[{"tags": ["haskell", "graph", "haskell-stack"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1467243355, "post_id": 38111666, "comment_id": 63657051, "body": "<a href=\"http://projects.haskell.org/diagrams/\" rel=\"nofollow noreferrer\">projects.haskell.org/diagrams</a>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1467280179, "post_id": 38111666, "comment_id": 63671148, "body": "please note that asking for libraries is considered off-topic here"}, {"owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "edited": false, "score": 0, "creation_date": 1467305102, "post_id": 38111666, "comment_id": 63689161, "body": "Ok. Let me write the question in other way"}, {"owner": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "edited": false, "score": 0, "creation_date": 1590167497, "post_id": 38111666, "comment_id": 109588006, "body": "Is this a duplicate of <a href=\"https://stackoverflow.com/questions/20824756/plotting-a-graph-using-haskell\" title=\"plotting a graph using haskell\">stackoverflow.com/questions/20824756/&hellip;</a>?"}, {"owner": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "edited": false, "score": 0, "creation_date": 1590168558, "post_id": 38111666, "comment_id": 109588565, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/20824756/plotting-a-graph-using-haskell\">Plotting a graph using Haskell</a>"}], "owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1467305031, "creation_date": 1467242687, "last_edit_date": 1467305031, "question_id": 38111666, "link": "https://stackoverflow.com/questions/38111666/plot-in-haskell", "title": "Plot in Haskell", "body": "<p>How can I plot graphs or others discrete structures like trees in Haskell? I would like to use colors and put some text.</p>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["scala", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 858, "user_id": 1875195, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/3ed18248b30a2d90cf49ea9393097425?s=128&d=identicon&r=PG", "display_name": "user1875195", "link": "https://stackoverflow.com/users/1875195/user1875195"}, "edited": false, "score": 1, "creation_date": 1467239370, "post_id": 38111078, "comment_id": 63655722, "body": "I would start off looking here <a href=\"http://docs.scala-lang.org/cheatsheets/\" rel=\"nofollow noreferrer\">docs.scala-lang.org/cheatsheets</a> its a pretty good quick reference guide if thats what you&#39;re interested in."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1467242222, "post_id": 38111078, "comment_id": 63656689, "body": "Don&#39;t try to learn a language by translating from another one: you are likely to produce non idiomatic code. Some Haskell patterns can be translated, yes, but I&#39;d start from a Scala tutorial in the beginning."}, {"owner": {"reputation": 19188, "user_id": 390708, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/34539ce56dfaf01d34a91861205f379d?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/390708/brian"}, "edited": false, "score": 0, "creation_date": 1467244544, "post_id": 38111078, "comment_id": 63657358, "body": "<code>removeLast</code> can be done with <code>init</code>. i.e. <code>List(1,2,3).init</code> is <code>List(1,2)</code>."}, {"owner": {"reputation": 19188, "user_id": 390708, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/34539ce56dfaf01d34a91861205f379d?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/390708/brian"}, "edited": false, "score": 0, "creation_date": 1467245250, "post_id": 38111078, "comment_id": 63657540, "body": "&#39;lessThan` can be done with <code>count</code>. i.e. <code>List(1.0, 1.1, 1.2, 1.3, 1.4).count(_ &lt; 1.3)</code> is <code>3</code>"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1467242185, "creation_date": 1467242185, "answer_id": 38111588, "question_id": 38111078, "link": "https://stackoverflow.com/questions/38111078/haskell-to-scala/38111588#38111588", "title": "Haskell to Scala", "body": "<p>If you want literal transformations, I think the below is as close as you will get. Bear in mind you have to put this inside an object/class/trait for this to compile (or just past it into the REPL).</p>\n\n<pre><code>def scalarProduct(list1: List[Int], list2: List[Int]): Int = (list1,list2) match {\n    case (Nil,_) =&gt; 0\n    case (_,Nil) =&gt; 0\n    case (x :: xs, y :: ys) =&gt; if (xs.length == ys.length) x*y + scalarProduct(xs,ys) else 0\n}\n\ndef lessThan(floats: List[Float], bound: Float): Int = floats match {\n    case Nil =&gt; 0\n    case x :: xs =&gt; if (x &lt; bound) 1 + lessThan(xs,n) else lessThan(xs,n)\n}\n\ndef removeLast[A](list: List[A]): List[A] = list match {\n    case Nil =&gt; Nil\n    case x :: xs =&gt; if (xs.length == 0) Nil else List(x) ++ removeLast(xs)\n}\n\ndef funcion(x: Int): Double = {\n    if (x &gt;= 6)\n      (9 to x*2).product\n    else if (x &gt; 0)\n      Math.pow(x,0.25)\n    else\n      (1 to -x).product.toDouble * Math.pow(5.0,x)\n}\n</code></pre>\n\n<p>This code is pretty un-Scala-like. For example, the Scala way of doing the first three would probably be with an implicit conversion class <code>RichList[A]</code>. Also, these can all be done much more simply using library functions - but I don't think that's what you are looking for (else you would've used the corresponding library functions for the Haskell code).</p>\n"}], "owner": {"reputation": 21, "user_id": 6118864, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208339433871019/picture?type=large", "display_name": "rodixxi", "link": "https://stackoverflow.com/users/6118864/rodixxi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 770, "favorite_count": 0, "accepted_answer_id": 38111588, "answer_count": 1, "score": -2, "last_activity_date": 1467242185, "creation_date": 1467239261, "question_id": 38111078, "link": "https://stackoverflow.com/questions/38111078/haskell-to-scala", "title": "Haskell to Scala", "body": "<p>Im new to Scala but I know something about functional programing thanks to Haskell and I'm looking for some examples, can you tell me how this would be in Scala?</p>\n\n<pre><code>scalarProduct :: [Int] -&gt; [Int] -&gt; Int\nscalarProduct [] _ = 0\nscalarProduct _ [] = 0\nscalarProduct (x:xs) (y:ys) = if length(xs) == length (ys) then x*y + scalarProduct xs ys else 0\n\nlessThan :: [Float] -&gt; Float -&gt; Int\nlessThan [] _ = 0\nlessThan (x:xs) n = if x &lt; n then 1 + lessThan xs n else lessThan xs n\n\n\nremoveLast :: [a] -&gt; [a]\nremoveLast [] = []\nremoveLast (x:xs) = if length(xs) == 0 then [] else [x] ++ removeLast xs\n\n\nfuncion :: Int -&gt; Float\nfuncion x | x &gt;= 6 = fromIntegral(product[9..x*2])\n          | x &gt; 0 = fromIntegral(x) ** (1/4)\n          | x &lt;= 0 = fromIntegral(product[1..(-x)]) * 5.0**fromIntegral(x)\n</code></pre>\n"}, {"tags": ["haskell", "type-constraints", "type-families"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1467255003, "post_id": 38109505, "comment_id": 63659699, "body": "What are you trying to accomplish? What problem are you trying to solve? What is <code>A</code> if there are &quot;many existing instances of <code>A</code> imported from external libraries which work just fine&quot;?"}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1467274039, "post_id": 38109505, "comment_id": 63667062, "body": "Sorry for not providing a context, but it&#39;s rather knotty. Here is a more elaborated <a href=\"https://github.com/forsyde/forsyde-atom/issues/5\" rel=\"nofollow noreferrer\">Git issue</a> providing also code snippets. In short: I am trying to include functions with a type signature like <code>f :: (Nat size) =&gt; (FSVec size a -&gt; b) -&gt; ...</code>  into a class where <code>f</code>&#39;s signature is <code>f :: (Value a -&gt; b) -&gt; ...</code>. Needless to say, I can modify the code for the class, but it will take too much effort to modify the code for every instance, that is why I prefer type synonyms. I will shortly update the questions as well."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1467287809, "post_id": 38109505, "comment_id": 63676305, "body": "It&#39;s unclear what you are asking. Please include a complete minimal example, explanations of what the parts of the example are, and the resulting error from the compiler. That&#39;s the <a href=\"http://stackoverflow.com/help/on-topic\">minimum information for a question to be on topic and useful for other stack overflow users</a>. Without that information a potential answerer can&#39;t tell if e.g. <code>X</code> is an attempt to &quot;wrap <code>FSVec size a</code> in a newtype&quot;."}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1467293634, "post_id": 38109505, "comment_id": 63680536, "body": "@Cirdec : it is done! I doubt that more details such as my attempts and errors could not shed more light into this matter. Moreover, I fear that it would fall into the &quot;debugging help&quot; category (as per the guide you sent), which I desperately wanted to avoid by formulating a general question for a general problem."}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "edited": false, "score": 0, "creation_date": 1467285592, "post_id": 38119396, "comment_id": 63674806, "body": "Thank you for the answer, I did not know the trick with <code>f = undefined</code>. On the other hand I fail to make the connection how can making <code>FSVec n</code> an instance of <code>A</code> help me with implementing the instance of <code>X</code> where the function argument is <code>FSVec n</code>. Could you please elaborate or point me to some documentation/examples since it seems I lack important background knowledge."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "edited": false, "score": 0, "creation_date": 1467287444, "post_id": 38119396, "comment_id": 63676061, "body": "@GeorgeUngureanu How are you going to determine <code>size</code> from <code>X</code>? How will the compiler? Is there some reason that the existence of a <code>Nat size</code> dictionary is all that needs to be known about the type <code>size</code>?"}, {"owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "edited": false, "score": 1, "creation_date": 1467532417, "post_id": 38119396, "comment_id": 63762992, "body": "I understand now that this is almost the answer I need. But instead of making <code>FSVec</code> an instance of <code>A</code>, in order to stick to the question <code>X</code> (which is the type I need to instantiate) should be defined as to contain a <code>Nat</code> context (e.g. <code>X n a = X a</code>). I will edit the answer and mark it as accepted. Thanks again!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1467279751, "creation_date": 1467279751, "answer_id": 38119396, "question_id": 38109505, "link": "https://stackoverflow.com/questions/38109505/type-level-constraints-in-instances-of-type-families/38119396#38119396", "title": "Type-level constraints in instances of type families", "body": "<p>It appears that you are using a class <code>Nat :: k -&gt; Constraint</code> and a data type <code>FSVec :: k -&gt; * -&gt; *</code>. The data type is constrained with the old <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/data-type-extensions.html#datatype-contexts\" rel=\"nofollow\"><code>DatatypeContexts</code></a> extension.</p>\n\n<pre><code>{-# LANGUAGE DatatypeContexts #-}\n\nclass Nat n\n\ndata Nat n =&gt; FSVec n a = FSVec -- ...\n</code></pre>\n\n<p>You have an existing class <code>A :: (* -&gt; *) -&gt; Constraint</code> which you'd like to write an <code>FSVec</code> instance for.</p>\n\n<pre><code>class A e where\n  --- ...\n  f :: ( {- ... -} b) -&gt; e a -&gt; e b\n</code></pre>\n\n<p>But <code>FSVec</code> can never have an <code>A</code> instance, because it's a kind mismatch. The class <code>A</code> requires a type argument with the kind <code>* -&gt; *</code> but <code>FSVec</code> has the kind <code>k -&gt; * -&gt; *</code>. You've already run into a problem, and aren't even using the type family yet. If you try to do this (hand waving away what the type family argument is for now)</p>\n\n<pre><code>data X = X\n\ninstance A (FSVec) where\n  type Arg FSVec a = X\n  f = undefined\n</code></pre>\n\n<p>You get a compiler error.</p>\n\n<pre><code>    Expecting one more argument to `FSVec'\n    The first argument of `A' should have kind `* -&gt; *',\n      but `FSVec' has kind `* -&gt; * -&gt; *'\n    In the instance declaration for `A (FSVec)'\n</code></pre>\n\n<p>Everything before here, including the compiler error, is useful information for communicating the problem you are having and is useful in asking for help.</p>\n\n<hr>\n\n<p>Fortunately it's a really easy problem to fix. If you pick some natural number <code>n</code>, then <code>FSVec n</code> has the kind <code>* -&gt; *</code>, which matches the kind of the type argument to <code>A</code>. You can start writing an <code>instance A (FSVec n)</code></p>\n\n<pre><code>instance A (FSVec n) where\n  f = -- ...\n</code></pre>\n\n<p>When you reintroduce the complete class definition with type families</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass A e where\n  type Arg e a\n  f :: (Arg e a -&gt; b) -&gt; e a -&gt; e b\n</code></pre>\n\n<p>The solution is still to write an <code>A</code> instance for <code>FSVec n</code> instead of for <code>FSVec</code>. Now that <code>n</code> has moved into the <code>instance</code> declaration, there's an obvious place to capture the needed <code>Nat n</code> context.</p>\n\n<pre><code>instance Nat n =&gt; A (FSVec n) where\n  type Arg (FSVec n) a = FSVec n a\n  f = undefined -- ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1467999546, "post_id": 38266131, "comment_id": 63964279, "body": "I&#39;m not sure entirely what you&#39;re trying to do, but it seems to me that all you really need is to write the function <code>Nat n =&gt; Y a -&gt; Y (FSVec n a)</code> for whichever <code>Y</code>s support this regrouping. Then the class <code>OldA</code> doesn&#39;t change at all, and there&#39;s an easy place to inject what the natural number <code>n</code> is."}], "tags": [], "owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "is_accepted": true, "score": 0, "last_activity_date": 1467979854, "last_edit_date": 1495541776, "creation_date": 1467979267, "answer_id": 38266131, "question_id": 38109505, "link": "https://stackoverflow.com/questions/38109505/type-level-constraints-in-instances-of-type-families/38266131#38266131", "title": "Type-level constraints in instances of type families", "body": "<p>Cirdec's answer explains one of the problems, but its solution given does not exactly answer the question posted. The question asks for an instance <code>X</code> for the class <code>A</code>, with a <code>FSVec</code> type synonym.</p>\n\n<p>The overarching issue here that prevents defining <code>type Arg X = FSVec size a</code> (in any possible configuration) is that <a href=\"https://wiki.haskell.org/GHC/Type_families#Injectivity.2C_type_inference.2C_and_ambiguity\" rel=\"nofollow noreferrer\">type families are not injective</a>. Knowing this and following Cirdec's reasoning, I can think of a workaround to achieve this goal: include a proxy \"context\" variable in <code>X</code>s type, to overcome the mentioned issue.</p>\n\n<pre><code>data X c a = X a\n\ninstance (Nat n) =&gt; A (X n) where\n  type (X n) a = FSVec n a\n  f = {- same as fIndependent -}\n</code></pre>\n\n<p>Of course, this is a quick fix that works for the minimal example (i.e. it answers the question posted), but might not scale well when composing multiple functions like <code>f</code> since there might appear type clashes between the inferred \"contexts\".</p>\n\n<hr>\n\n<p>The best solution I can think of would be to add a <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/constraint-kind.html\" rel=\"nofollow noreferrer\">constraint synonym</a> (as suggested by <a href=\"https://stackoverflow.com/a/9599994/2421116\">this answer</a>) for each instance, like:</p>\n\n<pre><code>import qualified Data.Param.FSVec\nimport Data.TypeLevel\nimport GHC.Exts  -- for Constraint kind\n\nclass A e where\n  type Arg e context a\n  type Ctx e context :: Constraint\n  f :: (Ctx e context) =&gt; (Arg e context a -&gt; b) -&gt; [e (Maybe a)] -&gt; [e b]\n\ninstance A Y where\n  type Arg Y c a = Maybe a\n  type Ctx Y c = ()\n  f = {- same as before -}\n\ninstance A X where\n  type Arg X size a = V.FSVec size (Maybe a)\n  type Ctx X size = Nat rate\n  f = {- same as fIndependent -}\n</code></pre>\n\n<p>But then we would have to deal with the ambiguous types resulted due to the infamous non-injectivity of type families (e.g. <code>Could not deduce: Arg e context0 a ~ Arg e context a</code>). In this case proving injectivity would have to be done manually using the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/InjectiveTypeFamilies\" rel=\"nofollow noreferrer\">TypeFamilyDependencies</a> extension (based on <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/ext-f/injective-type-families-acm.pdf\" rel=\"nofollow noreferrer\">injective type families</a>) available in GHC 8.0, and define <code>Arg</code> as:</p>\n\n<pre><code>type family Arg (e :: * -&gt; *) context = (r :: * -&gt; *) | r -&gt; context\n</code></pre>\n\n<p>Of course, this is not possible if the design of the type family is not injective (which is my case), but it is the cleanest solution so far. It is definitely recommended if one can design her type family using the guidelines in the <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/ext-f/injective-type-families-acm.pdf\" rel=\"nofollow noreferrer\">provided paper</a>.</p>\n"}], "owner": {"reputation": 125, "user_id": 2421116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f32a1587c6c2ee687f83d6ff29ed370f?s=128&d=identicon&r=PG", "display_name": "Iedu", "link": "https://stackoverflow.com/users/2421116/iedu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 38266131, "answer_count": 2, "score": 1, "last_activity_date": 1467979854, "creation_date": 1467232244, "last_edit_date": 1467414110, "question_id": 38109505, "link": "https://stackoverflow.com/questions/38109505/type-level-constraints-in-instances-of-type-families", "title": "Type-level constraints in instances of type families", "body": "<p>Is it possible to have type synonym families for parametrized data such as <a href=\"https://hackage.haskell.org/package/parameterized-data-0.1.5\" rel=\"nofollow\">Data.Param.FSVec</a>?</p>\n\n<p>Ideally, I would like this to compile:</p>\n\n<pre><code>class A e where\n  type Arg e a\n  f :: (Arg e a -&gt; b) -&gt; e a -&gt; e b\n\ninstance A X where\n  type Arg X a = Nat size =&gt; FSVec size a\n  f = {- implementation -}\n</code></pre>\n\n<p>I have tried several workarounds, like wrapping <code>FSVec size a</code> in a newtype, or constraint synonyms, but it seems that I could not get anything reasonable right.</p>\n\n<hr>\n\n<h2>Context + minimal working example</h2>\n\n<p><code>A</code> is a class previously defined (for example) as such: </p>\n\n<pre><code>class OldA e where\n  f :: (Maybe a -&gt; b) -&gt; [e (Maybe a)] -&gt; [e b]\n</code></pre>\n\n<p>An example of type inheriting <code>OldA</code> is:</p>\n\n<pre><code>data Y a = Y a\n\ninstance Functor Y where\n  fmap f (Y a) = Y (f a)\n\ninstance OldA Y where\n  f = fmap . fmap\n</code></pre>\n\n<p>I want to extend this class to be able to express more general function arguments for <code>f</code>. Let's say we have a type <code>X</code> and an associated function <code>fIndependent</code>:</p>\n\n<pre><code>import qualified Data.Param.FSVec as V\nimport Data.TypeLevel hiding ((==))\n\ndata X a = X a deriving Show\nfromX (X a) = a\n\nfIndependent :: (Nat size) =&gt; (V.FSVec size (Maybe a) -&gt; b) -&gt; [X (Maybe a)] -&gt; [X b]\nfIndependent _ [] = []\nfIndependent f xs = let x'  = (V.reallyUnsafeVector . take c . fmap fromX) xs\n                        xs' = drop c xs\n                        c   = V.length x'\n                    in if c == length (V.fromVector x') then X (f x') : fIndependent f xs' else []\n</code></pre>\n\n<p><code>fIndependent</code> is sane itself. Testing it with a function </p>\n\n<pre><code>test :: V.FSVec D2 x -&gt; Int\ntest a = V.length a\n</code></pre>\n\n<p>will grant the result:</p>\n\n<pre><code>&gt;&gt;&gt; fIndependent test $ map (X . Just) [1,2,3,4,5,6,7,8,9]\n[X 2, X 2, X 2, X 2]\n</code></pre>\n\n<p>Ok, now how to extend <code>OldA</code>? The most \"natural\" thing that came into my mind is to equip class <code>A</code> with a type synonym family <code>Arg e a</code> as below.</p>\n\n<pre><code>class NewA e where\n  type Arg e a\n  f :: (Arg e a -&gt; b) -&gt; [e (Maybe a)] -&gt; [e b]\n</code></pre>\n\n<p>Converting all existing instances is easy: </p>\n\n<pre><code>instance NewA Y where\n  type Arg Y a = Maybe a\n  f = fmap . fmap  -- old implementation\n</code></pre>\n\n<p>To express <code>fIndependent</code> as f is the difficult part, since just adding </p>\n\n<pre><code>instance NewA X where\n  type Arg X a = (Nat size) =&gt; FSVec size (Maybe a)  -- wrong!!!\n  f = {- same as fIndependent -}\n</code></pre>\n\n<p>does not work. This is what I have trouble with.</p>\n\n<hr>\n\n<h2>Try-outs</h2>\n\n<p>Most solutions I saw propose wrapping <code>FSVec</code> inside a <code>newtype</code>. Doing so does not help since the following code:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nnewtype ArgV a = ArgV (forall rate.Nat rate =&gt; V.FSVec rate (Maybe a))\n\ninstance NewA X where\n  type Arg X a = ArgV a\n  g f xs = let x'  = (V.reallyUnsafeVector . take c . fmap fromX) xs\n               xs' = drop c xs\n               c   = V.length x'\n           in if c == length (V.fromVector x') then X (f $ ArgV x') : g f xs' else []\n</code></pre>\n\n<p>the type inference system seems to lose the information about <code>size</code>:</p>\n\n<pre><code>Couldn't match type \u2018s0\u2019 with \u2018rate\u2019 \u2026\n      because type variable \u2018rate\u2019 would escape its scope\n    This (rigid, skolem) type variable is bound by\n      a type expected by the context: Nat rate =&gt; V.FSVec rate (Maybe a)\n    Expected type: V.FSVec rate (Maybe a)\n      Actual type: V.FSVec s0 (Maybe a)\n    Relevant bindings include\n      x' :: V.FSVec s0 (Maybe a)\n        (bound at ...)\n    In the first argument of \u2018Args\u2019, namely \u2018x'\u2019\n    In the second argument of \u2018($)\u2019, namely \u2018Args x'\u2019\nCompilation failed.\n</code></pre>\n\n<p>I would appreciate any lead or hint in this matter.</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"tags": [], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "is_accepted": true, "score": 2, "last_activity_date": 1467233756, "creation_date": 1467233756, "answer_id": 38109871, "question_id": 38102625, "link": "https://stackoverflow.com/questions/38102625/how-to-restart-a-sandboxed-and-custom-compiled-xmonad/38109871#38109871", "title": "How to restart a sandboxed and custom-compiled Xmonad", "body": "<p>It turns out the problem was that I couldn't use the <code>xmonad</code> binary produced by stack even though it was in my path and <code>~/.xmonad/xmonad-x86_64-linux</code> was symlinked to it. Instead, I got restarting working by binding my mod-q to the following:</p>\n\n<pre><code>restart \"/home/oldmanmike/.xmonad/xmonad-x86_64-linux\" True\n</code></pre>\n\n<p>It will work provided I give it the absolute path.</p>\n\n<p>This makes some sense given an observation earlier that putting the following in my .xinitrc would cause X to crash:</p>\n\n<pre><code>exec xmonad\n</code></pre>\n\n<p>Instead, I had to use the following for the initial launch:</p>\n\n<pre><code>exec ~/.xmonad/xmonad-x86_64-linux\n</code></pre>\n\n<p>So for now, it would seem as if calling <code>xmonad</code> is a lot less reliable of a command and I should just alias the path to <code>xmonad-x86_64-linux</code> and call that from now on.</p>\n"}], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 38109871, "answer_count": 1, "score": 3, "last_activity_date": 1467233756, "creation_date": 1467210532, "last_edit_date": 1467230227, "question_id": 38102625, "link": "https://stackoverflow.com/questions/38102625/how-to-restart-a-sandboxed-and-custom-compiled-xmonad", "title": "How to restart a sandboxed and custom-compiled Xmonad", "body": "<p>I wanted extend my <code>xmonad.hs</code> by moving it into its own sandboxed project environment via <code>stack</code>. It turns out that such sandboxing is possible via embedding your xmonad <code>main</code> function in a parent <code>main</code> that utilizes <a href=\"https://hackage.haskell.org/package/xmonad-entryhelper-0.1.0.0\" rel=\"nofollow\">xmonad-entryhelper</a>. Following the instructions in the projects README, converted <code>xmonad.hs</code> from this:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  statBar &lt;- spawnPipe myXMobar\n  xmonad def\n    { terminal            = myTerminal\n    , focusFollowsMouse   = myFocusFollowsMouse\n    , borderWidth         = myBorderWidth\n    , modMask             = myModMask\n    , workspaces          = myWorkspaces\n    , normalBorderColor   = myNormalBorderColor\n    , focusedBorderColor  = myFocusedBorderColor\n\n    -- key bindings\n    , keys                = myKeys\n    --, mouseBindings       = myMouseBindings\n\n    -- hooks, layouts\n    , layoutHook          = myLayoutHook\n    , manageHook          = manageHook def &lt;+&gt; myManageHook\n    --, handleEventHook     = myEventHook\n    , logHook             = myLogHook statBar &gt;&gt; setWMName \"LG3D\"\n    --, startupHook         = myStartupHook\n    }\n</code></pre>\n\n<p>To...</p>\n\n<pre><code>kaleidoscope :: IO ()\nkaleidoscope = do\n  statBar &lt;- spawnPipe myXMobar\n  xmonad def\n    { terminal            = myTerminal\n    , focusFollowsMouse   = myFocusFollowsMouse\n    , borderWidth         = myBorderWidth\n    , modMask             = myModMask\n    , workspaces          = myWorkspaces\n    , normalBorderColor   = myNormalBorderColor\n    , focusedBorderColor  = myFocusedBorderColor\n\n    -- key bindings\n    , keys                = myKeys\n    --, mouseBindings       = myMouseBindings\n\n    -- hooks, layouts\n    , layoutHook          = myLayoutHook\n    , manageHook          = manageHook def &lt;+&gt; myManageHook\n    --, handleEventHook     = myEventHook\n    , logHook             = myLogHook statBar &gt;&gt; setWMName \"LG3D\"\n    --, startupHook         = myStartupHook\n    }\n\nmain :: IO ()\nmain = EH.withCustomHelper kaleidoscopeConfig\n  where\n  kaleidoscopeConfig = EH.defaultConfig\n    { EH.run = kaleidoscope\n    , EH.compile = \\force -&gt; EH.withLock ExitSuccess $ do\n        let cmd =\n              if force\n                then \"cd /home/oldmanmike/src/github.com/oldmanmike/kaleidoscope &amp;&amp; stack clean &amp;&amp; stack build\"\n                else \"cd /home/oldmanmike/src/github.com/oldmanmike/kaleidoscope &amp;&amp; stack build\"\n        EH.compileUsingShell cmd\n    , EH.postCompile = EH.defaultPostCompile\n    }\n</code></pre>\n\n<p>So, I can now compile my project using <code>xmonad --recompile</code> and the binary found in <code>.xmonad</code> is soft linked to the binary produced by my sandboxed project.</p>\n\n<p><strong>But for some reason, <code>xmonad --restart</code> doesn't work anymore. What could be tripping it up?</strong></p>\n\n<p>The command itself doesn't seem to produce any errors from X - it just returns successfully with no sign anything even happened. I trying both the <code>xmonad --restart</code> command at the shell and binding <code>mod-q</code> in xmonad to either <code>spawnPipe \"xmonad --restart\"</code> or <code>io sendRestart</code> - neither seem to work. When I shut down my Xserver and restart it manually, any and all updates show up, but right now hot swapping changes doesn't seem to work. Does it need to see two separate binaries at once - the current one and new one?</p>\n\n<p><strong>EDIT:</strong> I've been playing around with the problem via reading the source code for <code>xmonad</code>, <code>xmonad-entryhelper</code>, and <code>X11</code>. I'm currently picking apart this:</p>\n\n<pre><code>sendRestart :: IO ()\nsendRestart = do\n    dpy &lt;- openDisplay \"\"\n    rw &lt;- rootWindow dpy $ defaultScreen dpy\n    xmonad_restart &lt;- internAtom dpy \"XMONAD_RESTART\" False\n    allocaXEvent $ \\e -&gt; do\n        setEventType e clientMessage\n        setClientMessageEvent e rw xmonad_restart 32 0 currentTime\n        sendEvent dpy rw False structureNotifyMask e\n    sync dpy False\n</code></pre>\n\n<p>I'm not familiar with the X11 API yet, but what weirds me out is the <code>internAtom</code> function and what the purpose of XMONAD_RESTART serves in the client message. There's also this handler:</p>\n\n<pre><code>handle e@ClientMessageEvent { ev_message_type = mt } = do\n    a &lt;- getAtom \"XMONAD_RESTART\"\n    if (mt == a)\n        then restart \"xmonad\" True\n        else broadcastMessage e\n\nhandle e = broadcastMessage e -- trace (eventName e) -- ignoring\n</code></pre>\n\n<p>So I'm guessing atoms are just ad-hoc strings used to ID message events?\nI don't get any error messages when I run a restart so it would seem as if it makes it all the way to the operation handle:</p>\n\n<pre><code>restart :: String -&gt; Bool -&gt; X ()\nrestart prog resume = do\n    broadcastMessage ReleaseResources\n    io . flush =&lt;&lt; asks display\n    let wsData = show . W.mapLayout show . windowset\n        maybeShow (t, Right (PersistentExtension ext)) = Just (t, show ext)\n        maybeShow (t, Left str) = Just (t, str)\n        maybeShow _ = Nothing\n        extState = return . show . catMaybes . map maybeShow . M.toList . extensibleState\n    args &lt;- if resume then gets (\\s -&gt; \"--resume\":wsData s:extState s) else return []\n    catchIO (executeFile prog True args Nothing)\n</code></pre>\n\n<p>I'm suspecting there's a permission issue here that <code>xmonad-x86_64-linux</code> had back when it was compiled and launched by a system installation of xmonad rather than my sandboxed one (which is currently symlinked to the binary produced by stack).</p>\n"}, {"tags": ["arrays", "haskell", "repa"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467214896, "post_id": 38101549, "comment_id": 63642184, "body": "I think all you need is to <code>reshape</code> the <code>x</code> and <code>y</code> arrays to be 2D and then <code>append</code> them."}], "answers": [{"comments": [{"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 0, "creation_date": 1467354510, "post_id": 38106406, "comment_id": 63707215, "body": "Thanks, that&#39;s it. Just out of curiosity - is it possible to control in which dimension are the arrays appended? Or is it only in the last one?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 0, "creation_date": 1467659885, "post_id": 38106406, "comment_id": 63807563, "body": "@zegkljan I don&#39;t think there is a slick general approach for that - you&#39;d have to change the shape, append, then change the shape back. For two dimensions you can use <code>transpose</code>, but otherwise I think you&#39;d go with <code>backpermute</code>. Bear in mind that even <code>col_stack</code> for numpy only works for 1D arguments too - there just is no simple way to generalize both <code>row_stack</code> and <code>col_stack</code> to N dimensions."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1467221316, "creation_date": 1467221316, "answer_id": 38106406, "question_id": 38101549, "link": "https://stackoverflow.com/questions/38101549/how-to-stack-arrays-in-repa-haskell/38106406#38106406", "title": "How to stack arrays in repa (Haskell)", "body": "<p>As I mentioned in the initial comment, all you need is to <code>reshape</code> then <code>append</code> (both in <a href=\"https://hackage.haskell.org/package/repa-3.4.1.1/docs/Data-Array-Repa.html\" rel=\"nofollow\">Data.Array.Repa</a>.</p>\n\n<pre><code>ghci&gt; let x' = reshape (ix2 4 1) x\nghci&gt; let y' = reshape (ix2 4 1) y\nghci&gt; z &lt;- computeP $ x' `append` y' :: IO (Array U DIM2 Int)\nghci&gt; z\nAUnboxed ((Z :. 4) :. 2) [1,5,2,6,3,7,4,8]\n</code></pre>\n\n<p>As for pretty-printing, <code>repa</code> isn't very good (likely because there is no good pretty printing for higher dimensions). Here is a one-line hack to display <code>z</code></p>\n\n<pre><code>ghci&gt; putStr $ unlines [ unwords [ show $ z ! ix2 i j  |  i&lt;-[0..3] ] | j&lt;-[0..1] ]\n1 2 3 4\n5 6 7 8\n</code></pre>\n"}], "owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 38106406, "answer_count": 1, "score": 1, "last_activity_date": 1467221316, "creation_date": 1467208062, "question_id": 38101549, "link": "https://stackoverflow.com/questions/38101549/how-to-stack-arrays-in-repa-haskell", "title": "How to stack arrays in repa (Haskell)", "body": "<p>Suppose there are two 1-D arrays of the same length:</p>\n\n<pre><code>let x = fromListUnboxed (ix1 4) [1, 2, 3, 4]\nlet y = fromListUnboxed (ix1 4) [5, 6, 7, 8]\n</code></pre>\n\n<p>Now I would like to stack these two arrays into one 2-D array so that these arrays form the rows. How can I do it in repa?</p>\n\n<p>Basically, I'm looking for an equivalent of numpy's <code>row_stack</code>:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>&gt;&gt;&gt; x = np.array([1, 2, 3, 4])\n&gt;&gt;&gt; y = np.array([5, 6, 7, 8])\n&gt;&gt;&gt; np.row_stack((x, y))\narray([[1, 2, 3, 4],\n       [5, 6, 7, 8]])\n</code></pre>\n\n<p><strong>Note.</strong> The two arrays, <code>x</code> and <code>y</code>, come from outside, i.e. I cannot create the 2-D array from scratch.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1467203499, "post_id": 38099510, "comment_id": 63633346, "body": "I would recommend setting up atom to use stack (should be possible: <a href=\"https://github.com/atom-haskell/ide-haskell/issues/82\" rel=\"nofollow noreferrer\">github.com/atom-haskell/ide-haskell/issues/82</a>)"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1467206575, "post_id": 38099510, "comment_id": 63635592, "body": "Is GHC in your system path?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467206585, "post_id": 38099510, "comment_id": 63635600, "body": "What happens if you just run <code>ghc</code> from the command line?"}, {"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1467235609, "post_id": 38099510, "comment_id": 63654147, "body": "There is no GHC environment variable and I am unable to run ghc from the command line."}, {"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1467291010, "post_id": 38099510, "comment_id": 63678610, "body": "I guess the question is - Where does stack install ghc? Once I know this I can add it to the path and all should be ok."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1478637330, "creation_date": 1478637330, "answer_id": 40495938, "question_id": 38099510, "link": "https://stackoverflow.com/questions/38099510/unable-to-build-a-haskell-program-using-cabal/40495938#40495938", "title": "Unable to build a Haskell program using cabal", "body": "<p>You can find out where stack installs ghc by running <code>stack path --ghc-paths</code>.</p>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 315, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478637330, "creation_date": 1467203198, "last_edit_date": 1478637264, "question_id": 38099510, "link": "https://stackoverflow.com/questions/38099510/unable-to-build-a-haskell-program-using-cabal", "title": "Unable to build a Haskell program using cabal", "body": "<p>I am trying to learn Haskell with Atom ide on windows 7. I can build a program with stack but not with cabal. I wouldn't care about this except that Atom uses cabal. When I enter the command 'cabal build' I get the following messages: \"Package has never been configured. Configuring with default flags. If this fails please run configure manually.\" \"cabal: The program 'ghc' version >=6.4 is required but it could not be found.\" I have ghc version 7.10.3 installed which is >=6.4. So I guess it can't find the ghc compiler. Could somebody please advise?</p>\n"}, {"tags": ["haskell", "conduit", "http-conduit"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1467218466, "post_id": 38099279, "comment_id": 63644601, "body": "Probably would get better help opening an <code>http-conduit</code> issue"}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1467219001, "post_id": 38099279, "comment_id": 63644909, "body": "Sure, opened one...at the time of posting, I wasn&#39;t sure if it were a bug, or a wrong usage of streaming feature on my part."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "is_accepted": true, "score": 0, "last_activity_date": 1467749968, "last_edit_date": 1467749968, "creation_date": 1467740701, "answer_id": 38209552, "question_id": 38099279, "link": "https://stackoverflow.com/questions/38099279/http-manager-shared-state-corruption-when-sending-wrong-length-for-stream/38209552#38209552", "title": "HTTP manager shared state corruption when sending wrong length for stream", "body": "<p>This is an issue with <code>http-client</code> <a href=\"https://github.com/snoyberg/http-client/issues/204\" rel=\"nofollow\">as reported here</a>. It leaves it up to the caller to make sure that the passed content length is correct. It is the shared connection to the server that seems to be in the bad state. Depending on the actual length vs expected length, the beginning of the next request might be treated as the end of the previous request body, causing the next request to be misinterpreted by the server.</p>\n\n<p>This has been fixed and merged into the trunk through a <a href=\"https://github.com/snoyberg/http-client/pull/205\" rel=\"nofollow\">pull request</a>. The solution was to add a simple length validation.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 38209552, "answer_count": 1, "score": 1, "last_activity_date": 1467749968, "creation_date": 1467202633, "last_edit_date": 1467203096, "question_id": 38099279, "link": "https://stackoverflow.com/questions/38099279/http-manager-shared-state-corruption-when-sending-wrong-length-for-stream", "title": "HTTP manager shared state corruption when sending wrong length for stream", "body": "<p>Given a shared HTTP manager, it seems that if the <code>requestBody</code> is of type <code>requestBodySource</code> and if wrong length is supplied for the request body, then subsequent requests will crap out on same HTTP manager for about 20 seconds. There seems to be something about interaction of shared state and <code>GivesPopper</code> perhaps that is causing this issue. Here is a sample code that reproduces it - we use requestb.in for sending wrong length upload, and then try to read another valid URL on requestb.in. </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport           Data.Conduit.Binary (sourceFile)\nimport           Network.HTTP.Conduit \nimport           Network.HTTP.Types\nimport qualified Data.ByteString.Lazy as LBS\nimport System.IO\nimport Control.Monad.Trans.Resource (runResourceT)\nimport Control.Concurrent.Async (async,waitCatch)\nimport Control.Exception (displayException)\n\nmain :: IO ()\nmain = do\n  {- Set up a ResourceT region with an available HTTP manager. -}\n  httpmgr &lt;- newManager tlsManagerSettings\n  httpmgr2 &lt;- newManager tlsManagerSettings\n  let file =\"out\" -- some byte contents with length &gt; 1\n  lenb &lt;- System.IO.withFile file ReadMode hFileSize\n  let inbytes = sourceFile file \n  initReq &lt;- parseUrl \"http://requestb.in/saxbx3sa\"\n  putreq &lt;- async $ runResourceT $ do\n    let req = initReq { method = \"POST\",\n      -- let us send wrong length in requestBodySource\n      requestBody = (requestBodySource (fromIntegral $ lenb - 1) inbytes)}\n    resp &lt;- httpLbs req httpmgr \n    return (statusCode . responseStatus $ resp)\n  putreqRes &lt;- waitCatch putreq\n  case putreqRes of\n    Left e -&gt; print $ displayException $ e\n    Right r -&gt; print $ r\n  getreq &lt;- async $ runResourceT $ do\n    -- Let us do a GET on a different resource to see if it works\n    initReq &lt;- parseUrl \"http://requestb.in/1l15sz21\"\n    let req = initReq { method = \"GET\"}\n    resp &lt;- httpLbs req httpmgr \n    return (statusCode . responseStatus $ resp)\n  getreqRes &lt;- waitCatch getreq\n  case getreqRes of\n    Left e -&gt; print $ displayException $ e\n    Right r -&gt; print $ r\n</code></pre>\n\n<p>Output - first bad upload goes through as <code>HTTP 200</code>, and subsequent <code>GET</code> request immediately causes <code>HTTP 400</code> error:</p>\n\n<pre><code> *Main&gt; main\n    200\n    \"StatusCodeException (Status {statusCode = 400, statusMessage = \\\"Bad Request\\\"})\n [(\\\"Date\\\",\\\"Wed, 29 Jun 2016 11:54:59 GMT\\\"),(\\\"Content-Type\\\",\\\"text/html\\\"),\n(\\\"Content-Length\\\",\\\"177\\\"),(\\\"Connection\\\",\\\"close\\\"),(\\\"Server\\\",\\\"-nginx\\\"),\n(\\\"CF-RAY\\\",\\\"-\\\"),(\\\"X-Response-Body-Start\\\",\\\"&lt;html&gt;\\\\r\\\\n&lt;head&gt;&lt;title&gt;400 Bad \nRequest&lt;/title&gt;&lt;/head&gt;\\\\r\\\\n&lt;body bgcolor=\\\\\\\"white\\\\\\\"&gt;\\\\r\\\\n&lt;center&gt;&lt;h1&gt;400 Bad \nRequest&lt;/h1&gt;&lt;/center&gt;\\\\r\\\\n&lt;hr&gt;&lt;center&gt;cloudflare-\nnginx&lt;/center&gt;\\\\r\\\\n&lt;/body&gt;\\\\r\\\\n&lt;/html&gt;\\\\r\\\\n\\\"),(\\\"X-Request-URL\\\",\\\"GET \nhttp://requestb.in:80/saxbx3sa\\\")] (CJ {expose = []})\"\n</code></pre>\n\n<p>Using a different http manager instead for <code>GET</code> request will return <code>HTTP 200</code>. So, shared state in http manager seems to be the problem here.</p>\n\n<p>Has anyone else observed it? I went through github issues for <code>HTTP Manager</code> but haven't seen this reported. On wrong streaming length, the behavior shouldn't be to corrupt the HTTP manager as seems to happen here.</p>\n\n<p>I have also simulated a source file for requestBodySource where length is correct, but the source aborts mid-way due to a simulated failure (to simulate network issues). In that case, there are no errors. So, it seems we have just one case where sending wrong length without any failures will cause some kind of shared state to become corrupt here, which gets released within 25 seconds.</p>\n\n<p>If anyone has any insights on what is going on here, it will be very helpful. I have a workaround of enforcing right streaming length. However, I will like to understand what is going on so that I can avoid running into this situation in production. </p>\n"}, {"tags": ["haskell", "repa"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1467206749, "post_id": 38097937, "comment_id": 63635731, "body": "What is not &quot;effective&quot; about <code>[(Double, Double, Double)]</code>? Please tell us why that isn&#39;t working. What about <code>Array U DIM1 (Double, Double, Double)</code>?"}, {"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1467206896, "post_id": 38097937, "comment_id": 63635860, "body": "@Eric When I said effective I meant computationally effective. For example, random access to Haskell lists is O(n)."}], "answers": [{"comments": [{"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 0, "creation_date": 1467232736, "post_id": 38103960, "comment_id": 63652748, "body": "Why didn&#39;t I try it? Well, because I&#39;m an idiot :). Thank you."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1467214036, "creation_date": 1467214036, "answer_id": 38103960, "question_id": 38097937, "link": "https://stackoverflow.com/questions/38097937/an-array-of-triplets-in-repa-checked-at-compile-time/38103960#38103960", "title": "An array of triplets in repa checked at compile time", "body": "<p>I may be reading the documentation wrong, but I think <code>Array U DIM1 (Double,Double,Double)</code> is exactly what you want (why don't you try it?). Before you tell me it is inefficient:</p>\n\n<ul>\n<li><p>As far as I can tell, there is no way of introducing <code>Array U sh u</code> without the constraints <code>Shape sh</code> <em>and</em> <code>Unbox u</code>. Therefore, any <code>Array U sh u</code> will necessarily be efficient and fully unboxed.</p></li>\n<li><p>In <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/candidate/docs/Data-Vector-Unboxed.html#t:Unbox\" rel=\"nofollow\">Unbox</a> notice the instance <code>(Unbox a, Unbox b, Unbox c) =&gt; Unbox (a, b, c)</code>, so <code>Unbox (Double, Double, Double)</code> is derivable.</p></li>\n</ul>\n"}], "owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 38103960, "answer_count": 1, "score": 1, "last_activity_date": 1467214036, "creation_date": 1467198827, "question_id": 38097937, "link": "https://stackoverflow.com/questions/38097937/an-array-of-triplets-in-repa-checked-at-compile-time", "title": "An array of triplets in repa checked at compile time", "body": "<p>First of all, I'm a total newbie in repa and I still consider myself a beginner in Haskell in general.</p>\n\n<p>I need an effective array of triplets of doubles. The na\u00efve approach would be <code>[(Double, Double, Double)]</code> but that's not effective. I thought I could use repa as it is supposed to be very effective. However, I don't know how should I define an array of triplets.</p>\n\n<p>I could do <code>Array U DIM2 Double</code> and store the elements of the triplets in the second dimension (i.e. first index is the index of the triplet and the second index is the element of the triplet). However there is nothing that forces the second dimension to be only of size 3.</p>\n\n<p>I need something like <code>Array U DIM1 Vec3D</code> but that's not possible as <code>Vec3D</code> is not instance of <code>Data.Vector.Unboxed.Base.Unbox</code>.</p>\n"}, {"tags": ["javascript", "haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 806, "user_id": 1527537, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5cac7130ae6a4029c6fc00eadc5868e6?s=128&d=identicon&r=PG", "display_name": "Joe Shanahan", "link": "https://stackoverflow.com/users/1527537/joe-shanahan"}, "edited": false, "score": 0, "creation_date": 1469008463, "post_id": 38098283, "comment_id": 64358393, "body": "2nd method: Seems to be exactly what I want - does this affect performance?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 806, "user_id": 1527537, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5cac7130ae6a4029c6fc00eadc5868e6?s=128&d=identicon&r=PG", "display_name": "Joe Shanahan", "link": "https://stackoverflow.com/users/1527537/joe-shanahan"}, "edited": false, "score": 1, "creation_date": 1469024602, "post_id": 38098283, "comment_id": 64370077, "body": "Yes, there are tradeoffs regarding HTTP round-trips vs enhanced content caching. It&#39;s actually a really big topic in the general web dev world."}, {"owner": {"reputation": 806, "user_id": 1527537, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5cac7130ae6a4029c6fc00eadc5868e6?s=128&d=identicon&r=PG", "display_name": "Joe Shanahan", "link": "https://stackoverflow.com/users/1527537/joe-shanahan"}, "edited": false, "score": 0, "creation_date": 1469028756, "post_id": 38098283, "comment_id": 64371627, "body": "Are there any Yesod blog posts around this topic that you know of?"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1467199815, "creation_date": 1467199815, "answer_id": 38098283, "question_id": 38096625, "link": "https://stackoverflow.com/questions/38096625/expose-compiled-julius-templates-as-a-seperate-file-instead-of-directly-placing/38098283#38098283", "title": "Expose compiled Julius templates as a seperate file, instead of directly placing them in the DOM", "body": "<p>There are multiple choices here:</p>\n\n<ul>\n<li>If you put the Julius content in an external file, you can use <code>juliusFileReload</code> and then edit the file and reload the webpage without a recompile. The scaffolded site does this by default.</li>\n<li>Have generated Javascript be placed in a separate file. This is also the default behavior of the scaffolded site.</li>\n</ul>\n"}], "owner": {"reputation": 806, "user_id": 1527537, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5cac7130ae6a4029c6fc00eadc5868e6?s=128&d=identicon&r=PG", "display_name": "Joe Shanahan", "link": "https://stackoverflow.com/users/1527537/joe-shanahan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 1, "accepted_answer_id": 38098283, "answer_count": 1, "score": 0, "last_activity_date": 1467199815, "creation_date": 1467195205, "question_id": 38096625, "link": "https://stackoverflow.com/questions/38096625/expose-compiled-julius-templates-as-a-seperate-file-instead-of-directly-placing", "title": "Expose compiled Julius templates as a seperate file, instead of directly placing them in the DOM", "body": "<p>When debugging JS, Chrome allows you edit JS and then reload the page. This can only happen if the JS you are editing is provided as a separate resource. As far as I can tell, it's currently not possible to debug JS code is this fashion because of the way Yesod drops any included JS on to the page directly.</p>\n\n<p>Editing a julius template file without changing any variable interpolation allows for instant reloading of the page. However, if I include small snippets of javascript with:</p>\n\n<pre><code>toWidget [julius|doStuff();|]\n</code></pre>\n\n<p>I can't edit this Javascript for debugging without causing a reload of the model, which for our case, takes ~1minute. Is there a way around this?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1467206766, "post_id": 38098657, "comment_id": 63635750, "body": "To force stck to rebuild a package - have a look at: <a href=\"http://stackoverflow.com/a/37237777/866915\">stackoverflow.com/a/37237777/866915</a>"}, {"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "edited": false, "score": 0, "creation_date": 1484387363, "post_id": 38098657, "comment_id": 70496384, "body": "I tried with <code>--no-system-ghc</code> and it doesn&#39;t make any difference. I tried to remove my <code>~&#47;.cabal</code> and <code>~&#47;.stack</code> folders and after <code>stack</code> re-installed the compiler it doesn&#39;t give me that wrong path, but it doesn&#39;t give me <i>any</i> path, the output of that command is now empty. I have nothing special in any of <code>Setup.hs</code> either."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 1, "last_activity_date": 1467201598, "last_edit_date": 1467201598, "creation_date": 1467200916, "answer_id": 38098657, "question_id": 38096298, "link": "https://stackoverflow.com/questions/38096298/where-is-the-source-of-ghc-paths-value-came-from/38098657#38098657", "title": "Where is the source of `GHC.Paths.*` value came from?", "body": "<p>You are almost right, the <code>GHC_</code> variables are CPP definitions coming from <a href=\"https://github.com/simonmar/ghc-paths/blob/7d0695ccd905f2d3878848990560efa435873549/Setup.hs#L55-L58\" rel=\"nofollow\">custom <code>Setup.hs</code></a>:</p>\n\n<pre><code>let buildinfo = emptyBuildInfo{\n         cppOptions = [\"-DGHC_PATHS_GHC_PKG=\" ++ show c_ghc_pkg,\n                       \"-DGHC_PATHS_GHC=\" ++ show c_ghc,\n                       \"-DGHC_PATHS_LIBDIR=\" ++ show libdir,\n                       \"-DGHC_PATHS_DOCDIR=\" ++ show docdir ]\n       }\n</code></pre>\n\n<hr>\n\n<p>About your problem with wrong path, try to run <code>stack --no-system-ghc ghci</code>. If it still shows <code>\"/usr/bin/ghc-7.10.3\"</code> for GHC paths, then I suspect that you <strong>had</strong> GHC there when you compiled <code>ghc-paths</code> for GHC-7.10.3, and as <code>stack</code> is quite good in not rebuilding stuff, the old version of <code>ghc-paths</code> is still there. I don't know a way to rebuild a package in a snapshot, other then whiping <code>~/.stack</code> and starting over; which might be a good idea. if you changed you global GHC stuff.</p>\n\n<p>There is a related issue: <a href=\"https://github.com/commercialhaskell/stack/issues/2221\" rel=\"nofollow\">Stop using system-ghc silently</a>.</p>\n"}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 38098657, "answer_count": 1, "score": 0, "last_activity_date": 1484387458, "creation_date": 1467194399, "last_edit_date": 1484387458, "question_id": 38096298, "link": "https://stackoverflow.com/questions/38096298/where-is-the-source-of-ghc-paths-value-came-from", "title": "Where is the source of `GHC.Paths.*` value came from?", "body": "<p>I am running <code>stack</code> version 1.1.2 x86_64 hpack-0.14.1</p>\n\n<pre><code>$ stack exec which ghc\nRun from outside a project, using implicit global project config\nUsing resolver: lts-5.10 from implicit global project's config file: /home/wisut/.stack/global-project/stack.yaml\n/home/wisut/.stack/programs/x86_64-linux/ghc-7.10.3/bin/ghc\n</code></pre>\n\n<p>but when using <code>stack ghci</code> with <code>GHC.Paths</code> it is return the wrong path</p>\n\n<pre><code>$ stack ghci\nRun from outside a project, using implicit global project config\nUsing resolver: lts-5.10 from implicit global project's config file: /home/wisut/.stack/global-project/stack.yaml\nError parsing targets: The specified targets matched no packages. Perhaps you need to run 'stack init'?\nWarning: build failed, but optimistically launching GHCi anyway\nConfiguring GHCi with the following packages: \nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nOk, modules loaded: none.\nPrelude&gt; GHC.Paths.ghc\n\"/usr/bin/ghc-7.10.3\"\n</code></pre>\n\n<p>I am running Arch linux with ghc 8.0.1 therefor there is no ghc-7 avaliable outside <code>stack</code></p>\n\n<pre><code>[wisut@earth ~]$ which ghc\n/usr/bin/ghc\n[wisut@earth ~]$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 8.0.1\n[wisut@earth ~]$ ls -al /usr/bin/ghc\nlrwxrwxrwx 1 root root 9 May 24 18:28 /usr/bin/ghc -&gt; ghc-8.0.1\n</code></pre>\n\n<p>Looking at GHC.Paths source, I have no idea where the value are from. Is it the ENV vars? </p>\n\n<pre><code>{-# LANGUAGE CPP #-}\n\nmodule GHC.Paths (\n        ghc, ghc_pkg, libdir, docdir\n  ) where\n\nlibdir, docdir, ghc, ghc_pkg :: FilePath\n\nlibdir  = GHC_PATHS_LIBDIR\ndocdir  = GHC_PATHS_DOCDIR\n\nghc     = GHC_PATHS_GHC\nghc_pkg = GHC_PATHS_GHC_PKG\n</code></pre>\n\n<p>Running <code>stack exec env</code> didn't see anything.</p>\n\n<pre><code>$ stack exec env | grep -i ghc\nRun from outside a project, using implicit global project config\nGHC_PACKAGE_PATH=/home/wisut/.stack/global-project/.stack-work/installx86_64-linux/lts-5.10/7.10.3/pkgdb:/home/wisut/.stack/snapshots/x86_64-linux/lts-5.10/7.10.3/pkgdb:/home/wisut/.stack/programs/x86_64-linux/ghc-7.10.3/lib/ghc-7.10.3/package.conf.d\nPATH=/home/wisut/.stack/global-project/.stack-work/install/x86_64-linux/lts-5.10/7.10.3/bin:/home/wisut/.stack/snapshots/x86_64-linux/lts-5.10/7.10.3/bin:/home/wisut/.stack/programs/x86_64-linux/ghc-7.10.3/bin:/home/wisut/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/lib/jvm/default/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl\n</code></pre>\n\n<p>How can I fix the wrong value? How to to config <code>stack</code> to make <code>GHC.Paths</code> return the correct one?</p>\n\n<p><strong>UPD</strong>\nI tried running <code>stack</code> with <code>--no-system-ghc</code> and it didn't make any difference.\nI tried to remove my <code>~/.cabal</code> and <code>~/.stack</code> folders. I had to do <code>stack setup</code>, and after <code>stack</code> re-installed the compiler it doesn't give me that wrong path, but it doesn't give me <em>any</em> path, the output of that command is now empty.\nI have nothing special in any of <code>Setup.hs</code> too.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1467196597, "post_id": 38096876, "comment_id": 63628642, "body": "Ok, this compiles and the tests pass."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1467195934, "creation_date": 1467195934, "answer_id": 38096876, "question_id": 38096296, "link": "https://stackoverflow.com/questions/38096296/how-to-compose-isos/38096876#38096876", "title": "How to &quot;compose&quot; Iso&#39;s?", "body": "<p>Using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.9.0.0/Data-Coerce.html\" rel=\"nofollow\">safe coercions</a>:</p>\n\n<pre><code>import Data.Coerce\n\nreprBuild2 :: Iso' (Maybe UniversalTime) (First SaneDate)\nreprBuild2 = iso coerce coerce\n</code></pre>\n\n<p>It type checks -- no other tests were performed.</p>\n"}, {"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": false, "score": 4, "last_activity_date": 1467196803, "last_edit_date": 1467196803, "creation_date": 1467196422, "answer_id": 38097055, "question_id": 38096296, "link": "https://stackoverflow.com/questions/38096296/how-to-compose-isos/38097055#38097055", "title": "How to &quot;compose&quot; Iso&#39;s?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Iso.html#v:mapping\" rel=\"nofollow\"><code>mapping</code></a> combinator lets you lift an <code>Iso</code> over any functor (in this case the <code>Maybe</code> functor):</p>\n\n<pre><code>reprBuild' :: Iso' (Maybe UniversalTime) (Maybe SaneDate)\nreprBuild' = mapping _Unwrapped\n</code></pre>\n\n<p>We can also use the fact that <code>First</code> has a <code>Wrapped</code> instance to get the iso you want:</p>\n\n<pre><code>reprBuild :: Iso' (Maybe UniversalTime) (First SaneDate)\nreprBuild = mapping _Unwrapped . _Unwrapped\n</code></pre>\n\n<p>You can also use the coercion isomorphism: <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Iso.html#v:coerced\" rel=\"nofollow\"><code>coerced</code></a> but this will only work over newtype wrappers and needs ghc >= 7.10.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467219704, "post_id": 38097124, "comment_id": 63645335, "body": "Safe coercions have been around since 7.8. Does <code>lens</code> have too tight a bound in the CPP?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1467196599, "last_edit_date": 1495535625, "creation_date": 1467196599, "answer_id": 38097124, "question_id": 38096296, "link": "https://stackoverflow.com/questions/38096296/how-to-compose-isos/38097124#38097124", "title": "How to &quot;compose&quot; Iso&#39;s?", "body": "<p>Recent versions of <code>lens</code> <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Iso.html#g:10\" rel=\"nofollow noreferrer\">have that built in</a>:</p>\n\n<pre><code>reprBuild = coerced\n</code></pre>\n\n<p>Of course, this requires safe coercions which are only available since 7.10; for backwards compatibility <a href=\"https://stackoverflow.com/a/38097055/745903\">use a manual approach with <code>mapping</code></a>.</p>\n"}], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 38097124, "answer_count": 3, "score": 2, "last_activity_date": 1467196803, "creation_date": 1467194390, "question_id": 38096296, "link": "https://stackoverflow.com/questions/38096296/how-to-compose-isos", "title": "How to &quot;compose&quot; Iso&#39;s?", "body": "<p>Here is my type:</p>\n\n<pre><code>newtype SaneDate = SaneDate UniversalTime\n   deriving (Show, Eq, Typeable, Generic)\nmakeWrapped ''SaneDate\n</code></pre>\n\n<p>Now I need an iso with this type:</p>\n\n<pre><code>reprBuild :: Iso' (Maybe UniversalTime) (Fist SaneDate)\n</code></pre>\n\n<p>I did this:</p>\n\n<pre><code>reprBuild = iso\n   (\\ t -&gt; First (SaneDate &lt;$&gt; t) )\n   (\\ sane_first -&gt; fmap (^. _Wrapped) $ getFirst sane_first  )\n</code></pre>\n\n<p>But I have the impression I'm working extra-hard. Is there a (shorter) way of writing the <code>reprBuild</code> iso as a composition of things?</p>\n"}, {"tags": ["haskell", "typeclass", "gadt"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467188159, "post_id": 38093803, "comment_id": 63622939, "body": "Since <code>Concrete</code> is a <i>type constructor</i> and <code>Show</code> is a <i>type class</i>, the expression <code>Concrete Show</code> isn&#39;t even legal, much less an instance of anything. I might be wrong, but I&#39;m going to suggest you won&#39;t ever get this to work."}, {"owner": {"reputation": 1448, "user_id": 1838811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X7hL1.jpg?s=128&g=1", "display_name": "afuous", "link": "https://stackoverflow.com/users/1838811/afuous"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467188300, "post_id": 38093803, "comment_id": 63623034, "body": "@MathematicalOrchid It already did work, with ConstraintKinds and FlexibleInstances. I added this to the question."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1467188461, "post_id": 38093803, "comment_id": 63623138, "body": "@MathematicalOrchid Now you can, since the kinding system allows <code>Show :: * -&gt; Constraint</code>, and you can parametrize a type with such kind, as done above."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467188638, "post_id": 38093803, "comment_id": 63623244, "body": "Interesting. I had no idea such craziness is possible. Next they&#39;ll be adding language extensions that make the type system Turing-complete... oh, wait."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1467188724, "post_id": 38093803, "comment_id": 63623291, "body": "I don&#39;t think this is doable. It would require something like <code>instance c (Concrete c)</code>. Also, don&#39;t forget that <code>[Showable]</code> is a known <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">antipattern</a> since it is an overcomplication of <code>[String]</code>."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1467196948, "post_id": 38093803, "comment_id": 63628868, "body": "@afuous I found it instructive to play around with the function <code>breakConcrete :: (forall a. c a =&gt; a -&gt; r) -&gt; Concrete c -&gt; r; breakConcrete f (Concrete x) = f x</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1448, "user_id": 1838811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X7hL1.jpg?s=128&g=1", "display_name": "afuous", "link": "https://stackoverflow.com/users/1838811/afuous"}, "edited": false, "score": 3, "creation_date": 1467190875, "post_id": 38094260, "comment_id": 63624717, "body": "So this is why in Java, it is <code>Thing implements Comparable&lt;Thing&gt;</code> and not just <code>Thing implements Comparable</code>. This is a good answer."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1448, "user_id": 1838811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X7hL1.jpg?s=128&g=1", "display_name": "afuous", "link": "https://stackoverflow.com/users/1838811/afuous"}, "edited": false, "score": 0, "creation_date": 1467191184, "post_id": 38094260, "comment_id": 63624910, "body": "@afuous Yes, exactly."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1467189867, "last_edit_date": 1467189867, "creation_date": 1467189072, "answer_id": 38094260, "question_id": 38093803, "link": "https://stackoverflow.com/questions/38093803/constructing-concrete-types-for-typeclasses-with-gadts/38094260#38094260", "title": "Constructing concrete types for typeclasses with GADTs", "body": "<p>It is not possible. Consider this:</p>\n\n<pre><code>instance Monoid (Concrete Monoid) where\n   mappend (Concrete x) (Concrete y) = Concrete (mappend x y) -- type error!\n</code></pre>\n\n<p>This is a type error since <code>x</code> and <code>y</code> come from two different existential quantifications. There is no guarantee that <code>x</code> and <code>y</code> can be added together.</p>\n\n<p>In other words, <code>[Concrete [1,2], Concrete [\"hello\"]]</code> has type <code>[Concrete Monoid]</code> but can not be summed (<code>mconcat</code>).</p>\n\n<hr>\n\n<p>This is precisely the same problem for which, in OOP, the following base class/interface does not work:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>interface Vector {\n   Vector scale(double x);\n   Vector add(Vector v);\n}\nclass Vec2D implements Vector { ... }\nclass Vec3D implements Vector { ... }\n</code></pre>\n\n<p>The interface implies that a 2D vector is addable to any other vector, including a 3D one, which makes no sense. For an OOP solution, see <a href=\"https://en.wikipedia.org/wiki/Bounded_quantification\" rel=\"nofollow\">F-bounded quantification</a> and its related popularization callled <a href=\"https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern\" rel=\"nofollow\">curiously recurring template pattern</a>. </p>\n\n<p>In Haskell, we often do not need such techniques since there is no subtyping, hence two types in, say, a <code>Vector</code> type class are already not mixable.</p>\n\n<pre><code>class Vector a where\n   scale :: Double -&gt; a -&gt; a\n   add :: a -&gt; a -&gt; a\ninstance Vector (Vec2D) where ...\ninstance Vector (Vec3D) where ...\n</code></pre>\n"}], "owner": {"reputation": 1448, "user_id": 1838811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X7hL1.jpg?s=128&g=1", "display_name": "afuous", "link": "https://stackoverflow.com/users/1838811/afuous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 38094260, "answer_count": 1, "score": 2, "last_activity_date": 1467189867, "creation_date": 1467187633, "last_edit_date": 1467188346, "question_id": 38093803, "link": "https://stackoverflow.com/questions/38093803/constructing-concrete-types-for-typeclasses-with-gadts", "title": "Constructing concrete types for typeclasses with GADTs", "body": "<p>The inspiration for this is creating a list of values that are instances of <code>Show</code>. I found the following snippet that uses GADTs to create a concrete <code>Showable</code> type.</p>\n\n<pre><code>data Showable where Showable :: Show a =&gt; a -&gt; Showable\n\ninstance Show Showable where\n    show (Showable x) = show x\n\nlist :: [Showable]\nlist = [Showable 4, Showable \"hello\", Showable 'a']\n</code></pre>\n\n<p>Then, I tried to make <code>Showable</code> more general by creating a type that could make any typeclass concrete.</p>\n\n<pre><code>data Concrete a where Concrete :: a b =&gt; b -&gt; Concrete a\n\ninstance Show (Concrete Show) where\n    show (Concrete x) = show x\n\nlist :: [Concrete Show]\nlist = [Concrete 4, Concrete \"hello\", Concrete 'a']\n</code></pre>\n\n<p>This works with the ConstraintKinds and FlexibleInstances language extensions, but in order to use <code>Concrete</code> to make concrete types for other typeclasses, each one would require a new instance.</p>\n\n<p>Is there a way to create something similar to <code>Concrete</code> such that, for example, <code>Concrete Show</code> is automatically an instance of <code>Show</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1467180829, "post_id": 38091492, "comment_id": 63618660, "body": "Short answer: no. Haskell needs you to define the type well for each input, but there are ways around."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1467180840, "post_id": 38091492, "comment_id": 63618667, "body": "there is a way (making a <code>Num</code> instance for the list - so that the literal <code>7</code> get&#39;s translated into <code>[7]</code>) - but I would not recommend it"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1467180860, "post_id": 38091492, "comment_id": 63618681, "body": "There are various fancy typeclass tricks I wouldn&#39;t recommend."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1467181051, "post_id": 38091492, "comment_id": 63618770, "body": "The real question is what <code>boomBangs</code> is supposed to <i>mean</i>. When we generalize something in Haskell, we do it to express some particular <i>idea</i> more generally. What is the general <code>boomBang</code> idea? I don&#39;t really think there is one."}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 5, "last_activity_date": 1467187988, "creation_date": 1467187988, "answer_id": 38093915, "question_id": 38091492, "link": "https://stackoverflow.com/questions/38091492/how-to-generalize-input-in-haskell/38093915#38093915", "title": "How to generalize input in Haskell", "body": "<p>In general, Haskell does not allow you to just arbitrarily overload the same function name with multiple distinct implementations. There are programming languages that let you do this; Haskell is not one of them.</p>\n\n<p>In general, if you want the same function to do something different for different types of arguments (or different return type, for that matter), you use type classes. However, even this does not allow you to just <em>arbitrarily</em> have different numbers or types of arguments; there must be a pattern to it.</p>\n\n<p>I realise this is only for experimentation purposes, but I second the comment by dfeuer: what is <code>boomBangs</code> supposed to <em>mean</em>? What argument types does it <em>make sense</em> for? Well, obviously in this case <code>boomBangs</code> is a trivial example function, and doesn't really make much sense for anything except as an example function. (I'm not sure if you've even got to the type class part of the tutorial yet.)</p>\n\n<p>Notice that, as written, <code>boomBangs</code> is <em>already</em> polymorphic: It will work for <em>any type</em> of integer. It works for signed 8-bit integers, unsigned 8-bit integers, signed 16-bit integers, unsigned 16-bit integers, arbitrary-precision integers... So it's working for quite a bit of stuff.</p>\n\n<p>Making it work for lists and non-lists isn't a very natural generalisation of this function. (It is boom-bang<b>s</b>, after all.) What <em>might</em> make sense is to generalise it to work for other foldable objects (e.g., list, <code>Maybe</code>, <code>Either e</code>). It might also make sense for it to work on any monad (e.g., it looks like a slight tweak of this might work for stateful computations or parsers or I/O actions). But again, I don't know if either of those concepts have been introduced in the tutorial yet.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1467239928, "post_id": 38097766, "comment_id": 63655918, "body": "side note: <code>[b | x &lt;- xs, b &lt;- boomBang x]</code> == <code>concat [boomBang x | x &lt;- xs]</code> == <code>concatMap boomBang xs</code> == <code>xs &gt;&gt;= boomBang</code>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 5, "last_activity_date": 1467198309, "creation_date": 1467198309, "answer_id": 38097766, "question_id": 38091492, "link": "https://stackoverflow.com/questions/38091492/how-to-generalize-input-in-haskell/38097766#38097766", "title": "How to generalize input in Haskell", "body": "<p>Yes. Name your second function differently: <code>boomBang</code>. Then write <code>boomBangs [2,5,6,7,1]</code> or <code>boomBang 7</code> -- no <code>if</code> required. </p>\n\n<p>Writing code should be easy and natural, don't make it harder on yourself than it has to be.</p>\n\n<p>Now you have </p>\n\n<pre><code>boomBangs xs = [b | x &lt;- xs, b &lt;- boomBang x]\n</code></pre>\n\n<p>removing the code duplication, which is usually a sign of underexplored problem space.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1467226705, "post_id": 38104772, "comment_id": 63649629, "body": "and <code>boomBang [[[2,5,6],[7,1]],[[19]]]</code> ==&gt; <code>[&quot;BOOM&quot;,&quot;BOOM&quot;,&quot;BOOM&quot;,&quot;BANG&quot;]</code>!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1467216163, "creation_date": 1467216163, "answer_id": 38104772, "question_id": 38091492, "link": "https://stackoverflow.com/questions/38091492/how-to-generalize-input-in-haskell/38104772#38104772", "title": "How to generalize input in Haskell", "body": "<p>You may implement different behaviors for different types using type classes. For example:</p>\n\n<pre><code>class BoomBang a where\n    boomBang :: a -&gt; [String]\n\ninstance BoomBang Integer where\n    boomBang x = [if x &lt; 10 then \"BOOM\" else \"BANG\" | odd x]\n\ninstance BoomBang a =&gt; BoomBang [a] where\n    boomBang xs = xs &gt;&gt;= boomBang\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>&gt; boomBang 7\n[\"BOOM\"]\n&gt; boomBang [2,5,6,7,1]\n[\"BOOM\",\"BOOM\",\"BOOM\"]\n</code></pre>\n"}], "owner": {"reputation": 243, "user_id": 3408981, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0a35L.jpg?s=128&g=1", "display_name": "CoffeeIsLife", "link": "https://stackoverflow.com/users/3408981/coffeeislife"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 38093915, "answer_count": 3, "score": 4, "last_activity_date": 1467216163, "creation_date": 1467180158, "last_edit_date": 1467192872, "question_id": 38091492, "link": "https://stackoverflow.com/questions/38091492/how-to-generalize-input-in-haskell", "title": "How to generalize input in Haskell", "body": "<p>I am just starting to learn Haskell and I am using <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow\">learnyouahaskell.com</a> as the guide, and I am using <code>ghci</code> as interpreter. I have a question regarding lists. On the website they specify the function:</p>\n\n<pre><code>boomBangs xs = [ if x &lt; 10 then \"BOOM!\" else \"BANG!\" | x &lt;- xs, odd x]\n</code></pre>\n\n<p>This works only for lists. Whereas </p>\n\n<pre><code>boomBangs x = [ if x &lt; 10 then \"BOOM!\" else \"BANG!\" | odd x]\n</code></pre>\n\n<p>Only works for single inputs, i.e. </p>\n\n<pre><code>boomBangs 21\nboomBangs 7\n</code></pre>\n\n<p>Is there a way to write this statement so that it doesn't matter whether I put </p>\n\n<pre><code>boomBangs [2,5,6,7,1]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>boomBangs 7\n</code></pre>\n\n<p>without the need of an if statement?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 1, "creation_date": 1467174296, "post_id": 38089728, "comment_id": 63616216, "body": "I think <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\">ScopedTypeVariables</a> could help"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1467169928, "creation_date": 1467169928, "answer_id": 38089728, "question_id": 38089536, "link": "https://stackoverflow.com/questions/38089536/usage-generics-from-function-type-declaration-in-function-body/38089728#38089728", "title": "Usage generics from function type declaration in function body", "body": "<p>Simple fixes:</p>\n\n<ul>\n<li>Add a type signature to <code>equals</code> - otherwise monomorphism bites you</li>\n<li>Remove the unnecessary type annotation on <code>def &amp; section .~ Just x</code> - the type is inferred anyways. </li>\n</ul>\n\n<p>So:</p>\n\n<pre><code>...\n\nequals :: Eq a =&gt; a -&gt; a -&gt; Bool\nequals = (==)\n...\naddElementToSectionedItems :: SectionedItems s i -&gt; SectionedItemsElement s i -&gt; SectionedItems s i\naddElementToSectionedItems si (Section x) =\n    (def &amp; section .~ Just x)\n    |&gt; \\subsec -&gt; si &amp; subsections %~ append subsec\n</code></pre>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 38089728, "answer_count": 1, "score": 0, "last_activity_date": 1467169928, "creation_date": 1467168531, "last_edit_date": 1467168976, "question_id": 38089536, "link": "https://stackoverflow.com/questions/38089536/usage-generics-from-function-type-declaration-in-function-body", "title": "Usage generics from function type declaration in function body", "body": "<pre><code>{-# LANGUAGE TemplateHaskell, DeriveGeneric, DeriveAnyClass #-}\nmodule Main where\nimport Flow\nimport Control.Lens hiding ((|&gt;))\nimport Data.Default\nimport GHC.Generics\n\nmain :: IO ()\nmain = putStrLn \"hello world\"\n\nappend x = (++ [x])\nequals = (==)\n\ndata SectionedItems s i = SectionedItems{\n    _section :: Maybe s,\n    _items :: [i],\n    _subsections :: [SectionedItems s i]\n} deriving (Show, Generic)\n\ninstance Default (SectionedItems s i) where\n  def = SectionedItems { _section = Nothing, _items = [], _subsections = [] }\n\nmakeLenses ''SectionedItems\n\nsectionedItems = SectionedItems{\n    _section = Nothing,\n    _items = [],\n    _subsections = []\n}\n\ndata SectionedItemsElement s i = Section s | Item i\n\n\naddElementToSectionedItems :: SectionedItems s i -&gt; SectionedItemsElement s i -&gt; SectionedItems s i\naddElementToSectionedItems si (Section x) =\n    (def &amp; section .~ Just x :: SectionedItems s i) -- Error is probably somewhere here\n    |&gt; \\subsec -&gt; si &amp; subsections %~ append subsec\n</code></pre>\n\n<p>What do I replace  and  with in order to make it work? I tried s and i but I get an error <code>Could not match actual type s1 with expected type s</code> on <code>Just x</code>. What can I use to reference types s and I from the function body?</p>\n"}, {"tags": ["haskell", "compiler-errors", "cabal"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1467157139, "post_id": 38087939, "comment_id": 63612172, "body": "Please post your <code>.cabal</code> file."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1467157850, "post_id": 38087939, "comment_id": 63612358, "body": "Answer updated with a link to the full cabal file."}], "answers": [{"comments": [{"owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "edited": false, "score": 0, "creation_date": 1467158246, "post_id": 38088034, "comment_id": 63612443, "body": "OK - I see what&#39;s the problem about, but the cabal file in the section 3.2 referes to another file. What I could do is to extract the content of the haq.hs file into a module and then try to run the example. I&#39;ll give it a try - thanks fr the help.  Obviously something must have changed since the tutorial was published. Is it that e.g. executables are no longer allowed in tests or what ? (forgive me potential wrong wording - as I said, I&#39;m new to Haskell)."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "edited": false, "score": 1, "creation_date": 1467159494, "post_id": 38088034, "comment_id": 63612745, "body": "Looks like an edit made on May 29th 2014 added the <code>test-suite</code> section to the .cabal file with the reference to the <code>haq</code> library without first explaining how to define the library."}, {"owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "edited": false, "score": 0, "creation_date": 1467191118, "post_id": 38088034, "comment_id": 63624865, "body": "Makes sense. So in order to go through this tutorial, I&#39;d need to:  1.) Restructure the code: extract the functionality into a module. 2.) Add &quot;library&quot; section to my .cabal file. 3.) Use the newly created module in both executable and tests. Right ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "edited": false, "score": 0, "creation_date": 1467411406, "post_id": 38088034, "comment_id": 63738283, "body": "Yes - that&#39;s what&#39;s done later on in the tutorial in section 3."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1467157822, "last_edit_date": 1467157822, "creation_date": 1467157510, "answer_id": 38088034, "question_id": 38087939, "link": "https://stackoverflow.com/questions/38087939/cant-go-through-a-haskell-tutorial/38088034#38088034", "title": "Can&#39;t go through a Haskell tutorial", "body": "<p>The <code>haq</code> in the <code>build-depends</code> section refers to a library, but your .cabal file does not specify how to build a library - ie. it doesn' have a <code>library</code> section.</p>\n\n<p>You'll see what the <code>library</code> section should look like in section 3.2 of that wiki page: <a href=\"https://wiki.haskell.org/How_to_write_a_Haskell_program#The_Cabal_file\" rel=\"nofollow\">(link)</a></p>\n"}, {"tags": [], "owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "is_accepted": false, "score": 0, "last_activity_date": 1574334049, "last_edit_date": 1574334049, "creation_date": 1467409909, "answer_id": 38154309, "question_id": 38087939, "link": "https://stackoverflow.com/questions/38087939/cant-go-through-a-haskell-tutorial/38154309#38154309", "title": "Can&#39;t go through a Haskell tutorial", "body": "<p>OK - managed to come up with the valid configuration. Thanks for the hint.</p>\n\n<p>Here's my cabal file:</p>\n\n<pre><code>-- Initial haq.cabal generated by cabal init.  For further documentation, \n-- see http://haskell.org/cabal/users-guide/\n\nname:                main\nversion:             0.1.0.0\nlicense:             GPL-2\nlicense-file:        LICENSE\nauthor:              Bogdan Baranski\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nlibrary\n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9\n  exposed-modules:     Main\n  default-language:    Haskell2010\n\nexecutable main\n  main-is:             Main.hs\n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9\n  default-language:    Haskell2010\n\ntest-suite tests\n  ghc-options:         -Wall\n  default-extensions:  OverloadedStrings\n  type:                exitcode-stdio-1.0\n  main-is:             HSpecTests.hs\n  build-depends:       base,\n                       main,\n                       hspec &gt;= 1.8\n  default-language:    Haskell2010\n</code></pre>\n\n<p>Also, I had to rename file to \"Main.hs\" in order to make it consistent with the module defined inside (I noticed that Haskell is very sensitive about this convention: a module \"Module\" must be defined in a file \"Module.hs\").</p>\n"}], "owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 38088034, "answer_count": 2, "score": 3, "last_activity_date": 1574334049, "creation_date": 1467156882, "last_edit_date": 1592644375, "question_id": 38087939, "link": "https://stackoverflow.com/questions/38087939/cant-go-through-a-haskell-tutorial", "title": "Can&#39;t go through a Haskell tutorial", "body": "<p>I'm quite new to Haskell \u2013 I know its syntax and not really much more, so I assumed the best way to get a bit more information is to follow some tutorials from Haskell wiki.</p>\n<p>I found this one:\n<a href=\"https://wiki.haskell.org/How_to_write_a_Haskell_program\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/How_to_write_a_Haskell_program</a></p>\n<p>Unfortunatelly, when I reach item (2.9), my results diverge from what's shown on the website. When I type <code>cabal install --enable-tests</code>, I get:</p>\n<pre><code>Resolving dependencies...\nConfiguring haq-0.1.0.0...\nBuilding haq-0.1.0.0...\nPreprocessing executable 'haq' for haq-0.1.0.0...\nLinking dist/dist-sandbox-2a06ecba/build/haq/haq ...\nPreprocessing test suite 'tests' for haq-0.1.0.0...\n&lt;command line&gt;: cannot satisfy -package-id haq-0.1.0.0-inplace\n    (use -v for more information)\nFailed to install haq-0.1.0.0\ncabal: Error: some packages failed to install:\nhaq-0.1.0.0 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n<p>There are really two questions:</p>\n<ol>\n<li><p>How can I solve this problem and make it compile?</p>\n</li>\n<li><p>Where does this <code>-inplace</code> appended to my package's version come from? I tried adding it in cabal file, but that didn't help either.</p>\n</li>\n</ol>\n<p>I'll be happy to post more details if needed. My code is pretty much the same as the instructions in the tutorial say.</p>\n<h3>EDIT</h3>\n<p>Here's my <code>.cabal</code> file:</p>\n<pre><code>name:                haq\nversion:             0.1.0.0\ndescription:         Super cool mega lambdas\nlicense:             GPL\nauthor:              Alojzy Leszcz\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nexecutable haq\n  main-is:             Haq.hs  \n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9  \n  default-language:    Haskell2010\n  \ntest-suite tests\n  ghc-options:         -Wall\n  default-extensions:  OverloadedStrings\n  type:                exitcode-stdio-1.0\n  main-is:             HSpecTests.hs\n  build-depends:       base,\n                       haq,\n                       hspec &gt;= 1.8\n  default-language:    Haskell2010\n</code></pre>\n"}, {"tags": ["haskell", "warnings", "cabal", "doctest"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467148528, "post_id": 38086345, "comment_id": 63609120, "body": "what does your .cabal file look like?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 2, "creation_date": 1467148649, "post_id": 38086345, "comment_id": 63609164, "body": "This seems to be a duplicate of <a href=\"http://stackoverflow.com/questions/24435856/error-with-cabal-update\" title=\"error with cabal update\">stackoverflow.com/questions/24435856/error-with-cabal-update</a>&zwnj;&#8203;. Take a look at the answers to that question and see if they resolve your problem!"}, {"owner": {"reputation": 51, "user_id": 5588609, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IN4Kzbe_tYk/AAAAAAAAAAI/AAAAAAAAABs/3bo208pgVNM/photo.jpg?sz=128", "display_name": "Andy Garcia", "link": "https://stackoverflow.com/users/5588609/andy-garcia"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467157590, "post_id": 38086345, "comment_id": 63612297, "body": "@jkeuhlen The .cabal is unmodified from a fresh install of haskell. I have tried the things on the possible duplicate. This does not seem to solve the problem."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467210343, "post_id": 38086345, "comment_id": 63638845, "body": "Did you check your cabal version? The other SO question mentioned there is a bug for this in one version. Possibly try to get a more updated version of cabal?"}, {"owner": {"reputation": 51, "user_id": 5588609, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IN4Kzbe_tYk/AAAAAAAAAAI/AAAAAAAAABs/3bo208pgVNM/photo.jpg?sz=128", "display_name": "Andy Garcia", "link": "https://stackoverflow.com/users/5588609/andy-garcia"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467229795, "post_id": 38086345, "comment_id": 63651280, "body": "cabal --version gives me &quot;cabal-install version 1.24.0.0 compiled using version 1.24.0.0 of the Cabal library&quot;. The one from the other thread is 1.16"}, {"owner": {"reputation": 51, "user_id": 5588609, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IN4Kzbe_tYk/AAAAAAAAAAI/AAAAAAAAABs/3bo208pgVNM/photo.jpg?sz=128", "display_name": "Andy Garcia", "link": "https://stackoverflow.com/users/5588609/andy-garcia"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1467249736, "post_id": 38086345, "comment_id": 63658531, "body": "I tried using different versions of haskell and cabal today. I tried 4 different versions of each, and I got the same error on all of them."}], "owner": {"reputation": 51, "user_id": 5588609, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IN4Kzbe_tYk/AAAAAAAAAAI/AAAAAAAAABs/3bo208pgVNM/photo.jpg?sz=128", "display_name": "Andy Garcia", "link": "https://stackoverflow.com/users/5588609/andy-garcia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1467249787, "creation_date": 1467148187, "last_edit_date": 1592644375, "question_id": 38086345, "link": "https://stackoverflow.com/questions/38086345/haskell-cabal-update-error-network-browser-request", "title": "Haskell cabal update error Network.Browser.request", "body": "<p>I have just installed haskell and I am trying to get a few more packages, such as doctest. When I run &quot;cabal update&quot;, I get :</p>\n<blockquote>\n<p>Downloading the latest package list from hackage.haskell.org</p>\n<p>Warning: http error: Network.Browser.request: Error raised ErrorParse &quot;InvalidChar.intToDigit: not a digit -1</p>\n</blockquote>\n<p>Do you have any idea what is going wrong?</p>\n"}, {"tags": ["haskell", "record"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1467147158, "post_id": 38085955, "comment_id": 63608515, "body": "What is the meaning of the two <code>Int</code> that <code>move</code> takes as parameters? Offsets along the x-axis and y-axis? Something else?"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1467147214, "post_id": 38085955, "comment_id": 63608546, "body": "Yes the offsets of x- and y-axis"}], "answers": [{"comments": [{"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467147393, "post_id": 38085996, "comment_id": 63608644, "body": "But can i use this syntax also inside my &quot;move&quot; function block? Or how would this be written?As you said I need to create a new rectangle and return this new rectangle from the &quot;move&quot; function, right?"}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467147997, "post_id": 38085996, "comment_id": 63608885, "body": "I changed my code above (Edit 1), but i still get a parse error at &quot;xCoordinate + x&quot;"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1467148272, "post_id": 38085996, "comment_id": 63609009, "body": "<code>move :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle</code>  and <code>move rec x y = rec { xCoodinate = x , yCoodinate = y }</code>.  You could do this without the record names too: <code>move (Record _ _ w h) x y = Record x y w h</code>."}], "tags": [], "owner": {"reputation": 1030, "user_id": 521806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PaOw7.jpg?s=128&g=1", "display_name": "Juan Pablo Santos", "link": "https://stackoverflow.com/users/521806/juan-pablo-santos"}, "is_accepted": false, "score": 6, "last_activity_date": 1467146764, "creation_date": 1467146764, "answer_id": 38085996, "question_id": 38085955, "link": "https://stackoverflow.com/questions/38085955/change-record-values-in-haskell/38085996#38085996", "title": "Change record values in Haskell", "body": "<p>Haskell values are immutable, so you want to return a new <code>Rectangle</code> with the desired properties modified. It's simple, use \"Record Update Syntax\" like this <code>let myNewRec = rec { yCoordinate = 20, xCoordinate = 20 }</code></p>\n"}, {"comments": [{"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467150976, "post_id": 38086477, "comment_id": 63610144, "body": "When i try the version with the &quot;Point&quot; i get <code>error: Not in scope: type variable \u2018x\u2019</code> in first line ..."}, {"owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467151409, "post_id": 38086477, "comment_id": 63610316, "body": "i changed it to <code>data Point = Point { x :: Int, y :: Int }</code> and then <code>Duplicate type signatures for \u2018move\u2019 </code> appeared. So i renamed the first move function to <code>movePoint</code> and now i get <code>Couldn&#39;t match expected type \u2018Int\u2019                   with actual type \u2018Point -&gt; Int\u2019 </code> `"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "edited": false, "score": 0, "creation_date": 1467157574, "post_id": 38086477, "comment_id": 63612290, "body": "Sorry about that; trygub has fixed it. I was undecided about whether to use record syntax for the <code>Point</code> type, and would up writing a broken mix of record and non-record syntax."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 8, "last_activity_date": 1467157519, "last_edit_date": 1467157519, "creation_date": 1467148717, "answer_id": 38086477, "question_id": 38085955, "link": "https://stackoverflow.com/questions/38085955/change-record-values-in-haskell/38086477#38086477", "title": "Change record values in Haskell", "body": "<p>You just add the offsets to the corner:</p>\n\n<pre><code>move :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove (Rectangle x y w h) dx dy = Rectangle (x + dx) (y + dy) w h\n</code></pre>\n\n<p>With record syntax, though, you can write it as</p>\n\n<pre><code>move :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove r@(Rectangle {xCoordinate = x, yCoordinate=y}) dx dy = r {\n  xCoordinate = x + dx,\n  yCoordinate = y + dy }\n</code></pre>\n\n<p>Longer, but only because of the long names chosen for the two fields to update. You might further define a <code>Point</code> type:</p>\n\n<pre><code>data Point = Point Int Int\nmovePoint :: Point -&gt; Int -&gt; Int -&gt; Point\nmovePoint (Point x y) dx dy = Point (x + dx) (y + dy)\n\ndata Rectangle = Rectangle { corner :: Point, width :: Int, height :: Int }\nmove :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove r@(Rectangle {corner=c}) dx dy = r { corner = movePoint c dx dy }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 8, "last_activity_date": 1467148766, "creation_date": 1467148766, "answer_id": 38086493, "question_id": 38085955, "link": "https://stackoverflow.com/questions/38085955/change-record-values-in-haskell/38086493#38086493", "title": "Change record values in Haskell", "body": "<p>Given that this is your first time with Haskell, go with the record update answer already mentioned. However, for people googling this in the future, and for you too if you are feeling more ambitious (or for future learning), Haskell has this very popular and extremely powerful library called <a href=\"https://hackage.haskell.org/package/lens\">lens</a>.</p>\n\n<p>Here's how you can engineer a solution to your problem using it.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Control.Lens\n\ndata Rectangle = Rectangle { _xCoordinate :: Int\n                           , _yCoordinate :: Int\n                           , _width :: Int\n                           , _height :: Int\n                           } deriving (Show)\nmakeLenses ''Rectangle\n\nmove :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\nmove rect dx dy= rect\n                   &amp; xCoordinate +~ dx\n                   &amp; yCoordinate +~ dy\n</code></pre>\n\n<p>This solution may not seem more powerful initially, but when you start trying to update nested records, I assure you the advantage becomes clear.</p>\n"}], "owner": {"reputation": 965, "user_id": 1380313, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/52f94da0fff6451c17a6199ef511f985?s=128&d=identicon&r=PG", "display_name": "ManzMoody", "link": "https://stackoverflow.com/users/1380313/manzmoody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4084, "favorite_count": 1, "accepted_answer_id": 38086477, "answer_count": 3, "score": 5, "last_activity_date": 1467157519, "creation_date": 1467146614, "last_edit_date": 1467147933, "question_id": 38085955, "link": "https://stackoverflow.com/questions/38085955/change-record-values-in-haskell", "title": "Change record values in Haskell", "body": "<p>I am trying to write a Haskell module with the following code:</p>\n\n<pre><code>module RectangleMover where\n\ndata Rectangle = Rectangle { xCoordinate :: Int\n                           , yCoordinate :: Int\n                           , width :: Int\n                           , height :: Int\n                           } deriving (Show)\n\nmove :: Rectangle -&gt; Int -&gt; Int -&gt; Rectangle\n-- Edit 1\nmove rec x y =\n    let rec' = { xCoordinate + x\n               , yCoordinate + y\n               }\n    return rec\n</code></pre>\n\n<p>To create a rectangle i would type:</p>\n\n<pre><code>let rec = Rectangle 10 10 20 30\n</code></pre>\n\n<p>But my question is now how to implement a function that \"moves\" this rectangle?\nIn C# or Java the call would be something like this: <code>rec.move(20,20);</code>\nBut how would this be written in Haskell? </p>\n\n<p>This is unfortunately my first try with a functional programming language...</p>\n\n<p><strong>Edit 1:</strong>\nI added the code inside my function but still get a parse error at \"xCoordinate + x\" ...</p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467146164, "post_id": 38085770, "comment_id": 63607965, "body": "This requires a dependently typed language. Alternatively I suggest using a <code>Maybe Int</code>. Have you heard of <code>Maybe</code> ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1467147675, "post_id": 38085770, "comment_id": 63608764, "body": "On the one hand, the spirit of StackOverflow tempts me to write an <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Dynamic.html#t:Dynamic\" rel=\"nofollow noreferrer\">answer</a> or <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Unsafe-Coerce.html#v:unsafeCoerce\" rel=\"nofollow noreferrer\">two</a>; on the other hand, the spirit of pedagogy tells me this question occurs mostly to beginners who would be damaged by the answer..."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1467147795, "post_id": 38085770, "comment_id": 63608809, "body": "@DanielWagner Perhaps a self-answered-question would be beneficial for a higher level canonical answer to this. I&#39;ve seen several similar questions of this nature (and run in to the same problem myself). You could also add warnings in the answer to dissuade newcomers to the language."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 6, "last_activity_date": 1467146570, "creation_date": 1467146570, "answer_id": 38085941, "question_id": 38085770, "link": "https://stackoverflow.com/questions/38085770/returning-a-string-or-an-int-depending-on-input/38085941#38085941", "title": "Returning a string or an Int depending on input", "body": "<p>I think the Haskell way of doing this would be using <code>Maybe</code>.</p>\n\n<pre><code>positive :: Int -&gt; Maybe Int\npositive x | x &gt;= 0 = Just x\n           | x &lt; 0  = Nothing\n</code></pre>\n\n<p>Then, you can pattern match to see if you got a <code>Just</code> or a <code>Nothing</code>. Otherwise, there is no way of writing a function that does what you say - what would its signature be: <code>Int -&gt; Int</code> or <code>Int -&gt; String</code>? </p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1467146683, "creation_date": 1467146683, "answer_id": 38085972, "question_id": 38085770, "link": "https://stackoverflow.com/questions/38085770/returning-a-string-or-an-int-depending-on-input/38085972#38085972", "title": "Returning a string or an Int depending on input", "body": "<p>Haskell is statically typed meaning that normally you cannot change the type depending on runtime content.</p>\n\n<p>You can however use the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:Either\"><code>Either</code></a> type:</p>\n\n<pre><code>fun :: Int -&gt; Either Int String\nfun x | x &gt; 0 = Left x\n      | otherwise = Right \"-\"\n</code></pre>\n\n<p><code>Either</code> is defined as:</p>\n\n<pre><code>data Either a b = Left a | Right b\n</code></pre>\n\n<p>You can then later in your program query whether you are dealing with the left constructor or the right constructor.</p>\n"}, {"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": false, "score": 5, "last_activity_date": 1467146881, "last_edit_date": 1491982283, "creation_date": 1467146881, "answer_id": 38086031, "question_id": 38085770, "link": "https://stackoverflow.com/questions/38085770/returning-a-string-or-an-int-depending-on-input/38086031#38086031", "title": "Returning a string or an Int depending on input", "body": "<p>Functions in haskell are required to return a single type. You can argue about whether this is beneficial (see <a href=\"https://softwareengineering.stackexchange.com/questions/105662/is-return-type-only-polymorphism-in-haskell-a-good-thing\">this Programmers.SE post</a>) but without delving into much more complicated parts of the language it is what you must deal with. </p>\n\n<p>Much like @pdexter mentioned in the comments and @Alec mentioned in his answer, a <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html\" rel=\"nofollow noreferrer\"><code>Maybe</code></a>  is the best way to handle this. </p>\n\n<pre><code>import Data.Maybe\n...    \n\nf :: Int -&gt; Maybe Int \nf num \n | x &gt;= 0 = Just num\n | x &lt; 0  = Nothing\n</code></pre>\n\n<p>Then in your other code you can handle the <code>Maybe</code>:  </p>\n\n<pre><code>-- Let's assume you want to bind the result to a String type\nlet num = f Number\nputStrLn $ case num of \n  Just x  -&gt; show x \n  Nothing -&gt; \"-\"\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "accepted_answer_id": 38085972, "answer_count": 3, "score": 2, "last_activity_date": 1467157276, "creation_date": 1467145910, "last_edit_date": 1467157276, "question_id": 38085770, "link": "https://stackoverflow.com/questions/38085770/returning-a-string-or-an-int-depending-on-input", "title": "Returning a string or an Int depending on input", "body": "<p>How do I write a function that takes as input an <code>Int</code> and returns that <code>Int</code> if it is <code>&gt; 0</code> or otherwise return  a dash <code>\"-\"</code> if it is <code>&lt; 0</code>. I understand that Haskell is strict with its types, but is there a way around this?</p>\n"}, {"tags": ["python", "haskell", "sage"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467143163, "post_id": 38084886, "comment_id": 63606338, "body": "How is sage installed? What happens if you call <code>print path</code>? (just making sure the sage libraries are in the path)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1467143204, "post_id": 38084886, "comment_id": 63606359, "body": "Why did you think that changing a symlink would fix the issue? Your Haskell call is evidently calling the CPython API directly, so it&#39;s not running the python interpreter at all but it <i>creates</i> its own interpreter inside the Haskell program using the CPython API.  Unfortunately this probably means that it isn&#39;t looking at the system directory you are thinking of. Try to add the path to the <code>sage</code> package in the <code>sys.path</code>."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467152245, "post_id": 38084886, "comment_id": 63610618, "body": "@pdexter Strangely, I get parse errors when I include &quot;print&quot; in the python file, even before trying any sage business."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467154247, "post_id": 38084886, "comment_id": 63611363, "body": "@Bakuriu Adding the path to the <code>sage</code> executable didn&#39;t work (nor would I expect it to), and adding the path to sage&#39;s <code>python</code> executable (in <code>SageMath&#47;local&#47;bin</code>) didn&#39;t help either."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467174530, "post_id": 38084886, "comment_id": 63616278, "body": "I meant to print it in Haskell. Also you need to add the path to the sage libraries, not the executable."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467314691, "post_id": 38084886, "comment_id": 63694445, "body": "@pdexter Where in the <code>SageMath</code> directory should I include in the path?"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1467318572, "post_id": 38084886, "comment_id": 63696567, "body": "@Eric Wherever the python libraries are. Probably the root of the sagemath library path."}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1467152469, "post_id": 38085148, "comment_id": 63610703, "body": "I&#39;m aware that Sage uses it&#39;s own python, that&#39;s why I created a symlink. How is your suggestion different than what I tried?"}, {"owner": {"reputation": 4059, "user_id": 782821, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aaf3f7965a7323d6a25ee614cfa386b4?s=128&d=identicon&r=PG", "display_name": "kcrisman", "link": "https://stackoverflow.com/users/782821/kcrisman"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1467160516, "post_id": 38085148, "comment_id": 63613022, "body": "I didn&#39;t know what you did, so I suggested this; note that you say you linked to the <i>Sage</i> binary and not the associated <i>Python</i> binary (which is definitely different).  Anyway, it turns out that a <i>lot</i> of people ask about this without realizing this about Sage and &quot;its&quot; Python, so I thought this would be helpful; unfortunately I can&#39;t help beyond this as I don&#39;t use Sage called from other programs, let alone from Haskell (of which I&#39;ve compiled precisely two programs)."}], "tags": [], "owner": {"reputation": 4059, "user_id": 782821, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aaf3f7965a7323d6a25ee614cfa386b4?s=128&d=identicon&r=PG", "display_name": "kcrisman", "link": "https://stackoverflow.com/users/782821/kcrisman"}, "is_accepted": false, "score": 1, "last_activity_date": 1467143573, "creation_date": 1467143573, "answer_id": 38085148, "question_id": 38084886, "link": "https://stackoverflow.com/questions/38084886/calling-sage-from-haskell/38085148#38085148", "title": "Calling Sage from Haskell", "body": "<p>The real question is \"which\" Python you are using; Sage uses its own Python, NOT your system Python.  You may want to try making a link from </p>\n\n<pre><code>$ pwd; local/bin/python --version\n/Users/.../Downloads/sage\nPython 2.7.10\n$\n</code></pre>\n\n<p>That is the one you will need to be linking to, in principle.  In practice, you may want to read the Sage documentation about more links, or other <a href=\"https://mvngu.wordpress.com/2009/10/08/how-to-use-sage-as-a-python-library/\" rel=\"nofollow\">blog posts</a> about running scripts.  But anyway it's only that Python which can use <code>from sage import *</code>.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1467144574, "creation_date": 1467142639, "last_edit_date": 1467144574, "question_id": 38084886, "link": "https://stackoverflow.com/questions/38084886/calling-sage-from-haskell", "title": "Calling Sage from Haskell", "body": "<p>I have some sage code that I'd like to call from Haskell. The following code uses <a href=\"http://hackage.haskell.org/package/cpython-3.3.0\" rel=\"nofollow\">cpython</a> to call a pure python script:</p>\n\n<p>test.py:</p>\n\n<pre><code>def pytest():\n    return 3.5+2\n</code></pre>\n\n<p>Main.hs:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified CPython as Py\nimport qualified CPython.Protocols.Object as Py\nimport qualified CPython.Types as Py\nimport qualified CPython.Types.Module as Py\nimport qualified CPython.System as Py\nimport qualified CPython.Types.Float as Py\nimport qualified Data.Text as T\nimport GHC.IO.Handle.FD\nimport Data.Maybe\n\nmain :: IO ()\nmain = do\n  Py.initialize\n  path &lt;- Py.getPath\n  Py.setPath $ T.pack $ \".:\" ++ T.unpack path -- path to the module to load\n  test &lt;- Py.importModule $ T.pack \"test\"\n  uname &lt;- Py.getAttribute test =&lt;&lt; (Py.toUnicode (T.pack \"pytest\"))\n  res &lt;- Py.callArgs uname []\n  Py.print res stdout\n  res' &lt;- Py.fromFloat =&lt;&lt; fromJust &lt;$&gt; Py.cast res\n  print $ (res' + 2.0 :: Double)\n</code></pre>\n\n<p>When I compile Main.hs and run it, I get the expected output:</p>\n\n<pre><code>5.5\n7.5\n</code></pre>\n\n<p>If I add <code>from sage import *</code> to test.py, I get (once I catch the exception) <code>ImportError(\"No module named 'sage'\",)</code>. Of course test.py loads fine directly from sage. I expected that replacing the <code>python</code> executable with a symlink to the <code>sage</code> executable would fix the problem, but I still get the same error.</p>\n\n<p>Does anyone know how to make cpython work with sage, or any other way to call a sage script from Haskell?</p>\n"}, {"tags": ["haskell", "file-io", "error-handling"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1467129341, "post_id": 38080021, "comment_id": 63598337, "body": "I&#39;m not optimistic about &quot;portable&quot; exceptions with the current state of the Haskell infrastructure. We&#39;ve been stuck in one-compiler mode for a number of years. Here&#39;s hoping that changes soon."}], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "edited": false, "score": 0, "creation_date": 1467172381, "post_id": 38089215, "comment_id": 63615752, "body": "I still get &quot;inappropriate type&quot; from both using System.IO.openFile on GHC 7.10.3 for GNU/Linux."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "edited": false, "score": 0, "creation_date": 1467173610, "post_id": 38089215, "comment_id": 63616053, "body": "I guess the exact exception is OS dependent then - I tested it under OS X + GHC 7.10.2. Updated answer."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "edited": false, "score": 0, "creation_date": 1467173750, "post_id": 38089215, "comment_id": 63616085, "body": "However - you do get a slightly different message - &quot;not a directory&quot; vs. &quot;is a directory&quot; - so that is a way to distinguish between the two."}, {"owner": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "edited": false, "score": 0, "creation_date": 1467210342, "post_id": 38089215, "comment_id": 63638844, "body": "Thank you for pointing me towards ioe_description, that ended up being exactly what I needed. I&#39;ve updated my question with the strings that I&#39;m catching on GNU/Linux but I don&#39;t have access to OS X. Could you please check that they&#39;re the same on OS X. Thanks again for the help!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "edited": false, "score": 1, "creation_date": 1467213199, "post_id": 38089215, "comment_id": 63640978, "body": "Actually I would base it on <code>ioe_errno</code> because on Unix/Linux/OS X systems the description string is a function of the errno error code and the errno codes are much more likely to be the same. If you give me a program that generates the errors I&#39;ll run it on my OS X system."}, {"owner": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "edited": false, "score": 0, "creation_date": 1467217063, "post_id": 38089215, "comment_id": 63643748, "body": "I added a Haskell program to my question. You might need to change some of the paths since I&#39;m not sure what OS X has under /dev/ and whether or not /root exists."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1467234121, "last_edit_date": 1467234121, "creation_date": 1467166313, "answer_id": 38089215, "question_id": 38080021, "link": "https://stackoverflow.com/questions/38080021/correct-way-to-handle-readfile-and-writefile-exceptions/38089215#38089215", "title": "Correct way to handle readFile and writeFile exceptions", "body": "<blockquote>\n  <ol>\n  <li>Which exceptions should I be catching for readFile/writeFile?</li>\n  </ol>\n</blockquote>\n\n<p>Under OS X, if you use <code>openFile</code> followed by <code>hGetContents</code> instead of <code>readFile</code> then you will get different exceptions for the cases you mention.</p>\n\n<p><code>openFile \"/bin/ls/asdf\" ...</code> will throw a \"no such file or directory\" exception whereas <code>openFile \"/bin\" ...</code> will throw \"inappropriate type\".</p>\n\n<p>Under Linux both open calls will throw a \"inappropriate type\" exception. However, you can distinguish between the two via the <code>ioe_errno</code> and <code>ioe_description</code> fields:</p>\n\n<pre><code>import System.IO\nimport GHC.IO.Exception\nimport Control.Exception\n\nfoo path = do\n  h &lt;- openFile path ReadMode\n  hClose h\n\nshow_ioe :: IOException -&gt; IO ()\nshow_ioe e = do\n  putStrLn $ \"errno: \" ++ show (ioe_errno e)\n  putStrLn $ \"description: \" ++ ioe_description e\n\nbar path = foo path `catch` show_ioe\n</code></pre>\n\n<p>Sample ghci session:</p>\n\n<pre><code>*Main&gt; bar \"/bin\"\nerrno: Nothing\ndescription: is a directory\n*Main&gt; bar \"/bin/ls/asd\"\nerrno: Just 20\ndescription: Not a directory\n</code></pre>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>Once I have an exception, how should I go about extracting information from it?</li>\n  </ol>\n</blockquote>\n\n<p>Each exception has its own structure. The definition of an IOException may be found <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.IO.Exception.html#IOException\" rel=\"nofollow\">here</a>.</p>\n\n<p>To bring the field accessors into scope you need to import <code>GHC.IO.Exception</code>.</p>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>Is there a portable way of catching the GHC-only exceptions such as InappropriateType?</li>\n  </ol>\n</blockquote>\n\n<p>As @dfeuer said, for all practical purposes GHC is the only Haskell implementation at this time.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Results from running your program. I didn't include the last result because I didn't have a read-only filesystem around to test it on, but I'm sure the error would be the same.</p>\n\n<pre><code>ioe_filename = Just \"/nonexistent\", ioe_description = \"No such file or directory\", ioe_errno = Just 2\nioe_filename = Just \"/dev/full\", ioe_description = \"Permission denied\", ioe_errno = Just 13\nioe_filename = Just \"/root\", ioe_description = \"is a directory\", ioe_errno = Nothing\nioe_filename = Just \"/bin\", ioe_description = \"is a directory\", ioe_errno = Nothing\nioe_filename = Just \"/bin\", ioe_description = \"Is a directory\", ioe_errno = Just 21\nioe_filename = Just \"/bin/ls/asdf\", ioe_description = \"Not a directory\", ioe_errno = Just 20\nioe_filename = Just \"/bin/ls/asdf\", ioe_description = \"Not a directory\", ioe_errno = Just 20\nioe_filename = Just \"/dev/null\", ioe_description = \"not a regular file\", ioe_errno = Nothing\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1342, "favorite_count": 1, "accepted_answer_id": 38089215, "answer_count": 1, "score": 8, "last_activity_date": 1467252018, "creation_date": 1467126753, "last_edit_date": 1467252018, "question_id": 38080021, "link": "https://stackoverflow.com/questions/38080021/correct-way-to-handle-readfile-and-writefile-exceptions", "title": "Correct way to handle readFile and writeFile exceptions", "body": "<p>I'm writing an application in Haskell and would like to display a meaningful error message to the user if <code>readFile</code> or <code>writeFile</code> fails. I'm currently catching <code>IOError</code>s with <code>Control.Exception.tryJust</code> and converting them to human-readable text.</p>\n\n<p>However, I'm having trouble figuring out which errors I should catch and how to extract information from them. For example, assuming \"/bin\" is a directory and \"/bin/ls\" is a file, <code>readFile \"/bin\"</code> and <code>readFile \"/bin/ls/asdf\"</code> both give \"inappropriate type\" but (in my opinion) they are different errors. In the case of the first one, I could recover by processing each file within the directory, whereas the second is more like a \"does not exist\" type of error.</p>\n\n<p>In relation to the previous example, there doesn't seem to be a portable way of catching \"inappropriate type\" errors. Looking at <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.IO.Exception.html#IOErrorType\" rel=\"nofollow noreferrer\">GHC.IO.Exception</a>, <code>InappropriateType</code> is marked GHC-only so I can't just pattern match on <code>ioeGetErrorType</code>. I could pattern match on <code>ioeGetErrorString</code> but I'm not sure if those strings are always the same across different platforms, compilers, locales, etc.</p>\n\n<p>In summary, my questions are:</p>\n\n<ol>\n<li>Which exceptions should I be catching for <code>readFile</code>/<code>writeFile</code>?</li>\n<li>Once I have an exception, how should I go about extracting information from it?</li>\n<li>Is there a portable way of catching the GHC-only exceptions such as <code>InappropriateType</code>?</li>\n</ol>\n\n<p><strong>Update:</strong></p>\n\n<p>Based on @ErikR's answer I'm looking at the fields of <code>GHC.IO.Exception.IOException</code> with the following Haskell program:</p>\n\n<pre><code>import Control.Exception (try)\nimport GHC.IO.Exception (IOException(..))\nimport qualified Data.ByteString as B\n\n\nmain :: IO ()\nmain = do\n    try (readFile \"/nonexistent\") &gt;&gt;= printException\n    try (writeFile \"/dev/full\" \" \") &gt;&gt;= printException\n    try (readFile \"/root\") &gt;&gt;= printException\n    try (readFile \"/bin\") &gt;&gt;= printException\n    try (writeFile \"/bin\" \"\") &gt;&gt;= printException\n    try (readFile \"/bin/ls/asdf\") &gt;&gt;= printException\n    try (writeFile \"/bin/ls/asdf\" \"\") &gt;&gt;= printException\n    try (B.readFile \"/dev/null\") &gt;&gt;= printException\n\n    -- I have /media/backups mounted as read-only. Substitute your own read-only\n    -- filesystem for this one\n    try (writeFile \"/media/backups/asdf\" \"\") &gt;&gt;= printException\n\nprintException :: Either IOError a -&gt; IO ()\nprintException (Right _) = putStrLn \"No exception caught\"\nprintException (Left e) = putStrLn $ concat [ \"ioe_filename = \"\n                                            , show $ ioe_filename e\n                                            , \", ioe_description = \"\n                                            , show $ ioe_description e\n                                            , \", ioe_errno = \"\n                                            , show $ ioe_errno e\n                                            ]\n</code></pre>\n\n<p>The output on Debian Sid GNU/Linux with GHC 7.10.3 is:</p>\n\n<pre><code>ioe_filename = Just \"/nonexistent\", ioe_description = \"No such file or directory\", ioe_errno = Just 2\nioe_filename = Just \"/dev/full\", ioe_description = \"No space left on device\", ioe_errno = Just 28\nioe_filename = Just \"/root\", ioe_description = \"Permission denied\", ioe_errno = Just 13\nioe_filename = Just \"/bin\", ioe_description = \"is a directory\", ioe_errno = Nothing\nioe_filename = Just \"/bin\", ioe_description = \"Is a directory\", ioe_errno = Just 21\nioe_filename = Just \"/bin/ls/asdf\", ioe_description = \"Not a directory\", ioe_errno = Just 20\nioe_filename = Just \"/bin/ls/asdf\", ioe_description = \"Not a directory\", ioe_errno = Just 20\nioe_filename = Just \"/dev/null\", ioe_description = \"not a regular file\", ioe_errno = Nothing\nioe_filename = Just \"/media/backups/asdf\", ioe_description = \"Read-only file system\", ioe_errno = Just 30\n</code></pre>\n"}, {"tags": ["list", "haskell", "types", "ghci", "type-constraints"], "comments": [{"owner": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "edited": false, "score": 0, "creation_date": 1467111025, "post_id": 38074099, "comment_id": 63584892, "body": "Turns out you can&#39;t delete a comment?!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 6, "creation_date": 1467111390, "post_id": 38074099, "comment_id": 63585113, "body": "That&#39;s an absolutely terrible error message. The type checker ran into a more subtle problem first and reported it instead of getting to the real point."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467111527, "post_id": 38074234, "comment_id": 63585197, "body": "(Better to avoid gendered language altogether in this context, I think. I have a gender, but not everyone does. Also, &quot;girls&quot; can be seen as disrespectful to women.)"}, {"owner": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "edited": false, "score": 1, "creation_date": 1467112017, "post_id": 38074234, "comment_id": 63585526, "body": "You should probably edit this answer, so that it <i>reads</i> like an answer. Writing <code>:t (:)</code> in GHCi yields <code>(:) :: a -&gt; [a] -&gt; [a]</code>. But you are passing it a <code>[a]</code> as the first arg, and an <code>a</code> as second."}], "tags": [], "owner": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "is_accepted": false, "score": 9, "last_activity_date": 1468066253, "last_edit_date": 1468066253, "creation_date": 1467111178, "answer_id": 38074234, "question_id": 38074099, "link": "https://stackoverflow.com/questions/38074099/haskells-head-tail-init-and-last-in-ghci/38074234#38074234", "title": "Haskell&#39;s head tail init and last in GHCi", "body": "<p>Ahh snap, <code>:</code> takes an element and the rest like in <code>x:xs</code>, not a list and the last element, like in <code>xs:x</code>. </p>\n\n<pre><code>Prelude Data.List Data.Char&gt; :info :  \ndata [] a = ... | a : [a] &gt;\u00b7-- Defined in \u2018GHC.Types\u2019\ninfixr 5 : \n\ndata [] a = ... | a : [a] &gt;\u00b7-- Defined in \u2018GHC.Types\u2019\ninfixr 5 : \n</code></pre>\n\n<p><strong>I still would like to know how you understand GHCi error messages and I have to wait 2 days to accept my own answer anyway.</strong></p>\n\n<p>Edit: I get that <code>x</code> and <code>xs</code> are only variable names chosen by convention, and <code>(xs:_)</code> would match the head but is unconventionally/confusingly named.</p>\n\n<p>Edit 2: I upvoted and accepted Daniel Wagner's answer, because he explained the error message step by step. Really nice! Thank you!</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1467135233, "creation_date": 1467135233, "answer_id": 38082764, "question_id": 38074099, "link": "https://stackoverflow.com/questions/38074099/haskells-head-tail-init-and-last-in-ghci/38082764#38082764", "title": "Haskell&#39;s head tail init and last in GHCi", "body": "<p>It is true that <code>head</code>/<code>last</code> and <code>tail</code>/<code>init</code> have identical types. So if you had simply swapped out <code>last</code> for <code>head</code> and <code>init</code> for <code>tail</code>, you would have had no problem:</p>\n\n<pre><code>&gt; let n = [1..10] in last n : init n\n[10,1,2,3,4,5,6,7,8,9]\n</code></pre>\n\n<p>But you didn't. You did both that swap <em>and another</em>: you changed the order of arguments to <code>:</code>. It so happens that <code>:</code> doesn't take two arguments of the same type:</p>\n\n<pre><code>&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>So this last swap is not okay! In fact, if you give <code>n</code> a slightly more specific type signature, ghci will give a better error:</p>\n\n<pre><code>&gt; let n :: [Integer]; n = [1..10] in init n : last n\n\n&lt;interactive&gt;:1:50:\n    Couldn't match type \u2018Integer\u2019 with \u2018[[Integer]]\u2019\n    Expected type: [[[Integer]]]\n      Actual type: [Integer]\n    In the first argument of \u2018last\u2019, namely \u2018n\u2019\n    In the second argument of \u2018(:)\u2019, namely \u2018last n\u2019\n</code></pre>\n\n<p>This error is still not 100% clear, but I think with a bit of puzzling you can see what it's complaining about: since <code>init n :: [Integer]</code>, and <code>(:) :: [Integer] -&gt; [[Integer]] -&gt; [[Integer]]</code>, it's expecting <code>last n :: [[Integer]]</code> and therefore <code>n :: [[[Integer]]]</code>. But you explicitly said <code>n :: [Integer]</code>, a conflict.</p>\n\n<p>Now, what about the error it actually gave you in your case? Well, the clue is in the type of <code>[1..10]</code>:</p>\n\n<pre><code>&gt; :t [1..10]\n[1..10] :: (Enum t, Num t) =&gt; [t]\n</code></pre>\n\n<p>Notice that <code>[1..10]</code> is polymorphic. Moreover, it is used twice in your expression, and so it can be given <em>separate</em> monomorphic types in the two uses. So <code>[1..10]</code> is instantiated with <em>two</em> different types in the sequel!</p>\n\n<p>Now I think you can start to see where the error you got comes in. It's trying to find a type <code>a</code> for which:</p>\n\n<ul>\n<li><code>Enum a</code> -- this is needed to do the <code>..</code> part of <code>init [1..10]</code></li>\n<li><code>Num a</code> -- this is needed to do the <code>1</code> and <code>10</code> parts of <code>init [1..10]</code></li>\n<li><code>Enum [[a]]</code> -- if <code>init n :: a</code>, then to have <code>init n : last n</code> be well-typed, we must have <code>last n :: [a]</code> and hence the second occurrence of <code>n</code> must have <code>n :: [[a]]</code>; then the <code>Enum</code> constraint is needed for the <code>..</code> part of <code>last [1..10]</code></li>\n<li><code>Num [[a]]</code> -- by similar reasoning, this is needed to do the <code>1</code> and <code>10</code> parts of <code>last [1..10]</code></li>\n</ul>\n\n<p>But these constraints together are hard to satisfy -- certainly there's no instance of <code>Enum</code> and <code>Num</code> for lists in scope in the <code>Prelude</code> or <code>Data.List</code>. So it complains.</p>\n"}, {"comments": [{"owner": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "edited": false, "score": 0, "creation_date": 1468066710, "post_id": 38082812, "comment_id": 63982059, "body": "Nice answer! Thanks. However Daniel was 3min. faster. Have an upvote. :)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "edited": false, "score": 1, "creation_date": 1468078842, "post_id": 38082812, "comment_id": 63985544, "body": "That&#39;s OK.  I&#39;ll take a few upvotes off of Daniel&#39;s desk to make up for it."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1467135394, "creation_date": 1467135394, "answer_id": 38082812, "question_id": 38074099, "link": "https://stackoverflow.com/questions/38074099/haskells-head-tail-init-and-last-in-ghci/38082812#38082812", "title": "Haskell&#39;s head tail init and last in GHCi", "body": "<p>In larger programs there is more type information (implicit and explicit) allowing the compiler to do a better job inferring types than in one-line snippets provided to GHCi.  As a result, the errors you see in GHCi are not representative of what is typically observed when building a full program.</p>\n\n<p>That said, it's no excuse for the awfulness that is the error you posted:</p>\n\n<pre><code>Prelude&gt; let n = [1..10] in (init n : last n)\n\n&lt;interactive&gt;:8:1:\n    Non type-variable argument in the constraint: Enum [[a]]\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall a. (Enum a, Enum [[a]], Num a, Num [[a]]) =&gt; [[a]]\n</code></pre>\n\n<p>So there is a lot of polymorphism involved in your own line.  You have lists of Num a (<code>Num a =&gt; [a]</code>) where the type variable <code>a</code> must itself be alist since you've used <code>: last n</code> where <code>last n :: [_] ~ a</code>.  So this, combined with the fact that <code>..</code> in list comprehension implies an enum, is how we got to the horrible message.</p>\n\n<p>Let's look at the simpler case where we've told GHCi our list is of type <code>[Int]</code>:</p>\n\n<pre><code>Prelude&gt; let n = [1..10] :: [Int] in (init n : last n)\n\n&lt;interactive&gt;:7:44:\n    Couldn't match type \u2018Int\u2019 with \u2018[[Int]]\u2019\n    Expected type: [[[Int]]]\n      Actual type: [Int]\n    In the first argument of \u2018last\u2019, namely \u2018n\u2019\n    In the second argument of \u2018(:)\u2019, namely \u2018last n\u2019\n</code></pre>\n\n<p>Ahh, much better.  Column 44 is the <code>n</code> in <code>last n</code>.  It says that <code>last n :: Int</code>.  So the type of <code>init n :</code> when <code>init n :: [Int]</code> means our cons function type is <code>(:) :: [Int] -&gt; [[Int]] -&gt; [[Int]]</code>.  But wait!  <code>[[Int]]</code> needed for the argument of <code>init n :</code> does not match <code>Int</code> provided by <code>last n</code>!</p>\n"}], "owner": {"reputation": 311, "user_id": 3750254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec61965b80e6551eaba49bdc62dba5?s=128&d=identicon&r=PG&f=1", "display_name": "inktrap", "link": "https://stackoverflow.com/users/3750254/inktrap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1870, "favorite_count": 0, "accepted_answer_id": 38082764, "answer_count": 3, "score": 2, "last_activity_date": 1468066253, "creation_date": 1467110830, "last_edit_date": 1467141851, "question_id": 38074099, "link": "https://stackoverflow.com/questions/38074099/haskells-head-tail-init-and-last-in-ghci", "title": "Haskell&#39;s head tail init and last in GHCi", "body": "<p>I have a question about <code>head</code>, <code>tail</code>, <code>init</code> and <code>last</code>.\nThe following works in GHCi:</p>\n\n<pre><code>Prelude Data.List Data.Char&gt; let n = [1..10] in (head n : tail n)\n[1,2,3,4,5,6,7,8,9,10]\n</code></pre>\n\n<p>As expected, I get the whole list. So this should work for <code>init</code> and <code>last</code> too,\nright?</p>\n\n<pre><code>Prelude Data.List Data.Char&gt; let n = [1..10] in (init n : last n)\n\n&lt;interactive&gt;:39:1:\n    Non type-variable argument in the constraint: Enum [[a]]\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall a. (Enum a, Enum [[a]], Num a, Num [[a]]) =&gt; [[a]]\n</code></pre>\n\n<p>If I look at the type signatures for the functions, then <code>head</code> and <code>last</code>\nlook the same -- they both return an element. Also <code>init</code> and <code>tail</code> look\nthe same, because they both return lists.</p>\n\n<pre><code>Prelude Data.List Data.Char&gt; :info head\nhead :: [a] -&gt; a        -- Defined in \u2018GHC.List\u2019\nPrelude Data.List Data.Char&gt; :info tail\ntail :: [a] -&gt; [a]      -- Defined in \u2018GHC.List\u2019\nPrelude Data.List Data.Char&gt; :info init\ninit :: [a] -&gt; [a]      -- Defined in \u2018GHC.List\u2019\nPrelude Data.List Data.Char&gt; :info last\nlast :: [a] -&gt; a        -- Defined in \u2018GHC.List\u2019\n</code></pre>\n\n<p>So what does <code>Non type-variable argument in the constraint: Enum [[a]]</code> mean?\nIf I do <code>init n</code> or <code>last n</code> without the construction of a new list, I get \n<code>[1..9]</code> and <code>10</code>.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "haskeline"], "comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1467118971, "post_id": 38071560, "comment_id": 63590551, "body": "Yes, <code>liftIO</code> is <code>liftIO :: MonadIO m =&gt; IO a -&gt; m a</code>, and <code>getLineIO</code> is a wrapper. The only difference that it takes an argument of <code>IO String</code> instead of <code>getInputLine</code>&#39;s regular <code>String</code>. How would you suggest to unwrap it?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1467120918, "post_id": 38071560, "comment_id": 63592040, "body": "If <code>getInputLine</code> just takes a regular string, then <code>getLineIO ios = ios &gt;&gt;= getInputLine</code>. You don&#39;t need <code>lift</code>."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1467121903, "post_id": 38071560, "comment_id": 63592805, "body": "Thanks, but I&#39;m not sure I&#39;m following you. Please see the updated question, is that what you had in mind?"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1467128441, "creation_date": 1467104308, "last_edit_date": 1495541769, "question_id": 38071560, "link": "https://stackoverflow.com/questions/38071560/unwrap-getinputline-result-from-input", "title": "unwrap getInputLine result from Input", "body": "<p>I'm getting a result from <code>getInputline</code>, whose type is:</p>\n\n<pre><code>(MonadException m) =&gt; IO String -&gt; InputT m (Maybe String)\n</code></pre>\n\n<p>I'd like to get just the <code>Maybe String</code> part. I'm well aware that in general there is no way to strip a monad, as explained in <a href=\"https://stackoverflow.com/a/8569332/165753\">this answer</a> (and other answers in the same question). However, since I'm doing it inside an <code>InputT</code>, I guess it's possible, as proposed <a href=\"https://stackoverflow.com/a/28053686/165753\">here</a>. However, I can't just use <code>liftIO</code>, as the answer suggests, since the <code>IO</code> is inside a <code>StateT</code>.</p>\n\n<pre><code>loop :: Counter -&gt; InputT (StateT [String] IO) ()    \nloop c = do\n        minput &lt;- getLineIO $ in_ps1 $ c\n        case minput of\n          Nothing -&gt; outputStrLn \"Goodbye.\"\n          Just input -&gt; (process' c input) &gt;&gt; loop c      \n\ngetLineIO :: (MonadException m) =&gt; IO String -&gt; InputT m (Maybe String)\ngetLineIO ios = do\n    s &lt;- liftIO ios\n    getInputLine s\n\nprocess' :: Counter -&gt; String -&gt; InputT (StateT [String] IO) ()\n[...]\n</code></pre>\n\n<p>The error I'm getting:</p>\n\n<pre><code>Main.hs:81:15:\n    No instance for (MonadException (StateT [String] IO))\n      arising from a use of \u2018getLineIO\u2019\n    In the expression: getLineIO\n    In a stmt of a 'do' block: minput &lt;- getLineIO $ in_ps1 $ c\n    In the expression:\n      do { minput &lt;- getLineIO $ in_ps1 $ c;\n           case minput of {\n             Nothing -&gt; outputStrLn \"Goodbye.\"\n             Just input -&gt; (process' c input) &gt;&gt; loop c } }\n</code></pre>\n\n<p>If I remove <code>getLineIO</code> and use <code>getInputLine</code> directly, as per @chepner's advice:</p>\n\n<pre><code>loop :: Counter -&gt; InputT (StateT [String] IO) ()\nloop c = do\n    minput &lt;- (in_ps1 c) &gt;&gt;= getInputLine\n    case minput of\n      Nothing -&gt; outputStrLn \"Goodbye.\"\n      Just input -&gt; (process' c input) &gt;&gt; loop c\n</code></pre>\n\n<p>I'm getting an error:</p>\n\n<pre><code>Main.hs:81:16:\n    Couldn't match type \u2018IO\u2019 with \u2018InputT (StateT [String] IO)\u2019\n    Expected type: InputT (StateT [String] IO) String\n      Actual type: IO String\n    In the first argument of \u2018(&gt;&gt;=)\u2019, namely \u2018(in_ps1 c)\u2019\n    In a stmt of a 'do' block: minput &lt;- (in_ps1 c) &gt;&gt;= getInputLine\n</code></pre>\n\n<p>Full code can be found <a href=\"https://github.com/dimidd/write-you-a-haskell/blob/master/chapter4/untyped/Main.hs\" rel=\"nofollow noreferrer\">here</a>, and explanations about what I'm trying to do can be found <a href=\"https://stackoverflow.com/questions/37930204/combining-statet-with-inputt/\">here</a>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1467084698, "post_id": 38066521, "comment_id": 63571561, "body": "You probably will want to look at <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-TH.html\" rel=\"nofollow noreferrer\">this</a>"}], "answers": [{"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1467097672, "post_id": 38067333, "comment_id": 63576419, "body": "Another convention I&#39;ve used is to name all the record field labels with a prefix for the data type, as in <code>sectionedItemsSections</code>. At least some of the options in Control.Lens.TH will strip off the prefix for the generated lens names, and this plays well with using the <code>makeFields</code> stuff for lenses that are overloaded for multiple data types (since it also stops the record field labels from clashing, though they&#39;re now extremely verbose)."}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1467099674, "post_id": 38067333, "comment_id": 63577628, "body": "Don&#39;t you need to use <code>TemplateHaskell</code> language extension to make Lenses work?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1467099817, "post_id": 38067333, "comment_id": 63577720, "body": "@klappvisor, to use the convenient <code>makeLenses</code>, etc., features, yes. To write lenses by hand and use them, no."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1467157734, "post_id": 38067333, "comment_id": 63612338, "body": "@2426021684 Let me check that out. I should&#39;ve tried that instance before typing it in."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1467158091, "last_edit_date": 1467158091, "creation_date": 1467089780, "answer_id": 38067333, "question_id": 38066521, "link": "https://stackoverflow.com/questions/38066521/haskell-records-with-default-values-using-lens-without/38067333#38067333", "title": "Haskell records with default values using lens without _", "body": "<p>There is a handy package called <a href=\"https://hackage.haskell.org/package/data-default\" rel=\"nofollow\">data-default</a> which defines a typeclass <code>Default</code> which exposes one function <code>def :: a</code> - a default value. Furthermore, although I can't seem to find any documentation for it, you can derive it automatically (with the right flags and things imported). Of course you can always declare the instance yourself if your default has to be different.</p>\n\n<p>Then, you can ease a bit of the pain in your example with something like this:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, DeriveAnyClass, TemplateHaskell #-}\n\nimport Data.Default\nimport GHC.Generics\nimport Control.Lens\n\ndata SectionedItems s i = SectionedItems{\n    _section :: Maybe s,\n    _items :: [i],\n    _subsections :: [SectionedItems s i]\n} deriving (Generic,Default)\nmakeLenses ''SectionedItems\n\n-- Create a SectionedItems - this could have whatever type you want\ndef &amp; section .~ Just 3 :: SectionedItems Int [String]\n</code></pre>\n\n<p>(Try not to use 'instance' like you would in OOP since Haskell has a very different meaning for instance).</p>\n\n<p>However that doesn't do away with the underscores in <code>Lens</code>. I'm not sure what you <em>could</em> do for that. The bottom line is that the functions <code>makeLenses''</code> generates for you can't have name clashes with the functions Haskell generates for you when you create records. By looking in <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-TH.html\" rel=\"nofollow\">Control.Lens.TH</a> you can see that you can regulate the lens names to be what you want, but bottom line you will have to settle on a convention - the underscore for record accessors and no underscore for lens is as good a convention as any.</p>\n\n<h2>EDIT</h2>\n\n<p>If you want to define the default value explicitly, you make an instance of <code>Default</code>:</p>\n\n<pre><code>instance Default (SectionedItems s i) where\n  def = SectionedItems { _section = Nothing, _items = [], _subsections = [] }\n</code></pre>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 0, "accepted_answer_id": 38067333, "answer_count": 1, "score": 2, "last_activity_date": 1467158091, "creation_date": 1467084083, "question_id": 38066521, "link": "https://stackoverflow.com/questions/38066521/haskell-records-with-default-values-using-lens-without", "title": "Haskell records with default values using lens without _", "body": "<p>I am trying to make record with default values and avoid using underscores when making records. I currently am using:</p>\n\n<pre><code>data SectionedItems s i = SectionedItems{\n    _section :: Maybe s,\n    _items :: [i],\n    _subsections :: [SectionedItems s i]\n}\nmakeLenses ''SectionedItems\n\nsectionedItems = SectionedItems{\n    _section = Nothing,\n    _items = [],\n    _subsections = []\n}\n\n-- Create Instance of SectionedItems\nsectionedItems\n    &amp; section .~ Just x\n</code></pre>\n\n<p>Is there a shorter or clearer way to make a record with default values and without underscores?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 7, "creation_date": 1467061164, "post_id": 38062995, "comment_id": 63565219, "body": "You should really have edited your original question instead of deleting it and posting this one. It&#39;s generally confusing to other users when we see &quot;new&quot; questions that look so much like ones we remember having seen."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1467065092, "post_id": 38062995, "comment_id": 63566855, "body": "Perhaps it will help to observe that <code>state = State</code>, hence <code>runState (state f) = runState (State f) = f</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467087230, "post_id": 38062995, "comment_id": 63572179, "body": "and <code>runState (state $ \\st -&gt; (st,st)) s</code> = <code>(\\st -&gt; (st,st)) s</code> = <code>(s,s)</code> so <code>x = s</code> and <code>s&#39; = s</code> - now you can replace this in then next <code>runState (state ...) </code> expression and observe that <code>runState (state (\\s -&gt; ...)) s&#39;</code> s just <code>(\\s -&gt; ..) s</code> again"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1467087359, "post_id": 38062995, "comment_id": 63572217, "body": "also note that you did not replace your <code>a</code> when you did <i>desugar</i> <code>foo</code> - look carefully <code>a</code> is really <code>st</code>!"}], "answers": [{"comments": [{"owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "edited": false, "score": 0, "creation_date": 1467109703, "post_id": 38071354, "comment_id": 63584136, "body": "My pleasure :). I&#39;d appreciate it if you would accept this answer."}], "tags": [], "owner": {"reputation": 2098, "user_id": 2896874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8dd5a8776e9c69d58e2b97f2ba16ed?s=128&d=identicon&r=PG&f=1", "display_name": "Vaibhav Sagar", "link": "https://stackoverflow.com/users/2896874/vaibhav-sagar"}, "is_accepted": false, "score": 1, "last_activity_date": 1467106099, "last_edit_date": 1467106099, "creation_date": 1467103765, "answer_id": 38071354, "question_id": 38062995, "link": "https://stackoverflow.com/questions/38062995/haskell-monad-state-desugar/38071354#38071354", "title": "Haskell monad state desugar", "body": "<p>I wrote a blog post with almost exactly this example: <a href=\"http://www.vaibhavsagar.com/blog/2016/06/17/haskell-state/\" rel=\"nofollow\">http://www.vaibhavsagar.com/blog/2016/06/17/haskell-state/</a>. </p>\n\n<p>If we define <code>(&gt;&gt;=)</code> as</p>\n\n<pre><code>  (&gt;&gt;=) (State sa) fn =\n    State (\\s0 -&gt; let (a, s1)  = sa s0\n                      State sb = fn a\n                  in sb s1)\n</code></pre>\n\n<p>The desugaring is then</p>\n\n<pre><code>    do i &lt;- get; put (i+1)\n == get &gt;&gt;= \\i -&gt; put (i+1)\n == State (\\s -&gt; (s, s)) &gt;&gt;= \\i -&gt; State (\\_ -&gt; ((), i+1))\n</code></pre>\n\n<p>Which we can simplify by the definition of <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>    (&gt;&gt;=) (State (\\s -&gt; (s,s))) (\\i -&gt; State (\\_ -&gt; ((), i+1))) =\n      State (\\s0 -&gt; let (a, s1)  = (\\s -&gt; (s,s)) s0\n                     -- (a, s1)  = (s0, s0)\n                        State sb = (\\i -&gt; State (\\_ -&gt; ((), i+1))) a\n                     --       sb = (\\_ -&gt; ((), s0+1))\n                    in sb s1)\n                     -- ((), s0+1)\n == State (\\s0 -&gt; ((), s0+1))\n == State (\\i  -&gt; ((), i+1))\n</code></pre>\n\n<p>Finally, we have</p>\n\n<pre><code>    exec (State (\\i -&gt; ((), i+1))) 0\n == snd $ runState (State (\\i -&gt; ((), i+1))) 0\n == snd $ (\\i -&gt; ((), i+1)) 0\n == snd $ ((), 1)\n == 1\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6518699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1467286299, "creation_date": 1467060608, "last_edit_date": 1467286299, "question_id": 38062995, "link": "https://stackoverflow.com/questions/38062995/haskell-monad-state-desugar", "title": "Haskell monad state desugar", "body": "<p>To study the details of the State monad, I'm trying to desugar :</p>\n\n<p>I pasting versions of which I was able to create with the help of Forum Members.</p>\n\n<p>I want to make sure that my line of thought  is correct:</p>\n\n<pre><code>newtype State s a = State { runState :: s -&gt; (a, s) }\n\nstate :: (s -&gt; (a, s)) -&gt; State s a\n</code></pre>\n\n<hr>\n\n<pre><code> foo = do\n      a &lt;-get\n      put(a+1)\n\nfoo =\n  get &gt;&gt;= \\a-&gt;\n  put (a+1)\n\n\n2. foo= get &gt;&gt;= \\a-&gt;put(a+1)\n   2.1 get = State (\\s-&gt;(s,s))\n   2.2 put a = State(\\_-&gt;((), a+1)\n\n3. foo= State (\\s-&gt;(s,s)) &gt;&gt;= \\a-&gt;State(\\_-&gt;((), a+1)\n\n4. foo= State (\\s0 -&gt; let (a,s1)=runState( State(\\s-&gt;(s,s)) s0\n                               in runState ((\\a-&gt;State(\\_-&gt;((),a+1) a) s1\n\n5. foo= State (\\s0 -&gt; let (a,s1)=(\\s-&gt;(s,s)) s0\n                               in runState ((\\a-&gt;State(\\_-&gt;((),a+1) a) s1\n\n6. foo= State (\\s0 -&gt; let (a,s1)=(s0,s0)  -- a=s0 i s1=s0\n                               in runState ((\\a-&gt;State(\\_-&gt;((),a+1) a) s1\n\n7. foo= State (\\s0 -&gt;  runState ((\\a-&gt;State(\\_-&gt;((),a+1) s0) s1\n\n8. foo= State (\\s0 -&gt;  runState ((State(\\_-&gt;((),s0+1) ) s1\n\n9.foo= State (\\s0 -&gt; ( \\_-&gt;((),s0+1) \n\n10.foo= State (\\s0 -&gt; ((),s0+1)\n\n\n11. runState  foo 0\n\n12. runState (State(\\s0-&gt;((),s0+1) 0\n\n13 . (\\s0-&gt;((),s0+1) 0\n</code></pre>\n\n<p>is it correct? :)</p>\n"}, {"tags": ["haskell", "opengl", "c-preprocessor", "cabal-install"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 1609218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0XjuR.jpg?s=128&g=1", "display_name": "Casey", "link": "https://stackoverflow.com/users/1609218/casey"}, "edited": false, "score": 0, "creation_date": 1467084205, "post_id": 38066085, "comment_id": 63571416, "body": "This worked perfectly, thank you! The only question I still have is how is it that there came to be a lack of space after the <code>include</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 3, "user_id": 1609218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0XjuR.jpg?s=128&g=1", "display_name": "Casey", "link": "https://stackoverflow.com/users/1609218/casey"}, "edited": false, "score": 0, "creation_date": 1467084914, "post_id": 38066085, "comment_id": 63571613, "body": "Don&#39;t know, and I don&#39;t have a Windows system right now to debug it."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1467080671, "creation_date": 1467080671, "answer_id": 38066085, "question_id": 38062271, "link": "https://stackoverflow.com/questions/38062271/cabal-failed-to-install-glutil/38066085#38066085", "title": "Cabal: Failed to Install GLUtil", "body": "<p>It appears that there should be a space between the <code>-include</code> and the file name.</p>\n\n<p>I created a version of GLUtil-0.9.0.1 that is already preprocessed and should work for you:</p>\n\n<p><a href=\"https://github.com/erantapaa/GLUtil-0.9.0.1-no-cpp\" rel=\"nofollow\">https://github.com/erantapaa/GLUtil-0.9.0.1-no-cpp</a></p>\n\n<p>It assumes you are using GHC 7.10.x or later.</p>\n\n<p>The steps to remove the dependency on CPP were:</p>\n\n<ul>\n<li><p>files JuicyTextures.hs and ShaderProgram.hs just use CPP to include Control.Applicative for older versions of GHC, so I just commented out those lines. Also remove <code>CPP</code> from the <code>LANGUAGE</code> pragma.</p></li>\n<li><p>Linear.hs uses CPP to generate code. You can create the pre-processed output with:</p>\n\n<pre><code>gcc -E - &lt; Linear.hs &gt; new-Linear.hs\n</code></pre></li>\n</ul>\n\n<p>Then remove lines beginning with a hash (#) and remove <code>CPP</code> from the <code>LANGUAGE</code> pragma.</p>\n\n<ul>\n<li><p>in <code>GLUtil.cabal</code> comment out/remove the lines:</p>\n\n<pre><code>if impl(ghc &gt;= 7.10.1)\n  Build-depends:     hpp &gt;= 0.3 &amp;&amp; &lt; 0.4\n  GHC-Options:       -pgmPhpp -optP--cpp -optP-P\nelse\n  Build-tools:       cpphs\n  GHC-Options:       -pgmPcpphs -optP--cpp -optP\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 3, "user_id": 1609218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0XjuR.jpg?s=128&g=1", "display_name": "Casey", "link": "https://stackoverflow.com/users/1609218/casey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 38066085, "answer_count": 1, "score": 0, "last_activity_date": 1467080671, "creation_date": 1467057651, "question_id": 38062271, "link": "https://stackoverflow.com/questions/38062271/cabal-failed-to-install-glutil", "title": "Cabal: Failed to Install GLUtil", "body": "<p>I'm new to Haskell but I want to try and write some OpenGL experiments in it.\nI've successfully installed OpenGL, GLUT and a few other packages but when I attempt to install GLUtil I get the following error:</p>\n\n<pre><code>Building GLUtil-0.9.0.1...\nFailed to install GLUtil-0.9.0.1\nBuild log ( C:\\Users\\David\\AppData\\Roaming\\cabal\\logs\\GLUtil-0.9.0.1.log ):\nBuilding GLUtil-0.9.0.1...\nPreprocessing library GLUtil-0.9.0.1...\nhpp: Couldn't open input file: -includeC:\\Users\\David\\AppData\\Local\\Temp\\ghc3236_0\\ghc_2.h\nCallStack (from HasCallStack):\n\nerror, called at src\\Hpp\\CmdLine.hs:89:0: error:\n    22 in hpp-0.3.0.0-61vdEFyxUJDaeEBxsHCsL:Hpp.CmdLine\n`hpp' failed in phase `C pre-processor'. (Exit code: 1)\ncabal: Leaving directory 'C:\\Users\\David\\AppData\\Local\\Temp\\cabal-tmp-6356\\GLUtil-0.9.0.1'\ncabal: Error: some packages failed to install:\nGLUtil-0.9.0.1 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I tried using older versions of GLUtil and its dependencies but it always ended the same way and I eventually just cleared and reinstalled the Haskell Platform (I didn't know about sandboxing).</p>\n\n<p>One thing that stands out is that <code>-includeC:\\Users\\Dav...</code> looks to me like a typo, as if there should be a space between <code>-include</code> and <code>C:\\...</code> but I don't know how to change this. I couldn't find <code>CmdLine.hs</code>, just the interface file <code>CmdLine.hi</code> which yielded no results.</p>\n\n<p>Does anyone have any advice on how to remedy this?</p>\n"}, {"tags": ["haskell", "recursion", "fold"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467060758, "post_id": 38061441, "comment_id": 63565027, "body": "I think you&#39;ve just written the fold-like action you seek! There is no actual fold, per se, because you don&#39;t have an actual container full of values but rather a handle that lets you use I/O to get values."}], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "edited": false, "score": 0, "creation_date": 1467054895, "post_id": 38061500, "comment_id": 63562020, "body": "Oh clever. Thanks."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1467055033, "last_edit_date": 1467055033, "creation_date": 1467054754, "answer_id": 38061500, "question_id": 38061441, "link": "https://stackoverflow.com/questions/38061441/turn-recursion-to-fold/38061500#38061500", "title": "Turn recursion to fold?", "body": "<p>Manually working with handles is very eschewed in Haskell. It doesn't play well together with a functional programming style.</p>\n\n<p>For a simple input processor like this, it's probably the best to just read <em>the entire file</em> as one (lazy) string, and process the lines of that:</p>\n\n<pre><code>processHandle h fn = mapM_ fn . lines =&lt;&lt; hgetContents h\n</code></pre>\n\n<p>Of course this can also be written as a fold, just look up <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Foldable.html#mapM_\">the definition of <code>mapM_</code></a>.</p>\n\n<p>Now, this lazy-IO approach doesn't work as well for many serious applications. If this isn't one huge file, then you may be good if you just read the file strictly <a href=\"http://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text-IO.html#v:readFile\">with the <code>Data.Text</code> equivalent</a>. Else, if you really need to read lines interleaved with the processing steps, better look into <a href=\"http://hackage.haskell.org/package/conduit\">conduit</a>.</p>\n"}], "owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 38061500, "answer_count": 1, "score": 1, "last_activity_date": 1467055033, "creation_date": 1467054490, "last_edit_date": 1467054627, "question_id": 38061441, "link": "https://stackoverflow.com/questions/38061441/turn-recursion-to-fold", "title": "Turn recursion to fold?", "body": "<p>I wrote this code that loops through the lines of a file handle and does an arbitrary action with it. I don't think it should need to be recursive - can I make it into a fold action?</p>\n\n<p>Thanks!</p>\n\n<pre><code>processHandle :: Handle -&gt; (String-&gt;IO ()) -&gt; IO ()\nprocessHandle h fn = do\n                   eof &lt;- hIsEOF h\n                   if eof then\n                     return ()\n                    else do\n                      myLine &lt;- hGetLine h\n                      fn myLine\n                      processHandle h fn\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1467059983, "post_id": 38059970, "comment_id": 63564672, "body": "In particular, <code>epsilon</code> is a Double, so <code>dif</code> will work only with <code>a ~ Double</code>. However, the type signature promises to work for <i>any</i> <code>Fractional a</code>, and the compiler is noting that your implementation doesn&#39;t live up to this promise, because it depends on <code>dif</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1467048985, "last_edit_date": 1495540289, "creation_date": 1467048985, "answer_id": 38059970, "question_id": 38059882, "link": "https://stackoverflow.com/questions/38059882/issues-adding-fractional-types/38059970#38059970", "title": "Issues adding fractional types", "body": "<p>Give <code>epsilon</code> a suitably polymorphic type signature:</p>\n\n<pre><code>epsilon :: Fractional a =&gt; a\n</code></pre>\n\n<p>You may also like the explanations in <a href=\"https://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\">What is the monomorphism restriction?</a>.</p>\n"}], "owner": {"reputation": 91, "user_id": 5361211, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f8b05f5ac4559584e2530bd517023b9c?s=128&d=identicon&r=PG&f=1", "display_name": "orange_juice", "link": "https://stackoverflow.com/users/5361211/orange-juice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 38059970, "answer_count": 1, "score": 1, "last_activity_date": 1467048985, "creation_date": 1467048575, "question_id": 38059882, "link": "https://stackoverflow.com/questions/38059882/issues-adding-fractional-types", "title": "Issues adding fractional types", "body": "<p>I am trying to define a function that requires me to add a fractional type to a double but I seem to receive an error.</p>\n\n<pre><code>epsilon = 0.0000001\ndif :: (Fractional a) =&gt; (a-&gt;a) -&gt; a -&gt; a\n\ndif f x = (f(x+epsilon)-f(x))/epsilon\n</code></pre>\n\n<p>Haskell seems to be having trouble interpreting x+epsilon but this seems odd considering that x is defined to be a Fractional type in the function declaration and epsilon is a double (which is a part of the Fractional type class?</p>\n\n<p>Heres the error I get: </p>\n\n<pre><code>Couldn't match expected type \u2018a\u2019 with actual type \u2018Double\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n      the type signature for dif :: Fractional a =&gt; (a -&gt; a) -&gt; a -&gt; a\n      at dif.hs:3:8\nRelevant bindings include\n  x :: a (bound at dif.hs:5:7)\n  f :: a -&gt; a (bound at dif.hs:5:5)\n  dif :: (a -&gt; a) -&gt; a -&gt; a (bound at dif.hs:5:1)\nIn the second argument of \u2018(+)\u2019, namely \u2018epsilon\u2019\nIn the first argument of \u2018f\u2019, namely \u2018(x + epsilon)\u2019\n</code></pre>\n\n<p>Thank you. </p>\n"}, {"tags": ["python", "haskell", "numpy"], "answers": [{"tags": [], "owner": {"reputation": 11305, "user_id": 6160119, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JlM4b.jpg?s=128&g=1", "display_name": "Tonechas", "link": "https://stackoverflow.com/users/6160119/tonechas"}, "is_accepted": true, "score": 5, "last_activity_date": 1467071907, "last_edit_date": 1467071907, "creation_date": 1467033533, "answer_id": 38055046, "question_id": 38054955, "link": "https://stackoverflow.com/questions/38054955/map-with-failure-in-numpy/38055046#38055046", "title": "map with failure in Numpy", "body": "<p>NumPy's <a href=\"http://docs.scipy.org/doc/numpy/reference/generated/numpy.where.html\" rel=\"nofollow\"><code>where()</code></a> will do the trick:</p>\n\n<pre><code>In [429]: import numpy as np\n\nIn [430]: arr = np.arange(10, dtype=np.object)\n\nIn [431]: np.where(arr &gt; 3, arr, None)\nOut[431]: array([None, None, None, None, 4, 5, 6, 7, 8, 9], dtype=object)\n</code></pre>\n\n<p>The code above creates a new array. If you wish to modify <code>arr</code> <strong>in place</strong>, you could use boolean indexing <code>arr[arr &lt; 4] = None</code> (as pointed out by @Chris Mueller) or <a href=\"http://docs.scipy.org/doc/numpy-1.10.4/reference/generated/numpy.putmask.html\" rel=\"nofollow\"><code>putmask()</code></a>:</p>\n\n<pre><code>In [432]: np.putmask(arr, arr &lt; 4, None)\n\nIn [433]: arr\nOut[433]: array([None, None, None, None, 4, 5, 6, 7, 8, 9], dtype=object)\n</code></pre>\n\n<hr>\n\n<p>Unless you are constrained to use <code>None</code> as a \"flag\" value, I would suggest you to stick to @ev-br's recommendation and use <code>np.nan</code> instead. I will follow that approach to assess performance:</p>\n\n<pre><code>In [434]: arr = np.arange(1000000, dtype=np.float)\n\nIn [435]: timeit np.where(arr &gt; 3, arr, np.nan)\n100 loops, best of 3: 3.61 ms per loop\n\nIn [436]: timeit arr[arr &lt; 4] = np.nan\n1000 loops, best of 3: 564 \u00b5s per loop\n\nIn [437]: timeit np.putmask(arr, arr &lt; 4, np.nan)\n1000 loops, best of 3: 1.08 ms per loop\n</code></pre>\n\n<p>Notice that I used a much larger array to further highlight efficiency differences. And the winner is... <a href=\"http://docs.scipy.org/doc/numpy/user/basics.indexing.html#boolean-or-mask-index-arrays\" rel=\"nofollow\">boolean indexing</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1467036716, "post_id": 38056015, "comment_id": 63550928, "body": "Interesting ! Thanks."}], "tags": [], "owner": {"reputation": 5116, "user_id": 3254859, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mGMef.jpg?s=128&g=1", "display_name": "Chris Mueller", "link": "https://stackoverflow.com/users/3254859/chris-mueller"}, "is_accepted": false, "score": 3, "last_activity_date": 1467036208, "creation_date": 1467036208, "answer_id": 38056015, "question_id": 38054955, "link": "https://stackoverflow.com/questions/38054955/map-with-failure-in-numpy/38056015#38056015", "title": "map with failure in Numpy", "body": "<p>A slightly different technique than Tonechas' which uses numpy's boolean indexing feature.</p>\n\n<pre><code>&gt;&gt;&gt; import numpy as np\n&gt;&gt;&gt; x = np.arange(10).astype(np.object)\n&gt;&gt;&gt; x[x&lt;4] = None\n</code></pre>\n\n<p>returns </p>\n\n<pre><code>array([None, None, None, None, 4, 5, 6, 7, 8, 9], dtype=object)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21050, "user_id": 143765, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/bd4477dc26bf9941268fbfa05abdeae6?s=128&d=identicon&r=PG", "display_name": "ev-br", "link": "https://stackoverflow.com/users/143765/ev-br"}, "is_accepted": false, "score": 5, "last_activity_date": 1467066865, "creation_date": 1467066865, "answer_id": 38064258, "question_id": 38054955, "link": "https://stackoverflow.com/questions/38054955/map-with-failure-in-numpy/38064258#38064258", "title": "map with failure in Numpy", "body": "<p>I'd recommend to revisit the premise that you want <code>None</code>s in a numpy array: you need an array of <code>dtype=object</code> to store a <code>None</code>, i.e. you'll be storing python objects in an array. This way you're going to lose most of the advantages that numpy provides over plain lists.</p>\n\n<p>If what you want is a sentinel value to signal \"not available\" or \"not known\", and you can have other values to be floating-point numbers, then you're better off using <code>np.nan</code></p>\n\n<pre><code>&gt;&gt;&gt; x = np.arange(10, dtype=float)\n&gt;&gt;&gt; x[x &lt; 3] = np.nan\n&gt;&gt;&gt; x\narray([ nan,  nan,  nan,   3.,   4.,   5.,   6.,   7.,   8.,   9.])\n</code></pre>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 38055046, "answer_count": 3, "score": 3, "last_activity_date": 1467071907, "creation_date": 1467033290, "last_edit_date": 1467036857, "question_id": 38054955, "link": "https://stackoverflow.com/questions/38054955/map-with-failure-in-numpy", "title": "map with failure in Numpy", "body": "<p>Inspired by Haskell:</p>\n\n<p>How can I implement the following with a numpy array in Python?</p>\n\n<pre><code>In [13]: [(x if x&gt;3 else None) for x in range(10)]\nOut[13]: [None, None, None, None, 4, 5, 6, 7, 8, 9]\n</code></pre>\n\n<p>In other words, I am looking for a function for numpy that would have the signature: <code>f:[a]-&gt;(a-&gt;Maybe a)-&gt;[Maybe a]</code> in Haskell, where <code>[a]</code> would be a numpy list. </p>\n\n<p>I was trying this:</p>\n\n<pre><code>np.apply_along_axis(lambda x:x if x&gt;3 else None,0,np.arange(10))\n</code></pre>\n\n<p>but it does not work:</p>\n\n<pre><code>ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\n</code></pre>\n"}, {"tags": ["haskell", "gitlab-ci", "haskell-stack"], "comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1467041615, "post_id": 38054594, "comment_id": 63554362, "body": "Hmm, what about making the packages required by your project part of the Docker image? We use a similar setup: Gitlab-CI + Docker executor. But we build the project once when <i>creating</i> the Docker image. This way stack has a chance to download and build all the dependencies and they are left as part of the docker image. The only downside is that we need to update the image if we switch stack snapshots...."}, {"owner": {"reputation": 4424, "user_id": 34996, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ca2e2c3442a73f84394abb35d6236b12?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/34996/magnus"}, "reply_to_user": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1467043216, "post_id": 38054594, "comment_id": 63555516, "body": "Yes, that would be one way to do what I call &quot;pre-fetch the snapshot we&#39;re currently using&quot; :) I&#39;d just really like something as nice as <code>stack setup</code>, that also pulls in the chosen snapshot. I don&#39;t switch snapshots that often, so updating the image when I do is not a terrible burden... it would of course be nicer if I could avoid that too :)"}], "answers": [{"tags": [], "owner": {"reputation": 4424, "user_id": 34996, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ca2e2c3442a73f84394abb35d6236b12?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/34996/magnus"}, "is_accepted": false, "score": 1, "last_activity_date": 1467116487, "creation_date": 1467116487, "answer_id": 38076143, "question_id": 38054594, "link": "https://stackoverflow.com/questions/38054594/caching-stack-databases-between-builds-in-gitlab-ci/38076143#38076143", "title": "Caching stack databases between builds in Gitlab CI", "body": "<p>After @dsign's comment and a bit of thinking I've come to a solution that is satisfactory:</p>\n\n<ul>\n<li>Yes, pre-fetching by (sort of) building the software once during docker image build is all right.</li>\n<li>The way to pre-fetch is by running <code>stack install --only-dependencies</code>.</li>\n</ul>\n"}], "owner": {"reputation": 4424, "user_id": 34996, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ca2e2c3442a73f84394abb35d6236b12?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/34996/magnus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 718, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1467116487, "creation_date": 1467032168, "question_id": 38054594, "link": "https://stackoverflow.com/questions/38054594/caching-stack-databases-between-builds-in-gitlab-ci", "title": "Caching stack databases between builds in Gitlab CI", "body": "<p>I have a large-ish, multi-language project using CMake to build. In this there is a part written in Haskell, and it uses <code>stack</code> to build. The CI builds are handled by Gitlab CI and run in a <em>docker executor</em>. During creation of the docker image ghc is downloaded using <code>stack setup</code>. The Haskell-part of the build still takes a rather long time though, since it downloads and builds all required packages anew for each build.</p>\n\n<p>To cache the local database I added</p>\n\n<pre><code>cache:\n  paths:\n    - src/utils/.stack-work\n</code></pre>\n\n<p>(The stack YAML file lives in <code>src/utils/</code>, and the three Haskell packages live in dirs there too.)</p>\n\n<p>This didn't really speed up the build that much though. After reading more carefully about <a href=\"http://docs.haskellstack.org/en/stable/GUIDE/#different-databases\" rel=\"noreferrer\">stack databases</a> I realised that snapshots are put into <code>STACK_ROOT</code> (<code>~/.stack</code>). Studying the options for stack suggests that there is no way to specify that snapshots should be stored separately from <code>STACK_ROOT</code>.</p>\n\n<p>Given that Gitlab CI seems to only allow caching of items in the build dir I think I'm left with two options:</p>\n\n<ul>\n<li>Use <code>stack --stack-root &lt;folder under build&gt; ...</code> to place the <code>STACK_ROOT</code> in the build dir and then cache the whole thing. This means my cache goes from less than 100M to about 1.6G!</li>\n<li>Pre-fetch the snapshot we're currently on into the docker image we're using for building.</li>\n</ul>\n\n<p>Now for my questions:</p>\n\n<ul>\n<li>Am I correct in thinking that snapshots <em>always</em> are stored in <code>STACK_ROOT</code>?</li>\n<li>Is there a way to pre-fetch a specific snapshot, similar to how <code>stack setup</code> fetches ghc?</li>\n</ul>\n\n<p>Or maybe I'm completely wrong, and there's a better route towards limiting the cache size.</p>\n"}, {"tags": ["haskell", "pattern-matching", "record", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "edited": false, "score": 0, "creation_date": 1467027266, "post_id": 38052886, "comment_id": 63544333, "body": "Great, thanks. I actually tried C{_} and C{..}, to no avail. Just one character too much. ^^"}, {"owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "edited": false, "score": 6, "creation_date": 1467032046, "post_id": 38052886, "comment_id": 63547514, "body": "Shame that Google doesn&#39;t help you much with &quot;haskell record pattern&quot;. I&#39;ve renamed the question, maybe that&#39;ll make it more discoverable for others."}, {"owner": {"reputation": 9895, "user_id": 452775, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/88963e7cc58eabf150447e7b78a24793?s=128&d=identicon&r=PG", "display_name": "Lii", "link": "https://stackoverflow.com/users/452775/lii"}, "reply_to_user": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "edited": false, "score": 1, "creation_date": 1467032752, "post_id": 38052886, "comment_id": 63548005, "body": "@theduke: Note also that you can use the empty record pattern (<code>B{}</code>) even if you declared <code>B</code> to be a normal, non-record data type."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 9895, "user_id": 452775, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/88963e7cc58eabf150447e7b78a24793?s=128&d=identicon&r=PG", "display_name": "Lii", "link": "https://stackoverflow.com/users/452775/lii"}, "edited": false, "score": 0, "creation_date": 1467034328, "post_id": 38052886, "comment_id": 63549069, "body": "@Lii That is something I didn&#39;t think about. I&#39;ll add a mention to the answer."}, {"owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "edited": false, "score": 0, "creation_date": 1467117304, "post_id": 38052886, "comment_id": 63589349, "body": "@Lili thanks for pointing it out. To me, it was obvious from the answer anyway, though."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 87, "last_activity_date": 1467034407, "last_edit_date": 1467034407, "creation_date": 1467027184, "answer_id": 38052886, "question_id": 38052553, "link": "https://stackoverflow.com/questions/38052553/haskell-record-pattern-matching/38052886#38052886", "title": "Haskell record pattern matching", "body": "<p>You can use record patterns like this:</p>\n\n<pre><code>data X = A | B {name :: String} | C {x::Int, y::Int, name::String}\n\nmyfn :: X -&gt; Int\nmyfn A = 50\nmyfn B{} = 200\nmyfn C{} = 500\n</code></pre>\n\n<p>Record patterns allow you to give names to the fields of the constructors.\nyou can also do things like:</p>\n\n<pre><code>myfn C{name=n} = length n\n</code></pre>\n\n<p>so you can see that you can pattern match only on the specific field you need.</p>\n\n<p><strong>Note:</strong> you can use the <em>empty</em> record pattern even with data types that do not use record syntax:</p>\n\n<pre><code>data A = A Int | B Int Int\n\nmyfn A{} = 1\nmyfn B{} = 2\n</code></pre>\n\n<p>This is fine.\nThere a number of other extensions related to record patterns:</p>\n\n<ul>\n<li><p><code>RecordWildCards</code> allows you to write things like <code>C{..}</code> which is equivalent to the pattern: <code>C{x=x, y=y, name=name}</code>, i.e. it matches all fields and you now have in scope <code>x</code> with the value matched for the <code>x</code> field etc.</p></li>\n<li><p><code>NamedFieldPuns</code> allows you to write <code>C{name}</code> to be equivalent to <code>C{name=name}</code>, so that <code>name</code> is now in scope and contains the value matched for the <code>name</code> field.</p></li>\n</ul>\n\n<p>Keep in mind that using record patterns doesn't prevent you from using your constructors in a positional way, so you can still write:</p>\n\n<pre><code>myfn (B _) = 200\n</code></pre>\n\n<p>It only <em>adds</em> functionality.</p>\n"}], "owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13845, "favorite_count": 10, "accepted_answer_id": 38052886, "answer_count": 1, "score": 40, "last_activity_date": 1525961597, "creation_date": 1467026176, "last_edit_date": 1525961597, "question_id": 38052553, "link": "https://stackoverflow.com/questions/38052553/haskell-record-pattern-matching", "title": "Haskell record pattern matching", "body": "<p>I'm looking for a way to simplify function patterns when the actual data is not required:</p>\n\n<pre><code>data X = A | B String | C Int Int String\nmyfn :: X -&gt; Int\nmyfn A = 50\nmyfn (B _) = 200\nmyfn (C _ _ _) = 500\n</code></pre>\n\n<p>Is there a way to make a simpler pattern for matching C, just discarding the values?</p>\n\n<p>hsdev adds a hint \"Hint: use record patterns\", but Google did not help me there.</p>\n"}, {"tags": ["haskell", "encryption", "file-io"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1467025008, "post_id": 38051825, "comment_id": 63542981, "body": "The error message says that you&#39;re calling the <code>(!!)</code> operator with an invalid index. And yet, the code you posted doesn&#39;t use this operator anywhere. I&#39;m going to say the problem is elsewhere."}, {"owner": {"reputation": 1, "user_id": 6280620, "user_type": "registered", "profile_image": "https://graph.facebook.com/818454581619009/picture?type=large", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/6280620/mayank-gupta"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467025551, "post_id": 38051825, "comment_id": 63543278, "body": "I get that. But in that case ,why is my function giving me the correct result when I am providing the input manually which is more than 16 hexadecimal in size?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467028512, "post_id": 38051825, "comment_id": 63545152, "body": "Without seeing the rest of your code, we can only speculate. Maybe try looking for all the places that <code>(!!)</code> is used?"}, {"owner": {"reputation": 1, "user_id": 6280620, "user_type": "registered", "profile_image": "https://graph.facebook.com/818454581619009/picture?type=large", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/6280620/mayank-gupta"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1467029213, "post_id": 38051825, "comment_id": 63545609, "body": "I understand completely. I will look at my code again. However, as it is a 190 line code, I decided not to upload my full code. Thanks for your valuable response."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1467054971, "post_id": 38051825, "comment_id": 63562070, "body": "If the broken code is too large, the helpful response is, &quot;I will find a shorter program with the same problem!&quot;, not, &quot;I will post only part of my program!&quot;."}, {"owner": {"reputation": 1, "user_id": 6280620, "user_type": "registered", "profile_image": "https://graph.facebook.com/818454581619009/picture?type=large", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/6280620/mayank-gupta"}, "edited": false, "score": 0, "creation_date": 1467084890, "post_id": 38051825, "comment_id": 63571606, "body": "I tried to find that. But individually, my different parts of code show no error. As I said, manual input gives no error. That is why I thought that the revelant part of the code would be this and hence the question"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1467030613, "creation_date": 1467030613, "answer_id": 38054060, "question_id": 38051825, "link": "https://stackoverflow.com/questions/38051825/reading-and-writing-files-using-haskell-after-encrypting-and-decrypting-them/38054060#38054060", "title": "Reading and writing files using haskell after encrypting and decrypting them", "body": "<p>Enabling profiling and using the RTS -xc option will display a stack trace when an exception occurs, and this might help locate the problem:</p>\n\n<pre><code>ghc program.hs -prof -fprof-auto\nprogram ...args... +RTS -xc\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6280620, "user_type": "registered", "profile_image": "https://graph.facebook.com/818454581619009/picture?type=large", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/6280620/mayank-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1467030613, "creation_date": 1467023966, "last_edit_date": 1467025711, "question_id": 38051825, "link": "https://stackoverflow.com/questions/38051825/reading-and-writing-files-using-haskell-after-encrypting-and-decrypting-them", "title": "Reading and writing files using haskell after encrypting and decrypting them", "body": "<p>I recently started to work on DES algorithm using haskell. I made two functions <code>des</code> and <code>indes</code> which, similar to DES, takes 16 hexadecimal of input and a 16 hexadecimal of key and then encrypt and decrypt them respectively. I wrote a function to take input from a file as arguments and the apply the required process accordingly. My encryption process is working good but the decryption process is showing the error <code>Prelude.!!: index too large</code> I gave multilines input in the function <code>dens</code> and it works. But, whenever I try to write it in the file, I give the same error. I am attaching only the significant code as I assume the function <code>des</code> and <code>indes</code> works fine.</p>\n\n<pre><code>denc :: String-&gt;String-&gt;String\ndenc [] _ = []\ndenc xs sx = if ((length xs)&gt;=16) then (des (take 16 xs) sx ++ denc (drop 16 xs) sx) else (des (take 16 (xs ++ (repeat '0'))) sx)\n\ndens :: String-&gt;[Char]-&gt;[Char]\ndens [] _ = []\ndens xs sx = (indes (take 16 xs) sx) ++ (dens (drop 16 xs) sx)\n\nmain :: IO ()\nmain = do\n    x:y:z:_ &lt;- getArgs\n    handle &lt;- openFile y ReadMode\n    contents &lt;- hGetContents handle \n    if (z==\"encrypt\") then (do\n            hanle &lt;- openFile \"cipher.txt\" WriteMode\n            let some = unlines $ unhex (denc (hex contents) (hex x))\n            hPutStrLn hanle some\n            hClose hanle\n        ) else (do\n            hanlee &lt;- openFile \"decipher.txt\" WriteMode\n            let some = unlines $ unhex (dens (hex contents) (hex x))\n            hPutStrLn hanlee some\n            hClose hanlee\n                )\nhClose handle\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1467021605, "post_id": 38050674, "comment_id": 63540924, "body": "Shouldn&#39;t it be: <code>prompt &lt;- liftIO $ getPrompt out_count iout; outputStrLn prompt</code>? At least, the type for <a href=\"https://hackage.haskell.org/package/haskeline-0.7.2.3/docs/System-Console-Haskeline.html#v:outputStrLn\" rel=\"nofollow noreferrer\"><code>outputStrLn</code></a> clearly says you should provide a <code>String</code> and not a monadic action as argument."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467022135, "post_id": 38050674, "comment_id": 63541290, "body": "Thanks, I&#39;ve tried it but it opens a whole new can of worms such as <code>No instance for (MonadState [String] (InputT (StateT [String] IO)))</code> in other parts of the code."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467023745, "post_id": 38050674, "comment_id": 63542248, "body": "That would seem to be an unrelated problem, though."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1467052617, "post_id": 38050674, "comment_id": 63560759, "body": "I see, so @Bakuriu, please post your comment as an answer, and I&#39;ll be glad to accept it."}], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 1, "last_activity_date": 1467053032, "creation_date": 1467053032, "answer_id": 38061060, "question_id": 38050674, "link": "https://stackoverflow.com/questions/38050674/string-vs-char-mismatch-in-haskell/38061060#38061060", "title": "String vs Char mismatch in haskell", "body": "<p>You are passing an <code>IO</code> action in place of a <code>String</code> to <code>outputStrLn</code>. You should instead do:</p>\n\n<pre><code>prompt &lt;- liftIO $ getPrompt out_count iout\noutputStrLn prompt\n</code></pre>\n\n<p>to obtain the <code>String</code> from the <code>IO</code> action, using <code>liftIO</code> and then passing this to <code>outputStrLn</code>.</p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 38061060, "answer_count": 1, "score": 1, "last_activity_date": 1467053032, "creation_date": 1467020749, "last_edit_date": 1495540349, "question_id": 38050674, "link": "https://stackoverflow.com/questions/38050674/string-vs-char-mismatch-in-haskell", "title": "String vs Char mismatch in haskell", "body": "<p>I'm getting an error about a type mismatch:</p>\n\n<pre><code>Main.hs:47:28:\n    Couldn't match type \u2018[Char]\u2019 with \u2018Char\u2019\n    Expected type: IO Char\n      Actual type: IO String\n    In the first argument of \u2018liftIO\u2019, namely \u2018prompt\u2019\n    In the second argument of \u2018($)\u2019, namely \u2018liftIO prompt\u2019\n</code></pre>\n\n<p>and struggling to understand why an <code>IO Char</code> is expected. Since <code>prompt</code> does type-check as <code>IO String</code> in line 46, and I thought, perhaps mistakenly, that <code>liftIO</code> would turn it to a <code>String</code> as suggested in this <a href=\"https://stackoverflow.com/a/28053686/165753\">answer</a>.</p>\n\n<pre><code>module Main where\n\nimport Syntax\nimport Parser\nimport Eval\nimport Pretty\nimport Counter\n\nimport Control.Monad\nimport Control.Monad.Trans\nimport System.Console.Haskeline\nimport Control.Monad.State\n\nshowStep :: (Int, Expr) -&gt; IO ()\nshowStep (d, x) = putStrLn ((replicate d ' ') ++ \"=&gt; \" ++ ppexpr x)\n\nprocess :: Counter -&gt; String -&gt; InputT (StateT [String] IO) ()\nprocess c line =\n    if ((length line) &gt; 0)\n       then\n        if (head line) /= '%'\n            then do\n                modify (++ [line])\n                let res = parseExpr line\n                case res of\n                    Left err -&gt; outputStrLn $ show err\n                    Right ex -&gt; do\n                        let (out, ~steps) = runEval ex\n                        --mapM_ showStep steps\n                        out_ps1 c $ out2iout $ show out\n        else do\n                let iout = handle_cmd line\n                out_ps1 c iout\n\n    -- TODO: don't increment counter for empty lines\n    else do\n      outputStrLn \"\"\n\nout2iout :: String -&gt; IO String\nout2iout s = return s\n\nout_ps1 :: Counter -&gt; IO String -&gt; InputT (StateT [String] IO) ()\nout_ps1 c iout = do\n      --out &lt;- liftIO iout\n      let out_count = c 0\n      let prompt = (getPrompt out_count iout) :: IO String\n      outputStrLn $ liftIO prompt\n      outputStrLn \"\"\n\n\ngetPrompt :: IO Int -&gt; IO String -&gt; IO String\ngetPrompt ion iout = do\n    n &lt;- ion\n    out &lt;- iout\n    return $ \"Out[\" ++ (show n) ++ \"]: \" ++ out\n\n\nhandle_cmd :: String -&gt; IO String\nhandle_cmd line = if line == \"%hist\"\n                     then\n                        evalStateT getHist []\n                     else\n                        return \"unknown cmd\"\n\njoinHist :: IO [String] -&gt; IO String\njoinHist ixs = do\n    xs &lt;- ixs\n    return $ unlines xs\n\ngetHist :: StateT [String] IO String\ngetHist = do\n    hist &lt;- lift get\n    let hists = (zip [(1::Int)..] hist) :: [(Int, String)]\n    return $ combineHist hists\n\n\ncombineHist :: [(Int, String)] -&gt; String\ncombineHist hists = unlines $ map (\\(i, h) -&gt; show i ++ \": \" ++ show h) hists\n\nmain :: IO ()\nmain = do\n    c &lt;- makeCounter\n    repl c\n\nrepl :: Counter -&gt; IO ()\nrepl c = evalStateT (runInputT defaultSettings(loop c)) []\n\nloop :: Counter -&gt; InputT (StateT [String] IO) ()\nloop c = do\n    minput &lt;- getLineIO $ in_ps1 $ c\n    case minput of\n      Nothing -&gt; return ()\n      Just input -&gt; process c input &gt;&gt; loop c\n\ngetLineIO :: (MonadException m) =&gt; IO String -&gt; InputT m (Maybe String)\ngetLineIO ios = do\n    s &lt;- liftIO ios\n    getInputLine s\n\nin_ps1 :: Counter -&gt; IO String\nin_ps1 c = do\n    let ion = c 1\n    n &lt;- ion\n    let s = \"Untyped: In[\" ++ (show n) ++ \"]&gt; \"\n    return s\n</code></pre>\n\n<p>More context can be found <a href=\"https://stackoverflow.com/questions/37930204/combining-statet-with-inputt\">here</a>.</p>\n"}, {"tags": ["haskell", "ghc", "ghc-pkg"], "answers": [{"comments": [{"owner": {"reputation": 235, "user_id": 936505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9626e272a0c020447fb1322645672d?s=128&d=identicon&r=PG", "display_name": "Giorgio Mossa", "link": "https://stackoverflow.com/users/936505/giorgio-mossa"}, "edited": false, "score": 0, "creation_date": 1467015794, "post_id": 38048690, "comment_id": 63537269, "body": "So basically my understanding was correct and I have misinterpreted what said in the link above?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 235, "user_id": 936505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9626e272a0c020447fb1322645672d?s=128&d=identicon&r=PG", "display_name": "Giorgio Mossa", "link": "https://stackoverflow.com/users/936505/giorgio-mossa"}, "edited": false, "score": 0, "creation_date": 1467018162, "post_id": 38048690, "comment_id": 63538688, "body": "Yes - your understanding is correct. That paragraph presents a simplified view of package databases, and its purpose is to motivate the need for the <code>ghcWithPackages</code> function presented in the next paragraph. Moreover, even though the statement &quot;GHC\u2019s store path is immutable once it\u2019s built&quot; is not technically true, nix would never modify the system package-db. Being &quot;functional&quot; it would create another package-db to layer on top of the system-db, and in that sense the statement is true."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1467014504, "creation_date": 1467014504, "answer_id": 38048690, "question_id": 38047415, "link": "https://stackoverflow.com/questions/38047415/how-does-ghc-resolve-paths-for-libraries/38048690#38048690", "title": "How does ghc resolve paths for libraries ?", "body": "<p>GHC has several command line options which allow you to manipulate how it searches for packages:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/7.10.3/docs/html/users_guide/flag-reference.html#idp46686514389712\" rel=\"nofollow\">https://downloads.haskell.org/~ghc/7.10.3/docs/html/users_guide/flag-reference.html#idp46686514389712</a></p>\n\n<p>In short, GHC allows you to specify a stack of of package directories (like a package db search path) so you can have it access libraries in different directories.</p>\n"}], "owner": {"reputation": 235, "user_id": 936505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9626e272a0c020447fb1322645672d?s=128&d=identicon&r=PG", "display_name": "Giorgio Mossa", "link": "https://stackoverflow.com/users/936505/giorgio-mossa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 1, "accepted_answer_id": 38048690, "answer_count": 1, "score": 1, "last_activity_date": 1467014504, "creation_date": 1467009846, "question_id": 38047415, "link": "https://stackoverflow.com/questions/38047415/how-does-ghc-resolve-paths-for-libraries", "title": "How does ghc resolve paths for libraries ?", "body": "<p>I'm starting to to use haskell with nixpkgs. From <a href=\"https://nixos.org/nixpkgs/manual/#how-to-install-a-compiler-with-libraries\" rel=\"nofollow\">the official guide to nixpkgs</a> I read: </p>\n\n<blockquote>\n  <p>GHC expects to find all installed libraries inside of its own lib directory. </p>\n</blockquote>\n\n<p>As it is stated it seems that it is saying that <em>ghc</em> require all the library to be installed in the same path. </p>\n\n<p>I thought that ghc was able to find out the path of libraries by looking at packages database configured through ghc-pkg.\nIf this is the case, it should be possible to put libraries under different \ndirectories in the filesystem and configuring the package-db to resolve these different paths. \nBut this would contradict what said in the above mentioned link, so what am I not getting?</p>\n\n<p>Thanks in advance for any answer.</p>\n"}, {"tags": ["haskell", "ghc", "cabal", "accelerate"], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 4661783, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bacb3e9406c0a0bf55575eb2ff6a12f9?s=128&d=identicon&r=PG&f=1", "display_name": "vivace", "link": "https://stackoverflow.com/users/4661783/vivace"}, "is_accepted": false, "score": 1, "last_activity_date": 1466998948, "creation_date": 1466998948, "answer_id": 38045584, "question_id": 38045511, "link": "https://stackoverflow.com/questions/38045511/cabal-install-accelerate-fails/38045584#38045584", "title": "cabal install accelerate fails", "body": "<p>it turned out that I just needed to </p>\n\n<pre><code>  $ ~ rm -rf .cabal\n  $ cabal install accelerate\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 4661783, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bacb3e9406c0a0bf55575eb2ff6a12f9?s=128&d=identicon&r=PG&f=1", "display_name": "vivace", "link": "https://stackoverflow.com/users/4661783/vivace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1466998948, "creation_date": 1466998469, "question_id": 38045511, "link": "https://stackoverflow.com/questions/38045511/cabal-install-accelerate-fails", "title": "cabal install accelerate fails", "body": "<p>The error is :</p>\n\n<pre><code>mtl-2.2.1 failed during the building phase. The exception was:\nExitFailure 1\nprimitive-0.6.1.0 failed during the building phase. The exception was:\nExitFailure 1\ntext-1.2.2.1 failed during the building phase. The exception was:\nExitFailure 1\nunordered-containers-0.2.7.1 depends on text-1.2.2.1 which failed to install.\nvector-0.11.0.0 depends on primitive-0.6.1.0 which failed to install.\n</code></pre>\n\n<p>running on ubuntu 14.04 cabal version 1.22.5.0 and ghc 8.0.1.</p>\n\n<p>initially i had the haskell-platform installed but then i was unable to use the accelerate-cuda package because, it is not updated for cuda 7. So i tried to update ghc and cabal which i seem to have managed to do, but not sure where to go from here. Do i need to upgrade my OS to ubuntu 16.04? Would really love to get this working...</p>\n"}, {"tags": ["haskell", "types", "typeclass", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 5, "last_activity_date": 1466995892, "last_edit_date": 1466995892, "creation_date": 1466995440, "answer_id": 38045186, "question_id": 38045091, "link": "https://stackoverflow.com/questions/38045091/inferring-type-class-constraint-when-using-associated-type-families/38045186#38045186", "title": "inferring type class constraint when using associated type families", "body": "<p>The crux of the problem is that given just a <code>FooT a</code>, you have nowhere to pull the <code>Eq</code> instance dictionary from.</p>\n\n<p>The workaround is to be explicit in your typeclass requirements, thereby having a place where the <code>Eq</code> dict is passed:</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving, UndecidableInstances #-}\n\ndata CantInferEq a = CantInferEq (FooT a)    \nderiving instance (Eq (FooT a)) =&gt; Eq (CantInferEq a)\n\ncantInferEq :: (Eq (FooT a)) =&gt; Proxy a -&gt; FooT a -&gt; FooT a -&gt; Bool\ncantInferEq _ x y = x == y\n</code></pre>\n\n<p>Or you can avoid having to use <code>UndecidableInstances</code> by packaging up the <code>Eq (FooT a)</code> dictionary with the <code>CantInferEq</code> constructor:</p>\n\n<pre><code>{-# LANGUAGE GADTs, StandaloneDeriving #-}\ndata CantInferEq a where\n    CantInferEq :: (Eq (FooT a)) =&gt; FooT a -&gt; CantInferEq a\nderiving instance Eq (CantInferEq a)\n</code></pre>\n"}], "owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 1, "accepted_answer_id": 38045186, "answer_count": 1, "score": 3, "last_activity_date": 1466995892, "creation_date": 1466994434, "last_edit_date": 1495541769, "question_id": 38045091, "link": "https://stackoverflow.com/questions/38045091/inferring-type-class-constraint-when-using-associated-type-families", "title": "inferring type class constraint when using associated type families", "body": "<p>I am aware that <a href=\"https://stackoverflow.com/questions/25219162/type-class-constraint-on-type-family-instances\">you can add constraints on associated type families and data families</a>. What this does is enforce the constraints on all <strong>instances</strong> of your class.</p>\n\n<p>But I can't figure out how to infer these constraints in <strong>instance derivation or function declarations</strong>. For example, this code fails to type check:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Data.Proxy ( Proxy )\n\nclass Eq (FooT a) =&gt; Foo a where\n    type FooT a :: *\n\n-- Can't infer it in an instance derivation\ndata CantInferEq a = CantInferEq (FooT a) deriving Eq\n\n-- Also can't infer it in a function declaration.\n-- The Proxy is there to avoid non-injectivity issues.\ncantInferEq :: Proxy a -&gt; FooT a -&gt; FooT a -&gt; Bool\ncantInferEq _ x y = x == y\n</code></pre>\n\n<p>the error messages are:</p>\n\n<pre><code>Test.hs:11:52: No instance for (Eq (FooT a)) \u2026\n      arising from the first field of \u2018CantInferEq\u2019 (type \u2018FooT a\u2019)\n    Possible fix:\n      use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (Eq (CantInferEq a))\n\nTest.hs:16:23: No instance for (Eq (FooT a)) arising from a use of \u2018==\u2019 \u2026\n    In the expression: x == y\n    In an equation for \u2018cantInferEq\u2019: cantInferEq _ x y = x == y\n\nCompilation failed.\n</code></pre>\n\n<p>What is going on here? Is there a workaround to get my desired behavior?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1466968023, "post_id": 38042061, "comment_id": 63524216, "body": "Are you asking how to define <code>(==)</code> with a custom function, or what custom function best suits your needs? The question is a bit bloated/confused as it stands now... btw, I don&#39;t think &quot;physical equality&quot; as you know it from other languages exists in haskell, you simply define your <code>class Eq a where (==) ....</code> and that&#39;s it..."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1466968113, "post_id": 38042061, "comment_id": 63524251, "body": "@mb21 He is either asking how to define an efficient instance for <code>Eq</code> or how to define a data structure for his DAG for which the default instance for <code>Eq</code> is efficient... not sure which one of the two, and given no code we can provide little help."}], "answers": [{"comments": [{"owner": {"reputation": 2425, "user_id": 2392147, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/09f00344014ef1858c322172cc0a1be3?s=128&d=identicon&r=PG&f=1", "display_name": "orm", "link": "https://stackoverflow.com/users/2392147/orm"}, "edited": false, "score": 0, "creation_date": 1466970068, "post_id": 38042434, "comment_id": 63524861, "body": "I see what you mean. I would like to be able to pattern match on a dag node (and say, its left child), to be able to apply transforms. How would you do that if the child has to be looked up in a vector?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2425, "user_id": 2392147, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/09f00344014ef1858c322172cc0a1be3?s=128&d=identicon&r=PG&f=1", "display_name": "orm", "link": "https://stackoverflow.com/users/2392147/orm"}, "edited": false, "score": 2, "creation_date": 1466970815, "post_id": 38042434, "comment_id": 63525104, "body": "@orm If you want to use a &quot;custom&quot; pattern matching mechanism, GHC offers <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#pattern-synonyms\" rel=\"nofollow noreferrer\">pattern synonyms</a>. It could take some effort for a beginner to define them, but once it&#39;s done, their usage is simple. If you happen to know Scala&#39;s extractor objects, they are (loosely) related."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 10, "last_activity_date": 1466969690, "creation_date": 1466969690, "answer_id": 38042434, "question_id": 38042061, "link": "https://stackoverflow.com/questions/38042061/eq-testing-for-large-dag-structures-in-haskell/38042434#38042434", "title": "Eq testing for large DAG structures in Haskell", "body": "<p>Part of the problem here is that Haskell has no concept of object identity, so when you say you have a DAG where you refer to the same node twice, as far as Haskell is concerned its just two values in different places on a tree. This is fundamentally different from the OO concept where an object is indexed by its location in memory, so the distinction between \"same object\" and \"different objects with equal fields\" is meaningful.</p>\n\n<p>To solve your problem you need to detect when you are visiting the same object that you saw earlier, and in order to do that you need to have a concept of \"same object\" that is independent of the value. There are two basic ways to attack this:</p>\n\n<ul>\n<li><p>Store all your objects in a vector (i.e. an array), and use the vector index as an object identity. Replace values with indices throughout your data structure.</p></li>\n<li><p>Give each object a unique \"identity\" field so you can tell if you have seen this one before when traversing the DAG.</p></li>\n</ul>\n\n<p>The former is how the <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Graph.html\" rel=\"noreferrer\">Data.Graph</a> module in the containers package does it. One advantage is that, if you have a single mapping from DAG to vector, then DAG equality becomes just vector equality.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1466971356, "creation_date": 1466971356, "answer_id": 38042676, "question_id": 38042061, "link": "https://stackoverflow.com/questions/38042061/eq-testing-for-large-dag-structures-in-haskell/38042676#38042676", "title": "Eq testing for large DAG structures in Haskell", "body": "<p>Any efficient way to test for equality will be intertwined with the way you build up the DAG values.  </p>\n\n<p>Here is an idea which keeps track of all nodes ever created in a Map.\nAs new nodes are added to the Map they are assigned a unique id.</p>\n\n<p>Creating nodes now becomes monadic as you have thread this Map\n(and the next available id) throughout your computation.</p>\n\n<p>In this example the nodes are implemented as Rose trees, and the\norder of the children is not significant - hence the call to\n<code>sort</code> in deriving the key into the map.</p>\n\n<pre><code> import Control.Monad.State\n import Data.List\n import qualified Data.Map as M\n\n data Node = Node { _eqIdent:: Int      -- equality identifier\n                  , _value :: String    -- value associated with the node\n                  , _children :: [Node] -- children\n                  }\n   deriving (Show)\n\n type BuildState = (Int, M.Map (String,[Int]) Node)\n\n buildNode :: String -&gt; [Node] -&gt; State BuildState Node\n buildNode value nodes = do\n   (nextid, nodeMap) &lt;- get\n   let key = (value, sort (map _eqIdent nodes))  -- the identity of the node\n   case M.lookup key nodeMap of\n     Nothing   -&gt; do let n = Node nextid value nodes\n                         nodeMap' = M.insert key n nodeMap\n                     put (nextid+1, nodeMap')\n                     return n\n     Just node -&gt; return node\n\n nodeEquality :: Node -&gt; Node -&gt; Bool\n nodeEquality a b = _eqIdent a == _eqIdent b\n</code></pre>\n\n<p>One caveat -- this approach requires that you know all the children of a node when you build it.</p>\n"}], "owner": {"reputation": 2425, "user_id": 2392147, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/09f00344014ef1858c322172cc0a1be3?s=128&d=identicon&r=PG&f=1", "display_name": "orm", "link": "https://stackoverflow.com/users/2392147/orm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1466971707, "creation_date": 1466967245, "last_edit_date": 1466971707, "question_id": 38042061, "link": "https://stackoverflow.com/questions/38042061/eq-testing-for-large-dag-structures-in-haskell", "title": "Eq testing for large DAG structures in Haskell", "body": "<p>I'm new to Haskell ( a couple of months ). I have a Haskell program that assembles a large expression DAG (not a tree, a DAG), potentially deep and with multiple merging paths (ie, the number of different paths from root to leaves is huge). I need a fast way to test these dags for equality.The default Eq derivation will just recurse, exploring the same nodes multiple times. Currently this causes my program to take 60 seconds for relatively small expressions, and not even finish for larger ones. The profiler indicates it is busy checking equality most of the time.  I would like to implement a custom Eq that does not have this problem.  I don't have a way to solve this problem that does not involve a lot of rewriting. So I want to hear your thoughts.  </p>\n\n<p>My first attempt was to 'instrument' tree nodes with  a hash that I compute incrementally, using <code>Data.Hashable.hash</code>, as I build the tree. This approach gave me an easy way to test two things aren't equal without looking deep into the structure. But often in this DAG, because of the paths in the DAG merging, the structures are indeed equal. So the hashes are equal, and I revert to full blown equality testing. </p>\n\n<p>If I had a way to do physical equality, then a lot of my problems here would go away: if they are physically equal, then that's it. Otherwise if the hash is different then that's it. Only go deeper if they are physically not the same, but their hash agrees. </p>\n\n<p>I could also imitate git, and compute a SHA1 per node to decide if they are equal period (no need to recurse).  I know for a fact that this would help, because If I let equality be decided fully in terms of hash equality, then the program runs in tens milliseconds for the largest expressions.  This approach also has the nice advantage that if for some reason there are two equal dags are not physically equal but are content-equal, I would be able to detect it fast in that case as well. (With Ids, Id still have to do a traversal at that point). So I like the semantics more. </p>\n\n<p>This approach, however involves a lot more work than just calling the <code>Data.Hashable.hash</code> function, because I have to derive it for every variant of the dag node type. And moreover, I have multiple dag representations,  with slightly different node definitions, so I would need to basically do this hashing trick thing twice or more if I decide to add more representations.</p>\n\n<p>What would you do?</p>\n"}, {"tags": ["haskell", "functional-programming", "immutability", "ghci"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 1, "creation_date": 1466959745, "post_id": 38040812, "comment_id": 63521512, "body": "that doesnt work in my rple..."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466959826, "post_id": 38040812, "comment_id": 63521543, "body": "Try to put <code>a = 1; a=2</code> inside a <code>.hs</code> file and compile it with <code>ghc</code>..."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 11, "creation_date": 1466960251, "post_id": 38040812, "comment_id": 63521677, "body": "GHCi commands are IO actions, so it&#39;s like if everything you type was inside a <code>do</code> block. Which means that subsequent assignment to the same name are like nested <code>let</code>s, you <i>shadow</i> the old binding."}, {"owner": {"reputation": 133, "user_id": 4671650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee50675971016f1ee0f70d582656f7a1?s=128&d=identicon&r=PG&f=1", "display_name": "yxw", "link": "https://stackoverflow.com/users/4671650/yxw"}, "edited": false, "score": 0, "creation_date": 1466960559, "post_id": 38040812, "comment_id": 63521802, "body": "Got it! Thank you. This confused me so much."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 7, "creation_date": 1466960939, "post_id": 38040812, "comment_id": 63521946, "body": "Also: try in GHCi (even in separate lines) <code>let a=4 ; let f x= x+a ; let a=0 ; f 2</code> and see <code>6</code> as an answer, confirming that the value of the old <code>a</code> was indeed not changed."}, {"owner": {"reputation": 32405, "user_id": 553209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCxak.jpg?s=128&g=1", "display_name": "Ankur", "link": "https://stackoverflow.com/users/553209/ankur"}, "edited": false, "score": 0, "creation_date": 1467106234, "post_id": 38040812, "comment_id": 63581832, "body": "Here is a way to overcome the confusion. Haskell doesn&#39;t have variables, only values."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466978779, "post_id": 38041231, "comment_id": 63527150, "body": "One thing missing: GHCi allows <code>data</code>, <code>newtype</code>, <code>type</code>, <code>class</code> and <code>instance</code> declarations, which are not allowed in Haskell <code>do</code> syntax."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1467025198, "post_id": 38041231, "comment_id": 63543085, "body": "Given that GHCi is an <i>interactive</i> environment it&#39;s an essential feature. how many times did it happen to mistype a definition? If everytime you do that you have to choose a completely new name you would easily end up with unreadable names like <code>myFunction7</code> where all previous definitiong of <code>myFunction</code> contain an error, and you have to remember to always add that <code>7</code> when using the correct definition..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1467026763, "post_id": 38041231, "comment_id": 63544000, "body": "Right. If that was required then we&#39;d need to adapt a completely different workflow, probably something with explicit scoping."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467334653, "post_id": 38041231, "comment_id": 63701953, "body": "GHCi&#39;s top level is really a lot more like ML&#39;s than like Haskell&#39;s, I think."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 23, "last_activity_date": 1466979231, "last_edit_date": 1466979231, "creation_date": 1466962334, "answer_id": 38041231, "question_id": 38040812, "link": "https://stackoverflow.com/questions/38040812/what-does-immutable-variable-in-haskell-mean/38041231#38041231", "title": "What does immutable variable in Haskell mean?", "body": "<p>Haskell doesn't allow you to modify existing variables. It does, however, allow you to <em>re-use variable names</em>, and that's all that's happening here. One way to see this is to ask GHCi, using the <code>:i[nfo]</code> directive, where the variable was declared:</p>\n\n<pre><code>Prelude&gt; let a = 1\nPrelude&gt; :i a\na :: Num a =&gt; a     -- Defined at &lt;interactive&gt;:2:5\nPrelude&gt; let a = 2\nPrelude&gt; :i a\na :: Num a =&gt; a     -- Defined at &lt;interactive&gt;:4:5\n</code></pre>\n\n<p>These are actually two entire seperate, different variables, which just happen to be called the same name! If you just ask for <code>a</code>, the newer definition will be &ldquo;preferred&rdquo;, but the old one is still there &ndash; one way to see this, as remarked by chi in the comments, is to use <code>a</code> in a function:</p>\n\n<pre><code>Prelude&gt; let a = 2\nPrelude&gt; :i a\na :: Num a =&gt; a     -- Defined at &lt;interactive&gt;:4:5\nPrelude&gt; let f x = a + x\nPrelude&gt; let a = 3\nPrelude&gt; f (-2)\n0\n</code></pre>\n\n<p><code>f</code> never needs to care that you've defined a new variable that's also called <code>a</code>; from its perspective <code>a</code> was one immutable variable that always stays as it is.</p>\n\n<hr>\n\n<p>It's worth talking a bit about why GHCi prefers the later definition. This does <strong>not</strong> otherwise happen in Haskell code; in particular if you try to compile the following module, it simply gives an error concerning duplicate definition:</p>\n\n<pre><code>a = 1\na = 2\n\nmain :: IO ()\nmain = print a\n</code></pre>\n\n<p>The reason that something like this is allowed in GHCi is that it works different from Haskell modules. The sequence of GHCi commands forms in fact a sequence of <em>actions in the IO monad</em><sup>&dagger;</sup>; i.e. the program would have to be</p>\n\n<pre><code>main :: IO ()\nmain = do\n   let a = 1\n   let a = 2\n   print a\n</code></pre>\n\n<p>Now, if you've learned about monads you'll know that this is just syntactic sugar for</p>\n\n<pre><code>main =\n   let a = 1 in (let a = 2 in (print a))\n</code></pre>\n\n<p>and this is really the crucial bit for why you can re-use the name <code>a</code>: the second one, <code>a = 2</code>, lives <em>in a narrower scope</em> than the first. So it is more local, and local definitions have priority. Whether this is a good idea is a bit debatable; a good argument for it is that you can have a function like</p>\n\n<pre><code>greet :: String -&gt; IO ()\ngreet name = putStrLn $ \"Hello, \"++name++\"!\"\n</code></pre>\n\n<p>and it won't stop working just because somebody defines elsewhere</p>\n\n<pre><code>name :: Car -&gt; String\nname car | rollsOverAtRightTurn car   = \"Reliant Robin\"\n         | fuelConsumption car &gt; 50*litrePer100km\n                                      = \"Hummer\"\n         | ...                        = ...\n</code></pre>\n\n<p>Besides, it's really quite useful that you can &ldquo;redefine&rdquo; variables while fooling around in GHCi, even though it's <em>not</em> such a good idea to redefine stuff in a proper program, which is supposed to show consistent behaviour.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>As dfeuer remarks, this is not the whole truth. You can do some things in GHCi that aren't allowed in an <code>IO</code> do-block, in particular you can define <code>data</code> types and <code>class</code>es. But any normal statement or variable definition act as it were in the <code>IO</code> monad.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 801, "user_id": 6428094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5c7d4a1af484f21012d000d133cf659?s=128&d=identicon&r=PG&f=1", "display_name": "FPstudent", "link": "https://stackoverflow.com/users/6428094/fpstudent"}, "is_accepted": false, "score": 2, "last_activity_date": 1467332251, "last_edit_date": 1467332251, "creation_date": 1467331850, "answer_id": 38135145, "question_id": 38040812, "link": "https://stackoverflow.com/questions/38040812/what-does-immutable-variable-in-haskell-mean/38135145#38135145", "title": "What does immutable variable in Haskell mean?", "body": "<p>(The other answer using GHCi is fine but to clarify it is not specific to GHCi or monads...)</p>\n\n<p>As you can see from the fact that the following Haskell program</p>\n\n<pre><code>main =\n  let x = 1 in\n  let f y = x + y in\n  let x = 2 in\n  print (x * f 3)\n</code></pre>\n\n<p>prints <code>8</code> rather than <code>10</code>, variables can only be \"bound\", not \"mutated\", in Haskell.  In other words, the program above is equivalent (called <em>\u03b1-equivalent</em>, meaning a consistent change of the names of bound variables only; see <a href=\"https://wiki.haskell.org/Alpha_conversion\" rel=\"nofollow\">https://wiki.haskell.org/Alpha_conversion</a> for more details) to</p>\n\n<pre><code>main =\n  let x1 = 1 in\n  let f y = x1 + y in\n  let x2 = 2 in\n  print (x2 + f 3)\n</code></pre>\n\n<p>where it is clear that <code>x1</code> and <code>x2</code> are different variables.</p>\n"}], "owner": {"reputation": 133, "user_id": 4671650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee50675971016f1ee0f70d582656f7a1?s=128&d=identicon&r=PG&f=1", "display_name": "yxw", "link": "https://stackoverflow.com/users/4671650/yxw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1700, "favorite_count": 2, "accepted_answer_id": 38041231, "answer_count": 2, "score": 13, "last_activity_date": 1467332251, "creation_date": 1466959557, "last_edit_date": 1466968817, "question_id": 38040812, "link": "https://stackoverflow.com/questions/38040812/what-does-immutable-variable-in-haskell-mean", "title": "What does immutable variable in Haskell mean?", "body": "<p>I am quite confused with the concept of immutable variables in Haskell. It seems like that we can't change the value of variables in Haskell. But when I tried following code in GHCI, it seemed like the value of variables did change:</p>\n\n<pre><code>Prelude&gt; foo x=x+1\nPrelude&gt; a=1\nPrelude&gt; a\n1\nPrelude&gt; foo a\n2\nPrelude&gt; a=2\nPrelude&gt; a\n2\nPrelude&gt; foo a\n3\n</code></pre>\n\n<p>Does this conflict with the idea of immutable variables?</p>\n\n<p>Many thanks!</p>\n"}, {"tags": ["swift", "haskell", "recursion", "functional-programming", "compiler-optimization"], "comments": [{"owner": {"reputation": 45896, "user_id": 2442804, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/wBmyS.jpg?s=128&g=1", "display_name": "luk2302", "link": "https://stackoverflow.com/users/2442804/luk2302"}, "edited": false, "score": 3, "creation_date": 1466955690, "post_id": 38040127, "comment_id": 63520205, "body": "I highly doubt it - much of the optimization that haskell is able to do is based on its &quot;lack&quot; of side-effects. Swift has side effects, it has variables, it has state, etc."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1466956289, "post_id": 38040127, "comment_id": 63520404, "body": "Replace <code>filterPositives</code> with a function that also increases a global counter and change <code>allSquareRoots</code> to compute something that depends on such global counter. In this case it&#39;s not possible a single traversal version. So: it <b>cannot</b> in the general case, and <i>probably doesn&#39;t</i> even when those functions are simple pure functions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1466961148, "post_id": 38040127, "comment_id": 63522017, "body": "Maybe Swift has some &quot;generator objects&quot;/&quot;streams&quot;/.., which can produce a value one-at-a-time, so that you can get a single pass if you code using these generators. It will not be as optimized as with fusion, but at least it&#39;s single pass."}], "owner": {"reputation": 3150, "user_id": 3443275, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Q4viU.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3443275/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1466955271, "creation_date": 1466955271, "question_id": 38040127, "link": "https://stackoverflow.com/questions/38040127/swift-compiler-recursive-code-optimisations-similar-to-haskell", "title": "Swift compiler recursive code optimisations (similar to Haskell)", "body": "<p>Does the Swift compiler use fusion to optimise code? </p>\n\n<p>Let's say we want to write code to calculate the sum of the square roots of all positive numbers in a list. In Haskell you can write</p>\n\n<pre><code>sumOfSquareRoots xs = sum (allSquareRoots (filterPositives xs))\n  where\n    allSquareRoots []     = []\n    allSquareRoots (x:xs) = sqrt x : allSquareRoots xs\n\n    filterPositives [] \n      = []\n    filterPositives (x:xs)\n      | x &gt; 0     = x : filterPositives xs\n      | otherwise = filterPositives xs\n</code></pre>\n\n<p>This code is quite easy to read (the first line is very neat - almost English; the parts after the <code>where</code> are local.) This style also makes use of powerful built-in functions such as <code>sum</code> and we could make the other functions public and have them reused. So, good style. </p>\n\n<p>However, we might be concerned that it is less efficient than having a one-pass function. (It pass through the list first to filterPositives then to get allSquareRoots of this and finally to sum this up.) Due to Haskell's, so-called, <em>lazy evaluation</em> execution strategy, however, the overhead is significantly less than in most other languages. Moreover, a good Haskell compiler can usually derive the one traversal version from the more elegant multiple traversal version using a process called <em>fusion</em>.</p>\n\n<p>My question - does the Swift compiler deploy such optimisation strategies when compiling recursive functions?</p>\n"}, {"tags": ["haskell", "recursion", "optimization", "spineless-tagless-graph"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466928288, "post_id": 38035639, "comment_id": 63512678, "body": "Not sure if relevant, but GHC moved from the push/enter evaluation model to the eval/apply one a few years ago because the latter started to become more performant. This changed the calling conventions significantly. I have no precise idea about whether TCO is used right now in GHC, though."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1466935109, "post_id": 38035639, "comment_id": 63514302, "body": "Of course TCO is still used."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466945569, "post_id": 38035639, "comment_id": 63517187, "body": "Thanks @chi - could expand on the implications of that change?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466959063, "post_id": 38035639, "comment_id": 63521294, "body": "I can&#39;t really recommend anything but checking the <a href=\"http://community.haskell.org/~simonmar/papers/evalapplyjfp06.pdf\" rel=\"nofollow noreferrer\">Making a fast curry</a> paper, and possibly a few more..."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1467808167, "post_id": 38035639, "comment_id": 63869992, "body": "Cool - can you expand that into an answer?"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1466945513, "creation_date": 1466920658, "last_edit_date": 1495542166, "question_id": 38035639, "link": "https://stackoverflow.com/questions/38035639/are-the-haskell-options-for-tail-call-optimisation-indicative-of-the-spineless-t", "title": "Are the Haskell options for Tail Call Optimisation indicative of the Spineless Tagless Graph-Machine?", "body": "<p>One of the amazing things about <a href=\"https://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler\" rel=\"nofollow noreferrer\">Haskell</a> is the <a href=\"http://webcache.googleusercontent.com/search?q=cache:VE05oXnwu4AJ:research.microsoft.com/jump/67083+&amp;cd=2&amp;hl=en&amp;ct=clnk&amp;gl=au\" rel=\"nofollow noreferrer\">Spineless Tagless Graph Machine</a> (STG). At the time, (according to <a href=\"https://en.wikipedia.org/wiki/Simon_Peyton_Jones\" rel=\"nofollow noreferrer\">SPJ</a>) it was written to <a href=\"https://www.youtube.com/watch?v=xmjvOLlCdFU\" rel=\"nofollow noreferrer\">enable the laziness that enabled functional programming to work on the limited hardware of the time</a>. Subsequently it has been shown to <a href=\"http://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf\" rel=\"nofollow noreferrer\">have any additional benefits for functional programming</a>. </p>\n\n<p>When we see languages like <a href=\"https://en.wikipedia.org/wiki/Scheme_(programming_language)\" rel=\"nofollow noreferrer\">Scheme</a> - <a href=\"https://en.wikipedia.org/wiki/Recursion_(computer_science)\" rel=\"nofollow noreferrer\">recursion</a> features prominently (as it does in Haskell). Part of what makes this <a href=\"http://c2.com/cgi/wiki?TailCallOptimization\" rel=\"nofollow noreferrer\">particularly effective</a> is the feature known as <a href=\"https://en.wikipedia.org/wiki/Tail_call\" rel=\"nofollow noreferrer\">Tail Call Elimination</a>. The reason you want Tail Call Elimination is because if a function calls itself 1000's of times, it can blow the stack, even stackoverflow. [sic]  </p>\n\n<p>Now <a href=\"https://wiki.haskell.org/Performance/GHC#Use_optimisation\" rel=\"nofollow noreferrer\">Haskell has some interesting options</a> for <a href=\"https://stackoverflow.com/questions/13042353/does-haskell-have-tail-recursive-optimization\">Tail Call Elimination</a>. What <a href=\"https://stackoverflow.com/a/13052612/15441\">we see is that</a>: </p>\n\n<blockquote>\n  <p>Haskell's recursive functions aren't evaluated in a very recursive way! The only stack of calls hanging around are the multiplications themselves. If  (*) is viewed as a strict data constructor, this is what's known as guarded recursion (although it is usually referred to as such with non-strict data constructors, where what's left in its wake are the data constructors - when forced by further access).</p>\n</blockquote>\n\n<p>My question is: <strong>Are the Haskell options for Tail Call Optimisation indicative of the Spineless Tagless Graph-machine?</strong></p>\n"}, {"tags": ["haskell", "dictionary", "hashtable"], "comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 2, "creation_date": 1466921827, "post_id": 38035635, "comment_id": 63511465, "body": "I&#39;m not quite sure what you&#39;re asking: (1) Are you concerned specifically with hash tables or with any key-value dictionaries/maps?  (<code>Data.Map</code> is a dictionary but not a hash table.)  (2) Are you asking whether you can have a hash table of hash tables?  (3) Are you asking whether you can have a &quot;heterogeneous&quot; hash table \u2013 one which maps different types of keys to different types of values?  (4) How do tuples fit in to this?  They&#39;re very different from hash tables/dictionaries."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1466940914, "post_id": 38035635, "comment_id": 63515922, "body": "yes to 1. and 2. if you&#39;re talking about <code>Map k a</code>, you&#39;ll have to <a href=\"http://learnyouahaskell.com/types-and-typeclasses\" rel=\"nofollow noreferrer\">read up on typeclasses</a> to instantiate <code>k</code> and <code>a</code> with what you want..."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1466945052, "post_id": 38035635, "comment_id": 63517034, "body": "Okay, <b>how</b> did you research <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map-Lazy.html#t:Map\" rel=\"nofollow noreferrer\"><code>Data.Map</code></a> and say &quot;I can not do that&quot;? The type is <code>Map k v</code> where you can already see that the type for the <code>k</code>eys is different than the one for the <code>v</code>alues, so answer to 2 is yes. Also there is no restriction over what <code>v</code> can be so it can be <code>Map k&#39; v&#39;</code> as in <code>Map k (Map k&#39; v&#39;)</code> which is a yes to question 1."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1466974326, "creation_date": 1466974326, "answer_id": 38043069, "question_id": 38035635, "link": "https://stackoverflow.com/questions/38035635/haskell-hashtable-in-hashtable/38043069#38043069", "title": "haskell hashtable in hashtable?", "body": "<blockquote>\n  <p>can I create hashtable in side hashtable? Meaning, use a hashtable as the value of a hashtable.</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<blockquote>\n  <p>Can a hashtable has different type of key and value pair?</p>\n</blockquote>\n\n<p>In any given hash table, all keys must have the same type, and all values must have the same type, but the keys may have different types than the values.</p>\n"}], "owner": {"reputation": 431, "user_id": 2494308, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bb275bbce79ac1fe4761d87d2c355921?s=128&d=identicon&r=PG", "display_name": "Max Li", "link": "https://stackoverflow.com/users/2494308/max-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1466974326, "creation_date": 1466920554, "question_id": 38035635, "link": "https://stackoverflow.com/questions/38035635/haskell-hashtable-in-hashtable", "title": "haskell hashtable in hashtable?", "body": "<p>I have two questions regarding hashtable implementation in haskell:</p>\n\n<ol>\n<li><p>can I create hashtable in side hashtable? Meaning, use a hashtable as the value of a hashtable.</p></li>\n<li><p>Can a hashtable has different type of key and value pair? </p></li>\n</ol>\n\n<p>I did research on Data.Map and Data.HashTable. It seems I can not do that.\nThe only possible tool is Data.Tuple seems like.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "reader-monad"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466922167, "post_id": 38035534, "comment_id": 63511511, "body": "It would help if you included your imports."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466939150, "post_id": 38036014, "comment_id": 63515424, "body": "Thanks @ErikR. What if I want to do this <i>without</i> using the regular ReaderT monad? Is my approach completely unworkable? Any help with completing the approach that I was following above?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466939554, "post_id": 38036014, "comment_id": 63515535, "body": "Conceptually does this work on the basis of which type of environment is being asked? If it&#39;s a <code>String</code> let the outer modad (or is it inner?) handle it, if it&#39;s <code>Int</code> let the inner monad (or is it outer?) handle it. It seems like this should be categorised as an anti-pattern or code-smell. Something doesn&#39;t seem right to me over here. What do you think about using the approach given at <a href=\"http://lexi-lambda.github.io/blog/2016/06/12/four-months-with-haskell/\" rel=\"nofollow noreferrer\">lexi-lambda.github.io/blog/2016/06/12/four-months-with-haske&zwnj;&#8203;ll</a> ?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466950984, "post_id": 38036014, "comment_id": 63518632, "body": "Answer updated. You can create your own monad if you want, but you don&#39;t have to just because you want to create a ReaderT on top of another ReaderT."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466956579, "post_id": 38036014, "comment_id": 63520501, "body": "Thanks ErikR for clarifying again. While this gives me a working solution, it doesn&#39;t help me understand how this is really working. And something about nested ReaderT&#39;s along with chained lift&#39;s don&#39;t make this seem like an elegant solution. Can&#39;t one &quot;extend&quot; a single monad (probably using typeclasses) to &quot;add more&quot; functionality to it? (Is this even making sense?)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466960226, "post_id": 38036014, "comment_id": 63521671, "body": "I think I&#39;ve answered your original question. If you need more help understanding how <code>lift</code> works (in the <code>mtl</code> library) please open up a new question."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466962468, "post_id": 38036014, "comment_id": 63522425, "body": "For what it\u2019s worth, @SaurabhNanda, I am the author of that blog post, and our app\u2019s monad looks basically like <code>newtype AppM a = AppM (ReaderT Config IO a)</code>, where <code>Config</code> is a record containing our application\u2019s configuration, and we derive <code>MonadIO</code> and <code>MonadReader</code> using GND. Then, in the typeclass implementation, we just use <code>asks</code> and <code>liftIO</code> to implement the individual typeclasses, just like in this answer."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466972623, "post_id": 38036014, "comment_id": 63525615, "body": "Thanks for helping me out!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1466950632, "last_edit_date": 1466950632, "creation_date": 1466924698, "answer_id": 38036014, "question_id": 38035534, "link": "https://stackoverflow.com/questions/38035534/how-to-build-a-custom-reader-monad-along-with-a-custom-typeclass/38036014#38036014", "title": "How to build a custom reader monad along with a custom typeclass?", "body": "<p>Here's some code which shows how to work with multiple Reader environments in the same transformer stack. Here <code>BaseMonad</code> is like your <code>SqlPersistT</code>:</p>\n\n<pre><code>import Control.Monad.Reader\nimport Control.Monad.State\nimport Control.Monad.IO.Class\n\ntype BaseMonad = ReaderT String IO\n\ntype NwMonad = ReaderT Int BaseMonad\n\naskString :: NwMonad String\naskString =  lift ask\n\naskInt :: NwMonad Int\naskInt = ask\n\nstartAria :: NwMonad ()\nstartAria = do\n  i &lt;- askInt\n  s &lt;- askString\n  liftIO $ putStrLn $ \"i: \" ++ show i ++ \" s: \" ++ s\n\nmain = do\n  let cfg = 10       -- i.e. your google client data\n      s = \"asd\"      -- whatever is needed for SqlPersistT\n  runReaderT (runReaderT startAria cfg) s\n</code></pre>\n\n<p>Here's some code using the SqlPersisT type and runSqlConn:</p>\n\n<pre><code>import Control.Monad.Reader\nimport Control.Monad.State\nimport Control.Monad.IO.Class\nimport Database.Persist.Sql\n\ndata Config = Config { _clientId :: String }\n\ntype BaseMonad = SqlPersistT IO\n\ntype NwMonad = ReaderT Config BaseMonad\n\naskBackend:: NwMonad SqlBackend\naskBackend =  lift ask\n\naskConfig :: NwMonad Config\naskConfig = ask\n\nstartAria :: NwMonad ()\nstartAria = do\n  cfg &lt;- askConfig\n  liftIO $ putStrLn $ \"client id: \" ++ (_clientId cfg)\n\nmain = do\n  let cfg = Config \"foobar\"\n      backend = undefined :: SqlBackend -- however you get this\n      sqlComputation = runReaderT startAria cfg :: SqlPersistT IO ()\n  runSqlConn sqlComputation backend :: IO ()\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>The type of the environment doesn't matter.</p>\n\n<pre><code>import Control.Monad.Reader\nimport Control.Monad.IO.Class\n\ntype Level1  =  ReaderT Int IO\ntype Level2  =  ReaderT Int Level1\ntype Level3  =  ReaderT Int Level2\n\nask3 :: Level3 Int\nask3 = ask\n\nask2 :: Level3 Int\nask2 =  lift ask\n\nask1 :: Level3 Int\nask1 =  lift $ lift $ ask\n\ndoit :: Level3 ()\ndoit = do\n  r1 &lt;- ask1\n  r2 &lt;- ask2\n  r3 &lt;- ask3\n  liftIO $ print (r1, r2, r3)\n\nmain = do\n  runReaderT (runReaderT (runReaderT doit 333) 222) 111\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 0, "accepted_answer_id": 38036014, "answer_count": 1, "score": 1, "last_activity_date": 1466950632, "creation_date": 1466919208, "question_id": 38035534, "link": "https://stackoverflow.com/questions/38035534/how-to-build-a-custom-reader-monad-along-with-a-custom-typeclass", "title": "How to build a custom reader monad along with a custom typeclass?", "body": "<p>I'm trying to marry the approach given at <a href=\"http://lexi-lambda.github.io/blog/2016/06/12/four-months-with-haskell/\" rel=\"nofollow\">http://lexi-lambda.github.io/blog/2016/06/12/four-months-with-haskell/</a> (section titled \"Typeclasses can emulate effects\") with some sort of homegrown reader monad. </p>\n\n<p>The overall problem I'm trying to solve is to avoid passing around a configuration variable to almost ever function in my app. And the reason I can't use a <code>ReaderT</code> is because a lot of my functions are in <code>SqlPersistT</code>, which itself uses a <code>ReaderT</code> internally. The other reason is to learn all this mental gymnastics better.</p>\n\n<p>My two questions are given as comments in the code below. Reproducing them here as well:</p>\n\n<ul>\n<li>What is the most appropriate way to define <code>NwMonad</code>?</li>\n<li>Consequently, how do define <code>NwMonad</code> as an instance of <code>HasNwConfig</code>? How to write the function body of <code>askNwConfig</code>?</li>\n<li>How do I finally call <code>runNwMonad</code>? What will be its arguments?</li>\n</ul>\n\n<p>Here's the code:</p>\n\n<pre><code>data NwConfig = NwConfig {\n  _googleClientId :: T.Text,\n  _googleClientSecret :: T.Text,\n  _tgramBotToken :: String,\n  _aria2Command :: String,\n  _aria2DownloadDir :: String\n  }\n$(makeLenses ''NwConfig)\n\ninstance Default NwConfig where\n  def = NwConfig{}\n\nclass MonadIO m =&gt; HasNwConfig m where\n  askNwConfig :: m NwConfig\n\nstartAria2 :: (HasNwConfig m) =&gt; m Sytem.Process.ProcessHandle\n  cfg &lt;- askNwConfig\n  (_, _, _, processHandle) &lt;- createProcess $ proc (cfg ^. aria2Command) []\nreturn processHandle\n\n\n-- QUESTION: Is this correct?\ndata NwMonad a = NwMonad{runNwMonad :: (NwConfig -&gt; IO a)}\n               deriving (Functor, Applicative, Monad, MonadIO)\n\n-- Or is this the way to do it?\ndata NwMonad a = NwMonad{runNwMonad :: IO a, nwConfig :: NwConfig}\n               deriving (Functor, Applicative, Monad, MonadIO)\n\ninstance HasNwConfig NwMonad where\n  askNwConfig = return . nwConfig -- QUESTION: How to write this?\n\nmain :: IO ()\nmain = do\n  [cId, cSecret, botToken] &lt;- sequence [getEnv \"GOOGLE_CLIENT_ID\", getEnv \"GOOGLE_CLIENT_SECRET\", getEnv \"TELEGRAM_TOKEN\"]\n  let cfg = (def :: NwConfig)\n        &amp; googleClientId .~ (T.pack cId)\n        &amp; googleClientSecret .~ (T.pack cSecret)\n        &amp; tgramBotToken .~ botToken\n        &amp; aria2Command .~ \"/Users/saurabhnanda/projects/nightwatch/aria2-1.19.3/bin/aria2c\"\n  -- QUESTION: How do I use this now?\n  runNwMonad $ (?????) $ startAria2\n</code></pre>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1466929019, "creation_date": 1466929019, "answer_id": 38036526, "question_id": 38034583, "link": "https://stackoverflow.com/questions/38034583/reducing-over-monads-in-haskell/38036526#38036526", "title": "Reducing over Monads in Haskell", "body": "<p>We can not compose <code>[Node]</code> with the proposed types. This is because otherwise we would get</p>\n\n<pre><code>sw1 :: SimpleWire A B\nsw2 :: SimpleWire C D\nbuildGraph :: [Node] -&gt; (SimpleWire a b)\nbuildGraph [ sw1, sw2 ] :: SimpleWire E F\n</code></pre>\n\n<p>Which is way too strong. We were able to compose arbitrary, incompatible types (wrong), and then to result with a random write at the very end (wrong).</p>\n\n<p>The problem is that we lost all the type information in the <code>[Node]</code> type. We need to remember some, namely:</p>\n\n<ol>\n<li>The first and last wire types are known (the intermediate ones are not)</li>\n<li>In the list, every adjacent node is composable</li>\n</ol>\n\n<p>So, we get a custom GADT list type</p>\n\n<pre><code>data NodeList a b where\n   Nil  :: NodeList a a\n   Cons :: Node a b -&gt; NodeList b c -&gt; NodeList a c\n</code></pre>\n\n<p>And then</p>\n\n<pre><code>buildGraph :: NodeList a b -&gt; SimpleWire a b\nbuildGraph Nil = id  \nbuildGraph (Cons (Node h) t) = h . buildGraph t\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": true, "score": 6, "last_activity_date": 1466929453, "creation_date": 1466929453, "answer_id": 38036577, "question_id": 38034583, "link": "https://stackoverflow.com/questions/38034583/reducing-over-monads-in-haskell/38036577#38036577", "title": "Reducing over Monads in Haskell", "body": "<p>I'm going to assume the following story:</p>\n\n<p>You probably used the type</p>\n\n<pre><code>data Node = forall a b. Node (SimpleWire a b)\n</code></pre>\n\n<p>instead of just <code>SimpleWire a b</code> because you wanted a list of <code>SimpleWire</code>'s where <code>a</code> and <code>b</code> are different. In particular, what you were really hoping for as the argument to <code>buildGraph</code> was something like (in pseudo-Haskell)</p>\n\n<pre><code>buildGraph :: [SimpleWire a b, SimpleWire b c, ..., SimpleWire x y] -&gt; SimpleWire a y\n</code></pre>\n\n<p>You couldn't express that first list with Haskell's standard homogeneous <code>[]</code> though and tried to use universally-quantified types to get you out of that pickle.</p>\n\n<p>If what I've said is true, you're probably looking for <a href=\"https://hackage.haskell.org/package/thrist-0.3.0.2\">type-threaded lists or \"thrists\"</a>. In particular, you can do away with <code>Node</code> altogether. A <code>Thrist (-&gt;) a b</code> is a list of functions <code>a -&gt; a1</code>, <code>a1 -&gt; a2</code>, ..., <code>an -&gt; b</code>. More generally a <code>Thrist f a b</code> is a list of <code>f</code>s <code>f a a1</code>, <code>f a1 a2</code>, ..., <code>f an b</code>.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\nimport qualified Data.Thrist as DT\n\n-- Note that I'll be using (&gt;&gt;&gt;) as a flipped form of (.), i.e. \n-- (&gt;&gt;&gt;) = flip (.)\n-- (&gt;&gt;&gt;) is in fact an Arrow operation which is significantly more general\n-- than function composition. Indeed your `SimpleWire` type is almost\n-- definitely an arrow.\nimport Control.Arrow ((&gt;&gt;&gt;))\n\n-- A simple take on SimpleWire\ntype SimpleWire = (-&gt;)\n\n-- Ugh a partial function that blows up if the thrist is empty\nunsafeBuildGraph :: DT.Thrist SimpleWire a b -&gt; SimpleWire a b\nunsafeBuildGraph = DT.foldl1Thrist (&gt;&gt;&gt;)\n\n-- Making it total\nbuildGraph :: DT.Thrist SimpleWire a b -&gt; Maybe (SimpleWire a b)\nbuildGraph DT.Nil = Nothing\nbuildGraph (wire `DT.Cons` rest) = Just $ DT.foldlThrist (&gt;&gt;&gt;) wire rest\n\n-- For syntactic sugar\n(*::*) = DT.Cons\ninfixr 6 *::*\n\ntrivialExample :: DT.Thrist SimpleWire a a\ntrivialExample = id *::* id *::* DT.Nil\n\nlessTrivialExample :: (Num a, Show a) =&gt; DT.Thrist SimpleWire a String\nlessTrivialExample = (+ 1) *::* (* 2) *::* show *::* DT.Nil\n\n-- result0 is \"12\"\nresult0 = (unsafeBuildGraph lessTrivialExample) 5\n\n-- result1 is Just \"12\"\nresult1 = fmap ($ 5) (buildGraph lessTrivialExample)\n</code></pre>\n\n<p>A side note:</p>\n\n<p>Although <code>SimpleWire</code> may very well be a monad, that's probably not going to directly help you. In particular while functions are monads, what you seem to care about is generalizing over the notion of function composition, which is what <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_arrows\">arrows</a> are for (and which bear only an indirect relationship to monads). There are hints of this in the fact that I used <code>&gt;&gt;&gt;</code> and that <code>Thrist</code> has an <code>Arrow</code> instance. As I mention in the comments to the code, <code>SimpleWire</code> is probably an <code>Arrow</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 3145241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GJnVw.jpg?s=128&g=1", "display_name": "sorpaas", "link": "https://stackoverflow.com/users/3145241/sorpaas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 38036577, "answer_count": 2, "score": 2, "last_activity_date": 1466929453, "creation_date": 1466906314, "question_id": 38034583, "link": "https://stackoverflow.com/questions/38034583/reducing-over-monads-in-haskell", "title": "Reducing over Monads in Haskell", "body": "<p>Suppose I have a type defined as:</p>\n\n<pre><code>data Node = forall a b. Node (SimpleWire a b)\n</code></pre>\n\n<p>The <code>SimpleWire</code> is a monad, where <code>a</code> represents the inputs, and <code>b</code> represents the outputs. I can do function commposition over that monad. So suppose I have <code>wireA</code> of type <code>SimpleWire A B</code>, and <code>wireB</code> of type <code>SimpleWire B C</code>, doing <code>wireA . wireB</code> would give me the type <code>SimpleWire A C</code>.</p>\n\n<p>Now I want to fold over a list of that monad (so of type <code>[Node]</code> for this case). Something like:</p>\n\n<pre><code>buildGraph :: [Node] -&gt; (SimpleWire a b)\nbuildGraph (Node h):t = h . (buildGraph t)\n</code></pre>\n\n<p>How do I make this code work in Haskell's type system?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 2, "creation_date": 1466903544, "post_id": 38034077, "comment_id": 63508794, "body": "First result on Google for &quot;contravariant functor example&quot;: <a href=\"https://ocharles.org.uk/blog/guest-posts/2013-12-21-24-days-of-hackage-contravariant.html\" rel=\"nofollow noreferrer\">a blog post about the <code>contravariant</code> package by Tom Ellis on Oliver Charles&#39; website</a>, which describes both a trivial example and a more elaborate and useful example of a contravariant functor."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 15, "last_activity_date": 1472159877, "last_edit_date": 1472159877, "creation_date": 1466916343, "answer_id": 38035291, "question_id": 38034077, "link": "https://stackoverflow.com/questions/38034077/what-is-a-contravariant-functor/38035291#38035291", "title": "What is a contravariant functor?", "body": "<h2>First, a note about our friend, the Functor class</h2>\n\n<p>You can think of <code>Functor f</code> as an assertion that <code>a</code> never appears in the \"negative position\". This is an esoteric term for this idea: Notice that in the following datatypes the <code>a</code> appears to act as a \"result\" variable.</p>\n\n<ul>\n<li><p><code>newtype IO a = IO (World -&gt; (World, a))</code></p></li>\n<li><p><code>newtype Identity a = Identity a</code></p></li>\n<li><p><code>newtype List a = List (forall r. r -&gt; (a -&gt; List a -&gt; r) -&gt; r)</code></p></li>\n</ul>\n\n<p>In each of these examples <code>a</code> appears in a positive position. In some sense the <code>a</code> for each type represents the \"result\" of a function. It might help to think of <code>a</code> in the second example as <code>() -&gt; a</code>. And it might help to remember that third example is equivalent to <code>data List a = Nil | Cons a (List a)</code>. In callbacks like <code>a -&gt; List -&gt; r</code> the <code>a</code> appears in the negative position but the <em>callback itself</em> is in the negative position so negative and negative multiply to be positive.</p>\n\n<p>This scheme for signing the parameters of a function is <a href=\"https://www.schoolofhaskell.com/user/commercial/content/covariance-contravariance\" rel=\"noreferrer\">elaborated in this wonderful blog post</a>.</p>\n\n<p>Now note that each of these types admit a <code>Functor</code>. That is no mistake! Functors are meant to model the idea of categorical covariant functors, which \"preserve the order of the arrows\" i.e. <code>f a -&gt; f b</code> as opposed to <code>f b -&gt; f a</code>. In Haskell, types where <code>a</code> never appears in a negative position always admit <code>Functor</code>. We say these types are covariant on <code>a</code>.</p>\n\n<p>To put it another way, one could validly rename the <code>Functor</code> class to be <code>Covariant</code>. They are one and the same idea.</p>\n\n<p>The reason this idea is worded so strangely with the word \"never\" is that <code>a</code> can appear in both a positive and negative location, in which case we say the type is invariant on <code>a</code>. <code>a</code> can also never appear (such as a phantom type), in which case we say the type is both covariant and contravariant on <code>a</code> \u2013 bivariant.</p>\n\n<h2>Back to Contravariant</h2>\n\n<p>So for types where <code>a</code> never appears in the positive position we say the type is contravariant in <code>a</code>. Every such type <code>Foo a</code> will admit an <code>instance Contravariant Foo</code>. Here are some examples, taken from the <code>contravariant</code> package:</p>\n\n<ul>\n<li><code>data Void a</code>(<code>a</code> is phantom)</li>\n<li><code>data Unit a = Unit</code> (<code>a</code> is phantom again)</li>\n<li><code>newtype Const constant a = Const constant</code></li>\n<li><code>newtype WriteOnlyStateVariable a = WriteOnlyStateVariable (a -&gt; IO ())</code></li>\n<li><code>newtype Predicate a = Predicate (a -&gt; Bool)</code></li>\n<li><code>newtype Equivalence a = Equivalence (a -&gt; a -&gt; Bool)</code></li>\n</ul>\n\n<p>In these examples <code>a</code> is either bivariant or merely contravariant. <code>a</code> either never appears or is negative (in these contrived examples <code>a</code> always appears before an arrow so determining this is extra-simple). As a result, each of these types admit an <code>instance Contravariant</code>.</p>\n\n<p>A more intuitive exercise would be to squint at these types (which exhibit contravariance) and then squint at the types above (which exhibit covariance) and see if you can intuit a difference in the semantic meaning of <code>a</code>. Maybe that is helpful, or maybe it is just still abstruse sleight of hand.</p>\n\n<p>When might these be practically useful? Let us for example want to partition a list of cookies by what kind of chips they have. We have a <code>chipEquality :: Chip -&gt; Chip -&gt; Bool</code>. To obtain a <code>Cookie -&gt; Cookie -&gt; Bool</code>, we simply evaluate <code>runEquivalence . contramap cookie2chip . Equivalence $ chipEquality</code>.</p>\n\n<p>Pretty verbose! But solving the problem of newtype-induced verbosity will have to be another question...</p>\n\n<h2>Other resources (add links here as you find them)</h2>\n\n<ul>\n<li><p><a href=\"https://ocharles.org.uk/blog/guest-posts/2013-12-21-24-days-of-hackage-contravariant.html\" rel=\"noreferrer\">24 Days of Hackage: contravariant</a></p></li>\n<li><p><a href=\"https://www.schoolofhaskell.com/user/commercial/content/covariance-contravariance\" rel=\"noreferrer\">Covariance, contravariance, and positive and negative positions</a></p></li>\n<li><p><a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/profunctors\" rel=\"noreferrer\">I love profunctors</a></p></li>\n<li><p><a href=\"https://www.youtube.com/watch?v=OJtGECfksds\" rel=\"noreferrer\">Talk: Fun with Profunctors</a>: I cannot overstate how great this talk is</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1466986235, "post_id": 38038041, "comment_id": 63528538, "body": "This would be even better with actual images; the ascii-art diagrams get a bit hard to read at the end."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1466986742, "post_id": 38038041, "comment_id": 63528621, "body": "I agree, I&#39;ll add pictures, when I can, could take some time (current workload is high)"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 17, "last_activity_date": 1533978621, "last_edit_date": 1533978621, "creation_date": 1466940446, "answer_id": 38038041, "question_id": 38034077, "link": "https://stackoverflow.com/questions/38034077/what-is-a-contravariant-functor/38038041#38038041", "title": "What is a contravariant functor?", "body": "<p>First of all @haoformayor's answer is excellent so consider this more an addendum than a full answer.</p>\n\n<h2>Definition</h2>\n\n<p>One way I like to think about Functor (co/contravariant) is in terms of diagrams. The definition is reflected in the following ones. (I am abbreviating <code>contramap</code> with <code>cmap</code>)</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>      covariant                           contravariant\nf a \u2500\u2500\u2500 fmap \u03c6 \u2500\u2500\u2500\u25b6 f b             g a \u25c0\u2500\u2500\u2500 cmap \u03c6 \u2500\u2500\u2500 g b\n \u25b2                   \u25b2               \u25b2                   \u25b2\n \u2502                   \u2502               \u2502                   \u2502\n \u2502                   \u2502               \u2502                   \u2502\n a \u2500\u2500\u2500\u2500\u2500\u2500 \u03c6 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 b               a \u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u03c6 \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 b\n</code></pre>\n\n<p>Note: that the only change in those two definition is the arrow on top, (well and the names so I can refer to them as different things).</p>\n\n<h2>Example</h2>\n\n<p>The example I always have in head when speaking about those is functions - and then an example of <code>f</code> would be <code>type F a = forall r. r -&gt; a</code> (which means the first argument is arbitrary but fixed <code>r</code>), or in other words all functions with a common input.\nAs always the instance for (covariant) <code>Functor</code> is just <code>fmap \u03c8 \u03c6</code> = \u03c8 . \u03c6`.</p>\n\n<p>Where the (contravariant) <code>Functor</code> is all functions with a common result - <code>type G a = forall r. a -&gt; r</code> here the <code>Contravariant</code> instance would be\n<code>cmap \u03c8 \u03c6 = \u03c6 . \u03c8</code>.</p>\n\n<p>But what the hell does this mean</p>\n\n<p><code>\u03c6 :: a -&gt; b</code> and <code>\u03c8 :: b -&gt; c</code></p>\n\n<p><em>usually</em> therefore <code>(\u03c8 . \u03c6) x = \u03c8 (\u03c6 x)</code> or <code>x \u21a6 y = \u03c6 x</code> and <code>y \u21a6 \u03c8 y</code> makes sense, what is ommited in the statement for <code>cmap</code> is that here</p>\n\n<p><code>\u03c6 :: a -&gt; b</code> but <code>\u03c8 :: <strong>c -> a</strong></code></p>\n\n<p>so <code>\u03c8</code> cannot take the result of <code>\u03c6</code> but it can transform its arguments to something <code>\u03c6</code> can use - therefore <code>x \u21a6 y = \u03c8 x</code> and <code>y \u21a6 \u03c6 y</code> is the only correct choice.</p>\n\n<p>This is reflected in the following diagrams, but here we have abstracted over the example of functions with common source/target - to something that has the property of being covariant/contravariant, which is a thing you often see in mathematics and/or haskell.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>                 covariant\nf a \u2500\u2500\u2500 fmap \u03c6 \u2500\u2500\u2500\u25b6 f b \u2500\u2500\u2500 fmap \u03c8 \u2500\u2500\u2500\u25b6 f c\n \u25b2                   \u25b2                   \u25b2\n \u2502                   \u2502                   \u2502\n \u2502                   \u2502                   \u2502\n a \u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u03c6 \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 b \u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u03c8 \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 c\n\n\n               contravariant\ng a \u25c0\u2500\u2500\u2500 cmap \u03c6 \u2500\u2500\u2500 g b \u25c0\u2500\u2500\u2500 cmap \u03c8 \u2500\u2500\u2500 g c\n \u25b2                   \u25b2                   \u25b2\n \u2502                   \u2502                   \u2502\n \u2502                   \u2502                   \u2502\n a \u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u03c6 \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 b \u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u03c8 \u2500\u2500\u2500\u2500\u2500\u2500\u25b6 c\n</code></pre>\n\n<h2>Remark:</h2>\n\n<p>In mathematics you usually require a law to call something functor.</p>\n\n   <pre class=\"lang-none prettyprint-override\"><code>        covariant\n   a                        f a\n  \u2502  \u2572                     \u2502    \u2572\n\u03c6 \u2502   \u2572 \u03c8.\u03c6   \u2550\u2550\u25b7   fmap \u03c6 \u2502     \u2572 fmap (\u03c8.\u03c6)\n  \u25bc    \u25c0                   \u25bc      \u25c0  \n  b \u2500\u2500\u25b6 c                f b \u2500\u2500\u2500\u2500\u25b6 f c\n    \u03c8                       fmap \u03c8\n\n       contravariant\n   a                        f a\n  \u2502  \u2572                     \u25b2    \u25b6\n\u03c6 \u2502   \u2572 \u03c8.\u03c6   \u2550\u2550\u25b7   cmap \u03c6 \u2502     \u2572 cmap (\u03c8.\u03c6)\n  \u25bc    \u25c0                   \u2502      \u2572  \n  b \u2500\u2500\u25b6 c                f b \u25c0\u2500\u2500\u2500 f c\n    \u03c8                       cmap \u03c8\n</code></pre>\n\n<p>which is equivalent to saying</p>\n\n<pre><code>fmap \u03c8 . fmap \u03c6 = fmap (\u03c8.\u03c6)\n</code></pre>\n\n<p>whereas</p>\n\n<pre><code>cmap \u03c6 . cmap \u03c8 = cmap (\u03c8.\u03c6)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1531329091, "post_id": 38044321, "comment_id": 89559620, "body": "I am struggling to follow your explanation and yet can&#39;t. Let me ask a question. What <b>rigorously</b> do you mean by saying that &quot;the function type a -&gt; r is a covariant functor in r, and a contravariant functor in a&quot;? Since functor is a mapping between categories, I assume both &#39;a&#39; and &#39;b&#39; to be distinct categories, however are they? It seems to me like a -&gt; b exists within <b>the same category</b> of SET (HASK, if you wish). Can you give a bit more explanation please? Coz&#39; contra/co-variance is a theoretical headache for me indeed."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 1, "creation_date": 1533003482, "post_id": 38044321, "comment_id": 90174842, "body": "@SerejaBogolubov I tried to answer your question, but I just can&#39;t fit it into a comment (and it&#39;s not really appropriate comment material anyway). I think your confusion is that my answer is written from the Haskell/programmers perspective on co- and contra-variant functors as represented by the Haskell typeclasses <code>Functor</code> and <code>Contravariant</code>. It isn&#39;t really a good discussion of co- and contra-variant functors from the category theory perspective (which is more general). I would be very happy to explain how the two viewpoints connect if you ask as a question instead of as a comment."}, {"owner": {"reputation": 3055, "user_id": 1404637, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27c64d06188fca40d38ecfe3c5b49ff1?s=128&d=identicon&r=PG", "display_name": "alx9r", "link": "https://stackoverflow.com/users/1404637/alx9r"}, "edited": false, "score": 0, "creation_date": 1544711077, "post_id": 38044321, "comment_id": 94379593, "body": "@ben Did a question about the connection between the progammer&#39;s viewpoint of  contravariance and the category theory viewpoint of contravariance get asked?   I&#39;d love to read your answer to that.  I&#39;m trying to gain an intuition of that connection myself."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 3055, "user_id": 1404637, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27c64d06188fca40d38ecfe3c5b49ff1?s=128&d=identicon&r=PG", "display_name": "alx9r", "link": "https://stackoverflow.com/users/1404637/alx9r"}, "edited": false, "score": 1, "creation_date": 1544774328, "post_id": 38044321, "comment_id": 94402255, "body": "@alx9r I didn&#39;t see one (but I may have missed it). If you can&#39;t find one already existing, feel free to ask one yourself! If you ping me here I&#39;ll do my best to answer (though there are lots of other people on SO with a better grasp of the category theory than me)"}, {"owner": {"reputation": 3055, "user_id": 1404637, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27c64d06188fca40d38ecfe3c5b49ff1?s=128&d=identicon&r=PG", "display_name": "alx9r", "link": "https://stackoverflow.com/users/1404637/alx9r"}, "edited": false, "score": 0, "creation_date": 1545235082, "post_id": 38044321, "comment_id": 94557486, "body": "@ben I asked <a href=\"https://stackoverflow.com/questions/53854853/why-is-there-a-distinction-between-co-and-contravariant-functors-in-haskell-but\">this question</a>.  Hopefully I&#39;m on the right track."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 51, "last_activity_date": 1467030589, "last_edit_date": 1467030589, "creation_date": 1466986136, "answer_id": 38044321, "question_id": 38034077, "link": "https://stackoverflow.com/questions/38034077/what-is-a-contravariant-functor/38044321#38044321", "title": "What is a contravariant functor?", "body": "<p>From a programmer's point of view the essence of functor-ness is being able to easily <em>adapt</em> things. What I mean by \"adapt\" here is that if I have an <code>f a</code> and I need an <code>f b</code>, I'd like an adaptor that will fit my <code>f a</code> in my <code>f b</code>-shaped  hole.</p>\n\n<p>It seems intuitive that if I can turn an <code>a</code> into a <code>b</code>, that I might be able to turn a <code>f a</code> into an <code>f b</code>. And indeed that's the pattern that Haskell's <code>Functor</code> class embodies; if I supply an <code>a -&gt; b</code> function then <code>fmap</code> lets me adapt <code>f a</code> things into <code>f b</code> things, without worrying about whatever <code>f</code> involves.<sup>1</sup></p>\n\n<p>Of course talking about paramterised types like list-of-x <code>[x]</code>, <code>Maybe y</code>, or <code>IO z</code> here, and the thing we get to change with our adaptors is the <code>x</code>, <code>y</code>, or <code>z</code> in those. If we want the flexibility to get an adaptor from any possible function <code>a -&gt; b</code> then of course the thing we're adapting has to be equally applicable to any possible type.</p>\n\n<p>What is less intuitive (at first) is that there are some types which can be adapted almost exactly the same way as functory ones, only they're \"backwards\"; for these if we want to adapt an <code>f a</code> to fill a need for a <code>f b</code> we actually need to supply a <code>b -&gt; a</code> function, not an <code>a -&gt; b</code> one!</p>\n\n<p>My favourite concrete example is actually the function type <code>a -&gt; r</code> (a for argument, r for result); all of this abstract nonsense makes perfect sense when applied to functions (and if you've done any substantial programming you've almost certainly used these concepts without knowing the terminology or how widely-applicable they are), and the two notions are so obviously dual to each other in this context.</p>\n\n<p>It's fairly well known that <code>a -&gt; r</code> is a functor in <code>r</code>. This makes sense; if I've got an <code>a -&gt; r</code> and I need an <code>a -&gt; s</code>, then I could use an <code>r -&gt; s</code> function to adapt my original function simply by post-processing the result.<sup>2</sup></p>\n\n<p>If, on the other hand, I have an <code>a -&gt; r</code> function and what I need is a <code>b -&gt; r</code>, then again it's clear that I can address my need by pre-processing arguments before passing them to the original function. But what do I pre-process them with? The original function is a black box; no matter what I do it's always expecting <code>a</code> inputs. So I need to turn my <code>b</code> values into the <code>a</code> values it expects: my pre-processing adaptor needs a <code>b -&gt; a</code> function.</p>\n\n<p>What we've just seen is that the function type <code>a -&gt; r</code> is a <em>covariant</em> functor in <code>r</code>, and a <em>contravariant</em> functor in <code>a</code>. I think of this as saying we can adapt a function's result, and the result type \"changes with\" the adaptor <code>r -&gt; s</code>, while when we adapt a function's argument the argument type changes \"in the opposite direction\" to the adaptor.</p>\n\n<p>Interestingly, the implementation of the function-result <code>fmap</code> and the function-argument <code>contramap</code> are almost exactly the same thing: just function composition (the <code>.</code> operator)! The only difference is on which side you compose the adaptor function:<sup>3</sup></p>\n\n<pre><code>fmap :: (r -&gt; s) -&gt; (a -&gt; r) -&gt; (a -&gt; s)\nfmap adaptor f = adaptor . f\nfmap adaptor = (adaptor .)\nfmap = (.)\n\ncontramap' :: (b -&gt; a) -&gt; (a -&gt; r) -&gt; (b -&gt; r)\ncontramap' adaptor f = f . adaptor\ncontramap' adaptor = (. adaptor)\ncontramap' = flip (.)\n</code></pre>\n\n<p>I consider the second definition from each block the most insightful; (covariantly) mapping over a function's result is composition on the left (post-composition if we want to take a \"this-happens-after-that\" view), while contravariantly mapping over a function's argument is composition on the right (pre-composition).</p>\n\n<p>This intuition generalises pretty well; if an <code>f x</code> structure can <em>give us</em> values of type <code>x</code> (just like an <code>a -&gt; r</code> function gives us <code>r</code> values, at least potentially), it might be a covariant <code>Functor</code> in <code>x</code>, and we could use an <code>x -&gt; y</code> function to adapt it into being an <code>f y</code>. But if an <code>f x</code> structure <em>receives</em> values of type <code>x</code> from us (again, like an <code>a -&gt; r</code> function's argument of type <code>a</code>), then it might be a <code>Contravariant</code> functor and we'd need to use a <code>y -&gt; x</code> function to adapt it to being an <code>f y</code>.</p>\n\n<p>I find it interesting to reflect that this \"sources are covariant, destinations are contravariant\" intuition reverses when you're thinking from the perspective of an <em>implementer</em> of the source/destination rather than a caller. If I'm trying to <em>implement</em> an <code>f x</code> that receives <code>x</code> values I can \"adapt my own interface\" so I get to work with <code>y</code> values instead (while still presenting the \"receives <code>x</code> values\" interface to my callers) by using an <code>x -&gt; y</code> function. Usually we don't think this way around; even as the implementer of the <code>f x</code> I think about adapting the things I'm calling rather than \"adapting my caller's interface to me\". But it's another perspective you can take.</p>\n\n<p>The only semi-real-world use I've made of <code>Contravariant</code> (as opposed to implicitly using the contravariance of functions in their arguments by using composition-on-the-right, which is very common) was for a type <code>Serialiser a</code> that could serialise <code>x</code> values. <code>Serialiser</code> had to be a <code>Contravariant</code> rather than a <code>Functor</code>; given I can serialise Foos, I can also serialise Bars if I can <code>Bar -&gt; Foo</code>.<sup>4</sup> But when you realise that <code>Serialiser a</code> is basically <code>a -&gt; ByteString</code> it becomes obvious; I'm just repeating a special case of the <code>a -&gt; r</code> example.</p>\n\n<p>In pure functional programming, there's not very much use in having something that \"receives values\" without it also giving something back so all the contravariant functors tend to look like functions, but nearly any straightforward data structure that can contain values of an arbitrary type will be a covariant functor in that type parameter. This is why <code>Functor</code> stole the good name early and is used all over the place (well, that and that <code>Functor</code> was recognised as a fundamental part of <code>Monad</code>, which was already in wide use before <code>Functor</code> was defined as a class in Haskell).</p>\n\n<p>In imperative OO I believe contravariant functors may be significantly more common (but not abstracted over with a unified framework like <code>Contravariant</code>), although it's also very easy to have mutability and side effects mean that a parameterised type just couldn't be a functor at all (commonly: your standard container of <code>a</code> that is both readable and writable is both an emitter and a sink of <code>a</code>, and rather than meaning it's both covariant and contravariant it turns out that means it's neither).</p>\n\n<hr>\n\n<p><sup>1</sup> The <code>Functor</code> instance of each individual <code>f</code> says how to apply arbitrary functions to the particular form of that <code>f</code>, without worrying about the particular types <code>f</code> is being applied to; a nice separation of concerns.</p>\n\n<p><sup>2</sup> This functor is also a monad, equivalent to the <code>Reader</code> monad. I'm not going to go beyond functors in detail here, but given the rest of my post an obvious question would be \"is the <code>a -&gt; r</code> type also some sort of contravariant monad in <code>a</code> then?\". Contravariance doesn't apply to monads unfortunately (see <a href=\"https://stackoverflow.com/questions/30641500/are-there-contravariant-monads\">Are there contravariant monads?</a>), but there is a contravariant analogue of <code>Applicative</code>: <a href=\"https://hackage.haskell.org/package/contravariant-1.4/docs/Data-Functor-Contravariant-Divisible.html\" rel=\"noreferrer\">https://hackage.haskell.org/package/contravariant-1.4/docs/Data-Functor-Contravariant-Divisible.html</a></p>\n\n<p><sup>3</sup> Note that my <code>contramap'</code> here doesn't match the actual <code>contramap</code> from <code>Contravariant</code> as implemented in Haskell; you can't make <code>a -&gt; r</code> an actual instance of <code>Contravariant</code> in Haskell code simply because the <code>a</code> is not the last type paramter of <code>(-&gt;)</code>. <em>Conceptually</em> it works perfectly well, and you can always use a newtype wrapper to swap the type parameters and make that an instance (the contravariant defines the the <code>Op</code> type for exactly this purpose).</p>\n\n<p><sup>4</sup> At least for a definition of \"serialise\" that doesn't necessarily include being able to reconstruct the Bar later, since it would serialise the a Bar identically to the Foo it mapped to with no way to include any information about what the mapping was.</p>\n"}, {"comments": [{"owner": {"reputation": 17038, "user_id": 58347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37881c0540fb86ebfa6c855e61021527?s=128&d=identicon&r=PG", "display_name": "Xanthir", "link": "https://stackoverflow.com/users/58347/xanthir"}, "edited": false, "score": 1, "creation_date": 1565198077, "post_id": 56150133, "comment_id": 101280332, "body": "Amazing, this is by far the best &quot;beginner&quot; answer. Thank you so much!"}, {"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 1, "creation_date": 1611494162, "post_id": 56150133, "comment_id": 116463822, "body": "Very good answer, +1! It helped me view this topic from another perspective. I&#39;ve written my interpretation in <a href=\"https://stackoverflow.com/a/65870966/5825294\">another answer I&#39;ve just posted</a>. Maybe you like that point of view too?"}], "tags": [], "owner": {"reputation": 2002, "user_id": 406343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iuR3T.jpg?s=128&g=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/406343/alexander"}, "is_accepted": false, "score": 11, "last_activity_date": 1557944763, "last_edit_date": 1557944763, "creation_date": 1557925549, "answer_id": 56150133, "question_id": 38034077, "link": "https://stackoverflow.com/questions/38034077/what-is-a-contravariant-functor/56150133#56150133", "title": "What is a contravariant functor?", "body": "<p>I know this answer won't be as deeply academic as the other ones, but it's simply based on the common implementations of contravariant you'll come across.</p>\n\n<p>First, a tip: Don't read the <code>contraMap</code> function type using the same mental metaphor for <code>f</code> as you do when reading the good ol' Functor's <code>map</code>.</p>\n\n<p>You know how you think:</p>\n\n<blockquote>\n  <p>\"a thing that <em>contains</em> (or <em>produces</em>) an <code>t</code>\"</p>\n</blockquote>\n\n<p>...when you read a type like <code>f t</code>?</p>\n\n<p>Well, you need to stop doing that, in this case.</p>\n\n<p>The Contravariant functor is \"the dual\" of the classic functor so, when you see <code>f a</code> in <code>contraMap</code>, you should think the \"dual\" metaphor:</p>\n\n<blockquote>\n  <p><code>f t</code> is a thing that <em>CONSUMES</em> a <code>t</code></p>\n</blockquote>\n\n<p>Now <code>contraMap</code>'s type should start to make sense:</p>\n\n<p><code>contraMap :: (a -&gt; b) -&gt; f b ...</code></p>\n\n<p>...pause right there, and the type is perfectly sensible:</p>\n\n<ol>\n<li>A function that \"produces\" a <code>b</code>.</li>\n<li>A thing that \"consumes\" a <code>b</code>.</li>\n</ol>\n\n<p>First argument cooks the <code>b</code>. Second argument eats the <code>b</code>.</p>\n\n<p>Makes sense, right?</p>\n\n<p>Now finish writing the type:</p>\n\n<p><code>contraMap :: (a -&gt; b) -&gt; f b -&gt; f a</code></p>\n\n<p>So in the end this thing must yield a \"<em>consumer</em> of <code>a</code>\".</p>\n\n<p>Well, surely we can build that, given that our first argument is a function that takes an <code>a</code> as input. </p>\n\n<p>A function <code>(a -&gt; b)</code> should be a good building block for building a \"consumer of <code>a</code>\".</p>\n\n<p>So <code>contraMap</code> basically lets you create a new \"consumer\", like this (warning: made up symbols incoming):</p>\n\n<p><code>(takes a as input / produces b as output) ~~&gt; (consumer of b)</code></p>\n\n<ul>\n<li>On the left of my made up symbol: The first argument to <code>contraMap</code> (i.e. <code>(a -&gt; b)</code>).</li>\n<li>On the right: The second argument (i.e. <code>f b</code>).</li>\n<li>The whole thing glued together: The final output of <code>contraMap</code> (a thing that knows how to consume an <code>a</code>, i.e. <code>f a</code>).</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "is_accepted": false, "score": 0, "last_activity_date": 1613031663, "last_edit_date": 1613031663, "creation_date": 1611494051, "answer_id": 65870966, "question_id": 38034077, "link": "https://stackoverflow.com/questions/38034077/what-is-a-contravariant-functor/65870966#65870966", "title": "What is a contravariant functor?", "body": "<p>Another view on the topic, limited to <em>functions</em> seen as contravariant functors. (See also <a href=\"https://medium.com/@drboolean/monoidal-contravariant-functors-are-actually-useful-1032211045c4\" rel=\"nofollow noreferrer\">this</a>.)</p>\n<h2><em>Functions</em> as <em>containers</em> (therefore <em><code>Functor</code>s</em>) of their result</h2>\n<p>A function <code>f</code> of type <code>a -&gt; b</code> can be tought of as containing a value of type <code>b</code>, which we get access to when we feed a value of type <code>a</code> to <code>f</code>.</p>\n<p>Now, things which are containers of other things can be made <code>Functor</code>s, in the sense that we can apply a function <code>g</code> to their content, via applying <code>fmap g</code> to the functor itself.</p>\n<p>Therefore, <code>f</code>, which is of type <code>a -&gt; b</code> can be seen as a functor in <code>b</code>, i.e. <code>(-&gt;) a</code> can be made a <code>Functor</code>. To do so, we need to define <code>fmap</code>: <code>fmap</code>ping a function <code>g</code> on the &quot;content&quot; of <code>f</code> essentially means applying <code>g</code> on whatever <code>f</code> returns (once it's fed with an input of type <code>a</code>, obviously), which means that <code>fmap g f = \\x -&gt; g (f x)</code> or, more concisely, <code>fmap g f = g . f</code>.</p>\n<h2><em><code>fmap</code>ping on <code>a -&gt; b</code> functions</em> = <em>post-processing</em> their result of type <code>b</code></h2>\n<p>As a last thought: a function of type <code>a -&gt; b</code> is a functor in <code>b</code> because we can <em><strong>post</strong></em>-process it by means of a function <code>b -&gt; c</code> (where <code>c</code> is just another type).</p>\n<h2><em><code>contramap</code>ping on <code>a -&gt; b</code> functions</em> = <em>pre-processing</em> an input to get <code>a</code></h2>\n<p>But what if we want to use a function <code>g</code> (of type <code>c -&gt; a</code>) to <strong><em>pre</em></strong>-process a value of some type <code>c</code> to obtain the value of type <code>a</code> that we want to feed to <code>f</code>?</p>\n<p>Well, it's clear that in this case, we want <code>g</code> to act <em>before</em> <code>f</code>, i.e. we are looking for <code>f . g</code>.</p>\n<p>And we want <code>f . g</code> to be the &quot;implementation&quot; of the concept of <em>&quot;mapping <code>g</code> on <code>f</code>&quot;</em>. In other words we want <code>whichmap g f = f . g</code>.</p>\n<p>Guess what? <code>whichmap</code> is actually the implementation of <code>contramap</code> for functions! And <code>contramap</code> is what you have to implement to make some type an instance of the <code>Contravariant</code> functor typeclass.</p>\n<h2>Well, not really <code>(-&gt; b)</code>...</h2>\n<p>Actually there isn't exactly an <code>instance</code> of <code>Contravariant</code> mirroring <code>instance Functor ((-&gt;) r)</code>, I believe just because <code>instance Contravariant (-&gt; r)</code>/<code>instance Contravariant (flip (-&gt;) r)</code> are invalid syntaxes; so another type is created, via</p>\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Op a b = Op { getOp :: b -&gt; a }\n</code></pre>\n<p>and <strong><em>this</em></strong> is made an instance of <code>Contravariant</code>:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>instance Contravariant (Op a) where\n  contramap f g = Op (getOp g . f)\n</code></pre>\n<p>The two last chunks of code are taken from <a href=\"http://hackage.haskell.org/package/contravariant-1.4.1/docs/src/Data-Functor-Contravariant.html#contramap\" rel=\"nofollow noreferrer\">hackage</a>.</p>\n<p>The example at the top of <a href=\"http://hackage.haskell.org/package/contravariant-1.4.1/docs/Data-Functor-Contravariant.html\" rel=\"nofollow noreferrer\">this</a> page is very illuminating too.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7263, "favorite_count": 16, "answer_count": 5, "score": 43, "last_activity_date": 1613031663, "creation_date": 1466899868, "question_id": 38034077, "link": "https://stackoverflow.com/questions/38034077/what-is-a-contravariant-functor", "title": "What is a contravariant functor?", "body": "<p>The type blows my mind:</p>\n\n<pre><code>class Contravariant (f :: * -&gt; *) where\n  contramap :: (a -&gt; b) -&gt; f b -&gt; f a\n</code></pre>\n\n<p>Then I read <a href=\"https://www.schoolofhaskell.com/user/liyang/profunctors\">this</a>, but contrary to the title, I wasn't any more enlightened.</p>\n\n<p>Can someone please give an explanation of what a contravariant functor is and some examples?</p>\n"}, {"tags": ["haskell", "design-patterns", "tree", "matching", "infinite"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1466899780, "post_id": 38033738, "comment_id": 63508212, "body": "This is a left fold - i.e. see <a href=\"http://image.slidesharecdn.com/fp-by-examples-130723041014-phpapp01/95/functional-programming-by-examples-using-haskell-28-638.jpg?cb=1374552694\" rel=\"nofollow noreferrer\">this graphic</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467129672, "post_id": 38033738, "comment_id": 63598541, "body": "It&#39;s kind of funny that I ran into a related problem myself recently, trying to push my temporary allocation in a list-to-tree function onto GHC&#39;s evaluation stack. In the end, I concluded the only way was probably to have one line for each tree spine shape, which is <i>way</i> too many lines."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1466899525, "creation_date": 1466899525, "answer_id": 38034035, "question_id": 38033738, "link": "https://stackoverflow.com/questions/38033738/how-to-stop-infinite-pattern-matching-in-haskell/38034035#38034035", "title": "How to stop infinite pattern-matching in Haskell?", "body": "<p>You might like the pattern <code>x:xs</code>, which matches any (non-empty) list, binding <code>x</code> to the first element and <code>xs</code> to the remaining elements. It is commonly used in conjunction with a recursive definition to inspect each element of a list in turn, no matter how long the list is.</p>\n\n<p>If you want to match lists longer than, say, three elements, the pattern can be extended to <code>x:y:z:rest</code>; in this case, <code>x</code>, <code>y</code>, and <code>z</code> will be bound to the first three elements of the list, and <code>rest</code> will be bound to the remaining elements.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 1, "last_activity_date": 1466899596, "creation_date": 1466899596, "answer_id": 38034044, "question_id": 38033738, "link": "https://stackoverflow.com/questions/38033738/how-to-stop-infinite-pattern-matching-in-haskell/38034044#38034044", "title": "How to stop infinite pattern-matching in Haskell?", "body": "<p>You need to write this function recursively, by finding a way to make one complicated case solvable in terms of a simpler case. Because what you are pattern-matching is a list, you will use the <code>(x:xs)</code> pattern, to break a list down into its head and its tail. Something like this:</p>\n\n<pre><code>build :: [LogMessage] -&gt; MessageTree\nbuild [] = ... -- remember lists can be empty!\nbuild [x] = Node Leaf x Leaf\nbuild (x:xs) = -- something to do with build [x] and xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1466899642, "creation_date": 1466899642, "answer_id": 38034051, "question_id": 38033738, "link": "https://stackoverflow.com/questions/38033738/how-to-stop-infinite-pattern-matching-in-haskell/38034051#38034051", "title": "How to stop infinite pattern-matching in Haskell?", "body": "<p>Rewrite your code in forward-calculating, accumulative style:</p>\n\n<pre><code>build [x] = go Leaf [x]\n  where\n  go tree (x:xs) = go (Node tree x Leaf) xs  -- build up (\"accumulate\") the tree \n  go tree []     = tree                      -- and reduce the list until empty\n\nbuild [x,y] = go (Node Leaf x Leaf) [y]      -- can we use another, simpler \n  where                                      --   initial accumulator value?\n  go tree (x:xs) = go (Node tree x Leaf) xs\n  go tree []     = tree\n\n....\n</code></pre>\n\n<p>Can you simplify this now? Do you notice the similarity here? Can <code>build</code> be called with a list of any length, i.e. matching the <code>(x:xs)</code> pattern?</p>\n"}, {"comments": [{"owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "reply_to_user": {"reputation": 378, "user_id": 5276213, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8bcd1b38316d6888a169c66403f8cc65?s=128&d=identicon&r=PG", "display_name": "aimorris", "link": "https://stackoverflow.com/users/5276213/aimorris"}, "edited": false, "score": 0, "creation_date": 1466902340, "post_id": 38034156, "comment_id": 63508596, "body": "In this case, since you were working with the list elements from last to first, the <code>(x:xs)</code> list pattern matching wasn&#39;t directly usable. But generally in the future you should try to get your functions work from the first element to the last, that way you can make use of the <code>(x:xs)</code> list pattern matching in order to make the function easier to write and understand."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 378, "user_id": 5276213, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8bcd1b38316d6888a169c66403f8cc65?s=128&d=identicon&r=PG", "display_name": "aimorris", "link": "https://stackoverflow.com/users/5276213/aimorris"}, "edited": false, "score": 1, "creation_date": 1466920429, "post_id": 38034156, "comment_id": 63511221, "body": "@Amorris repeatedly calling <code>init</code> is quadratic time behavior <i>(in strict languages...)</i>, and is what I tried to avoid. related: <a href=\"http://stackoverflow.com/questions/19944969/prolog-accumulators-are-they-really-a-different-concept/19951540#19951540\" title=\"prolog accumulators are they really a different concept\">stackoverflow.com/questions/19944969/&hellip;</a>, explaining a common programming technique that lets us make use of the <code>(x:xs)</code> pattern in such situations."}], "tags": [], "owner": {"reputation": 1786, "user_id": 4764550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15506251d83edf00de9f0936d2edf4e2?s=128&d=identicon&r=PG", "display_name": "Christopher Wells", "link": "https://stackoverflow.com/users/4764550/christopher-wells"}, "is_accepted": true, "score": 4, "last_activity_date": 1466900852, "creation_date": 1466900852, "answer_id": 38034156, "question_id": 38033738, "link": "https://stackoverflow.com/questions/38033738/how-to-stop-infinite-pattern-matching-in-haskell/38034156#38034156", "title": "How to stop infinite pattern-matching in Haskell?", "body": "<p>When you are working with functions that take in lists, you will often want to work with recursion and  list element functions.</p>\n\n<p>Let's take a look at what you have so far.</p>\n\n<p>On the fourth line, you have build evaluate to the following when it receives a list with three elements:</p>\n\n<pre><code>build [x,y,z] = Node (Node (build [x]) y Leaf) z Leaf\n</code></pre>\n\n<p>On the third line, you have build evaluates as follows when it receives a list of two elements:</p>\n\n<pre><code>build [x,y] = Node (build [x]) y Leaf\n</code></pre>\n\n<p>If you look at those two lines, you can notice that there is a bit of repetition. Specifically both contain <code>Node (build [x]) y Leaf</code>. When there is repetition like this, recursion can help.</p>\n\n<p>Using recursion, you can replace that repetition with a recursive call of the build function with a list of two elements. For example, you could replace line four with:</p>\n\n<pre><code>build [x,y,z] = Node (build [x,y]) z Leaf\n</code></pre>\n\n<p>That makes it a little bit simpler, but it doesn't yet solve the problem.</p>\n\n<pre><code>build :: [LogMessage] -&gt; MessageTree\nbuild [x] = Node Leaf x Leaf\nbuild [x,y] = Node (build [x]) y Leaf\nbuild [x,y,z] = Node (build [x,y]) z Leaf\n</code></pre>\n\n<p>If you take a look at the new function, you can see that some of the constants that we are using could be replaced by using list element functions, like <code>head</code>, <code>tail</code>, <code>last</code>, and <code>init</code>.</p>\n\n<p>In each pattern of the function we only treat the last element of the list separately. The non-last elements are then passed back into <code>build</code>. Thus we can get rid of some of the pattern matching by using <code>last</code> to access the last element of the list, and <code>init</code> to get all of the elements except for the last element.</p>\n\n<pre><code>build :: [LogMessage] -&gt; MessageTree\nbuild [x] = Node Leaf x Leaf\nbuild l = Node (build (init l)) (last l) Leaf\n</code></pre>\n\n<p>By working with general list elements using <code>init</code> and <code>last</code>, instead of working with explicitly specified elements of a list, we can remove the need for infinite pattern matching.</p>\n"}], "owner": {"reputation": 378, "user_id": 5276213, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8bcd1b38316d6888a169c66403f8cc65?s=128&d=identicon&r=PG", "display_name": "aimorris", "link": "https://stackoverflow.com/users/5276213/aimorris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 38034156, "answer_count": 4, "score": 1, "last_activity_date": 1467107473, "creation_date": 1466896241, "last_edit_date": 1467107473, "question_id": 38033738, "link": "https://stackoverflow.com/questions/38033738/how-to-stop-infinite-pattern-matching-in-haskell", "title": "How to stop infinite pattern-matching in Haskell?", "body": "<p>I am doing Exercise 3 from Homework 2 in <a href=\"http://www.cis.upenn.edu/~cis194/spring13/lectures.html\" rel=\"nofollow\">http://www.cis.upenn.edu/~cis194/spring13/lectures.html</a></p>\n\n<pre><code>build :: [LogMessage] -&gt; MessageTree\nbuild [x] = Node Leaf x Leaf\nbuild [x,y] = Node (build [x]) y Leaf\nbuild [x,y,z] = Node (Node (build [x]) y Leaf) z Leaf\n</code></pre>\n\n<p>I have a problem where I do not know how to end the pattern matching. It would just keep expanding to <code>[x,y,z,_]</code> and then <code>[x,y,z,_,_]</code> and so on. How do I stop this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1466886245, "post_id": 38032611, "comment_id": 63505463, "body": "<code>zipWith (-) x (tail x)</code>"}, {"owner": {"reputation": 313, "user_id": 3211178, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/8ad4ac8d8e0fcd3a6ab8b011d5536c26?s=128&d=identicon&r=PG&f=1", "display_name": "Question_Guy", "link": "https://stackoverflow.com/users/3211178/question-guy"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466886345, "post_id": 38032611, "comment_id": 63505505, "body": "@pdexter if you put it as an answer, I&#39;ll approve it"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1466959501, "post_id": 38032611, "comment_id": 63521423, "body": "Note that you could simply write <code>diff x = zipWith (-) x (tail x)</code> without the base case of <code>[]</code>, because when <code>x</code> is empty <code>zipWith</code> wont evalute its second argument and thus <code>tail</code> wont trigger an exception."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1466888467, "post_id": 38032699, "comment_id": 63506013, "body": "And, as a somewhat subtle side benefit, you will also stop crashing on <code>[]</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1466892511, "post_id": 38032699, "comment_id": 63506961, "body": "You can also shorten it a little as <code>diff = (zipWith (-)) &lt;*&gt; tail</code> (point-free and no explicit base case necessary) (although far less readable until you get used to <code>&lt;*&gt;</code>)."}], "tags": [], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "is_accepted": true, "score": 4, "last_activity_date": 1466886535, "creation_date": 1466886535, "answer_id": 38032699, "question_id": 38032611, "link": "https://stackoverflow.com/questions/38032611/compute-difference-between-consecutive-elements-in-a-given-list-of-integers/38032699#38032699", "title": "Compute difference between consecutive elements in a given list of integers", "body": "<p>As you have it now you're calculating <code>[2-4,7-2,3-7,6-3,5-6]</code>. If you swap the order of your arguments to <code>zipWith (-) x (tail x)</code> then you will correct it to <code>[4-2,2-7,7-3,3-6,6-5]</code></p>\n"}], "owner": {"reputation": 313, "user_id": 3211178, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/8ad4ac8d8e0fcd3a6ab8b011d5536c26?s=128&d=identicon&r=PG&f=1", "display_name": "Question_Guy", "link": "https://stackoverflow.com/users/3211178/question-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 0, "accepted_answer_id": 38032699, "answer_count": 1, "score": 0, "last_activity_date": 1466886535, "creation_date": 1466885848, "question_id": 38032611, "link": "https://stackoverflow.com/questions/38032611/compute-difference-between-consecutive-elements-in-a-given-list-of-integers", "title": "Compute difference between consecutive elements in a given list of integers", "body": "<p>I'm using <code>zipWith</code>. i get the correct results but with incorrect signs. How do I fix it? Where am I going wrong?</p>\n\n<pre><code>diff :: [Int] -&gt; [Int]\ndiff [] = []\ndiff x = zipWith (-) (tail x) x\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>diff  [4,2,7,3,6,5]\n[-2,5,-4,3,-1]\n</code></pre>\n\n<p>I want:</p>\n\n<pre><code>[2,-5,4,-3,1]\n</code></pre>\n"}, {"tags": ["haskell", "exception-handling"], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 2, "last_activity_date": 1466883733, "creation_date": 1466883733, "answer_id": 38032304, "question_id": 38032076, "link": "https://stackoverflow.com/questions/38032076/catching-every-exception-except-for-asyncexception/38032304#38032304", "title": "Catching every Exception except for AsyncException", "body": "<p>It is a dark corner of the language. Actually the <code>AsyncException</code> is wrapped into <code>SomeAsyncException</code> when it is <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.IO.Exception.html#asyncExceptionToException\" rel=\"nofollow\">converted to <code>SomeException</code></a>. Use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#v:asyncExceptionFromException\" rel=\"nofollow\"><code>asyncExceptionFromException</code></a> instead of <code>cast</code> (or cast to <code>SomeAsyncException</code>).</p>\n"}], "owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 38032304, "answer_count": 1, "score": 1, "last_activity_date": 1466883733, "creation_date": 1466882011, "question_id": 38032076, "link": "https://stackoverflow.com/questions/38032076/catching-every-exception-except-for-asyncexception", "title": "Catching every Exception except for AsyncException", "body": "<p>I need to execute many computations that might fail in multiple unimaginable ways but the failures can be ignored (user is notified). However, I don\u2019t want to ignore <code>AsyncException</code>s like <code>UserInterrupt</code> so the user could stop the program using <kbd>Control</kbd>-<kbd>C</kbd>.</p>\n\n<p>If I try to abort the program below, it will just output <code># failed: user interrupt</code> \u2013 as if the exception could not be cast to <code>AsyncException</code>. From <code>user interrupt</code> being printed we know the exception is <code>UserInterrupt</code> which can be cast (<code>cast UserInterrupt :: Maybe AsyncException</code>).</p>\n\n<p>Why is the <code>UserInterrupt</code> exception <strong>not</strong> discerned and <strong>re-thrown</strong>?</p>\n\n<pre><code>import Control.Exception\nimport Control.Monad\nimport Data.Typeable\n\nmain = forM_ [1..500000] processNumber\n\nprocessNumber n =\n    handle h (simulateComputation n)\n  where\n    h (SomeException e) =\n        case (cast e :: Maybe AsyncException) of\n            Just ae -&gt;\n                throw ae\n            Nothing -&gt;\n                putStrLn $ show n ++ \" failed: \" ++ show e\n\nsimulateComputation n = do\n    putStrLn \"...Obtaining data and computing...\"\n    --when (n `mod` 1000 == 0) $\n    --    throw (ErrorCall \"ComputationFailed\")\n    --when (n `mod` 1111 == 0) $\n    --    throw DivideByZero\n</code></pre>\n"}, {"tags": ["haskell", "arrows"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1467544700, "post_id": 38032028, "comment_id": 63765770, "body": "I found out that <a href=\"https://wiki.haskell.org/Netwire\" rel=\"nofollow noreferrer\"><i>Netwire</i></a> is a nice example. In particular <a href=\"https://hackage.haskell.org/package/netwire-5.0.1/docs/Control-Wire-Core.html#t:Wire\" rel=\"nofollow noreferrer\"><code>Wire</code></a> implements up to <code>ArrowChoice</code> but not <code>Monad</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 1, "last_activity_date": 1466984493, "creation_date": 1466984493, "answer_id": 38044182, "question_id": 38032028, "link": "https://stackoverflow.com/questions/38032028/good-state-of-the-art-examples-of-arrows-in-action/38044182#38044182", "title": "Good state-of-the-art examples of Arrows in action?", "body": "<p>Checkout <a href=\"https://github.com/tomjaguarpaw/haskell-opaleye/blob/master/Doc/Tutorial/TutorialBasic.lhs\" rel=\"nofollow\">this tutorial</a> for <a href=\"http://hackage.haskell.org/package/opaleye\" rel=\"nofollow\">opaleye</a>. Arrows are used extensively throughout (in addition to profunctors). The library offers a way to write composable, typesafe Postgres queries. I don't have much experience using it, but it seems like it is a well designed library, and is supposedly a good choice if you're using Postgres in the backend. Ben Kolera has a good video introduction to the library <a href=\"https://www.youtube.com/watch?v=A0oVn-GXOok\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 2, "answer_count": 1, "score": 6, "last_activity_date": 1466984493, "creation_date": 1466881645, "last_edit_date": 1466884815, "question_id": 38032028, "link": "https://stackoverflow.com/questions/38032028/good-state-of-the-art-examples-of-arrows-in-action", "title": "Good state-of-the-art examples of Arrows in action?", "body": "<p>I've been reading about <a href=\"https://www.haskell.org/arrows/\">arrows</a> lately, a concept invented more than 10 years ago. It allows to get more static information about computations compared to monads, while still having the power of computations depending on the previous ones.</p>\n\n<p>However I couldn't find them used in recent state-of-the-art libraries. For example <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.0.2/docs/Data-Attoparsec-Internal-Types.html#t:Parser\">attoparsec</a> doesn't even have an <code>Arrow</code> instance, even though arrows were designed to speed up parsing.</p>\n\n<p>Are there some nice examples of Arrows used in currently developed libraries or executables, which bring performance or other benefits?</p>\n\n<p>(I understand that this is kind of a soft question - my aim is to get better understanding of the concept and its advantages.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1466877199, "post_id": 38031301, "comment_id": 63502898, "body": "<code>[1,3..10]</code> is wrong. Don&#39;t write that."}, {"owner": {"reputation": 21, "user_id": 4467819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9ad25a9df8cdf56fc768362d2330851?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Tarrasso", "link": "https://stackoverflow.com/users/4467819/joan-tarrasso"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1466877328, "post_id": 38031301, "comment_id": 63502932, "body": "Why? What fixes that, i.e. to 0.9?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1466877363, "post_id": 38031301, "comment_id": 63502943, "body": "<code>[1,3..9]</code> of course."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1466877606, "post_id": 38031301, "comment_id": 63503016, "body": "But if you want <code>[0.1, 0.3, 0.5, 0.7, 0.9]</code> then just write <code>[0.1, 0.3..0.9]</code>. Maybe you&#39;ve oversimplified your real question?"}, {"owner": {"reputation": 21, "user_id": 4467819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9ad25a9df8cdf56fc768362d2330851?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Tarrasso", "link": "https://stackoverflow.com/users/4467819/joan-tarrasso"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1466877683, "post_id": 38031301, "comment_id": 63503037, "body": "Yes, but if I do [1,3..10] in ghci it displays [1,3,5,7,9]"}, {"owner": {"reputation": 21, "user_id": 4467819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9ad25a9df8cdf56fc768362d2330851?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Tarrasso", "link": "https://stackoverflow.com/users/4467819/joan-tarrasso"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1466878013, "post_id": 38031301, "comment_id": 63503135, "body": "If I do that, the last term isn&#39;t exactly 0.9. It&#39;s 0.899999999999999"}, {"owner": {"reputation": 21, "user_id": 4467819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9ad25a9df8cdf56fc768362d2330851?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Tarrasso", "link": "https://stackoverflow.com/users/4467819/joan-tarrasso"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1466878971, "post_id": 38031301, "comment_id": 63503440, "body": "Thank you very much! I&#39;m going to see this link."}], "owner": {"reputation": 21, "user_id": 4467819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9ad25a9df8cdf56fc768362d2330851?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Tarrasso", "link": "https://stackoverflow.com/users/4467819/joan-tarrasso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "closed_date": 1466880434, "answer_count": 0, "score": 2, "last_activity_date": 1466877765, "creation_date": 1466876949, "last_edit_date": 1466877765, "question_id": 38031301, "link": "https://stackoverflow.com/questions/38031301/a-list-comprehension-with-double-elements", "closed_reason": "Duplicate", "title": "A list comprehension with double elements", "body": "<p>In Haskell if I write</p>\n\n<pre><code>[x/10 | x &lt;- [1,3..10]]\n</code></pre>\n\n<p>I obtain</p>\n\n<pre><code>[0.1, 0.3, 0.5, 0.7, 0.9, 1.1]\n</code></pre>\n\n<p>What's wrong?</p>\n"}, {"tags": ["haskell", "haskell-lens", "aeson"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466880175, "post_id": 38031199, "comment_id": 63503815, "body": "Updated my answer with a lens solution."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1466880161, "last_edit_date": 1466880161, "creation_date": 1466879124, "answer_id": 38031648, "question_id": 38031199, "link": "https://stackoverflow.com/questions/38031199/query-properties-of-object/38031648#38031648", "title": "Query properties of Object", "body": "<p>Here is a lens solution:</p>\n\n<pre><code> {-# LANGUAGE OverloadedStrings #-}\n\n import Data.Text\n import Data.Aeson\n import Data.Aeson.Lens\n import Control.Lens\n\n Just obj1 = decode (\"{ \\\"a\\\": { \\\"b\\\": [ 3,4,5] } }\" ) :: Maybe Value\n Just obj2 = decode (\"{ \\\"a\\\": { \\\"d\\\": true } }\" ) :: Maybe Value\n\n test1 = (Just obj1) ^. (key \"a\" ) ^. (key \"b\") :: Maybe Value\n test2 = (Just obj2) ^. (key \"a\" ) ^. (key \"b\") :: Maybe Value\n</code></pre>\n\n<p>Note that you have to start the chain with a <code>Maybe Value</code>.</p>\n\n<p>Here's a non-lens answer if that helps:</p>\n\n<pre><code> {-# LANGUAGE OverloadedStrings #-}\n\n import Data.Aeson\n import qualified Data.HashMap.Strict as HM\n\n -- access .a.b\n get_a_b :: Object -&gt; Maybe Value\n get_a_b hm = do\n   v &lt;- HM.lookup \"a\" hm\n   hm2 &lt;- case v of\n            (Object hm2) -&gt; return hm2\n            _            -&gt; Nothing\n   HM.lookup \"b\" hm2\n</code></pre>\n"}], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1466880161, "creation_date": 1466876296, "last_edit_date": 1466876701, "question_id": 38031199, "link": "https://stackoverflow.com/questions/38031199/query-properties-of-object", "title": "Query properties of Object", "body": "<p>What's the Aeson equivalent of the javascript property accessor.</p>\n\n<p>How would you translate the javascript statement <code>x.a.b</code> to Haskell?</p>\n\n<p>As an example, given <code>someObject :: Object</code> containing e.g:</p>\n\n<pre><code>{ a:\n  { b:\n    [ 1\n    , 2\n    ]\n  }\n}\n</code></pre>\n\n<p>What would the function that returns <code>[1,2]</code> for the above look like.</p>\n\n<p>I've searching around for an answer to this problem and it would appear the answer to this question is \"use lenses\". I just can't seem to figure out how to do this.</p>\n"}, {"tags": ["haskell", "io", "referential-transparency"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1466848952, "post_id": 38027129, "comment_id": 63494852, "body": "assuming your interpreter will interact with the user - wouldn&#39;t it run in IO anyway? Why not just wrap <code>IO</code> in values in the representation of your interpreted language as well?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466849099, "post_id": 38027129, "comment_id": 63494890, "body": "What @Carsten said. If you are already manipulating values of different types, then perhaps one of those types could hold an IO value."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1466849708, "post_id": 38027129, "comment_id": 63495031, "body": "This <i>is</i> how I intend to model user interaction, as well as other forms of IO.  At present, IO is involved <i>only</i> during the initial module loading phase (which happens and is completed prior to execution).  At this point, it seems like the change to use IO during interpretation as well would lose at least some of the benefits of working in a pure system.  Avoiding IO when I don&#39;t need it seems like a useful goal, and if I can separate out a subsystem that <i>does</i> need it and <i>prove</i> that that subsystem is still referentially transparent, is there a good reason not to do so?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466849818, "post_id": 38027129, "comment_id": 63495050, "body": "Predicting when exactly thunks are forced in a lazy language can be very tricky -- this is why there are virtually no lazy impure functional languages. Adding <code>seq</code>s at the right spots might be less trivial than it looks. Further -- could you write a mock type for the interpreter? Is it <code>int :: Program -&gt; Result</code> or something similar?"}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1466850090, "post_id": 38027129, "comment_id": 63495106, "body": "The overall type of the interpreter is essentially <code>Scope s -&gt; Expr -&gt; ST s (Either ErrorMessage Value)</code>, where <code>Scope s</code> contains a description of both global (mutable) variables and functions/classes defined in the program, and the <code>Expr</code> is basically a simple bootstrap expression that calls a function in the program."}], "answers": [{"comments": [{"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1466866493, "post_id": 38028257, "comment_id": 63499587, "body": "This is an option I thought about briefly, but figured would be too complex.  That said, it&#39;s probably worth considering a little longer, if only because it has some useful applications (e.g. recording a trace of IO operations so that programs can be tested more easily).  As to the <i>reason</i> I want a pure interpreter, I&#39;ll add an edit to the question."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 0, "creation_date": 1466868628, "post_id": 38028257, "comment_id": 63500228, "body": "OK, you need different sets of primops, so injecting them looks reasonable. Anyway, don&#39;t let overthinking prevent you from trying -- you&#39;ll probably redesign and refactor everything a number of times anyway."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 2, "last_activity_date": 1466855785, "creation_date": 1466855785, "answer_id": 38028257, "question_id": 38027129, "link": "https://stackoverflow.com/questions/38027129/use-of-unsafeperformio-in-programming-language-interpreter-runtime/38028257#38028257", "title": "Use of unsafePerformIO in programming language interpreter runtime", "body": "<p>If I understand it correctly, you want to add <code>IO</code> actions to interpreted language (impure primops), while the interpreter itself is pure.</p>\n\n<p>The first option is abstract primops from interpreter. For example, the interpreter could run in some unspecified monad, while priops are injected:</p>\n\n<pre><code>data Primops m = Primops\n  { putChar :: Char -&gt; m ()\n  , getChar :: m Char\n  , ...\n  }\n\ninterpret :: Monad m =&gt; Primops m -&gt; Program -&gt; m ()\n</code></pre>\n\n<p>Now interpreter can't perform any <code>IO</code> action except the closed list of primops. (You can achieve similar result using custom monad instead of passing primops as an argument.)</p>\n\n<p>But I'd consider it over-engineering until you say exactly why you need pure interpreter. Probably you don't? If you just want to make pure parts of the interpreter easy to test, then it is probably better to extract those parts into separate pure functions. That way the top level entry point will be impure, but small, yet all the interpreter's logic will be testable.</p>\n"}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1466866625, "creation_date": 1466848090, "last_edit_date": 1466866625, "question_id": 38027129, "link": "https://stackoverflow.com/questions/38027129/use-of-unsafeperformio-in-programming-language-interpreter-runtime", "title": "Use of unsafePerformIO in programming language interpreter runtime", "body": "<p>To add IO functions to a programming language interpreter written in Haskell, I have basically two options:</p>\n\n<ul>\n<li>Modify the entire interpreter to run inside the IO monad</li>\n<li>Have the runtime functions that can be invoked by interpreted programs use <code>unsafePerformIO</code>.</li>\n</ul>\n\n<p>The former feels like a bad idea to me -- this effectively negates <em>any</em>  purity benefits by having <code>IO</code> reach practically everywhere in the program.  I also currently use <code>ST</code> heavily, and would have to modify large quantities of the program to achieve this, as there is no way I can see to use both <code>ST</code> and <code>IO</code> at the same time (?).</p>\n\n<p>The latter makes me nervous -- as the function name states, it <em>is</em> unsafe, but I think in this situation it may be justified.  Particularly:</p>\n\n<ul>\n<li>The amount of code touched by this change would be very small.</li>\n<li>The points at which IO may be performed are explicitly sequenced already by the use of <code>seq</code> at control points during evaluation of interpreted expressions.</li>\n<li>Perhaps more importantly, values returned by IO actions would only be used within interpreted sections of code, where I can guarantee referential transparency by the fact that the interpreter cannot be called multiple times with the same arguments, as an operation counter will be threaded through the entire system as part of the same change, and is <em>always</em> passed with a unique value to every function that would use <code>unsafePerformIO</code>.</li>\n</ul>\n\n<p>In this circumstance, is there a good reason not to use <code>unsafePerformIO</code>?</p>\n\n<h2>Update</h2>\n\n<p>I was asked why I want to retain purity in the interpreter.  There are a number of reasons, but perhaps the most pressing is that I intend to later build a compiler for this language, and the language will include a variety of metaprogramming techniques that will require the compiler to include the interpreter, but I want to be able to guarantee purity of the results of compilation.  The language will have a pure subset for this purpose, and I would like the interpreter to be pure when executing that subset.</p>\n"}, {"tags": ["haskell", "monads", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1466836510, "post_id": 38024914, "comment_id": 63491996, "body": "Thanks, this works. I didn&#39;t realize one could use the <code>App</code> record type for stuff like this."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 5, "last_activity_date": 1466828998, "last_edit_date": 1466828998, "creation_date": 1466828454, "answer_id": 38024914, "question_id": 38024654, "link": "https://stackoverflow.com/questions/38024654/how-to-configure-google-oauth-with-client-id-and-secret-from-environment-variabl/38024914#38024914", "title": "How to configure Google OAuth with client ID and secret from environment variables?", "body": "<p><strike>Not tested, but this should work:</strike> Full example: <a href=\"http://lpaste.net/167997\" rel=\"noreferrer\">http://lpaste.net/167997</a></p>\n\n<ol>\n<li><p>Add fields to your App record for the client id and secret:</p>\n\n<pre><code>data App = App { ...\n               , gmailClientId :: Text\n               , gmailClientSecret :: Text\n               }\n</code></pre></li>\n<li><p>Modify the authPlugins method to look up the client id and secret values from the App record:</p>\n\n<pre><code>instance YesodAuth App where\n  ...\n  authPlugins app = [ ...\n                    , authGoogleEmail (gmailClientId app)  (gmailClientSecret app)\n                    ]\n</code></pre></li>\n<li><p>Initialize the App record in <code>main</code> before calling <code>warp</code>:</p>\n\n<pre><code>main = do\n  clientId &lt;- getEnv \"CLIENT_ID\"\n  clientSecret &lt;- getEnv \"CLIENT_SECRET\"\n  ...\n  let app = App { ..., gmailClientId = clientId, gmailClientSecret = clientSecret }\n  warp 3000 app\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 1, "accepted_answer_id": 38024914, "answer_count": 1, "score": 1, "last_activity_date": 1466828998, "creation_date": 1466825328, "question_id": 38024654, "link": "https://stackoverflow.com/questions/38024654/how-to-configure-google-oauth-with-client-id-and-secret-from-environment-variabl", "title": "How to configure Google OAuth with client ID and secret from environment variables?", "body": "<p>I'd like my application's Client ID and Secret ID to NOT be part of my source code. Therefore, if I read these settings from environment variables during runtime they will always be wrapped in IO. This leads to a problem, because then they will fail to compose:</p>\n\n<pre><code>authPlugins :: master -&gt; [AuthPlugin master]\nauthGoogleEmail :: YesodAuth m =&gt; Text -&gt; Text -&gt; AuthPlugin m\ngetEnv :: String -&gt; IO String\n</code></pre>\n\n<p>Another way to pose this question is: how to read <code>clientId</code> and <code>clientSecret</code> from the environment in the first example code given at <a href=\"http://www.yesodweb.com/book/authentication-and-authorization\" rel=\"nofollow\">http://www.yesodweb.com/book/authentication-and-authorization</a></p>\n"}, {"tags": ["haskell", "dependent-type", "gadt", "existential-type", "combinators"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1466864592, "post_id": 38028765, "comment_id": 63499074, "body": "You&#39;ll have to <code>unsafeCoerce</code> the <code>typeRep</code> into a <code>Typeable</code> dictionary, like <a href=\"https://hackage.haskell.org/package/reflection-2.1.2/docs/src/Data-Reflection.html#reify\" rel=\"nofollow noreferrer\">the <code>reflection</code> library</a> does. This situation should improve in an upcoming version of GHC, where <code>TypeRep</code> will be indexed by the type it represents (that is: <code>class Typeable a where typeRep :: TypeRep a</code>). Then you&#39;d be able to put the <code>TypeRep</code> inside <code>CombBox</code> directly, rather than working implicitly with <code>Typeable</code> dictionaries: <code>data CombBox = forall a. CombBox (TypeRep a) (Comb a)</code>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1466870708, "post_id": 38028765, "comment_id": 63500905, "body": "@Benjamin Hodgson, &quot;You&#39;ll have to <code>unsafeCoerce</code> the <code>typeRep</code> into a <code>Typeable</code> dictionary&quot; \u2014 I don&#39;t think you can do that. For this you need to know the target dictionary to remove ambiguity, but there is just no such information. Indexed <code>TypeRep</code> will solve the problem of course."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 2, "last_activity_date": 1466859468, "creation_date": 1466859468, "answer_id": 38028765, "question_id": 38024458, "link": "https://stackoverflow.com/questions/38024458/type-juggling-with-existentials-at-runtime/38028765#38028765", "title": "Type Juggling with Existentials at Runtime", "body": "<p>Not a proper answer, but might be helpful.</p>\n\n<p>Parametricity doesn't allow control flow to depend on types, so you need some first-order representation of types. Haskell has <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Typeable.html\" rel=\"nofollow\">Typeable</a>:</p>\n\n<pre><code>deriving instance Typeable Comb\n\ndata CombBox = forall a. Typeable a =&gt; CombBox { unCombBox :: Comb a }\n</code></pre>\n\n<p>Using it we can define</p>\n\n<pre><code>castApply1 :: (Typeable a, Typeable b, Typeable ab) =&gt; Comb ab -&gt; Comb a -&gt; Maybe (Comb b)\ncastApply1 f x = (:$ x) &lt;$&gt; cast f\n</code></pre>\n\n<p>However</p>\n\n<pre><code>($$) :: CombBox -&gt; CombBox -&gt; Maybe CombBox\nCombBox f $$ CombBox x = CombBox &lt;$&gt; castApply f x\n</code></pre>\n\n<p>throws</p>\n\n<pre><code>Could not deduce (Typeable a0) arising from a use of `CombBox' \u2026\n    from the context (Typeable a)\n    or from (Typeable a1)\n    The type variable `a0' is ambiguous\n</code></pre>\n\n<p>The problem is that <code>b</code> is specified in the return type of <code>castApply1</code>, but if we immediately apply <code>CombBox</code> to <code>castApply f x</code>, then <code>b</code> doesn't get specified and hence remains ambiguous.</p>\n\n<p>We can specify <code>b</code> by providing <code>Proxy b</code> as an argument:</p>\n\n<pre><code>castApply2 :: (Typeable a, Typeable b, Typeable ab) =&gt; Proxy b -&gt; Comb ab -&gt; Comb a -&gt; Maybe (Comb b)\ncastApply2 p = castApply1\n</code></pre>\n\n<p>Which allows to wrap the result in <code>CombBox</code>:</p>\n\n<pre><code>castApply3 :: (Typeable a, Typeable b, Typeable ab) =&gt; Proxy b -&gt; Comb ab -&gt; Comb a -&gt; Maybe CombBox\ncastApply3 p f x = CombBox &lt;$&gt; castApply2 p f x\n</code></pre>\n\n<p>We can finally define something that doesn't mention that annoying <code>b</code>:</p>\n\n<pre><code>data SomeTypeable = forall a. Typeable a =&gt; SomeTypeable (Proxy a)\n\ncastApply4 :: (Typeable a, Typeable ab) =&gt; SomeTypeable -&gt; Comb ab -&gt; Comb a -&gt; Maybe CombBox\ncastApply4 (SomeTypeable p) = castApply3 p\n</code></pre>\n\n<p>Now having</p>\n\n<pre><code>typeRepToSomeTypeable :: TypeRep -&gt; SomeTypeable\n</code></pre>\n\n<p>We can define</p>\n\n<pre><code>castApply :: (Typeable a, Typeable ab) =&gt; TypeRep -&gt; Comb ab -&gt; Comb a -&gt; Maybe CombBox\ncastApply t = castApply4 (typeRepToSomeTypeable t)\n\n($$) :: CombBox -&gt; CombBox -&gt; Maybe CombBox\nCombBox f $$ CombBox x = funResultTy (typeRep f) (typeRep x) &gt;&gt;= \\t -&gt; castApply t f x\n</code></pre>\n\n<p><code>funResultTy</code> is a function in <code>Data.Typeable</code> that returns the codomain of a first argument if its domain matches the second argument.</p>\n\n<p>But how to define <code>typeRepToSomeTypeable</code>? It doesn't seem it was implemented somewhere. At least I haven't found it neither in <code>Data.Typeable</code> nor in <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\">Singletons</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1466872422, "post_id": 38029175, "comment_id": 63501435, "body": "There is a problem with your encoding: <code>Typey</code> is monomorphic. I.e. you can&#39;t apply <code>aid :: AComb</code> to itself. For this to work you&#39;d need to add explicit type variables and change <code>tyEq</code> to <code>tyUnify</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1466872774, "post_id": 38029175, "comment_id": 63501533, "body": "Yes, that&#39;s a shortcoming of simply-typed systems in general. I glossed over it in the answer because it makes the code significantly more complicated, to the point that (I think) the costs outweigh the benefits of type-indexed terms altogether."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1466902849, "post_id": 38029175, "comment_id": 63508678, "body": "This is exactly the sort of explanation I&#39;m looking for. Shame it&#39;s more complicated with polymorphic types but this helps a lot."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1466906965, "last_edit_date": 1466906965, "creation_date": 1466862303, "answer_id": 38029175, "question_id": 38024458, "link": "https://stackoverflow.com/questions/38024458/type-juggling-with-existentials-at-runtime/38029175#38029175", "title": "Type Juggling with Existentials at Runtime", "body": "<p>Get ready to learn about <em>dependent pairs</em> and <em>singletons</em>!</p>\n\n<hr>\n\n<p>I'm going to rewrite your system a little bit to simplify it.</p>\n\n<p>First off, I'm going to shrink your universe of types from <em>all of Haskell</em> to a much simpler universe consisting of a single primitive type and arrows.</p>\n\n<pre><code>infixr 0 :-&gt;\ndata Type = Unit | Type :-&gt; Type\n</code></pre>\n\n<p>Hopefully you should be able to see how to extend this with more primitive types.</p>\n\n<p>I'm also going to remove most of the bits from <code>Comb</code>, since they can all be expressed in terms of one another.</p>\n\n<pre><code>data Comb a where\n    S :: Comb ((a :-&gt; b :-&gt; c) :-&gt; (a :-&gt; b) :-&gt; a :-&gt; c)\n    K :: Comb (a :-&gt; b :-&gt; a)\n    (:$) :: Comb (a :-&gt; b) -&gt; Comb a -&gt; Comb b\n\ni = S :$ K :$ i\nb = (S :$ (K :$ S)) :$ K\nc = S :$ (S :$ (K :$ (S :$ (K :$ S) :$ K)) :$ S) :$ (K :$ K)\nw = S :$ S :$ (S :$ K)\n</code></pre>\n\n<hr>\n\n<p>Now to your question. As you correctly surmised, when you're reading user input you can't predict statically what the type of the resulting term will be, so you need to existentially quantify it.</p>\n\n<pre><code>data Ex f = forall a. Ex (f a)\n</code></pre>\n\n<p>The problem is: how do you recover the type information in order to be able to manipulate terms? We can pair up a <code>Comb</code> with another value which you can pattern-match on at runtime to <em>learn</em> the type of the <code>Comb</code>. Here's a combinator for pairing things up.</p>\n\n<pre><code>data (f :*: g) i = f i :*: g i\n</code></pre>\n\n<p>(I lifted both of these types from <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow\">the <em>Hasochism</em> paper</a>.) <code>:*:</code> pairs up two types ensuring that their indices are equal. We'll use it together with <code>Ex</code> to simulate a <em>dependent pair</em> or <em>sigma</em> type: a pair of values for whom the type of the second component depends on the value of the first. The idea is that <code>f</code> will be a GADT which tells you something about its index, so pattern matching on <code>f</code> gives you information about the type of <code>g</code>.</p>\n\n<pre><code>type Sg f g = Ex (f :*: g)\npattern Sg x y = Ex (x :*: y)\n</code></pre>\n\n<p>Now the clever part: coming up with a GADT which tells you about a combinator term's type.</p>\n\n<pre><code>data Typey t where\n    Unity :: Typey Unit\n    Arry :: Typey a -&gt; Typey b -&gt; Typey (a :-&gt; b)\n</code></pre>\n\n<p><code>Typey</code> is called a <em>singleton</em>. For a given <code>t</code>, there exists exactly one value of type <code>Typey t</code>. So if you have a <code>Typey t</code> value, you know everything there is to know about <code>t</code>.</p>\n\n<p>Singleton values are ultimately a hack. <code>Typey</code> is not <code>Type</code>; it's a value-level stand-in for <code>Type</code>'s duplicated type-level copy. In a real dependently-typed system you don't need singleton glue to affix value-level stuff to type-level stuff because the distinction isn't there in the first place.</p>\n\n<p>Our existentially-quantified combinators now look like this. <code>AComb</code> packs up a <code>Comb</code> with a runtime representation of its type. This technique allows us to guarantee that the boxed <code>Comb</code> is well-typed; we just can't say statically what that type is.</p>\n\n<pre><code>type AComb = Sg Typey Comb\n</code></pre>\n\n<hr>\n\n<p>How do we write <code>($$)</code>, which attempts to apply an <code>AComb</code> to another <code>AComb</code>? We need to pattern-match on their associated <code>Typey</code>s in order to learn whether or not it's possible to apply one to the other. In particular, we're going to need a way to know whether two types are equal.</p>\n\n<p>Here comes <em>propositional equality</em>, a GADT proof that two type-level things are equal. You can only give a value of <code>Refl</code> if you can explain to GHC that <code>a</code> and <code>b</code> are in fact the same. Conversely, if you pattern-match on <code>Refl</code> then GHC will add <code>a ~ b</code> to the typing context.</p>\n\n<pre><code>data a :~: b where\n    Refl :: a :~: a\nwithEq :: a :~: b -&gt; (a ~ b =&gt; r) -&gt; r\nwithEq Refl x = x\n</code></pre>\n\n<p>Here's a helper function to lift a pair of equalities through the <code>:-&gt;</code> constructor.</p>\n\n<pre><code>arrEq :: (a :~: c) -&gt; (b :~: d) -&gt; (a :-&gt; b) :~: (c :-&gt; d)\narrEq Refl Refl = Refl\n</code></pre>\n\n<p>As promised, we can write down a function to check whether two <code>Type</code>s are equal. We proceed by pattern-matching on their associated singleton <code>Typey</code>s, failing if we find the types to be incompatible. If the equality test succeeds, the spoils are a proof that the types are equal.</p>\n\n<pre><code>tyEq :: Typey t -&gt; Typey u -&gt; Maybe (t :~: u)\ntyEq Unity Unity = Just Refl\ntyEq (Arry a b) (Arry c d) = liftA2 arrEq (tyEq a c) (tyEq b d)\ntyEq _ _ = Nothing\n\nwithTyEq :: Typey t -&gt; Typey u -&gt; (t ~ u =&gt; a) -&gt; Maybe a\nwithTyEq t u x = fmap (\\p -&gt; withEq p x) (tyEq t u)\n</code></pre>\n\n<p>Finally, we can write <code>$$</code>. The typing rule goes like this:</p>\n\n<pre><code>f : a -&gt; b    y : a\n------------------- App\n      f y : b\n</code></pre>\n\n<p>That is, if the left-hand term of <code>$$</code> is a function type, and the type of the right-hand term matches the function's domain, we can type the application. So the implementation of this rule has to test (using <code>withTyEq</code>) whether the relevant types match in order to return the resulting term.</p>\n\n<pre><code>($$) :: AComb -&gt; AComb -&gt; Maybe AComb\nSg (Arry a b) x $$ Sg t y = withTyEq a t $ Sg b (x :$ y)\n_ $$ _ = Nothing\n</code></pre>\n\n<hr>\n\n<p>Generating <code>Typey</code> terms corresponds to the act of type-checking. In other words, a function <code>parse :: String -&gt; AComb</code> has to do both parsing <em>and</em> type-checking. In real compilers, these two phases are separated.</p>\n\n<p>So I'd advise parsing the user input into an <em>untyped</em> syntax tree, which admits ill-formed terms, and then generating typing information separately.</p>\n\n<pre><code>data Expr = S | K | Expr :$ Expr\nparse :: String -&gt; Parser Expr\ntypeCheck :: Expr -&gt; Maybe AComb\n</code></pre>\n\n<p>A fun exercise (in more-dependently-typed languages) is to modify <code>typeCheck</code> to return a more detailed explanation of why type-checking failed, like this bit of pseudo-Agda:</p>\n\n<pre><code>data Void : Set where\nNot : Set -&gt; Set\nNot a = a -&gt; Void\n\ndata TypeError : Expr -&gt; Set where\n    notArr : Not (IsFunction f) -&gt; TypeError (f :$ x)\n    mismatch : Not (domain f :~: type x) -&gt; TypeError (f :$ x)\n    inFunc : TypeError f -&gt; TypeError (f :$ x)\n    inArg : TypeError x -&gt; TypeError (f :$ x)\n\ntypeCheck : (e : Expr) -&gt; Either (TypeError e) AComb\n</code></pre>\n\n<p>You can also make <code>typeCheck</code> more precise by giving assurance that it doesn't change the term you give it (another exercise).</p>\n\n<p>For further reading, see <a href=\"http://strictlypositive.org/vfl.pdf\" rel=\"nofollow\"><em>The View from the Left</em></a>, which features a verified type-checker for the lambda calculus.</p>\n"}], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 1, "accepted_answer_id": 38029175, "answer_count": 2, "score": 4, "last_activity_date": 1466906965, "creation_date": 1466822820, "last_edit_date": 1466865600, "question_id": 38024458, "link": "https://stackoverflow.com/questions/38024458/type-juggling-with-existentials-at-runtime", "title": "Type Juggling with Existentials at Runtime", "body": "<p>I'm playing around with existentials and GADTs in Haskell, and I'm trying to define a DSL for combinators (such as SKI). I have the GADT working, as well as a reduction function which works fine (and isn't really relevant to the question)</p>\n\n<pre><code>{-# LANGUAGE GADTs, ExistentialQuantification #-}\n\nimport Control.Applicative\nimport Data.Monoid\nimport Control.Monad\n\ndata Comb t where\n    S :: Comb ((a -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c)\n    K :: Comb (a -&gt; b -&gt; a)\n    I :: Comb (a -&gt; a)\n    B :: Comb ((b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c)\n    C :: Comb ((b -&gt; a -&gt; c) -&gt; a -&gt; b -&gt; c)\n    W :: Comb ((a -&gt; a -&gt; b) -&gt; a -&gt; b)\n    (:$) :: Comb (a -&gt; b) -&gt; Comb a -&gt; Comb b\n</code></pre>\n\n<p>What I'm trying to do now is define a way to read combinator strings in from the user at runtime. Obviously, I need an existential type to do this, since the GADT's type information needs to be hidden.</p>\n\n<pre><code>data CombBox = forall a. CombBox { unCombBox :: Comb a }\n\n($$) :: CombBox -&gt; CombBox -&gt; Maybe CombBox\nx $$ y = undefined -- ???\n</code></pre>\n\n<p>I would like the <code>($$)</code> function to somehow \"look inside\" the <code>CombBox</code> existentials at runtime and, if it is possible to combine the two combinators using <code>:$</code> and get a well-typed result, I would like the result to be that. Otherwise, I want <code>Nothing</code>. So, for example,</p>\n\n<pre><code>CombBox S $$ CombBox K ==&gt; Just (CombBox (S :$ K))\nCombBox W $$ CombBox I ==&gt; Nothing\n</code></pre>\n\n<p>The latter should fail because <code>W</code> expects a 2-ary function where <code>I</code> takes one argument. But I would like to relegate this check to the runtime, and I'm not sure if such a thing is possible in the Haskell (+ GHC extensions) type system.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1466840332, "post_id": 38024087, "comment_id": 63492902, "body": "...which is what GHC was suggesting in &quot;Probable fix: use a type annotation to specify what \u2018t0\u2019 should be.&quot;"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466867561, "post_id": 38024087, "comment_id": 63499911, "body": "@chi Yes it does, but GHC&#39;s error messages seem a bit cryptic at the beginning, at least IMO."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 3, "last_activity_date": 1466818255, "last_edit_date": 1466818255, "creation_date": 1466817831, "answer_id": 38024087, "question_id": 38024043, "link": "https://stackoverflow.com/questions/38024043/print-out-a-char-in-main-method/38024087#38024087", "title": "Print out a char in main method", "body": "<p>You should just rename <code>call</code> to <code>c</code>.</p>\n\n<p>EDIT: Try annotating <code>2.0</code> as <code>Double</code>:</p>\n\n<pre><code>print $ c (2.0 :: Double)\n</code></pre>\n\n<p>GHC doesn't know which type to use for <code>2.0</code>, it could be any <code>Fractional</code> type. To fix this we force <code>2.0</code> to be of type <code>Double</code> by explicitly marking its type.</p>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 38024087, "answer_count": 1, "score": 0, "last_activity_date": 1466818255, "creation_date": 1466817337, "last_edit_date": 1466818039, "question_id": 38024043, "link": "https://stackoverflow.com/questions/38024043/print-out-a-char-in-main-method", "title": "Print out a char in main method", "body": "<p>I have two modules defined as follows:</p>\n\n<p>Foo.hs</p>\n\n<pre><code>module Foo\nwhere\n\nclass F t where\n  c :: t -&gt; Char\n\ninstance F Double where\n  c s = 'x'\n</code></pre>\n\n<p>Main.hs</p>\n\n<pre><code>import Foo\n\nmain :: IO ()\nmain =  do\n  print $ (c 2.0)\n</code></pre>\n\n<p>When I compile these two modules I get this error:</p>\n\n<pre><code>ghc Foo.hs Main.hs \n[1 of 2] Compiling Foo              ( Foo.hs, Foo.o )\n[2 of 2] Compiling Main             ( Main.hs, Main.o )\n\nMain.hs:6:12: error:\n    \u2022 Ambiguous type variable \u2018t0\u2019 arising from a use of \u2018c\u2019\n      prevents the constraint \u2018(F t0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018t0\u2019 should be.\n      These potential instance exist:\n        instance [safe] F Double -- Defined in \u2018Foo\u2019\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018(c 2.0)\u2019\n      In a stmt of a 'do' block: print $ (c 2.0)\n      In the expression: do { print $ (c 2.0) }\n\nMain.hs:6:14: error:\n    \u2022 Ambiguous type variable \u2018t0\u2019 arising from the literal \u20182.0\u2019\n      prevents the constraint \u2018(Fractional t0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018t0\u2019 should be.\n      These potential instances exist:\n        instance Fractional Double -- Defined in \u2018GHC.Float\u2019\n        instance Fractional Float -- Defined in \u2018GHC.Float\u2019\n        ...plus one instance involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the first argument of \u2018c\u2019, namely \u20182.0\u2019\n      In the second argument of \u2018($)\u2019, namely \u2018(c 2.0)\u2019\n      In a stmt of a 'do' block: print $ (c 2.0)\n</code></pre>\n\n<p>How do I fix this so it prints out 'x'?</p>\n"}, {"tags": ["scala", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466803800, "post_id": 38022322, "comment_id": 63486440, "body": "You can&#39;t <code>curry</code> a <code>Function1</code>."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466803976, "post_id": 38022322, "comment_id": 63486498, "body": "please explain what that means"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466804139, "post_id": 38022322, "comment_id": 63486557, "body": "I don&#39;t know any Scala, but I reckon it means you need something like <code>curry(fn:((_,_) =&gt; _)) = (fn _).curried</code>."}, {"owner": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466804153, "post_id": 38022322, "comment_id": 63486561, "body": "<code>_ =&gt; _</code> is a <code>Function1</code>, <code>( _ , _ ) =&gt; _</code> is a <code>Function2</code> and so forth."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1466804671, "post_id": 38022322, "comment_id": 63486742, "body": "I need to curry a function that has N arguments. Thats what I was trying to describe... please see the update question"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466804824, "post_id": 38022322, "comment_id": 63486789, "body": "@BrianKent also, your answer doesnt compile. did you test it out before posting?"}, {"owner": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466804947, "post_id": 38022322, "comment_id": 63486824, "body": "If you have a Function2 or higher then you can just call .curried"}, {"owner": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466805058, "post_id": 38022322, "comment_id": 63486850, "body": "The wonky (f _) syntax is just to turn a method into a function."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466805206, "post_id": 38022322, "comment_id": 63486898, "body": "So... if you read my update youll see that calling <code>curried</code> on a Function2 threw an error. What am I doing wrong? @BrianKent"}, {"owner": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466805294, "post_id": 38022322, "comment_id": 63486924, "body": "Try doing fn.curried"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1466805493, "post_id": 38022322, "comment_id": 63486980, "body": "How do I curry a function that has N arguments? @BrianKent"}], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1466912016, "post_id": 38022753, "comment_id": 63509908, "body": "this is... extremely verbose. Being a scala newbie can you clarify some things? What is a <code>sealed</code> trait? Why are some arguments in square brackets?  What is Shapeless?"}, {"owner": {"reputation": 39390, "user_id": 21755, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8d1dc85bd2d8ed3a2074b9728fbdaa55?s=128&d=identicon&r=PG", "display_name": "The Archetypal Paul", "link": "https://stackoverflow.com/users/21755/the-archetypal-paul"}, "edited": false, "score": 2, "creation_date": 1466926668, "post_id": 38022753, "comment_id": 63512298, "body": "You&#39;re trying to run before you can walk. If you really don&#39;t understand what type-parameters (the &quot;arguments in square brackets&quot;) are, it&#39;s probably a bit premature to be trying to write a general function-currier. Shapeless: <a href=\"https://github.com/milessabin/shapeless\" rel=\"nofollow noreferrer\">github.com/milessabin/shapeless</a>"}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1466967286, "post_id": 38022753, "comment_id": 63523975, "body": "@dopatraman - Paul&#39;s right.  You&#39;ve asked to do something that isn&#39;t really newbie-accessible.  The newbie-level answer is: you can&#39;t, since Scala (like many languages) does not abstract over function arity (i.e. the number of parameters).  The actual answer is: you can write the abstracting code yourself if you know what you&#39;re doing.  Good incentive to move from being a newbie to not, even if it doesn&#39;t solve the problem you have right now!"}], "tags": [], "owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "is_accepted": false, "score": 7, "last_activity_date": 1466807143, "last_edit_date": 1466807143, "creation_date": 1466805884, "answer_id": 38022753, "question_id": 38022322, "link": "https://stackoverflow.com/questions/38022322/writing-a-function-to-curry-any-function/38022753#38022753", "title": "Writing a function to curry any function", "body": "<p>Scala doesn't allow you to abstract over the arity of a function.  Thus, you need to use a typeclass-style approach (which allows you to abstract over just about anything, after you do all the manual work for it).</p>\n\n<p>So, in particular, you do something like</p>\n\n<pre><code>sealed trait FunctionCurrier[Unc, Cur] { def apply(fn: Unc): Cur }\nfinal class Function2Currier[A, B, Z]\nextends FunctionCurrier[(A, B) =&gt; Z, A =&gt; B =&gt; Z] {\n  def apply(fn: (A, B) =&gt; Z): (A =&gt; B =&gt; Z) = fn.curried\n}\n// Repeat for Function3 through Function21\n\nimplicit def makeCurrierForFunction2[A, B, Z]: Function2Currier[A, B, Z] =\n  new Function2Currier[A, B, Z]\n// Again, repeat for Function3 through Function21\n\ndef curryAll[Unc, Cur](fn: Unc)(implicit cf: FunctionCurrier[Unc, Cur]): Cur =\n  cf(fn)\n</code></pre>\n\n<p>Now you can use it like so:</p>\n\n<pre><code>scala&gt; def foo(a: Int, b: String) = a &lt; b.length\nfoo: (a: Int, b: String)Boolean\n\nscala&gt; curryAll(foo _)\nres0: Int =&gt; (String =&gt; Boolean) = &lt;function1&gt;\n</code></pre>\n\n<p>There is probably already something like this in Shapeless, but in this case you can roll your own, albeit with some tedium (and/or a code generator).</p>\n\n<p>(Note: if you want to \"curry\" <code>A =&gt; Z</code>, you can write a <code>Function1Currier</code> that just returns the function untouched.)</p>\n"}, {"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1466911910, "post_id": 38022910, "comment_id": 63509885, "body": "Can you please provide a complete example? <code>fn</code> would be undefined here."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1467039141, "post_id": 38022910, "comment_id": 63552725, "body": "I need one function that returns a curried FunctionN. This is not that."}], "tags": [], "owner": {"reputation": 181, "user_id": 6457000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/440f1fbcf86a084c1cfd35aa584e1d5d?s=128&d=identicon&r=PG&f=1", "display_name": "robot1208", "link": "https://stackoverflow.com/users/6457000/robot1208"}, "is_accepted": false, "score": 0, "last_activity_date": 1466945530, "last_edit_date": 1466945530, "creation_date": 1466806916, "answer_id": 38022910, "question_id": 38022322, "link": "https://stackoverflow.com/questions/38022322/writing-a-function-to-curry-any-function/38022910#38022910", "title": "Writing a function to curry any function", "body": "<p>This can be done using the <code>curried</code> method of functions.  You need to access the function itself as a partially applied function and get its curried form, like so:</p>\n\n<pre><code>def fn(i: Int, j: Int) = i + j\n\nval fnCurryable = (fn _).curried\n\nval fnCurried = fnCurryable(1)\nprintln(fnCurried(2))\n//prints 3\n</code></pre>\n\n<p>The same second line would work to curry any function with 2-22 arguments due to scala's powerful type inference.  Also, remember that you can declare your functions to be curryable in their declaration.  This would do the same as above:</p>\n\n<pre><code>def fnCurryable(i: Int)(j: Int) = i + j\n</code></pre>\n\n<p>The use of multiple argument lists means this function is called as <code>fnCurryable(1)(2)</code> and can NEVER be called as <code>fnCurryable(1, 2)</code>.  This conversion is basically what <code>.curried</code> does.\nThis is based on the function traits described on:</p>\n\n<p><a href=\"http://www.scala-lang.org/api/2.11.8/index.html#scala.package\" rel=\"nofollow\">http://www.scala-lang.org/api/2.11.8/index.html#scala.package</a></p>\n"}, {"tags": [], "owner": {"reputation": 512, "user_id": 3435266, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ubkb3.png?s=128&g=1", "display_name": "Aaron Rumery", "link": "https://stackoverflow.com/users/3435266/aaron-rumery"}, "is_accepted": false, "score": 0, "last_activity_date": 1554561971, "last_edit_date": 1554561971, "creation_date": 1554560983, "answer_id": 55550076, "question_id": 38022322, "link": "https://stackoverflow.com/questions/38022322/writing-a-function-to-curry-any-function/55550076#55550076", "title": "Writing a function to curry any function", "body": "<pre><code>def toCurry[A](f: (A, A) =&gt; A): A =&gt; A =&gt; A = x =&gt; f(x, _)\nval addTwoNum = (x: Int, y: Int) =&gt; x + y\nval curriedAddTwoNum = toCurry(addTwoNum)\nval part1Curry = curriedAddTwoNum(5)\nprintln(part1Curry(2))\n</code></pre>\n\n<p>For additional arity, you would simply need to add additional params to the above function definition.</p>\n\n<p>Otherwise, you may want to do something like <a href=\"https://stackoverflow.com/questions/13778545/can-you-curry-a-function-with-varargs-in-scala\">Can you curry a function with varargs in scala?</a></p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1554561971, "creation_date": 1466803403, "last_edit_date": 1466804777, "question_id": 38022322, "link": "https://stackoverflow.com/questions/38022322/writing-a-function-to-curry-any-function", "title": "Writing a function to curry any function", "body": "<p>For the record I find it very annoying that functions are not automatically curried in Scala. I'm trying to write a factory that takes in any function and returns a curried version:</p>\n\n<pre><code>def curry(fn:(_ =&gt; _)) = (fn _).curried\n</code></pre>\n\n<p>Basically what I have defined here is a function <code>curry</code> that takes as an argument a function <code>fn</code> that is of type <code>_ =&gt; _</code> and returns a curried version of function <code>fn</code>. Obviously this didnt work because Java.</p>\n\n<p>This was the error I got:</p>\n\n<pre><code>error: _ must follow method; cannot follow fn.type\n       def curry(fn:(_ =&gt; _)) = (fn _).curried\n</code></pre>\n\n<p>Can any gurus out there help me figure out why this doesnt work? I don't mean to sound snarky, I am used to functional languages treating all types as functions. Please help this Scala newbie.</p>\n\n<p>(I tagged this question with haskell because I'm trying to get Scala functions to behave like Haskell functions :'(</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Just to clarify, I need a <code>curryN</code> function, so a function that curries any other function regardless of its arity.</p>\n\n<p>Side note, some people have pointed out that increasing the number of fn's arguments would solve the problem. Nope:</p>\n\n<pre><code>def curry2(fn:((_, _) =&gt; _)) = (fn _).curried\nerror: _ must follow method; cannot follow fn.type\n       def curry2(fn:((_, _) =&gt; _)) = (fn _).curried\n</code></pre>\n"}, {"tags": ["haskell", "arrows"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1466800640, "post_id": 38021337, "comment_id": 63485174, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/5836640/are-there-human-friendly-names-for-applicative-and-friends-methods\">Are there human-friendly names for applicative (and friends) methods?</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1466801178, "post_id": 38021337, "comment_id": 63485390, "body": "Although the proposed duplicate asks about <code>***</code> and <code>&amp;&amp;&amp;</code>, none of the answers to that question addresses them. The author of the question makes a guess that you might consider an answer, though."}, {"owner": {"reputation": 49634, "user_id": 8372853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GzQid.png?s=128&g=1", "display_name": "cigien", "link": "https://stackoverflow.com/users/8372853/cigien"}, "edited": false, "score": 2, "creation_date": 1605287105, "post_id": 38021337, "comment_id": 114613248, "body": "I\u2019m voting to close this question because this is an opinion based question, and is not a programming question."}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 6, "last_activity_date": 1466849234, "last_edit_date": 1466849234, "creation_date": 1466802987, "answer_id": 38022240, "question_id": 38021337, "link": "https://stackoverflow.com/questions/38021337/what-are-the-real-names-of-haskells-arrow-operators/38022240#38022240", "title": "What are the &#39;real&#39; names of Haskell&#39;s Arrow operators?", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#v:-42--42--42-\" rel=\"nofollow\"><code>Control.Arrow</code></a> calls them \"split\" and \"fanout\". That's the closest you'll get for official names.</p>\n\n<p>However, in the particular case of arrows, I tend to think of them in terms of factory machines connected with conveyor belts. This gives you a very rich vocabulary if you start with defining the phonemes (not necessarily the actual functions)</p>\n\n<pre><code>belt = id\npipe-into = (.)\ndupe = belt &amp;&amp;&amp; belt\nnext-to = (***)\nprocess-with = arr\n</code></pre>\n\n<p>In this vocabulary you pronounce <code>first a</code> as \"<code>a</code> next to a <code>belt</code>\" and <code>second a</code> as \"a <code>belt</code> next-to <code>a</code>\", while <code>a &amp;&amp;&amp; b</code>  becomes \"a <code>dupe</code> piped into (an <code>a</code> next to a <code>b</code>).\" </p>\n\n<p>It also gives a nice visualization of ArrowApply; the factory machines can ArrowApply when there is some machine which takes in two conveyor belts: one for other machines, and one for objects that fit into the first machine. This machine stuffs the incoming object into the incoming machine, emits whatever the first machine emits, then throws the machine away.</p>\n\n<p>It also gives a less-nice visualization of ArrowLoop in terms of giving the factory a magic box, then incrementally asking the factory to commit to some of the structure of what's inside the magic box (possibly providing more magic boxes for it to use), then making the committed structure magically available when the box is opened.</p>\n"}], "owner": {"reputation": 849, "user_id": 2389405, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/12t9F.jpg?s=128&g=1", "display_name": "RvanHeest", "link": "https://stackoverflow.com/users/2389405/rvanheest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "closed_date": 1605370352, "accepted_answer_id": 38022240, "answer_count": 1, "score": 1, "last_activity_date": 1466849234, "creation_date": 1466798935, "question_id": 38021337, "link": "https://stackoverflow.com/questions/38021337/what-are-the-real-names-of-haskells-arrow-operators", "closed_reason": "Not suitable for this site", "title": "What are the &#39;real&#39; names of Haskell&#39;s Arrow operators?", "body": "<p>In 1998 John Hughes proposed the Arrow type class for Haskell in <a href=\"http://www.cse.chalmers.se/~rjmh/Papers/arrows.pdf\" rel=\"nofollow\">this paper</a>. This type class came with a number of operators that are 'non-alpha-numeric', like <code>***</code> and <code>&amp;&amp;&amp;</code>. He however does not give a pronounceable name for these operators.</p>\n\n<p>Haskell's Monad type class has a similar thing going on with <code>&gt;&gt;=</code>, which is pronounced as <code>bind</code>.</p>\n\n<p>My question is how to pronounce the Arrow operators <code>***</code> and <code>&amp;&amp;&amp;</code>. Or do they even have pronounceable names? How do Haskellers refer to these operators in conversations?</p>\n"}, {"tags": ["haskell", "ghci", "hmatrix"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1466822859, "creation_date": 1466822859, "answer_id": 38024461, "question_id": 38021258, "link": "https://stackoverflow.com/questions/38021258/how-to-remove-commas-and-brackets-from-a-list-hmatrix/38024461#38024461", "title": "How to remove commas and brackets from a list ( hmatrix )", "body": "<p>This will print out the matrix with each row on its own line:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport Numeric.LinearAlgebra\n\nm :: Matrix Double\nm = (5&gt;&lt;2)\n [   0.12130139101653795, -3.9532277879855915e-2\n , -9.943512129289413e-2, -1.8736674261187188e-2\n ,   0.21650870755682688,  -7.774998273846949e-3\n ,  -0.19540767578866855,  -4.889335919164774e-2\n , -4.296730149180415e-2,    0.11493730960653939 ]\n\nprintMatrix m = do\n  putStrLn $ unlines $ map (unwords . map show . toList )  (toRows m)\n\ntest = printMatrix m\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6510571"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 38024461, "answer_count": 1, "score": 0, "last_activity_date": 1537793234, "creation_date": 1466798538, "last_edit_date": 1537793234, "question_id": 38021258, "link": "https://stackoverflow.com/questions/38021258/how-to-remove-commas-and-brackets-from-a-list-hmatrix", "title": "How to remove commas and brackets from a list ( hmatrix )", "body": "<h3>For plotting a graphic in gnuplot</h3>\n\n<p>I'm trying to print this matrix into a file, but for it to be executed into gnuplot I need to create a file without the commas and brackets, how do I do that?</p>\n\n<pre><code>*install hmatrix\n*install hmatrix-special\n*import Numeric.LinearAlgebra\n\n(5&gt;&lt;2)\n [   0.12130139101653795, -3.9532277879855915e-2\n , -9.943512129289413e-2, -1.8736674261187188e-2\n ,   0.21650870755682688,  -7.774998273846949e-3\n ,  -0.19540767578866855,  -4.889335919164774e-2\n , -4.296730149180415e-2,    0.11493730960653939 ]\n</code></pre>\n"}, {"tags": ["haskell", "set"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1466797019, "post_id": 38020734, "comment_id": 63483571, "body": "so you have a list that contains 5-uples? like <code>[(1,2,3,4,5), (6,7,8,9,10), ...]</code> and you want <code>mySet n</code> to return a subset of this list depending on a predicate <code>P</code>? Then why aren&#39;t you writing <code>[x | x &lt;- originalList, predicate x]</code> to check one tuple at a time?  Or is the <code>5</code> in <code>5-uple</code> parametric? In this case note that you actually cannot do anything really generic because <code>3</code>-uples are a different type from <code>5</code>-uples."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1466797325, "post_id": 38020734, "comment_id": 63483716, "body": "Please show us the type signatures of that list you&#39;ve already written code to generate and the one you&#39;re trying to build."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1466797379, "post_id": 38020734, "comment_id": 63483744, "body": "Hmmm, wording sounds a lot like <a href=\"http://stackoverflow.com/questions/37949703/haskell-generate-list-of-lists\" title=\"haskell generate list of lists\">stackoverflow.com/questions/37949703/&hellip;</a> before the edit..."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466798399, "post_id": 38020734, "comment_id": 63484201, "body": "@user348307 Put relevant information in the question itself, not in a comment below."}, {"owner": {"reputation": 21, "user_id": 6510445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd0c81f323e782b00f81b80695f59b96?s=128&d=identicon&r=PG", "display_name": "user348307", "link": "https://stackoverflow.com/users/6510445/user348307"}, "edited": false, "score": 0, "creation_date": 1466798858, "post_id": 38020734, "comment_id": 63484392, "body": "@ melpomene sorry I&#39;ll fix that"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466799692, "post_id": 38020734, "comment_id": 63484751, "body": "Perhaps, you can adapt <code>[ [ (x,y) | x &lt;- [1..y] ] | y &lt;- [1..10] ]</code> to your needs."}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 1, "last_activity_date": 1466801299, "creation_date": 1466801299, "answer_id": 38021896, "question_id": 38020734, "link": "https://stackoverflow.com/questions/38020734/generating-a-list-of-lists-in-haskell/38021896#38021896", "title": "Generating a list of lists in Haskell", "body": "<p>You haven't told us precisely how you want to do this, so we're left speculating, but a function that I have defined many times to do a very similar task takes a list of elements and breaks it into sublists of a certain size:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>chunkify :: Int -&gt; [x] -&gt; [[x]]\nchunkify n [] = []\nchunkify n list = chunk : chunkify n rest \n    where (chunk, rest) = splitAt n list\n</code></pre>\n\n<p>You could then take your 12 <em>n</em><sup>4</sup> tuples coming from <code>firstList n</code> and split them into 12 <em>n</em><sup>3</sup> lists of length <em>n</em> via:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>myLists n = chunkify n (firstList n)\n</code></pre>\n\n<p>Or if you really want to be pointfree, that's just <code>myLists = chunkify &lt;*&gt; firstList</code> because <code>(Int -&gt;)</code> is an instance of a Reader-like applicative functor and the above <code>&lt;*&gt;</code> is defined for applicative functors in <code>Prelude</code> and/or <code>Control.Applicative</code>, depending on what version of GHC you're running.</p>\n\n<p>If you want something more sophisticated you'll have to let us know; we're not mind-readers.</p>\n"}], "owner": {"reputation": 21, "user_id": 6510445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd0c81f323e782b00f81b80695f59b96?s=128&d=identicon&r=PG", "display_name": "user348307", "link": "https://stackoverflow.com/users/6510445/user348307"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1466801969, "creation_date": 1466796315, "last_edit_date": 1466801969, "question_id": 38020734, "link": "https://stackoverflow.com/questions/38020734/generating-a-list-of-lists-in-haskell", "title": "Generating a list of lists in Haskell", "body": "<p>I'm trying to create a function that generates a set of sets of tuples, but I'm new to Haskell and don't know how to implement it. Here's pseudocode of what I'd like my code to do (I'll use {} to denote set):</p>\n\n<pre><code>mySet :: Int -&gt; {{(Int,Int,Int,Int,Int)}}\nmySet n = { {a_1,a_2,...,a_n} | P(a_1,a_2,...,a_n) }\n</code></pre>\n\n<p>The part I've written so far is the list that I'm taking each a_i from. The code is</p>\n\n<pre><code>firstList :: Int -&gt; [(Int,Int,Int,Int,Int)]\nfirstList n = [(a,b,c,d,e) | a &lt;- [0,1,(-1)], b &lt;- [1..n], c &lt;- [1..(2*n)], d &lt;- [1..n], e &lt;- [1..(2*n)]]\n</code></pre>\n\n<p>Basically, I want to have mySet take from the list of the form</p>\n\n<pre><code>[(a1,a2,a3,a4,a5),(b1,b2,b3,b4,b5),...]\n</code></pre>\n\n<p>and create a list (or set, actually) that, for example when n=3, looks like</p>\n\n<pre><code>[[(a1,a2,a3,a4,a5),(b1,b2,b3,b4,b5),(c1,c2,c3,c4,c5)],[(d1,d2,d3,d4,d5),(e1,e2,e3,e4,e5),(f1,f2,f3,f4,f5)],...]\n</code></pre>\n\n<p>As far as implementations go, I'd prefer readability over speed, but ideally I'd like both.</p>\n"}, {"tags": ["haskell", "module", "package", "ghc", "compiler-optimization"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1466794660, "post_id": 38019758, "comment_id": 63482485, "body": "Possibly relevant: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/phases.html#ghc-flag--split-objs\" rel=\"nofollow noreferrer\">split-objs</a>"}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 3, "creation_date": 1466795416, "post_id": 38019758, "comment_id": 63482859, "body": "If I recall correctly, it depends if the end result is statically linked or dynamically linked.... For dynamically linked - no. You have to include all of the <code>.so</code> files. For statically linked, I remember that only the relevant symbols are in the end result."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1466795761, "post_id": 38019758, "comment_id": 63483003, "body": "@chi The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/phases.html#ghc-flag--split-sections\" rel=\"nofollow noreferrer\"><code>split-sections</code></a> right below seems about what Petr is thinking."}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1466938168, "post_id": 38019758, "comment_id": 63515149, "body": "@Bakuriu technically both of you are correct. <code>split-sections</code> is replacing <code>split-objs</code> but <code>split-sections</code> is not supported yet on all platforms (Windows support will be finished by 8.2.1)"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1466792203, "creation_date": 1466792203, "question_id": 38019758, "link": "https://stackoverflow.com/questions/38019758/does-ghc-optimize-away-unused-code-and-packages", "title": "Does GHC optimize away unused code and packages?", "body": "<p>Let's say a big package is included to a project and only one function from the package is used, is the rest of the code optimized away when compiling the final binary?</p>\n\n<p>And If a package is included, but at the end it's never used (for example it's used to import a type by another library that's never used in the end), is the whole package stripped?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466788197, "post_id": 38018587, "comment_id": 63479260, "body": "Enable <code>-Wall</code> and check warnings. (It could be tabs vs spaces)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466788265, "post_id": 38018587, "comment_id": 63479295, "body": "Also <code>case ... of func2 vv -&gt;</code> is not valid (<code>func2 vv</code> is not a pattern)"}, {"owner": {"reputation": 5617, "user_id": 1696863, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/135f816584030598b25d11bc2da6bc8a?s=128&d=identicon&r=PG", "display_name": "Ankush", "link": "https://stackoverflow.com/users/1696863/ankush"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466788311, "post_id": 38018587, "comment_id": 63479318, "body": "func2 is actually a data type"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1466788443, "post_id": 38018587, "comment_id": 63479376, "body": "Show your actual code and the actual error message, please."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1466788467, "post_id": 38018587, "comment_id": 63479390, "body": "<code>type</code> is a keyword and you are using it incorrectly."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466788468, "post_id": 38018587, "comment_id": 63479391, "body": "A data type is not a pattern."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466788592, "post_id": 38018587, "comment_id": 63479453, "body": "Also, the guard <code>a == []</code> is an antipattern. You probably want <code>func [] b = ... ; func (x:xs) b = ...</code>. You should use guards only as a last resort, and prefer pattern matching when possible."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466788676, "post_id": 38018587, "comment_id": 63479484, "body": "@chi Even if you had to use a guard, <code>null a</code> would be better because it doesn&#39;t require an <code>Eq</code> constraint."}, {"owner": {"reputation": 5617, "user_id": 1696863, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/135f816584030598b25d11bc2da6bc8a?s=128&d=identicon&r=PG", "display_name": "Ankush", "link": "https://stackoverflow.com/users/1696863/ankush"}, "edited": false, "score": 0, "creation_date": 1466788720, "post_id": 38018587, "comment_id": 63479505, "body": "I have edited the question to include the actual code"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1466788817, "post_id": 38018587, "comment_id": 63479560, "body": "You have an unmatched <code>(</code> in <code>(H.insert</code>"}, {"owner": {"reputation": 5617, "user_id": 1696863, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/135f816584030598b25d11bc2da6bc8a?s=128&d=identicon&r=PG", "display_name": "Ankush", "link": "https://stackoverflow.com/users/1696863/ankush"}, "edited": false, "score": 0, "creation_date": 1466789143, "post_id": 38018587, "comment_id": 63479712, "body": "Oh! Well thanks for that! My brain just refuses to find those errors. Also where do I put the -Wall argument to check the warnings?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466789465, "post_id": 38018587, "comment_id": 63479871, "body": "@Ankush How are you running your code?"}, {"owner": {"reputation": 5617, "user_id": 1696863, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/135f816584030598b25d11bc2da6bc8a?s=128&d=identicon&r=PG", "display_name": "Ankush", "link": "https://stackoverflow.com/users/1696863/ankush"}, "edited": false, "score": 0, "creation_date": 1466789891, "post_id": 38018587, "comment_id": 63480080, "body": "using ghci. I&#39;m not really sure how the code compiles though"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466793223, "post_id": 38018587, "comment_id": 63481714, "body": "You can either invoke <code>ghci -Wall</code> or add at the top of the file <code>{-# OPTIONS -Wall #-}</code>"}], "owner": {"reputation": 5617, "user_id": 1696863, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/135f816584030598b25d11bc2da6bc8a?s=128&d=identicon&r=PG", "display_name": "Ankush", "link": "https://stackoverflow.com/users/1696863/ankush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1466788690, "creation_date": 1466787492, "last_edit_date": 1466788690, "question_id": 38018587, "link": "https://stackoverflow.com/questions/38018587/haskell-indentation-parse-error", "title": "Haskell indentation - parse error", "body": "<p>I have a function which looks like this:</p>\n\n<pre><code>eval (AppExp e1 e2) env | e2 == [] =\n                            case (eval e1 env) of\n                                CloVal vv e3 cenv -&gt; eval e3 cenv\n                                _  -&gt; ExnVal \"Apply to non-closure\"\n                        | otherwise =\n                            case (eval e1 env) of\n                              CloVal vv e3 cenv -&gt; let (e:es) = e2\n                                                   in case vv of\n                                                       [v]  -&gt; eval e3 (H.insert v (eval e env) cenv)\n                                                       v:vs -&gt; eval (AppExp (FunExp vs e3) es) (H.insert v (eval e env) cenv\n                              _ -&gt; ExnVal \"Apply to non-closure\"\n</code></pre>\n\n<p>However I get an indentation error on the last line. I can't figure out why. </p>\n"}, {"tags": ["haskell", "ffi", "bytestring"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466793117, "post_id": 38018117, "comment_id": 63481673, "body": "Wouldn&#39;t that break purity? Even if it&#39;s in IO, we can&#39;t usually change e.g. <code>x :: Int</code> to a different value..."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466793245, "post_id": 38018117, "comment_id": 63481724, "body": "@chi We&#39;re copying into <code>ptr</code>, leaving ByteString <code>src</code> intact, so if <code>ptr</code> is correctly handled, there won&#39;t be purity violations. But now I see the title might be a bit misleading, I&#39;ll update it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466794451, "post_id": 38018117, "comment_id": 63482375, "body": "Ah, now I see. You want to modify what the <code>ptr</code> points to, not the ByteString. I misread."}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1466793400, "creation_date": 1466785782, "last_edit_date": 1466793400, "question_id": 38018117, "link": "https://stackoverflow.com/questions/38018117/how-to-efficiently-poke-a-bytestring-value-of-a-given-length-at-a-ptr", "title": "How to efficiently &quot;poke&quot; a ByteString value of a given length at a Ptr?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Storable.html#v:peek\" rel=\"nofollow\">\"Peeking\"</a>, to read a pointer <code>ptr</code> to  a new <code>ByteString</code>, is straightforward:</p>\n\n<pre><code>BS.packCStringLen (ptr, size)\n</code></pre>\n\n<p>But the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Storable.html#v:poke\" rel=\"nofollow\"><code>poke</code></a> operation (writing a <code>ByteString</code> into a given memory location) isn't that obvious. We have</p>\n\n<pre><code>useAsCStringLen :: ByteString -&gt; (CStringLen -&gt; IO a) -&gt; IO a\n</code></pre>\n\n<p>so we could do (with the help of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Foreign-Marshal-Utils.html\" rel=\"nofollow\"><code>copyBytes</code></a>.</p>\n\n<pre><code>BS.useAsCStringLen bs $ \\(src, len) -&gt; copyBytes ptr src len\n</code></pre>\n\n<p>or for better performance <code>unsafeUseAsCStringLen</code>.</p>\n\n<p>Is there perhaps a ready-made function that does the above?</p>\n"}, {"tags": ["haskell", "networking", "ip-address", "endianness"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466779926, "post_id": 38015345, "comment_id": 63474577, "body": "I guess they are in &quot;serialized&quot; format, as after C functions <code>htons, htoni,...</code> which &quot;mangle&quot; the bits to convert from host-endianness to network-endianness. They should have been <code>newtype</code>s, IMO. (Further, I really don&#39;t like a library which self-declares itself to be &quot;semi-public&quot;. Internal modules should be opaque.)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1466882284, "post_id": 38015345, "comment_id": 63504434, "body": "@Petr Pudl&#225;k - Can you at least provide some feedback on my answer?  Thanks."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1469655489, "post_id": 38015345, "comment_id": 64632857, "body": "Note the announcement of the a <a href=\"https://groups.google.com/forum/#!msg/haskell-cafe/16NHm09PZik/Bli-wzf7CAAJ\" rel=\"nofollow noreferrer\">new network package</a> which now supports <a href=\"https://github.com/haskell/network/pull/210\" rel=\"nofollow noreferrer\">conversions between HostAddresses and endian independent tuples</a>"}], "answers": [{"comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1466885179, "post_id": 38015911, "comment_id": 63505174, "body": "Thank you for the links. I examined the package and it indeed looks good. My main concern is that t&#39;s part of a bigger package that my library would have to depend on unnecessarily. Also I&#39;m somewhat unhappy with functions for (de)constructing <code>IPv4</code> and <code>IPv6</code> that they use lists instead of tuples (less type-safe), but I guess that&#39;s easy to fix with a pull request :)."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1466778788, "creation_date": 1466778788, "answer_id": 38015911, "question_id": 38015345, "link": "https://stackoverflow.com/questions/38015345/manipulating-raw-ip-addresses-in-network-and-confusion-about-byte-order/38015911#38015911", "title": "Manipulating raw IP addresses in &quot;network&quot; and confusion about byte order", "body": "<p>The <a href=\"https://hackage.haskell.org/package/iproute-1.7.0/docs/Data-IP.html\" rel=\"nofollow\"><code>Data.IP</code></a> module looks like it addresses this.</p>\n\n<p>Have a look at:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/iproute-1.7.0/docs/Data-IP.html#v:toHostAddress\" rel=\"nofollow\">toHostAddress</a></li>\n<li><a href=\"https://hackage.haskell.org/package/iproute-1.7.0/docs/Data-IP.html#v:toHostAddress6\" rel=\"nofollow\">toHostAddress6</a></li>\n</ul>\n\n<p>and the various ways of creating an IPv4 and IPv6 value.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 1, "accepted_answer_id": 38015911, "answer_count": 1, "score": 3, "last_activity_date": 1466778788, "creation_date": 1466777097, "last_edit_date": 1466777669, "question_id": 38015345, "link": "https://stackoverflow.com/questions/38015345/manipulating-raw-ip-addresses-in-network-and-confusion-about-byte-order", "title": "Manipulating raw IP addresses in &quot;network&quot; and confusion about byte order", "body": "<p>The documentation for <code>HostAddress</code> and <code>HostAddress6</code> from the <a href=\"https://hackage.haskell.org/package/network-2.6.2.1/docs/Network-Socket-Internal.html#t:HostAddress\" rel=\"nofollow\">network</a> package says:</p>\n\n<pre><code>-- | Network byte order.\ntype HostAddress = Word32\n\n-- | Host byte order.\ntype HostAddress6 = (Word32, Word32, Word32, Word32)\n</code></pre>\n\n<p>What does this byte order actually mean? After all, <code>Word32</code> should be a number independent of host <a href=\"https://en.wikipedia.org/wiki/Endianness\" rel=\"nofollow\">endianness</a>, endianness should matter only when (de)serializing it.</p>\n\n<p><strong>My goal is given an IPv4 or IPv6 address to construct the correct <code>SockAddr</code> value.</strong></p>\n\n<p>It seems that for <code>HostAddress</code> the byte order is flipped on little-endian architectures, as I <code>show $ SockAddrInet 0 0x0100007f</code> gives <code>\"127.0.0.1:0\"</code>. And <code>show $ SockAddrInet6 0 0 (0,0,0,1) 0</code> gives <code>\"[::1]:0</code> so it seems there the byte order is correct. But currently I don't have the opportunity to test it on a big-endian architecture.</p>\n"}, {"tags": ["haskell", "types", "type-systems", "curry-howard"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774191, "post_id": 38014339, "comment_id": 63470939, "body": "are you talking about a <i>unit</i> type with just one value (mod. undefined) or a real <i>void</i> type (no values beside the usual undefined)?"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466774213, "post_id": 38014339, "comment_id": 63470956, "body": "Void has no inhabitants so how can you return something of type Void."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466774282, "post_id": 38014339, "comment_id": 63470992, "body": "@pdexter well many languages uses void as a <i>special</i> replacement for a unit-type (C,Java,...)"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774317, "post_id": 38014339, "comment_id": 63471018, "body": "@Carsten right, but this question was tagged as Haskell so I assume the author is talking about Haskell&#39;s Void."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774381, "post_id": 38014339, "comment_id": 63471058, "body": "I&#39;m confused s well - anyway: I suspect this one will be closed rather quickly - I don&#39;t think it&#39;s a good fit for SO"}, {"owner": {"reputation": 480, "user_id": 5173839, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CJDcM.jpg?s=128&g=1", "display_name": "Anton3", "link": "https://stackoverflow.com/users/5173839/anton3"}, "edited": false, "score": 0, "creation_date": 1466774387, "post_id": 38014339, "comment_id": 63471065, "body": "I&#39;m talking about Haskell&#39;s Void type. Discussion is whether to replace function&#39;s noreturn attribute (for functions like fatalError) with this Void return type. In Swift, it will be called NoReturn or something like this, but in this context it does not really matter. But to do so, - and then read the question."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774466, "post_id": 38014339, "comment_id": 63471097, "body": "@Anton3 can you give an example? Because it just does not make any sense to use <i>values</i>  of type <code>Void</code> - no matter if you call them <code>NoReturn</code> or anything else - a function <code>a -&gt; Void</code> in Haskell cannot be meaningful defined"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466774521, "post_id": 38014339, "comment_id": 63471137, "body": "@Anton3 take a look at how OCaml uses the unit type (<code>unit</code>) and its only value (<code>()</code>), that would be of better use."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774552, "post_id": 38014339, "comment_id": 63471156, "body": "f# uses exactly this - it translates .net <code>void</code> results into <code>Unit</code>"}, {"owner": {"reputation": 480, "user_id": 5173839, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CJDcM.jpg?s=128&g=1", "display_name": "Anton3", "link": "https://stackoverflow.com/users/5173839/anton3"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774574, "post_id": 38014339, "comment_id": 63471167, "body": "@Carsten If function in Haskell returns Void, then it must return undefined. Then it must crash before returning. So basically, noreturn attribute from C-family is equivlent to returning Void."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774627, "post_id": 38014339, "comment_id": 63471205, "body": "it does not have to <i>crash</i> (example <code>let f :: a -&gt; Void; f x = f x</code>) - as I said it&#39;s a pointless function - totally useless (how is <i>crashing</i>  your program the same as having a <code>void</code> function in C???)"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466774675, "post_id": 38014339, "comment_id": 63471236, "body": "@Anton3 sorry, are you claiming that &#39;returning undefined&#39; in Haskell crashes the program (not necessarily true by itself) and that you want a way to tag functions in Swift which crash the program?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1466774747, "post_id": 38014339, "comment_id": 63471278, "body": "well I don&#39;t think this will get any fitting answer here - I would recommend you visit the haskell IRC or reddit channels instead"}, {"owner": {"reputation": 480, "user_id": 5173839, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CJDcM.jpg?s=128&g=1", "display_name": "Anton3", "link": "https://stackoverflow.com/users/5173839/anton3"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774841, "post_id": 38014339, "comment_id": 63471342, "body": "@Carsten I had to add a clarification to the question that by <code>Void</code> I <i>always</i> mean Haskell&#39;s Void, an empty type, and never <code>void</code> type from C family."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1466774844, "post_id": 38014339, "comment_id": 63471344, "body": "anyway if you ask my opinion: if swift wants to be functional then you should either go the <code>Unit</code> route or just stick with what you have"}, {"owner": {"reputation": 480, "user_id": 5173839, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CJDcM.jpg?s=128&g=1", "display_name": "Anton3", "link": "https://stackoverflow.com/users/5173839/anton3"}, "reply_to_user": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 0, "creation_date": 1466774997, "post_id": 38014339, "comment_id": 63471412, "body": "@pdexter Yes, but that use case is not enough, so I want other examples of using <code>Void</code>. For examples, <code>Maybe Void</code> is equivalent to <code>()</code>  (without undefined), but how can that be used? <code>Either a Void</code> is equivalent to <code>a</code>, but I again can&#39;t think of an example where that would really help."}, {"owner": {"reputation": 24443, "user_id": 100020, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/7b137a205dff52b6471dfd17158c8b8f?s=128&d=identicon&r=PG", "display_name": "sdcvvc", "link": "https://stackoverflow.com/users/100020/sdcvvc"}, "edited": false, "score": 1, "creation_date": 1467557301, "post_id": 38014339, "comment_id": 63769221, "body": "see also <a href=\"http://stackoverflow.com/questions/11968789/\">stackoverflow.com/questions/11968789</a>"}], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 5173839, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CJDcM.jpg?s=128&g=1", "display_name": "Anton3", "link": "https://stackoverflow.com/users/5173839/anton3"}, "edited": false, "score": 0, "creation_date": 1466775774, "post_id": 38014750, "comment_id": 63471895, "body": "Thank you, that really helps! Can&#39;t upvote, but accepted."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 480, "user_id": 5173839, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CJDcM.jpg?s=128&g=1", "display_name": "Anton3", "link": "https://stackoverflow.com/users/5173839/anton3"}, "edited": false, "score": 0, "creation_date": 1466780027, "post_id": 38014750, "comment_id": 63474635, "body": "@Anton3 Another way of saying that a producer doesn&#39;t stop is to leave the return type polymorphic (it can be of any type, because it is never actually returned)."}, {"owner": {"reputation": 16685, "user_id": 2289509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F51FU.jpg?s=128&g=1", "display_name": "Elazar", "link": "https://stackoverflow.com/users/2289509/elazar"}, "edited": false, "score": 0, "creation_date": 1470256856, "post_id": 38014750, "comment_id": 64880312, "body": "Thats simply because a polymorphic (independent) return type is isomorphic to Void."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 16, "last_activity_date": 1466790426, "last_edit_date": 1466790426, "creation_date": 1466775316, "answer_id": 38014750, "question_id": 38014339, "link": "https://stackoverflow.com/questions/38014339/practical-examples-of-using-void/38014750#38014750", "title": "Practical examples of using Void", "body": "<p>(Speaking of <code>Void</code> as the type with <em>no</em> values, which is different to the type with just <em>one</em> value, usually called Unit.)</p>\n\n<p>In Haskell streaming libraries like <a href=\"http://hackage.haskell.org/package/streaming\" rel=\"noreferrer\">streaming</a> or <a href=\"http://hackage.haskell.org/package/pipes\" rel=\"noreferrer\">pipes</a>, there are data types that represent \"a source of values of type <code>a</code> that, once exhausted, returns a value of type <code>r</code>\". Something like <code>Producer a m r</code> (The <code>m</code> is a base monad but that's not relevant here.)</p>\n\n<p>Having producers return with a value (of a type unrelated to the type of values they emit while running) is actually quite useful. For example, you can define a \"streaming splitter\" as a function with type:</p>\n\n<pre><code>streamingSplit :: Producer a m r -&gt; Producer a m (Producer a m r)\n</code></pre>\n\n<p>This function segments the producer without having to accumulate in memory all the elements preceding the split.</p>\n\n<p>Now, what if we want to express at the type level that a producer <em>never stops</em> producing stuff? We can make it return a value of type <code>Void</code>, like <code>Producer a m Void</code>.</p>\n\n<p>Another possible use-case. Suppose you have a higher-order function that takes a callback that might fail. Something like:</p>\n\n<pre><code>-- does something with the wrapped callback, maybe emit a log message or whatever\ntakesACallback :: (a -&gt; IO (Either e r)) -&gt; a -&gt; IO (Either e r)\n</code></pre>\n\n<p>What if we want to define a version of <code>takesACallback</code> for functions <code>a -&gt; IO r</code> that <em>never fail</em>? Getting into and out of the <code>Either</code> is a hassle, and incurs in an spurious pattern-match when getting the value out.</p>\n\n<p>Using <code>Void</code> we can start by turning the <code>a -&gt; IO r</code> into a <code>a -&gt; IO (Either Void r)</code>, pass it into <code>takesACallback</code>, and then remove the \"fake\" error branch on the Either using the <a href=\"http://hackage.haskell.org/package/void-0.7.1/docs/Data-Void.html\" rel=\"noreferrer\"><code>absurd :: Void -&gt; a</code></a> function.</p>\n\n<pre><code>takesACallback':: (a -&gt; IO r) -&gt; a -&gt; IO r\ntakesACallback' callback = fmap (either absurd id) \n                         . takesACallback (fmap Right . callback) \n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/conceit-0.4.0.0/docs/Control-Concurrent-Conceit.html#v:_runConceit\" rel=\"noreferrer\">Here</a>'s an example of this trick on Hackage.</p>\n"}], "owner": {"reputation": 480, "user_id": 5173839, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CJDcM.jpg?s=128&g=1", "display_name": "Anton3", "link": "https://stackoverflow.com/users/5173839/anton3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1424, "favorite_count": 3, "accepted_answer_id": 38014750, "answer_count": 1, "score": 9, "last_activity_date": 1466790426, "creation_date": 1466774023, "last_edit_date": 1466774684, "question_id": 38014339, "link": "https://stackoverflow.com/questions/38014339/practical-examples-of-using-void", "title": "Practical examples of using Void", "body": "<p>Edit: By <code>Void</code>, I mean Haskell's <code>Void</code> type, i.e. empty type that cannot have values but <code>undefined</code>.</p>\n\n<p>There is an ongoing discussion on Swift Evolution whether to replace <code>noreturn</code> function attribute with an actual <code>Void</code> type. To do so, we must be sure that this will bring real benefit to the platform. Using <code>Void</code> as return type is just not enough.</p>\n\n<p>So I ask you to provide very <em>practical</em> examples, where usage of <code>Void</code> adds clarity, brevity, genericity to the code. Maybe it will use classes (in Haskell sense), maybe generics, maybe it will incorporate <code>Void</code> in an ADT.</p>\n\n<p>But <em>please</em>, don't go too far into HKT, Monads, all that high-level stuff. An utility function from standard library is also a bad example. A perfect example would be part of an arcade game or something like that.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 1, "creation_date": 1466765360, "post_id": 38011129, "comment_id": 63465725, "body": "<code>compute</code> do nothing with <code>m</code> and <code>(x, y)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 261, "user_id": 4433129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ab2af71ac9525992087912fdf9b17ced?s=128&d=identicon&r=PG", "display_name": "Romeo", "link": "https://stackoverflow.com/users/4433129/romeo"}, "edited": false, "score": 0, "creation_date": 1466785390, "post_id": 38012571, "comment_id": 63477822, "body": "Following your wise explanations, I ended up writing compute <code>m (x,y) = map (filter ((&#47;=1) . fst)) (checkAround m (x,y))</code> using <code>checkAround m (x,y)</code> (as you noticed) which returns a <code>type CMatrix = [[(Int, (Int, Int))]]</code>.  Very clear and explanatory, thank you @f4st!"}], "tags": [], "owner": {"reputation": 399, "user_id": 964015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b3afdd566b092e68363ec93cf09d96?s=128&d=identicon&r=PG", "display_name": "f4st", "link": "https://stackoverflow.com/users/964015/f4st"}, "is_accepted": true, "score": 5, "last_activity_date": 1466768344, "creation_date": 1466768344, "answer_id": 38012571, "question_id": 38011129, "link": "https://stackoverflow.com/questions/38011129/filter-tuples-in-list-of-lists-haskell/38012571#38012571", "title": "Filter tuples in list of lists [Haskell]", "body": "<p>Let's take a few steps to simplify the <code>compute</code> function and figure out the problem:</p>\n\n<ol>\n<li><p>First of all, <code>[row | row &lt;- list]</code> does nothing, it's equivalent to just <code>list</code>, so we can remove it and replace it with <code>list</code>, to make the function easier to read:</p>\n\n<pre><code>compute m (x,y) = filter (\\(a,(_,_)) -&gt; a /= 1) list\n</code></pre>\n\n<p>By the way, in your message I see that <code>list</code> isn't what the argument to filter is actually called. Instead, it's a <code>checkAround m (x, y)</code>, so <code>compute</code> should probably look like this:</p>\n\n<pre><code>compute m (x,y) = filter (\\(a,(_,_)) -&gt; a /= 1) $ checkAround m (x, y)\n</code></pre></li>\n<li><p>The function you're passing to <code>filter</code> is unnecessarily complicated, we can replace it with <code>\\(a,_) -&gt; a /= 1</code> or even <code>(/=1) . fst</code> to make it less noisy. Doing that gives us:</p>\n\n<pre><code>compute m (x,y) = filter ((/=1) . fst) list\n</code></pre></li>\n<li><p>I'd say it's now much easier to see the problem. Your <code>list</code> has the type <code>[[(Int, (Int, Int))]]</code>, ie. it's a list of lists of tuples.</p>\n\n<p>But the predicate your passing into <code>filter</code> is expecting a tuple, therefore <code>filter</code> itself is expecting a list of tuples.</p>\n\n<p>This is an obvious type mismatch. How do we solve this? I don't know, that's up to you, but I guess you want to filter the inner list.</p>\n\n<p>How do we do this? Well, we need to go through each of the inner lists, filter them and put the filtered ones in a new list. This is exactly what <code>map</code> (or <code>fmap</code>) can help us with. Let's map the filter we've constructed over <code>list</code>:</p>\n\n<pre><code>compute m (x,y) = map (filter ((/=1) . fst)) list\n</code></pre></li>\n<li><p>Unfortunately, the above still gives us a type error:</p>\n\n<pre><code>Couldn't match type \u2018(Integer, (Integer, Integer))\u2019 with \u2018Int\u2019\nExpected type: [[Int]]\nActual type: [[(Integer, (Integer, Integer))]]\n</code></pre>\n\n<p>Well, why is that? We know that the <code>Actual type</code> is the type of <code>list</code> and the type of the filtered list as well, but what is the <code>Expected type</code> and why is it a <code>[[Int]]</code>?</p>\n\n<p>The answer lies in your type signature, <code>Matrix -&gt; Coordinates -&gt; Matrix</code>. <code>compute</code> is supposed to produce a list of lists of <code>Int</code>s, but we're filtering something a bit different.</p></li>\n</ol>\n\n<p>At this point I don't really know what you'd like to do, so I'll just end here, but I suspect you either need to change <code>compute</code>'s type signature or you need to somehow merge <code>m</code> with the filtered results to create a new matrix.</p>\n"}, {"tags": [], "owner": {"reputation": 8873, "user_id": 2913864, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8fd76251e7baccce47654c94e399b915?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/2913864/alan"}, "is_accepted": false, "score": 0, "last_activity_date": 1466770510, "last_edit_date": 1466770510, "creation_date": 1466770142, "answer_id": 38013124, "question_id": 38011129, "link": "https://stackoverflow.com/questions/38011129/filter-tuples-in-list-of-lists-haskell/38013124#38013124", "title": "Filter tuples in list of lists [Haskell]", "body": "<p>Is this what you are trying to do?</p>\n\n<pre><code>type SparseMatrix = [Row]\ntype Row = [Element]\ntype Element = (Int, Coordinates)\ntype Coordinates = (Int, Int)\n\nremoveRowVal :: Row -&gt; Int -&gt; Row\nremoveRowVal row i = filter ((/= i).fst) row\n\nremoveSMVal :: SparseMatrix -&gt; Int -&gt; SparseMatrix\nremoveSMVal sm i = [removeRowVal row i | row &lt;- sm]\n</code></pre>\n\n<p>Even if your <code>list</code> is not some kind of oddly structured sparse matrix representation, I think the final result is what you described.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1466770202, "creation_date": 1466770202, "answer_id": 38013147, "question_id": 38011129, "link": "https://stackoverflow.com/questions/38011129/filter-tuples-in-list-of-lists-haskell/38013147#38013147", "title": "Filter tuples in list of lists [Haskell]", "body": "<p>Problem 1: Your definition of <code>compute</code> refers to <code>list</code>, but <code>list</code> is not a parameter.</p>\n\n<p>Problem 2: If you change <code>list</code> to <code>m</code> your code is correct, but the type signature you gave is not correct.</p>\n\n<p>Solution:</p>\n\n<p>Change <code>list</code> to <code>m</code>, and don't give a type a signature:</p>\n\n<pre><code>compute m (x,y) = filter (\\(a,(_,_)) -&gt; a /= 1) [row | row &lt;- m]\n</code></pre>\n\n<p>Now ask <code>ghci</code> what the type signature should be:</p>\n\n<pre><code>ghci&gt; :t compute\ncompute\n    :: (Eq a, Num a) =&gt; [(a, (t2, t3))] -&gt; (t, t1) -&gt; [(a, (t2, t3))]\n</code></pre>\n\n<p>Now you see that that <code>type Matrix</code> should be defined as</p>\n\n<pre><code>type Matrix = [ (Int, (Int,Int) ]\n</code></pre>\n"}], "owner": {"reputation": 261, "user_id": 4433129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ab2af71ac9525992087912fdf9b17ced?s=128&d=identicon&r=PG", "display_name": "Romeo", "link": "https://stackoverflow.com/users/4433129/romeo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 38012571, "answer_count": 3, "score": 2, "last_activity_date": 1466770510, "creation_date": 1466763842, "question_id": 38011129, "link": "https://stackoverflow.com/questions/38011129/filter-tuples-in-list-of-lists-haskell", "title": "Filter tuples in list of lists [Haskell]", "body": "<p>I have a list of lists of tuples:</p>\n\n<pre><code>let list = [[(1,(2,2)),(0,(3,2)),(0,(4,2))],[(0,(2,3)),(0,(3,3)),(0,(4,3))],[(0,(2,4)),(0,(3,4)),(0,(4,4))]]\n</code></pre>\n\n<p>I would like to filter them by the first value of each tuple.\nThat's what I tried...</p>\n\n<pre><code>compute :: Matrix -&gt; Coordinates -&gt; Matrix\ncompute m (x,y) = filter (\\(a,(_,_)) -&gt; a /= 1) [row | row &lt;- list]\n</code></pre>\n\n<p>with </p>\n\n<pre><code>type Matrix = [[Int]]\ntype Coordinates = (Int, Int)\n</code></pre>\n\n<p>That's the error I got:</p>\n\n<pre><code>ContiguousRegion.hs:20:36:\nCouldn't match expected type \u2018[Int]\u2019\n            with actual type \u2018(Integer, (t0, t1))\u2019\nIn the pattern: (a, (_, _))\nIn the first argument of \u2018filter\u2019, namely\n  \u2018(\\ (a, (_, _)) -&gt; a /= 1)\u2019\nIn the expression:\n  filter\n    (\\ (a, (_, _)) -&gt; a /= 1) [row | row &lt;- checkAround m (x, y)]\n\nContiguousRegion.hs:20:58:\nCouldn't match type \u2018(Int, (Int, Int))\u2019 with \u2018Int\u2019\nExpected type: [Int]\n  Actual type: [(Int, (Int, Int))]\nIn the expression: row\nIn the second argument of \u2018filter\u2019, namely\n  \u2018[row | row &lt;- checkAround m (x, y)]\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>How can I solve this?\nThanks!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1407, "user_id": 1032171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BmTWF.png?s=128&g=1", "display_name": "liuyang1", "link": "https://stackoverflow.com/users/1032171/liuyang1"}, "edited": false, "score": 0, "creation_date": 1466739785, "post_id": 38004687, "comment_id": 63454187, "body": "Thanks! I added a function like <code>.:</code> by this style <code>(.:) f g a b = f (g a b)</code>, but your solution is better, and <code>.:</code> is vivid."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1466734811, "creation_date": 1466734811, "answer_id": 38004687, "question_id": 38004393, "link": "https://stackoverflow.com/questions/38004393/how-to-wrap-function-in-haskell/38004687#38004687", "title": "How to wrap function in haskell?", "body": "<p>If you want to write <code>addChar</code> in point-free form, it would be:</p>\n\n<pre><code>addChar = (int2Char .) . (addMod26 `on` char2Int)\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>addChar = int2Char .: (addMod26 `on` char2Int)\n</code></pre>\n\n<p>Where <code>(.:) = (.) . (.)</code>, which composes a unary function with a binary function:</p>\n\n<pre><code>(.:) :: (c -&gt; d) -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; b -&gt; d\n</code></pre>\n\n<p>You can discover these refactorings using the <a href=\"https://hackage.haskell.org/package/pointfree\" rel=\"nofollow\"><code>pointfree</code></a> tool, although its results tend to be ugly.</p>\n"}], "owner": {"reputation": 1407, "user_id": 1032171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BmTWF.png?s=128&g=1", "display_name": "liuyang1", "link": "https://stackoverflow.com/users/1032171/liuyang1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 1, "accepted_answer_id": 38004687, "answer_count": 1, "score": 3, "last_activity_date": 1466734811, "creation_date": 1466732092, "question_id": 38004393, "link": "https://stackoverflow.com/questions/38004393/how-to-wrap-function-in-haskell", "title": "How to wrap function in haskell?", "body": "<pre><code>addMod26 a b = (a + b) `mod` 26\nchar2Int c = ord c - (ord 'a')\nint2Char i = chr (i + (ord 'a'))\naddChar a b = int2Char ((addMod26 `on` char2Int) a b)\n</code></pre>\n\n<p>This code try to implement <code>add</code> operation on <code>char</code>. It work well. But function <code>addChar</code> is too redundancy. How to simplify it?</p>\n\n<p>try to write like this</p>\n\n<pre><code>addChar = int2Char . (addMod26 `on` char2Int)\n</code></pre>\n\n<p>It's wrong. <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> cannot accept <code>(b -&gt; b -&gt; c)</code> as it's first argument.</p>\n\n<p>any good idea, or suggestion?</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1466708899, "post_id": 37999771, "comment_id": 63443894, "body": "why not use <code>foldl</code>?"}, {"owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1466708979, "post_id": 37999771, "comment_id": 63443944, "body": "There was a strict rule in the description of the task to use foldr."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1466710121, "post_id": 37999771, "comment_id": 63444577, "body": "Your <code>foldr</code> definition looks like it&#39;s actually <code>foldl</code>. That would explain the reversed results."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1466709387, "creation_date": 1466709387, "answer_id": 38000003, "question_id": 37999771, "link": "https://stackoverflow.com/questions/37999771/haskell-foldr-algrebraic-datatypes/38000003#38000003", "title": "Haskell foldr algrebraic datatypes", "body": "<p>Consider this definition of <code>foldr</code> for lists, which is used for the list instance of <code>Foldable</code>.</p>\n\n<pre><code>foldr            :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr _ z []     =  z\nfoldr f z (x:xs) =  f x (foldr f z xs)\n</code></pre>\n\n<p>Now consider that your data type is isomorphic to a list.</p>\n\n<pre><code>data DQueue a = Empty | Enqueue a (DQueue a)\n\ntoList :: Dqueue a -&gt; [a]\ntoList Empty = []\ntoList (Enqueue x xs) = x : toList xs\n\nfromList :: [a] -&gt; Dqueue a\nfromList [] = Empty\nfromList (x:xs) = Enqueue x (fromList xs)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 38000003, "answer_count": 1, "score": 1, "last_activity_date": 1466709387, "creation_date": 1466708561, "question_id": 37999771, "link": "https://stackoverflow.com/questions/37999771/haskell-foldr-algrebraic-datatypes", "title": "Haskell foldr algrebraic datatypes", "body": "<p>I have solved all issues I had with functions but one is left.</p>\n\n<p>The foldr function works from last element to the first one and I need to get the data in the other order</p>\n\n<pre><code>module QueueFunctor where\n\nimport Test.HUnit (runTestTT,Test(TestLabel,TestList,TestCase),(~?=))\nimport Data.Char (toUpper)\nimport Prelude hiding (foldr)\nimport Data.Foldable (Foldable, foldr)\n\ndata DQueue a = Empty | Enqueue a (DQueue a)\n    deriving (Eq, Show, Read)\n\ninstance Foldable DQueue\n  where\n    foldr _ result Empty = result \n    foldr f result (Enqueue x xs) = foldr f (f x result) xs\n\n\n-- | Tests a few examples.\nmain :: IO ()\nmain = do\n    testresults &lt;- runTestTT tests\n    print testresults\n\n\nsample1 :: DQueue Int\nsample1 =  Enqueue 1 $ Enqueue 2 $ Enqueue 3 $ Enqueue 4 Empty\n\nsample2 :: DQueue String\nsample2 = Enqueue \"a\" $ Enqueue \"b\" $ Enqueue \"c\" $ Enqueue \"d\" Empty\n\ntests :: Test\ntests = TestLabel \"DQueueTest\" (TestList [\n        foldr (++) \"\" sample2 ~?= \"abcd\"\n    ])\n</code></pre>\n\n<p>When I compile the program, I get one error regarding tests:</p>\n\n<pre><code>### Failure in: DQueueTest:1\nQueueFunctors.hs:56\nexpected: \"abcd\"\n but got: \"dcba\"\n</code></pre>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466702401, "post_id": 37997982, "comment_id": 63439780, "body": "Partially applied type synonyms are essentially equivalent to type-level lambdas, which make the type checking algorithm much more complex. GHC does not allow them. Use <code>newtype</code>s or <code>data</code>s wrappers instead, and wrap/unwrap your values with a constructor as needed. Otherwise, switch to Agda or Coq :-P"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1466702627, "post_id": 37997982, "comment_id": 63439906, "body": "By the way, the liberal-type-synonyms rule does not give you much more flexibility, only a little. If after the expansion of all the type-synonyms, we still have partially applied ones, a type error is triggered. If you had <code>type D f = f ()</code> instead, the extension would allow for your code. But <code>D f</code> would be the same type as <code>f ()</code>."}, {"owner": {"reputation": 778, "user_id": 6499999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48bb54922bb8f6ad1b5ba41fd3e9bf1b?s=128&d=identicon&r=PG", "display_name": "JoL", "link": "https://stackoverflow.com/users/6499999/jol"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466703876, "post_id": 37997982, "comment_id": 63440761, "body": "@chi that clarifies the extension for me.  Unfortunately, in my particular problem, I can&#39;t have D be a type synonym, but I might manage with having Id and Const be newtypes. Your &quot;it&#39;s too complex for GHC&quot; comment qualifies as an answer. I might accept it if you post it as so, but maybe I should wait a little more, in case someone else wants to post too."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466705154, "post_id": 37997982, "comment_id": 63441493, "body": "<a href=\"http://stackoverflow.com/questions/24881351/why-cant-you-totally-apply-a-type-synonym-that-has-arguments-using-an-other-t\">I also fell for something like this once</a>."}, {"owner": {"reputation": 778, "user_id": 6499999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48bb54922bb8f6ad1b5ba41fd3e9bf1b?s=128&d=identicon&r=PG", "display_name": "JoL", "link": "https://stackoverflow.com/users/6499999/jol"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1466705935, "post_id": 37997982, "comment_id": 63442024, "body": "@Bakuriu looks like I posted a duplicate. I couldn&#39;t find your question. Sorry, guys."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1466723701, "post_id": 37997982, "comment_id": 63450686, "body": "@Bakuriu Both of the examples in your question compile with <code>LiberalTypeSynonyms</code>; whereas the example in this question does not compile even with <code>LiberalTypeSynonyms</code>. So I agree with you that it is related, but not with jlmg that it is a duplicate."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1466728971, "post_id": 37998227, "comment_id": 63451884, "body": "Except when it&#39;s not :(. Ed Kmett wants to add <code>liftCoercion :: Maybe (Coercion a b -&gt; Coercion (f a) (f b))</code> to the <code>Functor</code> class, and similar methods to <code>Contravariant</code>, <code>Bifunctor</code> and <code>Profunctor</code>, to make coercions more generally applicable and thus more newtypes free."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1466703427, "last_edit_date": 1466703427, "creation_date": 1466703050, "answer_id": 37998227, "question_id": 37997982, "link": "https://stackoverflow.com/questions/37997982/why-cant-type-id-a-a-be-partially-applied-to-data-d-f-d-f/37998227#37998227", "title": "Why can&#39;t type Id a = a be partially applied to data D f = D (f ())?", "body": "<p>Haskell's type system does not support partially applied (also known as <em>unsaturated</em>) type synonyms or families. <code>data</code> types and <code>newtypes</code> do support partial application, though.</p>\n\n<pre><code>newtype D f = D (f ())\nnewtype Id a = Id a\n\nd :: D Id\nd = D (Id ())\n</code></pre>\n\n<p><code>newtype</code>s are erased during compilation, so the only cost you're paying is a syntactic one.</p>\n"}], "owner": {"reputation": 778, "user_id": 6499999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48bb54922bb8f6ad1b5ba41fd3e9bf1b?s=128&d=identicon&r=PG", "display_name": "JoL", "link": "https://stackoverflow.com/users/6499999/jol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 37998227, "answer_count": 1, "score": 2, "last_activity_date": 1466703427, "creation_date": 1466702252, "last_edit_date": 1466702444, "question_id": 37997982, "link": "https://stackoverflow.com/questions/37997982/why-cant-type-id-a-a-be-partially-applied-to-data-d-f-d-f", "title": "Why can&#39;t type Id a = a be partially applied to data D f = D (f ())?", "body": "<p>I also tried the following with the LiberalTypeSynonyms extension as suggested in <a href=\"https://stackoverflow.com/questions/29462675/when-if-ever-can-type-synonyms-be-partially-applied\">When (if ever) can type synonyms be partially applied?</a>, and have added an explicit kind signiture to <code>f</code> in <code>Id</code>'s definition. I still got the same error. I don't know if there are other extensions that might help.</p>\n\n<pre><code>ghci&gt; type Id a = a\nghci&gt; type Const a b = a\nghci&gt; data D f = D (f ())\nghci&gt; (((() :: Id ()) :: ()) :: Const () a)\n()\nghci&gt; D () :: D Id\n\n&lt;interactive&gt;:10:9:\n    Type synonym \u2018Id\u2019 should have 1 argument, but has been given none\n    In an expression type signature: D Id\n    In the expression: D () :: D Id\n    In an equation for \u2018it\u2019: it = D () :: D Id\n</code></pre>\n\n<p>This really confuses me. <code>f</code> in <code>D</code> is <code>* -&gt; *</code> and <code>Id</code> is <code>* -&gt; *</code>. What more is there to this?</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 3, "creation_date": 1466701629, "post_id": 37997678, "comment_id": 63439284, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/37987890/haskell-fmap-functor\">Haskell fmap functor</a> -- You asked this question a couple hours ago."}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 2, "creation_date": 1466702084, "post_id": 37997678, "comment_id": 63439582, "body": "Please do not change the question after you have received an answer with an updated error message. It would be best to start a new question. As it stands, the current answer makes it look like they never even read the question."}, {"owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "reply_to_user": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1466702142, "post_id": 37997678, "comment_id": 63439619, "body": "Okay, I will create a new one. Sorry."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "edited": false, "score": 0, "creation_date": 1466701606, "post_id": 37997731, "comment_id": 63439268, "body": "Hm you are right, it solved issue with fmap but not with foldr."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "edited": false, "score": 0, "creation_date": 1466704374, "post_id": 37997731, "comment_id": 63441037, "body": "Take a look at <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Foldable.html\" rel=\"nofollow noreferrer\">how <code>Maybe</code> implements <code>foldr</code> for the <code>Nothing</code> constructor</a>. Your implementation will probably look similar."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 2, "last_activity_date": 1466701384, "creation_date": 1466701384, "answer_id": 37997731, "question_id": 37997678, "link": "https://stackoverflow.com/questions/37997678/haskell-fmap-foldr-for-algebraic-datastructures/37997731#37997731", "title": "Haskell fmap foldr for algebraic datastructures", "body": "<p>Both instance declarations for <code>Foldable</code> and <code>Functor</code> are missing patterns that match the <code>Empty</code> constructor.</p>\n\n<p>You'll need to add code for</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>foldr f result Empty = ...\n-- and ...\nfmap f Empty = ...\n</code></pre>\n\n<p>Non-exhaustive means that there are patterns which are unmatched which can cause your program to crash.</p>\n"}], "owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 37997731, "answer_count": 1, "score": -3, "last_activity_date": 1466702207, "creation_date": 1466701213, "last_edit_date": 1466702207, "question_id": 37997678, "link": "https://stackoverflow.com/questions/37997678/haskell-fmap-foldr-for-algebraic-datastructures", "title": "Haskell fmap foldr for algebraic datastructures", "body": "<p>I need to implement code to cover few tests but I am stucked with few small problems.</p>\n\n<p>The logic for foldr functions seem to be correct but I get an error during compiling.</p>\n\n<p>This error means that my code does not cover some cases for foldr functions.</p>\n\n<p>The code is given below:</p>\n\n<pre><code>module QueueFunctor where\n\nimport Test.HUnit (runTestTT,Test(TestLabel,TestList,TestCase),(~?=))\nimport Data.Char (toUpper)\nimport Prelude hiding (foldr)\nimport Data.Foldable (Foldable, foldr)\n\ndata DQueue a = Empty | Enqueue a (DQueue a)\n    deriving (Eq, Show, Read)\n\n\n\ninstance Functor DQueue\n      where\n        fmap f (Enqueue x xs) = (length xs == 0) then Empty else Enqueue (f x) $ fmap f xs\n\ninstance Foldable DQueue\n  where\n    foldr f result (Enqueue x xs) = if (length xs == 0) then f result Empty else foldr f (f x result) xs\n\n\n-- | Tests a few examples.\nmain :: IO ()\nmain = do\n    testresults &lt;- runTestTT tests\n    print testresults\n\n\nsample1 :: DQueue Int\nsample1 =  Enqueue 1 $ Enqueue 2 $ Enqueue 3 $ Enqueue 4 Empty\n\nsample2 :: DQueue String\nsample2 = Enqueue \"a\" $ Enqueue \"b\" $ Enqueue \"c\" $ Enqueue \"d\" Empty\n\nsample3 :: DQueue [Int]\nsample3 = Enqueue [1,2,3] $ Enqueue [4,5,6] Empty\n\ntests :: Test\ntests = TestLabel \"DQueueTest\" (TestList [\n        fmap (+1) sample1 ~?= Enqueue 2 (Enqueue 3 (Enqueue 4 (Enqueue 5 Empty))),\n        fmap (map toUpper) sample2 ~?= Enqueue \"A\" (Enqueue \"B\" (Enqueue \"C\" (Enqueue \"D\" Empty))),\n        fmap (length) sample3 ~?= Enqueue 3 (Enqueue 3 Empty),\n        foldr (+) 0 sample1 ~?= 10,\n        foldr (++) \"\" sample2 ~?= \"abcd\",\n        foldr (\\a b -&gt;(+) b (length a)) 0 sample3 ~?= 6\n    ])\n</code></pre>\n\n<p>Thank you in advance</p>\n"}, {"tags": ["haskell", "happstack"], "comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 4, "creation_date": 1466697841, "post_id": 37996610, "comment_id": 63436954, "body": "Do you know about <code>map</code> ?"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 2, "creation_date": 1466697845, "post_id": 37996610, "comment_id": 63436957, "body": "<code>map (dir . fst) data</code>"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 1, "creation_date": 1466697902, "post_id": 37996610, "comment_id": 63436988, "body": "Do you want to pull out the data, apply it, and return that list, or apply in place, returning the new value in the fst position, the original value in the snd position?  I&#39;d recommend map for the former, lenses for the latter."}, {"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1466700273, "post_id": 37996610, "comment_id": 63438421, "body": "Thanks to everyone here! <code>map</code> is very useful!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1466702767, "post_id": 37996610, "comment_id": 63440011, "body": "As an exercise, you should solve this using both <code>map</code> and explicit recursion with pattern matching. <code>f [] = ... ; f ((x,y):rest) = ...</code>"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1467917352, "post_id": 37997400, "comment_id": 63927325, "body": "a further question here: what if I want to apply map on a function that takes in two variables? For example,  I have a function called <code>doubleUs</code> here, and <code>doubleUs = x*2 + y*2</code>. And x is from list [1,2,3], y is from list [2,3,4]. How can I achieve that?"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "edited": false, "score": 0, "creation_date": 1467917487, "post_id": 37997400, "comment_id": 63927406, "body": "That&#39;s been answered a few times on this site before. Take a look at [this question(<a href=\"http://stackoverflow.com/questions/9448570/using-map-with-two-lists-rather-than-one-can-you-nest\" title=\"using map with two lists rather than one can you nest\">stackoverflow.com/questions/9448570/&hellip;</a>) as an example."}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 5, "last_activity_date": 1466700315, "creation_date": 1466700315, "answer_id": 37997400, "question_id": 37996610, "link": "https://stackoverflow.com/questions/37996610/how-to-apply-a-function-on-each-element-in-a-list-in-haskell/37997400#37997400", "title": "How to apply a function on each element in a list in Haskell?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html\" rel=\"noreferrer\"><code>map</code></a> is defined as:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>This means it is a function that takes a function that goes from type a to type b and a list of type a, and then returns a list of type b. As pointed out by @pdexter and @karakfa in the comments, this is exactly what you need. </p>\n\n<pre><code>map f list\n</code></pre>\n\n<p>So what f do you need? Well, your list is a list of tuples and you want to apply a function to the first element to each tuple, so (exactly as @karakfa pointed out) all you need is </p>\n\n<pre><code>map (dir . fst) list\n</code></pre>\n\n<p>This composes the function fst with your custom dir function to give you a new function that will take the first element of a tuple and do whatever your dir function does to it. Then map applies that over the entire list.</p>\n"}], "owner": {"reputation": 87, "user_id": 6332341, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ee066c3e3b46d2ebed941862a75ee1b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mia.M", "link": "https://stackoverflow.com/users/6332341/mia-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16890, "favorite_count": 2, "accepted_answer_id": 37997400, "answer_count": 1, "score": 1, "last_activity_date": 1466700315, "creation_date": 1466697728, "question_id": 37996610, "link": "https://stackoverflow.com/questions/37996610/how-to-apply-a-function-on-each-element-in-a-list-in-haskell", "title": "How to apply a function on each element in a list in Haskell?", "body": "<p>I have a list of tuples here, and I want to apply function <code>dir..</code>on the first element in each tuple. How can I do that? Thanks a lot in advance!</p>\n\n<pre><code>[ (\"grid\", gridResponse),\n(\"graph\", graphResponse),\n(\"image\", graphImageResponse),\n(\"timetable-image\", timetableImageResponse x),\n(\"graph-fb\",toResponse \"\"),\n(\"post-fb\",toResponse \"\"),\n(\"test\", getEmail),\n(\"test-post\", postToFacebook),\n(\"post\", postResponse),\n(\"draw\", drawResponse),                  \n(\"about\", aboutResponse),\n(\"privacy\" ,privacyResponse),\n(\"static\", serveDirectory),\n(\"course\", retrieveCourse),\n(\"all-courses\", allCourses),\n(\"graphs\", queryGraphs),\n(\"course-info\", courseInfo),\n(\"depts\", deptList),\n(\"timesearch\",searchResponse),\n(\"calendar\",calendarResponse),\n(\"get-json-data\",getGraphJSON),\n(\"loading\",loadingResponse),\n(\"save-json\", saveGraphJSON)\uff3d\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 381, "user_id": 2004975, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c9315f734465f1906d4e615b826fb3d1?s=128&d=identicon&r=PG", "display_name": "agoebel", "link": "https://stackoverflow.com/users/2004975/agoebel"}, "edited": false, "score": 0, "creation_date": 1468248762, "post_id": 37995176, "comment_id": 64036701, "body": "In this particular case, probably just use <code>readLn</code>"}], "answers": [{"comments": [{"owner": {"reputation": 381, "user_id": 2004975, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c9315f734465f1906d4e615b826fb3d1?s=128&d=identicon&r=PG", "display_name": "agoebel", "link": "https://stackoverflow.com/users/2004975/agoebel"}, "edited": false, "score": 0, "creation_date": 1466694083, "post_id": 37995262, "comment_id": 63434187, "body": "Thanks, I guess I just got stuck on the idea of having to use <code>&gt;&gt;=</code> for some reason"}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 9, "last_activity_date": 1466693931, "creation_date": 1466693931, "answer_id": 37995262, "question_id": 37995176, "link": "https://stackoverflow.com/questions/37995176/cant-figure-out-what-monad-function-im-looking-for/37995262#37995262", "title": "Can&#39;t figure out what monad function I&#39;m looking for", "body": "<p>In cases like this I just use fmap....</p>\n\n<pre><code>main = do\n    n &lt;- fmap read getLine\n    ....\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1466700642, "creation_date": 1466700642, "answer_id": 37997499, "question_id": 37995176, "link": "https://stackoverflow.com/questions/37995176/cant-figure-out-what-monad-function-im-looking-for/37997499#37997499", "title": "Can&#39;t figure out what monad function I&#39;m looking for", "body": "<p>Half-jokingly, you are looking for <code>(return.)</code>, a simple partial application of <code>(.)</code> to the <code>return</code> function. It's hardly more typing that would be required for any reasonable name that might be assigned to it:</p>\n\n<pre><code>someFunc :: Monad m =&gt; (a -&gt; b) -&gt; a -&gt; m b\nsomeFunc = (return.)\n-- or someFunc = (.)return\n</code></pre>\n\n<p>Compare</p>\n\n<pre><code>getLine &gt;&gt;= someFunc read :: IO Int\ngetLine &gt;&gt;= return.read :: IO Int\n</code></pre>\n"}], "owner": {"reputation": 381, "user_id": 2004975, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c9315f734465f1906d4e615b826fb3d1?s=128&d=identicon&r=PG", "display_name": "agoebel", "link": "https://stackoverflow.com/users/2004975/agoebel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 37997499, "answer_count": 2, "score": 1, "last_activity_date": 1466700642, "creation_date": 1466693714, "last_edit_date": 1466694188, "question_id": 37995176, "link": "https://stackoverflow.com/questions/37995176/cant-figure-out-what-monad-function-im-looking-for", "title": "Can&#39;t figure out what monad function I&#39;m looking for", "body": "<p>I thought it was <code>liftM</code> but the type signature doesn't seem right. I was hoping for a function like:</p>\n\n<pre><code> someFunc :: Monad m =&gt; (a -&gt; b) -&gt; a -&gt; m b\n someFunc f = return . f\n</code></pre>\n\n<p>I know I can define this with the above code, but my gut says this has to already exist and I'm just not seeing it for whatever reason.</p>\n\n<p>eg:</p>\n\n<pre><code>main = do\n    n_tmp &lt;- getLine\n    let n = read n_tmp :: Int\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>main = do\n    getLine &gt;&gt;= someFunc read :: IO Int\n</code></pre>\n\n<p>Or am I just doing things horribly wrong?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 6, "last_activity_date": 1466694246, "last_edit_date": 1466694246, "creation_date": 1466693795, "answer_id": 37995221, "question_id": 37995164, "link": "https://stackoverflow.com/questions/37995164/how-to-call-a-built-in-function-which-is-shadowed-in-haskell/37995221#37995221", "title": "How to call a built-in function which is shadowed in Haskell?", "body": "<p>You can preface it with the module name to access the \"original\" function.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>Prelude.maximum [1, 2, 3]\n-- or...\nData.List.maximum [1, 2, 3]\n</code></pre>\n\n<p>It isn't overloaded (if by which you mean in an object-oriented sense of overloading) as your original question was phrased, the original <code>maximum</code> is just hidden or \"shadowed\" by your local definition. </p>\n"}], "owner": {"reputation": 747, "user_id": 4159812, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/af012235f3537ead591d7c77d89152c6?s=128&d=identicon&r=PG&f=1", "display_name": "Zhipeng YANG", "link": "https://stackoverflow.com/users/4159812/zhipeng-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 37995221, "answer_count": 1, "score": 0, "last_activity_date": 1466694246, "creation_date": 1466693670, "last_edit_date": 1466694178, "question_id": 37995164, "link": "https://stackoverflow.com/questions/37995164/how-to-call-a-built-in-function-which-is-shadowed-in-haskell", "title": "How to call a built-in function which is shadowed in Haskell?", "body": "<p>For example, we have <code>maximum [1,2,3]</code> which returns the maximum element in the list.</p>\n\n<p>But if we redefine it locally,</p>\n\n<pre><code>let maximum xs = head xs\n</code></pre>\n\n<p>(I know this is weird, but doesn't matter)</p>\n\n<p>How could we call the original maximum function?</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1466714933, "post_id": 37994219, "comment_id": 63447190, "body": "Anonymous, can you explain your -1?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1466878876, "post_id": 37994219, "comment_id": 63503408, "body": "Second anonymous, can you explain your -1?"}], "answers": [{"comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1466714877, "post_id": 37997738, "comment_id": 63447151, "body": "My approach is working without <code>RankNTypes</code> and using <code>&quot;</code> (diaeresis). My <i>dynamic</i> approach is working, I&#39;m looking for a static one... but thk."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1466701404, "creation_date": 1466701404, "answer_id": 37997738, "question_id": 37994219, "link": "https://stackoverflow.com/questions/37994219/proper-way-to-generalize-data-fields-based-on-enumerated-type/37997738#37997738", "title": "Proper way to generalize data fields based on enumerated type", "body": "<p>Your approach works if you use <code>RankNTypes</code>, <code>ScopedVariables</code> and you don't try to use double-quotes as an operator name:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ScopedTypeVariables #-}\n\nnewtype Stats a = Stats { unStats :: [Integer] } -- or Map, Vector, ...\n  deriving (Show)\n\ninstance forall a . (Enum a, Bounded a) =&gt; Num (Stats a) where\n    fromInteger = Stats . replicate sz\n                  where sz = fromEnum (maxBound::a) - fromEnum (minBound::a) + 1\n    (Stats a) + (Stats b) = Stats $ zipWith (+) a b\n\n(\u20ac) :: forall a . (Eq a, Enum a, Bounded a) =&gt; Integer -&gt; a -&gt; Stats a\nx \u20ac u = Stats $ map (\\k -&gt; if k == u then x else 0) [minBound .. maxBound :: a]\n\ndata TextStats = Lines | Words deriving (Eq, Ord, Enum, Bounded)\n\ntest = 3 \u20ac Lines + 5 \u20ac Words\n</code></pre>\n\n<p>I also changed the list to contain Integers instead of Ints. Is this what you are looking for?</p>\n"}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1466701404, "creation_date": 1466691316, "question_id": 37994219, "link": "https://stackoverflow.com/questions/37994219/proper-way-to-generalize-data-fields-based-on-enumerated-type", "title": "Proper way to generalize data fields based on enumerated type", "body": "<p>Using one fixed structure we can write</p>\n\n<pre><code>data Stats = Stats { lines :: !Int, words :: !Int }\n\ninstance Num Stats where\n    fromInteger x = Stats x x\n    (Stats a b) + (Stats a' b') = Stats (a + a') (b + b')\n</code></pre>\n\n<p>we can create some dynamic structure to achieve the generalized version</p>\n\n<pre><code>newtype Stats a = Stats { unStats :: [Int] } -- or Map, Vector, ...\n\ninstance forall a . (Enum a, Bounded a) =&gt; Num (Stats a) where\n    fromInteger = Stats . replicate sz\n                  where sz = fromEnum (maxBound::a) - fromEnum (minBound::a) + 1\n    (Stats a) + (Stats b) = Stats $ zipWith (+) a b\n\n(\u00a8) :: forall a . (Eq a, Enum a, Bounded a) =&gt; Int -&gt; a -&gt; Stats a\nx \u00a8 u = Stats $ map (\\k -&gt; if k == u then x else 0) [minBound .. maxBound :: a]\n</code></pre>\n\n<p>and use as</p>\n\n<pre><code>data TextStats = Lines | Words deriving (Eq, Ord, Enum, Bounded)\n\nsomeTextStats :: Stats TextStats\nsomeTextStats = 1 \u00a8Lines + 5 \u00a8Words\n</code></pre>\n\n<p>the former way is static (eg. the unit measurement function would be) but the later is not in the sense that defined structure should be traversed at runtime.</p>\n\n<p>Exists some way apart from Template Haskell? Thk!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466690100, "post_id": 37992835, "comment_id": 63431013, "body": "Show your reasoning."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6023611"}, "edited": false, "score": 0, "creation_date": 1466757661, "post_id": 37993938, "comment_id": 63461262, "body": "I don;t know ont thing now, how does it work unification , I mean from what you know <code>that (b -&gt; c), is unified with (t -&gt; u) -&gt; (s -&gt; t) -&gt; s -&gt; u</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1466699572, "last_edit_date": 1466699572, "creation_date": 1466690632, "answer_id": 37993938, "question_id": 37992835, "link": "https://stackoverflow.com/questions/37992835/compositions-in-haskell-way-of-working/37993938#37993938", "title": "compositions in haskell - way of working", "body": "<p>In this expression, <code>(.)</code> is applied to two arguments, <code>(.)</code> again and <code>(+)</code>. Let's take it one step at a time. First, partially apply <code>(.)</code> to <code>(.)</code>. We'll write the type signatures down explicitly, using different type variables to distinguish between the two:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(.) :: (t -&gt; u) -&gt; (s -&gt; t) -&gt; s -&gt; u\n</code></pre>\n\n<p>Now look at the type of <code>(.) (.)</code> (the partial application). (This is probably the trickiest step, due to the size of the type expressions involved. The next step is the same, but with simpler types.) The first argument, of type <code>(b -&gt; c)</code>, is unified with <code>(t -&gt; u) -&gt; (s -&gt; t) -&gt; s -&gt; u</code>, meaning</p>\n\n<pre><code>b ~ t -&gt; u\nc ~ (s -&gt; t) -&gt; s -&gt; u\n</code></pre>\n\n<p>When we do the partial application, we drop the first argument to <code>(.)</code> (since we've given it a value) and look at the type after replacing the remaining <code>b</code>s and <code>c</code>s with their new types.</p>\n\n<pre><code>(.)     :: (b -&gt; c) -&gt; (a -&gt;    b   )  -&gt; a -&gt;          c\n(.) (.) ::             (a -&gt; (t -&gt; u)) -&gt; a -&gt; ((s -&gt; t) -&gt; s -&gt; u)\n</code></pre>\n\n<p>Because <code>-&gt;</code> is right-associative, we can drop some of the excess parentheses to get</p>\n\n<pre><code>(.) (.) ::             (a -&gt; t -&gt; u) -&gt; a -&gt; (s -&gt; t) -&gt; s -&gt; u\n</code></pre>\n\n<p>Now, we apply <em>that</em> to <code>(+) :: Num v =&gt; v -&gt; v -&gt; v</code> (again, using a new type variable for clarity). The first argument of <code>(.) (.)</code> has type <code>a -&gt; t -&gt; u</code>, which we need to unify with <code>v -&gt; v -&gt; v</code>. In other words, we'll replace all occurrences of <code>a</code>, <code>t</code>, and <code>u</code> in <code>(.) (.)</code>'s type with <code>v</code></p>\n\n<pre><code>(.) (.)     :: (a -&gt; t -&gt; u) -&gt; a -&gt; (s -&gt; t) -&gt; s -&gt; u \n(.) (.) (+) ::                  v -&gt; (s -&gt; v) -&gt; s -&gt; v\n</code></pre>\n\n<p>And as you can see (after we add the <code>Num v</code> constraint back), this is equivalent to the type you see:</p>\n\n<pre><code>-- v ~ c, s ~ a\nNum v =&gt; v -&gt; (s -&gt; v) -&gt; s -&gt; v \nNum c =&gt; c -&gt; (a -&gt; c) -&gt; a -&gt; c\n</code></pre>\n\n<hr>\n\n<p>As for the actual expression being evaluated, </p>\n\n<pre><code>((.) . (+)) 3 (*2) 9\n</code></pre>\n\n<p>keep in mind the definition of <code>(.)</code></p>\n\n<pre><code>f . g = \\x -&gt; f (g x)\n</code></pre>\n\n<p>and work from left to right. First, <code>(.) . (+)</code> is applied to <code>3</code>.</p>\n\n<pre><code>((.) . (+)) 3 == (.) ((+) 3)\n              == (.) (3 +)\n</code></pre>\n\n<p>This partial application of <code>.</code> is applied to <code>(* 2)</code>:</p>\n\n<pre><code>(.) (3 +) (* 2) == (3 +) . (* 2)\n                == \\x -&gt; (3 +) ((* 2) x)\n</code></pre>\n\n<p>Finally, this function is applied to 9:</p>\n\n<pre><code>(\\x -&gt; (3 +) ((* 2) x)) 9 == (3 +) ((* 2) 9)\n                          == (3 +) (9 * 2)\n                          == 3 + 9 * 2\n                          == 3 + 18\n                          == 21\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6023611"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 37993938, "answer_count": 1, "score": 0, "last_activity_date": 1466699572, "creation_date": 1466687896, "question_id": 37992835, "link": "https://stackoverflow.com/questions/37992835/compositions-in-haskell-way-of-working", "title": "compositions in haskell - way of working", "body": "<p>I can't understand way of working composition in haskell,<br>\nfor example:  </p>\n\n<p><code>((.) . (+)) 3 (*2) 9 = 9 * 2 + 3 = 21</code>\nThis answer is generated by ghci.<br>\nFor me, it should be:<br>\n<code>((.) . (+)) 3 (*2) 9 = (3+9) * 2</code>\nSimilarily, I can't understand why type of <code>((.) . (+))</code> is <code>Num c =&gt; c -&gt; (a -&gt; c) -&gt; a -&gt; c</code>  </p>\n\n<p>Can you try to explain it me ?</p>\n"}, {"tags": ["haskell", "higher-kinded-types"], "comments": [{"owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1466694149, "post_id": 37991424, "comment_id": 63434246, "body": "@epsilonhalbe What do you mean by a functor with no content?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1466695113, "post_id": 37991424, "comment_id": 63434987, "body": "sorry I think I misunderstood your question - just forget my remark - I meant something like <code>data Const a = Const</code> this can be made an instance of <code>Functor</code> but the value constructor contains no information of <code>a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466688972, "post_id": 37991981, "comment_id": 63430056, "body": "If you use <code>RankNTypes</code>, things change a lot!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466689206, "post_id": 37991981, "comment_id": 63430239, "body": "@dfeuer: yes, but I don&#39;t see what specifically changes with relevance to this question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1466689422, "post_id": 37991981, "comment_id": 63430418, "body": "You can express, e.g., <code>(forall a . f a -&gt; g a) -&gt; ...</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466690514, "post_id": 37991981, "comment_id": 63431364, "body": "Sounds exciting, but I still don&#39;t see where you&#39;re heading. Why not make it an answer?"}, {"owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "edited": false, "score": 0, "creation_date": 1466694075, "post_id": 37991981, "comment_id": 63434177, "body": "Regarding your last paragraph, is there no time you&#39;d want to write a type signature which contains a type constructor as a variable, applied to a concrete type, e.g. <code>f Int</code>? Then it couldn&#39;t be rewritten to a single type variable."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "edited": false, "score": 0, "creation_date": 1466694978, "post_id": 37991981, "comment_id": 63434877, "body": "@CameronMartin: yes it could, because without any knowledge of what <code>f</code> is, <code>f Int</code> is just as useless as <code>a</code> \u2013 you can pass such a value on as it is, but you can&#39;t do anything with it yourself."}, {"owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "edited": false, "score": 0, "creation_date": 1466697364, "post_id": 37991981, "comment_id": 63436640, "body": "@leftaroundabout Ah ok, although you&#39;d be making the type of the function less restricted. So basically higher kinded parametric polymorphism isn&#39;t of much use?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "edited": false, "score": 0, "creation_date": 1466701305, "post_id": 37991981, "comment_id": 63439074, "body": "@CameronMartin without type classes, I don&#39;t see how it would be useful."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1466791154, "post_id": 37991981, "comment_id": 63480723, "body": "I added the stub of an answer."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1466686318, "last_edit_date": 1466686318, "creation_date": 1466685789, "answer_id": 37991981, "question_id": 37991424, "link": "https://stackoverflow.com/questions/37991424/can-a-function-be-parametrically-polymorphic-over-a-non-nullary-type-constructor/37991981#37991981", "title": "Can a function be parametrically polymorphic over a non-nullary type constructor?", "body": "<p>If you still allow typeclass constraints, then the answer is, <em>sure</em>! E.g. I'd still call something like</p>\n\n<pre><code>normalise :: (Foldable f, Functor f, Fractional n) =&gt; f n -&gt; f n\nnormalise v = fmap (/sum v) V\n</code></pre>\n\n<p>parametric polymorphism. But I suppose that's not what you have in mind.</p>\n\n<p>Another thing that's obviously possible is to just contrain types to have a particular form <code>_ _</code>, like</p>\n\n<pre><code>hmap :: (f a -&gt; f b) -&gt; [f a] -&gt; [f b]\nhmap = map\n</code></pre>\n\n<p>This isn't exactly remarkable, but it could possibly be useful in some applications as a subtle hint to the type checker. In fact, this is one way you can solve the phantom argument problem: instead of</p>\n\n<pre><code>class LengthyList l where minimumLength :: l a -&gt; Int\ninstance LengthyList [] where minimumLength _ = 0\ninstance LengthyList NonEmpty where minimumLength _ = 1\n</code></pre>\n\n<p>you might make the signature</p>\n\n<pre><code>  minimumLength :: p (l a) -&gt; Int\n</code></pre>\n\n<p>aka</p>\n\n<pre><code>  minimumLength :: proxy (l a) -&gt; Int\n</code></pre>\n\n<p>Thereby you still pass in the type-information of <code>l</code>, but guarantee that the implementation cannot try to evaluate the argument at runtime.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/tagged-0.8.3/docs/Data-Tagged.html\" rel=\"nofollow\">standard way</a> to do this is however</p>\n\n<pre><code>  minimumLength :: Tagged (l a) Int\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Proxy.html\" rel=\"nofollow\">or</a></p>\n\n<pre><code>  minimumLength :: Proxy (l a) -&gt; Int\n</code></pre>\n\n<p>Generally though, there's nothing you could do with <code>f a</code> that couldn't also be done with <code>fa</code>, so essentially you could rewrite the type of any such higher-order parametric function to a first-order parametrically polymorphic one.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466795353, "post_id": 38019473, "comment_id": 63482841, "body": "Ok, but not we&#39;d still need an example of a function that&#39;s polymorphic in <code>f</code> or <code>g</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466861883, "post_id": 38019473, "comment_id": 63498319, "body": "Ah, I think I know now what you mean. This <i>is</i> nice. Doesn&#39;t typecheck though, as it is..."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1467001563, "last_edit_date": 1467001563, "creation_date": 1466791126, "answer_id": 38019473, "question_id": 37991424, "link": "https://stackoverflow.com/questions/37991424/can-a-function-be-parametrically-polymorphic-over-a-non-nullary-type-constructor/38019473#38019473", "title": "Can a function be parametrically polymorphic over a non-nullary type constructor?", "body": "<p>You totally can do this. A type synonym pigworker is fond of:</p>\n\n<pre><code>type f ~&gt; g = forall a . f a -&gt; g a\n</code></pre>\n\n<p>This, for reasons I don't actually know, represents a natural transformation (whatever exactly that is) between functors <code>f</code> and <code>g</code>. But a function can take an argument of type <code>f ~&gt; g</code> and apply it to as many types <code>f a</code> as it likes. Using non-regular types (specifically, higher-order nested data types, as Ralf Hinze, for example, explored in <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.46.571\" rel=\"nofollow\">Numerical Representations as Higher-Order Nested Datatypes</a>), it could be applied to an unbounded number of different types.</p>\n\n<p>A contrived example:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, TypeOperators #-}\n\ntype f ~&gt; g = forall a . f a -&gt; g a\ndata Two g a = Two (g a) (g a)\ndata Foo f a = This (f a)\n             | That (Foo (Two f) a)\n\nhello :: (f ~&gt; g) -&gt; Foo f a -&gt; Foo g a\nhello t (This fa) = This (t fa)\nhello t (That buh) =\n  That (hello (\\(Two x y) -&gt; Two (t x) (t y)) buh)\n</code></pre>\n\n<p><code>hello</code> is polymorphic in the types <code>f</code> and <code>g</code>, each of which has kind <code>* -&gt; *</code>. &dagger; I believe that converting this to use only types of kind <code>*</code> could require non-trivial refactoring.</p>\n\n<p>&dagger;In fact, if you enable <code>PolyKinds</code>, <code>f</code> and <code>g</code> will each have a polykinded type <code>k -&gt; *</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1467056934, "post_id": 38053636, "comment_id": 63563098, "body": "This feels insufficiently polymorphic, which allows for incorrect implementations mixing up vector elements. I&#39;d have expected something more like <code>foldr :: (forall t ts . t -&gt; p ts -&gt; p (t &#39;: ts)) -&gt; p &#39;[] -&gt; HList xs -&gt; p xs</code>."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1467029413, "creation_date": 1467029413, "answer_id": 38053636, "question_id": 37991424, "link": "https://stackoverflow.com/questions/37991424/can-a-function-be-parametrically-polymorphic-over-a-non-nullary-type-constructor/38053636#38053636", "title": "Can a function be parametrically polymorphic over a non-nullary type constructor?", "body": "<p>One example I'm quite fond of is the <code>foldr</code> operator for lists indexed by their length: it is parametrically polymorphic over a predicate <code>p</code> of kind <code>Nat -&gt; *</code> and guarantees that if you apply it to a list of length <code>m</code> then you get back a proof of <code>p m</code>.</p>\n\n<p>This corresponds to this type:</p>\n\n<pre><code>foldr :: forall a (p :: Nat -&gt; *).\n         (forall n. a -&gt; p n -&gt; p ('Succ n)) -&gt;\n         p 'Zero -&gt;\n         forall n. Vec a n -&gt; p n\n</code></pre>\n\n<p>This extra precision makes it possible to implement e.g. <code>append</code> using <code>foldr</code> rather than having to proceed by pattern-matching.</p>\n\n<pre><code>append :: forall a m n. Vec a m -&gt; Vec a n -&gt; Vec a (m :+: n)\n</code></pre>\n\n<p>I've uploaded <a href=\"https://gist.github.com/gallais/7167e30136a0b51865ca06f459b4a442\" rel=\"nofollow\">a complete gist</a> with all the right language extensions turned on and the code corresponding to these types in case you want to peek.</p>\n"}], "owner": {"reputation": 5734, "user_id": 394796, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aad9f3d17d0679d81841dc6d83a03ea3?s=128&d=identicon&r=PG", "display_name": "Cameron Martin", "link": "https://stackoverflow.com/users/394796/cameron-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 1, "accepted_answer_id": 37991981, "answer_count": 3, "score": 4, "last_activity_date": 1467029413, "creation_date": 1466684326, "last_edit_date": 1466685737, "question_id": 37991424, "link": "https://stackoverflow.com/questions/37991424/can-a-function-be-parametrically-polymorphic-over-a-non-nullary-type-constructor", "title": "Can a function be parametrically polymorphic over a non-nullary type constructor?", "body": "<p>In Haskell, there are many examples of higher kinded polymorphism when dealing with ad hoc polymorphism, such as Monad and Functor. However, I cannot think of any examples of this for parametric polymorphism.</p>\n\n<p>Is this possible, and if so, can I have an example of one which is useful?</p>\n"}, {"tags": ["haskell", "functor", "algebraic-data-types"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 8, "creation_date": 1466675137, "post_id": 37987890, "comment_id": 63420006, "body": "Because you&#39;re missing an alternative for <code>Empty</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466679746, "post_id": 37987890, "comment_id": 63423187, "body": "I strongly recommend turning on warnings will <code>-Wall</code>. So many little mistakes are caught by this."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "edited": false, "score": 0, "creation_date": 1466676677, "post_id": 37987989, "comment_id": 63421097, "body": "Could you help With foldr Implementation?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "edited": false, "score": 0, "creation_date": 1466676984, "post_id": 37987989, "comment_id": 63421348, "body": "Stack Overflow posts are best when limited to a focused question. If you have followup questions on the code or need guidance, please open another question or visit the <a href=\"https://wiki.haskell.org/IRC_channel\" rel=\"nofollow noreferrer\">FreeNode Haskell channel</a>."}, {"owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "edited": false, "score": 0, "creation_date": 1466679900, "post_id": 37987989, "comment_id": 63423308, "body": "Sorry you are right.  I&#39;ve Marked this question As solved."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 6, "last_activity_date": 1466675118, "creation_date": 1466675118, "answer_id": 37987989, "question_id": 37987890, "link": "https://stackoverflow.com/questions/37987890/haskell-fmap-functor/37987989#37987989", "title": "Haskell fmap functor", "body": "<p>Your <code>Functor</code> instance definition is non-exhaustive because it doesn't handle all possible type constructors of <code>DQueue</code>. Namely, it is missing a pattern matching <code>Empty</code>. You need to define how to handle <code>fmap</code> when your value is <code>Empty</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1466681903, "last_edit_date": 1466681903, "creation_date": 1466675767, "answer_id": 37988255, "question_id": 37987890, "link": "https://stackoverflow.com/questions/37987890/haskell-fmap-functor/37988255#37988255", "title": "Haskell fmap functor", "body": "<p>The error speaks for itself: your definition for <code>Functor</code> is defined as:</p>\n\n<pre><code>data DQueue a = Empty | Enqueue a (DQueue a) deriving (Eq, Show, Read)\n\ninstance Functor DQueue where\n    fmap f (Enqueue x xs) = Enqueue (f x) $ fmap f xs\n</code></pre>\n\n<p>There is however the possibility (in this case, if I understand your data-structure correctly, the certainty) that eventually <code>fmap</code> will be fed an <code>Empty</code> instance. You thus have to expand your definition to:</p>\n\n<pre>\ninstance Functor DQueue where\n    fmap f (Enqueue x xs) = Enqueue (f x) $ fmap f xs\n    <b>fmap _ Empty = Empty</b>\n</pre>\n\n<hr>\n\n<p>Most compilers support a flag such that the compiler complains about non-exhaustive patterns, for the <em>Glasgow Haskell Compiler</em> (<code>ghc</code>), you can use the <code>-fwarn-incomplete-patterns</code> flag. For example:</p>\n\n<pre><code>$ ghc queue.hs -fwarn-incomplete-patterns\n[1 of 1] Compiling Main             ( queue.hs, queue.o )\n\nqueue.hs:7:5: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018fmap\u2019: Patterns not matched: _ Empty\nLinking queue ...\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6503430, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/90a242d60cfa9e1fa9bd2d84afc854f8?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/6503430/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 1, "accepted_answer_id": 37987989, "answer_count": 2, "score": 1, "last_activity_date": 1466681903, "creation_date": 1466674921, "question_id": 37987890, "link": "https://stackoverflow.com/questions/37987890/haskell-fmap-functor", "title": "Haskell fmap functor", "body": "<p>I have a problem with functors over queue based on designated algebraic datastructures. </p>\n\n<pre><code>data DQueue a = Empty | Enqueue a (DQueue a)\n    deriving (Eq, Show, Read)\n\n\ninstance Functor DQueue\n  where\n    fmap f (Enqueue x xs) = Enqueue (f x) $ fmap f xs\n\ninstance Foldable DQueue\n  where\n    foldr = error \"not done\"\n\nsample1 :: DQueue Int\nsample1 =  Enqueue 5 $ Enqueue 7 $ Enqueue 9 Empty\n</code></pre>\n\n<p>and result should be like that:</p>\n\n<pre><code>fmap (+1) sample1 ~?= Enqueue 6 (Enqueue 8 (Enqueue 10 Empty))\nfoldr (+) 0 sample1 ~?= 24\n</code></pre>\n\n<p>fmap seems to be logicaly correct but I get an error:\nNon-exhaustive patterns in function fmap</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["list", "haskell", "maybe"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1466661380, "post_id": 37983339, "comment_id": 63411637, "body": "<code>Maybe [a]</code> is not a list type, it&#39;s a <code>Maybe</code> type which may (or may not) contain a list. \u2014 It&#39;s not clear to me what you&#39;re trying to do."}, {"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466661934, "post_id": 37983339, "comment_id": 63411853, "body": "I try to extract the list [a] out from the Maybe [a] to work with the elements of the list [a]."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466662070, "post_id": 37983339, "comment_id": 63411906, "body": "Just as list has two basic constructors (<code>[]</code> and <code>x : xs</code>), <code>Maybe</code> has two basic constructors (<code>Nothing</code> and <code>Just x</code>), which you can pattern match on."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466662099, "post_id": 37983339, "comment_id": 63411920, "body": "@sandkasten What do you want to happen if there is no list?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1466662287, "post_id": 37983339, "comment_id": 63412004, "body": "It is not very clear why you have Maybe at all, and what you are going to do with <code>Maybe [a]</code> (there&#39;s not much you can do with it). Perhaps more context is needed."}, {"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466662627, "post_id": 37983339, "comment_id": 63412141, "body": "@melpomene: Just return an list with no elements. Maybe you can give me a example how to match pattern right to get to work with the list? Compare both list on there vaules and only return values, with are in both lists, for example: &lt;code&gt;[1,2,3] [2,3,4] -&gt; [2,3]"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1466662831, "post_id": 37983339, "comment_id": 63412232, "body": "To convert from <code>Maybe [a]</code> to <code>[a]</code>, you could use a function like this: <code>foo Nothing = []; foo (Just xs) = xs</code>. Or <code>import Data.Maybe</code> and just use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html#v:fromMaybe\" rel=\"nofollow noreferrer\"><code>fromMaybe []</code></a>."}, {"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "edited": false, "score": 0, "creation_date": 1466662961, "post_id": 37983339, "comment_id": 63412292, "body": "I will give it a try, unfortunately I&#39;l have to go to work now and just can test it afterwards."}], "answers": [{"comments": [{"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "edited": false, "score": 0, "creation_date": 1466942450, "post_id": 37983828, "comment_id": 63516323, "body": "Unfortunately I only can check one post as an answer, but I like this one too. It stay close to my logic from OOP, first to check if something contains vaild values before start working with it."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 5, "last_activity_date": 1466663372, "creation_date": 1466663372, "answer_id": 37983828, "question_id": 37983339, "link": "https://stackoverflow.com/questions/37983339/haskell-working-with-maybe-lists/37983828#37983828", "title": "Haskell working with Maybe lists", "body": "<p>In general:</p>\n\n<pre><code>yourFunction Nothing Nothing = ...\nyourFunction (Just xs) Nothing = \n  case xs of\n    [] -&gt; ...\n    x':xs' -&gt; ...\n-- or separately: \nyourFunction (Just []) Nothing = ... \nyourFunction (Just (x:xs)) Nothing = ...\n</code></pre>\n\n<p>et cetera. Which cases need to be treated separately depends on the specific function. More likely you would combine functions working on <code>Maybe</code> with functions working on <code>[]</code>.</p>\n\n<p>If you want to \"Just return an list with no elements\" for <code>Nothing</code>, then you can write </p>\n\n<pre><code>maybeToList1 :: Maybe [a] -&gt; [a]\nmaybeToList1 Nothing = []\nmaybeToList1 (Just xs) = xs\n</code></pre>\n\n<p>A better way to write the same function is <code>maybeToList1 = maybe [] id</code> (<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html#v:maybe\">docs for <code>maybe</code></a>) or <code>maybeToList1 = fromMaybe []</code>, but since you are just starting you may want to come back to this one later.</p>\n"}, {"comments": [{"owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "edited": false, "score": 1, "creation_date": 1466708965, "post_id": 37996981, "comment_id": 63443935, "body": "I realy enjoy reading your answer, its prove a good example and explanation. I think what you mentionend on the end is the goal which my exercise will lead to :) Maybe I stuck to much in OOP, where you will always check if something is nothing and this or that..."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "edited": false, "score": 0, "creation_date": 1466719512, "post_id": 37996981, "comment_id": 63449364, "body": "@sandkasten This also checks whether the lists were generated successfully (<code>Just xs</code>) or it failed on (at least) one of them (<code>Nothing</code>). In Haskell this all happens automatically by using <code>liftA2</code>, which keeps code very clear and concise IMO."}], "tags": [], "owner": {"reputation": 644, "user_id": 400527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e917751deccfa27247406ab6bb6a56e6?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/400527/matt"}, "is_accepted": true, "score": 7, "last_activity_date": 1466698912, "creation_date": 1466698912, "answer_id": 37996981, "question_id": 37983339, "link": "https://stackoverflow.com/questions/37983339/haskell-working-with-maybe-lists/37996981#37996981", "title": "Haskell working with Maybe lists", "body": "<p>To approach your problem from a different direction, I would argue you <em>don't</em> want a function that processes two <code>Maybe [a]</code>. Bear with me:</p>\n\n<p>Fundamentally, the operation you want to do operates on two lists to give you a new list, eg,</p>\n\n<pre><code>yourFunction :: [a] -&gt; [a] -&gt; [a]\nyourFunction a b = ...\n</code></pre>\n\n<p>That's fine, and you can and should write <code>yourFunction</code> as such.  The fact that the data you have is <code>Maybe [a]</code> captures some additional, auxiliary information: the operation that created your input lists may have failed.  The next step is to chain together <code>yourFunction</code> with the auxiliary information.  This is exactly the purpose of <code>do</code> notation, to mix pure operations (like <code>yourFunction</code>) with contexts (the fact that the creation of one of your input lists may have failed):</p>\n\n<pre><code>playWithMaybe :: Maybe [a] -&gt; Maybe [a] -&gt; Maybe [a]\nplayWithMaybe maybeA maybeB =\n  do a &lt;- maybeA   -- if A is something, get it; otherwise, pass through Nothing\n     b &lt;- maybeB   -- if B is something, get it; otherwise, pass through Nothing\n     Just (yourFunction a b)  -- both inputs succeeded!  do the operation, and return the result\n</code></pre>\n\n<p>But then it turns out there are other kinds of contexts you might want to work with (a simple one, instead of <code>Maybe</code> that just captures \"something bad happened\", we can use <code>Either</code> to capture \"something bad happened, and here is a description of what happened).  Looking back at <code>playWithMaybe</code>, the \"<code>Maybe</code>-ness\" only shows up in one place, the <code>Just</code> in the last line.  It turns out Haskell offers a generic function <code>pure</code> to wrap a pure value, like what we get from <code>yourFunction</code>, in a minimal context:</p>\n\n<pre><code>playWithMaybe' :: Maybe [a] -&gt; Maybe [a] -&gt; Maybe [a]\nplayWithMaybe' maybeA maybeB =\n  do a &lt;- maybeA\n     b &lt;- maybeB\n     pure (yourFunction a b)\n</code></pre>\n\n<p>But then Haskell also has a generic type to abstract the idea of a context, the Monad.  This lets us make our function even more generic:</p>\n\n<pre><code>playWithMonad :: Monad m =&gt; m [a] -&gt; m [a] -&gt; m [a]\nplayWithMonad mA mB =\n  do a &lt;- mA\n     b &lt;- mB\n     pure (yourFunction a b)\n</code></pre>\n\n<p>Now we have something very generic, and it turns out it is so generic, it's already in the standard library!  (This is getting quite subtle, so don't worry if it doesn't all make sense yet.)</p>\n\n<pre><code>import Control.Applicative\nplay :: Monad m =&gt; m [a] -&gt; m [a] -&gt; m [a]\nplay mA mB = liftA2 yourFunction mA mB\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>import Control.Applicative\nplay' :: Monad m =&gt; m [a] -&gt; m [a] -&gt; m [a]\nplay' = liftA2 yourFunction\n</code></pre>\n\n<p>Why did I switch from Monad to Applicative suddenly?  Applicative is similar to Monad, but even more generic, so given the choice, it is generally better to use Applicative if you can (similar to my choice to use <code>pure</code> instead of <code>return</code> earlier).  For a more complete explanation, I strongly recommend <em>Learn You a Haskell</em> (<a href=\"http://learnyouahaskell.com/chapters\" rel=\"noreferrer\">http://learnyouahaskell.com/chapters</a>), in particular chapters 11 and 12.  Note- definitely read chapter 11 first!  Monads only makes sense after you have a grasp on Functor and Applicative.</p>\n"}, {"tags": [], "owner": {"reputation": 778, "user_id": 6499999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48bb54922bb8f6ad1b5ba41fd3e9bf1b?s=128&d=identicon&r=PG", "display_name": "JoL", "link": "https://stackoverflow.com/users/6499999/jol"}, "is_accepted": false, "score": 0, "last_activity_date": 1466709467, "creation_date": 1466709467, "answer_id": 38000028, "question_id": 37983339, "link": "https://stackoverflow.com/questions/37983339/haskell-working-with-maybe-lists/38000028#38000028", "title": "Haskell working with Maybe lists", "body": "<p>Like others have said, <code>[Int]</code> and <code>Maybe [Int]</code> are not the same thing. <code>Maybe [Int]</code> includes the extra information that the list may or may not be there. You said that you read the Ids from files. Perhaps, the <code>Maybe</code> signifies whether the file existed or not, while the empty list signifies that the file did exist but contained no Ids.</p>\n\n<p>If you want to work with the list, you first need to define what to do if there is no list. You can use this function to extract the list:</p>\n\n<pre><code>fromMaybe :: a -&gt; Maybe a -&gt; a\n</code></pre>\n\n<p>Maybe you want to treat having no list the same as having an empty list:</p>\n\n<pre><code>fromMaybe [] :: Maybe [a] -&gt; [a]\n</code></pre>\n\n<p>Maybe you want to crash the entire program:</p>\n\n<pre><code>fromMaybe (error \"Missing list\") :: Maybe a -&gt; a\n</code></pre>\n\n<p>There is also the more general <code>maybe</code> function, which you can use if the default value is not of the same type as what's contained in the <code>Maybe</code>:</p>\n\n<pre><code>maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b\n</code></pre>\n\n<p>Both these functions are defined in the module <code>Data.Maybe</code>.</p>\n\n<p>You can also just work with the lists as if they existed and worry about their existence later by using <code>Applicative</code>. You said you wanted to find the Ids common to both lists. You can do it like this:</p>\n\n<pre><code>maybeCommonIds :: Maybe [Int] -&gt; Maybe [Int] -&gt; Maybe [Int]\nmaybeCommonIds xs ys = intersect &lt;$&gt; xs &lt;*&gt; ys\n</code></pre>\n\n<p><code>intersect</code> is defined in <code>Data.List</code>. Using <code>maybeCommonIds</code> will result in <code>Maybe [Int]</code>. The list contained inside will hold the common ids, but if either of the two lists did not exist, there is not list of common ids. In your case, this might be the same as having no common ids. In that case, you might want to pass the result to <code>fromMaybe []</code>, to get back the list.</p>\n"}], "owner": {"reputation": 595, "user_id": 1292838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6a1f317267d8897b850809e147276d01?s=128&d=identicon&r=PG", "display_name": "sandkasten", "link": "https://stackoverflow.com/users/1292838/sandkasten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5680, "favorite_count": 1, "accepted_answer_id": 37996981, "answer_count": 3, "score": 5, "last_activity_date": 1466709467, "creation_date": 1466661226, "last_edit_date": 1466661983, "question_id": 37983339, "link": "https://stackoverflow.com/questions/37983339/haskell-working-with-maybe-lists", "title": "Haskell working with Maybe lists", "body": "<p>I'm pretty new to haskell and don't get how to work with <code>Maybe [a]</code>. Normally I'm coding OOP (VB.NET) and in my free time I want to learn haskell (don't ask why ;) ).</p>\n\n<p>So, what do I want to do? I want to read two files with numerical IDs and find out only the IDs that match in both files. Reading the files is not a big thing, it works wonderfully easy. Now, I get two lists of <code>Maybe[Ids]</code> (for a simple example, just think the IDs are Int). So the function I need looks like this</p>\n\n<pre><code>playWithMaybe :: (Maybe [a]) -&gt; (Maybe [Int]) -&gt; [Int]\n</code></pre>\n\n<p>Now I want to access list members as I used to like this</p>\n\n<pre><code>playWithMaybe (x:xs) (y:ys) = undefined\n</code></pre>\n\n<p>But unfortunately it's not allowed, GHC says for both lists</p>\n\n<pre><code>Couldn't match expected type \u2018Maybe [Int]\u2019 with actual type \u2018[t0]\u2019\n</code></pre>\n\n<p>So I played around a little bit but didn't find a way to access list members. Can someone help me out? A little bit of explanation would be a great thing!</p>\n"}, {"tags": ["haskell", "vector", "mutable"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1466651515, "post_id": 37981015, "comment_id": 63408577, "body": "Doesn&#39;t it get fused correctly if you write it as a composition of <code>fold</code> and <code>freeze</code>?"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1466727857, "post_id": 37981015, "comment_id": 63451620, "body": "@Cactus I have no idea. There is no documentation on this."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466691548, "post_id": 37983567, "comment_id": 63432207, "body": "How much would this apply for a <i>strict</i> map?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466704707, "post_id": 37983567, "comment_id": 63441234, "body": "@leftaroundabout I&#39;m not sure, because the values themselves can still be lazy. For example, suppose the function I mapped were instead <code>\\x -&gt; &quot;Doubled number: &quot; ++ (x * 2)</code>. Would this have the same problem even in a strict map? I&#39;m not familiar enough with how haskell&#39;s thunking works to say."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1466705102, "post_id": 37983567, "comment_id": 63441456, "body": "Maybe if it were both spine-strict and value-strict, forcing each value to WHNF, it would work."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1466706028, "post_id": 37983567, "comment_id": 63442089, "body": "This is basically explaining why <code>map</code> and <code>fold</code> for mutable vectors would have to be <code>IO</code> (or <code>ST</code>) operations, since they need to read the current contents of the vector. Does the vector library not have those?"}, {"owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "edited": false, "score": 0, "creation_date": 1466727950, "post_id": 37983567, "comment_id": 63451652, "body": "The vector library doesn&#39;t have those."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1466674023, "last_edit_date": 1466674023, "creation_date": 1466662221, "answer_id": 37983567, "question_id": 37981015, "link": "https://stackoverflow.com/questions/37981015/haskell-mutable-vectors-have-no-map-fold-etc-higher-level-functions/37983567#37983567", "title": "Haskell mutable vectors have no map, fold, etc ... higher level functions?", "body": "<p>I don't know what the designers of these types had in mind when implementing the mutable versions, but the problem I see is to do with laziness and the expectation of consistency. </p>\n\n<p>Suppose I create a mutable vector of three ints, map <code>(* 2)</code> over them, and then modify the original vector. When I look at the output of map, will I see doubles of old values or of new values? The answer is, it depends on which elements I looked at before modifying, and which after. Consider:</p>\n\n<pre><code>main = do\n  v &lt;- V.replicate 3 1\n  let doubled = map (* 2) v\n  putStrLn \"First doubled number is: \" ++ show (head doubled)\n  set v 10\n  putStrLn \"Sum of doubled numbers is: \" ++ show (sum doubled)\n</code></pre>\n\n<p>Although we performed our operations in well-defined chunks, the caching of thunks means that the first element of <code>doubled</code> will be 2, because we had to force it in order to print it <em>before</em> we set the whole vector to 10, but the last two elements of <code>doubled</code> will be 20, so our sum is 42: neither the sum of double the original vector, nor the sum of double the final vector. We managed to observe an inconsistent state that our system as a whole was never intended to be in, because we treated a mutable vector as if it were an immutable list, by trying to <code>map</code> over it lazily.</p>\n"}], "owner": {"reputation": 1835, "user_id": 6292577, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/gqMCP.jpg?s=128&g=1", "display_name": "rityzmon", "link": "https://stackoverflow.com/users/6292577/rityzmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1466674023, "creation_date": 1466646647, "question_id": 37981015, "link": "https://stackoverflow.com/questions/37981015/haskell-mutable-vectors-have-no-map-fold-etc-higher-level-functions", "title": "Haskell mutable vectors have no map, fold, etc ... higher level functions?", "body": "<p>While using mutable vectors for the first time, I discovered that while <code>Data.Vector.Unboxed</code> has all the higher level functions you'd expected like <code>map</code>, <code>fold</code>, etc., the mutable version <code>Data.Vector.Unboxed.Mutable</code> has none of these. Trying to use the functions from the immutable package on mutable vectors didn't work.</p>\n\n<p>What is the reason why the mutable vector package lacks a lot of these higher level functions?</p>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "lambda-calculus", "type-theory"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1466667117, "post_id": 37980562, "comment_id": 63414714, "body": "Won&#39;t (arbitrary) fixed points make you lose the normalization property? In Agda/Coq there&#39;s a termination checker to prevent that, essentially limiting recursion to structural (higher-order) induction. Without inductive types, I&#39;m not sure how to guarantee termination and fixpoints in an easy way."}, {"owner": {"reputation": 1042, "user_id": 1236574, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/hyl6L.jpg?s=128&g=1", "display_name": "jmegaffin", "link": "https://stackoverflow.com/users/1236574/jmegaffin"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1466676100, "post_id": 37980562, "comment_id": 63420709, "body": "This is only for the normalized calculus, i.e. type checking, termination checking have already happened."}], "owner": {"reputation": 1042, "user_id": 1236574, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/hyl6L.jpg?s=128&g=1", "display_name": "jmegaffin", "link": "https://stackoverflow.com/users/1236574/jmegaffin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1466643964, "creation_date": 1466643227, "last_edit_date": 1466643964, "question_id": 37980562, "link": "https://stackoverflow.com/questions/37980562/representing-a-fixpoint-in-a-head-normal-lambda-calculus-ast", "title": "Representing a fixpoint in a head-normal lambda calculus AST", "body": "<p>Consider the following normalized term representation, obtained during type checking:</p>\n\n<pre><code>data Normal a\n  = Neutral (Neutral a)\n  | Type\n  | Pi (Normal a) (Normal (Maybe a))\n  | Abstract (Normal (Maybe a))\n\ndata Neutral a\n  = Variable a\n  | Apply (Neutral a) (Normal a)\n</code></pre>\n\n<p>I would like to be able to represent a fixpoint within this framework, or at least in a way that preserves its head-normal property, which is very convenient for implementing substitution and definitional equality.</p>\n\n<p>At first, I thought of using a fixpoint combinator defined in the calculus itself.  The Y combinator is out of the question, though, as with this term representation I cannot apply a lambda to a lambda.  The Z combinator is close to what I want, but assumes that the result is to be a function.</p>\n\n<p>If I were simply doing graph reduction, I would tie the knot with Haskell itself, leading to a lazy infinite syntax tree.  However, as this is being used for a dependent type checker, I need to be able to test for definitional equality on terms - it would get caught in an infinite loop this way.</p>\n"}]