[{"tags": ["haskell", "lazy-evaluation", "template-haskell", "quasiquotes"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576698935, "post_id": 59399050, "comment_id": 104987461, "body": "You can force evaluation with bang patterns and <code>seq</code>: <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:seq\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1576699555, "post_id": 59399050, "comment_id": 104987691, "body": "I suggest including the definition of <code>month</code> (and, for completeness <code>mon</code>) in your question."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1576705372, "post_id": 59399050, "comment_id": 104989808, "body": "<code>quoteExp month &quot;3&quot;</code> is definitely executed at compile-time, because that&#39;s what quasi-quotes do. If that action did the necessary checking, it would fail to compile."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576737988, "post_id": 59399050, "comment_id": 104997330, "body": "@WillemVanOnsem - I am familiar with BangPatterns &amp; <code>seq</code>; but struggling to see how to apply them here.  To my understanding, they only apply when the encompassing value (the argument to <code>seq</code>, say) is evaluated."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1576738013, "post_id": 59399050, "comment_id": 104997341, "body": "@K.A.Buhr - fair point, added."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1576743061, "post_id": 59399050, "comment_id": 104999157, "body": "@Carl - that is also my understanding, but I am struggling to see how to make that help; e.g., the <code>s</code> in <code>quoteExp</code> in the code (newly added, above) even <code>force</code>ing the <code>__fromString</code> doesn`t help - the issue seems to be that the resulting divergence still isn&#39;t evaluated until runtime."}], "answers": [{"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1576793740, "post_id": 59413645, "comment_id": 105022447, "body": "Well blow me down, it works.  Many thanks!  I&#39;m going to have to stare at the <code>Lift</code> stuff for a little while to understand it, but it does indeed do what I asked.  Kudos, and gratitude."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1576795004, "post_id": 59413645, "comment_id": 105022813, "body": "@user3416536 Here&#39;s an analogy that might help with <code>Lift</code>: it&#39;s the template Haskell version of <code>Show</code>. It converts values to their AST, so they can be included in the rendered output merged into a splice."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 4, "last_activity_date": 1576779536, "last_edit_date": 1576779536, "creation_date": 1576773180, "answer_id": 59413645, "question_id": 59399050, "link": "https://stackoverflow.com/questions/59399050/haskell-making-quasi-quoted-values-strict-evaluated-at-compile-time/59413645#59413645", "title": "Haskell: Making Quasi-Quoted values strict / evaluated at compile-time", "body": "<p>Your quasiquoter just defers everything to runtime by putting everything inside a quote. You need to move the parsing and verification outside the quote.</p>\n\n<p>My quick proof of concept:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, DeriveLift #-}\nmodule A ( Month,\n           mon,\n           month\n         ) where\n\nimport Text.Read\nimport Language.Haskell.TH\nimport Language.Haskell.TH.Syntax (Lift)\nimport Language.Haskell.TH.Quote\n\nnewtype Month = Month Int deriving (Show, Eq, Ord, Lift)\n\nmon :: Int -&gt; Maybe Month\nmon n | n &gt;= 1 &amp;&amp; n &lt;= 12 = Just $ Month n\n      | otherwise = Nothing\n\nmonthExpImpl :: String -&gt; Q Exp\nmonthExpImpl s = case readMaybe s of\n  Nothing -&gt; fail \"Couldn't parse input as number\"\n  Just n -&gt; case mon n of\n    Nothing -&gt; fail \"Not a valid month\"\n    Just x -&gt; [| x |]\n\nmonth :: QuasiQuoter\nmonth = QuasiQuoter { quoteDec  = error \"quoteDec not implemented\"\n                    , quoteType = error \"quoteType not implemented\"\n                    , quotePat  = error \"quotePat not implemented\"\n                    , quoteExp = monthExpImpl\n                    }\n</code></pre>\n\n<p>Note that <code>monthExpImpl</code> puts all the logic outside of the quote.  <code>fail</code> is the recommended way to terminate a <code>Q</code> action with a compilation error, strange as that feels to someone used to thinking of <code>fail</code> as a historical accident that we're moving away from.</p>\n\n<p>The most surprising bits here are the <code>DeriveLift</code> extension and its use to add <code>Lift</code> to the list of derived classes for <code>Month</code>. <a href=\"https://hackage.haskell.org/package/template-haskell-2.15.0.0/docs/Language-Haskell-TH-Syntax.html#t:Lift\" rel=\"nofollow noreferrer\"><code>Lift</code></a> is used by TH to convert a value to code that generates that value. Without it, the compiler has no idea how to make the <code>[| x |]</code> quote into code.</p>\n\n<p>You might wonder about how valid it is for TH to generate code that calls a constructor that shouldn't be visible from the compilation unit the generated code is in.  I wondered the same.  Turns out it's fine, as long as the code that creates the constructor in TH <em>can</em> see the constructor.  In this case, it's the <code>Lift</code> instance which is doing that, and it's defined in the same module, so it can see the constructor.  That might give you pause about creating such an instance, because you can't prevent an instance from being exported. And that's a valid consideration.  In this case it's fine, though, because <code>lift</code> requires a value to convert to code, and the only* way to get such a value from outside the module is through <code>mon</code> anyway, so it doesn't introduce any new ways to muck things up. (I say \"only*\" because <code>unsafeCoerce</code> exists, but let's just pretend it doesn't. When you use it, you have to take responsibility for breaking everything anyway.)</p>\n"}], "owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 59413645, "answer_count": 1, "score": 4, "last_activity_date": 1576779536, "creation_date": 1576698153, "last_edit_date": 1576742977, "question_id": 59399050, "link": "https://stackoverflow.com/questions/59399050/haskell-making-quasi-quoted-values-strict-evaluated-at-compile-time", "title": "Haskell: Making Quasi-Quoted values strict / evaluated at compile-time", "body": "<p>I have a 'Month' type, which is roughly</p>\n\n<pre><code>newtype Month = Month Word8\n</code></pre>\n\n<p>where the <code>Month</code> constructor isn't exported; instead, a function</p>\n\n<pre><code>mon :: Word8 -&gt; Maybe Month\nmon i = if i &gt; 0 &amp;&amp; i &lt; 13\n        then Just $ Month i\n        else Nothing\n</code></pre>\n\n<p>is exported, which will only return a value if the input value is between 1 &amp; 12 inclusive.</p>\n\n<p>Now, using <code>Language.Haskell.TH.Quote</code>, I have defined a quasi-quoting ... operator? ... that allows me to \"create\" instances of Month \"at compile time\":</p>\n\n<pre><code>month :: QuasiQuoter\nmonth = QuasiQuoter { quoteDec  = error \"quoteDec not implemented\"\n                    , quoteType = error \"quoteType not implemented\"\n                    , quotePat  = \"quotePat not implemented\"\n                    , quoteExp = (\\ s \u2192 \u27e6 force $ __fromString @Month s \u27e7)\n                    }\n\n\nm :: Month\nm = [month|3|]\n</code></pre>\n\n<p>Where <code>__fromString</code> parses a string, and either returns a value or calls <code>error</code>.  <code>force</code> is from <code>Control.DeepSeq</code>.</p>\n\n<p>Now this is well and good, but the principle value of this is to catch bad values as early as possible - but, thanks to Lazy Evaluation, the value m is not evaluated either at compile-time (which would be ideal, but a rather tall order, perhaps) or at least at the earliest stage of runtime.</p>\n\n<p>Is there any way that I can annotate the value (preferably within the quasi-quotation infra, so that every use of <code>month</code> gets it for free; but failing that, annotating <code>m</code>) to force the evaluation of <code>m</code> when the program gets run?  Requiring an <code>NFData</code> constraint or similar is fine.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "is_accepted": true, "score": 3, "last_activity_date": 1576698673, "creation_date": 1576698673, "answer_id": 59399133, "question_id": 59398893, "link": "https://stackoverflow.com/questions/59398893/how-to-use-custom-listof-in-quickcheck/59399133#59399133", "title": "How to use custom listOf in QuickCheck", "body": "<p>IIUC, the issue is that your tests are using <code>Arbitrary</code> instances, by way of the <code>Testable</code> <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#t:Testable\" rel=\"nofollow noreferrer\">instance for</a> <code>(Arbitrary a, Show a, Testable prop) =&gt; Testable (a -&gt; prop)</code>.</p>\n\n<p>A common pattern to get custom generators is to throw around some <code>newtype</code>s with the desired <code>Arbitrary</code> instances. So you'd define something like</p>\n\n<pre><code>newtype Board = Board [Point]\n\ninstance Arbitrary Board where\n  ...\n</code></pre>\n\n<p>That would work. But I'd recommend bypassing <code>Arbitrary</code> altogether and writing your properties with <code>forAll</code> <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:forAll\" rel=\"nofollow noreferrer\">and its variants</a>.</p>\n\n<pre><code>genBoard :: Gen [Point]\ngenBoard = ...\n\nshrinkBoard :: [Point] -&gt; [[Point]]\nshrinkBoard = ...\n\nmyProperty :: Property\nmyProperty = forAllShrink genBoard shrinkBoard (\\board -&gt; ...)\n</code></pre>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 1, "accepted_answer_id": 59399133, "answer_count": 1, "score": 3, "last_activity_date": 1576698673, "creation_date": 1576697348, "question_id": 59398893, "link": "https://stackoverflow.com/questions/59398893/how-to-use-custom-listof-in-quickcheck", "title": "How to use custom listOf in QuickCheck", "body": "<p>In my code, I need to generate a list of <code>Point</code></p>\n\n<p>I've instanced the custom type <code>Point</code> in the <code>Arbitrary</code> Type Class.\nSo far so good.</p>\n\n<p>Now I need to generate a list:  <code>[Points]</code></p>\n\n<p>But the default random list generated by QuickCheck(using <code>listOf</code> I believe?) is not working for me. \nBecause I need some special relations between the <code>points</code>. I know of the Generator combinators, ex. <code>suchAs</code> But they are too slow(because of very rare relation)</p>\n\n<p>I've defined a customed <code>Gen [Point]</code> to suit my needs.</p>\n\n<pre><code>randomBoard :: Gen [Point]\nrandomBoard = ...\n</code></pre>\n\n<p>But I have no idea how to let my test to use this custom <code>Gen</code> in the property test because it defaults to the <code>listOf</code> generated list.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1576700294, "post_id": 59398164, "comment_id": 104987996, "body": "<code>State s a == StateT s Identity a</code>, so <code>StateT s m a</code> and <code>m (StateT s Identity a)</code> are two different things. One is isomorphic to <code>m (s -&gt; (a, s))</code>, the other <code>s -&gt; m (a, s)</code>."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576702911, "post_id": 59398164, "comment_id": 104988938, "body": "@chepner That is a fair point, but even if that is true, it still does not address my high level issue, namely:  I am assuming the principle that if a monad has an associated transformer, then anything you can do by stacking monads you can do by using the transformer, call it the &quot;Transformer Principle&quot;.  So what I am trying to do, you can do by stacking monads, as showcased by my implementation <code>recFunc</code>. Therefore, if the principle holds (and since the <code>State</code> monad does have a transformer), there must be a way to do it with transformers. What is that way?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576703277, "post_id": 59398164, "comment_id": 104989057, "body": "Yes, but your conversion isn&#39;t just stacking monads. <code>recFuncT</code> is <i>different</i> than <code>recFunc</code>. If it were the same, you wouldn&#39;t have to change the body at all, because simply replacing <code>State</code> with the equivalent <code>StateT</code> is just alias expansion."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576703517, "post_id": 59398164, "comment_id": 104989138, "body": "@chepner I am pretty sure you must be missing the point. you can always replace <code>State</code> with <code>StateT</code>, but not all instances of <code>StateT</code> can be directly replaced with an instance of <code>State</code>. That is, whenever <code>m</code> is not the Identity, then <code>StateT s m a</code> cannot be rewritten in terms of <code>State</code>. However, conceptually and as I understand transformers, <code>StateT s m a</code> is &quot;inserting <code>State</code> capabilities inside <code>m</code>&quot;, and so should have at least all the functionality of <code>m (State s a)</code>. Are you saying this is not true, that there are things you can only do with <code>m (State s a)</code>?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1576704048, "post_id": 59398164, "comment_id": 104989321, "body": "I think the problem is that <code>StateT s m a</code> can be viewed as &quot;inserting <code>State</code> capabilities inside <code>m</code>&quot;, but the type <code>m (State s a)</code> can&#39;t.  It&#39;s not even clear what <code>m (State s a)</code> <i>is</i>, at least for general monad <code>m</code>.  What&#39;s <code>IO (State s a)</code>?  If it&#39;s supposed to be a monad, what does its bind operator look like?  If it&#39;s not supposed to be a monad, what are its &quot;capabilities&quot;?"}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1576704572, "post_id": 59398164, "comment_id": 104989538, "body": "I can see the general issue that you point to. To move forward, I&#39;ll tell you that my monad, while obviously not the same in relevant ways, is in many other ways very similar to the <code>List</code> monad. As a monad, List is about non-deterministic computations. So what&#39;s <code>[State s a]</code>, as a monad over <code>a</code>, well it&#39;s a non-deterministic stateful computation for <code>a</code>. And what does my <code>myFunc</code> function look like. It&#39;s something similar to adding an extra non-deterministic branch. You can&#39;t do that in general in <code>List</code>, but you can in my monad because it&#39;s not exactly the same."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1576704733, "post_id": 59398164, "comment_id": 104989600, "body": "If you know about it, my monad is similar to a combination of the <code>List</code> and the <code>Delay</code> monad. What <code>myFunc</code> does is add a delayed step to the non-deterministic computation.  But I can start to see the problem myself here. What I want is a non-deterministic set of stateful computations, not <i>one</i> stateful and non-deterministic computation, which is what I guess <code>StateT s m a</code> gives me. So maybe that means for my application I need to use <code>m (State s a)</code>."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1576705138, "post_id": 59398164, "comment_id": 104989731, "body": "I&#39;ll try to avoid the monologue but... I still see the semantic relationship between <code>m (State s a)</code> and <code>StateT s m a</code> in my case: they both represent a non-deterministic stateful computation (where the state itself is part of the non-determinism). Perhaps what that means is that <code>s -&gt; m (a,s)</code> and <code>m (s -&gt; (a,s))</code> are isomorphic in my particular case?"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1576705737, "post_id": 59400375, "comment_id": 104989938, "body": "Hm. But you could define that for any monad and it would not make sense. Why would it make more sense for this monad?  You could implement:  <code>newtype TransformerFromMonad tm m a = TransformerFromMonad (tm (m a))</code>  And then consider horrifying things like <code>TransformerFromMonad IO (State s) == IO (State s a)</code> and which is nothing like a transformer for the <code>IO</code> monad."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 1, "creation_date": 1576706523, "post_id": 59400375, "comment_id": 104990200, "body": "I added a note about this."}, {"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1576706757, "post_id": 59400375, "comment_id": 104990291, "body": "Maybe I am trying to generalize monad transformers too much, instead of taking them individually for what each of them are..."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1576706498, "last_edit_date": 1576706498, "creation_date": 1576705419, "answer_id": 59400375, "question_id": 59398164, "link": "https://stackoverflow.com/questions/59398164/function-in-haskell-to-map-over-a-monadtrans/59400375#59400375", "title": "Function in Haskell to map over a MonadTrans?", "body": "<p>From the discussion in the comments, it sounds like what you really want is a monad transformer for your custom monad that is then applied to the base monad <code>State</code>.  In other words, to the extent that your custom monad is \"nearly\" a list:</p>\n\n<pre><code>newtype Listish a = Listish [a]\n</code></pre>\n\n<p>its transformer version would have type:</p>\n\n<pre><code>newtype ListishT m a = ListishT [m a]\n</code></pre>\n\n<p>and so your final monad transformer stack would be:</p>\n\n<pre><code>type M s = ListishT (State s)\n</code></pre>\n\n<p>which is isomorphic to your monad stack</p>\n\n<pre><code>[State s a]  AKA  Listish (State s a)\n</code></pre>\n\n<p>Be sure not to over-generalize the pattern for creating a transformer from an underlying monad, however.  While transformers for some monads:</p>\n\n<pre><code>newtype List a = List [a]\nnewtype Reader r a = Reader (r -&gt; a)\n</code></pre>\n\n<p>are sensibly derived by replacing \"<code>a</code>\" with \"<code>m a</code>\":</p>\n\n<pre><code>newtype ListT m a = ListT [m a]\nnewtype ReaderT r m a = ReaderT (r -&gt; m a)\n</code></pre>\n\n<p>transformers for other types are derived differently.  For example:</p>\n\n<pre><code>newtype State s a = State (s -&gt; (a, s))\nnewtype Writer w a = Writer (a, w)\n</code></pre>\n\n<p>give:</p>\n\n<pre><code>newtype StateT s a = StateT (s -&gt; m (a, s))\n-- **NOT** StateT (s -&gt; (m a, s))\nnewtype WriterT s a = WriterT (m (a, w))\n-- **NOT** WriterT (m a, w)\n</code></pre>\n\n<p>In particular, there is no monad transformer for <code>IO</code>, because the simple substitution</p>\n\n<pre><code>newtype BadIOT m a = BadIOT (IO (m a))\n</code></pre>\n\n<p>is, as you point out, silly.</p>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "is_accepted": false, "score": 0, "last_activity_date": 1576717773, "last_edit_date": 1576717773, "creation_date": 1576714474, "answer_id": 59401718, "question_id": 59398164, "link": "https://stackoverflow.com/questions/59398164/function-in-haskell-to-map-over-a-monadtrans/59401718#59401718", "title": "Function in Haskell to map over a MonadTrans?", "body": "<p>EDIT: All of the below makes no sense. I leave it strikedthrough. Good answer below.</p>\n\n<p><s>For the record, my final solution was neither to use or implement a monad transformer, and instead simply implement the following function: (my custom monad is called <code>EnumProc</code>):</p>\n\n<pre><code>(..&gt;&gt;=) :: Monad m =&gt; EnumProc (m a) -&gt; (a -&gt; m b) -&gt; EnumProc (m b)\nen ..&gt;&gt;= f = en &lt;$&gt; (&gt;&gt;= f)\ninfixl 7 ..&gt;&gt;=\n</code></pre>\n\n<p>This allows me to deal with monadic computations inside my monad while keeping the outside monad structure. I was surprised myself when an <code>fmap</code> sufficed.</p>\n\n<p>I then use <code>EnumProc (State s a)</code> as type throughout.</s></p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 0, "creation_date": 1576718715, "post_id": 59402170, "comment_id": 104993272, "body": "Because of my low rep it doesn&#39;t let me set this one as accepted in the end. I realize I&#39;ve changed my mind and changed the phrasing of the problem many times, but as I understand it this is normal when I am not an expert in what I&#39;m talking about. I don&#39;t know what are exactly the policies of Stack Overflow when it comes to trying to leave this as not-a-mess. Let me know if I need to edit something, merge something, delete something or anything else and I&#39;ll try to do it.  Thanks again to those who helped me get to the core of it."}], "tags": [], "owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "is_accepted": false, "score": 0, "last_activity_date": 1576718613, "creation_date": 1576718613, "answer_id": 59402170, "question_id": 59398164, "link": "https://stackoverflow.com/questions/59398164/function-in-haskell-to-map-over-a-monadtrans/59402170#59402170", "title": "Function in Haskell to map over a MonadTrans?", "body": "<p>After a while, I finally came up with exactly what I was looking for since the beginning. I can use <code>StateT</code> exactly the way I wanted, and it has exactly the semantics I thought it had, but I did not explain it well (and put mistakes in what I wrote).</p>\n\n<p>Going back to my original post, I need not have a <code>State</code> as input, the <code>State</code>/<code>StateT</code> monad already includes the input in the monadic element. So what I needed was a function <code>recFuncT :: [t] -&gt; StateT s m a</code> that behaved equivalently to the following non-transformer one:</p>\n\n<pre><code>recFunc :: a -&gt; [t] -&gt; m (State s a)\nrecFunc x [] = return (return x)\nrecFunc x (t:ts) = myFunc (recFunc x ts)\n</code></pre>\n\n<p>It can be implemented directly, using the constructor <code>StateT</code> and <code>runStateT</code>. Here it is:</p>\n\n<pre><code>recFuncT :: a -&gt; [t] -&gt; StateT m s a\nrecFuncT x [] = return x\nrecFuncT x (t:ts) = StateT (\\s -&gt; myFunc (runStateT (recFuncT x ts) s))\n</code></pre>\n\n<p>Moreover, the function <code>transmap</code> can also be implemented in general, at least for <code>StateT</code>:</p>\n\n<pre><code>transmap :: Monad m =&gt; (forall b. m b -&gt; m b) -&gt; StateT s m a -&gt; StateT s m a\ntransmap f st = StateT (\\s -&gt; f (runStateT st s)\n</code></pre>\n\n<p>And then we could write <code>recFuncT</code> nicely in terms of it:</p>\n\n<pre><code>recFuncT :: a -&gt; [t] -&gt; StateT m s a\nrecFuncT x [] = return x\nrecFuncT x (t:ts) = transmap myFunc (recFuncT x ts)\n</code></pre>\n\n<p>I realize this does not really match with the code that I included originally, but it does match with the overall principle I was trying to appeal to saying that the <code>StateT</code> transformer is like adding state to my monad <code>m</code>, and therefore anything that can be done at the <code>m (State s a)</code> level can be done at the <code>StateT s m a</code> level.</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "edited": false, "score": 1, "creation_date": 1576775253, "post_id": 59402524, "comment_id": 105015668, "body": "It even has a predefined instance <code>MFunctor (StateT s)</code>, which is exactly what I wanted. This is exactly the answer I was initially looking for."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1576722317, "creation_date": 1576722317, "answer_id": 59402524, "question_id": 59398164, "link": "https://stackoverflow.com/questions/59398164/function-in-haskell-to-map-over-a-monadtrans/59402524#59402524", "title": "Function in Haskell to map over a MonadTrans?", "body": "<p>It appears that one concept you're seeking can be found in the <code>mmorph</code> package:</p>\n\n<pre><code>class MFunctor t where\n  -- The argument is generally required to be a monad morphism,\n  -- but some instances will work sensibly when it's not.\n  hoist :: Monad m =&gt; (forall x. m x -&gt; n x) -&gt; t m a -&gt; t n a\n</code></pre>\n\n<p>This is a little more general than your version because it allows the underlying monad to be replaced.</p>\n"}], "owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 59402524, "answer_count": 4, "score": 4, "last_activity_date": 1576722317, "creation_date": 1576693822, "question_id": 59398164, "link": "https://stackoverflow.com/questions/59398164/function-in-haskell-to-map-over-a-monadtrans", "title": "Function in Haskell to map over a MonadTrans?", "body": "<p>I have recently decided to start using monad transformations instead of stacking my monads, since it seems it's the right thing to do. I wasn't really stacking many monads before anyway. I get (I think) the idea behind it and the <code>lift</code> function, that, as I understand it, acts as a sort of <code>return</code> for the transformation (puts something from the underlying monad into the transformed monad).</p>\n\n<p>So far so good, but I don't see anything similar to an <code>fmap</code> function for monad transformations. Let me give you an example. Say I have a custom monad, <code>m</code>, and I use a <code>StateT</code> transformation on it, therefore using the type <code>StateT s m a</code> instead of <code>m (State s a)</code>.</p>\n\n<p>Now, it so happens that in my monad <code>m</code>, I have a function that transforms the monadic element (in fact it is one of the constructors of the monad, if you need details I can give) while keeping in some sense the underlying values: <code>myFunc :: m a -&gt; m a</code>.</p>\n\n<p>So I'm building a recursive function <code>recFunc :: State s a -&gt; [t] -&gt; m (State s a)</code> that looks similar to something like this:</p>\n\n<pre><code>recFunc :: State s a -&gt; [t] -&gt; m (State s a)\nrecFunc x [] = return x\nrecFunc x (t:ts) = myFunc (recFunc x ts)\n</code></pre>\n\n<p>But if I try to replicate this using monad transformations, I run into problems because I can find no way to plug in <code>myFunc</code> into the mix. It does not matter whether you write the input as <code>State s a</code> or as <code>StateT s Identity a</code> (which would be algebraically more precise?)</p>\n\n<pre><code>recFuncT :: StateT s Identity a -&gt; [t] -&gt; StateT s m a\nrecFuncT x [] = ???\nrecFuncT x (t:ts) = ????? where rec = recFuncT x ts\n</code></pre>\n\n<p>So what I'm looking for is something like the (invented, and don't know how I would implement, if possible) following functions:</p>\n\n<pre><code>transmap :: (MonadTrans t, Monad m) =&gt; (forall b. m b -&gt; m b) -&gt; t m a -&gt; t m a\ntransmap = ???\n\ntransreturn :: (MonadTrans t, Monad m) =&gt; m (t Identity a) -&gt; t m a\ntransreturn = ???\n</code></pre>\n\n<p>I have the feeling I should be able to define these using <code>lift</code>, but I don't see how, to be honest.</p>\n\n<p>If I had them, then I could do this:</p>\n\n<pre><code>recFuncT :: StateT s Identity a -&gt; [t] -&gt; StateT s m a\nrecFuncT x [] = transreturn (return x)\nrecFuncT x (t:ts) = transmap myFunc (recFuncT x ts)\n</code></pre>\n\n<p>Maybe what I really want is something more basic. I want the assumed isomorphism between <code>t m a</code> and <code>m (t Identity a)</code> to be explicit, so I'm looking for functions:</p>\n\n<pre><code>fromTrans :: t m a -&gt; m (t Identity a)\ntoTrans :: m (t Identity a) -&gt; t m a\n</code></pre>\n\n<p>As far as I understand monad transformers, these functions should always exist and be fairly straightforward, right?</p>\n\n<p>With these I could obviously implement <code>transmap</code> and <code>transreturn</code>:</p>\n\n<pre><code>transmap :: (MonadTrans t, Monad m) =&gt; (forall b. m b -&gt; m b) -&gt; t m a -&gt; t m a\ntransmap f x = toTrans (f (fromTrans x))\n\ntransreturn :: (MonadTrans t, Monad m) =&gt; m (t Identity a) -&gt; t m a\ntransreturn = toTrans\n</code></pre>\n\n<p>I am sure there is something obvious that I am overlooking. Please point at it for me.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1576686021, "post_id": 59396084, "comment_id": 104981533, "body": "<code>print putStrLn</code>?"}, {"owner": {"reputation": 375, "user_id": 3431557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ddc320a0b16d616cb5c9b6a6339131c?s=128&d=identicon&r=PG&f=1", "display_name": "user119264", "link": "https://stackoverflow.com/users/3431557/user119264"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1576686144, "post_id": 59396084, "comment_id": 104981596, "body": "@DanielWagner I originally put in the print because I thought that the types didn&#39;t match because of my misunderstanding of monads. However, with or without the print it still doesn&#39;t compile."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1576688468, "post_id": 59396084, "comment_id": 104982883, "body": "The error that arises with <code>print</code> <i>or</i> <code>putStrLn</code> is more interesting than the one generated by the obviously incorrect <code>print putStrLn</code>. Make sure your error message reflects the code in the question as well."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1576697033, "post_id": 59396084, "comment_id": 104986670, "body": "For future questions, please post text as text, and not as an image. <a href=\"https://meta.stackoverflow.com/questions/303812/discourage-screenshots-of-code-and-or-errors\" title=\"discourage screenshots of code and or errors\">meta.stackoverflow.com/questions/303812/&hellip;</a>"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1576722860, "post_id": 59396084, "comment_id": 104993977, "body": "You could, if you wanted to respect convention, remove your png and replace with text. This helps future users."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 5, "last_activity_date": 1576687045, "creation_date": 1576687045, "answer_id": 59396482, "question_id": 59396084, "link": "https://stackoverflow.com/questions/59396084/problem-with-printing-length-of-permutations-in-haskell/59396482#59396482", "title": "Problem with printing length of permutations in Haskell", "body": "<p><code>putStrLn</code> takes a parameter of type <code>String</code>, as evidenced by <a href=\"https://www.stackage.org/haddock/lts-14.17/base-4.12.0.0/Prelude.html#v:putStrLn\" rel=\"noreferrer\">its signature</a>.</p>\n\n<p><code>length</code> returns an <code>Int</code>, as evidenced by <a href=\"https://www.stackage.org/haddock/lts-14.17/base-4.12.0.0/Prelude.html#v:length\" rel=\"noreferrer\">its signature</a>.</p>\n\n<p>So obviously, trying to pass the result of <code>length</code> as a parameter to <code>putStrLn</code> causes a type mismatch. <code>Int</code> does not match <code>String</code>. As simple as that.</p>\n\n<p>The function <code>print</code>, on the other hand, takes parameter of any type (see <a href=\"https://www.stackage.org/haddock/lts-14.17/base-4.12.0.0/Prelude.html#v:print\" rel=\"noreferrer\">signature</a>), as long as that type has a <code>Show</code> instance, which <code>Int</code> does. So you can just replace <code>putStrLn</code> with <code>print</code>:</p>\n\n<pre><code>print $ length $ nub $ permutations str\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 7, "last_activity_date": 1576722458, "last_edit_date": 1576722458, "creation_date": 1576689121, "answer_id": 59397060, "question_id": 59396084, "link": "https://stackoverflow.com/questions/59396084/problem-with-printing-length-of-permutations-in-haskell/59397060#59397060", "title": "Problem with printing length of permutations in Haskell", "body": "<pre><code>print putStrLn $ length $ nub $ permutations str\n</code></pre>\n\n<p>is parsed by Haskell as</p>\n\n<pre><code>print putStrLn ( length ( nub ( permutations str )))\n</code></pre>\n\n<p>i.e. it calls <code>print</code> with 2 arguments, <code>putStrLn</code> and <code>length (nub (permutations str))</code>.</p>\n\n<p>You want to call it with just one parameter, so one more pair of parens is needed for that:</p>\n\n<pre><code>print ( putStrLn ( length ( nub ( permutations str ))))\n</code></pre>\n\n<p>This can be achieved with <code>$</code>s by just adding one more, as</p>\n\n<pre><code>print $ putStrLn $ length $ nub $ permutations str\n</code></pre>\n\n<p>This addresses only the syntactic issues with your code.</p>\n\n<p>Of course <code>print</code> with <code>putStrLn</code> is redundant. <code>putStrLn</code> already does all the output <code>print</code> would do (and even outputs one more newline after that). </p>\n\n<p>On the other hand <code>putStrLn</code> expects a string, but <code>length</code> produces an integer. To convert it to a string, the function <code>show</code> can be used, which <code>print</code> calls internally on its own.</p>\n\n<p>So it is either</p>\n\n<pre><code>print            $ length $ nub $ permutations str\n</code></pre>\n\n<p>or</p>\n\n<pre><code>putStrLn $ show $ length $ nub $ permutations str\n</code></pre>\n\n<p>as can be seen in GHCi:</p>\n\n<pre><code>&gt; :t print           . length . nub . permutations\n  :: Eq a =&gt; [a] -&gt; IO ()\n\n&gt; :t putStrLn . show . length . nub . permutations\n  :: Eq a =&gt; [a] -&gt; IO ()\n</code></pre>\n\n<p>If it has type, it makes <em>some</em> sense, at least.</p>\n"}], "owner": {"reputation": 375, "user_id": 3431557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ddc320a0b16d616cb5c9b6a6339131c?s=128&d=identicon&r=PG&f=1", "display_name": "user119264", "link": "https://stackoverflow.com/users/3431557/user119264"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1576722458, "creation_date": 1576685703, "last_edit_date": 1576687957, "question_id": 59396084, "link": "https://stackoverflow.com/questions/59396084/problem-with-printing-length-of-permutations-in-haskell", "title": "Problem with printing length of permutations in Haskell", "body": "<p>I'm starting out learning Haskell and I'm having a difficult time because the error messages are extremely cryptic. In particular, I'm not understanding the error messages when I run this code that is supposed to print the number of permutations of a string,</p>\n\n<pre><code>import Data.List\n\nmain::IO()\nmain = do\n        str &lt;- getLine\n        print putStrLn $ length $ nub $ permutations str\n</code></pre>\n\n<p>The error message I get is </p>\n\n<p><a href=\"https://i.stack.imgur.com/tFiLN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tFiLN.png\" alt=\"enter image description here\"></a></p>\n\n<p>However, when I run it in the REPL I get no such error:</p>\n\n<p><a href=\"https://i.stack.imgur.com/JW5jF.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JW5jF.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "timezone"], "comments": [{"owner": {"reputation": 767, "user_id": 841729, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/fb0153b7c04243e7fe2d1ec64f5daa91?s=128&d=identicon&r=PG", "display_name": "Small Hadron Collider", "link": "https://stackoverflow.com/users/841729/small-hadron-collider"}, "edited": false, "score": 1, "creation_date": 1576686478, "post_id": 59396062, "comment_id": 104981795, "body": "Looks like <a href=\"https://hackage.haskell.org/package/tz-0.1.2.1/docs/Data-Time-Zones.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/tz-0.1.2.1/docs/&hellip;</a> might work"}], "answers": [{"comments": [{"owner": {"reputation": 767, "user_id": 841729, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/fb0153b7c04243e7fe2d1ec64f5daa91?s=128&d=identicon&r=PG", "display_name": "Small Hadron Collider", "link": "https://stackoverflow.com/users/841729/small-hadron-collider"}, "edited": false, "score": 0, "creation_date": 1576833451, "post_id": 59401139, "comment_id": 105031705, "body": "I got it working with a <code>TimeZoneSeries</code>, it just wouldn&#39;t give me the right time. Maybe I needed to use <code>&#47;etc&#47;localtime</code> - hadn&#39;t found that."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1576710019, "creation_date": 1576710019, "answer_id": 59401139, "question_id": 59396062, "link": "https://stackoverflow.com/questions/59396062/displaying-a-local-time-in-haskell/59401139#59401139", "title": "Displaying a local time in Haskell", "body": "<p>The intended way of doing this with the <code>timezone-olson</code> package is to use a <code>TimeZoneSeries</code> which is the full series of time zone transitions over time, rather than merely a <code>TimeZone</code>, which reflects the time zone at a point in time.</p>\n\n<p>You will generally need to load the appropriate series from a file in <code>IO</code>.  You can load the default local time zone series from the standard <code>/etc/localtime</code> location, or you can load a specific series from, for example, <code>/usr/share/zoneinfo/America/Chicago</code> or whatever.  Unfortunately, there does not seem to be a robust, platform-independent way to specify and load time zone files.</p>\n\n<p>Once the <code>TimeZoneSeries</code> is read, it needs to be passed down to your pure computations, where you can use <code>utcToLocalTime'</code> to get a correct local time using the time zone for that time point.  Hopefully you already have a <code>Reader</code> handy:</p>\n\n<pre><code>import Control.Monad.Reader\nimport Data.Time (UTCTime(..), fromGregorian, LocalTime)\nimport Data.Time.LocalTime.TimeZone.Olson (getTimeZoneSeriesFromOlsonFile)\nimport Data.Time.LocalTime.TimeZone.Series (TimeZoneSeries, utcToLocalTime')\n\ndata R = R { tzs :: TimeZoneSeries }\n\nmain :: IO ()\nmain = do\n  mytzs &lt;- getTimeZoneSeriesFromOlsonFile \"/etc/localtime\"\n  print $ runReader getTimes R { tzs = mytzs }\n\ngetTimes :: Reader R LocalTime\ngetTimes = flip utcToLocalTime' (UTCTime (fromGregorian 2018 08 08) 0) &lt;$&gt; asks tzs\n</code></pre>\n\n<p>It looks like the <code>tz</code> package is the same, though it uses type <code>TZ</code> in place of <code>TimeZoneSeries</code>.  You still need to <code>loadTZFromFile</code> in <code>IO</code> and pass it down to a <code>utcToLocalTimeTZ</code> call located in your pure code.  There is a convenience function <code>loadLocalTZ</code> that reads from <code>/etc/localtime</code> (or an alternate location specified by the <code>TZ</code> environment variable); it <em>looks</em> platform-independent, but the <code>/etc/localtime</code> and <code>/usr/share/zoneinfo</code> paths are hard-coded in the source (except it uses the environment variable <code>TZDIR</code> in place of <code>/usr/share/zoneinfo</code>, if that's set).</p>\n\n<p>Anyway, the code would look like:</p>\n\n<pre><code>import Control.Monad.Reader\nimport Data.Time (UTCTime(..), fromGregorian, LocalTime)\n\nimport Data.Time.Zones (utcToLocalTimeTZ, loadLocalTZ, TZ)\n\ndata R = R { tz :: TZ }\n\nmain :: IO ()\nmain = do\n  mytz &lt;- loadLocalTZ\n  print $ runReader getTimes R { tz = mytz }\n\ngetTimes :: Reader R LocalTime\ngetTimes = flip utcToLocalTimeTZ (UTCTime (fromGregorian 2018 08 08) 0) &lt;$&gt; asks tz\n</code></pre>\n"}], "owner": {"reputation": 767, "user_id": 841729, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/fb0153b7c04243e7fe2d1ec64f5daa91?s=128&d=identicon&r=PG", "display_name": "Small Hadron Collider", "link": "https://stackoverflow.com/users/841729/small-hadron-collider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576710019, "creation_date": 1576685645, "question_id": 59396062, "link": "https://stackoverflow.com/questions/59396062/displaying-a-local-time-in-haskell", "title": "Displaying a local time in Haskell", "body": "<p>My state object is storing dates as <code>UTCTime</code>. But I need to show them to the user as the appropriate local time.</p>\n\n<p>I've tried using <code>getCurrentTimeZone</code> and then <code>utcToLocalTime</code>, but it doesn't work for dates in summer-time. The problem seems to be that <code>getCurrentTimeZone</code> returns my timezone <em>now</em>, not for the appropriate date.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let time = UTCTime (fromGregorian 2018 08 08) 0\ntz &lt;- getCurrentTimeZone -- GMT - my time zone now\nutcToLocalTime tz time\n-- 2018-08-08 00:00:00 - wrong\n</code></pre>\n\n<p>I can get it to work if I pass the date into <code>getTimeZone</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let time = UTCTime (fromGregorian 2018 08 08) 0\ntz &lt;- getTimeZone time -- BST - the timezone for the date\nutcToLocalTime tz time\n-- 2018-08-08 01:00:00 - right\n</code></pre>\n\n<p>The problem is, the code to set/display the time is deep into no-<code>IO</code> land (as it should be), so I can't run this code when I want to display the times.</p>\n\n<p>I've had a look at the <a href=\"https://hackage.haskell.org/package/timezone-olson-0.1.9/docs/Data-Time-LocalTime-TimeZone-Olson.html\" rel=\"nofollow noreferrer\">Olsen package</a>, but when I passed it <code>GMT</code> (using <code>timeZoneName</code>) it did the same as the first example above - couldn't work out how else to tell it to get the data.</p>\n"}, {"tags": ["haskell", "pdf", "report", "web-deployment", "yesod"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1576702799, "post_id": 59393306, "comment_id": 104988898, "body": "You can use CSS styles to set header and footer information."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1576703549, "post_id": 59393306, "comment_id": 104989144, "body": "@BobDalgleish could you make an example?"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 2, "creation_date": 1576707407, "post_id": 59393306, "comment_id": 104990515, "body": "I just did a search for &quot;html2pdf header and footer&quot; and came up with lots of examples."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1576714902, "post_id": 59393306, "comment_id": 104992537, "body": "@BobDalgleish no example has solved my issue, have you already done it?!\\"}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1576786348, "post_id": 59393306, "comment_id": 105019994, "body": "Are you able to get any results at all from your CSS? One issue I found on another project is that some of the CSS is sensitive to the media type."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1576862748, "post_id": 59393306, "comment_id": 105044279, "body": "@BobDalgleish no man, I didn&#39;t. My deadline to deliver the project were close so I used Jasper Reports"}], "answers": [{"comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1577067333, "post_id": 59448737, "comment_id": 105081667, "body": "We use puppeteer at work, whereas your library uses wkhtmltopdf, but it works on every page for us at least."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1577068147, "post_id": 59448737, "comment_id": 105081773, "body": "that is the problem, using the wkhtmltopdf alone, I didn&#39;t manage to make it out even using the way its documentation tells it should be. Very poor library interface."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1577069841, "post_id": 59448737, "comment_id": 105081988, "body": "Try with puppeteer (install <a href=\"http://npmjs.com/package/puppeteer-cli\" rel=\"nofollow noreferrer\">npmjs.com/package/puppeteer-cli</a>). It uses headless Chrome, so it&#39;s just the same as doing File &gt; Print from Chrome. It&#39;s more reliable than other ways because you have a full browser engine at your disposal."}], "tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": false, "score": 0, "last_activity_date": 1577056405, "creation_date": 1577056405, "answer_id": 59448737, "question_id": 59393306, "link": "https://stackoverflow.com/questions/59393306/yesod-haskell-how-to-create-pdf-reports-with-a-header-and-footer-on-each-page/59448737#59448737", "title": "Yesod Haskell - How to create PDF reports, with a header and footer on each page?", "body": "<p>You can do this with CSS pretty easily:</p>\n\n<pre><code>.header {\n  position: fixed;\n  top: 36px;\n  left: 51px;\n}\n\n.footer {\n  position: fixed;\n  bottom: 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577056405, "creation_date": 1576676470, "question_id": 59393306, "link": "https://stackoverflow.com/questions/59393306/yesod-haskell-how-to-create-pdf-reports-with-a-header-and-footer-on-each-page", "title": "Yesod Haskell - How to create PDF reports, with a header and footer on each page?", "body": "<p>I am currently trying out <code>Yesod.Content.PDF</code> with the function html2PDF, but I also need a way to make a footer and header for each page of my reports. Is there a way of doing this or a better tool for the Yesod ecosystem? I was thinking about using Jasper Reports, but it would require more installations and dealing with other language (Java), I would like to avoid that overhead and keep things as small and simple as possible.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1576672888, "post_id": 59391777, "comment_id": 104974210, "body": "I like your second approach. Infact, I would even refactor that into a single function such that you don&#39;t do the <code>|| (Just SearchR == mcurrentRoute)</code> in the hamlet file. The goal is to usually keep all your logic in the Haskell file and keep it minimal in the Hamlet file. If you have more dynamic parts, I would just create a single function to handle them (ie compose lots of single function to do what I want)."}, {"owner": {"reputation": 161, "user_id": 12147490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90b4bec77f92f0db5db412409f1275e4?s=128&d=identicon&r=PG&f=1", "display_name": "bg2000 Reinstate Monica", "link": "https://stackoverflow.com/users/12147490/bg2000-reinstate-monica"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1576674025, "post_id": 59391777, "comment_id": 104974781, "body": "Thanks for the kudos Sibi! The tip about &quot;the goal is usually&quot; is really valuable. I want to do things the Yesod way. Interesting, I think I do not fully understand, what would the return type of the single function be? I thought of returning a string like &quot;SearchResultsR&quot; to compare against, but this seems messy."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1576674088, "post_id": 59391777, "comment_id": 104974817, "body": "The return type will be <code>Bool</code>."}, {"owner": {"reputation": 161, "user_id": 12147490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90b4bec77f92f0db5db412409f1275e4?s=128&d=identicon&r=PG&f=1", "display_name": "bg2000 Reinstate Monica", "link": "https://stackoverflow.com/users/12147490/bg2000-reinstate-monica"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1576674340, "post_id": 59391777, "comment_id": 104974949, "body": "Thank you. An example: <code>:(isThisRouteSearchResultsROrSearchR mcurrentRoute) :.active</code> Or could do <code>:(isThisRouteSearchResultsR mcurrentRoute) || (isThisRouteSearchR mcurrentRoute) :.active</code> Perhaps these functions could be generated automatically in Foundation.hs by some Template Haskell."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1576674516, "post_id": 59391777, "comment_id": 104975040, "body": "That&#39;s right. I would prefer the first solution <code>:(isThisRouteSearchResultsROrSearchR mcurrentRoute) :.active</code>, but that&#39;s just me. I wouldn&#39;t reach to Template Haskell for this as this is quite simple (and readable)!"}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 12147490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90b4bec77f92f0db5db412409f1275e4?s=128&d=identicon&r=PG&f=1", "display_name": "bg2000 Reinstate Monica", "link": "https://stackoverflow.com/users/12147490/bg2000-reinstate-monica"}, "is_accepted": true, "score": 0, "last_activity_date": 1583374827, "creation_date": 1583374827, "answer_id": 60537343, "question_id": 59391777, "link": "https://stackoverflow.com/questions/59391777/yesod-compare-getcurrentroute-to-a-route-with-dynamic-parameters/60537343#60537343", "title": "Yesod Compare getCurrentRoute to a route with dynamic parameters", "body": "<p>The answer given by Sibi in the comments (thank you Sibi) is that the second approach in the question is in good form / style.</p>\n\n<p>e.g. in hamlet:\n<code>:(isThisRouteSearchResultsROrSearchR mcurrentRoute) :.active</code> </p>\n\n<p>Or could do \n<code>:(isThisRouteSearchResultsR mcurrentRoute) || (isThisRouteSearchR mcurrentRoute) :.active</code></p>\n\n<p>And you define these functions in Foundation.hs (Haskell) as per the question code.</p>\n\n<p>Sibi:</p>\n\n<blockquote>\n  <p>The goal is to usually keep all your logic in the Haskell file and\n  keep it minimal in the Hamlet file.</p>\n</blockquote>\n\n<p>Thank you Sibi for your guidance.</p>\n"}], "owner": {"reputation": 161, "user_id": 12147490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90b4bec77f92f0db5db412409f1275e4?s=128&d=identicon&r=PG&f=1", "display_name": "bg2000 Reinstate Monica", "link": "https://stackoverflow.com/users/12147490/bg2000-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 60537343, "answer_count": 1, "score": 3, "last_activity_date": 1583374827, "creation_date": 1576671123, "question_id": 59391777, "link": "https://stackoverflow.com/questions/59391777/yesod-compare-getcurrentroute-to-a-route-with-dynamic-parameters", "title": "Yesod Compare getCurrentRoute to a route with dynamic parameters", "body": "<p>A question of coding haskell with good form, instead of 'it works'.</p>\n\n<p>We want our menu navigation items to have a highlighted CSS class when the user is on that page.</p>\n\n<p>Easy.</p>\n\n<p>Here are my routes:</p>\n\n<pre><code>...\n/simple SimpleR GET POST\n/search SearchFormR GET POST\n/searchresults/#Int/#Text SearchResultsR GET \n...\n</code></pre>\n\n<p>In my hamlet template I have the below. This works perfectly, the link is highlighted when the user is on that page. The route is simple.</p>\n\n<pre><code>&lt;li .nav-item&gt;\n    &lt;a .nav-link :Just SimpleR == mcurrentRoute:.active href=@{SimpleR}&gt;\n        Simple page\n</code></pre>\n\n<p>This link should be highlighted when the user is on either of <code>SearchFormR</code> or <code>SearchResultsR</code>.</p>\n\n<pre><code>&lt;li .nav-item&gt;\n   &lt;a .nav-link :((Just (SearchResultsR _ _)) == mcurrentRoute) || (Just SearchFormR == mcurrentRoute):.active href=@{SearchFormR}&gt;\n       Search\n\n</code></pre>\n\n<p>This code does not work, because the <code>SearchResultsR</code> route constructor needs the two things passed to it. I cannot write <code>_ _</code> as I have above, since the constructor needs a literal value. And besides, the result of the constructor will be compared with <code>==</code> to the actual route anyway, it won't match unless both parameters happen to be the exact same.</p>\n\n<p>Without the <code>_ _</code> I of course get a type error, expecting two more things passed to the <code>SearchResultsR</code> constructor.</p>\n\n<p>That is, I want to check if we are on any <code>SearchResultsR</code> route, not only match <code>SearchResultsR 123 \"abc\"</code>.</p>\n\n<p>My first thought was to make a function to convert the route to a string and then check if that string contains the string of the route, but this is bad, and not the haskell / typesafe way.</p>\n\n<p>My second attempt is using pattern matching:</p>\n\n<p>Foundation.hs:</p>\n\n<pre><code>isThisRouteSearchResultsR :: Maybe (Route App) -&gt; Bool\nisThisRouteSearchResultsR (Just (SearchResultsR _ _)) = True\nisThisRouteSearchResultsR _ = False\n</code></pre>\n\n<p>Hamlet template:</p>\n\n<pre><code>&lt;li .nav-item&gt;\n   &lt;a .nav-link :(isThisRouteSearchResultsR mcurrentRoute) || (Just SearchR == mcurrentRoute) :.active href=@{SearchR}&gt;\n       Search\n</code></pre>\n\n<p>But this doesn't seem much better. What if I have a lot more routes that have dynamic parts?\nWhat is the proper way to do this? I looked at haskellers site source code but couldn't find the answer</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1576685466, "post_id": 59391670, "comment_id": 104981210, "body": "while learning, it might help using clearer names like <code>newtype Cont r a = MkCont { runCont :: (a -&gt; r) -&gt; r }</code>. Also, maybe use <code>br</code> for <code>k :: b -&gt; r</code>, <code>arr</code> or <code>ar_r</code> for <code>foo :: (a -&gt; r) -&gt; r</code>, etc."}, {"owner": {"reputation": 1263, "user_id": 5817767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/209584382725014/picture?type=large", "display_name": "Pawan Kumar", "link": "https://stackoverflow.com/users/5817767/pawan-kumar"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1576728692, "post_id": 59391670, "comment_id": 104995021, "body": "Thanks for the advise. I will follow that."}], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 5, "last_activity_date": 1576672314, "creation_date": 1576672314, "answer_id": 59392117, "question_id": 59391670, "link": "https://stackoverflow.com/questions/59391670/clarity-on-implementation-of-continuation-monad-instance/59392117#59392117", "title": "Clarity on Implementation of Continuation Monad Instance", "body": "<p>It looks to me like you were simply getting confused - which I find very easy to do with continuations!</p>\n\n<p>This definition:</p>\n\n<pre><code>newtype Cont r a = Cont { rC :: (a -&gt; r) -&gt; r }\n</code></pre>\n\n<p>defines 2 functions \"for free\":</p>\n\n<pre><code>Cont :: ((a -&gt; r) -&gt; r) -&gt; Cont r a\nrC :: Cont r a -&gt; (a -&gt; r) -&gt; r\n</code></pre>\n\n<p>Then in your attempted definition of <code>&gt;&gt;=</code>, you had:</p>\n\n<pre><code>Cont aCont &gt;&gt;= f = Cont $ \\k -&gt; rC (aCont (\\a -&gt; f a)) (\\b -&gt; k b)\n</code></pre>\n\n<p>Here <code>aCont (\\a -&gt; f a)</code> is being used as the argument to <code>rC</code>, so must have type <code>Cont r a</code>. At the same time, since <code>Cont</code> is a constructor with the type shown above, from <code>Cont aCont</code> then GHC must assign to <code>aCont</code> the type <code>(a -&gt; r) -&gt; r</code>. This in turn means <code>f a</code> must have type <code>r</code>, while <code>a</code> has type <code>a -&gt; r</code>.</p>\n\n<p>But from the type of <code>&gt;&gt;=</code>, <code>f</code> must have type <code>a -&gt; Cont r b</code>. So <code>f a</code> must simultaneously be of type <code>r</code> and <code>Cont r b</code>, and trying to make those two types the same clearly involves an infinite regress - which is exactly what GHC is telling you.</p>\n\n<p>The details above aren't too important however. What seems obvious is that <code>aCont</code> was already \"unwrapped\" and you didn't need to apply the unwrapping function <code>rC</code> to it.</p>\n"}, {"tags": [], "owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "is_accepted": false, "score": 1, "last_activity_date": 1576680492, "last_edit_date": 1576680492, "creation_date": 1576680047, "answer_id": 59394374, "question_id": 59391670, "link": "https://stackoverflow.com/questions/59391670/clarity-on-implementation-of-continuation-monad-instance/59394374#59394374", "title": "Clarity on Implementation of Continuation Monad Instance", "body": "<p>The <code>r</code> types must match in the definition of the <code>&gt;&gt;=</code></p>\n\n<p>If your type was </p>\n\n<pre><code>type Cont' a = forall r . Cont r a\n</code></pre>\n\n<p>Your definition would be valid </p>\n\n<pre><code>bind  :: Cont' a -&gt; (a -&gt; Cont' b) -&gt; Cont'  b\nbind  (Cont aCont) f = Cont $ \\k -&gt; rC (aCont (\\a -&gt; f a)) (\\b -&gt; k b)\n</code></pre>\n\n<p>The cool thing is without newtype wrapper this definition is simply function application.</p>\n\n<pre><code>bind\n  :: (forall r . (a -&gt; r) -&gt; r)\n  -&gt; (forall r . a -&gt; (b -&gt; r) -&gt; r)\n  -&gt; (forall r . (b -&gt; r) -&gt; r)\nbind a b = a b\n</code></pre>\n\n<p>Without using existential quantification  you should do explicitly pass continuations.</p>\n\n<pre><code>bind' :: ((a -&gt; r) -&gt; r) -&gt; (a -&gt; (b -&gt; r) -&gt; r) -&gt; ((b -&gt; r) -&gt; r)\nbind' a b cont = a (\\a' -&gt; b a' cont)\n</code></pre>\n\n<p>Finally with newtype wrapper </p>\n\n<pre><code>bind'' :: Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\nbind'' a b = Cont $ \\g -&gt; rC  a (\\a' -&gt; rC (b a') g )\n</code></pre>\n"}], "owner": {"reputation": 1263, "user_id": 5817767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/209584382725014/picture?type=large", "display_name": "Pawan Kumar", "link": "https://stackoverflow.com/users/5817767/pawan-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 59392117, "answer_count": 2, "score": 5, "last_activity_date": 1576680492, "creation_date": 1576670681, "last_edit_date": 1576673389, "question_id": 59391670, "link": "https://stackoverflow.com/questions/59391670/clarity-on-implementation-of-continuation-monad-instance", "title": "Clarity on Implementation of Continuation Monad Instance", "body": "<p>Below is the code sample I tried for Continuation Monad</p>\n\n<pre><code>newtype Cont r a = Cont { rC :: (a -&gt; r) -&gt; r }\n\ninstance Functor (Cont r) where\n  fmap :: (a -&gt; b) -&gt; Cont r a -&gt; Cont r b\n  fmap f (Cont aCont) = Cont $ \\k -&gt; aCont (\\a -&gt; k (f a))\n\ninstance Applicative (Cont r) where\n  pure :: a -&gt; Cont r a\n  pure a = Cont $ \\k -&gt; k a\n\n  (&lt;*&gt;) :: Cont r (a -&gt; b) -&gt; Cont r a -&gt; Cont r b\n  Cont fCont &lt;*&gt; Cont aCont = Cont $ \\k -&gt; fCont (\\f -&gt; aCont (\\a -&gt; k (f a)))\n\ninstance Monad (Cont r) where\n  return = pure\n\n  (&gt;&gt;=) :: Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n  Cont aCont &gt;&gt;= f = Cont $ \\k -&gt; rC (aCont (\\a -&gt; f a)) (\\b -&gt; k b)\n  -- f a :: Cont r b\n  -- aCont :: (a -&gt; r) -&gt; r\n  -- t = aCont (\\a -&gt; f a) :: Cont r b\n  -- t' = rc t :: (b -&gt; r) -&gt; r\n  -- k :: b -&gt; r\n  -- t' (\\b -&gt; k b) -&gt; r\n</code></pre>\n\n<p>This is Failing with below error </p>\n\n<pre><code>&lt;interactive&gt;:158:52: error:\n    * Occurs check: cannot construct the infinite type: r ~ Cont r b\n    * In the expression: f a\n      In the first argument of `aCont', namely `(\\ a -&gt; f a)'\n      In the first argument of `rC', namely `(aCont (\\ a -&gt; f a))'\n    * Relevant bindings include\n        k :: b -&gt; r (bound at &lt;interactive&gt;:158:30)\n        f :: a -&gt; Cont r b (bound at &lt;interactive&gt;:158:18)\n        aCont :: (a -&gt; r) -&gt; r (bound at &lt;interactive&gt;:158:8)\n        (&gt;&gt;=) :: Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n          (bound at &lt;interactive&gt;:158:14)\n</code></pre>\n\n<p>And when I changed the <strong>bind</strong> code as below it worked. Please help me with the type error.</p>\n\n<pre><code>  (&gt;&gt;=) :: Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n  Cont aCont &gt;&gt;= f = Cont $ \\k -&gt; aCont (\\a -&gt; rC (f a) (\\b -&gt; k b))\n</code></pre>\n"}, {"tags": ["haskell", "filter"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1576666524, "post_id": 59390491, "comment_id": 104971031, "body": "Hint: use <code>zipWith</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1576666617, "post_id": 59390491, "comment_id": 104971082, "body": "<code>However, this does not work as expected: it seems that Haskell always considers the second element of the list, as if &quot;head xs&quot; is calculated only once, but this does not seem normal to me since Haskell is lazy.</code> I am not sure why you expected <code>head xs</code> to be calculated more than once, or why it would ever refer to any element other than the second one of the list. And that has nothing to do with laziness."}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1576672486, "post_id": 59390551, "comment_id": 104973980, "body": "The usual caveat applied here about <code>tail</code>: better to use <code>drop 1</code> in case the function is ever passed an empty list."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1576672528, "post_id": 59390551, "comment_id": 104974008, "body": "@RobinZigmond: well here it will not matter, since <code>zipWith</code> will first evaluate the first parameter. Hence even if you pass an empty list, it will work, due to laziness."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1576740969, "post_id": 59390551, "comment_id": 104998369, "body": "But it&#39;s silly -- there is a subtle error which is however cancelled out by a subtle conditional strictness.  Or you have the option to make it all total with 0 instead of 2 dependencies on subtle things..."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1576672559, "last_edit_date": 1576672559, "creation_date": 1576666684, "answer_id": 59390551, "question_id": 59390491, "link": "https://stackoverflow.com/questions/59390491/taking-the-rest-of-the-list-into-account-in-filter/59390551#59390551", "title": "Taking the rest of the list into account in filter", "body": "<p>You can make use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:zipWith\" rel=\"nofollow noreferrer\"><strong><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code></strong></a> where we pass the list, and its tail. Indeed:</p>\n\n<pre><code>sucGreater :: Ord a =&gt; [a] -&gt; [Bool]\nsucGreater x = zipWith (&lt;) x (tail x)\n</code></pre>\n\n<p>or as @RobinZigmond says, we can omit tail, and use <code>drop</code>:</p>\n\n<pre><code>sucGreater :: Ord a =&gt; [a] -&gt; [Bool]\nsucGreater x = zipWith (&lt;) x (drop 1 x)\n</code></pre>\n\n<p>For the given sample list, this gives us:</p>\n\n<pre><code>Prelude&gt; sucGreater [3,7,2,1,9]\n[True,False,False,True]\n</code></pre>\n\n<p>I leave it as an exercise to the count the number of <code>True</code>s in that list.</p>\n"}], "owner": {"reputation": 918, "user_id": 4086503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4cedc52f61225b6ac8451e1d03e7981?s=128&d=identicon&r=PG&f=1", "display_name": "Stubborn", "link": "https://stackoverflow.com/users/4086503/stubborn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 59390551, "answer_count": 1, "score": 2, "last_activity_date": 1576672559, "creation_date": 1576666479, "last_edit_date": 1576667318, "question_id": 59390491, "link": "https://stackoverflow.com/questions/59390491/taking-the-rest-of-the-list-into-account-in-filter", "title": "Taking the rest of the list into account in filter", "body": "<p>I need to display the number of elements whose successor is greater in a list. For example, in the list [3,7,2,1,9] my function should return 2 because 7 is greater than 3 and 9 is greater than 1.<br>\nIn order to do that,I was thinking to use the filter function:</p>\n\n<pre><code>greaterElems :: Ord a =&gt; [a] -&gt; Int\ngreaterElems [] = 0\ngreaterElems [x] = 0\ngreaterElems (x:xs) = length (filter (&lt; head xs) (x:xs))\n</code></pre>\n\n<p>However, this does not work as expected: it seems that Haskell always considers the second element of the list, as if \"head xs\" is calculated only once, but this does not seem normal to me since Haskell is lazy.<br>\nWhat am I missing and how could I fix my code in order to achieve my goal?</p>\n"}, {"tags": ["haskell", "functional-programming", "ghc"], "comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 1, "creation_date": 1576660155, "post_id": 59388556, "comment_id": 104967776, "body": "btw: If you type <code>:i f</code> or <code>:t f</code> in prelude you get the name along with some more information about the function, might that help your cause?"}, {"owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1576660164, "post_id": 59388556, "comment_id": 104967783, "body": "That is literally something I would like to show, that doing \u02cbconst f\u02cb on \u02cb5\u02cb gives \u02cbf\u02cb"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1576660407, "post_id": 59388556, "comment_id": 104967910, "body": "It would also break referential transparency. Since in Haskell there should be no functional difference between an expression and its evaluated result."}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 1, "creation_date": 1576660649, "post_id": 59388556, "comment_id": 104968045, "body": "@LukeCollins For demonstration purposes you could use <a href=\"https://wiki.haskell.org/Lambdabot\" rel=\"nofollow noreferrer\">lambdabot</a> which has the <code>?src</code> command, see <a href=\"https://stackoverflow.com/questions/5786372/how-can-i-view-the-definition-of-a-function-in-haskell-ghci\">this question</a>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1576664016, "post_id": 59388556, "comment_id": 104969721, "body": "Functions don&#39;t have names. They are <i>values</i>. Variables have names. What is the name of 5? There is none."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576678661, "post_id": 59388556, "comment_id": 104977194, "body": "Even Python is doing something subtly different. Define a function <code>f</code>, then set <code>g = f</code>, then evaluate <code>g</code>. It still reports the name as <code>f</code>. Functions are also a special case, because they have a <code>__name__</code> attribute which the <code>def</code> statement sets. Other values do not. In any case, the variable you are using to <i>reference</i> the function isn&#39;t relevant to the name."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1576686910, "post_id": 59388556, "comment_id": 104982053, "body": "@n.&#39;pronouns&#39;m. Functions are often defined with names, and debugging tools are allowed to break referential transparency."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1576692621, "post_id": 59388556, "comment_id": 104984821, "body": "@user253751 Non-functions are also often defined with names. I have nothing against debugging tools breaking referential transparency, but it isn&#39;t clear how exactly they should do that. <code>x = 5; f y = g y + 1; g z = z * 42; print $ f x</code> You stop inside <code>g</code> and want to see the name of <code>z</code>. Is it <code>z</code>? Is it <code>y</code>? Is it <code>x</code>? Is it all of the above? Why? How would a debugging tool implement your option of choice?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1576692853, "post_id": 59388556, "comment_id": 104984924, "body": "@n.&#39;pronouns&#39;m. I don&#39;t particularly care - you may as well ask what it should print for the name of <code>z</code> when you execute <code>print $ f (2 + 2)</code>. Here is how I would implement that in a debugging tool: Every function that is defined with a name (syntax <code>f x = x + 2</code> for example, but not <code>f = \\x -&gt; x + 2</code>) is tagged with its name, source filename and line number. Every other function is tagged with its filename and line number. It is not complicated. Yes, <code>f . g</code> would return the location of the definition of <code>(.)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1576661571, "creation_date": 1576661571, "answer_id": 59389045, "question_id": 59388556, "link": "https://stackoverflow.com/questions/59388556/is-it-possible-to-show-a-functions-name-in-haskell-ghci/59389045#59389045", "title": "Is it possible to show a function&#39;s name in Haskell (ghci)?", "body": "<p>For demonstration purposes, you can try using the <a href=\"https://www.stackage.org/haddock/lts-14.17/simple-reflect-0.3.3/Debug-SimpleReflect.html\" rel=\"nofollow noreferrer\"><code>simple-reflect</code></a> package. It allows some forms of symbolic computation:</p>\n\n<pre><code>&gt; foldr f x [1,2,3]\nf 1 (f 2 (f 3 x))\n&gt; foldl f x [1,2,3]\nf (f (f x 1) 2) 3\n</code></pre>\n\n<p>Beware, it has its own limitations. For instance <code>(f . g) x</code> won't work unless with suitable type annotations. <code>[1] ++ x</code> won't work at all.</p>\n\n<p>Still, if you prepare the examples for a demonstration, you can check them in advance and ensure they work.</p>\n"}], "owner": {"reputation": 1306, "user_id": 5664775, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QqQGd.jpg?s=128&g=1", "display_name": "Luke Collins", "link": "https://stackoverflow.com/users/5664775/luke-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576661571, "creation_date": 1576659678, "last_edit_date": 1576661341, "question_id": 59388556, "link": "https://stackoverflow.com/questions/59388556/is-it-possible-to-show-a-functions-name-in-haskell-ghci", "title": "Is it possible to show a function&#39;s name in Haskell (ghci)?", "body": "<p>I know it is not possible to <a href=\"https://wiki.haskell.org/Show_instance_for_functions\" rel=\"nofollow noreferrer\">show the function's body</a> since Haskell carries out optimisations, but is it possible to somehow show it's <em>name</em>?</p>\n\n<p>I would like something like</p>\n\n<pre><code>Prelude&gt; f\n[Function f]\n</code></pre>\n\n<p>similar to what other REPL's do (Python, javascript, etc.)</p>\n\n<p>What I get with Haskell is</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Prelude&gt; f\n&lt;interactive&gt;:2:1: error:\n    \u2022 No instance for (Show (Integer -&gt; Integer)) arising from a use of \u2018print\u2019 (maybe you haven't applied a function to enough arguments?)\n    \u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>which is not helpful in demonstrations.</p>\n"}, {"tags": ["haskell", "shake"], "answers": [{"comments": [{"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1576647382, "post_id": 59385319, "comment_id": 104963157, "body": "Correct me if I&#39;m wrong, but I don&#39;t think <code>want</code> and <code>need</code> are interchangeable. <code>want</code> seems to: &quot;Require that the argument files are built by the rules, used to specify the target.&quot; whereas <code>need</code> declares that target&#39;s dependencies. Could you change your answer to a minimum working example to show how a directory of an arbitrary number of files could be transformed into another directory of that same number of files?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1576672185, "post_id": 59385319, "comment_id": 104973821, "body": "<code>action</code> is how you move from <code>Action</code> to <code>Rules</code>, and <code>want</code> is basically just <code>action . need</code>."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1576641937, "creation_date": 1576641937, "answer_id": 59385319, "question_id": 59385009, "link": "https://stackoverflow.com/questions/59385009/in-haskell-shake-how-can-i-want-a-file-pattern/59385319#59385319", "title": "In Haskell Shake, how can I want a file pattern?", "body": "<p><code>getDirectoryFiles</code> returns a result in the <code>Action</code> monad, but <code>want</code> returns a result in the <code>Rules</code> monad. You probably meant <code>need</code> instead, which is basically the same as <code>want</code> but in <code>Action</code>. Then just use <code>&gt;&gt;=</code> or <code>do</code> blocks like you would with any other monad:</p>\n\n<pre><code>do\n  directoryFiles &lt;- getDirectoryFiles path patterns\n  need directoryFiles\n</code></pre>\n\n<p>If you want to end up back in <code>Rules</code> after that, then wrap the entire <code>do</code> block in a call to <code>action</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 1, "last_activity_date": 1576669131, "last_edit_date": 1576669131, "creation_date": 1576664706, "answer_id": 59389937, "question_id": 59385009, "link": "https://stackoverflow.com/questions/59385009/in-haskell-shake-how-can-i-want-a-file-pattern/59389937#59389937", "title": "In Haskell Shake, how can I want a file pattern?", "body": "<p>If I understand you correctly, you can do like this.</p>\n\n<p>First of all, write a rule that creates the <em>html</em> file from <em>xml</em>.</p>\n\n<pre><code>main = shakeArgs shakeOptions $ do\n    \"dest/*.html\" %&gt; \\out -&gt; do\n        let src = \"source\" &lt;/&gt; dropDirectory1 out -&lt;.&gt; \"xml\"\n        -- todo: generate out (HTML) from src (XML)\n</code></pre>\n\n<p>Then you can write a rule by <code>action</code> that will be run in every build execution.</p>\n\n<pre><code>main = shakeArgs shakeOptions $ do\n    action $ do\n        srcs &lt;- getDirectoryFiles \"source\" [\"*.xml\"]\n        need [\"dest\" &lt;/&gt; src -&lt;.&gt; \"html\" | src &lt;- srcs]\n\n    \"dest/*.html\" %&gt; \\out -&gt; do\n        let src = \"source\" &lt;/&gt; dropDirectory1 out -&lt;.&gt; \"xml\"\n        -- todo: translate HTML(out) from XML(src)\n</code></pre>\n\n<hr>\n\n<p>For your information, <code>want</code> defined like: <code>want xs = action $ need xs</code>.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 59389937, "answer_count": 2, "score": 0, "last_activity_date": 1576669131, "creation_date": 1576639072, "question_id": 59385009, "link": "https://stackoverflow.com/questions/59385009/in-haskell-shake-how-can-i-want-a-file-pattern", "title": "In Haskell Shake, how can I want a file pattern?", "body": "<p>I have a directory of xml files in a source directory that I want to turn into a directory of html files in a destination directory. It seems I can use <code>getDirectoryFiles</code> to get files from a directory, but that is an Action, and <code>want</code> needs not an <code>Action [FilePath]</code> but just a <code>[FilePath]</code>. How can I do something like <code>want [\"dest/*.html\"]</code> in Shake? </p>\n"}, {"tags": ["haskell", "quickcheck", "haskell-hedgehog"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1580212913, "post_id": 59383320, "comment_id": 106016421, "body": "A couple of weeks later I realize I should have also asked about how to mark a property as failing ..."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 8, "last_activity_date": 1576624317, "last_edit_date": 1576624317, "creation_date": 1576623760, "answer_id": 59383320, "question_id": 59383136, "link": "https://stackoverflow.com/questions/59383136/quickcheck-why-isnt-there-a-function-to-pass-a-test-and-what-to-use-instead/59383320#59383320", "title": "QuickCheck: why isn&#39;t there a function to pass a test and what to use instead?", "body": "<p>You can use the <code>property</code> function from the <code>Testable</code> class, and various <code>Testable</code> instances to create a <code>Property</code> with whatever characteristics you need. </p>\n\n<p>For example, <code>property ()</code> always succeeds. For another example, <code>property (b :: Bool)</code> succeeds iff <code>b == True</code>.</p>\n\n<p>So you could do this for example:</p>\n\n<pre><code>prop_specialPair :: SpecialPair -&gt; Property\nprop_specialPair SpecialPair { xs } =\n  case xs of\n    x:_ -&gt; x =/= 3\n    _   -&gt; property ()\n</code></pre>\n\n<p>Or you can make it more explicit by using the <code>Testable Result</code> instance and the value <code>succeeded :: Result</code>:</p>\n\n<pre><code>prop_specialPair :: SpecialPair -&gt; Property\nprop_specialPair SpecialPair { xs } =\n  case xs of\n    x:_ -&gt; x =/= 3\n    _   -&gt; property succeeded\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 1, "last_activity_date": 1576669796, "creation_date": 1576669796, "answer_id": 59391402, "question_id": 59383136, "link": "https://stackoverflow.com/questions/59383136/quickcheck-why-isnt-there-a-function-to-pass-a-test-and-what-to-use-instead/59391402#59391402", "title": "QuickCheck: why isn&#39;t there a function to pass a test and what to use instead?", "body": "<p>You could also use implication with <a href=\"http://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:-61--61--62-\" rel=\"nofollow noreferrer\"><code>(==&gt;)</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>prop_specialPair :: Property\nprop_specialPair =\n  forAll specialPair $ \\(_, xs) -&gt;\n    not (null xs) ==&gt; take 1 xs =/= [3]\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 59383320, "answer_count": 2, "score": 7, "last_activity_date": 1576669796, "creation_date": 1576622468, "question_id": 59383136, "link": "https://stackoverflow.com/questions/59383136/quickcheck-why-isnt-there-a-function-to-pass-a-test-and-what-to-use-instead", "title": "QuickCheck: why isn&#39;t there a function to pass a test and what to use instead?", "body": "<p>Why isn't there a <code>QuickCheck</code> function similar to <code>hedgehog</code>'s <a href=\"https://www.stackage.org/haddock/lts-14.17/hedgehog-1.0.1/Hedgehog.html#v:success\" rel=\"noreferrer\"><code>success</code></a>? In particular I was wondering how one could translate a property like the following one:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>prop_specialPair :: Property\nprop_specialPair = property $ do\n  (_, xs) &lt;- forAll specialPair\n  case xs of\n    x:_ -&gt; x /== 3\n    _   -&gt; success\n\n</code></pre>\n\n<p>In <code>QuickCheck</code> if I use <a href=\"http://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:-61--47--61-\" rel=\"noreferrer\"><code>=/=</code></a> then I'm forced to return something of type <code>Property</code>, and there seem to be no constant function to return a passing property.</p>\n\n<p>So I either have to resort to the <code>Bool</code> type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>prop_specialPair :: SpecialPair -&gt; Bool\nprop_specialPair SpecialPair { xs } =\n  case xs of\n    x:_ -&gt; x == 3\n    _   -&gt; True\n</code></pre>\n\n<p>Or use a very awkward encoding for <code>success</code>, e.g.:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>prop_specialPair :: SpecialPair -&gt; Property\nprop_specialPair SpecialPair { xs } =\n  case xs of\n    x:_ -&gt; x =/= 3\n    _   -&gt; True === True\n</code></pre>\n\n<p>Are there better ways to express the property above in <code>QuickCheck</code>?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1576616369, "post_id": 59381946, "comment_id": 104955934, "body": "The <code>Integral</code> constraint has nothing to do with the <code>Num</code> constraint. If you define a <code>Num</code> instance for <code>MyData</code>, then you can write <code>x ^ b</code> as long as <code>b</code> is integral. <code>(^)</code> will use your <code>Num</code> instance, not the other way around."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1576616422, "post_id": 59381946, "comment_id": 104955944, "body": "Is your type actually a numeric type, or do you just want <code>(x ^ y)</code> as a short way to write &quot;do <code>x</code> <code>y</code> times&quot;? If the former, you should implement all of Num, not just one function, and if the latter you should use something other than <code>(^)</code>. For example, Semigroup appeals, if you want an effect like <code>stimes</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576616424, "post_id": 59381946, "comment_id": 104955947, "body": "If you ever want to use <code>MyData</code> for the exponent, then you need to <i>also</i> define an <code>Integral</code> instance for <code>MyData</code>."}, {"owner": {"reputation": 740, "user_id": 1495756, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74984f86d0fa97892c3107fe48e3b38c?s=128&d=identicon&r=PG", "display_name": "lenden", "link": "https://stackoverflow.com/users/1495756/lenden"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576616647, "post_id": 59381946, "comment_id": 104956029, "body": "@chepner If I just define (^) for my type as Num, I get error: No member &quot;^&quot; in class &quot;Num&quot;. Maybe I need some extensions? About Integral for MyData - what for? I don&#39;t want to use MyData as exponent, only as basis"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1576616713, "post_id": 59381946, "comment_id": 104956050, "body": "You don&#39;t define <code>(^)</code>; you get it for free as long as you have a <code>Num</code> instance for <code>MyData</code>."}, {"owner": {"reputation": 740, "user_id": 1495756, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74984f86d0fa97892c3107fe48e3b38c?s=128&d=identicon&r=PG", "display_name": "lenden", "link": "https://stackoverflow.com/users/1495756/lenden"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1576616735, "post_id": 59381946, "comment_id": 104956060, "body": "@amalloy what to you mean by &quot;type actually a numeric type&quot;? I&#39;ve defined (+), (*) and so on and I can write &quot;x * x&quot; or &quot;x + x&quot;, it works, but I want also &quot;x ^ 3&quot;."}, {"owner": {"reputation": 740, "user_id": 1495756, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74984f86d0fa97892c3107fe48e3b38c?s=128&d=identicon&r=PG", "display_name": "lenden", "link": "https://stackoverflow.com/users/1495756/lenden"}, "edited": false, "score": 0, "creation_date": 1576616771, "post_id": 59381946, "comment_id": 104956075, "body": "You don&#39;t define (^); you get it for free as long as you have a Num instance for MyData - sounds like answer :) gonna check"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1576617482, "post_id": 59381946, "comment_id": 104956365, "body": "Also, it looks like your error message (No member &quot;x&quot; in class &quot;Y&quot;) comes from Hugs.  You may want to consider switching to GHC.  Hugs is really old (more than a decade since the last official release), and getting help can be tough."}, {"owner": {"reputation": 740, "user_id": 1495756, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74984f86d0fa97892c3107fe48e3b38c?s=128&d=identicon&r=PG", "display_name": "lenden", "link": "https://stackoverflow.com/users/1495756/lenden"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1576617537, "post_id": 59381946, "comment_id": 104956387, "body": "@K.A.Buhr got it, thanks"}], "answers": [{"comments": [{"owner": {"reputation": 740, "user_id": 1495756, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74984f86d0fa97892c3107fe48e3b38c?s=128&d=identicon&r=PG", "display_name": "lenden", "link": "https://stackoverflow.com/users/1495756/lenden"}, "edited": false, "score": 0, "creation_date": 1576617198, "post_id": 59382099, "comment_id": 104956250, "body": "Thank you very much! It works. Unfortunatelly it was absolutelly not obvious :( I thought that correct way is some bonecrushing instance syntax variation"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1576620831, "last_edit_date": 1576620831, "creation_date": 1576616914, "answer_id": 59382099, "question_id": 59381946, "link": "https://stackoverflow.com/questions/59381946/instance-for-function-with-several-classes/59382099#59382099", "title": "Instance for function with several classes", "body": "<p>You don't have to do anything to define <code>(^)</code> for your data type; if your type has a <code>Num</code> instance, you get <code>x ^ b</code> for free, because <code>(^)</code> is defined for <em>any</em> type with a <code>Num</code> instance. (It basically just calls <code>*</code> a lot.)</p>\n\n<p>Note that <code>(^)</code> is <em>not</em> a member of <code>Num</code> or <code>Integral</code>; it's just a standalone function whose type is constrained by both classes.</p>\n\n<p>From <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Real.html#%5E\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Real.html#%5E</a></p>\n\n<pre><code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a\nx0 ^ y0 | y0 &lt; 0    = errorWithoutStackTrace \"Negative exponent\"\n        | y0 == 0   = 1\n        | otherwise = f x0 y0\n    where -- f : x0 ^ y0 = x ^ y\n          f x y | even y    = f (x * x) (y `quot` 2)\n                | y == 1    = x\n                | otherwise = g (x * x) (y `quot` 2) x         -- See Note [Half of y - 1]\n          -- g : x0 ^ y0 = (x ^ y) * z\n          g x y z | even y = g (x * x) (y `quot` 2) z\n                  | y == 1 = x * z\n                  | otherwise = g (x * x) (y `quot` 2) (x * z) -- See Note [Half of y - 1]\n</code></pre>\n\n<p><code>x0</code> is your <code>MyData</code> value; the only thing <code>(^)</code> ever does with <code>x0</code> (by virtue of it being passed as the <code>x</code> argument to <code>f</code> or <code>g</code>) is to multiply it by itself, so technically <code>(^)</code> will work as long as you have defined <code>(*)</code> in your <code>Num</code> instance.</p>\n"}], "owner": {"reputation": 740, "user_id": 1495756, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74984f86d0fa97892c3107fe48e3b38c?s=128&d=identicon&r=PG", "display_name": "lenden", "link": "https://stackoverflow.com/users/1495756/lenden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 59382099, "answer_count": 1, "score": -1, "last_activity_date": 1576620831, "creation_date": 1576616103, "question_id": 59381946, "link": "https://stackoverflow.com/questions/59381946/instance-for-function-with-several-classes", "title": "Instance for function with several classes", "body": "<p>I want to realize power function for my custom data type. I mean power (^) which has following signature:</p>\n\n<pre><code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>And I mean that my data type <code>MyData</code> should be instance of <code>Num</code>, so I could write</p>\n\n<pre><code>x :: MyData\n...\ny = x ^ b\n</code></pre>\n\n<p>where b is some <code>Integral</code>. It's very easy when we need function of one class like</p>\n\n<pre><code>(+), (-), (*) :: (Num a) =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>We just write</p>\n\n<pre><code>instance Num MyData where\n  (*) x y = someFunc x y\n</code></pre>\n\n<p>But I have no idea how to define it taking into account that there is also <code>Integral b</code>. That syntax should be like</p>\n\n<pre><code>instance (Integral b) =&gt; Num MyData b where\n  (^) x y = someFunc x y\n</code></pre>\n\n<p>But I've tried a hundred of such variations and nothing works. Hours of googling also didn't help.</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "unique"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1576580341, "post_id": 59372772, "comment_id": 104938187, "body": "Take a look at <code>nub</code>: <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:nub\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 357, "user_id": 12117801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50f0b1a5a3f823ef8adbd669c294bee1?s=128&d=identicon&r=PG&f=1", "display_name": "erdostamasa", "link": "https://stackoverflow.com/users/12117801/erdostamasa"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576581995, "post_id": 59372772, "comment_id": 104939098, "body": "Thankf, completely forgot about it. It will suffice for this case, because I&#39;m not working with a lot of date"}], "answers": [{"comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 3, "creation_date": 1576589282, "post_id": 59372974, "comment_id": 104942808, "body": "Like <code>hashNub</code>, there is also <a href=\"http://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Containers-ListUtils.html#v:nubOrd\" rel=\"nofollow noreferrer\"><code>nubOrd</code> and <code>nubInt</code></a> from the <code>containers</code> package which use a <code>Set</code> and an <code>IntSet</code> respectively to achieve the same <i>O(n log n)</i> complexity. (It looks like <code>hashNub</code> requires either the <code>classy-prelude</code> or the <code>witherable</code> package.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1576608474, "post_id": 59372974, "comment_id": 104952699, "body": "Also <code>nubOrdOn</code> and <code>nubIntOn</code>, which let you categorize elements of the list and take only the first from each category."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 12, "last_activity_date": 1576580907, "creation_date": 1576580907, "answer_id": 59372974, "question_id": 59372772, "link": "https://stackoverflow.com/questions/59372772/how-to-take-only-unique-elements-from-a-list/59372974#59372974", "title": "How to take only unique elements from a list?", "body": "<p>You can make use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:nub\" rel=\"noreferrer\"><strong><code>nub :: Eq a =&gt; [a] -&gt; [a]</code></strong></a> which acts as a <em>uniqness filter</em>. It will however require <em>O(n<sup>2</sup>)</em> since it does not use a data structure like a hashset.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude Data.List&gt; nub [1,2,3,4,3,2,4]\n[1,2,3,4]\n</code></pre>\n\n<p>If the elements are of a type that is a member of the <a href=\"https://hackage.haskell.org/package/classy-prelude-1.5.0/docs/ClassyPrelude.html#t:Hashable\" rel=\"noreferrer\"><strong><code>Hashable</code></strong> typeclass</a>, you can use for example <a href=\"https://hackage.haskell.org/package/classy-prelude-1.5.0/docs/ClassyPrelude.html#v:hashNub\" rel=\"noreferrer\"><strong><code>hashNub :: (Eq a, Hashable a) =&gt; [a] -&gt; [a]</code></strong></a> to perform a uniqness filter in <em>O(n log n)</em>:</p>\n\n<pre><code>Prelude ClassyPrelude&gt; hashNub [1,2,3,4,3,2,4]\n[1,2,3,4]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576590939, "post_id": 59373014, "comment_id": 104943806, "body": "Or just <code>nubOrd</code>?"}, {"owner": {"reputation": 1148, "user_id": 11619101, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pgyla3H7sk4/AAAAAAAAAAI/AAAAAAAAABc/XQ20NuIAEmM/photo.jpg?sz=128", "display_name": "Yuri Kovalenko", "link": "https://stackoverflow.com/users/11619101/yuri-kovalenko"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576592271, "post_id": 59373014, "comment_id": 104944641, "body": "@JosephSible-ReinstateMonica or so :)"}], "tags": [], "owner": {"reputation": 1148, "user_id": 11619101, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Pgyla3H7sk4/AAAAAAAAAAI/AAAAAAAAABc/XQ20NuIAEmM/photo.jpg?sz=128", "display_name": "Yuri Kovalenko", "link": "https://stackoverflow.com/users/11619101/yuri-kovalenko"}, "is_accepted": false, "score": 5, "last_activity_date": 1576581043, "creation_date": 1576581043, "answer_id": 59373014, "question_id": 59372772, "link": "https://stackoverflow.com/questions/59372772/how-to-take-only-unique-elements-from-a-list/59373014#59373014", "title": "How to take only unique elements from a list?", "body": "<p>There is a <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:nub\" rel=\"noreferrer\"><code>nub</code></a> function exactly for that. However, it has complexity of O(n^2), which is not so good. In case of numbers (or any <code>Ord</code> type) you can make your own <code>unique</code> function like this:</p>\n\n<pre><code>unique :: Ord a =&gt; [a] -&gt; [a]\nunique = map head . group . sort\n</code></pre>\n\n<p>You'll need to import <code>Data.List</code>.\nIt acts like this:</p>\n\n<pre><code>sort [1,2,3,1,2] -&gt; [1,1,2,2,3]        -- to order the elements\ngroup [1,1,2,2,3] -&gt; [[1,1],[2,2],[3]] -- to group equal ones\nmap head [[1,1],[2,2],[3]] -&gt; [1,2,3]  -- to take first of groups\n</code></pre>\n\n<p>That has complexity of O(n log n), which is a way better.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 11261191, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-y0dQi0BCJcA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDcaHErQGx63B_FTSy1HAszx1aQg/mo/photo.jpg?sz=128", "display_name": "Levkovich Efrat", "link": "https://stackoverflow.com/users/11261191/levkovich-efrat"}, "is_accepted": false, "score": 10, "last_activity_date": 1576581134, "creation_date": 1576581134, "answer_id": 59373040, "question_id": 59372772, "link": "https://stackoverflow.com/questions/59372772/how-to-take-only-unique-elements-from-a-list/59373040#59373040", "title": "How to take only unique elements from a list?", "body": "<p>You can do it with sets using Data.set:</p>\n\n<pre><code>import qualified Data.Set as Set\nlst = [1,2,3,4,1,2,3]\ny =  Set.fromList lst\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>y\n=&gt; fromList [1,2,3,4]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576592046, "post_id": 59373817, "comment_id": 104944504, "body": "@Joseph Sible-Reinstate Monica Thanks for the editing but if i am not mistaken, this version seems to make cons operation per item of the source list while the previous one does cons once per item of the results list which is (sometimes much) shorter in case there are duplicates."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576593030, "post_id": 59373817, "comment_id": 104945036, "body": "Yeah, I guess there is a bit of a trade-off here, of yielding the results earlier vs. allocating less. I personally prefer the former, but feel free to revert if you&#39;re not a fan."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 2, "last_activity_date": 1576608002, "last_edit_date": 1576608002, "creation_date": 1576583919, "answer_id": 59373817, "question_id": 59372772, "link": "https://stackoverflow.com/questions/59372772/how-to-take-only-unique-elements-from-a-list/59373817#59373817", "title": "How to take only unique elements from a list?", "body": "<p>Basically since <code>sort</code>ing in Haskell lists are quite fast (best case O(n) worst case O(nlogn) we might use sorting first and then folding for an efficient solution with an additional effect of getting a sorted result, if that would be beneficial.</p>\n\n<p>The following code is for minimal <code>cons</code> operations;</p>\n\n<pre><code>Prelude Data.List\n\u03bb&gt; :{\n\u03bb| foldr (\\e rs -&gt; case rs of\n\u03bb|                 []     -&gt; [e]\n\u03bb|                 (x:xs) -&gt; if x == e then rs else e:rs) [] $ sort [8,8,4,3,2,3,3,2,1,8,3,5]\n\u03bb| :}\n[1,2,3,4,5,8]\n</code></pre>\n\n<p>and the following is, as per pointed out by @Joseph Sible-Reinstate Monica for <em>enhanced</em> laziness.</p>\n\n<pre><code>Prelude Data.List\n\u03bb&gt; :{\n\u03bb| foldr (\\e rs -&gt; e : case rs of\n\u03bb|                 []     -&gt; []\n\u03bb|                 (x:xs) -&gt; if x == e then xs else rs) [] $ sort [8,8,4,3,2,3,3,2,1,8,3,5]\n\u03bb| :}\n[1,2,3,4,5,8]\n</code></pre>\n"}], "owner": {"reputation": 357, "user_id": 12117801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50f0b1a5a3f823ef8adbd669c294bee1?s=128&d=identicon&r=PG&f=1", "display_name": "erdostamasa", "link": "https://stackoverflow.com/users/12117801/erdostamasa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 925, "favorite_count": 0, "accepted_answer_id": 59372974, "answer_count": 4, "score": 3, "last_activity_date": 1576608002, "creation_date": 1576580289, "last_edit_date": 1576593936, "question_id": 59372772, "link": "https://stackoverflow.com/questions/59372772/how-to-take-only-unique-elements-from-a-list", "title": "How to take only unique elements from a list?", "body": "<p>I have a list, say <code>[1,2,3,4,3,2,4]</code>.\nI would like to output every element once, for example <code>[1,2,3,4]</code>.\nHow can I do this in Haskell?</p>\n"}, {"tags": ["haskell", "io", "io-monad"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 9, "creation_date": 1576527937, "post_id": 59363786, "comment_id": 104921383, "body": "No if you read <code>\\123\\456</code>, you read it as <code>\\123\\456</code>. Beware that there is a difference between the <i>content</i> of a string, and the <i>representation</i> of a string."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1576527993, "post_id": 59363786, "comment_id": 104921408, "body": "Note in passing that you can simplify your <code>func</code> definition to just <code>func = getLine</code>, which rather raises the question of why you need to define it as a separate action."}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1576528066, "post_id": 59363786, "comment_id": 104921448, "body": "@RobinZigmond this is a simplified version of my actual function, where I&#39;ve left only the important information"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576528237, "post_id": 59363786, "comment_id": 104921519, "body": "@arryn: then it is not <code>123456</code>, but <code>{\u01c8</code>."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1576528591, "post_id": 59363786, "comment_id": 104921654, "body": "Wait, but a string <code>&quot;123456&quot;</code> wouldn&#39;t be represented as <code>&quot;\\123\\456&quot;</code>, at least not in Haskell. Or did you have some specific not-Haskell representation rules in mind? What are they?"}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1576528796, "post_id": 59363786, "comment_id": 104921744, "body": "@FyodorSoikin I meant that I don&#39;t want &#39;\\&#39; to be an element of my read string. For now it is, since &#39;return text&#39; returns &#39;\\\\123\\\\456&#39;. But I do want it to be in the string as in &#39;\\123\\456&#39;"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1576529027, "post_id": 59363786, "comment_id": 104921834, "body": "&quot;I don&#39;t want &#39;\\&#39; to be an element of my string&quot; but &quot;I do want it to be in the string&quot; - does not compute. You&#39;re saying contradictory things."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1576529073, "post_id": 59363786, "comment_id": 104921851, "body": "I think you want to <code>read (&#39;&quot;&#39; : text ++ &quot;\\&quot;&quot;) :: String</code>?"}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576529301, "post_id": 59363786, "comment_id": 104921925, "body": "@WillemVanOnsem yes! Could you explain now why it works? In my intuition, it does quite the opposite, but it doesn&#39;t :)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576529825, "post_id": 59363786, "comment_id": 104922121, "body": "@arryn: because <code>read</code> normally converts a string as if it was a Haskell source code fragment to a certain object (although not per se, since one can implement <code>Show</code> and <code>Read</code> freely). We thus prepend and append the string with quotes, and let it parse as if it was a string literal."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1576549379, "post_id": 59364226, "comment_id": 104927251, "body": "@arryn Is there a reason you want to <code>read</code> vs just use the string?  If you have a string <code>the string you want</code> then why <code>read (&#39;&quot;&#39; : text&quot; ++&quot;\\&quot;&quot;)</code> instead of just use the variable <code>text</code>?"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 12, "last_activity_date": 1576530027, "creation_date": 1576530027, "answer_id": 59364226, "question_id": 59363786, "link": "https://stackoverflow.com/questions/59363786/read-a-string-exactly-as-it-is-in-haskell/59364226#59364226", "title": "Read A String Exactly As It Is in Haskell", "body": "<p>Based on the discussion in comments, it looks like you want to parse the string as if it was a string <em>literal</em>, except that it is not surrounded by quotes.</p>\n\n<p>We can make use of of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:read\" rel=\"noreferrer\"><strong><code>read :: Read a =&gt; String -&gt; a</code></strong></a> here that for a string parses it as if it was a string literal to a string. The only problem is that this string literal is surrounded by double quotes (<code>\"</code>).</p>\n\n<p>We can thus add these quotes, and work with:</p>\n\n<pre><code><b>read</b> ('\"' : text ++ \"\\\"\") :: String</code></pre>\n\n<p>Not every string <code>text</code> is however per se a valid string literal, so the above might fail. For example if the <code>text</code> contains a double quote itself, that is not directly preceded by a backslash (<code>\\</code>).</p>\n"}], "owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 59364226, "answer_count": 1, "score": 0, "last_activity_date": 1576530027, "creation_date": 1576527807, "question_id": 59363786, "link": "https://stackoverflow.com/questions/59363786/read-a-string-exactly-as-it-is-in-haskell", "title": "Read A String Exactly As It Is in Haskell", "body": "<p>My program is something like that:</p>\n\n<pre><code>func = do\n      text &lt;- getLine\n      return text\n</code></pre>\n\n<p>If I read line <code>\\123\\456</code>, the result is, naturally, <code>\\\\123\\\\456</code>.\nHow can I obtain  <code>\\123\\456</code> as the result?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1576522618, "post_id": 59362437, "comment_id": 104919305, "body": "There seems to be some information <a href=\"https://docs.servant.dev/en/stable/tutorial/Server.html#from-combinators-to-handler-arguments\" rel=\"nofollow noreferrer\">here</a>, but I&#39;m not sure it&#39;s useful... FWIW, from a REST API design viewpoint, I think the appropriate response to <code>&#47;position&#47;1&#47;test</code> ought to be <code>404 Not Found</code>, but I don&#39;t know if you&#39;re doing REST or not :)"}], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1576537866, "post_id": 59362669, "comment_id": 104924901, "body": "I appreciate your response, though it does seem quite odd for servant to not do this. I don&#39;t see how it is any different than parsing a JSON object. Parser libraries can report errors, what makes URLs/servant the exception?"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1576538491, "post_id": 59362669, "comment_id": 104925071, "body": "The first part of my answer addresses precisely this concern. It&#39;s not that Servant <i>can&#39;t</i> do it, it&#39;s that it doesn&#39;t make much sense to do."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1576539335, "post_id": 59362669, "comment_id": 104925260, "body": "It&#39;s a bit hard to follow for myself, not sure why you&#39;re adding a <code>Text</code> (parameter?) - I assume so you can match it later on with <code>badPosition</code>? But then I think (correct me if I&#39;m wrong) the answer is practically speaking &quot;No&quot; due to way Servant is designed (not that it&#39;s a bad thing)."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1576539504, "post_id": 59362669, "comment_id": 104925306, "body": "In my initial example I assume it COULD just start parsing on the <code>position</code> and if it fails a further parser combinator(?), to report an error on that case (string is not valid int)."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1576539574, "post_id": 59362669, "comment_id": 104925321, "body": "That would be very limiting, because it would prevent existence of other routes that have a similar shape, but admit non-numbers."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1576539742, "post_id": 59362669, "comment_id": 104925353, "body": "So instead, if Servant fails to parse a route, it abandons this route and attempts to parse the next one."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 2, "last_activity_date": 1576522255, "creation_date": 1576522255, "answer_id": 59362669, "question_id": 59362437, "link": "https://stackoverflow.com/questions/59362437/how-can-i-validate-report-errors-for-invalid-input-with-servant/59362669#59362669", "title": "How can I validate / report errors for invalid input with Servant?", "body": "<p>In general, I think, this is not worth doing, because <em>in general</em>, there may be very complicated combinations of routes, yielding very unintuitive error messages. For example, consider the following API:</p>\n\n<pre><code>type API = \n         \"position\" :&gt; Capture \"x\" Int :&gt; Capture \"y\" Int :&gt; Get '[JSON] Position\n    :&lt;|&gt; \"position\" :&gt; \"foo\" :&gt; \"test\" :&gt; Get '[JSON] Position\n</code></pre>\n\n<p>This API admits <code>/position/1/2</code> and <code>/position/foo/test</code>, but rejects <code>/position/1/test</code>, and there is no sane error message you can generate for this last case. It would have to be something like \"<em>expecting either an Int at the very end, or a \"foo\" in the second-from-end position, but got \"test\" at the end and \"1\" at second-from-end</em>\". Not helpful for the consumer.</p>\n\n<p>But if you just want to handle this one particular path, you can just create a second \"catch-all\" route that would return an appropriately formatted message:</p>\n\n<pre><code>type API = \"position\" :&gt; Capture \"x\" Int :&gt; Capture \"y\" Int :&gt; Get '[JSON] Position\n      :&lt;|&gt; \"position\" :&gt; Capture \"x\" Text :&gt; Capture \"y\" Text :&gt; Get '[JSON] ()\n      :&lt;|&gt; \"hello\" :&gt; QueryParam \"name\" String :&gt; Get '[JSON] HelloMessage\n      :&lt;|&gt; \"marketing\" :&gt; ReqBody '[JSON] ClientInfo :&gt; Post '[JSON] Email\n\n...\n\nserver3 = position\n     :&lt;|&gt; badPosition\n     :&lt;|&gt; hello\n     :&lt;|&gt; marketing\n\n    where \n        ...\n\n        badPosition x y =\n            throwError $ err400 { errBody = \"Expected ints, got '\" &lt;&gt; x &lt;&gt; \"' and '\" &lt;&gt; y &lt;&gt; \"'\" }\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 59362669, "answer_count": 1, "score": 2, "last_activity_date": 1576522255, "creation_date": 1576521209, "question_id": 59362437, "link": "https://stackoverflow.com/questions/59362437/how-can-i-validate-report-errors-for-invalid-input-with-servant", "title": "How can I validate / report errors for invalid input with Servant?", "body": "<p>I'm going through the servant tutorial here: <a href=\"https://docs.servant.dev/en/stable/tutorial/Server.html#from-combinators-to-handler-arguments\" rel=\"nofollow noreferrer\">https://docs.servant.dev/en/stable/tutorial/Server.html#from-combinators-to-handler-arguments</a></p>\n\n<p>Which roughly has code like below:</p>\n\n<pre><code>app1 :: Application\napp1 = serve (Proxy :: Proxy API) server3\n\nmain' :: IO ()\nmain' = run 8081 app1\ntype API = \"position\" :&gt; Capture \"x\" Int :&gt; Capture \"y\" Int :&gt; Get '[JSON] Position\n      :&lt;|&gt; \"hello\" :&gt; QueryParam \"name\" String :&gt; Get '[JSON] HelloMessage\n      :&lt;|&gt; \"marketing\" :&gt; ReqBody '[JSON] ClientInfo :&gt; Post '[JSON] Email\n\ndata Position = Position\n  { xCoord :: Int\n  , yCoord :: Int\n  } deriving Generic\n\ninstance ToJSON Position\n\nnewtype HelloMessage = HelloMessage { msg :: String }\n  deriving Generic\n\ninstance ToJSON HelloMessage\n\ndata ClientInfo = ClientInfo\n  { clientName :: String\n  , clientEmail :: String\n  , clientAge :: Int\n  , clientInterestedIn :: [String]\n  } deriving Generic\n\ninstance FromJSON ClientInfo\ninstance ToJSON ClientInfo\n\ndata Email = Email\n  { from :: String\n  , to :: String\n  , subject :: String\n  , body :: String\n  } deriving Generic\n\ninstance ToJSON Email\n\nemailForClient :: ClientInfo -&gt; Email\nemailForClient c = Email from' to' subject' body'\n\n  where from'    = \"great@company.com\"\n        to'      = clientEmail c\n        subject' = \"Hey \" ++ clientName c ++ \", we miss you!\"\n        body'    = \"Hi \" ++ clientName c ++ \",\\n\\n\"\n                ++ \"Since you've recently turned \" ++ show (clientAge c)\n                ++ \", have you checked out our latest \"\n                ++ intercalate \", \" (clientInterestedIn c)\n                ++ \" products? Give us a visit!\"\n\nserver3 :: Server API\nserver3 = position\n     :&lt;|&gt; hello\n     :&lt;|&gt; marketing\n\n  where position :: Int -&gt; Int -&gt; Handler Position\n        position x y = return (Position x y)\n\n        hello :: Maybe String -&gt; Handler HelloMessage\n        hello mname = return . HelloMessage $ case mname of\n          Nothing -&gt; \"Hello, anonymous coward\"\n          Just n  -&gt; \"Hello, \" ++ n\n\n        marketing :: ClientInfo -&gt; Handler Email\n        marketing clientinfo = return (emailForClient clientinfo)\n</code></pre>\n\n<p>Given a simple input works great:</p>\n\n<pre><code>curl http://localhost:8081/position/1/2        \n{\"yCoord\":2,\"xCoord\":1}\n</code></pre>\n\n<p>Given an simple <strong>invalid</strong> input works not so great (replacing <code>2</code> with a string <code>test</code>:</p>\n\n<pre><code>curl -v http://localhost:8081/position/1/test  \n*   Trying ::1:8081...\n* TCP_NODELAY set\n* connect to ::1 port 8081 failed: Connection refused\n*   Trying 127.0.0.1:8081...\n* TCP_NODELAY set\n* Connected to localhost (127.0.0.1) port 8081 (#0)\n&gt; GET /position/1/test HTTP/1.1\n&gt; Host: localhost:8081\n&gt; User-Agent: curl/7.65.3\n&gt; Accept: */*\n&gt; \n* Mark bundle as not supporting multiuse\n&lt; HTTP/1.1 400 Bad Request\n&lt; Transfer-Encoding: chunked\n&lt; Date: Mon, 16 Dec 2019 18:01:00 GMT\n&lt; Server: Warp/3.2.28\n&lt; \n* Connection #0 to host localhost left intact\n</code></pre>\n\n<hr>\n\n<p>How can I add error handling / validation to the response in the second case? So ideally rather than just a blank HTTP 400, it responds with \"error expecting int, got string\". Would this be to do with the <code>ExceptT</code> functionality? Is there a simple example of this anywhere?</p>\n"}, {"tags": ["string", "haskell", "xor"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1576516469, "post_id": 59361341, "comment_id": 104916603, "body": "Well you xor the index number of the ASCII character. The result you then convert back to ascii, not as a hexadecimal string."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 4, "creation_date": 1576516636, "post_id": 59361341, "comment_id": 104916675, "body": "<code>chr</code> returns the character for the given ASCII value. It doesn&#39;t convert the number to hex. If you want a hexadecimal output, you will need to find something other than <code>chr</code>."}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576516944, "post_id": 59361341, "comment_id": 104916848, "body": "@WillemVanOnsem thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 4, "last_activity_date": 1576516904, "creation_date": 1576516904, "answer_id": 59361477, "question_id": 59361341, "link": "https://stackoverflow.com/questions/59361341/xoring-strings-in-haskell/59361477#59361477", "title": "XORing strings in Haskell", "body": "<pre><code>stringXor s t = map chr $ zipWith xor (map ord s) (map ord t)\n</code></pre>\n\n<p>You map <code>chr</code> to the results of XOR. This results in characters for each ASCII value. To show the results as hexadecimal, you will need to find a different function to replace <code>chr</code> or write one yourself.</p>\n\n<p><strong>Side note:</strong> In cryptography, it is common to use Base64 notation to encode binary data instead of hex because it uses less characters (and therefore less memory or network bandwidth) to represent the same binary sequence.</p>\n"}, {"comments": [{"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 0, "creation_date": 1576519149, "post_id": 59361567, "comment_id": 104917864, "body": "But now encDec is not nilpotent, right? And to its inverse I would have to use some &#39;chr . fromHex&#39; on the encrypted text and then throw it all into &#39;encDec&#39;? I&#39;m asking because I am not sure if I understand the logic properly here"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 0, "creation_date": 1576519288, "post_id": 59361567, "comment_id": 104917912, "body": "@arryn: Why not? <code>zipWith</code> stops from the moment one of the lists is exhausted. So if <code>text</code> is exhausted, regardless if <code>cycle key</code> is exhausted (it can not be exhausted), it will stop."}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 0, "creation_date": 1576519632, "post_id": 59361567, "comment_id": 104918035, "body": "I meant that it&#39;s not nilpotent because of &#39;toHex&#39; instead of &#39;chr&#39;. So if I apply &#39;encDec&#39; to previously encrypted text won&#39;t get the initial text, but only more encrypted one"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 0, "creation_date": 1576519753, "post_id": 59361567, "comment_id": 104918086, "body": "@arryn: ah yes. In order to prevent that, you thus should make something that &quot;decodes&quot; a hex stream, instead of using <code>ord</code>. But then you can of course no longer use <code>&quot;this is a test&quot;</code> directly to encode data."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1576528177, "last_edit_date": 1576528177, "creation_date": 1576517260, "answer_id": 59361567, "question_id": 59361341, "link": "https://stackoverflow.com/questions/59361341/xoring-strings-in-haskell/59361567#59361567", "title": "XORing strings in Haskell", "body": "<p>The problem is with the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Char.html#v:chr\" rel=\"nofollow noreferrer\"><strong><code>chr :: Int -&gt; Char</code></strong></a>. This function converts an <code>Int</code> to the corresponding character, but <em>not</em> a hexadecimal representation of that number.</p>\n\n<p>You can for example define a utility function with <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Char.html#v:intToDigit\" rel=\"nofollow noreferrer\"><strong><code>intToDigit :: Int -&gt; Char</code></strong></a>:</p>\n\n<pre><code>import Data.Char(intToDigit)\n\ntoHex2 :: Int -&gt; String\ntoHex2 h = map intToDigit [d, m]\n    where (d, m) = divMod h 16\n</code></pre>\n\n<p>Then we can implement the function as:</p>\n\n<pre><code>stringXor :: String -&gt; String -&gt; String\nstringXor s t = concatMap toHex2 (zipWith xor (map ord s) (map ord t))\n</code></pre>\n\n<p>Or as <a href=\"https://stackoverflow.com/questions/59361341/xoring-strings-in-haskell/59361567?noredirect=1#comment104920154_59361567\">@DanielWagner says</a>:</p>\n\n<pre><code>import Data.Function(on)\n\nstringXor :: String -&gt; String -&gt; String\nstringXor s t = concatMap toHex2 (zipWith (xor `on` ord) s t)\n</code></pre>\n\n<p>This then gives us:</p>\n\n<pre><code>Prelude Data.Char Data.Bits&gt; encDec \"this is a test\" \"k\"\n\"1f0302184b02184b0a4b1f0e181f\"\n</code></pre>\n\n<p>Note that you do not need to use <code>length</code> here, in fact it is safer <em>without</em> length, you can just use <code>cycle</code>:</p>\n\n<pre><code>encDec :: String -&gt; String -&gt; String\nencDec text key = stringXor (cycle key) text\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 0, "creation_date": 1576522092, "post_id": 59362527, "comment_id": 104919076, "body": "I&#39;m getting the second line, which I don&#39;t know how to convert into the first line"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 1, "creation_date": 1576522348, "post_id": 59362527, "comment_id": 104919186, "body": "@arryn What Daniel is saying is that the two strings are identical. E.g. <code>&#39;\\x1f&#39;</code> and <code>&#39;\\US&#39;</code> are two different representations of the same character."}, {"owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1576522592, "post_id": 59362527, "comment_id": 104919298, "body": "@chi so is there a way to make the program show result in the &#39;\\x1f&#39; way?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "edited": false, "score": 2, "creation_date": 1576522855, "post_id": 59362527, "comment_id": 104919413, "body": "@arryn Before printing the result, you need to convert it to the right hex codes using something like Willem&#39;s <code>toHex</code> he posted above. This conversion is not used to return the result, only to print it in the wanted representation."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576526792, "post_id": 59362527, "comment_id": 104920921, "body": "There&#39;s a difference between <code>&quot;\\x1f\\x03...</code> and <code>&quot;1f03...&quot;</code>, though. The actual result is equivalent to the former, but not the latter."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1576521638, "creation_date": 1576521638, "answer_id": 59362527, "question_id": 59361341, "link": "https://stackoverflow.com/questions/59361341/xoring-strings-in-haskell/59362527#59362527", "title": "XORing strings in Haskell", "body": "<p>You <em>are</em> getting <code>1f0302184b02184b0a4b1f0e181f4b</code>:</p>\n\n<pre><code>&gt; \"\\x1f\\x03\\x02\\x18\\x4b\\x02\\x18\\x4b\\x0a\\x4b\\x1f\\x0e\\x18\\x1f\\x4b\"\n\"\\US\\ETX\\STX\\CANK\\STX\\CANK\\nK\\US\\SO\\CAN\\USK\"\n</code></pre>\n\n<p>...which is exactly the output you saw from <code>encDec</code> (up to what appears to be a simple copy-paste error in your expected output).</p>\n"}], "owner": {"reputation": 313, "user_id": 12047827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/465cdede6feeb53d122d87d7ccd42c5e?s=128&d=identicon&r=PG&f=1", "display_name": "arryn", "link": "https://stackoverflow.com/users/12047827/arryn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 59361567, "answer_count": 3, "score": 2, "last_activity_date": 1576528177, "creation_date": 1576516414, "question_id": 59361341, "link": "https://stackoverflow.com/questions/59361341/xoring-strings-in-haskell", "title": "XORing strings in Haskell", "body": "<p>I want to write a program that encrypts a text using XOR-cipher. That's what I have for now:</p>\n\n<pre><code>-- XORres 2 strings\nstringXor :: String -&gt; String -&gt; String\nstringXor s t = map chr $ zipWith xor (map ord s) (map ord t)\n\n-- encryption and decryption\nencDec :: String -&gt; String -&gt; String\nencDec text key = stringXor (take (length text) (cycle key)) text\n</code></pre>\n\n<p>But the output of <code>encDec \"this is a test\" \"k\"</code> is </p>\n\n<pre><code>  \"\\US\\ETX\\STX\\CANK\\STX\\CANK\\nK\\US\\SO\\CAN\\US\"\n</code></pre>\n\n<p>while I was expecting something like <code>1f0302184b02184b0a4b1f0e181f4b</code>.</p>\n\n<p>What could be the problem here? I've searched similar questions but that wasn't very helpful.</p>\n"}, {"tags": ["haskell", "string-length"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1576508838, "post_id": 59359283, "comment_id": 104912746, "body": "You first let it <i>take</i> <code>i</code> letters from the string."}, {"owner": {"reputation": 41, "user_id": 6833821, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a65a5622fa62b6708996c1d2100dde89?s=128&d=identicon&r=PG&f=1", "display_name": "Jon H", "link": "https://stackoverflow.com/users/6833821/jon-h"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576509817, "post_id": 59359283, "comment_id": 104913246, "body": "@WillemVanOnsem <code>take i(p) == take i(reverse p) = True</code> ? It returns false on some occasions when it should return true."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1576509885, "post_id": 59359283, "comment_id": 104913285, "body": "You did it the wrong way for the right operand: it should be <code>reverse (take i p)</code>"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1576522357, "post_id": 59359283, "comment_id": 104919193, "body": "You don&#39;t even  use <code>i</code> in your code."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1576509965, "creation_date": 1576509965, "answer_id": 59359594, "question_id": 59359283, "link": "https://stackoverflow.com/questions/59359283/check-if-string-is-palindrome-at-i-letters/59359594#59359594", "title": "Check if string is palindrome at &quot;i&quot; letters?", "body": "<p>You can make use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:take\" rel=\"nofollow noreferrer\"><strong><code>take :: Int -&gt; [a] -&gt; [a]</code></strong></a> here to pre-process the string:</p>\n\n<pre><code>palindromes :: Eq a =&gt; [a] -&gt; Int -&gt; Bool\npalindromes p i = p' == reverse p'\n    where p' = <b>take i p</b></code></pre>\n"}], "owner": {"reputation": 41, "user_id": 6833821, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a65a5622fa62b6708996c1d2100dde89?s=128&d=identicon&r=PG&f=1", "display_name": "Jon H", "link": "https://stackoverflow.com/users/6833821/jon-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576509965, "creation_date": 1576508782, "question_id": 59359283, "link": "https://stackoverflow.com/questions/59359283/check-if-string-is-palindrome-at-i-letters", "title": "Check if string is palindrome at &quot;i&quot; letters?", "body": "<p>I got a program that checks if string is palindrome or not. I want to add functionality that lets user check if given string is palindrome at i letters. For example if string is \"abbaabba\" and user gives number 4 it returns true because \"abba\" is palindrome. If user gives 5 then it returns false, because \"abbaa\" is not palindrome.</p>\n\n<p>This is what I've done so far</p>\n\n<pre><code>palindromes:: String -&gt; Int -&gt; Bool\n\npalindromes p i\n   | p == reverse p = True\n   | otherwise = False\n</code></pre>\n\n<p>How do I add that functionality?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1576505386, "post_id": 59358277, "comment_id": 104910916, "body": "<code>[head] ++ ...</code>? Use <code>head : ...</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1576508098, "post_id": 59358334, "comment_id": 104912345, "body": "Though arguably, better would be if <code>head</code> and <code>tail</code> were purged from <code>base</code> and all libraries that use them..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1576508167, "post_id": 59358334, "comment_id": 104912382, "body": "@leftaroundabout: I agree with that, since these are unsafe functions :)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1576655010, "post_id": 59358334, "comment_id": 104965619, "body": "Hear, here.  They are perfectly good variable/function names too, always cluttering up my namespace."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1576505363, "creation_date": 1576505363, "answer_id": 59358334, "question_id": 59358277, "link": "https://stackoverflow.com/questions/59358277/how-can-we-limit-recursive-calls-in-haskell/59358334#59358334", "title": "How can we limit recursive calls in Haskell?", "body": "<p><strong>Yes</strong>. You can make use of a <code>let</code> expression, or a <code>where</code> clause. For example:</p>\n\n<pre><code>splitat :: Eq a =&gt; a -&gt; [a] -&gt; ([a], [a])\nsplitat _ [] = ([],[])\nsplitat x' xa@(x:xs) | x == x' = ([], xa)\n                     | otherwise = (x:ys1, ys2)\n    where <b>(ys1, ys2) = splitat x' xs</b></code></pre>\n\n<blockquote>\n  <p><strong>Note</strong>: please do <em>not</em> use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:head\" rel=\"noreferrer\"><strong><code>head :: [a] -&gt; a</code></strong></a> or <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:head\" rel=\"noreferrer\"><strong><code>tail :: [a] -&gt; [a]</code></strong></a> or other functions that are defined as variables, since these will <em>shadow</em> the existing binding. It makes it harder to reason about the code, since a person might think that <code>head</code> and <code>tail</code> refer to these functions, and not the variables.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 3, "creation_date": 1576506213, "post_id": 59358409, "comment_id": 104911331, "body": "<a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\"><code>Data.Bifunctor</code></a> is in <code>base</code> now; it was added in GHC 7.10, if I\u2019m reading my version numbers right (<code>base</code> 4.8.0.0)."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1576505619, "creation_date": 1576505619, "answer_id": 59358409, "question_id": 59358277, "link": "https://stackoverflow.com/questions/59358277/how-can-we-limit-recursive-calls-in-haskell/59358409#59358409", "title": "How can we limit recursive calls in Haskell?", "body": "<p>Use <code>Control.Arrow.first</code> (or <code>Data.Bifunctor.first</code>; the <code>arrow</code> library ships with GHC, while I don't recall if you need to install <code>bifunctor</code> first or not):</p>\n\n<pre><code>splitat _ [] = ([],[])\nsplitAt e lst@(h:t) | e == h = ([], lst)\n                    | otherwise = first (h:) (splitAt e t)\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 11364088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/022d6d2557727c7159bcf60f3664440b?s=128&d=identicon&r=PG&f=1", "display_name": "TimzyPatzy", "link": "https://stackoverflow.com/users/11364088/timzypatzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 59358334, "answer_count": 2, "score": 5, "last_activity_date": 1576508024, "creation_date": 1576505169, "last_edit_date": 1576508024, "question_id": 59358277, "link": "https://stackoverflow.com/questions/59358277/how-can-we-limit-recursive-calls-in-haskell", "title": "How can we limit recursive calls in Haskell?", "body": "<p>I've got a problem with my code, which is the following:</p>\n\n<pre><code>import Data.List\n\nsplitat _ [] = ([],[])\nsplitat element (head:tail)\n  | element == head = ([],(head:tail))\n  | otherwise = ([head]++fst(splitat element tail), snd(splitat element tail))\n</code></pre>\n\n<p>It splits a list at 'element', then combining the left and right sublist into a tuple.\nHowever, in the third line, the 'splitat element tail' command is called twice, once through 'fst' and once through 'snd'. Is there a way to evaluate this term only 1 time to keep the recursion tree narrow?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "monads", "functor", "monad-transformers", "applicative"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1576492402, "post_id": 59354774, "comment_id": 104904376, "body": "You can not return <code>a</code>, since it should be a <code>StateT s m b</code>, not <code>StateT s m a</code>."}, {"owner": {"reputation": 121, "user_id": 5459759, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3cbbdd3ca3da640706b554b4e3483d81?s=128&d=identicon&r=PG&f=1", "display_name": "Vigo", "link": "https://stackoverflow.com/users/5459759/vigo"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576522215, "post_id": 59354774, "comment_id": 104919130, "body": "I have understand the mistake but I really don&#39;t see how to correct it? Any idea ?"}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 5459759, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3cbbdd3ca3da640706b554b4e3483d81?s=128&d=identicon&r=PG&f=1", "display_name": "Vigo", "link": "https://stackoverflow.com/users/5459759/vigo"}, "edited": false, "score": 0, "creation_date": 1576598171, "post_id": 59365844, "comment_id": 104947883, "body": "Great and precise answer !"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1576540744, "creation_date": 1576540744, "answer_id": 59365844, "question_id": 59354774, "link": "https://stackoverflow.com/questions/59354774/couldnt-match-type-a-with-b-error-in-monad-instance-definition/59365844#59365844", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018b\u2019error in Monad instance definition", "body": "<p>You need to take a page from other monads that signal errors in the middle of a monadic computation.  They don't <code>return</code> the error value, because that's not generally possible: a monadic action of type <code>m b</code> can <em>only</em> <code>return</code> a value of type <code>b</code>, not some other arbitrary type like <code>(a,s,LogS)</code>.  Instead, these other error-signaling monads use a sum type for representing errors.  For example, the monadic action <code>Either MyNastyError b</code> can only <code>return</code> a value of type <code>b</code> (by using <code>Right</code>), but it can signal an error of type <code>MyNastyError</code> using <code>Left</code>.</p>\n\n<p>Also, you won't generally be able to produce an <code>(a,s,LogS)</code> because not enough is known about the type <code>a</code>.  It's just the return type of some action that was bound into the overall monadic action immediately before the action that ultimately failed, so the caller won't generally be ready to do anything with it.  You can return <code>(s,LogS)</code> though, since that type will be fixed across all actions in a given monad.</p>\n\n<p>Specifically, you can redefine your <code>StateT</code> type as:</p>\n\n<pre><code>newtype StateT s m a\n  = StateT { runStateT :: (s, LogS) -&gt; m (Maybe a, s, LogS) }\n  deriving (Functor)\n</code></pre>\n\n<p>This uses <code>Maybe a</code> to signal failure.  A computation that returns <code>(Just x, s, l)</code> can continue, but a <code>(Nothing, s, l)</code> is ready to stop and dump its state and log.</p>\n\n<p>With this type, the two <code>LogS</code> constructors are now redundant, because failure is already signaled by the <code>Maybe a</code> value, so <code>LogS</code> can be simplified to:</p>\n\n<pre><code>data LogS = LogS { stepS :: Int , logS :: [String] }\n  deriving (Show)\n</code></pre>\n\n<p>The appropriate <code>Applicative</code> and <code>Monad</code> instances can be updated to:</p>\n\n<pre><code>instance (Monad m) =&gt; Applicative (StateT s m) where\n  pure a = StateT $ \\(s, l) -&gt; return (Just a, s, l)\n  (&lt;*&gt;) = ap\ninstance (Monad m) =&gt; Monad (StateT s m) where\n  return = pure\n  m &gt;&gt;= k = StateT $ \\(s, l) -&gt; do\n    (maybeA, s', l') &lt;- runStateT m (s, l)\n    case maybeA of\n      Nothing -&gt; return (Nothing, s', l')\n      Just a -&gt; runStateT (k a) (s', l' {stepS = 1 + stepS l'})\n  fail err = StateT $ \\(s, l) -&gt; return (Nothing, s, l { logS = err:logS l })\n</code></pre>\n\n<p>Note that I think <code>fail</code> makes more sense if it does \"nice\" failure in this monad instead of using the base monad's <code>fail</code>.  I'm assuming here that the <code>logS</code> field is in reverse order, so latest messages are appended to the head.</p>\n\n<p>The full code:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n{-# LANGUAGE DeriveFunctor #-}\n\nmodule TestStateJLJ1  where\n\nimport Data.Functor.Identity\nimport Control.Monad\n\ndata LogS = LogS { stepS :: Int , logS :: [String] }\n  deriving (Show)\n\ninitLogS :: LogS\ninitLogS = LogS 1 []\n\nnewtype StateT s m a\n  = StateT { runStateT :: (s, LogS) -&gt; m (Maybe a, s, LogS) }\n  deriving (Functor)\n\ninstance (Monad m) =&gt; Applicative (StateT s m) where\n  pure a = StateT $ \\(s, l) -&gt; return (Just a, s, l)\n  (&lt;*&gt;) = ap\ninstance (Monad m) =&gt; Monad (StateT s m) where\n  return = pure\n  m &gt;&gt;= k = StateT $ \\(s, l) -&gt; do\n    (maybeA, s', l') &lt;- runStateT m (s, l)\n    case maybeA of\n      Nothing -&gt; return (Nothing, s', l')\n      Just a -&gt; runStateT (k a) (s', l' {stepS = 1 + stepS l'})\n  fail err = StateT $ \\(s, l) -&gt; return (Nothing, s, l { logS = err:logS l })\n\ntype State s = StateT s Identity\n\nstate :: (Monad m) =&gt; ((s, LogS) -&gt; (Maybe a, s, LogS)) -&gt; StateT s m a\nstate f = StateT $ return . f\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 5459759, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3cbbdd3ca3da640706b554b4e3483d81?s=128&d=identicon&r=PG&f=1", "display_name": "Vigo", "link": "https://stackoverflow.com/users/5459759/vigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 59365844, "answer_count": 1, "score": 3, "last_activity_date": 1576540744, "creation_date": 1576492266, "question_id": 59354774, "link": "https://stackoverflow.com/questions/59354774/couldnt-match-type-a-with-b-error-in-monad-instance-definition", "title": "Couldn&#39;t match type \u2018a\u2019 with \u2018b\u2019error in Monad instance definition", "body": "<p>I'm writing a haskell program to execute a bunch of statements to modify a data record. I would like to make modifications and tests to the state at each statement without user intervention. I had the idea to modify the <a href=\"http://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-State-Strict.html\" rel=\"nofollow noreferrer\">Control.Monad.Trans.State.Strict</a> module to incorporate my specific type in a tuple <code>(,)</code>. </p>\n\n<p>It worked well until I had the following error</p>\n\n<pre><code>\u2022 Couldn't match type \u2018a\u2019 with \u2018b\u2019\n  \u2018a\u2019 is a rigid type variable bound by\n    the type signature for:\n      (&gt;&gt;=) :: forall a b.\n               StateT s m a -&gt; (a -&gt; StateT s m b) -&gt; StateT s m b\n    at TestMon.hs:38:7\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      (&gt;&gt;=) :: forall a b.\n               StateT s m a -&gt; (a -&gt; StateT s m b) -&gt; StateT s m b\n    at TestMon.hs:38:7\n  Expected type: m (b, s, LogS)\n    Actual type: m (a, s, LogS)\n</code></pre>\n\n<p>and I don't understand why I get this error.\nMy code is like this :</p>\n\n<pre><code>module TestStateJLJ1  where\n\nimport Data.Functor.Identity\nimport Control.Applicative\nimport Control.Monad\n\ndata LogS = LogOK { stepS:: Int ,logS::[String] }\n          | LogErr {stepS:: Int , logS::[String] }\n         deriving (Show)\n\ninitLogS = LogOK { stepS=1, logS=[]}\n\ntype State s = StateT s Identity\n\nstate :: (Monad m) =&gt; ((s,LogS) -&gt; (a, s,LogS)) -&gt; StateT s m a\nstate f  = StateT (return . f )\n\nnewtype StateT s m a = StateT { runStateT :: (s,LogS) -&gt; m (a,s,LogS) }\n\ninstance (Functor m) =&gt; Functor (StateT s m) where\n    fmap f m = StateT $ \\ (s,l) -&gt;\n        fmap (\\ (a, s',l') -&gt; (f a, s',l')) $ runStateT m (s,l)\n\ninstance (Functor m, Monad m) =&gt; Applicative (StateT s m) where\n    pure a = StateT $ \\ (s,l) -&gt; return (a, s,l)\n\n    StateT mf &lt;*&gt; StateT mx = StateT $ \\ (s,l) -&gt; do\n        (f, s',l') &lt;- mf (s,l)\n        (x, s'',l'') &lt;- mx (s',l')\n        return (f x, s'',l'')\n\n    m *&gt; k = m &gt;&gt;= \\_ -&gt; k\n\ninstance (Monad m) =&gt; Monad (StateT s m) where\n    return a = StateT $ \\ (s,l) -&gt; return (a, s,l)\n\n    m &gt;&gt;= k  = StateT $ \\ (s,l) -&gt; do\n        (a, s',l') &lt;- runStateT m (s,l)\n        case l' of\n           LogOK _ _ -&gt; runStateT (k a) (s',l'{stepS=1+stepS l'})\n           LogErr _ _-&gt; do return ( a, s',l') -- &lt;- This line is causing trouble\n\n    fail str = StateT $ \\ _ -&gt; fail str\n</code></pre>\n\n<p>I tried to modify the behaviour of the <code>Monad</code> instance to test the value of the <code>LogS</code> data type and according to its value :</p>\n\n<ul>\n<li><p>Perform an increment of <code>stepS</code> (to count the number of statement) and many other things (not implemented yet) and continue the monad execution.</p></li>\n<li><p>Or stop the monad execution and return the actual state.</p></li>\n</ul>\n\n<p>Do you know what is wrong with my code and how to correct it ?</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1576492875, "post_id": 59354495, "comment_id": 104904618, "body": "I&#39;m also doing this year&#39;s Advent of Code in Haskell - but I fear you&#39;ve missed the point of this problem. I&#39;m not sure if or how you can fix it to run in constant memory (I&#39;m no expert in such things), but even if you can, the runtime will be totally unreasonable. You need to break the problem down into smaller chunks in order to solve it."}, {"owner": {"reputation": 47, "user_id": 4789472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69a8172b1d7a6105bac545a3444d47c?s=128&d=identicon&r=PG&f=1", "display_name": "DuSTman", "link": "https://stackoverflow.com/users/4789472/dustman"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1576493309, "post_id": 59354495, "comment_id": 104904864, "body": "Perhaps, but I&#39;m not sure - it states the example would take 4,686,774,924 iterations which is significant, but not intractable. I suspect a C++ implementation could do this in a minute or two."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1576494111, "post_id": 59354495, "comment_id": 104905238, "body": "Well I&#39;d be surprised if any language could do this significantly faster than a million iterations per second, at which rate that would still take about an hour and a quarter. (You might be prepared to wait that long, but the FAQ explicitly says no solution should take more than 15 seconds to run with the right algorithm.) And my answer was several orders of magnitude greater than that number. (I say &quot;my answer&quot; because I think AoC gives slightly different inputs to different users, but I&#39;d expect they&#39;re all of a similar size.)"}, {"owner": {"reputation": 47, "user_id": 4789472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69a8172b1d7a6105bac545a3444d47c?s=128&d=identicon&r=PG&f=1", "display_name": "DuSTman", "link": "https://stackoverflow.com/users/4789472/dustman"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1576505645, "post_id": 59354495, "comment_id": 104911043, "body": "Ok. Well, I&#39;ll think about another solution, but I&#39;m still interested in how the memory problem with this implementation might be solved, in case I run into this issue again."}, {"owner": {"reputation": 3424, "user_id": 3750257, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KF8gx.png?s=128&g=1", "display_name": "pppery", "link": "https://stackoverflow.com/users/3750257/pppery"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1577331924, "post_id": 59354495, "comment_id": 105143130, "body": "@RobinZigmond Your thought is correct."}, {"owner": {"reputation": 47, "user_id": 4789472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69a8172b1d7a6105bac545a3444d47c?s=128&d=identicon&r=PG&f=1", "display_name": "DuSTman", "link": "https://stackoverflow.com/users/4789472/dustman"}, "edited": false, "score": 0, "creation_date": 1577470204, "post_id": 59354495, "comment_id": 105181371, "body": "Yes. I was able to rewrite it to take about 10 seconds to complete, so Robin Zigmond was right about that one. I also marked K.A.Buhr&#39;s answer correct, as he pointed out that the speed problem doesn&#39;t seem to be in the section of code I posted.."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1576519184, "creation_date": 1576519184, "answer_id": 59362012, "question_id": 59354495, "link": "https://stackoverflow.com/questions/59354495/how-can-this-function-in-haskell-be-optimised/59362012#59362012", "title": "How can this function in Haskell be optimised", "body": "<p>The comments are undoubtedly correct that your approach is not the intended solution method.</p>\n\n<p>However, the functions you've posted would not, in and of themselves, cause a memory leak, fail to tail recurse, or lead to poor performance.  Given your code above plus the definitions:</p>\n\n<pre><code>updateCycle 4686774942 = 0\nupdateCycle n = n+1\n\nmain = do\n  print $ simulateUntilRepeat (0 :: Int)\n</code></pre>\n\n<p>and compiling with <code>-O2</code>, the program runs in constant memory on my laptop in about 30 seconds.  Adding explicit type signatures to use <code>Int</code> in place of <code>Integer</code> for the iteration count:</p>\n\n<pre><code>simulateUntilRepeat_int :: Int -&gt; Int -&gt; Int -&gt; Int\nsimulateUntilRepeat :: Int -&gt; Int\n</code></pre>\n\n<p>it runs in about 2.4 seconds.</p>\n\n<p>So, to understand why your program is gobbling all available memory or why your strictness annotations failed to make a difference, it would probably be necessary to see the whole working program (or preferably a minimal example that illustrates the performance problem).  If the program is short, and the question is \"why is the performance of this program totally unreasonable?\" instead of \"how can I optimize my program to run as fast as possible?\", it might still be a good SO question.  Otherwise, the Code Review site might be better -- you can post a larger program there and ask for general performance advice, and that's considered on-topic for that site. </p>\n"}], "owner": {"reputation": 47, "user_id": 4789472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69a8172b1d7a6105bac545a3444d47c?s=128&d=identicon&r=PG&f=1", "display_name": "DuSTman", "link": "https://stackoverflow.com/users/4789472/dustman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 59362012, "answer_count": 1, "score": 2, "last_activity_date": 1576519184, "creation_date": 1576491244, "question_id": 59354495, "link": "https://stackoverflow.com/questions/59354495/how-can-this-function-in-haskell-be-optimised", "title": "How can this function in Haskell be optimised", "body": "<p>As part of an advent of code challenge, I've written the following functions in Haskell:</p>\n\n<pre><code>simulateUntilRepeat_int a b i = if (a /= b) then (simulateUntilRepeat_int a (updateCycle b) (i+1)) else i\n\nsimulateUntilRepeat a = simulateUntilRepeat_int a (updateCycle a) 1\n</code></pre>\n\n<p>The purpose of this is to take a list of moons and simulate their movement until they resume their original position, returning the number of cycles it took for them to get there. (the function updateCycle does one iteration of the simulation). However, when I attempt to run this it uses all available memory and then gets killed by the operating system. The question does admit that this may take a very large number of cycles.</p>\n\n<p>Googling around about this problem I find the usual fix is to make some of the parameters strict, but I think I've experimented with all possible permutations of strictness on the parameters to no avail. By the looks of this function, I'd have anticipated the compiler would be able to use the tail recursion optimisation and turn it into a loop, but this seems to not be happening somehow.</p>\n\n<p>A friend of mine, who is knowledgeable in haskell suggested changing the form of the function to the following:</p>\n\n<pre><code>f a b0 = length (takeWhile (/= a) (iterate updateCycle b0))\n</code></pre>\n\n<p>But doing this didn't fix it either, leaving me out of ideas.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1576481880, "post_id": 59351966, "comment_id": 104899693, "body": "The question is about a different package than the one <a href=\"https://stackoverflow.com/a/59225974/126014\">asked about here</a>, but the answer ought to be the same. I wonder if we should close this as a duplicate?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1576481998, "post_id": 59351966, "comment_id": 104899734, "body": "The package name is <code>arithmoi</code>. See here for more details: <a href=\"https://stackoverflow.com/a/48855060/126014\">stackoverflow.com/a/48855060/126014</a>"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1576483689, "post_id": 59351966, "comment_id": 104900277, "body": "There are a lot of concepts that you are misunderstanding/not aware of here, and I do not have time to write a full answer. For helpfulness&#39;s sake, you should be able to incant <code>cabal v2-repl -b arithmoi</code>, and then import your desired modules."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1576485246, "post_id": 59351966, "comment_id": 104900872, "body": "Cabal deals with <i>packages</i>, a package is a collection of <i>modules</i>. <code>Math.NumberTheory</code> is a <i>module</i>."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1576553581, "creation_date": 1576553581, "answer_id": 59367254, "question_id": 59351966, "link": "https://stackoverflow.com/questions/59351966/how-to-import-math-x-in-haskell/59367254#59367254", "title": "How to import Math.X in Haskell?", "body": "<blockquote>\n  <p>It doesn't seem to be included in Prelude</p>\n</blockquote>\n\n<p>Prelude is a module, not a package, and thus can not include other modules.  You probably mean \"base\".</p>\n\n<blockquote>\n  <p>cabal install Math.NumberTheory seems to have no knowledge of any such package names \"Math\"</p>\n</blockquote>\n\n<p>Because that is a module name, not a package which is a collection of modules (roughly).  You need to tell cabal to install the package not the module.</p>\n\n<p>Try instead:</p>\n\n<pre><code>cabal install arithmoi\nghci\nimport Math.NumberTheory.Moduli.Class\n</code></pre>\n\n<p>Or as a project-in-a-file:</p>\n\n<pre><code>$ cat so.hs\n#!/usr/bin/env cabal\n{- cabal:\n        build-depends: base, arithmoi\n-}\n\nmodule Main where\n\nimport Math.NumberTheory.Moduli.Class\n\nmain :: IO ()\nmain = return ()\n$ chmod +x so.hs ; ./so.hs 2&gt;/dev/null 1&gt;&amp;2 ; echo $?\n0\n</code></pre>\n"}], "owner": {"reputation": 2577, "user_id": 6263317, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Imx4J.jpg?s=128&g=1", "display_name": "Jon Deaton", "link": "https://stackoverflow.com/users/6263317/jon-deaton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 401, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1576553581, "creation_date": 1576480136, "question_id": 59351966, "link": "https://stackoverflow.com/questions/59351966/how-to-import-math-x-in-haskell", "title": "How to import Math.X in Haskell?", "body": "<p>I would like to use <a href=\"http://hackage.haskell.org/package/arithmoi-0.10.0.0/docs/Math-NumberTheory-Moduli-Class.html\" rel=\"nofollow noreferrer\">Math.NumberTheory.Moduli.Class</a> in my Haskell program. It doesn't seem to be included in Prelude since when I try to use it in GHCI</p>\n\n<pre><code>&gt; (3 :: Mod 5) + (4 :: Mod 5)\n</code></pre>\n\n<p>we have <code>Not in scope: type constructor or class \u2018Mod\u2019</code>. I also can't seem to import it into GHCI since none of the following work</p>\n\n<pre><code>&gt; import Math.NumberTheory.Moduli.Class\n&gt; import Math.NumberTheory.Moduli\n&gt; import Math.NumberTheory\n</code></pre>\n\n<p>because \"Could not find module\". Finally, </p>\n\n<pre><code>cabal install Math.NumberTheory\n</code></pre>\n\n<p>seems to have no knowledge of any such package names \"Math\". Moreover, I can't figure out how to use <em>any</em> of the packages in <code>Math.NumberTheory</code>. How does one import these into a Haskell program?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1576451566, "post_id": 59348813, "comment_id": 104893740, "body": "This may be an <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY question</a>. <b>a)</b> not every constraint can be feasibly expressed in Haskell. Haskell is not Agda; if you want full type safety all the way  down than that or some other dependently-typed language is what you should use. But it&#39;s perfectly possible to <i>informally</i> enforce such properties in Haskell: just make sure all the functions you export from your module ensure these properties. <b>b)</b> if QuickCheck is too slow, then this may be what you should ask about. I suspect you use a generate&amp;discard scheme?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1576461644, "post_id": 59348813, "comment_id": 104895393, "body": "See also <a href=\"https://stackoverflow.com/questions/11910143/positive-integer-type/11912348#11912348\" title=\"positive integer type\">stackoverflow.com/questions/11910143/positive-integer-type/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1576471242, "post_id": 59350025, "comment_id": 104896941, "body": "Importantly, don&#39;t export <code>Rec</code>! Or, if you do, make sure it&#39;s documented as &quot;unsafe,&quot; and preferably only export it from a different (<code>Unsafe</code> or <code>Internal</code> or ...)  module. Otherwise, it all falls apart."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1576464961, "creation_date": 1576464961, "answer_id": 59350025, "question_id": 59348813, "link": "https://stackoverflow.com/questions/59348813/how-to-enforce-type-relation-and-constraints-when-defing-data-type/59350025#59350025", "title": "How to enforce type relation and constraints when defing data type", "body": "<p>To point out the obvious, the standard way of enforcing these constraints at type level would be to define your <code>Rectangle</code> differently:</p>\n\n<pre><code>data Rectangle = Rec\n  { x1 :: Int\n  , x2 :: Int\n  , height :: Int\n  }\n</code></pre>\n\n<p>This enforces all constraints except \"x1 &lt; x2\".  You can use smart destructors to recreate the rectangle's <code>Point</code> \"fields\":</p>\n\n<pre><code>point1 :: Rectangle -&gt; Point\npoint1 (Rec x1 _ h) = Point x1 0 h\n\npoint2 :: Rectangle -&gt; Point\npoint2 (Rec _ x2 h) = Point x2 h 0\n</code></pre>\n\n<p>and define a smart constructor (which can also enforce the \"x1 &lt; x2\" constraint):</p>\n\n<pre><code>rect :: Point -&gt; Point -&gt; Rectangle\nrect (Point x1 0 h1) (Point x2 h2 0) | h1 == h2 &amp;&amp; x1 &lt; x2 = Rec x1 x2 h1\nrect _ _ = error \"bad rectangle\"\n</code></pre>\n\n<p>Seriously, this really is the best way to enforce constraints at the type level in Haskell!</p>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 59350025, "answer_count": 1, "score": 1, "last_activity_date": 1576464961, "creation_date": 1576450819, "last_edit_date": 1576451742, "question_id": 59348813, "link": "https://stackoverflow.com/questions/59348813/how-to-enforce-type-relation-and-constraints-when-defing-data-type", "title": "How to enforce type relation and constraints when defing data type", "body": "<p>In the following code:</p>\n\n<pre><code>data Point = Point { x           :: Int, \n                     leftHeight  :: Int, \n                     rightHeight :: Int}\ndata Rectangle = Rec Point Point\n\nrec1 = Rec p1 p2\n</code></pre>\n\n<p>There are several constraints when creating <code>Rec</code> such as: </p>\n\n<pre><code>x p1 &lt; x p2\n(leftHeight p1 ) should always be zero\n(rightHeight p2 ) should always be zero\nrightHeight p1 == leftHeight p2\n</code></pre>\n\n<p>Is there a way to enforce these constraints at type level?\nBecause I'm using <code>QuickCheck</code> to generate some sample <code>Rec</code> but these contraints make <code>QuickCheck</code> very slow to generate random samples.</p>\n\n<p>edit: I've solved the slow QuickCheck issue. But anyway still curious if such constraint can be expressed in Haskell</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1576445801, "post_id": 59348153, "comment_id": 104892524, "body": "The error message actually suggests the way to solve this: <code>Possible fix: add (Eq a) to the context of the instance declaration [...]</code>. It&#39;s worthwhile to post your error messages too, since they often contain useful information like that."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 12542136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df64af006e82257b18411806786d4dfe?s=128&d=identicon&r=PG&f=1", "display_name": "Dude1662", "link": "https://stackoverflow.com/users/12542136/dude1662"}, "edited": false, "score": 0, "creation_date": 1576445164, "post_id": 59348176, "comment_id": 104892390, "body": "Thank you. The questions were a bit ambigious in the homeworkproblem and I think it was asked  to solve the problem like you did in the first half of your comment. Now it works as intended. Sadly I cannot upvote you yet, because I lack the reputation."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1576444898, "creation_date": 1576444898, "answer_id": 59348176, "question_id": 59348153, "link": "https://stackoverflow.com/questions/59348153/problem-with-type-constructor-in-haskell-homework/59348176#59348176", "title": "Problem with type constructor in Haskell homework", "body": "<p>You can only check if two <code>R a b</code>s are equal, given you can check that items of <code>a</code> and <code>b</code> are equal. So you need to add these as type constraints:</p>\n\n<pre><code>instance <b>(Eq a, Eq b) =&gt;</b> Eq (Row a b)  where\n    (R x y) == (R c d) = (x == c) &amp;&amp; (y == d)\n    _ == _ = False</code></pre>\n\n<p>Note however that you do <em>not</em> need to implement the <code>Eq</code> instance yourself. If you want two <code>R a b</code>s to be the same if the data constructor is the same, and their corresponding parameters are the same, then you an just let the compiler derive the instance for your:</p>\n\n<pre><code>data Row a b = R a b deriving (<b>Eq, </b>Show)</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 12542136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df64af006e82257b18411806786d4dfe?s=128&d=identicon&r=PG&f=1", "display_name": "Dude1662", "link": "https://stackoverflow.com/users/12542136/dude1662"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1576562803, "creation_date": 1576444678, "last_edit_date": 1576562803, "question_id": 59348153, "link": "https://stackoverflow.com/questions/59348153/problem-with-type-constructor-in-haskell-homework", "title": "Problem with type constructor in Haskell homework", "body": "<p>I have created a datatype and need to make it an instance of the equality typeclass using instance. My datatype consists of values R a b. I want to make <code>R x y</code> equal to <code>R c d</code> if <code>x</code> is equal to <code>c</code> and <code>y</code> is equal to <code>d</code>. </p>\n\n<p>Here is the code that I have written so far. It does not compile.</p>\n\n<pre><code> data Row a b = R a b deriving (Show)\n instance Eq (Row a b)  where\n     (R x y) == (R c d) = (x == c) &amp;&amp; (y == d)\n     _ == _ = False\n</code></pre>\n\n<p>I am thinking it might be wrong because the types a and b do not necessarily have to be in the Equality typeclass. I do not know how to fix this problem.</p>\n"}, {"tags": ["haskell", "free-theorem"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 5, "creation_date": 1576443417, "post_id": 59347971, "comment_id": 104891985, "body": "I believe this is saying that <code>(\\(a,b) -&gt; (map f a, map f b)) . foo = foo . map (map f)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 565, "user_id": 6597726, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-MrwVF1qyPBY/AAAAAAAAAAI/AAAAAAAAAI8/aQPxySVXNL8/photo.jpg?sz=128", "display_name": "Jingjie YANG", "link": "https://stackoverflow.com/users/6597726/jingjie-yang"}, "edited": false, "score": 0, "creation_date": 1576451697, "post_id": 59348739, "comment_id": 104893760, "body": "Nice explanation! Just a question: when you say &quot;for every g&quot;, does g have to be total or strict, or are there no restrictions at all?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 565, "user_id": 6597726, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-MrwVF1qyPBY/AAAAAAAAAAI/AAAAAAAAAI8/aQPxySVXNL8/photo.jpg?sz=128", "display_name": "Jingjie YANG", "link": "https://stackoverflow.com/users/6597726/jingjie-yang"}, "edited": false, "score": 1, "creation_date": 1576453347, "post_id": 59348739, "comment_id": 104894035, "body": "@JingjieYANG Yes, there are some restrictions if we use Haskell. Most results like this are actually done in a pure type system where every terminates (hence it is total). In Haskell, if I recall correctly, since we have non termination we need to require <code>g</code> total. Similarly, since we have <code>seq</code> we need to require <code>g</code> to be strict. I&#39;m not 100% sure on the exact restrictions, but I think these should be it. I don&#39;t remember where I read about those, though -- probably on the free theorem generator page there&#39;s some information."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576454988, "post_id": 59348739, "comment_id": 104894297, "body": "Isn&#39;t Control.Arrow(***) on tuples a bit out of style, in favor of Data.Bifunctor(bimap)? Any objection to an edit to change to the latter?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1576455809, "post_id": 59348739, "comment_id": 104894442, "body": "@JosephSible-ReinstateMonica I have no idea. I guess it&#39;s a bit like <code>map</code> vs <code>fmap</code>. People continue using <code>map</code> since it makes it obvious that we are dealing with lists (and not other functor). Similarly, <code>(***)</code> only works on pairs (and not other bifunctors). I&#39;m probably using it mostly for its infix-ness, since in maths we tend to write <code>f \\times g</code> to apply the product bifunctor. Maybe <code>bimap</code> should have its infix variant as well, like <code>&lt;$&gt;</code> is a variant for <code>fmap</code>."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576460215, "post_id": 59348739, "comment_id": 104895146, "body": "While it&#39;s true that <code>(***)</code> is more specific than <code>bimap</code> in that it only works on pairs rather than arbitrary bifunctors, it&#39;s also true that <code>bimap</code> is more specific than <code>(***)</code> in that it only works on functions rather than on arbitrary arrows. Re infix, that wouldn&#39;t be quite the same for <code>bimap</code> and <code>fmap</code>, since <code>bimap</code> takes 3 parameters and <code>fmap</code> only takes 2."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1576450275, "last_edit_date": 1576450275, "creation_date": 1576449927, "answer_id": 59348739, "question_id": 59347971, "link": "https://stackoverflow.com/questions/59347971/law-for-type-a-a-a/59348739#59348739", "title": "Law for type [[a]] -&gt; ([a], [a])", "body": "<p>If <code>R1</code> and <code>R2</code> are relations (say, <code>R_i</code> between <code>A_i</code> and <code>B_i</code>, with <code>i in {1,2}</code>), then <code>lift{(,)}(R1,R2)</code> is the \"lifted\" relations pairs, between <code>A1 * A2</code> and <code>B1 * B2</code>, with <code>*</code> denoting the product (written <code>(,)</code> in Haskell).</p>\n\n<p>In the lifed relation, two pairs <code>(x1,x2) :: A1*A2</code> and <code>(y1,y2) :: B1*B2</code> are related if and only if <code>x1 R1 y1</code> and <code>x2 R2 y2</code>. In your case, <code>R1</code> and <code>R2</code> are functions <code>map g, map g</code>, so the lifting becomes a function as well: <code>y1 = map g x1 &amp;&amp; y2 = map g x2</code>.</p>\n\n<p>Hence, the generated</p>\n\n<pre><code>(f x, f (map (map g) x)) in lift{(,)}(map g,map g)\n</code></pre>\n\n<p>means:</p>\n\n<pre><code>fst (f (map (map g) x)) = map g (fst (f x))\nAND\nsnd (f (map (map g) x)) = map g (snd (f x))\n</code></pre>\n\n<p>or, in other words:</p>\n\n<pre><code>f (map (map g) x) = (map g (fst (f x)), map g (snd (f x)))\n</code></pre>\n\n<p>which I wold write as, using <code>Control.Arrow</code>:</p>\n\n<pre><code>f (map (map g) x) = (map g *** map g) (f x)\n</code></pre>\n\n<p>or even, in pointfree style:</p>\n\n<pre><code>f . map (map g) = (map g *** map g) . f\n</code></pre>\n\n<p>This is no surprise, since your <code>f</code> can be written as</p>\n\n<pre><code>f :: F a -&gt; G a\nwhere F a = [[a]]\n      G a = ([a], [a])\n</code></pre>\n\n<p>and <code>F</code>,<code>G</code> are functors (in Haskell we would need to use a <code>newtype</code> to define a functor instance, but I will omit that, since it's irrelevant). In such common case, the free theorem has a very nice form: for every <code>g</code>,</p>\n\n<pre><code>f . fmap_of_F g = fmap_of_G g . f\n</code></pre>\n\n<p>This is a very nice form, called naturality (<code>f</code> can be interpreted as a natural transformation in a suitable category). Note that the two <code>f</code>s above are actually instantiated on separate types, so to make types agree with the rest.</p>\n\n<p>In your specific case, since <code>F a = [[a]]</code>, it is the composition of the <code>[]</code> functor with itself, hence we (unsurprisingly) get <code>fmap_of_F g = fmap_of_[] (fmap_of_[] g) = map (map g)</code>.</p>\n\n<p>Instead, <code>G a = ([a],[a])</code> is the composition of functors <code>[]</code> and <code>H a = (a,a)</code> (technically, diagonal functor composed with the product functor). We have <code>fmap_of_H h = (h *** h) = (\\x -&gt; (h x, h x))</code>, from which <code>fmap_of_G g = fmap_of_H (fmap_of_[] g) = (map g *** map g)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1576655433, "creation_date": 1576655433, "answer_id": 59387603, "question_id": 59347971, "link": "https://stackoverflow.com/questions/59347971/law-for-type-a-a-a/59387603#59387603", "title": "Law for type [[a]] -&gt; ([a], [a])", "body": "<p>Same thing as @chi's answer with less ceremony:</p>\n\n<p><em>It doesn't matter if you change the <code>a</code>s to <code>b</code>s before or after the function, you get the same thing (as long as you use an <code>fmap</code>-like-thing to do it).</em></p>\n\n<pre>\nFor any f : a -> b,\n\n    [[a]] ------------->   [[b]]\n      |    (map.map) f       |\n      |                      |\n     foo                    foo\n      |                      |\n      v                      v\n    ([a],[a]) ---------> ([b],[b])\n              bimap f f\n\ncommutes.\n</pre>\n"}], "owner": {"reputation": 565, "user_id": 6597726, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-MrwVF1qyPBY/AAAAAAAAAAI/AAAAAAAAAI8/aQPxySVXNL8/photo.jpg?sz=128", "display_name": "Jingjie YANG", "link": "https://stackoverflow.com/users/6597726/jingjie-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 59348739, "answer_count": 2, "score": 8, "last_activity_date": 1576655433, "creation_date": 1576443109, "question_id": 59347971, "link": "https://stackoverflow.com/questions/59347971/law-for-type-a-a-a", "title": "Law for type [[a]] -&gt; ([a], [a])", "body": "<p>I am trying to do this question from my homework:</p>\n\n<blockquote>\n  <p>Given arbitrary <code>foo :: [[a]] -&gt; ([a], [a])</code>, write down one law that the function <code>foo</code> satisfies, involving <code>map</code> on lists and pairs.</p>\n</blockquote>\n\n<p>Some context: I am a first year undergrad taking a course of functional programming. Whilst the course is rather introductory, the lecturer has mentioned many things out of syllabus, amongst which are the free theorems. So after attempting to read Wadler's paper, I reckoned that <code>concat :: [[a]] -&gt; [a]</code> with the law <code>map f . concat = concat . map (map f)</code> looks relevant to my problem, since we must have <code>foo xss = (concat xss, concat' xss)</code> where <code>concat</code> and <code>concat'</code> are any functions of type <code>[[a]] -&gt; [a]</code>. Then <code>foo</code> satisfies <code>bimap (map f, map g) . foo = \\xss -&gt; ((fst . foo . map (map f)) xss, (snd . foo . map (map g)) xss)</code>.</p>\n\n<p>Already this 'law' seems too long to be correct, and I am unsure of my logic as well. So I thought of using an <a href=\"http://free-theorems.nomeata.de\" rel=\"noreferrer\">online free theorems generator</a>, but I don't get what <code>lift{(,)}</code> means:</p>\n\n<pre><code>forall t1,t2 in TYPES, g :: t1 -&gt; t2.\n forall x :: [[t1]].\n  (f x, f (map (map g) x)) in lift{(,)}(map g,map g)\n\nlift{(,)}(map g,map g)\n  = {((x1, x2), (y1, y2)) | (map g x1 = y1) &amp;&amp; (map g x2 = y2)}\n</code></pre>\n\n<p>How should I understand this output? And how should I derive the law for the function <code>foo</code> properly?</p>\n"}, {"tags": ["function", "haskell", "error-handling"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576442676, "post_id": 59347893, "comment_id": 104891792, "body": "What would <code>simplify (Const True `Not` a) = a</code> do?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576442705, "post_id": 59347893, "comment_id": 104891800, "body": "Futhermore <code>simplify (Const True `Or` a) = a</code> should be <code>simplify (Const True `Or` a) = const True</code>"}, {"owner": {"reputation": 67, "user_id": 12425185, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hM3rBjfNTCM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re3s0GhoUFQ_2x3kAwI_wOB71hBkA/photo.jpg?sz=128", "display_name": "osobennyj", "link": "https://stackoverflow.com/users/12425185/osobennyj"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576442741, "post_id": 59347893, "comment_id": 104891807, "body": "I would say returns a?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1576442979, "post_id": 59347893, "comment_id": 104891862, "body": "but <code>Not</code> takes only one parameter, hence <code>const True `Not` a</code>, makes no sense, it should be <code>Not a</code>, or <code>Not (Const True)</code>, or something else. I strongly advice you to first try to <i>understand</i> what is happening, instead of trying to write more lines that look similar."}, {"owner": {"reputation": 67, "user_id": 12425185, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hM3rBjfNTCM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re3s0GhoUFQ_2x3kAwI_wOB71hBkA/photo.jpg?sz=128", "display_name": "osobennyj", "link": "https://stackoverflow.com/users/12425185/osobennyj"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576443233, "post_id": 59347893, "comment_id": 104891938, "body": "You mean <code>Not</code> cannot take both <code>Const True</code> and <code>a</code> ?"}, {"owner": {"reputation": 67, "user_id": 12425185, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hM3rBjfNTCM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re3s0GhoUFQ_2x3kAwI_wOB71hBkA/photo.jpg?sz=128", "display_name": "osobennyj", "link": "https://stackoverflow.com/users/12425185/osobennyj"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576443324, "post_id": 59347893, "comment_id": 104891954, "body": "Oh,yeah. Right, it&#39;s declared as one argument Proposition."}, {"owner": {"reputation": 67, "user_id": 12425185, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hM3rBjfNTCM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re3s0GhoUFQ_2x3kAwI_wOB71hBkA/photo.jpg?sz=128", "display_name": "osobennyj", "link": "https://stackoverflow.com/users/12425185/osobennyj"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576443527, "post_id": 59347893, "comment_id": 104892010, "body": "So in <code>Not</code> case it will be <code>simplify ( Not (Const True)) = Const False</code> ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576483752, "post_id": 59347893, "comment_id": 104900304, "body": "exactly. Note that you furthermore first might want to simplify <code>a</code> itself, so recurse on <code>a</code> for certain simplifications."}], "answers": [{"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1576685782, "post_id": 59377178, "comment_id": 104981380, "body": "You made the same mistake! <code>simplify (Const True `And` a) = a</code> is correct. <code>simplify (Const True `Or` a) = a</code> is incorrect."}], "tags": [], "owner": {"reputation": 81, "user_id": 9216167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b50237ef0fc683b0ab171655ed747cb0?s=128&d=identicon&r=PG&f=1", "display_name": "n0m4d3", "link": "https://stackoverflow.com/users/9216167/n0m4d3"}, "is_accepted": false, "score": 1, "last_activity_date": 1576686466, "last_edit_date": 1576686466, "creation_date": 1576595838, "answer_id": 59377178, "question_id": 59347893, "link": "https://stackoverflow.com/questions/59347893/reduce-the-size-of-a-proposition-in-haskell/59377178#59377178", "title": "Reduce the size of a proposition in Haskell", "body": "<p>There are several things that can be improved in your approach.</p>\n\n<p>First, there are a few errors in your function, \nas already pointed out in the commments, the 'Not' constructor only takes one argument so </p>\n\n<pre><code>simplify (Const False `Not` a) = Const False\n</code></pre>\n\n<p>and </p>\n\n<pre><code>simplify (Const True `Not` a) = a\n</code></pre>\n\n<p>will not work.\nIn addition there are some logic errors,</p>\n\n<pre><code>simplify (Const False `Or` a) = Const False\n</code></pre>\n\n<p>and</p>\n\n<pre><code>simplify (Const True `Or` a) = a\n</code></pre>\n\n<p>are incorrect.</p>\n\n<p>Once these are fixed, your function should properly simplify, but only on the top level of the proposition. In order to simplify the whole proposition you need to add recursive calls to each right side that includes a variable and add the missing cases that are currently covered by</p>\n\n<pre><code>simplify prop = prop\n</code></pre>\n\n<p>e.g. you should change your cases like</p>\n\n<pre><code>simplify (Const True `And` a) = a\n</code></pre>\n\n<p>to</p>\n\n<pre><code>simplify (Const True `And` a) = simplify a\n</code></pre>\n\n<p>and add cases like</p>\n\n<pre><code>simplify (a `And` b) = ((simplify a) `And` (Simplify b))\n</code></pre>\n\n<p>This way the function will go through the entire proposition and stop at the first level. One way to make sure you have all cases covered is to remove</p>\n\n<pre><code>simplify prop = prop\n</code></pre>\n\n<p>and make a case for each constructor.\nFor the variables, you can just write</p>\n\n<pre><code>simplify (Var a) = (Var a)\n</code></pre>\n\n<p>and that will leave them as they are.</p>\n\n<p>In addition, top level functions are expected to have type annotations, so consider adding </p>\n\n<pre><code>simplify :: Proposition -&gt; Proposition\n</code></pre>\n\n<p>above your function declaration.</p>\n\n<p>A minor nitpick:\nIn cases like</p>\n\n<pre><code>simplify (Const False `And` a) = Const False\n</code></pre>\n\n<p>you don't need to bind a and can instead use a wildcard, like so:</p>\n\n<pre><code>simplify (Const False `And` _) = Const False\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 12425185, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hM3rBjfNTCM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re3s0GhoUFQ_2x3kAwI_wOB71hBkA/photo.jpg?sz=128", "display_name": "osobennyj", "link": "https://stackoverflow.com/users/12425185/osobennyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576686466, "creation_date": 1576442523, "question_id": 59347893, "link": "https://stackoverflow.com/questions/59347893/reduce-the-size-of-a-proposition-in-haskell", "title": "Reduce the size of a proposition in Haskell", "body": "<p>There is a function <strong>simplify</strong>, where <code>simplify :: Proposition -&gt; Proposition</code>, where </p>\n\n<pre><code>data Proposition =  Const Bool \n                   | Var String\n                   | And Proposition Proposition\n                   | Or Proposition Proposition\n                   | Not Proposition\n                   deriving Show\n</code></pre>\n\n<p>It is used to reduce the size of a given proposition. </p>\n\n<p>For example, </p>\n\n<pre><code>simplify (Const False `And` a) == Const False \nsimplify (Const True `And` a)  == a\n</code></pre>\n\n<p>My attempt is to use pattern matching in that case:</p>\n\n<pre><code>simplify (Const False `And` a) = Const False\nsimplify (Const False `Or` a) = Const False\nsimplify (Const False `Not` a) = Const False\nsimplify (Const True `And` a) = a\nsimplify (Const True `Or` a) = a\nsimplify (Const True `Not` a) = a\nsimplify prop = prop\n</code></pre>\n\n<p>But I am receiving two types of errors:</p>\n\n<ol>\n<li><p>The constructor \u2018Not\u2019 should have 1 argument, but has been given 2</p></li>\n<li><p>Variable not in scope: a :: Proposition</p></li>\n</ol>\n\n<p>What am I doing wrong? </p>\n"}, {"tags": ["haskell", "design-patterns", "functional-programming", "matching"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576441910, "post_id": 59347803, "comment_id": 104891607, "body": "A <code>filter</code> might eliminate elements, hence <code>filter (\\g -&gt; g </code>mod` 2 == 0) (x:xs)` is not said to return any elements, and thus the patterns <code>(a:as)</code> and <code>(b:bs)</code> might fail."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1576459801, "post_id": 59347803, "comment_id": 104895086, "body": "I see you have answers already, giving better ways to write this function - but the actual reason for the error message, which doesn&#39;t seem to have been picked up, is that in 2 of your patterns you misspell <code>addEven</code> as <code>addEeven</code>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1576442071, "creation_date": 1576442071, "answer_id": 59347838, "question_id": 59347803, "link": "https://stackoverflow.com/questions/59347803/haskell-non-exhaustive-pattern-for-a-reason-i-dont-understand/59347838#59347838", "title": "Haskell - Non-exhaustive pattern for a reason I don&#39;t understand", "body": "<p>A <code>filter</code> might eliminate elements, hence <code>filter (\\g -&gt; g</code>mod<code>2 == 0)</code> is not said to return any elements, and thus the patterns <code>(a:as)</code> and <code>(b:bs)</code> might fail.</p>\n\n<p>That being said, I think you make the problem too complex here. You can first define a helper function that adds two elements of a list:</p>\n\n<pre><code>addList :: Num a =&gt; [a] -&gt; [a] -&gt; [a]\naddList (x:xs) (y:ys) = (x+y) : addList xs ys\naddList xs [] = xs\naddList [] ys = ys\n</code></pre>\n\n<p>Then we do the filter on the two parameters, and make a function <code>addEven</code> that looks like:</p>\n\n<pre><code>addEven :: Integral a =&gt; [a] -&gt; [a] -&gt; [a]\naddEven xs ys = addList (filter even xs) (filter even ys)\n</code></pre>\n\n<p>or with <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Function.html#v:on\" rel=\"nofollow noreferrer\"><strong><code>on :: (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c</code></strong></a>:</p>\n\n<pre><code>import Data.Function(on)\n\naddEven :: Integral a =&gt; [a] -&gt; [a] -&gt; [a]\naddEven = addList `on` filter even\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1576449465, "creation_date": 1576449465, "answer_id": 59348685, "question_id": 59347803, "link": "https://stackoverflow.com/questions/59347803/haskell-non-exhaustive-pattern-for-a-reason-i-dont-understand/59348685#59348685", "title": "Haskell - Non-exhaustive pattern for a reason I don&#39;t understand", "body": "<p>While using <code>filter</code> is very instinctive in this case, perhaps using <code>filter</code> twice and then summing up the results might be slightly ineffficient for large lists. Why don't we do the job all at once for a change..?</p>\n\n<pre><code>addMatches :: [Int] -&gt; [Int] -&gt; [Int]\naddMatches [] [] = []\naddMatches [] ys = filter even ys\naddMatches xs [] = filter even xs\naddMatches xs ys = first [] xs ys\n                   where\n                   first :: [Int] -&gt; [Int] -&gt; [Int] -&gt; [Int]\n                   first rs [] ys     = rs ++ filter even ys\n                   first rs (x:xs) ys = rs ++ if even x then second [x] xs ys\n                                                        else first [] xs ys\n                   second :: [Int] -&gt; [Int] -&gt; [Int] -&gt; [Int]\n                   second [r] xs []     = [r] ++ filter even xs\n                   second [r] xs (y:ys) = if even y then first [r+y] xs ys\n                                                    else second [r] xs ys\n\n\u03bb&gt; addMatches [1,2,1,4,6] [2,2]\n[4,6,6]\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 9610524, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gMQ_j9H-5QI/AAAAAAAAAAI/AAAAAAAACe8/RKQEJJWTCLk/photo.jpg?sz=128", "display_name": "Jere", "link": "https://stackoverflow.com/users/9610524/jere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1576449465, "creation_date": 1576441793, "question_id": 59347803, "link": "https://stackoverflow.com/questions/59347803/haskell-non-exhaustive-pattern-for-a-reason-i-dont-understand", "title": "Haskell - Non-exhaustive pattern for a reason I don&#39;t understand", "body": "<p>So I'm trying to write a function that, given two lists of integers, adds the ith even number of each list and returns them in another list. In case one of the list doesn't have an ith even number, a 0 is considered. For example, if the lists are [1,2,1,4,6] and [2,2], it returns [4,6,6] ([2+2,4+2,6+0]). I have the following code:</p>\n\n<pre><code>addEven :: [Int] -&gt; [Int] -&gt; [Int] \naddEeven [] [] = []\naddEeven (x:xs) [] = filter (\\g -&gt; g `mod`2 == 0) (x:xs)\naddEven [] (y:ys) = filter (\\g -&gt; g `mod` 2 == 0) (y:ys)\naddEven (x:xs) (y:ys) = (a + b):(addEven as bs)\n                        where \n                          (a:as) = filter (\\g -&gt; g `mod` 2 == 0) (x:xs)\n                          (b:bs) = filter (\\g -&gt; g `mod` 2 == 0) (y:ys)\n</code></pre>\n\n<p>When I run that with the previous example, I get:</p>\n\n<pre><code>[4,6*** Exception: ex.hs:(4,1)-(8,101): Non-exhaustive patterns in function addEven\n</code></pre>\n\n<p>I really can't see what I'm missing, since it doesn't work with any input I throw at it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576437030, "post_id": 59347208, "comment_id": 104890394, "body": "<code>case</code> expects patterns, <code>n `mod` 2 &#47;= 0</code>, etc. are <i>not</i> patterns."}, {"owner": {"reputation": 4025, "user_id": 3107926, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/ONSDS.jpg?s=128&g=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3107926/oscar"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576437152, "post_id": 59347208, "comment_id": 104890423, "body": "right, so how would one go about doing this? guards?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1576440245, "post_id": 59347208, "comment_id": 104891196, "body": "<code>putStrLn $ if odd n || inRange (6,20) n then &quot;Weird&quot; else &quot;Not Weird&quot;</code>"}, {"owner": {"reputation": 4025, "user_id": 3107926, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/ONSDS.jpg?s=128&g=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3107926/oscar"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1576494189, "post_id": 59347208, "comment_id": 104905271, "body": "@DanielWagner even though yours is shorter, my objective was not to come up with the shortest possible version, but rather to understand the difference between <code>if..else</code> statements, <code>guards</code> and <code>case..of</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1576437161, "creation_date": 1576437161, "answer_id": 59347237, "question_id": 59347208, "link": "https://stackoverflow.com/questions/59347208/haskell-how-to-replace-nested-if-with-a-case-of-statement/59347237#59347237", "title": "Haskell, how to replace nested if with a case-of statement?", "body": "<p>You need to use guards if you have boolean expressions (conditions), instead of actual patterns.</p>\n\n<pre><code>main :: IO()\nmain = do\n    n &lt;- readLn :: IO Int\n    case () of\n       _ | n `mod` 2 /= 0 -&gt; putStrLn \"Weird\"\n         | n &gt;= 2 &amp;&amp; n &lt;= 5 -&gt; putStrLn \"Not Weird\"\n         | n &gt;= 6 &amp;&amp; n &lt;= 20 -&gt; putStrLn \"Weird\"\n         | n &gt; 20 -&gt; putStrLn \"Not Weird\"\n</code></pre>\n\n<p>Consider using <code>otherwise</code> in the last case: assuming you want to catch everything else, it's faster and suppresses a GHC warning about non-exhaustiveness.</p>\n\n<p>A \"multiway if\" can also be used as an alternative, but it requires an extension.</p>\n"}, {"comments": [{"owner": {"reputation": 4025, "user_id": 3107926, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/ONSDS.jpg?s=128&g=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3107926/oscar"}, "edited": false, "score": 0, "creation_date": 1576437820, "post_id": 59347264, "comment_id": 104890577, "body": "n == 1 should be catched by the first case, it is an odd number, however I replaced otherwise with _ and throws an error, do you know why could this be?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 4025, "user_id": 3107926, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/ONSDS.jpg?s=128&g=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3107926/oscar"}, "edited": false, "score": 0, "creation_date": 1576437975, "post_id": 59347264, "comment_id": 104890605, "body": "@OscarFranco: you can not write <code>otherwise = _</code>, since Haskell expects a string. You thus will need to specify a string, like <code>&quot;Weird&quot;</code> for example."}, {"owner": {"reputation": 4025, "user_id": 3107926, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/ONSDS.jpg?s=128&g=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3107926/oscar"}, "edited": false, "score": 0, "creation_date": 1576438023, "post_id": 59347264, "comment_id": 104890617, "body": "no, I wrote <code>| _ = &quot;Weird&quot;</code> since I learned that _ is a valid identifier"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 4025, "user_id": 3107926, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/ONSDS.jpg?s=128&g=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3107926/oscar"}, "edited": false, "score": 2, "creation_date": 1576438067, "post_id": 59347264, "comment_id": 104890622, "body": "@OscarFranco: no <code>_</code> is a <i>pattern</i> :). So you can not use it in a guard. Which expects expressions of type <code>Bool</code>. In fact <code>otherwise</code> is just an alias for <code>True</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1576437938, "last_edit_date": 1576437938, "creation_date": 1576437323, "answer_id": 59347264, "question_id": 59347208, "link": "https://stackoverflow.com/questions/59347208/haskell-how-to-replace-nested-if-with-a-case-of-statement/59347264#59347264", "title": "Haskell, how to replace nested if with a case-of statement?", "body": "<p>A <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-460003.13\" rel=\"nofollow noreferrer\"><em><code>case</code> expression</em> [Haskell-report]</a> deals with patterns. An expression like <code>n `mod` 2 /= 0</code> is <em>not</em> a pattern.</p>\n\n<p>I propose to define a helper function, and use <em>guards</em>:</p>\n\n<pre><code>tmp :: Int -&gt; String\ntmp n | n `mod` 2 /= 0 = &quot;Weird&quot;\n      | n &gt;= 2 &amp;&amp; N &lt;= 5 = &quot;Not Weird&quot;\n      | n &gt;= 6 &amp;&amp; N &lt;= 20 = &quot;Weird&quot;\n      | n &gt; 20 = &quot;Not Weird&quot;\n      | otherwise = &hellip;</code></pre>\n\n<p>You will still need to define a value for the <code>otherwise</code> case, in case <code>n &lt;= 0</code>.</p>\n\n<p>We can then use this with:</p>\n\n<pre><code>main = do\n    n &lt;- readLn\n    putStrLn (tmp n)</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1576481474, "creation_date": 1576481474, "answer_id": 59352233, "question_id": 59347208, "link": "https://stackoverflow.com/questions/59347208/haskell-how-to-replace-nested-if-with-a-case-of-statement/59352233#59352233", "title": "Haskell, how to replace nested if with a case-of statement?", "body": "<p>\"multiway if\" was mentioned in chi's answer but not explained and I think it's useful to know about for such cases. Enabling <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#multi-way-if-expressions\" rel=\"nofollow noreferrer\">the <code>MultiWayIf</code> extension</a> (e.g. by writing <code>{-# LANGUAGE MultiWayIf #-}</code> at the top of the file) allows you to write</p>\n\n<pre><code>if | (n `mod` 2 /= 0) -&gt; putStrLn \"Weird\"\n   | (n &gt;= 2) &amp;&amp; (n &lt;= 5) -&gt; putStrLn \"Not Weird\"\n   | (n &gt;= 6) &amp;&amp; (n &lt;= 20) -&gt; putStrLn \"Weird\"\n   | otherwise -&gt; putStrLn \"Not Weird\"\n</code></pre>\n"}], "owner": {"reputation": 4025, "user_id": 3107926, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/ONSDS.jpg?s=128&g=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3107926/oscar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 59347264, "answer_count": 3, "score": 1, "last_activity_date": 1576481474, "creation_date": 1576436871, "last_edit_date": 1576438280, "question_id": 59347208, "link": "https://stackoverflow.com/questions/59347208/haskell-how-to-replace-nested-if-with-a-case-of-statement", "title": "Haskell, how to replace nested if with a case-of statement?", "body": "<p>I'm starting to learn haskell and I'm solving some simple programming challenges. So my current problem right now is just printing some text based on the value being passed:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = do\n  n &lt;- readLn :: IO Int\n  if n `mod` 2 &gt; 0\n      then putStrLn \"Weird\"\n      else if n &gt; 1 &amp;&amp; n &lt; 6\n          then putStrLn \"Not Weird\"\n          else if n &gt; 5 &amp;&amp; n &lt; 21\n              then putStrLn \"Weird\"\n              else putStrLn \"Not Weird\"\n</code></pre>\n\n<p>However I think this is fairly ugly, is there someway I could replace the nested if structure with a more elegant pattern matching?</p>\n\n<p>I've tried:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO()\nmain = do\n    n &lt;- readLn :: IO Int\n    case n of\n        n `mod` 2 /= 0 -&gt; putStrLn \"Weird\"\n        n &gt;= 2 &amp;&amp; N &lt;= 5 -&gt; putStrLn \"Not Weird\"\n        n &gt;= 6 &amp;&amp; N &lt;= 20 -&gt; putStrLn \"Weird\"\n        n &gt; 20 -&gt; putStrLn \"Not Weird\"\n</code></pre>\n\n<p>but I get a compile error.</p>\n\n<p>Edit: Final solution</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>check :: Int -&gt; String\ncheck n\n    | (n `mod` 2 /= 0) = \"Weird\"\n    | (n &gt;= 2) &amp;&amp; (n &lt;= 5) = \"Not Weird\"\n    | (n &gt;= 6) &amp;&amp; (n &lt;= 20) = \"Weird\"\n    | otherwise = \"Not Weird\"\n\nmain :: IO()\nmain = do\n    n &lt;- readLn :: IO Int\n    putStrLn (check n)\n</code></pre>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "state-monad", "category-theory", "gadt"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1576426377, "post_id": 59345398, "comment_id": 104887672, "body": "There seems to be an interesting problem here but the types most likely will need a lot of fixing (e.g., <code>(() := &#39;Closed) &#39;Open)</code> is an empty type, so probably not what you&#39;re looking for). Can you give some more context about the problem you are trying to solve?"}, {"owner": {"reputation": 739, "user_id": 198277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cfe3de23679d68748d82750de1b88dc?s=128&d=identicon&r=PG", "display_name": "Sam Derbyshire", "link": "https://stackoverflow.com/users/198277/sam-derbyshire"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1576426596, "post_id": 59345398, "comment_id": 104887728, "body": "<code>( () := &#39;Closed ) &#39;Open</code> is uninhabited, but I am only dealing with values of type <code>AST ( ( () := &#39;Closed ) &#39;Open) </code>."}, {"owner": {"reputation": 739, "user_id": 198277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cfe3de23679d68748d82750de1b88dc?s=128&d=identicon&r=PG", "display_name": "Sam Derbyshire", "link": "https://stackoverflow.com/users/198277/sam-derbyshire"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1576426766, "post_id": 59345398, "comment_id": 104887788, "body": "For context, the AST (as formulated in the OP) is already being used to implement an EDSL that compiles to a low-level shading language on the GPU, and I want to implement an evaluator to be able to run that same code on the CPU side within Haskell. The types as written in the OP are working in my situation, although they might of course need adjustement in order to implement evaluation (although I would hope to be able to keep disruption to a minimum)."}, {"owner": {"reputation": 739, "user_id": 198277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cfe3de23679d68748d82750de1b88dc?s=128&d=identicon&r=PG", "display_name": "Sam Derbyshire", "link": "https://stackoverflow.com/users/198277/sam-derbyshire"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1576427267, "post_id": 59345398, "comment_id": 104887930, "body": "The indexed state I am using is quite complex, but as far as evaluation is concerned in my situation it should boil down to a map of bindings. For instance I have an AST constructor akin to <code>NewBinding :: LacksBinding name st =&gt; Proxy name -&gt; AST ( a -&gt; ( () := InsertBinding &#39;(name, a) st ) st )</code>. (The rest of the indexed monadic state is being used for type-level validation and can be discarded for the purposes of writing an evaluator.)"}, {"owner": {"reputation": 739, "user_id": 198277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cfe3de23679d68748d82750de1b88dc?s=128&d=identicon&r=PG", "display_name": "Sam Derbyshire", "link": "https://stackoverflow.com/users/198277/sam-derbyshire"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1576427619, "post_id": 59345398, "comment_id": 104888028, "body": "You are of course right that the uninhabitedness of <code>( a := j ) i</code> for distinct i, j is a central problem. I was envisioning an instantiation of the form <code>eval&#39; :: AST ( ( a := j ) i ) -&gt; IndexedStateMonad i j a</code> and then the user can use some <code>runIndexedState</code> function to evaluate the right hand side given a starting state compatible with the starting state type annotation <code>i</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1576428482, "post_id": 59345398, "comment_id": 104888254, "body": "Ok so the index of <code>AST</code> is just meant to be some syntax of the types of the EDSL. That the index is a <code>Type</code> and that <code>:=</code>/<code>AtKey</code> is used does not really matter. I&#39;d be curious to see how your compiler already handles <code>Lam</code>, <code>Bind</code> and maybe one of the operations."}, {"owner": {"reputation": 739, "user_id": 198277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cfe3de23679d68748d82750de1b88dc?s=128&d=identicon&r=PG", "display_name": "Sam Derbyshire", "link": "https://stackoverflow.com/users/198277/sam-derbyshire"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1576430277, "post_id": 59345398, "comment_id": 104888694, "body": "It handles lambdas and bind by doing code-generation for their arguments, applying the functions to these arguments, and doing code-generation for the result. For an operation such as adding a binding, it adds the value of the binding to the state of the code-generator monad, so that code-generation for the &quot;get value of binding&quot; operation can use that monadic state to retrieve the value. I&#39;m afraid the comment section here is a bit small for a more detailed answer."}], "owner": {"reputation": 739, "user_id": 198277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cfe3de23679d68748d82750de1b88dc?s=128&d=identicon&r=PG", "display_name": "Sam Derbyshire", "link": "https://stackoverflow.com/users/198277/sam-derbyshire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1576427152, "creation_date": 1576424374, "last_edit_date": 1576427152, "question_id": 59345398, "link": "https://stackoverflow.com/questions/59345398/evaluator-for-an-ast-that-describes-both-pure-and-indexed-monadic-impure-value", "title": "Evaluator for an AST that describes both pure and (indexed monadic) impure values", "body": "<p>I have an AST which describes both pure and impure computations, with the impure computations keeping track of state at the type level. I'm using a HOAS representation; the relevant constructors of the AST GADT are as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data AST a where\n  Lam :: (AST a -&gt; AST b) -&gt; AST (a -&gt; b)\n  (:$) :: AST (a -&gt; b) -&gt; AST a -&gt; AST b\n\n  Return :: AST (a -&gt; (a := i) i)\n  Bind :: AST ( (a := j) i -&gt; ( a -&gt; q j ) -&gt; q i )\n\n  -- then some stateful operations\n  -- for instance if the indexed state keeps track of a CD player tray:\n  -- OpenCDPlayer :: AST ( ( () := 'Open ) 'Closed )\n  -- CloseCDPlayer :: AST ( ( () := 'Closed ) 'Open )\n</code></pre>\n\n<p>Here <code>(a := j) i</code> is McBride's <code>AtKey</code> type, which consists of a type annotated with beginning and end states (<code>i</code> and <code>j</code>, respectively). <code>Bind</code> corresponds to McBride's \"angelic bind\", which boils down to the provision of a function</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>bind :: AST ( (a := j) i ) -&gt; Codensity AST (a := j) i\n</code></pre>\n\n<p>where <code>Codensity</code> is the indexed version of the usual codensity transformation.    </p>\n\n<p>My question is about how to implement evaluation in this situation. Usually, one would have an evaluation function of the form:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>eval :: AST a -&gt; a\n</code></pre>\n\n<p>However in this case I am at a loss as to what type give to the evaluation function, as when state-annotated types are involved I think evaluation should be formulated as having a type close to the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>evalM :: Codensity AST (a := j) i -&gt; Codensity ((-&gt;) St) (a := j) i\n</code></pre>\n\n<p>where <code>St</code> allows us to keep track of state at the value-level, so that the right-hand side is an indexed state monad (<code>Codensity ((-&gt;) s) ~ State s</code>).<br>\nThis type signature for <code>evalM</code> seems rather intuitive, as it describes a natural transformation of indexed monads, and seems to be the core of the task at hand.   </p>\n\n<p><strong>Question</strong>: how can I formulate and implement evaluation in this context? What type should it have, and how would I implement the <code>evalM</code> function above?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1576425180, "post_id": 59344885, "comment_id": 104887395, "body": "I admit I got a bit lost but my guess would be it&#39;s the interaction <code>doTimings</code> and <code>runCollectTimingx</code> -- I&#39;m suspicious they don&#39;t match up. Try annotating where you are instantiating them with <code>TypeApplications</code> (even just for your mind)."}], "answers": [{"comments": [{"owner": {"reputation": 88, "user_id": 115960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2dd177659b9a6b38efbe5559d0a490?s=128&d=identicon&r=PG", "display_name": "pepeiborra", "link": "https://stackoverflow.com/users/115960/pepeiborra"}, "edited": false, "score": 0, "creation_date": 1576426480, "post_id": 59345631, "comment_id": 104887695, "body": "Thanks, that&#39;s actually very helpful - problem solved. I had assumed a need for quantified constraints there, much better without them."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1576426137, "creation_date": 1576426137, "answer_id": 59345631, "question_id": 59344885, "link": "https://stackoverflow.com/questions/59344885/encoding-a-choice-of-monad-transformers/59345631#59345631", "title": "Encoding a choice of monad transformers", "body": "<p>If you simplify the superclass context on the <code>instance MonadCostCenter (Both t1 t2 m)</code> to the minimum needed:</p>\n\n<pre><code>instance (MonadTransControl t1, MonadCostCenter (t2 m), MonadCostCenter (t1 (t2 m)))\n         =&gt; MonadCostCenter (Both t1 t2 m) where\n  registerCostCenter name (Both action) = ...\n</code></pre>\n\n<p>it seems to type-check.  Like @luqui, I'm lost in the types, so I can't see exactly why the original code doesn't work.</p>\n"}], "owner": {"reputation": 88, "user_id": 115960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2dd177659b9a6b38efbe5559d0a490?s=128&d=identicon&r=PG", "display_name": "pepeiborra", "link": "https://stackoverflow.com/users/115960/pepeiborra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 59345631, "answer_count": 1, "score": 2, "last_activity_date": 1576426325, "creation_date": 1576420463, "last_edit_date": 1576426325, "question_id": 59344885, "link": "https://stackoverflow.com/questions/59344885/encoding-a-choice-of-monad-transformers", "title": "Encoding a choice of monad transformers", "body": "<pre><code>&gt; {-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n&gt; {-# LANGUAGE ConstraintKinds, DerivingVia, DerivingStrategies, GeneralizedNewtypeDeriving, KindSignatures, NoMonomorphismRestriction, RecordWildCards #-}\n&gt; {-# LANGUAGE GADTs, QuantifiedConstraints, RankNTypes #-}\n&gt; import Control.Monad.Identity\n&gt; import Control.Monad.IO.Class\n&gt; import Control.Monad.Trans.Reader\n&gt; import Control.Monad.Trans.State\n&gt; import Control.Monad.Trans.Class\n&gt; import Control.Monad.Trans.Control\n&gt; import Data.Time.Clock (NominalDiffTime, diffUTCTime)\n&gt; import qualified Data.Time.Clock as Time\n</code></pre>\n\n<p>Sometimes it can be desirable to intercept or change the behaviour of a monadic effect dynamically.\nTo make things concrete, let's assume an effect that allows to declare cost centers:</p>\n\n<pre><code>&gt; class Monad m =&gt; MonadCostCenter m where\n&gt;   registerCostCenter :: Name -&gt; m a -&gt; m a\n</code></pre>\n\n<p>One possible implementation generates log lines for every start/complete event of a cost center:</p>\n\n<pre><code>&gt; newtype ViaLogging m a = ViaLogging {runViaLogging :: m a}\n&gt;   deriving (Applicative, Functor, Monad, MonadIO) via (IdentityT m)\n&gt;   deriving MonadTrans via IdentityT\n\n&gt; instance MonadLog m =&gt; MonadCostCenter (ViaLogging m) where\n&gt;   registerCostCenter name action = do\n&gt;     ViaLogging $ logMsg (\"Starting cost center \" &lt;&gt; name)\n&gt;     res &lt;- action\n&gt;     ViaLogging $ logMsg (\"Completed cost center\" &lt;&gt; name)\n&gt;     return res\n</code></pre>\n\n<p>Another possibility is to collect all the timings in a data structure for processing later:</p>\n\n<pre><code>&gt; data Timing = Timing {name :: String, duration :: NominalDiffTime}\n\n&gt; newtype CollectTimingsT m a = CollectTimingsT (StateT [Timing] m a)\n&gt;   deriving newtype (Applicative, Functor, Monad, MonadIO, MonadTrans, MonadTransControl)\n\n&gt; runCollectTimings :: Monad m =&gt; ([Timing] -&gt; m ()) -&gt; CollectTimingsT m a -&gt; m a\n&gt; runCollectTimings doSomethingWithTimings (CollectTimingsT action) = do\n&gt;   (res, timings) &lt;- runStateT action []\n&gt;   doSomethingWithTimings timings\n&gt;   return res\n\n&gt; instance MonadTime m =&gt; MonadCostCenter (CollectTimingsT m) where\n&gt;   registerCostCenter name action = do\n&gt;     startTime &lt;- CollectTimingsT $ lift getCurrentTime\n&gt;     res &lt;- action\n&gt;     endTime &lt;- CollectTimingsT $ lift getCurrentTime\n&gt;     let duration = diffUTCTime endTime startTime\n&gt;     CollectTimingsT $ modify (Timing{..} :)\n&gt;     return res\n</code></pre>\n\n<p>Assume our application is a web service and it doesn't care to collect timings unless\nexplicitly required by the request being handled. Our code will look like:</p>\n\n<pre><code>&gt; type HandlerMonad = WebT (CostCenterT (LogT (TimeT IO)))\n&gt;\n&gt; runHandler :: HandlerMonad a -&gt; IO a\n&gt; runHandler = undefined\n</code></pre>\n\n<p>But what is the type <code>CostCenterT</code>? Didn't we say that it depends on the request?\nWell yes, we want to handle cost centers differently depending on the request,\nbut the Haskell type system requires that the type of the <em>carrier</em> <code>HandlerMonad</code> is fixed.\nThis choice can be encoded explicitly using an <code>Either</code> based carrier:</p>\n\n<pre><code>&gt; type HandlerMonad' = WebT (EitherT ViaLogging CollectTimingsT (LogT (TimeT IO)))\n&gt;\n&gt; newtype EitherT t1 t2 (m :: * -&gt; *) a = EitherT {runEitherT :: Either (t1 m a) (t2 m a)}\n</code></pre>\n\n<p>The rest of <code>EitherT</code> boilerplate (instances, run function) are not pretty and left as an exercise for the reader.\nIs there a better way?</p>\n\n<h2>Effect interpreters</h2>\n\n<p>The problem described above does not apply to some effect systems like <em>polysemy</em>,\nwhere there is no explicit carrier. Effect systems with explicit carriers like <em>fused-effects</em>\nand <em>transformers</em> can work around this by defining an <code>Interpreter</code> transformer.\nIndeed, <em>fused-effects</em> includes the monad transfomer <code>Control.Effect.Interpret.InterpretC s sig</code>\nwhich can be used to intercept an effect <code>sig</code> implemented by the underlying monad <code>m</code>.</p>\n\n<p>We can define a similar abstraction for vanilla <em>transformers</em> as follows:</p>\n\n<pre><code>&gt; newtype InterpretT c m a = InterpretT (ReaderT (Interpreter c m) m a)\n&gt;   deriving (Applicative, Functor, Monad, MonadIO)\n&gt;\n&gt; instance MonadTrans (InterpretT c) where\n&gt;   lift = InterpretT . lift\n&gt;\n&gt; data Interpreter c (m :: * -&gt; *) where\n&gt;   Interpreter :: c (t m) =&gt; (forall a . t m a -&gt; m a) -&gt; Interpreter c m\n&gt;\n&gt; runInterpretT :: Interpreter c m -&gt; InterpretT c m a -&gt; m a\n&gt; runInterpretT run (InterpretT action) = runReaderT action run\n&gt;\n&gt; wrapEffect :: Monad m =&gt; (forall m . c m =&gt; m a) -&gt; InterpretT c m a\n&gt; wrapEffect action = InterpretT $ do\n&gt;   Interpreter run &lt;- ask\n&gt;   lift (run action)\n</code></pre>\n\n<p>Now we can define <code>HandlerMonad</code> and <code>runHandler</code> as follows:</p>\n\n<pre><code>&gt; type HandlerMonad'' = InterpretT MonadCostCenter (WebT (LogT (TimeT IO)))\n&gt;\n&gt; runHandler'' = runTimeT\n&gt;              . runLogT\n&gt;              . runWebT\n&gt;              . runInterpretT (if True then Interpreter runViaLogging else Interpreter (runCollectTimings sendTimings))\n</code></pre>\n\n<h2>Dynamic effect interpreters</h2>\n\n<p>The solution above works well for simple dynamism, but sometimes we want to change\nor extend the interpreter <em>within</em> the computation. Something like:</p>\n\n<pre><code>&gt; localInterpreter :: (Interpreter c m -&gt; Interpreter c m) -&gt; InterpretT c m a -&gt; InterpretT c m a\n&gt; localInterpreter f (InterpretT action) = InterpretT $ local f action\n</code></pre>\n\n<p>This is almost useful, except that there is no practical way to delegate to the\nprevious interpreter. It allows overwrite only:</p>\n\n<pre><code>&gt; switchToCollectTimings :: ([Timing -&gt; m ()]) -&gt; HandlerMonad'' a -&gt; HandlerMonad'' a\n&gt; switchToCollectTimings doTimings = localInterpreter (const $ Interpreter $ runCollectTimings sendTimings)\n</code></pre>\n\n<p>In order to enable delegation, we have to resort to another monad transformer:</p>\n\n<pre><code>&gt; newtype Both (t1 :: (* -&gt; *) -&gt; * -&gt; *) t2 (m :: * -&gt; *) a = Both {runBoth :: t1 (t2 m) a}\n&gt;   deriving (Applicative, Functor, Monad, MonadIO)\n\n&gt; instance (forall m . Monad m =&gt; Monad (t2 m), MonadTrans t2, MonadTrans t1) =&gt; MonadTrans (Both t1 t2) where\n&gt;   lift = Both . lift . lift\n\n&gt; instance (forall n. Monad n =&gt;\n&gt;          (MonadCostCenter (t1 n)\n&gt;          ,MonadCostCenter (t2 n)\n&gt;          ,Monad (t1 n)\n&gt;          ,Monad (t2 n))\n&gt;          ,MonadTransControl t1\n&gt;          ,Monad m\n&gt;          ) =&gt; MonadCostCenter (Both t1 t2 m) where\n&gt;   registerCostCenter name (Both action) = Both\n&gt;     $ registerCostCenter name\n&gt;     $ liftWith (\\runInT2 -&gt; registerCostCenter name (runInT2 action)) &gt;&gt;= restoreT . return\n</code></pre>\n\n<p>Now we can almost write the function below:</p>\n\n<pre><code>&gt; class (MonadTime m, MonadCostCenter m) =&gt; MonadCostCenterTime m\n&gt; instance (MonadTime m, MonadCostCenter m) =&gt; MonadCostCenterTime m\n\n&gt; type HandlerMonad''' = InterpretT MonadCostCenterTime (WebT (LogT (TimeT IO)))\n\n&gt; addTimingsCollection :: (forall m . MonadTime m =&gt; [Timing] -&gt; m ()) -&gt; HandlerMonad''' a -&gt; HandlerMonad''' a\n&gt; addTimingsCollection doTimings = localInterpreter $ \\(Interpreter delegate) -&gt;\n&gt;    Interpreter (delegate . runCollectTimings doTimings . runBoth)\n</code></pre>\n\n<p>However it fails with the type error below, where the <code>instance MonadCostCenter CollectTimingsT</code>\npulls in a <code>MonadTime</code> constraint, and GHC demands evidence that the delegate interpreter provides it.\nWe know that it does, since it satisfies <code>MonadCostCenterTime</code> which includes <code>MonadTime</code>, but for some\nreason the type checked doesn't accept this.</p>\n\n<pre><code>    * Could not deduce (MonadIO n) arising from a use of `Interpreter'\n      from the context: MonadCostCenterTime (t (WebT (LogT (TimeT IO))))\n        bound by a pattern with constructor:\n                   Interpreter :: forall (c :: (* -&gt; *) -&gt; Constraint) (t :: (* -&gt; *)\n                                                                             -&gt; * -&gt; *) (m :: *\n                                                                                              -&gt; *).\n                                  c (t m) =&gt;\n                                  (forall a. t m a -&gt; m a) -&gt; Interpreter c m,\n                 in a lambda abstraction\n        at interpreter.lhs:161:57-76\n      or from: Monad n\n        bound by a quantified context at interpreter.lhs:1:1\n      Possible fix:\n        add (MonadIO n) to the context of a quantified context\n    * In the expression:\n        Interpreter (delegate . runCollectTimings doTimings . runBoth)\n      In the second argument of `($)', namely\n        `\\ (Interpreter delegate)\n           -&gt; Interpreter (delegate . runCollectTimings doTimings . runBoth)'\n      In the expression:\n        localInterpreter\n          $ \\ (Interpreter delegate)\n              -&gt; Interpreter (delegate . runCollectTimings doTimings . runBoth)\n    |\n162 | &gt;    Interpreter (delegate . runCollectTimings doTimings . runBoth)\n    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 11238748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lt00p.jpg?s=128&g=1", "display_name": "s666", "link": "https://stackoverflow.com/users/11238748/s666"}, "edited": false, "score": 0, "creation_date": 1576409731, "post_id": 59343451, "comment_id": 104883921, "body": "Thanks! And I was just wondering if there is a function in Haskell that work in the way as I said, rather that prefix match?"}, {"owner": {"reputation": 11251, "user_id": 9558399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RFQOg.jpg?s=128&g=1", "display_name": "bugs", "link": "https://stackoverflow.com/users/9558399/bugs"}, "reply_to_user": {"reputation": 133, "user_id": 11238748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lt00p.jpg?s=128&g=1", "display_name": "s666", "link": "https://stackoverflow.com/users/11238748/s666"}, "edited": false, "score": 0, "creation_date": 1576409765, "post_id": 59343451, "comment_id": 104883926, "body": "Sure! See Willem&#39;s answer"}], "tags": [], "owner": {"reputation": 11251, "user_id": 9558399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RFQOg.jpg?s=128&g=1", "display_name": "bugs", "link": "https://stackoverflow.com/users/9558399/bugs"}, "is_accepted": false, "score": 10, "last_activity_date": 1576410767, "last_edit_date": 1576410767, "creation_date": 1576409410, "answer_id": 59343451, "question_id": 59343416, "link": "https://stackoverflow.com/questions/59343416/span-function-in-haskell/59343451#59343451", "title": "span function in Haskell", "body": "<p>Your understanding of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:span\" rel=\"nofollow noreferrer\">span</a> is not entirely correct, this is what the official docs say:</p>\n\n<blockquote>\n  <p>span, applied to a predicate p and a list xs,\n  returns a tuple where first element is longest <strong>prefix</strong> (possibly empty)\n  of xs of elements that satisfy p and second element\n  is the remainder of the list</p>\n</blockquote>\n\n<p>(emphasis mine).</p>\n\n<p>Hence, the predicate is applied to each element of the list starting from the beginning. This means that the predicate in</p>\n\n<pre><code>span (&lt;3) [1,2,4,5,6]\n</code></pre>\n\n<p>is satisfied for the first two elements, and the result is </p>\n\n<pre><code>([1,2], [4,5,6])\n</code></pre>\n\n<p>But in this other example</p>\n\n<pre><code>span (&gt;3) [1,2,4,5,6]\n</code></pre>\n\n<p>the first element of the list already doesn't satisfy the predicate, so the first element of the returned tuple will be an empty list.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 7, "last_activity_date": 1576409451, "creation_date": 1576409451, "answer_id": 59343463, "question_id": 59343416, "link": "https://stackoverflow.com/questions/59343416/span-function-in-haskell/59343463#59343463", "title": "span function in Haskell", "body": "<p>What you describe here is <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:partition\" rel=\"noreferrer\"><strong><code>partition :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])</code></strong></a>. This is a function that for a given predicate will take a list, and make a 2-tuple where the first item is a list with items that satisfy the predicate, and the second item a list of items that do <em>not</em> satisfy the predicate. Indeed:</p>\n\n<pre><code>Prelude Data.List&gt; partition (&gt;3) [1,2,4,5,6]\n([4,5,6],[1,2])\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:span\" rel=\"noreferrer\"><strong><code>span :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])</code></strong></a> on the other hand makes a 2-tuple where the first item is the <strong><em>longest prefix</em></strong> of elements in the list that satisfy the predicate, and the second item is the list of remaining elements. Since for <code>span (&gt;3) [1,2,4,5,6]</code>, the first item does <em>not</em> satisfy the predicate. The longest prefix is the empty list <code>[]</code>, and all elements of the given list, appear in the second item.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1576416786, "creation_date": 1576416786, "answer_id": 59344384, "question_id": 59343416, "link": "https://stackoverflow.com/questions/59343416/span-function-in-haskell/59344384#59344384", "title": "span function in Haskell", "body": "<p>Basically <code>span</code>'s complement is kind of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:break\" rel=\"nofollow noreferrer\"><code>break :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])</code></a>. You might even need to read the part twice in the docs to understand the subtle difference between <code>break</code> and <code>span</code>.</p>\n\n<blockquote>\n  <p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:break\" rel=\"nofollow noreferrer\"><code>break</code></a>, applied to a predicate p and a list xs, returns a tuple where\n  first element is longest prefix (possibly empty) of xs of elements\n  that <strong>do not</strong> satisfy p and second element is the remainder of the list:</p>\n</blockquote>\n\n<p>So coming back to your question</p>\n\n<pre><code>\u03bb&gt; break (&gt;3) [1,2,4,5,6]\n([1,2],[4,5,6])\n</code></pre>\n\n<p>You may of course <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Tuple.html\" rel=\"nofollow noreferrer\"><code>swap :: (a, b) -&gt; (b, a)</code></a> the tuple if that's essential. ie. <code>swap . break</code></p>\n"}, {"tags": [], "owner": {"reputation": 2590, "user_id": 371082, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/K4lxo.png?s=128&g=1", "display_name": "dade", "link": "https://stackoverflow.com/users/371082/dade"}, "is_accepted": false, "score": 0, "last_activity_date": 1596642028, "creation_date": 1596642028, "answer_id": 63268720, "question_id": 59343416, "link": "https://stackoverflow.com/questions/59343416/span-function-in-haskell/63268720#63268720", "title": "span function in Haskell", "body": "<p>Another way to view the <code>span</code> function is to see it as consisting of both <code>takeWhile</code> and <code>dropWhile</code> function. i.e it is the application of both <code>takeWhile</code> and <code>dropWhile</code> function.</p>\n<p>And what are these two functions?</p>\n<p><code>takeWhile</code> according to the <a href=\"https://hackage.haskell.org/package/base/docs/Data-List.html#v:takeWhile\" rel=\"nofollow noreferrer\">documentation</a></p>\n<blockquote>\n<p>takeWhile, applied to a predicate p and a list xs, returns the longest prefix (possibly empty) of xs of elements that satisfy p:</p>\n</blockquote>\n<p>Basically it keeps returning elements from the list as long as the predicate is true. This means If the first element fails the predicate <code>takeWhile</code> will return []</p>\n<p><code>dropWhile</code> on the other hand, according to the <a href=\"https://hackage.haskell.org/package/base/docs/Data-List.html#v:dropWhile\" rel=\"nofollow noreferrer\">documentation</a></p>\n<blockquote>\n<p>dropWhile p xs returns the suffix remaining after takeWhile p xs</p>\n</blockquote>\n<p>Basically it keeps skipping elements from the list while the predicate returns true. Once the predicate returns false, the remaining elements in the list is returned.</p>\n<p>To see if the statement I made above about <code>span</code> being the application of both <code>takeWhile</code> and <code>dropWhile</code> function, we can apply these function independently to see their results.</p>\n<p>Using just <code>takeWhile</code>:</p>\n<pre><code>*Main Data.List&gt; takeWhile (&gt;3) [1,2,4,5,6]\n[]\n</code></pre>\n<p>Using just <code>dropWhile</code>:</p>\n<pre><code>*Main Data.List&gt; dropWhile (&gt;3) [1,2,4,5,6]\n[1,2,4,5,6]\n</code></pre>\n<p>Now using <code>span</code></p>\n<pre><code>*Main Data.List&gt; span (&gt;3) [1,2,4,5,6]\n([],[1,2,4,5,6])\n</code></pre>\n<p>The result confirms <code>span</code> is applying both <code>takeWhile</code> and <code>dropWhile</code></p>\n<p>Note that what you describe here:</p>\n<blockquote>\n<p>I think that the span function is Haskell is to apply a predicate to a list, and return a tuple where the first element is elements in the list that satisfy that predicate and the second element is the reminder of the list</p>\n</blockquote>\n<p>Is the <code>partition</code> function as can be seen from the <a href=\"https://hackage.haskell.org/package/base/docs/Data-List.html#v:partition\" rel=\"nofollow noreferrer\">documentation</a></p>\n"}], "owner": {"reputation": 133, "user_id": 11238748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lt00p.jpg?s=128&g=1", "display_name": "s666", "link": "https://stackoverflow.com/users/11238748/s666"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2159, "favorite_count": 0, "answer_count": 4, "score": 3, "last_activity_date": 1596642028, "creation_date": 1576409122, "last_edit_date": 1576409286, "question_id": 59343416, "link": "https://stackoverflow.com/questions/59343416/span-function-in-haskell", "title": "span function in Haskell", "body": "<p>I think that the <strong>span</strong> function is <strong>Haskell</strong> is to apply a predicate to a list, and return a tuple where the first element is elements in the list that satisfy that predicate and the second element is the reminder of the list. </p>\n\n<p>And it works well when I put:\n<code>span (&lt;3) [1,2,4,5,6]</code>. It just returns in GHCI:\n<code>([1,2], [4,5,6])</code>.</p>\n\n<p>However, when I enter <code>span (&gt;3) [1,2,4,5,6]</code>, it returns <code>([],[1,2,4,5,6])</code>. But I thought it should return <code>([4,5,6],[1,2])</code>. So I was wondering the reason of it .</p>\n"}, {"tags": ["parsing", "haskell", "types", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576408431, "post_id": 59343287, "comment_id": 104883691, "body": "You wrap it in a <code>P</code> constructor, hence it should be of type <code>String -&gt; [(a,String)]</code>. That being said, the parser is not yet complete, since it is possible that the list contains more than one element."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1576409212, "last_edit_date": 1576409212, "creation_date": 1576408823, "answer_id": 59343370, "question_id": 59343287, "link": "https://stackoverflow.com/questions/59343287/monad-parser-couldnt-match-expected-type-b-string-with-actual-type-pa/59343370#59343370", "title": "Monad Parser - Couldn&#39;t match expected type \u2018[(b, String)]\u2019 with actual type \u2018Parser b\u2019", "body": "<p><code>&gt;&gt;=</code> return a Parser b, not a [(b, String)].Infact <code>g v</code>, is a <code>Parser</code>.</p>\n\n<p>That is correct, but we are constructing a <code>Parser</code> with the outer <code>P</code>. Indeed:</p>\n\n<pre><code>p &gt;&gt;=  g = <b>P</b> (\\inp -&gt; case parse p inp of\n  [] -&gt; []\n  [(v, out)] -&gt; parse (g v) out)</code></pre>\n\n<p>Notice the <code>P</code> here immediately after the <code>=</code>. The lambda expression <code>\\inp -&gt; &hellip;</code> thus has to have as type <code>String -&gt; [(b, String)]</code>, not <code>Parser</code>. We evaluate the parser with <code>parse</code>, since that acts as a \"getter\" to get the function out of the <code>g v</code>.</p>\n\n<p>Your implementation of <code>&gt;&gt;=</code> is however not complete. Indeed, this is a backtracking parser, and it is possible that the list contains no elements (no options), one element, or <em>multiple</em> elements. We thus should perform a mapping like:</p>\n\n<pre><code>p &gt;&gt;= g = P (\n    \\inp -&gt; <b>concatMap (\\(v, out) -&gt; parse (g v) out)</b> (parse p inp)\n  )</code></pre>\n\n<p>or we can make use of the bind operator <code>&gt;&gt;=</code> defined for lists:</p>\n\n<pre><code>p &gt;&gt;= g = P (\n    \\inp -&gt; parse p inp &gt;&gt;= \\(v, out) -&gt; parse (g v) out\n  )</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 4789197, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e1ac805d1a1c6297fe67a630d20546a2?s=128&d=identicon&r=PG&f=1", "display_name": "Cenzy ", "link": "https://stackoverflow.com/users/4789197/cenzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 59343370, "answer_count": 1, "score": 2, "last_activity_date": 1576409212, "creation_date": 1576408209, "question_id": 59343287, "link": "https://stackoverflow.com/questions/59343287/monad-parser-couldnt-match-expected-type-b-string-with-actual-type-pa", "title": "Monad Parser - Couldn&#39;t match expected type \u2018[(b, String)]\u2019 with actual type \u2018Parser b\u2019", "body": "<p>I'm studying Haskell using \"Programming in Haskell\" of G.Hutton. I'm following ch.13 of Monadic Parser.\nFirst, I define a type Parser:</p>\n\n<pre><code>newtype Parser a = P (String -&gt; [(a, String)])\n</code></pre>\n\n<p>Then, a parse function</p>\n\n<pre><code>parse:: Parser a -&gt; String -&gt; [(a, String)]\n</code></pre>\n\n<p>I make the Parser a Monad</p>\n\n<pre><code>instance Monad Parser where\n--return :: a -&gt; Parser a\n return v =  P(\\inp -&gt; [(v, inp)])\n\n--(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n p &gt;&gt;=  g = P (\\inp -&gt; case parse p inp of\n  [] -&gt; []\n  [(v, out)] -&gt; parse (g v) out)\n</code></pre>\n\n<p>My problem is on the last line of Monad instance\nWhy this</p>\n\n<pre><code>[(v, out)] -&gt; parse (g v) out)\n</code></pre>\n\n<p>and not this</p>\n\n<pre><code>[(v, out)] -&gt; (g v))\n</code></pre>\n\n<p><code>&gt;&gt;=</code> return a Parser b, not a <code>[(b, String)]</code>.Infact <code>g v</code>, is a Parser.</p>\n\n<p>I know I'm wrong, but I don't understand why.</p>\n"}, {"tags": ["haskell", "hspec"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1576420916, "creation_date": 1576420916, "answer_id": 59344939, "question_id": 59342263, "link": "https://stackoverflow.com/questions/59342263/getting-started-with-hspec-and-tasty-in-haskell/59344939#59344939", "title": "Getting started with HSpec and Tasty in Haskell?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/tasty-hspec-1.1.5.1/docs/Test-Tasty-Hspec.html#g:4\" rel=\"nofollow noreferrer\">Examples section</a> in the documentation of tasty-hspec has the solution: use <code>testSpec</code> to convert a <code>Spec</code> to a <code>TestTree</code>.</p>\n\n<pre><code>spec_beats :: Spec\nspec_beats = ...\n\nmain :: IO ()\nmain = do\n  tests &lt;- testSpec \"beats\" spec_beats\n  defaultMain tests\n</code></pre>\n"}], "owner": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 495, "favorite_count": 0, "accepted_answer_id": 59344939, "answer_count": 1, "score": 1, "last_activity_date": 1576420916, "creation_date": 1576398006, "last_edit_date": 1576399241, "question_id": 59342263, "link": "https://stackoverflow.com/questions/59342263/getting-started-with-hspec-and-tasty-in-haskell", "title": "Getting started with HSpec and Tasty in Haskell?", "body": "<p>I'm new to Haskell and I'm trying to get <a href=\"https://hspec.github.io/\" rel=\"nofollow noreferrer\">hspec</a> working with <a href=\"https://hackage.haskell.org/package/tasty\" rel=\"nofollow noreferrer\">Tasty</a> (using <a href=\"https://hackage.haskell.org/package/tasty-hspec\" rel=\"nofollow noreferrer\">tasty-hspec</a>) with <a href=\"https://docs.haskellstack.org/\" rel=\"nofollow noreferrer\">Stack</a>. I've seen an <a href=\"https://github.com/feuerbach/tasty\" rel=\"nofollow noreferrer\">example</a> of using tasty with <a href=\"https://hackage.haskell.org/package/HUnit\" rel=\"nofollow noreferrer\">HUnit</a> which looks like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Test.Tasty\nimport Test.Tasty.SmallCheck as SC\nimport Test.Tasty.QuickCheck as QC\nimport Test.Tasty.HUnit\n\nimport Data.List\nimport Data.Ord\n\nmain = defaultMain tests\n\ntests :: TestTree\ntests = testGroup \"Tests\" [properties, unitTests]\n\nproperties :: TestTree\nproperties = testGroup \"Properties\" [scProps, qcProps]\n\nscProps = testGroup \"(checked by SmallCheck)\"\n  [ SC.testProperty \"sort == sort . reverse\" $\n      \\list -&gt; sort (list :: [Int]) == sort (reverse list)\n  , SC.testProperty \"Fermat's little theorem\" $\n      \\x -&gt; ((x :: Integer)^7 - x) `mod` 7 == 0\n  -- the following property does not hold\n  , SC.testProperty \"Fermat's last theorem\" $\n      \\x y z n -&gt;\n        (n :: Integer) &gt;= 3 SC.==&gt; x^n + y^n /= (z^n :: Integer)\n  ]\n\nqcProps = testGroup \"(checked by QuickCheck)\"\n  [ QC.testProperty \"sort == sort . reverse\" $\n      \\list -&gt; sort (list :: [Int]) == sort (reverse list)\n  , QC.testProperty \"Fermat's little theorem\" $\n      \\x -&gt; ((x :: Integer)^7 - x) `mod` 7 == 0\n  -- the following property does not hold\n  , QC.testProperty \"Fermat's last theorem\" $\n      \\x y z n -&gt;\n        (n :: Integer) &gt;= 3 QC.==&gt; x^n + y^n /= (z^n :: Integer)\n  ]\n\nunitTests = testGroup \"Unit tests\"\n  [ testCase \"List comparison (different length)\" $\n      [1, 2, 3] `compare` [1,2] @?= GT\n\n  -- the following test does not hold\n  , testCase \"List comparison (same length)\" $\n      [1, 2, 3] `compare` [1,2,2] @?= LT\n  ]\n</code></pre>\n\n<p>But instead of using hunit, smallcheck or quickcheck I'd like to use hspec. I've tried the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Spec where\n\nimport Game\n\nimport Test.Tasty\nimport Test.Tasty.Hspec\n\nspec_beats :: Spec\nspec_beats = do\n\n  it \"hello\" $\n    Rock `beats` Scissors `shouldBe` True\n\ntests :: TestTree\ntests = testGroup \"Tests\" [spec_beats]\n\nmain = defaultMain tests\n</code></pre>\n\n<p>But this doesn't compile:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018hspec-core-2.7.1:Test.Hspec.Core.Spec.Monad.SpecM\n                             () ()\u2019\n                     with \u2018TestTree\u2019\n      Expected type: TestTree\n        Actual type: Spec\n    \u2022 In the expression: spec_beats\n      In the second argument of \u2018testGroup\u2019, namely \u2018[spec_beats]\u2019\n      In the expression: testGroup \"Tests\" [spec_beats]\n   |        \n15 | tests = testGroup \"Tests\" [spec_beats]\n   |                            ^^^^^^^^^^\n</code></pre>\n\n<p>So my question is, how do I make my hspec example work with tasty?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576378439, "post_id": 59340468, "comment_id": 104879299, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/55133331/how-to-store-value-of-function-call-to-a-variable\">How to store value of function call to a variable</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11275316, "user_type": "registered", "profile_image": "https://graph.facebook.com/2551622511519097/picture?type=large", "display_name": "Ezequiel Barreira", "link": "https://stackoverflow.com/users/11275316/ezequiel-barreira"}, "edited": false, "score": 0, "creation_date": 1576407162, "post_id": 59340794, "comment_id": 104883437, "body": "That&#39;s right, thank you! I never thought to use the clause where, that serves just right, thanks again."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1576377148, "creation_date": 1576377148, "answer_id": 59340794, "question_id": 59340468, "link": "https://stackoverflow.com/questions/59340468/iterate-through-2-list-in-haskell/59340794#59340794", "title": "Iterate through 2 list in Haskell", "body": "<p>You can \"save\" something the way you are asking using a scope trick.  </p>\n\n<pre><code>funcaoFinal xs0 ys0 = funcaoFinal' xs0 ys0\n    where\n    funcaoFinal' [] [] = []\n    -- the rest of your implementation here\n</code></pre>\n\n<p><em>(Note that <code>'</code> is an identifier character so <code>funcaoFinal'</code> is a different name from <code>funcaoFinal</code>.)</em></p>\n\n<p>Now if you define <code>funcaoFinal'</code> the same recursive way, you will have access to the <code>xs0</code> and <code>ys0</code> bound as parameters in the outer function, which will be the original lists.</p>\n"}], "owner": {"reputation": 11, "user_id": 11275316, "user_type": "registered", "profile_image": "https://graph.facebook.com/2551622511519097/picture?type=large", "display_name": "Ezequiel Barreira", "link": "https://stackoverflow.com/users/11275316/ezequiel-barreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "closed_date": 1576378439, "answer_count": 1, "score": -1, "last_activity_date": 1576377148, "creation_date": 1576372214, "question_id": 59340468, "link": "https://stackoverflow.com/questions/59340468/iterate-through-2-list-in-haskell", "closed_reason": "Needs details or clarity", "title": "Iterate through 2 list in Haskell", "body": "<p>I'm stuck in an exercise, well, basically, if we are given 2 lists of Strings, we need to check both of them and see if the first list contains any value that equals the second list, if it does, save something on a list and then put it all in a list of Strings.</p>\n\n<p>I have this code:</p>\n\n<pre><code>funcaoFinal [] [] = []\nfuncaoFinal _ [] = []\nfuncaoFinal (x:xs) (y:ys)\n   | xs == [] = funcaoFinal (x:xs) ys\n   | raioVizinhanca x y = ((splitVirgula y) !! 2) : funcaoFinal (x:xs) ys\n   | otherwise = funcaoFinal xs (y:ys)\n</code></pre>\n\n<p>If  you are asking what <em>raioVizinhanca</em> does, it simply check one condition, it's not the problem. About <em>splitVirgula</em>, it just takes the thing we want to put in the list, don't make case of this functions.\nMy problem is this: I know ofc that this code/recursion does not do what we want, because it does not save the original list to be able to keep searching after xs == [] and i don't know how i could in Haskell save that list and iterate through it again, and i'm not seeing another possibility for this problem. Does anyone have any idea ? If you need some examples (in case you don't understand what it must do), just ask.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576359792, "post_id": 59339405, "comment_id": 104876393, "body": "Hint: use an <i>accumulator</i>."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576359840, "post_id": 59339405, "comment_id": 104876405, "body": "Where is an array here? <code>[]</code> is a linked list just like your <code>List</code> is."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576359887, "post_id": 59339405, "comment_id": 104876416, "body": "Hint: use recursion in the <code>Cons</code> case."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576360015, "post_id": 59339405, "comment_id": 104876448, "body": "I guess <code>Cons</code> here should be named <code>Snoc</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576360226, "post_id": 59339405, "comment_id": 104876499, "body": "@WillemVanOnsem Only if <code>last :: List a</code> is intended to be implemented as <code>last (Cons _ x) = x</code>."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "edited": false, "score": 0, "creation_date": 1576441520, "post_id": 59339434, "comment_id": 104891510, "body": "I passed &quot;go&quot; a List as a second argument, now it works as needed. A lot of thanks for step-by-step explanation. As to the reverse running, I grasp an obvious solution which turns around calling Cons value constructor throghout a list input."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 0, "last_activity_date": 1576359985, "creation_date": 1576359985, "answer_id": 59339434, "question_id": 59339405, "link": "https://stackoverflow.com/questions/59339405/make-list-from-a-custom-data-type-in-haskell-reverse-operation-also/59339434#59339434", "title": "Make list from a custom data type in Haskell (reverse operation also)", "body": "<p>You can make of an accumulator here. You define a helper function where you pass a value, and each recursive call, you pass a slighly modified copy of that value.</p>\n\n<p>Your <code>listToList</code> thus then will look like:</p>\n\n<pre><code>listToList :: List a -> [a]\nlistToList = go []\n    where go &hellip; = &hellip;</code></pre>\n\n<p>Here you still need to implement <code>go</code>. <code>go</code> has as signature <code>go :: [a] -&gt; List a -&gt; [a]</code>. In case you encounter a <code>Nil</code>, then you can return the accumulator. In case you encounter a <code>Cons x y</code>, you prepend the accumulator with <code>y</code> and recurse on <code>x</code>.</p>\n"}], "owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 59339434, "answer_count": 1, "score": 2, "last_activity_date": 1576359985, "creation_date": 1576359695, "question_id": 59339405, "link": "https://stackoverflow.com/questions/59339405/make-list-from-a-custom-data-type-in-haskell-reverse-operation-also", "title": "Make list from a custom data type in Haskell (reverse operation also)", "body": "<p>I'm going to learn how to convert a data type to an array using Haskell. That's a case as I need to get that from the data as follows:</p>\n\n<pre><code>data List a = Nil | Cons (List a) a\nlistToList :: List a -&gt; [a]\nlistToList Nil = []\nlistToList (Cons Nil a) = [a]\n...another pattern match, I guess...\n</code></pre>\n\n<p>What is missing here to complete this conversion without non-exhaustive matching (flatten may be)? I'm embarrassed a few because there is a lack of comprehension how to handle on. Also, I would be grateful for any prompt about a reverse function (from [a] to List a).          </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 5444193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FTDqnteOAMc/AAAAAAAAAAI/AAAAAAAAABY/CuwiGbvN3dM/photo.jpg?sz=128", "display_name": "Uncle Wab", "link": "https://stackoverflow.com/users/5444193/uncle-wab"}, "edited": false, "score": 0, "creation_date": 1576356842, "post_id": 59339033, "comment_id": 104875800, "body": "Am I missing a pattern then or something? Im really struggling to see"}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "reply_to_user": {"reputation": 31, "user_id": 5444193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FTDqnteOAMc/AAAAAAAAAAI/AAAAAAAAABY/CuwiGbvN3dM/photo.jpg?sz=128", "display_name": "Uncle Wab", "link": "https://stackoverflow.com/users/5444193/uncle-wab"}, "edited": false, "score": 0, "creation_date": 1576357107, "post_id": 59339033, "comment_id": 104875842, "body": "@UncleWab, depends on why you&#39;re expecting this output and what you&#39;re trying to do. Why should this expression be bracketed like that? What&#39;s the rule?"}, {"owner": {"reputation": 31, "user_id": 5444193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FTDqnteOAMc/AAAAAAAAAAI/AAAAAAAAABY/CuwiGbvN3dM/photo.jpg?sz=128", "display_name": "Uncle Wab", "link": "https://stackoverflow.com/users/5444193/uncle-wab"}, "edited": false, "score": 0, "creation_date": 1576357243, "post_id": 59339033, "comment_id": 104875871, "body": "It&#39;s lambda calculus, so:  \u03bbx \u2192 y z =  \u03bbx \u2192 (y z) and  x y z = (x y) z and  \u03bbx \u2192 \u03bby \u2192 y x = \u03bbx \u2192 \u03bby \u2192 (y x)  these are the general rules"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 31, "user_id": 5444193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FTDqnteOAMc/AAAAAAAAAAI/AAAAAAAAABY/CuwiGbvN3dM/photo.jpg?sz=128", "display_name": "Uncle Wab", "link": "https://stackoverflow.com/users/5444193/uncle-wab"}, "edited": false, "score": 0, "creation_date": 1576365066, "post_id": 59339033, "comment_id": 104877462, "body": "@UncleWab Which of the pattern matches in your code do you think should match <code>LamApp (LamAbs 1 (LamVar 1)) (LamAbs 1 (LamVar 1))</code> (the 1st one, the 2nd one, etc)?"}], "tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": false, "score": 1, "last_activity_date": 1576356644, "creation_date": 1576356644, "answer_id": 59339033, "question_id": 59338968, "link": "https://stackoverflow.com/questions/59338968/printing-lambda-expressions-in-haskell/59339033#59339033", "title": "Printing lambda expressions in haskell", "body": "<p>The data structure in the call to <code>printLambda</code> is <code>LamApp LamAbs(...) LamAbs(...)</code>. Let's see why the patterns in the function don't match that:</p>\n\n<ul>\n<li><code>LamApp (LamAbs x f) (LamApp g h)</code> doesn't match because you have <code>LamAbs</code>, not <code>LamApp</code> as the <em>second</em> argument</li>\n<li><code>LamApp m (LamApp f g)</code> doesn't match for the same reason</li>\n<li><code>LamApp (LamApp f g) m</code> doesn't match because you have <code>LamAbs</code>, not <code>LamApp</code> as the <em>first</em> argument</li>\n<li>finally, <code>LamApp m n</code> matches any <code>LamApp</code> and outputs two <code>LamApp</code>s that aren't enclosed in parentheses</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1576365132, "creation_date": 1576365132, "answer_id": 59339961, "question_id": 59338968, "link": "https://stackoverflow.com/questions/59338968/printing-lambda-expressions-in-haskell/59339961#59339961", "title": "Printing lambda expressions in haskell", "body": "<p>The more common way to do this (note that the <code>Show</code> class also works like this) is to add an extra argument to <code>printLambda</code> that tells you the precedence context.</p>\n\n<pre><code>data Prec = Free | Fun | Arg deriving (Eq, Ord)\nprintLambda :: Prec -&gt; LamExpr -&gt; String\n</code></pre>\n\n<p>In a <code>Free</code> context, there is no danger of the term being \"torn apart\" by an operation of higher precedence, so no parentheses are needed. The top level of the term is printed in a <code>Free</code> context, and the body of every lambda abstraction is also <code>Free</code>. The <code>Fun</code> context appears on the left of an application. Here, any lambda expression must be parenthesized, or else it will \"absorb\" the argument (<code>(\\x1 -&gt; x1) x2</code> becomes <code>\\x1 -&gt; x1 x2</code>). Applications are fine, though, since they are left associative (<code>(f x) y</code> becomes <code>f x y</code> stays <code>(f x) y</code>). The <code>Arg</code> context is the strictest. You can't have a lambda expression, or else it will consume anything on its right (<code>f (\\x1 -&gt; x1) x2)</code> becomes <code>f \\x1 -&gt; x1 x2</code>). You can't have an application, or it will be shredded (<code>f (g x)</code> becomes <code>f g x</code> becomes <code>(f g) x</code>).</p>\n\n<p>This helper function conditionally adds parentheses (see built in <code>showParen</code>):</p>\n\n<pre><code>parens :: Bool -&gt; String -&gt; String\nparens True s = \"(\" ++ s ++ \")\"\nparens False s = s\n</code></pre>\n\n<p>And this makes everything much easier:</p>\n\n<pre><code>printLambda _ (LamVar i) = \"x\" ++ show i\nprintLambda p (LamAbs i b) = parens (p &gt; Free) $ \"\\\\x\" ++ show i ++ \" -&gt; \" ++ printLambda Free b\nprintLambda p (LamApp f x) = parens (p &gt; Fun) $ printLambda Fun f ++ \" \" ++ printLambda Arg x\n</code></pre>\n\n<p>For your example, this produces <code>(\\x1 -&gt; x1) (\\x1 -&gt; x1)</code>. The output <code>(\\x1 -&gt; x1) \\x1 -&gt; x1</code>, as asked, is generally considered incorrect. It's not ambiguous, but adding stuff to its right implies adding parentheses <em>in</em>side the term, which is weird. You could implement it with a new <code>Prec</code> called <code>Block</code> (the name is because GHC calls this syntax <code>BlockArguments</code>)</p>\n\n<pre><code>data Prec = Free | Fun | Arg | Block deriving (Eq, Ord)\n</code></pre>\n\n<p>that replaces <code>Arg</code>s directly under <code>Free</code>:</p>\n\n<pre><code>printLambda _ (LamVar i) = \"x\" ++ show i\nprintLambda p (LamAbs i b) = parens (p &gt; Free &amp;&amp; p /= Block) $ \"\\\\x\" ++ show i ++ \" -&gt; \" ++ printLambda Free b\nprintLambda p (LamApp f x) = parens (p &gt; Fun) $ printLambda Fun f ++ \" \" ++ printLambda arg x\n  where arg = if p &gt; Free then Arg else Block\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 5444193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FTDqnteOAMc/AAAAAAAAAAI/AAAAAAAAABY/CuwiGbvN3dM/photo.jpg?sz=128", "display_name": "Uncle Wab", "link": "https://stackoverflow.com/users/5444193/uncle-wab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576365132, "creation_date": 1576356016, "question_id": 59338968, "link": "https://stackoverflow.com/questions/59338968/printing-lambda-expressions-in-haskell", "title": "Printing lambda expressions in haskell", "body": "<p>I'm trying to pretty print a Lambda Expression of the following type</p>\n\n<p><code>data LamExpr = LamApp LamExpr LamExpr  |  LamAbs Int LamExpr  |  LamVar Int deriving (Show, Eq)</code></p>\n\n<p>I think I made some logic errors with my pattern matching, it's bracketing things incorrectly and I'm unsure why. I've tried adding more cases but I think that overcomplicates things.</p>\n\n<pre><code>printLambda :: LamExpr -&gt; String\nprintLambda (LamAbs x f)                            = printf \"\\\\x%d -&gt; %s\" x (printLambda f)\nprintLambda (LamVar x)                              = printf \"x%d\" x\nprintLambda (LamApp (LamAbs x f) (LamApp g h))      = printf \"(%s) (%s)\" (printLambda (LamAbs x f)) (printLambda (LamApp g h))\nprintLambda (LamApp m (LamApp f g))                 = printf \"%s (%s)\" (printLambda m) (printLambda (LamApp f g))\nprintLambda (LamApp (LamApp f g) m)                 = printf \"(%s) %s\" (printLambda (LamApp f g)) (printLambda m) \nprintLambda (LamApp m n)                            = printf \"%s %s\" (printLambda m) (printLambda n) \n</code></pre>\n\n<p>Example case:</p>\n\n<p><code>printLambda (LamApp (LamAbs 1 (LamVar 1)) (LamAbs 1 (LamVar 1))) == \"(\\\\x1 -&gt; x1) \\\\x1 -&gt; x1\"</code></p>\n\n<p>Instead I get this:</p>\n\n<p><code>\"\\\\x1 -&gt; x1 \\\\x1 -&gt; x1\"</code></p>\n"}, {"tags": ["haskell", "functional-programming", "currying"], "answers": [{"tags": [], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "is_accepted": true, "score": 2, "last_activity_date": 1577012773, "last_edit_date": 1577012773, "creation_date": 1576352741, "answer_id": 59338560, "question_id": 59338559, "link": "https://stackoverflow.com/questions/59338559/unary-predicate-to-check-for-a-character-being-in-string/59338560#59338560", "title": "Unary predicate to check for a character being in string", "body": "<p>As soon as I looked for the link in the question and visited it (for the first time), I realized that the code chunks are commented by readers, and the first comment under <code>splitLines</code> reads:</p>\n\n<blockquote>\n  <p>augustss 2008-04-23</p>\n  \n  <p>[...] If you're making a point about functional\n  style maybe you should use</p>\n\n<pre><code>isLineSeparator = (`elem` \"\\r\\n\")\n</code></pre>\n</blockquote>\n\n<p>So it comes out I was thinking to much about composition of functions, while the easiest solution lies in the partial application of a so simple function, <code>elem</code>. The drawback here is that the operator used to check for equality is built in <code>elem</code> and cannot be changed. Nonetheless I feel dumb for not having thought to <code>elem</code> myself.</p>\n"}], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 59338560, "answer_count": 1, "score": 2, "last_activity_date": 1577012773, "creation_date": 1576352741, "last_edit_date": 1577012738, "question_id": 59338559, "link": "https://stackoverflow.com/questions/59338559/unary-predicate-to-check-for-a-character-being-in-string", "title": "Unary predicate to check for a character being in string", "body": "<p>I'm reading <a href=\"http://book.realworldhaskell.org/\" rel=\"nofollow noreferrer\"><em>Real World Haskell</em></a>, and I tried to implement the <code>splitLines</code> code myself, and I came up with more or less the same implementation (<a href=\"http://book.realworldhaskell.org/read/functional-programming.html\" rel=\"nofollow noreferrer\">Chapter 4</a>, page 73):</p>\n\n<pre><code>splitLines :: String -&gt; [String]\nsplitLines [] = []\nsplitLines ('\\r':a) = splitLines a\nsplitLines ('\\n':a) = splitLines a\nsplitLines       a  = let (l,r) = break isCRorNL a\n                      in l:splitLines r\n                      where isCRorNL e = ???\n--the book defines isCRorNL c = c == '\\n' || c == '\\r'\n</code></pre>\n\n<p>However, I've been spending definitely too much time trying to write the <code>isCRorNL</code> in the most functional and readable way I could think of, so that I can get rid of the <code>where</code> and turning the last definition of <code>splitLines</code> into an amost-english sentence (just like <code>compare `on` length</code> and the likes), without success.</p>\n\n<p>Some sparse thoughts I have been going through:</p>\n\n<ul>\n<li>A lambda, <code>(\\c -&gt; c == '\\n' || c == '\\r')</code>, is just too much power and too little expressiveness for such a simple and specific task;</li>\n<li>furthermore, it contains a fair amount of duplicated code and/or it is uselessly verbose.</li>\n<li>Whatever I have to put in <code>isCRorNL</code> has to have type <code>Char -&gt; Bool</code>,</li>\n<li>therefore it can have any type <code>a1 -&gt; a2 -&gt; ... -&gt; an -&gt; Char -&gt; Bool</code> if I provide it with the first <code>n</code> arguments.</li>\n<li>The <code>any</code> function can help me checking if a <em>given</em> character is either <code>'\\n'</code> or <code>'\\r'</code> or, in other words, if it is in the list of <code>Char</code>s <code>\"\\n\\r\"</code>.</li>\n<li>Since I want to check for equality, I can pass <code>(==)</code> to my function.</li>\n<li>Therefore <code>isCRorNL</code> can have type <code>(Char -&gt; Char -&gt; Bool) -&gt; [Char] -&gt; Char -&gt; Bool</code> (or with the first two argument inverted), and I can pass to it <code>(==)</code> as the first argument and <code>\"\\n\\r\"</code> as the second argument.</li>\n<li>So I was looking for some standard functions I could compose to get such a function.</li>\n</ul>\n\n<p>Finally I gave up and defined it this way: <code>isCRorNL e = any (== e) \"\\n\\r\"</code>; I think this is quite good as regards extensibility, as I can add as many characters in the <code>\"\u2026\"</code>, and I can change the operator <code>==</code>; sadly I cannot put the function directly where it is used, as I am not able to write it as a partially applied function. </p>\n\n<p>How would you do it?</p>\n"}, {"tags": ["haskell", "functional-programming", "primes", "primality-test"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 3, "creation_date": 1576350104, "post_id": 59338196, "comment_id": 104874202, "body": "What does <code>ld</code> stand for? It&#39;s not the logarithmus dualis. So: use proper descriptive names for your functions."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 3, "creation_date": 1576350218, "post_id": 59338196, "comment_id": 104874226, "body": "No, this is not a particularly efficient method. There are <a href=\"https://en.wikipedia.org/wiki/Prime_number#Computational_methods\" rel=\"nofollow noreferrer\">many better approaches</a>."}], "answers": [{"comments": [{"owner": {"reputation": 275, "user_id": 9759263, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7q0lz.jpg?s=128&g=1", "display_name": "F. Zer", "link": "https://stackoverflow.com/users/9759263/f-zer"}, "edited": false, "score": 0, "creation_date": 1577379831, "post_id": 59447548, "comment_id": 105156873, "body": "Thank you. Could you explain a little what&#39;s the purpose of this comparison <code>[n] == take 1</code>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 275, "user_id": 9759263, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7q0lz.jpg?s=128&g=1", "display_name": "F. Zer", "link": "https://stackoverflow.com/users/9759263/f-zer"}, "edited": false, "score": 0, "creation_date": 1577380883, "post_id": 59447548, "comment_id": 105157273, "body": "I&#39;ve added this to the answer. and you&#39;re very welcome. :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1577380569, "last_edit_date": 1577380569, "creation_date": 1577043982, "answer_id": 59447548, "question_id": 59338196, "link": "https://stackoverflow.com/questions/59338196/writing-an-isprime-function-in-haskell/59447548#59447548", "title": "Writing an isPrime function in Haskell", "body": "<p>It is too operational. It can be equivalently expressed<sup>(*)</sup> as</p>\n\n<pre><code>isPrime :: Integer -&gt; Bool\nisPrime n  =  [n] == take 1 [i | i &lt;- [2..n], mod n i == 0]\n</code></pre>\n\n<p>so it is more visually apparent and immediately clear, a <a href=\"https://wiki.haskell.org/Prime_numbers_miscellaneous#One-liners\" rel=\"nofollow noreferrer\">one-liner</a> easier to deal with.</p>\n\n<p>Trying it as</p>\n\n<pre><code>GHCi&gt; zipWith (-) =&lt;&lt; tail $ filter isPrime [2..]\n[1,2,2,4,2,4,2,4,6,2,6,4,2,4,6,6,2,6,4,2,6,4,6,8,4,2,4,2,4,14,4,6,2,10,2,6,6,4,6,6,2,10,2,4,2,12,12,\n4,2,4,6,2,10,6,6,6,2,6,4,2,10,14,4,2,4,14,6,10,2,4,6,8,6,6,4,6,8,4,8,10,2,10,2,6,4,6,8,4,2,4,12,8,4,\n8,4,6,12,2,18,6,10,6,6,2,6,10,6,6,2,6,6,4,2,12,10,2,4,6,6,2,12,4,6,8,10,8,10,8,6,6,4,8,6,4,8,4,14,10\n......\n</code></pre>\n\n<p>reveals how slow it is. We could try re-writing it as</p>\n\n<pre><code>isPrime n  =  null [i | i &lt;- [2..n-1], mod n i == 0]\n           =  none (\\ i -&gt; mod n i==0) [2..n-1]\n           =  all (\\ i -&gt; mod n i &gt; 0) [2..n-1]\n           =  and  [mod n i &gt; 0 | i &lt;- [2..n-1]]\n</code></pre>\n\n<p>but <code>[2..n-1]</code> is not <em>that</em> much shorter than <code>[2..n]</code>, isn't it. It should be much <em>much</em> shorter, ending <em>much</em> earlier than that; and even shorter still, with lots of <em>holes</em> in it...</p>\n\n<blockquote class=\"spoiler\">\n  <p> <code>isPrime n  =  and [mod n p &gt; 0 | p &lt;- takeWhile (\\p -&gt; p^2 &lt;= n) primes]</code><br />\n <code>primes     =  2 : filter isPrime [3..]</code></p>\n</blockquote>\n\n<p>And the next improvement after that is, <a href=\"https://wiki.haskell.org/Prime_numbers\" rel=\"nofollow noreferrer\">getting rid of <code>mod</code></a> altogether.</p>\n\n<hr>\n\n<p><sup>(*) this expresses exactly the same computation action as your <code>leastDivisor n == n</code> is doing. <code>take 1</code> takes just the first of the number's divisors, as a list; its length is necessarily 1; comparing it with the one-element list <code>[n]</code> is then equivalent to comparing the first - i.e. smallest - divisor with the number <code>n</code>. Just what your code is doing. </sup></p>\n\n<p><sup>But in this form, it is (arguably) a clearer code, more visually apparent. At least for me it is so. :)</sup></p>\n"}], "owner": {"reputation": 275, "user_id": 9759263, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7q0lz.jpg?s=128&g=1", "display_name": "F. Zer", "link": "https://stackoverflow.com/users/9759263/f-zer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 1, "accepted_answer_id": 59447548, "answer_count": 1, "score": 0, "last_activity_date": 1577380569, "creation_date": 1576349696, "last_edit_date": 1577041305, "question_id": 59338196, "link": "https://stackoverflow.com/questions/59338196/writing-an-isprime-function-in-haskell", "title": "Writing an isPrime function in Haskell", "body": "<pre class=\"lang-hs prettyprint-override\"><code>isPrime :: Int -&gt; Bool\nisPrime n = leastDivisor n == n\n\nleastDivisor :: Int -&gt; Int \nleastDivisor n = leastDivisorFrom 2 n\n\nleastDivisorFrom :: Int -&gt; Int -&gt; Int\nleastDivisorFrom k n | n `mod` k == 0 = k\n                     | otherwise      = leastDivisorFrom (k + 1) n\n</code></pre>\n\n<p>My question would be: </p>\n\n<ul>\n<li>What design problems does this function have?</li>\n</ul>\n"}, {"tags": ["haskell", "lazy-evaluation", "dry"], "answers": [{"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576350278, "post_id": 59338239, "comment_id": 104874239, "body": "Because that&#39;s an incomplete pattern match. Even if my function is a whole is total, I don&#39;t like pieces of it being partial."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576350565, "post_id": 59338239, "comment_id": 104874318, "body": "So you said &quot;we know for sure&quot; still with some doubt. Perhaps that is healthy."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576350640, "post_id": 59338239, "comment_id": 104874335, "body": "We do know for sure, given that my second code block in my question always returns <code>Just</code> yet is total. I know that your solution as written is in fact total, but it&#39;s brittle in that a seemingly-safe modification could then result in it bottoming."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576363873, "post_id": 59338239, "comment_id": 104877217, "body": "This will also slightly slow down the program, as GHC can&#39;t prove that it will always be <code>Just</code>, so it will add a test to make sure it&#39;s not <code>Nothing</code> every time it recurses through."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1576350024, "creation_date": 1576350024, "answer_id": 59338239, "question_id": 59337499, "link": "https://stackoverflow.com/questions/59337499/how-do-i-make-this-algorithm-lazier-without-repeating-myself/59338239#59338239", "title": "How do I make this algorithm lazier without repeating myself?", "body": "<p>How about </p>\n\n<pre><code>GT -&gt; let Just v = precise (Just (k,v) r) in Just v\n</code></pre>\n\n<p>?</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1576439567, "post_id": 59338785, "comment_id": 104891025, "body": "Are all those <code>id</code>s in the middle between <code>Just</code> and the final <code>(k,v)</code> eliminated by the compiler? probably not, functions are supposed to be opaque, and you could&#39;ve (type-feasibly) used <code>first (1+)</code> instead of <code>id</code> for all the compiler knows. but it makes for a <i>compact</i> code... of course, my code is the unraveling and specification of yours here, with the additional simplification (the elimination of the <code>id</code>s). also very interesting how the more general type serves as a constraint, a relation between the values involved (not tight enough though, with <code>first (1+)</code> being allowed as <code>wrap</code>)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1576440543, "post_id": 59338785, "comment_id": 104891280, "body": "(contd.) your polymorphic <code>precise</code> is used at two types, directly corresponding to the two specialized functions used in the more verbose variant. nice interplay there. Also, I wouldn&#39;t call this CPS, <code>wrap</code> isn&#39;t used as a continuation, it&#39;s not built up &quot;on the inside&quot;, it&#39;s stacked - by recursion - on the outside. Maybe if it <i>were</i> used as continuation you could get rid of those extraneous <code>id</code>s... btw we can see here once again that old pattern of functional argument used as indicator of what to do, switching between the two courses of action (<code>Just</code> or <code>id</code>)."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1576354624, "creation_date": 1576354624, "answer_id": 59338785, "question_id": 59337499, "link": "https://stackoverflow.com/questions/59337499/how-do-i-make-this-algorithm-lazier-without-repeating-myself/59338785#59338785", "title": "How do I make this algorithm lazier without repeating myself?", "body": "<p>Starting from my non-lazy implementation, I first refactored <code>precise</code> to receive <code>Just</code> as an argument, and generalized its type accordingly:</p>\n\n<pre><code>data TreeMap v = Leaf | Node Integer v (TreeMap v) (TreeMap v) deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess i = precise Just Nothing where\n  precise :: ((Integer, v) -&gt; t) -&gt; t -&gt; TreeMap v -&gt; t\n  precise _ closestSoFar Leaf = closestSoFar\n  precise wrap closestSoFar (Node k v l r) = case i `compare` k of\n    LT -&gt; precise wrap closestSoFar l\n    EQ -&gt; wrap (k, v)\n    GT -&gt; precise wrap (wrap (k, v)) r\n</code></pre>\n\n<p>Then, I changed it to do <code>wrap</code> early and call itself with <code>id</code> in the <code>GT</code> case:</p>\n\n<pre><code>data TreeMap v = Leaf | Node Integer v (TreeMap v) (TreeMap v) deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess i = precise Just Nothing where\n  precise :: ((Integer, v) -&gt; t) -&gt; t -&gt; TreeMap v -&gt; t\n  precise _ closestSoFar Leaf = closestSoFar\n  precise wrap closestSoFar (Node k v l r) = case i `compare` k of\n    LT -&gt; precise wrap closestSoFar l\n    EQ -&gt; wrap (k, v)\n    GT -&gt; wrap (precise id (k, v) r)\n</code></pre>\n\n<p>This still works exactly as before, except for the benefit of the added laziness.</p>\n"}, {"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576371094, "post_id": 59339329, "comment_id": 104878393, "body": "I didn&#39;t think of my answer as CPS until you pointed it out. I was thinking of something closer to a worker-wrapper transform. I guess <a href=\"https://devblogs.microsoft.com/oldnewthing/20140414-01/?p=1253\" rel=\"nofollow noreferrer\">Raymond Chen strikes again!</a>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1576423583, "last_edit_date": 1576423583, "creation_date": 1576359066, "answer_id": 59339329, "question_id": 59337499, "link": "https://stackoverflow.com/questions/59337499/how-do-i-make-this-algorithm-lazier-without-repeating-myself/59339329#59339329", "title": "How do I make this algorithm lazier without repeating myself?", "body": "<p>I think the CPS version you answered with yourself is the best but for completeness here are a few more ideas. (EDIT: Buhr's answer is now the most performant.)</p>\n\n<p>The first idea is to get rid of the \"<code>closestSoFar</code>\" accumulator, and instead let the <code>GT</code> case handle all the logic of picking the rightmost value smallest than the argument. In this form, the <code>GT</code> case can directly return a <code>Just</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>closestLess1 :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess1 _ Leaf = Nothing\nclosestLess1 i (Node k v l r) =\n  case i `compare` k of\n    LT -&gt; closestLess1 i l\n    EQ -&gt; Just (k, v)\n    GT -&gt; Just (fromMaybe (k, v) (closestLess1 i r))\n</code></pre>\n\n<p>This is simpler, but takes a bit more space on the stack when you hit a lot of <code>GT</code> cases. Technically you could even use that <code>fromMaybe</code> in the accumulator form (i.e., replacing the <code>fromJust</code> implicit in luqui's answer), but that would be a redundant, unreachable branch.</p>\n\n<p>The other idea that there's really two \"phases\" of the algorithm, one before and one after you hit a <code>GT</code>, so you parameterize it by a boolean to represent these two phases, and use dependent types to encode the invariant that there will always be a result in the second phase.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data SBool (b :: Bool) where\n  STrue :: SBool 'True\n  SFalse :: SBool 'False\n\ntype family MaybeUnless (b :: Bool) a where\n  MaybeUnless 'True a = a\n  MaybeUnless 'False a = Maybe a\n\nret :: SBool b -&gt; a -&gt; MaybeUnless b a\nret SFalse = Just\nret STrue = id\n\nclosestLess2 :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess2 i = precise SFalse Nothing where\n  precise :: SBool b -&gt; MaybeUnless b (Integer, v) -&gt; TreeMap v -&gt; MaybeUnless b (Integer, v)\n  precise _ closestSoFar Leaf = closestSoFar\n  precise b closestSoFar (Node k v l r) = case i `compare` k of\n    LT -&gt; precise b closestSoFar l\n    EQ -&gt; ret b (k, v)\n    GT -&gt; ret b (precise STrue (k, v) r)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1576362189, "creation_date": 1576362189, "answer_id": 59339656, "question_id": 59337499, "link": "https://stackoverflow.com/questions/59337499/how-do-i-make-this-algorithm-lazier-without-repeating-myself/59339656#59339656", "title": "How do I make this algorithm lazier without repeating myself?", "body": "<p>Rather than use explicit wrappers, you can leverage the type system.  Note that the version of  <code>precise</code> that uses <code>Maybe</code> for your first code snippet:</p>\n\n<pre><code>precise :: Maybe (Integer, v) -&gt; TreeMap v -&gt; Maybe (Integer, v)\nprecise closestSoFar Leaf = closestSoFar\nprecise closestSoFar (Node k v l r) = case i `compare` k of\n  LT -&gt; precise closestSoFar l\n  EQ -&gt; Just (k, v)\n  GT -&gt; precise (Just (k, v)) r\n</code></pre>\n\n<p>is almost exactly the same algorithm as the version of <code>precise</code> without <code>Maybe</code> from your second code snippet, which could be written in the <code>Identity</code> functor as:</p>\n\n<pre><code>precise :: Identity (Integer, v) -&gt; TreeMap v -&gt; Identity (Integer, v)\nprecise closestSoFar Leaf = closestSoFar\nprecise closestSoFar (Node k v l r) = case i `compare` k of\n  LT -&gt; precise closestSoFar l\n  EQ -&gt; Identity (k, v)\n  GT -&gt; precise (Identity (k, v)) r\n</code></pre>\n\n<p>These can be unified into a version polymorphic in the <code>Applicative</code>:</p>\n\n<pre><code>precise :: (Applicative f) =&gt; f (Integer, v) -&gt; TreeMap v -&gt; f (Integer, v)\nprecise closestSoFar Leaf = closestSoFar\nprecise closestSoFar (Node k v l r) = case i `compare` k of\n  LT -&gt; precise closestSoFar l\n  EQ -&gt; pure (k, v)\n  GT -&gt; precise (pure (k, v)) r\n</code></pre>\n\n<p>By itself, that doesn't accomplish much, but if we know that the <code>GT</code> branch will always return a value, we can force it to run in the <code>Identity</code> functor, regardless of the starting functor.  That is, we can start in the <code>Maybe</code> functor but recurse into the <code>Identity</code> functor in the <code>GT</code> branch:</p>\n\n<pre><code>closestLess :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess i = precise Nothing\n  where\n    precise :: (Applicative t) =&gt; t (Integer, v) -&gt; TreeMap v -&gt; t (Integer, v)\n    precise closestSoFar Leaf = closestSoFar\n    precise closestSoFar (Node k v l r) = case i `compare` k of\n      LT -&gt; precise closestSoFar l\n      EQ -&gt; pure (k, v)\n      GT -&gt; pure . runIdentity $ precise (Identity (k, v)) r\n</code></pre>\n\n<p>This works fine with your test case:</p>\n\n<pre><code>&gt; isJust $ closestLess 5 (Node 3 () Leaf undefined)\nTrue\n</code></pre>\n\n<p>and is a nice example of polymorphic recursion.</p>\n\n<p>Another nice thing about this approach from a performance point of view is that the <code>-ddump-simpl</code> shows that there are no wrappers or dictionaries.  It's all been erased at the type level with specialized functions for the two functors:</p>\n\n<pre><code>closestLess\n  = \\ @ v i eta -&gt;\n      letrec {\n        $sprecise\n        $sprecise\n          = \\ @ v1 closestSoFar ds -&gt;\n              case ds of {\n                Leaf -&gt; closestSoFar;\n                Node k v2 l r -&gt;\n                  case compareInteger i k of {\n                    LT -&gt; $sprecise closestSoFar l;\n                    EQ -&gt; (k, v2) `cast` &lt;Co:5&gt;;\n                    GT -&gt; $sprecise ((k, v2) `cast` &lt;Co:5&gt;) r\n                  }\n              }; } in\n      letrec {\n        $sprecise1\n        $sprecise1\n          = \\ @ v1 closestSoFar ds -&gt;\n              case ds of {\n                Leaf -&gt; closestSoFar;\n                Node k v2 l r -&gt;\n                  case compareInteger i k of {\n                    LT -&gt; $sprecise1 closestSoFar l;\n                    EQ -&gt; Just (k, v2);\n                    GT -&gt; Just (($sprecise ((k, v2) `cast` &lt;Co:5&gt;) r) `cast` &lt;Co:4&gt;)\n                  }\n              }; } in\n      $sprecise1 Nothing eta\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1576409417, "creation_date": 1576409417, "answer_id": 59343454, "question_id": 59337499, "link": "https://stackoverflow.com/questions/59337499/how-do-i-make-this-algorithm-lazier-without-repeating-myself/59343454#59343454", "title": "How do I make this algorithm lazier without repeating myself?", "body": "<p>Not only do we always know <code>Just</code>, <em>after</em> its first discovery, we also always know <code>Nothing</code> <em>until</em> then. That's actually two different \"logics\".</p>\n\n<p>So, we go left first of all, so make <em>that</em> explicit:</p>\n\n<pre><code>data TreeMap v = Leaf | Node Integer v (TreeMap v) (TreeMap v) \n                 deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer \n            -&gt; TreeMap v \n            -&gt; Maybe (Integer, v)\nclosestLess i = goLeft \n  where\n  goLeft :: TreeMap v -&gt; Maybe (Integer, v)\n  goLeft n@(Node k v l _) = case i `compare` k of\n          LT -&gt; goLeft l\n          _  -&gt; Just (precise (k, v) n)\n  goLeft Leaf = Nothing\n\n  -- no more maybe if we're here\n  precise :: (Integer, v) -&gt; TreeMap v -&gt; (Integer, v)\n  precise closestSoFar Leaf           = closestSoFar\n  precise closestSoFar (Node k v l r) = case i `compare` k of\n        LT -&gt; precise closestSoFar l\n        EQ -&gt; (k, v)\n        GT -&gt; precise (k, v) r\n</code></pre>\n\n<p>The price is we repeat at most <em>one</em> step at most once.</p>\n"}], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 59339656, "answer_count": 5, "score": 9, "last_activity_date": 1576423583, "creation_date": 1576344574, "question_id": 59337499, "link": "https://stackoverflow.com/questions/59337499/how-do-i-make-this-algorithm-lazier-without-repeating-myself", "title": "How do I make this algorithm lazier without repeating myself?", "body": "<p>(Inspired by my answer to <a href=\"https://stackoverflow.com/q/59336641/7509065\">this question</a>.)</p>\n\n<p>Consider this code (it's supposed to find the largest element that's less than or equal to a given input):</p>\n\n<pre><code>data TreeMap v = Leaf | Node Integer v (TreeMap v) (TreeMap v) deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess i = precise Nothing where\n  precise :: Maybe (Integer, v) -&gt; TreeMap v -&gt; Maybe (Integer, v)\n  precise closestSoFar Leaf = closestSoFar\n  precise closestSoFar (Node k v l r) = case i `compare` k of\n    LT -&gt; precise closestSoFar l\n    EQ -&gt; Just (k, v)\n    GT -&gt; precise (Just (k, v)) r\n</code></pre>\n\n<p>This isn't very lazy. Once the <code>GT</code> case is entered, we know for sure that the final return value will be <code>Just</code> something rather than <code>Nothing</code>, but the <code>Just</code> still isn't available until the end. I'd like to make this lazier so that the <code>Just</code> is available as soon as the <code>GT</code> case is entered. My test case for this is that I want <code>Data.Maybe.isJust $ closestLess 5 (Node 3 () Leaf undefined)</code> to evaluate to <code>True</code> rather than bottoming. Here's one way I can think to do this:</p>\n\n<pre><code>data TreeMap v = Leaf | Node Integer v (TreeMap v) (TreeMap v) deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess _ Leaf = Nothing\nclosestLess i (Node k v l r) = case i `compare` k of\n  LT -&gt; closestLess i l\n  EQ -&gt; Just (k, v)\n  GT -&gt; Just (precise (k, v) r)\n  where\n    precise :: (Integer, v) -&gt; TreeMap v -&gt; (Integer, v)\n    precise closestSoFar Leaf = closestSoFar\n    precise closestSoFar (Node k v l r) = case i `compare` k of\n      LT -&gt; precise closestSoFar l\n      EQ -&gt; (k, v)\n      GT -&gt; precise (k, v) r\n</code></pre>\n\n<p>However, I'm now repeating myself: the core logic is now in both <code>closestLess</code> and in <code>precise</code>. How can I write this so that it's lazy but without repeating myself?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576343584, "post_id": 59337358, "comment_id": 104872449, "body": "I&#39;m not sure if your problem is the fact that you want to restrict the generation of objects, <i>or</i> if you want to add a &quot;getter&quot; <code>x</code> to <code>EmptyPoint</code>."}, {"owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576343789, "post_id": 59337358, "comment_id": 104872503, "body": "@WillemVanOnsem I suppose quickcheck generates random data for type Point. What I want is that it does not generate EmptyPoint"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576343904, "post_id": 59337358, "comment_id": 104872537, "body": "Well you need to make <code>Point</code> an instance of <code>Arbitrary</code>. So that means that you can specify how to generate arbitrary <code>Point</code>s exactly how you want that to happen."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 5, "last_activity_date": 1576343955, "creation_date": 1576343955, "answer_id": 59337425, "question_id": 59337358, "link": "https://stackoverflow.com/questions/59337358/quickcheck-limit-to-only-certain-data-constructor/59337425#59337425", "title": "QuickCheck limit to only certain data constructor", "body": "<p>Instead of automatically deriving the <code>Arbitrary</code> class for your type (which is what, I assume, you're doing at the moment), you can just write one manually and make it generate your points however you want, for example:</p>\n\n<pre><code>instance Arbitrary Point where\n    arbitrary = Point &lt;$&gt; arbitrary &lt;*&gt; arbitrary\n</code></pre>\n\n<p>Or in a slightly more verbose way if you like:</p>\n\n<pre><code>instance Arbitrary Point where\n    arbitrary = do\n        x &lt;- arbitrary\n        y &lt;- arbitrary\n        pure Point { x, y }\n</code></pre>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 59337425, "answer_count": 1, "score": 2, "last_activity_date": 1576343955, "creation_date": 1576343511, "last_edit_date": 1576343828, "question_id": 59337358, "link": "https://stackoverflow.com/questions/59337358/quickcheck-limit-to-only-certain-data-constructor", "title": "QuickCheck limit to only certain data constructor", "body": "<p>I have a data type definition:</p>\n\n<pre><code>data Point = Point {x :: Int, h :: Int} | EmptyPoint\n</code></pre>\n\n<p>In my property test, I would like to limit the test only on the Point constructor cases. For example point1 - point2 = Point 0 0. This presumes that the accessor <code>x</code> is defined which is not the case with EmptyPoint.</p>\n\n<p>in other words: I don't want EmptyPoint to be generated.</p>\n\n<p>Is there a way to do that?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576343644, "post_id": 59337355, "comment_id": 104872465, "body": "Take a look at the <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\" rel=\"nofollow noreferrer\"><i>sieve of Eratosthenes</i></a>"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576344976, "post_id": 59337355, "comment_id": 104872862, "body": "This is really two questions in one. The first is how you find prime numbers in Haskell, and the second is how you filter a list by the elements&#39; indices (as opposed to the usual case of filtering by their values). @WillemVanOnsem provided a link that will help with the first. Which of the pieces are you stuck on?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1576346300, "post_id": 59337355, "comment_id": 104873203, "body": "Why do you need the items at the prime indices..?"}], "answers": [{"tags": [], "owner": {"reputation": 2485, "user_id": 11282404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e3829cb91cc6be3541a37381b5ff21?s=128&d=identicon&r=PG&f=1", "display_name": "jpmarinier", "link": "https://stackoverflow.com/users/11282404/jpmarinier"}, "is_accepted": true, "score": 0, "last_activity_date": 1576441174, "creation_date": 1576441174, "answer_id": 59347713, "question_id": 59337355, "link": "https://stackoverflow.com/questions/59337355/how-could-i-make-a-list-in-haskell-by-prime-index/59347713#59347713", "title": "How could I make a list in Haskell by prime index?", "body": "<h2>A possible strategy:</h2>\n\n<p>Following the general approach mentioned above by @Joseph Sible-Reinstate Monica, the problem can be solved like this:</p>\n\n<ol>\n<li>get a list of all prime numbers, say <code>primes</code></li>\n<li>use that first list to create an auxiliary list of booleans which has <code>True</code> elements solely at prime indices</li>\n<li>use the second list together with classic list functions (map, filter, zip) to solve the problem</li>\n</ol>\n\n<p>Regarding the <strong>first part</strong>, there are a number of available algorithms in the <a href=\"https://wiki.haskell.org/Prime_numbers\" rel=\"nofollow noreferrer\">relevant page of the Haskell Wiki</a>. We can just pick one of them.</p>\n\n<pre><code>import  Data.List.Ordered\n\n_Y   :: (t -&gt; t) -&gt; t\n_Y g = g (_Y g)    \n\njoinL :: (Ord a, Eq a) =&gt; [[a]] -&gt; [a]\njoinL ((x:xs):t) = x : union xs (joinL t)\njoinL ([]:t)     = joinL t\njoinL  []        = []\n\nprimesLME :: [Integer]\nprimesLME = 2 : _Y ((3:) . minus [5,7..] . joinL . map (\\p-&gt; [p*p, p*p+2*p..]))\n\nprimes = primesLME\n</code></pre>\n\n<p>with LME standing for Linear MErging.</p>\n\n<p>Regarding the <strong>second part</strong>, a function to transform <code>primes</code> into the required list of booleans, say <code>primeMask</code>, can be taken from <a href=\"https://stackoverflow.com/a/59092535/11282404\">SO_q59092535</a>.</p>\n\n<pre><code>-- boolean list from index list (with unfoldr):\nbooleansFromIndices :: [Integer] -&gt; [Bool]\nbooleansFromIndices indices =\n    let  sfn (pos,ind) =  Just $  -- stepping function for unfoldr\n             if (null ind)\n               then ( False, (pos+1, []) )\n               else ( pos==head ind,\n                      (pos+1, if (pos==head ind)  then  tail ind  else  ind))\n    in   unfoldr  sfn  (0,indices)\n\nprimeMask :: [Bool]\nprimeMask = drop 1 $ booleansFromIndices primes  -- 1-based indexing\n\n</code></pre>\n\n<h2>Putting it all together (third and last part):</h2>\n\n<p>In a <code>ghci</code> session:</p>\n\n<pre><code> \u03bb&gt; \n \u03bb&gt; take 10 primes\n[2,3,5,7,11,13,17,19,23,29]\n \u03bb&gt; \n \u03bb&gt; \n \u03bb&gt; take 15 primeMask\n[False,True,True,False,True,False,True,False,False,False,True,False,True,False,False]\n \u03bb&gt; \n \u03bb&gt; take 20 $ map  (\\b -&gt; if b then '1' else '0')  primeMask\n\"01101010001010001010\"\n \u03bb&gt; \n \u03bb&gt; str = \"primesarefun\"\n \u03bb&gt; \n \u03bb&gt; zip primeMask str\n[(False,'p'),(True,'r'),(True,'i'),(False,'m'),(True,'e'),(False,'s'),(True,'a'),(False,'r'),(False,'e'),(False,'f'),(True,'u'),(False,'n')]\n \u03bb&gt; \n \u03bb&gt; filter fst $ zip primeMask str\n[(True,'r'),(True,'i'),(True,'e'),(True,'a'),(True,'u')]\n \u03bb&gt; \n \u03bb&gt; map snd $ filter fst $ zip primeMask str\n\"rieau\"\n \u03bb&gt; \n \u03bb&gt; primeIndex = \\xs -&gt; map snd $ filter fst $ zip primeMask xs\n \u03bb&gt; \n \u03bb&gt; primeIndex [1..20]\n[2,3,5,7,11,13,17,19]\n \u03bb&gt; \n\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 12234788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/207867fde03aecd6c4e308e06f7b6a36?s=128&d=identicon&r=PG&f=1", "display_name": "peter.s", "link": "https://stackoverflow.com/users/12234788/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 59347713, "answer_count": 1, "score": -1, "last_activity_date": 1576441174, "creation_date": 1576343488, "question_id": 59337355, "link": "https://stackoverflow.com/questions/59337355/how-could-i-make-a-list-in-haskell-by-prime-index", "title": "How could I make a list in Haskell by prime index?", "body": "<p>How could I make a list where I get every number/letter which has a prime index number?</p>\n\n<pre><code>primeIndex :: [a] -&gt; [a]\nprimeIndex [1..20] == [2, 3, 5, 7, 11, 13, 17, 19]\nprimeIndex \"primesarefun\" == \"rieau\"\n</code></pre>\n"}, {"tags": ["haskell", "gloss"], "answers": [{"comments": [{"owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "edited": false, "score": 0, "creation_date": 1576603518, "post_id": 59337636, "comment_id": 104950509, "body": "Thanks for this. But I think stringWidth gives the width in pixels - how to I convert the result to Float that Gloss uses?"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1576345614, "creation_date": 1576345614, "answer_id": 59337636, "question_id": 59337172, "link": "https://stackoverflow.com/questions/59337172/how-do-find-the-width-of-a-text-picture-in-gloss/59337636#59337636", "title": "How do find the width of a Text Picture in gloss?", "body": "<p><a href=\"https://github.com/benl23x5/gloss/blob/885cca8a9854efb49541cb6172226f888924f5fe/gloss-rendering/Graphics/Gloss/Internals/Rendering/Picture.hs#L88-L92\" rel=\"nofollow noreferrer\">Here</a>'s how text is rendered in Gloss:</p>\n\n<pre><code>        Text str\n         -&gt; do\n                GL.blend        $= GL.Disabled\n                GL.preservingMatrix $ GLUT.renderString GLUT.Roman str\n                GL.blend        $= GL.Enabled\n</code></pre>\n\n<p>The important point here is that it calls <code>renderString</code>. Looking at <a href=\"https://hackage.haskell.org/package/GLUT-2.7.0.15/docs/Graphics-UI-GLUT-Fonts.html#v:renderString\" rel=\"nofollow noreferrer\">the documentation for <code>renderString</code></a>, we immediately see two other useful functions: <a href=\"https://hackage.haskell.org/package/GLUT-2.7.0.15/docs/Graphics-UI-GLUT-Fonts.html#v:stringWidth\" rel=\"nofollow noreferrer\"><code>stringWidth</code></a> and <a href=\"https://hackage.haskell.org/package/GLUT-2.7.0.15/docs/Graphics-UI-GLUT-Fonts.html#v:fontHeight\" rel=\"nofollow noreferrer\"><code>fontHeight</code></a>. As such, you can get your width and height like this:</p>\n\n<pre><code>import Graphics.UI.GLUT.Fonts\n\ndo\n    width &lt;- stringWidth Roman str\n    height &lt;- fontHeight Roman\n</code></pre>\n"}], "owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 311, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1576345614, "creation_date": 1576342089, "question_id": 59337172, "link": "https://stackoverflow.com/questions/59337172/how-do-find-the-width-of-a-text-picture-in-gloss", "title": "How do find the width of a Text Picture in gloss?", "body": "<p>In the Haskell Gloss library, one draws text with the Text constructor of the Picture type. But how, then does one find the width (and height) of such a picture?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576341861, "post_id": 59337082, "comment_id": 104872025, "body": "Should <code>rightPoint (leftPoint p b) b == p</code>? Now you basically say that the right point of the left point of <code>p</code> is the left point of <code>p</code>?"}, {"owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576342175, "post_id": 59337082, "comment_id": 104872112, "body": "@WillemVanOnsem thanks for point this out.my bad, it&#39;s a typo. In my program it&#39;s correct without this typo."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1576343203, "post_id": 59337082, "comment_id": 104872371, "body": "QuickCheck will usually report the value(s) that caused the property to be falsified. Doesn&#39;t it do that for you?"}, {"owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1576343290, "post_id": 59337082, "comment_id": 104872383, "body": "@MarkSeemann it does and it certainly helps. but sitll I prefer to see the exact failure location."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1576344049, "post_id": 59337082, "comment_id": 104872577, "body": "If Haskell comes with a debugger that enables you step through code, I&#39;m not aware of it. I usually troubleshoot Haskell code like this: <a href=\"https://stackoverflow.com/a/48222438/126014\">stackoverflow.com/a/48222438/126014</a>"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576342110, "creation_date": 1576341417, "last_edit_date": 1576342110, "question_id": 59337082, "link": "https://stackoverflow.com/questions/59337082/how-to-step-through-a-quickcheck-process", "title": "How to step through a Quickcheck process", "body": "<p>I have the follow two functions:</p>\n\n<pre><code>leftPoint :: Point -&gt; Board -&gt; Point\nrightPoint :: Point -&gt; Board -&gt; Point\n</code></pre>\n\n<p>It should have the propoerty:</p>\n\n<pre><code>rightPoint (leftPoint p b) b == p\n</code></pre>\n\n<p>Or in English: the right point of a point's left point is itself.</p>\n\n<p>My test failed with a case but I'd like to run through the test in a step by step way to understand it.\nDoes Haskell or QuickCheck library provide such a debugging tool?</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-search-tree"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1576339176, "post_id": 59336641, "comment_id": 104871267, "body": "I don&#39;t get what you would want your <code>precise</code> function to do. Also, avoid throwing <code>error</code>s in pure functions, instead find a better representation for your result (like using <code>Maybe</code>)"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1576339326, "post_id": 59336641, "comment_id": 104871305, "body": "Can you maybe post a working imperative version of <code>closest lower keys</code> so that we can understand what exactly you want your haskell version to do?"}, {"owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1576339477, "post_id": 59336641, "comment_id": 104871351, "body": "Following @Bergi&#39;s request, I added type definition. Sorry for this mistake"}, {"owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1576339870, "post_id": 59336641, "comment_id": 104871488, "body": "@Bergi, I need solving that as in this tutorial for C++ programmers <a href=\"https://www.geeksforgeeks.org/find-closest-element-binary-search-tree/\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1576340724, "post_id": 59336641, "comment_id": 104871725, "body": "I think you can follow their algorithm quite literally - except maybe those weird in-out mutable <code>min_diff</code> and <code>min_diff_key</code> parameters, which - even worse - also have some no-value values like <code>MAX_INTEGER</code> and <code>-1</code>. Write a function <code>Integer -&gt; TreeMap v -&gt; Maybe (Integer, v) -&gt; Maybe (Integer, v)</code> with parameters <code>searchValue</code>, <code>tree</code>, and <code>closestSoFar</code>."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "edited": false, "score": 1, "creation_date": 1576353147, "post_id": 59337292, "comment_id": 104874908, "body": "It works perfectly, thank you. It&#39;s a very remarkable explanation of this case solution, indeed - as a newbie in functional programming, I appreciate your review and conclusions about all of that very much."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 0, "last_activity_date": 1576451114, "last_edit_date": 1576451114, "creation_date": 1576342996, "answer_id": 59337292, "question_id": 59336641, "link": "https://stackoverflow.com/questions/59336641/find-keys-closest-to-an-integer-argument-in-haskell-tree/59337292#59337292", "title": "Find keys closest to an integer argument in Haskell tree", "body": "<p>Here's how I'd do it:</p>\n\n<pre><code>data TreeMap v = Leaf | Node Integer v (TreeMap v) (TreeMap v) deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer -&gt; TreeMap v -&gt; Maybe (Integer, v)\nclosestLess i = precise Nothing where\n  precise :: Maybe (Integer, v) -&gt; TreeMap v -&gt; Maybe (Integer, v)\n  precise closestSoFar Leaf = closestSoFar\n  precise closestSoFar (Node k v l r) = case i `compare` k of\n    LT -&gt; precise closestSoFar l\n    EQ -&gt; Just (k, v)\n    GT -&gt; precise (Just (k, v)) r\n</code></pre>\n\n<p>A few notes regarding the differences between this and your attempt:</p>\n\n<ul>\n<li>You used record syntax for the <code>Node</code> constructor. It's bad form to use record syntax on sum types, since the functions would then be partial (for example, <code>pair Leaf</code> would be bottom). Since you didn't actually use these and they're not necessary, I removed them.</li>\n<li>You wrapped the key and value in a tuple, with no apparent reason why. I separated them out and placed them directly in the type.</li>\n<li>Your <code>closestLess</code> function had a return type of <code>(Integer, v)</code>, even though it couldn't always return something of that type. I changed it to <code>Maybe (Integer, v)</code>, so that it can return <code>Nothing</code> instead of having to use <code>error</code>. (Side note: your error message was technically wrong. If you called <code>closestLess</code> where the search value is smaller than all of the nodes, it would fail even though the tree did have elements.)</li>\n<li>Your code is inconsistent as to which is the left and which is the right branch of the nodes. In my code, the left branch is always the one that's on the left in the data constructor.</li>\n<li>You used <code>i &lt; fst pair</code> and <code>i == fst pair</code> in separate guards. By case-matching on the output of <code>compare</code> instead, you only have to do the comparison once instead of twice.</li>\n<li>You were on the right track with needing a <code>precise</code> function, but a lot of the logic that you had in <code>closestLess</code> actually needed to be in it.</li>\n</ul>\n\n<p>Here's a quick test case, using the example at the site you linked:</p>\n\n<pre><code>Prelude&gt; tree = Node 9 () (Node 4 () (Node 3 () Leaf Leaf) (Node 6 () (Node 5 () Leaf Leaf) (Node 7 () Leaf Leaf))) (Node 17 () Leaf (Node 22 () (Node 20 () Leaf Leaf) Leaf))\nPrelude&gt; closestLess 4 tree\nJust (4,())\nPrelude&gt; closestLess 18 tree\nJust (17,())\nPrelude&gt; closestLess 12 tree\nJust (9,())\nPrelude&gt; closestLess 2 tree\nNothing\n</code></pre>\n\n<hr>\n\n<p>You can also make it lazier (yielding the outer <code>Just</code> as soon as a single candidate is found), at the expense of being a bit more complex:</p>\n\n<pre>\n<b>import Data.Functor.Identity</b>\n\ndata TreeMap v = Leaf | Node Integer v (TreeMap v) (TreeMap v) deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer -> TreeMap v -> Maybe (Integer, v)\nclosestLess i = precise Nothing\n  where\n    precise :: <b>Applicative t => t</b> (Integer, v) -> TreeMap v -> <b>t</b> (Integer, v)\n    precise closestSoFar Leaf = closestSoFar\n    precise closestSoFar (Node k v l r) = case i `compare` k of\n      LT -> precise closestSoFar l\n      EQ -> <b>pure</b> (k, v)\n      GT -> <b>pure . runIdentity $</b> precise (<b>Identity</b> (k, v)) r\n</pre>\n\n<p>See <a href=\"https://stackoverflow.com/q/59337499/7509065\">my question about this</a> for more details about it.</p>\n"}], "owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 59337292, "answer_count": 1, "score": 2, "last_activity_date": 1576451114, "creation_date": 1576338250, "last_edit_date": 1576339305, "question_id": 59336641, "link": "https://stackoverflow.com/questions/59336641/find-keys-closest-to-an-integer-argument-in-haskell-tree", "title": "Find keys closest to an integer argument in Haskell tree", "body": "<p>There is a plenty of solutions how to find closest lower and upper keys in binary tree in imperative languages, but a lack of same questions for doing it in purely functional style like that of Haskell. I'm curious to learn how it's possible to walk around a binary serch tree ahead of meeting both closest keys. There is a function and some pattern matches I've so far:</p>\n\n<pre><code>data TreeMap v = Leaf | Node { pair::(Integer, v), l::TreeMap v, r::TreeMap v} deriving (Show, Read, Eq, Ord)\n\nclosestLess :: Integer -&gt; TreeMap v -&gt; (Integer, v)\nclosestLess i Leaf = error \"Tree doesn't include any element\"\nclosestLess i (Node pair tree_r tree_l)\n        | i &lt; fst pair = closestLess i tree_l\n        | i == fst pair = closestLess i tree_r\n        | otherwise = precise i pair tree_r \n</code></pre>\n\n<p>I use this function to get a lower key, but closest to an Integer argument. In my opinion, there is nothing but necessity to implement some auxiliary function like \"precise\", although I'm confused what definition it needs exactly. My suggestion is to put that Integer value, node into \"precise\", right subtree also to find any key which is just closest one to the target. Therefore I would have some tips or assumptions how to make it for lower and upper keys as well.                </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3258, "user_id": 953125, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8f88b10fdab50cf9addcb710afe76b39?s=128&d=identicon&r=PG", "display_name": "balajeerc", "link": "https://stackoverflow.com/users/953125/balajeerc"}, "edited": false, "score": 0, "creation_date": 1576339098, "post_id": 59336481, "comment_id": 104871235, "body": "If you want indices, then the results should all be 1 less I think."}], "answers": [{"tags": [], "owner": {"reputation": 3258, "user_id": 953125, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8f88b10fdab50cf9addcb710afe76b39?s=128&d=identicon&r=PG", "display_name": "balajeerc", "link": "https://stackoverflow.com/users/953125/balajeerc"}, "is_accepted": false, "score": 0, "last_activity_date": 1576339000, "last_edit_date": 1576339000, "creation_date": 1576338056, "answer_id": 59336608, "question_id": 59336481, "link": "https://stackoverflow.com/questions/59336481/how-could-i-get-the-index-of-a-tuple-in-haskell/59336608#59336608", "title": "How could I get the index of a tuple in haskell?", "body": "<p>Looks like homework. ;)</p>\n\n<pre><code>import Data.List\n\ntupleDiff :: (Int, Int) -&gt; Int\ntupleDiff (x, y) = abs(x - y)\n\ntype TupleArray = [(Int, Int)]\nmaxDiff :: TupleArray -&gt; Maybe Int\nmaxDiff tuples = elemIndex maxVal tupleDiffs\n  where tupleDiffs = map tupleDiff tuples \n        maxVal = maximum tupleDiffs\n\nmain :: IO ()\nmain = do\n  print $ maxDiff [(-5, 3), (-20, 20), (21, 33), (-50, 30)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1493, "user_id": 4377932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/f9nFx.jpg?s=128&g=1", "display_name": "artcorpse", "link": "https://stackoverflow.com/users/4377932/artcorpse"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1576348312, "post_id": 59336727, "comment_id": 104873737, "body": "@Redu You are right. It assumes that Ord for tuples is implemented lexicographically, and it seems this is implied by the Haskell 2010 Report <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch11.html\" rel=\"nofollow noreferrer\">11.1 Derived instances of Eq and Ord</a>"}], "tags": [], "owner": {"reputation": 1493, "user_id": 4377932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/f9nFx.jpg?s=128&g=1", "display_name": "artcorpse", "link": "https://stackoverflow.com/users/4377932/artcorpse"}, "is_accepted": true, "score": 1, "last_activity_date": 1576338808, "creation_date": 1576338808, "answer_id": 59336727, "question_id": 59336481, "link": "https://stackoverflow.com/questions/59336481/how-could-i-get-the-index-of-a-tuple-in-haskell/59336727#59336727", "title": "How could I get the index of a tuple in haskell?", "body": "<pre><code>maxDiff = snd . minimum . (`zip` [1..]) . map (uncurry (-))\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 12234788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/207867fde03aecd6c4e308e06f7b6a36?s=128&d=identicon&r=PG&f=1", "display_name": "peter.s", "link": "https://stackoverflow.com/users/12234788/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 59336727, "answer_count": 2, "score": -2, "last_activity_date": 1576339000, "creation_date": 1576337279, "question_id": 59336481, "link": "https://stackoverflow.com/questions/59336481/how-could-i-get-the-index-of-a-tuple-in-haskell", "title": "How could I get the index of a tuple in haskell?", "body": "<p>How could I get the index of the highest difference between the elements of a tuple in a list of tuples in haskell?</p>\n\n<pre><code>maxDiff :: [(Int, Int)] -&gt; Int\nmaxDiff [(-5, 3), (-20, 20), (21, 33)] == 2\nmaxDiff [(-5, 3)] == 1\nmaxDiff [(-5, 3), (-20, 20), (21, 33), (-50, 30)] == 4\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576336672, "post_id": 59336347, "comment_id": 104870659, "body": "If you specify <code>regex-tdfa &gt;=1.3.1</code>, then you ask for a <code>regex-tdfa</code> library with a version that is <code>1.3.1</code> or higher. But as you say yourself, the library installed <code>regex-tdfa-1.2.3.1</code> hence the error."}, {"owner": {"reputation": 161, "user_id": 12147490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90b4bec77f92f0db5db412409f1275e4?s=128&d=identicon&r=PG&f=1", "display_name": "bg2000 Reinstate Monica", "link": "https://stackoverflow.com/users/12147490/bg2000-reinstate-monica"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576337368, "post_id": 59336347, "comment_id": 104870821, "body": "Yes, exactly; I ask for it. I think that package.yaml and stack are supposed to manage what is installed. I would like to tell stack to use the version that&#39;s on hackage, not stackage? Stackage does not go up to that number yet, except for in &quot;nightly&quot; <a href=\"https://www.stackage.org/lts-14.17/package/regex-tdfa-1.2.3.2\" rel=\"nofollow noreferrer\">stackage.org/lts-14.17/package/regex-tdfa-1.2.3.2</a> Can I specify nightly just for that one package? I can&#39;t find it in the docs unfortunately."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1576356027, "creation_date": 1576356027, "answer_id": 59338970, "question_id": 59336347, "link": "https://stackoverflow.com/questions/59336347/yesod-regular-expressions-in-2019/59338970#59338970", "title": "Yesod Regular Expressions in 2019", "body": "<p>After the error message about the dependency, you should see the following text displayed:</p>\n\n<pre><code>Some different approaches to resolving this:\n\n  * Set 'allow-newer: true' in /u/buhr/.stack/config.yaml to ignore all version\n    constraints and build anyway.\n\n  * Recommended action: try adding the following to your extra-deps \n    .../yesodtest/stack.yaml:\n\n- regex-tdfa-1.3.1.0@sha256:c77808a0d68d275c75fb84dc9ced340536574...\n</code></pre>\n\n<p>The <code>extra-deps</code> solution is the preferred one.  In your project-specific <code>stack.yaml</code>, add:</p>\n\n<pre><code>extra-deps:\n- regex-tdfa-1.3.1.0\n</code></pre>\n\n<p>(The detailed SHA256 is not actually needed.)  This throws another error because <code>regex-base</code> is too old, so you need to also add it, as per the recommended action:</p>\n\n<pre><code>extra-deps:\n- regex-tdfa-1.3.1.0\n- regex-base-0.94.0.0\n</code></pre>\n\n<p>That was enough to get a <code>yesod/simple</code> template building for me using <code>resolver: lts-14.17</code>.</p>\n"}], "owner": {"reputation": 161, "user_id": 12147490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90b4bec77f92f0db5db412409f1275e4?s=128&d=identicon&r=PG&f=1", "display_name": "bg2000 Reinstate Monica", "link": "https://stackoverflow.com/users/12147490/bg2000-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 59338970, "answer_count": 1, "score": -1, "last_activity_date": 1576356027, "creation_date": 1576336359, "question_id": 59336347, "link": "https://stackoverflow.com/questions/59336347/yesod-regular-expressions-in-2019", "title": "Yesod Regular Expressions in 2019", "body": "<p>Yesod uses <code>Text</code> a lot.</p>\n\n<p>I wish to use any Regex library at all, that supports UTF8 and <code>Text</code>.</p>\n\n<p>The most-recommended two libraries seem to be:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/regex-tdfa\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/regex-tdfa</a></li>\n<li><a href=\"http://hackage.haskell.org/package/regex-pcre\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/regex-pcre</a></li>\n</ul>\n\n<p><strong>Attempts at regex-tdfa:</strong></p>\n\n<pre><code>import          Text.Regex.TDFA\n...\nlet (parta,partb,partc) = ((sometext :: Text) =~ (\"de\" :: String)) :: (String, String, String)\n</code></pre>\n\n<p>I can't seem to use <code>Text</code>, even though it appears that <code>regex-tdfa</code> has some sort of module for <code>Text</code> \n<a href=\"http://hackage.haskell.org/package/regex-tdfa-1.3.1.0/docs/Text-Regex-TDFA-Text.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/regex-tdfa-1.3.1.0/docs/Text-Regex-TDFA-Text.html</a></p>\n\n<p>The version of regex-tdfa that stack has installed here is regex-tdfa-1.2.3.1 and it won't use the newer one that has the above Text.Regex.TDFA.Text, for some reason. When I try to specify the version <code>- regex-tdfa &gt;=1.3.1</code> in my package.yaml, I get this error when building with \"yesod devel\":</p>\n\n<pre><code>In the dependencies for example-0.0.0(+dev +library-only):\n    regex-tdfa-1.2.3.1 from stack configuration does not match &gt;=1.3.1 \nneeded since backend is a build target.\n</code></pre>\n\n<p>Existing SO question: The answer to this question is out of date, regex-tdfa-text is deprecated:\n<a href=\"https://stackoverflow.com/questions/31160216/regular-expression-on-yesod-type-text\">Regular Expression on Yesod type Text</a></p>\n\n<p>How can I use the <code>Text</code>-supporting version of regex-tdfa?</p>\n\n<p><strong>Attempts with PCRE:</strong></p>\n\n<pre><code>import          Text.Regex.PCRE\n...\nlet stringResult = ( \"hello there\" :: Text ) =~ ( \"e\" :: Text ) :: AllTextMatches [] Text\n</code></pre>\n\n<p>This doesn't work unless I replace all the <code>Text</code> with <code>String</code>.\nThe error is:</p>\n\n<pre><code>  \u2022 No instance for (RegexMaker Regex CompOption ExecOption Text)\n        arising from a use of \u2018=~\u2019\n    \u2022 In the expression:\n          (\"hello there\" :: Text) =~ (\"e\" :: Text) :: AllTextMatches [] Text\n</code></pre>\n\n<p>This tutorial claims PCRE works with UTF8: <a href=\"https://gabebw.com/blog/2015/10/11/regular-expressions-in-haskell\" rel=\"nofollow noreferrer\">https://gabebw.com/blog/2015/10/11/regular-expressions-in-haskell</a> </p>\n\n<p>But I am not sure if regex-pcre claims to work with <code>Text</code>. Am I supposed to convert from <code>Text</code> to <code>String</code> and then use regex-pcre?</p>\n\n<p><strong>Summary:</strong></p>\n\n<p>What is the best practice for using regex with Yesod? How can I use a library with <code>Text</code> AND UTF8?</p>\n"}, {"tags": ["haskell", "functional-programming", "binary-search-tree"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "edited": false, "score": 1, "creation_date": 1576330477, "post_id": 59335560, "comment_id": 104869183, "body": "Haskell is fine as your answer, indeed. Absolutely, now things look well. Many thanks"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1576330131, "creation_date": 1576330131, "answer_id": 59335560, "question_id": 59335508, "link": "https://stackoverflow.com/questions/59335508/zipping-tuples-inside-haskell-tree/59335560#59335560", "title": "Zipping tuples inside Haskell tree", "body": "<p>Why pattern match on the subtrees? You can just use <code>Node pair t1 t2</code>. Indeed:</p>\n\n<pre><code>listFromTree :: TreeMap v -&gt; [(Integer, v)]\nlistFromTree Leaf = []\nlistFromTree (Node pair <b>t1 t2</b>) = pair : listFromTree <b>t1</b> ++ listFromTree <b>t2</b></code></pre>\n\n<p>Here we use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-43--43-\" rel=\"nofollow noreferrer\"><strong><code>(++) :: [a] -&gt; [a] -&gt; [a]</code></strong></a> to append two lists together.</p>\n\n<p>In case one of the two subtrees is a <code>Leaf</code>, then this will result in an empty list, and appending with an empty list, results in the other list.</p>\n"}], "owner": {"reputation": 77, "user_id": 12097044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4262bad179488ade2278093151e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Max_ReFactor", "link": "https://stackoverflow.com/users/12097044/max-refactor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 59335560, "answer_count": 1, "score": 0, "last_activity_date": 1576330131, "creation_date": 1576329791, "question_id": 59335508, "link": "https://stackoverflow.com/questions/59335508/zipping-tuples-inside-haskell-tree", "title": "Zipping tuples inside Haskell tree", "body": "<p>I'm seeking any suggestion how to solve a problem with a binary search tree in Haskell. It has declaration as follows:</p>\n\n<pre><code>data TreeMap v = Leaf | Node { pair::(Integer, v), l::TreeMap v, r::TreeMap v} deriving (Show, Read, Eq, Ord)\n</code></pre>\n\n<p>Now I want to zip all pairs to have them as array elements. My solution so far is</p>\n\n<pre><code>listMyTuples :: TreeMap v -&gt; [(Integer, v)]\nlistMyTuples Leaf = []\nlistMyTuples (Node pair Leaf tree2) = pair : listMyTuples tree2\nlistMyTuples (Node pair tree1 Leaf) = pair : listMyTuples tree1\n...other pattern matching needed \n</code></pre>\n\n<p>I'm barely to complete that due to some lack of comprehension what to do in a case of missing leafs. So, how to make some kind of functional brigde between two subtrees to get it right?  </p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "fold", "foldleft"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1576328250, "post_id": 59335289, "comment_id": 104868666, "body": "Because in the former <code>x</code> is the <i>accumulator</i>, so you call <code>f</code> on the <i>accumulator</i>."}, {"owner": {"reputation": 11, "user_id": 11503948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5zi6G.jpg?s=128&g=1", "display_name": "Ayush kabir verma", "link": "https://stackoverflow.com/users/11503948/ayush-kabir-verma"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576328520, "post_id": 59335289, "comment_id": 104868723, "body": "when I use foldr with first definition as follows <code>firstThat :: (a-&gt; Bool) -&gt; a -&gt; [a] -&gt; a firstThat f = foldr (\\x acc -&gt; if f x then x else acc)</code> I got correct result as 5 but not 100."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1576328573, "post_id": 59335289, "comment_id": 104868733, "body": "but the order of the accumulator and the element are swapped between <code>foldr</code> and <code>foldl</code>."}, {"owner": {"reputation": 11, "user_id": 11503948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5zi6G.jpg?s=128&g=1", "display_name": "Ayush kabir verma", "link": "https://stackoverflow.com/users/11503948/ayush-kabir-verma"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576328686, "post_id": 59335289, "comment_id": 104868767, "body": "ohk got it. Thanks @WillemVanOnsem"}], "answers": [{"tags": [], "owner": {"reputation": 1263, "user_id": 5817767, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/209584382725014/picture?type=large", "display_name": "Pawan Kumar", "link": "https://stackoverflow.com/users/5817767/pawan-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1576984518, "creation_date": 1576984518, "answer_id": 59441377, "question_id": 59335289, "link": "https://stackoverflow.com/questions/59335289/how-lambda-function-works-in-haskell/59441377#59441377", "title": "How Lambda function works in Haskell", "body": "<p>Both foldl &amp; foldr traverses a list from left to right but the difference is foldl is Left associative and foldr is right associative</p>\n\n<p>Given as list (xs)</p>\n\n<pre><code>xs = 1, 2, 3, ....., n\n</code></pre>\n\n<p>Think like foldl places the initial value to the left and associates the brackets to the left.</p>\n\n<pre><code>acc = 0\nop = +\n(((...(0 + 1) + 2) + 3) + 4) ..... + n)\n</code></pre>\n\n<p>foldr places the initial value to the right and associates the brackets to the right.</p>\n\n<pre><code>acc = 0\nop = +\n(1 + (2 + (3 + ......+ (n + 0)))...)))\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11503948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5zi6G.jpg?s=128&g=1", "display_name": "Ayush kabir verma", "link": "https://stackoverflow.com/users/11503948/ayush-kabir-verma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576984518, "creation_date": 1576328163, "last_edit_date": 1576329200, "question_id": 59335289, "link": "https://stackoverflow.com/questions/59335289/how-lambda-function-works-in-haskell", "title": "How Lambda function works in Haskell", "body": "<p>I am new to Haskell, while working on small programs I found little confusions about functioning of lambda functions.</p>\n\n<pre><code>lastThat :: (a -&gt; Bool) -&gt; a -&gt; [a] -&gt; a   \nlastThat f = foldl (\\x acc -&gt; if f x then x else acc)\n</code></pre>\n\n<p>Executing <code>lastThat (&gt;0) 100 [-1,-4,5,7,9,-10]</code> I got 100 . While using the following definition </p>\n\n<pre><code>lastThat :: (a -&gt; Bool) -&gt; a -&gt; [a] -&gt; a   \nlastThat f = foldl (\\acc x -&gt; if f x then x else acc)\n</code></pre>\n\n<p>&amp; then executing <code>lastThat (&gt;0) 100 [-1,-4,5,7,9,-10]</code> I got 9 as expected.</p>\n\n<p>Why it did not worked with first definition?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1576317911, "post_id": 59334093, "comment_id": 104866396, "body": "<code>maximum</code> has signature <code>maximum :: Ord a =&gt; [a] -&gt; a</code>, so it does not return a <code>Maybe a</code>. You will need to guard against the empty list as well. Note that <code>[filter (f) x]</code> will generate a singleton list that contains a sublist, so you are not filtring properly."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1576319176, "creation_date": 1576319176, "answer_id": 59334247, "question_id": 59334093, "link": "https://stackoverflow.com/questions/59334093/how-to-get-the-highest-value-from-a-filtered-list-haskell/59334247#59334247", "title": "How to get the highest value from a filtered list? haskell", "body": "<p>There are basically two major problems here:</p>\n\n<ol>\n<li>with <code>[filter (f) x]</code> you are creating a <em>singleton</em> list: a list that contains exactly <em>one</em> element: the filtered list, so it has type <code>[[a]]</code>; you probably want to use <code>(filter f x)</code> instead; and </li>\n<li><code>maximum :: (Foldable f, Ord a) =&gt; f a -&gt; a</code> does <em>not</em> return a <code>Maybe a</code>, but an <code>a</code>. You thus need to construct a function that first looks if the list is empty, and if not, return a <code>Just &hellip;</code> that wraps the maximum; otherwise it should return <code>Nothing</code>.</li>\n</ol>\n\n<p>You thus probably want to implement a helper function, and then use that function in the <code>conditionalMax</code>:</p>\n\n<pre><code>safeMaximum :: Ord a =&gt; [a] -&gt; Maybe a\nsafeMaximum = &hellip;</code></pre>\n\n<p>where you need to fill in <code>&hellip;</code> yourself.</p>\n"}], "owner": {"reputation": 71, "user_id": 12234788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/207867fde03aecd6c4e308e06f7b6a36?s=128&d=identicon&r=PG&f=1", "display_name": "peter.s", "link": "https://stackoverflow.com/users/12234788/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 59334247, "answer_count": 1, "score": 0, "last_activity_date": 1576319176, "creation_date": 1576317812, "last_edit_date": 1576319065, "question_id": 59334093, "link": "https://stackoverflow.com/questions/59334093/how-to-get-the-highest-value-from-a-filtered-list-haskell", "title": "How to get the highest value from a filtered list? haskell", "body": "<p>My function basically would work, but I have problems with type definition (it's fix, I can't change it)</p>\n\n<pre><code>conditionalMax :: Ord a =&gt; (a -&gt; Bool) -&gt; [a] -&gt; Maybe a\nconditionalMax f x = maximum [filter (f) x] \n</code></pre>\n\n<p>the output should be like: </p>\n\n<pre><code>conditionalMax even [2,5,9,8,4,2] == Just 8\nconditionalMax odd [2,5,9,8,4,2] == Just 9\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3306, "user_id": 2750819, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/gOFsQ.png?s=128&g=1", "display_name": "Kent Shikama", "link": "https://stackoverflow.com/users/2750819/kent-shikama"}, "edited": false, "score": 0, "creation_date": 1576312387, "post_id": 59333527, "comment_id": 104865492, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/841851/how-do-you-combine-filter-conditions\">How do you combine filter conditions</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1576313280, "post_id": 59333527, "comment_id": 104865635, "body": "You should make a recursive call to <code>filterMany</code>, not to <code>filter</code>. Remove <code>== True</code>, it&#39;s redundant. Parentheses in <code>(variable)</code> are also redundant."}, {"owner": {"reputation": 71, "user_id": 12234788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/207867fde03aecd6c4e308e06f7b6a36?s=128&d=identicon&r=PG&f=1", "display_name": "peter.s", "link": "https://stackoverflow.com/users/12234788/peter-s"}, "edited": false, "score": 0, "creation_date": 1576313876, "post_id": 59333527, "comment_id": 104865705, "body": "do you mean:      filterMany&#39; (f:fs) [] = []     filterMany&#39; (f:fs) x       | f x = x : filterMany&#39; fs x       | otherwise = filterMany&#39; fs x"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1576313321, "creation_date": 1576313321, "answer_id": 59333624, "question_id": 59333527, "link": "https://stackoverflow.com/questions/59333527/how-could-i-filter-for-many-conditions-in-a-list-in-haskell/59333624#59333624", "title": "How could I filter for many conditions in a list in Haskell?", "body": "<p>You can make use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:all\" rel=\"nofollow noreferrer\"><strong><code>all :: (a -&gt; Bool) -&gt; [a] -&gt; Bool</code></strong></a> here to check if <em>all</em> conditions are met. We thus can implement this with:</p>\n\n<pre><code>filterMany :: Foldable f => f (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterMany fs = filter (\\x -&gt; <b>all ($ x)</b> fs)</code></pre>\n\n<p>We here thus apply all predicates with parameter <code>x</code> by specifying <code>all ($ x) fs</code>. If all these predicates hold, then we retrain the element <code>x</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; filterMany [even, odd] [1..10]\n[]\nPrelude&gt; filterMany [even, (\\x -&gt; x `mod` 4 /= 0)] [1..10]\n[2,6,10]\nPrelude&gt; filterMany [(&lt;7), (&gt;3), odd] [1..20]\n[5]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12756874, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/7a58cd3bab3fa59327ac11ccb450ff4f?s=128&d=identicon&r=PG", "display_name": "user12756874", "link": "https://stackoverflow.com/users/12756874/user12756874"}, "is_accepted": false, "score": 0, "last_activity_date": 1579638312, "last_edit_date": 1579638312, "creation_date": 1579635597, "answer_id": 59848112, "question_id": 59333527, "link": "https://stackoverflow.com/questions/59333527/how-could-i-filter-for-many-conditions-in-a-list-in-haskell/59848112#59848112", "title": "How could I filter for many conditions in a list in Haskell?", "body": "<p>Another way:</p>\n\n<pre><code>filterMany :: [a -&gt; Bool] -&gt; [a] -&gt; [a]\nfilterMany [] (x:xs) = (x:xs)\nfilterMany (f:fs) (x:xs) = filter f (filterMany (fs) (x:xs))\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 12234788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/207867fde03aecd6c4e308e06f7b6a36?s=128&d=identicon&r=PG&f=1", "display_name": "peter.s", "link": "https://stackoverflow.com/users/12234788/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 59333624, "answer_count": 2, "score": 2, "last_activity_date": 1579638312, "creation_date": 1576312146, "last_edit_date": 1576312471, "question_id": 59333527, "link": "https://stackoverflow.com/questions/59333527/how-could-i-filter-for-many-conditions-in-a-list-in-haskell", "title": "How could I filter for many conditions in a list in Haskell?", "body": "<p>the function definition is already given</p>\n\n<pre><code>filterMany :: [a -&gt; Bool] -&gt; [a] -&gt; [a]\nfilterMany (f:fs) [] = []\nfilterMany (f:fs) (x)\n  | filter (f) x == True = x : filter (fs) x\n  | otherwise = filter (fs) x\n</code></pre>\n\n<p>the output should be: </p>\n\n<pre><code>filterMany [even, odd] [1..10] == []\nfilterMany [even, (\\x -&gt; x `mod` 4 /= 0)] [1..10] == [2,6,10]\nfilterMany [(&lt;7), (&gt;3), odd] [1..20] == [5]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1576331557, "post_id": 59333006, "comment_id": 104869434, "body": "interestingly, the <a href=\"https://hackage.haskell.org/package/pipes-4.3.13\" rel=\"nofollow noreferrer\">package blurb</a> says &quot;Advantages over traditional streaming libraries: &lt;...&gt;  Bidirectionality: Implement duplex channels&quot; but it doesn&#39;t say &quot;... Implements duplex channels&quot;; and &quot;duplex&quot; is not in the <a href=\"https://hackage.haskell.org/package/pipes-4.3.13/docs/doc-index-D.html\" rel=\"nofollow noreferrer\">index</a> (that&#39;s all I know)."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1576397091, "creation_date": 1576397091, "answer_id": 59342176, "question_id": 59333006, "link": "https://stackoverflow.com/questions/59333006/using-request-and-response-in-with-the-pipes-library-for-bidirectional-communica/59342176#59342176", "title": "Using request and response in with the Pipes library for bidirectional communication", "body": "<p>The definitions of <code>await</code> and <code>yield</code> are:</p>\n\n<pre><code>await = request ()\nyield = respond\n</code></pre>\n\n<p>so they are closely related to <code>request</code> and <code>respond</code>.  The <code>await</code> and <code>yield</code> versions have just been specialized to unidirectional pull-based streams (<code>Producer</code>s, <code>Pipe</code>s and <code>Consumer</code>s).</p>\n\n<p>To perform bidirectional communication between two endpoints, you want to set up a <code>Client</code> and a <code>Server</code> and connect them.</p>\n\n<p>A <code>Client</code> is a monadic action that makes requests:</p>\n\n<pre><code>y &lt;- request x\n</code></pre>\n\n<p>by sending request <code>x</code> and receiving response <code>y</code>.  A <code>Server</code> is a monadic action that responds:</p>\n\n<pre><code>x &lt;- respond y\n</code></pre>\n\n<p>by accepting request <code>x</code> and sending response <code>y</code>.  Note that these operations are symmetric, so in a given application it's arbitrary which half is the <code>Client</code> and which half is the <code>Server</code>.</p>\n\n<p>Now, you may notice that while the <code>Client</code> sends an <code>x</code> and receives a <code>y</code> in response, the <code>Server</code> seems backward.  It sends response <code>y</code> before receiving request <code>x</code>!  In fact, it just needs to operate one step behind -- a server in a pull-based stream will want to send its response <code>y</code> to the <strong>previous</strong> request in order to receive the <strong>next</strong> request <code>x</code>.</p>\n\n<p>As a simple example, here's a <code>Client</code> that requests addition of numbers to calculate powers of two:</p>\n\n<pre><code>-- |Client to generate powers of two\npower2 :: Client (Int, Int) Int IO ()\npower2 = go 1\n  where go n | n &lt;= 1024 = do\n          liftIO $ print n\n          n' &lt;- request (n,n)   -- ask adder to add \"n\" and \"n\"\n          go n'\n        go n = liftIO $ print \"Done\"\n</code></pre>\n\n<p>Writing the server to add numbers is a little trickier because of this \"one step behind\" business.  We might start by writing:</p>\n\n<pre><code>-- |Server to sum numbers\nsum2 :: Server (Int, Int) Int IO ()\nsum2 = do\n  (n,n) &lt;- respond ???   -- send previous response to get current request\n  let n' = n+n\n  ??? &lt;- respond n'      -- send current reponse to get next request\n</code></pre>\n\n<p>The trick is to get things started by accepting the first request as an argument to the monadic action:</p>\n\n<pre><code>-- |Server to sum numbers\nsum2 :: (Int, Int) -&gt; Server (Int, Int) Int IO ()\nsum2 (m, n) = do\n  (m', n') &lt;- respond (m+n)  -- send response to get next request\n  sum2 (m', n')              -- and loop\n</code></pre>\n\n<p>Fortunately, the pull point-ful connector <code>+&gt;&gt;</code> has the right type to connect these:</p>\n\n<pre><code>mypipe :: Effect IO ()\nmypipe = sum2 +&gt;&gt; power2\n</code></pre>\n\n<p>and we can run the resulting effect in the usual manner:</p>\n\n<pre><code>main :: IO ()\nmain = runEffect mypipe\n\nghci&gt; main\n1\n2\n4\n8\n16\n32\n64\n128\n256\n512\n1024\n\"Done\"\n</code></pre>\n\n<p>Note that, for this type of bidirectional communication, requests and responses need to run in synchronous lock-step, so you can't do the equivalent of yielding once and awaiting twice.  If you wanted to re-design the example above to send requests in two parts, you'd need to develop a protocol with sensible request and response types, like:</p>\n\n<pre><code>data Req = First Int | Second Int\ndata Res = AckFirst | Answer Int\n\npower2 = ...\n    AckFirst &lt;- request n\n    Answer n' &lt;- request n\nsum2 = ...\n    First m' &lt;- respond (Answer (m+n))\n    Second n' &lt;- respond AckFirst\n    ...\n</code></pre>\n\n<p>For your brain/robot application, you can design the robot as either a client:</p>\n\n<pre><code>robotC :: Client Color (Color,Turn) Identity ()\nrobotC = go newRobot\n  where\n    go r = do\n      (c, turn) &lt;- request (color r)\n      go $ update c turn r\n</code></pre>\n\n<p>or a server:</p>\n\n<pre><code>robotS :: Server (Color,Turn) Color Identity ()\nrobotS = go newRobot\n  where\n    go r = do\n      (c, turn) &lt;- respond (color r)\n      go $ update c turn r\n</code></pre>\n\n<p>Because the robot produces output before consuming input, as a client it will fit into a pull-based stream with a brain server:</p>\n\n<pre><code>brainS :: Color -&gt; Server Color (Color,Turn) Identity ()\nbrainS = ...\n\napproach1 = brainS +&gt;&gt; robotC\n</code></pre>\n\n<p>or as a server it will fit into a push-based stream with a brain client:</p>\n\n<pre><code>brainC :: Color -&gt; Client (Color,Turn) Color Identity ()\nbrainC = ...\n\napproach2 = robotS &gt;&gt;~ brainC\n</code></pre>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1576397091, "creation_date": 1576306560, "question_id": 59333006, "link": "https://stackoverflow.com/questions/59333006/using-request-and-response-in-with-the-pipes-library-for-bidirectional-communica", "title": "Using request and response in with the Pipes library for bidirectional communication", "body": "<p>This question is about the Haskell <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\">Pipes</a> library</p>\n\n<p><strong>Background:</strong></p>\n\n<p>In a <a href=\"https://stackoverflow.com/questions/59280156/composing-pipes-into-a-loop-or-cycle-in-haskell\">previous question</a>, I asked how to form a cycle using pipes and <a href=\"https://stackoverflow.com/questions/59280156/composing-pipes-into-a-loop-or-cycle-in-haskell/59289637#59289637\">the answer I got</a> was \"don't do that.  Use <code>request</code> and <code>response</code> instead.\"  While there is an excellent and clearly written <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes-Tutorial.html\" rel=\"nofollow noreferrer\">tutorial</a> that covers <code>Producers</code>, <code>Consumers</code>, <code>Pipes</code>, and <code>Effects</code> in plain English.  The <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes-Core.html\" rel=\"nofollow noreferrer\">documentation</a> for <code>request</code> and <code>response</code> <code>Client</code> and <code>Server</code> starts by defining <a href=\"https://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Core.html#g:2\" rel=\"nofollow noreferrer\">Categories</a> and mentioning some other CompSci concepts like \"<a href=\"https://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Core.html#g:3\" rel=\"nofollow noreferrer\">the generator design pattern.</a>\" and \"<a href=\"https://hackage.haskell.org/package/pipes-4.3.13/docs/Pipes-Core.html#g:4\" rel=\"nofollow noreferrer\">the iteratee design pattern</a>.\" which are never explained. So I'm stuck not knowing how to \"use <code>request</code> and <code>response</code> instead.\"</p>\n\n<p><strong>The Setup</strong></p>\n\n<p>I have two state-machines like thing that need to pass data back and forth repeatedly, <code>robot</code> and <code>intCode</code>.</p>\n\n<p>The Robot is pretty simple:</p>\n\n<pre><code>robot :: Pipe Int Int m r -- robot never returns so its return type is polymorphic\nrobot = go newRobot\n  where\n    go r = do\n      yield $ color r\n      c &lt;- toColor &lt;$&gt; await \n      turn &lt;- toTurn &lt;$&gt; await\n      go $ update c turn r\n</code></pre>\n\n<p>It <code>yield</code>s a value, <code>await</code>s <em>two</em> instructions (a new color and a turn), updates the state (<code>r</code>) of the robot, and starts over.</p>\n\n<p>The <code>intCode</code> virtual machine runs programmed to communicate with the robot. It takes a program (called <code>code</code>) and creates a pipe that will <code>await</code> the sensor reading from the robot then <code>yield</code> two instructions to it.</p>\n\n<pre><code>(boot code) :: Pipe Int Int m ()\n</code></pre>\n\n<p>Let's assume that the IntCode VM is not easily modified, but that the robot is.</p>\n\n<p><strong>Questions:</strong></p>\n\n<p>How are <code>request</code> and <code>respond</code> different from <code>await</code> and <code>yield</code>?</p>\n\n<p>How do I use them to facilitate continuous communication between the robot and the VM?</p>\n"}, {"tags": ["haskell", "generator", "quickcheck"], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1576287379, "last_edit_date": 1576287379, "creation_date": 1576286425, "answer_id": 59331568, "question_id": 59331364, "link": "https://stackoverflow.com/questions/59331364/how-to-generate-datatypes-that-use-mvars/59331568#59331568", "title": "How to generate datatypes that use MVars?", "body": "<p>How about passing the <code>MVar</code> as a parameter to your <code>Gen</code> function? Like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>pageLogCommandGen :: MVar () -&gt; Gen PageLogCommand\npageLogCommandGen stopMVar = oneof\n  [ LogPage &lt;$&gt; arbitrary\n  , pure (Stop stopMVar)\n  ]\n</code></pre>\n\n<p>Then you can generate <code>stopMVar</code> in IO and pass it on like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>do stopMVar &lt;- newEmptyMVar\n   plc &lt;- generate (pageLogCommandGen stopMVar)\n   ...\n</code></pre>\n\n<p>before you test a property.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1576321365, "creation_date": 1576321365, "answer_id": 59334514, "question_id": 59331364, "link": "https://stackoverflow.com/questions/59331364/how-to-generate-datatypes-that-use-mvars/59334514#59334514", "title": "How to generate datatypes that use MVars?", "body": "<p>You <a href=\"https://stackoverflow.com/a/51620647/126014\">can't extract a pure value from <code>IO</code></a>. That's by design.</p>\n\n<p>You can, however, write QuickCheck properties that run in <code>IO</code>; something like this:</p>\n\n<pre><code>myIOProperty :: Testable prop =&gt; IO prop\nmyIOProperty = do\n  mvar &lt;- newEmptyMVar\n  -- do something with mvar here and return a result\n</code></pre>\n\n<p>Then use <code>ioProperty</code> or <code>idempotentIOProperty</code> to turn the <code>IO prop</code> value into a <code>Property</code>.</p>\n"}], "owner": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1576321393, "creation_date": 1576283771, "last_edit_date": 1576321393, "question_id": 59331364, "link": "https://stackoverflow.com/questions/59331364/how-to-generate-datatypes-that-use-mvars", "title": "How to generate datatypes that use MVars?", "body": "<p>I have a datatype that looks like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data PageLogCommand = LogPage Page\n                    | Stop (MVar ())\n</code></pre>\n\n<p>And I want to create a generator of type <code>Gen PageLogCommand</code>.</p>\n\n<p>For the <code>Stop</code> command though, making a new empty MVar has type <code>IO (MVar a)</code>, so how can I get the <code>MVar</code> out of the <code>IO</code> monad and use it to make a <code>Gen</code> type?</p>\n"}, {"tags": ["python", "oop", "haskell", "functional-programming", "state"], "comments": [{"owner": {"reputation": 150, "user_id": 10993032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d1bdcf63aa0e5ed4f4d2d82e455008a?s=128&d=identicon&r=PG&f=1", "display_name": "mikerover", "link": "https://stackoverflow.com/users/10993032/mikerover"}, "edited": false, "score": 1, "creation_date": 1576277658, "post_id": 59330733, "comment_id": 104860806, "body": "Do note that FP isn&#39;t all about having states or not; it&#39;s in JS but do read have a look at <a href=\"https://softwareengineering.stackexchange.com/questions/258114/help-me-to-understand-stateless-software-in-functional-programming\" title=\"help me to understand stateless software in functional programming\">softwareengineering.stackexchange.com/questions/258114/&hellip;</a>"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1576280677, "post_id": 59330733, "comment_id": 104861464, "body": "All but the very simplest of programs have state. That&#39;s required for basically everything. Functional programming doesn&#39;t say to get rid of state. It says 1) make access to state explicit, and 2) make state values immutable so that sharing them doesn&#39;t cause problems."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1576315365, "post_id": 59330733, "comment_id": 104865957, "body": "This is not your original question but I guess you should review your <a href=\"https://stackoverflow.com/a/3722218/5536315\">definition of stateful computations</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user12533913"}, "edited": false, "score": 0, "creation_date": 1576332882, "post_id": 59331268, "comment_id": 104869754, "body": "Thank-you, this clears up a lot of things :)"}], "tags": [], "owner": {"reputation": 2042, "user_id": 11424673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ecf0fd0aa656482af8bc20d0d22c88?s=128&d=identicon&r=PG&f=1", "display_name": "Hymns For Disco", "link": "https://stackoverflow.com/users/11424673/hymns-for-disco"}, "is_accepted": true, "score": 0, "last_activity_date": 1576282466, "creation_date": 1576282466, "answer_id": 59331268, "question_id": 59330733, "link": "https://stackoverflow.com/questions/59330733/what-are-states-vs-stateless-properties-and-advantages/59331268#59331268", "title": "What are states vs stateless properties and advantages?", "body": "<p>If you consider a program where there is no state whatsoever, and the program is not able to read external states (for example, checking the system time), that would entail that any function, besides what values may be passed as parameters, would have no way of differentiating any different circumstances because no different circumstances can exist.</p>\n\n<p>With this class of program, the run-time is effectively redundant as an optimizing compiler could derive any resulting outputs statically.  Its essentially equivalent to writing out a large math equation.  You can solve it, but the idea of \"running the program\" is redundant because it has an output inherent to the program itself that cannot change.</p>\n\n<p>Obviously this doesn't resemble most programs, even ones that may be described as \"stateless\".  Usually there is some minimal kind of state, such as input initially passed to the program.  For example, imagine a program that outputs the first N digits of the square root of a number K.  This program now has an initial state, but beyond knowing what N and K are, the program doesn't need to track program-level states like what day of the week it is, whether or not the user prefers MDY vs DMY date format, etc.  However, since the program almost certainly involves some kind of dynamic looping to find N digits, it would need to have some kind of state associated with the loop (for example an iteration number)</p>\n\n<p>So when code is referred to as \"stateless\" its not a 100% promise, but a kind of qualifier of the degree to which the code depends on state.</p>\n\n<p>So what are the advantages and disadvantages here?  The more your code depends on state, the more likely it is to do something that the programmer wasn't expecting.  Remember, state is something inherent to the runtime.  But we don't write code at runtime.  We can try to imagine all the different possible runtime states that <em>could</em> happen, but this quickly gets out of hand.</p>\n\n<h1>Examples</h1>\n\n<p>Here's an example of the same python program in a stateful vs stateless way.</p>\n\n<p>stateful.py</p>\n\n<pre><code>import math\n\nangle_type = 'radians'\n\ndef cosecant(x):\n    if angle_type == 'radians':\n        return 1/math.sin(x)\n    elif angle_type == 'degrees':\n        return 1/math.sin(x*math.pi/180)\n    else:\n        raise NotImplementedError('cosecant is not implemented for angle type', angle_type)\n</code></pre>\n\n<pre><code>================== RESTART: F:/Documents/Python/stateful.py ==================\n&gt;&gt;&gt; cosecant(1)\n1.1883951057781212\n&gt;&gt;&gt; angle_type = 'degrees'\n&gt;&gt;&gt; cosecant(1)\n57.298688498550185\n&gt;&gt;&gt; angle_type = 'turns'\n&gt;&gt;&gt; cosecant(1)\nTraceback (most recent call last):\n  File \"&lt;pyshell#16&gt;\", line 1, in &lt;module&gt;\n    cosecant(1)\n  File \"F:/Documents/Python/stateful.py\", line 11, in cosecant\n    raise NotImplementedError('cosecant is not implemented for angle type', angle_type)\nNotImplementedError: ('cosecant is not implemented for angle type', 'turns')\n&gt;&gt;&gt; \n</code></pre>\n\n<p>stateless.py</p>\n\n<pre><code>import math\n\ndef cosecant(x):\n    return 1/math.sin(x)\n\ndef cosecant_degrees(x):\n    return 1/math.sin(x*math.pi/180)\n</code></pre>\n\n<pre><code>================= RESTART: F:/Documents/Python/stateless.py =================\n&gt;&gt;&gt; cosecant(1)\n1.1883951057781212\n&gt;&gt;&gt; cosecant_degrees(1)\n57.298688498550185\n&gt;&gt;&gt; cosecant_turns(1)\nTraceback (most recent call last):\n  File \"&lt;pyshell#19&gt;\", line 1, in &lt;module&gt;\n    cosecant_turns(1)\nNameError: name 'cosecant_turns' is not defined\n&gt;&gt;&gt; \n</code></pre>\n\n<p>This example may seem odd, but the same principals and pitfalls extend to more complex programs.  We can see how using state here can lead to problems.  Consider <code>stateful.py</code>.  One problem is that the person calling <code>cosecant</code> doesn't necessarily know the current state of angle_type, they would have to set it every time before using <code>cosecant</code> to make sure that it will do what the want it to do.  Since programmers tend to not like repeating themselves, someone may declare <code>mymathlib.angle_type = 'degrees'</code> at the start of their program, and assume nothing else will ever change it. For example, what if you are working in degrees, but then you call a subroutine that changes <code>angle_type</code> to <code>'radians'</code> and doesn't change to degrees upon finishing.</p>\n\n<p>If other parts of the program <em>are</em> changing it, then the programmer effectively has to set the value to what the want every time before calling it.  And even still, if code is running on multiple threads, there is no guarantee that when you set <code>angle_type</code> to <code>'degrees'</code>, another thread didn't immediately set it to something else before your <code>cosecant</code> call gets executed (a race condition).</p>\n\n<p>In our stateless version of the program, all of these problems disappear.  What's the cost? Well now we have 2 different functions instead of 1.  Why is this a cost? Well, generally, it is considered good practice to keep an API smaller rather than larger, having multiple tools that do the same thing is confusing for people trying to use your library.  Because of this principle, it is sometimes tempting to smoosh 2 or more different functions into 1 if they seem to be doing the same thing. In general this isn't <em>terrible</em>, in fact it often helps a library in terms of maintenance and usability. In this case though, it has caused more harm than good because in the stateful program, while the programmer <em>can</em> effectively use it to do the same thing, we no longer have the simple guarantee that the function will do what you think it will do every time.</p>\n\n<p>This may on the surface seem like a silly example, but consider that python's <code>decimal</code> module does nearly the same thing.  In the <code>decimal</code> module, states variables including the number of decimal places of precision and rounding rules are stored in the current thread's <code>context</code>.  This isn't quite as problematic as the previous example. Since each thread has its own <code>context</code>, we don't have to worry about the race condition, but there are still potential trouble spots, like if a subroutine changes state without nicely changing it back for you.</p>\n\n<p>It's easy to rationalize this kind of design and say \"a competent programmer should be able to analyze the code and be able to avoid these kind of state related problems if they take the time to think about it\".  This is true in theory, but if we look at how people actually write code, the principle of least effort trumps everything else most of the time.  Look at examples of use of the <code>decimal</code> module in the official documentation, or any tutorial, and you will notice a common pattern.  The references to <code>decimal.getcontext()</code> outnumber the references to <code>decimal.setcontext()</code> 10 to 1 -- that is if setcontext is mentioned at all, often it is not.  In order to manage state in a competent \"safety first\" kind of way, both of these tools are equally important and if anything <code>decimal.setcontext()</code> should be used more often since it is what you use to guarantee consistent behavior.  Because of this least-effort principle, it is inevitable that programmers, especially beginners, will write code like this that may work in testing, but has no hard guarantee of future safety as the program evolves.</p>\n\n<h1>Conclusion</h1>\n\n<p>So is stateful code evil, and stateless code is our savior?  Well maybe. It could help to think of this little epigram as a guiding principle to avoid certain pitfalls.  The reality is that often stateful code is hard to avoid, or even inherent to the program's design.  For example, how could we make a video game without state? How do we make a health counter? How does the player move around the level and track its position? Can we have scores or win conditions? Stateful code is not going anywhere, but it does genuinely help to have an understanding of the common pitfalls of designing programs in that way.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user12533913"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 4, "closed_date": 1576284794, "accepted_answer_id": 59331268, "answer_count": 1, "score": 3, "last_activity_date": 1576284718, "creation_date": 1576277240, "last_edit_date": 1576284718, "question_id": 59330733, "link": "https://stackoverflow.com/questions/59330733/what-are-states-vs-stateless-properties-and-advantages", "closed_reason": "Duplicate", "title": "What are states vs stateless properties and advantages?", "body": "<p>I have read from various sources as a <strong>state</strong> being defined as something along the lines of:</p>\n\n<ul>\n<li>'the program's condition regarding stored inputs';</li>\n<li>'contents of memory locations at any given time in the program's\nexecution'</li>\n</ul>\n\n<p>But then I look up what the characteristic of being <strong>stateless</strong> is (e.g \"Haskell is stateless\"): </p>\n\n<ul>\n<li>'when an application isn't dependent on its state'; </li>\n<li>'physical state can't be changed'</li>\n<li>'Same output for same input - address in memory always stays the same'</li>\n<li>'methods don't depend on an instance and its corresponding instance\nvariables'</li>\n</ul>\n\n<p>Now, I must have misunderstood the (vague?) former definition, as surely FP languages which go hand-in-hand with the 'stateless' model stores inputs too?? Or is this something about functions simply being evaluating rather than mutating data?</p>\n\n<hr>\n\n<p>Well, I <em>sort of</em> get that such models are sometimes powerful - after reading about its use in program verification, debugging and concurrency.</p>\n\n<p>But it did get fairly complicated when I then read on about how:</p>\n\n<ul>\n<li>\"it eliminates a whole class of multithreading bugs related to <em>race\nconditions</em>\"</li>\n<li>more <em>expressive</em> code (whatever that is?)</li>\n<li>\"<em>static evaluation</em> ... can be used to favourably guide computer's\npositions [in a tic-tac-toe game tree]\" <a href=\"https://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf\" rel=\"nofollow noreferrer\">https://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf</a> (or perhaps static typing is for another question entirely?)</li>\n</ul>\n\n<hr>\n\n<p>So I also wondered about the advantages of being able to manipulate states, in iterative programming languages, and many forums gave examples like how altering one's 'age' via calling add() will mutate the 'age' variable outside of its scope.</p>\n\n<p>Maybe it's my lack of experience with OOP, but what are the exact advantages of using states in wider applications?</p>\n\n<p>If any example code could be given, please could you try and stick to Python/Haskell as the contrasting representatives of these opposite disciplines? My inexpertise in reading other languages does seem to hinder my understanding of other posts' explanations.</p>\n"}, {"tags": ["haskell", "generator", "quickcheck"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1576270356, "post_id": 59329480, "comment_id": 104858648, "body": "<code>Char</code> is already an <code>Arbitrary</code> instance, so you can just the the <code>arbitrary</code> method for that. If you need a <code>String</code>, you could also use the <code>String</code> instance, which is available via that <code>[]</code> instance."}, {"owner": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1576270810, "post_id": 59329480, "comment_id": 104858816, "body": "Could you give an example how to do that? I&#39;m a bit stuck on how the code would look like"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 1, "last_activity_date": 1576270278, "creation_date": 1576270278, "answer_id": 59329653, "question_id": 59329480, "link": "https://stackoverflow.com/questions/59329480/how-to-generate-strings-drawn-from-every-possible-character/59329653#59329653", "title": "How to generate strings drawn from every possible character?", "body": "<p>Since Char is an instance of Bounded as well as Enum (confirm this by asking GHCI for <code>:i Char</code>), you can simply write</p>\n\n<pre><code>[minBound..maxBound] :: [Char]\n</code></pre>\n\n<p>to get a list of all legal characters. Obviously this will not lead to efficient random access, though! So you could instead convert the bounds to <code>Int</code> with <code>Data.Char.ord :: Char -&gt; Int</code>, and use QuickCheck's feature to select from a range of integers, then map back to a character with <code>Data.Chra.chr :: Int -&gt; Char</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "edited": false, "score": 0, "creation_date": 1576284612, "post_id": 59329866, "comment_id": 104862048, "body": "Why does the first example only return slashes and numbers? Or are those ASCII numbers?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "edited": false, "score": 0, "creation_date": 1576305975, "post_id": 59329866, "comment_id": 104864486, "body": "@doctopus: these are just characters in the unicode range. Since it picks characters <i>uniformly</i>, 0.2% of the characters picked will be ASCII, since the number of non-ASCIIs is simply huge. That is why you might want to use <code>arbitrary</code> instead."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1576271579, "creation_date": 1576271579, "answer_id": 59329866, "question_id": 59329480, "link": "https://stackoverflow.com/questions/59329480/how-to-generate-strings-drawn-from-every-possible-character/59329866#59329866", "title": "How to generate strings drawn from every possible character?", "body": "<p><code>Char</code> is a instance of both the <code>Enum</code> and <code>Bounded</code> typeclass, you can make use of the <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:arbitraryBoundedEnum\" rel=\"nofollow noreferrer\"><strong><code>arbitraryBoundedEnum :: (Bounded a, Enum a) =&gt; Gen a</code></strong></a> function:</p>\n\n<pre><code>import Test.QuickCheck(Gen, arbitraryBoundedEnum, listOf)\n\narbStr :: Gen String\narbStr = listOf arbitraryBoundedEnum\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Test.QuickCheck&gt; sample arbStr\n\"\"\n\"\"\n\"\\821749\"\n\"\\433465\\930384\\375110\\256215\\894544\"\n\"\\431263\\866378\\313505\\1069229\\238290\\882442\"\n\"\"\n\"\\126116\\518750\\861881\\340014\\42369\\89768\\1017349\\590547\\331782\\974313\\582098\"\n\"\\426281\"\n\"\\799929\\592960\\724287\\1032975\\364929\\721969\\560296\\994687\\762805\\1070924\\537634\\492995\\1079045\\1079821\"\n\"\\496024\\32639\\969438\\322614\\332989\\512797\\447233\\655608\\278184\\590725\\102710\\925060\\74864\\854859\\312624\\1087010\\12444\\251595\"\n\"\\682370\\1089979\\391815\"\n</code></pre>\n\n<p>Or you can make use of the <code>arbitrary</code> in the <code>Arbitrary Char</code> typeclass:</p>\n\n<pre><code>import Test.QuickCheck(Gen, arbitrary, listOf)\n\narbStr :: Gen String\narbStr = listOf arbitrary\n</code></pre>\n\n<p>Note that the <code>arbitrary</code> for <code>Char</code> is implemented such that ASCII characters are (three times) more common than non-ASCII characters, so the \"distribution\" is different.</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1576521714, "last_edit_date": 1576521714, "creation_date": 1576331990, "answer_id": 59335806, "question_id": 59329480, "link": "https://stackoverflow.com/questions/59329480/how-to-generate-strings-drawn-from-every-possible-character/59335806#59335806", "title": "How to generate strings drawn from every possible character?", "body": "<p>When we do like</p>\n\n<pre><code>\u03bb&gt; length ([minBound..maxBound] :: [Char])\n1114112\n</code></pre>\n\n<p>we get the number of all characters and say Wow..! If you think the list is too big then you may always do like <code>drop x . take y</code> to limit the range.</p>\n\n<p>Accordingly, if you need <code>n</code> many random characters just <a href=\"https://codereview.stackexchange.com/q/232894/105433\"><code>shuffle :: [a] -&gt; IO [a]</code></a> the list and do a <code>take n</code> from that shuffled list.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Well of course... since shuffling could be expensive, it's best if we chose a clever strategy. It would be ideal to <em>randomly</em> limit the all characters list. So just</p>\n\n<ol>\n<li><p>make a <code>limits = liftM sort . mapM randomRIO $ replicate 2 (0,1114112) :: (Ord a, Random a, Num a) =&gt; IO [a]</code></p></li>\n<li><p><code>limits &gt;&gt;= \\[min,max] -&gt; return . drop min . take max $ ([minBound..maxBound] :: [Char])</code></p></li>\n<li><p>Finally just take <code>n</code> many like random <code>Char</code>s like <code>liftM . take n</code> from the result of <strong>Item 2</strong>.</p></li>\n</ol>\n"}], "owner": {"reputation": 3991, "user_id": 6378530, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5325e39f6f9f2d12029b11d4f8e56a69?s=128&d=identicon&r=PG&f=1", "display_name": "doctopus", "link": "https://stackoverflow.com/users/6378530/doctopus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 59329866, "answer_count": 3, "score": 2, "last_activity_date": 1576521714, "creation_date": 1576269226, "question_id": 59329480, "link": "https://stackoverflow.com/questions/59329480/how-to-generate-strings-drawn-from-every-possible-character", "title": "How to generate strings drawn from every possible character?", "body": "<p>At the moment I'm generating strings like this:</p>\n\n<pre><code>arbStr :: Gen String\narbStr = listOf $ elements (alpha ++ digits)\n  where alpha = ['a'..'z']\n        digits = ['0'..'9']\n</code></pre>\n\n<p>But obviously this only generates strings from alpha num chars. How can I do it to generate from all possible chars?</p>\n"}, {"tags": ["haskell", "filter"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1576252896, "post_id": 59325917, "comment_id": 104851310, "body": "What have you tried? Have you written down the mathematical equation? Where is the problem?  In Haskell the absolute value function is <code>abs</code>, the difference function is <code>(-)</code> and you can accumulate the differences in row and column via <code>(+)</code>.  Finally you can determine if two rows are different via <code>(&#47;=)</code>.  Can you stick those together?"}, {"owner": {"reputation": 93, "user_id": 12189211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916d741c3407c241c286e5b38d11478f?s=128&d=identicon&r=PG&f=1", "display_name": "vNSkyline", "link": "https://stackoverflow.com/users/12189211/vnskyline"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1576254893, "post_id": 59325917, "comment_id": 104852286, "body": "@ThomasM.DuBuisson My problem is i don&#39;t know how should i filter by that abs value calculation function. My function looks like this now: <code>knight (x,y) = filter (&#47;=(x,y)) (filter (==3) (abs (x - fst(possibleMoves)))  possibleMoves)</code> and i get a lot of type error."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1576255619, "post_id": 59325917, "comment_id": 104852664, "body": "Please don&#39;t put code in the comments. Saying &quot;i get a lot of type error&quot; is unhelpful. What are those errors. Include them above and not in the comment section."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1576256479, "post_id": 59325917, "comment_id": 104853053, "body": "You can find the problem, by examining the types of the pieces. Write your code in pieces, examine types and see if your types are matching what the compiler expects."}], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 1, "last_activity_date": 1577322255, "last_edit_date": 1577322255, "creation_date": 1576265057, "answer_id": 59328657, "question_id": 59325917, "link": "https://stackoverflow.com/questions/59325917/simple-chess-function-in-haskell/59328657#59328657", "title": "Simple chess function in Haskell", "body": "<p>It seems like you're making it harder than it needs to be.</p>\n\n<p>Given position <code>K</code> below, you could simply list each knight move:</p>\n\n<pre><code>    1   2   3   4   5\n  +---+---+---+---+---+\n1 |   | H |   | A |   |\n  +---+---+---+---+---+\n2 | G |   |   |   | B |\n  +---+---+---+---+---+\n3 |   |   | K |   |   |\n  +---+---+---+---+---+\n4 | F |   |   |   | C |\n  +---+---+---+---+---+\n5 |   | E |   | D |   |\n  +---+---+---+---+---+\n</code></pre>\n\n<p>And remove the ones that are outside the chessboard.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>knight :: (Int, Int) -&gt; [(Int, Int)]\nknight (x, y) = filter validPosition\n  [ (x + 1, y + 2)\n  , (x + 2, y + 1)\n  , (x + 2, y - 1)\n  , (x + 1, y - 2)\n  , (x - 1, y - 2)\n  , (x - 2, y - 1)\n  , (x - 2, y + 1)\n  , (x - 1, y + 2)\n  ]\n</code></pre>\n\n<p>Then if you think you're repeating yourself too much:</p>\n\n<pre><code>knight' :: (Int, Int) -&gt; [(Int, Int)]\nknight' (x, y) = filter validPosition\n  [ (x + dx, y + dy) | dx &lt;- [-2,-1,1,2]\n                     , dy &lt;- [-2,-1,1,2]\n                     , ... something about dx, dy and 3 ...\n                     ]\n</code></pre>\n\n<p>It seems that the <code>(== y) . snd</code> stuff obscures the solution a little.</p>\n"}, {"tags": [], "owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "is_accepted": false, "score": 0, "last_activity_date": 1577163861, "creation_date": 1577163861, "answer_id": 59464045, "question_id": 59325917, "link": "https://stackoverflow.com/questions/59325917/simple-chess-function-in-haskell/59464045#59464045", "title": "Simple chess function in Haskell", "body": "<p>Your idea of filtering the knight's positions is actually really succinct and easy to implement using a list comprehension.</p>\n\n<pre><code>knight (x, y) = [(x', y') | x'&lt;-[x-2..x+2], y'&lt;-[y-2..y+2], abs (x' - x) + abs (y' - y) == 3 ]\n</code></pre>\n\n<p>Restricting the possible displacement values to -2 and +2 will also prevent the column and row from being the same, so you can do away with that condition. </p>\n\n<p>The only thing is, it will also return values that are past the board. You could check this using your preexisting <code>possibleMoves</code> function:</p>\n\n<pre><code>import Data.List (intersect)\nsafeKnight = intersect possibleMoves . knight\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 12189211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916d741c3407c241c286e5b38d11478f?s=128&d=identicon&r=PG&f=1", "display_name": "vNSkyline", "link": "https://stackoverflow.com/users/12189211/vnskyline"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 59328657, "answer_count": 2, "score": 0, "last_activity_date": 1577322255, "creation_date": 1576252491, "last_edit_date": 1576257156, "question_id": 59325917, "link": "https://stackoverflow.com/questions/59325917/simple-chess-function-in-haskell", "title": "Simple chess function in Haskell", "body": "<p>My homework is to write simple functions related to chess. The <code>rook</code> function is working fine i guess it shows where can you step from the given start coordinate. And now I'm stuck with the <code>knight</code> function. My idea is to filter the coordinates list by the following condition: If the abs value of the coordinate differences is 3 and the rows are different then its a valid step. But I don't really know how should i implement this in Haskell. Any idea how should i do that?</p>\n\n<p>My Code:</p>\n\n<pre><code>import Data.List\n\npossibleMoves = [ (x, y) | x &lt;- [0..7], y &lt;- [7,6..0]]\n\nrook :: (Int, Int) -&gt; [(Int, Int)]\nrook (x,y) = filter (/=(x,y)) (filter ((==y).snd) possibleMoves ++ filter ((==x).fst ) possibleMoves)\n\nknight :: (Int, Int) -&gt; [(Int, Int)] \nknight (x,y) = filter ((==3)((abs(y - head(map snd(possibleMoves))))).snd) possibleMoves\n</code></pre>\n\n<p>Resulting the following error :</p>\n\n<pre><code>    * Couldn't match expected type `Int -&gt; Bool'\n                  with actual type `Bool'\n    * Possible cause: `== 3' is applied to too many arguments\n      In the first argument of `(.)', namely\n        `(== 3) ((abs (y - head (map snd (possibleMoves)))))'\n      In the first argument of `filter', namely\n        `((== 3) ((abs (y - head (map snd (possibleMoves))))) . snd)'\n      In the expression:\n        filter\n          ((== 3) ((abs (y - head (map snd (possibleMoves))))) . snd)\n          possibleMoves\n  |\n9 | knight (x,y) = filter ((==3)((abs(y - head(map snd(possibleMoves))))).snd) possibleMoves\n  |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "types", "sudoku", "quickcheck"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1576249678, "post_id": 59324953, "comment_id": 104849715, "body": "&quot;I need it to output as a Property&quot; Why?"}, {"owner": {"reputation": 197, "user_id": 11094853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26974b35c81e0675ca4416101ebf045?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/11094853/alex"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1576249764, "post_id": 59324953, "comment_id": 104849765, "body": "@MarkSeemann This is part of an assignment, they have deemed that it be the output."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1576250448, "post_id": 59324953, "comment_id": 104850107, "body": "That doesn&#39;t seem to make much sense, but I suppose you could use one of the functions in <a href=\"https://hackage.haskell.org/package/QuickCheck/docs/Test-QuickCheck.html\" rel=\"nofollow noreferrer\">the QuickCheck library</a> that return <code>Property</code>. Perhaps rewrite your property so that it compares expected and actual values with <code>===</code>, or perhaps the <code>total</code> function could be handy..."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 1, "last_activity_date": 1576265134, "creation_date": 1576265134, "answer_id": 59328678, "question_id": 59324953, "link": "https://stackoverflow.com/questions/59324953/how-do-you-create-quickcheck-properties-with-a-property-output-in-haskell/59328678#59328678", "title": "How do you create quickCheck properties with a Property output in Haskell?", "body": "<p>At the very simplest, you can use <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:property\" rel=\"nofollow noreferrer\"><code>property</code></a> method to convert e.g. <code>Bool</code> to <code>Property</code>. I suggest to look at the instances of <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#t:Testable\" rel=\"nofollow noreferrer\"><code>Testable</code></a> class, and try to understand what each of them does, and how it can be used.</p>\n\n<p>Or you can be more sophisticated and use some other functions returning <code>Property</code>, e.g. <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:-61--61--61-\" rel=\"nofollow noreferrer\"><code>===</code></a>. That might be tricky in your example.</p>\n\n<p>One quite useful function, is <a href=\"https://hackage.haskell.org/package/QuickCheck-2.13.2/docs/Test-QuickCheck.html#v:counterexample\" rel=\"nofollow noreferrer\"><code>counterexample</code></a>. It allows you to print additional output, when property doesn't hold. For example, it's used to implement <code>===</code>:</p>\n\n<pre><code>(===) :: (Eq a, Show a) =&gt; a -&gt; a -&gt; Property\nx === y =\n  counterexample (show x ++ interpret res ++ show y) res\n  where\n    res = x == y\n    interpret True  = \" == \"\n    interpret False = \" /= \"\n</code></pre>\n\n<p>As this is an assignment, I'm not giving you any more hints.</p>\n"}], "owner": {"reputation": 197, "user_id": 11094853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26974b35c81e0675ca4416101ebf045?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/11094853/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 59328678, "answer_count": 1, "score": 1, "last_activity_date": 1576265134, "creation_date": 1576248886, "last_edit_date": 1576249652, "question_id": 59324953, "link": "https://stackoverflow.com/questions/59324953/how-do-you-create-quickcheck-properties-with-a-property-output-in-haskell", "title": "How do you create quickCheck properties with a Property output in Haskell?", "body": "<p>How do you create a property that checks that all solutions provided are valid solutions, I need it to output as a Property, but I'm unsure how to do that, I only understand how to do Bool outputs for quickCheck properties. See below for my attempt, and the general idea of how I want it to function:</p>\n\n<pre><code>solve :: Sudoku -&gt; Maybe Sudoku\nsolve s = solve' (blanks s) s\n\nsolve' :: [Pos] -&gt; Sudoku -&gt; Maybe Sudoku\nsolve' blankl s\n    | not (isOkay s)        = Nothing\n    | isFilled s            = Just s\n    | otherwise             = listToMaybe [fromJust sol | n &lt;- [1..9], \n                                            let sol = solve' (tail blankl) (update s (head blankl) (Just n)),\n                                            sol /= Nothing]\n\nisSolutionOf :: Sudoku -&gt; Sudoku -&gt; Bool\nisSolutionOf s1 s2 = \n    isOkay s1 \n    &amp;&amp; isFilled s1\n    &amp;&amp; and [ a == b || b == Nothing | \n             (a,b) &lt;- zip (concat (rows s1)) (concat (rows s2)) ]\n\nprop_SolveSound :: Sudoku -&gt; Property\nprop_SolveSound s \n    | solution == Nothing = True\n    | otherwise           = isSolutionOf (fromJust solution) s where\n                              solution = solve s\n</code></pre>\n\n<p>Any help is much appreciated, I guess what I'm asking is how can you convert the - quite clearly - <code>Bool</code> output from <code>prop_SolveSound</code> to a <code>Property</code> output?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1576259500, "post_id": 59319774, "comment_id": 104854430, "body": "Right, thank you - but the newtype means that I can&#39;t use it for its original intent, an instance of <code>Foo</code> for (<code>NonNull [a]</code>) (for all a).  Given that the kind of NonNull * -&gt; <i>, and the kind of [] is * -&gt; *; surely the kind of NonNull [] is *-&gt;</i>, which is the same as []; hence, I would hope to be able to express this."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1576264360, "post_id": 59319774, "comment_id": 104856479, "body": "You are missing escapes, so I am not sure what you expect the kind of <code>NonNull</code> to be. But in fact it is <code>* -&gt; *</code>, so <code>NonNull []</code> doesn&#39;t kind-check."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1576313624, "post_id": 59319774, "comment_id": 104865667, "body": "You are right, I mean <code>* -&gt; *</code>; and <code>[]</code> is also <code>* -&gt; *</code>, so I expect the kind of <code>NonNull []</code> to be <code>* -&gt; *</code>, which is the same as <code>[]</code>; which does kind-check.  To be clear, I am sure that you are correct, I am trying to understand why my reasoning fails."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1576320465, "post_id": 59319774, "comment_id": 104866911, "body": "<code>NonNull :: * -&gt; *</code> means its argument can only be <code>*</code>, not <code>* -&gt; *</code>. It works for kinds just like for types; if you have <code>not :: Bool -&gt; Bool</code>, <code>not not</code> doesn&#39;t typecheck."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 4, "last_activity_date": 1576230870, "last_edit_date": 1576230870, "creation_date": 1576229955, "answer_id": 59319774, "question_id": 59319013, "link": "https://stackoverflow.com/questions/59319013/haskell-instance-wrapping/59319774#59319774", "title": "Haskell Instance wrapping []", "body": "<p>Your last attempt is the closest one, but you need a <code>newtype</code> instead of a <code>type</code> synonym (<code>data</code> would work too):</p>\n\n<pre><code>newtype NonNullList \u03b1 = NonNullList (NonNull [\u03b1])\n\ninstance ToSeq NonNullList where ...\n</code></pre>\n\n<p><code>NonNull []</code> which you tried first doesn't make sense because <code>NonNull</code>'s argument must be a type (like <code>[Int]</code>), not a type constructor like <code>[]</code>. You should see a second error, like <a href=\"https://repl.it/repls/LawfulSevereShoutcast\" rel=\"nofollow noreferrer\">in this similar example</a>:</p>\n\n<pre><code>instance Functor (Maybe []) where\n\nmain.hs:5:19: error:\n    \u2022 Expected kind \u2018* -&gt; *\u2019, but \u2018Maybe []\u2019 has kind \u2018*\u2019\n    \u2022 In the first argument of \u2018Functor\u2019, namely \u2018(Maybe [])\u2019\n      In the instance declaration for \u2018Functor (Maybe [])\u2019\n  |\n5 | instance Functor (Maybe []) where\n  |                   ^^^^^^^^\nmain.hs:5:25: error:\n    \u2022 Expecting one more argument to \u2018[]\u2019\n      Expected a type, but \u2018[]\u2019 has kind \u2018* -&gt; *\u2019\n    \u2022 In the first argument of \u2018Maybe\u2019, namely \u2018[]\u2019\n      In the first argument of \u2018Functor\u2019, namely \u2018(Maybe [])\u2019\n      In the instance declaration for \u2018Functor (Maybe [])\u2019\n  |\n5 | instance Functor (Maybe []) where\n  |                         ^^\n</code></pre>\n"}], "owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1576230870, "creation_date": 1576227020, "question_id": 59319013, "link": "https://stackoverflow.com/questions/59319013/haskell-instance-wrapping", "title": "Haskell Instance wrapping []", "body": "<p>I'm trying to create an instance of a type that wraps []; i.e.,</p>\n\n<pre><code>instance Foo (NonNull []) where\n</code></pre>\n\n<p>(where NonNull is Michael Snoyman's <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.13.0/docs/Data-NonNull.html\" rel=\"nofollow noreferrer\">Data.NonNull</a>)\nThis works fine for, say,</p>\n\n<pre><code>instance Foo [] where\n</code></pre>\n\n<p>But with <code>NonNull []</code>, I get </p>\n\n<pre><code>Expected kind \u2018* -&gt; *\u2019, but \u2018NonNull []\u2019 has kind \u2018*\u2019\n</code></pre>\n\n<p>I have tried using RankNTypes to provide an explicit forall:</p>\n\n<pre><code>instance \u2200 \u03b1 . Foo (NonNull [\u03b1]) where\n</code></pre>\n\n<p>With a similar result:</p>\n\n<pre><code>Expected kind \u2018* -&gt; *\u2019, but \u2018NonNull [\u03b1]\u2019 has kind \u2018*\u2019\n</code></pre>\n\n<p>And also a type synonym:</p>\n\n<pre><code>type NonNullList \u03b1 = NonNull [\u03b1]\ninstance ToSeq NonNullList where\n</code></pre>\n\n<p>which gives:</p>\n\n<pre><code>The type synonym \u2018NonNullList\u2019 should have 1 argument, but has been given none\n</code></pre>\n\n<p>I'm sure this must be possible, but I am missing the incantation.\nAny pointers gratefully received.</p>\n"}, {"tags": ["haskell", "recursion", "lazy-evaluation", "function-composition"], "comments": [{"owner": {"reputation": 356, "user_id": 3966456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1677e4fdd3c56cfca9d2711064876394?s=128&d=identicon&r=PG&f=1", "display_name": "Weijun Zhou", "link": "https://stackoverflow.com/users/3966456/weijun-zhou"}, "edited": false, "score": 0, "creation_date": 1576256790, "post_id": 59318876, "comment_id": 104853187, "body": "After various attempts, I found <code>flip (foldl&#39; (&amp;)) (repeat x)</code> with <code>(&amp;)</code> from <code>Data.Function</code> to be a working version with <code>fold*</code> and friends."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1576313800, "post_id": 59318876, "comment_id": 104865696, "body": "yes, because <code>z &amp; x = x $ z</code> and <code>foldl&#39;</code> is forcing the accumulator value as it goes along the list, that is equivalent to <code>flip (foldl&#39; (&amp;)) (repeat x) z = foldl&#39; (&amp;) z (repeat x) = let {z1 = x $! z} in foldl&#39; (&amp;) z1 (repeat x) = let {z1 = x $! z} in let {z2 = x $! z1} in foldl&#39; (&amp;) z2 (repeat x) = ...</code>."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1576314040, "post_id": 59320616, "comment_id": 104865742, "body": "the actual definition is just an implementation of the equation specification above it, so it&#39;s all good."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 3, "last_activity_date": 1576232853, "creation_date": 1576232853, "answer_id": 59320616, "question_id": 59318876, "link": "https://stackoverflow.com/questions/59318876/laziness-in-recursive-function-composition/59320616#59320616", "title": "Laziness in recursive function composition", "body": "<p>Let's start with <code>iterateUntilError1</code>. If you try to evaluate</p>\n\n<pre><code>iterateUntilError1 tail [1..5] =\n</code></pre>\n\n<p>expand definition of <code>iterateUntilError1</code>: </p>\n\n<pre><code>((iterateUntilError1 tail) . tail) [1..5] =\n</code></pre>\n\n<p>expand definition of <code>.</code>:</p>\n\n<pre><code>(iterateUntilError1 tail) (tail [1..5]) =\n</code></pre>\n\n<p>wait, we have <code>iterateUntilError1 tail</code> again!</p>\n\n<pre><code>((iterateUntilError1 tail) . tail) (tail [1..5]) =\n(iterateUntilError1 tail) (tail (tail [1..5]))\n</code></pre>\n\n<p>and so on.</p>\n\n<p>With <code>iterateUntilError3</code> you have (inserting some extra parentheses to make priority more clear)</p>\n\n<pre><code>iterateUntilError3 tail [1..5] =\n((iterateUntilError3 tail) . tail) $! [1..5] =\n((iterateUntilError3 tail) . tail) (1:[2..5]) = \niterateUntilError3 tail (tail (1:[2..5])) =\n(iterateUntilError3 tail . tail) $! (tail (1:[2..5])) =\n(iterateUntilError3 tail . tail) (2:[3..5]) = ...\n</code></pre>\n\n<p>and so it ends up getting an error. </p>\n\n<p>With <code>iterateUntilError2</code>, you have similar evaluation until the line before last where <code>$!</code> forces <code>tail</code> to reduce until getting a constructor and <code>$</code> doesn't:</p>\n\n<pre><code>(iterateUntilError2 tail . tail) $ (tail [1..5]) =\n(iterateUntilError2 tail . tail) (tail [1..5]) =\n(iterateUntilError2 tail) (tail (tail [1..5])) = ...\n</code></pre>\n\n<p>And finally (using <code>tail_</code> for <code>(tail $!)</code> for simplicity):</p>\n\n<pre><code>iterateUntilError4 tail [1..5] =\nfoldl1 (.) (repeat tail_) [1..5] = \nfoldl (.) tail_ (repeat tail_) [1..5] =\nfoldl (.) (tail_ . tail_) (repeat tail_) [1..5] =\nfoldl (.) (tail_ . tail_ . tail_) (repeat tail_) [1..5] = ...\n</code></pre>\n\n<p>(for this one I didn't follow <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#foldl\" rel=\"nofollow noreferrer\">the actual definition</a> but the idea should still be right, I think).</p>\n"}], "owner": {"reputation": 356, "user_id": 3966456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1677e4fdd3c56cfca9d2711064876394?s=128&d=identicon&r=PG&f=1", "display_name": "Weijun Zhou", "link": "https://stackoverflow.com/users/3966456/weijun-zhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 59320616, "answer_count": 1, "score": 3, "last_activity_date": 1576232853, "creation_date": 1576226488, "question_id": 59318876, "link": "https://stackoverflow.com/questions/59318876/laziness-in-recursive-function-composition", "title": "Laziness in recursive function composition", "body": "<p>I am trying to understand the lazy evaluation of Haskell and made the following attempt in <code>GHCi</code></p>\n\n<pre><code>GHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set +m\nPrelude&gt; let iterateUntilError1 :: (a-&gt;a) -&gt; (a-&gt;a)\nPrelude|     iterateUntilError1 f = (iterateUntilError1 f) . f\nPrelude| \nPrelude&gt; let iterateUntilError2 :: (a-&gt;a) -&gt; (a-&gt;a)\nPrelude|     iterateUntilError2 f = \\x -&gt; (iterateUntilError2 f) . f $ x\nPrelude| \nPrelude&gt; let iterateUntilError3 :: (a-&gt;a) -&gt; (a-&gt;a)\nPrelude|     iterateUntilError3 f = \\x -&gt; (iterateUntilError3 f) . f $! x\nPrelude| \nPrelude&gt; let iterateUntilError4 x = foldl1 (.) (repeat (($!) x))\nPrelude&gt; iterateUntilError3 tail [1..5]\n*** Exception: Prelude.tail: empty list\nPrelude&gt; iterate tail [1..5]\n[[1,2,3,4,5],[2,3,4,5],[3,4,5],[4,5],[5],[],*** Exception: Prelude.tail: empty list\n</code></pre>\n\n<p>Among the 4 versions presented, only <code>iterateUntilError3</code> works as expected, the other 3 versions enter an infinite loop that has to be stopped via <kbd>Ctrl</kbd>+<kbd>C</kbd>. I don't quite understand why the other three versions don't work in this case.</p>\n\n<p>The related question <a href=\"https://stackoverflow.com/questions/9032295/laziness-and-function-composition-haskell-erlang\">laziness and function composition (haskell, erlang)</a> does not seem to address the issues presented in this question.</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 2, "creation_date": 1576204426, "post_id": 59315282, "comment_id": 104832180, "body": "I don&#39;t mind downvotes, but if you have an issue with the answer I would be happy to improve it."}], "tags": [], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "is_accepted": false, "score": 1, "last_activity_date": 1576203618, "creation_date": 1576203618, "answer_id": 59315282, "question_id": 59315118, "link": "https://stackoverflow.com/questions/59315118/how-can-i-modify-the-windowset-in-xmonad/59315282#59315282", "title": "How can I modify the windowSet in XMonad?", "body": "<p>The <code>X</code> monad has an instance of <code>MonadState</code></p>\n\n<pre><code>instance MonadState XState X\n</code></pre>\n\n<p>So we can use <code>modify</code> as</p>\n\n<pre><code>modify :: (XState -&gt; XState) -&gt; X ()\n</code></pre>\n\n<p>So we need to turn out function to one on <code>XState</code>s.  And if we look at the definition </p>\n\n<pre><code>XState\n    windowset :: !WindowSet\n    mapped :: !(Set Window)\n    waitingUnmap :: !(Map Window Int)\n    dragging :: !(Maybe (Position -&gt; Position -&gt; X (), X ())) \n    numberlockMask :: !KeyMask\n    extensibleState :: !(Map String (Either String StateExtension))\n</code></pre>\n\n<p>we will see <code>WindowSet</code> which is a type alias for a particular <code>StackState</code>.  So you can turn a function from <code>StackState</code>s into one on <code>XState</code>s like so:</p>\n\n<pre><code>overWindowSet :: (WindowSet -&gt; WindowSet) -&gt; XState -&gt; XState\noverWindowSet f xState = xState { windowset = f (windowset xState) }\n</code></pre>\n\n<p>This can be combined with <code>modify</code> to make the complete function you would like:</p>\n\n<pre><code>modify . overWindowSet\n</code></pre>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576238678, "creation_date": 1576202176, "last_edit_date": 1576238678, "question_id": 59315118, "link": "https://stackoverflow.com/questions/59315118/how-can-i-modify-the-windowset-in-xmonad", "title": "How can I modify the windowSet in XMonad?", "body": "<p>I have a function that looks like:</p>\n\n<pre><code>sinkFocus :: StackSet i l a s sd -&gt; Maybe (StackSet i l a s sd)\nsinkFocus = (fmap . flip sink) &lt;*&gt; peek\n</code></pre>\n\n<p>However I would like an <code>X ()</code> so that I can use it.  For example <code>additionalKeys</code> uses an <code>X ()</code>.</p>\n\n<p>The documentation says that <code>X</code> is a <code>IO</code> with some state and reader transformers, so I am under the impression that the <code>StackSet</code> is contained within the state of <code>X</code>.  So in theory it should be possible to modify the relevant part of the state.  However the state accessible is <code>XState</code> not the <code>StackState</code> I want, so I need to be able to turn my function on <code>StackState</code> to one on <code>XState</code>.</p>\n\n<p>This would be easy enough if I had a function of the type</p>\n\n<pre><code>(StackSet i l a s sd -&gt; StackSet i l a s sd) -&gt; X ()\n</code></pre>\n\n<p>However after digging around in the documentation I haven't been able to piece together a way to do this yet.  Is there a way to take a function on <code>StackSet</code> and make an <code>X ()</code> that performs that function?   </p>\n"}, {"tags": ["postgresql", "haskell", "postgresql-simple"], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 2, "last_activity_date": 1576257375, "creation_date": 1576257375, "answer_id": 59327132, "question_id": 59314764, "link": "https://stackoverflow.com/questions/59314764/how-to-retrieve-json-jsonb-value-with-postgresql-simple/59327132#59327132", "title": "How to retrieve JSON jsonb value with postgresql-simple?", "body": "<p>Looking at the <code>FromField</code> instances here (<a href=\"http://hackage.haskell.org/package/postgresql-simple-0.6.2/docs/Database-PostgreSQL-Simple-FromField.html#t:FromField\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/postgresql-simple-0.6.2/docs/Database-PostgreSQL-Simple-FromField.html#t:FromField</a>) I realized it should be a <code>Value</code> and not a <code>Object</code>.</p>\n\n<p>Hence:</p>\n\n<pre><code>selectCALogs :: IO [(Int, Value)]\nselectCALogs = do\n  con &lt;- connection\n  query_ con \"select \\\"clusterId\\\", \\\"jsonExample\\\" from cluster\"\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 59327132, "answer_count": 1, "score": 0, "last_activity_date": 1576257375, "creation_date": 1576198722, "question_id": 59314764, "link": "https://stackoverflow.com/questions/59314764/how-to-retrieve-json-jsonb-value-with-postgresql-simple", "title": "How to retrieve JSON jsonb value with postgresql-simple?", "body": "<p>I have a column (<code>jsonExample</code>) in the postgresql database with type <code>jsonb</code>.</p>\n\n<pre><code>selectCALogs :: IO [(Int, Object)]\nselectCALogs = do\n  con &lt;- connection\n  query_ con \"select \\\"clusterId\\\", \\\"jsonExample\\\" from cluster\"\n</code></pre>\n\n<p>This gives an error of:</p>\n\n<pre><code>    \u2022 No instance for (Database.PostgreSQL.Simple.FromField.FromField\n                         (unordered-containers-0.2.10.0:Data.HashMap.Base.HashMap\n                            Text Value))\n        arising from a use of \u2018query_\u2019\n    \u2022 In a stmt of a 'do' block:\n        query_ con \"select \\\"clusterId\\\", \\\"clusterCALogs\\\" \nfrom cluster\"\n      In the expression:\n        do con &lt;- connection\n           query_ con \"select \\\"clusterId\\\", \\\"clusterCALogs\\\"from cluster\"\n      In an equation for \u2018selectCALogs\u2019:\n          selectCALogs\n            = do con &lt;- connection\n                 query_ con \"select \\\"clusterId\\\", \n\\\"clusterCALogs\\\" from cluster\"\n   |\n80 |   query_ con \"select \\\"clusterId\\\", \\\"clusterCALogs\\\" \nfrom cluster\"\n   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>How can I have it return a JSON object - using aeson or something else?</p>\n"}, {"tags": ["sql", "postgresql", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 1, "last_activity_date": 1576265564, "creation_date": 1576265564, "answer_id": 59328750, "question_id": 59314156, "link": "https://stackoverflow.com/questions/59314156/how-can-i-fix-operator-does-not-exist-text-uuid-when-using-haskells-postgr/59328750#59328750", "title": "How can I fix &quot;operator does not exist: text = uuid&quot; when using Haskell&#39;s postgres-simple library to perform a multi-row insert?", "body": "<p>To help debug your issue, use <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.6.2/docs/Database-PostgreSQL-Simple.html#v:formatQuery\" rel=\"nofollow noreferrer\"><code>formatQuery</code></a> function, then you can see what kind of final query <code>postgresql-simple</code> is sending to the server.</p>\n\n<p>Also, I'd recommend using <a href=\"https://hackage.haskell.org/package/uuid-types-1.0.3/docs/Data-UUID-Types.html#t:UUID\" rel=\"nofollow noreferrer\"><code>UUID</code></a> type from <code>uuid-types</code> package, instead of <code>Text</code> for the uuids. Using <code>Text</code> most likely hides some issues from you (which you'll hopefully see by using <code>formatQuery</code>.</p>\n"}], "owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 0, "accepted_answer_id": 59328750, "answer_count": 1, "score": 3, "last_activity_date": 1576265564, "creation_date": 1576193477, "last_edit_date": 1576193778, "question_id": 59314156, "link": "https://stackoverflow.com/questions/59314156/how-can-i-fix-operator-does-not-exist-text-uuid-when-using-haskells-postgr", "title": "How can I fix &quot;operator does not exist: text = uuid&quot; when using Haskell&#39;s postgres-simple library to perform a multi-row insert?", "body": "<p>I am using the postgres-simple library to insert into the <code>eligible_class_passes</code> table. Which is essentially a join table representing a many to many relationship.</p>\n\n<p>I am using the <a href=\"http://hackage.haskell.org/package/postgresql-simple-0.6.2/docs/Database-PostgreSQL-Simple.html#v:executeMany\" rel=\"nofollow noreferrer\"><code>executeMany</code></a> function from the <code>postgres-simple</code> to do a multi row insert.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>updateEligibleClassPasses :: Connection -&gt; Text -&gt; Text -&gt; [Text] -&gt; IO Int64\nupdateEligibleClassPasses conn tenantId classTypeId classPassTypeIds =\n  withTransaction conn $ do\n    executeMany\n      simpleConn\n      [sql| \n      INSERT INTO eligible_class_passes (class_type_id, class_pass_type_id)\n      SELECT upd.class_type_id::uuid, upd.class_pass_type_id::uuid\n      FROM (VALUES (?, ?, ?)) as upd(class_type_id, class_pass_type_id, tenant_id)\n      INNER JOIN class_types AS ct\n      ON upd.class_type_id::uuid = ct.id\n      INNER JOIN subscription_types AS st\n      ON class_pass_type_id::uuid = st.id\n      WHERE ct.tenant_id = upd.tenant_id::uuid AND st.tenant_id = upd.tenant_id::uuid\n      |]\n      params\n where\n  addParams classPassTypeId = (classTypeId, classPassTypeId, tenantId)\n  params = addParams &lt;$&gt; classPassTypeIds\n</code></pre>\n\n<p>When this function is executed with the correct parameters applied I get the following runtime error</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>SqlError {sqlState = \"42883\", sqlExecStatus = FatalError, sqlErrorMsg = \"operator does not exist: text = uuid\", sqlErrorDetail = \"\", sqlErrorHint = \"No operator matches the given name and argument type(s). You might need to add explicit type casts.\"}\n</code></pre>\n\n<p>However, when translated to SQL without the parameter substitutions (?) the query works correctly when executed in psql.</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>INSERT INTO eligible_class_passes (class_type_id, class_pass_type_id)\nSELECT upd.class_type_id::uuid, upd.class_pass_type_id::uuid\nFROM (VALUES ('863cb5ea-7a68-41d5-ab9f-5344605de500', 'e9195660-fd48-4fa2-9847-65a0ad323bd5', '597e6d7a-092a-49be-a2ea-11e8d85d8f82')) as upd(class_type_id, class_pass_type_id, tenant_id)\nINNER JOIN class_types AS ct\nON upd.class_type_id::uuid = ct.id\nINNER JOIN subscription_types AS st\nON class_pass_type_id::uuid = st.id\nWHERE ct.tenant_id = upd.tenant_id::uuid AND st.tenant_id = upd.tenant_id::uuid;        \n</code></pre>\n\n<p>My schema is as follows</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\nCREATE TABLE tenants (\n  id UUID NOT NULL DEFAULT uuid_generate_v4() PRIMARY KEY, \n  name text NOT NULL UNIQUE, \n  email text NOT NULL UNIQUE, \n  created_at timestamp with time zone NOT NULL default now(), \n  updated_at timestamp with time zone NOT NULL default now()\n);\n\nCREATE TABLE class_types (\n  id UUID NOT NULL DEFAULT uuid_generate_v4() PRIMARY KEY, \n  FOREIGN KEY (tenant_id) REFERENCES tenants (id), \n  created_at timestamp with time zone NOT NULL default now(), \n  updated_at timestamp with time zone NOT NULL default now()\n);\n\nCREATE TABLE class_pass_types (\n  id UUID NOT NULL DEFAULT uuid_generate_v4() PRIMARY KEY, \n  name TEXT NOT NULL, \n  tenant_id UUID NOT NULL, \n  price Int NOT NULL, \n  created_at timestamp with time zone NOT NULL default now(), \n  updated_at timestamp with time zone NOT NULL default now(), \n  FOREIGN KEY (tenant_id) REFERENCES tenants (id)\n);\n\n-- Many to many join through table.\n-- Expresses class pass type redeemability against class types.\nCREATE TABLE eligible_class_passes (\n  class_type_id UUID, \n  class_pass_type_id UUID, \n  created_at timestamp with time zone NOT NULL default now(), \n  updated_at timestamp with time zone NOT NULL default now(), \n  FOREIGN KEY (class_type_id) REFERENCES class_types (id) ON DELETE CASCADE, \n  FOREIGN KEY (class_pass_type_id) REFERENCES class_pass_types (id) ON DELETE CASCADE, \n  PRIMARY KEY (\n    class_type_id, class_pass_type_id\n  )\n);\n</code></pre>\n"}, {"tags": ["haskell", "tree", "maybe"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1576187676, "post_id": 59312801, "comment_id": 104828358, "body": "<code>data Tree a = Tree (Maybe (a,Tree a,Tree a))</code> seems to be appointing <code>Nothing</code> to <code>Empty</code> and <code>Just</code> to <code>Node</code> in the original definition. What exactly it is good for..?"}], "answers": [{"comments": [{"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1576186349, "post_id": 59312878, "comment_id": 104827867, "body": "I think you are referring to the solution which I&#39;ve just included in my answer. Even if it is effective, I found it a bit &quot;clunky&quot;."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 3, "creation_date": 1576186758, "post_id": 59312878, "comment_id": 104828020, "body": "@EnricoMariaDeAngelis Ah, right. I missed that. What&#39;s clunky about it? I don&#39;t think there&#39;s another easy way. From a type-theoretic point of view, the standard tree definition is <code>Tree a = 1 + (a * Tree a * Tree a)</code> where <code>+</code> denotes a sum type, <code>*</code> a product type, <code>1</code> a unit type. In Haskell, that translates to <code>Tree a = Either () (a, Tree a, Tree a)</code> and <code>Either ()</code> is best written as <code>Maybe</code>."}, {"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1576321880, "post_id": 59312878, "comment_id": 104867216, "body": "My level of type theory is pretty low (if not zero), so I will probably come back to this comment of yours at some point in the future."}, {"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1576321884, "post_id": 59312878, "comment_id": 104867218, "body": "However, it would be great if you could clarify the last part: <i><code>Either ()</code> is best written as <code>Maybe</code></i>; my understanding is that both <code>Maybe</code> and <code>Either ()</code> are type ctors taking 1 concrete type <code>a</code> to produce either a value of type <code>a</code> wrapped in <i>something</i>, or <i>somethingelse</i>, where <i>something</i> is <code>Just</code> for <code>Maybe</code> and <code>Right</code> for <code>Either</code>, and <i>somethingelse</i> is <code>Nothing</code> for <code>Maybe</code> and <code>Left ()</code> for <code>Either ()</code>. So they look two different things to me (even though they can encode the same information)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 2, "creation_date": 1576326777, "post_id": 59312878, "comment_id": 104868340, "body": "@EnricoMariaDeAngelis What you wrote is correct. They are two distinct types, but they encode the same information. In type theory we say that these are isomorphic, since there are two functions <code>f :: Maybe a -&gt; Either () a</code> and <code>g :: Either () a -&gt; Maybe a</code> which are mutual inverses. In many cases, we don&#39;t really distinguish between the two because of this reason. In practice, in Haskell it&#39;s unusual to use <code>Either () a</code>, since <code>Maybe a</code> can do the same job and is conceptually simpler to understand. It&#39;s only a matter of taste, in a sense."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1576185603, "creation_date": 1576185603, "answer_id": 59312878, "question_id": 59312801, "link": "https://stackoverflow.com/questions/59312801/real-world-haskell-chapter-3-excercise-binary-tree-with-1-value-constructor-f/59312878#59312878", "title": "Real World Haskell Chapter 3 excercise: Binary Tree with 1 value constructor - follow up", "body": "<p>Here's a hint: you can turn any n-ary constructor into a 1-ary one using a n-tuple type.</p>\n\n<p>For instance, your tree type is isomorphic to the following one:</p>\n\n<pre><code>data Tree a = Node (a, Tree a, Tree a)\n            | Empty\n</code></pre>\n\n<p>I think you should now be able to turn this type into one which only involves one constructor.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576209831, "post_id": 59315161, "comment_id": 104833226, "body": "Why are you posting an answer that just restates what others have said?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576300189, "post_id": 59315161, "comment_id": 104863787, "body": "@chepner to summarise and condense it all in an answer"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1576202639, "creation_date": 1576202639, "answer_id": 59315161, "question_id": 59312801, "link": "https://stackoverflow.com/questions/59312801/real-world-haskell-chapter-3-excercise-binary-tree-with-1-value-constructor-f/59315161#59315161", "title": "Real World Haskell Chapter 3 excercise: Binary Tree with 1 value constructor - follow up", "body": "<p>The answer of @chi alongside his comments says all, it could be done with either as:</p>\n\n<pre><code>data Tree a = T (Either () (a, Tree a, Tree a)) deriving Show\n</code></pre>\n\n<p>And an example of a tree is:</p>\n\n<pre><code>node1 = T $ Right (\"data node 1\", node2, node3)\nnode2 = T $ Left ()\nnode3 = T $ Right (\"data node 3\", node2, node2)\n\n  $&gt; node1\nT (Right (\"data node 1\",T (Left ()),T (Right (\"data node 3\",T (Left ()),T (Left ())))))\n</code></pre>\n\n<p>But everybody already also said, that can be replaced with Maybe, because <code>Either ()</code> can be seen as <code>Maybe a</code></p>\n"}], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 59312878, "answer_count": 2, "score": 3, "last_activity_date": 1576202639, "creation_date": 1576185331, "last_edit_date": 1576187342, "question_id": 59312801, "link": "https://stackoverflow.com/questions/59312801/real-world-haskell-chapter-3-excercise-binary-tree-with-1-value-constructor-f", "title": "Real World Haskell Chapter 3 excercise: Binary Tree with 1 value constructor - follow up", "body": "<p><strong>This question is not a duplicate</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/6613871/real-world-haskell-chapter-3-excercise-binary-tree-with-1-value-constructor\">A question with the same title already exists</a>, but the <a href=\"https://stackoverflow.com/a/6614006/5825294\">answer</a> only partially addressed it, in my opinion, and I am interested also in what it left unaswered.</p>\n\n<p><strong>Foreword</strong></p>\n\n<p>Real World Haskell proposes, in Chapter 3, page 58, the following definition for a binary tree datatype,</p>\n\n<pre><code>data Tree a = Node a (Tree a) (Tree a)\n            | Empty\n              deriving (Show)\n</code></pre>\n\n<p>which provides two constructors (for empty and non-empty <code>Tree</code>s).</p>\n\n<p>On the other hand, at page 60, an exercise challenges the reader to define the <code>Tree</code> datatype by using a single constructor.</p>\n\n<p>After several attempts, I came up with the same solution as the one linked above:</p>\n\n<pre><code>data Tree a = Node a (Maybe (Tree a)) (Maybe (Tree a)) deriving(Show)\n</code></pre>\n\n<p><strong>What is unanswered in the linked question</strong></p>\n\n<p>The drawback of this definition is that it does not allow the instantiation of an empty <code>Tree</code>, although it allows the instantiation of a <code>Tree</code> with empty children through the following syntax:</p>\n\n<pre><code>Node 3 Nothing (Just (Node 2 Nothing Nothing))\n</code></pre>\n\n<p>I think that there's not much a better solution than the above, if not having a \"standalone\" empty tree is acceptable and the requirement is to use one constructor only. </p>\n\n<p>Having some comment on the above statement would be nice; however, my main question is how can I define <code>Tree</code> with one constructor such that I can instantiate an empty <code>Tree</code>?</p>\n\n<p>Now that I've written the question, I think that one possible answer is the following, of which I am not at all sure:</p>\n\n<p><em>If a children being empty or not is encoded in whether it is costructed through <code>Nothing</code> or <code>Just (Node ...)</code>, pretty much the same holds for the whole tree (or root node), which can be indeed defined itself as a <code>Nothing</code> or <code>Just (Node ...)</code>; this is to say that with only one constructor, <code>Nothing</code> is the way to instanciate an empty tree. (In other words, I'm just starting to think that this question is inherently \"ill-formed\". Notheless I'll post it, as I think I can learn something your comments/answers.)</em></p>\n\n<p>Does the above make any sense?</p>\n\n<p><strong>A possible answer</strong></p>\n\n<p>A comment in the original question proposes the following solution</p>\n\n<pre><code>data Tree a = Tree (Maybe (a,Tree a,Tree a))\n</code></pre>\n\n<p>which (my understanding) allows to instantiate an emtpy tree by <code>Node Nothing</code>, or a non-empty tree by <code>Node (Just (value,child1,child2))</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1576169983, "post_id": 59309340, "comment_id": 104821154, "body": "To be pedantic, you are asking about Haskell <i>implementations</i> (presumably, GHC in particular). How Haskell itself works is defined in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/\" rel=\"nofollow noreferrer\">Haskell Report</a>."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1576170560, "post_id": 59309340, "comment_id": 104821403, "body": "A disassembler cannot help you, because the assembly language of modern machines does not describe Haskell semantics well. As far as I know (I may not be accurate), the GHC translates into the abstract code of the G-machine, and then the interpretation of this code is described in assembler."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1576258195, "post_id": 59309340, "comment_id": 104853814, "body": "There&#39;s certainly no need for <i>disassembly</i>. You can ask GHC to output the assembly or LLVM code it generates."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1576351847, "creation_date": 1576351847, "answer_id": 59338472, "question_id": 59309340, "link": "https://stackoverflow.com/questions/59309340/understanding-how-ghc-compiled-code-works-at-the-lowest-level/59338472#59338472", "title": "Understanding how GHC-compiled code works at the lowest level", "body": "<h3>Running GHC Programs under the Gnu Debugger</h3>\n\n<p>The GHC compiler provides some support for <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/debug-info.html\" rel=\"nofollow noreferrer\">debugging programs under GDB</a>.  If you have a program:</p>\n\n<pre><code>-- Quot.hs\n\n{-# NOINLINE quot2 #-}\nquot2 :: Int -&gt; Int\nquot2 n = n `quot` 2\n\nmain = print $ quot2 10\n</code></pre>\n\n<p>you can compile it with the <code>-g</code> flag and run it under GDB using the instructions in the above link:</p>\n\n<pre><code>$ ghc -O2 -g -rtsopts Quot.hs    # Note: I'm using GHC 8.6.5\n$ gdb --args ./Quot +RTS -V0\n</code></pre>\n\n<p>You can set a breakpoint at the line <code>quot2 n = n `quot` 2</code>, disassemble, and step through the relevant code:</p>\n\n<pre><code>(gdb) break Quot.hs:5\nBreakpoint 1 at 0x4062c0: file Quot.hs, line 5.\n(gdb) run\nStarting program: /u/buhr/src/haskell/Quot +RTS -V0\n...\nBreakpoint 1, Main_zdwquot2_info () at Quot.hs:5\n(gdb) display/10i $rip\n1: x/10i $rip\n=&gt; 0x4062c0 &lt;Main_zdwquot2_info&gt;:   mov    %r14,%rax\n   0x4062c3 &lt;Main_zdwquot2_info+3&gt;: shr    $0x3f,%rax\n   0x4062c7 &lt;Main_zdwquot2_info+7&gt;: mov    %r14,%rbx\n   0x4062ca &lt;Main_zdwquot2_info+10&gt;:    add    %rax,%rbx\n   0x4062cd &lt;Main_zdwquot2_info+13&gt;:    sar    %rbx\n   0x4062d0 &lt;Main_zdwquot2_info+16&gt;:    jmpq   *0x0(%rbp)\n   ...\n(gdb) p $r14\n$1 = 10\n(gdb)\n</code></pre>\n\n<p>(Here the <code>Main_zdwquot2_info</code> symbol is a mangled name.  See below for some info on this.)  Anyway, from this disassembly you can can see that the optimized <code>quot2</code> code uses a couple of right shifts to perform the equivalent of:</p>\n\n<pre><code>((n &lt; 0 : 1 ? 0) + n) &gt;&gt; 1\n</code></pre>\n\n<p>to get truncation towards zero right for negative numbers.</p>\n\n<p>If <code>div</code> had been used instead, the code would have looked like:</p>\n\n<pre><code>1: x/10i $rip\n=&gt; 0x4062c0 &lt;Main_zdwdiv2_info&gt;:    mov    %r14,%rbx\n   0x4062c3 &lt;Main_zdwdiv2_info+3&gt;:  sar    %rbx\n   0x4062c6 &lt;Main_zdwdiv2_info+6&gt;:  jmpq   *0x0(%rbp)\n   ...\n</code></pre>\n\n<p>So, even though I would have said you can't learn anything from disassembling GHC code, I guess I was wrong.  We've already learned:</p>\n\n<ul>\n<li>This <a href=\"https://stackoverflow.com/a/13669277/7203016\">answer</a> is incorrect, or at least obsolete as of GHC 8.6.5, since <code>`quot` 2</code> and <code>`div` 2</code> <em>are</em>  optimized to shifts.</li>\n<li>The frequently repeated advice to use <a href=\"https://stackoverflow.com/a/8111203/7203016\"><code>quot</code> in preference to <code>div</code></a> for maximum efficiency doesn't apply if you're dividing by 2, since the code generated by <code>`div` 2</code> is more efficient.</li>\n</ul>\n\n<h3>Dumping GHC Intermediate Forms</h3>\n\n<p>However, it's still <em>really</em> hard to trace Haskell code execution using GDB.  If you had set a breakpoint at the main entry point (which is typically called <code>Main_main_info</code>):</p>\n\n<pre><code>(gdb) break Main_main_info\nBreakpoint 2 at 0x4063c8: file Div.hs, line 7.\n(gdb) run\n...\nBreakpoint 2, Main_main_info () at Div.hs:7\n1: x/10i $rip\n=&gt; 0x4063c8 &lt;Main_main_info&gt;:   mov    $0x4ac622,%edi\n   0x4063cd &lt;Main_main_info+5&gt;: mov    $0x4a4348,%esi\n   0x4063d2 &lt;Main_main_info+10&gt;:    mov    $0x4a73b8,%r14d\n   0x4063d8 &lt;Main_main_info+16&gt;:    jmpq   0x433de8 &lt;base_GHCziIOziHandleziText_hPutStrzq_info&gt;\n...\n</code></pre>\n\n<p>it would be easy to get lost.  Here, $0x4ac622 is the closure for the Haskell constant <code>True</code>, $0x4a4348 is the closure for the printable string representation of the result of <code>quot2 10</code>, and $0x4a73b8 is the closure for <code>stdout</code>, all being set up for a <code>GHC.IO.Handle.Text.hPutStr'</code> call.</p>\n\n<p>In GHC code, functions are invoked with <code>jmpq</code>, not <code>callq</code>, so you can't really <code>(gdb) next</code> over calls you aren't interested in tracing.  Moreover, because of the lazy evaluation model, arguments aren't evaluated before functions are called, so to trace the execution of the <code>quot2 10</code> call from scratch, you'd need to trace the execution of <code>hPutStr'</code> to find the point where it forces the evaluation of the closure for the printable representation of the result, and then trace the evaluation of that closure to see where it forces the evaluation of <code>quot2 10</code> itself.</p>\n\n<p>The other issue is that the assembly is <em>really</em> low level compared to the original Haskell code.  Though you might be able to learn something about \"micro-optimizations\", like how <code>`div` 2</code> is implemented, most Haskell performance problems are caused by higher-level inefficiencies (e.g., unnecessary boxing of values, failure of list fusion, etc.).  It would be incredibly difficult to diagnose these problems from a GDB session.</p>\n\n<p>For that reason, most people seeking to understand GHC-compiled code look at various forms of intermediate compiler output.  The GHC compiler, as you've probably discovered from your research, performs a number of transformations through intermediate forms.  These can be dumped using a series of <code>-ddump-xxx</code> flags.  Often, there's a lot of unnecessary detail, so adding the flag <code>-dsuppress-all</code> and sometimes also the flag <code>-dsuppress-uniques</code> can help to keep the noise down.  Also, <code>-fforce-recomp</code> is helpful when running <code>ghc</code> multiple times to look at different forms, since it forces a recompilation (and dumping of desired output), even if the source hasn't changed.  So, you might dump the output of the desugaring pass using:</p>\n\n<pre><code>ghc -O2 -fforce-recomp -ddump-ds -dsuppress-all -dsuppress-uniques Quot.hs\n</code></pre>\n\n<p>Anyway, here are the intermediate forms of most interest:</p>\n\n<ul>\n<li>The original source code is \"desugared\" to Core (<code>-ddump-ds</code>), a simplified version of the Haskell language that is still recognizably Haskell.  No optimizations have been performed at this point, so this dump is most useful for just getting to know the Core syntax and how it differs from \"real\" Haskell.  Some of the best documentation of <code>Core</code> is in the GHC source tree -- see <code>ghc/compiler/coreSyn/CoreSyn.hs</code> and the definition of the <code>Expr</code> type.</li>\n<li>Most high-level optimizations are performed on Core by applying Core-to-Core transformation functions.  You can learn a lot about a program's likely performance by studying the Core output produced by the simplifier (<code>-ddump-simpl</code>).</li>\n<li>The simplified Core is transformed into STG (<code>-ddump-stg</code>).  Unlike Core, STG is recognizably \"not Haskell\".  It's an untyped functional language that best represents the way a GHC program \"actually ticks\".  With the STG in front of you as a roadmap/reference, you could probably work through lower-level representations, include stepping through the disassembled code with a debugger, and understand what it's actually doing.  The best reference I've found for understanding STG is the paper <a href=\"https://www.microsoft.com/en-us/research/publication/make-fast-curry-pushenter-vs-evalapply/\" rel=\"nofollow noreferrer\">How to make a fast curry</a>.  In the paper, STG is basically the language described in Figure 1, and the assembly code generated corresponds to the \"evaluation rules\" in Figure 2.  You might also find <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/commentary/compiler/generated-code\" rel=\"nofollow noreferrer\">I know kung fu: learning STG by example</a> helpful, though I think the examples there are outdated.</li>\n<li>Below STG, the lower-level forms are CMM (<code>-ddump-cmm</code>) and the assembly (<code>-ddump-asm</code>).  CMM is a C-like assembly language.  I haven't found any particuarly good/accurate documentation on it, though it's often easier to understand than the assembly, which in turn is usually easier to follow than the disassembly under GDB, because it includes additional symbols that are missing from the debugging info.  I was able to identify the closures for <code>True</code>, etc. in the example above by comparing the assembly dumped by GHC with what I was seeing under GDB.</li>\n</ul>\n\n<p>I find I usually have to look at the STG, CMM, and assembly all side-by-side to figure out how some GHC code is working.</p>\n\n<p>So, maybe that'll get you started.</p>\n\n<h3>Name Mangling</h3>\n\n<p>As noted above, the names in the executable that you'll see in GDB have been mangled from the forms in the dumped compiler output (including <code>-ddump-asm</code>).  I don't know if this is documented anywhere, but here's a table I got from the GHC source code (<code>ghc/compiler/utils/Encoding.hs</code>):</p>\n\n<pre><code>'(' =\"ZL\"   'Z' =\"ZZ\"  '$' =\"zd\"  '&lt;' =\"zl\"  '\\\\'=\"zr\"\n')' =\"ZR\"   'z' =\"zz\"  '=' =\"ze\"  '-' =\"zm\"  '/' =\"zs\"\n'[' =\"ZM\"   '&amp;' =\"za\"  '&gt;' =\"zg\"  '!' =\"zn\"  '*' =\"zt\"\n']' =\"ZN\"   '|' =\"zb\"  '#' =\"zh\"  '+' =\"zp\"  '_' =\"zu\"\n':' =\"ZC\"   '^' =\"zc\"  '.' =\"zi\"  '\\''=\"zq\"  '%' =\"zv\"\n</code></pre>\n\n<p>so the name <code>Main_zdwquot2_info</code> in GDB correspond to <code>Main_$wquot2_info</code> in dumped GHC output.  That still looks mangled, but that's because it's a \"system name\".  As explained in comments in <code>ghc/compiler/basicTypes/OccName</code>:</p>\n\n<pre><code>Making System Names\n-------------------\n\nHere's our convention for splitting up the interface file name space:\n\n   d...         dictionary identifiers\n                (local variables, so no name-clash worries)\n\nAll of these other OccNames contain a mixture of alphabetic\nand symbolic characters, and hence cannot possibly clash with\na user-written type or function name\n\n   $f...        Dict-fun identifiers (from inst decls)\n   $dmop        Default method for 'op'\n   $pnC         n'th superclass selector for class C\n   $wf          Worker for function 'f'\n   $sf..        Specialised version of f\n   D:C          Data constructor for dictionary for class C\n   NTCo:T       Coercion connecting newtype T with its representation type\n   TFCo:R       Coercion connecting a data family to its representation type R\n</code></pre>\n\n<p>so the above function was a \"worker\" for the <code>quot2</code> function.   Often, a function that operates on boxed integers will have a \"worker\" counterpart that operates on unboxed integers.  In our <code>Quot.hs</code> example, this unboxed worker function was all that was needed, so the original <code>quot2</code> function was dropped in the final compiler output.</p>\n"}], "owner": {"reputation": 21, "user_id": 12417556, "user_type": "registered", "profile_image": "https://graph.facebook.com/2891044364241146/picture?type=large", "display_name": "Arnaud Paran", "link": "https://stackoverflow.com/users/12417556/arnaud-paran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576351847, "creation_date": 1576169534, "last_edit_date": 1576257974, "question_id": 59309340, "link": "https://stackoverflow.com/questions/59309340/understanding-how-ghc-compiled-code-works-at-the-lowest-level", "title": "Understanding how GHC-compiled code works at the lowest level", "body": "<p>When using a language, I find it useful to understand exactly how my code is compiled.  For example, I like using C because I can inspect the disassembled code in a debugger like GDB and quickly see how the C code I write actually behaves.</p>\n\n<p>The Haskell Wiki has some <a href=\"https://wiki.haskell.org/Debugging\" rel=\"nofollow noreferrer\">debugging advice</a>, but I haven't found a way to see the disassembled code generated by GHC.  Looking at it with GDB isn't very helpful, since I can't figure out how to find the code for a particular function, figure out where a particular variable is stored, set breakpoints or anything else that I can do with a C program.</p>\n\n<p>My question:  <strong>How can I disassemble code generated by GHC in a way that's useful?</strong>  Is there a tool to produce an annotated listing of the code generated by GHC?  Is there a way to compile functions in a way that you can see how the compiled code \"ticks\"?</p>\n\n<p><em>Some additional background and references:</em></p>\n\n<p>One reason I want to do this is I think this kind of understanding would be extremely important for getting good performance (e.g., <a href=\"https://stackoverflow.com/questions/13669134/c-vs-haskell-collatz-conjecture-speed-comparison\">C vs Haskell Collatz conjecture speed comparison</a>).  The Haskell wiki entry on <a href=\"https://wiki.haskell.org/Performance\" rel=\"nofollow noreferrer\">performance</a> doesn't go into enough detail to cover the answer to that SO question (namely, optimization of <code>n % 2</code> and <code>n / 2</code> by C compilers versus lack of optimization of <code>quot n 2</code> and <code>rem n 2</code> in GHC).  If I could see the disassembled code, I could figure it out for myself.</p>\n\n<p>Some resources I've found included:</p>\n\n<ul>\n<li>A paper on GHC garbage collection: <a href=\"http://simonmar.github.io/bib/papers/parallel-gc.pdf\" rel=\"nofollow noreferrer\">Parallel Generational-Copying Garbage Collection with a Block-Structured Heap</a></li>\n<li>Some Stack Overflow information on <a href=\"https://stackoverflow.com/questions/4385160/how-does-a-haskell-compiler-work\">how the compiler works</a> which gave multiple references:\n\n<ul>\n<li>@Max Bolingbroke referenced <a href=\"https://www.microsoft.com/en-us/research/publication/implementing-functional-languages-a-tutorial/?from=http%3A%2F%2Fresearch.microsoft.com%2Fen-us%2Fum%2Fpeople%2Fsimonpj%2Fpapers%2Fpj-lester-book%2F\" rel=\"nofollow noreferrer\">Implementing functional languages: a tutorial</a></li>\n<li>@stephen tetley referenced <a href=\"https://wiki.clean.cs.ru.nl/Functional_Programming_and_Parallel_Graph_Rewriting\" rel=\"nofollow noreferrer\">Functional Programming and Parallel Graph Rewriting</a></li>\n<li>@The_Ghost referenced a book chapter on <a href=\"https://www.aosabook.org/en/ghc.html\" rel=\"nofollow noreferrer\">The Glasgow Haskell Compiler</a></li>\n<li>@adminfdv referenced the <a href=\"https://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler#Architecture\" rel=\"nofollow noreferrer\">wikipedia article on GHC</a></li>\n</ul></li>\n</ul>\n\n<p>These resources are really useful, but to fully understand them, I feel like I need to see actual compiled GHC code in action.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1576164667, "post_id": 59307984, "comment_id": 104818076, "body": "What&#39;s your definition of <code>streamRepeat</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1576164718, "post_id": 59307984, "comment_id": 104818110, "body": "At first sight it looks like <code>streamRepeat</code> might be &quot;blocking&quot;, so never yielding a (partial) result. Nevertheless, you should use <i>irrefutable patterns</i> here on the second parameter of <code>interleaveStreams</code>."}, {"owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1576164788, "post_id": 59307984, "comment_id": 104818159, "body": "@chepner Edited the question to include streamRepeat"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 2, "creation_date": 1576166098, "post_id": 59307984, "comment_id": 104818994, "body": "Looks like the problem is that <code>interleaveStreams</code> pattern matches using a strict pattern on its second argument, thus when you call it in the definition of <code>ruler</code>, <code>streamMap succ ruler</code> needs to be evaluated which in turns requires <code>ruler</code> to be evaluated"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1576169299, "last_edit_date": 1576169299, "creation_date": 1576168308, "answer_id": 59309015, "question_id": 59307984, "link": "https://stackoverflow.com/questions/59307984/recursive-definition-hangs-indefintely/59309015#59309015", "title": "Recursive definition hangs indefintely", "body": "<p><code>interleaveStreams</code> is strict in both its arguments, and <code>streamMap</code> is strict in it second argument, so evaluating <code>ruler</code> even one step requires evaluating <code>ruler</code> one step which requires ...</p>\n\n<p>The simplest solution is to make <code>interleaveStreams</code> lazy in its second argument, so that you don't need to evaluate <code>ruler</code> recursively until you've gotten at least one value from it.</p>\n\n<pre><code>interleaveStreams :: Stream a -&gt; Stream a -&gt; Stream a\ninterleaveStreams (Cons afirst arest) b = \n    let (Cons bfirst brest) = b \n    in Cons afirst (Cons bfirst (interleaveStreams arest brest))\n</code></pre>\n\n<p>Now</p>\n\n<pre><code>ruler == interleaveStreams (streamRepeat 0) (streamMap succ ruler)\n      == let (Cons bfirst brest) = streamMap succ ruler\n         in Cons 0 (Cons bfirst brest)\n</code></pre>\n\n<p>When we try to pattern match on <code>ruler</code>, we can get the first 0 without having to evaluate <code>ruler</code> further, which means when we <em>do</em> try to evaluate <code>streamMap succ ruler</code>, <em>it</em> can produce a first value (because we know that <code>ruler</code> starts with <code>0</code>).</p>\n\n<p>A simpler way to do this is to use a lazy pattern:</p>\n\n<pre><code>interleaveStreams :: Stream a -&gt; Stream a -&gt; Stream a\ninterleaveStreams (Cons afirst arest) ~(Cons bfirst brest) = \n    Cons afirst (Cons bfirst (interleaveStreams arest brest))\n</code></pre>\n\n<p>which desugars to the first example.</p>\n\n<hr>\n\n<p>Another solution would be to hardcode the first element of <code>ruler</code> and reverse the arguments to <code>interleaveStreams</code>, i.e.,</p>\n\n<pre><code>ruler = Cons 0 $ interleaveStreams (streamMap succ ruler) (streamRepeat 0)\n</code></pre>\n\n<p>which makes <code>ruler</code> work but doesn't fix <code>interleaveStreams</code> in general.</p>\n"}], "owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "closed_date": 1576175434, "accepted_answer_id": 59309015, "answer_count": 1, "score": -1, "last_activity_date": 1576175446, "creation_date": 1576164621, "last_edit_date": 1576164771, "question_id": 59307984, "link": "https://stackoverflow.com/questions/59307984/recursive-definition-hangs-indefintely", "closed_reason": "Duplicate", "title": "Recursive definition hangs indefintely", "body": "<p>I am trying to implement exercise 5 of <a href=\"https://www.cis.upenn.edu/~cis194/spring13/hw/06-laziness.pdf\" rel=\"nofollow noreferrer\">CIS 194 - Homework 6</a></p>\n\n<p>This is my implementations;</p>\n\n<pre><code>data Stream a = Cons a (Stream a)\n\nstreamRepeat :: a -&gt; Stream a\nstreamRepeat a = Cons a (streamRepeat a)\n\nstreamMap :: (a -&gt; b) -&gt; Stream a -&gt; Stream b\nstreamMap f (Cons xval xlist) = Cons (f xval) (streamMap f xlist)\n\ninterleaveStreams :: Stream a -&gt; Stream a -&gt; Stream a\ninterleaveStreams (Cons afirst arest) (Cons bfirst brest) = \n    Cons afirst (Cons bfirst (interleaveStreams arest brest))\n\nruler :: Stream Integer\nruler = interleaveStreams (streamRepeat 0) (streamMap succ ruler)\n</code></pre>\n\n<p>However, when I try to get even the first value from the Stream, it hangs indefinitely. How can I make this recursive definition work lazily?</p>\n"}, {"tags": ["haskell", "types", "type-conversion", "value-constructor"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 11737889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/787e863ec85b815cd797b5d6e31811d1?s=128&d=identicon&r=PG&f=1", "display_name": "Cara", "link": "https://stackoverflow.com/users/11737889/cara"}, "edited": false, "score": 0, "creation_date": 1576159835, "post_id": 59306294, "comment_id": 104815067, "body": "The problem is that I want to return a natural number and I am not show how to call a function that returns a number and not the value constructor itselt. How would the function look like if I would like to enter 2 and get back an integral? I do not see the usefullness,,"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 133, "user_id": 11737889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/787e863ec85b815cd797b5d6e31811d1?s=128&d=identicon&r=PG&f=1", "display_name": "Cara", "link": "https://stackoverflow.com/users/11737889/cara"}, "edited": false, "score": 0, "creation_date": 1576159897, "post_id": 59306294, "comment_id": 104815100, "body": "You call a function <code>f</code> with parameter <code>x</code> as <code>f x</code>."}, {"owner": {"reputation": 133, "user_id": 11737889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/787e863ec85b815cd797b5d6e31811d1?s=128&d=identicon&r=PG&f=1", "display_name": "Cara", "link": "https://stackoverflow.com/users/11737889/cara"}, "edited": false, "score": 0, "creation_date": 1576160560, "post_id": 59306294, "comment_id": 104815512, "body": "I know that. I think I have a false understanding of how it works. I have to read further"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1576159194, "creation_date": 1576159194, "answer_id": 59306294, "question_id": 59306230, "link": "https://stackoverflow.com/questions/59306230/how-to-define-a-function-that-takes-natural-numbers-of-a-data-type-and-return-th/59306294#59306294", "title": "How to define a function that takes natural numbers of a data type and return their sum?", "body": "<p>You can pattern match on these. For example, we can decrement the number (or return <code>Zero</code> in case it was already <code>Zero</code>) with:</p>\n\n<pre><code>dec :: Nat -&gt; Nat\ndec <b>Zero</b> = Zero\ndec <b>(Succ <i>n</i>)</b> = n</code></pre>\n\n<p>Here the patterns are thus <code>Zero</code>, which matches the <code>Zero</code> value, and <code>Succ n</code>, which will thus unify <code>n</code> with the value wrapped in the <code>Succ</code> data constructor.</p>\n\n<p>If you want to sum up two <code>Nat</code>s, you thus define a function <code>add :: Nat -&gt; Nat -&gt; Nat</code>. You first might want to try all possible cases for the data constructors of the two values, and perhaps later look to improve your code by generalizing the clauses.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1576161096, "creation_date": 1576161096, "answer_id": 59306820, "question_id": 59306230, "link": "https://stackoverflow.com/questions/59306230/how-to-define-a-function-that-takes-natural-numbers-of-a-data-type-and-return-th/59306820#59306820", "title": "How to define a function that takes natural numbers of a data type and return their sum?", "body": "<p>You can implement <code>mult :: Nat -&gt; Nat -&gt; Nat</code> without converting the arguments to <code>Integer</code> first. What is multiplication? It's repeated addition, which you can define recursively:</p>\n\n<pre><code>n * 0 == 0\nn * m == n + n * (m - 1)\n</code></pre>\n\n<p>Recall that <code>m - 1</code> is the value of the <code>Nat</code> wrapped by <code>Succ</code>; if <code>m == Succ k</code>, then <code>k</code> represents <code>m - 1</code>. With that in mind, you should be able to see how to define <code>mult</code>, assuming you have a definition of <code>add :: Nat -&gt; Nat -&gt; Nat</code> available.</p>\n\n<pre><code>mult :: Nat -&gt; Nat -&gt; Nat\nmult n Zero = ...\nmult n (Succ m) = ...\n</code></pre>\n\n<p><code>add :: Nat -&gt; Nat -&gt; Nat</code> can be defined similarly, using a definition based on repeated incrementing.</p>\n\n<pre><code>-- n + 0 = n\n-- n + m = (n + 1) + (m - 1)\ndef add :: Nat -&gt; Nat -&gt; Nat\nadd n Zero = ...\nadd n (Succ m) = ...\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 11737889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/787e863ec85b815cd797b5d6e31811d1?s=128&d=identicon&r=PG&f=1", "display_name": "Cara", "link": "https://stackoverflow.com/users/11737889/cara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 0, "accepted_answer_id": 59306820, "answer_count": 2, "score": 1, "last_activity_date": 1576161096, "creation_date": 1576159008, "question_id": 59306230, "link": "https://stackoverflow.com/questions/59306230/how-to-define-a-function-that-takes-natural-numbers-of-a-data-type-and-return-th", "title": "How to define a function that takes natural numbers of a data type and return their sum?", "body": "<p>I am still learning how value constructors work. I read a lot about data types and their value constructors. The problem is that I never saw them in practice. For example</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n</code></pre>\n\n<p>Now if we want to define a functions that takes two inputs of Nat and returns the product, how would we do that? We have to convert them to Haskell Integrals if we want to use the operator *.\nAnd if we want to implement a mult function that takes two Nat's which should multiply them without converting them to Haskel Integrals, how would that look like?</p>\n\n<p>I really don't get data types|value constructors yet. Can anyone illustrate how to correctly use such value constructors from the data Nat example above?</p>\n"}, {"tags": ["haskell", "process", "typed-process"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1576162813, "post_id": 59306118, "comment_id": 104816922, "body": "The POSIX spec <i>defines</i> the environment as a list of strings consisting of a name and a value joined by <code>=</code>. <code>getEnvironment</code> simply ensures that an entry like <code>foo</code> is treated like the &quot;proper&quot; entry <code>foo=</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1576167315, "post_id": 59306118, "comment_id": 104819751, "body": "Also, <code>pcEnv</code> won&#39;t help here.  It&#39;s the configuration option that&#39;s <i>set</i> by <code>setEnv</code> (set to <code>Just</code> an environment) and <code>setEnvInherit</code> (set to <code>Nothing</code>).  Your solution of using <code>getEnvironment</code> and adding additional options to the result is the correct way of doing what you want to do, as far as I can see."}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 1, "last_activity_date": 1576159294, "creation_date": 1576159294, "answer_id": 59306319, "question_id": 59306118, "link": "https://stackoverflow.com/questions/59306118/how-to-set-additional-environment-variables-for-new-process-in-typed-process/59306319#59306319", "title": "How to set additional environment variables for new process in typed-process?", "body": "<p>One workaround can be done using the <code>unix</code> package:</p>\n\n<pre><code>import System.Posix.Env (getEnvironment)\n\ncurrentEnv &lt;- getEnvironment\nlet totalEnv = currentEnv ++ [(\"KUBECONFIG\",\"k8s.cfg\")]\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 59306319, "answer_count": 1, "score": 2, "last_activity_date": 1576159294, "creation_date": 1576158614, "question_id": 59306118, "link": "https://stackoverflow.com/questions/59306118/how-to-set-additional-environment-variables-for-new-process-in-typed-process", "title": "How to set additional environment variables for new process in typed-process?", "body": "<p>I'd like a new process to inherit the existing environment variables, as well as set my own.</p>\n\n<p>I only see two options to set the environment variables within <a href=\"http://hackage.haskell.org/package/typed-process-0.2.6.0/docs/System-Process-Typed.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/typed-process-0.2.6.0/docs/System-Process-Typed.html</a>:</p>\n\n<pre><code>setEnv :: [(String, String)] -&gt; ProcessConfig stdin stdout stderr -&gt; ProcessConfig stdin stdout stderrSource\nsetEnvInherit :: ProcessConfig stdin stdout stderr -&gt; ProcessConfig stdin stdout stderr\n</code></pre>\n\n<p>I could manually get a list of all environment variables with <code>System.Environment.getEnvironment</code> however it's documentation(<a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/System-Environment.html#v:getEnvironment\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.12.0.0/docs/System-Environment.html#v:getEnvironment</a>) mentions:</p>\n\n<blockquote>\n  <p>getEnvironment retrieves the entire environment as a list of\n  (key,value) pairs.</p>\n  \n  <p>If an environment entry does not contain an '=' character, the key is\n  the whole entry and the value is the empty string.</p>\n</blockquote>\n\n<p>Which seems a bit iffy.</p>\n\n<hr>\n\n<p>Looking through the source there seems to be a data constructor that has the environment variables set in <code>pcEnv :: !(Maybe [(String, String)])</code> - but this does not seem to be exported. Is there some means to modify this value?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1576155949, "post_id": 59305037, "comment_id": 104812831, "body": "It would likely break <a href=\"https://stackoverflow.com/a/9859966/67579\">referential transparency</a> by counting recursive calls."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1576157220, "post_id": 59305037, "comment_id": 104813502, "body": "The simplest makeshift way is to pass another parameter to your function like <code>cnt</code> which gets incremented by one every time you make a recursive call and include it in the return value somehow.. perhaps use a tuple for the return value whereas <code>fst</code> is the answer and <code>snd</code> is the <code>cnt</code>. Kind of..."}, {"owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1576159425, "post_id": 59305037, "comment_id": 104814824, "body": "can you please write the program, I didn&#39;t really understand :/ @Redu"}], "answers": [{"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": true, "score": 3, "last_activity_date": 1576161577, "creation_date": 1576161577, "answer_id": 59306968, "question_id": 59305037, "link": "https://stackoverflow.com/questions/59305037/counting-recursive-calls-haskell/59306968#59306968", "title": "counting recursive calls - Haskell", "body": "<p>You may do like</p>\n\n<pre><code>rechnerb :: Integer -&gt; Integer -&gt; Int -&gt; ((Integer,Integer,Integer), Int)\nrechnerb 0 b c = ((b, 0, 1), c)\nrechnerb a b c = let ((g, x, y), cnt) = rechnerb (b `mod` a) a (c+1)\n                 in ((g, y - (b `div` a) * x, x), cnt)\n</code></pre>\n\n<p>and call like;</p>\n\n<pre><code>\u03bb&gt; rechnerb 7 1100 1 -- last parameter is the initial value (call # 1)\n((1,-157,1),3)       -- (1,-157,1) is the answer and 3 is the # of calls to rechnerb\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 12429061, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LPeFpqCo8pQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pvhFkdewt5Pm1XY2MTnIgr6USr8A/mo/photo.jpg?sz=128", "display_name": "German student 99", "link": "https://stackoverflow.com/users/12429061/german-student-99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 59306968, "answer_count": 1, "score": 1, "last_activity_date": 1576161577, "creation_date": 1576155126, "question_id": 59305037, "link": "https://stackoverflow.com/questions/59305037/counting-recursive-calls-haskell", "title": "counting recursive calls - Haskell", "body": "<p>Is there a function that count recursive calls for Extended Euclidean algorithm function?</p>\n\n<pre><code>rechnerb :: Integer -&gt; Integer -&gt; (Integer,Integer,Integer)\nrechnerb 0 b = (b, 0, 1)\nrechnerb a b = let (g, x, y) = rechnerb (b `mod` a) a\n           in (g, y - (b `div` a) * x, x)\n\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 158, "user_id": 9829124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72f7d1c0d0730d3f3617f337ea602c1b?s=128&d=identicon&r=PG&f=1", "display_name": "Hopia", "link": "https://stackoverflow.com/users/9829124/hopia"}, "is_accepted": false, "score": 1, "last_activity_date": 1576162565, "creation_date": 1576162565, "answer_id": 59307283, "question_id": 59304848, "link": "https://stackoverflow.com/questions/59304848/sql-array-aggregation-in-haskell-squeal/59307283#59307283", "title": "SQL Array aggregation in Haskell + Squeal", "body": "<p>For the record, the library's author provided a solution as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>keywords :: Query_ Schemas () (Only (VarArray [Text]))\nkeywords = select_\n  (fromNull (array [] &amp; inferredtype) (arrayAgg (All #keyword)) `as` #fromOnly)\n  (from (table #keywords) &amp; groupBy Nil)\n</code></pre>\n\n<p>The key factors here are:</p>\n\n<ol>\n<li>Provide a default empty array with <code>fromNull (array [] &amp; inferredtype) ...</code>. This way we can avoid using <code>Maybe</code> in the return type</li>\n<li>Provide grouping with <code>groupBy Nil</code></li>\n<li>Choose either <code>Distinct</code> or <code>All</code> rows in <code>arrayAgg</code></li>\n<li>Finally, the return type should be <code>VarArray x</code></li>\n</ol>\n"}], "owner": {"reputation": 158, "user_id": 9829124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72f7d1c0d0730d3f3617f337ea602c1b?s=128&d=identicon&r=PG&f=1", "display_name": "Hopia", "link": "https://stackoverflow.com/users/9829124/hopia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576162565, "creation_date": 1576154508, "last_edit_date": 1576154940, "question_id": 59304848, "link": "https://stackoverflow.com/questions/59304848/sql-array-aggregation-in-haskell-squeal", "title": "SQL Array aggregation in Haskell + Squeal", "body": "<p>I'm using an SQL library called <strong>Squeal</strong> in Haskell.</p>\n\n<h2>What's the correct way to aggregate multiple text rows into one array in Squeal library?</h2>\n\n<p>Say I got a very simple Schema with just one table containing a column '<strong>keyword</strong>' (of PG text type) + associated types:\n</p>\n\n<pre><code>import           Squeal.PostgreSQL\nimport qualified GHC.Generics                  as GHC\nimport qualified Generics.SOP                  as SOP\n\ntype Constraints = '[\"pk_keywords\"  ::: 'PrimaryKey '[\"id\"]]\ntype Columns\n  = '[\"id\" ::: 'Def :=&gt; 'NotNull 'PGint8, \"keyword\" ::: 'NoDef :=&gt; 'NotNull 'PGtext]\ntype Table = 'Table (Constraints :=&gt; KColumns)\ntype Schema = '[\"keywords\" ::: Table]\ntype Schemas = '[\"public\" ::: Schema]\n\nnewtype Keywords = Keywords {unKeywords ::  [Text]} deriving (GHC.Generic)\ninstance SOP.Generic Keywords\ninstance SOP.HasDatatypeInfo Keywords\ntype instance PG Keywords = 'PGvararray ( 'NotNull 'PGtext)\n</code></pre>\n\n<h2>This is the part I need help with:</h2>\n\n<p>I'm trying an aggregation query like this:</p>\n\n<pre><code>keywords :: Query_ Schemas () Keywords\nkeywords =\n  select_ ((arrayAgg (All #keyword)) `as` #fromOnly) (from (table #keywords))\n</code></pre>\n\n<p>However, I keep getting an error:</p>\n\n<pre><code>* Couldn't match type 'NotNull (PG [Text])\n                 with 'Null ('PGvararray ty0)\n    arising from a use of `as'\n</code></pre>\n\n<p>From what I understand, <code>arrayAgg</code> can produce <code>NULL</code> so I need to provide a default of empty array <code>[]</code> somehow with <code>fromNull</code> from here:\n<a href=\"https://hackage.haskell.org/package/squeal-postgresql-0.5.1.0/docs/Squeal-PostgreSQL-Expression-Null.html#v:fromNull\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/squeal-postgresql-0.5.1.0/docs/Squeal-PostgreSQL-Expression-Null.html#v:fromNull</a></p>\n\n<p>But I don't quite know how to provide that.</p>\n\n<h3>What about the value type mismatch (<code>PG [Text]</code> vs <code>'PGvararray ty0</code>)? How to solve that?</h3>\n"}, {"tags": ["haskell", "lazy-sequences"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1576142674, "post_id": 59298311, "comment_id": 104805510, "body": "The key difference is far from self-evident and should probably be stated: pattern matches in <code>let</code> and <code>where</code> are always lazy, but patterns for arguments default to strict unless made lazy using <code>~</code>."}, {"owner": {"reputation": 1812, "user_id": 268040, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/52942006944f73662535117cd8c220f6?s=128&d=identicon&r=PG", "display_name": "Daniel Patru", "link": "https://stackoverflow.com/users/268040/daniel-patru"}, "edited": false, "score": 0, "creation_date": 1576149976, "post_id": 59298311, "comment_id": 104809666, "body": "Thank you K. A. Buhr and luqui!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 7, "last_activity_date": 1576168506, "last_edit_date": 1576168506, "creation_date": 1576128985, "answer_id": 59298311, "question_id": 59297557, "link": "https://stackoverflow.com/questions/59297557/when-can-i-rely-on-haskell-to-read-a-list-lazily/59298311#59298311", "title": "When can I rely on Haskell to read a list lazily?", "body": "<p>You can fix <code>to10plus</code> by using an irrefutable match (i.e., a <code>~</code> prefix) in your definition of <code>merge</code>:</p>\n\n<pre><code>merge (a, b) ~(as, bs) = (a:as, b+bs)\n</code></pre>\n\n<p>The reason for the difference in behavior between <code>to10</code> and <code>to10plus</code> is that <code>to10</code> can return the first element of the list without having to evaluate <code>to10 xs</code> and so without inspecting <code>xs</code>.</p>\n\n<p>In contrast, before it can return anything, <code>to10plus</code> must successfully call <code>merge</code> with the arguments <code>(x, 1)</code> and <code>to10plus xs</code>.  For this call to succeed, <code>to10plus xs</code> must be evaluated far enough to ensure it matches the pattern <code>(as, bs)</code> used in the definition of <code>merge</code>, but that evaluation requires inspecting elements of <code>xs</code>, which aren't available yet.</p>\n\n<p>You could also have avoided the problem by defining <code>to10plus</code> a little differently:</p>\n\n<pre><code>to10plus (x:xs) | x &lt; 10 = (x:as,1+bs)\n                | otherwise = ([], 0)\n  where (as,bs) = to10plus xs\n</code></pre>\n\n<p>Here, <code>to10plus</code> can provide the first element <code>x</code> of the first part of the tuple without trying to evaluate <code>as</code>, and so without trying to pattern match <code>to10plus xs</code> with <code>(as,bs)</code> in the <code>where</code> clause.  A <code>let</code> clause would have done the same thing:</p>\n\n<pre><code>to10plus (x:xs) | x &lt; 10 = let (as,bs) = to10plus xs in (x:as,1+bs)\n                | otherwise = ([], 0)\n</code></pre>\n\n<p>As @luqui points out, this is a difference in the timing for pattern matches made by <code>let</code> and <code>where</code> statements:</p>\n\n<pre><code>let (a,b) = expr in body\n-- OR --\nbody where (a,b) = expr\n</code></pre>\n\n<p>versus <code>case</code> statements / function definitions:</p>\n\n<pre><code>case expr of (a,b) -&gt; body\n-- OR --\nf (a,b) = body  -- AND THEN EVALUATING: -- f expr\n</code></pre>\n\n<p>The <code>let</code> and <code>where</code> statements match patterns lazily, meaning that <code>expr</code> isn't matched to the pattern <code>(a,b)</code> until <code>a</code> or <code>b</code> are evaluated in the <code>body</code>.  In contrast, for the <code>case</code> statement, <code>expr</code> is matched to <code>(a,b)</code> right away, before the <code>body</code> is even examined.  And given the above definition for <code>f</code>, the argument to <code>f</code> will be matched to <code>(a,b)</code> as soon as the expression <code>f expr</code> is evaluated without waiting until <code>a</code> or <code>b</code> is needed in the function <code>body</code>.  Here are some working examples to illustrate:</p>\n\n<pre><code>ex1 = let (a,b) = undefined in print \"okay\"\nex2 = print \"also okay\" where (a,b) = undefined\nex3 = case undefined of (a,b) -&gt; print \"not okay\"\nex4 = f undefined\nf (a,b) = print \"also not okay\"\n\nmain = do\n  ex1   -- works\n  ex2   -- works\n  ex3   -- fails\n  ex4   -- fails\n</code></pre>\n\n<p>Adding <code>~</code> changes the behavior for <code>case</code> / function definitions so the matching takes place only when <code>a</code> or <code>b</code> are needed:</p>\n\n<pre><code>ex5 = case undefined of ~(a,b) -&gt; print \"works fine\"\nex6 = g undefined\ng ~(a,b) = print \"also works fine\"\n\nex7 = case undefined of ~(a,b) -&gt; print $ \"But trying \" ++ show (a+b) ++ \" would fail\"\n</code></pre>\n"}], "owner": {"reputation": 1812, "user_id": 268040, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/52942006944f73662535117cd8c220f6?s=128&d=identicon&r=PG", "display_name": "Daniel Patru", "link": "https://stackoverflow.com/users/268040/daniel-patru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 59298311, "answer_count": 1, "score": 8, "last_activity_date": 1576168506, "creation_date": 1576123593, "last_edit_date": 1576150622, "question_id": 59297557, "link": "https://stackoverflow.com/questions/59297557/when-can-i-rely-on-haskell-to-read-a-list-lazily", "title": "When can I rely on Haskell to read a list lazily?", "body": "<p>Why do I get an infinite loop (<code>&lt;&lt;loop&gt;&gt;</code>) runtime error here?</p>\n\n<p>file feedback.hs:</p>\n\n<pre><code>plus1 :: [Int]-&gt;[Int] -- add 1 to input stream\nplus1 [] = []\nplus1 (x:xs) = (x+1): plus1 xs\n\nto10 :: [Int] -&gt; [Int] -- stop the input stream when it gets to 10\nto10 (x:xs) | x &lt; 10 = x : to10 xs\n            | otherwise = []\n\nto10plus :: [Int] -&gt; ([Int], Int) -- like to10 but also return the count\nto10plus (x:xs) | x &lt; 10 = (x, 1) `merge` (to10plus xs)\n            | otherwise = ([], 0)\n  where merge (a, b) (as, bs) = (a:as, b+bs)\n\nmain = do\n  let out = plus1 $ 1: to10 out\n  putStrLn $ show out -- gives [2,3,4,5,6,7,8,9,10]\n\n\n  let out = plus1 $ 1: out2\n      out2 = to10 out\n  putStrLn $ show out -- same as above\n\n  let out = plus1 $ 1: out2\n      (out2, count) = to10plus out\n  putStrLn $ show (out, count) -- expect ([2,3,4,5,6,7,8,9,10], 8) \n                               -- but get runtime error: &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<pre><code>$ ghc feedback.hs \n[1 of 1] Compiling Main             ( feedback.hs, feedback.o )\nLinking feedback ...\n$ ./feedback\n[2,3,4,5,6,7,8,9,10]\n[2,3,4,5,6,7,8,9,10]\nfeedback: &lt;&lt;loop&gt;&gt;\n</code></pre>\n"}]