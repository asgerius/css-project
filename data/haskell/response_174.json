[{"tags": ["parsing", "haskell", "compiler-construction", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1525899228, "post_id": 50261752, "comment_id": 87541870, "body": "If an arithmetic expression can be an expression and an expression can be an arithmetic expression, these shouldn&#39;t be separate things at all. Just merge the definitions of <code>aExpr</code> and <code>expressionParser</code>."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1525915928, "last_edit_date": 1525915928, "creation_date": 1525904820, "answer_id": 50262929, "question_id": 50261752, "link": "https://stackoverflow.com/questions/50261752/parsing-expressions-inside-arithmetic-expressions/50262929#50262929", "title": "Parsing expressions inside arithmetic expressions", "body": "<p><strong>EDIT</strong> I just now realized that you are using <code>makeExpressionParser</code> and my answer doesn't really apply to that.  Anyway maybe this answer is still helpful?</p>\n\n<p>Parsec is a type of recursive-descent parser, which means it cannot handle left recursion, as you are seeing.  You need to factor it out, which can always be done if the grammar is context-free.  One way you see this factorization done is by having a production for each precedence level.  Here is an example grammar for simple arithmetic:</p>\n\n<pre><code>expr ::= addExpr\naddExpr ::= mulExpr '+' addExpr\n          | mulExpr '-' addExpr\n          | mulExpr\nmulExpr ::= term '*' mulExpr\n          | term '/' mulExpr\n          | term\nterm ::= '(' expr ')'\n       | number\n</code></pre>\n\n<p>Notice the pattern: the first symbol in each production calls down to the next more specific one.  Then explicit parentheses allow us to re-enter the top-level production.  This is generally how operator precedence is expressed in recursive descent.</p>\n\n<p>The above grammar can only produce right-nested expressions.  While it will accept exactly the right strings, it does not correctly parse when the interpretation is left-associative.  In particular, </p>\n\n<pre><code>1 - 2 - 3 - 4\n</code></pre>\n\n<p>will be parsed as</p>\n\n<pre><code>1 - (2 - (3 - 4))\n</code></pre>\n\n<p>which is not correct according to our conventions.  In a general recursive-descent parser you have to do some tricks to associate correctly here.  In Parsec, however, we have the <code>many</code> combinators, which we can use to our advantage.  For example, to parse left-associated subtraction, we could say</p>\n\n<pre><code>subExpr = foldl1 (-) &lt;$&gt; many1 mulExpr\n</code></pre>\n\n<p>The next level here are apparently the <a href=\"http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Combinator.html#v:chainl\" rel=\"nofollow noreferrer\"><code>chainl</code></a> combinators which seem to have been designed for just this purpose (though I just learned about it now -- guess I should have perused the docs more).  An example of using this would be</p>\n\n<pre><code>addExpr = chainl1 mulExpr oper\n    where\n    oper = choice [ (+) &lt;$ symbol '+'\n                  , (-) &lt;$ symbol '-'\n                  ]\n</code></pre>\n\n<p>I love writing parsers in Haskell.  Good luck!</p>\n"}], "owner": {"reputation": 1469, "user_id": 2934534, "user_type": "registered", "accept_rate": 77, "profile_image": "https://lh3.googleusercontent.com/-eF8AiD0GO8s/AAAAAAAAAAI/AAAAAAAAABQ/WZobF6ZbPIg/photo.jpg?sz=128", "display_name": "Michael", "link": "https://stackoverflow.com/users/2934534/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 0, "accepted_answer_id": 50262929, "answer_count": 1, "score": 2, "last_activity_date": 1525915928, "creation_date": 1525898680, "last_edit_date": 1525904025, "question_id": 50261752, "link": "https://stackoverflow.com/questions/50261752/parsing-expressions-inside-arithmetic-expressions", "title": "Parsing expressions inside arithmetic expressions", "body": "<p>I would like to parse arithmetic expressions. </p>\n\n<p><strong>Here is my current parser:</strong> </p>\n\n<pre><code>data AExpr\n    = ExprAsAExpr Expr\n    | IntConst Integer\n    | Neg AExpr\n    | ABinary ABinOp AExpr AExpr\n    deriving (Show, Eq)\n\naExpr :: Parser AExpr\naExpr = makeExprParser aTerm aOperators\n\naTerm :: Parser AExpr\naTerm\n    =   parens aExpr\n    &lt;|&gt; IntConst &lt;$&gt; integerParser\n\naOperators :: [[Operator Parser AExpr]]\naOperators =\n    [ [Prefix (Neg &lt;$ symbol \"-\") ]\n    , [ InfixL (ABinary Multiply &lt;$ symbol \"*\")\n      , InfixL (ABinary Divide   &lt;$ symbol \"/\") ]\n    , [ InfixL (ABinary Add      &lt;$ symbol \"+\")\n      , InfixL (ABinary Subtract &lt;$ symbol \"-\") ]\n    ]\n</code></pre>\n\n<p>Using this I can correctly parse this: </p>\n\n<pre><code>1 + 2\n</code></pre>\n\n<p>Generating an AST like this. </p>\n\n<pre><code>(ABinary Add (IntConst 1) (IntConst 2))\n</code></pre>\n\n<p>Another thing I can parse are general expressions. These can be things such as variables, method calls, ternaries etc. </p>\n\n<p><strong>E.g.</strong></p>\n\n<p><strong>Identifiers:</strong></p>\n\n<pre><code>varName\n</code></pre>\n\n<p>This generates: </p>\n\n<pre><code>(Identifier (Name \"varName\"))\n</code></pre>\n\n<p><strong>Method Calls:</strong></p>\n\n<pre><code>methodCall()\n</code></pre>\n\n<p>This generates: </p>\n\n<pre><code>(MethodCall (Name \"methodCall\") (BlockExpr []))\n</code></pre>\n\n<p>Here's an example for parsing general expressions. </p>\n\n<pre><code>expressionParser :: Parser Expr\nexpressionParser\n    =   methodCallParser\n    &lt;|&gt; identifierParser\n</code></pre>\n\n<p>This works fine but I would also like to parse arithmetic expressions in this. </p>\n\n<pre><code>expressionParser :: Parser Expr\nexpressionParser\n    =   newClassInstanceParser\n    &lt;|&gt; methodCallParser\n    &lt;|&gt; AExprAsExpr &lt;$&gt; aExpr\n    &lt;|&gt; identifierParser\n</code></pre>\n\n<p>This means using the <code>expressionParser</code> I can now parse all the different expressions including arithmetic expressions. If it happens to be an arithmetic expression it gets wrapped in <code>AExprAsExpr</code>. </p>\n\n<p><strong>Problem</strong></p>\n\n<p>I would like to parse arithmetic expressions containing other expressions. </p>\n\n<p>E.g.</p>\n\n<pre><code>x + y\n</code></pre>\n\n<p>To do this my original thought was to change the arithmetic parser so it also parses expressions. </p>\n\n<pre><code>data AExpr\n    = ExprAsAExpr Expr\n    | IntConst Integer\n    | Neg AExpr\n    | ABinary ABinOp AExpr AExpr\n    deriving (Show, Eq)\n\naExpr :: Parser AExpr\naExpr = makeExprParser aTerm aOperators\n\naTerm :: Parser AExpr\naTerm\n    =   parens aExpr\n    &lt;|&gt; IntConst &lt;$&gt; integerParser\n    &lt;|&gt; ExprAsAExpr &lt;$&gt; expressionParser\n\naOperators :: [[Operator Parser AExpr]]\naOperators =\n    [ [Prefix (Neg &lt;$ symbol \"-\") ]\n    , [ InfixL (ABinary Multiply &lt;$ symbol \"*\")\n      , InfixL (ABinary Divide   &lt;$ symbol \"/\") ]\n    , [ InfixL (ABinary Add      &lt;$ symbol \"+\")\n      , InfixL (ABinary Subtract &lt;$ symbol \"-\") ]\n    ]\n</code></pre>\n\n<p>The problem with this is there is a recursive loop as <code>aTerm</code> calls the expression parser, the expression parser calls <code>aExpr</code>. This leads to an infinite loop. There is also the issue that all <code>identifiers</code> will now be wrapped inside an <code>AExprAsExpr</code>.</p>\n\n<p>What is the correct method of parsing expressions inside arithmetic expressions? </p>\n"}, {"tags": ["haskell", "constraint-kinds"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525909807, "post_id": 50261658, "comment_id": 87545152, "body": "<a href=\"http://hackage.haskell.org/package/trivial-constraint\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/trivial-constraint</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1525898575, "creation_date": 1525898575, "answer_id": 50261720, "question_id": 50261658, "link": "https://stackoverflow.com/questions/50261658/as-empty-constraint/50261720#50261720", "title": "() as empty constraint", "body": "<p><code>()</code> has kind <code>Constraint</code> and is not meant to be applied to a <code>Type</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 0, "creation_date": 1525900874, "post_id": 50261741, "comment_id": 87542570, "body": "the quote from and link to the mailing list discussion about the topic helped me"}, {"owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "edited": false, "score": 1, "creation_date": 1525901063, "post_id": 50261741, "comment_id": 87542643, "body": "now i guess my mistake was the confusion between &#39;constraint&#39; and &#39;class&#39;"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 5, "last_activity_date": 1525937576, "last_edit_date": 1592644375, "creation_date": 1525898635, "answer_id": 50261741, "question_id": 50261658, "link": "https://stackoverflow.com/questions/50261658/as-empty-constraint/50261741#50261741", "title": "() as empty constraint", "body": "<blockquote>\n<p><code>()</code> has kind <code>*</code> or <code>Constraint</code>, depending on context, never <code>a -&gt; Constraint</code>. Similarly <code>(,)</code> has kind <code>* -&gt; * -&gt; *</code> or <code>Constraint -&gt; Constraint -&gt; Constraint</code>, depending on context.</p>\n<p>\u2014 <a href=\"https://mail.haskell.org/pipermail/glasgow-haskell-users/2011-December/021355.html\" rel=\"nofollow noreferrer\">Simon Peyton-Jones</a></p>\n</blockquote>\n<p>It\u2019s just that <code>()</code> is only overloaded for whether it\u2019s a type or a constraint. That is, you\u2019d write <code>() =&gt; a</code>, not <code>(() a) =&gt; a</code>. So I think this:</p>\n<pre><code>class Empty x\ninstance Empty x\n</code></pre>\n<p>Is the correct solution here. (And perhaps something like that should be in <code>base</code>.)</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525900246, "post_id": 50261994, "comment_id": 87542315, "body": "<code>ConstEmpty</code> is actually completely useless."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525902199, "post_id": 50261994, "comment_id": 87543036, "body": "@dfeuer I included it because the question explicitly asks for something of kind <code>* -&gt; Constraint</code>. Why do you say it&#39;s useless? It looks approximately as useful to me as the <code>class Empty x; instance Empty x</code> solution mentioned in other answers to which you did not object; the only thing you can&#39;t do with it compared to that is partially apply it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1525902410, "post_id": 50261994, "comment_id": 87543104, "body": "Partially applying it is indeed its entire purpose. That makes it <i>useful</i>. For example, if a class has an associated type <code>type Constr a :: * -&gt; Constraint</code>, then <code>type Constr A = Empty</code> is a perfectly good instantiation. <code>ConstEmpty</code>, on the other hand, can only be used fully applied, where the entire application could be written <code>()</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1525899725, "creation_date": 1525899725, "answer_id": 50261994, "question_id": 50261658, "link": "https://stackoverflow.com/questions/50261658/as-empty-constraint/50261994#50261994", "title": "() as empty constraint", "body": "<p>Either of these work fine, depending on what you want:</p>\n\n<pre><code>type Empty = (() :: Constraint)\ntype ConstEmpty x = (() :: Constraint)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1525964820, "last_edit_date": 1525964820, "creation_date": 1525904146, "answer_id": 50262820, "question_id": 50261658, "link": "https://stackoverflow.com/questions/50261658/as-empty-constraint/50262820#50262820", "title": "() as empty constraint", "body": "<p><a href=\"https://stackoverflow.com/a/50261741/1477667\">Jon Purdy's answer</a> is correct. If you want one thing you can slap in regardless of arity (except in an instance head or type family LHS), you're going to need to use some boilerplate:</p>\n\n<pre><code>{-# language PolyKinds, ConstraintKinds, FlexibleInstances,\n    MultiParamTypeClasses, TypeFamilies #-}\n\nimport Data.Kind (Constraint)\n\nclass Unit1 a\ninstance Unit1 a\nclass Unit2 a b\ninstance Unit2 a b\n...\n\ntype family Unit :: k\ntype instance Unit = (() :: Constraint)\ntype instance Unit = Unit1\ntype instance Unit = Unit2\n...\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>Prelude K&gt; type Empty = (Unit :: Type -&gt; Constraint)\nPrelude K&gt; :kind! Empty\nEmpty :: * -&gt; Constraint\n= Unit1\n</code></pre>\n"}], "owner": {"reputation": 2204, "user_id": 112298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/515a5692f7efeba0c7ef6906d67352be?s=128&d=identicon&r=PG", "display_name": "libeako", "link": "https://stackoverflow.com/users/112298/libeako"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "accepted_answer_id": 50261741, "answer_count": 4, "score": 3, "last_activity_date": 1525964820, "creation_date": 1525898325, "question_id": 50261658, "link": "https://stackoverflow.com/questions/50261658/as-empty-constraint", "title": "() as empty constraint", "body": "<p>how can one represent the empty constraint ?</p>\n\n<p>for the following file</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE KindSignatures #-}\n\nimport Data.Kind(Type, Constraint)\n\ntype Empty = (() :: Type -&gt; Constraint)\n\nmain :: IO ()\nmain = return ()\n</code></pre>\n\n<p>ghc 8.2.2 answers </p>\n\n<pre><code>constraint.hs:6:15: error:\n    \u2022 Expected kind \u2018* -&gt; Constraint\u2019, but \u2018()\u2019 has kind \u2018*\u2019\n    \u2022 In the type \u2018(() :: Type -&gt; Constraint)\u2019\n      In the type declaration for \u2018Empty\u2019\n  |\n6 | type Empty = (() :: Type -&gt; Constraint)\n  |  \n</code></pre>\n\n<p>what do i miss ?</p>\n\n<p>i know about the following solution</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nclass Empty x\ninstance Empty x\n</code></pre>\n\n<p>but i want to know why () does not work</p>\n"}, {"tags": ["list", "haskell", "concatenation"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1525898044, "post_id": 50261596, "comment_id": 87541276, "body": "Hint: pattern match with the <code>Element</code> constructor."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525898255, "post_id": 50261596, "comment_id": 87541382, "body": "<code>concatenation (Element x xs) y = ?</code> (The first base case isn&#39;t necessary; <code>concatenation a Empty = a</code> works just fine if <code>a</code> matches <code>Empty</code>.)"}], "answers": [{"tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": false, "score": 3, "last_activity_date": 1525903548, "last_edit_date": 1525903548, "creation_date": 1525903113, "answer_id": 50262642, "question_id": 50261596, "link": "https://stackoverflow.com/questions/50261596/implementing-concatenation-by-hand-in-haskell/50262642#50262642", "title": "Implementing concatenation by hand in haskell", "body": "<p>Just use the standard recursion:</p>\n\n<pre><code>concatenation:: MyList a -&gt; MyList a -&gt; MyList a\nconcatenation Empty l = l\nconcatenation (Element e l1) l2 = Element e (concatenation l1 l2)\n</code></pre>\n\n<p>Why does it stop? The second rule with take every element of the first list, one by one, and nest it before the concatenation of <code>Empty</code> and the second list, that is the second list itself (first rule).</p>\n\n<pre><code>  concatenation Element 1 (... Element n (Empty)) l2\n= Element 1 (concatenation Element 2 (... Element n (Empty))) l2 -- second rule\n= ...\n= Element 1 (Element 2 (... Element n (concatenation Empty l2))) -- second rule\n= Element 1 (Element 2 (... Element n (l2))) -- first rule\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1525940706, "last_edit_date": 1525940706, "creation_date": 1525904759, "answer_id": 50262920, "question_id": 50261596, "link": "https://stackoverflow.com/questions/50261596/implementing-concatenation-by-hand-in-haskell/50262920#50262920", "title": "Implementing concatenation by hand in haskell", "body": "<p>Instead of using variables directly, we can enumerate over the constructors. There are thus four cases we need to cover:</p>\n\n<pre><code>concatenation:: MyList a -&gt; MyList a -&gt; MyList a\nconcatenation Empty Empty = -- ...\nconcatenation Empty (Element b bs) = -- ...\nconcatenation (Element a as) Empty = -- ...\nconcatenation (Element a as) (Element b bs) = -- ...\n</code></pre>\n\n<p>Now we can aim to solve those cases. Concatenating two <code>Empty</code> lists will return an empty list, so <code>Empty</code>.</p>\n\n<pre><code>concatenation Empty Empty = Empty\n</code></pre>\n\n<p>In case the first list is <code>Empty</code>, and the latter is not, then we return the second list.</p>\n\n<pre><code>concatenation Empty (Element b bs) = Element b bs\n</code></pre>\n\n<p>in case the first element is a list, and the latter is not, then we can return the first list:</p>\n\n<pre><code>concatenation (Element a as) Empty = Element a as\n</code></pre>\n\n<p>finally in case both lists are non-empty, then the resulting list starts with the first element of the first list, followed by the concatenation of the tail of the first list, and the second list:</p>\n\n<pre><code>concatenation (Element a as) (Element b bs) = Element a (concatenation as (Element b bs))\n</code></pre>\n\n<p>this gives us the following code:</p>\n\n<pre><code>concatenation:: MyList a -&gt; MyList a -&gt; MyList a\nconcatenation Empty Empty = Empty\nconcatenation Empty (Element b bs) = Element b bs\nconcatenation (Element a as) Empty = Element a as\nconcatenation (Element a as) (Element b bs) = Element a (concatenation as (Element b bs))\n</code></pre>\n\n<p>We can shorten the implementation with <em>as patterns</em>:</p>\n\n<pre><code>concatenation:: MyList a -&gt; MyList a -&gt; MyList a\nconcatenation Empty Empty = Empty\nconcatenation Empty bl@(Element b bs) = bl\nconcatenation al@(Element a as) Empty = al\nconcatenation (Element a as) bl@(Element b bs) = Element a (concatenation as bl)\n</code></pre>\n\n<p>But this is rather verbose, furthermore it performs pattern matching on both lists, which can be expensive: if for example the second list requires expensive computations first, and the first list is long enough (or even infinite), then we will never be interested in the second list anyway.</p>\n\n<p>We thus can look if we can compact the number of clauses. The first two lines can be grouped together, from:</p>\n\n<pre><code>concatenation Empty Empty = Empty\nconcatenation Empty (Element b bs) = Element b bs\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>concatenation Empty bl = bl\n</code></pre>\n\n<p>since regardless of the value of the second list, we return that anyway. It also saves us potentially an evaluation, which can result in more effecient code.</p>\n\n<p>Can we do a similar thing with the last two lines?</p>\n\n<pre><code>concatenation (Element a as) Empty = Element a as\nconcatenation (Element a as) bl@(Element b bs) = Element a (concatenation as bl)\n</code></pre>\n\n<p>both have as a result an <code>Element</code> constructor, and <code>a</code> as the first element. Since the concatenation of <code>as</code> and <code>Empty</code> is eventually <code>concatenation as Empty = as</code>, we thus can perform a recursive call in the former case as well, and use:</p>\n\n<pre><code>concatenation (Element a as) bl = Element a (concatenation as bl)\n</code></pre>\n\n<p>and this results into:</p>\n\n<pre><code>concatenation :: MyList a -&gt; MyList a -&gt; MyList a\nconcatenation Empty bl = bl\nconcatenation (Element a as) bl = Element a (concatenation as bl)\n</code></pre>\n\n<p>we can omit the second parameter here with:</p>\n\n<pre><code>concatenation :: MyList a -&gt; MyList a -&gt; MyList a\nconcatenation Empty = id\nconcatenation (Element a as) = Element a . concatenation as\n</code></pre>\n\n<p>Note that the last reduction is not per se more efficient: this can result in constructing an entire copy of a (potentially large) list into memory, and a lot of computations if the second list turns out to be empty. If on the other hand computing the second list would result in getting stuck in an infinite loop or an expensive computation, and we are not interested in that part, we can potentially save a lot of CPU cycles.</p>\n"}], "owner": {"reputation": 726, "user_id": 9767286, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216280821678325/picture?type=large", "display_name": "Jones1220", "link": "https://stackoverflow.com/users/9767286/jones1220"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 493, "favorite_count": 0, "accepted_answer_id": 50262920, "answer_count": 2, "score": 1, "last_activity_date": 1525940706, "creation_date": 1525898008, "last_edit_date": 1525900184, "question_id": 50261596, "link": "https://stackoverflow.com/questions/50261596/implementing-concatenation-by-hand-in-haskell", "title": "Implementing concatenation by hand in haskell", "body": "<p>How can I implement the concatenation operator in Haskell by hand? \nThis is what I have so far, but I am struggling with the recursion at the end:</p>\n\n<pre><code>data MyList a = Empty | Element a (MyList a)\n deriving Show\n\nconcatenation:: MyList a -&gt; MyList a -&gt; MyList a\nconcatenation Empty Empty = Empty\nconcatenation a Empty = a\nconcatenation Empty a = a\nconcatenation x y = ???\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1525894606, "post_id": 50260591, "comment_id": 87539710, "body": "<code>IO</code> itself is not magic, just the state that it wraps. <code>newtype IO a = IO (magic -&gt; (magic, a))</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1525896205, "post_id": 50260591, "comment_id": 87540466, "body": "@chepner it is though, because the state-passing &quot;semantics&quot; can not model some of its features, specifically <code>forkIO</code>.  (You can of course make the argument that the magic of <i>magic</i> is what handles threading too, but we are beginning to reach pretty far)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1525896934, "post_id": 50260591, "comment_id": 87540782, "body": "The monadness of the monad you are after must rely on some property of pure code that is not guaranteed also by a monad law.  One example of such a property would be <code>const x y == x</code>  (in monad land that is <code>const &lt;$&gt; x &lt;*&gt; y == x</code> which is not true).  Maybe that&#39;s a place to start."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525898388, "post_id": 50260591, "comment_id": 87541451, "body": "@chepner: Isn\u2019t the only magic thing about <code>RealWorld</code> that it\u2019s neither unlifted (because it has kind <code>*</code>) nor lifted (because it has no runtime representation and so doesn\u2019t contain \u22a5)? Or does GHC treat <code>RealWorld</code> values in some other special way that doesn\u2019t follow from those properties? I can\u2019t seem to find any documentation on what\u2019s <i>really</i> magical about it other than that."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1525900400, "post_id": 50260591, "comment_id": 87542380, "body": "If we throw away the magic effectful <code>IO</code>, and concentrate on pure functions, is there a reason why a monad transformer may fail to exist? That is, can we take such a pair of wel-behaved, pure-functional monads that producing a transformer cannot logically be constructed? I frankly don&#39;t see why that could happen. What law of monad transformers could we potentially even break?"}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1525903099, "post_id": 50260591, "comment_id": 87543321, "body": "@9000 I updated my question to add a qualification that, indeed, we are interested only in pure functions. Let me rephrase the question more, to answer your comment. Basically, while you say you don&#39;t see how we could violate the laws of monad transformers, you seem to assume that it&#39;s obvious <i>how to write</i> a monad transformer, given any type constructor of some monad and an implementation of its monad instance. But the point of my question is that we have no procedure that will accomplish that in the general case."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525916348, "post_id": 50260591, "comment_id": 87546554, "body": "@JonPurdy, that remark is really about how the <code>RealWorld</code> type is manufactured by GHC. It&#39;s of absolutely no relevance to the model of <code>IO</code> or anything even low-level <code>IO</code> hacking libraries need to care one whit about. But there is <i>plenty</i> of disgusting magic in the optimizer relating to things that pass <code>State#</code> values around, which is why the extreme brokenness of the <code>IO</code> type turns out to be a problem in practice. The biggest problem is strictness analysis."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1525918712, "post_id": 50260591, "comment_id": 87547073, "body": "&quot;<code>ListT</code> done right&quot; is from 2007. The original (somewhat invalid) <code>ListT</code> seems to have shown up in GHC 5, in 2002. So I&#39;m not sure I&#39;d say even &quot;relatively recently&quot;."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 1, "creation_date": 1525920860, "post_id": 50260591, "comment_id": 87547585, "body": "I don&#39;t quite understand what do you mean by &quot;a monad transformer of a monad&quot;. A monad transformer is a wrapper over another type, which is, given that the underlying type is a monad, also a monad. But, if you, instead, start with a concrete type F, what do you mean by &quot;monad transformer for F&quot;"}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1525921727, "post_id": 50260591, "comment_id": 87547754, "body": "If you are looking for a regular way to build monad transformers, you probably should take a look at <a href=\"http://okmij.org/ftp/Computation/free-monad.html#freer\" rel=\"nofollow noreferrer\">Freer monad</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 4, "creation_date": 1525924175, "post_id": 50260591, "comment_id": 87548349, "body": "@max630 Presumably <code>T</code> is a monad transformer for <code>F</code> if <code>T</code> is a monad transformer and there is a monad isomorphism between <code>T Identity</code> and <code>F</code> (that is, a standard isomorphism that respects bind and return)."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525937503, "post_id": 50260591, "comment_id": 87553272, "body": "@dfeuer: Thanks, I was grepping for <code>RealWorld</code> in the GHC sources when I should\u2019ve been looking at <code>State#</code>. Time to read some code!"}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "reply_to_user": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1525986838, "post_id": 50260591, "comment_id": 87579729, "body": "@max630 I call <code>ReaderT</code> the &quot;monad transformer of the <code>Reader</code> monad&quot;, <code>WriterT</code> the &quot;monad transformer of the <code>Writer</code> monad` etc. What would you call that? For example, how you would fill the blank in &quot;The monad transformer <code>ListT</code> is _____  of / for / from / to / ... the <code>List</code> monad&quot;?"}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "reply_to_user": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1525987183, "post_id": 50260591, "comment_id": 87579866, "body": "@max630 I am familiar with free monads and the &quot;freer&quot; paper. The free monad has a monad transformer, which is defined in a way different from the way we define <code>ReaderT</code>, <code>WriterT</code>, <code>StateT</code>, <code>ListT</code>, or <code>ContT</code>. So, the construction of the free monad&#39;s monad transformer does not really help me to understand how to construct monad transformers for monads in a systematic way. I have updated my question to reflect this comment."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525990553, "post_id": 50260591, "comment_id": 87581041, "body": "There are at least two other possibilities you don&#39;t mention. It may be possible to prove that such a transformer exists (according to some well-accepted mathematical theory) even if the algorithm you seek does not exist. Indeed, I&#39;d place my bet on that possibility or a counterexample. It&#39;s also possible that this is independent of the rest of mathematics, although I doubt it."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1526040863, "post_id": 50260591, "comment_id": 87600401, "body": "Is this a duplicate of <a href=\"https://stackoverflow.com/questions/24515876/is-there-a-monad-that-doesnt-have-a-corresponding-monad-transformer-except-io\" title=\"is there a monad that doesnt have a corresponding monad transformer except io\">stackoverflow.com/questions/24515876/&hellip;</a> ?"}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1526055124, "post_id": 50260591, "comment_id": 87609449, "body": "@BenjaminHodgson Yes, thank you. A very similar question indeed. I don&#39;t see a satisfactory (constructive) answer there. In the accepted answer, it is claimed that every monad has a monad transformer, but no constructive procedure is given for deriving a monad transformer given the source code of a monad."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1526055796, "post_id": 50260591, "comment_id": 87609778, "body": "The answer there describes how to go from an adjunction to a corresponding monad transformer, so all that remains is to go from the monad to the underlying adjunction. <a href=\"https://bartoszmilewski.com/2017/03/14/algebras-for-monads/\" rel=\"nofollow noreferrer\">Bartosz Milewski&#39;s blog</a> delivers, as always, with a Haskell-oriented description of that decomposition process. Have a Google for &quot;monadic adjunction&quot; for more info"}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1526058434, "post_id": 50260591, "comment_id": 87611098, "body": "@BenjaminHodgson Thank you, this is useful. Although Bartosz also says that there is a whole family of adjunctions, not a unique one. I will try to see if his blog really answers the question. Can&#39;t wait to see how to construct monad transformers for the examples <code>Q u v a</code> and <code>F a</code> in my question. Hopefully it won&#39;t be just a statement about the &quot;existence&quot; of some functor."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1526351378, "post_id": 50260591, "comment_id": 87699066, "body": "@BenjaminHodgson No, unfortunately Bartosz Milewski&#39;s blog gives only a purely theoretical construction: the EM and the Kleisli adjunctions. There is no indication about how to find the specific program code that correspond to these functors and categories... It also says that there is a whole category of adjunctions, so the EM and the K adjunctions are perhaps not the only two. So, even if we can find the code that represents them, we will not know which one actually yields correct monad transformers. Disappointed."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1547778214, "post_id": 50260591, "comment_id": 95318236, "body": "Found an example of a monad that probably doesn&#39;t have an explicit monad transformer. <code>L a = Either a (r -&gt; a)</code> where <code>r</code> is a fixed type. My efforts to guess its monad transformer failed so far. See also my new answer in <a href=\"https://stackoverflow.com/a/54177543/593934\">stackoverflow.com/a/54177543/593934</a>"}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1615668925, "post_id": 50260591, "comment_id": 117764808, "body": "My claim was wrong: the monad <code>L</code> defined by <code>type L a = Either a (r -&gt; a)</code> has a lawful monad transformer. The type is <code>type LT m a = m (Either a (r -&gt; m a))</code>. This was not obvious to me 2 years ago. Details are in the book &quot;The Science of Functional Programming&quot; chapter 14. <a href=\"https://github.com/winitzki/sofp\" rel=\"nofollow noreferrer\">github.com/winitzki/sofp</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1525986926, "post_id": 50278953, "comment_id": 87579783, "body": "You seem to be making a free monad out of a given monad first. This produces a different monad. A free monad built out of a monad <code>F</code> has a monad transformer, of course, but it will not be the monad transformer of <code>F</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1525987674, "post_id": 50278953, "comment_id": 87580023, "body": "@winitzki, <code>IOF</code> isn&#39;t a monad. It&#39;s the base functor of <code>IO</code>. You can use Churchy versions of <code>Free</code> and <code>FreeT</code> to get somewhat more precise isomorphisms, but I think this should already do if you watch your abstraction barrier."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1525987746, "post_id": 50278953, "comment_id": 87580047, "body": "Like I said, though, this isn&#39;t a proper answer because (unlike <code>IO</code>), not every monad is a free monad."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1525989239, "post_id": 50278953, "comment_id": 87580614, "body": "How is <code>IOF</code> defined, what is the type expression for <code>IOF a</code> such that <code>Free IOF</code> (i.e. the free monad built on IOF) is equivalent to the <code>IO</code> monad? I think, either this can&#39;t be done, or <code>IOF</code> must be an opaque type, not definable in the pure lambda calculus, just like <code>IO</code> is. In the example you gave, <code>IOF a</code> is defined as the functor equivalent to <code>Either (String, a) (String -&gt; a)</code>. The free monad based on this will be certainly a monad, but it will not be the same as the <code>IO</code> monad."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 1, "creation_date": 1525989983, "post_id": 50278953, "comment_id": 87580861, "body": "@winitzki, that type represents a hypothetical type with far more constructors. And I&#39;m assuming that <code>IO</code> and <code>IOT</code> are hidden (by the module system) so they only expose certain operations (and can&#39;t be inspected generally). It would actually be possible for a Haskell implementation to implement <code>IO</code> in a similar fashion. Obviously, there&#39;s no way to map <code>IO a -&gt; MyIO a</code> in Glasgow Haskell, but that&#39;s not a very interesting fact."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1525984002, "last_edit_date": 1525984002, "creation_date": 1525975484, "answer_id": 50278953, "question_id": 50260591, "link": "https://stackoverflow.com/questions/50260591/what-is-an-explicit-example-of-a-monad-without-a-monad-transformer/50278953#50278953", "title": "What is an explicit example of a monad without a monad transformer?", "body": "<p>This isn't an answer, but it's way too big for a comment. We can write</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving\n  , DeriveFunctor #-}\n\nimport Control.Monad.Free\n\n-- All the IO primops you could ever need\ndata IOF a = PutStrLn String a\n           | GetLine (String -&gt; a)\n           deriving Functor\n\nnewtype MyIO a = MyIO {unMyIO :: Free IOF a}\n  deriving (Functor, Applicative, Monad)\n</code></pre>\n\n<p>But we can actually make a monad transformer out of this:</p>\n\n<pre><code>import Control.Monad.Trans.Free\n\nnewtype IOT m a = IOT {unIOT :: FreeT IOF m a}\n  deriving (Functor, Applicative, Monad, MonadTrans)\n</code></pre>\n\n<p>So I don't really think even <code>IO</code> is excluded, although the isomorphism in that case is not \"internal\".</p>\n"}], "owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 2, "closed_date": 1526056519, "answer_count": 1, "score": 16, "last_activity_date": 1526001241, "creation_date": 1525893440, "last_edit_date": 1526001241, "question_id": 50260591, "link": "https://stackoverflow.com/questions/50260591/what-is-an-explicit-example-of-a-monad-without-a-monad-transformer", "closed_reason": "Duplicate", "title": "What is an explicit example of a monad without a monad transformer?", "body": "<p>Monad transformers are known for all standard monads (Reader, Writer, State, Cont, List, etc.), but each of these monad transformers works in a slightly different way. There is no general method or formula for constructing a monad transformer given a definition of a type constructor with a monad instance. So, it is not assured that a monad data type designed according to some arbitrary business requirements will have a monad transformer. Is there such an explicit example?</p>\n\n<h2>Related work</h2>\n\n<p><a href=\"https://stackoverflow.com/questions/13034229\">Another question</a> explains that a functor composition of two monads is not necessarily a monad. See also <a href=\"https://stackoverflow.com/questions/13034229/concrete-example-showing-that-monads-are-not-closed-under-composition-with-proo\">this question</a>. Those examples do not answer the present question - they merely illustrate the problem of having no general method for constructing a monad transformer. Those examples show that, given two monads M and N, we will sometimes find that M (N a) is a monad, sometimes that N (M a) is a monad, and sometimes neither will be a monad. But this shows neither how to construct a monad transformer for M or N, nor whether it exists at all.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/11792275/is-access-to-the-internal-structure-of-a-monad-required-for-a-monad-transformer\">An answer to another question</a> argues that the <code>IO</code> monad <em>cannot</em> have a monad transformer because if it had one <code>IOT</code>, we could apply <code>IOT</code> to <code>List</code>, and then lifting an empty list (<code>lift []</code>) into the resulting monad would have to undo the side effects performed \"earlier\" by the IO monad. This argument is based on the idea that the <code>IO</code> monad \"actually performs\" side effects that, presumably, cannot be undone. However, the <code>IO</code> monad is not an explicit type constructor.</p>\n\n<h2>Discussion</h2>\n\n<p>In every example where a monad type is given explicitly, a monad transformer could be found <em>somehow</em>, - sometimes with certain ingenuity required. For example, the <code>ListT</code> transformer that existed in the Haskell library was <a href=\"https://wiki.haskell.org/ListT_done_right\" rel=\"nofollow noreferrer\">relatively recently</a> found to be incorrect in a subtle way, but the problem was eventually fixed by changing the definition of <code>ListT</code>.</p>\n\n<p>Standard examples of monads without transformers are monads such as <code>IO</code>, which is actually not defined by an explicit type constructor - <code>IO</code> is an opaque \"magic\" type defined by the library <em>somehow</em>, at low level. It seems clear that one <em>cannot</em> define <code>IO</code> as an explicit type constructor, with a monad instance given by pure functions. The <code>IO</code> example shows that a monad transformer may fail to exist if we allow the monad instance to contain hidden low-level code with impure side effects. So, let us limit our attention to monads implemented using pure functions.</p>\n\n<p>There does not seem to be an algorithm that would derive monad transformers automatically from the monad's source code. Do we even know that this is always possible?</p>\n\n<p>To make it more clear what I mean by an \"explicit example\" of a monad: Suppose I claim that</p>\n\n<pre><code> type Q u v a = ((u -&gt; (a, Maybe a)) -&gt; v) -&gt; u -&gt; (a, Maybe a)\n</code></pre>\n\n<p>can have a lawful <code>Monad</code> instance with respect to the type parameter <code>a</code>, and I produce the source code for an implementation of the <code>Monad</code> instance for <code>Q u v</code> as pure functions <code>return</code> and <code>join</code>. Do we then know that <code>Q u v</code> has a monad transformer <code>QT u v</code> such that <code>QT u v Id</code> is equivalent to <code>Q u v</code>, and the laws of the monad transformers hold? Do we then know how to construct <code>QT</code> explicitly? I don't.</p>\n\n<p>To decide this question, we need either</p>\n\n<ul>\n<li>to demonstrate an algorithm that would find a monad transformer from an arbitrary given type constructor and a given implementation of a monad instance; e.g. given the code <code>type F a = r -&gt; Either (a, a) (a, a, Maybe a)</code> and an implementation of a monad instance for this, to find the code for the monad transformer; let's limit ourselves to type constructors made out of any combination of <code>-&gt;</code>, tuple, and <code>Either</code> for simplicity; or</li>\n<li>to demonstrate a counterexample: an <em>explicit</em> monad type constructor, given by an explicit code definition, e.g. <code>type F a = r -&gt; Either (a, a, a) (a, a, Maybe a)</code> or whatever, such that this is a lawful <code>Monad</code>, with a <code>Monad</code> instance given by pure functions, but we can <em>prove</em> that <code>F</code> has no monad transformer.</li>\n</ul>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1525892379, "post_id": 50260118, "comment_id": 87538623, "body": "I think I&#39;d write a modified <code>words</code> that keeps track of when it sees quote characters, and doesn&#39;t break the string when it&#39;s between them."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525892980, "post_id": 50260118, "comment_id": 87538892, "body": "A regex actually can do this properly."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1525970170, "post_id": 50260118, "comment_id": 87571713, "body": "Your function is fine, except use <code>foldl1</code> instead of <code>foldl</code> and remove the <code>&quot;&quot;</code> just before <code>. words</code>. The initial value is what is causing the extra `&quot; --conf &quot; at the beginning."}, {"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "reply_to_user": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 1, "creation_date": 1525970364, "post_id": 50260118, "comment_id": 87571830, "body": "@fp_mora Thanks, but that&#39;s not the issue (and in fact, the &quot;--conf&quot; at the beginning is desired).  The issue is that <code>words</code> splits the options inside of the escaped quotes, which is not desired.  See the answer of @wp78de below, which seems like it would work, except for the fact that the regex engine I&#39;m using (<code>regex-compat</code>) doesn&#39;t seem to like the <code>++</code> and <code>?:</code> symbols."}], "answers": [{"comments": [{"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 0, "creation_date": 1525963752, "post_id": 50266228, "comment_id": 87567922, "body": "Thank you for your answer; this is really promising.  I had been trying to use <code>subRegex</code> but could not get the right pattern.  I had to escape the backslashes and quotes in your pattern to get it to not complain about &quot;lexical errors&quot;, but now I&#39;m getting &quot;repetition-operator operand invalid&quot;.  E.g., with <code>pattern = &quot;[^\\\\s\\&quot;]+|\\\\s[^\\\\s\\&quot;]++\\&quot;(?:[^\\&quot;]*)\\&quot;\\\\s&quot;</code> and <code>x = &quot;spark.yarn.memoryOverhead=3g spark.executor.extraJavaOptions=\\&quot;-verbose:gc -XX:+UseSerialGC -XX:+PrintGCDetails -XX:+PrintAdaptiveSizePolicy\\&quot; spark.default.parallelism=1000 spark.yarn.executor.memoryOverhead=2000&quot;</code>"}, {"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 0, "creation_date": 1525963811, "post_id": 50266228, "comment_id": 87567966, "body": "... I write <code>subRegex (mkRegex pattern) x &quot;--conf \\0&quot;</code> and get the following error: &quot;&quot;*** Exception: user error (Text.Regex.Posix.String died: (ReturnCode 13,&quot;repetition-operator operand invalid&quot;))&quot;  Any idea which operand it&#39;s talking about?"}, {"owner": {"reputation": 16007, "user_id": 8291949, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a7pBo.gif?s=128&g=1", "display_name": "wp78de", "link": "https://stackoverflow.com/users/8291949/wp78de"}, "reply_to_user": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 0, "creation_date": 1525975930, "post_id": 50266228, "comment_id": 87574686, "body": "@user4601931 Sorry, I cannot test this end-to-end since I don&#39;t code in Haskell and there are too many regex flavors. Try a single <code>+</code> instead of the <code>++</code>."}, {"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 0, "creation_date": 1525985702, "post_id": 50266228, "comment_id": 87579283, "body": "Thanks for your reply, understandable as this now seems less like a Haskell question and more like a regex question.  Changing <code>++</code> to <code>+</code> works, but it doesn&#39;t like <code>?:</code>.  Removing this symbol altogether works (as in, it doesn&#39;t error out), but now it doesn&#39;t actually match anything it seems.  Which is strange, given what I now understand <code>?:</code> to mean."}, {"owner": {"reputation": 16007, "user_id": 8291949, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a7pBo.gif?s=128&g=1", "display_name": "wp78de", "link": "https://stackoverflow.com/users/8291949/wp78de"}, "reply_to_user": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 0, "creation_date": 1526000190, "post_id": 50266228, "comment_id": 87583369, "body": "Have you tried it like that: <code>[^\\s&quot;]+|\\s[^\\s&quot;]+&quot;[^&quot;]*&quot;\\s</code> ? I am sorry, there is not much else I can do."}, {"owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "edited": false, "score": 1, "creation_date": 1526011226, "post_id": 50266228, "comment_id": 87585682, "body": "This is the one that ended up working: <code>[^\\\\ \\&quot;]+| [^\\\\ \\&quot;]+\\&quot;([^\\&quot;]*)\\&quot;</code>.  Thanks for putting me on the right track!"}], "tags": [], "owner": {"reputation": 16007, "user_id": 8291949, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a7pBo.gif?s=128&g=1", "display_name": "wp78de", "link": "https://stackoverflow.com/users/8291949/wp78de"}, "is_accepted": true, "score": 1, "last_activity_date": 1525930952, "creation_date": 1525930952, "answer_id": 50266228, "question_id": 50260118, "link": "https://stackoverflow.com/questions/50260118/split-on-space-while-ignoring-escaped-quotes/50266228#50266228", "title": "Split on space while ignoring escaped quotes", "body": "<p>A split is not the right weapon of choice here. Inspired by <a href=\"https://stackoverflow.com/users/33358/jan-goyvaerts\">Jan Goyvaerts</a> answer <a href=\"https://stackoverflow.com/a/366532/8291949\">here</a> I suggest substituting a match pattern instead that:</p>\n\n<ol>\n<li>matches characters that aren't spaces or quotes, </li>\n<li>and 1) followed by characters that begin and end with a quote, with no quotes in between.</li>\n</ol>\n\n\n\n<pre><code>[^\\s\"]+|\\s[^\\s\"]++\"(?:[^\"]*)\"\\s\n</code></pre>\n\n<p>Output after substitution: <code>--conf $0</code></p>\n\n<pre><code> --conf spark.yarn.memoryOverhead=3g --conf  spark.executor.extraJavaOptions=\\\"-verbose:gc -XX:+UseSerialGC\n-XX:+PrintGCDetails -XX:+PrintAdaptiveSizePolicy\\\"  --conf spark.default.parallelism=1000  --conf spark.yarn.executor.memoryOverhead=2000\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/1ReQJY/1/\" rel=\"nofollow noreferrer\"><strong>Demo</strong></a></p>\n\n<p>I hope, this is useful to you.</p>\n\n<p><em>Note</em>: There are some unnecessary spaces in the output since I had to add surrounding spaces to the second pattern. I haven't treated them since it would make the regex even more complicated and your CLI app won't complain, I guess.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1526150322, "last_edit_date": 1526150322, "creation_date": 1525991166, "answer_id": 50282359, "question_id": 50260118, "link": "https://stackoverflow.com/questions/50260118/split-on-space-while-ignoring-escaped-quotes/50282359#50282359", "title": "Split on space while ignoring escaped quotes", "body": "<p>I have a useless but interesting partial solution. It assembles strings that are assembled by <code>words</code>. It is a 'scanl1' function so outputs an partially assembled string before the final string. </p>\n\n<pre><code>strl = \"spark.yarn.memoryOverhead=3g spark.executor.extraJavaOptions=\\\"-verbose:gc -XX:+UseSerialGC -XX:+PrintGCDetails -XX:+PrintAdaptiveSizePolicy\\\" spark.default.parallelism=1000 spark.yarn.executor.memoryOverhead=2000\"\n</code></pre>\n\n<p>Now the function</p>\n\n<pre><code>t = scanl1 (\\acc l -&gt; if (take 5 l) == \"spark\" then \"--conf \" ++ l else  acc ++ l ) $ words strl\n</code></pre>\n\n<p>Now the results with three excess records</p>\n\n<pre><code>t !! 0\n\"spark.yarn.memoryOverhead=3g\"\nt !! 1\n\"spark.executor.extraJavaOptions=\\\"-verbose:gc\"\nt !! 2\n\"spark.executor.extraJavaOptions=\\\"-verbose:gc-XX:+UseSerialGC\"\nt !! 3\n\"spark.executor.extraJavaOptions=\\\"-verbose:gc-XX:+UseSerialGC-XX:+PrintGCDetails\"\nt !! 4\n\"spark.executor.extraJavaOptions=\\\"-verbose:gc-XX:+UseSerialGC-XX:+PrintGCDetails-XX:+PrintAdaptiveSizePolicy\\\"\"\nt !! 5\n\"spark.default.parallelism=1000\"\nt !! 6\n\"spark.yarn.executor.memoryOverhead=2000\"\n</code></pre>\n\n<p>The only thing going for this is it assembles correctly if excessively.\nI added the <code>--conf</code> after I ran it otherwise it would appear before each line</p>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 0, "last_activity_date": 1607649703, "creation_date": 1607649703, "answer_id": 65244532, "question_id": 50260118, "link": "https://stackoverflow.com/questions/50260118/split-on-space-while-ignoring-escaped-quotes/65244532#65244532", "title": "Split on space while ignoring escaped quotes", "body": "<blockquote>\n<p>This sort of makes me feel like regex isn't the right tool for the job, hence my question, <strong>what is the right tool for this job</strong>?</p>\n</blockquote>\n<p>The right tool for this job is <em>monadic parsers</em>.</p>\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport Replace.Megaparsec\nimport Data.Void\nimport Data.Either\n\n-- | Invert a single-token parser \u201ccharacter class\u201d.\n-- | For example, match any single token except a letter or whitespace: \n-- |\n-- |     anySingleExcept (letterChar &lt;|&gt; spaceChar)\n-- |\nanySingleExcept :: (MonadParsec e s m, Token s ~ Char) =&gt; m (Token s) -&gt; m (Token s)\nanySingleExcept p = notFollowedBy p *&gt; anySingle\n\nnonSpaceQuoted :: Parsec Void String String\nnonSpaceQuoted = \n  ((chunk &quot;\\\\\\&quot;&quot;) *&gt; manyTill anySingle (chunk &quot;\\\\\\&quot;&quot;)) -- match anything between escaped quotes\n  &lt;|&gt; -- or\n  (pure &lt;$&gt; anySingleExcept spaceChar) -- match anything that's not a space\n\nwordsQuoted :: Parsec Void String String\nwordsQuoted = fst &lt;$&gt; match (some nonSpaceQuoted)\n\ninput = &quot;spark.yarn.memoryOverhead=3g spark.executor.extraJavaOptions=\\\\\\&quot;-verbose:gc -XX:+UseSerialGC -XX:+PrintGCDetails -XX:+PrintAdaptiveSizePolicy\\\\\\&quot; spark.default.parallelism=1000 spark.yarn.executor.memoryOverhead=2000&quot;\n\nputStrLn $ unlines $ fmap (&quot;--conf &quot; &lt;&gt;) $ rights $ splitCap wordsQuoted input\n</code></pre>\n<p>Here's the output, printed with <code>unlines</code> instead of <code>unwords</code> for clarity:</p>\n<pre><code>--conf spark.yarn.memoryOverhead=3g\n--conf spark.executor.extraJavaOptions=\\&quot;-verbose:gc -XX:+UseSerialGC -XX:+PrintGCDetails -XX:+PrintAdaptiveSizePolicy\\&quot;\n--conf spark.default.parallelism=1000\n--conf spark.yarn.executor.memoryOverhead=2000\n</code></pre>\n"}], "owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 50266228, "answer_count": 3, "score": 1, "last_activity_date": 1607649703, "creation_date": 1525891370, "question_id": 50260118, "link": "https://stackoverflow.com/questions/50260118/split-on-space-while-ignoring-escaped-quotes", "title": "Split on space while ignoring escaped quotes", "body": "<p>I would like to take a string representing options to a spark-submit command and format them with <code>--conf</code> interspersed between the options.  This</p>\n\n<pre><code>concatConf :: String -&gt; String\nconcatConf = foldl (\\acc c -&gt; acc ++ \" --conf \" ++ c) \"\" . words\n</code></pre>\n\n<p>works for most collections of options, e.g.,</p>\n\n<pre><code>\u03bb =&gt; concatConf \"spark.yarn.memoryOverhead=3g spark.default.parallelism=1000 spark.yarn.executor.memoryOverhead=2000\"\n\" --conf spark.yarn.memoryOverhead=3g --conf spark.default.parallelism=1000 --conf spark.yarn.executor.memoryOverhead=2000\"\n</code></pre>\n\n<p>But on occasion there can be <code>spark.executor.extraJavaOptions</code>, which is a space-separated, escaped-quote enclosed, list of additional options; for example, </p>\n\n<pre><code>\"spark.yarn.memoryOverhead=3g spark.executor.extraJavaOptions=\\\"-verbose:gc -XX:+UseSerialGC -XX:+PrintGCDetails -XX:+PrintAdaptiveSizePolicy\\\" spark.default.parallelism=1000 spark.yarn.executor.memoryOverhead=2000\"\n</code></pre>\n\n<p>and the <code>concatConf</code> function above obviously breaks down.  </p>\n\n<p>The following function, using the <a href=\"https://hackage.haskell.org/package/regex-compat-0.95.1/docs/Text-Regex.html\" rel=\"nofollow noreferrer\"><code>regex-compat</code></a> library works for this example</p>\n\n<pre><code>import Data.Monoid (&lt;&gt;)\nimport Text.Regex (mkRegex, matchRegexAll)\n\nconcatConf :: String -&gt; String\nconcatConf conf = let regex = mkRegex \"(\\\\ *.*extraJavaOptions=\\\\\\\".*\\\\\\\")\"\n                  in case matchRegexAll regex conf of\n                    Just (x, y, z, _) -&gt; (insConf x) &lt;&gt; \" --conf \" &lt;&gt; y &lt;&gt; (insConf z)\n                    Nothing           -&gt; \"\"\n                  where insConf = foldl (\\acc c -&gt; acc ++ \" --conf \" ++ c) \"\" . words\n</code></pre>\n\n<p>until you figure out that there's a similar <code>spark.driver.extraJavaOptions</code> that comes in a similar format.  In any case, this function doesn't work for when there isn't such an option.  Now I'm struggling with many cases: where there is none or one or both of these, which one appears first in the string if it's there, etc.</p>\n\n<p>This sort of makes me feel like regex isn't the right tool for the job, hence my question, <strong>what is the right tool for this job?</strong>  </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1525890319, "creation_date": 1525890319, "answer_id": 50259861, "question_id": 50259647, "link": "https://stackoverflow.com/questions/50259647/function-types-as-monadreader/50259861#50259861", "title": "Function types as MonadReader", "body": "<p>The key point is that you used the syntax for <em>application</em>.</p>\n\n<p>When you write</p>\n\n<pre><code>view (point . x) (Atom \"C\" (Point 1 2))\n</code></pre>\n\n<p>you are essentially writing the application <code>f a</code> where <code>f = view (point . x)</code> and <code>a = Atom \"C\" (Point 1 2)</code>. To type check <code>f a</code> GHC initially starts from</p>\n\n<pre><code>f :: t1 -&gt; t2     -- in prefix for rm, this is written as (-&gt;) t1 t2\na :: t1\n</code></pre>\n\n<p>for some fresh type variables <code>t1, t2</code>. This is always done for all applications.\n(Well, almost. Some advanced types require a more careful algorithm, but I'll neglect that.)</p>\n\n<p>However, GHC also knows</p>\n\n<pre><code>f :: MonadReader Atom m =&gt; m Double\na :: Atom\n</code></pre>\n\n<p>so it deduces <code>t1 ~ Atom</code> and <code>m ~ (-&gt;) t1 ~ (-&gt;) Atom</code>. Since this is indeed a <code>MonadRead Atom</code> instance, it proceeds with that.</p>\n"}], "owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 50259861, "answer_count": 1, "score": 3, "last_activity_date": 1525890319, "creation_date": 1525889450, "question_id": 50259647, "link": "https://stackoverflow.com/questions/50259647/function-types-as-monadreader", "title": "Function types as MonadReader", "body": "<p>I'm going through the <code>lens</code> <a href=\"http://hackage.haskell.org/package/lens-tutorial-1.0.3/docs/Control-Lens-Tutorial.html\" rel=\"nofollow noreferrer\">tutorial</a> and, in particular, trying to wrap my head around the types involved in <code>view</code>.</p>\n\n<p>So, taking the definitions</p>\n\n<pre><code>data Atom = Atom { _element :: String, _point :: Point }\ndata Point = Point { _x :: Double, _y :: Double }\nmakeLenses ''Atom\nmakeLenses ''Point\n</code></pre>\n\n<p>let's inspect the type of the expression <code>view (point . x)</code>:</p>\n\n<pre><code>*Main&gt; :t view (point . x)\nview (point . x) :: MonadReader Atom m =&gt; m Double\n</code></pre>\n\n<p>So, given an environment with an <code>Atom</code> we can produce a <code>Double</code> wrapped in a <code>MonadReader</code>. Nice, that's even more generic than a lens newbie could expect!</p>\n\n<p>Now, let's try to apply this to some <code>atom</code>:</p>\n\n<pre><code>*Main&gt; :t view (point . x) (Atom \"C\" (Point 1 2))\nview (point . x) (Atom \"C\" (Point 1 2)) :: Double\n</code></pre>\n\n<p>How does this type-check given the above type for <code>view (point . x)</code>? I know there is an instance of <code>MonadReader</code> for the partially applied function type <code>r -&gt;</code>, but how is ghc able to figure out that this particular instance shall be used in this case (if that's the one that's indeed used, of course)?</p>\n"}, {"tags": ["haskell", "idris"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1525890813, "post_id": 50259562, "comment_id": 87537807, "body": "I&#39;m not an Idris expert, but it should be the eta-expanded version of <code>(-&gt;) Integer</code>. Here, <code>(-&gt;)</code> is partially applied, but in <code>\\uv =&gt; (-&gt;) Integer uv</code> it is fully applied. Both are eta-convertible."}, {"owner": {"reputation": 27525, "user_id": 924313, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/14d86d9d0a97d8464d59eb42935838ae?s=128&d=identicon&r=PG", "display_name": "corazza", "link": "https://stackoverflow.com/users/924313/corazza"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1525891203, "post_id": 50259562, "comment_id": 87538008, "body": "@chi ah right that makes sense. thanks. I think it confused me because I don&#39;t interpret types as first-order intuitively yet"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525891224, "post_id": 50259562, "comment_id": 87538020, "body": "Is it due to Idris functions being total? I don&#39;t know Idris well enough to come up with a good example, but it seems like the composition of two total functions is not, itself, guaranteed to be total. (My first try was something like <code>(10.0 &#47;) . (10.0 - )</code>, although that function applied to 10 evaluates to <code>Infinity</code>.)"}, {"owner": {"reputation": 27525, "user_id": 924313, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/14d86d9d0a97d8464d59eb42935838ae?s=128&d=identicon&r=PG", "display_name": "corazza", "link": "https://stackoverflow.com/users/924313/corazza"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525891870, "post_id": 50259562, "comment_id": 87538377, "body": "@chepner I could be wrong but I don&#39;t think Idris is a total language. It&#39;s turing-complete, and for example isn&#39;t <code>10.0 &#47;</code> not total itself?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525892619, "post_id": 50259562, "comment_id": 87538744, "body": "Well, <code>(10.0 &#47;)</code> <i>is</i> total, since it maps <code>10.0</code> to <code>Infinity</code>. <code>(.)</code> is marked as total, but my glancing familiarity with Idris makes it difficult for me to come up with a good example of a partial function."}, {"owner": {"reputation": 27525, "user_id": 924313, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/14d86d9d0a97d8464d59eb42935838ae?s=128&d=identicon&r=PG", "display_name": "corazza", "link": "https://stackoverflow.com/users/924313/corazza"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525892744, "post_id": 50259562, "comment_id": 87538790, "body": "@chepner oh! I tried it with <code>log (-1)</code> but that turns out to be NaN. cheating!:p"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525893050, "post_id": 50259562, "comment_id": 87538929, "body": "I thought maybe I could do something with <code>Prelude.Nat.(-)</code>, but it uses dependent typing to make that total as well."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525893149, "post_id": 50259562, "comment_id": 87538982, "body": "Oh, it looks likes it&#39;s just a matter of syntax, not semantics: <a href=\"https://groups.google.com/forum/#!topic/idris-lang/f7iSKzKBF1A\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/idris-lang/f7iSKzKBF1A</a>. TL;DR <code>(-&gt;)</code> isn&#39;t a type constructor."}, {"owner": {"reputation": 14306, "user_id": 2747511, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h6jTZ.jpg?s=128&g=1", "display_name": "Anton Trunov", "link": "https://stackoverflow.com/users/2747511/anton-trunov"}, "edited": false, "score": 0, "creation_date": 1525894301, "post_id": 50259562, "comment_id": 87539571, "body": "<a href=\"https://stackoverflow.com/q/32043985/2747511\">This</a> is related."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1525924271, "post_id": 50259562, "comment_id": 87548375, "body": "@chepner The composition of two total functions is total, if it is well-typed at all."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525949031, "post_id": 50259562, "comment_id": 87559286, "body": "FWIW, I sometimes think we would be better off in Haskell without <code>Functor (-&gt;)</code> too. Shorthands involving this instance are often confusing and would be better expressed with <code>Arrow</code> combinators, whereas for serious larger-scale uses of the <code>Monad</code> instance it&#39;s better to use the more explicit <code>Reader</code> type."}], "answers": [{"comments": [{"owner": {"reputation": 311, "user_id": 4878871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Iz6Ij.jpg?s=128&g=1", "display_name": "Jeroen Noels", "link": "https://stackoverflow.com/users/4878871/jeroen-noels"}, "edited": false, "score": 0, "creation_date": 1525951206, "post_id": 50270839, "comment_id": 87560445, "body": "There is also infix syntax <code>(~&gt;)</code> for <code>Morphism</code>, so you can write <code>Integer ~&gt; Integer</code>"}], "tags": [], "owner": {"reputation": 311, "user_id": 4878871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Iz6Ij.jpg?s=128&g=1", "display_name": "Jeroen Noels", "link": "https://stackoverflow.com/users/4878871/jeroen-noels"}, "is_accepted": true, "score": 4, "last_activity_date": 1525950264, "last_edit_date": 1525950264, "creation_date": 1525948243, "answer_id": 50270839, "question_id": 50259562, "link": "https://stackoverflow.com/questions/50259562/why-doesnt-3-map-100-work-in-idris/50270839#50270839", "title": "Why doesn&#39;t (*3) `map` (+100) work in Idris?", "body": "<p>Functor is an interface.  In Idris, implementations are restricted to data or type constructors, i.e. defined using the <code>data</code> keyword.  I am not an expert in dependent types, but I believe this restriction is required&mdash;practically, at least&mdash;for a sound interface system.</p>\n\n<p>When you ask for the type of  <code>\\a =&gt; Integer -&gt; a</code> at the REPL, you get</p>\n\n<pre><code>\\a =&gt; Integer -&gt; a : Type -&gt; Type\n</code></pre>\n\n<p>In Haskell we would consider this to be a real type constructor, one that can be made into an instance of type classes such as <code>Functor</code>.  In Idris however, <code>(-&gt;)</code> is not a type constructor but a <a href=\"https://stackoverflow.com/a/27271810/4878871\">binder</a>.</p>\n\n<p>The closest thing to your example in Idris would be</p>\n\n<pre><code>((*3) `map` Mor (+100)) `applyMor` 1\n</code></pre>\n\n<p>using the <a href=\"https://github.com/idris-lang/Idris-dev/blob/master/libs/base/Data/Morphisms.idr\" rel=\"nofollow noreferrer\">Data.morphisms</a> module.  Or step by step:</p>\n\n<pre><code>import Data.Morphisms\n\nf : Morphism Integer Integer\nf = Mor (+100)\n\ng : Morphism Integer Integer\ng = (*3) `map` f\n\nresult : Integer\nresult = g `applyMor` 1\n</code></pre>\n\n<p>This works because <code>Morphism</code> is a real type constructor, with a <code>Functor</code> implementation defined in the library.</p>\n"}], "owner": {"reputation": 27525, "user_id": 924313, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/14d86d9d0a97d8464d59eb42935838ae?s=128&d=identicon&r=PG", "display_name": "corazza", "link": "https://stackoverflow.com/users/924313/corazza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 50270839, "answer_count": 1, "score": 11, "last_activity_date": 1525950264, "creation_date": 1525889140, "last_edit_date": 1525892810, "question_id": 50259562, "link": "https://stackoverflow.com/questions/50259562/why-doesnt-3-map-100-work-in-idris", "title": "Why doesn&#39;t (*3) `map` (+100) work in Idris?", "body": "<p>In Haskell, functions are functors and the following code works as expected:</p>\n\n<pre><code>(*3) `fmap` (+100) $ 1\n</code></pre>\n\n<p>The output is 303 of course. However, in Idris (with fmap -> map), it gives the following error:</p>\n\n<blockquote>\n  <p>Can't find implementation for <code>Functor (\\uv =&gt; Integer -&gt; uv)</code></p>\n</blockquote>\n\n<p>To me this seems like functions aren't implemented as functors in Idris, at least not like they are in Haskell, but why is that?</p>\n\n<p>Furthermore, what exactly does the type signature <code>(\\uv =&gt; Integer -&gt; uv)</code> mean? It <em>looks</em> like some partially applied function, and that's  what would be expected from a functor implementation, but the syntax is a bit confusing, specifically what <code>\\</code> which is supposed to be used for a lambda/literal is doing there.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1525886204, "post_id": 50258172, "comment_id": 87535481, "body": "You can replace the multiple <code>lets</code> by using eg. <code>createObject (x:y:z:_) = object (x,y,z)</code> (and you&#39;ll probably want to add a case for when the list is less than 3 elements long)."}], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": false, "score": 8, "last_activity_date": 1525886814, "last_edit_date": 1525886814, "creation_date": 1525883797, "answer_id": 50258204, "question_id": 50258172, "link": "https://stackoverflow.com/questions/50258172/parse-error-haskell/50258204#50258204", "title": "Parse Error: Haskell", "body": "<p><code>let-in</code> expressions in Haskell use only one <code>let</code>: </p>\n\n<pre><code>createObject :: [a] -&gt; object a \ncreateObject lst =\n  let x = lst !! 0\n      y = lst !! 1\n      z = lst !! 2\n  in object(x,y,z)\n</code></pre>\n\n<p>In a <code>do</code> block, you do use multiple <code>let</code> bindings, but we don't use an <code>in</code> expression: </p>\n\n<pre><code>trivialExample :: [a] -&gt; IO (Object a)\ntrivialExample lst = do \n  let x = lst !! 0 \n  let y = lst !! 1 \n  let z = lst !! 2\n  return $ object (x,y,z)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1525891319, "creation_date": 1525891319, "answer_id": 50260105, "question_id": 50258172, "link": "https://stackoverflow.com/questions/50258172/parse-error-haskell/50260105#50260105", "title": "Parse Error: Haskell", "body": "<p>Each <code>let</code> must have its own <code>in</code> (except in <code>do</code> notation and list comprehensions).</p>\n\n<p>You could therefore use</p>\n\n<pre><code>createObject lst =\n      let x = lst !! 0\n      in let y = lst !! 1\n      in let z = lst !! 2\n      in object(x,y,z)\n</code></pre>\n\n<p>but this is not idiomatic, since a single <code>let</code> can involve a block of definitions. Indeed, @jkeuhlen showed above the idiomatic use of <code>let</code>.</p>\n\n<p>You should however avoid using <code>!!</code>, which is slow and partial, and prefer pattern matching whenever possible.</p>\n\n<pre><code>createObject :: [a] -&gt; object a \ncreateObject [x,y,z] = object (x,y,z)\ncreateObject _       = error \"createObject: input list must have length 3\"\n</code></pre>\n\n<p>or</p>\n\n<pre><code>createObject :: [a] -&gt; object a \ncreateObject (x:y:z:_) = object (x,y,z)\ncreateObject _         = error \"createObject: input list must have length &gt;= 3\"\n</code></pre>\n\n<p>Note that the above is still a code smell: the input type <code>[a]</code> looks wrong, since it seems to allow any list length, when it actually works only on length 3 (or larger, in the second case, ignoring the other elements).</p>\n\n<p>It is hard to guess what you actually need, here.</p>\n"}], "owner": {"reputation": 11, "user_id": 9766133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2fb7afec8e5430fba7e306778b25af7?s=128&d=identicon&r=PG&f=1", "display_name": "Boyd Crowder", "link": "https://stackoverflow.com/users/9766133/boyd-crowder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1525891319, "creation_date": 1525883697, "last_edit_date": 1525884454, "question_id": 50258172, "link": "https://stackoverflow.com/questions/50258172/parse-error-haskell", "title": "Parse Error: Haskell", "body": "<p>I am getting a parse error on the below and I'm not sure why.  Thanks for any help! </p>\n\n<pre><code>   createObject :: [a] -&gt; object a \n   createObject lst =\n      let x = lst !! 0\n      let y = lst !! 1\n      let z = lst !! 2\n      in object(x,y,z)\n\n   test.hs:28:5: error: parse error on input `let'\n   |\n   28 |     let y = lst !! 1\n</code></pre>\n"}, {"tags": ["xml", "haskell", "hxt", "hdbc"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1525885926, "post_id": 50257952, "comment_id": 87535334, "body": "Currently your question is too broad. Can you break it down to an individual problem you&#39;re having? There are several Haskell libraries for reading XML files. Have you created your own data types <code>Group</code> and <code>Member</code>? What do they look like? Break down your problem into smaller pieces: 1) how do I read files? 2) How do I turn the XML into some record? 3) How do I save a record to my database?"}, {"owner": {"reputation": 353, "user_id": 5973391, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5dgQW7u2I38/AAAAAAAAAAI/AAAAAAAAAPo/X_WgLkhH0I4/photo.jpg?sz=128", "display_name": "harshainfo", "link": "https://stackoverflow.com/users/5973391/harshainfo"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1525887423, "post_id": 50257952, "comment_id": 87536084, "body": "Thanks for your comment and breaking my problem into smaller pieces. But I do not want to post them as three separate questions because I am unable to combine different solutions. However I have datatypes as :        data Group = Group {GroupNo, GroupName :: String} and data Member = Member {MemberNo, MemberName :: String}"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1526121710, "post_id": 50257952, "comment_id": 87626899, "body": "Hey @harshainfo, it would be easier to help you if we had the actual XML file, not an image of it. Could you post that?"}, {"owner": {"reputation": 353, "user_id": 5973391, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5dgQW7u2I38/AAAAAAAAAAI/AAAAAAAAAPo/X_WgLkhH0I4/photo.jpg?sz=128", "display_name": "harshainfo", "link": "https://stackoverflow.com/users/5973391/harshainfo"}, "edited": false, "score": 0, "creation_date": 1528135572, "post_id": 50257952, "comment_id": 88382424, "body": "XML file added as a code block for easy copying."}], "owner": {"reputation": 353, "user_id": 5973391, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5dgQW7u2I38/AAAAAAAAAAI/AAAAAAAAAPo/X_WgLkhH0I4/photo.jpg?sz=128", "display_name": "harshainfo", "link": "https://stackoverflow.com/users/5973391/harshainfo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1528135842, "creation_date": 1525882915, "last_edit_date": 1528135842, "question_id": 50257952, "link": "https://stackoverflow.com/questions/50257952/how-to-read-xml-as-objects-and-write-to-mysql-using-haskell", "title": "How to Read XML as Objects and Write to MySQL using Haskell", "body": "<p>I have several XML files of the following format in path location:</p>\n\n<p><a href=\"https://i.stack.imgur.com/KVPWH.jpg\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n\n<pre><code>&lt;Group&gt;\n  &lt;Group_No&gt;1&lt;/Group_No&gt;\n  &lt;Group_Name&gt;One&lt;/Group_Name&gt;\n  &lt;Member_List&gt;\n    &lt;Member&gt;\n      &lt;Member_No&gt;1&lt;/Member_No&gt;\n      &lt;Member_Name&gt;Mike&lt;/Member_Name&gt;\n    &lt;/Member&gt;\n    &lt;Member&gt;\n      &lt;Member_No&gt;2&lt;/Member_No&gt;\n      &lt;Member_Name&gt;Jacob&lt;/Member_Name&gt;\n    &lt;/Member&gt;\n  &lt;/Member_List&gt;\n&lt;/Group&gt;\n</code></pre>\n\n<p>I want to read all those XML files and create Group and Member data objects and save them to a MySQL DB using Haskell(I know I need to use HXT and HDBC libraries but I am confused as to how I could use them). Though there are examples for reading XML, they do not show how to traverse through the objects to save to DB.</p>\n\n<p>DB structure:</p>\n\n<pre><code>DB name : L group_member_db\n\nGroup table:\n\nGroup ID:PK , Int, AutoIncrement\n\nGroup No: String\n\nGroup Name:String\n\nMember Table:\n\nMember ID:PK, Int, AutoIncrement\n\nMember No:String\n\nMember Name:String\n</code></pre>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "arrows", "opaleye"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1525875928, "post_id": 50255304, "comment_id": 87529154, "body": "I&#39;m not sure I agree with the idea that that &quot;restriction&quot; is what makes arrows worthwhile. It&#39;s pretty trivial to get around using arrow apply, and there&#39;s even nice syntactic sugar to do that: <code>z &lt;- action2 x -&lt;&lt; y</code>"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1525875993, "post_id": 50255304, "comment_id": 87529191, "body": "Also, this might be helpful reading if you haven&#39;t seen it yet: <a href=\"https://stackoverflow.com/questions/3652054/monads-vs-arrows?rq=1\" title=\"monads vs arrows\">stackoverflow.com/questions/3652054/monads-vs-arrows?rq=1</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1525876647, "post_id": 50255304, "comment_id": 87529732, "body": "I think it&#39;s fundamentally missing the point to always compare arrows to monads. Arrows are foremostly a generalisation of functions/morphisms, whereas monads layer upon objects. Of course, both concepts are strongly linked in a cartesian closed category, but it&#39;s still a quite different conceptual approach."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525882830, "post_id": 50255304, "comment_id": 87533709, "body": "@leftaroundabout That&#39;s fair. I think because they can both capture effectful actions, there is general confusion on when each is more appropriate of a solution so they get compared to each other a lot."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 3, "last_activity_date": 1525879873, "creation_date": 1525879873, "answer_id": 50257067, "question_id": 50255304, "link": "https://stackoverflow.com/questions/50255304/why-are-database-queries-a-good-place-to-use-arrows/50257067#50257067", "title": "Why are database queries a good place to use Arrows?", "body": "<p>Paramaterized database queries look like arrows:</p>\n\n<ul>\n<li>each has an input and an output</li>\n<li>they compose</li>\n<li>we want to treat them differently than Haskell functions</li>\n</ul>\n\n<p>Composition <code>(.)</code> (or <code>(&lt;&lt;&lt;)</code>) looks like an SQL subquery.  <code>(&amp;&amp;&amp;)</code> looks like an SQL join.</p>\n\n<p>I believe that the \"statically known\" restriction relates to things you might reasonably be able to translate into SQL.  Once you allow <code>fmap</code> / <code>lmap</code> / <code>rmap</code> with arbitrary Haskell functions, that isn't feasible (at least without SQL language extensions and GHC compiler plugins).  I haven't worked out the details, though.</p>\n\n<p>I don't know how many of the translations we might manage by hand Opaleye implements.</p>\n"}, {"tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": false, "score": 0, "last_activity_date": 1526142561, "creation_date": 1526142561, "answer_id": 50308416, "question_id": 50255304, "link": "https://stackoverflow.com/questions/50255304/why-are-database-queries-a-good-place-to-use-arrows/50308416#50308416", "title": "Why are database queries a good place to use Arrows?", "body": "<p>There is a difficulty around variable scope when combining aggregation and monadic bind in query languages.  I've never come up with a particularly satisfying explanation but you can see <a href=\"https://www.reddit.com/r/haskell/comments/2nxx7n/announcing_opaleye_sqlgenerating_embedded_domain/cmhyr17/\" rel=\"nofollow noreferrer\">a historical Reddit post of mine</a> and a <a href=\"https://github.com/khibino/haskell-relational-record/issues/19\" rel=\"nofollow noreferrer\">(fixed) issue with relational-record</a> for some details.</p>\n"}], "owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1526142561, "creation_date": 1525874363, "question_id": 50255304, "link": "https://stackoverflow.com/questions/50255304/why-are-database-queries-a-good-place-to-use-arrows", "title": "Why are database queries a good place to use Arrows?", "body": "<p>I was reading <a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-21-arrows.html\" rel=\"noreferrer\">this</a>, which said:</p>\n\n<blockquote>\n  <p>Well, the point is that arrow notation forbids some computations that do notation allows. In particular all \u201carrow actions\u201d must be \u201cstatically\u201d known\u201c.</p>\n</blockquote>\n\n<p>and it explains:</p>\n\n<blockquote>\n  <p>Statically known\" means that if we have a couple of rows of arrow notation</p>\n  \n  <p><code>&gt; --    y &lt;- action1 -&lt; x</code></p>\n  \n  <p><code>&gt; --    z &lt;- action2 -&lt; y</code></p>\n  \n  <p>then the expression action2 cannot depend on x or indeed anything bound on the left hand side of an arrow notation row.</p>\n</blockquote>\n\n<p>As far as I understand, this restriction is what makes arrows worthwhile.</p>\n\n<p>Now, I was trying to learn Opaleye and I noticed that it uses arrows to combine things together. </p>\n\n<p>Why is Opaleye using arrows? Why are arrows a well suited thing for this job? What is it about databases/queries that make this restriction useful?</p>\n"}, {"tags": ["haskell", "types", "compiler-errors", "primes", "typeclass"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525872838, "post_id": 50254694, "comment_id": 87526889, "body": "You basically want to write with this list comprehension an <code>all</code> I think."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1525873016, "post_id": 50254694, "comment_id": 87527017, "body": "I&#39;d add an explicit type annotation like <code>prime :: Integer -&gt; Bool</code>. It does not make sense for floats anyway, and the inability to determine whether to use floats is what appears to stop the automatic type inference."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1525874003, "post_id": 50254694, "comment_id": 87527800, "body": "Numeric types in Haskell are very rigid: no implicit conversion/promotion ever happens (but numeric literals are of the right type). <code>**</code> requires a floating type (e.g. <code>Double</code>) while <code>mod</code> requires an integral one (e.g. <code>Integer</code>). You need to perform the conversions as needed."}, {"owner": {"reputation": 109, "user_id": 9575977, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "L5RK", "link": "https://stackoverflow.com/users/9575977/l5rk"}, "edited": false, "score": 0, "creation_date": 1525874073, "post_id": 50254694, "comment_id": 87527876, "body": "I&#39;ve actually tried that, to no avail. I get this error:                   &lt;interactive&gt;:3:1: error:     * No instance for (RealFrac Integer) arising from a use of <code>prime&#39;     * In the expression: prime :: Integer -&gt; Bool       In an equation for </code>it&#39;: it = prime :: Integer -&gt; Bool"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525875233, "post_id": 50254694, "comment_id": 87528682, "body": "Define the function piecewise instead of trying to fit everything into nested <code>if</code> expressions. <code>prime 1 = False; prime 2 = True; prime p = ...</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1525875346, "post_id": 50254694, "comment_id": 87528745, "body": "At the very least, boolean operators are your friend (just as in Python): <code>prime p = (p != 1) &amp;&amp; ((p==2) || (...))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1525874060, "creation_date": 1525874060, "answer_id": 50255181, "question_id": 50254694, "link": "https://stackoverflow.com/questions/50254694/haskell-type-errors/50255181#50255181", "title": "Haskell Type errors", "body": "<p><strong>In short</strong>: by using <code>mod</code>, <code>floor</code>, and <code>(**)</code> all at the same time, you restrict the type of <code>p</code> a lot, and Haskell fails to find a numerical type to call <code>prime</code>.</p>\n\n<p>The main problem here is in the iterable of your list comprehension:</p>\n\n<pre><code>[2..(floor(p**0.5))]\n</code></pre>\n\n<p>Here you call <code>p ** 0.5</code>, but since <code>(**)</code> has type <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-42--42-\" rel=\"nofollow noreferrer\"><strong><code>(**) :: Floating a =&gt; a -&gt; a -&gt; a</code></strong></a>, that thus means that <code>p</code> has to be an instance of a type that is an instance of the <code>Floating</code> typeclass, for example a <code>Float</code>. I guess you do not want that.</p>\n\n<p>Your <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:floor\" rel=\"nofollow noreferrer\"><strong><code>floor :: (RealFrac a, Integral b) =&gt; a -&gt; b</code></strong></a> even makes it worse, since now <code>p</code> also has to be of a type that is an instance of the <code>RealFrac</code> typeclass.</p>\n\n<p>On the other hand, you use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:mod\" rel=\"nofollow noreferrer\"><strong><code>mod :: Integral a =&gt; a -&gt; a -&gt; a</code></strong></a>, so it means that your <code>p</code> has to be <code>Floating</code>, as well as <code>Integral</code>, which are rather two disjunctive sets: although strictly speaking, we can define such a type, it is rather weird for a number to be both <code>Integral</code> and <code>Floating</code> at the same type. <code>Float</code> is for instance a <code>Floating</code> number, but not <code>Integral</code>, and <code>Int</code> is <code>Integral</code>, but not a <code>Floating</code> type.</p>\n\n<p>We have to find a way to relax the constraints put on <code>p</code>. Since usually non-<code>Integral</code> numbers are no primes at all, we better thus aim to throw out <code>floor</code> and <code>(**)</code>. The optimization to iterate up to the square root of <code>p</code> is however a good idea, but we will need to find other means to enforce that.</p>\n\n<p>One way to do this is by using a <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:takeWhile\" rel=\"nofollow noreferrer\"><strong><code>takeWhile :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code></strong></a> where we take elements, until the square of the numbers is greater than <code>p</code>, so we can rewrite the <code>[2..(floor(p**0.5))]</code> to:</p>\n\n<pre><code>takeWhile (\\x -&gt; x * x &lt;= p) [2..]\n</code></pre>\n\n<p>We even can work only with odd elements and <code>2</code>, by writing it as:</p>\n\n<pre><code>takeWhile (\\x -&gt; x * x &lt;= p) (2:[3, 5..])\n</code></pre>\n\n<p>If we test this with a <code>p</code> that is for instance set to <code>99</code>, we get:</p>\n\n<pre><code>Prelude&gt; takeWhile (\\x -&gt; x * x &lt;= 99) (2:[3, 5..])\n[2,3,5,7,9]\n</code></pre>\n\n<p>If we plug that in, we relaxed the type:</p>\n\n<pre><code>prime p = if p == 1 then False else if p == 2 then True else if maximum ([if p `mod` x == 0 then x else -1 | x &lt;- takeWhile (\\x -&gt; x * x &lt;= p) (2:[3, 5..])]) &gt; 0 then False else True\n</code></pre>\n\n<p>we actually relaxed it enough:</p>\n\n<pre><code>Prelude&gt; :t prime\nprime :: Integral a =&gt; a -&gt; Bool\n</code></pre>\n\n<p>and we get:</p>\n\n<pre><code>Prelude&gt; prime 23\nTrue\n</code></pre>\n\n<p>But the code is very <em>ugly</em> and rather <em>un-Haskell</em>. First of all, you here use <code>maximum</code> as a trick to check if <em>all</em> elements satisfy a predicate. But it makes no sense to do that this way: from the moment one of the elements is dividable, we know that the number is not prime. So we can better use the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:all\" rel=\"nofollow noreferrer\"><strong><code>all :: (a -&gt; Bool) -&gt; [a] -&gt; Bool</code></strong></a> function. Furthermore conditions are usually checked by using <em>pattern matching</em> and guards, so we can write it like:</p>\n\n<pre><code>prime :: Integral a =&gt; a -&gt; Bool\nprime n | n &lt; 2 = False\n        | otherwise = all ((/=) 0 . mod n) divisors\n    where divisors = takeWhile (\\x -&gt; x * x &lt;= n) (2:[3, 5..])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1525897270, "last_edit_date": 1525897270, "creation_date": 1525883884, "answer_id": 50258227, "question_id": 50254694, "link": "https://stackoverflow.com/questions/50254694/haskell-type-errors/50258227#50258227", "title": "Haskell Type errors", "body": "<p>Your code can be simplified as</p>\n\n<pre><code>prime p = if p == 1 then False else \n          if p == 2 then True else \n          if maximum ([if p `mod` x == 0 then x else -1 | x&lt;-[2..(floor(p**0.5))]]) &gt; 0 \n             then False else True\n=\nprime p = if p == 1 then False else \n          if p == 2 then True else \n          not (maximum [if p `mod` x == 0 then x else -1 | x&lt;-[2..floor(p**0.5)]] &gt; 0 )\n=\nprime p = not ( p == 1 ) &amp;&amp; \n          ( p == 2 ||\n            maximum [if p `mod` x == 0 then x else -1 | x&lt;-[2..floor(p**0.5)]] &lt;= 0 )\n=\nprime p = p /= 1   &amp;&amp; \n          ( p == 2 ||\n            maximum [if p `mod` x == 0 then x else -1 | x&lt;-[2..floor(p**0.5)]] == -1 )\n=~\nprime p = p == 2 || p &gt; 2 &amp;&amp; null [x | x &lt;- [2..floor(p**0.5)], p `mod` x == 0] \n</code></pre>\n\n<p>(convince yourself in the validity of each transformation).</p>\n\n<p>This still gives us a type error of course, because <code>(**) :: Floating a =&gt; a -&gt; a -&gt; a</code> and <code>mod :: Integral a =&gt; a -&gt; a -&gt; a</code> are conflicting. To counter that, just throw a <code>fromIntegral</code> in there:</p>\n\n<pre><code>isPrime :: Integral a =&gt; a -&gt; Bool\nisPrime p = p == 2 || \n            p &gt; 2 &amp;&amp; null [x | x &lt;- [2..floor(fromIntegral p**0.5)], p `mod` x == 0] \n</code></pre>\n\n<p>and it's working:</p>\n\n<pre><code>~&gt; filter isPrime [1..100]\n[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97]\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 9575977, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "L5RK", "link": "https://stackoverflow.com/users/9575977/l5rk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 1, "accepted_answer_id": 50258227, "answer_count": 2, "score": 2, "last_activity_date": 1525897270, "creation_date": 1525872682, "last_edit_date": 1525897264, "question_id": 50254694, "link": "https://stackoverflow.com/questions/50254694/haskell-type-errors", "title": "Haskell Type errors", "body": "<p>First day learning haskell, and coming from a python background I'm really having trouble debugging when it comes to type; Currently I'm working on a simple function to see if a number is a prime;</p>\n\n<pre><code>prime p = if p == 1 then False else if p == 2 then True else if maximum ([if p `mod` x == 0 then x else -1 | x&lt;-[2..(floor(p**0.5))]]) &gt; 0 then False else True\n</code></pre>\n\n<p>It works when I have a specific number instead of the generic P, but no matter what I try (and I've tried a lot, including just moving onto different problems) I always get some kind of error regarding type. For this current iteration, I'm getting the error </p>\n\n<pre><code>&lt;interactive&gt;:149:1: error:\n* Ambiguous type variable `a0' arising from a use of `prime'\n  prevents the constraint `(RealFrac a0)' from being solved.\n  Probable fix: use a type annotation to specify what `a0' should be.\n  These potential instances exist:\n    instance RealFrac Double -- Defined in `GHC.Float'\n    instance RealFrac Float -- Defined in `GHC.Float'\n    ...plus one instance involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n* In the expression: prime 2\n  In an equation for `it': it = prime 2\n\n&lt;interactive&gt;:149:7: error:\n* Ambiguous type variable `a0' arising from the literal `2'\n  prevents the constraint `(Num a0)' from being solved.\n  Probable fix: use a type annotation to specify what `a0' should be.\n  These potential instances exist:\n    instance Num Integer -- Defined in `GHC.Num'\n    instance Num Double -- Defined in `GHC.Float'\n    instance Num Float -- Defined in `GHC.Float'\n    ...plus two others\n    ...plus one instance involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n* In the first argument of `prime', namely `2'\n  In the expression: prime 2\n  In an equation for `it': it = prime 2\n</code></pre>\n\n<p>If someone could, as well as debugging this particular program, give me a heads up on how to think of haskell types, I'd be incredibly grateful. I've tried looking at learnyouahaskell but so far I've had no luck applying that.</p>\n"}, {"tags": ["haskell", "functor", "either"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525869699, "post_id": 50253569, "comment_id": 87524560, "body": "That&#39;s impossible unless you define it as <code>data Either b a = Left a | Right b</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1525870082, "post_id": 50253569, "comment_id": 87524873, "body": "Pay close attention to what they are doing; <code>Either</code> itself is not a functor, only the higher-kinded type resulting from the application of <code>Either</code> to an arbitrary type."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1525877523, "post_id": 50253569, "comment_id": 87530382, "body": "This is a direct consequence of other design choices made in Haskell.  See <a href=\"https://stackoverflow.com/a/44139690/383200\">stackoverflow.com/a/44139690/383200</a> for some further discussion of those design choices and why they lead to this result."}, {"owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525884474, "post_id": 50253569, "comment_id": 87534596, "body": "@chepner that is true, but can&#39;t we have some type level <code>flip</code> to do what @Willem Van Onsem said?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "edited": false, "score": 0, "creation_date": 1525885157, "post_id": 50253569, "comment_id": 87534944, "body": "@AgnishomChattopadhyay I had something similar in a different, deleted answer. It wasn&#39;t quite type-level, but defined a natural transformation <code>eswap :: Either a b -&gt; Either b a</code> that could bracket the application of <code>fmap f</code>. (<code>leftmap f = eswap . fmap f . eswap</code>). Are you thinking of something analogous to <code>newtype Compose f g a = Compose { getCompose :: f (g a) }</code>, like <code>newtype Flip f a b = Flip { getFlip :: f b a }</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1525876847, "last_edit_date": 1525876847, "creation_date": 1525869759, "answer_id": 50253725, "question_id": 50253569, "link": "https://stackoverflow.com/questions/50253569/how-to-make-either-into-a-functor-in-second-type/50253725#50253725", "title": "How to make Either into a functor in second type", "body": "<p>You can't; <code>Either a</code> can be a functor because the partial application of <code>Either</code> has kind <code>* -&gt; *</code>, but you can't do partial application from the right.</p>\n\n<p>Instead, you might be interested in the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\"><code>Bifunctor</code></a> instance of <code>Either</code>:</p>\n\n<pre><code>instance Bifunctor Either where\n    bimap f _ (Left a) = Left (f a)\n    bimap _ g (Right b) = Right (g b)\n</code></pre>\n\n<p><code>bimap</code> takes two functions, one for each of the two types wrapped by <code>Either</code>.</p>\n\n<pre><code>&gt; bimap (+1) length (Left 3)\nLeft 4\n&gt; bimap (+1) length (Right \"hi\")\nRight 2\n</code></pre>\n\n<p>There are also <code>first</code> and <code>second</code> functions that focus on one or the other type. <code>second</code> corresponds to the regular <code>fmap</code> for <code>Either</code>; <code>first</code> is the function you are looking for.</p>\n\n<pre><code>&gt; first (+1) (Left 3)\nLeft 4\n&gt; first (+1) (Right 3)\nRight 3\n&gt; second (+1) (Left 3)\nLeft 3\n&gt; second (+1) (Right 3)\nRight 4\n</code></pre>\n\n<hr>\n\n<p>(hat tip to @leftaroundabout)</p>\n\n<p>The <code>Control.Arrow</code> module provides the <code>left</code> function, which effectively is the same as <code>second</code>, but with a more descriptive name and a different derivation. Compare their types:</p>\n\n<pre><code>&gt; :t Data.Bifunctor.second\nData.Bifunctor.second :: Bifunctor p =&gt; (b -&gt; c) -&gt; p a b -&gt; p a c\n&gt; :t Control.Arrow.left\nControl.Arrow.left :: ArrowChoice a =&gt; a b c -&gt; a (Either b d) (Either c d)\n</code></pre>\n\n<p><code>second</code> is hard-coded to work with functions and can be restricted by <code>p ~ Either</code>. <code>left</code> is hard-coded to work with <code>Either</code> and can be restricted by <code>a ~ (-&gt;)</code>.</p>\n\n<hr>\n\n<p>Confusingly, <code>Control.Arrow</code> <em>also</em> provides a <code>second</code> function which is similar to the <code>Bifunctor</code> instance for tuples:</p>\n\n<pre><code>&gt; :t Control.Arrow.second\nControl.Arrow.second :: Arrow a =&gt; a b c -&gt; a (d, b) (d, c)\n\n&gt; Control.Arrow.second (+1) (1,2) == Data.Bifunctor.second (+1) (1,2)\nTrue\n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 2176528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/136af1bfd8b8c1582d2e56ac08bfcd94?s=128&d=identicon&r=PG", "display_name": "kishlaya", "link": "https://stackoverflow.com/users/2176528/kishlaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 1, "accepted_answer_id": 50253725, "answer_count": 1, "score": 5, "last_activity_date": 1525876847, "creation_date": 1525869268, "question_id": 50253569, "link": "https://stackoverflow.com/questions/50253569/how-to-make-either-into-a-functor-in-second-type", "title": "How to make Either into a functor in second type", "body": "<p>I have been reading \"Learn You A Haskell For Great Good!\" and right now I am on \"The Functor Typeclass\" section. </p>\n\n<p>Here they make Either into a functor by fixing the first type as follows:</p>\n\n<pre><code>instance Functor (Either a) where\n  fmap f (Right x) = Right (f x)\n  fmap f (Left x)  = Left x\n</code></pre>\n\n<p>So I wanted to ask, how could I make Either into a functor in the first type (by fixing the second type) instead, so that, I get the following definition for fmap</p>\n\n<pre><code>fmap f (Left x) = Left (f x)\nfmap f (Right x)  = Right x\n</code></pre>\n"}, {"tags": ["haskell", "evaluation", "fold"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1525852621, "post_id": 50246794, "comment_id": 87513818, "body": "I think that would be roughly equivalent to letting <code>foldl&#39; = foldl</code>, losing the strictness. On lists, for instance, you can&#39;t implement <code>foldl&#39;</code> using <code>foldl</code>, but you can when using <code>foldr</code> instead. It sounds counter-intuitive, at first."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1525877129, "post_id": 50246794, "comment_id": 87530116, "body": "@chi, you <i>can</i> implement the right semantics for <code>foldl&#39;</code> using <code>foldl</code> (the OP has done so); what you <i>can&#39;t</i> do is implement it <i>well</i>."}], "answers": [{"comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1525852950, "post_id": 50247695, "comment_id": 87514005, "body": "So in other words, cons-lists go well with <code>foldr</code> and <code>foldl&#39;</code>, and thus <code>foldl&#39;</code> has default definition using <code>foldr</code>? And binary trees won&#39;t really matter, right?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1525858677, "post_id": 50247695, "comment_id": 87517425, "body": "it&#39;s a bit unclear to what &quot;here&quot;, &quot;<code>f&#39;</code>&quot;, &quot;its results&quot; and &quot;the fold&quot; are referring. Maybe if you&#39;d included the actual code snippet it&#39;d clarify things."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1525850607, "creation_date": 1525850607, "answer_id": 50247695, "question_id": 50246794, "link": "https://stackoverflow.com/questions/50246794/default-definitions-of-foldl-and-foldr-seem-weird/50247695#50247695", "title": "Default definitions of foldl&#39; and foldr&#39; seem weird", "body": "<p>Generally speaking, <code>foldl'</code> is best for things that look kind of like cons-lists and <code>foldr'</code> is best for things that look kind of like snoc-lists. The situations are symmetrical, so let's just look at cons-lists, where <code>foldl'</code> had better be good.</p>\n\n<p>You've probably read that <code>foldl</code> for cons-lists can lead to space leaks if it's not optimized well enough. Well, that's exactly what will happen here. <code>f'</code> is strict, but none of its results are demanded until the fold has reached the end of the list!</p>\n\n<p>The default definitions give a little twist, which makes even naive compilation (or interpretation) work properly.</p>\n"}], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 50247695, "answer_count": 1, "score": 4, "last_activity_date": 1525850607, "creation_date": 1525847247, "question_id": 50246794, "link": "https://stackoverflow.com/questions/50246794/default-definitions-of-foldl-and-foldr-seem-weird", "title": "Default definitions of foldl&#39; and foldr&#39; seem weird", "body": "<p>Default definitions of <code>foldl'</code> and <code>foldr'</code> seem weird. They have default definition as:</p>\n\n<pre><code>class Foldable t where\n    -- ...\n    foldr' f z0 xs = foldl f' id xs z0\n      where f' k x z = k $! f x z\n    -- ...\n    foldl' f z0 xs = foldr f' id xs z0\n      where f' x k z = k $! f z x\n    -- ...\n</code></pre>\n\n<p>Why not?:</p>\n\n<pre><code>class Foldable t where\n    -- ...\n    foldr' f = foldr (\\x z -&gt; f x $! z)\n    -- ...\n    foldl' f = foldl (\\z x -&gt; flip f x $! z)\n    -- ...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1525841556, "post_id": 50245513, "comment_id": 87508867, "body": "It has to be an <code>Enum</code> because otherwise you can\u2019t have the operation <code>[0..n]</code>. As for the <code>Floating</code> \u2013 the operands of <code>**</code> have to both be the same type. Maybe you\u2019re looking for the <code>^</code> operator? Also, <code>powersOf x = map (x^) [0..]</code> and you can <code>take 5 (powersOf 0.5)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 0, "creation_date": 1525888146, "post_id": 50248031, "comment_id": 87536469, "body": "Thanks Willem. Two comments. 1) I get an error of error: parse error on input \u2018import\u2019 when I try your example.  2) The larger question.  I appreciate your example, but how would one get my original method working?  As I said, it works fine when you type it directly into WinGHCi but produces the error described with a &quot;:load&quot;.  I tried changing the signature to powersOfx :: (Enum a, Floating b) =&gt;  a -&gt; b -&gt; [b] and got the same error as when I used Integral."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 1, "creation_date": 1525891830, "post_id": 50248031, "comment_id": 87538358, "body": "(1) that is probably because you defined functions before the <code>import</code> statement. <code>import</code> statements should be grouped at the top (2) By changing the signature to the one above; but that would make the function just horrible, since then <code>n</code> is considered to be a <code>Floating</code>, and those typically can have rounding errors. You can start converting between <code>Integral</code>s with <code>fromIntegral</code>, but that again can result in rounding errors. The signature is <code>:: (Enum b, Floating b) =&gt; b -&gt; b -&gt; [b]</code> (note here there is only <code>b</code>, not <code>a</code>)."}, {"owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "edited": false, "score": 0, "creation_date": 1525901563, "post_id": 50248031, "comment_id": 87542824, "body": "Thank you very much Wilem!  It&#39;s becoming clearer. I reread your answer, and (hopefully correctly) inferred what your answer implies. 1) Yes, I put import ant beginning of file and all is well.  2) Once I put all &#39;b&#39; and not some combination of &#39;a&#39; and &#39;b&#39; in :: (Enum b, Floating b) =&gt; b -&gt; b -&gt; [b] all worked.  I was assumming that there had to be an &#39;a&#39; and a &#39;b&#39; because there are two arguments, n and x.  But the Enum b, Floating b is referring to the fact that both arguments need to be floating and enum. I see why both have to be floating (because I used **) but not why both need enum."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1525892037, "last_edit_date": 1525892037, "creation_date": 1525851701, "answer_id": 50248031, "question_id": 50245513, "link": "https://stackoverflow.com/questions/50245513/haskell-type-error-when-loading-function-but-not-inline/50248031#50248031", "title": "Haskell. Type error when loading function but not inline", "body": "<h1>The signature of the <code>map (\\y-&gt;(x**y)) [0..n]</code> function</h1>\n\n<p><strong>In short:</strong> your signature is <strong>too broad</strong>, one can design <code>Floating</code> types such that the function can not be called.</p>\n\n<p>Let us first analyze the types you use here:</p>\n\n<pre><code>Prelude&gt; let x = 0.5\nPrelude&gt; let n = 5\nPrelude&gt; :t map (\\y-&gt;(x**y)) [0..n]\nmap (\\y-&gt;(x**y)) [0..n] :: (Enum b, Floating b) =&gt; [b]\nPrelude&gt; :t \\n x -&gt; map (\\y-&gt;(x**y)) [0..n]\n\\n x -&gt; map (\\y-&gt;(x**y)) [0..n]\n  :: (Enum b, Floating b) =&gt; b -&gt; b -&gt; [b]\n</code></pre>\n\n<p>So what we see here is that the output type <code>b</code>, actually has to be an instance of two typeclasses: <code>Enum</code>, and <code>Floating</code>. That is logical: you use <code>[0..n]</code>, so that means that you ask Haskell to enumerate all elements between <code>0</code> and <code>n</code>, but a number is not per se enumerable (in fact we can already wonder that <code>Floating</code> is <code>Enum</code>erable in the first place: here we make hops of one, but we thus omit the <code>Floating</code> values in between, in case we would have a real float, then enumerating is even impossible).</p>\n\n<p>As a result the <code>y</code>s have the same type as <code>n</code>, and since we perform arithmetic with <code>x</code> and <code>y</code> (we write <code>x ** y</code>), this thus means that <code>x</code> and <code>y</code> need to have the same type since <code>(**)</code> has type <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-42--42-\" rel=\"nofollow noreferrer\"><strong><code>(**) :: Floating a =&gt; a -&gt; a -&gt; a</code></strong></a>. We can thus construct a function:</p>\n\n<pre><code>powersOfx :: (Enum b, Floating b) =&gt; b -&gt; b -&gt; [b]\npowersOfx n x = map (\\y-&gt;(x**y)) [0..n]\n</code></pre>\n\n<p>But this is a bad idea. <code>Floating</code> is usually something we better avoid as much as possible: if the number is large, we can have all sorts of rounding errors. We could use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:fromIntegral\" rel=\"nofollow noreferrer\"><strong><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code></strong></a>, but again this can result in rounding errors when we convert for example a large <code>Int</code> to a <code>Float</code>. In that case the type would be:</p>\n\n<pre><code>powersOfx :: (Enum b, Floating b, Integral a) =&gt; a -&gt; b -&gt; [b]\npowersOfx n x = map (\\y-&gt;(x**y)) [0..fromIntegral n]\n</code></pre>\n\n<h1>Making a more generic variant</h1>\n\n<p>Nevertheless we can make the function more flexible and generic, by using <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:iterate\" rel=\"nofollow noreferrer\"><strong><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]</code></strong></a> and by using the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:take\" rel=\"nofollow noreferrer\"><strong><code>take :: Int -&gt; [a] -&gt; [a]</code></strong></a> (or <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:genericTake\" rel=\"nofollow noreferrer\"><strong><code>genericTake :: Integral i =&gt; i -&gt; [a] -&gt; [a]</code></strong></a>):</p>\n\n<pre><code>import Data.List(genericTake)\n\npowersOfx :: (Integral i, Num n) =&gt; i -&gt; n -&gt; [n]\npowersOfx n x = genericTake (n+1) (iterate (x*) 1)\n</code></pre>\n\n<p>This then produces:</p>\n\n<pre><code>Prelude Data.List&gt; f 5 0.5\n[1.0,0.5,0.25,0.125,6.25e-2,3.125e-2]\n</code></pre>\n"}], "owner": {"reputation": 6505, "user_id": 286641, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4c26cc999586b87d902ed6ebf115ae5b?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/286641/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 50248031, "answer_count": 1, "score": 1, "last_activity_date": 1525892037, "creation_date": 1525840095, "last_edit_date": 1525841045, "question_id": 50245513, "link": "https://stackoverflow.com/questions/50245513/haskell-type-error-when-loading-function-but-not-inline", "title": "Haskell. Type error when loading function but not inline", "body": "<p>I'm a complete newbie to Haskell.  I type this into WinGHCi and it works fine:</p>\n\n<pre><code>&gt; let x = 0.5\n&gt; let n = 5\n&gt; map (\\y-&gt;(x**y)) [0..n]\n[1.0,0.5,0.25,0.125,6.25e-2,3.125e-2]  -- notice it is powers of 1/2 !\n</code></pre>\n\n<p>But when I define a simple function in a file:</p>\n\n<pre><code>powersOfx :: (Integral a, Floating b) =&gt;  a -&gt; b -&gt; [b]\npowersOfx n x = map (\\y-&gt;(x**y)) [0..n]\n</code></pre>\n\n<p>and type\n<code>:l myFile</code>, I get:</p>\n\n<pre><code> Couldn't match expected type \u2018b\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          powersOfx :: forall a b. (Integral a, Floating b) =&gt; a -&gt; b -&gt; [b]\n</code></pre>\n\n<p>What's going on? Am I doing the signature incorrectly?  I'm guessing I might be, because when I just comment it out and :l myFile it works but </p>\n\n<pre><code>:t powersOfx \n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>powersOfx :: (Floating b, Enum b) =&gt; b -&gt; b -&gt; [b]\n</code></pre>\n\n<p>Notice the 'Enum' instead of 'Integral'.</p>\n\n<p>I suppose I could just get rid of the type signature but I'm under the impression it's good practice to put a signature AND I'm trying to solve a larger problem where I'm getting error reported here:\n<a href=\"https://stackoverflow.com/questions/38531803/ambiguous-type-variable-a0-arising-from-a-use-of-it\">Ambiguous type variable `a0&#39; arising from a use of `it&#39;</a></p>\n\n<p>If I get this part working, I'll post a separate question about that!</p>\n\n<p>Please let me know if I'd be better off posting to another group or if I should be posting more information.</p>\n\n<p>-Dave</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1525830486, "post_id": 50244122, "comment_id": 87506413, "body": "<code>Data.Data</code> is quite outdated anyway. GHC Generics are the current type-safe, performant and modular solution for generic programming."}, {"owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1525839384, "post_id": 50244122, "comment_id": 87508305, "body": "I usually prefer <code>GHC.Generics</code> too. It does get verbose though. I find it surprising how simple (or at least concise) <code>Data.Data</code> solutions can be. I wonder if <code>Data.Data</code> could be made faster with a lot of rewrite rules."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1525830872, "creation_date": 1525830872, "answer_id": 50244446, "question_id": 50244122, "link": "https://stackoverflow.com/questions/50244122/in-data-data-why-does-gmapm-take-a-monad-rather-than-an-applicative/50244446#50244446", "title": "In Data.Data, why does gmapM take a Monad rather than an applicative?", "body": "<p>It looks like a historical detail from before implementing the Monad-Applicative proposal.</p>\n\n<p>I can define both the <code>gmapM</code> default and the instance for lists in terms of <code>Applicative</code>.</p>\n\n<pre><code>gmapM :: forall m a. (Data a, Applicative m) =&gt; (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a\ngmapM f = gfoldl k pure\n  where\n    k :: Data d =&gt; m (d -&gt; b) -&gt; d -&gt; m b\n    k c x = c &lt;*&gt; f x\n\n-- instance Data a =&gt; Data [a] where ...\ngmapMlist :: forall m a. (Data a, Applicative m) =&gt; (forall d. Data d =&gt; d -&gt; m d) -&gt; [a] -&gt; m [a]\ngmapMlist _   []     = pure []\ngmapMlist f   (x:xs) = (:) &lt;$&gt; f x &lt;*&gt; f xs\n</code></pre>\n"}], "owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 50244446, "answer_count": 1, "score": 2, "last_activity_date": 1525830872, "creation_date": 1525827896, "question_id": 50244122, "link": "https://stackoverflow.com/questions/50244122/in-data-data-why-does-gmapm-take-a-monad-rather-than-an-applicative", "title": "In Data.Data, why does gmapM take a Monad rather than an applicative?", "body": "<p><code>gmapM</code> seems like the obvious candidate for writing a generic traversal based on <code>Data.Data</code>, for instance, if one wants to implement <code>MonoTraversable</code>. The only hiccup is that it takes a <code>Monad</code> rather than an <code>Applicative</code>. Why is that? Also, is there a similar function to <code>fmapM</code> with weaker assumptions?</p>\n"}, {"tags": ["docker", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1525884912, "post_id": 50248817, "comment_id": 87534831, "body": "Thanks Michael. I was actually following that post to do multistage build, but it doesn&#39;t say about postgres. I wonder what dependencies needs to install on <code>fpco&#47;pid1</code> to use <code>postgres-simple</code>"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1525854603, "creation_date": 1525854603, "answer_id": 50248817, "question_id": 50244023, "link": "https://stackoverflow.com/questions/50244023/what-is-the-best-practice-for-building-docker-images-for-a-haskel-web-app/50248817#50248817", "title": "What is the best practice for building docker images for a Haskel web app", "body": "<p>Stack has built in support for both building with Docker, and for creating Docker images. The former can be turned on with the <code>--docker</code> command line flag (or modifications to <code>stack.yaml</code>), and the latter can be performed with the <code>stack image container</code> command. I use this for a number of websites.</p>\n\n<p>Alternatively, you can also use multistage Docker files for this. One of my coworkers, Deni Bertovic, <a href=\"https://www.fpcomplete.com/blog/2017/12/building-haskell-apps-with-docker\" rel=\"nofollow noreferrer\">wrote a blog post</a> on the subject.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 50248817, "answer_count": 1, "score": 0, "last_activity_date": 1525854603, "creation_date": 1525826968, "question_id": 50244023, "link": "https://stackoverflow.com/questions/50244023/what-is-the-best-practice-for-building-docker-images-for-a-haskel-web-app", "title": "What is the best practice for building docker images for a Haskel web app", "body": "<p>I have a haskell web app that uses postgresql-simple, which require <code>libpq</code>.</p>\n\n<p>I use stack for building the project on Mac</p>\n\n<p>What is the best practice for building a Docker image for running a haskell web app? Such that:</p>\n\n<ol>\n<li>I can use multi-staging build to include only the executable and the necessary dependencies in the final image</li>\n<li>If I make changes to the code, rebuilding the image would not have to compile the packages again.</li>\n</ol>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1525831197, "post_id": 50243956, "comment_id": 87506554, "body": "Check out <a href=\"http://hackage.haskell.org/package/control-monad-omega-0.3.1/docs/Control-Monad-Omega.html\" rel=\"nofollow noreferrer\"><code>Control.Monad.Omega</code></a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1525831354, "post_id": 50243956, "comment_id": 87506587, "body": "(I know the first few answers at the linked dupe don&#39;t meet your &quot;multiple infinite lists&quot; criteria. Just keep reading. I promise there&#39;s an answer that does.)"}], "owner": {"reputation": 23, "user_id": 9761734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac0d766c5f6cdd97c3166cdd73a9aed?s=128&d=identicon&r=PG&f=1", "display_name": "mellow", "link": "https://stackoverflow.com/users/9761734/mellow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 1, "closed_date": 1525831289, "answer_count": 0, "score": 2, "last_activity_date": 1525829460, "creation_date": 1525826350, "last_edit_date": 1525829460, "question_id": 50243956, "link": "https://stackoverflow.com/questions/50243956/haskell-how-to-update-each-infinite-variable-once-in-list-comprehension-using-i", "closed_reason": "Duplicate", "title": "Haskell: How to update each infinite variable once in list comprehension using infinite lists", "body": "<p>If I've got something that looks like this:</p>\n\n<pre><code>list1 = [(a,b,c) | a &lt;- [0..], b &lt;- [0..], c &lt;- [0..]]\n</code></pre>\n\n<p>How would I go about updating each of the variables once instead of c infinitely growing?</p>\n\n<p>Like this:</p>\n\n<pre><code>[(0,0,0), (0,0,1), (0,1,1), (1,1,1), ...]\n</code></pre>\n\n<p>Instead of this:</p>\n\n<pre><code>[(0,0,0), (0,0,1), (0,0,2), (0,0,3), ...]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 5, "creation_date": 1525808643, "post_id": 50241018, "comment_id": 87499878, "body": "Wouldn&#39;t it be easier to just use the type GHC infers for the definition?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 2, "creation_date": 1525812705, "post_id": 50241018, "comment_id": 87501761, "body": "Would you need the liftIO at all? Since all the actions you&#39;re using are already generalized to MonadIO I expect you could leave it out entirely."}, {"owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "edited": false, "score": 0, "creation_date": 1525812874, "post_id": 50241018, "comment_id": 87501830, "body": "As a matter of fact, yes."}], "tags": [], "owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "is_accepted": true, "score": 5, "last_activity_date": 1525812912, "last_edit_date": 1525812912, "creation_date": 1525807770, "answer_id": 50241018, "question_id": 50240956, "link": "https://stackoverflow.com/questions/50240956/how-do-i-remove-code-duplication-in-two-identical-haskell-functions-with-differe/50241018#50241018", "title": "How do I remove code duplication in two identical Haskell functions with different output type?", "body": "<p>Easiest way would be to use the fact that <code>Render</code> is a <code>MonadIO</code>, meaning you could simply make one <code>IO</code> typed definition, and <code>liftIO</code> the call when inside the <code>Render</code> Monad.<br><br>\nEdit:\nAs per Carl's suggestion, and since <code>widgetGetAllocatedWidth</code>/<code>widgetGetAllocatedHeight</code> are constrained on the <code>MonadIO</code> requisite, you could also make a </p>\n\n<pre><code>getWidgetSize :: MonadIO m =&gt; Gtk.DrawingArea -&gt; m (Int, Int)\ngetWidgetSize widget = do\n  width'  &lt;- liftIO $ fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedWidth widget\n  height' &lt;- liftIO $ fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedHeight widget\n  return (width', height')\n</code></pre>\n\n<p>which would then work in both scenario. This is mostly equivalent, however it allows it to be called the same way from any <code>MonadIO</code> context.</p>\n\n<p>Edit2: (Because more edits is always better right guys)<br>\nEdit3: Because sometimes you look at something from too close, and you miss it.<br>\nThe <code>liftIO</code>, which I moved inside the <code>do</code> block for clarity, can also be removed to declutter the field a bit :</p>\n\n<pre><code>getWidgetSize :: MonadIO m =&gt; Gtk.DrawingArea -&gt; m (Int, Int)\ngetWidgetSize widget = do\n  width'  &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedWidth widget\n  height' &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedHeight widget\n  return (width', height')\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1525823006, "post_id": 50241997, "comment_id": 87504922, "body": "Thank you for the lecture. I always found it difficult to learn from abstract examples and your detailed discussion of a concrete problem I had will definitely help. While I can write both monad syntaxes I need to improve my reasoning."}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 1, "creation_date": 1526229999, "post_id": 50241997, "comment_id": 87652604, "body": "I have read it few times over and over again and it begins to make sense. :-)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1525855717, "last_edit_date": 1525855717, "creation_date": 1525812253, "answer_id": 50241997, "question_id": 50240956, "link": "https://stackoverflow.com/questions/50240956/how-do-i-remove-code-duplication-in-two-identical-haskell-functions-with-differe/50241997#50241997", "title": "How do I remove code duplication in two identical Haskell functions with different output type?", "body": "<p>Yes, we can reason over the types:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/gi-gtk-3.0.22/docs/GI-Gtk-Objects-Widget.html#v:widgetGetAllocatedWidth\" rel=\"nofollow noreferrer\"><strong><code>widgetGetAllocatedWidth :: (HasCallStack, MonadIO m, IsWidget a) =&gt; a -&gt; m Int32</code></strong></a></li>\n<li><a href=\"http://hackage.haskell.org/package/gi-gtk-3.0.22/docs/GI-Gtk-Objects-Widget.html#v:widgetGetAllocatedHeight\" rel=\"nofollow noreferrer\"><strong><code>widgetGetAllocatedHeight :: (HasCallStack, MonadIO m, IsWidget a) =&gt; a -&gt; m Int32</code></strong></a></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Functor.html#v:-60--36--62-\" rel=\"nofollow noreferrer\"><strong><code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code></strong></a></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:fromIntegral\" rel=\"nofollow noreferrer\"><strong><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code></strong></a></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-62--62--61-\" rel=\"nofollow noreferrer\"><strong><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code></strong></a></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:return\" rel=\"nofollow noreferrer\"><strong><code>return :: Monad m =&gt; a -&gt; m a</code></strong></a></li>\n</ul>\n\n<p>First we can desugar the <code>do</code>-block:</p>\n\n<pre><code>getWidgetSize widget = do\n  width'  &lt;- fromIntegral &lt;$&gt; widgetGetAllocatedWidth widget\n  height' &lt;- fromIntegral &lt;$&gt; widgetGetAllocatedHeight widget\n  return (width', height')\n</code></pre>\n\n<p>is syntactical sugar for:</p>\n\n<pre><code>getWidgetSize widget = fromIntegral &lt;$&gt; widgetGetAllocatedWidth widget &gt;&gt;= \\w' -&gt; (\n    fromIntegral &lt;$&gt; widgetGetAllocatedHeight widget &gt;&gt;= \\h' -&gt; (\n        return (w', h')\n    )\n)\n</code></pre>\n\n<p>So first we assume <code>getWidgetSize</code> has type <code>a -&gt; b</code>, and we assume <code>widget :: a</code> (we will later work out what <code>a</code>, <code>b</code>, etc are).</p>\n\n<p>Next we see that there is a call <code>widgetGetAllocatedWidth widget</code>, so that means that <code>(HasCallStack, MonadIO m, IsWidget a)</code> holds, and that <code>widgetGetAllocatedWidth widget</code> has return type <code>m Int32</code>, so we now know:</p>\n\n<pre><code>getWidgetSize :: (HasCallStack, MonadIO m, IsWidget a) =&gt; a -&gt; b\nwidget :: (HasCallStack, MonadIO m, IsWidget a) =&gt; a\nwidgetGetAllocatedWidth widget :: (HasCallStack, MonadIO m, IsWidget a) =&gt; m Int32\n</code></pre>\n\n<p>So now we perform a <code>(&lt;$&gt;) fromIntegral (widgetGetAllocatedWidth widget)</code> so that means that:</p>\n\n<pre><code>(&lt;$&gt;) :: Functor f =&gt; (c -&gt; d) -&gt; f c -&gt; f d\nfromIntegral :: (Integral c, Num d) =&gt; c -&gt; d\nwidgetGetAllocatedWidth widget :: (HasCallStack, MonadIO m, IsWidget a) =&gt; m Int32\n</code></pre>\n\n<p>So we conclude that <code>f ~ m</code> and <code>c ~ Int32</code>, and that:</p>\n\n<pre><code>(&lt;$&gt;) fromIntegral (widgetGetAllocatedWidth widget) :: (HasCallStack, MonadIO m, IsWidget a, Num d, Functor m) =&gt; m d\n</code></pre>\n\n<p>The same holds for the second part <code>fromIntegral &lt;$&gt; widgetGetAllocatedHeight widget</code>, since the signature of <code>widgetGetAllocatedHeight</code> is the same as <code>widgetGetAllocatedWidth</code>, we conclude that:</p>\n\n<pre><code>(&lt;$&gt;) fromIntegral (widgetGetAllocatedHeight widget) :: (HasCallStack, MonadIO n, IsWidget a, Num e, Functor n) =&gt; n e\n</code></pre>\n\n<p>Note that here the <code>n</code> is <em>not</em> per se the same as <code>m</code> (later it will turn out it is), and that <code>e</code> is <em>not</em> per se the same as <code>d</code>.</p>\n\n<p>Now we thus have three parts of the function (we will shorter the first two parts to <code>f</code> and <code>g</code>, such that) our function looks like:</p>\n\n<pre><code>getWidgetSize widget = f widget &gt;&gt;= (\\w -&gt; g widget &gt;&gt;= (\\h -&gt; return (w, h)))\n</code></pre>\n\n<p>With</p>\n\n<pre><code>f :: (HasCallStack, MonadIO m, IsWidget a, Num e, Functor m) =&gt; m d\ng :: (HasCallStack, MonadIO n, IsWidget a, Num e, Functor n) =&gt; n e\n</code></pre>\n\n<p>Since the <code>(&gt;&gt;=)</code> function has as signature <code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>, we thus know that the <code>w</code> variable has type <code>Num d =&gt; d</code>.</p>\n\n<p>We furthermore know that the part <code>g &gt;&gt;= \\h -&gt; return (w, h)</code> has as type:</p>\n\n<pre><code>g &gt;&gt;= \\h -&gt; return (w, h) :: (HasCallStack, MonadIO n, IsWidget a, Num d, Num e, Functor n) =&gt; n (d, e)\n</code></pre>\n\n<p>Since we we \"bind\" <code>f</code> with <code>\\w -&gt; g &gt;&gt;= \\h -&gt; return (w, h)</code>, we know that <code>m ~ n</code>. And so we come to the conclusion that the type of the result is:</p>\n\n<pre><code>(HasCallStack, MonadIO m, IsWidget a, Num d, Num e, Functor m) =&gt; m (d, e)\n</code></pre>\n\n<p>Now we can remove some duplication: since a <code>MonadIO</code> is defined as:</p>\n\n<blockquote><pre><code>class <b>Monad m</b> =&gt; MonadIO m where\n    -- ...</code></pre></blockquote>\n\n<p>and since that:</p>\n\n<blockquote><pre><code>class <b>Applicative m</b> =&gt; Monad m where\n    -- ...</code></pre>(...)<pre><code>class <b>Functor m</b> =&gt; Applicative m where\n    -- ...</code></pre></blockquote>\n\n<p>We know that <code>MonadIO m</code>, actually implies <code>Functor m</code>, so we can remove <code>Functor m</code>, so the final type for the implementation is:</p>\n\n<pre><code>getWidgetSize :: <b>(HasCallStack, MonadIO m, IsWidget a, Num b, Num c) =&gt; a -&gt; m (b, c)</b>\ngetWidgetSize widget = do\n  width'  &lt;- fromIntegral &lt;$&gt; widgetGetAllocatedWidth widget\n  height' &lt;- fromIntegral &lt;$&gt; widgetGetAllocatedHeight widget\n  return (width', height')</code></pre>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 50241018, "answer_count": 2, "score": 4, "last_activity_date": 1525855717, "creation_date": 1525807492, "last_edit_date": 1525808704, "question_id": 50240956, "link": "https://stackoverflow.com/questions/50240956/how-do-i-remove-code-duplication-in-two-identical-haskell-functions-with-differe", "title": "How do I remove code duplication in two identical Haskell functions with different output type?", "body": "<p>I continue experimenting with Haskell and GUI\n<a href=\"https://github.com/bigos/cairo-example/blob/1c4448a936031b0e5b66b77027be975d040df01b/src/Main.hs\" rel=\"nofollow noreferrer\">https://github.com/bigos/cairo-example/blob/1c4448a936031b0e5b66b77027be975d040df01b/src/Main.hs</a>\nand I've ran into another problem.</p>\n\n<p>I have two identical functions with different result type:</p>\n\n<pre><code>getWidgetSize :: Gtk.DrawingArea -&gt; Render (Int, Int)\ngetWidgetSize widget = do\n  width'  &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedWidth widget\n  height' &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedHeight widget\n  return (width', height')\n\ngetWidgetSize2 :: Gtk.DrawingArea -&gt; IO (Int, Int)\ngetWidgetSize2 widget = do\n  width'  &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedWidth widget\n  height' &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedHeight widget\n  return (width', height')\n</code></pre>\n\n<p>One is used in this function</p>\n\n<pre><code>updateCanvas :: Gtk.DrawingArea -&gt; Model -&gt; Render ()\n</code></pre>\n\n<p>and the other is used in the main function.</p>\n\n<p>Is it possible to remove the code duplication?</p>\n\n<h1>solution</h1>\n\n<p>Following Vora's advice I have used the following:</p>\n\n<pre><code>getWidgetSize :: Gtk.DrawingArea -&gt; IO (Int, Int)\ngetWidgetSize widget = do\n  width'  &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedWidth widget\n  height' &lt;- fromIntegral &lt;$&gt; Gtk.widgetGetAllocatedHeight widget\n  return (width', height')\n\nupdateCanvas :: Gtk.DrawingArea -&gt; Model -&gt; Render ()\nupdateCanvas canvas model = do\n  size &lt;- liftIO (getWidgetSize canvas)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1525797287, "post_id": 50238367, "comment_id": 87494013, "body": "I don&#39;t see anything particularly wrong with this. What part of it is off-putting to you?"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1525797747, "post_id": 50238367, "comment_id": 87494279, "body": "It feels like I am going in and out of IO too much. I return on a string in zeros to type match the bits, but at the same time, I return on bits, so I can &gt;&gt;= on a showHex and then I return on the result, so I can do the final &gt;&gt;=. Feels like there has to be a more elegant way of going about it."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 5, "creation_date": 1525797935, "post_id": 50238367, "comment_id": 87494386, "body": "Following <code>&gt;&gt;=</code> with <code>return</code>  means you don&#39;t really need <code>Monad</code>. I would probably write <code>intercalate &quot;-&quot; &lt;$&gt; sequence [zeros, zeros, bits, bits]</code> and <code>flip showHex &quot;&quot; &lt;$&gt; randomRIO (0x10000000::Integer, 0xffffffff::Integer)</code> instead, where <code>&lt;$&gt;</code> is <code>fmap</code>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1525798063, "post_id": 50238367, "comment_id": 87494456, "body": "First, you don&#39;t &quot;go in and out of IO&quot; in Haskell. Once you&#39;re in IO, you&#39;re there to stay. There is no way &quot;out&quot; of IO in the larger sense. You can bind values out of IO to be used in a pure way later, but the function where you do that will always be IO. Second, if you&#39;d like to express the pure components without <code>return</code>s cluttering it up, you could express this with <code>do</code> notation instead? I also like @danidiaz&#39;s suggestion of using the <code>Functor</code> instance for IO here to essentially map your pure functions over the IO computations."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1525798720, "post_id": 50238367, "comment_id": 87494791, "body": "I understand that you cannot completely get rid of IO once you start with it. But it seems like major part of what monads are about is to allow applying pure functions to impure values. And once you are in a pure function you could be considered &quot;out of IO&quot;, since you are no longer operating on monads."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1525798761, "post_id": 50238367, "comment_id": 87494812, "body": "@danidiaz thanks, that looks much more pleasant."}, {"owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "edited": false, "score": 0, "creation_date": 1525799476, "post_id": 50238367, "comment_id": 87495186, "body": "You can also get rid of the <code>return</code> in your <code>zeros</code> binding by doing something along the lines of <code>intercalate &quot;-&quot; . ([zeros, zeros] ++ ) &lt;$&gt; sequence [bits, bits]</code> or even <code>intercalate &quot;-&quot; . (zeros:) . (zeros:) &lt;$&gt; sequence [bits, bits]</code>. Wether this pleases your eye more is yours to determine. It does hide the fact that this in fact goes through the IO Monad, in any case."}], "answers": [{"comments": [{"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1525813238, "post_id": 50241694, "comment_id": 87501955, "body": "You are right, the range is picked for convenience, so I don&#39;t have to do some sort of scanf-like operation on the resulting string."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1525813424, "post_id": 50241694, "comment_id": 87502030, "body": "Looks like random-sting is available through hackage <a href=\"https://hackage.haskell.org/package/random-string\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/random-string</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1525813504, "post_id": 50241694, "comment_id": 87502058, "body": "@MadWombat I guess so, I forgot about that."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1525879939, "post_id": 50241694, "comment_id": 87532006, "body": "I have tried a few times to implement the same thing through Text.Printf, but couldn&#39;t make printf play nicely with IO. Is there a way to do that?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1525881753, "post_id": 50241694, "comment_id": 87533111, "body": "Sounds like a separate question should be opened for that. The <code>printf</code> function is polymorphic, but you should be able to use it as IO, such as <code>printf &quot;%d\\n&quot; 42 :: IO ()</code>"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1525810786, "creation_date": 1525810786, "answer_id": 50241694, "question_id": 50238367, "link": "https://stackoverflow.com/questions/50238367/random-hex-id-in-haskell/50241694#50241694", "title": "Random hex ID in Haskell", "body": "<p>You could use the random-string package to handle both the random value and the rendering:</p>\n\n<pre><code>% git clone https://github.com/TomMD/random-string\nCloning into 'random-string'...\nremote: Counting objects: 12, done.\nremote: Total 12 (delta 0), reused 0 (delta 0), pack-reused 12\nUnpacking objects: 100% (12/12), done.\n% cd random-string\n% cabal new-repl\nResolving dependencies...\n&gt; import Data.List\n&gt; let zeros = pure $ replicate 8 '0'\n&gt; let rnd = randomString (StringOpts Base16 4)\n&gt; (intercalate \"-\") &lt;$&gt; sequence [zeros,zeros,rnd,rnd]\n</code></pre>\n\n<p>Which is to say the solution sans imports is extremely similar to what you already have:</p>\n\n<pre><code>f = intercalate \"-\" &lt;$&gt; sequence [z,z,r,r]\n  where z = pure (replicate 8 '0')\n        r = randomString (StringOpts Base16 4)\n</code></pre>\n\n<p>N.B. The range on my solution is different from yours.  I'm assuming you selected a random of 0x10000000-0xFFFFFFFF just because you wanted a full rendered 8 characters and didn't want to or know how to render the leading zeros.  If you want to pair down the range then the random-string package probably is more trouble than value.</p>\n"}, {"comments": [{"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1525879880, "post_id": 50249286, "comment_id": 87531961, "body": "Thanks, need to read up on comonads. This sounds scary though, even if you only picked seed randomly, you would still be non-pure, since multiple runs would produce different streams of pseudo-randomness. Therefore you would still be in a monadic world somewhere."}], "tags": [], "owner": {"reputation": 931, "user_id": 2631185, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75f07727c65d676aa81eeb97b794cfa7?s=128&d=identicon&r=PG", "display_name": "Regis Kuckaertz", "link": "https://stackoverflow.com/users/2631185/regis-kuckaertz"}, "is_accepted": false, "score": 0, "last_activity_date": 1525856174, "creation_date": 1525856174, "answer_id": 50249286, "question_id": 50238367, "link": "https://stackoverflow.com/questions/50238367/random-hex-id-in-haskell/50249286#50249286", "title": "Random hex ID in Haskell", "body": "<p>Your code is tightly coupled with <code>IO</code>, which, depending on the design of your application, might not be very practical. Intuitively, the IO action is only necessary to produce a random seed, after that it is useless.</p>\n\n<pre><code>deviceId :: RandomGen g =&gt; g -&gt; String\n</code></pre>\n\n<p>I've never played with random in Haskell, but I thought that \"randomness\" is a qualitative attribute of the input, not of the output (as depicted by the type of <code>deviceId</code> above). So I wondered whether there was a Random Comonad somewhere, and <a href=\"https://hackage.haskell.org/package/comonad-random-0.1.2/docs/Control-Comonad-Random.html\" rel=\"nofollow noreferrer\">it turns out there is</a>.</p>\n\n<pre><code>-- Generates random hex strings of length n\nrandomHexString :: RandomGen g =&gt; Int -&gt; g -&gt; [String]\nrandomHexString n = (extracts next =&lt;= take n . extracts next) . mkRandR ('0', 'f')\n</code></pre>\n\n<p>Now <code>deviceId</code> is as simple as</p>\n\n<pre><code>deviceId g = intercalate \"-\" xss where\n  xss = zs ++ ws\n  zs = replicate 2 (replicate 8 '0') \n  ws = take 2 $ randomHexString 8 g\n</code></pre>\n\n<p>and there's no IO in sight. Sadly, the comonad-random package is deprecated.</p>\n\n<p>Still, you might want to generate a random seed at the end of the world and pass it around when necessary.</p>\n"}], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1525856174, "creation_date": 1525797162, "last_edit_date": 1525802517, "question_id": 50238367, "link": "https://stackoverflow.com/questions/50238367/random-hex-id-in-haskell", "title": "Random hex ID in Haskell", "body": "<p>I am very new to Haskell and hard FP. I have been trying to come up with a function that would generate special type of ID for my project. The ID has 4 groups of 8 digits. The first two groups are always zeros and the other two groups are random 8 digit hex numbers. This is the code I came up with, but it seems to call a lot of things to achieve a simple result. What is the proper Haskell way of doing something like this?</p>\n\n<pre><code>import Data.List (intercalate)\nimport System.Random (randomRIO)\nimport Numeric (showHex)\n\ndeviceId :: IO String\ndeviceId = sequence [zeros, zeros, bits, bits] &gt;&gt;= return . intercalate \"-\"\n    where zeros = return \"00000000\"\n          bits = randomRIO (0x10000000::Integer, 0xffffffff::Integer) &gt;&gt;= return . flip showHex \"\"\n</code></pre>\n\n<p>Edit: thanks to the comments my function now uses fmap and looks like this</p>\n\n<pre><code>deviceId :: IO String\ndeviceId = intercalate \"-\" &lt;$&gt; sequence [zeros, zeros, bits, bits]\n    where zeros = return \"00000000\"\n          bits = flip showHex \"\" &lt;$&gt; randomRIO (0x10000000::Integer, 0xffffffff::Integer)\n</code></pre>\n\n<p>The return on zeros makes sense to me, since it clearly indicates that we are operating on IO strings. Thanks. Any other improvements?</p>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1546031639, "post_id": 50237042, "comment_id": 94766439, "body": "Any opinios about <a href=\"https://stackoverflow.com/questions/53964198/plugin-name-lookup-behavior-change-from-ghc-8-4-series\" title=\"plugin name lookup behavior change from ghc 8 4 series\">stackoverflow.com/questions/53964198/&hellip;</a>?"}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 4, "last_activity_date": 1525795967, "last_edit_date": 1525795967, "creation_date": 1525792749, "answer_id": 50237042, "question_id": 50236926, "link": "https://stackoverflow.com/questions/50236926/how-to-replicate-the-behaviour-of-name-in-a-th-splice/50237042#50237042", "title": "How to replicate the behaviour of &#39;name in a TH splice", "body": "<p>The problem in this case is not so much that the <code>Name</code> returned by <code>'foo</code> vs. <code>lookupValueName</code> is different, but that using <code>'foo</code> keeps <code>foo</code> alive throughout the compilation of the module, while <code>lookupValueName \"foo\"</code> does not. Then GHC removes the binding of <code>\"foo\"</code> and inspection-testing trips over it.</p>\n\n<p>And indeed removing the export list from the module, which keeps all top-level bindings around, makes the problem go away.</p>\n"}], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1525795967, "creation_date": 1525792396, "last_edit_date": 1525792567, "question_id": 50236926, "link": "https://stackoverflow.com/questions/50236926/how-to-replicate-the-behaviour-of-name-in-a-th-splice", "title": "How to replicate the behaviour of &#39;name in a TH splice", "body": "<p>Consider this Haskell file:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n{-# OPTIONS_GHC -fplugin Test.Inspection.Plugin #-}\nmodule Text (main) where\n\nimport Test.Inspection\n\nimport Data.Text as T\nimport Data.Text.Encoding as E\nimport Data.ByteString (ByteString)\n\nimport Language.Haskell.TH\n\ntoUpperString :: String -&gt; String\ntoUpperString = T.unpack . T.toUpper . T.pack\n\ntoUpperBytestring :: ByteString -&gt; String\ntoUpperBytestring = T.unpack . T.toUpper . E.decodeUtf8\n\ndo Just n &lt;- lookupValueName \"toUpperString\"\n   inspect $ n `hasNoType` ''T.Text\ninspect $ 'toUpperBytestring `hasNoType` ''T.Text\n\nmain :: IO ()\nmain = return ()\n</code></pre>\n\n<p>It uses Template Haskell to define test obligations which are tested by the GHC plugin in inspection-testing.</p>\n\n<p>Under the hood, inspection testing passes a Template Haskell name in an annotation, and converts it to to a Core name using <code>thNameToGhcName</code>, and then tries to find this name in the current module.</p>\n\n<p>This works fine if I create a template Haskell name using <code>'foo</code>, but it fails if I use <code>lookupValueName</code>.</p>\n\n<ul>\n<li>Why are they different?</li>\n<li>How can I recreate the behavior of <code>'foo</code> when I have a string?</li>\n</ul>\n\n<p>(Why do I not just use <code>'foo</code>? Because I want to dynamically create obligations, so I have Template Haskell code that defines many such functions and obligations.)</p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 518, "user_id": 3605831, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/5928Q.png?s=128&g=1", "display_name": "markvdlaan93", "link": "https://stackoverflow.com/users/3605831/markvdlaan93"}, "edited": false, "score": 0, "creation_date": 1525792446, "post_id": 50236845, "comment_id": 87491220, "body": "You may look into this post <a href=\"https://stackoverflow.com/questions/6270214/haskell-list-of-tuples-to-list\" title=\"haskell list of tuples to list\">stackoverflow.com/questions/6270214/&hellip;</a>"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1525792923, "post_id": 50236845, "comment_id": 87491532, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/6270214/haskell-list-of-tuples-to-list\">Haskell List of tuples to list?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1525811072, "post_id": 50237456, "comment_id": 87501086, "body": "Incidentally, the point-free version would be clearer as <code>(uncurry (:) . second (:[]) =&lt;&lt;)</code>: \u201ccons the first element onto the second element wrapped in a list for each pair\u201d. (<code>second</code> is from <code>Control.Arrow</code> and in this case can be replaced with <code>fmap</code>.)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1525799049, "last_edit_date": 1525799049, "creation_date": 1525793932, "answer_id": 50237456, "question_id": 50236845, "link": "https://stackoverflow.com/questions/50236845/list-of-tuples-into-list-with-list-comprehension/50237456#50237456", "title": "list of tuples into list with list comprehension", "body": "<p>Given the list of tuples is named <code>ts</code>, we can perform iteration twice:</p>\n\n<pre><code>[ t | (a, b) &lt;- ts, t &lt;- [a, b] ]\n</code></pre>\n\n<p>So here we first iterate over the tuples <code>(a, b)</code> in <code>ts</code>, next we construct a new list <code>[a, b]</code>, and we iterate over that list as well, and we yield <code>t</code> for every <code>t</code> in <code>[a, b]</code>.</p>\n\n<p>Or with a point-free list monad:</p>\n\n<pre><code>(&gt;&gt;= uncurry ((. pure) . (:)))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 1, "creation_date": 1525878428, "post_id": 50251588, "comment_id": 87530974, "body": "<code>concatMap</code> is defined in <code>Data.Foldable</code> and so must be <code>imported</code>. <code>concat.map</code> works the same without importing."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "reply_to_user": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1525879445, "post_id": 50251588, "comment_id": 87531681, "body": "@fpmora Hoogle says it is also in the base prelude"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1525879940, "post_id": 50251588, "comment_id": 87532008, "body": "My bad. I thought not. It&#39;s great to know, Thank you."}], "tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 1, "last_activity_date": 1526025948, "last_edit_date": 1526025948, "creation_date": 1525863014, "answer_id": 50251588, "question_id": 50236845, "link": "https://stackoverflow.com/questions/50236845/list-of-tuples-into-list-with-list-comprehension/50251588#50251588", "title": "list of tuples into list with list comprehension", "body": "<pre><code>concatMap (\\(x, y) -&gt; [x, y]) [(1,2),(3,4),(5,6)]\n</code></pre>\n\n<p>will give</p>\n\n<pre><code>[1,2,3,4,5,6]\n</code></pre>\n\n<p>If you don't want to use <code>concatMap</code> you can do </p>\n\n<pre><code>concat . map (\\(x, y) -&gt; [x, y])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 2, "last_activity_date": 1525879370, "last_edit_date": 1525879370, "creation_date": 1525878328, "answer_id": 50256600, "question_id": 50236845, "link": "https://stackoverflow.com/questions/50236845/list-of-tuples-into-list-with-list-comprehension/50256600#50256600", "title": "list of tuples into list with list comprehension", "body": "<p>You can, of course, process any list, even a list of tuples in a list comprehension. It is the form that is different. You see in the two great answers before this, the form is (a,b) or (x,y). These both mean the same. They mean two elements in a tuple. The problem with processing the tuple form is that the output are individual, two item lists. This is why <code>concat</code> is so valuable.</p>\n\n<p>I do like list comprehensions so very much and the classic form for flattening a list of any kind with a list comprehension is given above.</p>\n\n<p>I am relatively new to Haskell and had trouble understanding how <code>fold</code>s could produce a list and not a single value like <code>sum</code> or <code>product</code>.</p>\n\n<p>Questions like this are invaluable because they help me understand.</p>\n\n<p>The <code>foldr</code> version of this results in a list. The list you want. Why is it a list and not a single value? It is because <code>foldr</code> produces a series of successively larger and larger lists with the last largest being the answer.</p>\n\n<p>Here is a <code>foldr</code> version of the function to flatten a tuple list.</p>\n\n<pre><code>foldr (\\(a,b) l-&gt; a:b:l) []    [(1,2),(3,4),(5,6)]\n</code></pre>\n\n<p>[1,2,3,4,5,6]</p>\n"}], "owner": {"reputation": 49, "user_id": 8880650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/038374c98950ba15f4c499f7ca64e830?s=128&d=identicon&r=PG&f=1", "display_name": "Kubaguette The Testobun", "link": "https://stackoverflow.com/users/8880650/kubaguette-the-testobun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 0, "accepted_answer_id": 50237456, "answer_count": 3, "score": 1, "last_activity_date": 1526025948, "creation_date": 1525792139, "last_edit_date": 1525792845, "question_id": 50236845, "link": "https://stackoverflow.com/questions/50236845/list-of-tuples-into-list-with-list-comprehension", "title": "list of tuples into list with list comprehension", "body": "<p>Is there any function or method in Haskell which helps me to take a list of tuples, for example <code>[(1,2),(3,4),(5,6)]</code> and<br>\nreturns <code>[1,2,3,4,5,6]</code> and works with list comprehension?</p>\n\n<p>I'm specifically searching for a function which takes a parameter <code>xs</code> and<br>\nhas in body (of the function) a list comprehension.</p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1525790258, "post_id": 50236095, "comment_id": 87489759, "body": "<code>x `mod` 20</code> is not a Boolean.  See your last guard in the list comprehension."}, {"owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "edited": false, "score": 0, "creation_date": 1525790395, "post_id": 50236095, "comment_id": 87489854, "body": "<code>odd x == False</code> is also equivalent to <code>even x</code>. This will however make your list unable to find the first 5 items, since no even number mod 20 can ever give an odd result."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525866679, "post_id": 50236328, "comment_id": 87522551, "body": "we know that it is 185? how?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525867084, "post_id": 50236328, "comment_id": 87522773, "body": "@WillNess: by interpreting it as a <i>linear Diophantine equation</i>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525867366, "post_id": 50236328, "comment_id": 87522969, "body": "@WillNess: If I find some time later today, I will try to expand the answer."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1525790774, "last_edit_date": 1525790774, "creation_date": 1525790576, "answer_id": 50236328, "question_id": 50236095, "link": "https://stackoverflow.com/questions/50236095/list-comprehension-with-multiple-procedures/50236328#50236328", "title": "List Comprehension with multiple procedures", "body": "<p>The culprit is in the last part:</p>\n\n<pre><code>take 5 [x | x &lt;- [0..], odd x == False, x &gt; 0, x `mod` 13 == 3, x `mod` 20]\n--                                                              ^^^^^^^^^^\n</code></pre>\n\n<p>Here Haskell expects that you write a filter, but <code>x `mod` 20</code> is <em>not</em> a filter: it does <em>not</em> return a <code>Bool</code>, <code>x `mod` 20</code> returns the same type of number as <code>x</code> itself.</p>\n\n<p>Based on your question, you want that to be five, so can solve it with:</p>\n\n<pre><code>take 5 [x | x &lt;- [0..], odd x == False, x &gt; 0, x `mod` 13 == 3, x `mod` 20 == 5]\n--                                                              ^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>But there are some other problems here:</p>\n\n<ol>\n<li>you wrote \"uneven\", hence the <code>odd x</code> check should be <code>True</code>;</li>\n<li><code>x &gt; 0</code> can always be <code>True</code>, given we restrict the iterator of <code>x</code> to <code>[1..]</code>;</li>\n<li>we can merge <code>x &lt;- [1..]</code> and <code>odd x</code> into <code>[1, 3..]</code>;</li>\n</ol>\n\n<p>This results in:</p>\n\n<pre><code>take 5 [x | x &lt;- [1, 3..], x `mod` 13 == 3, x `mod` 20 == 5]\n</code></pre>\n\n<p>Nevertheless we do not need all this modulo checking anyway: we can first calculate the <em>least common multiple</em> of <code>2</code> (odd constraint), <code>20</code>, and <code>13</code> which is <code>260</code>, as a result we know that the numbers in the result take \"hops\" of 260.</p>\n\n<p>We also know that the first result is <code>185</code>, so this can be rewritten to:</p>\n\n<pre><code>take 5 [185, 445 ..]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 1, "last_activity_date": 1525790637, "creation_date": 1525790637, "answer_id": 50236358, "question_id": 50236095, "link": "https://stackoverflow.com/questions/50236095/list-comprehension-with-multiple-procedures/50236358#50236358", "title": "List Comprehension with multiple procedures", "body": "<p>The problem is the </p>\n\n<pre><code>x mod 20\n</code></pre>\n\n<p>at the end of the comprehension. You do not compare it to anything, so it fails as a condition to filter your list.</p>\n"}, {"tags": [], "owner": {"reputation": 165, "user_id": 2630395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b5f0f742c249caa0f3d03554e9a1675?s=128&d=identicon&r=PG", "display_name": "Somebody", "link": "https://stackoverflow.com/users/2630395/somebody"}, "is_accepted": true, "score": 3, "last_activity_date": 1525790715, "creation_date": 1525790715, "answer_id": 50236385, "question_id": 50236095, "link": "https://stackoverflow.com/questions/50236095/list-comprehension-with-multiple-procedures/50236385#50236385", "title": "List Comprehension with multiple procedures", "body": "<p>The error is because of <code>x</code>mod<code>20</code>. This expression returns a Num type and your need a Bool. If, for instance, you want to compare the modulus result with 0:</p>\n\n<pre><code>take 5 [x | x &lt;- [0..], even x, x `mod` 13 == 3, x `mod` 20 == 0]\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 8880650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/038374c98950ba15f4c499f7ca64e830?s=128&d=identicon&r=PG&f=1", "display_name": "Kubaguette The Testobun", "link": "https://stackoverflow.com/users/8880650/kubaguette-the-testobun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 50236385, "answer_count": 3, "score": 0, "last_activity_date": 1525790774, "creation_date": 1525789874, "last_edit_date": 1525790079, "question_id": 50236095, "link": "https://stackoverflow.com/questions/50236095/list-comprehension-with-multiple-procedures", "title": "List Comprehension with multiple procedures", "body": "<p>Im really new to haskell and trying to learn the Basics, now I wanted to try<br>\nlittle bit of list comprehension.  </p>\n\n<p>I want to create an list (not ending) with uneven numbers from <code>0 to \u2026</code> where <code>number `mod` 13 == 3</code> and <code>number `mod` 20 == 5</code>.  </p>\n\n<p>Then I want to use the <code>take</code> function and take the first 5 numbers of this list<br>\nand show them.  </p>\n\n<p>My Code was this:</p>\n\n<pre><code>take 5 [x | x &lt;- [0..], odd x == False, x &gt; 0, x `mod` 13 == 3, x `mod` 20]\n</code></pre>\n\n<p>Now I'm getting errors in haskell and dont really know what do to:  </p>\n\n<pre><code>&gt; &lt;interactive&gt;:14:19: error:  \n    \u2022 No instance for (Num Bool) arising from the literal \u20180\u2019  \n    \u2022 In the expression: 0  \n      In the expression: [0 .. ]  \n      In a stmt of a list comprehension: x &lt;- [0 .. ]  \n&lt;interactive&gt;:14:25: error:  \n    \u2022 No instance for (Integral Bool) arising from a use of \u2018odd\u2019  \n    \u2022 In the first argument of \u2018(==)\u2019, namely \u2018odd x\u2019  \n      In the expression: odd x == False  \n      In a stmt of a list comprehension: odd x == False  \n</code></pre>\n\n<p>Does somebody know how I can make it correctly? </p>\n"}, {"tags": ["algorithm", "sorting", "haskell", "cycle-sort"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1525789930, "post_id": 50236088, "comment_id": 87489531, "body": "I&#39;m afraid this is a bit off topic here. You can for example ask questions about <i>specific</i> parts of cyclesorts, and why your attempt to implement such subparts fail."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1525796928, "post_id": 50236088, "comment_id": 87493791, "body": "This would maybe be better suited to <a href=\"https://codereview.stackexchange.com/\">Code Review Stack Exchange</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1525833138, "post_id": 50236088, "comment_id": 87506896, "body": "@AJFarmar, this isn&#39;t even <i>close</i> to being on-topic for Code Review."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 4, "last_activity_date": 1525839129, "last_edit_date": 1592644375, "creation_date": 1525839129, "answer_id": 50245396, "question_id": 50236088, "link": "https://stackoverflow.com/questions/50236088/cyclesort-in-haskell-troubles/50245396#50245396", "title": "CycleSort in Haskell - troubles", "body": "<p>Rather than trying to translate, let's go to <a href=\"https://en.wikipedia.org/wiki/Cycle_sort#Algorithm\" rel=\"nofollow noreferrer\">wikipedia's\ndefinition</a>:</p>\n<blockquote>\n<h1>Algorithm</h1>\n<p>Given an element a, we can find the index at which it will occur in\nthe sorted list by simply counting the number of elements in the entire list\nthat are smaller than a. Now</p>\n<ol>\n<li>If the element is already at the correct position, do nothing.</li>\n<li>If it is not, we will write it to its intended position. That position is\ninhabited by a different element b, which we then have to move to its\ncorrect position. This process of displacing elements to their correct\npositions continues until an element is moved to the original position of\na. This completes a cycle.</li>\n</ol>\n<p>Repeating this process for every element sorts the list, with a single writing\noperation if and only if an element is not already at its correct position.\nWhile computing the correct positions takes O(n) time for every single\nelement, thus resulting in a quadratic time algorithm, the number of writing\noperations is minimized.</p>\n<h2>Implementation</h2>\n<p>To create a working implementation from the above outline,\ntwo issues need to be addressed:</p>\n<ol>\n<li>When computing the correct positions, we have to make sure not to\ndouble-count the first element of the cycle.</li>\n<li>If there are duplicate elements present, we could try to move an element a\nto its correct position, which already happens to be inhabited by an a.\nSimply swapping these would cause the algorithm to cycle indefinitely.\nInstead, we have to insert the element after any of its duplicates.</li>\n</ol>\n</blockquote>\n<p>Implementing <code>cycleSort</code> in haskell, our first question should be what should\nthe type of <code>cycleSort</code> be?</p>\n<p>The normal\n<a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:sort\" rel=\"nofollow noreferrer\"><code>sort</code></a>\nhas the type <code>sort :: Ord a =&gt; [a] -&gt; [a]</code>, but this won't work for <code>cycleSort</code>.\nCycle sort is an <em>in-place</em> algorithm, so sorting a list makes no sense. Rather,\nwe'll want to sort a <a href=\"http://hackage.haskell.org/package/vector-0.10.12.2/docs/Data-Vector-Mutable.html#t:MVector\" rel=\"nofollow noreferrer\">mutable\nvector</a>.</p>\n<pre><code>cycleSort :: Ord a =&gt; MVector s a -&gt; MVector s a\n</code></pre>\n<p>This type isn't quite right though. Operations on <code>MVector</code>s aren't pure - they\nreturn actions in some monad, usually <code>ST s</code> or <code>IO</code>. So this type needs a\nlittle tweaking.</p>\n<p>Rather than return a sorted vector, we'll return an action that will sort the\nmutable vector when executed:</p>\n<pre><code>cycleSort :: (PrimMonad m, Ord a) =&gt; MVector (PrimState m) a -&gt; m ()\n</code></pre>\n<p>(<code>PrimMonad m</code> just means that <code>m</code> can construct actions that mutate vectors,\n<code>PrimState m</code> serves to tie the <code>MVector</code> to this particular monad).</p>\n<p>For comparison with other implementations, we may want to count the number of\nwrites:</p>\n<pre><code>cycleSort :: (PrimMonad m, Ord a) =&gt; MVector (PrimState m) a -&gt; m Int\n</code></pre>\n<p>So now we can work on the algorithm itself.</p>\n<p>Since this is an assignment, I won't provide the solution for you, but here's\nsome useful functions:</p>\n<ul>\n<li><code>Data.Vector.Mutable.length :: MVector s a -&gt; Int</code> to get the length of a mutable vector</li>\n<li><code>Data.Vector.Mutable.read :: PrimMonad m =&gt; MVector (PrimState m) a -&gt; Int -&gt; m a</code> to read a value at an index in a mutable vector</li>\n<li><code>Data.Vector.Mutable.write :: PrimMonad m =&gt; MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()</code> to write a value at an index in a mutable vector</li>\n</ul>\n<p>For an example of use, here's a function that reverses an MVector:</p>\n<pre><code>import Control.Monad (when)\nimport Control.Monad.Primitive (PrimMonad, PrimState)\nimport qualified Data.Vector.Mutable as MV\n\nreverseMVector :: PrimMonad m =&gt; MV.MVector (PrimState m) a -&gt; m ()\nreverseMVector v = loop 0 (MV.length v - 1) where\n  loop lo hi = when (lo &lt; hi) $ do\n    a &lt;- MV.read v lo\n    b &lt;- MV.read v hi\n    MV.write v lo b\n    MV.write v hi a\n    loop (lo+1) (hi-1)\n</code></pre>\n<p>There's a bunch of advanced techniques that can make the solution prettier, but\nrecursive functions (like <code>loop</code> above) are sufficient.</p>\n<p>For example, one could translate</p>\n<pre><code>// ignore all duplicate elements\nwhile (item == arr[pos])\n    pos += 1;\n</code></pre>\n<p>As</p>\n<pre><code>-- ignore all duplicate elements\nlet skipDupes pos = do\n      jtem &lt;- MV.read v pos\n      if item == jtem\n        then skipDupes (pos + 1)\n        else return pos\npos &lt;- skipDupes pos\n</code></pre>\n<p>If you want to test your code on various inputs, use\n<code>Data.Vector.thaw</code>/<code>Data.Vector.freeze</code> to convert an <code>Vector a</code> to and from a\n<code>MVector s a</code>.</p>\n<p>As you run into issues, post the code you have so far and the errors you're\nrunning into.</p>\n"}], "owner": {"reputation": 1, "user_id": 9759068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c50e1b75f379f2656fee79ccd02eb79f?s=128&d=identicon&r=PG&f=1", "display_name": "S.Pas", "link": "https://stackoverflow.com/users/9759068/s-pas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "closed_date": 1525839229, "answer_count": 1, "score": -5, "last_activity_date": 1525839129, "creation_date": 1525789853, "last_edit_date": 1525827396, "question_id": 50236088, "link": "https://stackoverflow.com/questions/50236088/cyclesort-in-haskell-troubles", "closed_reason": "Opinion-based", "title": "CycleSort in Haskell - troubles", "body": "<p>I am trying to make a CycleSort in Haskell, it is my assignment, but nobody has made me clear how to work with Haskell, I have tried many times, tried to \"translate\" a code from other language, but it didn't work. I have looked for it everywhere, but there was nothing. I would be very, very thankful if somebody helps me with this stuff.\nThere is the code of CycleSort in Java.</p>\n\n<pre><code>// Function sort the array using Cycle sort\npublic static void cycleSort(int arr[], int n)\n{\n    // count number of memory writes\n    int writes = 0;\n\n    // traverse array elements and put it to on\n    // the right place\n    for (int cycle_start = 0; cycle_start &lt;= n - 2; cycle_start++) {\n        // initialize item as starting point\n        int item = arr[cycle_start];\n\n        // Find position where we put the item. We basically\n        // count all smaller elements on right side of item.\n        int pos = cycle_start;\n        for (int i = cycle_start + 1; i &lt; n; i++)\n            if (arr[i] &lt; item)\n                pos++;\n\n        // If item is already in correct position\n        if (pos == cycle_start)\n            continue;\n\n        // ignore all duplicate elements\n        while (item == arr[pos])\n            pos += 1;\n\n        // put the item to it's right position\n        if (pos != cycle_start) {\n            int temp = item;\n            item = arr[pos];\n            arr[pos] = temp;\n            writes++;\n        }\n\n        // Rotate rest of the cycle\n        while (pos != cycle_start) {\n            pos = cycle_start;\n\n            // Find position where we put the element\n            for (int i = cycle_start + 1; i &lt; n; i++)\n                if (arr[i] &lt; item)\n                    pos += 1;\n\n            // ignore all duplicate elements\n            while (item == arr[pos])\n                pos += 1;\n\n            // put the item to it's right position\n            if (item != arr[pos]) {\n                int temp = item;\n                item = arr[pos];\n                arr[pos] = temp;\n                writes++;\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["haskell", "types", "syntax", "output"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525785376, "post_id": 50234571, "comment_id": 87486448, "body": "Types start with uppercase."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1525785694, "creation_date": 1525785694, "answer_id": 50234688, "question_id": 50234571, "link": "https://stackoverflow.com/questions/50234571/access-type-fields-in-data-constructor-haskell/50234688#50234688", "title": "Access type fields in data constructor haskell", "body": "<h1>With <em>pattern matching</em></h1>\n\n<p>We can construct a function that uses pattern matching:</p>\n\n<pre><code>objectType1 :: Object -&gt; Type1\nobjectType1 (Object x _ _ _) = x\n</code></pre>\n\n<h1>With <em>record syntax</em></h1>\n\n<p>We can also define a data type with <em>record syntax</em>:</p>\n\n<pre><code>data Object = Object {objectType1 :: Type1,\n                      objectType2 :: Type2,\n                      objectType3 :: Type3,\n                      objectType4 :: Type4} deriving(Eq, Show)\n</code></pre>\n\n<p>Haskell will then automatically construct getters, so then you have implictly constructed such <code>objectType1</code> function.</p>\n\n<p>We can also use such record syntax as a \"<em>setter</em>\", for example:</p>\n\n<pre><code>setObjectType1 :: Type1 -&gt; Object -&gt; Object\nsetObjectType1 t o = o { objectType1 = t}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 103, "user_id": 4216421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5a37788f314993c6e3d14b81190e098?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Mueller", "link": "https://stackoverflow.com/users/4216421/peter-mueller"}, "is_accepted": false, "score": 0, "last_activity_date": 1557703344, "creation_date": 1557703344, "answer_id": 56104253, "question_id": 50234571, "link": "https://stackoverflow.com/questions/50234571/access-type-fields-in-data-constructor-haskell/56104253#56104253", "title": "Access type fields in data constructor haskell", "body": "<p>Also, the line</p>\n\n<pre><code>Object t1 t2 t3 t4 = construct\n</code></pre>\n\n<p>seems to unpack the four fields. I'm new to Haskell, so I don't know if that is a kind of documented behavior or recommended method (sort of pattern matching?).</p>\n"}], "owner": {"reputation": 263, "user_id": 9654804, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HaskellPlease", "link": "https://stackoverflow.com/users/9654804/haskellplease"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1689, "favorite_count": 0, "accepted_answer_id": 50234688, "answer_count": 2, "score": 3, "last_activity_date": 1557703344, "creation_date": 1525785328, "last_edit_date": 1525785411, "question_id": 50234571, "link": "https://stackoverflow.com/questions/50234571/access-type-fields-in-data-constructor-haskell", "title": "Access type fields in data constructor haskell", "body": "<p>I have a question how do I access certain types in a data constructor. Lets say I got this code sample</p>\n\n<pre><code>data Object = Object Type1 Type2 Type3 Type4\n  deriving(Eq,Show)\ntype Type1 = Float\ntype Type2 = Bool\ntype Type3 = Int\ntype Type4 = String\n</code></pre>\n\n<p>and I define a function called</p>\n\n<pre><code>construct = Object 5.6 True 10 \"World\"\n</code></pre>\n\n<p>How can I print certain types from construct for example I want to print \"World\" from construct how can I get that information.</p>\n\n<pre><code>Type4 construct \n</code></pre>\n\n<p>does not work </p>\n\n<p>Thank you in Advance</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1525783019, "post_id": 50233718, "comment_id": 87484970, "body": "What does <code>ldd</code> say when you run it on <code>test</code> and <code>libsafe.so</code>?"}, {"owner": {"reputation": 328, "user_id": 2765718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5609d9b3cd77f4949670d8cd4ecf074?s=128&d=identicon&r=PG&f=1", "display_name": "Ed Behn", "link": "https://stackoverflow.com/users/2765718/ed-behn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1525787103, "post_id": 50233718, "comment_id": 87487647, "body": "I added ldd to the question."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1525827458, "post_id": 50233718, "comment_id": 87505807, "body": "If Arrowd&quot;solution does not work (but it should) you can try this code on my blog: <a href=\"https://laustep.github.io/stlahblog/posts/FloatExpansionHaskell.html#compilation\" rel=\"nofollow noreferrer\">laustep.github.io/stlahblog/posts/&hellip;</a>"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1525834062, "post_id": 50233718, "comment_id": 87507093, "body": "Not sure that <code>-shared</code> has an effect on Linux."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1525795557, "creation_date": 1525795557, "answer_id": 50237941, "question_id": 50233718, "link": "https://stackoverflow.com/questions/50233718/haskell-shared-library-not-loading-properly/50237941#50237941", "title": "Haskell shared library not loading properly", "body": "<p>The functionality you are looking for is implemented in Cabal 2. In the <code>.cabal</code> file you can now use <code>foreign-library</code> stanza, which would produce a DSO that has all haskell bits linked in statically (as far as I understand it). This DSO can then be loaded into non-haskell code as regular DSO.</p>\n\n<p>Example of using <code>foreign-library</code>:</p>\n\n<pre><code>foreign-library myforeignlib\n  type:                native-shared\n  lib-version-info:    1:2:3\n\n  if os(Windows)\n    options: standalone\n    mod-def-file: MyForeignLib.def\n\n  other-modules:       MyForeignLib.SomeModule\n                       ...\n  build-depends:       base\n                       ...\n  hs-source-dirs:      src\n  c-sources:           csrc/some_c_code.c\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 328, "user_id": 2765718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5609d9b3cd77f4949670d8cd4ecf074?s=128&d=identicon&r=PG&f=1", "display_name": "Ed Behn", "link": "https://stackoverflow.com/users/2765718/ed-behn"}, "is_accepted": false, "score": 0, "last_activity_date": 1526354356, "creation_date": 1526354356, "answer_id": 50341843, "question_id": 50233718, "link": "https://stackoverflow.com/questions/50233718/haskell-shared-library-not-loading-properly/50341843#50341843", "title": "Haskell shared library not loading properly", "body": "<p>I found a useful guide here: <a href=\"https://www.vex.net/~trebla/haskell/so.xhtml\" rel=\"nofollow noreferrer\">https://www.vex.net/~trebla/haskell/so.xhtml</a></p>\n\n<p>The sort answer is that I need to link my library with the RTS library:</p>\n\n<pre><code>ghc -dynamic -shared -fPIC -o libsafe.so Safe.hs -lHSrts-ghc8.2.2\n</code></pre>\n"}], "owner": {"reputation": 328, "user_id": 2765718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5609d9b3cd77f4949670d8cd4ecf074?s=128&d=identicon&r=PG&f=1", "display_name": "Ed Behn", "link": "https://stackoverflow.com/users/2765718/ed-behn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 200, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1526354356, "creation_date": 1525782690, "last_edit_date": 1525786846, "question_id": 50233718, "link": "https://stackoverflow.com/questions/50233718/haskell-shared-library-not-loading-properly", "title": "Haskell shared library not loading properly", "body": "<p>I'm working on a project that involves compiling and loading user-defined Haskell code. To that end, I want to be able to compile a Haskell module to a shared library (.so file). </p>\n\n<p>I compile the module with</p>\n\n<pre><code>ghc --make -dynamic -shared -fPIC Safe.hs -o libsafe.so\n</code></pre>\n\n<p>and my test program with</p>\n\n<pre><code>ghc --make -no-hs-main -optc-O test.c -o test\n</code></pre>\n\n<p>Both compile cleanly. However, when I run <code>test</code>, I get</p>\n\n<pre><code>/usr/lib64/ghc-8.0.2/ghc-prim-0.5.0.0/libHSghc-prim-0.5.0.0-ghc8.0.2.so: undefined symbol: stg_thawArrayzh\n</code></pre>\n\n<p>It seems like I'm not linking something somewhere, but shouldn't ghc handle all of that for me? I'm using ghc-8.0.2. </p>\n\n<p>The source code is </p>\n\n<p><code>Safe.hs</code> :</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Safe where\n\nimport Foreign.C.Types\n\nfibonacci :: Int -&gt; Int\nfibonacci n = fibs !! n\n    where fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n\nfibonacci_hs :: CInt -&gt; CInt\nfibonacci_hs = fromIntegral . fibonacci . fromIntegral\n\nforeign export ccall fibonacci_hs :: CInt -&gt; CInt\n</code></pre>\n\n<p><code>test.c</code>:</p>\n\n<pre><code>#include &lt;HsFFI.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;dlfcn.h&gt;\n\nint main(int argc, char *argv[])\n{\n    void* handle;\n\n    hs_init(&amp;argc, &amp;argv);\n\n    handle = dlopen(\"/home/ebehn/Desktop/libsafe.so\", RTLD_NOW);\n    if (!handle)\n    {\n        fprintf(stderr, \"%s\\n\", dlerror());\n        return 2;\n    }\n\n    hs_exit();\n    return 0;\n}\n</code></pre>\n\n<p>Running <code>ldd</code>:</p>\n\n<pre><code>[bash]&gt; ldd test\n    linux-vdso.so.1 (0x00007ffef8ff1000)\n    libgmp.so.10 =&gt; /lib64/libgmp.so.10 (0x00007ff046d0e000)\n    libm.so.6 =&gt; /lib64/libm.so.6 (0x00007ff0469c3000)\n    librt.so.1 =&gt; /lib64/librt.so.1 (0x00007ff0467bb000)\n    libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007ff0465b7000)\n    libffi.so.6 =&gt; /lib64/libffi.so.6 (0x00007ff0463af000)\n    libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007ff046191000)\n    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ff045ddb000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007ff046f86000)\n\n[bash]&gt; ldd libsafe.so \n    linux-vdso.so.1 (0x00007ffe44bf1000)\n    libHSbase-4.9.1.0-ghc8.0.2.so =&gt; /usr/lib64/ghc-8.0.2/base-4.9.1.0/libHSbase-4.9.1.0-ghc8.0.2.so (0x00007fc705d0c000)\n    libHSinteger-gmp-1.0.0.1-ghc8.0.2.so =&gt; /usr/lib64/ghc-8.0.2/integer-gmp-1.0.0.1/libHSinteger-gmp-1.0.0.1-ghc8.0.2.so (0x00007fc705ad6000)\n    libHSghc-prim-0.5.0.0-ghc8.0.2.so =&gt; /usr/lib64/ghc-8.0.2/ghc-prim-0.5.0.0/libHSghc-prim-0.5.0.0-ghc8.0.2.so (0x00007fc7056d4000)\n    libgmp.so.10 =&gt; /lib64/libgmp.so.10 (0x00007fc70545c000)\n    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fc7050a6000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fc706b41000)\n</code></pre>\n"}, {"tags": ["haskell", "maybe"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525772985, "post_id": 50230658, "comment_id": 87478587, "body": "There definitely are better ways to do this, but please make this an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we can actually see what it needs to do."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525773029, "post_id": 50230658, "comment_id": 87478607, "body": "This is typically a Maybe <i>monad</i>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525773107, "post_id": 50230658, "comment_id": 87478646, "body": "Shouldn&#39;t the last one be <code>sheets ^. sSheetId</code>?"}, {"owner": {"reputation": 63, "user_id": 9403534, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel D&#39;costa", "link": "https://stackoverflow.com/users/9403534/samuel-dcosta"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525773604, "post_id": 50230658, "comment_id": 87478982, "body": "@WillemVanOnsem no, its correct"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1525812279, "post_id": 50230658, "comment_id": 87501606, "body": "<code>fmap (_sProperties &gt;=&gt; \\props -&gt; _sTitle props &gt;&gt; _sSheetId props)</code> or something like it is probably what I would have written. Note that <code>_sTitle props &gt;&gt; ...</code> is a more specific instance of the useful idiom: <code>guard (somePredicate props) &gt;&gt; ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 8, "last_activity_date": 1525773832, "last_edit_date": 1525773832, "creation_date": 1525773479, "answer_id": 50230882, "question_id": 50230658, "link": "https://stackoverflow.com/questions/50230658/what-can-i-use-instead-of-case-of-to-reduce-the-code/50230882#50230882", "title": "what can i use instead of `case of` to reduce the code?", "body": "<p>The particular pattern</p>\n\n<pre><code>     case f foo of\n       Just bla -&gt; case g bla of\n          Just muh -&gt; h muh\n       Nothing -&gt; Nothing\n</code></pre>\n\n<p>is chararacteristic of the <em><code>Maybe</code> monad</em>. That instance is defined as</p>\n\n<pre><code>instance Monad Maybe where\n  return = Just\n  Nothing &gt;&gt;= _ = Nothing\n  Just x &gt;&gt;= f = f x\n</code></pre>\n\n<p>So you can rewrite the above <code>case</code> construction to</p>\n\n<pre><code>    f foo &gt;&gt;= \\bla -&gt; g bla &gt;&gt;= \\muh -&gt; h muh\n</code></pre>\n\n<p>which can be made more readable by either using <code>do</code> syntax</p>\n\n<pre><code>    do\n      bla &lt;- f foo\n      muh &lt;- g bla\n      h muh\n</code></pre>\n\n<p>or eta-reduction and the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Monad.html#v:-62--61--62-\" rel=\"noreferrer\">Kleisli-composition operator</a></p>\n\n<pre><code>     (f &gt;=&gt; g &gt;=&gt; h) foo\n</code></pre>\n\n<p>In your example, the latter is actually not possible because the innermost function doesn't use <code>sheets</code> but <code>sheetProperties</code> again, but <code>do</code> notation can still be used.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1525773668, "creation_date": 1525773668, "answer_id": 50230940, "question_id": 50230658, "link": "https://stackoverflow.com/questions/50230658/what-can-i-use-instead-of-case-of-to-reduce-the-code/50230940#50230940", "title": "what can i use instead of `case of` to reduce the code?", "body": "<p>What you here bascially show is the use of a <code>Maybe</code> <em>monad</em>, so we can write it like:</p>\n\n<pre><code>fmap (\\s -&gt; (s ^. sProperties) &gt;&gt;= \\sheetProperties -&gt; (sheetProperties ^. sTitle) &gt;&gt; (sheetProperties ^. sSheetId)) listOfSheets\n</code></pre>\n\n<p>Since a <code>Maybe</code> monad is defined as:</p>\n\n<blockquote>\n<pre><code>instance Monad Maybe where\n    return = Just\n    (&gt;&gt;=) Nothing _ = Nothing\n    (&gt;&gt;=) (Just x) f = f x\n</code></pre>\n</blockquote>\n\n<p>Or we can write it in do notation, although that is basically the same:</p>\n\n<pre><code>fmap f listOfSheets\n    where f eachSheet = do\n        sheetProperties &lt;- eachSheet ^. sProperties\n        sheets &lt;- sheetProperties ^. sTitle\n        sheetProperties ^. sSheetId\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 9403534, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel D&#39;costa", "link": "https://stackoverflow.com/users/9403534/samuel-dcosta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 50230940, "answer_count": 2, "score": 4, "last_activity_date": 1525777543, "creation_date": 1525772798, "last_edit_date": 1525777543, "question_id": 50230658, "link": "https://stackoverflow.com/questions/50230658/what-can-i-use-instead-of-case-of-to-reduce-the-code", "title": "what can i use instead of `case of` to reduce the code?", "body": "<pre><code>fmap ( \\eachSheet -&gt; case (eachSheet ^. sProperties) of\n  Just sheetProperties -&gt; case (sheetProperties ^. sTitle) of\n    Just sheets -&gt; (sheetProperties ^. sSheetId)    \n    Nothing -&gt; Nothing\n  Nothing -&gt; Nothing ) listOfSheets\n</code></pre>\n\n<p>any better way to this then case matching </p>\n"}, {"tags": ["haskell", "character-encoding", "text-processing"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1525771023, "post_id": 50229882, "comment_id": 87477357, "body": "Why though? Just read the text as it is, decode, process, and then re-encode. Keeping the text encoded in-process doesn&#39;t really buy you anything; If you&#39;re dealing with datasources with multiple different encodings and want to make sure you write the right one back just keep the original encoding around like <code>(DynEncoding, Text)</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1525771100, "post_id": 50229882, "comment_id": 87477402, "body": "I don&#39;t think this makes sense. Legacy encodings like GB-2312 should be purged entirely. All text should be Unicode, and how it&#39;s encoded internally is an implementation detail. (Arguably, it should <a href=\"http://utf8everywhere.org/\" rel=\"nofollow noreferrer\">always be Utf-8</a> which <code>Text</code> doesn&#39;t use but <a href=\"http://hackage.haskell.org/package/foundation-0.0.20/docs/Foundation-String.html\" rel=\"nofollow noreferrer\"><code>Foundation.String</code></a> does, but it doesn&#39;t really matter because the interface abstracts over this.) Everything else isn&#39;t text but <i>data</i>, for which there is <code>ByteString</code>."}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525771330, "post_id": 50229882, "comment_id": 87477540, "body": "@leftaroundabout It would be convenient if all text were Unicode, but the reality is that I still run into gb2312 encoded files all the time."}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1525771610, "post_id": 50229882, "comment_id": 87477744, "body": "@Cubic that&#39;s what I&#39;ve been doing. It just hasn&#39;t felt right that one type of text gets such preferential treatment over others."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525772009, "post_id": 50229882, "comment_id": 87477988, "body": "If you run into gb2312 files then the right thing to do is re-encode them. If you&#39;re not allowed to do that, pity, but then at least read them in as Unicode."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1525772770, "post_id": 50229882, "comment_id": 87478467, "body": "@martin Text encodings aren&#39;t a social group. There&#39;s no non-discrimination laws for them and there&#39;s no ethical reason for there to be any. Unicode and its associated encodings get preferential treatment because they&#39;re better than the alternatives."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1525778578, "post_id": 50229882, "comment_id": 87482040, "body": "@Cubic in fact, one might say Unicode itself is the embodiment of non-discrimination, and using any particular other encoding discriminates against languages that it doesn&#39;t cover."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1525782626, "post_id": 50229882, "comment_id": 87484720, "body": "This kind of fruitless debate is exactly why SO has rules against asking for library recommendations: when the library doesn&#39;t exist, everybody argues until they&#39;re blue in the face that you shouldn&#39;t want it (and will continue to do so right up to the moment that somebody sits down and writes a library, at which point the tune suddenly changes), and when the library does exist, recommendations go out of date because a new library that does the same thing is sure to come along eventually. I encourage future would-be commenters to vote to close and move on."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1525799543, "post_id": 50229882, "comment_id": 87495222, "body": "@martin &quot;It just hasn&#39;t felt right that one type of text gets such preferential treatment over others.&quot; That&#39;s the idea. The entire purpose of Unicode is to supersede all other encodings, so of course it&#39;s going to get preferential treatment."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1525799763, "post_id": 50229882, "comment_id": 87495354, "body": "Things would get really complicated really quickly if languages supported hundreds of internal encodings, because then every program anyone wrote would need to support all these different encodings. The best way to resolve this would be to have a single generic way to refer to characters regardless of the encoding, while you&#39;re working with the text. That &quot;generic interface&quot; is called Unicode."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1525880097, "post_id": 50229882, "comment_id": 87532121, "body": "Are you actually trying to process texts that contain characters not representable in Unicode?"}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "reply_to_user": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1525923291, "post_id": 50229882, "comment_id": 87548104, "body": "@bergey I&#39;ve updated my question."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1526040681, "post_id": 50229882, "comment_id": 87600292, "body": "Reading the updated question, I strongly suspect you have misunderstood something. Unicode <i>is not</i> an encoding. <code>String</code> <i>is not</i> specific to any encoding. If you have a function which consumes <code>String</code>s, that function will work on your codepoints, no matter which encoding you used to convert bytes into codepoints."}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526042696, "post_id": 50229882, "comment_id": 87601470, "body": "@DanielWagner I&#39;ve updated my question."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1526043567, "post_id": 50229882, "comment_id": 87602027, "body": "@martin You have misdiagnosed your problem. <code>String</code> is not specific to an encoding; but <code>readFile</code> <i>is</i>. So: you should either use GHC&#39;s mechanism for affecting what encoding <code>readFile</code> uses, or use <code>Data.ByteString.readFile</code> to read bytes and another package to convert the bytes to a <code>String</code>."}, {"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1526045284, "post_id": 50229882, "comment_id": 87603137, "body": "@DanielWagner Right, I guess what I meant to say there was that libraries that work with strings only work with unicode text. From what I&#39;ve been able to gather, it does indeed seem that the only option for working with non-unicode text at this point would be to convert it from a ByteString to unicode text as a String or Data.Text."}], "owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 303, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1526042627, "creation_date": 1525770235, "last_edit_date": 1526042627, "question_id": 50229882, "link": "https://stackoverflow.com/questions/50229882/working-with-non-unicode-text-in-haskell", "title": "Working with non-unicode text in Haskell", "body": "<p>I feel like there is a bit of a debate in the Haskell community about <code>String</code> vs <code>Data.Text</code>, but in my mind they both suffer from the same deficiency - namely that they don't represent all textual data, just Unicode text. </p>\n\n<p>The only project I've found that deals with character encodings is the aptly named <a href=\"https://hackage.haskell.org/package/encoding\" rel=\"nofollow noreferrer\">encoding</a> package, but it seems to only support conversion to/from Unicode, without providing any mechanisms for text processing in those encodings. </p>\n\n<p>Is there a project out there that is trying to get a new typeclass (<code>Textual</code>?) that different character encodings could be instances of, so that I could do text processing directly with UTF-8 just as easily as with, say GB-2312? </p>\n\n<hr>\n\n<p>As for @bergey's comment, it's not that I'm trying to work with characters that aren't part of Unicode. All of the non-Unicode files that I encounter typically use established legacy character sets that were included in Unicode. </p>\n\n<p>My issue is more with text functions that were designed to work with non-Unicode text. For example: </p>\n\n<ul>\n<li>Url percent encoding.</li>\n</ul>\n\n<p><a href=\"https://tools.ietf.org/html/rfc3986#section-2\" rel=\"nofollow noreferrer\">RFC 3986</a> allows percent-encoding and transmission of non-unicode character encodings, and in the real world, there are still people using GB2312/EUC-CN. When a Haskell library only offers unicode percent encoding (eg <code>Network.HTTP.urlEncode :: String -&gt; String</code>), it won't work for those apis.</p>\n\n<ul>\n<li>quoted-printable</li>\n</ul>\n\n<p>Similarly, <a href=\"https://tools.ietf.org/html/rfc2047#section-4.2\" rel=\"nofollow noreferrer\">quoted-printable</a> text should be able to represent non-unicode encodings, and I still come across these types of emails. The only library I've found to deal with quoted printable, <a href=\"https://hackage.haskell.org/package/mime-0.4.0.2/docs/Codec-MIME-Decode.html\" rel=\"nofollow noreferrer\"><code>Codec.MIME.Decode</code></a>, also works with Strings, which means it can't deal with these non-Unicode encodings. </p>\n\n<p>I'm certainly not trying to be critical here; I'm mainly interested in finding how to best add support for other types of textual data (and whether or not people are already working on it). In my mind, it would be great for functions like <code>urlEncode</code> to able to be written once and retain the type <code>String -&gt; String</code>, and be able to handle any type of text string and not just unicode without needing separate implementations for each possible type of text. </p>\n\n<hr>\n\n<p>As for @DanielWagner's comment:</p>\n\n<p><code>String</code> is absolutely specific to certain encodings. </p>\n\n<pre><code>[martin@localhost ~]$ echo -n '\u4e2d\u6587' &gt; utf8text\n[martin@localhost ~]$ iconv -f utf8 -t gb2312 utf8text &gt; gb2312text\n[martin@localhost ~]$ xxd gb2312text \n00000000: d6d0 cec4                                ....\n[martin@localhost ~]$ ghc -e 'readFile \"gb2312text\"'\n&lt;interactive&gt;: gb2312text: hGetContents: invalid argument (invalid byte sequence)\n</code></pre>\n\n<p>The <code>invalid byte sequence</code> exception is thrown because the String function is unable to convert these bytes into codepoints. </p>\n"}, {"tags": ["haskell", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "edited": false, "score": 0, "creation_date": 1525796901, "post_id": 50229692, "comment_id": 87493779, "body": "but the above code would separate the text by words. I want the text to be separated by paras. The output for the pastebin link I attached should return a length of 3."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 0, "last_activity_date": 1525769660, "creation_date": 1525769660, "answer_id": 50229692, "question_id": 50229205, "link": "https://stackoverflow.com/questions/50229205/haskell-attoparsec-does-not-recognize-newline-while-parsing-from-a-text-file/50229692#50229692", "title": "Haskell attoparsec does not recognize newline while parsing from a text file", "body": "<p>The problem is that <code>space</code> parser in the following line:</p>\n\n<pre><code>inputPara = Prose &lt;$&gt; many1' (letter &lt;|&gt; digit &lt;|&gt; space &lt;|&gt; satisfy (inClass specialChars) &lt;|&gt; satisfy (inClass \"\u2015\u2015.?!\") )\n</code></pre>\n\n<p>matches characters such as <code>\\n\\r\\t</code> (every char which is <code>isSpace</code>)</p>\n\n<p>That's why <code>inputPara</code> matches the whole text without separation.</p>\n\n<p>One of the solutions could be removing <code>space</code> parser from <code>inputPara</code> and add <code>' '</code> character into <code>specialChars</code></p>\n\n<p>For example, the following code should work, but certainly feel free to choose the option, which works best for you:</p>\n\n<pre><code>import Data.Attoparsec.Text\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as Txt\nimport Control.Applicative ((&lt;|&gt;))\n\nnewtype Prose = Prose {\n  word :: [Char]\n}\n\ninstance Show Prose where\n  show a = word a\n\noptional :: Parser a -&gt; Parser ()\noptional p = option () (try p *&gt; pure ())\n\nspecialChars = ['-', '_', '\u2026', '\u201c', '\u201d', '\\\"', '\\'', '\u2019', '@', '#', '$',\n                '%', '^', '&amp;', '*', '(', ')', '+', '=', '~', '`', '{', '}',\n                '[', ']', '/', ':', ';', ',', ' ']\n\ninputPara :: Parser Prose\ninputPara = Prose &lt;$&gt; many1' (letter &lt;|&gt; digit &lt;|&gt; satisfy (inClass specialChars) &lt;|&gt; satisfy (inClass \"\u2015\u2015.?!\") )\n\nparaSeparator :: Parser [Char]\nparaSeparator = many1 space\n\nparaParser :: String -&gt; [Prose]\nparaParser str = case parseOnly wp (T.pack str) of\n    Left err -&gt; error err\n    Right x -&gt; x\n    where\n      wp = optional paraSeparator *&gt; inputPara `sepBy1` paraSeparator\n\nmain :: IO()\nmain = do\n  input &lt;- readFile \"test.txt\"\n  let para = paraParser input\n  print para\n  print $ length para\n</code></pre>\n"}], "owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525769660, "creation_date": 1525768021, "last_edit_date": 1525768062, "question_id": 50229205, "link": "https://stackoverflow.com/questions/50229205/haskell-attoparsec-does-not-recognize-newline-while-parsing-from-a-text-file", "title": "Haskell attoparsec does not recognize newline while parsing from a text file", "body": "<p>I've been trying to parse a .txt file with some English text in it. My code tries to return back the number of paragraphs in that .txt file. For some reason, attoparsec can't seem recognize a newline or any other characters such as <code>\\n\\r\\t</code>. Below is my code. I've also tried using <code>many1 (satisfy (inClass \"\\n\\r\\t\"))</code>, but still no luck. What do you think the underlying problem is? Also here's the <a href=\"https://pastebin.com/Ai10vxPM\" rel=\"nofollow noreferrer\">link to the sample text file</a> I've been testing it on.</p>\n\n<pre><code>import Data.Attoparsec.Text\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as Txt\n\nnewtype Prose = Prose {\n  word :: [Char]\n}\n\ninstance Show Prose where\n  show a = word a\n\noptional :: Parser a -&gt; Parser ()\noptional p = option () (try p *&gt; pure ())\n\nspecialChars = ['-', '_', '\u2026', '\u201c', '\u201d', '\\\"', '\\'', '\u2019', '@', '#', '$',\n                '%', '^', '&amp;', '*', '(', ')', '+', '=', '~', '`', '{', '}',\n                '[', ']', '/', ':', ';', ',']\n\ninputPara :: Parser Prose\ninputPara = Prose &lt;$&gt; many1' (letter &lt;|&gt; digit &lt;|&gt; space &lt;|&gt; satisfy (inClass specialChars) &lt;|&gt; satisfy (inClass \"\u2015\u2015.?!\") )\n\nparaSeparator :: Parser ()\nparaSeparator = many1 (satisfy (isEndOfLine) &lt;|&gt; satisfy (isHorizontalSpace)) &gt;&gt; pure ()\n\nparaParser :: String -&gt; [Prose]\nparaParser str = case parseOnly wp (T.pack str) of\n    Left err -&gt; error err\n    Right x -&gt; x\n    where\n      wp = optional paraSeparator *&gt; inputPara `sepBy1` paraSeparator\n\nmain :: IO()\nmain = do\n  input &lt;- readFile \"test.txt\"\n  let para = paraParser input\n  print para\n  print $ length para\n</code></pre>\n"}, {"tags": ["sockets", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 2, "last_activity_date": 1525760874, "creation_date": 1525760874, "answer_id": 50227240, "question_id": 50227072, "link": "https://stackoverflow.com/questions/50227072/how-to-extract-portnumber-from-socket/50227240#50227240", "title": "How to extract PortNumber from socket?", "body": "<p>It seems that you've skipped one step (binding socket to an address):</p>\n\n<pre><code>bind sock (addrAddress addr)\n</code></pre>\n\n<p>Unbound socket returns <code>0.0.0.0:0</code>, that's why you always receive <code>0</code> as a result of <code>socketPort sock</code></p>\n"}], "owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 50227240, "answer_count": 1, "score": 0, "last_activity_date": 1525760874, "creation_date": 1525760297, "question_id": 50227072, "link": "https://stackoverflow.com/questions/50227072/how-to-extract-portnumber-from-socket", "title": "How to extract PortNumber from socket?", "body": "<p>I am trying to extract Port Number from socket using this code </p>\n\n<pre><code>import           Network.Socket\n\nlet hints = defaultHints { addrSocketType = Stream }\naddr:_ &lt;- getAddrInfo (Just hints) (Just \"127.0.0.1\") (Just \"3000\")\nsock &lt;- socket (addrFamily addr) (addrSocketType addr) (addrProtocol addr)\nsocketPort  sock\n</code></pre>\n\n<p>but <code>socketPort  sock</code> always return 0 , why it returns 0?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1525758707, "post_id": 50222098, "comment_id": 87470636, "body": "There is the class <code>Foldable1</code> from <a href=\"https://hackage.haskell.org/package/semigroupoids-5.2.2/docs/Data-Semigroup-Foldable-Class.html\" rel=\"nofollow noreferrer\">semigroupoids</a> that seems like it might be what you want."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1525891043, "post_id": 50222098, "comment_id": 87537919, "body": "Somewhat related: <a href=\"https://www.stackage.org/haddock/lts-11.8/lens-4.16.1/Control-Lens-Internal-Fold.html#v:NoMax\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-11.8/lens-4.16.1/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1525797950, "last_edit_date": 1525797950, "creation_date": 1525726759, "answer_id": 50222338, "question_id": 50222098, "link": "https://stackoverflow.com/questions/50222098/is-there-bounded-maybe-a-for-un-bounded-a/50222338#50222338", "title": "Is there Bounded (Maybe a) for un-Bounded a?", "body": "<p>The monoid-extras package offers <a href=\"http://hackage.haskell.org/package/monoid-extras-0.4.4/docs/Data-Monoid-Inf.html\" rel=\"nofollow noreferrer\">Data.Monoid.Inf</a> for one-sided bounds. The extended-reals package offers <a href=\"http://hackage.haskell.org/package/extended-reals-0.2.3.0/docs/Data-ExtendedReal.html\" rel=\"nofollow noreferrer\">Data.ExtendedReal</a>, which is sometimes more convenient if you want to add both bounds in one shot without privileging one or the other's <code>Monoid</code> instance or want a fresh <code>Bounded</code> instance that doesn't rely on the underlying type being <code>Bounded</code>.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 50222338, "answer_count": 1, "score": 6, "last_activity_date": 1525797950, "creation_date": 1525725643, "last_edit_date": 1525728043, "question_id": 50222098, "link": "https://stackoverflow.com/questions/50222098/is-there-bounded-maybe-a-for-un-bounded-a", "title": "Is there Bounded (Maybe a) for un-Bounded a?", "body": "<p>I have a <code>Foldable</code> of <code>Integer</code>s which are unbounded and thus I cannot apply a <code>Max</code> fold to it.</p>\n\n<p>Would it make sense to define <code>Max</code> instance of <code>Nothing</code> when a value does not exist? There is <code>Ord a =&gt; Semigroup (Max a)</code> but I cannot find <code>Max</code> instance for <code>(Ord a) =&gt; Option a</code>.</p>\n\n<p>See <a href=\"https://www.stackage.org/haddock/lts-11.7/reducers-3.12.2/src/Data.Semigroup.Reducer.html#foldReduce\" rel=\"nofollow noreferrer\">foldReduce</a> for more context.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1525724933, "post_id": 50221935, "comment_id": 87461316, "body": "<code>IORef</code> is not a monad."}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1525724995, "post_id": 50221935, "comment_id": 87461343, "body": "it shows you I am a noob :-)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1525726028, "post_id": 50222150, "comment_id": 87461765, "body": "Why not factor out the model change from the <code>IORef</code> business? The latter is something like <code>modifyIORef&#39;</code>."}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1525727850, "post_id": 50222150, "comment_id": 87462614, "body": "Thank you very much. I have learned new things about Haskell today."}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1526808483, "post_id": 50222150, "comment_id": 87881033, "body": "Using modifyIORef&#39; can lead to problems in some circumstances <a href=\"https://stackoverflow.com/questions/50320430/why-my-haskell-game-sometimes-responds-differently-to-the-same-arguments\" title=\"why my haskell game sometimes responds differently to the same arguments\">stackoverflow.com/questions/50320430/&hellip;</a>"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "reply_to_user": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1526808846, "post_id": 50222150, "comment_id": 87881109, "body": "@ruby_object This is a semantically equivalent refactoring of your original code (asides from being strict in the new model) - it didn&#39;t sound like multithreading was a consideration from your original question."}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": true, "score": 4, "last_activity_date": 1525726658, "last_edit_date": 1525726658, "creation_date": 1525725822, "answer_id": 50222150, "question_id": 50221935, "link": "https://stackoverflow.com/questions/50221935/how-do-i-correctly-update-a-haskell-records-held-in-data-ioref/50222150#50222150", "title": "How do I correctly update a Haskell records held in Data.IORef?", "body": "<p>This might be a simpler refactoring. Note that <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-IORef.html#v:modifyIORef-39-\" rel=\"nofollow noreferrer\"><code>modifyIORef'</code></a> combines <code>readIORef</code> and <code>writeIORef</code> into a single strict operation:</p>\n\n<pre><code>ifNoneThen :: Heading -&gt; Heading -&gt; Heading\nNone `ifNoneThen` x = x\nh    `ifNoneThen` _ = h\n\nupdateModel :: Int -&gt; Model -&gt; Model\nupdateModel kv oldModel = Model newKv newHeading\n    where newKv      = fromIntegral kv\n          newHeading = keyToHeading newKv `ifNoneThen` heading oldModel\n\nfoo :: Int -&gt; Model -&gt; IO ()\nfoo kv globalModel = modifyIORef' globalModel (updateModel kv)\n</code></pre>\n\n<ul>\n<li>A small utility function for <code>Header</code>s, <code>ifNoneThen</code> (that you might be able to use elsewhere as well) cleans up the <code>if</code> statement in the body of the code.</li>\n<li>Some minor refactoring to remove duplicated calls (why call <code>fromIntegral kv</code>  3 times if you can call it once and give the result a meaningful name?).</li>\n<li>Factoring the pure code (construction of the new model from an old model) out of the impure code (updating the <code>IORef</code>) makes it easier to reason about the code - there's fewer places for unexpected side-effects to crop up.</li>\n</ul>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 50222150, "answer_count": 1, "score": 3, "last_activity_date": 1526808900, "creation_date": 1525724878, "last_edit_date": 1526808900, "question_id": 50221935, "link": "https://stackoverflow.com/questions/50221935/how-do-i-correctly-update-a-haskell-records-held-in-data-ioref", "title": "How do I correctly update a Haskell records held in Data.IORef?", "body": "<p>I have <a href=\"https://github.com/bigos/cairo-example/blob/4945d174df7ac1b1cf947f6eb9a38c9c45973dd2/src/Main.hs\" rel=\"nofollow noreferrer\">this simple project</a> where I tried to experiment with Haskell and Cairo library.</p>\n\n<p>I ran into a problem with redrawing the state of the application. At the moment  I have the record that holds global state. I had to store it in <code>Data.IORef</code> monad in order to be able to pass the data from one GUI event to another.</p>\n\n<p>I was inspired by Elm to try it like that, but I wonder if there is better way to do it?</p>\n\n<p>I'm particularly concerned about this fragment in main function.</p>\n\n<pre><code>-- update globalModel in place\nreadIORef globalModel &gt;&gt;= (\\m -&gt; writeIORef globalModel (Model\n                                                         (fromIntegral kv)\n                                                         (if ((keyToHeading (fromIntegral kv)) == None)\n                                                           then (heading m)\n                                                           else (keyToHeading (fromIntegral kv)))))\n</code></pre>\n\n<p>Please advice of better approach.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1525763202, "post_id": 50220957, "comment_id": 87472763, "body": "Is this because leaving out the <code>forall</code> will implicitly place it as <code>apm :: Applicative f =&gt; forall f. Ap f (Max Int)</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 2, "creation_date": 1525782203, "post_id": 50220957, "comment_id": 87484446, "body": "@SimonShine No, there is no sensible rationale like that. It&#39;s just an arbitrary rule set in place to distinguish between variables that should be bound in the definition associated with that declaration and variables that shouldn&#39;t be bound. Many people even think the rule is backwards (variables should be bound by default and left unbound if they are explicitly universally quantified); the existing rule was chosen to be the opposite of that just so that turning on the extension would not change the meaning of any existing code, not for any deep theoretical reason."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1525720397, "creation_date": 1525720397, "answer_id": 50220957, "question_id": 50220843, "link": "https://stackoverflow.com/questions/50220843/could-not-deduce-applicative-f0-when-applicative-f-is-given/50220957#50220957", "title": "Could not deduce (Applicative f0) when Applicative f is given", "body": "<p>The standard solution is to use <code>ScopedTypeVariables</code> to announce that the <code>f</code> in the signature for <code>apm</code> and the <code>f</code> you want <code>pure</code> to produce are the same <code>f</code>. So:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.Semigroup.Applicative\nimport Data.Semigroup.Reducer\nimport Data.Semigroup\n\napm :: forall f. Applicative f =&gt; Ap f (Max Int)\napm = unit (pure 2 :: f Int)\n</code></pre>\n\n<p>Don't lose the <code>forall</code>; it's a requirement of the extension to bring <code>f</code> into scope in the definition's body.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 50220957, "answer_count": 1, "score": 2, "last_activity_date": 1525720397, "creation_date": 1525719875, "question_id": 50220843, "link": "https://stackoverflow.com/questions/50220843/could-not-deduce-applicative-f0-when-applicative-f-is-given", "title": "Could not deduce (Applicative f0) when Applicative f is given", "body": "<p>I'm having trouble understanding why there are two independent <code>f</code> and <code>f0</code> Applicative constraints in code below (requires <code>reducers</code> package).</p>\n\n<pre><code>import Data.Semigroup.Applicative\nimport Data.Semigroup.Reducer\nimport Data.Semigroup\n\n-- | Foo\n--\n-- &gt;&gt;&gt; getMax $ foo [\"abc\",\"a\",\"hello\",\"\"]\n-- 5\nfoo :: [String] -&gt; (Max Int)\nfoo = foldReduce . map (length)\n\nbar :: (Foldable f, Monoid m, Reducer e m) =&gt; f e -&gt; m\nbar = foldReduce\n\nm :: Max Int\nm = unit (2 :: Int)\n\napm :: (Applicative f) =&gt; Ap f (Max Int)\napm = unit $ pure (2 :: Int) -- ambiguous Applicative!\n</code></pre>\n\n<p>I think that I need to somehow tell that I want <code>f0 ~ f</code> where <code>f0</code> is independently inferred by use of <code>pure</code>. </p>\n\n<p>I tried to simplify:</p>\n\n<pre><code>u :: (Applicative f, Monoid m) =&gt; e -&gt; Ap f m\nu = undefined \n\nm :: (Applicative f) =&gt; Ap f (Max Int)\nm = u $ (pure (2 :: Int))\n</code></pre>\n\n<p>It will compile once <code>e</code> is changed to <code>f e</code> so that contexts can \"unify\". But I don't know how to unify <a href=\"http://hackage.haskell.org/package/reducers-3.12.2/docs/Data-Semigroup-Reducer.html#t:Reducer\" rel=\"nofollow noreferrer\">with reducer</a> context.</p>\n\n<p>My goal is to foldReduce with Applicative Semigroup (if that's possible at all) so that <code>length</code> will be replaced with effectful version.</p>\n"}, {"tags": ["haskell", "functional-programming", "list-comprehension"], "comments": [{"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1527018809, "post_id": 50220695, "comment_id": 87964460, "body": "Your second list compression is much more efficient than most. Its output is a very short list.-- Separate the + &amp; - in the very short list with [(a,b,c) |(a,b,c)&lt;-lc1, c==a+b]++ [(a,b,c) |(a,b,c)&lt;-lc1, c==a-b] where lc1 is the output of your fast list compression. OR simpler  <code>partition (\\(a,b,c) -&gt; c == a+b) lc1</code>produces both lists in a tuple.\u2013 fp_mora 22 hours ag"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1527113781, "post_id": 50220695, "comment_id": 88009338, "body": "Also, it is superfluous to select values from <code>y</code> when you can just set them. The results are the same. <code>let xs = [1..4] in     [(a,b,c) | a &lt;- xs, b &lt;- xs, c &lt;- [(a-b),(a+b)], even c]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "edited": false, "score": 0, "creation_date": 1525719656, "post_id": 50220729, "comment_id": 87458767, "body": "Thank you this is perfect! I wasn&#39;t aware you could use a function as a generator in a list comprehension."}, {"owner": {"reputation": 452, "user_id": 3531310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c879bfa7b230a3b1a3f96fd3cb830e?s=128&d=identicon&r=PG&f=1", "display_name": "jaroslawj", "link": "https://stackoverflow.com/users/3531310/jaroslawj"}, "edited": false, "score": 0, "creation_date": 1525719760, "post_id": 50220729, "comment_id": 87458827, "body": "@chi Just out of curiosity, how have you measured ~200x speed up?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "edited": false, "score": 2, "creation_date": 1525719762, "post_id": 50220729, "comment_id": 87458829, "body": "@Marcel Of course, even if you couldn&#39;t use a function, you could still achieve the same effect with normal data; e.g. <code>[(a,b,c) | useAddition &lt;- [False, True], ..., c == if useAddition then a + b else a - b]</code>. The real insight here is to put the things you want to vary slowest as the first generators."}, {"owner": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "edited": false, "score": 0, "creation_date": 1525720100, "post_id": 50220729, "comment_id": 87459000, "body": "Ok thats nice to know, too. This will definitely help me at some point. Thanks again!"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 452, "user_id": 3531310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c879bfa7b230a3b1a3f96fd3cb830e?s=128&d=identicon&r=PG&f=1", "display_name": "jaroslawj", "link": "https://stackoverflow.com/users/3531310/jaroslawj"}, "edited": false, "score": 2, "creation_date": 1525720318, "post_id": 50220729, "comment_id": 87459117, "body": "@jaroslawj Doesn&#39;t look measured, just estimated: it does 200 fewer evenness checks and comparisons for every combination of f, a and b."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 452, "user_id": 3531310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c879bfa7b230a3b1a3f96fd3cb830e?s=128&d=identicon&r=PG&f=1", "display_name": "jaroslawj", "link": "https://stackoverflow.com/users/3531310/jaroslawj"}, "edited": false, "score": 0, "creation_date": 1525723821, "post_id": 50220729, "comment_id": 87460821, "body": "@jaroslawj It is indeed an estimate: the original code tries all values <code>c</code> in <code>[-100..100]</code> and then checks if  <code>c == f a b</code>. Testing only <i>one</i> value for <code>c</code>, instead of 200, should be much faster (even if maybe not 200x faster)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "edited": false, "score": 0, "creation_date": 1525724046, "post_id": 50220729, "comment_id": 87460931, "body": "@Marcel Remember that, in a functional language, functions are &quot;first-class&quot; value, like integers, lists, pairs, etc. Variables can be bound to any value, including functions."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1525719323, "creation_date": 1525719323, "answer_id": 50220729, "question_id": 50220695, "link": "https://stackoverflow.com/questions/50220695/haskell-list-comprehension-order-elements-tuples/50220729#50220729", "title": "Haskell List Comprehension order elements/tuples", "body": "<p>Choose between functions <code>(+),(-)</code> in the first generator.</p>\n\n<pre><code>listComprehension =\n   [(a,b,c) | f &lt;- [(+),(-)], a &lt;- xs, b &lt;- xs, c &lt;- ys, even c, c == f a b ]\n   where xs = [1..4]; ys = [(-100)..100]\n</code></pre>\n\n<p>By the way, this is an inefficient approach. Instead of trying every <code>c &lt;- ys</code>, we should instead <code>let c = f a b</code> and then check whether <code>-100 &lt;= c &amp;&amp; c &lt;= 100</code> (and evenness). We make the code ~200 times faster, in this way.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1527114262, "last_edit_date": 1527114262, "creation_date": 1525820484, "answer_id": 50243338, "question_id": 50220695, "link": "https://stackoverflow.com/questions/50220695/haskell-list-comprehension-order-elements-tuples/50243338#50243338", "title": "Haskell List Comprehension order elements/tuples", "body": "<p>I have used alternate functions ([even,odd]) in list comprehensions before. I was not always satisfied that they were most efficient. The drawback, I saw, was that they would make two or more passes through the source list. For this, I opted for a different approach, though, efficiency is not much of a consideration with smaller sets of data. </p>\n\n<p>This is what I wrote</p>\n\n<pre><code>lc xs ys = [[(a,b,c)|(a,b,c)&lt;-ls,c==a+b] ++ [(a,b,c)|(a,b,c)&lt;-ls,c==a-b]]\n           where ls = [(a,b,c)| a&lt;-xs, b&lt;-xs, c&lt;-ys, even c]\n</code></pre>\n\n<p>This was faster than your original function and faster than the other answer. What was more striking is that it used much less memory than either.</p>\n\n<p>It is one thing to select values from a long list and another to just set them from generated values. </p>\n\n<pre><code>lc xs = [(a,b,c)|a&lt;-xs,b&lt;-xs,c&lt;-[(a-b),(a+b)],even c]\npartition (\\(a,b,c) -&gt; c == a+b) lc [1..4]\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 8930201, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208507500359909/picture?type=large", "display_name": "Marcel", "link": "https://stackoverflow.com/users/8930201/marcel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 0, "accepted_answer_id": 50220729, "answer_count": 2, "score": 2, "last_activity_date": 1527114262, "creation_date": 1525719109, "last_edit_date": 1525719411, "question_id": 50220695, "link": "https://stackoverflow.com/questions/50220695/haskell-list-comprehension-order-elements-tuples", "title": "Haskell List Comprehension order elements/tuples", "body": "<p>I'm currently learning Haskell and am an absolute beginner when it comes to FP.</p>\n\n<p>Right now I'm trying different stuff with list comprehensions.</p>\n\n<pre><code> listComprehension  = [(a,b,c) | a &lt;- xs, b &lt;- xs, c &lt;- ys, even c, c == a+b] ++\n                      [(a,b,c) | a &lt;- xs, b &lt;- xs, c &lt;- ys, even c, c == a-b]\n                      where xs = [1..4]; ys = [(-100)..100]\n</code></pre>\n\n<p>So why not say:</p>\n\n<pre><code> listComprehension  = [(a,b,c) | a &lt;- xs, b &lt;- xs, c &lt;- ys, even c, c == a+b || c == a-b]\n                      where xs = [1..4]; ys = [(-100)..100]\n</code></pre>\n\n<p>?</p>\n\n<p>I want the elements to be ordered exactly like my first example.\nI want all elements where c = a+b and then all elements where c = a-b.</p>\n\n<p>Notice that in my 2nd code the order is not what I would like to have. I can't seem to figure out how I order things in a list comprehension, specially when I have tuples..</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["json", "parsing", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 0, "creation_date": 1525712462, "post_id": 50219127, "comment_id": 87455208, "body": "I&#39;m voting to close this question as off-topic because it would belong better on The Code Review SE <a href=\"https://codereview.stackexchange.com\">codereview.stackexchange.com</a>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1525712479, "post_id": 50219127, "comment_id": 87455218, "body": "Well usually people do not write tokenizers themselve: they use what is known as <i>compiler compilers</i>, programs that turn a list of regexes or a context free grammar into a lexer/parser."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 1, "creation_date": 1525712535, "post_id": 50219127, "comment_id": 87455249, "body": "@EliSadoff: although I agree, there is only a very limited number of Haskell programmers active on cr.SE, so usually people do not get much help there."}, {"owner": {"reputation": 7441, "user_id": 1575353, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rvz3i.png?s=128&g=1", "display_name": "S\u1d00\u1d0d On\u1d07\u1d0c\u1d00", "link": "https://stackoverflow.com/users/1575353/s%e1%b4%80%e1%b4%8d-on%e1%b4%87%e1%b4%8c%e1%b4%80"}, "reply_to_user": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "edited": false, "score": 1, "creation_date": 1525712575, "post_id": 50219127, "comment_id": 87455284, "body": "@EliSadoff It is okay to recommend the OP post on CR but in the future, please don&#39;t use Code Review as a reason to close a question. Evaluate the request and use a reason like <i>too broad</i>, <i>primarily opinion-based</i>, etc. Then you can mention to the OP that it can be posted on Code Review if it is <a href=\"https://codereview.stackexchange.com/help/on-topic\">on-topic</a>. Please see the section <b>What you should not do</b> in <a href=\"https://codereview.meta.stackexchange.com/a/5778/120114\">this answer to <i>A guide to Code Review for Stack Overflow users</i></a>"}, {"owner": {"reputation": 6596, "user_id": 5021321, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f10a1b457e63d44e3a221e89e32c17?s=128&d=identicon&r=PG", "display_name": "Eli Sadoff", "link": "https://stackoverflow.com/users/5021321/eli-sadoff"}, "reply_to_user": {"reputation": 7441, "user_id": 1575353, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rvz3i.png?s=128&g=1", "display_name": "S\u1d00\u1d0d On\u1d07\u1d0c\u1d00", "link": "https://stackoverflow.com/users/1575353/s%e1%b4%80%e1%b4%8d-on%e1%b4%87%e1%b4%8c%e1%b4%80"}, "edited": false, "score": 0, "creation_date": 1525712739, "post_id": 50219127, "comment_id": 87455377, "body": "@SamOnela Thank you. Sorry I hadn&#39;t seen that post before."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1525716345, "post_id": 50219127, "comment_id": 87457090, "body": "FWIW, I think this is a fine, on-topic question, with a clear answer. There are (just) two idiomatic Haskell solutions: parser combinators (which by and large share the bulk of their API -- enough that I could write some code for the two parser chunks mentioned above in a pretty much library-agnostic way) and parser generators. I&#39;d love to write this answer, except that I&#39;ve never used parser generators, and don&#39;t feel qualified to write that half of the answer. If somebody will volunteer to do that half, I&#39;ll happily start (or contribute to) a community wiki answer on the combinator half."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1525716996, "post_id": 50219127, "comment_id": 87457424, "body": "@WillemVanOnsem With all due respect, whether there are Haskell answerers on CodeReview has no bearing at all on whether the question is on-topic here. I do think it&#39;s on-topic here; but that&#39;s because I think it is about a specific programming problem that Haskell experts can agree on the answer to, not because there&#39;s some other site elsewhere that it wouldn&#39;t get answered on. (And Sam Onela has already represented the obvious analog of this discussion in the other direction: just because the question would fit well on CodeReview has absolutely no bearing on whether it&#39;s off-topic here.)"}, {"owner": {"reputation": 148, "user_id": 5323434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33d6d9d66a9297522d7fd07d9e249243?s=128&d=identicon&r=PG&f=1", "display_name": "FrozenHawk", "link": "https://stackoverflow.com/users/5323434/frozenhawk"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1525811760, "post_id": 50219127, "comment_id": 87501394, "body": "@DanielWagner Thanks for mentioning the parser combinators, and parser generators. Even without giving any example code it gives me a place to look to see how this could be tackled in a more functional way."}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": true, "score": 2, "last_activity_date": 1525934663, "creation_date": 1525934663, "answer_id": 50267081, "question_id": 50219127, "link": "https://stackoverflow.com/questions/50219127/haskell-json-parser-improvements/50267081#50267081", "title": "Haskell JSON Parser Improvements", "body": "<p>I would try a parser combinator. This is a good place to start: <a href=\"http://dev.stephendiehl.com/fun/002_parsers.html\" rel=\"nofollow noreferrer\">Write You a Haskell: Parsing by Stephen Diehl</a>. It gives you a simple example of what a parser combinator looks like. Then I would look at the available parser combinators like <code>parsec</code>, <code>attoparsec</code> and <code>trifecta</code>. I personally like <code>attoparsec</code>, but <code>trifecta</code> has a lot more features.</p>\n\n<p>I've also written a small tutorial on <code>attoparsec</code>. It isn't complete but it should help you get started.</p>\n\n<ul>\n<li><a href=\"http://mchaver.com/posts/2016-05-09-attoparsec-tutorial-1.html\" rel=\"nofollow noreferrer\">Attoparsec Tutorial Part 1 - Parser Combinators and Test Driven Parsing</a></li>\n<li><a href=\"http://mchaver.com/posts/2016-05-09-attoparsec-tutorial-2.html\" rel=\"nofollow noreferrer\">Attoparsec Tutorial Part 2 - Parse and Return Values</a></li>\n<li><a href=\"http://mchaver.com/posts/2016-05-10-attoparsec-tutorial-3.html\" rel=\"nofollow noreferrer\">Attoparsec Tutorial Part 3 - Parse Data in Variable Order</a></li>\n</ul>\n"}], "owner": {"reputation": 148, "user_id": 5323434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33d6d9d66a9297522d7fd07d9e249243?s=128&d=identicon&r=PG&f=1", "display_name": "FrozenHawk", "link": "https://stackoverflow.com/users/5323434/frozenhawk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 50267081, "answer_count": 1, "score": 1, "last_activity_date": 1525934663, "creation_date": 1525712348, "question_id": 50219127, "link": "https://stackoverflow.com/questions/50219127/haskell-json-parser-improvements", "title": "Haskell JSON Parser Improvements", "body": "<p>For one of my courses last semester we were tasked with implementing a JSON parser that spits out formatted HTML. I ended up implementing it in what I felt was more of an iterative fashion than a functional one. Here's the main code snippet I have issues with:</p>\n\n<pre><code>stringToTokens (x:xs)\n            .....\n            | x == '\\\"' = StringLiteral (parseStringToken xs) : stringToTokens (advancePastString xs)\n            | startsNumeric x = Numeric (processNumeric (x:xs) takeWhile) : stringToTokens (processNumeric xs dropWhile)\n            | startsKeyword x = Keyword (processKeyword (x:xs) take) : stringToTokens (processKeyword (x:xs) drop)\n            .....\n            | otherwise = stringToTokens xs\n\n....\nadvancePastString :: String -&gt; String\nadvancePastString (x:xs)\n            | x == '\\\"' = xs\n            | x == '\\\\' = advancePastString (tail xs)\n            | otherwise = advancePastString xs\n</code></pre>\n\n<p>My issue with how I went about handling this is that it feels as if I've taken how I would implement it in a procedural language and just replaced the loop with recursion and drop functions. While this does work I'm wondering what would be a more idiomatic functional way of handling this.</p>\n"}, {"tags": ["list", "haskell", "matrix", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1525700853, "post_id": 50215817, "comment_id": 87448305, "body": "Let us forget about Haskell for one moment. How would you rotate the matrix yourself (for example in pseudo-code)?"}, {"owner": {"reputation": 29, "user_id": 9753170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cDBvLpNLY78/AAAAAAAAAAI/AAAAAAAAAPA/cgLPb4G5JNY/photo.jpg?sz=128", "display_name": "xorvralin2", "link": "https://stackoverflow.com/users/9753170/xorvralin2"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525700929, "post_id": 50215817, "comment_id": 87448355, "body": "Probably by some combination of reverseing and transposing the matrices. But I can&#39;t figure out which orders of these give the correct results."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1525701678, "post_id": 50215817, "comment_id": 87448862, "body": "Hint: first do some experiments with rotating a 2D matrix: for example a 3x3, then aim to generalize it to an nxn."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1525706339, "post_id": 50215817, "comment_id": 87451892, "body": "<a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:transpose\" rel=\"nofollow noreferrer\"><code>transpose</code></a> might come in handy."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525713517, "post_id": 50215817, "comment_id": 87455769, "body": "I assume all the lists have the same length? So this is a list of N lists, each of which is a list of N lists each of which is a list of N characters?"}, {"owner": {"reputation": 29, "user_id": 9753170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cDBvLpNLY78/AAAAAAAAAAI/AAAAAAAAAPA/cgLPb4G5JNY/photo.jpg?sz=128", "display_name": "xorvralin2", "link": "https://stackoverflow.com/users/9753170/xorvralin2"}, "edited": false, "score": 1, "creation_date": 1525716442, "post_id": 50215817, "comment_id": 87457137, "body": "Nope, they don&#39;t have to be bounded by a square. For example <code>[[&quot;CCC&quot;, &quot; C &quot;]]</code>. Of course i could  always pad them out if necessary"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525724039, "post_id": 50220884, "comment_id": 87460928, "body": "Your list comprehensions are really all just <code>map</code>. Rotating an even number of times about an axis can probably be optimized to skip the <code>transpose</code>. Bonus challenge: optimize sequences of rotations about arbitrary axes, assuming all the lists in the same direction have the same length (m * n * o)."}], "tags": [], "owner": {"reputation": 29, "user_id": 9753170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cDBvLpNLY78/AAAAAAAAAAI/AAAAAAAAAPA/cgLPb4G5JNY/photo.jpg?sz=128", "display_name": "xorvralin2", "link": "https://stackoverflow.com/users/9753170/xorvralin2"}, "is_accepted": true, "score": 2, "last_activity_date": 1525720054, "creation_date": 1525720054, "answer_id": 50220884, "question_id": 50215817, "link": "https://stackoverflow.com/questions/50215817/having-trouble-rotating-a-3-dimensional-list-of-chars-in-haskell/50220884#50220884", "title": "Having trouble rotating a 3-dimensional list of chars in Haskell", "body": "<p>Well, i solved myself:</p>\n\n<pre><code>rotate2dArr :: [[Char]] -&gt; Int -&gt; [[Char]]                                                                                                                                                              \nrotate2dArr arr 0 = arr\nrotate2dArr arr r = rotate2dArr (transpose $ [reverse row | row &lt;- arr]) (r-1)\n\nrotateX :: [[[Char]]] -&gt; Int -&gt; [[[Char]]]\nrotateX arr 0 = arr\nrotateX arr r = rotateX (transpose $ [reverse plane| plane &lt;- arr]) (r-1) \n\nrotateY :: [[[Char]]] -&gt; Int -&gt; [[[Char]]]\nrotateY arr 0 = arr\nrotateY arr r = rotateY (rotateX (rotateZ (rotateX arr 1) 1) 3) (r - 1)\n\nrotateZ :: [[[Char]]] -&gt; Int -&gt; [[[Char]]]\nrotateZ arr r = [rotate2dArr plane r | plane &lt;- arr]\n\nrotate3dArr :: [[[Char]]] -&gt; Char -&gt; Int -&gt; [[[Char]]]\nrotate3dArr arr axis r = case axis of \n        'x' -&gt; rotateX arr r -- Rotates cube on x axis backwards \n        'y' -&gt; rotateY arr r -- Rotates cube clockwise as seen from above\n        'z' -&gt; rotateZ arr r\n</code></pre>\n\n<p>It might not be all that pretty but it works</p>\n"}], "owner": {"reputation": 29, "user_id": 9753170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cDBvLpNLY78/AAAAAAAAAAI/AAAAAAAAAPA/cgLPb4G5JNY/photo.jpg?sz=128", "display_name": "xorvralin2", "link": "https://stackoverflow.com/users/9753170/xorvralin2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 50220884, "answer_count": 1, "score": 0, "last_activity_date": 1525720054, "creation_date": 1525700774, "last_edit_date": 1525700824, "question_id": 50215817, "link": "https://stackoverflow.com/questions/50215817/having-trouble-rotating-a-3-dimensional-list-of-chars-in-haskell", "title": "Having trouble rotating a 3-dimensional list of chars in Haskell", "body": "<p>I'm relatively new to Haskell and functional programming but right now I'm working on a project where I attempt to solve 3D-cube puzzles.</p>\n\n<p>I have the following 3-Dimensional list where <code>' '</code> represent empty space and <code>'C'</code> represents a part of the structure:</p>\n\n<pre><code>myShape = [[\"CC\", \" C\"], [\" C\", \"  \"]]\n</code></pre>\n\n<p>I want to be able to rotate this structure along all three axises to try it in different positions. I know that I can rotate it along one axis by independently rotating every 2D-layer.</p>\n\n<p>My question is: How can I rotate along the other axises without hard-coding the rotations?</p>\n"}, {"tags": ["haskell", "bytestring", "http-conduit"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 1, "last_activity_date": 1525698463, "creation_date": 1525698463, "answer_id": 50215010, "question_id": 50214641, "link": "https://stackoverflow.com/questions/50214641/log-all-requests-and-responses-for-http-conduit/50215010#50215010", "title": "Log all requests and responses for http-conduit", "body": "<p><code>managerModifyResponse</code> doesn't work with a <code>Response ByteString</code>, it works with a <code>Response BodyReader</code>, where <code>type BodyReader = IO ByteString</code> along with the contract that if it produces a non-empty <code>ByteString</code> there is more input that can be read.</p>\n\n<p>The problem you're running into is that <code>pure fullResponse</code> never returns an empty <code>ByteString</code> unless it always does.  You need to provide a somewhat more complex IO action to capture the intended behavior.  Maybe something along these lines (untested):</p>\n\n<pre><code>returnOnce :: Monoid a =&gt; a -&gt; IO (IO a)\nreturnOnce x = do\n    ref &lt;- newIORef x\n    pure $ readIORef ref &lt;* writeIORef ref mempty\n</code></pre>\n\n<p>As for how to debug this?  Not sure about generic methods.  I was just suspicious that you probably needed a solution along these lines, and <a href=\"https://hackage.haskell.org/package/http-client-0.5.12.1/docs/Network-HTTP-Client-Internal.html#t:BodyReader\" rel=\"nofollow noreferrer\">the docs for <code>BodyReader</code></a> confirmed it.</p>\n"}], "owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 50215010, "answer_count": 1, "score": 1, "last_activity_date": 1525698463, "creation_date": 1525697289, "question_id": 50214641, "link": "https://stackoverflow.com/questions/50214641/log-all-requests-and-responses-for-http-conduit", "title": "Log all requests and responses for http-conduit", "body": "<p>I have written this <code>ManagerSettings</code> to log all requests and responses for my http-conduit application. (By the way, I am importing <code>ClassyPrelude</code>).</p>\n\n<pre><code>tracingManagerSettings :: ManagerSettings\ntracingManagerSettings =\n  tlsManagerSettings { managerModifyRequest = \\req -&gt; do\n                         putStr \"TRACE: \"\n                         print req\n                         putStrLn \"\"\n                         pure req\n                     , managerModifyResponse = \\r -&gt; do\n                         responseChunks &lt;- brConsume $ responseBody r\n                         let fullResponse = mconcat responseChunks\n                         putStr \"TRACE: RESPONSE: \"\n                         putStrLn $ decodeUtf8 fullResponse\n                         pure $ r { responseBody = pure fullResponse }\n                     }\n</code></pre>\n\n<p>However, it's not working - when I use it, the application is hanging and trying to consume all the RAM in the machine after printing the first request and first response, which suggests some kind of infinite loop.</p>\n\n<p>Also, the request is printed twice.</p>\n\n<p>I made a previous attempt that was similar, but didn't modify <code>r</code>. That failed because after I had already read the response completely, there was no more response data to read.</p>\n\n<p>If I replace this with <code>tlsManagerSettings</code>, <code>http-conduit</code> works again.</p>\n\n<p>My application is using libstackexchange, which I have modified to allow the <code>ManagerSettings</code> to be customised. I am using http-conduit version 2.2.4.</p>\n\n<p>How can I diagnose the issue? How can I fix it?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1525697270, "post_id": 50214585, "comment_id": 87445912, "body": "Sounds like what you&#39;re looking for might be WAI middleware; Perhaps <a href=\"https://hackage.haskell.org/package/wai-middleware-auth\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 1, "creation_date": 1525974658, "post_id": 50214585, "comment_id": 87574047, "body": "There is a servan-auth package, but it is limited to JWT or cookies for the moment. <a href=\"https://github.com/haskell-servant/servant-auth\" rel=\"nofollow noreferrer\">github.com/haskell-servant/servant-auth</a>"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525697114, "creation_date": 1525697114, "question_id": 50214585, "link": "https://stackoverflow.com/questions/50214585/routing-in-servant", "title": "Routing in servant", "body": "<p>I am using the Servant in a Haskell project. Below is my source code:</p>\n\n<pre><code>type MyAPI \n    = \"base\" :&gt;  \"page1.html\":&gt; Get '[HTML] H.Html \n    :&lt;|&gt; \"base\" :&gt; \"page2.html\" :&gt; Get '[HTML] H.Html \n    :&lt;|&gt; \"base\" :&gt; \"page3.html\" :&gt; Get '[HTML] H.Html \n\nserverAPI = pageH1 :&lt;|&gt; pageH2 :&lt;|&gt; pageH3\n</code></pre>\n\n<p>For each of the methods (pageH1, pageH2, pageH3) there is a general action. This general action determines whether it is possible to load pages (pageH1, pageH2, pageH3). I want to write a listener for the path \"base/\" and afte that move on next routes (or don`t move). Like next:</p>\n\n<pre><code>type MyAPI \n        = \"base\" :&gt; ............... \n        :&lt;|&gt; \"base\" :&gt;  \"page1.html\":&gt; Get '[HTML] H.Html \n        :&lt;|&gt; \"base\" :&gt; \"page2.html\" :&gt; Get '[HTML] H.Html \n        :&lt;|&gt; \"base\" :&gt; \"page3.html\" :&gt; Get '[HTML] H.Html \n\n    serverAPI = page :&lt;|&gt; pageH1 :&lt;|&gt; pageH2 :&lt;|&gt; pageH3\n</code></pre>\n\n<p>Is it possible to implement it?</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525696491, "post_id": 50214331, "comment_id": 87445412, "body": "What are the settings, did you use <code>127.0.0.1</code> instead of <code>localhost</code>?"}, {"owner": {"reputation": 73, "user_id": 9414418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p7jD4FCoE7c/AAAAAAAAAAI/AAAAAAAACkk/KPBQusRwRPk/photo.jpg?sz=128", "display_name": "Giulio De Stasio", "link": "https://stackoverflow.com/users/9414418/giulio-de-stasio"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525761201, "post_id": 50214331, "comment_id": 87471743, "body": "I export <code>127.0.0.1</code>, but also with localhost is the same, the settings.yml is the standard"}], "owner": {"reputation": 73, "user_id": 9414418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p7jD4FCoE7c/AAAAAAAAAAI/AAAAAAAACkk/KPBQusRwRPk/photo.jpg?sz=128", "display_name": "Giulio De Stasio", "link": "https://stackoverflow.com/users/9414418/giulio-de-stasio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 468, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1525799418, "creation_date": 1525696357, "last_edit_date": 1525799418, "question_id": 50214331, "link": "https://stackoverflow.com/questions/50214331/yesod-network-socket-bind-permission-denied-permission-denied", "title": "Yesod Network.Socket.bind permission denied (permission denied)", "body": "<p>When trying to execute my project from stack I get this error</p>\n\n<pre><code>% stack exec horizon\nhorizon: Network.Socket.bind: permission denied (Permission denied)\n</code></pre>\n\n<p>Also i get that:</p>\n\n<pre><code>% sudo stack --allow-different-user exec horizon\n07/May/2018:14:16:10 +0200 [Error#yesod-core] Error handler errored out: \nInternalError \"Network.Socket.connect: &lt;socket: 23&gt;: does not exist\n(Connection refused)\" @(yesod-\ncore-1.4.37.3-9gXfYzTigbs72LNNfHDGk9:Yesod.Core.Internal.Run ./Yesod\n/Core/Internal/Run.hs:233:21)\n</code></pre>\n\n<p>when i try to execute in sudo mode (or with root).</p>\n\n<p>I've already tried to remove ./.stack-works and ~/.stack folders and still don't work</p>\n\n<h3>Update</h3>\n\n<p>The first error was caused using low port (80). In port 3000, either with <code>stack exec horizon</code> and <code>stack exec yesod devel</code> don't work. I have also reinstalled network and added on extra-deps.</p>\n"}, {"tags": ["haskell", "dll", "cabal", "haskell-stack", "ekg"], "owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525849181, "creation_date": 1525693808, "last_edit_date": 1525849181, "question_id": 50213530, "link": "https://stackoverflow.com/questions/50213530/why-do-i-have-to-remove-ekg-from-build-deps-for-haskell-stack-cabal-to-find-my", "title": "Why do I have to remove `ekg` from build-deps for haskell stack/cabal to find my dll on Windows?", "body": "<p>I'm building a Haskell 7.10 project that depends on tdsodbc.dll, using stack v1.7.1 on Windows, everything 64-bit. I have tdsodbc.dll in the <code>lib</code> folder of the project, and <code>extra-lib-dirs: lib</code> and <code>extra-libraries: tdsodbc</code> in the .cabal. </p>\n\n<p>But when I compile, I get <code>Missing C library: tdsodbc</code> when stack runs <code>cabal configure</code>. I've tried putting <code>extra-lib-dirs: [lib]</code> in <code>stack.yaml</code>, and I can see from that configure command that it has put <code>--extra-lib-dirs=C:\\Users\\Kevin\\src\\theproject\\lib</code> on the cabal configure command line, but still complains about it missing.</p>\n\n<p>Now the weird part: If I remove <code>ekg</code> from the <code>build-deps</code> of the project (and remove the relevant imports etc.), the project builds just fine! I still have to copy the dll into <code>.stack-work/dist/\u2026</code> to make it <em>run</em>, but why would <code>ekg</code> in build-deps stop cabal from being able to configure it? </p>\n\n<p>I've tried the trick from <a href=\"https://stackoverflow.com/questions/5759838/cannot-get-cabal-to-find-the-mpi-library-for-haskell-mpi-on-windows\">Cannot get cabal to find the mpi library for haskell-mpi on Windows</a> with putting <code>c/Users/Kevin/src/theproject/lib</code> in <code>LIBRARY_PATH</code> (there's no <code>.a</code> file to mv in my case, and no .h's), but that didn't help me. Only removing <code>ekg</code> has helped me so far. What could be causing this? The \"solution\" seems completely irrelevant to the problem :(</p>\n\n<hr>\n\n<p>EDIT: I tried using plain Haskell Platform 7.10.3 (from <a href=\"https://www.haskell.org/platform/prior.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/prior.html</a> ), and that configured and built just fine. So the problem is just when cabal configure is called from stack.</p>\n"}, {"tags": ["haskell", "monads", "reader-monad"], "answers": [{"comments": [{"owner": {"reputation": 209, "user_id": 963356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sZoNL.jpg?s=128&g=1", "display_name": "\u91d1\u5141\u96c4Oliver", "link": "https://stackoverflow.com/users/963356/%e9%87%91%e5%85%81%e9%9b%84oliver"}, "edited": false, "score": 0, "creation_date": 1525699423, "post_id": 50213264, "comment_id": 87447310, "body": "This has been a very insightful answer! I will need the time to digest the materials though. You deserve more than my upvote!"}, {"owner": {"reputation": 209, "user_id": 963356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sZoNL.jpg?s=128&g=1", "display_name": "\u91d1\u5141\u96c4Oliver", "link": "https://stackoverflow.com/users/963356/%e9%87%91%e5%85%81%e9%9b%84oliver"}, "edited": false, "score": 1, "creation_date": 1525917780, "post_id": 50213264, "comment_id": 87546880, "body": "I finally understand now.. I wasn&#39;t understanding record syntax properly. Thanks for sharing."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 8, "last_activity_date": 1525700766, "last_edit_date": 1525700766, "creation_date": 1525692873, "answer_id": 50213264, "question_id": 50212988, "link": "https://stackoverflow.com/questions/50212988/implementing-the-reader-monad-from-real-world-haskell-book/50213264#50213264", "title": "Implementing the Reader monad (from Real World Haskell book)", "body": "<blockquote>\n  <p>I am having difficulty understanding <em>the Reader Monad</em>.</p>\n</blockquote>\n\n<p><strong><em>Edit:</em></strong> I should point to a number of resources on this, rather than attempt to repeat them.</p>\n\n<ul>\n<li><a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf\" rel=\"noreferrer\"><em>Monads for Functional Programming</em></a> by Philip Wadler. He calls them <em>state reader monads</em>.</li>\n<li><a href=\"http://haskellbook.com/\" rel=\"noreferrer\"><em>Chapter 22.1: Reader</em> in HaskellBook.com</a> by Chris Allen and Julie Moronuki.</li>\n<li><a href=\"https://wiki.haskell.org/Typeclassopedia#Instances_3\" rel=\"noreferrer\"><em>Typeclassopedia: Monad Instances</em></a> adapted from Brent Yorgey's <a href=\"https://wiki.haskell.org/wikiupload/8/85/TMR-Issue13.pdf\" rel=\"noreferrer\">The Monad.Reader issue 13</a>.</li>\n<li><a href=\"http://learnyouahaskell.com/for-a-few-monads-more\" rel=\"noreferrer\">LYAH chapter 13: <em>For a Few Monads More</em></a>.</li>\n</ul>\n\n<blockquote>\n  <p>I thought <code>runReader</code> only takes one argument, but it seems it's taking two right now, one being <code>k (runReader m r)</code> and another being <code>r</code>.</p>\n</blockquote>\n\n<p>If you look at the type signature for <code>runReader :: Reader e a -&gt; e -&gt; a</code>, this can be seen as either taking a <code>Reader e a</code> and producing an <code>e -&gt; a</code>, or as taking a <code>Reader e a</code> and an <code>e</code> and producing an <code>a</code>. The point of the reader monad is to introduce an implicit argument.</p>\n\n<blockquote>\n  <p>How does <code>runReader (k (runReader m r)) r</code> work out?</p>\n</blockquote>\n\n<p>You could spell out the <em>bind</em> operator definition a little more:</p>\n\n<pre><code>instance Monad (Reader e) where \n  return a = R $ \\_ -&gt; a\n  -- (&gt;&gt;=) :: Reader e a -&gt; (a -&gt; Reader e b) -&gt; Reader e b\n  ma &gt;&gt;= k = R $ \\e -&gt; let a = runReader ma e\n                           mb = k a\n                       in runReader mb e\n</code></pre>\n\n<p>That is, first \"<code>ma</code> is run with <code>e</code>\" (<code>runReader ma :: e -&gt; a</code> is applied to <code>e</code>). This produces an <code>a</code>.</p>\n\n<p>Then <code>k a</code> is run. This produces an <code>mb</code>.</p>\n\n<p>Then \"<code>mb</code> is run with <code>e</code>\" (<code>runReader mb :: e -&gt; b</code> is applied to <code>e</code>).</p>\n\n<p>This is packaged up into <code>R $ \\e -&gt; ... runReader mb e</code>.</p>\n\n<p>I've come to the thought that the difficult part of understanding this is mostly tied to the way <em>newtype</em> requires constant wrapping (<code>R</code>) and unwrapping (<code>runReader</code>) of its content, rather than the notorious <em>how monads work</em>.</p>\n\n<hr>\n\n<p>Imagine the only monad you ever needed was the reader monad, and we could do without the <code>newtype</code> and <code>instance Monad (Reader e)</code> fluff. Then your definition could look like:</p>\n\n<pre><code>type Reader e a = e -&gt; a\n-- type Reader e a = (-&gt;) e a\n-- type Reader e = (-&gt;) e\n\nunit :: a -&gt; Reader e a\n--   :: a -&gt; (e -&gt; a)\nunit a = \\_e -&gt; a\n-- unit a _e = a\n-- unit = const\n\nask :: Reader e e\n--  :: e -&gt; e\nask = \\e -&gt; e\n-- ask e = e\n-- ask = id\n\nbind :: Reader e a -&gt; (a -&gt; Reader e b) -&gt; Reader e b\n--   :: (e -&gt; a)   -&gt; (a -&gt; (e -&gt; b))   -&gt; (e -&gt; b)\nbind ma k = \\e -&gt; let a = ma e\n                      mb = k a\n                  in mb e\n-- bind ma k e = let mb = k (ma e) in mb e\n</code></pre>\n\n<p>at which point it becomes more clear that all <code>unit</code> does is discard <code>e</code>, all <code>ask</code> does is return <code>e</code>, and what <code>bind</code> does is take two functions (<code>ma</code> and <code>k (ma e)</code>, aka <code>mb</code>) that both expect an <code>e</code>, composes them inside a new function that also expects an <code>e</code>, without having to explicitly pass <code>e</code> during the composition.</p>\n\n<p>A misconception I had myself when learning how to write monad definitions was that <code>runReader</code> <em>runs</em> anything. It helped me conceptually to call it <code>unR</code> since all it does is remove the <code>R</code> wrapping.</p>\n"}], "owner": {"reputation": 209, "user_id": 963356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sZoNL.jpg?s=128&g=1", "display_name": "\u91d1\u5141\u96c4Oliver", "link": "https://stackoverflow.com/users/963356/%e9%87%91%e5%85%81%e9%9b%84oliver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 0, "accepted_answer_id": 50213264, "answer_count": 1, "score": 2, "last_activity_date": 1565019032, "creation_date": 1525691949, "last_edit_date": 1565019032, "question_id": 50212988, "link": "https://stackoverflow.com/questions/50212988/implementing-the-reader-monad-from-real-world-haskell-book", "title": "Implementing the Reader monad (from Real World Haskell book)", "body": "<pre><code>newtype Reader e a = R { runReader :: e -&gt; a }\n\ninstance Monad (Reader e) where \n  return a = R $ \\_ -&gt; a\n  m &gt;&gt;= k  = R $ \\r -&gt; runReader (k (runReader m r)) r\n</code></pre>\n\n<p>I am having difficulty understanding these two snippets. I can tell that the first one is a record syntax description of a reader that has a function <code>runReader</code> from <code>e</code> to <code>a</code>, but the second one puzzles me. </p>\n\n<p>By binding <code>m</code> with <code>k</code>, it's essentially trying to create a new <code>Reader</code>, but how does</p>\n\n<pre><code>runReader (k (runReader m r)) r\n</code></pre>\n\n<p>work out? I thought <code>runReader</code> only takes one argument, but it seems it's taking two right now, one being <code>k (runReader m r)</code> and another being <code>r</code>.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525687407, "post_id": 50210726, "comment_id": 87440109, "body": "Frequently if one only needs to <i>compare</i> distances, one does not calculate the distance, but the square distance, so in such case, you could drop the <code>sqrt</code>."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 9546967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826c1d83ac04e533a376551172abf6c7?s=128&d=identicon&r=PG&f=1", "display_name": "studyer", "link": "https://stackoverflow.com/users/9546967/studyer"}, "edited": false, "score": 0, "creation_date": 1525685926, "post_id": 50210821, "comment_id": 87439207, "body": "thanks for your helping,  how can I round the final answer to int type?"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 9, "user_id": 9546967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826c1d83ac04e533a376551172abf6c7?s=128&d=identicon&r=PG&f=1", "display_name": "studyer", "link": "https://stackoverflow.com/users/9546967/studyer"}, "edited": false, "score": 0, "creation_date": 1525686096, "post_id": 50210821, "comment_id": 87439311, "body": "For example, by using <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:round\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/&hellip;</a> function"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 2, "last_activity_date": 1525684824, "creation_date": 1525684824, "answer_id": 50210821, "question_id": 50210726, "link": "https://stackoverflow.com/questions/50210726/how-to-fix-type-matching-error/50210821#50210821", "title": "How to fix Type matching error", "body": "<p>The problem is that <a href=\"https://www.haskell.org/hoogle/?hoogle=sqrt\" rel=\"nofollow noreferrer\">sqrt</a> accepts Floating number, but <a href=\"https://www.haskell.org/hoogle/?hoogle=fromIntegral\" rel=\"nofollow noreferrer\">fromIntegral</a> will help to explicitly type cast the integers to floating numbers:</p>\n\n<pre><code>getRadius :: Coord -&gt; Coord -&gt; Float\ngetRadius (x0,y0) (x1,y1) = sqrt(fromIntegral (sqrX+sqrY))\n                             where sqrX = (x1-x0)*(x1-x0)\n                                   sqrY = (y1-y0)*(y1-y0)\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 9546967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826c1d83ac04e533a376551172abf6c7?s=128&d=identicon&r=PG&f=1", "display_name": "studyer", "link": "https://stackoverflow.com/users/9546967/studyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525684824, "creation_date": 1525684476, "question_id": 50210726, "link": "https://stackoverflow.com/questions/50210726/how-to-fix-type-matching-error", "title": "How to fix Type matching error", "body": "<p>I am writing a function to calculate radius, and the first input is centre of a circle and second is a point from the edge of the circle.</p>\n\n<pre><code>type Coord = (Int,Int)\ngetRadius :: Coord -&gt; Coord -&gt; Float\ngetRadius (x0,y0) (x1,y1) = sqrt(sqrX+sqrY)\n                             where sqrX = (x1-x0)*(x1-x0)\n                                   sqrY = (y1-y0)*(y1-y0)\n</code></pre>\n\n<p>This is my code but when I compile it , an error shows that \"Couldn't match expected type \u2018Float\u2019 with actual type \u2018Int\u2019. \"\nI think the output should be a float not int . How can I fix this error? thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525684377, "post_id": 50210693, "comment_id": 87438350, "body": "I think in that case, you better alter the type and use an element together with the tail of the list."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1525684404, "post_id": 50210693, "comment_id": 87438364, "body": "<a href=\"https://hayoo.fh-wedel.de/?query=NonEmpty\" rel=\"nofollow noreferrer\">hayoo.fh-wedel.de/?query=NonEmpty</a> (But, this really isn&#39;t necessary here, why don&#39;t you just pattern-match right on the top level? Or use the standard <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Foldable.html#v:minimum\" rel=\"nofollow noreferrer\"><code>minimum</code> function</a>?)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1525689318, "post_id": 50210693, "comment_id": 87441206, "body": "@leftaroundabout: I think the OP wants to calculate the minimum as well as constructing a new list without that minimum in the same &quot;sweep&quot;."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1525694434, "post_id": 50210693, "comment_id": 87444257, "body": "<code>minf [] = undefined</code> ?"}, {"owner": {"reputation": 465, "user_id": 2580077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b58818b540ede79814842b1e8736e6c2?s=128&d=identicon&r=PG&f=1", "display_name": "duggi", "link": "https://stackoverflow.com/users/2580077/duggi"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1525706006, "post_id": 50210693, "comment_id": 87451689, "body": "@St&#233;phaneLaurent yes, can&#39;t get minimum of elements, if there are no elements."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1525707653, "post_id": 50210693, "comment_id": 87452737, "body": "@St&#233;phaneLaurent. Better yet, <code>minf [] = error &quot;selectionSort: cannot happen&quot;</code>, which gives you a helpful error message when the thing that cannot possibly happen happens."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1525689471, "last_edit_date": 1525689471, "creation_date": 1525684611, "answer_id": 50210758, "question_id": 50210693, "link": "https://stackoverflow.com/questions/50210693/how-to-inform-ghc-that-a-particular-pattern-match-is-impossible-ex-list-will-n/50210758#50210758", "title": "How to inform GHC that a particular pattern match is impossible (ex: list will never be empty)?", "body": "<p>Usually the idea is to \"design\" types in such way that the number of \"impossible patterns\" is very small (and prefereably zero).</p>\n\n<p>As a <em>poor man solution</em>, you can rewrite the signature of the function from:</p>\n\n<pre><code>foo :: [a] -&gt; b  -- [a] is a non-empty list\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>foo :: a -&gt; [a] -&gt; b  -- head and tail as input\n</code></pre>\n\n<p>So in this context we can rewrite your function to:</p>\n\n<pre><code>selectionSort :: Ord a =&gt; [a] -&gt; [a]\nselectionSort [] = []\nselectionSort (x:xs) = minElem : selectionSort ys\n    where (minElem, ys) = minf x xs\n          minf z [] = (z, [])\n          minf z za@(z2:zs) = let (m, ms) = minf z2 zs in\n              if z &lt;= m then (z, za)\n              else (m, z:ms)\n</code></pre>\n\n<p>So we here use the first parameter as the <em>head</em> of the list, and the second as the tail. Since the list contains at least one element, this means that the tail can be empty, and hence we can do pattern matching. As a result, we can still use the <code>-Wincomplete-patterns</code> flag to check if <em>all</em> patterns are covered and thus we still have some guarantees by the compiler.</p>\n\n<p>In case you still have no means to design the types properly, you can for example add the pattern and raise a (validation) error:</p>\n\n<pre><code>minf [] = error \"Impossible: minf only works with a non-empty list\"\n</code></pre>\n"}], "owner": {"reputation": 465, "user_id": 2580077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b58818b540ede79814842b1e8736e6c2?s=128&d=identicon&r=PG&f=1", "display_name": "duggi", "link": "https://stackoverflow.com/users/2580077/duggi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 50210758, "answer_count": 1, "score": 2, "last_activity_date": 1525689471, "creation_date": 1525684319, "last_edit_date": 1525684588, "question_id": 50210693, "link": "https://stackoverflow.com/questions/50210693/how-to-inform-ghc-that-a-particular-pattern-match-is-impossible-ex-list-will-n", "title": "How to inform GHC that a particular pattern match is impossible (ex: list will never be empty)?", "body": "<p>I defined <strong>selectionSort</strong> function as below, sorting an empty list just results in an empty list and sorting a non-empty list is cons of minimum element and sorted version of rest of the list.</p>\n\n<pre><code>selectionSort :: Ord a =&gt; [a] -&gt; [a]\nselectionSort xs\n  | null xs = []\n  | otherwise = minElem : (selectionSort ys)\n    where\n      (minElem, ys) = minf xs\n        where\n          minf [x] = (x, [])\n          minf (x:xs) = let (m ,ms) = minf xs in\n            if x &lt;= m then (x, xs)\n            else (m, x:ms)\n</code></pre>\n\n<p><strong>minf</strong> takes a non-empty list and returns a tuple of minimum value and rest of the list.</p>\n\n<p>When i compile this function with -W flag, I get this warning </p>\n\n<pre><code>warning: [-Wincomplete-patterns]\nPattern match(es) are non-exhaustive\nIn an equation for `minf': Patterns not matched: []\n    |\n 24 |             minf [x] = (x, [])\n    |             ^^^^^^^^^^^^^^^^^^...\n</code></pre>\n\n<p>It is straight forward that the function <code>minf</code> is never applied to an empty list, because those cases are caught in <code>null xs = []</code>. Is there any way to inform GHC that the particular case is impossible without using other types (<code>NonEmpty</code> list type) or <code>Maybe</code>s</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525683373, "post_id": 50210234, "comment_id": 87437746, "body": "Sorry, but there&#39;s no way this question could be objectively answered, which is a requirement on StackOverflow."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525683635, "post_id": 50210234, "comment_id": 87437900, "body": "You could maybe ask for advice on the code you already <i>have</i> on <a href=\"https://codereview.stackexchange.com/\">Codereview.SE</a> (there are quite a few things in it that aren&#39;t really idiomatic at all), and possibly in the discussion some ideas would also come up for how to proceed."}, {"owner": {"reputation": 9, "user_id": 9373294, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Momna Fatima", "link": "https://stackoverflow.com/users/9373294/momna-fatima"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525683664, "post_id": 50210234, "comment_id": 87437917, "body": "I&#39;m a beginner, how am i supposed to learn if there is no answer?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525683912, "post_id": 50210234, "comment_id": 87438052, "body": "Well, if you don&#39;t have ideas for what to do next then why not just read <a href=\"https://wiki.haskell.org/Books#Textbooks\" rel=\"nofollow noreferrer\">books</a> and look at their examples! But, surely you can come up with ideas of what could be <i>interesting</i> for the program to do? That&#39;s not really bound to programming experience. (Judging how difficult the ideas are to implement might need experience, but that&#39;s something you could ask a question about.)"}], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1525685731, "last_edit_date": 1525685731, "creation_date": 1525685365, "answer_id": 50210970, "question_id": 50210234, "link": "https://stackoverflow.com/questions/50210234/how-to-add-more-complexity-in-my-game/50210970#50210970", "title": "how to add more complexity in my game?", "body": "<p>This may be a little advanced, but the full <a href=\"https://en.wikipedia.org/wiki/Twenty_Questions\" rel=\"nofollow noreferrer\">Twenty Questions</a> game is described in the following two StackExchange Q&amp;A's: <a href=\"https://stackoverflow.com/questions/887533/how-do-20-questions-ai-algorithms-work\">How do 20 questions AI algorithms work?</a> and <a href=\"https://gamedev.stackexchange.com/questions/40024/how-can-i-implement-a-20-questions-algorithm\">How can I implement a \u201c20 Questions\u201d algorithm?</a> (has drawings + answer from author of <a href=\"http://20q.net/\" rel=\"nofollow noreferrer\">20Q.net</a>).</p>\n\n<p>Perhaps you should ask yourself more concretely what kind of game you can make with only a small increment in complexity compared to your current game. Randomness makes games entertaining. Your current game has a fixed path.</p>\n\n<p>For example, you could make a simple game where the end goal is to <a href=\"https://wiki.haskell.org/Guess_a_random_number\" rel=\"nofollow noreferrer\">guess a random number</a>, with the program giving \"higher / lower\" hints. Someone already did this and submitted their code to the Code Review Stack Exchange: <a href=\"https://codereview.stackexchange.com/questions/134844/number-guessing-game-in-haskell\">Number Guessing Game in Haskell</a>, as @leftaroundabout suggested.</p>\n\n<p>Since this problem already has pretty solutions online, you have to come up with a twist that you can only solve by yourself to be sure you're learning. A twist for the number guessing game could be an upper limit to how many guesses the player has.</p>\n\n<hr>\n\n<p>A next step could be to make a random country guessing game where the hints to each country is still fixed, but the country is randomly chosen. Once you have made your mind about the flow of the program, you can define a datatype that models the content of your game. For example,</p>\n\n<pre><code>type Country = String\ntype Hint = String\n\ncountries :: [(Country, [Hint])]\ncountries = [ (\"Denmark\", [ \"It is the smallest of Scandinavian countries.\"\n                          , \"It is the oldest kingdom in the world.\"\n                          , ...\n                          ]\n            , (\"Turkey\", [ \"It was established as a republic in 1923.\"\n                         , \"It is named after its founder, Kemal Atat\u00fcrk.\"\n                         ])\n            , ...\n            ]\n</code></pre>\n\n<p>This way, your program logic becomes independent of whatever particular questions you've got. This means you can make the game bigger by filling in <em>data</em> rather than complicating the logic of the game further.</p>\n\n<p>You could <em>(a)</em> build a mechanism for picking a random country, and <em>(b)</em> build a mechanism for reading possible answers and determining if they're right, and <em>(c)</em> build a mechanism for giving more hints and count how many hints were needed, until you run out of hints.</p>\n\n<p>Picking a random country you can learn how to do by doing the \"guess a random number game\". Picking a random country then becomes picking a random element from a list, which with the above <code>countries :: [(Country, [Hint])]</code> means picking a random element of the type <code>(Country, [Hint])</code>.</p>\n\n<p>Reading possible answers and determining if they're right becomes a matter of comparing <code>answer &lt;- getLine</code> with the value of type <code>Country</code> that you drew randomly.</p>\n\n<p>And giving hints gets more complicated because you need to cycle the list of hints, give a new one when requested, and somehow disappoint the player when there are no more hints. Once you have a working game (for some definition of working), consider submitting this to the Code Review Stack Exchange. It's better to set the goals low and be done with some sub-game, than submit a bunch of code that isn't working, where the goal isn't clear, and your level of comprehension isn't at the level of your goal. This will only frustrate reviewers because a proper review may be wasted on you yet.</p>\n"}], "owner": {"reputation": 9, "user_id": 9373294, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Momna Fatima", "link": "https://stackoverflow.com/users/9373294/momna-fatima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525761599, "creation_date": 1525682577, "last_edit_date": 1525761599, "question_id": 50210234, "link": "https://stackoverflow.com/questions/50210234/how-to-add-more-complexity-in-my-game", "title": "how to add more complexity in my game?", "body": "<p>I'm a beginner in functional programming I'm trying to make a game \"Guess the country\". This is the code I've written - how can I add more complexity? I need ideas - I want to give the player some points after he/she tells the right answer but I don't know how to add that.</p>\n\n<pre><code>game = do\n         putStrLn \"Welcome to the game\"\n         putStrLn \"Press one to start\"\n         n1&lt;- getLine\n         let x1 = read n1::Int\n         if(x1==1) then \n           putStrLn\"DESCRIPTION: Write level 1 and  Guess the Country's name\"\n         else \n           putStrLn\"exit\"\n\n    level 1= do\n        putStrLn \"It was discovered by columbus\"\n        ans1&lt;- getLine\n        if ans1==\"america\" then\n          putStrLn \"***CONGRATULATIONS***\\n You've achieved 5 coins\\n to move to next question write question2\"\n        else \n          putStrLn\"Your answer is wrong\\n***GAMEOVER***\\nto try again write level 1\"\n\n    question2= do\n        putStrLn \"It is very famous for football\"\n        ans1&lt;- getLine\n        if ans1==\"spain\" then\n          putStrLn \"***CONGRATULATIONS***\\n You've achieved 5 coins\\n to move to next question write question3\"\n        else \n          putStrLn\"Your answer is wrong\\n***GAMEOVER***\\nto try again write question2\"\n\n    question3 = do\n         putStrLn \"It is the largest country of the world\"\n         ans1&lt;- getLine\n         if ans1==\"russia\" then\n           putStrLn \"***CONGRATULATIONS***\\n You've achieved 5 coins\\n to move to next question write question4\"\n         else \n           putStrLn\"Your answer is wrong\\n***GAMEOVER***\\nto try again write question3\"\n    question4 =do\n        putStrLn \"It has a maple leaf on its flag\"\n        ans1&lt;- getLine\n        if ans1==\"canada\" then\n          putStrLn \"***CONGRATULATIONS***\\n You've achieved 5 coins\\n to move to next question write question5\"\n        else \n          putStrLn\"Your answer is wrong\\n***GAMEOVER***\\nto try again write question4\"\n    question5 = do\n        putStrLn \"It's capital is RIO DE JANEIRO\"\n        ans1&lt;- getLine\n        if ans1==\"brazil\" then\n          putStrLn \"***CONGRATULATIONS***\\n You've achieved 5 coins\\n to move to next level write level2\"\n        else \n          putStrLn\"Your answer is wrong\\n***GAMEOVER***\\nto try again write question5\"\n    level2= do\n         putStrLn\"In this level you have to guess the countries capital \\nwhats the capitol of china\"\n         ans1&lt;- getLine\n         if ans1==\"bejing\" then\n            putStrLn \"***CONGRATULATIONS***\\n You've achieved 10 coins\\n to move to next quest\"`\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1736, "user_id": 6744670, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dcea90697f5e09866420d509362947a6?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksei Maide", "link": "https://stackoverflow.com/users/6744670/aleksei-maide"}, "edited": false, "score": 1, "creation_date": 1525670825, "post_id": 50207475, "comment_id": 87431989, "body": "All coordinates between two points, there are infinitely many points between any two points on the line... if your function truly attempts that, then you should not even worry about it getting to the polygon function, because it will take... a while :) ... Anyway, the quesiton is a bit hard to understand, add some code and intended output, will make it easier to actually help."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525677753, "post_id": 50207475, "comment_id": 87434807, "body": "<code>line p1 p2 :: [Coord]</code> ; <code>(line p1 p2 : undefined) :: ......</code> ? <code>(line p1 p2 ++ undefined) :: ......</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1525684631, "post_id": 50209272, "comment_id": 87438486, "body": "&quot;<code>[x, y, z]</code> could be also be written <code>x : [y, z]</code>&quot; could more directly convey the intent. short name for an internal function, like <code>go</code>, could be less distracting.  YMMV for all points, of course."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1525686155, "last_edit_date": 1592644375, "creation_date": 1525678810, "answer_id": 50209272, "question_id": 50207475, "link": "https://stackoverflow.com/questions/50207475/how-to-use-recursion-for-every-two-elements-in-the-list/50209272#50209272", "title": "How to use recursion for every two elements in the list", "body": "<blockquote>\n<p>So if I gives a list vertex <code>[p1, p2, p3, p4]</code> the function should return</p>\n<pre><code>[line p1 p2 : line p2 p3 : line p3 p4 : line p4 p1]\n</code></pre>\n</blockquote>\n<p>You probably mean either</p>\n<pre><code>[line p1 p2, line p2 p3, line p3 p4, line p4 p1] :: [[Coord]]\n</code></pre>\n<p>or</p>\n<pre><code>line p1 p2 ++ line p2 p3 ++ line p3 p4 ++ line p4 p1 :: [Coord]\n</code></pre>\n<p>which is equivalent to</p>\n<pre><code>concat [line p1 p2, line p2 p3, line p3 p4, line p4 p1] :: [Coord]\n</code></pre>\n<p>What you're describing does not type-check: <code>[x : y : z]</code> is a list that consists of one list, <code>x : y : z</code>, where <code>z</code> is the tail. But if <code>line px py</code> is an element of this list, it can't also be the tail of that list. <code>[x, y, z]</code> could also be written <code>x : [y, z]</code> or <code>x : y : [z]</code> or <code>x : y : z : []</code>. The confusion here arises from using <code>x : ...</code> to construct lists with recursion, but lists of a fixed length most often look like <code>[x, y, z]</code>.</p>\n<hr />\n<p>Since you're using each point twice; once as the first argument to <code>line</code>, and once as the second argument, you could use the following recursion pattern:</p>\n<pre><code>polygon :: [Coord] -&gt; [Coord]\npolygon (p1:p2:ps) = line p1 p2 ++ polygon (p2:ps)\npolygon [pLast] = ???\npolygon [] = []\n</code></pre>\n<p>In the second iteration, what used to be <code>p2</code> becomes <code>p1</code>, and so on.</p>\n<p>You can evaluate this by hand to get the picture:</p>\n<pre><code>polygon (px : py : pz : [])\n  ~&gt; line px py ++ polygon (py : pz : [])\n  ~&gt; line px py ++ line py pz ++ polygon (pz : [])\n  ~&gt; line px py ++ line py pz ++ ???\n</code></pre>\n<p>Unfortunately, it seems that to connect the last coordinate to the first, you want to somehow write <code>line pLast pFirst</code>, but <code>pFirst</code> is not in scope. <em>Hint:</em> You can rewrite this function so that the first coordinate is available when you reach the end of the list, e.g. by making a nested helper function:</p>\n<pre><code>polygon :: [Coord] -&gt; [Coord]\npolygon [] = ...\npolygon (pFirst:pRest) = ...\n  where\n    polygon' :: [Coord] -&gt; [Coord]\n    polygon' (p1:p2:ps) = ...\n    polygon' [pLast] = ...\n    polygon' [] = ...\n</code></pre>\n<p>That is one way to construct an explicitly recursive function that does it.</p>\n<p>If you were going to use the standard library, another way could be:</p>\n<pre><code>import Data.List (concat, zipWith, tail, cycle)\n\npolygon :: [Coord] -&gt; [Coord]\npolygon [] = []\npolygon ps = concat (zipWith line ps (tail (cycle ps)))\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9543629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8e12e381f55e2a477eaf70a5829fe09?s=128&d=identicon&r=PG&f=1", "display_name": "learner", "link": "https://stackoverflow.com/users/9543629/learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525686155, "creation_date": 1525670309, "last_edit_date": 1525671394, "question_id": 50207475, "link": "https://stackoverflow.com/questions/50207475/how-to-use-recursion-for-every-two-elements-in-the-list", "title": "How to use recursion for every two elements in the list", "body": "<p>I have already written a function to get a certain number of the coordinates for a line between two points.</p>\n\n<pre><code>line :: Coord -&gt; Coord -&gt; [Coord]\nline (xa,ya) (xb,yb) = ....\n</code></pre>\n\n<p>But I faced some diffculties when I am trying to use it to get all the coordinates for a polygon. The input I put is the coordinate of vertex.</p>\n\n<pre><code>polygon :: [Coord] -&gt; [Coord]\npolygon (p1:p2:ps) = line p1 p2 : polygon ps\n</code></pre>\n\n<p>When I run this polygon , I didnt get the result I wanted to obtain.\nCan anyone provide some help for this ? I know how to do a recursion for adding one to every element in a list but I have no idea how to use recursion for two elements.</p>\n\n<p>So if I gives a list vertex [p1,p2,p3,p4] \nthe function should return [line p1 p2 : line p2 p3 : line p3 p4 :line p4 p1]\nHow to use recursion to come true this ?</p>\n\n<p>thanks a lot.</p>\n"}, {"tags": ["haskell", "higher-order-functions", "fold"], "comments": [{"owner": {"reputation": 1169, "user_id": 7731046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4421d9cc740a327082631cf828105f85?s=128&d=identicon&r=PG&f=1", "display_name": "fghzxm", "link": "https://stackoverflow.com/users/7731046/fghzxm"}, "edited": false, "score": 1, "creation_date": 1525654143, "post_id": 50205761, "comment_id": 87428725, "body": "Are you sure it should not be <code>scanl&#39; :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]</code>?"}, {"owner": {"reputation": 229, "user_id": 7450338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5419bd8beb0bdef4aac01a64cb9c7e9e?s=128&d=identicon&r=PG&f=1", "display_name": "A.M.", "link": "https://stackoverflow.com/users/7450338/a-m"}, "reply_to_user": {"reputation": 1169, "user_id": 7731046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4421d9cc740a327082631cf828105f85?s=128&d=identicon&r=PG&f=1", "display_name": "fghzxm", "link": "https://stackoverflow.com/users/7731046/fghzxm"}, "edited": false, "score": 0, "creation_date": 1525654277, "post_id": 50205761, "comment_id": 87428745, "body": "Yep, sorry - I accidentally copied an old version of the code I wrote."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1525654559, "post_id": 50205761, "comment_id": 87428801, "body": "What&#39;s your question exactly?"}, {"owner": {"reputation": 229, "user_id": 7450338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5419bd8beb0bdef4aac01a64cb9c7e9e?s=128&d=identicon&r=PG&f=1", "display_name": "A.M.", "link": "https://stackoverflow.com/users/7450338/a-m"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1525654631, "post_id": 50205761, "comment_id": 87428811, "body": "@AJFarmar How is <code>scanr</code> defined? (Or at least, how can it be defined recursively?)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1525655420, "post_id": 50205761, "comment_id": 87428958, "body": "@A.Morris I found this, the actual implementation, in less than a minute using hoogle: <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.List.html#scanr\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 229, "user_id": 7450338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5419bd8beb0bdef4aac01a64cb9c7e9e?s=128&d=identicon&r=PG&f=1", "display_name": "A.M.", "link": "https://stackoverflow.com/users/7450338/a-m"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1525680933, "post_id": 50205761, "comment_id": 87436432, "body": "@AJFarmar so did I but I understood neither the syntax nor how the definition could be derived (whereas with Fred Miller&#39;s answer I now think I understand both)."}], "answers": [{"tags": [], "owner": {"reputation": 1169, "user_id": 7731046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4421d9cc740a327082631cf828105f85?s=128&d=identicon&r=PG&f=1", "display_name": "fghzxm", "link": "https://stackoverflow.com/users/7731046/fghzxm"}, "is_accepted": true, "score": 3, "last_activity_date": 1525654960, "creation_date": 1525654960, "answer_id": 50205892, "question_id": 50205761, "link": "https://stackoverflow.com/questions/50205761/recursive-definitions-of-scanl-and-scanr-in-haskell/50205892#50205892", "title": "Recursive definitions of scanl and scanr in Haskell", "body": "<p>To compute</p>\n\n<pre><code>result = scanr' f x (y:ys)\n</code></pre>\n\n<p>you must have computed</p>\n\n<pre><code>partialResult = scanr' f x ys\n</code></pre>\n\n<p>after which you get</p>\n\n<pre><code>result = (y `f` head partialResult) : partialResult\n</code></pre>\n\n<p>The complete implementation is</p>\n\n<pre><code>scanr' _ x [] = [x]\nscanr' f x (y:ys) = (y `f` head partialResult) : partialResult\n    where partialResult = scanr' f x ys\n</code></pre>\n"}], "owner": {"reputation": 229, "user_id": 7450338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5419bd8beb0bdef4aac01a64cb9c7e9e?s=128&d=identicon&r=PG&f=1", "display_name": "A.M.", "link": "https://stackoverflow.com/users/7450338/a-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 786, "favorite_count": 0, "accepted_answer_id": 50205892, "answer_count": 1, "score": 1, "last_activity_date": 1525654960, "creation_date": 1525653444, "last_edit_date": 1525654173, "question_id": 50205761, "link": "https://stackoverflow.com/questions/50205761/recursive-definitions-of-scanl-and-scanr-in-haskell", "title": "Recursive definitions of scanl and scanr in Haskell", "body": "<p>I have searched but cannot find simple definitions of the functions <code>scanr</code> and <code>scanl</code>, only explanations that they show the intermediate calculations of the functions <code>foldr</code> and <code>foldl</code> (respectively).</p>\n\n<p>I have written a recursive definition for <code>scanl</code>, based on the <code>foldl</code> property <code>foldl f y (x:xs) = foldl f (f y x) xs</code>:</p>\n\n<pre><code>scanl' :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]\nscanl' f x [] = [x]\nscanl' f x (y:ys) = x : scanl' f (f x y) ys\n</code></pre>\n\n<p>This seems to work. However, there is a type error when I try to apply this analogy with the <code>foldr</code> property <code>foldr f y (x:xs) = f x (foldr f y xs)</code>:</p>\n\n<pre><code>scanr' :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; [b]\nscanr' _ x [] = [x]\nscanr' f x (y:ys) = y : f x (scanr' f x ys)\n</code></pre>\n\n<p>This fails as the second input for <code>f</code> needs to be a <code>b</code> not a <code>[b]</code>. However, I am unsure how to do this while also recursing on <code>scanr'</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 8, "creation_date": 1525643055, "post_id": 50204798, "comment_id": 87426617, "body": "Great function! What did you try?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1525644171, "post_id": 50204798, "comment_id": 87426887, "body": "What if there are multiple number in the given range? How do you distinguish between &quot;I found no number in the range&quot; and &quot;The number 0 is in the range&quot;? Better to have the type <code>Int -&gt; Int -&gt; [Int] -&gt; [Int]</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1525644311, "post_id": 50204798, "comment_id": 87426920, "body": "@chepner: I think the function should return the <i>number</i> of numbers in the range."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1525645375, "post_id": 50204798, "comment_id": 87427171, "body": "<a href=\"https://softwareengineering.meta.stackexchange.com/questions/6166/open-letter-to-students-with-homework-problems\" title=\"open letter to students with homework problems\">softwareengineering.meta.stackexchange.com/questions/6166/&hellip;</a>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525646045, "post_id": 50204798, "comment_id": 87427295, "body": "Hint: write a helper function <code>countWhere :: (a -&gt; Bool) -&gt; [a] -&gt; Int</code> such that <code>countWhere f xs</code> returns the number of elements <code>x</code> in <code>xs</code> for which <code>f x</code> is true. Then use <code>countWhere</code> to implement <code>givenRange</code>."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1525667523, "post_id": 50204798, "comment_id": 87431184, "body": "With <code>filter</code> the question sounds clear to me."}], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 0, "last_activity_date": 1525699628, "creation_date": 1525699628, "answer_id": 50215416, "question_id": 50204798, "link": "https://stackoverflow.com/questions/50204798/get-how-many-numbers-are-in-the-input-list-are-in-the-given-range/50215416#50215416", "title": "get how many numbers are in the input list are in the given range", "body": "<pre><code>filter (\\x -&gt; x &gt;= low &amp;&amp; x &lt;= hi) xs\n</code></pre>\n\n<p>gives you the numbers in range. Then take the length.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1525710734, "last_edit_date": 1525710734, "creation_date": 1525710311, "answer_id": 50218627, "question_id": 50204798, "link": "https://stackoverflow.com/questions/50204798/get-how-many-numbers-are-in-the-input-list-are-in-the-given-range/50218627#50218627", "title": "get how many numbers are in the input list are in the given range", "body": "<p>This was not simple. The concept of a range within a range is, I think, best handled with equality testing (==). The range within the range is best produced with the <code>take.drop</code> pair. If the two don't match then <code>0</code>. There can be no possibility of <code>0</code> matches. I tested with 0 5 [5..12], 9 13 [5..12] and more. It seems robust. What cannot be assumed that any range is totally sequential. Equality (==) is the fastest way to check each element.</p>\n\n<pre><code>gr s e ls = if [s..e] == (take lls.drop (s-(ls!!0)) $ ls)\n            then lls \n            else 0 \n      where lls = length [s..e]\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9749935, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "user9749935", "link": "https://stackoverflow.com/users/9749935/user9749935"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1525710734, "creation_date": 1525642976, "last_edit_date": 1525644659, "question_id": 50204798, "link": "https://stackoverflow.com/questions/50204798/get-how-many-numbers-are-in-the-input-list-are-in-the-given-range", "title": "get how many numbers are in the input list are in the given range", "body": "<p>I have a function</p>\n\n<pre><code>givenRange:: Int -&gt; Int -&gt; [Int] -&gt; Int\n</code></pre>\n\n<p>and I want to implement <code>givenRange low hi xs</code> so it returns the number of values in <code>xs</code> that between <code>low</code> and <code>hi</code>, inclusive.</p>\n\n<p>For example:</p>\n\n<pre><code>givenRange 2 4 [1,2,3,4,5] == 3  -- 2, 3, 4\ngivenRange 5 7 [1,2,3] == 0\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "functional-programming", "tail-recursion"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1525622977, "post_id": 50201660, "comment_id": 87420190, "body": "The most common approach in Haskell would be to rewrite it with productive corecursion instead of tail-calls. That&#39;s just almost always better in Haskell. Is there some reason that doesn&#39;t work in your use case?"}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1525623084, "post_id": 50201660, "comment_id": 87420214, "body": "@Carl, I am not haskeller. Can you please show how it gonna look like?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1525623577, "post_id": 50201660, "comment_id": 87420391, "body": "The productive corecursion version would look something like <code>phiApproximations = iterate (\\x -&gt; 1 + (1&#47;x)) 1</code>, but it&#39;s probably worth using something stricter than <code>iterate</code> there. The basic idea is to set up the calculation such that you generate successive results hidden behind data constructors so that they&#39;re only calculated if needed."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1525633900, "post_id": 50201847, "comment_id": 87423988, "body": "Always make your accumulator strict!  <code>$</code> \u27fc <code>$!</code>"}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1525634512, "post_id": 50201847, "comment_id": 87424170, "body": "why so? to prevent memory leak due to native Haskell&#39;s laziness?"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 1, "creation_date": 1525636413, "post_id": 50201847, "comment_id": 87424775, "body": "Basically, yes. If the accumulator isn&#39;t strict, then haskell will just build a potentially large thunk, and in the case of most accumulators, the thunk is more memory-costly than the actual value(for instance, with <code>Int32</code> accumulator, it&#39;s just 4 bytes, vs much more for a thunk). An example of that is using <code>foldl&#39; (+) 0</code> to sum large lists of numbers instead of <code>foldl (+) 0</code>. (The former is strict in the accumulator)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525646247, "post_id": 50201847, "comment_id": 87427341, "body": "Speaking of strictness, <code>BangPatterns</code> are pretty common for strict accumulators: <code>go l&#39; !acc | l&#39; &lt; l = go (l&#39; + 1) (1 + 1 &#47; acc) | otherwise = acc</code>\u2014a little bit simpler than <code>seq</code> or <code>$!</code>, although less explicit."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1525634156, "last_edit_date": 1525634156, "creation_date": 1525623189, "answer_id": 50201847, "question_id": 50201660, "link": "https://stackoverflow.com/questions/50201660/can-this-particular-recursion-be-rewritten-in-a-tail-optimized-way/50201847#50201847", "title": "Can this particular recursion be rewritten in a tail-optimized way?", "body": "<p>So you have this computation tree:</p>\n\n<pre>\n               +                 l\n              \u2571 \u2572\n             1   \u00f7\n                \u2571 \u2572\n               1   +             l-1\n                  \u2571 \u2572\n                 1   \u00f7\n                    \u2571 \u2572\n                   1  ...\n                        \u2572\n                         +       1\n                        \u2571 \u2572\n                       1   \u00f7\n                          \u2571 \u2572\n                         1   1   0\n</pre>\n\n<p>Since this has a linear shape, you can indeed make it tail-recursive. For this you need to start at the bottom and keep the already-calculated right result in an accumulator variable.</p>\n\n<pre><code>phi _ l = go 0 1  -- n isn't actually used\n where go l' acc\n        | l' &lt; l     = go (l'+1) $! 1 + 1/acc\n        | otherwise  = acc\n</code></pre>\n\n<p>Not tested, there might be an off-by-1 error here.</p>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 1, "accepted_answer_id": 50201847, "answer_count": 1, "score": 3, "last_activity_date": 1525634156, "creation_date": 1525622050, "question_id": 50201660, "link": "https://stackoverflow.com/questions/50201660/can-this-particular-recursion-be-rewritten-in-a-tail-optimized-way", "title": "Can this particular recursion be rewritten in a tail-optimized way?", "body": "<pre><code>phi n 0 = 1\nphi n l = 1 + 1 / phi n (l - 1)\n</code></pre>\n\n<p>Obviously, the last evaluated action <strong>is not</strong> recursive call, thus given implementation indeed throws with a sufficiently large <code>l</code>.</p>\n\n<p>So what's the way (if any) to rewrite recursion such that 1) it remains recursive, 2) becomes tail-optimized? I assume <code>phi n l result</code> would work, however can't redefine accordingly... are there reliable methods/techniques how to tackle down such a problems?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "is_accepted": true, "score": 4, "last_activity_date": 1525621408, "creation_date": 1525621408, "answer_id": 50201556, "question_id": 50201495, "link": "https://stackoverflow.com/questions/50201495/accessing-attributes-of-a-datatype/50201556#50201556", "title": "Accessing attributes of a datatype", "body": "<p>You can either make your own accessors</p>\n\n<pre><code>names :: Human -&gt; [Names]\nnames (Human n _) = n\n</code></pre>\n\n<p>or use lenses, which gives you that and much more.<br>\n<a href=\"http://hackage.haskell.org/package/lens-tutorial-1.0.3/docs/Control-Lens-Tutorial.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/lens-tutorial-1.0.3/docs/Control-Lens-Tutorial.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 5, "last_activity_date": 1525621561, "creation_date": 1525621561, "answer_id": 50201582, "question_id": 50201495, "link": "https://stackoverflow.com/questions/50201495/accessing-attributes-of-a-datatype/50201582#50201582", "title": "Accessing attributes of a datatype", "body": "<p>In this case the simplest way is to define a function, which pattern-matches the <code>Human</code> data type:</p>\n\n<pre><code>getNames (Human names _) = names\n</code></pre>\n\n<p>Otherwise, you can use Record Syntax to define fields of the record:</p>\n\n<pre><code>data Human = Human { names :: [Names], age :: Age }\n</code></pre>\n\n<p>Using this syntax you achieve <code>names</code> and <code>age</code> functions, which allow you to access the fields:</p>\n\n<pre><code>human1 = Human [\"FirstName\",\"LastName\"] 22\nnames human1\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 4994693, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf135adf371897e4c60586e96dabdd11?s=128&d=identicon&r=PG&f=1", "display_name": "Luca9984", "link": "https://stackoverflow.com/users/4994693/luca9984"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 50201556, "answer_count": 2, "score": 0, "last_activity_date": 1525621561, "creation_date": 1525621024, "question_id": 50201495, "link": "https://stackoverflow.com/questions/50201495/accessing-attributes-of-a-datatype", "title": "Accessing attributes of a datatype", "body": "<p>I created a new datatype:</p>\n\n<pre><code>data Human = Human [Names] Age\n  deriving(Eq,Show)\ntype Names = String\ntype Age = Int\n</code></pre>\n\n<p>And now I want to access the elements of [Names] for an object of type Human:</p>\n\n<pre><code>human1 = Human [\"FirstName\",\"LastName\"] 22\n</code></pre>\n\n<p>Is there a simple way to do this for my example such as <code>Names human1</code> ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 4, "creation_date": 1525638729, "post_id": 50200487, "comment_id": 87425499, "body": "Haskell often reports first fatal error,  only. Put a digit where the first out-of-scope <code>x</code> is to see additional errors, that is, <code>x</code> out of scope"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 10, "creation_date": 1525651311, "post_id": 50200487, "comment_id": 87428179, "body": "It gets better. For example, <code>let 1+1 = 3 in 1+1</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1525696021, "post_id": 50200487, "comment_id": 87445132, "body": "@Alec Indeed! Even better, <code>let 1+1=3 in 1+1</code> evaluates to <code>3</code> (not <code>2</code>), while <code>let 2=3 in 2</code> evaluates to <code>2</code> (not <code>3</code>). And, in ancient Haskell, <code>let x+2=7 in x</code> used to evaluate to <code>5</code>, unlike <code>let 2+x=7 in x</code> (fortunately, this is no longer the case.)"}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1525760000, "post_id": 50200487, "comment_id": 87471204, "body": "@chi I thought n+k patterns needed brackets, or is that not the case?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1525765402, "post_id": 50200487, "comment_id": 87474003, "body": "@Potato44 Yes, I think you are right. They have been removed from Haskell a long time ago, so I forgot how these precisely worked."}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1525812950, "post_id": 50200487, "comment_id": 87501852, "body": "@chi They still exist in GHC, you just need to turn on <code>-XNPlusKPatterns</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 70, "last_activity_date": 1529998363, "last_edit_date": 1529998363, "creation_date": 1525615321, "answer_id": 50200527, "question_id": 50200487, "link": "https://stackoverflow.com/questions/50200487/why-is-2-x-7-valid-haskell/50200527#50200527", "title": "Why is `2 + x = 7` valid Haskell?", "body": "<p>It is valid because it defines <code>+</code> instead.</p>\n\n<pre><code>main = print (3 + 4)\n   where -- silly redefinition of `+` follows\n   0 + y = y\n   x + y = x * ((x-1) + y)\n</code></pre>\n\n<p>Above, the Prelude <code>(+)</code> function is shadowed by a local binding. The result will be <code>24</code>, not <code>7</code>, consequently.</p>\n\n<p>Turning on warnings should point out the dangerous shadowing.</p>\n\n<pre><code>&lt;interactive&gt;:11:6: warning: [-Wname-shadowing]\n    This binding for \u2018+\u2019 shadows the existing binding\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 37, "last_activity_date": 1525615356, "creation_date": 1525615356, "answer_id": 50200532, "question_id": 50200487, "link": "https://stackoverflow.com/questions/50200487/why-is-2-x-7-valid-haskell/50200532#50200532", "title": "Why is `2 + x = 7` valid Haskell?", "body": "<p>You're defining a local function called <code>+</code>.</p>\n\n<p><code>2 + x = 7</code> is equivalent to <code>(+) 2 x = 7</code>, which is equivalent to</p>\n\n<pre><code>(+) y x | y == 2 = 7\n</code></pre>\n\n<p><code>x</code> is an (unused) parameter, and the function is only defined if the first argument is <code>2</code>. That's not very useful, but it explains why <code>x</code> is not visible outside.</p>\n"}], "owner": {"reputation": 1169, "user_id": 7731046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4421d9cc740a327082631cf828105f85?s=128&d=identicon&r=PG&f=1", "display_name": "fghzxm", "link": "https://stackoverflow.com/users/7731046/fghzxm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6572, "favorite_count": 6, "accepted_answer_id": 50200527, "answer_count": 2, "score": 48, "last_activity_date": 1529998363, "creation_date": 1525615030, "question_id": 50200487, "link": "https://stackoverflow.com/questions/50200487/why-is-2-x-7-valid-haskell", "title": "Why is `2 + x = 7` valid Haskell?", "body": "<p>When I try to compile</p>\n\n<pre><code>main = putStrLn $ show x where\n    2 + x = 7\n</code></pre>\n\n<p>GHC complains</p>\n\n<pre><code>error: Variable not in scope: x\n  |\n1 | main = putStrLn $ show x\n  |                        ^\n</code></pre>\n\n<p>So it seems that <code>2 + x = 7</code> is by itself syntactically valid, although it doesn't actually define <code>x</code>. But why is it so?</p>\n"}, {"tags": ["haskell", "ghc", "type-families", "constraint-kinds"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1525640122, "post_id": 50200404, "comment_id": 87425855, "body": "FWIW, the Haskell spec says that instances are always in scope across the entire program - it doesn&#39;t depend on what module you&#39;re in. It&#39;s a long-standing bug in GHC that you can find counter-examples to that behavior. Usually it&#39;s not worth worrying about those counter-examples. Do you have a concrete need to do so, or is this an abstract worry?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1525660523, "post_id": 50200404, "comment_id": 87429894, "body": "@Carl: it&#39;s an abstract worry. Either something that has the behaviour of the first or the second would work fine for my purposes."}], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1525695203, "post_id": 50213857, "comment_id": 87444655, "body": "See the cafe response I don&#39;t think this approach you suggest works on existing classes, and that&#39;s largely the point of this exercise, reusing instances of existing well developed and used classes."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1525695548, "post_id": 50213857, "comment_id": 87444861, "body": "OK, yes you can&#39;t insert an Associated type into an already-defined/imported class, especially in the Prelude. (In the cafe post you called your classes <code>A, B</code> -- so I thought you were creating them fresh.) Then the wiki page approach is the only way."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1525695875, "post_id": 50213857, "comment_id": 87445049, "body": "The wiki page approach doesn&#39;t work as there&#39;s no way to find out all the instances of a class, as any package could define new ones."}], "tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 0, "last_activity_date": 1525696135, "last_edit_date": 1525696135, "creation_date": 1525694847, "answer_id": 50213857, "question_id": 50200404, "link": "https://stackoverflow.com/questions/50200404/reducing-satisfied-constraints-to-ordinary-types/50213857#50213857", "title": "Reducing satisfied constraints to ordinary types", "body": "<p>I answered a similar question from you <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2018-May/129039.html\" rel=\"nofollow noreferrer\">here on the cafe</a>.</p>\n\n<p>As @Carl says, all instances <em>should</em> be in scope everywhere. The exception is compiling so-called <a href=\"https://wiki.haskell.org/Orphan_instance\" rel=\"nofollow noreferrer\">'orphan instances'</a> -- which is a Bad Thing and easy to avoid.</p>\n\n<p>For the record here, the approach is to use an Associated type in your class, with a default definition. This works if you are genuinely happy for the Associated type to throw a 'no instance' error if there's no match to the constraint:</p>\n\n<pre><code>class A t where\n  type MatchesA t :: Bool           -- Associated type\n  type instance MatchesA t = True   -- default instance\n  ...                               -- methods for A\n\ninstance A Int where\n                                    -- uses default instance for MatchesA\n  ...                               -- method implementations as usual\n\n-- undefined :: (MatchesA Int)      -- gives type True\n-- undefined :: (MatchesA Bool)     -- gives 'no instance' error\n</code></pre>\n\n<p>You can get an either-or Matches constraint I think -- see the cafe post for MatchesA or MatchesB. (I've tested that quickly, it might be a bit flakey, depending how eager is the type family reduction.)</p>\n\n<p>What you can't do with this approach is opt for one thing if the constraint holds, but a different thing if it doesn't. So the best you can get is the \"fail to reduce\". In the cafe post I've linked to a (rather old) wiki page with a more comprehensive approach, which relies on overlapping instances. Associated types don't allow overlaps :-(.</p>\n\n<p><strong>EDIT:</strong> There's a deep reason why the compiler won't expose whether some constraint matches, in the way you want for <code>Prelude</code> classes in your comment: you might be using the fact of matching to select some instance of another class <code>C</code>; and there might be a further class <code>D</code> whose instance selection depends on <code>C</code> matching; and <code>A, B</code>'s instance selection depends on <code>D</code>. So now we have circular dependencies. This could be further complicated by other instances in other modules the compiler hasn't yet seen.</p>\n\n<p>So all those (apparently) duplicated instances on the wiki page represent that the programmer knows all the instances and how they inter-depend, in a way that the compiler can't figure out.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525696135, "creation_date": 1525614475, "question_id": 50200404, "link": "https://stackoverflow.com/questions/50200404/reducing-satisfied-constraints-to-ordinary-types", "title": "Reducing satisfied constraints to ordinary types", "body": "<p>I understand the following type family shouldn't and perhaps can't be implemented in GHC:</p>\n\n<pre><code>type family MatchesConstraint c a :: Bool where\n  MatchesConstraint c a is True if (c a)\n  MatchesConstraint c a is False otherwise\n</code></pre>\n\n<p>This is problematic because classes are open, so <code>MatchesConstraint c a</code> could evaluate to <code>True</code> for some parts of the program and <code>False</code> in others depending on what instances are in scope, which I imagine could be potentially quite disastrous. </p>\n\n<p>But consider the following:</p>\n\n<pre><code>type family MatchesConstraint c a :: Bool where\n  MatchesConstraint c a is True if (c a)\n  MatchesConstraint c a doesn't reduce otherwise\n</code></pre>\n\n<p>This seems quite safe. In some parts of our program we might fail to reduce if an instance is not in scope, but we'll never have an inconsistency. </p>\n\n<p>Can I make something like this work in GHC?</p>\n\n<p>The reason I'm asking for this, is because one could perhaps select instances based on not just type directly but class. Which could be a useful thing in some contexts I believe. </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1525626287, "post_id": 50200373, "comment_id": 87421384, "body": "<code>zipWith (^) (repeat x) [0..]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525636219, "post_id": 50200373, "comment_id": 87424718, "body": "<code>fix ((1:) . map (x*))</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1467, "user_id": 9718110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gTdLM.jpg?s=128&g=1", "display_name": "ktzr", "link": "https://stackoverflow.com/users/9718110/ktzr"}, "edited": false, "score": 1, "creation_date": 1525615029, "post_id": 50200464, "comment_id": 87417515, "body": "This should work with <code>map</code>, as well <code>fmap</code>. It can be a bit easier to understand if you are not confident about functors."}], "tags": [], "owner": {"reputation": 1959, "user_id": 2520530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MUfpY.jpg?s=128&g=1", "display_name": "Erik Cupal", "link": "https://stackoverflow.com/users/2520530/erik-cupal"}, "is_accepted": false, "score": 4, "last_activity_date": 1525614871, "creation_date": 1525614871, "answer_id": 50200464, "question_id": 50200373, "link": "https://stackoverflow.com/questions/50200373/how-to-do-this-in-haskell-x0-x1-x2-x3/50200464#50200464", "title": "how to do this in haskell ? [x^0,x^1,x^2,x^3 ...]", "body": "<p>Yes, it is pretty easy thing to do in haskell.</p>\n\n<p>You create an infinite stream of positive numbers and then map over them with function <code>n \u21a6 x^n</code></p>\n\n<pre><code>f :: Num a =&gt; a -&gt; [a]\nf x = fmap (\\n -&gt; x^n) [0..]\n\n&gt; take 10 (f 2)\n\n[1,2,4,8,16,32,64,128,256,512]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1525615206, "last_edit_date": 1525615206, "creation_date": 1525615029, "answer_id": 50200486, "question_id": 50200373, "link": "https://stackoverflow.com/questions/50200373/how-to-do-this-in-haskell-x0-x1-x2-x3/50200486#50200486", "title": "how to do this in haskell ? [x^0,x^1,x^2,x^3 ...]", "body": "<p>You can use <code>iterate</code> or <code>unfoldr</code> to double a number many times. This could be more efficient than computing <code>x^n</code> for each <code>n</code>.</p>\n\n<p>Below, I use <code>x=2</code>, but you can use any <code>x</code>.</p>\n\n<pre><code>&gt; take 10 $ iterate (*2) 1\n[1,2,4,8,16,32,64,128,256,512]\n&gt; take 10 $ unfoldr (\\x -&gt; Just (x,2*x)) 1\n[1,2,4,8,16,32,64,128,256,512]\n</code></pre>\n\n<p>Also beware that bounded integer types such as <code>Int</code> will overflow pretty fast in this way.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 2, "last_activity_date": 1525626194, "creation_date": 1525626194, "answer_id": 50202316, "question_id": 50200373, "link": "https://stackoverflow.com/questions/50200373/how-to-do-this-in-haskell-x0-x1-x2-x3/50202316#50202316", "title": "how to do this in haskell ? [x^0,x^1,x^2,x^3 ...]", "body": "<p>In Haskell, the list is linear no matter the progression. By linear, I mean non-recursive. The elements in the list are not dependent on one or more previous elements or an initial element.</p>\n\n<p>In Haskell such lists are used very much. In Haskell there are two primary facilities for producing such lists. The first is <code>map</code> and it is effective without any filtering or recursion.</p>\n\n<pre><code>f b n = map (b^) [0..n]\n</code></pre>\n\n<p>The second is the list comprehension</p>\n\n<pre><code>f b n = [b^x|x&lt;-[0..n]]\n</code></pre>\n\n<p>In both it is simple to set the limit or number of elements in the result. These  could both be made into infinite lists if desired by excluding the <code>n</code> in both the left and right side of the equations.</p>\n"}], "owner": {"reputation": 65, "user_id": 4484634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100005444971752/picture?type=large", "display_name": "Aaron Swartz", "link": "https://stackoverflow.com/users/4484634/aaron-swartz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 50200486, "answer_count": 3, "score": 2, "last_activity_date": 1525626194, "creation_date": 1525614293, "question_id": 50200373, "link": "https://stackoverflow.com/questions/50200373/how-to-do-this-in-haskell-x0-x1-x2-x3", "title": "how to do this in haskell ? [x^0,x^1,x^2,x^3 ...]", "body": "<p>i want to have a list like this one  </p>\n\n<pre><code>[x^0,x^1,x^2,x^3 ...] \n</code></pre>\n\n<p>is it possible  to have such a list </p>\n\n<p>for example  </p>\n\n<pre><code> ex : x = 2   [1,2,4,8,16,32 ..] \n</code></pre>\n"}, {"tags": ["list", "haskell", "monads"], "comments": [{"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1525627523, "post_id": 50200100, "comment_id": 87421830, "body": "@ErikCupal&#39;s answer should serve you well. <code>do</code> notation is not well loved and there are alternatives. One is this that does everything you want, even [x] = []. <code>f ls = [(a,b)| a&lt;-ls,b&lt;-ls, a&#47;=b]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1525646583, "post_id": 50200243, "comment_id": 87427404, "body": "Can also be written using <code>guard</code> from <code>Control.Monad</code>: <code>do { a &lt;- xs; b &lt;- xs; guard (a &#47;= b); pure (a, b); }</code>"}], "tags": [], "owner": {"reputation": 1959, "user_id": 2520530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MUfpY.jpg?s=128&g=1", "display_name": "Erik Cupal", "link": "https://stackoverflow.com/users/2520530/erik-cupal"}, "is_accepted": true, "score": 2, "last_activity_date": 1525613365, "creation_date": 1525613365, "answer_id": 50200243, "question_id": 50200100, "link": "https://stackoverflow.com/questions/50200100/list-of-all-element-pairs-using-list-monad-in-haskell/50200243#50200243", "title": "List of all element pairs using list monad in Haskell", "body": "<p>Using <code>do</code> notation:</p>\n\n<pre><code>pairs :: Eq a =&gt; [a] -&gt; [(a,a)]\npairs xs = do\n  a &lt;- xs\n  b &lt;- xs\n  if a == b\n    then []\n    else return (a, b)\n</code></pre>\n\n<p>and using <code>bind</code> (<code>&gt;&gt;=</code>):</p>\n\n<pre><code>pairs' :: Eq a =&gt; [a] -&gt; [(a,a)]\npairs' xs =\n  xs &gt;&gt;= \\a -&gt;\n    xs &gt;&gt;= \\b -&gt;\n      if a == b\n        then []\n        else [(a, b)]\n</code></pre>\n\n<p>Both of the solutions are equivalent. Do notation is just syntactic sugar for <code>&gt;&gt;=</code> chains.</p>\n"}], "owner": {"reputation": 187, "user_id": 9517321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc52bd738d15863c94b001d51483099?s=128&d=identicon&r=PG&f=1", "display_name": "Aelin", "link": "https://stackoverflow.com/users/9517321/aelin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 50200243, "answer_count": 1, "score": 2, "last_activity_date": 1525613365, "creation_date": 1525612359, "question_id": 50200100, "link": "https://stackoverflow.com/questions/50200100/list-of-all-element-pairs-using-list-monad-in-haskell", "title": "List of all element pairs using list monad in Haskell", "body": "<p>I'm trying to make the function <code>pairs</code> that produces a list of all pairs of <strong>different</strong> elements in a given list, using the list monad. I would like to use <code>&gt;&gt;=</code> or <code>do</code> notation.</p>\n\n<p>Here's what I have at this point:</p>\n\n<pre><code>pairs :: Eq a =&gt; [a] -&gt; [(a,a)]\npairs xs = [ (x,y) | (x:rest) &lt;- tails xs , y &lt;- rest ]\n</code></pre>\n\n<p>Some examples:</p>\n\n<ul>\n<li><code>pairs [1]</code> ==> <code>[]</code></li>\n<li><code>pairs [1,2]</code> ==> <code>[(1,2),(2,1)]</code></li>\n<li><code>pairs [1,2,3]</code> ==> <code>[(1,2),(1,3),(2,1),(2,3),(3,1),(3,2)]</code></li>\n</ul>\n\n<p>I have read <a href=\"https://stackoverflow.com/questions/28191103/iterate-over-all-pair-combinations-without-repetition-in-haskell\">Iterate over all pair combinations without repetition in Haskell\n</a>.</p>\n"}, {"tags": ["list", "haskell", "tuples", "list-comprehension"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1525602562, "post_id": 50198657, "comment_id": 87414011, "body": "Hint: What do you think <code>y &lt;- fst(xs)</code> do? <code>fst(xs)</code> is not even a list."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1525602657, "post_id": 50198657, "comment_id": 87414038, "body": "Besides, <a href=\"https://meta.stackexchange.com/questions/2950/should-hi-thanks-taglines-and-salutations-be-removed-from-posts\">don&#39;t need to say thanks</a>. Upvotes and accepting answers (if any) is better."}, {"owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "edited": false, "score": 0, "creation_date": 1525684394, "post_id": 50198657, "comment_id": 87438357, "body": "For the record: <code>f = foldr (\\(a,b) acc -&gt; a:b:acc) []</code> adds every element of every couple to the accumulator. <code>f [(5,6),(7,8),(9,10)]</code>gives: <code>[5,6,7,8,9,10]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": true, "score": 3, "last_activity_date": 1525646890, "last_edit_date": 1525646890, "creation_date": 1525611424, "answer_id": 50199959, "question_id": 50198657, "link": "https://stackoverflow.com/questions/50198657/haskell-concat-list-of-tuples-using-only-list-comprehensions/50199959#50199959", "title": "Haskell &quot;concat&quot; list of tuples using only list comprehensions", "body": "<p>To flatten any list with a list comprehension, the form is always the same. Take the multiple elements from the source one-at-a-time.</p>\n\n<p>List comprehensions, like functions let you specify and exact pattern of the source, tuple or list.</p>\n\n<p>Your function is not in the form of multiples, one-at-a-time, so correcting it will never give you what you want. It will, at very least require the use of <code>concat</code> to concatenate the output.</p>\n\n<p>Here is the form of a flattening list comprehension</p>\n\n<pre><code>[ n |(a,b)&lt;-[(1,2),(3,4),(5,6)],n &lt;-[a,b]]\n</code></pre>\n\n<p><code>a</code> and <code>b</code> are taken one-at-a-time by <code>n</code>, to flatten.</p>\n"}], "owner": {"reputation": 9, "user_id": 9100798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912dc37f3108986c2e5cef4ad9090ff6?s=128&d=identicon&r=PG&f=1", "display_name": "B.abyface", "link": "https://stackoverflow.com/users/9100798/b-abyface"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1586, "favorite_count": 0, "accepted_answer_id": 50199959, "answer_count": 1, "score": 1, "last_activity_date": 1525646890, "creation_date": 1525602420, "last_edit_date": 1525607301, "question_id": 50198657, "link": "https://stackoverflow.com/questions/50198657/haskell-concat-list-of-tuples-using-only-list-comprehensions", "title": "Haskell &quot;concat&quot; list of tuples using only list comprehensions", "body": "<p>How to change of list of tuples, like </p>\n\n<pre><code>[(5,6),(7,8),(9,10)]\n</code></pre>\n\n<p>into a normal list, like</p>\n\n<pre><code>[5,6,7,8,9,10]\n</code></pre>\n\n<p>via list comprehensions and without <code>concat</code>?</p>\n\n<p>I have tried this:</p>\n\n<pre><code>[ [y, z] | xs &lt;- [(1,2),(3,4)], y &lt;- fst(xs), z &lt;- snd(xs) ]\n</code></pre>\n"}, {"tags": ["haskell", "compiler-errors"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 2, "creation_date": 1525595044, "post_id": 50197631, "comment_id": 87412159, "body": "Have you actually read the error message? There are some clues in it."}, {"owner": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1525595256, "post_id": 50197631, "comment_id": 87412209, "body": "I am missing an import?  Perhaps the Data.Tuple import?  Tried that.  A module header?  Tried that.  Thanks for the help."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1525595314, "post_id": 50197631, "comment_id": 87412225, "body": "@SteveB The magic words are <i>top-level declaration</i>."}, {"owner": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 3, "creation_date": 1525595480, "post_id": 50197631, "comment_id": 87412273, "body": "I am confused.  I don&#39;t see anything in the Haskell textbook I am using or any references on the internets that I understand."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1525595581, "post_id": 50197631, "comment_id": 87412292, "body": "@SteveB Which textbook are you using?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1525596037, "post_id": 50197631, "comment_id": 87412398, "body": "In the mean time, <a href=\"http://haskellbook.com/assets/img/sample.pdf\" rel=\"nofollow noreferrer\">haskellbook.com/assets/img/sample.pdf</a> has some information in &quot;<i>2.2 Interacting with Haskell code</i>&quot;."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1525607801, "post_id": 50197631, "comment_id": 87415394, "body": "@steveB. Your question has been answered, but the point was the compiler was telling you that you need either a import declaration,a module declaration or some top level declaration. You have none of them: expressions are not top level declaration."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525647045, "post_id": 50197631, "comment_id": 87427493, "body": "By the way, when you\u2019re entering things in GHCi, you\u2019re not entering them \u201cin the prelude\u201d\u2014<code>Prelude</code> is the standard library module that\u2019s always imported by default, and the GHCi prompt says <code>Prelude&gt;</code> because by default it lists all imported modules; if you write <code>import Data.Maybe</code> or <code>:module +Data.Maybe</code> then it will show <code>Prelude Data.Maybe&gt;</code>. You can change this prompt using <code>:set prompt</code>\u2014for example, to change it to a lambda without the module list: <code>:set prompt &quot;\u03bb &quot;</code>; to move the module list to a separate line: <code>:set prompt &quot;%s\\n&gt; &quot;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 49, "creation_date": 1525595665, "post_id": 50197721, "comment_id": 87412313, "body": "What did I expect to happen??? I am newbie at Haskell!!!  People on stackoverflow can be just rude."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 2, "creation_date": 1525595773, "post_id": 50197721, "comment_id": 87412338, "body": "@SteveB That was a real question. What <i>did</i> you expect to happen?"}, {"owner": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 7, "creation_date": 1525595982, "post_id": 50197721, "comment_id": 87412384, "body": "I have no expectations.  I thought that statements I enter in prelude can also be included in a .hs Haskell script as is. In the first four chapters of my textbook &quot;Programming in Haskell&quot; by Graham Hutton, it makes no mention (that I can find) about main declaration. Thanks for your help."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 0, "creation_date": 1525596092, "post_id": 50197721, "comment_id": 87412418, "body": "@SteveB I mean, you were not expecting the error you&#39;re getting, so you must have expected something else to happen."}, {"owner": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 0, "creation_date": 1525596159, "post_id": 50197721, "comment_id": 87412434, "body": "I was expecting to see the output from those two statements as I would in the prelude:  1 and 2."}, {"owner": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 0, "creation_date": 1525596512, "post_id": 50197721, "comment_id": 87412541, "body": "Thanks for the reference. It appears that I have to wrap all statements in a print ( ) and include &gt;&gt; before a newline if the next line has a statement.  Is there any other way of having a script file that doesn&#39;t require that?  I basically want to follow along in the book and save the commands I try in a script file for reference."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 1, "creation_date": 1525596565, "post_id": 50197721, "comment_id": 87412556, "body": "@SteveB Definitions (in the form of (multiple) equations) are introduced in chapter one (Introduction). Chapter 2 (&quot;First steps&quot;) introduces ghci and says it can be used to evaluate expressions interactively. Section 2.5 (&quot;Haskell scripts&quot;) says that you can put definitions in a <code>.hs</code> file and load it into ghci to play around with. Nowhere does it imply you can put expressions in files. Unfortunately that&#39;s where my free sample ends, so I don&#39;t know where separate compilation is introduced."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "edited": false, "score": 1, "creation_date": 1525596682, "post_id": 50197721, "comment_id": 87412581, "body": "@SteveB You could have just done <code>valueOne = fst (1,2)</code> and <code>valueTwo = snd (1,2)</code> (or any other names) if all you wanted to do is make the results available in ghci. <code>main</code> is only useful to produce a freestanding executable (when the program is started, the contents of <code>main</code> is what&#39;s executed)."}, {"owner": {"reputation": 683, "user_id": 3208895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9531a7acf89bad418f44ab0f695f6c9c?s=128&d=identicon&r=PG", "display_name": "huw", "link": "https://stackoverflow.com/users/3208895/huw"}, "edited": false, "score": 18, "creation_date": 1534725523, "post_id": 50197721, "comment_id": 90795379, "body": "This answer does come off as a little rude and unforgiving. A user coming from Python could very reasonably expect to just run a file and have it execute."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 683, "user_id": 3208895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9531a7acf89bad418f44ab0f695f6c9c?s=128&d=identicon&r=PG", "display_name": "huw", "link": "https://stackoverflow.com/users/3208895/huw"}, "edited": false, "score": 0, "creation_date": 1534742812, "post_id": 50197721, "comment_id": 90798546, "body": "@huw Even in Python you can&#39;t just put <code>2 + 2</code> in a file and have it print <code>4</code> when executed, even though that&#39;s what happens in the interactive interpreter."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 10, "last_activity_date": 1552074370, "last_edit_date": 1552074370, "creation_date": 1525595293, "answer_id": 50197721, "question_id": 50197631, "link": "https://stackoverflow.com/questions/50197631/haskell-parse-error-module-header-import-declaration-or-top-level-declaration/50197721#50197721", "title": "Haskell: Parse error: module header, import declaration or top-level declaration expected", "body": "<p>You can't just put any expression in a hs file.</p>\n\n<p>As the error message says, you need a declaration here. For example:</p>\n\n<pre><code>main =\n    print (fst (1,2)) &gt;&gt;\n    print (snd (1,2))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 340, "user_id": 5695300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2d1e7702a9cd65ed8b5da02433dc2af?s=128&d=identicon&r=PG&f=1", "display_name": "user4779", "link": "https://stackoverflow.com/users/5695300/user4779"}, "edited": false, "score": 3, "creation_date": 1592711896, "post_id": 53212324, "comment_id": 110520578, "body": "I&#39;m still coming to terms with why no book, tutorial or any other resource I could find said something simple like &quot;to run a script from command prompt/shell, put the program logic in a main = do ...&quot;. Yet this answer right here says it, and now that works. Thanks."}, {"owner": {"reputation": 587, "user_id": 623324, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6e381492a14eff1031e66603bf51baf5?s=128&d=identicon&r=PG", "display_name": "latj", "link": "https://stackoverflow.com/users/623324/latj"}, "edited": false, "score": 0, "creation_date": 1597724850, "post_id": 53212324, "comment_id": 112219648, "body": "Maybe most of the haskell code ever written has never been run ;)"}, {"owner": {"reputation": 1143, "user_id": 5234788, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-osCRG_7XNH0/AAAAAAAAAAI/AAAAAAAADMI/_BOOXObV96k/photo.jpg?sz=128", "display_name": "Ray Oei", "link": "https://stackoverflow.com/users/5234788/ray-oei"}, "edited": false, "score": 0, "creation_date": 1599427917, "post_id": 53212324, "comment_id": 112764837, "body": "This comment (<a href=\"https://stackoverflow.com/questions/50197631/haskell-parse-error-module-header-import-declaration-or-top-level-declaration#comment87412581_50197721\" title=\"haskell parse error module header import declaration or top level declaration%23comment87412581_50197721\">stackoverflow.com/questions/50197631/&hellip;</a>) from @melpomene is exactly &#39;more&#39; true."}], "tags": [], "owner": {"reputation": 4325, "user_id": 143447, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b397983c72fc0400927bd578212b8b5e?s=128&d=identicon&r=PG", "display_name": "Lou Zell", "link": "https://stackoverflow.com/users/143447/lou-zell"}, "is_accepted": false, "score": 24, "last_activity_date": 1541695394, "creation_date": 1541695394, "answer_id": 53212324, "question_id": 50197631, "link": "https://stackoverflow.com/questions/50197631/haskell-parse-error-module-header-import-declaration-or-top-level-declaration/53212324#53212324", "title": "Haskell: Parse error: module header, import declaration or top-level declaration expected", "body": "<p>From a newbie to future newbies: The interactive environment <code>ghci</code> would lead you to believe that you can punch some expressions into an <code>.hs</code> file and run the thing (in a similar fashion to languages like swift and ruby). This is not the case.</p>\n\n<p>Haskell needs an entrypoint called <code>main</code>. Quoting:</p>\n\n<blockquote>\n  <p>Here is a simple program to read and then print a character:</p>\n\n<pre><code>main :: IO ()\nmain =  do c &lt;- getChar\n           putChar c\n</code></pre>\n  \n  <p>The use of the name main is important: main is defined to be the entry point of a Haskell program (similar to the main function in C), and must have an IO type, usually IO ()</p>\n</blockquote>\n\n<p>Source: <a href=\"https://www.haskell.org/tutorial/io.html\" rel=\"noreferrer\">https://www.haskell.org/tutorial/io.html</a></p>\n"}], "owner": {"reputation": 1732, "user_id": 728363, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/KUTag.jpg?s=128&g=1", "display_name": "Steve3p0", "link": "https://stackoverflow.com/users/728363/steve3p0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12250, "favorite_count": 2, "accepted_answer_id": 50197721, "answer_count": 2, "score": 16, "last_activity_date": 1552074370, "creation_date": 1525594623, "question_id": 50197631, "link": "https://stackoverflow.com/questions/50197631/haskell-parse-error-module-header-import-declaration-or-top-level-declaration", "title": "Haskell: Parse error: module header, import declaration or top-level declaration expected", "body": "<p>I am saving some commands in a Haskell script in a .hs file while working thru a Haskell textbook. Here's a small example.</p>\n\n<pre><code>fst (1,2)\nsnd (1,2)\n</code></pre>\n\n<p>When I run these commands from the prelude in GHCi, they work fine. When I try to compile the .hs file with these two lines, I get the following:</p>\n\n<pre><code>ch4_test.hs:2:1: error:\n    Parse error: module header, import declaration\n    or top-level declaration expected.\n  |\n2 | fst (1,2)\n  | ^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>I've googled this error and can't find any explanation what I'm doing wrong.</p>\n"}, {"tags": ["parsing", "haskell", "attoparsec"], "comments": [{"owner": {"reputation": 931, "user_id": 2631185, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75f07727c65d676aa81eeb97b794cfa7?s=128&d=identicon&r=PG", "display_name": "Regis Kuckaertz", "link": "https://stackoverflow.com/users/2631185/regis-kuckaertz"}, "edited": false, "score": 0, "creation_date": 1525599848, "post_id": 50196708, "comment_id": 87413328, "body": "According to your question 1, the sentence separator should rather be &quot;at least two newline characters&quot;, e.g. <code>endOfLine &gt;&gt; many1 endOfLine</code>"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "edited": false, "score": 0, "creation_date": 1525975401, "post_id": 50196708, "comment_id": 87574427, "body": "@ceeks can you change the images for actual text? It would make it easier to help you out."}], "owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1525586883, "creation_date": 1525586554, "last_edit_date": 1525586883, "question_id": 50196708, "link": "https://stackoverflow.com/questions/50196708/parsing-sentences-in-haskell-more-effectively-using-attoparsec", "title": "Parsing sentences in Haskell more effectively using attoparsec", "body": "<p>I'm trying to parse an ebook in .txt form, to learn more about attoparsec and Haskell (I'm a newbie). In this case, I'm trying to count the number of sentences in the given text file. Here's my code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.Attoparsec.Text\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as Txt\nimport Data.List\nimport Control.Applicative ((&lt;*&gt;), (*&gt;), (&lt;$&gt;), (&lt;|&gt;), pure)\n\ndata Prose = Prose {\n  word :: [Char]\n} deriving Show\n\noptional :: Parser a -&gt; Parser ()\noptional p = option () (try p *&gt; pure ())\n\nspecialChars = ['-', '_', '\u2026', '\u201c', '\u201d', '\\\"', '\\'', '\u2019', '@', '#', '$',\n                '%', '^', '&amp;', '*', '(', ')', '+', '=', '~', '`', '{', '}',\n                '[', ']', '/', ':', ';', ',']\n\ninputSentence :: Parser Prose\ninputSentence = Prose &lt;$&gt; many1' (letter &lt;|&gt; digit &lt;|&gt; space &lt;|&gt; satisfy (inClass specialChars))\n\nsentenceSeparator :: Parser ()\nsentenceSeparator = many1 (space &lt;|&gt; satisfy (inClass \".?!\")) &gt;&gt; pure ()\n\nsentenceParser :: String -&gt; [Prose]\nsentenceParser str = case parseOnly wp (T.pack str) of\n    Left err -&gt; error err\n    Right x -&gt; x\n    where\n        wp = optional sentenceSeparator *&gt; inputSentence `sepBy1` sentenceSeparator\n\nmain :: IO()\nmain = do\n  input &lt;- readFile \"test.txt\"\n  let sentences = sentenceParser input\n  print sentences\n  print $ length sentences\n</code></pre>\n\n<p>Click this <a href=\"https://github.com/ceekyay/HaskellParser/blob/master/Main.hs\" rel=\"nofollow noreferrer\">link</a> to the github repo if you want to take a complete look at what I'm doing. \nMy problem is that when I try to parse text file with input: <a href=\"https://i.stack.imgur.com/QGRlc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QGRlc.png\" alt=\"enter image description here\"></a></p>\n\n<p>I get an`output as follows: </p>\n\n<p><a href=\"https://i.stack.imgur.com/LbvHj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LbvHj.png\" alt=\"enter image description here\"></a></p>\n\n<p>So my question is, how can I:</p>\n\n<ol>\n<li>Make the parser realize that anything with \"\\n\\n..\" is a different sentence.</li>\n<li>Input like <code>Daniel G. Brinton</code> is just 1 sentence.</li>\n</ol>\n\n<p>I've tried using <code>isHorizontalSpace</code>, but to no avail. </p>\n"}, {"tags": ["haskell", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "edited": false, "score": 0, "creation_date": 1525580476, "post_id": 50196173, "comment_id": 87409387, "body": "Sorry I should have indicated that I have been using Data.Text and using string &quot;--&quot; would cause an error. But however, I fixed it by using another inClass. You can see my updated post."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "edited": false, "score": 0, "creation_date": 1525580608, "post_id": 50196173, "comment_id": 87409406, "body": "@ceeks <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.2.2/docs/Data-Attoparsec-Text.html#v:string\" rel=\"nofollow noreferrer\"><code>string</code> from <code>Data.Attoparsec.Text</code></a> will work just fine with <code>Data.Text</code>. You may need to use <code>OverloadedStrings</code> or <code>Data.Text.pack</code> to produce a <code>Text</code> value for the argument to <code>Data.Attoparsec.Text.string</code>, but believe me, it really is the function you want."}, {"owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "edited": false, "score": 0, "creation_date": 1525580932, "post_id": 50196173, "comment_id": 87409451, "body": "Thanks for the suggestion and I will do so. But just out of sheer curiosity, what kind of implications/consequences would it have if I used another satisfy (inclass &quot;--&quot;) ?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "edited": false, "score": 0, "creation_date": 1525581085, "post_id": 50196173, "comment_id": 87409465, "body": "@ceeks As I mentioned in my answer, <code>inClass &quot;\u2015\u2015&quot;</code> would be precisely equivalent to <code>inClass [&#39;\u2015&#39;]</code>, so your parser would treat the string <code>\u2015\u2015</code> as two distinct separators, and it would parse a single <code>\u2015</code> as a separator. I assume this isn\u2019t what you want, since if it was, you would just write <code>inClass &quot;\u2015&quot;</code> and be done with it."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 4, "last_activity_date": 1525580040, "creation_date": 1525580040, "answer_id": 50196173, "question_id": 50196120, "link": "https://stackoverflow.com/questions/50196120/error-parsing-a-char-in-haskell/50196173#50196173", "title": "Error parsing a char (\u2015\u2015) in Haskell", "body": "<p>A <code>Char</code> is one character, full stop. <code>\u2015\u2015</code> is two characters, so it is two <code>Char</code>s. You can fit as many <code>Char</code>s as you want into a <code>String</code>, but you certainly cannot fit two <code>Char</code>s into one <code>Char</code>.</p>\n\n<p>Since <code>satisfy</code> considers individual characters at a time, it probably isn\u2019t what you want if you need to parse a sequence of two characters as a single unit. The <code>inClass</code> function just produces a predicate on characters (<code>inClass</code> partially applied to one argument produces a function of type <code>Char -&gt; Bool</code>), so <code>inClass \"\u2015\u2015\"</code> is the same as <code>inClass ['\u2015', '\u2015']</code>, which is just the same as <code>inClass ['\u2015']</code> since duplicates are irrelevant. That won\u2019t help you much.</p>\n\n<p>Consider using <code>string</code> instead of or in combination with <code>inClass</code>, since it is designed to handle <em>sequences</em> of characters. For example, something like this might better suit your needs:</p>\n\n<pre><code>wordSeparator :: Parser ()\nwordSeparator = many1 (space &lt;|&gt; string \"\u2015\u2015\" &lt;|&gt; satisfy (inClass \"?!,:\")) &gt;&gt; pure ()\n</code></pre>\n"}], "owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 50196173, "answer_count": 1, "score": 0, "last_activity_date": 1525580040, "creation_date": 1525579205, "question_id": 50196120, "link": "https://stackoverflow.com/questions/50196120/error-parsing-a-char-in-haskell", "title": "Error parsing a char (\u2015\u2015) in Haskell", "body": "<p>I'm writing a parser to parse huge chunks of English text using attoparsec. Everything has been great so far, except for parsing this char <code>\"\u2015\u2015\"</code>. I know it is just 2 dashes together <code>\"--\"</code>. The weird thing is, the parser catches it in this code:</p>\n\n<pre><code>wordSeparator :: Parser ()\nwordSeparator = many1 (space &lt;|&gt; satisfy (inClass \"\u2015\u2015?!,:\")) &gt;&gt; pure () \n</code></pre>\n\n<p>but not in this case:</p>\n\n<pre><code>specialChars = ['\u2015\u2015', '?', '!', ',', ':']\nwordSeparator :: Parser ()\nwordSeparator = many1 (space &lt;|&gt; satisfy (inClass specialChars)) &gt;&gt; pure ()\n</code></pre>\n\n<p>The reason I'm using the list <code>specialChars</code> is because I have a lot of characters to consider and I apply it multiple cases. And for the input consider: <code>\"I am \u2015\u2015Walt Whitman._\"</code> and the output is supposed to be <code>{\"I\", \"am\", \"Walt\", \"Whiteman.\"}</code> I believe it's mostly because <code>\"\u2015\u2015\"</code> is not a Char? How do I fix this? </p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1525639820, "post_id": 50195063, "comment_id": 87425778, "body": "Instead of pattern synonyms, you could just use a normal data type, i.e. <code>data Stamped a = Stamped UTCTime a</code> and write your <code>Monoid</code> by hand."}], "owner": {"reputation": 1570, "user_id": 31490, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/869963bdf99b541c9f0bbfb04b0320f1?s=128&d=identicon&r=PG", "display_name": "mithrandi", "link": "https://stackoverflow.com/users/31490/mithrandi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1525565465, "creation_date": 1525564715, "last_edit_date": 1525565465, "question_id": 50195063, "link": "https://stackoverflow.com/questions/50195063/timestamped-values", "title": "Timestamped values", "body": "<p>I wanted a type for timestamped values that had an appropriate <code>Semigroup</code> instance (latest value wins). It turns out that <code>Max (Arg UTCTime a)</code> does exactly what I want, but is really awkward to work with directly so I wrote this:</p>\n\n<pre><code>import Data.Semigroup\nimport Data.Thyme ()\nimport Data.Thyme.Clock\n\nnewtype Stamped a =\n  Stamped' (Max (Arg UTCTime a))\n  deriving (Show, Eq, Semigroup, Functor)\n  -- Many other useful classes could be added here\n\npattern Stamped :: UTCTime -&gt; a -&gt; Stamped a\npattern Stamped s v = Stamped' (Max (Arg s v))\n\nunstamp :: Max (Arg a b) -&gt; b\nunstamp (Max (Arg _ v)) = v\n\nstamp :: IO a -&gt; IO (Stamped a)\nstamp a = do\n  ts &lt;- getCurrentTime\n  result &lt;- a\n  pure (Stamped ts result)\n</code></pre>\n\n<p>And some other helpers:</p>\n\n<pre><code>updateStamped :: TVar (Stamped a) -&gt; Stamped a -&gt; STM ()\nupdateStamped v n = modifyTVar v (&lt;&gt; n)\n\nupdateStamped' :: TVar (Stamped a) -&gt; Stamped a -&gt; STM ()\nupdateStamped' v n = modifyTVar' v (&lt;&gt; n)\n</code></pre>\n\n<p>Is there a better way to do this? I haven't seen pattern synonyms used with a newtype like this so I feel like I missed something more idiomatic.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1525562105, "post_id": 50194695, "comment_id": 87406707, "body": "Concatenate the string with itself and output chunks of three, advancing the beginning by one each time."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 5, "creation_date": 1525562506, "post_id": 50194695, "comment_id": 87406774, "body": "<code>\\xs -&gt; zipWith (const (take 3)) xs (tails (cycle xs))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9746904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LfdNU.jpg?s=128&g=1", "display_name": "Maximepzv", "link": "https://stackoverflow.com/users/9746904/maximepzv"}, "edited": false, "score": 0, "creation_date": 1525599945, "post_id": 50196495, "comment_id": 87413349, "body": "Works great, thanks you! I added map (take n) (cyclicPerms s) to make this with an arbitrary number to take only the n firsts caracters"}], "tags": [], "owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "is_accepted": true, "score": 2, "last_activity_date": 1525584466, "last_edit_date": 1525584466, "creation_date": 1525584120, "answer_id": 50196495, "question_id": 50194695, "link": "https://stackoverflow.com/questions/50194695/build-a-specific-list-of-string-from-a-string-in-haskell/50196495#50196495", "title": "Build a specific list of string from a string in Haskell", "body": "<p>Let's start with a list, <code>[1..4]</code>. Let's repeat it for eternity:</p>\n\n<pre><code>&gt;&gt;&gt; cycle [1..4]\n[1,2,3,4,1,2,3,4,1,2,3,4,...\n</code></pre>\n\n<p>Now let's take a slice of it, at say, the 2nd index:</p>\n\n<pre><code>&gt;&gt;&gt; take 4 $ drop (2-1) $ cycle [1..4]\n[2,3,4,1]\n</code></pre>\n\n<p>We can generalize this by naming a function:</p>\n\n<pre><code>slice n = take 4 $ drop n $ cycle [1..4]\n</code></pre>\n\n<p>To obtain all possible cyclic permutations, we only need to sample n from 1 to 4:</p>\n\n<pre><code>&gt;&gt;&gt; map slice [1..4]\n[[2,3,4,1],[3,4,1,2],[4,1,2,3],[1,2,3,4]]\n</code></pre>\n\n<hr>\n\n<p>Now, how can we make this work with an arbitrary string? Let's redefine slice to accept a string:</p>\n\n<pre><code>slice s n = take (length s) $ drop n $ cycle s\n</code></pre>\n\n<p>And so our cyclic permutations function can be defined as follows:</p>\n\n<pre><code>cyclicPerms s = map (slice s) [1..(length s)]\n</code></pre>\n\n<p>Testing:</p>\n\n<pre><code>&gt;&gt;&gt; cyclicPerms \"abcde\"\n[\"bcdea\",\"cdeab\",\"deabc\",\"eabcd\",\"abcde\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1527099185, "last_edit_date": 1527099185, "creation_date": 1525712651, "answer_id": 50219201, "question_id": 50194695, "link": "https://stackoverflow.com/questions/50194695/build-a-specific-list-of-string-from-a-string-in-haskell/50219201#50219201", "title": "Build a specific list of string from a string in Haskell", "body": "<p>I had originally posted an answer totally misunderstanding the specification. I, like a Haskell enumeration, read only the first two numbers so I thought it continued as such. Oops. In any event I just adapted a <code>chunks</code> function I wrote to produce the repetitions. When I get home, I think I have another that cycles lists. I'll post it as well if it's not the same. Who knows.</p>\n\n<p>This function allows you to specify the chunk size as well as the list.</p>\n\n<pre><code>cychnks n ls = [take n.drop x$ls2|(x,y) &lt;-zip [0..] ls]\n                where ls2 = ls++ls\n\ncychnks 5 \"abcde\"\n</code></pre>\n\n<p>[\"abcde\",\"bcdea\",\"cdeab\",\"deabc\",\"eabcd\"]</p>\n\n<pre><code>cychnks 3 \"abcde\"\n</code></pre>\n\n<p>[\"abc\",\"bcd\",\"cde\",\"dea\",\"eab\"]</p>\n"}], "owner": {"reputation": 3, "user_id": 9746904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LfdNU.jpg?s=128&g=1", "display_name": "Maximepzv", "link": "https://stackoverflow.com/users/9746904/maximepzv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 50196495, "answer_count": 2, "score": 0, "last_activity_date": 1527099185, "creation_date": 1525560619, "last_edit_date": 1525567628, "question_id": 50194695, "link": "https://stackoverflow.com/questions/50194695/build-a-specific-list-of-string-from-a-string-in-haskell", "title": "Build a specific list of string from a string in Haskell", "body": "<p>I'm starting learning haskell and i'm stuck in a problem.</p>\n\n<p>I read from the standard input a string like <code>\"1234\"</code> or <code>\"azer\"</code> \nand I want to make a list like <code>[\"123\", \"234\", \"341\", \"412\"]</code> or <code>[\"aze\", \"zer\", \"era\", \"raz\"]</code>.</p>\n\n<p>I probably must use <code>map</code> but i don't know how to proceed.\nIs someone can help me to do that ? Thanks</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1525559288, "post_id": 50194076, "comment_id": 87406196, "body": "For examples of combinators, see things like <code>over</code>, <code>view</code>, <code>preview</code>, <code>set</code>, <code>toListOf</code>, <code>sequenceOf</code>, etc."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525560506, "post_id": 50194076, "comment_id": 87406430, "body": "All those super-classes are there because the whole idea of <code>Conjoined</code> is that it&#39;s either a function or an indexed function, and in either case those instances are all available. It&#39;s not the most principled thing."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1525562354, "post_id": 50194076, "comment_id": 87406741, "body": "@JustinL.. <code>over</code>, <code>set</code>, <code>toListOf</code> all have their indexed counterparts, not sure about the others."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525562506, "post_id": 50194076, "comment_id": 87406773, "body": "@dfeuer, yes, but why are they needed? You don&#39;t write something, because you can. You write something for a reason. Just because you can use <code>Indexable</code> somewhere downstream and need <code>MonadFix</code> for whatever reason? I&#39;d rather prefer to see where exactly this is needed rather than permit to use those instances in every function that has the <code>Indexable</code> constraint."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1525563483, "post_id": 50194076, "comment_id": 87406954, "body": "Edward Kmett has explicitly told me that <code>Conjoined</code> has all those superclasses because it can. The fact that you don&#39;t like that reasoning does not mean it&#39;s wrong."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525564072, "post_id": 50194076, "comment_id": 87407057, "body": "@dfeuer, it&#39;s just strange to <a href=\"http://fvisser.nl/post/2013/okt/11/why-i-dont-like-the-lens-library.html\" rel=\"nofollow noreferrer\">scare people</a> with all those classes, just because you can write them. I mean, I have never seen this reasoning, is it applied somewhere else too? I thought it&#39;s more like &quot;because that maximally constrains the class, so it&#39;s clearer that there aren&#39;t many instances&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525576588, "post_id": 50194076, "comment_id": 87408898, "body": "@user3237465, the <code>Comonad (Rep p)</code> superclass certainly gets a lot of use. The <code>Category p</code> superclass is nice to have too, as is the <code>Profunctor p</code> one. I&#39;m not really sure which of them are used &quot;in the wild&quot;. I think generally <code>Conjoined</code> is a rather peculiar thing to have, but it apparently exists for practical efficiency and convenience reasons rather than any theoretical ones."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1525682263, "post_id": 50194076, "comment_id": 87437075, "body": "@user3237465 <code>over</code> has an indexed counterpart, but you can still use indexed lenses with <code>over</code> if you want to ignore the index.  If the library was designed differently, <code>over</code> wouldn&#39;t work as an index-ignoring over for indexed lenses."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1525682383, "post_id": 50194076, "comment_id": 87437150, "body": "@user3237465 <code>folded</code> uses this trick; it&#39;s technically an indexed fold, but it can be used as if it were a normal fold.  So in defining <code>folded</code>, you can have both a normal fold and an indexed fold, and users using it as a normal fold wouldn&#39;t even know."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1525695184, "post_id": 50194076, "comment_id": 87444645, "body": "@JustinL., but then <code>iover</code> is not a cut name. Also the other my questions are exactly about why do I want to use <code>over</code> over an indexed lens. Thanks for the <code>folded</code> example, it&#39;s indeed a cut name. Here are a couple of others: <code>worded</code>, <code>lined</code>. I checked all matches of <code>IndexedFold</code> and <code>IndexedLensLike</code> in <code>Control.Lens.Fold</code> and do not see other such functions. I&#39;d rather prefer to have <code>folded</code> and <code>ifolded</code>, but <code>worded</code> and <code>lined</code> seem nice, also I think there just should be a combinator for recovering indices in plain folds."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525698477, "post_id": 50194076, "comment_id": 87446666, "body": "@dfeuer, I do not think it&#39;s a bad class: efficiency concerns are as important as theoretical ones. I think that without <code>distrib</code> and that pile of superclasses it would be clearer (unless it doesn&#39;t make sense to remove something from the class, of course). It&#39;s &quot;practical&quot;, but it looks &quot;theoretical&quot; and intimidating."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525719154, "post_id": 50194076, "comment_id": 87458509, "body": "I&#39;m not really sure what <code>distrib</code> is for, or why there isn&#39;t a <code>contradistrib :: Contravariant f =&gt; p a b -&gt; p (f b) (f a)</code>, but it&#39;s pretty simple."}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1525554779, "creation_date": 1525554779, "question_id": 50194076, "link": "https://stackoverflow.com/questions/50194076/why-are-indexed-lenses-defined-the-way-they-are", "title": "Why are indexed lenses defined the way they are?", "body": "<p>There are some very helpful explanations in <a href=\"https://www.reddit.com/r/haskell/comments/1o6iqs/why_i_dont_like_the_lens_library/ccpc2fd/\" rel=\"noreferrer\">this reddit thread</a> of how indexed lenses are defined, but I'd like to know the details.</p>\n\n<p>So the main point is that indexed lenses are defined such that they can be treated as non-indexed ones too. These two classes are responsible for that:</p>\n\n<pre><code>class (Choice p, Corepresentable p,\n       Comonad (Corep p), Traversable (Corep p),\n       Strong p, Representable p, Monad (Rep p),\n       MonadFix (Rep p), Distributive (Rep p),\n       ArrowLoop p, ArrowApply p, ArrowChoice p\n       ) =&gt; Conjoined p where\n  distrib :: Functor f =&gt; p a b -&gt; p (f a) (f b)\n  conjoined :: (p ~ (-&gt;) =&gt; q (a -&gt; b) r) -&gt; q (p a b) r -&gt; q (p a b) r\n\nclass Conjoined p =&gt; Indexable i p where\n  indexed :: p a b -&gt; i -&gt; a -&gt; b\n</code></pre>\n\n<p>Questions:</p>\n\n<p>0) Why is it useful to treat indexed lenses as non-indexed ones? Edward (see the link above) says</p>\n\n<blockquote>\n  <p>This let us cut out 30+ combinator names and let us share one combinator for the indexed and unindexed versions of most operations.</p>\n</blockquote>\n\n<p>What are those combinators? I'd appreciate a few examples.</p>\n\n<p>No matter how <code>Conjoined</code> is smart, I guess it's still more efficient (no need to prey for full inlining so dictionaries are not passed around) and flexible to use non-indexed optics when possible. And indeed I see this:</p>\n\n<pre><code>-- If you don't need access to the index, then 'mapped' is more flexible in what it accepts.\nimapped :: IndexedSetter i (f a) (f b) a b\n</code></pre>\n\n<p>(Since it's <code>class Functor f =&gt; FunctorWithIndex i f | f -&gt; i</code> would it be better to replace the <code>imap (const id) \u2261 id</code> law with the <code>imap (const f) \u2261 fmap f</code> one?)</p>\n\n<p>The <code>itraversed . itraversed</code> behavior which ignores the former index and returns the latter looks rather implicit and confusing to me. And this complicates type inference and errors. Also, I saw somewhere that <code>traversed . traversed</code> doesn't work for some definition of \"work\", is this correct?</p>\n\n<p>Should I write only indexed optics for my library and be fine with it or is it still required to provide both indexed and non-indexed variants of combinators?</p>\n\n<p>1) <code>Conjoin</code> is a very neat trick, but it's far from being obvious and it's underdocumented. I suppose, some people who define their own indexed optics combinators (is it common?) do not know they should use <code>conjoin</code>. Is it possible to enforce the usage of <code>conjoin</code> somehow?</p>\n\n<p>Are even <code>MonadFix (Rep p)</code> and <code>ArrowLoop p</code> constraints required for <code>Conjoin</code> to work? What is <code>distrib</code> for? How does it relate to <code>Mapping</code>?</p>\n\n<pre><code>class (Traversing p, Closed p) =&gt; Mapping p where\n  map' :: Functor f =&gt; p a b -&gt; p (f a) (f b)\n</code></pre>\n\n<p>What is the <code>Conjoined ReifiedGetter</code> instance for?</p>\n\n<p>2) Is there a less ad hoc structure than <code>Indexable</code>? Say, something like</p>\n\n<pre><code>class Functor f =&gt; StarLike p f | p -&gt; f where\n  runStarLike :: p a b -&gt; a -&gt; f b\n\ntype Indexable i p = (Conjoined p, StarLike p ((-&gt;) i)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "edited": false, "score": 1, "creation_date": 1525547221, "post_id": 50193055, "comment_id": 87403159, "body": "I&#39;m quite new around here, so if someone could explain why the question received a downvote it would be nice, so I don&#39;t make the same mistake twice"}, {"owner": {"reputation": 1645, "user_id": 249900, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/V2Y3F.jpg?s=128&g=1", "display_name": "J. Martin", "link": "https://stackoverflow.com/users/249900/j-martin"}, "edited": false, "score": 1, "creation_date": 1525549943, "post_id": 50193055, "comment_id": 87403998, "body": "I honestly don&#39;t know why, maybe someone doesn&#39;t like Haskell, the question seems fine to me, though I am not sure how to answer it. Good luck, and welcome to Stack Overflow :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525582339, "post_id": 50193055, "comment_id": 87409659, "body": "I don&#39;t think your circular permutation test is right. What if <code>string2</code> is <code>&quot;abcabc&quot;</code>?"}, {"owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "edited": false, "score": 0, "creation_date": 1525616340, "post_id": 50193055, "comment_id": 87417913, "body": "Yes you are right, I should have pointed out that I have other tests before that one that check that every element of the list are the same size (working with debruijn sequence of size alphabetsize^order) I&#39;m going to edit the question to specify that. Thank you"}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525647567, "post_id": 50193762, "comment_id": 87427592, "body": "Just as an aside, you can factor out some repetition here: <code>if sequence `isInfixOf` sequenceconc then cleanInfix sequence xs (delete x cleanlist) else cleanInfix sequence xs cleanlist</code> can be written <code>cleanInfix sequence xs $ if sequence `isInfixOf` sequenceconc then delete x cleanlist else cleanlist</code> or even <code>cleanInfix sequence xs $ (if sequence `isInfixOf` sequenceconc then delete x else id) cleanlist</code>."}], "tags": [], "owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "is_accepted": false, "score": 0, "last_activity_date": 1525552268, "creation_date": 1525552268, "answer_id": 50193762, "question_id": 50193055, "link": "https://stackoverflow.com/questions/50193055/haskell-filter-out-circular-permutations/50193762#50193762", "title": "Haskell filter out circular permutations", "body": "<p>The wonders you can make with a pen and some paper...</p>\n\n<p>So if anyone is interested here is how I solved it, it's probably badly optimised but at least it works (I'm just trying to learn haskell, so it's good enough for now)</p>\n\n<pre><code>-- cleanInfix function\ncleanInfix :: String -&gt; [String] -&gt; [String] -&gt; [String]                                                                    \ncleanInfix sequence [] cleanlist = cleanlist                                                                           \ncleanInfix sequence (x:xs) cleanlist = do \n-- this is where I check for the circular permuation                                                                                  \n  let sequenceconc = x ++ x                                                                                                   \n  if sequence `isInfixOf` sequenceconc                                                                                        \n    then cleanInfix sequence xs (delete x cleanlist)                                                                        \n    else cleanInfix sequence xs cleanlist                                                                                   \n\n\n-- checkClean Function\ncheckClean :: [String] -&gt; [String] -&gt; [String] -&gt; [String]                                                                  \ncheckClean [] listesend cleanlist = cleanlist                                                                            \ncheckClean (x:xs) listesend cleanlist = do\n-- The first delete is to avoid checking if an element is the circular permuation of... itself, because it obviously is... in some way                                                                                  \n  let liste2 = cleanInfix x (delete x listesend) cleanlist                                                                  \n  checkClean xs (delete x listesend) liste2 \n\n\n -- Clean function, first second and third are the command line argument don't worry about them                                                                                                                        \nclean first second third = do                                                                                                 \n  -- create of the result list by asking user for input\n\n  let printlist = checkClean result result result -- yes, it's the same list, three times                                                                            \n  print printlist -- print the list\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": true, "score": 0, "last_activity_date": 1525774681, "last_edit_date": 1525774681, "creation_date": 1525727389, "answer_id": 50222462, "question_id": 50193055, "link": "https://stackoverflow.com/questions/50193055/haskell-filter-out-circular-permutations/50222462#50222462", "title": "Haskell filter out circular permutations", "body": "<p>I guess you call your initial code (question) with something like that:</p>\n\n<pre><code>result = [\"NUUNNFFUF\", \"FFUFNUUNN\"]\nmain = do\n    checkClean result result\n</code></pre>\n\n<p>It won't print anything because:</p>\n\n<ul>\n<li>the first call of <code>cleanInfix</code> has the arguments following arguments: <code>\"NUUNNFFUF\"</code> and <code>[\"NUUNNFFUF\", \"FFUFNUUNN\"]</code></li>\n<li>in <code>cleanInfix</code>, since <code>seq == x</code>  you have a recursive call with the following arguments: <code>\"NUUNNFFUF\"</code> and <code>[\"FFUFNUUNN\"]</code></li>\n<li>now, <code>\"NUUNNFFUF\"</code> is a real permutation of <code>\"FFUFNUUNN\"</code>: <code>cleanInfix</code> returns <code>\"abortmath\"</code>, and <code>checkClean</code> returns <code>()</code></li>\n<li>then you have a recursive call of <code>checkClean</code> with following arguments: <code>\"FFUFNUUNN\"</code> and <code>[\"NUUNNFFUF\", \"FFUFNUUNN\"]</code></li>\n<li>again, <code>\"FFUFNUUNN\"</code> is a real permutation of <code>\"NUUNNFFUF\"</code>: <code>cleanInfix</code> returns <code>\"abortmath\"</code>, and <code>checkClean</code> returns <code>()</code></li>\n<li>this is the end.</li>\n</ul>\n\n<p>Basically, x is a permutation of y and y is a permutation of x, thus x and y are discarded.</p>\n\n<p>Your answer works, but it is horribly complicated. </p>\n\n<p>I won't try to improve either of your codes, but I will make a general comment: you should (you <em>really</em> should) avoid returning a monad when you don't need to: in the question, <code>checkClean</code> just needs to remove duplicates (or \"circular duplicates\") from a list. That's totally functional: you have all the information you need. Thus, remove those <code>do</code>s, <code>let</code>s and <code>return</code>s!</p>\n\n<p>Now, let's try to focus on this:</p>\n\n<blockquote>\n  <p>You have a list with N elements You only want to print elements that are not circular permuations of other elements of the same list</p>\n</blockquote>\n\n<p>Why don't you use your initial knowledge on circular permutations?</p>\n\n<pre><code>isCircPermOf x y = x `isInfixOf` (y ++ y)\n</code></pre>\n\n<p>Now, you need  a function that takes a sequence and a list of sequences, and return only the elements of the second that are not circular permutations of the first :</p>\n\n<pre><code>filterCircDuplicates :: String -&gt; [String] -&gt; [String]\nfilterCircDuplicates seq [] = []\nfilterCircDuplicates seq (x:xs) =\n    if seq `isCircPermOf` x\n    then removeCircDuplicates seq xs\n    else x:removeCircDuplicates seq xs\n</code></pre>\n\n<p>This pattern is well know, and you can use <code>filter</code> to simplify it:</p>\n\n<pre><code>filterCircDuplicates seq l = filter (\\x -&gt; !seq `isCircPermOf` x) l\n</code></pre>\n\n<p>Or better:</p>\n\n<pre><code>filterCircDuplicates seq = filter (not.isCircPermOf seq) \n</code></pre>\n\n<p>Note the signature: <code>not.isCircPermOf seq :: String -&gt; Boolean</code>. It returns true if the current element is not a circular permutation of <code>seq</code>. (You don't have to add the list argument.)</p>\n\n<p>Final step: you need a function that takes a list and return this list without (circular) duplicates.</p>\n\n<pre><code>removeCircDuplicates :: [String] -&gt; [String]\nremoveCircDuplicates [] = []\nremoveCircDuplicates (x:xs) = x:filterCircDuplicates x (removeCircDuplicates xs)\n</code></pre>\n\n<p>When your list has a head and a tail, you clean the tail, then remove the duplicates of the first element of the tail, and keep this first element.</p>\n\n<p>Again, you have a well known pattern, a <code>fold</code>:</p>\n\n<pre><code>removeCircDuplicates = foldr (\\x acc -&gt; x:filterCircDuplicates x acc) []\n</code></pre>\n\n<p>It removes the duplicates from right to left.</p>\n\n<p>And if you want a one-liner:</p>\n\n<pre><code>Prelude Data.List&gt; foldr (\\x -&gt; ((:) x).filter(not.(flip isInfixOf (x++x)))) [] [\"abcd\", \"acbd\", \"cdab\", \"abdc\", \"dcab\"]\n[\"abcd\",\"acbd\",\"abdc\"]\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 50222462, "answer_count": 2, "score": 5, "last_activity_date": 1525774681, "creation_date": 1525546971, "last_edit_date": 1525616411, "question_id": 50193055, "link": "https://stackoverflow.com/questions/50193055/haskell-filter-out-circular-permutations", "title": "Haskell filter out circular permutations", "body": "<p>You have a list with N elements\nYou only want to print elements that are not circular permuations of other elements of the same list</p>\n\n<p>To check if two strings are the circular permutations of each other I do this, which works fine :</p>\n\n<pre><code>string1 = \"abc\"\nstring2 = \"cab\"\nstringconc = string1 ++ string1\nif string2 `isInfixOf` stringconc\nthen -- it's a circular permuation\nelse -- it's not\n</code></pre>\n\n<p>Edit : As one comment pointed that out, this test only work for strings of the same size</p>\n\n<p>Back to the real use case :</p>\n\n<pre><code>checkClean :: [String] -&gt; [String] -&gt; IO String\ncheckClean [] list = return \"\"\ncheckClean (x:xs) list = do\nlet sequence = cleanInfix x list\n  if sequence /= \"abortmath\"\n    then putStr sequence\n    else return ()\n  checkClean xs list\n</code></pre>\n\n<p>cleanInfix :</p>\n\n<pre><code>cleanInfix :: String -&gt; [String] -&gt; String\ncleanInfix seq [] = seq\ncleanInfix seq (x:xs) = do\n  let seqconc = x ++ x\n  if seq `isInfixOf` seqconc &amp;&amp; seq /= x\n    then \"abortmath\"\n    else cleanInfix seq xs\n</code></pre>\n\n<p>However this just outputs... nothing\nWith some research I found out that sequence in checkClean is always \"abortmath\" \nAlso I'm not quite comfortable with this \"flag\" abortmath, because if by any chance one element of the list is \"abortmath\", well.. </p>\n\n<p>For example : \nif I have a list composed of :</p>\n\n<pre><code>NUUNNFFUF\nFFUFNUUNN\n</code></pre>\n\n<p>I should write \nNUUNNFFUF</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": true, "score": 9, "last_activity_date": 1525547300, "creation_date": 1525547300, "answer_id": 50193090, "question_id": 50193020, "link": "https://stackoverflow.com/questions/50193020/error-not-in-scope-type-variable-haskell/50193090#50193090", "title": "error: Not in scope: type variable [Haskell]", "body": "<p>According to the <a href=\"https://wiki.haskell.org/Data_declaration_with_constraint\" rel=\"noreferrer\">Haskell wiki</a></p>\n\n<blockquote>\n  <p>In Haskell 98, only functions can have type constraints.</p>\n</blockquote>\n\n<p>In order to do what you want, you can declare <code>Polynomial</code> with a type parameter. Then you write functions with the appropriate type constraints.</p>\n\n<pre><code>data Polynomial a = Polynomial xs\n    deriving (Show)\n</code></pre>\n\n<p>This allows you to construct concrete polynomial types such as <code>Polynomial Int</code> or <code>Polynomial Float</code> or even <code>Polynomial String</code>. A function which operates on your <code>Polynomial</code> type can declare constraints on the type parameter. For example a function to add two polynomials can have the following signature:</p>\n\n<pre><code>(+) :: (Num a) =&gt; Polynomial a -&gt; Polynomial a -&gt; Polynomial a\n</code></pre>\n\n<p>Rinse and repeat as appropriate for each function.</p>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 8565175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5jYdIxZdMlY/AAAAAAAAAAI/AAAAAAAAACU/e_9FLrZl0Og/photo.jpg?sz=128", "display_name": "Brandon Chinn", "link": "https://stackoverflow.com/users/8565175/brandon-chinn"}, "is_accepted": false, "score": 0, "last_activity_date": 1544038828, "creation_date": 1544038828, "answer_id": 53639577, "question_id": 50193020, "link": "https://stackoverflow.com/questions/50193020/error-not-in-scope-type-variable-haskell/53639577#53639577", "title": "error: Not in scope: type variable [Haskell]", "body": "<p>If you have access to the <code>ExistentialQuantification</code> language extension, you can do this:</p>\n\n<pre><code>data Polynomial = forall a. Num a =&gt; Polynomial { xs :: [a] }\n</code></pre>\n\n<p>You can also derive Show with <code>StandaloneDeriving</code>:</p>\n\n<pre><code>data Polynomial = forall a. (Show a, Num a) =&gt; Polynomial { xs :: [a] }\nderiving instance Show Polynomial\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 4484634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100005444971752/picture?type=large", "display_name": "Aaron Swartz", "link": "https://stackoverflow.com/users/4484634/aaron-swartz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 0, "accepted_answer_id": 50193090, "answer_count": 2, "score": 3, "last_activity_date": 1544038828, "creation_date": 1525546684, "question_id": 50193020, "link": "https://stackoverflow.com/questions/50193020/error-not-in-scope-type-variable-haskell", "title": "error: Not in scope: type variable [Haskell]", "body": "<p>i want a list of numerical values in my data type </p>\n\n<p><code>data Polynomial = Polynomial {xs ::(Num a) =&gt; [a] } deriving (Show)</code> </p>\n\n<p>but i'm still getting this  Error </p>\n\n<pre><code>error: Not in scope: type variable \u2018a\u2019\n</code></pre>\n"}, {"tags": ["haskell", "gtk", "cairo"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1525555176, "post_id": 50192550, "comment_id": 87405373, "body": "It\u2019s been a while since I programmed gtk. It might be that you can only drwa from <code>onWidgetDraw</code>, and you use <a href=\"https://developer.gnome.org/gtk3/stable/GtkWidget.html#gtk-widget-queue-draw\" rel=\"nofollow noreferrer\">Gtk.widgetQueueDraw</a> on the widget to trigger the drawing. This makes sense because the UI always has to be able to redraw the window, so whatever you would draw in <code>onWidgetKeyPressEvent</code>, if you could, would get lost when the user resizes the window or so."}], "answers": [{"comments": [{"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1525594459, "post_id": 50195480, "comment_id": 87411999, "body": "I&#39;m not saying you are wrong, but I have found the following functions which might add something to your answer <a href=\"https://hackage.haskell.org/package/gi-gtk-3.0.22/docs/GI-Gtk-Functions.html#g:16\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/gi-gtk-3.0.22/docs/&hellip;</a>    <a href=\"https://hackage.haskell.org/package/gi-gtk-3.0.22/docs/GI-Gtk-Functions.html#g:17\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/gi-gtk-3.0.22/docs/&hellip;</a>"}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1525597039, "post_id": 50195480, "comment_id": 87412676, "body": "Drawing events are triggered only when I expose or resize window. I need to figure out how to trigger drawing event on a keypress"}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1525604949, "post_id": 50195480, "comment_id": 87414586, "body": "In my key press event I can say Gtk.widgetQueueDraw canvas and force calling redraw of the widget. Not I need to figure out the global state."}, {"owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1525609039, "post_id": 50195480, "comment_id": 87415713, "body": "<a href=\"https://developer.gnome.org/gtk3/stable/GtkWidget.html#GtkWidget-draw\" rel=\"nofollow noreferrer\">Documentation for C</a> please note that <code>user_data</code> which can be a pointer to anywhere, where you can store different values"}, {"owner": {"reputation": 1444, "user_id": 6062567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e87060f0ce67ed68a097ac5186027c5?s=128&d=identicon&r=PG&f=1", "display_name": "oldtechaa", "link": "https://stackoverflow.com/users/6062567/oldtechaa"}, "edited": false, "score": 0, "creation_date": 1525663607, "post_id": 50195480, "comment_id": 87430432, "body": "+1. This is right. <code>queue_draw</code> (or <code>Gtk.widgetQueueDraw</code>) is also the right thing to use. I&#39;m not familiar with Haskell, but in other languages, a typical solution might be using a global variable to handle state."}], "tags": [], "owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "is_accepted": true, "score": 2, "last_activity_date": 1525571320, "last_edit_date": 1525571320, "creation_date": 1525570073, "answer_id": 50195480, "question_id": 50192550, "link": "https://stackoverflow.com/questions/50192550/how-do-i-draw-on-drawingarea-widget-using-cairo/50195480#50195480", "title": "How do I draw on drawingArea widget using Cairo?", "body": "<p>Simply put, you can't. You will not have access to the drawing context outside of the <code>onWidgetDraw</code> callback.<br><br>\nWhat you can (and should) do is to use a global state to allow your <code>onWidgetDraw</code> callback to draw different things depending on what happens. For example, if you want to draw some text when the user press the right arrow:</p>\n\n<ul>\n<li>In the <code>onWidgetKeyPressEvent</code> callback, set a value in your global state when the user presses the selected key</li>\n<li>In the <code>onWidgetDraw</code> callback, use that value to determine if you have to draw the text or not.<br><br>\nIdeally, you'd try to fit your state in a State Monad or something similar - however, in this specific case, Gtk doesn't allow injecting Monadic state itself, so this is not directly possible. You have to resort to <code>IORef</code>s, <code>TVar</code>s or any equivalent.<br><br>\nGood luck! :)</li>\n</ul>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 50195480, "answer_count": 1, "score": 2, "last_activity_date": 1525571320, "creation_date": 1525543469, "last_edit_date": 1525544971, "question_id": 50192550, "link": "https://stackoverflow.com/questions/50192550/how-do-i-draw-on-drawingarea-widget-using-cairo", "title": "How do I draw on drawingArea widget using Cairo?", "body": "<p>I have this little project where I try to use gi-gtk to draw on a window.</p>\n\n<p><a href=\"https://github.com/bigos/cairo-example/blob/b9480dc63d6fff3bc195d35c7422f193fc8ae7d4/src/Main.hs\" rel=\"nofollow noreferrer\">https://github.com/bigos/cairo-example/blob/b9480dc63d6fff3bc195d35c7422f193fc8ae7d4/src/Main.hs</a></p>\n\n<p>I have figured out how to make gi-gtk work with Cairo.</p>\n\n<p><a href=\"https://github.com/haskell-gi/haskell-gi/wiki/Using-Cairo-with-haskell-gi-generated-bindings\" rel=\"nofollow noreferrer\">https://github.com/haskell-gi/haskell-gi/wiki/Using-Cairo-with-haskell-gi-generated-bindings</a></p>\n\n<p>But I have a problem with obtaining cairo context. In the following code I have two events. The first event works fine. But I can't figure out how to get the cairo context needed for drawing on canves when I listen to key presses on window object.</p>\n\n<pre><code>  win &lt;- Gtk.windowNew WindowTypeToplevel\n  canvas &lt;- Gtk.drawingAreaNew\n  Gtk.containerAdd win canvas\n\n  _ &lt;- Gtk.onWidgetDraw canvas $ \\context -&gt;\n    renderWithContext context (updateCanvas canvas) &gt;&gt; pure True\n\n  _ &lt;- Gtk.onWidgetKeyPressEvent win $ \\x -&gt; do\n    vvv &lt;- Gdk.getEventKeyKeyval x\n    -- How do I draw on canvas here?\n    (putStrLn (\"You have pressed key code \" ++  (show vvv))) &gt;&gt; pure True\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1525609337, "post_id": 50191914, "comment_id": 87415802, "body": "Keeping it in the comprehension <code>[(a,b,c)| p&lt;-[[1..3]], a&lt;-p,b&lt;-p,c&lt;-p]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525544531, "post_id": 50192037, "comment_id": 87402317, "body": "I like the comprehension with <code>let</code> and <code>(,,) &lt;$&gt; xs &lt;*&gt; xs &lt;*&gt; xs</code> = <code>liftA3 (,,) xs xs xs</code> the most. Another needlessly clever trick is to use the <code>(-&gt;)</code> applicative and list applicative together to make a point-free version, <code>join (join (liftA3 (,,))) [1..3]</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1525540208, "creation_date": 1525540208, "answer_id": 50192037, "question_id": 50191914, "link": "https://stackoverflow.com/questions/50191914/generating-tuples-using-list-comprehension/50192037#50192037", "title": "Generating tuples using list comprehension", "body": "<p>A few alternatives</p>\n\n<pre><code>let xs = [1..3] in [(a,b,c) | a &lt;- xs, b &lt;- xs, c &lt;- xs]\n[(a,b,c) | let xs = [1..3], a &lt;- xs, b &lt;- xs, c &lt;- xs]\n(,,) &lt;$&gt; [1..3] &lt;*&gt; [1..3] &lt;*&gt; [1..3]\nlet xs = [1..3] in (,,) &lt;$&gt; xs &lt;*&gt; xs &lt;*&gt; xs\n(\\[a,b,c]-&gt;(a,b,c)) &lt;$&gt; replicateM 3 [1..3]\n</code></pre>\n\n<p>However, I'd look for the most readable one, rather than the shortest.</p>\n"}], "owner": {"reputation": 121, "user_id": 4994693, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf135adf371897e4c60586e96dabdd11?s=128&d=identicon&r=PG&f=1", "display_name": "Luca9984", "link": "https://stackoverflow.com/users/4994693/luca9984"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 50192037, "answer_count": 1, "score": 3, "last_activity_date": 1525540208, "creation_date": 1525539404, "last_edit_date": 1525539818, "question_id": 50191914, "link": "https://stackoverflow.com/questions/50191914/generating-tuples-using-list-comprehension", "title": "Generating tuples using list comprehension", "body": "<p>I generate tuples using list comprehension:</p>\n\n<pre><code>[(a,b,c) | a &lt;- [1..3], b &lt;- [1..3], c &lt;- [1..3]]\n</code></pre>\n\n<p>Since all three entries of the tuples are from the same interval, is there a shorter way to write this?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "edited": false, "score": 1, "creation_date": 1525539833, "post_id": 50191905, "comment_id": 87400815, "body": "Hi there buddy, and welcome to StackOverflow. This sort of question really does not belong here, since there are many tutorials you can find via a simple google search which will help you get started with Haskell. Take care and good luck!"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1525540597, "post_id": 50191905, "comment_id": 87401030, "body": "I&#39;m not sure what your question is, but basically none of your code is right (except for <code>[x | x &lt;-</code> maybe)."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 2, "creation_date": 1525541895, "post_id": 50191905, "comment_id": 87401443, "body": "I suggest that you break your requirements into smaller pieces: 1. A function that takes a list of integers and returns a list of only the even integers from that list. 2. A function which reads a input and returns a list of integers. Write a <code>main</code> function that uses these two functions. Once you get something that works, you can iterate on it to simplify it all into a single list comprehension."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1525545639, "last_edit_date": 1525545639, "creation_date": 1525545217, "answer_id": 50192801, "question_id": 50191905, "link": "https://stackoverflow.com/questions/50191905/read-a-list-of-int-type-from-the-console-and-print-out-only-even-numbers-out-of/50192801#50192801", "title": "Read a list of INT type from the console and print out only even numbers out of the given list Using list comprehension", "body": "<p>What you have written has a couple of minor errors:</p>\n\n<pre><code>[x | x &lt;- [nums], x == even, x &lt;= 50]\n</code></pre>\n\n<ol>\n<li><p><code>x &lt;- [nums]</code> will bind <code>x</code> to each element of the list <code>[nums] :: [[Int]]</code>, which has one element, <code>nums :: [Int]</code>. Presumably you wanted <code>x &lt;- nums</code>, so that <code>x :: Int</code>.</p></li>\n<li><p><code>x == even</code> attempts to compare <code>x</code>, which has type <code>Int</code>, to the function <code>even</code>, which has type <code>Integral a =&gt; a -&gt; Bool</code> (or, simplified a bit, <code>Int -&gt; Bool</code>). You can\u2019t compare values of different types for equality, nor can you compare functions; what you want to do is <em>call</em> the function <code>even</code> on <code>x</code> with <code>even x</code>.</p></li>\n</ol>\n\n<p>With those changes, your expression will work without error:</p>\n\n<pre><code>[x | x &lt;- nums, even x, x &lt;= 50]\n</code></pre>\n\n<p>Now, as for reading the values from the console, you would do that from <code>main</code> since it requires <code>IO</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  putStrLn \"Enter space-separated list of numbers.\"\n  line &lt;- getLine\n  let nums = map read (words line) :: [Int]\n  print [x | x &lt;- nums, even x, x &lt;= 50]\n</code></pre>\n\n<p>This uses <code>words</code> to split the line on whitespace, <code>map read</code> to convert each string in the resulting list to an <code>Int</code>, and finally your list comprehension to calculate the output. Now, input such as <code>10 25 30 45 50 60</code> will produce output such as <code>[10,30,50]</code>.</p>\n\n<p>A couple of exercises to improve your understanding:</p>\n\n<ul>\n<li><p>Move the prompt, parsing, and list comprehension into separate top-level function definitions with type signatures.</p></li>\n<li><p>What happens when the user enters invalid input like <code>10, 20, foo</code>? How could you handle this error?</p></li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 9615022, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3UWs1.jpg?s=128&g=1", "display_name": "Hajra Zamir", "link": "https://stackoverflow.com/users/9615022/hajra-zamir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1525545639, "creation_date": 1525539335, "last_edit_date": 1525540269, "question_id": 50191905, "link": "https://stackoverflow.com/questions/50191905/read-a-list-of-int-type-from-the-console-and-print-out-only-even-numbers-out-of", "title": "Read a list of INT type from the console and print out only even numbers out of the given list Using list comprehension", "body": "<p>I'm very new to functional programming with Haskell, I have started learning it a few days ago by doing a few tasks.</p>\n\n<p>I'm trying to write a function that will Read a list of INT type from the console and print out only even numbers out of the given list Using list comprehension. This is what I have:</p>\n\n<pre><code>[x | x &lt;- [nums], x == even, x &lt;= 50]\n</code></pre>\n"}, {"tags": ["security", "haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1525528630, "post_id": 50190094, "comment_id": 87397259, "body": "What&#39;s your question?"}, {"owner": {"reputation": 926, "user_id": 1486968, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WvBqy.png?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/1486968/joe"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1525529039, "post_id": 50190094, "comment_id": 87397369, "body": "Is it possible to use mueval (or something like it) to safely evaluate untrusted Haskell modules? I&#39;ll edit the question"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1525537737, "post_id": 50190094, "comment_id": 87400167, "body": "Yes.  Safe evaluation is the purpose of mueval."}, {"owner": {"reputation": 926, "user_id": 1486968, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WvBqy.png?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/1486968/joe"}, "edited": false, "score": 2, "creation_date": 1525538406, "post_id": 50190094, "comment_id": 87400388, "body": "Typical mueval usage seem to be evaluating individual expressions. I&#39;d like to be able to evaluate an entire file, which may contain type and function definitions, while maintaining the same security guarantees"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1525538646, "post_id": 50190094, "comment_id": 87400458, "body": "Ah sorry. You want a <code>hint</code> like api with the safety of <code>mueval</code>?  I expect this could be done quickly but do not think there is a pre-existing package or capability inside of mueval."}, {"owner": {"reputation": 926, "user_id": 1486968, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WvBqy.png?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/1486968/joe"}, "edited": false, "score": 0, "creation_date": 1525538983, "post_id": 50190094, "comment_id": 87400553, "body": "That&#39;s exactly what I want, thanks.  It&#39;s unfortunate for me if it doesn&#39;t exist"}], "owner": {"reputation": 926, "user_id": 1486968, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WvBqy.png?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/1486968/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1525529055, "creation_date": 1525527648, "last_edit_date": 1525529055, "question_id": 50190094, "link": "https://stackoverflow.com/questions/50190094/evaluate-entire-haskell-modules-sandboxed-using-mueval", "title": "Evaluate entire Haskell modules sandboxed using mueval", "body": "<p>I'm trying to build a web app halfway between <a href=\"https://tryhaskell.org\" rel=\"nofollow noreferrer\">tryhaskell.org</a> and <a href=\"https://openjscad.org\" rel=\"nofollow noreferrer\">openjscad.org</a>. Where a user can enter Haskell code for a module that defines  a solid object,  evaluated server side, with the resulting object displayed in the browser.</p>\n\n<p>I already have an implementation of the CSG functions required.</p>\n\n<p>I'd like to be able to use <a href=\"https://hackage.haskell.org/package/mueval\" rel=\"nofollow noreferrer\">mueval</a> to safely run untrusted Haskell, much like tryhaskell.org.\nI can't see how to use mueval to safely run Haskell code, including function definitions, as opposed to just evaluating Haskell statements.</p>\n\n<p>I'm aware of the <code>--loadfile</code> argument to mueval, but this doesn't give the same security guarantees as mueval provides when evaluating expressions.</p>\n\n<p>Is it possible to use mueval (or something like it) to safely evaluate untrusted Haskell modules?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1525527295, "post_id": 50189967, "comment_id": 87396842, "body": "You didn&#39;t convert the other addend (<code>y1</code>)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525531510, "post_id": 50189967, "comment_id": 87398124, "body": "you can structure it as <code>( round $ ... ) + y1</code> and it might work (depending on the definition of <code>Coord</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9745525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c7c32d3f9a2c671f6ed1f4ef3264cf?s=128&d=identicon&r=PG&f=1", "display_name": "spicy boi", "link": "https://stackoverflow.com/users/9745525/spicy-boi"}, "edited": false, "score": 0, "creation_date": 1525528265, "post_id": 50190056, "comment_id": 87397158, "body": "Hi thanks for the help! I now understand why the use of the <code>+</code> operation would break the algorithm, but I tried to implement your suggestions resulting in this code:      bresenhamAlgorithm :: Coord -&gt; Coord -&gt; Int -&gt; Int     bresenhamAlgorithm (x1, y1) (x2, y2) x&#39;= round $ fromIntegral ((y2      - y1) * (x&#39; - x1)) / fromIntegral (x2 - x1))+ fromIntegral y1  But it now gives me an error on the round operation <code>Defaulting the following constraints to type &#39;Double&#39;</code>. How do I keep it as an Int?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 33, "user_id": 9745525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c7c32d3f9a2c671f6ed1f4ef3264cf?s=128&d=identicon&r=PG&f=1", "display_name": "spicy boi", "link": "https://stackoverflow.com/users/9745525/spicy-boi"}, "edited": false, "score": 1, "creation_date": 1525531584, "post_id": 50190056, "comment_id": 87398149, "body": "@spicyboi <code>Double</code> is good, you <i>want</i> to divide the <code>Double</code>s, for better precision."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 33, "user_id": 9745525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c7c32d3f9a2c671f6ed1f4ef3264cf?s=128&d=identicon&r=PG&f=1", "display_name": "spicy boi", "link": "https://stackoverflow.com/users/9745525/spicy-boi"}, "edited": false, "score": 2, "creation_date": 1525532014, "post_id": 50190056, "comment_id": 87398289, "body": "@spicyboi That&#39;s not an error, it&#39;s just a warning telling you that because you didn&#39;t really tell the compiler what type <code>fromIntegral</code> should return it just picked one for you (<code>Double</code>). If you use the <code>toDouble</code> function from this answer instead (which just restricts <code>fromIntegral</code>), the message will go away (think of it as a &quot;yes, that&#39;s what I meant&quot; you can tell the compiler)."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 5, "last_activity_date": 1525528484, "last_edit_date": 1525528484, "creation_date": 1525527416, "answer_id": 50190056, "question_id": 50189967, "link": "https://stackoverflow.com/questions/50189967/implementing-the-bresenham-algorithm/50190056#50190056", "title": "Implementing the Bresenham Algorithm", "body": "<p></p>\n\n<blockquote>\n  <p>I don't understand as I believed that fromIntegral would convert the numerator and denominator to fractionals which would allow for the use of the / operation?</p>\n</blockquote>\n\n<p>Yes, your understanding is basically correct but you made a small oversight.</p>\n\n<hr>\n\n<p>Here is your code formatted slightly differently:</p>\n\n<pre><code>bresenhamAlgorithm :: Coord -&gt; Coord -&gt; Int -&gt; Int\nbresenhamAlgorithm (x1, y1) (x2, y2) x'= round $\n  (\n    fromIntegral ((y2 - y1) * (x' - x1)) \n  / fromIntegral (x2 - x1)\n  ) + y1\n</code></pre>\n\n<p>this is (because <code>+</code> binds stronger than <code>$</code>) equivalent to:</p>\n\n<pre><code>bresenhamAlgorithm :: Coord -&gt; Coord -&gt; Int -&gt; Int\nbresenhamAlgorithm (x1, y1) (x2, y2) x'= round (\n  (\n    fromIntegral ((y2 - y1) * (x' - x1)) \n  / fromIntegral (x2 - x1)\n  ) + y1)\n</code></pre>\n\n<p>The problem here is actually neither <code>round</code> nor <code>/</code>, it's your <code>+ y1</code> at the end. Because <code>y1</code> is already known to be <code>Int</code>, the type checker tries to unify </p>\n\n<pre><code>fromIntegral ((y2 - y1) * (x' - x1)) / fromIntegral (x2 - x1)\n</code></pre>\n\n<p>with <code>Int</code>, which of course fails because <code>/</code> isn't allowed with <code>Int</code>.</p>\n\n<p>The solution is to add <em>another</em> <code>fromIntegral</code>:</p>\n\n<pre><code>bresenhamAlgorithm :: Coord -&gt; Coord -&gt; Int -&gt; Int\nbresenhamAlgorithm (x1, y1) (x2, y2) x'= round $\n  (\n    fromIntegral ((y2 - y1) * (x' - x1)) \n  / fromIntegral (x2 - x1)\n  ) + fromIntegral y1 -- we need y1 as a fractional\n</code></pre>\n\n<p>Alternatively you could also wrap the everything before <code>+ y1</code> - including the <code>round</code> - in parentheses, that would work too.</p>\n\n<hr>\n\n<p>Now the reason this wasn't caught earlier is because <code>fromIntegral</code> can actually convert integer types to <em>any</em> number type... including themselves. So in this case, because of how the expression was written the typechecker inferred that you meant <code>fromIntegral</code> to convert <code>Int</code> to... <code>Int</code> again. Which is not what you meant, but the compiler doesn't know that.</p>\n\n<p>If we add a small helper function:</p>\n\n<pre><code>toDouble :: Int -&gt; Double\ntoDouble = fromIntegral\n</code></pre>\n\n<p>and use it in your definition instead of <code>fromIntegral</code></p>\n\n<pre><code>bresenhamAlgorithm :: Coord -&gt; Coord -&gt; Int -&gt; Int\nbresenhamAlgorithm (x1, y1) (x2, y2) x'= round $\n  (\n    toDouble ((y2 - y1) * (x' - x1)) \n  / toDouble (x2 - x1)\n  ) + y1\n</code></pre>\n\n<p>to force the conversion, we actually get a more helpful error message:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Double\u2019 with actual type \u2018Int\u2019\n\u2022 In the second argument of \u2018(+)\u2019, namely \u2018y1\u2019\n  In the second argument of \u2018($)\u2019, namely\n    \u2018(toDouble ((y2 - y1) * (x' - x1)) / toDouble (x2 - x1)) + y1\u2019\n  In the expression:\n    round\n      $ (toDouble ((y2 - y1) * (x' - x1)) / toDouble (x2 - x1)) + y1\n\n    ) + y1\n        ^^\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9745525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c7c32d3f9a2c671f6ed1f4ef3264cf?s=128&d=identicon&r=PG&f=1", "display_name": "spicy boi", "link": "https://stackoverflow.com/users/9745525/spicy-boi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 50190056, "answer_count": 1, "score": 3, "last_activity_date": 1525528484, "creation_date": 1525526790, "last_edit_date": 1525526968, "question_id": 50189967, "link": "https://stackoverflow.com/questions/50189967/implementing-the-bresenham-algorithm", "title": "Implementing the Bresenham Algorithm", "body": "<p>Hi I'm trying to write some basic code to implement the Bresenham Algorithm but I'm stuck trying to use <code>round</code> and <code>/</code>. My code is:</p>\n\n<pre><code>bresenhamAlgorithm :: Coord -&gt; Coord -&gt; Int -&gt; Int\nbresenhamAlgorithm (x1, y1) (x2, y2) x'= round $ (fromIntegral ((y2 - \ny1) * (x' - x1)) / fromIntegral (x2 - x1)) + y1\n</code></pre>\n\n<p>I keep getting the <code>No instance for (Fractional Int) arising from a use of \u2018/\u2019</code> and <code>No instance for (RealFrac Int) arising from a use of \u2018round\u2019</code> errors occuring. I don't understand as I believed that fromIntegral would convert the numerator and denominator to fractionals which would allow for the use of the <code>/</code> operation?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525533398, "post_id": 50187673, "comment_id": 87398708, "body": "Side note: there\u2019s no such thing as a \u201cmatrice\u201d\u2014singular is \u201cone matrix\u201d, plural is \u201csome matrices\u201d, same as vertex/vertices, index/indices, appendix/appendices, &amp;c."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1525622009, "post_id": 50187673, "comment_id": 87419883, "body": "<code>f ls m n  = ls!!m!!n</code> the matrix is given in ls, the list within the matrix is <code>m</code> and the element of the specified list is <code>n</code> ... [[a]] -&gt; Int -&gt; Int -&gt; a ... If you want to do error checking in your function, do so but maybe use the <code>!!</code> operator."}], "answers": [{"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 4, "last_activity_date": 1525511807, "creation_date": 1525511807, "answer_id": 50187757, "question_id": 50187673, "link": "https://stackoverflow.com/questions/50187673/multiple-lists-haskell/50187757#50187757", "title": "Multiple lists haskell", "body": "<p>Just handle each list individually, and <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-33--33-\" rel=\"nofollow noreferrer\">!!</a> will work:</p>\n\n<pre><code>Prelude&gt; example\n[[3,5],[2,1],[0,4],[6,8]]\nPrelude&gt; :t example\nexample :: Matrice Int\nPrelude&gt; example !! 0 !! 1\n5\n</code></pre>\n\n<p>But lists are probably not the right data structure for this, because indexing is O(n). Depending on your task, Data.Vector or Data.Array may be better suited. See also <a href=\"https://stackoverflow.com/questions/9611904/haskell-lists-arrays-vectors-sequences\">Haskell: Lists, Arrays, Vectors, Sequences</a>. </p>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "edited": false, "score": 0, "creation_date": 1525515636, "post_id": 50187825, "comment_id": 87393341, "body": "But how do you adjust the function with this given type of nth? nth :: Matrix a -&gt; Int -&gt; Int -&gt; a"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "edited": false, "score": 0, "creation_date": 1525516509, "post_id": 50187825, "comment_id": 87393622, "body": "@Asma but what are you going to receive, when your indices are too large and there is no element to return?"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 2, "last_activity_date": 1525516418, "last_edit_date": 1525516418, "creation_date": 1525512320, "answer_id": 50187825, "question_id": 50187673, "link": "https://stackoverflow.com/questions/50187673/multiple-lists-haskell/50187825#50187825", "title": "Multiple lists haskell", "body": "<p><code>!!</code> can be used for accessing an element by index, but be careful, since it's raising an exception, if the index is too large.</p>\n\n<pre><code>example !! 2 !! 0\n</code></pre>\n\n<p>And you've already written a function for accessing <code>nth</code> element of a list, just apply it twice:</p>\n\n<pre><code>nth :: Int -&gt; Int -&gt; [[a]] -&gt; Maybe a\nnth k n matrix = nth' n =&lt;&lt; nth' k matrix\n  where\n    nth' _ [] = Nothing\n    nth' 0 (x: _) = Just x\n    nth' n (_ : xs) = nth' (n - 1) xs\n</code></pre>\n\n<p>Or using your created <code>Matrice</code> type:</p>\n\n<pre><code>nth :: Matrice a -&gt; Int -&gt; Int -&gt; Maybe a\nnth matrix k n = nth' n =&lt;&lt; nth' k matrix\n  where\n    nth' _ [] = Nothing\n    nth' 0 (x: _) = Just x\n    nth' n (_ : xs) = nth' (n - 1) xs\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 7942926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/662072e84a772ef540fb6aa5e3638f75?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/7942926/anna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 762, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1525516418, "creation_date": 1525511149, "question_id": 50187673, "link": "https://stackoverflow.com/questions/50187673/multiple-lists-haskell", "title": "Multiple lists haskell", "body": "<p>How do you find nth elements in the matrix at a given row and column position? For example, if you have</p>\n\n<pre><code>type Matrice a = [[a]]\n\nexample :: Matrice Int  \nexample = [ [3, 5],                \n        [2, 1],                \n        [0, 4],                \n        [6, 8] ] \n\nPrelude &gt;  example 0 1\n      5\nPrelude &gt;  example 2 0\n      0\nPrelude &gt;  example 1 1\n      2\n</code></pre>\n\n<p>I know how to work out with only given list such as </p>\n\n<pre><code>nth :: Int -&gt; [a] -&gt; Maybe a\nnth _ []       = Nothing\nnth 1 (x : _)  = Just x\nnth n (_ : xs) = nth (n - 1) xs\n</code></pre>\n\n<p>But my question is, how do you access nth element in a matrix as in the given example</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "edited": false, "score": 0, "creation_date": 1525453238, "post_id": 50179411, "comment_id": 87376835, "body": "Thank you for your answer, So I edtied the code accordingly to your suggestions but i&#39;m still getting some compile errors. At least The &quot;all&quot; line looks fine. I&#39;ve edited my question for more info"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "edited": false, "score": 0, "creation_date": 1525453442, "post_id": 50179411, "comment_id": 87376923, "body": "Well, it&#39;s basically the same issue with <code>dropWhile</code>."}, {"owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "edited": false, "score": 0, "creation_date": 1525453524, "post_id": 50179411, "comment_id": 87376972, "body": "Ok I think I got it thank, i&#39;m gonna try some things then mark your answer as accepted, thanks again"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1525451971, "last_edit_date": 1525451971, "creation_date": 1525451227, "answer_id": 50179411, "question_id": 50179111, "link": "https://stackoverflow.com/questions/50179111/haskell-is-string-only-composed-of-characters-from-another-string/50179411#50179411", "title": "Haskell- Is string only composed of characters from another string", "body": "<p>With <code>all (isAlphabet ys alpha)</code>, you try to first apply <code>isAlphabet</code> to <em>the entire string</em> <code>ys</code> and the alphabet, and then somehow pull the result of that through <code>all</code>. But, the types don't support this:\n<pre><code>isAlphabet :: Char -> String -> Bool\n               \u2502         \u2502       \u2502\nys      ::   <b>String</b>      \u2502       \u2502\nalpha   ::            String     \u2502\nall     ::                   <b>(a->Bool)</b> -> <b>[a] -></b> Bool\n</pre></code>\nWhat you instead want to do is <em>use</em> <code>all</code> to apply <code>isAlphabet</code> to each character <em>individually</em>. That's what it's there for.</p>\n\n<pre><code>  ... all (\\c -&gt; isAlphabet c alpha) ys ...\n</code></pre>\n\n<p>Note that if you'd defined the <code>isAlphabet</code> function which swapped arguments (which would be the more natural order) then you could shorten (eta-reduce) this to</p>\n\n<pre><code>isAlphabet :: String -&gt; Char -&gt; Bool\n\n  ... all (isAlphabet alpha) ys ...\n</code></pre>\n\n<p>Alternatively you can use an <em>operator section</em> to directly apply the second argument. In fact I wouldn't bother defining <code>isAlphabet</code> in the first place, because it's actually an exact synonym for <code>elem</code>. Just write</p>\n\n<pre><code>  ... all (`elem` alpha) ys ...\n</code></pre>\n\n<p><pre><code>all           :: (a->Bool) -> [a] -> Bool\n                     \u2502         \u2502\n(`elem`alpha) :: Char->Bool    \u2502\nys            ::             String\n</pre></code></p>\n"}], "owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 50179411, "answer_count": 1, "score": 1, "last_activity_date": 1525453671, "creation_date": 1525450104, "last_edit_date": 1525453671, "question_id": 50179111, "link": "https://stackoverflow.com/questions/50179111/haskell-is-string-only-composed-of-characters-from-another-string", "title": "Haskell- Is string only composed of characters from another string", "body": "<p>I want to check if a string given by the user is only composed from characters of another string previously given as program arguments</p>\n\n<p>I have search every where for doing this in haskell but I didn't found anything (found answer for other language but not haskell)\nI know how to do this in python or in C but this is my first haskell program</p>\n\n<p>Here is what I have so far :</p>\n\n<p>I'm calling the function + setup of the string to check</p>\n\n<pre><code>myCheck first second = do\n-- some stuff\nlet alpha = \"01\" -- normally this is given with argument by the user but just for simplicity let's do it that way (it could also be alpha = \"aziuef\u00e8!\u00e7\u00e8\")\nsuite &lt;- getLine\nif isValid suite alpha\n  then putStr \"OK\\n\"\n  else exit\n-- some other stuff\n</code></pre>\n\n<p>Now the Is valid function the isValid \"\" alpha = True is important because I need to handle that elsewhere later in the code</p>\n\n<pre><code>isValid :: String -&gt; String -&gt; Bool                                                                       \nisValid \"\" alpha = True                                                                                   \nisValid xs alpha =                                                                                      \n  case dropWhile (isAlphabet xs alpha) of                                                                  \n    \"\" -&gt; True                                                                                             \n   ('.':ys) -&gt; all (isAlphabet ys alpha)                                                                  \n   _ -&gt; False\n</code></pre>\n\n<p>And the isAlphabet function</p>\n\n<pre><code>isAlphabet :: Char -&gt; String -&gt; Bool                                                                     \nisAlphabet xs alpha = xs `elem` alpha\n</code></pre>\n\n<p>But (and I'm starting to get used to while using haskell)</p>\n\n<pre><code> /Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:29:19: error:\n\u2022 Couldn't match expected type \u2018a0 -&gt; Bool\u2019 with actual type \u2018Bool\u2019\n\u2022 Possible cause: \u2018isAlphabet\u2019 is applied to too many arguments\n  In the first argument of \u2018dropWhile\u2019, namely\n    \u2018(isAlphabet xs alpha)\u2019\n  In the expression: dropWhile (isAlphabet xs alpha)\n  In the expression:\n    case dropWhile (isAlphabet xs alpha) of\n      \"\" -&gt; True\n      ('.' : ys) -&gt; all (isAlphabet ys alpha)\n      _ -&gt; False\n     |\n  29 |   case dropWhile (isAlphabet xs alpha) of\n     |                   ^^^^^^^^^^^^^^^^^^^\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:29:30: error:\n\u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Char\u2019\n  Expected type: Char\n    Actual type: String\n\u2022 In the first argument of \u2018isAlphabet\u2019, namely \u2018xs\u2019\n  In the first argument of \u2018dropWhile\u2019, namely\n    \u2018(isAlphabet xs alpha)\u2019\n  In the expression: dropWhile (isAlphabet xs alpha)\n   |\n29 |   case dropWhile (isAlphabet xs alpha) of\n   |                              ^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:30:5: error:\n    \u2022 Couldn't match expected type \u2018[a0] -&gt; [a0]\u2019\n              with actual type \u2018[Char]\u2019\n    \u2022 In the pattern: \"\"\n     In a case alternative: \"\" -&gt; True\n     In the expression:\n    case dropWhile (isAlphabet xs alpha) of\n      \"\" -&gt; True\n      ('.' : ys) -&gt; all (isAlphabet ys alpha)\n      _ -&gt; False\n   |\n30 |     \"\" -&gt; True\n   |     ^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:31:6: error:\n \u2022 Couldn't match expected type \u2018[a0] -&gt; [a0]\u2019\n               with actual type \u2018[Char]\u2019\n \u2022 In the pattern: '.' : ys\n  In a case alternative: ('.' : ys) -&gt; all (isAlphabet ys alpha)\n  In the expression:\n    case dropWhile (isAlphabet xs alpha) of\n      \"\" -&gt; True\n      ('.' : ys) -&gt; all (isAlphabet ys alpha)\n      _ -&gt; False\n   |\n31 |     ('.':ys) -&gt; all (isAlphabet ys alpha)\n   |      ^^^^^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:31:17: error:\n  \u2022 Couldn't match expected type \u2018Bool\u2019\n              with actual type \u2018t0 a1 -&gt; Bool\u2019\n  \u2022 Probable cause: \u2018all\u2019 is applied to too few arguments\n  In the expression: all (isAlphabet ys alpha)\n  In a case alternative: ('.' : ys) -&gt; all (isAlphabet ys alpha)\n  In the expression:\n    case dropWhile (isAlphabet xs alpha) of\n      \"\" -&gt; True\n      ('.' : ys) -&gt; all (isAlphabet ys alpha)\n      _ -&gt; False\n   |\n31 |     ('.':ys) -&gt; all (isAlphabet ys alpha)\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:31:22: error:\n   \u2022 Couldn't match expected type \u2018a1 -&gt; Bool\u2019 with actual type \u2018Bool\u2019\n   \u2022 Possible cause: \u2018isAlphabet\u2019 is applied to too many arguments\n    In the first argument of \u2018all\u2019, namely \u2018(isAlphabet ys alpha)\u2019\n    In the expression: all (isAlphabet ys alpha)\n    In a case alternative: ('.' : ys) -&gt; all (isAlphabet ys alpha)\n   |\n31 |     ('.':ys) -&gt; all (isAlphabet ys alpha)\n   |                      ^^^^^^^^^^^^^^^^^^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:31:33: error:\n  \u2022 Couldn't match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019\n  \u2022 In the first argument of \u2018isAlphabet\u2019, namely \u2018ys\u2019\n    In the first argument of \u2018all\u2019, namely \u2018(isAlphabet ys alpha)\u2019\n    In the expression: all (isAlphabet ys alpha)\n   |\n31 |     ('.':ys) -&gt; all (isAlphabet ys alpha)\n   |                                 ^^\n</code></pre>\n\n<p>This specific function isn't homework but part of a bigger project that is\nThank you, really hope I didn't miss any previous questions already answered</p>\n\n<p>Edit suggested by answer : </p>\n\n<p>Removed isAlphabet (this function wasn't making any sense, since it was only calling elem)</p>\n\n<pre><code>isValid :: String -&gt; String -&gt; Bool                                                                    \nisValid \"\" alpha = True                                                                              \nisValid xs alpha =                                                                                         \n  case dropWhile (xs `elem` alpha) of                                                                      \n    \"\" -&gt; True                                                                                             \n    ('.':ys) -&gt; all (`elem` alpha) ys                                                                      \n    _ -&gt; False\n</code></pre>\n\n<p>compile errors :</p>\n\n<pre><code>/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:26:19: error:\n    \u2022 Couldn't match expected type \u2018a0 -&gt; Bool\u2019 with actual type \u2018Bool\u2019\n    \u2022 Possible cause: \u2018elem\u2019 is applied to too many arguments\n     In the first argument of \u2018dropWhile\u2019, namely \u2018(xs `elem` alpha)\u2019\n      In the expression: dropWhile (xs `elem` alpha)\n      In the expression:\n        case dropWhile (xs `elem` alpha) of\n          \"\" -&gt; True\n         ('.' : ys) -&gt; all (`elem` alpha) ys\n         _ -&gt; False\n   |\n26 |   case dropWhile (xs `elem` alpha) of\n   |                   ^^^^^^^^^^^^^^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:26:29: error:\n    \u2022 Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\n      Expected type: [String]\n        Actual type: String\n    \u2022 In the second argument of \u2018elem\u2019, namely \u2018alpha\u2019\n      In the first argument of \u2018dropWhile\u2019, namely \u2018(xs `elem` alpha)\u2019\n      In the expression: dropWhile (xs `elem` alpha)\n   |\n26 |   case dropWhile (xs `elem` alpha) of\n   |                             ^^^^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:27:5: error:\n    \u2022 Couldn't match expected type \u2018[a0] -&gt; [a0]\u2019\n                  with actual type \u2018[Char]\u2019\n    \u2022 In the pattern: \"\"\n      In a case alternative: \"\" -&gt; True\n      In the expression:\n        case dropWhile (xs `elem` alpha) of\n          \"\" -&gt; True\n          ('.' : ys) -&gt; all (`elem` alpha) ys\n          _ -&gt; False\n   |\n27 |     \"\" -&gt; True\n   |     ^^\n\n/Users/mgial/tech2/FUN_deBruijn_2017/app/Main.hs:28:6: error:\n    \u2022 Couldn't match expected type \u2018[a0] -&gt; [a0]\u2019\n                  with actual type \u2018[Char]\u2019\n    \u2022 In the pattern: '.' : ys\n      In a case alternative: ('.' : ys) -&gt; all (`elem` alpha) ys\n      In the expression:\n        case dropWhile (xs `elem` alpha) of\n          \"\" -&gt; True\n          ('.' : ys) -&gt; all (`elem` alpha) ys\n          _ -&gt; False\n   |\n28 |     ('.':ys) -&gt; all (`elem` alpha) ys\n   |      ^^^^^^\n</code></pre>\n\n<p>Final edit :</p>\n\n<pre><code>isValid :: String -&gt; String -&gt; Bool                                                                     \nisValid \"\" alpha = True                                                                                 \nisValid xs alpha =                                                                                         \n  case dropWhile (`elem` alpha) xs of                                                                      \n    \"\" -&gt; True                                                                                             \n    ('.':ys) -&gt; all (`elem` alpha) ys                                                                      \n    _ -&gt; False\n</code></pre>\n"}, {"tags": ["haskell", "monads", "servant"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1525450160, "post_id": 50178815, "comment_id": 87375353, "body": "Once in IO, always in IO. What did you try with <code>takeWhileM</code> that didn&#39;t work?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525450313, "post_id": 50178815, "comment_id": 87375444, "body": "<code>ClientM</code> <a href=\"http://hackage.haskell.org/package/servant-client-0.13.0.1/docs/Servant-Client.html#control.i:id:ClientM:MonadIO:4\" rel=\"nofollow noreferrer\">is <i>already</i></a> a (transformer-enhanced) IO monad. You can just execute any <code>IO</code> action in it with <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad-IO-Class.html#v:liftIO\" rel=\"nofollow noreferrer\"><code>liftIO</code></a>."}, {"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1526175894, "post_id": 50178815, "comment_id": 87640355, "body": "This really sounds like something I&#39;m after @leftaroundabout, but I&#39;m really struggling to replace my <code>take 2</code> with something with <code>liftIO</code>. Could you elaborate a bit more please? Sorry, real haskell noob here :|"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1525470460, "post_id": 50181766, "comment_id": 87384379, "body": "In the next version of <code>streaming</code>, that <code>void</code> shouldn&#39;t be needed."}, {"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1525874347, "post_id": 50181766, "comment_id": 87528077, "body": "This is a cool approach, but how do I get <code>len</code> for <code>S.take len</code>? I don&#39;t know what it should be in advance - I should stop fetching data once the last fetch returns an empty list."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1525886549, "post_id": 50181766, "comment_id": 87535666, "body": "@zoran119 That <code>len</code> in <code>repeatAndCollectLimited</code> is only for setting a maximum number of iterations. The other way of stopping is when the action returns a <code>Right</code> (this is the only way <code>repeatAndCollect</code> can stop)."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1525465811, "last_edit_date": 1525465811, "creation_date": 1525461366, "answer_id": 50181766, "question_id": 50178815, "link": "https://stackoverflow.com/questions/50178815/can-io-actions-be-sequenced-while-keeping-the-logic-in-a-pure-function/50181766#50181766", "title": "Can IO actions be sequenced while keeping the logic in a pure function?", "body": "<p>For these cases of monadic iteration I usually turn to the <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html\" rel=\"noreferrer\">streaming</a> library. Its interface is reminiscent to that of pure lists, while still allowing effects:</p>\n\n<pre><code>import           Streaming\nimport qualified Streaming.Prelude               as S\n\nrepeatAndCollect :: Monad m =&gt; m (Either a r) -&gt; m [a]\nrepeatAndCollect = S.toList_ . Control.Monad.void . S.untilRight\n\nrepeatAndCollectLimited :: Monad m =&gt; Int -&gt; m (Either a r) -&gt; m [a]\nrepeatAndCollectLimited len = S.toList_ . S.take len . S.untilRight\n</code></pre>\n\n<p>Using the <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html#v:untilRight\" rel=\"noreferrer\"><code>untilRight</code></a>, <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html#v:take\" rel=\"noreferrer\"><code>take</code></a> and <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming-Prelude.html#v:toList_\" rel=\"noreferrer\"><code>toList_</code></a> functions.</p>\n\n<hr>\n\n<p>When only the first successful result is needed, we can use the <code>Alternative</code> instance of the <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Except.html#t:ExceptT\" rel=\"noreferrer\"><code>ExceptT</code></a> transformer in combination with <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Foldable.html#v:asum\" rel=\"noreferrer\"><code>asum</code></a> from <code>Data.Foldable</code> to execute a list of fallible actions until one of them succeeds.</p>\n\n<p><code>IO</code> itself has an <code>Alternative</code> instance that returns the first \"success\", where \"failure\" means throwing a <code>IOException</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1525470014, "post_id": 50183113, "comment_id": 87384254, "body": "<code>eitherM</code> is the same as <code>either</code>. Using <code>&gt;&gt;=</code> with <code>case</code> (or <code>LambdaCase</code>) or just writing a <code>do</code> block would be fine as well."}], "tags": [], "owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "is_accepted": false, "score": 1, "last_activity_date": 1525470719, "last_edit_date": 1525470719, "creation_date": 1525468387, "answer_id": 50183113, "question_id": 50178815, "link": "https://stackoverflow.com/questions/50178815/can-io-actions-be-sequenced-while-keeping-the-logic-in-a-pure-function/50183113#50183113", "title": "Can IO actions be sequenced while keeping the logic in a pure function?", "body": "<p>If you need to keep the <code>ClientM</code> objects separate (either to run them each in a clean state, or anything similar), the best way is to chain your operations together.<br><br>\nIn this particular case, the <code>runClientM query ...</code> IO action returns a <code>Either String [BlogPost]</code>. This means that the stop condition is receiving a <code>Left String</code> from one of the computations.</p>\n\n<p><s>Using a hand-crafted <code>eitherM</code> helper, which runs one of two actions depending on the <code>Either</code> contructor, here is a relatively simple example of that:</s><br>\nUsing the good old either makes this relatively simple :</p>\n\n<pre><code>queryAll :: ClientEnv -&gt; [Int] -&gt; IO [[BlogPost]]\nqueryAll _ [] = return []\nqueryAll url (x:xs) = runClientM (posts x) url &gt;&gt;= either ((const.pure) []) (\\b -&gt; (b:) &lt;$&gt; queryAll url xs)\n\nmain :: IO ()\nmain = do\n  manager' &lt;- newManager defaultManagerSettings\n  let url = ClientEnv manager' (BaseUrl Http \"jsonplaceholder.typicode.com\" 80 \"\")\n  posts' &lt;- queryAll url [1..]\n  print posts'\n</code></pre>\n\n<p>Hope it can help! :)</p>\n"}, {"tags": [], "owner": {"reputation": 931, "user_id": 2631185, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75f07727c65d676aa81eeb97b794cfa7?s=128&d=identicon&r=PG", "display_name": "Regis Kuckaertz", "link": "https://stackoverflow.com/users/2631185/regis-kuckaertz"}, "is_accepted": false, "score": 2, "last_activity_date": 1525515185, "last_edit_date": 1525515185, "creation_date": 1525509844, "answer_id": 50187494, "question_id": 50178815, "link": "https://stackoverflow.com/questions/50178815/can-io-actions-be-sequenced-while-keeping-the-logic-in-a-pure-function/50187494#50187494", "title": "Can IO actions be sequenced while keeping the logic in a pure function?", "body": "<p>Have you tried <code>unfoldM</code>? </p>\n\n<pre><code>unfoldM :: Monad m =&gt; m (Maybe a) -&gt; m [a]\n</code></pre>\n\n<p>Let's update <code>posts</code> this way</p>\n\n<pre><code>posts :: Maybe Integer -&gt; ClientM (Maybe [BlogPost])\nposts = fmap notNil . client api where\n  notNil [] = Nothing\n  notNil bs = Just bs\n</code></pre>\n\n<p>The idea is to update <code>query</code> so that you can just use <code>unfoldM query</code> and get back an <code>ClientM [[BlogPost]]</code>. To do that, the type of <code>query</code> has to be</p>\n\n<pre><code>query :: ClientM (Maybe [BlogPost])\n</code></pre>\n\n<p>meaning, the page number must be coming from the environment:</p>\n\n<pre><code>query = forever $ page &gt;&gt;= posts\n</code></pre>\n\n<p>Clearly, there is some form of state going on here, as we need a way to keep track of the current page number. We can wrap the client action in a <code>StateT</code>:</p>\n\n<pre><code>type ClientSM = StateT Integer ClientM\n\npage :: ClientSM Integer\npage = get &lt;* modify (+1)\n</code></pre>\n\n<p>This action demands a few additional changes to both <code>query</code> and <code>posts</code>. <strong>Edit: see below for a stroke of insight I got in the bus.</strong> First we need to lift the client action in the state monad:</p>\n\n<pre><code>posts :: Integer -&gt; ClientSM (Maybe [BlogPost])\nposts = fmap notNil . lift . client api . Just  where\n  notNil [] = Nothing\n  notNil xs = Just xs\n</code></pre>\n\n<p>Only the type of <code>query</code> needs changing</p>\n\n<pre><code>query :: ClientSM (Maybe [BlogPost])\n</code></pre>\n\n<p>Finally, the main action just needs to peel the monad stack and unfold the query:</p>\n\n<pre><code>main = do\n  manager' &lt;- newManager defaultManagerSettings\n  let url = mkClientEnv manager' (BaseUrl Http \"jsonplaceholder.typicode.com\" 80 \"\")\n  result &lt;- flip runClientM url $ flip runStateT 1 $ unfoldM query\n  case result of\n    Left error -&gt; print error\n    Right (posts, _) -&gt; print posts\n</code></pre>\n\n<p>I haven't tested this, but it compiles \ud83d\ude05\ud83e\udd17</p>\n\n<hr>\n\n<p><code>posts</code> is oblivious to the state, and should remain so. So, without changing my original version above, you just need to lift in <code>query</code>:</p>\n\n<pre><code>query :: ClientSM (Maybe [BlogPost])\nquery = forever $ page &gt;&gt;= lift . posts . Just\n</code></pre>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 2, "answer_count": 3, "score": 7, "last_activity_date": 1525515185, "creation_date": 1525449157, "question_id": 50178815, "link": "https://stackoverflow.com/questions/50178815/can-io-actions-be-sequenced-while-keeping-the-logic-in-a-pure-function", "title": "Can IO actions be sequenced while keeping the logic in a pure function?", "body": "<p>I have the following code which grabs two pages of data from a paginated API endpoint. I'd like to modify <code>query</code> function to keep getting pages until it finds no more data (so replace <code>take 2</code> in the code below with something which looks at the API response).</p>\n\n<p>My question is wether it is possible to achieve this without changing <code>query</code> function to an <code>IO</code> function. And if so, how would I go about it. If not, is there a way of doing this without writing recursive function?</p>\n\n<p>Here is the code:</p>\n\n<pre><code>#!/usr/bin/env stack\n\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport Servant.Client\nimport Network.HTTP.Client (newManager, defaultManagerSettings)\n\nimport Data.Proxy\nimport Servant.API\n\nimport Data.Aeson\nimport GHC.Generics\n\n\n-- data type\ndata BlogPost = BlogPost\n  { id :: Integer\n  , title :: String\n  } deriving (Show, Generic)\n\ninstance FromJSON BlogPost\n\n\n-- api client\ntype API = \"posts\" :&gt; QueryParam \"_page\" Integer :&gt; Get '[JSON] [BlogPost]\napi :: Proxy API\napi = Proxy\nposts :: Maybe Integer -&gt; ClientM [BlogPost]\nposts = client api\n\n\n-- query by page\nquery :: ClientM [[BlogPost]]\nquery = sequence $ take 2 $ map posts pages\n  where\n    pages = [Just p | p &lt;- [1..]]\n\n-- main\nmain :: IO ()\nmain = do\n  manager' &lt;- newManager defaultManagerSettings\n  let url = ClientEnv manager' (BaseUrl Http \"jsonplaceholder.typicode.com\" 80 \"\")\n  posts' &lt;- runClientM query url\n  print posts'\n</code></pre>\n\n<hr>\n\n<p>I've tried to use <code>takeWhileM</code> to do this and ended up making query an <code>IO</code> function and passing <code>url</code> into it. It was starting to look pretty horrible and I couldn't get the types to match up (I felt like I needed something more like <code>(a -&gt; m Bool) -&gt; m [a] -&gt; m [a]</code> rather than <code>(a -&gt; m Bool) -&gt; [a] -&gt; m [a]</code> which is what <code>takeWhileM</code> is - still find this strange because I see this function as a filter, yet the input list and output list are different (one has monad around it and the other doesn't)).</p>\n"}, {"tags": ["haskell", "quicksort"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1525446969, "post_id": 50177982, "comment_id": 87373555, "body": "You realise that (not-degeneracy-robust, as yours seems to be as well) quicksort can just be written <code>quicksort (x:xs) = quicksort (filter (&lt;x) xs) ++ [x] ++ quicksort (filter (&gt;=x) xs)</code>? If yes, then it wouldn&#39;t hurt to explain briefly what the idea behind your approach is."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1525447343, "post_id": 50177982, "comment_id": 87373822, "body": "Your guards <code>| l1 == [] = addi&#39; (l1, quicksort l2) | l2 == [] = addi&#39; (l1,l2)</code> mean that if <code>l2</code> is ever empty, but <code>l1</code> isn&#39;t (which is going to happen) you just stop sorting. Also, <code>addi&#39; (x,y)</code> is just <code>x ++ y</code>, the second split is unnecessary, and of course <code>[] ++ x</code> = <code>x ++ []</code> = <code>x</code>, so for all those cases where you compare against empty lists you can greatly simplify your function."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1525447878, "post_id": 50177982, "comment_id": 87374128, "body": "It has nothing to do with the numbers being &quot;small&quot;. For example, <code>quicksort [13,8,11,7,12,9,3,6,1,10,2,1,4,5]</code> gives <code>[13,8,11,7,12,9,3,6,1,10,2,1,4,5]</code> (I just replaced the &quot;big&quot; numbers in your example list with &quot;small&quot; ones that have the same ordering). Now: how short of a list can you make that doesn&#39;t get sorted correctly? Can you make it small enough to execute the function by hand?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1525482520, "post_id": 50177982, "comment_id": 87386744, "body": "Random code review comment: There is no need for your <code>addi&#39;</code>. It does nothing else than <code>(++)</code> itself, so everywhere where you write <code>addi&#39;(x,y)</code> just write <code>x ++ y</code>."}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 9, "last_activity_date": 1525465647, "creation_date": 1525465647, "answer_id": 50182618, "question_id": 50177982, "link": "https://stackoverflow.com/questions/50177982/quicksort-algorithm-only-works-with-lists-with-small-numbers-why/50182618#50182618", "title": "Quicksort algorithm only works with lists with small numbers. Why?", "body": "<p>When debugging such code, <code>QuickCheck</code> is an amazingly helpful tool.</p>\n\n<p>I put your code into <code>Test.hs</code>, loaded it in <code>ghci</code> and then ran this:</p>\n\n<pre><code>*Test&gt; import Test.QuickCheck\n*Test Test.QuickCheck&gt; quickCheck $ \\xs -&gt; quicksort xs == Data.List.sort xs\n*** Failed! Falsifiable (after 8 tests and 5 shrinks):    \n[1,0]\n*Test Test.QuickCheck&gt; quicksort [1,0]\n[1,0]\n</code></pre>\n\n<p>Now you have a very small input (<code>[1,0]</code>) to look at and trace through your code:</p>\n\n<pre><code>  quicksort (1::0::[]) -- has (l1,l2) = splitBy' 1 [1,0] = ([1,0],[])\n= addi' ([1,0], [])       -- because  `l2 == []`\n= [1,0] ++ []\n= [1,0]\n</code></pre>\n\n<p>Presumably you had a different behavior of either <code>splitBy'</code> or your checks in <code>quicksort</code> in mind. Check where this execution differs from your intention, and you will find how to fix your code.</p>\n"}], "owner": {"reputation": 205, "user_id": 9710552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8578fe2900e52ee3bd08329635673614?s=128&d=identicon&r=PG&f=1", "display_name": "RM777", "link": "https://stackoverflow.com/users/9710552/rm777"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525465647, "creation_date": 1525446339, "question_id": 50177982, "link": "https://stackoverflow.com/questions/50177982/quicksort-algorithm-only-works-with-lists-with-small-numbers-why", "title": "Quicksort algorithm only works with lists with small numbers. Why?", "body": "<p>I have added two helping functions to split the lists and to add tupples.\nThe output with two different lists as input shows my problem.</p>\n\n<p>*Main> quicksort [367,324,675,238,1237,345,12,45,1,434,2,1,33,43]\n[1,1,2,12,33,43,45,238,324,345,367,434,675,1237]                - It works</p>\n\n<p>*Main> quicksort [3687,324,675,238,1237,345,12,45,1,434,2,1,33,43]\n[3687,324,675,238,1237,345,12,45,1,434,2,1,33,43] - doesn't work</p>\n\n<p>Down below is the code:</p>\n\n<pre><code>    splitBy :: Int -&gt; [Int] -&gt; ([Int],[Int])\n\n    splitBy n y = ([x|x &lt;- y,x &gt; n],[x|x &lt;- y, x&lt;=n]) \n    addi :: ([a],[a]) -&gt; ([a],[a]) -&gt; ([a],[a])\n    addi ([],[]) ([],[]) = ([],[])\n    addi (x,y) (w,z) =  (x++w,y++z)\n\n    splitBy' :: Int -&gt; [Int] -&gt; ([Int],[Int])\n\n    splitBy' _ [] = ([],[])\n    splitBy' n (y:ys) =  addi (q,d) (splitBy' n ys)\n        where q = if y &gt; n then [] else [y]\n            d = if y &lt;= n then [] else [y]\n    addi' :: ([a],[a]) -&gt; [a]\n    addi' ([],[]) = []\n    addi' (x,z) = x++z\n    quicksort :: [Int] -&gt; [Int]\n    quicksort [] = []\n    quicksort (x:xs) \n        | (l1 /= []    ) &amp;&amp; (l2 /= []) = addi'(quicksort l1', quicksort l2')\n        | l1 == [] = addi' (l1, quicksort l2)\n        | l2 == [] = addi' (l1,l2)\n            where\n                (l1,l2) = splitBy' x (x:xs)\n                (l1',l2') =  (addi'(splitBy' (x-1) l1),addi' (splitBy' (x+1) l2))\n</code></pre>\n"}, {"tags": ["haskell", "fold", "state-monad"], "comments": [{"owner": {"reputation": 3525, "user_id": 1440433, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/mKFTJ.jpg?s=128&g=1", "display_name": "Joker_vD", "link": "https://stackoverflow.com/users/1440433/joker-vd"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1525446589, "post_id": 50177920, "comment_id": 87373306, "body": "@FyodorSoikin It&#39;s actually called <code>foldM</code>"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 6, "last_activity_date": 1525446667, "creation_date": 1525446667, "answer_id": 50178076, "question_id": 50177920, "link": "https://stackoverflow.com/questions/50177920/haskell-foldl-monad-bind/50178076#50178076", "title": "Haskell foldl Monad bind", "body": "<p>If you have an initial <code>Node</code> and a <code>[Move]</code> you can use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Monad.html#v:foldM\" rel=\"noreferrer\"><code>foldM</code></a>:</p>\n\n<pre><code>moveAll :: Node -&gt; [Move] -&gt; Maybe Node\nmoveAll startNode moves = foldM (\\n m -&gt; move m n) startNode moves\n</code></pre>\n\n<p>or simply</p>\n\n<pre><code>moveAll = foldM (flip move)\n</code></pre>\n"}], "owner": {"reputation": 640, "user_id": 8015575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/600de8cfd5d1fbd41152c709122662f0?s=128&d=identicon&r=PG&f=1", "display_name": "Ben373", "link": "https://stackoverflow.com/users/8015575/ben373"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 497, "favorite_count": 1, "accepted_answer_id": 50178076, "answer_count": 1, "score": 1, "last_activity_date": 1525446667, "creation_date": 1525446180, "question_id": 50177920, "link": "https://stackoverflow.com/questions/50177920/haskell-foldl-monad-bind", "title": "Haskell foldl Monad bind", "body": "<p>I got a function</p>\n\n<pre><code>move :: Move -&gt; Node -&gt; Maybe Node\n</code></pre>\n\n<p>where I can use my bind monad to obtain a Maybe Node</p>\n\n<pre><code>(return n &gt;&gt;= move m) \n</code></pre>\n\n<p>where n::Node and m::Move, but how I can now fold through a list of Moves ([Move])?  </p>\n\n<p>I tried to do it with foldl but without success.</p>\n"}, {"tags": ["haskell", "haskell-stack", "haddock"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525453013, "post_id": 50175379, "comment_id": 87376730, "body": "There&#39;s a good reason to also build the docs for all dependencies: it makes sure the links will actually work! Cabal-install doesn&#39;t do this, which is not always a blessing."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1525524043, "post_id": 50184613, "comment_id": 87395861, "body": "Thanks, this seems to be working. Does it also build the package itself, along with generating the docs? It seems the compiling everything to <code>.o</code> files. Any way to avoid that and generate JUST the docs?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1525526243, "post_id": 50184613, "comment_id": 87396524, "body": "I don&#39;t think that&#39;s possible with stack. I&#39;m not sure if there are other ways to achieve that."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1525526899, "post_id": 50184613, "comment_id": 87396721, "body": "This command ends with a bunch of <code>Missing documentation for</code> warnings; reports <code>Completed 25 action(s).</code>; but then also says <code>Process exited with code: ExitFailure 1</code>. In <code>.stack-work&#47;install&#47;x86_64-osx&#47;lts-9.0&#47;8.0.2&#47;doc&#47;webservice-&zwnj;&#8203;0.1.0.0</code> the only file is <code>LICENSE</code>. A few other packages have documentation in <code>.stack-work&#47;install&#47;x86_64-osx&#47;lts-9.0&#47;8.0.2&#47;doc&#47;</code> which seems to be completely generated. Any idea what I&#39;m doing wrong?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1525527820, "post_id": 50184613, "comment_id": 87396994, "body": "The warnings aren&#39;t unusual. Is there no error message somewhere that could be connected to the ExitFailure? Also: did you start with a clean project, i.e. no <code>.stack-work</code>? If you could tell me how to reproduce the issue, I could possibly say more\u2026"}], "tags": [], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "is_accepted": true, "score": 4, "last_activity_date": 1525480474, "creation_date": 1525480474, "answer_id": 50184613, "question_id": 50175379, "link": "https://stackoverflow.com/questions/50175379/how-to-exclude-dependencies-when-building-haddocks/50184613#50184613", "title": "How to exclude dependencies when building haddocks?", "body": "<p>The flag you're looking for is <code>--no-haddock-deps</code> as in</p>\n\n<pre><code>stack haddock --no-haddock-deps webservice\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 1, "accepted_answer_id": 50184613, "answer_count": 1, "score": 4, "last_activity_date": 1525500548, "creation_date": 1525438181, "last_edit_date": 1525500548, "question_id": 50175379, "link": "https://stackoverflow.com/questions/50175379/how-to-exclude-dependencies-when-building-haddocks", "title": "How to exclude dependencies when building haddocks?", "body": "<p>Is there any way to build haddock docs for specific packages? I'm trying to build haddocks for my package/app alone, but the following command seems to be doing this for all dependencies, as well:</p>\n\n<pre><code>stack haddock webservice\n</code></pre>\n\n<p>(where <code>webservice</code> is the name of my package/app)</p>\n"}, {"tags": ["haskell", "types", "type-families"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1525473731, "post_id": 50170870, "comment_id": 87385222, "body": "In the unlikely event that this is not a minimized example: since you don&#39;t mention <code>a</code> alone anywhere in the class (only <code>T a</code>), consider <code>class C a where pred :: a -&gt; Bool</code>; it requires no fancy extensions, and is no less powerful (thanks to the <code>r -&gt; a</code> annotation on your associated type)."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1525498004, "post_id": 50170870, "comment_id": 87388874, "body": "@DanielWagner Even though it is minimized severely, I could actually use your advice. You see, I have two kinds of methods in my class: &quot;connecting&quot;, that have both <code>a</code> and <code>T a</code> in their signature, and &quot;isolated&quot;, that only have <code>T a</code>, but never <code>a</code>. (E.g. <code>pred</code> would be isolated.) Now, I can put all the isolated methods in a class <code>C</code>, and then put the connecting methods in a two-parameter subclass <code>C ta =&gt; B a ta</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 6, "last_activity_date": 1525427321, "creation_date": 1525427321, "answer_id": 50172057, "question_id": 50170870, "link": "https://stackoverflow.com/questions/50170870/can-i-drop-the-type-instantiation-from-an-instance-of-a-class-with-an-associated/50172057#50172057", "title": "Can I drop the type instantiation from an instance of a class with an associated type family?", "body": "<p>You can just add a default type instantiation:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n{-# LANGUAGE DefaultSignatures #-}\n\nmodule Study where\n\ndata One a = One a\n\nclass C a where\n    type T a = r | r -&gt; a\n    -- This looks a bit strange,\n    -- because it looks like T is defined twice\n    -- but that's not actually the case\n    type T a = [a]\n    pred :: T a -&gt; Bool\n\n    default pred :: T a ~ [a] =&gt; T a -&gt; Bool\n    pred = not . null\n\ninstance C Integer\n\ninstance C Char where\n  type T Char = One Char\n  pred = const True\n</code></pre>\n\n<hr>\n\n<pre><code>*Study&gt; :t undefined :: T Integer\nundefined :: T Integer :: [Integer]\n*Study&gt; :t undefined :: T Char\nundefined :: T Char :: One Char\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 50172057, "answer_count": 1, "score": 1, "last_activity_date": 1525427321, "creation_date": 1525423751, "question_id": 50170870, "link": "https://stackoverflow.com/questions/50170870/can-i-drop-the-type-instantiation-from-an-instance-of-a-class-with-an-associated", "title": "Can I drop the type instantiation from an instance of a class with an associated type family?", "body": "<p>I have this code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n{-# LANGUAGE DefaultSignatures #-}\n\nmodule Study where\n\nclass C a where\n    type T a = r | r -&gt; a\n    pred :: T a -&gt; Bool\n\n    default pred :: T a ~ [a] =&gt; T a -&gt; Bool\n    pred = not . null\n\ninstance C Integer where\n    type T Integer = [Integer]\n</code></pre>\n\n<p>It works like this:</p>\n\n<pre><code>\u03bb Study.pred [1,2,3]\nTrue\n\u03bb Study.pred ([ ] :: [Integer])\nFalse\n</code></pre>\n\n<p>I would like to reduce minimal instance definitions simply to:</p>\n\n<pre><code>instance C Integer\n</code></pre>\n\n<p>\u2014 Unless I want specifically to diverge from the pattern.</p>\n\n<p>Most of the instances I plan to have should be default, with <code>T a ~ [a]</code>, but some do need their\nown <code>T</code> type. I am reluctant to tolerate numerous identical trivial definitions like the given\none. What can be done?</p>\n"}, {"tags": ["haskell", "maybe", "monoids", "semigroup"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1525423034, "post_id": 50170631, "comment_id": 87358559, "body": "Well that is one of the constraints a monoid has to satisfy: there is an empty element <code>0</code>, and <code>0 + x = x + 0 = x</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525423849, "post_id": 50170631, "comment_id": 87359055, "body": "@WillemVanOnsem, yes, and OP&#39;s does satisfy that. Note: mempty = <i>Just</i> mempty."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1525423889, "post_id": 50170631, "comment_id": 87359076, "body": "@luqui: but then that would mean that we have a <code>mempty</code> for <code>a</code> right?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525423910, "post_id": 50170631, "comment_id": 87359082, "body": "@WillemVanOnsem, we do, because of the <code>Monoid a =&gt;</code> constraint."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525424314, "post_id": 50170631, "comment_id": 87359341, "body": "Aargh... Yes, I overlooked the <code>Monoid a</code> constraint :("}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 2, "creation_date": 1525424566, "post_id": 50170631, "comment_id": 87359520, "body": "<a href=\"https://ghc.haskell.org/trac/ghc/ticket/1189#comment:1\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/1189#comment:1</a> link to the mailing list discussion, with its summary"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1525432081, "post_id": 50170631, "comment_id": 87363901, "body": "You make the assumption that there is an &quot;error&quot; or &quot;failure&quot; semantic in the maybe, versus just a Nothing , Something semantic. The Nothing&lt;&gt;Something semantic is, is somehow equivalent to a list with 0 or 1 element. In that case, it seams natural that the concept of &quot;empty&quot; correspond to Nothing. For a list, you wouldn&#39;t expect <code>mempty</code> to be <code>[mempty]</code> wouldn&#39;t you ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1525437474, "post_id": 50170631, "comment_id": 87367226, "body": "@mb14 Sure, you can reduce the semantics of a type to its bare minimum. But <code>List</code> is a Monoid in its own right, whereas <code>Maybe</code> imposes a constraint on <code>a</code> (either <code>Semigroup a</code> or <code>Monoid a</code> depending on the implementation). So in case of <code>Maybe</code> we have to pick one."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1525469206, "post_id": 50170631, "comment_id": 87383964, "body": "Related: <a href=\"https://byorgey.wordpress.com/2011/04/18/monoids-for-maybe/\" rel=\"nofollow noreferrer\">Monoids for Maybe</a>; <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Semigroup.html#t:Option\" rel=\"nofollow noreferrer\">Option</a>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1525426996, "post_id": 50171196, "comment_id": 87360948, "body": "So decision/compromises have to be made in Haskell, just like in imperative languages. But the possibility to decide is limited to the cases that the underlying mathematical framework allows, which is a big win - probably."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1525427411, "post_id": 50171196, "comment_id": 87361208, "body": "I see this issue coming from the core idea of typeclasses which is a sort of pun, pretending that types and algebraic structures are in perfect correspondence (e.g. there is only one way a type can be a monad).  It&#39;s often, but not always true.  But making that little lie makes a <i>lot</i> of things very convenient and cuts down on a lot of mess that would otherwise be there, manually keeping track of which algebraic structure we&#39;re talking about.  But then there are cases like this where we have to pick favorites and/or disambiguate manually, and it can be cumbersome."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1525428228, "post_id": 50171196, "comment_id": 87361710, "body": "Your answer along with the comment provides a great explanation for a vague question. Thank you!"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1525438459, "post_id": 50171196, "comment_id": 87367889, "body": "<a href=\"http://www.catb.org/jargon/html/O/on-the-gripping-hand.html\" rel=\"nofollow noreferrer\">&quot;on the gripping hand&quot;</a>, perhaps? :)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 7, "last_activity_date": 1525424729, "creation_date": 1525424729, "answer_id": 50171196, "question_id": 50170631, "link": "https://stackoverflow.com/questions/50170631/why-is-maybes-semigroup-instance-biased-towards-just-and-the-monoid-uses-nothin/50171196#50171196", "title": "Why is Maybe&#39;s Semigroup instance biased towards Just and the Monoid uses Nothing as its empty element?", "body": "<p>Your instance is actually a special case of a much more general instance for applicative functors.  </p>\n\n<pre><code>newtype LiftA f a = LiftA { getLiftA :: f a }\n\ninstance (Applicative f, Semigroup a) =&gt; Semigroup (LiftA f a) where\n    LiftA x &lt;&gt; LiftA y = LiftA $ liftA2 (&lt;&gt;) x y\n\ninstance (Applicative f, Monoid a) =&gt; Monoid (LiftA f a) where\n    mempty = LiftA $ pure mempty\n</code></pre>\n\n<p>Which I assumed would be in the standard library somewhere (under a different name probably) but I couldn't find it.  But the existence of this general instance could be one reason to choose the library version of <code>Maybe</code>, which is more of <code>Maybe</code>'s special power.  On the other hand, it's quite nice when your algebraic structures are all coherent with each other; i.e. when a type is an <code>Applicative</code>, use the \"<code>LiftA</code>\"-style instance whenever possible (on all <a href=\"https://lukepalmer.wordpress.com/2013/03/12/constructions-on-typeclasses-part-1-f-algebras/\" rel=\"noreferrer\">F-algebra</a> classes).</p>\n\n<p>On the third hand (!), we can't have coherence everywhere, since the library instance agrees with <code>Maybe</code>'s <code>MonadPlus</code> instance.  This is strikingly parallel to the fact that there are two monoids on natural numbers: addition and multiplication.  For numbers, we just picked not to have <em>any</em> monoid instance because it's unclear which to use. </p>\n\n<p>In conclusion, I don't know.  But maybe this information was helpful.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1525456537, "last_edit_date": 1525456537, "creation_date": 1525438778, "answer_id": 50175578, "question_id": 50170631, "link": "https://stackoverflow.com/questions/50170631/why-is-maybes-semigroup-instance-biased-towards-just-and-the-monoid-uses-nothin/50175578#50175578", "title": "Why is Maybe&#39;s Semigroup instance biased towards Just and the Monoid uses Nothing as its empty element?", "body": "<p>I think the idea behind this is that <code>Maybe</code> is supposed to have the semantics that are actually only properly expressed by <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Semigroup.html#t:Option\" rel=\"nofollow noreferrer\"><code>Option</code></a>: it takes any semigroup and makes a monoid out of it, by adding <code>Nothing</code> as an ad-hoc \u201cfree mempty\u201d. I.e. actually the instances should be</p>\n\n<pre><code>instance Semigroup a => Semigroup (Maybe a) where\n  Nothing &lt;> a = a\n  a &lt;> Nothing = a\n  Just x &lt;> Just y = Just $ x &lt;> y\n\ninstance <b>Semigroup</b> a => Monoid (Maybe a) where\n  mappend = (&lt;>)\n  mempty = Nothing\n</code></pre>  \n\n<p>This is analogous to how <code>[]</code> gives the free monoid over <em>any</em> type, by adding both <code>mempty</code> and <code>&lt;&gt;</code>.</p>\n\n<p>Of course, this requires that the <code>Semigroup</code> class is in <code>base</code>, which it wasn't until recently.</p>\n\n<p>Corollary to this is that <code>mempty</code> becomes clearly pattern-matchable, because by parametricity it cannot depend on the contained type.</p>\n\n<p>Practically speaking, this instance is arguably more useful then the one you propose, because as Luke remarked that is already covered by the <code>Applicative</code> instance so you can easily write <code>liftA2 (&lt;&gt;)</code> and <code>pure mempty</code>. Granted, the standard instance is also already covered by the <code>Alternative</code> instance, but <code>Alternative/MonadPlus</code> have always been considered as a bit hackish, inferior to the more mathematically impeccable <code>Semigroup</code>, <code>Monoid</code>, <code>Functor</code> and <code>Applicative</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1525456537, "creation_date": 1525422965, "last_edit_date": 1525429019, "question_id": 50170631, "link": "https://stackoverflow.com/questions/50170631/why-is-maybes-semigroup-instance-biased-towards-just-and-the-monoid-uses-nothin", "title": "Why is Maybe&#39;s Semigroup instance biased towards Just and the Monoid uses Nothing as its empty element?", "body": "<p><code>Maybe</code> expresses computations that might not produce a result due to an error. Therefore such computations must be short circuited.</p>\n\n<p>Now <code>Maybe</code>'s Semigroup/Monoid instances seem to break with this semantics, because the former is biased towards <code>Just</code> and the latter treats the error case <code>Nothing</code> as its empty element:</p>\n\n<pre><code>Just \"foo\" &lt;&gt; Nothing -- Just \"foo\"\nNothing &lt;&gt; Just \"bar\" -- Just \"bar\"\nJust \"foo\" &lt;&gt; Just \"bar\" -- Just \"foobar\"\nNothing &lt;&gt; Nothing -- Nothing\n</code></pre>\n\n<p>I would expect <code>Nothing</code> for the first two cases.</p>\n\n<p>Here is the alternative implementation (hopefully it is correct/lawful):</p>\n\n<pre><code>instance Semigroup a =&gt; Semigroup (Maybe a) where\n    Nothing &lt;&gt; _       = Nothing\n    _       &lt;&gt; Nothing = Nothing\n    Just a  &lt;&gt; Just b  = Just (a &lt;&gt; b)\n\ninstance Monoid a =&gt; Monoid (Maybe a) where\n  mempty = Just mempty\n</code></pre>\n\n<p>I don't want to say that these alternative instances are better. But they seem useful too. So why was a selection made in the first place instead of leaving the implementation to the user?</p>\n"}, {"tags": ["haskell", "types", "typeclass", "type-constraints", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525422732, "post_id": 50170540, "comment_id": 87358397, "body": "The last is because you forgot to close a string literal."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525422774, "post_id": 50170540, "comment_id": 87358424, "body": "And the second one actually works for me."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1525424011, "post_id": 50170540, "comment_id": 87359136, "body": "&quot;I don&#39;t either understand why I need to put the &#39;show&#39; if normally in the examples of the book It don&#39;t need it.&quot; - This should probably be a separate question, and you should elaborate on it, e.g. by showing one of the examples where you don&#39;t need it."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1525431279, "post_id": 50170540, "comment_id": 87363444, "body": "Voting to close, questions whose answer turns out to be &quot;this is a typo&quot; are off topic on SO."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1525432629, "post_id": 50170540, "comment_id": 87364202, "body": "@Cubic the OP claims they made the copying error when typing the question on SO, not in the actual code. Without the <code>&quot;</code> we get a different error than the one shown in the Q. So it&#39;s unclear. But they also asked about the necessity of  <code>Show</code> context."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525963369, "post_id": 50170540, "comment_id": 87567664, "body": "@ooootramas yes, it is either <code>toString&#39; :: [Int] -&gt; String</code> (or similar), or <code>toString&#39; :: (Show a) =&gt; [a] -&gt; String</code>. the last one means it should work for <i>any</i> type <code>a</code>, as I write in my answer. (this is how you can <i>ping</i> a user on SO in the comments: type @ and then Tab to complete the name, then type your message to them; they will be notified)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525963866, "post_id": 50170540, "comment_id": 87568003, "body": "don&#39;t worry about the votes. you have two up votes, it&#39;s OK."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9640427"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1525967546, "post_id": 50170540, "comment_id": 87570238, "body": "ok, Thank you @WillNess  ;)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525967839, "post_id": 50170540, "comment_id": 87570395, "body": "you&#39;re welcome. :)"}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1525424445, "creation_date": 1525424445, "answer_id": 50171120, "question_id": 50170540, "link": "https://stackoverflow.com/questions/50170540/in-haskell-could-a-be-anything/50171120#50171120", "title": "In Haskell, could `a` be anything?", "body": "<p>This is not a type error, this is a <em>syntax</em> error. You're just missing the closing quote on the end of the line.</p>\n\n<pre><code>toString' [\"abc\", \"bc\", \"efc\"]\n                            ^\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1525432091, "last_edit_date": 1525432091, "creation_date": 1525427802, "answer_id": 50172211, "question_id": 50170540, "link": "https://stackoverflow.com/questions/50170540/in-haskell-could-a-be-anything/50172211#50172211", "title": "In Haskell, could `a` be anything?", "body": "<p>I've just copied your code into my GHCi and all three of your examples work. <code>Prelude&gt; toString' [\"abc\", \"bc\", \"efc\"]</code> produces \n<code>\"\\\"abc\\\", \\\"bc\\\" and \\\"efc\\\"\"</code>. </p>\n\n<p>What I think happened is you tried your definition inside GHCi without the type signature, and monomorphism restriction kicked in. That's why only one of the examples \"worked\" for you.</p>\n\n<p>About the <code>Show</code> constraint, since you're using  <code>show :: Show a =&gt; a -&gt; String</code> function, yes, it is necessary.</p>\n\n<p>If you were defining a <em>specific</em> version <code>toString'Int :: [Int] -&gt; String</code> (or <code>Char</code>) there'd be no problem. But you're defining it for <code>[a]</code> -- for <em>any</em> <code>a</code>. And since you're using <code>show (x :: a)</code>, <em>any</em> <code>a</code> that this function accepts must belong to <code>Show</code>. This is expressed as <code>(Show a) =&gt; ....</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9640427"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "closed_date": 1525463836, "accepted_answer_id": 50172211, "answer_count": 2, "score": 0, "last_activity_date": 1525963791, "creation_date": 1525422660, "last_edit_date": 1525963791, "question_id": 50170540, "link": "https://stackoverflow.com/questions/50170540/in-haskell-could-a-be-anything", "closed_reason": "Not suitable for this site", "title": "In Haskell, could `a` be anything?", "body": "<p>While I have been reading the documentation I always thought that <code>a</code> could be anything in:</p>\n\n<pre><code>example :: a -&gt; a \n</code></pre>\n\n<p>'a' could be a <code>Char</code>, <code>String</code>, <code>Int</code>, <code>Integer</code>.</p>\n\n<p>Of course if I put:</p>\n\n<pre><code>example :: [a] -&gt; a\n</code></pre>\n\n<p>The imput should be a list, but a list of whatever: <code>[\"ab\", \"cd\"]</code>, <code>[1,2]</code> or <code>['s', 'c']</code>.</p>\n\n<p>But in my code:</p>\n\n<pre><code>toString' :: (Show a) =&gt; [a] -&gt; String\ntoString' [] = \"empty\"\ntoString' [x] = \" and \" ++ show x\ntoString' (x:y:[]) = show x ++ toString' [y]\ntoString' (x:xs) = show x ++ \", \" ++ toString' xs\n</code></pre>\n\n<p>It should work, but isn't always working:</p>\n\n<pre><code>Prelude&gt; toString' ['a', 'b', 'c']  -- Works\nPrelude&gt; toString' [1, 2, 3]  -- Don't work\nPrelude&gt; toString' [\"abc\", \"bc\", \"efc\"] -- Don't work\n</code></pre>\n\n<p>I don't understand why I need to add the <code>Show</code> constraint if normally in the examples of the book I don't need it.</p>\n\n<p>UPDATE</p>\n\n<p>Ok, no, it isn't the change from <code>[\"abc\", \"bc\", \"efc]</code> to <code>[\"abc\", \"bc\", \"efc\"]</code>, actually in the code I have it right, it's only here that I typed it wrong, first.</p>\n\n<p>And about the <code>Show</code>, can you answer me if it's necessary to use it in this code?</p>\n\n<p>UPDATE 2</p>\n\n<p>I don't know if this going to be usefull if you downvoted it, or it will be closed, but anyway</p>\n\n<p>The code works better if in the last line I use:</p>\n\n<pre><code>toString' (x:xs) = show x ++ \", \" ++ (toString' xs)\n</code></pre>\n\n<p>but still don't understand why I need the <code>Show</code> (I mean, why I can't remove it from the code?)</p>\n\n<p>UPDATE 3</p>\n\n<p>I see my error with <code>Show</code>, if you use a variable type <code>a</code> and not a <code>String</code>, you need <code>Show</code>, maybe because it could Haskell doesn't know which type it is until you put a value, so it needs to know you'll want to show it, or because there are some types of variables that don't extend <code>Show</code> by themselves.</p>\n"}, {"tags": ["haskell", "types", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1525421723, "post_id": 50169630, "comment_id": 87357880, "body": "Well, this kind of works. I still cannot write an empty <code>instance C Integer</code>. I have to specify the <code>type T Integer = [Integer]</code>. But at least I can omit the definition of <code>pred</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 2, "creation_date": 1525474097, "post_id": 50169630, "comment_id": 87385316, "body": "@IgnatInsarov, if you want an empty instance, you can also provide a default for <code>T</code> by adding the line <code>type T a = [a]</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1567154850, "last_edit_date": 1567154850, "creation_date": 1525419421, "answer_id": 50169630, "question_id": 50167812, "link": "https://stackoverflow.com/questions/50167812/can-i-have-a-default-type-value-for-an-associated-type-family/50169630#50169630", "title": "Can I have a default type value for an associated type family?", "body": "<p>You need a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=default#extension-DefaultSignatures\" rel=\"nofollow noreferrer\">default signature</a>.</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| class C a where\nPrelude|   type T a = r | r -&gt; a\nPrelude|   pred :: T a -&gt; Bool\nPrelude|   default pred :: (T a ~ [a]) =&gt; T a -&gt; Bool\nPrelude|   pred = not . null\nPrelude| :}\n</code></pre>\n\n<p><em>(Thanks to @luqui.)</em> Note that, if you want to be able to write an empty <code>instance C Integer</code>, you should also provide a default for <code>T</code> by adding the line <code>type T a = [a]</code>.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 1, "accepted_answer_id": 50169630, "answer_count": 1, "score": 4, "last_activity_date": 1567154850, "creation_date": 1525412017, "last_edit_date": 1525416105, "question_id": 50167812, "link": "https://stackoverflow.com/questions/50167812/can-i-have-a-default-type-value-for-an-associated-type-family", "title": "Can I have a default type value for an associated type family?", "body": "<p>Consider this code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n\nmodule Study where\n\nclass C a where\n    type T a = r | r -&gt; a\n    pred :: T a -&gt; Bool\n    pred _ = True\n</code></pre>\n\n<p>I want to have a more meaningful default definition of <code>pred</code>, like this:</p>\n\n<pre><code>class C' a where\n    ...\n    pred' = not . null\n</code></pre>\n\n<p><em>(I imagine a default</em> <code>T' a</code> <em>to be</em> <code>= [a]</code><em>.)</em></p>\n\n<p>Is there a way?</p>\n"}, {"tags": ["parsing", "haskell", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "edited": false, "score": 0, "creation_date": 1525417848, "post_id": 50167825, "comment_id": 87355758, "body": "I&#39;m sorry, but could you please elaborate a bit ? or give an example? Because I have been looking at the documentation for &quot;sepBy&quot; and Im not sure how to apply it specifically in this case."}], "tags": [], "owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "is_accepted": true, "score": 3, "last_activity_date": 1525439213, "last_edit_date": 1525439213, "creation_date": 1525412085, "answer_id": 50167825, "question_id": 50167415, "link": "https://stackoverflow.com/questions/50167415/recursively-return-all-words-from-txt-file-using-attoparsec/50167825#50167825", "title": "Recursively return all words from .txt file using attoparsec", "body": "<p>You have a pretty good start already - you can parse a word.<br>\nWhat you need next is a <code>Parser [Prose]</code>, which can be expressed by combining your <code>prose</code> parser with another one which consumes the \"not prose\" parts, using <code>sepBy</code> or <code>sepBy1</code>, which you can look up in the <code>Data.Attoparsec.Text</code> documentation.</p>\n\n<p>From there, the easiest way to get the word count would be to simply get the length of your obtained <code>[Prose]</code>.\n<br><br>\nEDIT:<br><br>\nHere is a minimal working example. The <code>Parser</code> runner has been swapped for <code>parseOnly</code> to allow for residual input to be ignored, meaning that a trailing non-word won't make the parser go cray-cray.<br></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Atto where\n\n--import qualified Data.Text.IO as Txt\nimport Data.Attoparsec.Text\nimport Control.Applicative ((*&gt;), (&lt;$&gt;), (&lt;|&gt;), pure)\n\nimport qualified Data.Text as T\n\ndata Prose = Prose {\n  word :: String\n} deriving Show\n\noptional :: Parser a -&gt; Parser ()\noptional p = option () (try p *&gt; pure ())\n\n-- Modified to disallow empty words, switched to applicative style\nprose :: Parser Prose\nprose = Prose &lt;$&gt; many1' letter\n\nseparator :: Parser ()\nseparator = many1 (space &lt;|&gt; satisfy (inClass \",.'\")) &gt;&gt; pure ()\n\nwordParser :: String -&gt; [Prose]\nwordParser str = case parseOnly wp (T.pack str) of\n    Left err -&gt; error err\n    Right x -&gt; x\n    where\n        wp = optional separator *&gt; prose `sepBy1` separator\n\nmain :: IO ()\nmain = do\n  let input = \"Hello World, I am Elliot Anderson. \\nAnd I'm Mr.Robot.\\n\"\n  let words = wordParser input\n  print words\n  print $ length words\n</code></pre>\n\n<p>The provided parser does not give the exact same result as <code>concatMap words . lines</code> since it also breaks words on <code>.,'</code>. Modifying this behaviour is left as a simple exercise.</p>\n\n<p>Hope it helps! :)</p>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1525439284, "last_edit_date": 1525439284, "creation_date": 1525437747, "answer_id": 50175238, "question_id": 50167415, "link": "https://stackoverflow.com/questions/50167415/recursively-return-all-words-from-txt-file-using-attoparsec/50175238#50175238", "title": "Recursively return all words from .txt file using attoparsec", "body": "<p>You're on the right track! You've written a parser (<code>prose</code>) which reads a single word: <code>many' letter</code> recognises a sequence of letters.</p>\n\n<p>So now that you've figured out how to parse a single word, your job is to scale this up to parse a sequence of words separated by spaces. That's what <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.2.2/docs/Data-Attoparsec-Text.html#v:sepBy\" rel=\"nofollow noreferrer\"><code>sepBy</code></a> does: <code>p `sepBy` q</code> runs the <code>p</code> parser repeatedly with the <code>q</code> parser interspersed.</p>\n\n<p>So a parser for a sequence of words looks something like this (I've taken the liberty of renaming your <code>prose</code> to <code>word</code>):</p>\n\n<pre><code>word = many letter\nphrase = word `sepBy` some space  -- \"some\" runs a parser one-or-more times\n\nghci&gt; parseOnly phrase \"wibble wobble wubble\"  -- with -XOverloadedStrings\nRight [\"wibble\",\"wobble\",\"wubble\"]\n</code></pre>\n\n<p>Now, <code>phrase</code>, being composed out of <code>letter</code> and <code>space</code>, will die on non-letter non-space characters such as <code>'</code> and <code>.</code>. I'll leave it to you to figure out how to fix that. (As a hint, you'll probably need to change <code>many letter</code> to <code>many (letter &lt;|&gt; ...)</code>, depending on how exactly you want it to behave on the various punctuation marks.)</p>\n"}], "owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 1, "accepted_answer_id": 50167825, "answer_count": 2, "score": 1, "last_activity_date": 1525439284, "creation_date": 1525409835, "last_edit_date": 1525411820, "question_id": 50167415, "link": "https://stackoverflow.com/questions/50167415/recursively-return-all-words-from-txt-file-using-attoparsec", "title": "Recursively return all words from .txt file using attoparsec", "body": "<p>I am fairly new to Haskell and I'm just starting to learn how to work with attoparsec for parsing huge chunks of english text from a .txt file. I know how to get the number of words in a .txt file without using attoparsec, but I'm kinda stuck with attoparsec. When I run my code below, on let's say </p>\n\n<blockquote>\n  <p>\"Hello World, I am Elliot Anderson. \\nAnd I'm Mr.Robot.\\n\"</p>\n</blockquote>\n\n<p>I only get back: </p>\n\n<blockquote>\n  <p>World, I am Elliot Anderson. \\nAnd I'm Mr.Robot.\\n\" (Prose {word =\n  \"Hello\"})</p>\n</blockquote>\n\n<p>This is my current code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Control.Exception (catch, SomeException)\nimport System.Environment (getArgs)\nimport Data.Attoparsec.Text\nimport qualified Data.Text.IO as Txt\nimport Data.Char\nimport Control.Applicative ((&lt;*&gt;), (*&gt;), (&lt;$&gt;), (&lt;|&gt;), pure)\n\n{-\nThis is how I would usually get the length of the list of words in a .txt file normally.\n\ncountWords :: String -&gt; Int\ncountWords input = sum $ map (length.words) (lines input)\n\n-}\n\ndata Prose = Prose {\n  word :: String\n} deriving Show\n\nprose :: Parser Prose\nprose = do\n  word &lt;- many' $ letter\n  return $ Prose word\n\nmain :: IO()\nmain = do\n  input &lt;- Txt.readFile \"small.txt\"\n  print $ parse prose input\n</code></pre>\n\n<p>Also how can I get the integer count of words, later on? Furthermore any suggestions on how to get started with attoparsec?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": true, "score": 1, "last_activity_date": 1525496936, "last_edit_date": 1525496936, "creation_date": 1525412456, "answer_id": 50167895, "question_id": 50166215, "link": "https://stackoverflow.com/questions/50166215/how-to-modify-a-state-monad/50167895#50167895", "title": "How to modify a state monad?", "body": "<p><strike>It looks like you could use <a href=\"https://www.stackage.org/haddock/lts-10.4/amqp-0.18.1/Network-AMQP-Lifted.html#v:consumeMsgs\" rel=\"nofollow noreferrer\">Network.AMQP.Lifted.consumeMsgs</a>. <code>StateT s IO</code> is an instance of <code>MonadBaseControl IO m</code>, so you could run whole <code>consumeMsgs</code> inside single <code>runStateT</code></strike> </p>\n\n<p>Yes, StateT monad transformer is basically a nice notation for a pure code, so if your API accepts only IO callbacks you have no choice but to use \"real\" state like MVar or IORef etc.</p>\n\n<p>PS: As <a href=\"https://stackoverflow.com/a/50170903/2303202\">other answer</a> suggests, the state changes done in <a href=\"https://www.stackage.org/haddock/lts-10.4/amqp-0.18.1/Network-AMQP-Lifted.html#v:consumeMsgs\" rel=\"nofollow noreferrer\">Network.AMQP.Lifted.consumeMsgs</a>'s callback do not propagate to subsequent callback runs or resulting state. I cannot wrap my head around the implementation, but I tried <a href=\"https://www.stackage.org/haddock/lts-11.7/monad-control-1.0.2.3/Control-Monad-Trans-Control.html#v:liftBaseWith\" rel=\"nofollow noreferrer\">liftBaseWith</a> a bit and it really looks like so.</p>\n"}, {"tags": [], "owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "is_accepted": false, "score": 1, "last_activity_date": 1525423879, "creation_date": 1525423879, "answer_id": 50170903, "question_id": 50166215, "link": "https://stackoverflow.com/questions/50166215/how-to-modify-a-state-monad/50170903#50170903", "title": "How to modify a state monad?", "body": "<p>To add a clarification that might be useful for future reference, the accepted answer is not exact. While <code>Network.AMQP.Lifted.consumeMsgs</code> should work with <code>StateT s IO</code>, the RabbitMQ haskell library actually discards the monadic state after each use. This means that if you do use that instance, you will not see changes made after the initial <code>consumeMsgs</code> call, including changes made by the callback itself. The callback is basically called with the same Monadic state every time - the state in which it was when the callback was registered.</p>\n\n<p>This means that you can use it to pass global configuration state, but <em>not</em> to keep track of state between callback executions.</p>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 1, "accepted_answer_id": 50167895, "answer_count": 2, "score": 3, "last_activity_date": 1525496936, "creation_date": 1525400321, "question_id": 50166215, "link": "https://stackoverflow.com/questions/50166215/how-to-modify-a-state-monad", "title": "How to modify a state monad?", "body": "<p>I use State Monad Transformer to manage global state like this</p>\n\n<pre><code>data State = State ...\nStateT State IO ()\n</code></pre>\n\n<p>And I use <code>amqp</code> to consume messages from RabbitMQ. The state will be modified according to messages received. The function has the type like</p>\n\n<pre><code>consumeMsgs :: Channel \n            -&gt; Text \n            -&gt; Ack \n            -&gt; ((Message, Envelope) -&gt; IO ())  -- ^ the callback function\n            -&gt; IO ConsumerTag\n</code></pre>\n\n<p>Right now we can ignore other parameters but the third which is a callback function I will supply and where the modification happen.</p>\n\n<p>Because it's a mainly IO Monad, so I use this function as follows</p>\n\n<pre><code>consumeMsgs chan queue Rmq.Ack (flip evalStateT ssss . rmqCallback)\n</code></pre>\n\n<p>Here the <code>ssss</code> is the state I put in and I find that during the process of my callback function <code>rmqCallback</code> the state can be correctly modified. But, every time next callback happens the global state is the same as before the consumeMsgs is called or equal with <code>ssss</code>.</p>\n\n<p>I understand State Monad is just a process needing an initial state to put in and maintain the state during whole way but has nothing to do with the state out of Monad (am I missing something?),  so I count on MVar to hold and modify the state, and that works. I want to know it's there other way to handle this, maybe another Monad?</p>\n"}, {"tags": ["parsing", "haskell", "attoparsec"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1525388800, "creation_date": 1525388800, "answer_id": 50164943, "question_id": 50164814, "link": "https://stackoverflow.com/questions/50164814/issue-with-overloading-strings-in-haskell-using-attoparsec/50164943#50164943", "title": "Issue with overloading strings in Haskell using attoparsec", "body": "<p><code>-XOverloadedStrings</code> only changes the type of <em>string literals</em> from <code>String</code> to the more general <code>IsString a =&gt; a</code> (which can be unified with <code>String</code>, <code>Text</code>, <code>ByteString</code> and more). In your code, there's just one literal: the file name <code>\"small.txt\"</code>.</p>\n\n<p><em>But file names are always <code>String</code> anyway!</em> Well, <code>FilePath</code>, but that's just a synonym for <code>String</code>. (Even the <code>Data.Text.IO</code> functions take filenames as such plain-old-list strings.) So the overloaded string literal actually makes no difference here at all.</p>\n\n<p>But the parser does not process file names but file <em>contents</em>, so what you need to do is use IO routines that obtain this content as <code>Text</code>.</p>\n\n<pre><code>import qualified Data.Text.IO as Txt\n\nmain :: IO()\nmain = do\n  input &lt;- Txt.readFile \"small.txt\"\n  print $ parse prose input\n</code></pre>\n"}], "owner": {"reputation": 190, "user_id": 4762363, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/BdZxT.jpg?s=128&g=1", "display_name": "centrinok", "link": "https://stackoverflow.com/users/4762363/centrinok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 50164943, "answer_count": 1, "score": 0, "last_activity_date": 1525388800, "creation_date": 1525387788, "question_id": 50164814, "link": "https://stackoverflow.com/questions/50164814/issue-with-overloading-strings-in-haskell-using-attoparsec", "title": "Issue with overloading strings in Haskell using attoparsec", "body": "<p>First of all I would like to let you know that I'm fairly new to Haskell and I'm trying to understand how parsers work in haskell . So I'm basically trying to parse this e-book from <a href=\"http://www.gutenberg.org/files/57071/57071-0.txt\" rel=\"nofollow noreferrer\">http://www.gutenberg.org/files/57071/57071-0.txt</a> and analyze the text. Like output the number of english words, sentences and paragraphs and such. \nHere's my code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Exception (catch, SomeException)\nimport System.Environment (getArgs)\nimport Data.Attoparsec.Text\nimport Data.Char\nimport Control.Applicative ((&lt;*&gt;), (*&gt;), (&lt;$&gt;), (&lt;|&gt;), pure)\n\n\ndata Prose = Prose {\n  word :: String\n} deriving Show\n\nprose :: Parser Prose\nprose = do\n  word &lt;- many' $ satisfy isAlphaNum\n  return $ Prose word\n\nmain :: IO()\nmain = do\n  input &lt;- readFile \"small.txt\"\n  print $ parse prose input\n</code></pre>\n\n<p>This is my error message: </p>\n\n<ul>\n<li>Couldn't match type \u2018[Char]\u2019 with \u2018Data.Text.Internal.Text\u2019;<br>\n  Expected type: Data.Text.Internal.Text;<br>\n  Actual type: String</li>\n<li>In the second argument of \u2018parse\u2019, namely \u2018input\u2019\nIn the second argument of \u2018($)\u2019, namely \u2018parse prose input\u2019\nIn a stmt of a 'do' block: print $ parse prose input</li>\n</ul>\n\n<p>I have used \"OverloadedStrings\" to try and fix this issue, but it doesnt seem to work. Also any guidance on examples or tutorials to get started with attoparsec would be greatly helpful!</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1525383375, "creation_date": 1525383375, "answer_id": 50164176, "question_id": 50164021, "link": "https://stackoverflow.com/questions/50164021/fmap-a-2-arity-function-on-nothing-should-return-nothing/50164176#50164176", "title": "fmap a 2-arity function on Nothing should return Nothing?", "body": "<p>Yes, <code>fmap f Nothing = Nothing</code> no matter what <code>f</code> is or what type it has. The <code>Show</code> instance for <code>Maybe</code> looks like</p>\n\n<pre><code>instance Show a =&gt; Show (Maybe a) where\n  ...\n</code></pre>\n\n<p>So you can't <code>show</code> or <code>print</code> a value of type <code>Maybe (A -&gt; B)</code> because functions don't have a <code>Show</code> instance.</p>\n"}, {"comments": [{"owner": {"reputation": 2453, "user_id": 1215410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eee998ff263fb88dac8b490195c8e774?s=128&d=identicon&r=PG", "display_name": "Dapeng Li", "link": "https://stackoverflow.com/users/1215410/dapeng-li"}, "edited": false, "score": 0, "creation_date": 1525384689, "post_id": 50164218, "comment_id": 87346777, "body": "Thank for very much for the detailed answer!"}], "tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 7, "last_activity_date": 1525383569, "creation_date": 1525383569, "answer_id": 50164218, "question_id": 50164021, "link": "https://stackoverflow.com/questions/50164021/fmap-a-2-arity-function-on-nothing-should-return-nothing/50164218#50164218", "title": "fmap a 2-arity function on Nothing should return Nothing?", "body": "<p>Yes. Let's look at the types:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n(++) :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>so,</p>\n\n<pre><code>fmap (++) :: Functor f =&gt; f [a] -&gt; f ([a] -&gt; [a])\n</code></pre>\n\n<p><code>fmap</code> takes a 1-arity function. However, in Haskell a 2-arity function is just a 1-arity function that returns another 1-arity function:</p>\n\n<pre><code>([a] -&gt; [a] -&gt; [a]) ~ ([a] -&gt; ([a] -&gt; [a]))\n</code></pre>\n\n<p>so your <code>fmap (++) :: Maybe [a] -&gt; Maybe ([a] -&gt; [a])</code></p>\n\n<p>If you pass <code>Nothing</code> to this, it returns <code>Nothing</code>. If you pass <code>Just \"foo\"</code> (for example), it returns <code>Just</code> a function that takes a string and prepends <code>\"foo\"</code> to it:</p>\n\n<pre><code>Prelude&gt; Just f = fmap (++) $ Just \"foo\"\nPrelude&gt; f \"bar\"\n\"foobar\"\n</code></pre>\n\n<p>The reason you get an error is because GHCi tries to print the output, meaning the output must implement the <code>Show</code> typeclass. What it's trying to <code>show</code> is <code>Nothing :: Maybe ([a] -&gt; [a])</code>. The type system doesn't know it just has to print <code>Nothing</code>, all it knows is it can't <code>show</code> an <code>[a] -&gt; [a]</code>. So it prints the error.</p>\n"}], "owner": {"reputation": 2453, "user_id": 1215410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eee998ff263fb88dac8b490195c8e774?s=128&d=identicon&r=PG", "display_name": "Dapeng Li", "link": "https://stackoverflow.com/users/1215410/dapeng-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 50164176, "answer_count": 2, "score": 1, "last_activity_date": 1525383569, "creation_date": 1525382457, "question_id": 50164021, "link": "https://stackoverflow.com/questions/50164021/fmap-a-2-arity-function-on-nothing-should-return-nothing", "title": "fmap a 2-arity function on Nothing should return Nothing?", "body": "<p>From the source of <code>Maybe</code> in <a href=\"https://github.com/ghc/ghc/blob/master/libraries/base/GHC/Base.hs#L844\" rel=\"nofollow noreferrer\">ghc</a>:</p>\n\n<pre><code>instance Functor Maybe where\n    fmap _ Nothing  = Nothing\n    fmap f (Just a) = Just (f a)\n</code></pre>\n\n<p>When <code>fmap</code> is applied to <code>Nothing</code>, it should return <code>Nothing</code>.</p>\n\n<p>For example, run this in ghci (v8.2.2):</p>\n\n<pre><code>Prelude&gt; fmap (+1) Nothing\nNothing\n</code></pre>\n\n<p>However, when I apply a function with an arity of 2:</p>\n\n<pre><code>Prelude&gt; fmap (++) Nothing\n&lt;interactive&gt;:11:1: error:\n    \u2022 No instance for (Show ([a0] -&gt; [a0]))\n        arising from a use of \u2018print\u2019\n        (maybe you haven't applied a function to enough arguments?)\n    \u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>In fact, the result seems to be <code>Nothing</code>:</p>\n\n<pre><code>Prelude&gt; import Data.Maybe\nPrelude Data.Maybe&gt; isNothing $ fmap (++) Nothing\nTrue\n</code></pre>\n\n<p>My question is, does <code>fmap (++) Nothing</code> really return <code>Nothing</code>?</p>\n"}, {"tags": ["haskell", "swagger", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "edited": false, "score": 0, "creation_date": 1525419570, "post_id": 50163970, "comment_id": 87356696, "body": "You have definitely identified the problem, thank you very much. It&#39;s a little embarrassing, not even close to what I thought it was! As you can see, the PathItem might contain multiple operations. I want to insert an operationId wherever one exists. I&#39;ve tried using traverse, and each, in various combinations e.g. <code>genOpsId = paths %~ InsOrdHashMap.mapWithKey (\\k v -&gt; v . traverse ?~ (mempty &amp; operationId ?~ (pack &quot;hello&quot;)))</code>. Do you know how I might achieve that? Also, I&#39;m a little confused about what <code>mempty &amp; operationId</code> is doing, do you know what I might read to understand that? Thanks!"}, {"owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "edited": false, "score": 0, "creation_date": 1525420134, "post_id": 50163970, "comment_id": 87357012, "body": "Never mind that second question, got the <code>mempty &amp; operationId</code> bit!"}, {"owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "edited": false, "score": 0, "creation_date": 1525423041, "post_id": 50163970, "comment_id": 87358564, "body": "<code>For the record, I&#39;m pretty sure there&#39;s a way, way, way cleaner way to do this, but here goes.</code> haha, thank you very much!"}], "tags": [], "owner": {"reputation": 291, "user_id": 9529580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e826697f12ac7b6de2a502cd1e7e0b5?s=128&d=identicon&r=PG", "display_name": "Vora", "link": "https://stackoverflow.com/users/9529580/vora"}, "is_accepted": true, "score": 2, "last_activity_date": 1525422905, "last_edit_date": 1525422905, "creation_date": 1525382197, "answer_id": 50163970, "question_id": 50160738, "link": "https://stackoverflow.com/questions/50160738/haskell-swagger-lens-autogeneration/50163970#50163970", "title": "Haskell Swagger Lens autogeneration", "body": "<p>Disclaimer : I never used Swagger.\nHowever, looking at the documentation for it, I can see the following element in the Swagger type :<br>\n<code>_swaggerPaths :: InsOrdHashMap FilePath PathItem</code> - corresponding to the <code>paths</code> Lens.<br>\nLooking at the definition of <code>PathItem</code> reveals that it is not an instance of <code>HasOperationId</code> - it itself is composed of<br></p>\n\n<pre><code>PathItem     \n  _pathItemGet :: Maybe Operation   \n  _pathItemPut :: Maybe Operation   \n  _pathItemPost :: Maybe Operation  \n  _pathItemDelete :: Maybe Operation    \n  _pathItemOptions :: Maybe Operation   \n  _pathItemHead :: Maybe Operation  \n  _pathItemPatch :: Maybe Operation \n  _pathItemParameters :: [Referenced Param]\n</code></pre>\n\n<p>which would seem to suggest that what you are missing a Lens composition in<br>\n<code>(\\k v -&gt; v &amp; (??? . operationId) ?~ (pack \"hello\"))</code>; something similar to<br>\n<code>(\\k v -&gt; v &amp; (itemGet . operationId) ?~ (pack \"hello\"))</code></p>\n\n<p>EDIT : \nIt looks like what you are trying to achieve (setting up a simple path operation) can be easily done by using the <code>Monoid</code> instance of the <code>PathItem</code> record, like this:<br></p>\n\n<pre><code>genOpsId = paths %~ InsOrdHashMap.mapWithKey (\\k v -&gt; v &amp; get ?~ (mempty &amp; operationId ?~ (pack \"hello\")))\n</code></pre>\n\n<p><br>\n<br>\nEDIT#2:\nAs requested, here is one way to iterate over the fields of the <code>PathItem</code> record and set the operationId of those that are present.\n<br>\nFor the record, I'm pretty sure there's a way, way, way cleaner way to do this, but here goes.</p>\n\n<pre><code>dokey :: PathItem -&gt; PathItem\ndokey v = foldl \n  (\\acc nv -&gt; acc &amp; nv %~ (fmap $ operationId ?~ (pack \"hello\")))\n  v \n  [get, put, post, delete, options, head_, patch]  \n\ngenOpIds :: Swagger -&gt; Swagger\ngenOpIds = paths %~ InsOrdHashMap.mapWithKey (\\k -&gt; doKey)\n</code></pre>\n\n<p><br>Hope it helps! :)</p>\n"}], "owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 50163970, "answer_count": 1, "score": 2, "last_activity_date": 1525422905, "creation_date": 1525368235, "question_id": 50160738, "link": "https://stackoverflow.com/questions/50160738/haskell-swagger-lens-autogeneration", "title": "Haskell Swagger Lens autogeneration", "body": "<p>I have the following code:</p>\n\n<pre><code>import Control.Lens ((&amp;), (.~), (?~), (%~))\nimport Data.Swagger (Swagger)\nimport Data.Swagger.Lens (paths, operationId, info, description)\nimport qualified Data.HashMap.Strict.InsOrd as InsOrdHashMap\nimport Data.Text (Text(..), pack)\n\ngenOpIds :: Swagger -&gt; Swagger\ngenOpIds = paths %~ InsOrdHashMap.mapWithKey (\\k v -&gt; v &amp; operationId ?~ (pack \"hello\"))\n</code></pre>\n\n<p>Generating the following compile error:</p>\n\n<pre><code>    \u2022 No instance for (Data.Swagger.Lens.HasOperationId\n                         Data.Swagger.Internal.PathItem (Maybe Text))\n        arising from a use of \u2018operationId\u2019\n    \u2022 In the first argument of \u2018(?~)\u2019, namely \u2018operationId\u2019\n      In the second argument of \u2018(&amp;)\u2019, namely\n        \u2018operationId ?~ (pack \"hello\")\u2019\n      In the expression: v &amp; operationId ?~ (pack \"hello\")\n   |\n12 | genOpIds = paths %~ InsOrdHashMap.mapWithKey (\\k v -&gt; v &amp; operationId ?~ (pack \"hello\"))\n   |                                                           ^^^^^^^^^^^\n</code></pre>\n\n<p>I'm finding it a bit difficult to diagnose, as I think makeLenses is used to generate the class instances. I'm struggling a bit to see how this is different to the following (which compiles fine):</p>\n\n<pre><code>writeInfoTitle :: Swagger -&gt; Swagger\nwriteInfoTitle = info.description ?~ (pack \"whatever description\")\n</code></pre>\n\n<p>as the type hierarchy involved is similar at the bottom. I suspect there's a fundamental bit of understanding I'm missing here, but I've read the lens tutorial, including the section on traversals; various bits of the servant swagger code, and some other examples and haven't managed to figure this out.</p>\n\n<p>To recreate the error message easily, you could clone the following repo and <code>stack build</code>:</p>\n\n<pre><code>https://github.com/msk-/improved-spork\n</code></pre>\n"}, {"tags": ["haskell", "type-families", "existential-type", "system-f"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1525364177, "post_id": 50159349, "comment_id": 87337004, "body": "I get an ambiguity error in <code>f</code>&#39;s declaration. Do you have <code>AllowAmbiguousTypes</code> turned on?"}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1525364264, "post_id": 50159349, "comment_id": 87337058, "body": "Yes, I do. Give me a moment to edit the question with all necessary extensions."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1525371600, "last_edit_date": 1525371600, "creation_date": 1525367053, "answer_id": 50160423, "question_id": 50159349, "link": "https://stackoverflow.com/questions/50159349/type-abstraction-in-ghc-haskell/50160423#50160423", "title": "Type abstraction in GHC Haskell", "body": "<p>This might be a GHC bug. I can not see how this GHC behavior makes any sense.</p>\n\n<p>This issue has nothing to do with type families, but it seems to arise from ambiguous types and typeclass constraints.</p>\n\n<p>Here is a MCVE for the same issue.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes    #-}\n{-# LANGUAGE RankNTypes             #-}\n{-# LANGUAGE TypeApplications       #-}\n\nclass C a where\n   getInt :: Int\n\ninstance C Char where\n   getInt = 42\n\nf :: (forall a. C a =&gt; Int) -&gt; Bool\nf x = even (x @ Char)\n\ng :: (forall a. C a =&gt; Int) -&gt; Bool\n-- g = f               -- fails\n-- g h = f h           -- fails\n-- g h = f getInt      -- fails\ng _ = f 42             -- OK\n</code></pre>\n\n<p>It seems that <code>f</code> can not be called with any argument that actually exploits the constraint.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1526157058, "post_id": 50276125, "comment_id": 87636786, "body": "I can&#39;t understand why this is not considered to be a bug. If ambiguous types were not allowed, I would not. But since ambiguous types now can be turned on, I can&#39;t see anything wrong with the code. I&#39;d consider this a very weird technical limitation of GHC, at best. I wonder if there is some deep reason in the inference algorithm for this to fail type checking, or if it is only an incident. Oh, well."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526645541, "post_id": 50276125, "comment_id": 87837518, "body": "I guess you just can&#39;t make it work in the general case, and not trying to for some concrete and obvious cases keeps inference simple and reasonable. If this would work, we&#39;d have the same discussion for some other example that would be even trickier to infer. The question is, where do we stop with such ad-hoc hacks in type inference?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1526646679, "post_id": 50276125, "comment_id": 87838125, "body": "That might be the case, but the trac discussion does not support that view. It only says &quot;it is ambiguous, therefore GHC can&#39;t handle it&quot;, when this reason alone is not at all sufficient, since GHC accepts <code>f</code> just fine, even if it has an ambiguous type. Indeed, the trac discussion seems to point out, wrongly, that you can not write <code>f</code>. Whatever type checking algorithm accepts <code>x :: T ; x = expr</code> (for some <code>T,expr</code>) but rejects <code>x :: T ; x = expr ; y :: T ; y = x</code> is very, very weird in my eye."}], "tags": [], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "is_accepted": true, "score": 2, "last_activity_date": 1563991096, "last_edit_date": 1563991096, "creation_date": 1525965040, "answer_id": 50276125, "question_id": 50159349, "link": "https://stackoverflow.com/questions/50159349/type-abstraction-in-ghc-haskell/50276125#50276125", "title": "Type abstraction in GHC Haskell", "body": "<p>This is by design. It seems there is no way around using <code>Proxy</code>s for now: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15119\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/15119</a>.</p>\n\n<p>Edit Jul 2019: There's now a <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/238\" rel=\"nofollow noreferrer\">GHC proposal for this</a>!</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 1, "accepted_answer_id": 50276125, "answer_count": 2, "score": 6, "last_activity_date": 1564731383, "creation_date": 1525363159, "last_edit_date": 1564731383, "question_id": 50159349, "link": "https://stackoverflow.com/questions/50159349/type-abstraction-in-ghc-haskell", "title": "Type abstraction in GHC Haskell", "body": "<p>I'd love to get the following example to type-check:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes    #-}\n{-# LANGUAGE RankNTypes             #-}\n{-# LANGUAGE TypeApplications       #-}\n{-# LANGUAGE TypeFamilies           #-}\n\nmodule Foo where\n\nf :: Int -&gt; (forall f. Functor f =&gt; Secret f) -&gt; Int\nf x _ = x\n\ng :: (forall f. Functor f =&gt; Secret f) -&gt; Int\ng = f 4\n\ntype family Secret (f :: * -&gt; *) :: * where\n  Secret f = Int\n</code></pre>\n\n<p>I get it that it's probably not possible to infer and check <code>g</code>s type (even though in this specific case it's obvious because it's just a partial application): <code>Secret</code> is not injective and there's no way to tell the compiler which <code>Functor</code> instance it should expect. Consequently, it fails with the following error message:</p>\n\n<pre><code>    \u2022 Could not deduce (Functor f0)\n      from the context: Functor f\n        bound by a type expected by the context:\n                  forall (f :: * -&gt; *). Functor f =&gt; Secret f\n        at src/Datafix/Description.hs:233:5-7\n      The type variable \u2018f0\u2019 is ambiguous\n      These potential instances exist:\n        instance Functor IO -- Defined in \u2018GHC.Base\u2019\n        instance Functor Maybe -- Defined in \u2018GHC.Base\u2019\n        instance Functor ((,) a) -- Defined in \u2018GHC.Base\u2019\n        ...plus one other\n        ...plus 9 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression: f 4\n      In an equation for \u2018g\u2019: g = f 4\n    |\n233 | g = f 4\n    |     ^^^\n</code></pre>\n\n<p>So some guidance by the programmer is needed and it would readily be accepted if I could write <code>g</code> like this:</p>\n\n<pre><code>g :: (forall f. Functor f =&gt; Secret f) -&gt; Int\ng h = f 4 (\\\\f -&gt; h @f)\n</code></pre>\n\n<p>Where <code>\\\\</code> is hypothetical syntax for System Fw's big lambda, i.e. type abstraction. I can emulate this with ugly <code>Proxy</code>s, but is there some other GHC Haskell feature that let's me write something like this?</p>\n"}, {"tags": ["haskell", "console"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1525364973, "post_id": 50159342, "comment_id": 87337452, "body": "The variable <code>num</code> in your code is a string that happens to contain the ascii character <code>5</code>.  If you wish to read a line then parse that line into another value, such as an integer, then consider using <code>read</code> or <code>readMaybe</code>.  More complex tasks arguably should be handled with a parser library such as parsec, megaparsec, or attoparsec."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9642775, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rahat Batool", "link": "https://stackoverflow.com/users/9642775/rahat-batool"}, "edited": false, "score": 0, "creation_date": 1525366211, "post_id": 50159869, "comment_id": 87338173, "body": "Can number be display without show? If not then why?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 21, "user_id": 9642775, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rahat Batool", "link": "https://stackoverflow.com/users/9642775/rahat-batool"}, "edited": false, "score": 0, "creation_date": 1525366821, "post_id": 50159869, "comment_id": 87338464, "body": "Sure; I just threw <code>show</code> in as a quick way to get this example to type-check. I guess for completeness, I should add that as a constraint to <code>getNum</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1525366893, "last_edit_date": 1525366893, "creation_date": 1525365010, "answer_id": 50159869, "question_id": 50159342, "link": "https://stackoverflow.com/questions/50159342/how-to-input-any-numerical-type-using-input-output-in-haskell/50159869#50159869", "title": "How to input any Numerical type using input output in Haskell?", "body": "<p>You can define a function <code>getNum</code> which is identical to <code>readLn</code>, but is restricted to types with a <code>Num</code> instance.</p>\n\n<pre><code>getNum :: (Read a, Num a, Show a) =&gt; IO a\ngetNum = readLn\n\nmain = do\n  putStrLn \"Enter any number: \"\n  num &lt;- getNum\n  -- or just inline the type annotation:\n  -- num &lt;- (readLn :: (Read a, Num a, Show a) =&gt; IO a)\n  putStrLn (\"number is \" ++ show num)\n</code></pre>\n\n<p>The <code>Show</code> constraint is just to ease creating a string for the last <code>putStrLn</code>; it has nothing to do with parsing the input.</p>\n\n<p><code>getNum</code> will raise an error if <code>readLn</code> cannot parse the input string as a number, so this is probably the least good way to do this, but it is simple.</p>\n"}], "owner": {"reputation": 21, "user_id": 9642775, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rahat Batool", "link": "https://stackoverflow.com/users/9642775/rahat-batool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1525366893, "creation_date": 1525363120, "question_id": 50159342, "link": "https://stackoverflow.com/questions/50159342/how-to-input-any-numerical-type-using-input-output-in-haskell", "title": "How to input any Numerical type using input output in Haskell?", "body": "<p>In haskell to input a String we use getLine and to input a character we use getChar but what is used to input any integer or float?</p>\n\n<p>I search a lot and I found but it also use getLine for integer.\n<a href=\"https://stackoverflow.com/questions/42214305/how-to-input-an-integer-in-haskell-input-in-console\">This is the link where I found</a></p>\n\n<p>It really works as I used this in my code</p>\n\n<p>Code:</p>\n\n<pre><code>main = do\n   putStrLn \"Enter any number : \"\n   num &lt;- getLine\n   putStrLn (\"number is \"++num)  \n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>F17BCSE206&gt;main\nEnter any number : \n5\nnumber is 5\n:: IO ()\n</code></pre>\n\n<p>But my mind can't satisfies to input an integer we use getLine. Is there any other more precise way to input an integer and float using input output instead of     <code>func :: Int -&gt; Int</code>  </p>\n\n<p>Can getInt or getFloat exists in haskell to input an integer or float?</p>\n\n<p>Can anybody knows, So please help me.</p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1525361809, "post_id": 50158842, "comment_id": 87335554, "body": "What did you try yourself? How would you define the output for this function for an empty list, a list with 1, 2, 3 elements, and a solution for <i>n</i> elements in terms of <i>n-1</i> elements?"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1525361810, "post_id": 50158842, "comment_id": 87335555, "body": "<code>take 3</code> is your friend. write a recursive function, or use <code>foldl</code> to produce the entire list."}, {"owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525363792, "post_id": 50158842, "comment_id": 87336784, "body": "@WillemVanOnsem I&#39;ve updated the question for your first interrogation. However I&#39;m not sure I understood the other ones ? If you mean error handling related stuff I can manage that my self before passing the string. I&#39;m also looking into take and foldl thank you"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525364465, "post_id": 50158842, "comment_id": 87337166, "body": "Kudos for staying engaged and editing your question to include your code! It so happens that this question was already asked and answered on this site. You&#39;re welcome to peruse the linked entry, and ask any new questions as you get them. Welcome to Stack Overflow!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1525365023, "post_id": 50158842, "comment_id": 87337485, "body": "if the answers there are unsatisfactory, and you want to implement this function yourself by direct recursion instead of using other built-in functions for example (as a learning exercise, perhaps), ask a new question underscoring this requirement, and include any code you have, again (and always)."}], "owner": {"reputation": 95, "user_id": 9736371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e_iucgxHTrc/AAAAAAAAAAI/AAAAAAAAANQ/kXzFifjCPaU/photo.jpg?sz=128", "display_name": "Mathis Panzani", "link": "https://stackoverflow.com/users/9736371/mathis-panzani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 0, "closed_date": 1525364392, "answer_count": 0, "score": 0, "last_activity_date": 1525363699, "creation_date": 1525361542, "last_edit_date": 1525363699, "question_id": 50158842, "link": "https://stackoverflow.com/questions/50158842/haskell-split-string-at-every-character-into-list-of-n-size-string", "closed_reason": "Duplicate", "title": "Haskell Split String at every character into list of n size string", "body": "<p>I'm working on something that could tell whether or not the given string is a valid de Bruijn sequence of order n</p>\n\n<p>So I want to split the given string at every character into a list of size n Strings</p>\n\n<p>Example : \"011001100\" order = 3</p>\n\n<p>becomes {\"011\", \"110\", \"100\", \"001\", \"110\", \"100\"}\nNow I can easily check if the list contains one of the elements twice or more</p>\n\n<p>I'm quite the newbie with haskell, I tried to do something myself but I don't know where to start.\n(if you have any other idea to do the given task i'm open to it)</p>\n\n<p>Answering comment : \nWhat i've tried :</p>\n\n<pre><code>import Data.List\n\nchunk :: Int -&gt; [a] -&gt; [[a]]\nchunk _ [] = []\nchunk n xs = first : chunk n rest where (first, rest) = splitAt n xs\n</code></pre>\n\n<p>Then I can get the list with:</p>\n\n<pre><code>print $ transpose $ chunk order sequence\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525355674, "post_id": 50156531, "comment_id": 87331369, "body": "What JSON document type do you use? Is it possible to provide some data in a way that we can reproduce and test potential solutions?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1525356102, "post_id": 50156531, "comment_id": 87331654, "body": "...how about an MVCE...?"}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525356473, "post_id": 50156531, "comment_id": 87331887, "body": "@WillemVanOnsem what do you mean by document type?"}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525356513, "post_id": 50156531, "comment_id": 87331924, "body": "@leftaroundabout what would you be looking for? A stack script?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1525356518, "post_id": 50156531, "comment_id": 87331927, "body": "@Reactormonk: the type of <code>doc</code>? There are several libraries that handle JSON, etc."}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525356652, "post_id": 50156531, "comment_id": 87332019, "body": "@WillemVanOnsem got it. I&#39;ve barely ever heard of another json library than aeson, so I didn&#39;t even consider anything else. For lenses the lens-aeson package. I&#39;ll tinker up a stack script."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1525357128, "post_id": 50156531, "comment_id": 87332353, "body": "A stack script is perfect. Just a function with proper type signature, and reference to the modules where the data types come from would also be sufficient."}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1525357347, "post_id": 50156531, "comment_id": 87332525, "body": "I don&#39;t know the correct type signature, I think this is as far I can go."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525359826, "post_id": 50156531, "comment_id": 87334280, "body": "Your JSON string is invalid, you have two closing square brackets <code>]]</code>. I assume this is only a mistake in the question?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1525360411, "post_id": 50156531, "comment_id": 87334675, "body": "@WillemVanOnsem There are two open brackets as well, one before <code>key</code> and one before <code>foo</code>. The brace to close <code>body[0]</code> is missing, though."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1525362935, "post_id": 50156531, "comment_id": 87336280, "body": "Why is everyone nitpicking a question that was very clear from the start? I&#39;m a bit baffled by all the comments so far. If you know the lens ecosystem well enough to answer the question, you&#39;d already know <code>lens-aeson</code> is the library the question is referring to. The problem description was clear, including an input, output, and description of the technique desired to solve it. Why so much focus on trivialities?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1525471069, "post_id": 50156531, "comment_id": 87384545, "body": "@Carl, I disagree rather strongly with your premise. Not everyone has to be an expert to answer questions here. They just need to be able to find enough information easily enough to apply their problem-solving skills to the puzzle. SO is not just for <i>askers</i> to learn. It&#39;s also for <i>answerers</i> to learn. Yes, there&#39;s a certain amount of altruism in answering questions, and a certain amount of showing-off, but I think many of the best would vanish if they weren&#39;t also learning new things."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1525486366, "post_id": 50156531, "comment_id": 87387287, "body": "@dfeuer I see your point - I have learned a lot answering questions here over the years. At the same time, I have to take a stand for questions I believe are sufficiently well-formed as to be answerable and protest the attitude that all questions must satisfy a checklist before they&#39;re worth answering. I think it&#39;s important for the approachability of the site overall to do so."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 4, "last_activity_date": 1525410791, "last_edit_date": 1525410791, "creation_date": 1525365536, "answer_id": 50160005, "question_id": 50156531, "link": "https://stackoverflow.com/questions/50156531/index-a-traversal-with-a-lens/50160005#50160005", "title": "Index a Traversal with a Lens", "body": "<h1>New, sickeningly complete answer</h1>\n\n<p>I've finally returned to a real computer with GHC, and did some more thorough testing.  I found two things: 1) My basic idea works. 2) There is a <em>lot</em> of subtlety in using it the way you want.</p>\n\n<p>Here are some expanded definitions to start the experiment:</p>\n\n<pre><code>{-# Language OverloadedStrings, FlexibleContexts #-}\n\nimport Control.Lens\nimport Data.Aeson\nimport Data.Aeson.Lens\nimport Data.Text\nimport Data.Monoid (First)\nimport Data.Maybe (isJust, fromJust)\n\ndoc :: Text\ndoc = \"{\\\"body\\\": [ {\\\"key\\\": 23, \\\"data\\\": [{\\\"foo\\\": 1}, {\\\"foo\\\": 2}]}, {\\\"key\\\": 29, \\\"data\\\": [{\\\"foo\\\": 11}, {\\\"bar\\\": 12}]} ]}\"\n\ndoc2 :: Text\ndoc2 = \"{\\\"body\\\": [ {\\\"data\\\": [{\\\"foo\\\": 21}, {\\\"foo\\\": 22}]}, {\\\"key\\\": 23, \\\"data\\\": [{\\\"foo\\\": 1}, {\\\"foo\\\": 2}]}, {\\\"key\\\": 29, \\\"data\\\": [{\\\"foo\\\": 11}, {\\\"bar\\\": 12}]} ]}\"\n\nsubIndex :: Indexable i p =&gt; Getting i s i -&gt; p s fb -&gt; s -&gt; fb\nsubIndex f = reindexed (view f) selfIndex\n\nsubIndex2 :: Indexable (Maybe a) p =&gt; Getting (First a) s a -&gt; p s fb -&gt; s -&gt; fb\nsubIndex2 f = reindexed (preview f) selfIndex\n\nsubIndex3 :: (Applicative f, Indexable i p) =&gt; Getting (First i) s i -&gt; p s (f s) -&gt; s -&gt; f s\nsubIndex3 f = reindexed fromJust (subIndex2 f . indices isJust)\n</code></pre>\n\n<p>I've defined 3 different variants of a function to do what you want. The first one, <code>subIndex</code>, is most precisely what you asked for in the question title. It needs a lens, not a traversal. This prevents it from being usable exactly the way you'd want.</p>\n\n<pre><code>&gt; doc ^@.. key \"body\" . values . subIndex (key \"key\" . _Integer) &lt;. key \"data\" . values . key \"foo\" . _Integer\n\n&lt;interactive&gt;:61:42: error:\n    \u2022 No instance for (Monoid Integer) arising from a use of \u2018key\u2019\n    \u2022 In the first argument of \u2018(.)\u2019, namely \u2018key \"key\"\u2019\n      In the first argument of \u2018subIndex\u2019, namely\n        \u2018(key \"key\" . _Integer)\u2019\n      In the first argument of \u2018(&lt;.)\u2019, namely\n        \u2018subIndex (key \"key\" . _Integer)\u2019\n</code></pre>\n\n<p>The problem here is that the key might not actually be there. The type system carries enough information to detect this problem, and refuse to compile.  You can work around it with a minor modification:</p>\n\n<pre><code>&gt; doc ^@.. key \"body\" . values . subIndex (singular $ key \"key\" . _Integer) &lt;. key \"data\" . values . key \"foo\" . _Integer\n[(23,1),(23,2),(29,11)]\n</code></pre>\n\n<p>But <code>singular</code> is a promise to the compiler. If you were wrong, things go wrong:</p>\n\n<pre><code>&gt; doc2 ^@.. key \"body\" . values . subIndex (singular $ key \"key\" . _Integer) &lt;. key \"data\" . values . key \"foo\" . _Integer\n[(*** Exception: singular: empty traversal\nCallStack (from HasCallStack):\n  error, called at src/Control/Lens/Traversal.hs:667:46 in lens-4.16-f58XaBDme4ClErcSwBN5e:Control.Lens.Traversal\n  singular, called at &lt;interactive&gt;:63:43 in interactive:Ghci4\n</code></pre>\n\n<p>So, my next thought was using <code>preview</code> instead of <code>view</code>, which resulted in <code>subIndex2</code>.</p>\n\n<pre><code>&gt; doc ^@.. key \"body\" . values . subIndex2 (key \"key\" . _Integer) &lt;. key \"data\" . values . key \"foo\" . _Integer\n[(Just 23,1),(Just 23,2),(Just 29,11)]\n</code></pre>\n\n<p>It's a bit ugly to have those <code>Just</code> constructors in there, but it has its advantages:</p>\n\n<pre><code>&gt; doc2 ^@.. key \"body\" . values . subIndex2 (key \"key\" . _Integer) &lt;. key \"data\" . values . key \"foo\" . _Integer\n[(Nothing,21),(Nothing,22),(Just 23,1),(Just 23,2),(Just 29,11)]\n</code></pre>\n\n<p>With this, the traversal still hits all its regular targets, even if the index is missing. This is potentially an interesting point in the solution space. There are certainly use cases for which it would be the best choice. Despite that, I figured it wasn't exactly what you wanted.  I figured you probably really wanted Traversal-ish behavior - if there is no target for the index traversal, just skip all children.  Unfortunately, lens is a bit austere doing this sort of manipulation of indices.  I eventually ended up with <code>subIndex3</code>, which uses an index-level variant of the <code>map fromJust . filter isJust</code> pattern. It's perfectly safe as is, but it's somewhat fragile in the face of refactoring.</p>\n\n<p>It works, though:</p>\n\n<pre><code>&gt; doc ^@.. key \"body\" . values . subIndex3 (key \"key\" . _Integer) &lt;. key \"data\" . values . key \"foo\" . _Integer\n[(23,1),(23,2),(29,11)]\n</code></pre>\n\n<p>And, it works as you'd probably expect when the index traversal doesn't find any targets:</p>\n\n<pre><code>&gt; doc2 ^@.. key \"body\" . values . subIndex3 (key \"key\" . _Integer) &lt;. key \"data\" . values . key \"foo\" . _Integer\n[(23,1),(23,2),(29,11)]\n</code></pre>\n\n<p>The dictionary that lacks a <code>\"key\"</code> field is just ignored, even though the remainder of the traversal would have targets in it.</p>\n\n<p>So there you go - three related options, each of which has positives and negatives. The third one is pretty rough in terms of implementation, and I suspect it's not going to have the best performance either. But I estimate it is most likely to be what you actually desire.</p>\n\n<h1>Old, incomplete answer</h1>\n\n<p>This isn't a complete answer, as I don't have a computer with ghc around - I've been testing by chatting with lambdabot on freenode.</p>\n\n<pre><code>09:34 &lt;me&gt; &gt; let setIndex f = reindexed (view f) selfIndex in Just (1, [3..6]) ^@.. _Just . setIndex _1 &lt;. _2 . traverse\n09:34 &lt;lambdabot&gt;  [(1,3),(1,4),(1,5),(1,6)]\n</code></pre>\n\n<p>I think that is the basic idea you were looking for, but I haven't applied it to exactly your data. I applied it to a value that was structurally similar to prove the pattern, at least. The basic idea is to use a combination of <code>selfIndex</code> and <code>reindexed</code> to create an indexed optic with the correct index value. Then you have to be careful with <code>(&lt;.)</code> and similar operators to maintain the correct index across compositions of various indexed optics.</p>\n\n<p>Finally, I switched to using <code>(^@..)</code> to extract a list of (index, target) pairs instead of using <code>withIndex</code>. The latter will work, but then you need to be even more careful with how you associate the various compositions together.</p>\n\n<p>Example using <code>withIndex</code>, note that it required overriding the default association of the composition operators in order to work:</p>\n\n<pre><code>12:21 &lt;me&gt; &gt; let setIndex f = reindexed (view f) selfIndex in Just (1, [3..6]) ^.. (_Just . setIndex _1 &lt;. _2 . traverse) . withIndex\n12:21 &lt;lambdabot&gt;  [(1,3),(1,4),(1,5),(1,6)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1525378951, "last_edit_date": 1525378951, "creation_date": 1525378183, "answer_id": 50163125, "question_id": 50156531, "link": "https://stackoverflow.com/questions/50156531/index-a-traversal-with-a-lens/50163125#50163125", "title": "Index a Traversal with a Lens", "body": "<p>Would a mere <code>Fold</code>\u2014not a full <code>Traversal</code>\u2014be enough?</p>\n\n<p><code>Control.Lens.Reified</code> provides a <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Reified.html#t:ReifiedFold\" rel=\"nofollow noreferrer\"><code>ReifiedFold</code></a> newtype with useful instances. In particular, the <code>Applicative</code> instance performs a cartesian product of folds.</p>\n\n<p>We could use that cartesian product to obtain the \"key\" on one side, and the \"data\" on the other. Like this:</p>\n\n<pre><code>indexedBody :: Fold Value (Int,Int)\nindexedBody =\n    let k :: Fold Value Int\n        k = key \"key\"._Integral\n        d :: Fold Value Int\n        d = key \"data\".values.key \"foo\"._Integral\n        Fold kd = (,) &lt;$&gt; Fold k &lt;*&gt; Fold d\n     in key \"body\" . values . kd\n</code></pre>\n\n<p>There's no combinatorial explosion because the \"key\" part targets at most one value.</p>\n"}], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "accepted_answer_id": 50160005, "answer_count": 2, "score": 4, "last_activity_date": 1525410791, "creation_date": 1525354877, "last_edit_date": 1525362016, "question_id": 50156531, "link": "https://stackoverflow.com/questions/50156531/index-a-traversal-with-a-lens", "title": "Index a Traversal with a Lens", "body": "<p>I have a <a href=\"https://www.stackage.org/nightly-2018-05-02/package/lens-aeson-1.0.2\" rel=\"nofollow noreferrer\">lens</a> pointing to a json document, e.g.</p>\n\n<pre><code>doc ^? ((key \"body\").values)\n</code></pre>\n\n<p>Now I would like to index the values in body with the key \"key\", because the json looks like</p>\n\n<pre><code>{\"body\": [{\"key\": 23, \"data\": [{\"foo\": 1}, {\"foo\": 2}]}]}\n</code></pre>\n\n<p>So I'm looking for something which would allow me to index by another lens:</p>\n\n<pre><code>doc ^? key \"body\" . values\n      . indexWith (key \"key\")\n      . key \"data\" . values\n      . key \"foo\" . withIndex\n</code></pre>\n\n<p>which should return</p>\n\n<pre><code>[(23, 1), (23, 2)]\n</code></pre>\n\n<p>MVCE:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-11.7 script\n-- --package lens\n-- --package text\n-- --package lens-aeson\n{-# LANGUAGE OverloadedStrings #-}\nimport Control.Lens\nimport Data.Aeson.Lens\nimport Data.Text\n\ndoc :: Text\ndoc = \"{\\\"body\\\": [{\\\"key\\\": 23, \\\"data\\\": [{\\\"foo\\\": 1}, {\\\"foo\\\": 2}]}]}\"\n\n-- Something akin to Lens -&gt; Traversal -&gt; IndexedTraversal\nindexWith :: _\nindexWith = undefined\n\n-- should produce [(23, 1), (23, 2)]\nindexedBody :: [(Int, Int)]\nindexedBody = doc ^? key \"body\" . values\n                   . indexWith (key \"key\")\n                   . key \"data\" . values\n                   . key \"foo\" . withIndex\n\nmain = print indexedBody\n</code></pre>\n"}, {"tags": ["haskell", "types", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1525352379, "post_id": 50155340, "comment_id": 87328992, "body": "It would be great if you can add a &quot;theory&quot; part to your post that answers the second point in my question, even if sketchily."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1525352461, "post_id": 50155340, "comment_id": 87329062, "body": "I already gave an example to that. My instances have made the <code>T</code> type family non-injective, because the make <code>T Int ~ T Char ~ ()</code>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1525353222, "post_id": 50155340, "comment_id": 87329580, "body": "Oh. I see. I read the Nota Bene in the error message as &quot;... (may not) (be injective) <i>(never ever)</i>&quot; while it should be read as &quot;... (may) (not be injective) <i>(sometimes)</i>&quot;. So, what it says is that the type function, when it is variously instantiated, may happen to not be one to one anymore and, therefore, certain class of type signatures would become ambiguous. May I ask you to put an explanation along these lines somewhere in your answer for the sake of the future reader?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1525410698, "post_id": 50155340, "comment_id": 87352715, "body": "@HTNW I cannot compile your example with <code>TypeFamilyDependencies</code>. It says <code>parse error on input \u2018::\u2019</code>. Do I need to enable some other extensions?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1525411053, "post_id": 50155340, "comment_id": 87352813, "body": "...If I omit the kind signature, like this: <code>type T a = r | r -&gt; a</code>, \u2014 it compiles fine."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1525430307, "post_id": 50155340, "comment_id": 87362896, "body": "@IgnatInsarov Whoops, I ate some parentheses."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1525535562, "last_edit_date": 1525535562, "creation_date": 1525351246, "answer_id": 50155340, "question_id": 50155026, "link": "https://stackoverflow.com/questions/50155026/associated-type-family-complains-about-pred-t-a-bool-with-nb-t-is-a/50155340#50155340", "title": "Associated type family complains about `pred :: T a -&gt; Bool` with &quot;NB: \u2018T\u2019 is a type function, and may not be injective&quot;", "body": "<pre><code>instance C Int where\n  type T Int = ()\n  pred () = False\n\ninstance C Char where\n  type T Char = ()\n  pred () = True\n</code></pre>\n\n<p>So now you have two definitions of <code>pred</code>. Because a type family assigns just, well, type synonyms, these two definitions have the signatures</p>\n\n<pre><code>pred :: () -&gt; Bool\n</code></pre>\n\n<p>and</p>\n\n<pre><code>pred :: () -&gt; Bool\n</code></pre>\n\n<p>Hm, looks rather similar, doesn't it? The type checker has no way to tell them apart. What, then, is</p>\n\n<pre><code>pred ()\n</code></pre>\n\n<p>supposed to be? <code>True</code> or <code>False</code>?</p>\n\n<p>To resolve this, you need some explicit way of providing the information of which instance the particular <code>pred</code> in some use case is supposed to belong to. One way to do that, as you've discovered yourself, is to change to an associated <code>data</code> family: <code>data T Int = TInt</code> and <code>data T Char = TChar</code> would be two distinguishable new types, rather than synonyms to types, which have no way to ensure they're actually different. I.e. data families are always injective; type families sometimes aren't. The compiler assumes, in the absence of other hints, that <em>no</em> type family is injective.</p>\n\n<p>You can declare a type family injective with another language extension:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilyDependencies #-}\nclass C a where\n  type T a = (r :: *) | r -&gt; a\n  pred :: T a -&gt; a\n</code></pre>\n\n<p>The <code>=</code> simply binds the <code>r</code>esult of <code>T</code> to a name so it is in scope for the injectivity annotation, <code>r -&gt; a</code>, which reads like a functional dependency: the <code>r</code>esult of <code>T</code> is enough to determine the <code>a</code>rgument. The above instances are now illegal; <code>type T Int = ()</code> and <code>type T Char = ()</code> together violate injectivity. Just one by itself is admissible.</p>\n\n<p>Alternatively, you can follow the compiler's hint; <code>-XAllowAmbiguousTypes</code> makes the original code compile. However, you will then need <code>-XTypeApplications</code> to resolve the instance at the use site:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>pred @Int () == False\npred @Char () == True\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 50155340, "answer_count": 1, "score": 3, "last_activity_date": 1525535562, "creation_date": 1525350233, "question_id": 50155026, "link": "https://stackoverflow.com/questions/50155026/associated-type-family-complains-about-pred-t-a-bool-with-nb-t-is-a", "title": "Associated type family complains about `pred :: T a -&gt; Bool` with &quot;NB: \u2018T\u2019 is a type function, and may not be injective&quot;", "body": "<p>This code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nmodule Study where\n\nclass C a where\n    type T a :: *\n    pred :: T a -&gt; Bool\n</code></pre>\n\n<p>\u2014 Gives this error:</p>\n\n<pre><code>.../Study.hs:7:5: error:\n    \u2022 Couldn't match type \u2018T a\u2019 with \u2018T a0\u2019\n      Expected type: T a -&gt; Bool\n        Actual type: T a0 -&gt; Bool\n      NB: \u2018T\u2019 is a type function, and may not be injective\n      The type variable \u2018a0\u2019 is ambiguous\n    \u2022 In the ambiguity check for \u2018Study.pred\u2019\n      To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n      When checking the class method:\n        Study.pred :: forall a. A a =&gt; T a -&gt; Bool\n      In the class declaration for \u2018A\u2019\n  |\n7 |     pred :: T a -&gt; Bool\n  |     ^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Replacing <code>type</code> keyword with <code>data</code> fixes.</p>\n\n<ul>\n<li>Why is one wrong and the other correct?</li>\n<li>What do they mean by \"may not be injective\"? What kind of function that is if it is not even allowed to be one to one? And how is this related to the type of <code>pred</code>?</li>\n</ul>\n"}, {"tags": ["haskell", "bytestring", "haskell-wai", "haskell-warp", "haskell-streaming"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1525380107, "post_id": 50153398, "comment_id": 87345066, "body": "<code>hoist runResourceT body</code> typechecks, but I don&#39;t think it will actually do what you want it to do. I suspect it will every &quot;step&quot; of the stream as an isolated resource context, with is not the desired behaviour."}, {"owner": {"reputation": 16972, "user_id": 429232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/85636c21191554846664badf095bfcf8?s=128&d=identicon&r=PG", "display_name": "Jack Kelly", "link": "https://stackoverflow.com/users/429232/jack-kelly"}, "edited": false, "score": 2, "creation_date": 1525381035, "post_id": 50153398, "comment_id": 87345472, "body": "Agreed. Pretty sure <code>runResourceT $ m &gt;&gt;= f</code> is not equivalent to <code>runResourceT m &gt;&gt;= runResourceT . f</code>, which is the property you need to apply <code>hoist</code>."}, {"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1525400525, "post_id": 50153398, "comment_id": 87350346, "body": "Yes I can confirm <code>hoist runResourceT body</code> does not work the way I intend."}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1525382290, "post_id": 50163774, "comment_id": 87345943, "body": "Related to the topic of resource handling in WAI: <a href=\"https://stackoverflow.com/questions/47517973/what-forces-drove-wai-application-to-be-redesigned-five-times\" title=\"what forces drove wai application to be redesigned five times\">stackoverflow.com/questions/47517973/&hellip;</a>"}, {"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1525400782, "post_id": 50163774, "comment_id": 87350386, "body": "Hmm yeah, that would work, but I&#39;m trying to maintain the body to be written behind an interface, I don&#39;t want any Handle type stuff leaking back across. Perhaps I could restructure the interface to return an action to allow embedding it in the bracket operation. <a href=\"https://github.com/anacrolix/transcoder/blob/e38d7b573a43e01b69d7618cbec3782792079b0e/Main.hs#L436\" rel=\"nofollow noreferrer\">Here</a>&#39;s the interface for reference."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1525411268, "post_id": 50163774, "comment_id": 87352906, "body": "@MattJoiner Perhaps you could structure your interface in continuation-passing style, something like <code>OpId -&gt; FileLength -&gt; (BS.ByteString (ResourceT IO) () -&gt; IO r) -&gt; IO r</code>. That would hide the gory details of handle management from the user while still letting you employ bracketing operations. Packages like &quot;managed&quot; <a href=\"http://hackage.haskell.org/package/managed\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/managed</a> are built around this pattern. The alternative type <code>OpId -&gt; FileLength -&gt; (BS.ByteString (ResourceT IO) x -&gt; IO (r,x) -&gt; IO (r,x)</code> would force the user to exhaust the stream when consuming it."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1525382485, "last_edit_date": 1525382485, "creation_date": 1525381230, "answer_id": 50163774, "question_id": 50153398, "link": "https://stackoverflow.com/questions/50153398/streaming-bytestring-as-wai-http-server-response-body/50163774#50163774", "title": "Streaming bytestring as WAI HTTP server response body", "body": "<p>Instead of <a href=\"https://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:readFile\" rel=\"nofollow noreferrer\"><code>readFile</code></a>, would <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/System-IO.html#v:withFile\" rel=\"nofollow noreferrer\"><code>withFile</code></a> + <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/System-IO.html#v:hSetBinaryMode\" rel=\"nofollow noreferrer\"><code>hSetBinaryMode</code></a> +<a href=\"https://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:fromHandle\" rel=\"nofollow noreferrer\"><code>Data.ByteString.Streaming.fromHandle</code></a> be enough?</p>\n\n<p><code>fromHandle</code> produces a <code>ByteString IO ()</code> that can be converted to a <code>Stream (Of ByteString) IO ()</code> that <code>streamingResponse</code> or <code>streamingBody</code> can accept.</p>\n\n<p>There's the issue of where to put the <code>withFile</code> bracketing operation. According to the <a href=\"https://hackage.haskell.org/package/wai-3.0.4.0/docs/Network-Wai.html#t:Application\" rel=\"nofollow noreferrer\">WAI documentation</a>, you can wrap with it the result of your <code>Application</code>-building function:</p>\n\n<blockquote>\n  <p>Note that, since WAI 3.0, this type is structured in continuation\n  passing style to allow for proper safe resource handling. This was\n  handled in the past via other means (e.g., ResourceT).</p>\n  \n  <p>[...]</p>\n  \n  <p>In order to allocate resources in an exception-safe manner, you can\n  use the bracket pattern outside of the call to responseStream.</p>\n</blockquote>\n\n<hr>\n\n<p><strong>Note:</strong> the documentation of <em>streaming-bytestring</em> says that <code>fromHandle</code> closes the handle automatically when EOF is reached. Looking at the implementation, <a href=\"https://github.com/haskell-streaming/streaming-bytestring/issues/9\" rel=\"nofollow noreferrer\">that doesn't seem to be the case</a>. You need <code>withFile</code> to properly close the handle.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1525515969, "last_edit_date": 1525515969, "creation_date": 1525457717, "answer_id": 50180944, "question_id": 50153398, "link": "https://stackoverflow.com/questions/50153398/streaming-bytestring-as-wai-http-server-response-body/50180944#50180944", "title": "Streaming bytestring as WAI HTTP server response body", "body": "<p>If we want to allow <code>Stream</code>s that live in <code>ResourceT</code>, we can do without the functions from <a href=\"https://hackage.haskell.org/package/streaming-wai-0.1.1/docs/Network-Wai-Streaming.html#v:streamingResponse\" rel=\"nofollow noreferrer\">streaming-wai</a> (that only work for <code>Stream</code>s based on <code>IO</code>) and instead build on top of functions like <code>responseStream</code> from <a href=\"https://hackage.haskell.org/package/wai-3.0.4.0/docs/Network-Wai.html\" rel=\"nofollow noreferrer\">network-wai</a>:</p>\n\n<pre><code>import           Control.Monad.Trans.Resource\nimport           Network.Wai                     \nimport           Streaming                   \nimport qualified Streaming.Prelude               as S\nimport           Data.ByteString.Builder (byteString, Builder)\n\nstreamingResponseR :: Stream (Of ByteString) (ResourceT IO) r\n                   -&gt; Status\n                   -&gt; ResponseHeaders\n                   -&gt; Response\nstreamingResponseR stream status headers =\n    responseStream status headers streamingBody\n    where\n    streamingBody writeBuilder flush =\n        let writer a =\n                do liftIO (writeBuilder (byteString a))\n                    -- flushes for every produced bytestring, perhaps not optimal\n                   liftIO flush\n         in runResourceT $ void $ S.effects $ S.for stream writer\n</code></pre>\n\n<p><code>streamingBody</code> has type <a href=\"https://hackage.haskell.org/package/wai-3.0.4.0/docs/Network-Wai.html#t:StreamingBody\" rel=\"nofollow noreferrer\"><code>StreamingBody</code></a>, which is actually a type synonym for a function <code>(Builder -&gt; IO ()) -&gt; IO () -&gt; IO ()</code> that takes a write callback and a flush callback as parameters, and uses them to write the response using some source of data that is in scope. (Note that these callbacks <em>are provided by WAI</em>, not by the user.)</p>\n\n<p>In our case, the source of data is a <code>Stream</code> that lives in <code>ResourceT</code>. We need to lift the write and flush callbacks (that live in <code>IO</code>) using <code>liftIO</code>, an also remember to invoke <code>runResourceT</code> to return a plain <code>IO</code> action at the end.</p>\n\n<hr>\n\n<p>What if we wanted to flush the response <em>only</em> after the accumulated length of the emitted bytestrings reached some limit?</p>\n\n<p>We would need a function (not implemented here) to create a division each time the limit is reached:</p>\n\n<pre><code>breaks' :: Monad m \n        =&gt; Int \n        -&gt; Stream (Of ByteString) m r \n        -&gt; Stream (Stream (Of ByteString) m) m r\nbreaks' breakSize = undefined\n</code></pre>\n\n<p>And then we could intercalate the flushing action between each group using <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming.html#v:intercalates\" rel=\"nofollow noreferrer\"><code>intercalates</code></a>, before writing the stream:</p>\n\n<pre><code>streamingBodyFrom :: Stream (Of ByteString) (ResourceT IO) () \n                  -&gt; Int \n                  -&gt; StreamingBody\nstreamingBodyFrom stream breakSize writeBuilder flush =\n    let writer a = liftIO (writeBuilder (byteString a))\n        flusher = liftIO flush\n        broken = breaks' breakSize stream\n     in runResourceT . S.mapM_ writer . S.intercalates flusher $ broken\n</code></pre>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 1, "accepted_answer_id": 50180944, "answer_count": 2, "score": 2, "last_activity_date": 1525515969, "creation_date": 1525345129, "last_edit_date": 1525352626, "question_id": 50153398, "link": "https://stackoverflow.com/questions/50153398/streaming-bytestring-as-wai-http-server-response-body", "title": "Streaming bytestring as WAI HTTP server response body", "body": "<p>I have a value <code>body :: BS.ByteString (ResourceT IO) ()</code>, from a function based on <a href=\"https://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:readFile\" rel=\"nofollow noreferrer\"><code>BS.readFile</code></a>. I want to stream that value as the response body from a <a href=\"https://hackage.haskell.org/package/wai-3.2.1.2/docs/Network-Wai.html#t:Application\" rel=\"nofollow noreferrer\">Wai <code>Application</code></a>. There's a helper, <a href=\"https://hackage.haskell.org/package/streaming-wai-0.1.1/docs/Network-Wai-Streaming.html#v:streamingResponse\" rel=\"nofollow noreferrer\"><code>streamingResponse</code></a> that takes a value of the type <code>Stream (Of ByteString) IO r</code>. I'm able to convert my <code>BS.ByteString (ResourceT IO) ()</code> to <code>Stream (Of ByteString) (ResourceT IO) ()</code> through the use of <a href=\"https://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:toChunks\" rel=\"nofollow noreferrer\"><code>BS.toChunks</code></a>, but it contains an extra <code>ResourceT</code> monad layer. Passing the <code>body</code> to <code>streamingResponse</code> gives me:</p>\n\n<pre><code>Couldn't match type \u2018ResourceT IO\u2019 with \u2018IO\u2019\n  Expected type: Stream (Of ByteString) IO ()\n    Actual type: Stream (Of ByteString) (ResourceT IO) ()\n</code></pre>\n\n<p>I've tried various things like wrapping things in runResourceT, binding and hoisting values etc. but really have no idea how to proceed. <a href=\"https://github.com/anacrolix/transcoder/blob/228c8be10ac63d4f24569d847c8ed2d1a7f8da23/Main.hs#L200\" rel=\"nofollow noreferrer\">Here</a>'s the line in the full project if extra context is required.</p>\n\n<h1>Update0</h1>\n\n<p><code>hoist runResourceT body</code> seems to type check. Someone also referred me to a Haskell Pipes <a href=\"https://groups.google.com/forum/#!topic/haskell-pipes/k1Vw18IWcrA\" rel=\"nofollow noreferrer\">thread</a>, which may be a very related problem, and possible hint toward a solution.</p>\n"}, {"tags": ["haskell", "concat"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1525332785, "post_id": 50149270, "comment_id": 87316489, "body": "Well, source list is [[a]] not [a] so I&#39;m not sure that I understand your question?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1525332924, "post_id": 50149270, "comment_id": 87316555, "body": "I get the error that i just posted above."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1525333074, "post_id": 50149270, "comment_id": 87316653, "body": "Yes i do expect that to happen."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1525333757, "post_id": 50149270, "comment_id": 87317046, "body": "Perhaps you meant to <code>foldr (++)</code> instead of <code>foldr (:)</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1525342822, "post_id": 50149270, "comment_id": 87322807, "body": "<code>foldr (:) [] xs == xs</code> is  <code>True</code> for any <code>xs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1525333410, "post_id": 50149493, "comment_id": 87316845, "body": "Well that is what i am trying to understand .You are removing a set of brackets when concatenating.So from [[a]]  shouldn&#39;t it become  [a] ?"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1525333611, "post_id": 50149493, "comment_id": 87316963, "body": "Yes, it should. But in your implementation it doesn&#39;t become <code>[a]</code>, it remains <code>[[a]]</code>"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1525333783, "post_id": 50149493, "comment_id": 87317058, "body": "Well if i  apply the cons operator for [[1,2],[3,4]] does it not translate into [1,2]:[3,4]:[] ?"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 2, "creation_date": 1525333837, "post_id": 50149493, "comment_id": 87317090, "body": "It does, and <code>[1,2]:[3,4]:[]</code> is equal to <code>[[1,2], [3,4]]</code> isn&#39;t it?"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 4, "last_activity_date": 1525333319, "creation_date": 1525333319, "answer_id": 50149493, "question_id": 50149270, "link": "https://stackoverflow.com/questions/50149270/explanation-on-the-type-of-concat-method/50149493#50149493", "title": "Explanation on the type of Concat method", "body": "<p>Actually compiler show the useful hint in the error (actually a couple lines lower, than the message, that you've posted)</p>\n\n<pre><code>Expected type: [a]\nActual type: [[a]]\n</code></pre>\n\n<p>In the following code the argument is indeed of type <code>[[a]]</code>, but the result is also of type <code>[[a]]</code>, which conflicts with the type definition:</p>\n\n<pre><code>conc :: [[a]] -&gt; [a]\nconc xs@(x1:xs') = foldr (:) [] xs\n</code></pre>\n\n<p><code>xs</code> in the code is of type <code>[[a]]</code> and you're iterating over it using <code>foldr</code> and add every element, which is of type <code>[a]</code> to a list. As a result, you'll receive a list of type <code>[[a]]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1525343471, "creation_date": 1525343471, "answer_id": 50152832, "question_id": 50149270, "link": "https://stackoverflow.com/questions/50149270/explanation-on-the-type-of-concat-method/50152832#50152832", "title": "Explanation on the type of Concat method", "body": "<p><code>foldr (:) [] xs == xs</code> is  <code>True</code> for any <code>xs</code>. This means that <code>foldr (:) []</code> is an identity function on lists. This fact is widely known, part of Haskell lore so much so that <code>foldr (:) []</code> automatically reads as <code>id</code> in the mind of an experienced Haskell programmer. </p>\n\n<p>One way of seeing <code>foldr c n</code> is as replacing the \"cons\" (i.e. <code>(:)</code>) with <code>c</code> and the <code>[]</code> with <code>n</code>, in a given list. Replacing <code>(:)</code> with <code>(:)</code> and <code>[]</code> with <code>[]</code> is obviously going to be changing nothing:</p>\n\n<pre><code>[a, b, ..., z]  ==&gt;  a : b : ... : z : []  ==  [a, b, ..., z]\n</code></pre>\n\n<p>Replacing <code>(:)</code>s with <code>(++)</code> on the other hand, will get all the lists inside the input list concatenated together into one:</p>\n\n<pre><code>[a, b, ..., z]  ==&gt;  a ++ b ++ ... ++ z\n</code></pre>\n\n<p>which is what you wanted to achieve.</p>\n\n<p>So the correct implementation for <code>concat</code> with <code>foldr</code> is <code>foldr (++) []</code>.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 50149493, "answer_count": 2, "score": -1, "last_activity_date": 1525343471, "creation_date": 1525332551, "last_edit_date": 1525332908, "question_id": 50149270, "link": "https://stackoverflow.com/questions/50149270/explanation-on-the-type-of-concat-method", "title": "Explanation on the type of Concat method", "body": "<p>Can someone please explain to me why the type of the source list in  my implementation of concat does not work ?</p>\n\n<pre><code>conc::[[a]]-&gt;[a]\nconc xs@(x1:xs')=foldr (:) [] xs\n</code></pre>\n\n<p>Why should the source list be <code>[a]</code> and not <code>[[a]]</code> ? If i want to concat <code>[[1,2],[3,4]]</code> isn't the type <code>[[a]]</code> not <code>[a]</code> and the element type is <code>[a]</code>.</p>\n\n<p>I get the following error :</p>\n\n<pre><code>Couldn't match type `a' with `[a]'\n      `a' is a rigid type variable bound by\n        the type signature for:\n          conc :: forall a. [[a]] -&gt; [a]\n</code></pre>\n"}, {"tags": ["regex", "parsing", "haskell", "alex"], "comments": [{"owner": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 2, "creation_date": 1525315924, "post_id": 50146178, "comment_id": 87310549, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/13531204/how-to-match-paragraphs-in-text-with-regx\">How to Match Paragraphs in Text with regx</a>"}, {"owner": {"reputation": 61, "user_id": 9377220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95280889cd0392cb692cc09cc939afcc?s=128&d=identicon&r=PG&f=1", "display_name": "mjosh", "link": "https://stackoverflow.com/users/9377220/mjosh"}, "reply_to_user": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1525316037, "post_id": 50146178, "comment_id": 87310579, "body": "I tried that but was receiving a parse error.."}, {"owner": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1525316094, "post_id": 50146178, "comment_id": 87310599, "body": "can you paste the error in your question please?"}, {"owner": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1525316265, "post_id": 50146178, "comment_id": 87310648, "body": "just confirming you are using haskell?"}, {"owner": {"reputation": 61, "user_id": 9377220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95280889cd0392cb692cc09cc939afcc?s=128&d=identicon&r=PG&f=1", "display_name": "mjosh", "link": "https://stackoverflow.com/users/9377220/mjosh"}, "reply_to_user": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1525316322, "post_id": 50146178, "comment_id": 87310660, "body": "Yes, Haskell Alex.. creating a lexer"}, {"owner": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1525316343, "post_id": 50146178, "comment_id": 87310668, "body": "can you please try this instead? (\\n|^).*\\?(\\?=\\n|$)"}, {"owner": {"reputation": 61, "user_id": 9377220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95280889cd0392cb692cc09cc939afcc?s=128&d=identicon&r=PG&f=1", "display_name": "mjosh", "link": "https://stackoverflow.com/users/9377220/mjosh"}, "reply_to_user": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1525316364, "post_id": 50146178, "comment_id": 87310674, "body": "same error as before"}, {"owner": {"reputation": 61, "user_id": 9377220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95280889cd0392cb692cc09cc939afcc?s=128&d=identicon&r=PG&f=1", "display_name": "mjosh", "link": "https://stackoverflow.com/users/9377220/mjosh"}, "reply_to_user": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1525316499, "post_id": 50146178, "comment_id": 87310708, "body": "haha yes I just posted the important piece above."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1525375814, "post_id": 50160893, "comment_id": 87343040, "body": "Note that this will not match three-line breaks; it only matches an even number of <code>\\n</code>s. If you want any number greater than two, then <code>\\n\\n+</code> is what you want."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1525368928, "creation_date": 1525368928, "answer_id": 50160893, "question_id": 50146178, "link": "https://stackoverflow.com/questions/50146178/regex-match-for-paragraphs/50160893#50160893", "title": "RegEx match for paragraphs", "body": "<blockquote>\n  <p>What I currently have:</p>\n\n<pre><code>[\\n\\n]+\n</code></pre>\n</blockquote>\n\n<p>At a guess: you are expecting this to match arbitrarily many copies of two lines in a row. But in fact <code>[]</code> create a character class regex, which only ever matches one character (any of the ones enclosed by the brackets). So this matches any positive number of newlines, including just one.</p>\n\n<p>It's easy to fix, though the right fix depends on exactly what you want. If you want any number of newlines greater than two to be a paragraph separator, you could try</p>\n\n<pre><code>\\n\\n+\n</code></pre>\n\n<p>without brackets. Or, if you want multiple paragraph separators when there are more than two newlines, then perhaps</p>\n\n<pre><code>(\\n\\n)+\n</code></pre>\n\n<p>is what you intended. (Not being an alex expert, I can't remember whether parentheses need to be escaped; sorry about that.)</p>\n"}], "owner": {"reputation": 61, "user_id": 9377220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95280889cd0392cb692cc09cc939afcc?s=128&d=identicon&r=PG&f=1", "display_name": "mjosh", "link": "https://stackoverflow.com/users/9377220/mjosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1525559609, "creation_date": 1525315569, "last_edit_date": 1525559609, "question_id": 50146178, "link": "https://stackoverflow.com/questions/50146178/regex-match-for-paragraphs", "title": "RegEx match for paragraphs", "body": "<p>I can not figure out the correct RegEx to use for parsing a text file and identifying paragraphs.  </p>\n\n<p>What I currently have:</p>\n\n<pre><code>[\\n\\n]+  \n</code></pre>\n\n<p>Sample Text:</p>\n\n<blockquote>\n  <p>Das Pensionat Klinger war bereits etwas zusammengeschmolzen, als das\n  junge Ehepaar daselbst eintrat. Es war ein unfreundlicher, regnerischer\n  Sommer gewesen. Klagen \u00fcberall ... aus der Schweiz -- vom Salzkammergut\n  her, wo der ber\u00fcchtigte \u00bbSchn\u00fcrlregen\u00ab tagaus tagein herabgo\u00df -- Klagen\n  vom Ostseestrande und aus dem Engadin ... Klagen endlich auch aus dem\n  lieblichen Gebirgsnest in S\u00fcd-Bayern, in welchem man durch sch\u00f6nes\n  Wetter sonst arg verw\u00f6hnt war.</p>\n  \n  <p>Ein so reizendes St\u00fcck Erde! Tief gelegen -- hoch gelegen, wie man's\n  eben nehmen wollte, denn die zierlichen, wie aus der Spielzeugschachtel\n  genommenen H\u00e4uschen kletterten <em>hier</em> waghalsig die Berge empor,\n  versteckten sich <em>dort</em> eigenwillig unter breit\u00e4stigen Obstb\u00e4umen tief\n  drunten im Thal. Aber die Sonne fand sie alle und \u00fcbergo\u00df sie mit\n  breiten Strahlenfluten hellen Goldes, und der Bergwind, wie er frisch\n  und k\u00fchl vom Gebirge herunterfuhr, strich dar\u00fcber hin -- und ringsumher\n  griffen die Berge wie die Glieder einer gewaltigen Kette ineinander\n  ... einige gr\u00fcn, dicht bewaldet, die anderen kahl und schroff, hoch\n  oben nur mit k\u00fcmmerlichem Fichtenwuchs bestanden, und etwelche unter\n  ihnen stolz zu den Wolken aufragend, ewigen Schnee auf dem Haupt, und\n  in den Falten des Obergewandes blauschimmerndes Gletschereis!</p>\n</blockquote>\n\n<p>I keep getting feedback that at the end of the line I am getting a token back saying TokenParagraph.  </p>\n\n<p>For example:  </p>\n\n<p>.... and there is a [this is where it miss steps]</p>\n\n<p><strong>Edit:</strong> </p>\n\n<p>When trying <code>(\\n|^).*?(?=\\n|$)</code></p>\n\n<p>I get,</p>\n\n<p>Preprocessing executable 'Main' for lexing-0.1.0.0..\nTokens.x:22:8: parse error</p>\n\n<pre><code>%wrapper \"basic\"\n\n$whiteSpace     = [\\ \\t \\f \\v \\r]\n$digit          = 0-9                                                                                     \n$alpha          = [a-zA-Z]                          \n\n\ntokens :-\n\n  $whiteSpace+        ;\n  $digit+             ;                              \n  (\\n|^).*\\?(\\?=\\n|$)   { \\s -&gt; TokenParagraph  }  \n</code></pre>\n"}, {"tags": ["haskell", "pascals-triangle"], "answers": [{"tags": [], "owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "is_accepted": true, "score": 2, "last_activity_date": 1525310027, "last_edit_date": 1525310027, "creation_date": 1525309392, "answer_id": 50145540, "question_id": 50145509, "link": "https://stackoverflow.com/questions/50145509/pascal-triangle-in-haskell-nested-lists/50145540#50145540", "title": "pascal triangle in haskell nested lists", "body": "<p>To get the kth row:</p>\n\n<pre><code>&gt;&gt;&gt; pascal_infinite !! 4\n[1,4,6,4,1]\n</code></pre>\n\n<p>To get all rows from <code>[0..k]</code>:</p>\n\n<pre><code>&gt;&gt;&gt; map (pascal_infinite !!) [0..4]\n[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1]]\n</code></pre>\n\n<p>To get all rows from <code>[0..k]</code> <em>fast</em>:</p>\n\n<pre><code>&gt;&gt;&gt; take (4+1) pascal_infinite\n[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1]]\n</code></pre>\n\n<hr>\n\n<p>Whoops, misread the question a bit. To get what you're asking for, you should probably construct just use the good old <code>n choose k</code> formula or something similar if you're concerned about speed.</p>\n\n<p>If this is just an exercise, disregarding speed, here's one way:</p>\n\n<pre><code>pascal n = map (!! n) $ drop n pascal_infinite\n</code></pre>\n\n<p>Then simply sample a couple of the 4th elements:</p>\n\n<pre><code>&gt;&gt;&gt; take 8 $ pascal (4-1)\n[1,4,10,20,35,56,84,120]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1525348338, "creation_date": 1525348338, "answer_id": 50154451, "question_id": 50145509, "link": "https://stackoverflow.com/questions/50145509/pascal-triangle-in-haskell-nested-lists/50154451#50154451", "title": "pascal triangle in haskell nested lists", "body": "<p>This basically is an <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:iterate\" rel=\"nofollow noreferrer\"><strong><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]</code></strong></a> function where you have a state, and each time you update the state and you thus produce a list of elements.</p>\n\n<p>As iterate function, we basically want to perform a <code>zipWith (+)</code> with the previous list <code>xs</code>, and <code>(0:xs)</code>, but where we keep iterating until both lists are exhausted. We can implement a <code>zipWithLongest</code> for this:</p>\n\n<pre><code>zipWithLongest :: a -&gt; b -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWithLongest x0 y0 f = go\n    where go (x:xs) (y:ys) = f x y : go xs ys\n          go [] t = map (f x0) t\n          go t [] = map (flip f y0) t\n</code></pre>\n\n<p>So now we can produce the list by using:</p>\n\n<pre><code>import Control.Monad(ap)\n\npascalTriangle :: Num n =&gt; [[n]]\npascalTriangle = iterate (ap (zipWithLongest 0 0 (+)) (0:)) [1]\n</code></pre>\n\n<p>We can index the list by using the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-33--33-\" rel=\"nofollow noreferrer\"><strong><code>(!!) :: [a] -&gt; Int -&gt; a</code></strong></a>. Note however that this is usually a bit of an anti-pattern because of two reasons:</p>\n\n<ol>\n<li>a lookup takes <em>O(k)</em> time with <em>k</em> the value of the index we want to obtain; and</li>\n<li>it is a partial function in the sense that the index can be out of range (here a negative index, and for finite lists an index that is too large).</li>\n</ol>\n\n<p>We know that every next line of the <em>Pascal triangle</em> contains one element more than the previous line. So the <em>k</em>-th line contains <em>k</em> elements. If we want to obtain the <code>k</code>-th element of every sublist, then we should first <em>ignore</em> all the lists that don't have a <code>k</code>-th element. So we use <code>drop k</code> to drop the first <code>k</code>-elements of the list, and then a <code>map (!! k)</code> to obtain the <code>k</code>-th element of every sublist that we do not filter.</p>\n\n<p>So we can write a function:</p>\n\n<pre><code>kThPascalTriangle :: Num n =&gt; Int -&gt; [n]\nkThPascalTriangle k = map (!! k) (drop k pascalTriangle)\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 7916942, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/124af8fc95168eb085275c92f593dd95?s=128&d=identicon&r=PG&f=1", "display_name": "helloworld", "link": "https://stackoverflow.com/users/7916942/helloworld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 575, "favorite_count": 0, "accepted_answer_id": 50145540, "answer_count": 2, "score": 1, "last_activity_date": 1525348338, "creation_date": 1525309169, "question_id": 50145509, "link": "https://stackoverflow.com/questions/50145509/pascal-triangle-in-haskell-nested-lists", "title": "pascal triangle in haskell nested lists", "body": "<p>im trying to get the kth row in every list in the pascal list. For example pascal 4 would get the 4nd element in every row. So it would return 1,4,10,20... etc. I understand how to construct an infinite pascal list which is what outputs below, but im unsure of how to get a nth element in each nested list. any suggestions? i was thinking of using map, but im not necessarily mapping a function here which is throwing me off a bit. thank you. </p>\n\n<pre><code>// im trying to get pascal k to return the nth element of every row in the triangle\npascal n = map(\\n -&gt; ??) take n pascal \npascal_infite = [1] : map (\\l -&gt; zipWith (+) (l ++ [0]) (0:l)) pascal_infinite\n</code></pre>\n"}]