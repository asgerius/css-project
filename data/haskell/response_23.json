[{"tags": ["haskell", "functional-programming", "runtime", "transactional-memory"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1434581552, "post_id": 30903526, "comment_id": 49846336, "body": "<code>(# s2#, TVar tvar# #)</code> is an unboxed tuple. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/primitives.html#unboxed-tuples\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1434581961, "post_id": 30903526, "comment_id": 49846427, "body": "In <code>stg_newTVarzh</code> the last <code>zh</code> is the so-called z-encoding of <code>#</code>: this encoding generates a plain name usable by the linker/the ABI in all platform, removing funny characters like hash (#). I forgot where this encoding is actually defined. The <code>stg_</code> prefix is common to the whole GHC runtime, and stands for the spineless-tagless G-machine, an abstract machine to evaluate functional languages."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1434587151, "post_id": 30903526, "comment_id": 49847675, "body": "The z-encoding is detailed <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/SymbolNames\" rel=\"nofollow noreferrer\">here</a>, in case anyone is interested."}, {"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1434588787, "post_id": 30903526, "comment_id": 49848065, "body": "Great, thanks guys.  @chi, if you want to copy your comments into an answer I would be happy to accept it."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1434616334, "creation_date": 1434616334, "answer_id": 30910277, "question_id": 30903526, "link": "https://stackoverflow.com/questions/30903526/hook-into-ghc-runtime-system/30910277#30910277", "title": "Hook into GHC runtime system", "body": "<p><code>(# s2#, TVar tvar# #)</code> is an <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/primitives.html#unboxed-tuples\" rel=\"nofollow\">unboxed tuple</a>.</p>\n\n<p>The name <code>stg_newTVarzh</code> is built from:</p>\n\n<ul>\n<li><p>The <code>stg_</code> prefix, which is common to the whole GHC runtime, and stands for the spineless-tagless G-machine, an abstract machine to evaluate functional languages;</p></li>\n<li><p><code>newTVar</code> which is the first part of <code>newTVar#</code>;</p></li>\n<li><p>the final <code>zh</code>, which is the so-called <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/SymbolNames\" rel=\"nofollow\">z-encoding</a> of <code>#</code>: this encoding generates a plain name usable by the linker/the ABI in all platform, removing funny characters like hash (#).</p></li>\n</ul>\n"}], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 30910277, "answer_count": 1, "score": 3, "last_activity_date": 1434616334, "creation_date": 1434580059, "question_id": 30903526, "link": "https://stackoverflow.com/questions/30903526/hook-into-ghc-runtime-system", "title": "Hook into GHC runtime system", "body": "<p>I have been looking at how transactional memory is implemented in Haskell, and I am not sure I understand how the STM operations exposed to the programmer hook into the runtime system functions written in C.  In <code>ghc/libraries/base/GHC/Conc/Sync.hs</code> of the git repo, I see the following definitions:</p>\n\n<pre><code>-- |A monad supporting atomic memory transactions.\nnewtype STM a = STM (State# RealWorld -&gt; (# State# RealWorld, a #))\n            deriving Typeable\n\n-- |Shared memory locations that support atomic memory transactions.\ndata TVar a = TVar (TVar# RealWorld a)\n          deriving Typeable\n\n-- |Create a new TVar holding a value supplied\nnewTVar :: a -&gt; STM (TVar a)\nnewTVar val = STM $ \\s1# -&gt;\n    case newTVar# val s1# of\n         (# s2#, tvar# #) -&gt; (# s2#, TVar tvar# #)\n</code></pre>\n\n<p>Then in <code>ghc/rts/PrimOps.cmm</code>, I see the following C-- definition:</p>\n\n<pre><code>stg_newTVarzh (P_ init){\n  W_ tv;\n\n  ALLOC_PRIM_P (SIZEOF_StgTVar, stg_newTVarzh, init);\n\n  tv = Hp - SIZEOF_StgTVar + WDS(1);\n  SET_HDR (tv, stg_TVAR_DIRTY_info, CCCS);\n\n  StgTVar_current_value(tv) = init;\n  StgTVar_first_watch_queue_entry(tv) = stg_END_STM_WATCH_QUEUE_closure;\n  StgTVar_num_updates(tv) = 0;\n\n  return (tv);\n}\n</code></pre>\n\n<p>My questions:</p>\n\n<ol>\n<li>What does the first and last <code>#</code> mean in <code>(# s2#, TVar tvar# #)</code>.  I've read before that putting a <code>#</code> after a variable is just a naming convention indicating something is unboxed, but what does it mean when it is by itself?</li>\n<li>How do we get from <code>newTVar#</code> to <code>stg_newTVarzh</code>?  It seems like I am missing another definition between these two.  Does the compiler rewrite <code>newTVar#</code> into a call to the C-- function listed?</li>\n<li>What are <code>P_</code> and <code>W_</code> in the C-- code?</li>\n</ol>\n\n<p>I have only been able to find one other occurrence of <code>newTVar#</code> in <code>ghc/compiler/prelude/primops.txt.pp</code></p>\n\n<pre><code>primop  NewTVarOp \"newTVar#\" GenPrimOp\n   a\n    -&gt; State# s -&gt; (# State# s, TVar# s a #)\n {Create a new {\\tt TVar\\#} holding a specified initial value.}\nwith\n out_of_line  = True\n has_side_effects = True\n</code></pre>\n\n<p>According to <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/PrimOps\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/wiki/Commentary/PrimOps</a>, this is how primitives are defined so that the compiler knows about them.  </p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1434570605, "post_id": 30899782, "comment_id": 49841043, "body": "Addition is way faster than allocating new <code>(:)</code> constructors."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 5, "last_activity_date": 1434826061, "last_edit_date": 1434826061, "creation_date": 1434570577, "answer_id": 30901064, "question_id": 30899782, "link": "https://stackoverflow.com/questions/30899782/profiling-two-functions-that-sum-large-list/30901064#30901064", "title": "Profiling Two Functions That Sum Large List", "body": "<p>I am no expert in haskell-specific profiling, but I can see several possible problems in <code>faster</code>. You are walking the input list at least three times: once to get its length, once for splitAt (maybe it is twice, I'm not totally sure how this is implemented), and then again to read and sum its elements. In <code>single</code>, the list is walked only once.</p>\n\n<p>You also hold the entire list in memory at once with <code>faster</code>, but with <code>single</code> haskell can process it lazily, and GC as you go. If you look at the profiling output, you can see that <code>faster</code> is copying many more bytes during GC: over 3,000 times more! <code>faster</code> also needed 400MB of memory all at once, where <code>single</code> needed only 40KB at a time. So the garbage collector had a larger space to keep scanning over.</p>\n\n<p>Another big issue: you allocate a ton of new cons cells in <code>faster</code>, to hold the two intermediate sub-lists. Even if it could all be GCed right away, this is a lot of time spent allocating. It's more expensive than just doing the addition to begin with! So even before you start adding, you are already \"over budget\" compared to <code>simple</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 165, "user_id": 4485049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/626f8645e9e35a2ad579b6dcf716e77d?s=128&d=identicon&r=PG&f=1", "display_name": "peter a g", "link": "https://stackoverflow.com/users/4485049/peter-a-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1434603861, "last_edit_date": 1434603861, "creation_date": 1434583076, "answer_id": 30904066, "question_id": 30899782, "link": "https://stackoverflow.com/questions/30899782/profiling-two-functions-that-sum-large-list/30904066#30904066", "title": "Profiling Two Functions That Sum Large List", "body": "<p>Following amalloy's answer... My machine is slower than yours, and running your single took \n     Total   time    0.41s  (  0.35s elapsed)</p>\n\n<p>I tried:</p>\n\n<pre><code>list = [  1..10000000]\nlist1 = [ 1..5000000]\nlist2 = [ 5000001 .. 10000000 ]\n\n\nfastest :: IO ()\nfastest = print . runEval $ do\n   res1 &lt;- rpar (sum list1)\n   res2 &lt;- rpar (sum list2)\n   return (res1 + res2)\n</code></pre>\n\n<p>With that I got </p>\n\n<pre><code>c:\\Users\\peter\\Documents\\Haskell\\practice&gt;parlist 4 +RTS -s -N2\nparlist 4 +RTS -s -N2\n50000005000000\n    960,068,544 bytes allocated in the heap\n       1,398,472 bytes copied during GC\n          43,832 bytes maximum residency (3 sample(s))\n         203,544 bytes maximum slop\n               3 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      1836 colls,  1836 par    0.00s    0.01s     0.0000s    0.0009s\n  Gen  1         3 colls,     2 par    0.00s    0.00s     0.0002s    0.0004s\n\n  Parallel GC work balance: 0.04% (serial 0%, perfect 100%)\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N2)\n\n  SPARKS: 2 (0 converted, 0 overflowed, 0 dud, 1 GC'd, 1 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time    0.31s  (  0.33s elapsed)\n  GC      time    0.00s  (  0.01s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time    0.31s  (  0.35s elapsed)\n\n  Alloc rate    3,072,219,340 bytes per MUT second\n\n  Productivity 100.0% of total user, 90.1% of total elapsed\n</code></pre>\n\n<p>which is faster...</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1434826061, "creation_date": 1434566457, "last_edit_date": 1434567565, "question_id": 30899782, "link": "https://stackoverflow.com/questions/30899782/profiling-two-functions-that-sum-large-list", "title": "Profiling Two Functions That Sum Large List", "body": "<p>I just started reading Parallel and Concurrent Programming in Haskell.</p>\n\n<p>I wrote two programs that, I believe, sums up a list in 2 ways: </p>\n\n<ul>\n<li>running <code>rpar (force (sum list))</code></li>\n<li>splitting up the list, running the above command on each list, and adding each</li>\n</ul>\n\n<p>Here's the code:</p>\n\n<pre><code>import Control.Parallel.Strategies\nimport Control.DeepSeq\nimport System.Environment\n\nmain :: IO ()\nmain = do\n  [n] &lt;- getArgs\n  [single, faster] !! (read n - 1)\n\nsingle :: IO ()\nsingle = print . runEval $ rpar (sum list)\n\nfaster :: IO ()\nfaster = print . runEval $ do\n    let (as, bs) = splitAt ((length list) `div` 2) list\n    res1 &lt;- rpar (sum as)\n    res2 &lt;- rpar (sum bs)\n    return (res1 + res2)\n\n\nlist :: [Integer]\nlist = [1..10000000]\n</code></pre>\n\n<p><strong>Compile with parallelization enabled (-threaded)</strong></p>\n\n<pre><code>C:\\Users\\k\\Workspace\\parallel_concurrent_haskell&gt;ghc Sum.hs -O2 -threaded -rtsopts\n[1 of 1] Compiling Main             ( Sum.hs, Sum.o )\nLinking Sum.exe ...\n</code></pre>\n\n<p><strong>Results of <code>single</code> Program</strong></p>\n\n<pre><code>C:\\Users\\k\\Workspace\\parallel_concurrent_haskell&gt;Sum 1 +RTS -s -N2\n50000005000000\n     960,065,896 bytes allocated in the heap\n         363,696 bytes copied during GC\n          43,832 bytes maximum residency (2 sample(s))\n          57,016 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      1837 colls,  1837 par    0.00s    0.01s     0.0000s    0.0007s\n  Gen  1         2 colls,     1 par    0.00s    0.00s     0.0002s    0.0003s\n\n  Parallel GC work balance: 0.18% (serial 0%, perfect 100%)\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N2)\n\n  SPARKS: 1 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 1 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time    0.27s  (  0.27s elapsed)\n  GC      time    0.00s  (  0.01s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time    0.27s  (  0.28s elapsed)\n\n  Alloc rate    3,614,365,726 bytes per MUT second\n\n  Productivity 100.0% of total user, 95.1% of total elapsed\n\ngc_alloc_block_sync: 573\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p><strong>Run with <code>faster</code></strong></p>\n\n<pre><code>C:\\Users\\k\\Workspace\\parallel_concurrent_haskell&gt;Sum 2 +RTS -s -N2\n50000005000000\n   1,600,100,336 bytes allocated in the heap\n   1,477,564,464 bytes copied during GC\n     400,027,984 bytes maximum residency (14 sample(s))\n      70,377,336 bytes maximum slop\n             911 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      3067 colls,  3067 par    1.05s    0.68s     0.0002s    0.0021s\n  Gen  1        14 colls,    13 par    1.98s    1.53s     0.1093s    0.5271s\n\n  Parallel GC work balance: 0.00% (serial 0%, perfect 100%)\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N2)\n\n  SPARKS: 2 (0 converted, 0 overflowed, 0 dud, 1 GC'd, 1 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time    0.38s  (  1.74s elapsed)\n  GC      time    3.03s  (  2.21s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time    3.42s  (  3.95s elapsed)\n\n  Alloc rate    4,266,934,229 bytes per MUT second\n\n  Productivity  11.4% of total user, 9.9% of total elapsed\n\ngc_alloc_block_sync: 335\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>Why did <code>single</code> complete in <strong>0.28 seconds</strong>, but <code>faster</code> (poorly named, evidently) took <strong>3.95 seconds</strong>?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 18, "creation_date": 1434564847, "post_id": 30899003, "comment_id": 49837522, "body": "What is the type of <code>x</code>?  If it&#39;s <code>(Num a, Enum a) =&gt; [a]</code> then this won&#39;t work as expected.  Try <code>let x = [1..100] :: [Int]</code>.  In reality, when you print <code>x</code> with the more general type GHCi specializes it to <code>Integer</code> to do the printing.  This means that the values you see printed are not actually stored back in <code>x</code>&#39;s thunk.  Using a concrete type avoids this problem."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 8, "creation_date": 1434565574, "post_id": 30899003, "comment_id": 49837902, "body": "For once, a problem caused by the <i>lack</i> of the dreaded monomorphism restriction! :-)"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1434569619, "post_id": 30899003, "comment_id": 49840420, "body": "Well that&#39;s the usual bias of defaults: the disadvantages of the default are going to be more salient than the advantages."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1434571023, "post_id": 30899003, "comment_id": 49841316, "body": "I think @bheklilr comment should b ethe answer - just a small observation: when I red it, it almost look like the problem might be <code>Integer</code> vs <code>Int</code> - this is not a critique it&#39;s just that I thought for a moment: &quot;is there something going on with <code>Integer</code>?) - so maybe you can just rename it to <code>[1..100] :: [Integer]</code>? (sorry)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1434575473, "post_id": 30899003, "comment_id": 49843833, "body": "By running this scenario myself, I got: <code>x = 1 : _</code> the second time."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1434586010, "post_id": 30899003, "comment_id": 49847418, "body": "@CommuSoft You must either be putting it into a file and then loading it or you&#39;re using a GHCi with a version before 7.8. The monomorphism restriction would be turned on in those cases."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1452180804, "creation_date": 1452180804, "answer_id": 34659048, "question_id": 30899003, "link": "https://stackoverflow.com/questions/30899003/evaluating-list-to-weak-head-normal-form/34659048#34659048", "title": "Evaluating List to Weak Head Normal Form", "body": "<p>I think this bheklilr's comment should be marked as the answer:</p>\n\n<blockquote>\n  <p>What is the type of x? If it's <code>(Num a, Enum a) =&gt; [a]</code> then this won't work as expected. Try <code>let x = [1..100] :: [Int</code>]. In reality, when you print x with the more general type GHCi specializes it to Integer to do the printing. This means that the values you see printed are not actually stored back in x's thunk. Using a concrete type avoids this problem.</p>\n</blockquote>\n\n<p>With the additional note from David Young that this problem won't occur on GHCi versions earlier than 7.8, when the monomorphism restriction was enabled.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 3, "answer_count": 1, "score": 16, "last_activity_date": 1452180804, "creation_date": 1434564105, "question_id": 30899003, "link": "https://stackoverflow.com/questions/30899003/evaluating-list-to-weak-head-normal-form", "title": "Evaluating List to Weak Head Normal Form", "body": "<p>Given the following list from 1 to 100:</p>\n\n<pre><code>&gt; let x = [1..100]\n</code></pre>\n\n<p>I run <code>sprint x</code> to observe its unevaluated value.</p>\n\n<pre><code>&gt; :sprint x\nx = _\n</code></pre>\n\n<p>Then, I ran <code>seq</code> to evaluate it to Weak Head Normal Form:</p>\n\n<pre><code>&gt; seq x ()\n()\n</code></pre>\n\n<p>But re-running <code>sprint x</code> shows (<em>what I think</em>) is the same value.</p>\n\n<pre><code>&gt; :sprint x\nx = _\n</code></pre>\n\n<p>Why is that?</p>\n"}, {"tags": ["haskell", "cabal", "stackage"], "comments": [{"owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 0, "creation_date": 1434560191, "post_id": 30897658, "comment_id": 49834724, "body": "can&#39;t you just set <code>remote-repo</code> in <code>~&#47;.cabal&#47;config</code>?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 0, "creation_date": 1434560305, "post_id": 30897658, "comment_id": 49834784, "body": "@ibotty Yes, but I&#39;m interested in making it the default for all users, in particular I need to avoid any changes in <code>~&#47;.cabal</code>."}, {"owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 1, "creation_date": 1434560981, "post_id": 30897658, "comment_id": 49835194, "body": "Ah, I see. The other &quot;global&quot;. I assumed you meant not in a sandbox."}], "answers": [{"tags": [], "owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "is_accepted": false, "score": 1, "last_activity_date": 1434562500, "creation_date": 1434562500, "answer_id": 30898526, "question_id": 30897658, "link": "https://stackoverflow.com/questions/30897658/how-to-install-stackage-as-the-system-default/30898526#30898526", "title": "How to install Stackage as the system default?", "body": "<p>AFAIK cabal does not support a global config file. But even that won't help by itself because afaict, you can't disable configured <code>remote-repo</code>s anyway.</p>\n\n<p>So I see two approaches with obvious drawbacks.</p>\n\n<h2>Clean way for new users</h2>\n\n<p>Install a <code>/etc/skel/.cabal/config</code> file that will be copied to new user accounts. That won't help with older users though.</p>\n\n<h2>Hacky way for all users</h2>\n\n<p>Install a global alias (or shell script wrapper) with name <code>cabal</code> that calls <code>cabal --remote-repo=hackage.haskell.org:http://www.stackage.org/lts</code>.</p>\n\n<p>Users can opt out by <code>unalias</code>ing cabal or using the real cabal executable when using a shell script.</p>\n\n<p>Users will be utterly confused though, because cabal will tell users it uses hackage, when in fact it is using stackage.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1434562500, "creation_date": 1434559660, "question_id": 30897658, "link": "https://stackoverflow.com/questions/30897658/how-to-install-stackage-as-the-system-default", "title": "How to install Stackage as the system default?", "body": "<p>The installation instructions at the <a href=\"https://www.stackage.org/\" rel=\"nofollow\">Stackage web site</a> describe how to use it for one project.</p>\n\n<p>Is there a way how to configure Stackage to be the default for all users and install packages globally available to them?</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1434561676, "post_id": 30897154, "comment_id": 49835594, "body": "Your understanding is correct. The compiler is not even aware that a call to <code>fib 36</code> will contain a call to <code>fib 35</code>. If you want sharing, you will have to implement it yourself. GHC doesn&#39;t do any CSE, because it isn&#39;t an optimization in general. Note that <code>x</code> and <code>y</code> are evaluated in parallel - 0.73s is the time to compute fib 35, and 1.9s is the time to compute fib 36."}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1434558142, "creation_date": 1434558142, "question_id": 30897154, "link": "https://stackoverflow.com/questions/30897154/parallel-fibonacci-from-parallel-and-concurrent-haskell", "title": "Parallel Fibonacci from &quot;Parallel and Concurrent Haskell&quot;", "body": "<p>From Simon Marlow's <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch02.html#sec_par-eval-whnf\" rel=\"nofollow\">Parallel and Concurrent Haskell</a>, he shows the following example (<code>rpar.hs</code>):</p>\n\n<pre><code>fib :: Integer -&gt; Integer\nfib 0 = 1\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n\nmain = do\n  [n] &lt;- getArgs\n  let test = [test1,test2,test3,test4] !! (read n - 1)\n  t0 &lt;- getCurrentTime\n  r &lt;- evaluate (runEval test)\n  printTimeSince t0\n  print r\n  printTimeSince t0\n\ntest2 = do\n  x &lt;- rpar (fib 36)\n  y &lt;- rseq (fib 35)\n  return (x,y)\n</code></pre>\n\n<p>Typing in the following from the command-line will run the second test on two cores:</p>\n\n<pre><code>$rpar 2 +RTS -N2\ntime: 0.73s\n(24157817,14930352)\ntime: 1.90s\n</code></pre>\n\n<p>As I understand, the first time represents the time elapsed in order to complete the <code>rseq (fib 35)</code>. Then, calling <code>print r</code> causes the complete evaluation of <code>rpar (fib 36)</code>.</p>\n\n<p>If that explanation is correct, then it seems that <code>fib 36</code>'s calculation was not able to re-use the already calculated <code>fib 35</code>. In other words, all of the work, i.e. calculating <code>fib 35</code>, had to be performed twice.</p>\n\n<p>Is this understanding correct? Please correct or elaborate on anything that I missed.</p>\n"}, {"tags": ["postgresql", "haskell", "amazon-web-services", "scheduled-tasks", "yesod"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434562468, "post_id": 30896030, "comment_id": 49836056, "body": "You are already using Yesod, which comes with a companion library called <a href=\"http://hackage.haskell.org/package/persistent\" rel=\"nofollow noreferrer\">persistent</a> which implements, you guessed it, persistent storage. There is a <a href=\"https://hackage.haskell.org/package/persistent-postgresql\" rel=\"nofollow noreferrer\">postgres backend</a> for persistent as well."}, {"owner": {"reputation": 1455, "user_id": 393863, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1c52f2566306ab2c1f82de50a1472ff3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/393863/alexander"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434611801, "post_id": 30896030, "comment_id": 49855432, "body": "Well...I know that and I used <code>persistent</code> for other projects. I want a scheduler that persists it tasks in a database to recover from a crash/restart, whatever and not an ORM..."}], "owner": {"reputation": 1455, "user_id": 393863, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1c52f2566306ab2c1f82de50a1472ff3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/393863/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 227, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1434555087, "creation_date": 1434555087, "question_id": 30896030, "link": "https://stackoverflow.com/questions/30896030/job-scheduling-with-yesod", "title": "Job Scheduling with Yesod", "body": "<p>Following problem:</p>\n\n<p>I have a Yesod web app that is connected to a Postgres database (everything is hosted on AWS Elastic Beanstalk).</p>\n\n<p>My customer wants to define a schedule (day, hour, ...) for things to happen automatically (e.g. sending out a message). E.g.: \"every wednesday message A will be sent at 02:00 PM, but does not get sent after 03:00 PM if the server was down in that period\". The definition could be saved to a text file on S3 for example.</p>\n\n<p>One lib I found was <a href=\"https://hackage.haskell.org/package/cron\" rel=\"nofollow\">https://hackage.haskell.org/package/cron</a> which could be used as a basis for my needs with a caveat: if the server is shut down in that particular minute in which a job would be triggered, the message would not be sent when the server is back.</p>\n\n<p>I used DelayedJob (Ruby) in the past and there the scheduled jobs were stored in a database to circumvent this issue. But in Haskell I could only find solutions without database persistence.</p>\n\n<p>Is there anything to look into for Haskell or do I have to build that on my own e.g. use something like <a href=\"http://jdabbs.com/resquing-yesod/\" rel=\"nofollow\">http://jdabbs.com/resquing-yesod/</a> as a starting point)?</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "idioms"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1434548648, "post_id": 30893339, "comment_id": 49826088, "body": "Provide a function that given a list of points constructs a polyline. For example you could do <code>addPoints line ps = ps ++ line</code> or something like that. BTW: you can also call <code>addPoint</code> in infix notation."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1434549501, "post_id": 30893339, "comment_id": 49826770, "body": "The idiomatic way would probably be to ditch <code>addPoint</code> and just construct the list directly as <code>[p3, p2, p1]</code>, but if you want to keep that abstract then just make your own operator, like <code>infixr 5 #</code>, <code>(#) :: Point -&gt; Polyline -&gt; Polyline</code>, <code>(#) = addPoint</code> (note that I&#39;ve swapped the argument order here).  The <code>infixr</code> line is important, make sure you keep it, but it means you could instead write this as <code>p3 # p2 # p1 # line</code>.  If you really want to keep the argument order then do <code>infixl 5 #</code> and it would be written as <code>line # p1 # p2 # p3</code> instead."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1434549565, "post_id": 30893339, "comment_id": 49826827, "body": "Note that if you changed the argument order so that it was <code>addPoint :: Point -&gt; Polyline -&gt; Polyline</code>, then you could write this as <code>addPoint p3 $ addPoint p2 $ addPoint p1 line</code>, which might be sufficient for your purposes."}], "answers": [{"tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": true, "score": 5, "last_activity_date": 1434549853, "creation_date": 1434549853, "answer_id": 30893924, "question_id": 30893339, "link": "https://stackoverflow.com/questions/30893339/idiomatic-list-construction/30893924#30893924", "title": "Idiomatic list construction", "body": "<p>The multiple call to addPoints could be replaced by a fold. As suggested in a comment, reversing your addPoint function would make things easier:</p>\n\n<pre><code>addPoint' :: Point -&gt; Polyline -&gt;  Polyline\naddPoint' p line = p:line\n</code></pre>\n\n<p>So then your constructLine function could build a temporary list of the points to add add use a fold:</p>\n\n<pre><code>constructLine :: Polyline -&gt; Polyline\nconstructLine line =\n    let\n        p1 = Point 2 4 87\n        p2 = Point 3 7 2\n        p3 = Point 23 4 8\n    in foldr addPoint' line [p3,p2,p1]\n</code></pre>\n\n<p>This does not break the encapsulation (you can replace your implementation of Polyline by something else than a list of Point) and uses the new points in the order they're going to end up at (p3 in front of p2, etc.)</p>\n"}, {"comments": [{"owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "edited": false, "score": 0, "creation_date": 1434570067, "post_id": 30900437, "comment_id": 49840688, "body": "Yes I know this but I wanted to abstract the polyline construction. Thanks for your answer anyway!"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "edited": false, "score": 0, "creation_date": 1434570772, "post_id": 30900437, "comment_id": 49841156, "body": "@ElieGnrd: If polylines are conceptually similar to lists but there are invariants that you wish to protect, one simple way is to have conversion functions back-and-forth between the opaque <code>PolyLine</code> type and lists of points.  Then a lot of the logic can be done in terms of list operations (very well supported in Haskell), and to create a <code>PolyLine</code> you just supply a list.  For example, the <code>Data.Map.Map</code> type in the Haskell Platform works like this\u2014one of the most common ways of creating one is to use the function <code>fromList :: Ord k =&gt; [(k, v)] -&gt; Map k v</code>."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 2, "last_activity_date": 1434568568, "creation_date": 1434568568, "answer_id": 30900437, "question_id": 30893339, "link": "https://stackoverflow.com/questions/30893339/idiomatic-list-construction/30900437#30900437", "title": "Idiomatic list construction", "body": "<p>Your <code>constructLine</code> example just strikes me as a long-winded version of this:</p>\n\n<pre><code>constructLine :: Polyline -&gt; Polyline\nconstructLine line = [Point 23 4 8, Point 3 7 2, Point 2 4 87] ++ line\n</code></pre>\n\n<p>I don't know if you've come across these yet, but just to be sure:</p>\n\n<ul>\n<li><code>[Point 23 4 8, Point 3 7 2, Point 2 4 87]</code> is just a list literal.</li>\n<li><code>++</code> is the function to append lists.</li>\n</ul>\n\n<p>Generally, to add multiple elements to a list, what you do is you have a list of the elements that you wish to add, and append that list together with the original list.</p>\n\n<p>This pattern continues. If we notice that <code>line</code> is a constant defined to <code>[]</code>, then your whole program really is just a long-winded version of this:</p>\n\n<pre><code>type Coord = Double\ndata Point = Point Coord Coord Coord deriving Show\n\nmain :: IO () \nmain = putStrLn (show points)\n     where points = [Point 23 4 8, Point 3 7 2, Point 2 4 87]\n</code></pre>\n\n<p>Basically, if the points' values are known at compilation time, you can just <em>write</em> the list, there's no need to go through all this indirection. </p>\n"}], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 30893924, "answer_count": 2, "score": 1, "last_activity_date": 1434568568, "creation_date": 1434548360, "last_edit_date": 1434552471, "question_id": 30893339, "link": "https://stackoverflow.com/questions/30893339/idiomatic-list-construction", "title": "Idiomatic list construction", "body": "<p>I'm very new to Haskell and functional programming in general, so I don't really know how to make this code idiomatic:</p>\n\n<pre><code>type Coord = Double\ndata Point = Point Coord Coord Coord deriving Show\n\ntype Polyline = [Point]\n\n-- Add a point to a polyline\naddPoint :: Polyline -&gt; Point -&gt; Polyline\naddPoint line p = p:line\n\nline :: Polyline\nline = []\n\nconstructLine :: Polyline -&gt; Polyline\nconstructLine line =\n    let \n        p1 = Point 2 4 87\n        p2 = Point 3 7 2\n        p3 = Point 23 4 8\n    in addPoint (addPoint (addPoint line p1) p2) p3\n\nmain :: IO() \nmain = do\n    putStrLn ( show (constructLine line))\n</code></pre>\n\n<p>My problem is in the <code>constructLine</code> function. If I want to add a lot of points the nested <code>addPoint</code> functions are going to be a problem. How can I factor this? And do you see other things that could be improved?</p>\n"}, {"tags": ["haskell", "automatic-differentiation", "hmatrix"], "comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1434603163, "post_id": 30888615, "comment_id": 49851438, "body": "Question for the audience: Does cabal run use something like runhaskell under the hood, ie is part of the problem that this code is being interpreted instead of compiled?"}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 1, "creation_date": 1434625506, "post_id": 30888615, "comment_id": 49864325, "body": "@JohnF.Miller <code>cabal run</code> does run compiled code. Running the same thing from GHCi (ie use <code>:main</code>) is even slower."}], "answers": [{"tags": [], "owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "is_accepted": true, "score": 3, "last_activity_date": 1442428624, "creation_date": 1442428624, "answer_id": 32616196, "question_id": 30888615, "link": "https://stackoverflow.com/questions/30888615/how-to-get-more-performance-out-of-automatic-differentiation/32616196#32616196", "title": "How to get more performance out of automatic differentiation?", "body": "<p>You are running into pretty much the worst-case scenario for the current <code>ad</code> library here.</p>\n\n<p>FWIW- You won't be able to use the existing <code>ad</code> classes/types with \"matrix/vector ad\". It'd be a fairly large engineering effort, see <a href=\"https://github.com/ekmett/ad/issues/2\" rel=\"nofollow\">https://github.com/ekmett/ad/issues/2</a></p>\n\n<p>As for why you can't unbox: <code>conjugateGradient</code> requires the ability to use <code>Kahn</code> mode or two levels of forward mode on your functions. The former precludes it from working with unboxed vectors, as the data types carry syntax trees, and can't be unboxed. For various technical reasons I haven't figured out how to make it work with a fixed sized 'tape' like the standard <code>Reverse</code> mode.</p>\n\n<p>I think the \"right\" answer here is for us to sit down and figure out how to get matrix/vector AD right and integrated into the package, but I confess I'm timesliced a bit too thinly right now to give it the attention it deserves.</p>\n\n<p>If you get a chance to swing by #haskell-lens on irc.freenode.net I'd happy to talk about designs in this space and offer advice. Alex Lang has also been working on <code>ad</code> a lot and is often present there and may have ideas.</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 1, "accepted_answer_id": 32616196, "answer_count": 1, "score": 16, "last_activity_date": 1442428624, "creation_date": 1434536069, "last_edit_date": 1495541250, "question_id": 30888615, "link": "https://stackoverflow.com/questions/30888615/how-to-get-more-performance-out-of-automatic-differentiation", "title": "How to get more performance out of automatic differentiation?", "body": "<p>I am having a hard time optimizing a program that is relying on <code>ad</code>s <code>conjugateGradientDescent</code> function for most of it's work.</p>\n\n<p>Basically my code is a translation of an <a href=\"http://redwood.berkeley.edu/bruno/sparsenet/\" rel=\"nofollow noreferrer\">old papers code</a> that is written in Matlab and C. I have not measured it, but that code is running at several iterations per second. Mine is in the order of minutes per iteration ...</p>\n\n<p>The code is available in this repositories:</p>\n\n<ul>\n<li><a href=\"https://github.com/fhaust/aer\" rel=\"nofollow noreferrer\">https://github.com/fhaust/aer</a></li>\n<li><a href=\"https://github.com/fhaust/aer-utils\" rel=\"nofollow noreferrer\">https://github.com/fhaust/aer-utils</a></li>\n</ul>\n\n<p>The code in question can be run by following these commands:</p>\n\n<pre><code>$ cd aer-utils\n$ cabal sandbox init\n$ cabal sandbox add-source ../aer\n$ cabal run learngabors\n</code></pre>\n\n<p>Using GHCs profiling facilities I have confirmed that the descent is in fact the part that is taking most of the time:</p>\n\n<p><img src=\"https://i.stack.imgur.com/T8iPP.png\" alt=\"Flamegraph of one iteration\"></p>\n\n<p>(interactive version here: <a href=\"https://dl.dropboxusercontent.com/u/2359191/learngabors.svg\" rel=\"nofollow noreferrer\">https://dl.dropboxusercontent.com/u/2359191/learngabors.svg</a>)</p>\n\n<p><code>-s</code> is telling me that productivity is quite low:</p>\n\n<pre><code>Productivity  33.6% of total user, 33.6% of total elapsed\n</code></pre>\n\n<p>From what I have gathered there are two things that might lead to higher performance:</p>\n\n<ul>\n<li><p><strong>Unboxing:</strong> currently I use a custom matrix implementation (in <code>src/Data/SimpleMat.hs</code>). This was the only way I could get <code>ad</code> to work with matrices (see: <a href=\"https://stackoverflow.com/questions/30072218/how-to-do-automatic-differentiation-on-hmatrix\">How to do automatic differentiation on hmatrix?</a>). My guess is that by using a matrix type like <code>newtype Mat w h a = Mat (Unboxed.Vector a)</code> would achieve better performance due to unboxing and fusion. I found <a href=\"https://gist.github.com/aavogt/6bee72717148123a187c\" rel=\"nofollow noreferrer\">some code</a> that has <code>ad</code> instances for unboxed vectors, but up to now I haven't been able to use these with the <code>conjugateGradientFunction</code>.</p></li>\n<li><p><strong>Matrix derivatives:</strong> In an email I just can't find at the moment Edward mentions that it would be better to use <code>Forward</code> instances for matrix types instead of having matrices filled with <code>Forward</code> instances. I have a faint idea how to achieve that, but have yet to figure out how I'd implement it in terms of <code>ad</code>s type classes.</p></li>\n</ul>\n\n<p>This is probably a question that is too wide to be answered on SO, so if you are willing to help me out here, feel free to contact me on Github.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1434536853, "post_id": 30888565, "comment_id": 49817260, "body": "The constraing <code>Show a</code> appears because you called the <code>show</code> function. It&#39;s that simple. (...<code>putStrLn $ show maybeAge</code>...)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1434539424, "post_id": 30888565, "comment_id": 49818934, "body": "BTW, <code>maybeAge</code> is more commonly defined as <code>maybeAge = processYear `fmap` readMay strYear</code> or <code>maybeAge = processYear &lt;$&gt; readMay strYear</code>."}], "answers": [{"comments": [{"owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "edited": false, "score": 1, "creation_date": 1434560380, "post_id": 30888614, "comment_id": 49834832, "body": "In other words we can say that there is constraint on type a that it should be an instance of typeclass Show"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1434536067, "creation_date": 1434536067, "answer_id": 30888614, "question_id": 30888565, "link": "https://stackoverflow.com/questions/30888565/what-does-the-type-show-a-maybe-a-io-mean/30888614#30888614", "title": "What does the type &quot;Show a =&gt; Maybe a -&gt; IO ()&quot; mean?", "body": "<p><code>displayAge</code> takes a value that is <code>Maybe</code> of type <code>a</code>, where <code>a</code> is any type which can be <code>Show</code>n.</p>\n\n<p>It's often useful to first read what's on the right-hand side of <code>=&gt;</code> in Haskell signatures, i.e. <code>Maybe a -&gt; IO ()</code></p>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 0, "last_activity_date": 1434598605, "last_edit_date": 1592644375, "creation_date": 1434598605, "answer_id": 30906053, "question_id": 30888565, "link": "https://stackoverflow.com/questions/30888565/what-does-the-type-show-a-maybe-a-io-mean/30906053#30906053", "title": "What does the type &quot;Show a =&gt; Maybe a -&gt; IO ()&quot; mean?", "body": "<p>So, this is a type declaration, so it is going to tell you about what you need to supply to the function <code>displayAge</code> in order for the type checker to be happy.  The lines that follow actually describe how the function works.  Type declarations are (nearly always) optional, but they are important documentation, and frequently make error messages make a lot more sense because the compiler now knows what you thought you wanted to do and can compare that to what you actually did.</p>\n<h2><code>Show a</code></h2>\n<p>The first part of the declaration, the piece before the <code>=&gt;</code> tells us something about <code>a</code>. We note that <code>a</code> is lower case so it is <em>not</em> a type but a type variable.  When you actually use the <code>displayAge</code> function you may use any type you wish in place of <code>a</code> (Int, String, [Double], etc ...) but this says that there must be a <code>Show</code> instance for that type.  So just about any type that is not a function.  If classes in haskell are still confusing to you, check out <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">this section</a> of <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">Learn You a Haskell for Great Good</a> (really it is as good as _Why's tutorial on Ruby)</p>\n<h2><code>Maybe a</code></h2>\n<p>There are lots of ways to read Haskell type signatures, but if your new, it can help to think of all the types before the last arrow (<code>-&gt;</code>) as &quot;inputs&quot; and the final type as &quot;output.&quot; This idea misses currying, and first class functions, but it can really help get you started.</p>\n<p>So this function wants a <code>Maybe a</code> and will give you an <code>IO()</code>.</p>\n<p>What then is a <code>Maybe a</code>?  If you are not familiar with the <code>Maybe</code> type you should certainly make an effort to become so.  It is a second order type.  That means that in order to use it you need to give it some other type to contain. Maybe holds some other type.  So <code>Maybe Int</code> holds and <code>Int</code>, and <code>Maybe String</code> holds a <code>String</code>.  But this function is designed to work with a <code>Maybe</code> which holds any type at all (so long has it has a Show instance like we noted above). Again note that lower case <code>a</code> If this function had needed some type in particular, it would have used a type that started with a Capital letter.</p>\n<h2><code>IO()</code></h2>\n<p>Ok, this could be the hard part. This function rather then calculating some new value, does something to the Real World -- All the things that exist beyond the world of haskell is the Real World. So user input and output, network stuff and mutable memory all have to go inside an IO type. (Yes it is second order just like Maybe) This is the famous and lovely IO monad which we hope you have heard of, and will learn to love.  When a function comes with the type <code>IO()</code> it means that it <em>does</em> something rather then returning a value.  In our case we think it should probably display and age, right?. You will need to use <code>displayAge</code> in a <code>do</code> block like the one for the <code>main</code> function*.</p>\n<hr />\n<p>* Not strictly true, you can use bind (<code>&gt;&gt;=</code>) instead, but come on this is clearly a beginners question, and we have this rule about not writing monad tutorials, right?</p>\n"}], "owner": {"reputation": 159, "user_id": 4878529, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PHCAd7dBxRQ/AAAAAAAAAAI/AAAAAAAAAR4/idA5SWFjVBo/photo.jpg?sz=128", "display_name": "dan9131", "link": "https://stackoverflow.com/users/4878529/dan9131"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1434598605, "creation_date": 1434535921, "last_edit_date": 1434542665, "question_id": 30888565, "link": "https://stackoverflow.com/questions/30888565/what-does-the-type-show-a-maybe-a-io-mean", "title": "What does the type &quot;Show a =&gt; Maybe a -&gt; IO ()&quot; mean?", "body": "<p>I have a code snippet, which is looks as follows</p>\n\n<pre><code>displayAge :: Show a =&gt; Maybe a -&gt; IO ()\ndisplayAge maybeAge =\n  case maybeAge of\n    Nothing -&gt; putStrLn \"Invalid year\"\n    Just maybeAge -&gt; putStrLn $ show maybeAge\n</code></pre>\n\n<p>This function takes its parameter from the console and is passed to it through <code>readMay</code> function as follows;</p>\n\n<pre><code>main = do\n  putStrLn \"Your birth year\"\n  strYear &lt;- getLine\n  let maybeAge = do\n        intYear &lt;- readMay strYear\n        return (processYear intYear)\n  displayAge maybeAge\n</code></pre>\n\n<p>Can you please explain the type declaration of the <code>displayAge</code> function. Why is <code>Show a</code> used?</p>\n"}, {"tags": ["haskell", "type-level-computation", "hlist"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1434535300, "post_id": 30886740, "comment_id": 49816270, "body": "It seems that you want to fold over only those elements of the list which are instances of <code>EncodeBit</code>. Why do you want to do that? (Also, it&#39;s impossible. Haskell doesn&#39;t have &quot;not instance of class&quot; constraints). Instead, you could require that all types are <code>EncodeBit</code>, and then fold over all of them."}], "answers": [{"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1434648593, "post_id": 30921913, "comment_id": 49880781, "body": "This is really cool! I&#39;m slowly reading and assimilating now. Thanks a lot!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1434652037, "last_edit_date": 1434652037, "creation_date": 1434648429, "answer_id": 30921913, "question_id": 30886740, "link": "https://stackoverflow.com/questions/30886740/fold-over-a-heterogeneous-compile-time-list/30921913#30921913", "title": "Fold over a heterogeneous, compile time, list", "body": "<p>Answering your comment:</p>\n\n<blockquote>\n  <p>Actually, I can do if I can filter the heterogeneous list by type. Is that possible?</p>\n</blockquote>\n\n<p>You can filter the heterogeneous list by type if you add a <code>Typeable</code> constraint to <code>b</code>.</p>\n\n<p>The main idea is we will use <code>Data.Typeable</code>'s <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Typeable.html#v:cast\" rel=\"nofollow\"><code>cast :: (Typeable a, Typeable b) =&gt; a -&gt; Maybe b</code></a> to determine if each item in the list is of a certain type. This will require a <code>Typeable</code> constraint for each item in the list. Instead of building a new list type with this constraint built in, we will make the ability to check if <code>All</code> types in a list meet some constraint.</p>\n\n<p>Our goal is to make the following program output <code>[True,False]</code>, filtering a heterogeneous list to only its <code>Bool</code> elements. I will endevour to place the language extensions and imports with the first snippet they are needed for</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\n\nexample :: HList (Bool ': String ': Bool ': String ': '[])\nexample = HCons True $ HCons \"Jack\" $ HCons False $ HCons \"Jill\" $ HNil\n\nmain = do\n    print (ofType example :: [Bool])\n</code></pre>\n\n<p><code>HList</code> here is a fairly standard definition of a heterogeneous list in haskell using <code>DataKinds</code></p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n\ndata HList (l :: [*]) where\n    HCons :: h -&gt; HList t -&gt; HList (h ': t)\n    HNil :: HList '[]\n</code></pre>\n\n<p>We want to write <code>ofType</code> with a signature like \"if <code>All</code> things in a heterogeneous list are <code>Typeable</code>, get a list of those things of a specific <code>Typeable</code> type.</p>\n\n<pre><code>import Data.Typeable\n\nofType :: (All Typeable l, Typeable a) =&gt; HList l -&gt; [a]\n</code></pre>\n\n<p>To do this, we need to develop the notion of <code>All</code> things in a list of types satisfying some constraint. We will store the dictionaries for satisfied constraints in a <code>GADT</code> that either captures both the head constraint  dictionary and constraints for <code>All</code> of the the tail or proves that the list is empty. A type list satisfies a constraint for <code>All</code> it's items if we can capture the dictionaries for it.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-} \n{-# LANGUAGE ConstraintKinds #-}\n\n-- requires the constraints\u2020 package.\n-- Constraint is actually in GHC.Prim\n-- it's just easier to get to this way\nimport Data.Constraint (Constraint)\n\nclass All (c :: * -&gt; Constraint) (l :: [*]) where\n    allDict :: p1 c -&gt; p2 l -&gt; DList c l\n\ndata DList (ctx :: * -&gt; Constraint) (l :: [*]) where\n    DCons :: (ctx h, All ctx t) =&gt; DList ctx (h ': t)\n    DNil  ::                       DList ctx '[]\n</code></pre>\n\n<p><code>DList</code> really is a list of dictionaries. <code>DCons</code> captures the dictionary for the constraint applied to the head item (<code>ctx h</code>) and all the dictionaries for the remainder of the list (<code>All ctx t</code>). We can't get the dictionaries for the tail directly from the constructor, but we can write a function that extracts them from the dictionary for <code>All ctx t</code>.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Proxy\n\ndtail :: forall ctx h t. DList ctx (h ': t) -&gt; DList ctx t\ndtail DCons = allDict (Proxy :: Proxy ctx) (Proxy :: Proxy t)\n</code></pre>\n\n<p>An empty list of types trivially satisfies any constraint applied to all of its items</p>\n\n<pre><code>instance All c '[] where\n    allDict _ _ = DNil\n</code></pre>\n\n<p>If the head of a list satisfies a constraint and all of the tail does too, then everything in the list satisfies the constraint.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n\ninstance (c h, All c t) =&gt; All c (h ': t) where\n    allDict _ _ = DCons\n</code></pre>\n\n<p>We can now write <code>ofType</code>, which requires <code>forall</code>s for scoping type variables with <code>ScopedTypeVariables</code>.</p>\n\n<pre><code>import Data.Maybe\n\nofType :: forall a l. (All Typeable l, Typeable a) =&gt; HList l -&gt; [a]\nofType l = ofType' (allDict (Proxy :: Proxy Typeable) l) l\n  where\n    ofType' :: forall l. (All Typeable l) =&gt; DList Typeable l -&gt; HList l -&gt; [a]\n    ofType' d@DCons (HCons x t) = maybeToList (cast x) ++ ofType' (dtail d) t\n    ofType' DNil    HNil        = []\n</code></pre>\n\n<p>We are zipping the <code>HList</code> together with its dictionaries with <code>maybeToList . cast</code> and concatenating the results. We can make that explicit with <code>RankNTypes</code>.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Data.Monoid (Monoid, (&lt;&gt;), mempty)\n\nzipDHWith :: forall c w l p. (All c l, Monoid w) =&gt; (forall a. (c a) =&gt; a -&gt; w) -&gt; p c -&gt; HList l -&gt; w\nzipDHWith f p l = zipDHWith' (allDict p l) l\n  where\n    zipDHWith' :: forall l. (All c l) =&gt; DList c l -&gt; HList l -&gt; w\n    zipDHWith' d@DCons (HCons x t) = f x &lt;&gt; zipDHWith' (dtail d) t\n    zipDHWith' DNil    HNil        = mempty\n\nofType :: (All Typeable l, Typeable a) =&gt; HList l -&gt; [a]\nofType = zipDHWith (maybeToList . cast) (Proxy :: Proxy Typeable) \n</code></pre>\n\n<hr>\n\n<p>\u2020<a href=\"http://hackage.haskell.org/package/constraints\" rel=\"nofollow\">constraints</a></p>\n"}], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 30921913, "answer_count": 1, "score": 7, "last_activity_date": 1434652037, "creation_date": 1434531203, "last_edit_date": 1434535567, "question_id": 30886740, "link": "https://stackoverflow.com/questions/30886740/fold-over-a-heterogeneous-compile-time-list", "title": "Fold over a heterogeneous, compile time, list", "body": "<p>I have a list of heterogeneous types (or at least that's what I have in mind):</p>\n\n<pre><code>data Nul\n\ndata Bits b otherBits where \n    BitsLst :: b -&gt; otherBits -&gt; Bits b otherBits \n    NoMoreBits :: Bits b Nul\n</code></pre>\n\n<p>Now, given an input type <code>b</code>, I want to go through all the slabs of <code>Bits</code> with type <code>b</code> and summarize them, ignoring other slabs with type <code>b' /= b</code>:</p>\n\n<pre><code>class Monoid r =&gt; EncodeBit b r | b -&gt; r where \n    encodeBit :: b -&gt; r\n\nclass AbstractFoldable aMulti r where \n    manyFold :: r -&gt; aMulti -&gt; r\n\ninstance (EncodeBit b r, AbstractFoldable otherBits r) =&gt; \n                     AbstractFoldable (Bits b otherBits ) r where \n    manyFold r0 (BitsLst bi other) = manyFold (r0 `mappend` (encodeBit bi)) other\n    manyFold b0 NoMoreBits = b0 \n\ninstance AbstractFoldable otherBits r =&gt;\n                     AbstractFoldable (Bits nb    otherBits ) r where \n    manyFold r0 (BitsLst _ other) = manyFold r0 other\n    manyFold b0 NoMoreBits = b0 \n</code></pre>\n\n<p>But the compiler wants none of it. And with good reason, since both instance declarations have the same head. Question: what is the correct way of folding over <code>Bits</code> with an arbitrary type?</p>\n\n<p>Note: the above example is compiled with </p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, \n             FunctionalDependencies,\n             GADTs,\n             DataKinds,\n             FlexibleInstances,\n             FlexibleContexts\n#-}\n</code></pre>\n"}, {"tags": ["haskell", "ghcjs", "reflex"], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 5165951, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M47y5.jpg?s=128&g=1", "display_name": "ali", "link": "https://stackoverflow.com/users/5165951/ali"}, "is_accepted": true, "score": 5, "last_activity_date": 1438110179, "creation_date": 1438110179, "answer_id": 31685002, "question_id": 30885883, "link": "https://stackoverflow.com/questions/30885883/why-does-this-reflex-code-result-in-dynamics-firing-indefinitely-with-the-same-v/31685002#31685002", "title": "Why does this Reflex code result in Dynamics firing indefinitely with the same value?", "body": "<p>It looks like your code for listChoiceWidget is throwing away the click events constructed by dynButton.</p>\n\n<p><code>listWithKey</code> returns <code>m (Dynamic t (Map k a))</code>. In your case, the keys are of type <code>Int</code> and the values are <code>Event t ()</code> (produced by dynButton).</p>\n\n<p>On this line:</p>\n\n<pre><code>k &lt;- mapDyn (fst . head . Map.toList) evs\n</code></pre>\n\n<p>You are turning the <code>Dynamic t (Map Int (Event t ()))</code> into a <code>Dynamic t Int</code> but, crucially, you're not doing so when a click event fires. This line maps over <code>evs</code> and produces a Dynamic that will always contain the first key in the Map of Ints to Events, regardless of whether an event has fired or not. It will always be a Dynamic containing the Int 0.</p>\n\n<p>The reason you're seeing a loop is because:</p>\n\n<ol>\n<li><code>main</code> feeds <code>foo</code> with its initial value of 0 into <code>options</code></li>\n<li>new options are constructed</li>\n<li><code>listChoiceWidget</code> receives the new options and the list is updated</li>\n<li>the first key of the resultant Map of Ints to Events is updated</li>\n<li><code>foo</code> receives the key updated event from <code>listChoiceWidget</code></li>\n<li>back to step 2 ad infinitum</li>\n</ol>\n\n<p>Instead of retrieving the first key out of the Map, you need some way of determining the last button click event. Your Map already contains click events for each button displayed. Right now those events have the type <code>Event t ()</code>, but what you really need is <code>Event t Int</code>, so that when an event fires you can tell which button it came from.</p>\n\n<pre><code>evs' &lt;- mapDyn (Map.mapWithKey (\\k e -&gt; fmap (const k) e)) evs\n</code></pre>\n\n<p><code>evs'</code> has the type <code>Dynamic t (Map Int (Event t Int))</code>. Next we need some way of combining our events so that we have one event that fires with the most recently clicked button's key.</p>\n\n<pre><code>dynEv &lt;- mapDyn (leftmost . Map.elems . Map.mapWithKey (\\k e -&gt; fmap (const k) e)) evs\n</code></pre>\n\n<p><code>dynEv</code> now has the type <code>Dynamic t (Event t Int)</code>. The keys of the Map have already been baked into the events, so we don't need them anymore. <code>Map.elems</code> turns our Map of events into a list of events, and <code>leftmost</code> allows you to combine a list of events into one event.</p>\n\n<p>From the <a href=\"https://hackage.haskell.org/package/reflex-0.2/docs/Reflex-Class.html#v:leftmost\">docs</a> for <code>leftmost</code>: \"Create a new Event that occurs if at least one of the Events in the list occurs. If multiple occur at the same time they are folded from the left with the given function.\"</p>\n\n<p>Finally, we need to convert your <code>Dynamic t (Event t Int)</code> into an <code>Event t Int</code>. We're going to use <code>switch</code>, which takes a <code>Behavior t (Event t a)</code> and returns an <code>Event t a</code>. So, the following line will result in <code>Event t Int</code>.</p>\n\n<pre><code>switch (current dynEv)\n</code></pre>\n\n<p><code>current</code> extracts the <code>Behavior</code> of a <code>Dynamic</code>, and <code>switch</code> creates \"an Event that will occur whenever the currently-selected input Event occurs.\"</p>\n\n<p>Here's the revised <code>listChoiceWidget</code> code. I've included inline type annotations, so you'll need the <code>ScopedTypeVariables</code> language extension enabled to compile this code (or you can remove the annotations).</p>\n\n<pre><code>listChoiceWidget\n  :: forall t m. MonadWidget t m\n  =&gt; Dynamic t [String]\n  -&gt; m (Event t Int)\nlistChoiceWidget choices = el \"div\" $ do\n  asMap &lt;- mapDyn (Map.fromList . zip [(0::Int)..]) choices\n  evs :: Dynamic t (Map.Map Int (Event t ())) &lt;- listWithKey asMap (\\_ s -&gt; dynButton s)\n  dynEv :: Dynamic t (Event t Int) &lt;- mapDyn (leftmost . Map.elems . Map.mapWithKey (\\k e -&gt; fmap (const k) e)) evs\n  return $ switch (current dynEv)\n</code></pre>\n\n<p><a href=\"https://gist.github.com/xionite/ac0604f5a458e48aee62\">Here's a gist of the complete file.</a></p>\n"}], "owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 2, "accepted_answer_id": 31685002, "answer_count": 1, "score": 5, "last_activity_date": 1438110179, "creation_date": 1434528845, "question_id": 30885883, "link": "https://stackoverflow.com/questions/30885883/why-does-this-reflex-code-result-in-dynamics-firing-indefinitely-with-the-same-v", "title": "Why does this Reflex code result in Dynamics firing indefinitely with the same value?", "body": "<p>The intent of this small program is to show three buttons, with the third button's label initially being \"0\" and afterwards being the index of the last-clicked button. For now the number of buttons and the labels of the other buttons are constant.</p>\n\n<p>When I compile this self-contained file with ghcjs and load Main.jsexe/index.html in the browser, I can see the two traceDyns firing in a loop, both always having the value 0. As far as I understand, nothing should happen until a button is clicked, because the _el_clicked feeds the rest of the system.</p>\n\n<p>Also, note that I'm using <code>mapDyn (fst . head . Map.toList)</code> in order to extract the index of the selected button - I'm not sure this is correct, but either way I don't know what causes the infinite looping.</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n\nmodule Main where\n\nimport Reflex\nimport Reflex.Dom\n\nimport qualified Data.Map as Map\n\ndynButton\n  :: MonadWidget t m\n  =&gt; Dynamic t String\n  -&gt; m (Event t ())\ndynButton s = do\n  (e, _) &lt;- el' \"button\" $ dynText s\n  return $ _el_clicked e\n\n-- widget that takes dynamic list of strings\n-- and displays a button for each, returning\n-- an event of chosen button's index\nlistChoiceWidget\n  :: MonadWidget t m\n  =&gt; Dynamic t [String]\n  -&gt; m (Event t Int)\nlistChoiceWidget choices = el \"div\" $ do\n  asMap &lt;- mapDyn (Map.fromList . zip [(0::Int)..]) choices\n  evs &lt;- listWithKey asMap (\\_ s -&gt; dynButton s)\n  k &lt;- mapDyn (fst . head . Map.toList) evs\n  return $ updated (traceDyn \"k\" k)\n\noptions :: MonadWidget t m =&gt; Dynamic t Int -&gt; m (Dynamic t [String])\noptions foo = do\n  mapDyn (\\x -&gt; [\"a\", \"b\", show x]) foo\n\nmain :: IO ()\nmain = mainWidget $ el \"div\" $ do\n  rec n &lt;- listChoiceWidget o\n      o &lt;- options foo\n      foo &lt;- holdDyn 0 n\n  display (traceDyn \"foo\" foo)\n</code></pre>\n"}, {"tags": ["c++", "c", "haskell", "erlang", "snmp"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1434529305, "post_id": 30885833, "comment_id": 49811981, "body": "As much as I like to advertise Haskell \u2013 in a performance-related context it should always be noted that the language, due to lazyness, doesn&#39;t make it easy to get reliable performance. You <i>can</i> get very good performance if you know the language, even without too ugly manual optimisations. You can also make it parallel/concurrent very easily, and be pretty safe from all the risks this incurs in imperative language. But you can also easily end up with space leaks etc. if some list isn&#39;t evaluated strictly enough and piles up lazy thunks."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1434532494, "post_id": 30885833, "comment_id": 49814127, "body": "@leftaroundabout True enough. The actual SNMP stuff is all going to be I/O; I guess it depends what you plan on doing with the results. (E.g., if you&#39;re just trying to poll everything and suck it into a database, it&#39;s probably fine...)"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1564048761, "last_edit_date": 1564048761, "creation_date": 1434528687, "answer_id": 30885833, "question_id": 30884995, "link": "https://stackoverflow.com/questions/30884995/which-language-and-lib-is-better-suited-for-high-performant-network-devices-poll/30885833#30885833", "title": "Which language and lib is better suited for high-performant network devices polling server (SNMP)?", "body": "<p>As a scripting language, I'd expect Python to be fairly slow.</p>\n\n<p>C or C++ ought to be about as performant as you can get. C# or Java probably aren't bad. Erlang should be reasonable. GHC compiles Haskell to native machine code, so it ought to be fairly fast. In the end, this is going to come down to which library do you like the look of the most.</p>\n\n<p>I have no idea what SNMP is or what it does. But I found <a href=\"http://hackage.haskell.org/package/NetSNMP\" rel=\"nofollow noreferrer\">a Haskell library for SNMP</a>. According to the documentation, a trivial SNMP client might look something like this:</p>\n\n<pre><code>import Network.Protocol.Snmp\nimport Control.Applicative\nimport Network.Socket.ByteString (recv, sendAll)\nimport Network.Socket hiding (recv, sendAll)\n\n-- create new empty packet\nv2 :: Packet\nv2 = initial Version2\n\ncommunity = Community \"hello\"\n\noi = Coupla [1,3,6,1,2,1,1,4,0] Zero\n\n-- set community, oid\npacket :: Community -&gt; Coupla -&gt; Packet\npacket community oi = \n  setCommunityP community . setSuite (Suite [oi]) $ v2\n\n-- here must be code for create udp socket\nmakeSocket :: Hostname -&gt; Port -&gt; IO Socket\nmakeSocket = undefined\n\nmain :: IO ()\nmain = do\n   socket &lt;- makeSocket \"localhost\" \"161\"\n   sendAll socket $ encode $ setRequest (GetRequest 1 0 0) packet\n   result &lt;- decode &lt;$&gt; recv socket 1500 :: IO Packet\n   print $ getSuite result \n</code></pre>\n\n<p>If that looks OK to you, go knock yourself out...</p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "edited": false, "score": 0, "creation_date": 1434612384, "post_id": 30896305, "comment_id": 49855796, "body": "Thanks! I know Erlang has full SNMP support. Even SMI is fully supported. The thing is I need some simple polling server service which can poll 1000 hosts in 5-10 seconds on Core2Duo without much CPU load (so as fast as possible)."}, {"owner": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "edited": false, "score": 0, "creation_date": 1434614248, "post_id": 30896305, "comment_id": 49856919, "body": "Well, I said poll 1000 hosts in 5-10 seconds but didn&#39;t provide any other info. Let&#39;s assume it&#39;s ideal local network with FastEthernet links. So infrastructure is good enough to handle the load. The problem is enc/dec and response processing should be fast enough. Erlang seems a better option due to it&#39;s full SNMP support, reliability and scalability (if I get it right, I can balance the load on more than one machine without much code changes). But how fast is it?  Let aside user (my) code."}, {"owner": {"reputation": 25491, "user_id": 49197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15ebf24a33a29b9efbf9924f530dd736?s=128&d=identicon&r=PG", "display_name": "Hynek -Pichi- Vychodil", "link": "https://stackoverflow.com/users/49197/hynek-pichi-vychodil"}, "reply_to_user": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "edited": false, "score": 0, "creation_date": 1434615665, "post_id": 30896305, "comment_id": 49857715, "body": "1000 hosts in 5s are 200 in 1s. It is 100 hosts pers second and core. Just check the speed of encoding and decoding and you should have a basic idea if it is viable. It is way how to decide if there can be any problem in this particular regard of encoding and decoding. If you find all encoding and decoding load for one host is far less than 10ms, you can worry about the rest which usually is less problem in Erlang."}], "tags": [], "owner": {"reputation": 25491, "user_id": 49197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/15ebf24a33a29b9efbf9924f530dd736?s=128&d=identicon&r=PG", "display_name": "Hynek -Pichi- Vychodil", "link": "https://stackoverflow.com/users/49197/hynek-pichi-vychodil"}, "is_accepted": true, "score": 3, "last_activity_date": 1434556884, "last_edit_date": 1434556884, "creation_date": 1434555774, "answer_id": 30896305, "question_id": 30884995, "link": "https://stackoverflow.com/questions/30884995/which-language-and-lib-is-better-suited-for-high-performant-network-devices-poll/30896305#30896305", "title": "Which language and lib is better suited for high-performant network devices polling server (SNMP)?", "body": "<p>Erlang support for SNMP in OTP distribution as application <a href=\"http://www.erlang.org/doc/apps/snmp/index.html\" rel=\"nofollow\"><code>snmp</code></a>. It means it is stable, matured and battle tested in a corporate environment. It <a href=\"http://www.erlang.org/doc/apps/snmp/snmp_intro.html\" rel=\"nofollow\">supports</a>:</p>\n\n<blockquote>\n  <p>The SNMP development toolkit contains the following parts:</p>\n  \n  <ul>\n  <li>An Extensible multi-lingual SNMP agent, which understands SNMPv1\n  (RFC1157), SNMPv2c (RFC1901, 1905, 1906 and 1907), SNMPv3 (RFC2271,\n  2272, 2273, 2274 and 2275), or any combination of these protocols.</li>\n  <li>A multi-lingual SNMP manager.</li>\n  <li>A MIB compiler, which understands SMIv1\n  (RFC1155, 1212, and 1215) and SMIv2 (RFC1902, 1903, and 1904).</li>\n  </ul>\n</blockquote>\n\n<p>From the point of language, Erlang is strict but dynamically typed functional language with strict evaluation and embedded concurrency (actor based) and strong reliability support. (You can think about is as DSL for writing reliable clustered services.) Erlang compile to bytecode or native (but not as efficient as Haskell) and runs in own VM BEAM. The Haskell is strict and static typed functional with lazy evaluation and no embedded support for concurrency and reliability, but there are solutions in modules. In my personal opinion, Erlang is much smaller language and simpler to learn for somebody going from an imperative language.</p>\n\n<p>Erlang is often not recognized for its speed, but there are real-world applications where Erlang outperforms Java, C++ or C# solutions especially under concurrent load. There is even a <a href=\"http://www.erlang.org/workshop/2003/paper/p1-nystrom.pdf\" rel=\"nofollow\">study</a> comparing real C++ application with Erlang counterpart. The result is really surprising.</p>\n\n<p>I personally would choose Erlang ower Haskell. There is one major catch, for writing corporate grade solution the <a href=\"http://www.erlang.org/doc/design_principles/users_guide.html\" rel=\"nofollow\">OTP</a> is must. Where Erlang as language is small and easy, the OTP is much harder but concurrency and reliability are hard itself and OTP makes it actually easier.</p>\n\n<p>As last remark, there is always possible rewrite time critical parts from Erlang to C or C++ as native implemented functions (NIF) and I found it surprisingly easy in comparison with my previous experience with writing similar functions for Perl or Python.</p>\n"}], "owner": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 936, "favorite_count": 0, "closed_date": 1435046239, "accepted_answer_id": 30896305, "answer_count": 2, "score": 2, "last_activity_date": 1564048761, "creation_date": 1434526156, "last_edit_date": 1434526551, "question_id": 30884995, "link": "https://stackoverflow.com/questions/30884995/which-language-and-lib-is-better-suited-for-high-performant-network-devices-poll", "closed_reason": "Not suitable for this site", "title": "Which language and lib is better suited for high-performant network devices polling server (SNMP)?", "body": "<p>I'm working on network devices monitoring solution at work. Prototype is written on Python using PySNMP which is awfully slow and stresses CPU a lot with small amount of devices being monitored. So I thought of making some small high-performance SNMP polling server to get rid of PySnmp and split the program in two (data provider and data analyser/decision maker).</p>\n\n<p>Net-SNMP is not a good choice for SNMPv3 (not thread-safe, not fully async due to synchronous engineID discovery, which is slow if device is not responding) and I don't like SNMP++, so I decided to try writing this server on other languages. Java is not an option (no JVM), so in the end it's Erlang or Haskell (I don't know both of them..). Erlang does have built-in SNMP support, but I don't need process/machine distribution.</p>\n\n<p>So could you please recommend which lang and snmp protocol (manager) implementation is better suited for the task?\nRequirements:</p>\n\n<ul>\n<li>high performance (small CPU usage),</li>\n<li>stability,</li>\n<li>high concurrency (a lot of simultaneous polls),</li>\n<li>non-blocking requests,</li>\n<li>full Snmp V1, V2C and V3 support.</li>\n</ul>\n"}, {"tags": ["haskell", "concurrency", "network-programming"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1434508354, "post_id": 30881229, "comment_id": 49803624, "body": "I don&#39;t think most people will want to search through so much code to find this bug. Perhaps writing some tests will help you find it."}, {"owner": {"reputation": 323, "user_id": 3105639, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/100005543680545/picture?type=large", "display_name": "Mattiemus", "link": "https://stackoverflow.com/users/3105639/mattiemus"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434508963, "post_id": 30881229, "comment_id": 49803762, "body": "I have modified the question to further pin down the problem to 4 main functions. What sort of tests would I need to write to isolate this problem, the problem seems to eventually occur regardless of weather i remove all modifiers over the either the server or events MVar, leading me to believe I am somehow using them incorrectly.  There are multiple producers over the events MVar (one thread for each client) however only a single consumer - maybe this is the issue?"}, {"owner": {"reputation": 7985, "user_id": 475100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Ozk6.jpg?s=128&g=1", "display_name": "Chris Kuklewicz", "link": "https://stackoverflow.com/users/475100/chris-kuklewicz"}, "edited": false, "score": 0, "creation_date": 1434531795, "post_id": 30881229, "comment_id": 49813652, "body": "In <code>sense</code> you are using an <code>MVar</code> very much like a channel.  Why not use a <code>Chan</code> instead?"}, {"owner": {"reputation": 7985, "user_id": 475100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Ozk6.jpg?s=128&g=1", "display_name": "Chris Kuklewicz", "link": "https://stackoverflow.com/users/475100/chris-kuklewicz"}, "edited": false, "score": 0, "creation_date": 1434531949, "post_id": 30881229, "comment_id": 49813750, "body": "<code>modifyMVar</code> and <code>withMVar</code> are safe.  I do not see <code>swapMVar</code> used, which is unsafe, is it used elsewhere?"}, {"owner": {"reputation": 323, "user_id": 3105639, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/100005543680545/picture?type=large", "display_name": "Mattiemus", "link": "https://stackoverflow.com/users/3105639/mattiemus"}, "reply_to_user": {"reputation": 7985, "user_id": 475100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Ozk6.jpg?s=128&g=1", "display_name": "Chris Kuklewicz", "link": "https://stackoverflow.com/users/475100/chris-kuklewicz"}, "edited": false, "score": 0, "creation_date": 1434553973, "post_id": 30881229, "comment_id": 49830306, "body": "@ChrisKuklewicz <code>swapMVar</code> was removed in favor of using modifyMVar_ due to this problem, however the core issue still persists. I dont use <code>Chan</code> because I dont want to block while the channel is empty, I want to use it as if there is simply an empty list of events. See <code>popAllMVar</code> in Concurrency.hs"}], "answers": [{"comments": [{"owner": {"reputation": 7985, "user_id": 475100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Ozk6.jpg?s=128&g=1", "display_name": "Chris Kuklewicz", "link": "https://stackoverflow.com/users/475100/chris-kuklewicz"}, "edited": false, "score": 1, "creation_date": 1434532070, "post_id": 30882371, "comment_id": 49813830, "body": "The &quot;blocks...forever&quot; can only trigger this exception if GHC runtime can prove it is blocked forever.  Can the network ops lead to this?"}, {"owner": {"reputation": 323, "user_id": 3105639, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/100005543680545/picture?type=large", "display_name": "Mattiemus", "link": "https://stackoverflow.com/users/3105639/mattiemus"}, "edited": false, "score": 0, "creation_date": 1434553712, "post_id": 30882371, "comment_id": 49830118, "body": "@sclv If you are pointing at the broadcast/sendTo/sendToExcept functions, then moving the network operations outside of the withMVar does not rectify the problem: the deadlock persists."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 2, "last_activity_date": 1434515490, "creation_date": 1434515490, "answer_id": 30882371, "question_id": 30881229, "link": "https://stackoverflow.com/questions/30881229/thread-blocked-indefinitely-in-an-mvar-operation/30882371#30882371", "title": "Thread blocked indefinitely in an MVar operation", "body": "<p>I think I see the problem -- it is in Server.hs. You have operations that do network IO inside a <code>withMVar</code> call. Now imagine that IO blocks effectively forever. You neither get an exception that forces the var to be replaced, nor does the operation complete normally and replace the var, and hence you get stuck.</p>\n\n<p>In general, you should not do any significant operations in a <code>withMVar</code> call, even though you <em>can</em>. And if you do any such operations, you need to be double-sure that you effectively guard them with timeouts, etc. such that you are sure they always complete one way or another.</p>\n"}, {"tags": [], "owner": {"reputation": 323, "user_id": 3105639, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/100005543680545/picture?type=large", "display_name": "Mattiemus", "link": "https://stackoverflow.com/users/3105639/mattiemus"}, "is_accepted": true, "score": 4, "last_activity_date": 1434595306, "creation_date": 1434595306, "answer_id": 30905638, "question_id": 30881229, "link": "https://stackoverflow.com/questions/30881229/thread-blocked-indefinitely-in-an-mvar-operation/30905638#30905638", "title": "Thread blocked indefinitely in an MVar operation", "body": "<p>Three days later and its solved: Was actually unrelated to either the networking or concurrency code, and infact caused by my incorrect re-implementation of Yampas <code>dpSwitch</code> in Netwire. Corrected code posted below for anyone wishing to implement this function:</p>\n\n<pre><code>dpSwitch :: (Monoid e, Applicative m, Monad m, T.Traversable col) =&gt; (forall wire. a -&gt; col wire -&gt; col (b, wire))\n     -&gt; col (Wire s e m b c)\n     -&gt; Wire s e m (a, col c) (Event d)\n     -&gt; (col (Wire s e m b c) -&gt; d -&gt; Wire s e m a (col c))\n     -&gt; Wire s e m a (col c)\ndpSwitch route wireCol switchEvtGen continuation = WGen $ gen wireCol switchEvtGen\nwhere\n    gen wires switchEvtGenWire _ (Left x) = return (Left mempty, WGen $ gen wires switchEvtGenWire)\n    gen wires switchEvtGenWire ws (Right x) = do            \n        let routings = route x wires\n        wireSteps &lt;- T.sequenceA (fmap (\\(wireInput, wire) -&gt; stepWire wire ws (Right wireInput)) routings)\n        let wireOutputs = T.sequenceA (fmap fst wireSteps)\n            steppedWires = fmap snd wireSteps\n        case wireOutputs of\n            Left wireInhibitedOutput -&gt; return (Left wireInhibitedOutput, WGen $ gen steppedWires switchEvtGenWire)\n            Right wireResultOutput -&gt; do\n                (event, steppedSwitchEvtGenWire) &lt;- stepWire switchEvtGenWire ws (Right (x, wireResultOutput))\n                case event of\n                    Left eventInhibited -&gt; return (Left eventInhibited, WGen $ gen steppedWires steppedSwitchEvtGenWire)\n                    Right NoEvent -&gt; return (wireOutputs, WGen $ gen steppedWires steppedSwitchEvtGenWire)\n                    Right (Event e) -&gt; return (wireOutputs, continuation steppedWires e)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 4, "last_activity_date": 1582749895, "last_edit_date": 1582749895, "creation_date": 1434606497, "answer_id": 30907386, "question_id": 30881229, "link": "https://stackoverflow.com/questions/30881229/thread-blocked-indefinitely-in-an-mvar-operation/30907386#30907386", "title": "Thread blocked indefinitely in an MVar operation", "body": "<p>For anyone who might stumble on this, some additional information <code>thread blocked indefinitely in an MVar operation</code> is not really that smart.  It happens when every thread that contains a reference to the MVar is trying to read (or write) to that location, has died, or is waiting on another primitive that is blocked forever. eg thread 1 is trying to read MVar <code>a</code> and waiting on thread 2 which is either dead, also trying to read MVar <code>a</code>, or trying to read MVar <code>b</code> which can only be written to in thread 1.</p>\n\n<p>The following code happily hangs forever:</p>\n\n<pre><code>do\n  a &lt;- newEmptyMVar\n  forkIO (readMVar a &gt;&gt;= print)\n  putMVar a $ last $ repeat 0\n</code></pre>\n"}], "owner": {"reputation": 323, "user_id": 3105639, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/100005543680545/picture?type=large", "display_name": "Mattiemus", "link": "https://stackoverflow.com/users/3105639/mattiemus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2351, "favorite_count": 0, "accepted_answer_id": 30905638, "answer_count": 3, "score": 10, "last_activity_date": 1582749895, "creation_date": 1434507252, "last_edit_date": 1434553634, "question_id": 30881229, "link": "https://stackoverflow.com/questions/30881229/thread-blocked-indefinitely-in-an-mvar-operation", "title": "Thread blocked indefinitely in an MVar operation", "body": "<p>I have been attempting to debug a problem when using multiple MVars, however to no luck.</p>\n\n<p>My code uses two MVars: one to store the servers current state, and another to pass network events to and from the client threads. However after connecting and disconnecting several times, the server stops sending data upon new clients connecting (presumably because the network events MVar is emptied for whatever reason) and eventually trips up with the error:  <code>*** Exception: thread blocked indefinitely in an MVar operation</code></p>\n\n<p>I have concluded the following in trying to debug this issue over the last few days:</p>\n\n<ol>\n<li>The functions used to modify the MVar(s) wont throw exceptions</li>\n<li>The problem does not occur until a client either connects, or connects then disconnects</li>\n<li>The issue seems to occur randomly (sometimes several clients can connect then disconnect, other times it happens right away)</li>\n</ol>\n\n<p>I have isolated the problem to three files:</p>\n\n<ol>\n<li><a href=\"https://github.com/Mattiemus/IMC-Server/blob/master/IMC.hs\" rel=\"noreferrer\">https://github.com/Mattiemus/IMC-Server/blob/master/IMC.hs</a> (the exception gets thrown in <code>sense</code>)</li>\n<li><a href=\"https://github.com/Mattiemus/IMC-Server/blob/master/IMC/Networking/Server.hs\" rel=\"noreferrer\">https://github.com/Mattiemus/IMC-Server/blob/master/IMC/Networking/Server.hs</a> (Modifined within <code>application</code> <code>handleClient</code>, and <code>cleanupClient</code>)</li>\n<li><a href=\"https://github.com/Mattiemus/IMC-Server/blob/master/IMC/Utilities/Concurrency.hs\" rel=\"noreferrer\">https://github.com/Mattiemus/IMC-Server/blob/master/IMC/Utilities/Concurrency.hs</a> (functions which push and pop to a list stored in an MVar)</li>\n</ol>\n\n<p>I am totally out of ideas, as I  only use modifyMVar and withMVar (so surely it should never be totally left empty) - my only assumption is that maybe an Exception is being thrown while modifying the MVar, however I think this is highly unlikely.</p>\n\n<p>Any help is appreciated, this problem has been bugging me for some time now.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 4, "creation_date": 1434498898, "post_id": 30880087, "comment_id": 49801241, "body": "You should state the &quot;fault&quot; in the question. One problem that immediately jumps out a &quot;pattern match failed&quot; for the case of nested expressions such as <code>(Operation OR (Operation AND (Lit True) (Lit False)) (Lit False))</code>."}], "answers": [{"comments": [{"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "edited": false, "score": 0, "creation_date": 1434501388, "post_id": 30880284, "comment_id": 49801882, "body": "but what if I also needed to be able to handle NOT which only takes 1 argument?"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1434543219, "last_edit_date": 1434543219, "creation_date": 1434499708, "answer_id": 30880284, "question_id": 30880087, "link": "https://stackoverflow.com/questions/30880087/logical-expression-evaluator-haskell/30880284#30880284", "title": "logical expression evaluator Haskell", "body": "<p>You're making <code>eval</code> a bit too low-level. By including <code>Literal</code>s in the signature. A better way to do this is, is using recursion:</p>\n\n<pre><code>eval :: Expression -&gt; Bool\neval (Literal x) = x\neval (Operation AND x y) = (eval x) &amp;&amp; (eval y)\neval (Operation OR x y) = (eval x) || (eval y)\n</code></pre>\n\n<p>In other words call <code>eval</code> on the <em>right-hand-side</em>. In case it is a <code>Literal</code>, it will immediately resolve to the correct value, in case it is a cascaded expression, it will resolve that <code>Operation _ _ _</code> as well.</p>\n\n<p>In general it is not advisable to start cascaded pattern matching (ok, sometimes it is useful). In that case you should at least ask yourself if there is no more elegant solution.</p>\n\n<p>This piece of code easily shows that the function is <em>total</em> (regardless of the input, it will always generate a result). That's not the case for your code. Always try to perform a <em>totality-check</em>.</p>\n\n<h1>Edit</h1>\n\n<p>In case the number of <code>Operation</code>s will increase significantly, you better separate concerns into a <code>handler :: Operation -&gt; Bool -&gt; Bool -&gt; Bool</code> function and the <code>eval</code> function. Something like:</p>\n\n<pre><code>data Expression = Literal Bool | Operation Operator Expression Expression\ndata Operator = AND | OR | XOR\n\nhandler :: Operation -&gt; Bool -&gt; Bool -&gt; Bool\nhandler AND = (&amp;&amp;)\nhandler OR = (||)\nhandler XOR = xor\n    where xor True False = True\n          xor False True = True\n          xor _ _ = False\n\neval :: Expression -&gt; Bool\neval (Literal x) = x\neval (Operation o x y) = (handler o) (eval x) (eval y)\n</code></pre>\n\n<hr>\n\n<p>In case you need to handle a <code>NOT</code>, that's another type of expression:</p>\n\n<pre><code>data Expression = Literal Bool | Operation Operator Expression Expression | OperationU OperatorU Expression\n</code></pre>\n\n<p><code>OperatorU</code> is here an unary operator. For instance:</p>\n\n<pre><code>data OperatorU = ID | NOT\n</code></pre>\n\n<p>with <code>ID</code> the identity. Now in that case you can define a second handler:</p>\n\n<pre><code>handlerU :: OperatorU -&gt; Bool -&gt; Bool\nhandlerU ID = id\nhandlerU NOT = not\n</code></pre>\n\n<p>and then <code>eval</code> reads:</p>\n\n<pre><code>eval :: Expression -&gt; Bool\neval (Literal x) = x\neval (Operation o x y) = (handler o) (eval x) (eval y)\neval (OperationU o x) = (handlerU o) (eval x)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1434571678, "last_edit_date": 1495542139, "creation_date": 1434570375, "answer_id": 30901008, "question_id": 30880087, "link": "https://stackoverflow.com/questions/30880087/logical-expression-evaluator-haskell/30901008#30901008", "title": "logical expression evaluator Haskell", "body": "<p>Excellent answer by CommuSoft.  I'm going to riff on that and go a bit more high-level/philosophical.  </p>\n\n<p>One key guideline to follow in designing languages and interpreters for them is the <a href=\"https://en.wikipedia.org/wiki/Principle_of_compositionality\" rel=\"nofollow noreferrer\">principle of compositionality</a>:</p>\n\n<ul>\n<li>The meaning of a complex expression should be a function of the meaning of its parts and their manner of combination.</li>\n</ul>\n\n<p>In this case, the \"meanings\" are the <code>Bool</code>s that the expressions evaluate to.  Applied to your evaluator, what compositionality means is:</p>\n\n<ul>\n<li>Your evaluator should only look at the <em>meanings</em> (<code>Bool</code> evaluation results) of subexpressions, never their <em>syntax</em>.</li>\n</ul>\n\n<p>This equation of your <code>eval</code> violates that rule, because it \"peeks\" inside the subexpressions to examine whether the <code>Literal</code> constructor is there:</p>\n\n<pre><code>eval (Operation AND (Literal x) (Literal y))\n | x == True &amp;&amp; y == True           = True\n | otherwise                        = False\n</code></pre>\n\n<p>One useful trick to make sure you're doing things compositionally is this:</p>\n\n<ol>\n<li>Write a generic fold function over the syntax tree type.  (See <a href=\"https://stackoverflow.com/questions/16426463/what-constitutes-a-fold-for-types-other-than-list\">this question</a> for some guidance on this concept.)</li>\n<li>Write your evaluator in terms of that fold function.</li>\n</ol>\n\n<p>In this case:</p>\n\n<pre><code>data Expression = Literal Bool | Operation Operator Expression Expression\ndata Operator = AND | OR\n\nfoldExpression :: (Bool -&gt; r) -&gt; (Operator -&gt; r -&gt; r -&gt; r) -&gt; r\nfoldExpression f _ (Literal x) = f x\nfoldExpression f g (Operation op l r) = g op (subfold l) (subfold r)\n    where subfold = foldExpression f g \n</code></pre>\n\n<p>The trick is that when you use <code>foldExpression</code> it prevents you from seeing the constructors of nodes below the current expression, so you are forced to work in in terms of the result type <code>r</code>.  So here goes:</p>\n\n<pre><code>eval :: Expression -&gt; Bool\neval = foldExpression evalLiteral evalOperation\n    where \n      -- A literal just evals to the `Bool` it carries.\n      evalLiteral :: Bool -&gt; Bool\n      evalLiteral b = b\n\n      evalOperation :: Operator -&gt; Bool -&gt; Bool -&gt; Bool\n\n      -- An `AND` operation evaluates to the `&amp;&amp;` of its subexpressions' values\n      evalOperation (AND l r) = l &amp;&amp; r\n\n      -- An `OR` operation evaluates to the `||` of its subexpressions' values\n      evalOperation (OR l r) = l || r\n</code></pre>\n\n<p>And note how <code>evalOperation</code> is the same thing as CommuSoft's <code>handler</code> function.  This just fell out naturally from writing  the solution as a fold.</p>\n\n<hr>\n\n<p>A bit more worked out, including unary operations and understandability-at-scale:</p>\n\n<pre><code>data Unary = Not\ndata Binary = And | Or | If\ndata Expr = Lit Bool | Expr1 Unary Expr | Expr2 Binary Expr Expr\n\n-- Package all the functions used in a fold into a record\n-- so that we don't need to remember the argument order.\n-- For complex tree types with many types of nodes you will \n-- want this!\ndata ExprFold r \n    = ExprFold { literal :: Bool -&gt; r\n               , unary :: Unary -&gt; r -&gt; r\n               , binary :: Binary -&gt; r -&gt; r -&gt; r\n               }\n\nfoldExpr :: ExprFold r -&gt; Expr -&gt; r\nfoldExpr f (Lit b) = literal f b\nfoldExpr f (Expr1 e) = unary f (foldExpr f e)\nfoldExpr f (Expr2 e e') = binary f (foldExpr f e) (foldExpr f e')\n\nevaluator :: ExprFold Bool\nevaluator = ExprFold { literal = evalLit\n                     , unary = evalExpr1\n                     , binary = evalExpr2 }\n    where \n      evalLit b = b\n      evalExpr1 (Not b) = not b\n      evalExpr2 (And b b') = b &amp;&amp; b'\n      evalExpr2 (Or b b') = b || b'\n      evalExpr2 (If b b') = not b || b'\n</code></pre>\n"}], "owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1635, "favorite_count": 0, "accepted_answer_id": 30880284, "answer_count": 2, "score": 2, "last_activity_date": 1434571678, "creation_date": 1434498342, "last_edit_date": 1434542877, "question_id": 30880087, "link": "https://stackoverflow.com/questions/30880087/logical-expression-evaluator-haskell", "title": "logical expression evaluator Haskell", "body": "<p>I wrote the following logical expression evaluator. It works for simple 2-member expressions, and it runs but produces a fault for expression containing other expressions as the second/first member. Here's my code.</p>\n\n<pre><code>data Expression = Literal Bool | Operation Operator Expression Expression\ndata Operator = AND | OR\n\neval :: Expression -&gt; Bool\neval (Literal x)                    = x\neval (Operation AND (Literal x) (Literal y))\n | x == True &amp;&amp; y == True           = True\n | otherwise                        = False\neval (Operation OR (Literal x) (Literal y))\n | x == False &amp;&amp; y == False         = False\n | otherwise                        = True\n</code></pre>\n\n<p>It works correctly when called with this input:</p>\n\n<pre><code>main = do\nprint $ eval (Operation OR (Literal False) (Literal False))\n</code></pre>\n\n<p>But produces an error when called with this input:</p>\n\n<pre><code>main = do\nprint $ eval( Operation OR (Literal True) (Operation AND (Literal True) (Literal False)) )\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1434494482, "post_id": 30879442, "comment_id": 49799861, "body": "Simple solution: <code>linCongGen seed = let x = ((2*seed) + 3) `mod` 100 in x : linCongGen x</code>, with <code>linCongGen :: Int -&gt; [Int]</code> then since Haskell is lazy, everytime you need the next number, you can get it from the head of the list. The correct solution would use a state monad though... No easy way out - you are asking for a function that returns different output even if you give it the same input."}, {"owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1434494639, "post_id": 30879442, "comment_id": 49799923, "body": "thta is exactly what I am asking, yes. A function that returns different output with same input every time. You got it."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1434494836, "post_id": 30879442, "comment_id": 49799999, "body": "Haskell doesn&#39;t let you do that. That is the point of functions in Haskell - they always return the same output given the same input. You can tiptoe around the problem using a state monad."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1434515279, "post_id": 30879442, "comment_id": 49805327, "body": "@Alec: no need to use direct recursion: <a href=\"https://hackage.haskell.org/package/base/docs/Data-List.html#v:iterate\" rel=\"nofollow noreferrer\"><code>iterate</code></a> is exactly for this pattern in your comment."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1434571847, "creation_date": 1434571847, "answer_id": 30901461, "question_id": 30879442, "link": "https://stackoverflow.com/questions/30879442/linear-congruent-generator-in-haskell/30901461#30901461", "title": "linear congruent generator in haskell", "body": "<p>I'll summarize the comments a bit more meaningfully. The simplest solution is, like you observed, an infinite list of the sequence of generated elements. Then, every time you want to get a new number, pop off the head of that list.</p>\n\n<pre><code>linCongGen :: Integral a =&gt; a -&gt; [a]\nlinCongGen = iterate $ \\x -&gt; ((2*x) + 3) `mod` 100\n</code></pre>\n\n<p>That said, here is a solution (which I do not agree with), but which does what I think you want. For mutable state, we usually use <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-IORef.html\" rel=\"nofollow\"><code>IORef</code></a>, which is sort of like a reference or pointer. Here is the code. Please read the disclaimer afterwards though.</p>\n\n<pre><code>import Data.IORef\nimport System.IO.Unsafe\n\nseed :: IORef Int\nseed = unsafePerformIO $ newIORef 71\n\nlinCongGen :: IO Int\nlinCongGen = do previous &lt;- readIORef seed\n                modifyIORef' seed $ \\x -&gt; ((2*x) + 3) `mod` 100\n                return previous\n</code></pre>\n\n<p>And here is a sample usage printing out the first hundred numbers generated: <code>main = replicateM_ 100 $ getRandom &gt;&gt;= print</code> (you'll need to have <code>Control.Monad</code> imported too for <code>replicateM_</code>).</p>\n\n<h3>DISCLAIMER</h3>\n\n<p>This is a bit of a hacky approach described <a href=\"https://wiki.haskell.org/Top_level_mutable_state\" rel=\"nofollow\">here</a>. As the link says \"Maybe the need for global mutable state is a symptom of bad design.\" The link also has a good description of a more intelligent workaround. Making an <code>IORef</code> is an inherently <code>IO</code> operation, and we really shouldn't be using <code>unsafePerformIO</code> on it. If you find yourself fighting Haskell in this way, it's because Haskell was designed to get in your way when you are doing things you shouldn't.</p>\n\n<p>That said, I find comfort in knowing that this approach is also the one using in <a href=\"https://hackage.haskell.org/package/random-1.0.0.3/docs/System-Random.html\" rel=\"nofollow\">System.Random</a> (the standard random number module) to define the initial seed (<a href=\"https://hackage.haskell.org/package/random-1.0.0.3/docs/src/System-Random.html#theStdGen\" rel=\"nofollow\">check out the source</a>). </p>\n"}], "owner": {"reputation": 837, "user_id": 4072022, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b8d2b1ab1299eb31efacc0843964517?s=128&d=identicon&r=PG&f=1", "display_name": "Rumen Hristov", "link": "https://stackoverflow.com/users/4072022/rumen-hristov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1434571847, "creation_date": 1434494209, "question_id": 30879442, "link": "https://stackoverflow.com/questions/30879442/linear-congruent-generator-in-haskell", "title": "linear congruent generator in haskell", "body": "<p>This is a very simple linear-congruent pseudo-random number generator. It works fine when I seed it, but I want to make it so that it self-seeds with every produced number. Problem is that I don't know how to do that in Haskell where the notion of variables does not exist. I can feed the produced number recursively, but then my result would be a list of integers instead of a single number.</p>\n\n<pre><code>linCongGen :: Int -&gt; Int\nlinCongGen seed = ((2*seed) + 3) `mod` 100\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "bind"], "comments": [{"owner": {"reputation": 2568, "user_id": 1235982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a6bc519c83ff9d8bd541271deb459bd?s=128&d=identicon&r=PG", "display_name": "mehtunguh", "link": "https://stackoverflow.com/users/1235982/mehtunguh"}, "edited": false, "score": 0, "creation_date": 1434487739, "post_id": 30877696, "comment_id": 49796789, "body": "what is the expected behavior when one argument is shorter than the others? Did you intend the input to be <code>[[1,2,3], [4,5,6], [7,8,9]]</code> ? Or maybe just a typo?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1434489314, "post_id": 30877696, "comment_id": 49797642, "body": "The problem is that it is not certain that all the elements in a list have a head, the empty array <code>[]</code> for instance hasn&#39;t. <code>&lt;-</code> does more than simply matching, it filters as well."}, {"owner": {"reputation": 133, "user_id": 3556115, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/84298ecd37f0fe0dc7580eb481f6a263?s=128&d=identicon&r=PG&f=1", "display_name": "user3556115", "link": "https://stackoverflow.com/users/3556115/user3556115"}, "edited": false, "score": 0, "creation_date": 1434528492, "post_id": 30877696, "comment_id": 49811468, "body": "The input is right the way it is. The list shorter than the others shall be left out, simply not taken in the result. Better said when there are no more elements to take into the resulting listlist, then the empty list shall be appended, or better, nothing to be done."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1434492213, "last_edit_date": 1434492213, "creation_date": 1434490233, "answer_id": 30878586, "question_id": 30877696, "link": "https://stackoverflow.com/questions/30877696/haskell-pattern-match-error-with-bind-operator/30878586#30878586", "title": "Haskell pattern match error with bind operator", "body": "<p>There are a few problems with this approach:</p>\n\n<ul>\n<li><p>The signature of <code>transheadA</code> should be different than the one for <code>transtailA</code>.</p>\n\n<pre><code>transheadA :: [[a]] -&gt; [a]\ntranstailA :: [[a]] -&gt; [[a]]\n</code></pre></li>\n<li><p>Since you do some pattern matching in the list comprehension, you cannot simply use this in the lambda expression: it is possible the pattern fails in which case that part of the list comprehension <code>fail</code>s as well. You can inline this as:</p>\n\n<pre><code>where f (h:_) = return h\n      f _ = fail []\n</code></pre>\n\n<p>Then you can use <code>f</code> in the side of the binding operator <code>&gt;&gt;=</code>. Clearly this has an impact on how to encode things. Implicitly for each such pattern matching (thus everything not <code>x &lt;-</code> with <code>x</code> a single variable) Haskell could have written such <code>fail</code> (be aware Haskell does not necessarily uses the list monad).</p></li>\n<li><p>As you can read <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"nofollow\">here</a> for the list monad, you don't need to use <code>return</code>, although in this context it not much of a problem, but will reduce the length of your code. In that case you need to replace the right hand side of the expression with <code>[x]</code> instead of <code>x</code>.</p></li>\n</ul>\n\n<p>Based on the above hints, I've managed to fix your implementation of <code>transpose</code> myself. I hope this clarifies a thing or two?</p>\n"}], "owner": {"reputation": 133, "user_id": 3556115, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/84298ecd37f0fe0dc7580eb481f6a263?s=128&d=identicon&r=PG&f=1", "display_name": "user3556115", "link": "https://stackoverflow.com/users/3556115/user3556115"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 30878586, "answer_count": 1, "score": 0, "last_activity_date": 1434530897, "creation_date": 1434487026, "last_edit_date": 1434530897, "question_id": 30877696, "link": "https://stackoverflow.com/questions/30877696/haskell-pattern-match-error-with-bind-operator", "title": "Haskell pattern match error with bind operator", "body": "<p>I have a task, where I am stuck at a point, where I do not get any further.\nGiven is a function:</p>\n\n<pre><code>transpose :: [[a]] -&gt; [[a]]\ntranspose []       =  []\ntranspose ([]:ls)  =  transpose ls\ntranspose ll       =  [h | (h:_) &lt;- ll] : transpose [t |(_:t) &lt;- ll]\n</code></pre>\n\n<p>I shall write it again using the do-notation on the one hand and the bind-operator on the other hand. I may use hd, tl and (:).\nI do not have problems with the do-notation solution but there is a pattern matching problem with the bind version.\nHere is, what I have so far:</p>\n\n<pre><code>transheadA ll = ll &gt;&gt;= \\(h:_) -&gt;\n    return h\n\ntranstailA ll = ll &gt;&gt;= \\(_:t) -&gt;\n    return t\n\ntransposeA :: [[a]] -&gt; [[a]]\ntransposeA []       =  []\ntransposeA ([]:ls)  =  transposeA ls\ntransposeA ll       =  (transheadA ll : transposeA (transtailA ll))\n</code></pre>\n\n<p>The same style for the do-notation works but with the bind operator I get a pattern match error at transheadA with</p>\n\n<pre><code>\\(h:_) -&gt; ...\n</code></pre>\n\n<p>See:</p>\n\n<pre><code>transposeA [[1,2,3],[4,5,6],[7,8]]\n[[1,4,7],[2,5,8],[3,6*** Exception: transpose.hs:(16,22)-(17,24): Non-exhaustive patterns in lambda\n</code></pre>\n\n<p>I was thinking about how to solve this problem a longer time but I do not know, where to add a new pattern to let this work.</p>\n\n<h1>EDIT</h1>\n\n<p>I just want hints, of course.\nDirect solutions are not the sense of the homework nor of this board.\nThank You</p>\n\n<h1>EDIT SOLUTION</h1>\n\n<p>Thanks to CommuSoft I could solve this problem, I think.\nMy solution now is the following:</p>\n\n<pre><code>transheadA :: [[a]] -&gt; [a]\ntransheadA ll = ll &gt;&gt;= f\n    where f (h:_) = return h\n          f _     = fail []\n\n\ntranstailA :: [[a]] -&gt; [[a]]\ntranstailA ll = ll &gt;&gt;= f\n    where f (_:t) = return t\n          f _     = fail []\n\ntransposeA :: [[a]] -&gt; [[a]]\ntransposeA []       =  []\ntransposeA ([]:ls)  =  transposeA ls\ntransposeA ll       =  (transheadA ll : transposeA (transtailA ll))\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1434485357, "post_id": 30877019, "comment_id": 49795411, "body": "I&#39;ve also noticed this, so I&#39;ll be glad to see an answer, too. Perhaps it <i>is</i> a bug?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 7, "creation_date": 1434485594, "post_id": 30877019, "comment_id": 49795523, "body": "I fear that the latter command is never allocating memory. In such case, the GHC thread scheduler is (IIRC) unfair, and will never transfer control to other threads, or allow the async exception from Ctrl-C to be delivered. (To be honest, this used to be the case a long time ago, and I don&#39;t know if they worked around this somehow.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1434486403, "post_id": 30877019, "comment_id": 49795997, "body": "I know the problem you&#39;re talking about, but at least for me (in GHC-7.10), Ctrl+C <i>does</i> interrupt <code>last (repeat 0)</code>!"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 11, "last_activity_date": 1434486328, "creation_date": 1434486328, "answer_id": 30877498, "question_id": 30877019, "link": "https://stackoverflow.com/questions/30877019/how-to-abort-execution-in-ghci/30877498#30877498", "title": "How to abort execution in GHCI?", "body": "<p>(Caveat lector: I use Linux, and run zsh on urxvt or gnome-terminal. If you use a different operating system, terminal, or shell, it's possible this will work differently for you.)</p>\n\n<p>The way I usually handle this is to hit Ctrl+Z (which puts it in the background, pausing execution entirely as a side-effect) then kill the job. Usually this is <code>kill %1</code>, though you can run <code>jobs</code> to double-check.</p>\n\n<p>You can also start a new terminal and do something like <code>killall -9 ghci</code>, but this has a much higher resource cost: you are spawning a few new processes, opening X connections, doing whatever it is your terminal does when it initializes itself, doing whatever it is your shell does when it initializes itself, etc. If you're in the situation I often find myself in -- ghci is swapping like crazy -- that just gives ghci more time to screw things up.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1520522351, "post_id": 48994318, "comment_id": 85358286, "body": "Ctrl+D will not close ghci while it is executing code. Ctrl+Z, on the other hand, sends a signal that can&#39;t be caught or handled by the receiving process, so will always work (for any process, not just ghci). You can clean up after the leftover process left behind by Ctrl+Z with <code>kill</code> or similar, as discussed in my answer."}, {"owner": {"reputation": 404, "user_id": 11392504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b00e9f81811e12413804ac19b4965869?s=128&d=identicon&r=PG&f=1", "display_name": "Student", "link": "https://stackoverflow.com/users/11392504/student"}, "edited": false, "score": 0, "creation_date": 1567537903, "post_id": 48994318, "comment_id": 101989976, "body": "Yeah.. <code>Ctrl+D</code> did not close my <code>ghci</code> when I ask it to compute <code>333^333^333</code> for me."}], "tags": [], "owner": {"reputation": 2500, "user_id": 3142049, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e397754f01a0c386cf59f64d86565d31?s=128&d=identicon&r=PG&f=1", "display_name": "Abhisek", "link": "https://stackoverflow.com/users/3142049/abhisek"}, "is_accepted": false, "score": 2, "last_activity_date": 1519667661, "creation_date": 1519667661, "answer_id": 48994318, "question_id": 30877019, "link": "https://stackoverflow.com/questions/30877019/how-to-abort-execution-in-ghci/48994318#48994318", "title": "How to abort execution in GHCI?", "body": "<p><code>Ctrl+Z</code> seems to leave the shell, but it doesn't entirely close the process.</p>\n\n<p>For Example</p>\n\n<pre><code>$ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; \n[4]+  Stopped                 ghci\n$ ps\n  PID TTY          TIME CMD\n 3160 pts/1    00:00:00 bash\n 3554 pts/1    00:00:21 emacs\n 5602 pts/1    00:00:00 ghc\n 5693 pts/1    00:00:00 ps\n</code></pre>\n\n<p>However if you do <code>Ctrl+D</code></p>\n\n<pre><code>$ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; \nLeaving GHCi.\n$ ps\n  PID TTY          TIME CMD\n 3160 pts/1    00:00:00 bash\n 3554 pts/1    00:00:21 emacs\n 5870 pts/1    00:00:00 ps\n</code></pre>\n\n<p>So the proper way to close <code>haskell-shell</code> is to hit <strong><code>Ctrl+D</code></strong>.</p>\n\n<p><em>Note</em>: Tested on Linux (Ubuntu 16.04 LTS)</p>\n"}, {"tags": [], "owner": {"reputation": 713, "user_id": 8662097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZWv2.png?s=128&g=1", "display_name": "ivanjermakov", "link": "https://stackoverflow.com/users/8662097/ivanjermakov"}, "is_accepted": false, "score": 1, "last_activity_date": 1588425801, "creation_date": 1588425801, "answer_id": 61560093, "question_id": 30877019, "link": "https://stackoverflow.com/questions/30877019/how-to-abort-execution-in-ghci/61560093#61560093", "title": "How to abort execution in GHCI?", "body": "<p>You can quit GHCI using <a href=\"https://downloads.haskell.org/~ghc/5.04.1/docs/html/users_guide/ghci-commands.html\" rel=\"nofollow noreferrer\"><code>:quit</code></a> command</p>\n\n<pre><code>Prelude&gt; :quit\nLeaving GHCi.\n</code></pre>\n\n<p>Or by pressing <kbd>Control</kbd>+<kbd>D</kbd> that <a href=\"https://unix.stackexchange.com/questions/110240/why-does-ctrl-d-eof-exit-the-shell/\">sends EOF signal</a>.</p>\n\n<p>If GHCI is busy you have no choice other than killing the process manually.</p>\n"}], "owner": {"reputation": 1028, "user_id": 1717752, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/59df9ec4676523399b240b7009f91413?s=128&d=identicon&r=PG", "display_name": "ominug", "link": "https://stackoverflow.com/users/1717752/ominug"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11158, "favorite_count": 1, "accepted_answer_id": 30877498, "answer_count": 3, "score": 15, "last_activity_date": 1588425801, "creation_date": 1434484798, "question_id": 30877019, "link": "https://stackoverflow.com/questions/30877019/how-to-abort-execution-in-ghci", "title": "How to abort execution in GHCI?", "body": "<p>\nWhen I launch</p>\n\n<pre><code>ghci&gt; last [0..]\n</code></pre>\n\n<p>I can interrupt it with Ctrl+C.</p>\n\n<p>However</p>\n\n<pre><code>ghci&gt; last (repeat 0)\n</code></pre>\n\n<p>cannot be aborted with Ctrl+C. GHCI silently ignores the keystrokes.</p>\n\n<p>How to abort this command in GHCI? Is it a bug?</p>\n"}, {"tags": ["linux", "haskell", "makefile", "ghc", "theorem-proving"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1434480352, "post_id": 30874199, "comment_id": 49792666, "body": "Please <b>include</b> the error message inside the question. Questions should be <i>self contained</i>. Links should only add references or further information, but shouldn&#39;t be relied upon to provide the meaning/essential information of the question."}], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1434480601, "post_id": 30874433, "comment_id": 49792834, "body": "That&#39;s natural. Most distributions still ship only the haskell platform 2013 which uses ghc 7.6.3."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1434525802, "post_id": 30874433, "comment_id": 49809881, "body": "FWIW they <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9590\" rel=\"nofollow noreferrer\">gave up</a> supporting <code>haskell98</code> in GHC 7.10, as a consequence of the AMP reform. The problem is that the <code>Monad</code> class, which is deeply embedded in the language (e.g. with <code>do</code> notation) is no longer backwards-compatible (it now has <code>Applicative</code> as superclass), so it&#39;s impossible to mix code using monads defined in the old and new style."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 2, "last_activity_date": 1434476155, "creation_date": 1434476155, "answer_id": 30874433, "question_id": 30874199, "link": "https://stackoverflow.com/questions/30874199/haskell-make-recipe-fails-for-paradox-theorem-prover-using-ghc/30874433#30874433", "title": "Haskell make recipe fails for Paradox theorem prover using GHC", "body": "<p>Looks like paradox was written for a rather old version of GHC. You can fix all these \"Could not find module\" errors by using GHC version 7.8 or older and setting</p>\n\n<pre><code>GHC     = ghc -hide-package base -package haskell98\n</code></pre>\n\n<p>in the Makefile, though you will likely encounter more errors after that.</p>\n\n<p>The warning about <code>-fglasgow-exts</code> is mostly harmless, you can ignore it.</p>\n"}], "owner": {"reputation": 49, "user_id": 2889232, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/55832a47fde8f3818ff1036ce27ab332?s=128&d=identicon&r=PG&f=1", "display_name": "Kit", "link": "https://stackoverflow.com/users/2889232/kit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 30874433, "answer_count": 1, "score": 1, "last_activity_date": 1434484532, "creation_date": 1434475420, "last_edit_date": 1434484532, "question_id": 30874199, "link": "https://stackoverflow.com/questions/30874199/haskell-make-recipe-fails-for-paradox-theorem-prover-using-ghc", "title": "Haskell make recipe fails for Paradox theorem prover using GHC", "body": "<p>I am trying to install the paradox theorem prover sourced from <a href=\"http://www.cse.chalmers.se/~koen/code/\" rel=\"nofollow\">here</a>.</p>\n\n<p>When I run the makefile this is the command that runs:\n<code>ghc -optl -static -lstdc++ -I../instantiate -I../minisat/current-base ../minisat/current-base/Solver.or ../minisat/current-base/Prop.or ../instantiate/MiniSatWrapper.or ../instantiate/MiniSatInstantiateClause.or -fglasgow-exts -O2 -static -threaded -main-is Paradox.Main.main --make Paradox.Main -o paradox\n</code></p>\n\n<p>And it results in several errors like so:</p>\n\n<pre><code>Flags.hs:52:8:\n    Could not find module \u2018Char\u2019\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>for a variety of modules including but not limited to <code>Char</code>, <code>CPUTime</code>, <code>IO</code>.</p>\n\n<p>The final error message is</p>\n\n<pre><code>Makefile:38: recipe for target 'paradox.exe' failed\nmake: *** [paradox.exe] Error 1\n</code></pre>\n\n<p>I don't know Haskell, nor am I very experienced with GNU <code>make</code>, but I am trying to install this package for a project and it is obscure enough to not be packaged for my OS (I'm running Arch Linux). As far as I know it is not packaged for any OS, so it is necessary to install from source.</p>\n\n<p>As far as I can tell the problem starts with the following error message:</p>\n\n<p><code>on the commandline: Warning:\n    -fglasgow-exts is deprecated: Use individual extensions instead\n</code></p>\n\n<p>I am using the version of the GHC provided in the Arch Linux package repository: <a href=\"https://www.archlinux.org/packages/extra/x86_64/ghc/\" rel=\"nofollow\">package link</a></p>\n"}, {"tags": ["scala", "haskell"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1434473342, "post_id": 30873455, "comment_id": 49788543, "body": "So do you just want an <code>i -&gt; b</code> function where <code>i</code> is the type of a subset of integers, and thus the question boils down to &quot;how can we define a type containing a subset of integers&quot;?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434473422, "post_id": 30873455, "comment_id": 49788587, "body": "@Andr&#225;sKov&#225;cs I believe the OP wouldn&#39;t want to define a new type for each instance of such a tuple.."}, {"owner": {"reputation": 1703, "user_id": 2757620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/wFg9k.jpg?s=128&g=1", "display_name": "qartal", "link": "https://stackoverflow.com/users/2757620/qartal"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434474001, "post_id": 30873455, "comment_id": 49788924, "body": "@Andr&#225;s Kov&#225;cs, I want <code>i</code> to be an specific subset of integers that is defined in runtime (that is, user instantiate A, and I want f to be a function from this specific A to integers). In other words, as @Eugene mentioned, I do not want to define a new type for each specific  <code>i</code>; rather,  I want to define f more generally representing a set of types from the sets of integers ( defined by user in runtime) to integers. I hope this clarifies more the question."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1434474132, "post_id": 30873455, "comment_id": 49788979, "body": "It does, but you can&#39;t define A in Haskell."}, {"owner": {"reputation": 1703, "user_id": 2757620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/wFg9k.jpg?s=128&g=1", "display_name": "qartal", "link": "https://stackoverflow.com/users/2757620/qartal"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1434474319, "post_id": 30873455, "comment_id": 49789088, "body": "@Rein, would you please elaborate a bit."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1434474407, "post_id": 30873455, "comment_id": 49789151, "body": "You can&#39;t define a type as a subset of another type in Haskell."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1434474458, "post_id": 30873455, "comment_id": 49789181, "body": "@ReinHenrichs I think we can, for most types."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1434474511, "post_id": 30873455, "comment_id": 49789223, "body": "@Andr&#225;sKov&#225;cs Can it be an <i>infinite</i> subset?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1434474602, "post_id": 30873455, "comment_id": 49789265, "body": "BTW, found <a href=\"http://stackoverflow.com/questions/19730031/is-it-possible-to-define-a-function-on-a-subset-of-an-existing-type\">this discussion</a>. Not sure if it is duplicate."}, {"owner": {"reputation": 15478, "user_id": 1223622, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yWKR2.jpg?s=128&g=1", "display_name": "Ben Reich", "link": "https://stackoverflow.com/users/1223622/ben-reich"}, "edited": false, "score": 3, "creation_date": 1434479230, "post_id": 30873455, "comment_id": 49792018, "body": "Can you elaborate a little bit on how you plan to use this?  What is known at runtime and compile time?  How do you want to enforce the domain restriction \u2013 a compile-time error?  a run-time exception?"}, {"owner": {"reputation": 1703, "user_id": 2757620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/wFg9k.jpg?s=128&g=1", "display_name": "qartal", "link": "https://stackoverflow.com/users/2757620/qartal"}, "reply_to_user": {"reputation": 15478, "user_id": 1223622, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yWKR2.jpg?s=128&g=1", "display_name": "Ben Reich", "link": "https://stackoverflow.com/users/1223622/ben-reich"}, "edited": false, "score": 0, "creation_date": 1434480350, "post_id": 30873455, "comment_id": 49792665, "body": "@Ben, I think it should be run-time error, since in compile-time, the elements of A is not yet initialized."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1434480355, "post_id": 30873455, "comment_id": 49792667, "body": "Practical answer: use <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Lazy.html#t:Map\" rel=\"nofollow noreferrer\"><code>Map</code></a>. The theoretical answer has so very much more boilerplate..."}, {"owner": {"reputation": 1703, "user_id": 2757620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/wFg9k.jpg?s=128&g=1", "display_name": "qartal", "link": "https://stackoverflow.com/users/2757620/qartal"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1434481543, "post_id": 30873455, "comment_id": 49793330, "body": "@DanielWagner, I do not think using Maps will be the solution, we need to check the key set of map f to be restricted to the A contents by some extra coding. It seems having this extra coding is inevitable in Scala/Haskell. I will update the question with Scala code."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1434482920, "post_id": 30873455, "comment_id": 49794084, "body": "In the Scala case, I think if it&#39;s possible, then the solution will involve something like what Shapeless does."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1434485058, "post_id": 30873455, "comment_id": 49795238, "body": "@qartal Don&#39;t keep a separate set and map. <i>Just</i> the map. The set is implicit: the keys that exist in the map define the set."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1434490641, "post_id": 30873455, "comment_id": 49798309, "body": "I don&#39;t get it -- all you want is a run-time error, yet you want the constraint &quot;enforced by Haskell/Scala typing system&quot;. If you really want the check at run-time, why bothering with the type system and its enforcement at all?"}], "answers": [{"tags": [], "owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "is_accepted": false, "score": 0, "last_activity_date": 1493693015, "creation_date": 1493693015, "answer_id": 43729252, "question_id": 30873455, "link": "https://stackoverflow.com/questions/30873455/dependence-of-a-function-domain-to-the-elements-of-another-set-in-haskell-scala/43729252#43729252", "title": "Dependence of a function domain to the elements of another set in Haskell/Scala", "body": "<p>You can accomplish this in Scala by leveraging the following -</p>\n\n<ul>\n<li>The <a href=\"https://github.com/milessabin/shapeless\" rel=\"nofollow noreferrer\">shapeless</a> library to encode integers as <code>Nat</code> values (natural numbers)</li>\n<li>An object <code>f</code> with an <code>apply()</code> method to emulate a function call</li>\n<li>A type class <code>F[N]</code> defined in that object which enforces the acceptable input types</li>\n</ul>\n\n<pre class=\"lang-scala prettyprint-override\"><code>scala&gt; :paste\n// Entering paste mode (ctrl-D to finish)\n\nimport shapeless._\n\nobject f {\n  def apply(n: Nat)(implicit ev: F[n.N]) = ev()\n  sealed trait F[N] { def apply(): Int }\n  private def inst[N](r: Int): F[N] = new F[N] { def apply(): Int = r }\n  implicit val one = inst[Nat._1](10)\n  implicit val two = inst[Nat._2](15)\n}\n\n// Exiting paste mode, now interpreting.\n\nimport shapeless._\ndefined object f\n\nscala&gt; f(1)\nres0: Int = 10\n\nscala&gt; f(2)\nres1: Int = 15\n\nscala&gt; f(3)\n&lt;console&gt;:16: error: could not find implicit value for parameter ev: f.F[shapeless.Succ[shapeless.Succ[shapeless.Succ[shapeless._0]]]]\n       f(3)\n        ^\n</code></pre>\n"}], "owner": {"reputation": 1703, "user_id": 2757620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/wFg9k.jpg?s=128&g=1", "display_name": "qartal", "link": "https://stackoverflow.com/users/2757620/qartal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 219, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1493693015, "creation_date": 1434472921, "last_edit_date": 1434481965, "question_id": 30873455, "link": "https://stackoverflow.com/questions/30873455/dependence-of-a-function-domain-to-the-elements-of-another-set-in-haskell-scala", "title": "Dependence of a function domain to the elements of another set in Haskell/Scala", "body": "<p>I would like to define a tuple <code>(A, f)</code>, such that A is a set of Integers and f is a function from this set to Integers. I would like to emphasize that f's domain is dependent on the A elements. For example, if A is defined to be <code>A={1,2}</code>, then <code>f={1-&gt;10,2-&gt;15}</code> is a valid instance of f, but <code>f={1-&gt;10,2-&gt;15,3-&gt;20}</code> is not a valid f; since in the second case f's domain is not restricted to A.</p>\n\n<p><strong>My question:</strong></p>\n\n<p>Is there any way to define <code>(A, f)</code> in Haskell/Scala such that dependability of f to A content is enforced by Haskell/Scala typing system. (I suspect that this scenario is an example of <a href=\"https://en.wikipedia.org/wiki/Dependent_type\" rel=\"nofollow\">dependent types</a>. Am I right?) </p>\n\n<hr>\n\n<p><strong>Update:</strong></p>\n\n<p>I am adding a piece of Scala code for the above question, to add more clarity. Having the following code, the very concrete question would be: Is there any way (using typing system of the language) that make us free of writing the throw statement in the following code? that is to say, using language typing system, we say domain of f is restricted only to A elements?</p>\n\n<pre><code>class ClassA (val A:Set[Int], val f:Map[Int,Int] ){\n    if (!A.equals(f.keySet)){\n          throw new IllegalArgumentException(\"f domain and set A do not match\")\n     }\n  }\n</code></pre>\n"}, {"tags": ["haskell", "state", "monads"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 4, "creation_date": 1434470569, "post_id": 30872442, "comment_id": 49786832, "body": "&quot;why is the <code>a</code> of type <code>()</code>?&quot; - Why shouldn&#39;t it be?  What were you expecting instead?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1434470610, "post_id": 30872442, "comment_id": 49786850, "body": "<code>put</code> has type <code>s -&gt; m ()</code> (see <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/mtl-2.2.1/docs/&hellip;</a>)."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "is_accepted": false, "score": 6, "last_activity_date": 1434476873, "last_edit_date": 1434476873, "creation_date": 1434470757, "answer_id": 30872756, "question_id": 30872442, "link": "https://stackoverflow.com/questions/30872442/state-monad-with-put-function/30872756#30872756", "title": "State Monad with `put` Function", "body": "<p>When using <code>put</code> with the <code>State</code> monad, it has the <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-State-Lazy.html#v:put\" rel=\"nofollow\">type</a> <code>s -&gt; State s ()</code>.</p>\n\n<p><code>put</code> sets the state to its argument, and that's all it does. As for its return value: it's essentially a dummy value, because there's nothing useful to return.</p>\n\n<p>This is also evident in its <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/src/Control-Monad-Trans-State-Lazy.html#put\" rel=\"nofollow\">definition</a> <code>put s = state $ \\ _ -&gt; ((), s)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1434482267, "last_edit_date": 1434482267, "creation_date": 1434479853, "answer_id": 30875573, "question_id": 30872442, "link": "https://stackoverflow.com/questions/30872442/state-monad-with-put-function/30875573#30875573", "title": "State Monad with `put` Function", "body": "<p>The easiest way to really understand <code>State</code>, IMHO, is just to study the code and understand it well enough that you can implement it from memory, like I'm about to do:</p>\n\n<pre><code>import Control.Applicative\n\nnewtype State s a = State { runState :: s -&gt; (a, s) }\n\ninstance Functor (State s) where\n    fmap f fa = State $ \\s -&gt; f (runState fa s)\n\ninstance Applicative (State s) where\n    pure a = State $ \\s -&gt; (a, s)\n    ff &lt;*&gt; fa = State $ \\ s -&gt; \n        let (f, s') = runState ff s\n            (a, s'') = runState fa s'\n        in (f a, s'')\n\ninstance Monad (State s) where\n    return = pure\n    ma &gt;&gt;= f = State $ \\s -&gt; \n        let (a, s') = runState ma s\n            (b, s'') = runState (f a) s'\n        in (b, s'')\n\nget :: State s s\nget = State $ \\s -&gt; (s, s)\n\nput :: s -&gt; State s ()\nput s = State $ \\_ -&gt; ((), s)\n\nmodify :: (s -&gt; s) -&gt; State s ()\nmodify f = State $ \\s -&gt; ((), f s)\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>Since <code>runState</code> returns an <code>(a, s)</code>, why is the a of type <code>()</code>?</p>\n</blockquote>\n\n<p>That really is just arbitrary/conventional.  Taking the above as a baseline, we could just as well write <code>modify</code>, <code>get</code> and <code>put</code> like this:</p>\n\n<pre><code>-- | Replaces the state with the result of applying it to the supplied\n-- function.  The result of the action is the original state.\nmodify :: (s -&gt; s) -&gt; State s s\nmodify f = State $ \\s -&gt; (s, f s)\n\n-- `get` is just what you get when you `modify` with an identity function.\nget :: State s s\nget = modify (\\s -&gt; s)\n\n-- This version of `put` differs from the canonical one because it returns \n-- the old value.\nput :: s -&gt; State s s\nput s = modify (\\_ -&gt; s) \n</code></pre>\n\n<p>In this version <code>modify</code> and <code>put</code> have the same effects as the original, but additional produce the old state as their result.  Clients that use <code>modify</code> and <code>put</code> only for the effect would not generally notice the difference.</p>\n\n<p>Alternatively, the \"return old state\" versions of <code>modify</code> and <code>put</code> can be written in terms of the official ones.  For example:</p>\n\n<pre><code>swap :: s -&gt; State s s\nswap s = do\n    orig &lt;- get\n    put s\n    return orig\n</code></pre>\n\n<p>So most of these operations are interdefinable, it doesn't much matter which ones are \"basic\" and which ones not...</p>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 1, "last_activity_date": 1434605494, "creation_date": 1434605494, "answer_id": 30907163, "question_id": 30872442, "link": "https://stackoverflow.com/questions/30872442/state-monad-with-put-function/30907163#30907163", "title": "State Monad with `put` Function", "body": "<p>The <code>runState</code> function takes an action in the State monad and an initial state and gives you back <em>both</em> the result of the calculation and the final state.</p>\n\n<p>A typical use case for <code>runState</code> is to hand it a complex action with an intial and to then get the final result and the state back.  In your example, the action is a simple primitive, <code>put</code>.</p>\n\n<p>The <code>put</code> action takes a new state and produces <code>()</code> (pronounced unit) for a value.  It is very similar to how putStrLn has the type <code>IO ()</code> It performs an action in the monad, but does not produce a useful value.</p>\n\n<p>So, with <code>runState (put 5) 1</code> the initial state, <code>1</code> gets blown away by the new state <code>5</code>.  The result the state calculation is the result of <code>put</code> that is <code>()</code>.</p>\n\n<p>Just for kicks, lets look at something just a little more interesting:</p>\n\n<pre><code>runState (puts 5 &gt;&gt; return \"hello world!\") undefined\n  --&gt; (\"hello world!\", 5)\n</code></pre>\n\n<p>Here we have two actions glued together with <code>&gt;&gt;</code> (I read this as \"then\", it is a limited form of bind <code>&gt;&gt;=</code> where we just drop the result from the left hand side).  The first action changes the state to <code>5</code> the second doesn't touch the state, but results in the string \"hello world!\" which then becomes the value of the entire calculation.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 627, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1434605494, "creation_date": 1434469876, "last_edit_date": 1434471979, "question_id": 30872442, "link": "https://stackoverflow.com/questions/30872442/state-monad-with-put-function", "title": "State Monad with `put` Function", "body": "<p>Looking at the State Monad's <a href=\"https://wiki.haskell.org/State_Monad\" rel=\"nofollow\">wiki</a>, I'm trying to understand the <code>runState</code> and <code>put</code> functions.</p>\n\n<p>As I understand <code>runState</code>, it takes a first argument of <code>State</code>, which has a \"universe\", <code>s</code>, and a value, <code>a</code>. It takes a second argument of a universe. Finally, it returns a <code>(a, s)</code> where <code>a</code> is the new value and <code>s</code> is the new universe?</p>\n\n<pre><code>ghci&gt; :t runState\nrunState :: State s a -&gt; s -&gt; (a, s)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>ghci&gt; let s = return \"X\" :: State Int String\nghci&gt; runState s 100\n(\"X\",100)\n</code></pre>\n\n<p>However, I'm don't understand the <code>put</code> result:</p>\n\n<pre><code>ghci&gt; runState (put 5) 1\n((),5)\n</code></pre>\n\n<p>Since <code>runState</code> returns an <code>(a, s)</code>, why is the <code>a</code> of type <code>()</code>?</p>\n\n<p>I'm not confident on my above attempted explanations. Please correct me, and answer my question on <code>put</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 9, "creation_date": 1434466216, "post_id": 30870960, "comment_id": 49783635, "body": "Because <code>$</code> is right-associative. <code>Right 100 (Right 20)</code> doesn&#39;t type check."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 8, "creation_date": 1434466384, "post_id": 30870960, "comment_id": 49783763, "body": "FYI you can use <code>(,)</code> instead of your lambda: <code>liftA2 (,) (Right 100) (Right 1)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 9436, "user_id": 1984384, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e61d31a5f0fa86bf2f1824f0da4cfa49?s=128&d=identicon&r=PG", "display_name": "Tim Bodeit", "link": "https://stackoverflow.com/users/1984384/tim-bodeit"}, "is_accepted": true, "score": 12, "last_activity_date": 1434466496, "creation_date": 1434466496, "answer_id": 30871174, "question_id": 30870960, "link": "https://stackoverflow.com/questions/30870960/using-over-parentheses-example/30871174#30871174", "title": "Using $ over Parentheses Example", "body": "<p>Thats because</p>\n\n<pre><code>liftA2 (\\x y -&gt; (x, y)) $ Right 100 $ Right 20\n</code></pre>\n\n<p>Is equal to</p>\n\n<pre><code>liftA2 (\\x y -&gt; (x, y)) ( Right 100 ( Right 20 ))\n</code></pre>\n\n<hr>\n\n<p>You are trying to shove an additional argument into the <code>Right</code> constructor (takes one argument, but type has none) and your liftA2 is missing one.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 30871174, "answer_count": 1, "score": 1, "last_activity_date": 1434466496, "creation_date": 1434466005, "question_id": 30870960, "link": "https://stackoverflow.com/questions/30870960/using-over-parentheses-example", "title": "Using $ over Parentheses Example", "body": "<p>Looking at <code>liftA2</code>:</p>\n\n<pre><code>ghci&gt; :t liftA2\nliftA2 :: Applicative f =&gt; (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n</code></pre>\n\n<p>I can produce an <code>Either (a, a)</code>:</p>\n\n<pre><code>ghci&gt; liftA2 (\\x y -&gt; (x, y)) (Right 100) (Right 1)\nRight (100,1)\n</code></pre>\n\n<p>But I get a compile-time error if I use <code>$</code>:</p>\n\n<pre><code>ghci&gt; liftA2 (\\x y -&gt; (x, y)) $ Right 100 $ Right 20\n\n&lt;interactive&gt;:23:27:\n    Couldn't match expected type `Either a1 b1 -&gt; f t'\n                with actual type `Either a0 b0'\n    Relevant bindings include\n      it :: f t1 -&gt; f (t, t1) (bound at &lt;interactive&gt;:23:1)\n    The first argument of ($) takes one argument,\n    but its type `Either a0 b0' has none\n    In the second argument of `($)', namely `Right 100 $ Right 20'\n    In the expression: liftA2 (\\ x y -&gt; (x, y)) $ Right 100 $ Right 20\n</code></pre>\n\n<p>Why can't I use <code>$</code> for this example to get the same result as with parentheses?</p>\n"}, {"tags": ["haskell", "type-level-computation", "data-kinds"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434455469, "post_id": 30866612, "comment_id": 49774895, "body": "What about <code>log2 0</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1434457604, "creation_date": 1434457604, "answer_id": 30867564, "question_id": 30866612, "link": "https://stackoverflow.com/questions/30866612/defining-custom-type-families-over-the-nat-kind/30867564#30867564", "title": "Defining custom type families over the Nat kind", "body": "<p>We can pattern match on any literal <code>Nat</code>, then recurse using built-in operations. </p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances #-}\n\nimport GHC.TypeLits\n\ntype family Div2 n where\n  Div2 0 = 0\n  Div2 1 = 0\n  Div2 n = Div2 (n - 2) + 1\n\ntype family Log2 n where\n  Log2 0 = 0  -- there has to be a case, else we get nontermination\n              -- or we could return Maybe Nat\n  Log2 1 = 0\n  Log2 n = Log2 (Div2 n) + 1\n\ntype family WIDTH n where\n  WIDTH 0 = 0\n  WIDTH n = Log2 (n - 1)\n</code></pre>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 1, "accepted_answer_id": 30867564, "answer_count": 1, "score": 6, "last_activity_date": 1434457604, "creation_date": 1434455085, "question_id": 30866612, "link": "https://stackoverflow.com/questions/30866612/defining-custom-type-families-over-the-nat-kind", "title": "Defining custom type families over the Nat kind", "body": "<p>How does one define new computation over types of kind <code>GHC.TypeLits.Nat</code>? I am hoping to be able to define a type family</p>\n\n<pre><code>type family WIDTH (n :: Nat) :: Nat\n</code></pre>\n\n<p>such that <code>WIDTH 0 ~ 0</code> and <code>WIDTH (n+1) ~ log2 n</code></p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1434454893, "post_id": 30865166, "comment_id": 49774495, "body": "Remember that do notation is sugar for &gt;&gt;= and &gt;&gt;. The type signatures there dictate that you&#39;ll have to do that <i>outside</i> of the do-block."}], "answers": [{"comments": [{"owner": {"reputation": 1455, "user_id": 393863, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1c52f2566306ab2c1f82de50a1472ff3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/393863/alexander"}, "edited": false, "score": 0, "creation_date": 1434451684, "post_id": 30865210, "comment_id": 49772427, "body": "How does the second approach work without GeneralizedNewtypeDeriving?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 1455, "user_id": 393863, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1c52f2566306ab2c1f82de50a1472ff3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/393863/alexander"}, "edited": false, "score": 0, "creation_date": 1434452693, "post_id": 30865210, "comment_id": 49773085, "body": "@Alexander It doesn&#39;t."}], "tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": true, "score": 0, "last_activity_date": 1434451089, "creation_date": 1434451089, "answer_id": 30865210, "question_id": 30865166, "link": "https://stackoverflow.com/questions/30865166/how-to-wrap-monadic-return-value/30865210#30865210", "title": "How to &quot;wrap&quot; monadic return value", "body": "<pre><code>createNotificationIdentifierItem :: APNSIdentifier -&gt; APNSItem\ncreateNotificationIdentifierItem (Identifier identifier) = Item $ do\n    putWord8 3\n    putWord16be 4\n    putWord32be identifier\n</code></pre>\n\n<p>or</p>\n\n<pre><code>createNotificationIdentifierItem :: APNSIdentifier -&gt; APNSItem\ncreateNotificationIdentifierItem (Identifier identifier) = do\n    Item $ putWord8 3\n    Item $ putWord16be 4\n    Item $ putWord32be identifier\n</code></pre>\n\n<p>after making <code>APNSItem</code> an instance of <code>Monad</code> (you can do this with <code>GeneralizedNewtypeDeriving</code>, but you'll need to fix <code>APNSItem</code> to have a single type variable first)</p>\n"}], "owner": {"reputation": 1455, "user_id": 393863, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1c52f2566306ab2c1f82de50a1472ff3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/393863/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 30865210, "answer_count": 1, "score": 1, "last_activity_date": 1434451089, "creation_date": 1434450933, "question_id": 30865166, "link": "https://stackoverflow.com/questions/30865166/how-to-wrap-monadic-return-value", "title": "How to &quot;wrap&quot; monadic return value", "body": "<p>I have the following code:</p>\n\n<pre><code>data APNSIdentifier = NoIdentifier | Identifier Word32 deriving (Show, Eq)\nnewtype APNSItem = Item Put\n\ncreateNotificationIdentifierItem :: APNSIdentifier -&gt; APNSItem   &lt;--- here\ncreateNotificationIdentifierItem (Identifier identifier) = do\n    putWord8 3\n    putWord16be 4\n    putWord32be identifier\n</code></pre>\n\n<p>How can I \"wrap\" the <code>Put</code> monad with an <code>APNSItem</code>? Do I have to make <code>APNSItem</code> an instance of the <code>Monad</code> typeclass or is there a simpler solution?</p>\n"}, {"tags": ["haskell", "frege"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1434455607, "post_id": 30865148, "comment_id": 49774996, "body": "That&#39;s a very good question, since the <a href=\"http://www.frege-lang.org/doc/Language.pdf\" rel=\"nofollow noreferrer\">official language specification</a> makes no mention of polymorphism for numeric literals.  In Haskell, a literal has the type <code>Num a =&gt; a</code>, which allows it to be specialized to whatever numeric type works in that context, it could be that similar type magic is going on here, but I couldn&#39;t find out for sure in the 5 minutes I spent looking for it."}], "answers": [{"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 3, "last_activity_date": 1434459575, "creation_date": 1434459575, "answer_id": 30868307, "question_id": 30865148, "link": "https://stackoverflow.com/questions/30865148/how-does-frege-generalize-number-literals/30868307#30868307", "title": "How does Frege generalize number literals?", "body": "<p>Simple decimal literals without type indicator (i.e. one of the letters lndf) do not automatically have type Int in Frege.</p>\n\n<p>They will get assigned the type you probably wanted, and the literal will get adapted accordingly. This is why they are called DWIM  (do what I mean) literals. </p>\n\n<p>This is mentioned in the \"Differences to Haskell\" document. And it should be also in the language reference manual, of course. If it isn't there yet, it must be because the author is extremely lazy. </p>\n\n<p>In brief, DWIM works like this: when the type checker sees the literal the first time, it just assigns a type variable for it, plus a Num constraint for that type variable. Later, in a second pass, it finds all DWIM literals. And now, the type variable is in one of the following states :</p>\n\n<ol>\n<li>unified with some type, like Long, Double or the like. The literal will be typed accordingly. </li>\n<li>Unified with some other type: this is an error. </li>\n<li>Unified with a type variable from a type signature: the literal gets replaced with an application of fromInt to the literal typed as Int. </li>\n<li>Not unified at all: if the type variable is constrained by (a subtype of) Real the type is Double otherwise Int. </li>\n</ol>\n\n<p>In your example, the literals are typed Double because of the Real constraint of the division operator. </p>\n\n<p>A similar approach is taken for literals with decimal point, however, they start out with a Real constraint, and can thus end up as Float or Double or application of fromDouble.</p>\n\n<p>Note that except for case 3 there is no type conversion or type cast at runtime. </p>\n\n<p>The reason literals are not generally overloaded like in Haskell is to avoid unnecessary class constraints, because  their implementation tends to result in expensive code. Also, since we don't have monomorphism restriction, you could have polymorphic constants accidentally. (Think fibs = 1:1:...)</p>\n\n<p>With DWIM  literals, you get monomorphic constants and functions unless you require otherwise with a type annotation. </p>\n"}], "owner": {"reputation": 1308, "user_id": 2746333, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a006d823040407817369ae675172ac39?s=128&d=identicon&r=PG", "display_name": "Dierk", "link": "https://stackoverflow.com/users/2746333/dierk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 30868307, "answer_count": 1, "score": 6, "last_activity_date": 1434459575, "creation_date": 1434450884, "question_id": 30865148, "link": "https://stackoverflow.com/questions/30865148/how-does-frege-generalize-number-literals", "title": "How does Frege generalize number literals?", "body": "<p>It appears that Frege can evaluate </p>\n\n<pre><code>1/2\n</code></pre>\n\n<p>to return the Double value 0.5.</p>\n\n<p>The literal <code>1</code> is of type <code>Int</code>. It seems to be promoted to <code>Double</code>, which is a type in the <code>Real</code> class and thus knows the <code>/</code> operator. How does this happen? Is it using the Haskell approach of silently replacing the literal 1 with <code>fromInt 1</code> or is something else going on? How is <code>Double</code> chosen as the instance of <code>Real</code> to use here? Is there a list of \"default\" instance types like in Haskell? </p>\n"}, {"tags": ["haskell", "file-io", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1434451974, "post_id": 30865213, "comment_id": 49772624, "body": "Thanks, you made my day!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1434452416, "last_edit_date": 1434452416, "creation_date": 1434451095, "answer_id": 30865213, "question_id": 30864903, "link": "https://stackoverflow.com/questions/30864903/haskell-return-lazy-string-from-file-io/30865213#30865213", "title": "Haskell return lazy string from file IO", "body": "<p>You're right, this is a pain. Avoid using the old standard file IO module, for this reason &ndash; except to simply read an entire file that won't change, as you did; this can be done just fine with <code>readFile</code>.</p>\n\n<pre><code>readCsvContents :: Filepath -&gt; IO String\nreadCsvContents fileName = do\n   contents &lt;- readFile fileName\n   return contents\n</code></pre>\n\n<p>Note that, by the monad laws, this is exactly the same<sup>1</sup> as</p>\n\n<pre><code>readCsvContents = readFile\n</code></pre>\n\n<p>The problem with what you tried is that the handle is closed unconditionally when the monad exits <code>withFile</code>, without checking whether lazy-evaluation of <code>contents</code> has actually forced the file reads. That is of course horrible; I would never bother to use handles myself. <code>readFile</code> avoids the problem by linking the closing of the handle to garbage-collection of the original result thunk; this isn't altogether nice either but often works quite well.</p>\n\n<p>For proper work with file IO, check out either the <a href=\"http://hackage.haskell.org/package/conduit\" rel=\"nofollow\">conduit</a> or <a href=\"http://hackage.haskell.org/package/pipes\" rel=\"nofollow\">pipes</a> library. The former focuses a bit more on performance, the latter more on elegance (but really, the difference isn't that big).</p>\n\n<hr>\n\n<p><sup>1</sup><sub>And your first try is the same as <code>readCsvContents fn = withFile fn ReadMode hGetContents</code>.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 1576064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47c868b652ffdc287498a8c604a30013?s=128&d=identicon&r=PG", "display_name": "Lubom&#237;r Sedl&#225;\u0159", "link": "https://stackoverflow.com/users/1576064/lubom%c3%adr-sedl%c3%a1%c5%99"}, "is_accepted": false, "score": 3, "last_activity_date": 1434451490, "creation_date": 1434451490, "answer_id": 30865376, "question_id": 30864903, "link": "https://stackoverflow.com/questions/30864903/haskell-return-lazy-string-from-file-io/30865376#30865376", "title": "Haskell return lazy string from file IO", "body": "<p>This is a problem with lazy IO. What happens in your code is that <code>withFile</code> opens the file, passes the handle to the lambda. This lambda returns a lazy list containing the contents of the file. Then <code>withFile</code> notices that the callback finished and closes the file.</p>\n\n<p>Since the returned list is lazy, the file contents will only be read when the list is evaluated. This happens in the call to <code>length</code>. However, at this point the file handle is already closed and therefore you can't read anything from the file.</p>\n\n<p>The modified version of your call forces the file contents in the <code>withFile</code> argument, at which point the file is still available, and therefore it works.</p>\n"}], "owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 1, "accepted_answer_id": 30865213, "answer_count": 2, "score": 3, "last_activity_date": 1434452416, "creation_date": 1434450186, "last_edit_date": 1434451926, "question_id": 30864903, "link": "https://stackoverflow.com/questions/30864903/haskell-return-lazy-string-from-file-io", "title": "Haskell return lazy string from file IO", "body": "<p>Here I'm back again with a (for me) really strange behaviour of my newest masterpiece...</p>\n\n<p>This code should read a file, but it doesn't:</p>\n\n<pre><code>readCsvContents :: String -&gt; IO ( String )\nreadCsvContents fileName = do\n     withFile fileName ReadMode (\\handle -&gt; do\n          contents &lt;- hGetContents handle\n          return contents\n          )\n\nmain = do\n    contents &lt;- readCsvContents \"src\\\\EURUSD60.csv\"\n    putStrLn (\"Read \" ++ show (length contents) ++ \" Bytes input data.\")\n</code></pre>\n\n<p>The result is</p>\n\n<pre><code>Read 0 Bytes input data.\n</code></pre>\n\n<p>Now I changed the first function and added a <code>putStrLn</code>:</p>\n\n<pre><code>readCsvContents :: String -&gt; IO ( String )\nreadCsvContents fileName = do\n     withFile fileName ReadMode (\\handle -&gt; do\n          contents &lt;- hGetContents handle\n          putStrLn (\"hGetContents gave \" ++ show (length contents) ++ \" Bytes of input data.\")\n          return contents\n          )\n</code></pre>\n\n<p>and the result is</p>\n\n<pre><code>hGetContents gave 3479360 Bytes of input data.\nRead 3479360 Bytes input data.\n</code></pre>\n\n<p>WTF ??? Well, I know, Haskell is lazy. But I didn't know I had to kick it in the butt like this.</p>\n"}, {"tags": ["haskell", "boilerplate"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1434435458, "post_id": 30859917, "comment_id": 49762648, "body": "Can you write the error?"}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1434436846, "post_id": 30859917, "comment_id": 49763356, "body": "This is just an example, and the actual code is much more complicated, so I don&#39;t have an exact error message handy. But it&#39;s easy to see the error - The type of fmap must be <code>(a -&gt; b) -&gt; Foo a -&gt; Foo b</code> But the last equation has <code>fmap f a = a</code>, where <code>f::(a-&gt;b)</code> and <code>a::Foo a</code>, implying that the type of fmap is <code>(a-&gt;b) -&gt; Foo a -&gt; Foo a</code>. So the error message says that <code>a</code> and <code>b</code> cannot be unified."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1434437575, "post_id": 30859917, "comment_id": 49763719, "body": "@AJFarmar the rhs has a different type than the lhs. GHC knows that the types check out only if we write out the constructors."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1434437749, "post_id": 30859917, "comment_id": 49763826, "body": "Another option would be to derive Functor using that GHC extension?"}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1434438307, "post_id": 30859917, "comment_id": 49764127, "body": "@AJFarmar Good suggestion! However deriving a functor will work for this specific example, but not when you want to do something more complicated in the functor instance."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1434442125, "post_id": 30859917, "comment_id": 49766420, "body": "Deriving functor should cover a vast amount of cases. IIRC, given a type there can only be one functor instance (satisfying the functor laws), so you can&#39;t really do anything different in an hand crafted instance (can&#39;t find the proof for this at the moment). One can always also write a Template Haskell library, if all else fails."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1505587766, "post_id": 30859917, "comment_id": 79478125, "body": "@chi, a hand-written instance for a recursive type may manually apply the static argument transformation to allow the mapped function to inline. Derived instances don&#39;t currently do this. Maybe they should. Also, instances can&#39;t be derived for GADTs and such. There are also some cases involving existential quantification where there can be multiple valid instances in a boring and unobservable way. And there can also be invalid instances that people want to hide under the module covers."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1505645889, "post_id": 30859917, "comment_id": 79489564, "body": "@dfeuer Do you have an example for &quot;a hand-written instance for a recursive type may manually apply the static argument transformation to allow the mapped function to inline&quot;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1505662612, "post_id": 30859917, "comment_id": 79494281, "body": "@AnupamJain, <code>fmap f = go where go [] = []; go (x:xs) = f x : go xs</code>, as opposed to the derived <code>fmap f [] = []; fmap f (x:xs) = f x : fmap f xs</code>. Usually it doesn&#39;t matter, but for passed functions that are somewhat trivial it can matter a good bit."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1505673717, "post_id": 30859917, "comment_id": 79497758, "body": "@dfeuer ah I see what you mean now! Thanks!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1505680903, "post_id": 30859917, "comment_id": 79499867, "body": "Trivial, in this case, means that they either ignore their argument altogether, or do nothing but apply zero or more lazy constructors. In such cases, inlining prevents the construction of useless thunks, and in the constant case can even prevent memory leaks."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 12, "last_activity_date": 1505560101, "last_edit_date": 1505560101, "creation_date": 1434440225, "answer_id": 30861484, "question_id": 30859917, "link": "https://stackoverflow.com/questions/30859917/how-do-i-avoid-writing-this-type-of-haskell-boilerplate-code/30861484#30861484", "title": "How do I avoid writing this type of Haskell boilerplate code", "body": "<p>There are two main simple solutions to this.</p>\n\n<p>First, for simple types, just <code>deriving (Functor)</code> it using the necessary extension.</p>\n\n<p>The other solution is to define another data type:</p>\n\n<pre><code>data Bar = S String | B Bool | I Int  -- \"Inner\" type\ndata Foo a = X a | Q Bar              -- \"Outer\" type\n\ninstance Functor Foo where\n    fmap f (X a) = X (f a)\n    fmap _ (Q b) = Q b -- `b' requires no type change. \n</code></pre>\n\n<p>So you can write one more line to remove many.</p>\n\n<p>It's not exactly ideal for pattern matching, but it does at least solve this problem.</p>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1434443065, "post_id": 30862052, "comment_id": 49766949, "body": "<code>fmap = over _X</code> would be nicer."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1434443394, "post_id": 30862052, "comment_id": 49767141, "body": "@Andr&#225;sKov&#225;cs I said I&#39;m a newbie, <code>over</code> is new for me. I suspected something like that should exist but didn&#39;t know where to look."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1434443782, "post_id": 30862052, "comment_id": 49767369, "body": "if you could include a clean version without all the verbose comments and old code.."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 8, "last_activity_date": 1434443501, "last_edit_date": 1434443501, "creation_date": 1434442145, "answer_id": 30862052, "question_id": 30859917, "link": "https://stackoverflow.com/questions/30859917/how-do-i-avoid-writing-this-type-of-haskell-boilerplate-code/30862052#30862052", "title": "How do I avoid writing this type of Haskell boilerplate code", "body": "<p>Looks like a job for prisms.</p>\n\n<p>Disclaimer: I'm  a lens/prism newbie.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell   #-}\n\nimport Control.Lens\nimport Control.Lens.Prism\n\ndata Foo x = X x | Y Int | Z String deriving Show\n\nmakePrisms ''Foo\n\ninstance Functor Foo where\n   -- super simple impl, by Andr\u00e1s Kov\u00e1cs\n   fmap = over _X\n   -- My overly complicated idea\n   --    fmap f = id &amp; outside _X .~ (X . f)\n   -- Original still more complicated implementation below\n   --     fmap f (X x) = X (f x)\n   --     fmap _ a = id &amp; outside _X .~ undefined $ a\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>*Main&gt; fmap (++ \"foo\") (Y 3)\nY 3\n*Main&gt; fmap (++ \"foo\") (X \"abc\")\nX \"abcfoo\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1434463563, "post_id": 30862840, "comment_id": 49781295, "body": "<code>over</code> is perfect! Goddamnit I love the lens library."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 10, "last_activity_date": 1434445479, "last_edit_date": 1434445479, "creation_date": 1434444591, "answer_id": 30862840, "question_id": 30859917, "link": "https://stackoverflow.com/questions/30859917/how-do-i-avoid-writing-this-type-of-haskell-boilerplate-code/30862840#30862840", "title": "How do I avoid writing this type of Haskell boilerplate code", "body": "<p>I assume that we'd like to have a solution for the general case where the changing type parameter is not necessarily in the right position for <code>DeriveFunctor</code>. </p>\n\n<p>We can distinguish two cases.</p>\n\n<p>In the simple case out data type is not recursive. Here, <a href=\"https://hackage.haskell.org/package/lens-4.11/docs/Control-Lens-Prism.html\">prisms</a> are a fitting solution:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\n\ndata Foo x y = X x | Y y | Z String\n\nmakePrisms ''Foo\n\nmapOverX :: (x -&gt; x') -&gt; Foo x y -&gt; Foo x' y\nmapOverX = over _X\n</code></pre>\n\n<p>If our data is recursive, then things get more complicated. Now <code>makePrisms</code> doesn't create type-changing prisms. We can get rid of the recursion in the definition by factoring it out to an explicit fixpoint. This way our prisms remain type-changing:</p>\n\n<pre><code>import Control.Lens\n\nnewtype Fix f = Fix {out :: f (Fix f)}\n\n-- k marks the recursive positions\n-- so the original type would be \"data Foo x y = ... | Two (Foo x y) (Foo x y)\"\ndata FooF x y k = X x | Y y | Z String | Two k k deriving (Functor)\n\ntype Foo x y = Fix (FooF x y)\n\nmakePrisms ''FooF\n\nmapOverX :: (x -&gt; x') -&gt; Foo x y -&gt; Foo x' y\nmapOverX f = \n   Fix .               -- rewrap \n   over _X f .         -- map f over X if possible\n   fmap (mapOverX f) . -- map over recursively\n   out                 -- unwrap\n</code></pre>\n\n<p>Or we can factor out the bottom-up transformation:</p>\n\n<pre><code>cata :: (Functor f) =&gt; (f a -&gt; a) -&gt; Fix f -&gt; a\ncata f = go where go = f . fmap go . out\n\nmapOverX :: (x -&gt; x') -&gt; Foo x y -&gt; Foo x' y\nmapOverX f = cata (Fix . over _X f)\n</code></pre>\n\n<p>There's a sizeable literature on using fixpoints of functors for generic programming, and also a number of libraries, for example <a href=\"https://hackage.haskell.org/package/recursion-schemes-4.1.2\">this</a> or <a href=\"https://hackage.haskell.org/package/fixplate\">this</a>. You might want to search for \"recursion schemes\" for further references. </p>\n"}, {"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1434453861, "post_id": 30865254, "comment_id": 49773833, "body": "It&#39;s also not robust: if the datatype is extended with a new constructor <code>X&#39; x</code>, no warning will be generated because the catch-all makes this definition exhaustive and then anything will go."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1434463719, "post_id": 30865254, "comment_id": 49781437, "body": "Thanks for mentioning it. It&#39;s educational, even though it&#39;s a bad idea! I did try <code>coerce</code>, but that doesn&#39;t work across types. I assumed unsafeCoerce would also not work because GHC would represent the two types differently, but I guess I was wrong."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 3, "last_activity_date": 1434456623, "last_edit_date": 1434456623, "creation_date": 1434451205, "answer_id": 30865254, "question_id": 30859917, "link": "https://stackoverflow.com/questions/30859917/how-do-i-avoid-writing-this-type-of-haskell-boilerplate-code/30865254#30865254", "title": "How do I avoid writing this type of Haskell boilerplate code", "body": "<p>Mostly for completeness, here is yet a way to do it:</p>\n\n<pre><code>import Unsafe.Coerce\n\ninstance Functor Foo where\n    fmap f (X x) = X (f x)\n    fmap _ a = unsafeCoerce a\n</code></pre>\n\n<p>in the situation described by you, this would actually be a safe use of <code>unsafeCoere</code>. But there are good reasons to avoid this:</p>\n\n<ul>\n<li>The safety depends on how GHC compiles the data structures and the code; knowledge that the normal programer should not need to have.</li>\n<li>It is also not robust: if the datatype is extended with a new constructor X' x, no warning will be generated because the catch-all makes this definition exhaustive and then anything will go. (thx @gallais for that comment)</li>\n</ul>\n\n<p>Therefore, this solution is definitely <strong>not</strong> advisable.</p>\n"}], "owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1813, "favorite_count": 2, "accepted_answer_id": 30862840, "answer_count": 4, "score": 28, "last_activity_date": 1505560101, "creation_date": 1434434799, "question_id": 30859917, "link": "https://stackoverflow.com/questions/30859917/how-do-i-avoid-writing-this-type-of-haskell-boilerplate-code", "title": "How do I avoid writing this type of Haskell boilerplate code", "body": "<p>I run into this situation often enough for it to be annoying.</p>\n\n<p>Let's say I have a sum type which can hold an instance of <code>x</code> or a bunch of other things unrelated to <code>x</code> -</p>\n\n<pre><code>data Foo x = X x | Y Int | Z String | ...(other constructors not involving x)\n</code></pre>\n\n<p>To declare a Functor instance I have to do this -</p>\n\n<pre><code>instance Functor Foo where\n    fmap f (X x) = X (f x)\n    fmap _ (Y y) = Y y\n    fmap _ (Z z) = Z z\n    ... And so on\n</code></pre>\n\n<p>Whereas what I would like to do is this -</p>\n\n<pre><code>instance Functor Foo where\n    fmap f (X x) = X (f x)\n    fmap _ a = a\n</code></pre>\n\n<p>i.e. I only care about the <code>X</code> constructor, all other constructors are simply \"passed through\". But of course this wouldn't compile because <code>a</code> on the left hand side is a different type from the <code>a</code> on the right hand side of the equation.</p>\n\n<p>Is there a way I can avoid writing this boilerplate for the other constructors?</p>\n"}, {"tags": ["loops", "haskell"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1434434176, "post_id": 30859457, "comment_id": 49762158, "body": "I&#39;d use something like <a href=\"https://hackage.haskell.org/package/monad-loops-0.4.2.1/docs/Control-Monad-Loops.html#v:unfoldrM\" rel=\"nofollow noreferrer\">unfoldrM</a> in <code>offsetSizes</code>; also, you can write <code>let ln = runGet (skip offset &gt;&gt; getWord32be) bytes</code> to make it simpler."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1434441123, "post_id": 30859457, "comment_id": 49765864, "body": "The loop is not so bad. What looks bad, instead, is the repeated <code>oss ++ [(offset&#39;, sz&#39;)]</code> which is inefficient. It would be better to use <code>(offset&#39;, sz&#39;) : oss</code> to build a reversed list and then finally reverse it once the loop is over. This will also let you avoid <code>last oss</code>, which is slow."}, {"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1434441263, "post_id": 30859457, "comment_id": 49765956, "body": "thanks for the suggestion, I&#39;ll try that."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1457337743, "creation_date": 1457337743, "answer_id": 35838832, "question_id": 30859457, "link": "https://stackoverflow.com/questions/30859457/better-way-to-write-loops-in-io/35838832#35838832", "title": "Better way to write loops in IO", "body": "<p><code>offsetSizes</code> is repeatedly fed some state (the <code>(offset, sz)</code> pair) to produce a new pair or finish. All the pairs created are collected into a list.</p>\n\n<p>This recursion scheme is captured by <a href=\"https://hackage.haskell.org/package/monad-loops-0.4.2.1/docs/Control-Monad-Loops.html#v:unfoldrM\" rel=\"nofollow\"><code>unfoldrM</code></a> from the <a href=\"https://hackage.haskell.org/package/monad-loops\" rel=\"nofollow\"><code>monad-loops</code></a> package, allowing you to write <code>offsetSizes</code> as</p>\n\n<pre><code>offsetSizes :: Int -&gt; BS.ByteString -&gt; IO [(Int, Int)]\noffsetSizes fLen bytes = unfoldrM step (0, 8)\n  where\n    step (offset, sz) = do\n        let offset' = offset + sz\n        sz' &lt;- size bytes offset'\n        let state' = (offset', sz')\n        return $ if offset' + sz' &lt; fLen then Just (state', state') else Nothing\n</code></pre>\n"}], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1457337743, "creation_date": 1434432571, "last_edit_date": 1434449836, "question_id": 30859457, "link": "https://stackoverflow.com/questions/30859457/better-way-to-write-loops-in-io", "title": "Better way to write loops in IO", "body": "<p>Given a png file, I am trying to get the list of its chunks' offset and sizes.</p>\n\n<p>In a nutshell, <a href=\"https://en.wikipedia.org/wiki/Portable_Network_Graphics#.22Chunks.22_within_the_file\" rel=\"nofollow\">png files</a> are made of chunks, and each chunk is made of three 4-byte fields plus one variable-length field (the chunk's data field). The size of the data field is stored in the first 4-byte field (called the \"length\" field).</p>\n\n<p>Therefore given the current chunk's offset and size, (ofs, sz), one derives the next chunk's offset and size, (ofs', sz'), that way :</p>\n\n<p>ofs' = ofs + sz</p>\n\n<p>read sz' at offset = ofs'</p>\n\n<p>Given the initial chunk's offset and size, always (0, 8) in png files, one can loop through the file until one reaches its end. That's how I did it :</p>\n\n<pre><code>import Data.Word\nimport qualified Data.ByteString.Lazy as BS\nimport Data.Binary.Get\n\nsize :: BS.ByteString -&gt; Int -&gt; IO (Int)\nsize bytes offset = do\n    let ln = runGet (do skip offset\n                        l &lt;- getWord32be\n                        return l)\n                    bytes\n    return $ 3*4 + fromIntegral ln\n\noffsetSizes :: Int -&gt; BS.ByteString -&gt; [(Int, Int)] -&gt; IO [(Int, Int)]\noffsetSizes fLen bytes oss = do\n        let (offset, sz) = last oss\n            offset' = offset + sz\n        sz' &lt;- size bytes offset'\n        let nextOffset = offset' + sz'\n        if nextOffset &lt; fLen then offsetSizes fLen bytes $ oss ++ [(offset', sz')]\n                              else return oss\nmain = do\n    contents &lt;- BS.readFile \"myfile.png\"\n    let fLen = fromIntegral $ BS.length contents :: Int\n\n    ofszs &lt;- offsetSizes fLen contents [(0,8)]\n    putStrLn $ \"# of chunks: \" ++ (show $ length ofszs)\n    putStrLn $ \"chunks [(offset,size)]: \" ++ show ofszs\n</code></pre>\n\n<p><strong>My question</strong> : I am not really satisfied with the loop. I was wondering whether there is a more idiomatic way to achieve the same in Haskell?</p>\n"}, {"tags": ["haskell", "fibonacci"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 6, "creation_date": 1434433389, "post_id": 30858449, "comment_id": 49761849, "body": "It doesn&#39;t just sit there... it also generates heat."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1434431354, "creation_date": 1434431354, "answer_id": 30859250, "question_id": 30858449, "link": "https://stackoverflow.com/questions/30858449/get-each-fibbonacci-value-in-haskell/30859250#30859250", "title": "Get each fibbonacci value in haskell", "body": "<p>Consider the simpler problem of summing the first 100 positive integers: </p>\n\n<pre><code>sum [x | x &lt;- [1,2..], x &lt;= 100]\n</code></pre>\n\n<p>This doesn't work either. As a human, you know that once <code>x &lt;= 100</code> returns False, it will never return True again, because <code>x</code> is getting larger. But Haskell doesn't know that! So this list comprehension produces the first 100 integers, then tries 101 and finds it doesn't work, then tries 102 and finds it doesn't work...there's no point at which <code>sum</code> can be sure there are no more elements in the list, so it can never return a number for you.</p>\n\n<p>Your list comprehension over <code>fib 1 2</code> has the same problem. You can resolve it by calling <code>take</code> or <code>takeWhile</code> separately, instead of using a guard on each element, as you demonstrate in your question.</p>\n"}], "owner": {"reputation": 3381, "user_id": 183753, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0f59545fe4b3d43c7e98710b0c17af9f?s=128&d=identicon&r=PG", "display_name": "Marconi", "link": "https://stackoverflow.com/users/183753/marconi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 30859250, "answer_count": 1, "score": 0, "last_activity_date": 1434448731, "creation_date": 1434426591, "last_edit_date": 1434448731, "question_id": 30858449, "link": "https://stackoverflow.com/questions/30858449/get-each-fibbonacci-value-in-haskell", "title": "Get each fibbonacci value in haskell", "body": "<p>I'm learning haskell and I have the following code:</p>\n\n<pre><code>fib a b =\n  a : fib b (a + b)\n\nfindFibSum =\n  sum [x | x &lt;- fib 1 2, mod x 2 == 0 &amp;&amp; x &lt; 100]\n</code></pre>\n\n<p>If I run <code>findFibSum</code> nothing happens, it just sits there. Shouldn't <code>fib</code> be evaluated and return each item? I'm guessing this has something to do with lazy evaluation.</p>\n\n<p>If I call <code>take</code> first and make <code>findFibSum</code> accept the taken list like:</p>\n\n<pre><code>findFibSum $ take 100 $ fib 1 2\n</code></pre>\n\n<p>it works instead. How do I make it so that I can retrieve and check each item instead? I can probably get away by taking by batch using <code>take</code> but I'd like to understand this first.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Thanks to @amalloy i finally got it working with:</p>\n\n<pre><code>findFibSum xs =\n  sum [x | x &lt;- takeWhile (&lt;4000000) xs, mod x 2 == 0]\n</code></pre>\n\n<p><code>takeWhile</code> ensures that it'll stop retrieving value from fib once it gets >= 4m.</p>\n"}, {"tags": ["haskell", "dictionary", "count", "frequency"], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 2370458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91202a8ede068abbe8fd21450f467de?s=128&d=identicon&r=PG", "display_name": "KJ4TIP", "link": "https://stackoverflow.com/users/2370458/kj4tip"}, "is_accepted": true, "score": 3, "last_activity_date": 1434419757, "last_edit_date": 1434419757, "creation_date": 1434419452, "answer_id": 30857623, "question_id": 30857473, "link": "https://stackoverflow.com/questions/30857473/frequency-count-in-haskell/30857623#30857623", "title": "Frequency Count in Haskell", "body": "<p>Here's a possible solution:</p>\n\n<pre><code>import Data.List\n\ngroupsOf n str =\n  unfoldr (\\s -&gt;\n            if length s &lt; n\n            then Nothing\n            else Just (take n s, tail s)) str\n\nfrequency :: (Ord t, Eq t) =&gt; [t] -&gt; [(t, Int)]\nfrequency =\n  map (\\s -&gt; (head s, length s)) . group . sort\n</code></pre>\n\n<p><code>groupsOf</code> splits an input string into overlapping sequences of length n.  For example,</p>\n\n<pre><code>groupsOf 3 \"AABCABC\"\n</code></pre>\n\n<p>would give</p>\n\n<pre><code>[\"AAB\", \"ABC\", \"BCA\", \"CAB\", \"ABC\"].  \n</code></pre>\n\n<p><code>frequency</code> then will count the occurrences of each subsequence, so</p>\n\n<pre><code>frequency $ groupsOf 3 \"AABCABC\"\n</code></pre>\n\n<p>should give </p>\n\n<pre><code>[(\"AAB\", 1), (\"ABC\", 2), (\"BCA\", 1), (\"CAB\", 1)].\n</code></pre>\n\n<p>Any subsequence that does not appear in the result occurred zero times.</p>\n"}], "owner": {"reputation": 235, "user_id": 1391818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/152caacacafa684490ab5cfd0be51a26?s=128&d=identicon&r=PG", "display_name": "Koborl", "link": "https://stackoverflow.com/users/1391818/koborl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 944, "favorite_count": 1, "accepted_answer_id": 30857623, "answer_count": 1, "score": 0, "last_activity_date": 1434419757, "creation_date": 1434417971, "question_id": 30857473, "link": "https://stackoverflow.com/questions/30857473/frequency-count-in-haskell", "title": "Frequency Count in Haskell", "body": "<p>So The task i'm trying to accomplish is to get a frequency list of all possible patterns of length n from a string s.</p>\n\n<pre><code>Input (Text,Length) \nOutput (Frequency)\nString -&gt; Int -&gt; [Int]\nfreqCount s n = frequency list [int] in alphabetical order\n</code></pre>\n\n<p>[\"A\",\"B\",\"C\",\"D\"]</p>\n\n<p>where the characters in s are limited to the four mentioned above, so I figured first step would be to get all the possible permutations of length n with repetitions allowed.</p>\n\n<pre><code>permutationsR k = sort(replicateM k ['A','B','C','D'])\n</code></pre>\n\n<p>eg. </p>\n\n<pre><code>permutationsR 2 \n</code></pre>\n\n<p>would give the output</p>\n\n<pre><code> [\"AA\",\"AB\",\"AC\",\"AD\",\"BA\",\"BB\",\"BC\",\"BD\",\"CA\",\"CB\",\"CC\",\"CD\",\"DA\",\"DB\",\"DC\",\"DD\"]\n</code></pre>\n\n<p>and then for each pattern get a count of how many times each occurred\nso something like</p>\n\n<pre><code>patternCount:: String -&gt; String -&gt; Int\npatternCount text pattern = length (filter (\\x -&gt; x == pattern) [take (length(pattern)) (drop x text)| x &lt;- [0..length(text)- length(pattern)]])\nfrequencyCount s n = map (\\x -&gt; patternCount s x) (permutationsR n)\n</code></pre>\n\n<p>However i figure this is going to be extremely inefficient because I am essentially going through the entire list to check for each pattern length(permutationsR n) times instead of what I reason should be possible to do in only one iteration.</p>\n\n<p>Is there a way to generate a frequency map like i would in an imperative language.</p>\n\n<p>i.e. in pseudocode</p>\n\n<pre><code>where s = string\nand n = length of pattern\n//pattern is a map where key = pattern and value = frequencyCount\n\npatterns = {\"AA\":0,\"AB\":0,\"AC:0...}\nfor (i = 0; i &lt; (length s - n); i++){\n    patterns[s[i:(i+n)]] += 1\n}\n</code></pre>\n\n<p>basically just iterating through once, splitting the string from (i:i+n)\nand updating the patterns map with each occurence.</p>\n\n<p>example input,output would be something like this</p>\n\n<pre><code>s= \"AABBCA\"\nn = 2\nfrequencyList s n = [1,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0]\n</code></pre>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "edited": false, "score": 0, "creation_date": 1434412083, "post_id": 30855004, "comment_id": 49756697, "body": "Thanks for the response. So that definitely makes a lot of sense and helps. It still feels a little weird, mainly because my module is exposing a data type from  a 3rd party module. If I wanted to swap out my parsing library, ideally I&#39;d only have to change it in my parser, and no other module would have to care or even notice the change."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "reply_to_user": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "edited": false, "score": 4, "creation_date": 1434420154, "post_id": 30855004, "comment_id": 49758542, "body": "Well, if you want to be able to swap parsing library, you shouldn&#39;t use library specific ParseError as an output of your parsing function. If you don&#39;t use it, then your problem would also be solved as there&#39;ll be nothing to reexport."}, {"owner": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "edited": false, "score": 0, "creation_date": 1434480563, "post_id": 30855004, "comment_id": 49792799, "body": "So what would that look like? Would the mean creating my own error, catching any <code>ParseError</code>s, and then instead returning my own error type? I guess that&#39;s what I what sort of wondering in the first place - is that a standard practice?"}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "reply_to_user": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "edited": false, "score": 1, "creation_date": 1434496085, "post_id": 30855004, "comment_id": 49800462, "body": "I don&#39;t think there is a standard practise here, but providing your own error type makes a lot of sense. For example if your config file consists of statements in a format &quot;key = value&quot; where key starts with [a-z] the user of your module would prefer to get a specific error <code>InvalidKey &quot;1mykey&quot;</code> rather than meaningless (in terms of DBConfig) Parsec&#39;s message."}], "tags": [], "owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "is_accepted": true, "score": 7, "last_activity_date": 1434402499, "creation_date": 1434402499, "answer_id": 30855004, "question_id": 30854359, "link": "https://stackoverflow.com/questions/30854359/best-practice-for-handling-data-types-from-3rd-party-libraries-in-haskell/30855004#30855004", "title": "Best practice for handling data types from 3rd party libraries in Haskell?", "body": "<p>I am not ready to give a nice list of best practises, but for starters if you want to keep stuff sanely organized, use explicit exports instead of just exporting everything, e.g:</p>\n\n<pre><code>module Parser\n  ( parseConfig\n  ) where\n...\n</code></pre>\n\n<p>Explicit exports also allow you to reexport your imports, e.g.</p>\n\n<pre><code>module Parser\n  ( parseConfig\n  , ParseError(..)\n  ) where\n...\n</code></pre>\n\n<p>After that you can just <code>import Parser</code>, and have <code>ParseError</code> available as if it was defined inside <code>Parser</code>.</p>\n\n<p>I think this should solve your immediate problem.</p>\n"}], "owner": {"reputation": 621, "user_id": 3126392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc2e724afb363fd82e4ae96c536d1dc?s=128&d=identicon&r=PG&f=1", "display_name": "tydotg", "link": "https://stackoverflow.com/users/3126392/tydotg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 30855004, "answer_count": 1, "score": 2, "last_activity_date": 1434402499, "creation_date": 1434399902, "question_id": 30854359, "link": "https://stackoverflow.com/questions/30854359/best-practice-for-handling-data-types-from-3rd-party-libraries-in-haskell", "title": "Best practice for handling data types from 3rd party libraries in Haskell?", "body": "<p>I'm just getting into my first real Haskell project of size (a web app), and I'm starting to run into issues with types from 3rd party libraries leaking all over my code. Here is a quick example:</p>\n\n<p>My <code>Parser</code> module imports <code>Test.Parsec</code>, and the exports a function (<code>parseConfig</code>) that returns <code>Either ParseError DbConfig</code>, where <code>ParseError</code> is a data type defined in the <code>Parsec</code> library (<code>DbConfig</code> is a custom data type for my app, not shown for brevity).</p>\n\n<pre><code>-- Parser.hs\nmodule Parser where\n\nimport Text.Parsec\n\nparseConfig :: String -&gt; Either ParseError DbConfig\nparseConfig = parse ...\n</code></pre>\n\n<p>Later, I want to use my <code>parseConfig</code> function, but in order to use it, I have to import <code>Text.Parsec</code> again so that I have access to the <code>ParseError</code> type.</p>\n\n<pre><code>-- Api.hs\nmodule Api where\n\nimport Parser\nimport Text.Parsec\n\ngetConfigFromBody :: Object -&gt; Either ParseError DbConfig\ngetConfigFromBody = parseConfig . (...)\n</code></pre>\n\n<p>This is not only a hassle as far as managing imports goes, but also a poor separation of concerns, so right of the bat I know this isn't the best way to do it. My question is, what is the best practice for managing this issue? Would making a type synonym be ideal?</p>\n\n<pre><code>type ConfigParseError = ParseError\n\nparseConfig :: String -&gt; Either ConfigParseError DbConfig\nparseConfig = parse ...\n</code></pre>\n\n<p>This seems reasonable insofar as keeping the <code>Parsec</code> the dependency internal to my <code>Parser</code> module, but aliasing library types seems like a strange pattern to use by default. </p>\n\n<p>So my question is, how do larger Haskell apps or libraries handle this? Is there a general technique for managing data types from 3rd party libraries?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1434398697, "post_id": 30853910, "comment_id": 49751439, "body": "If all you want a sequence of <code>[1,2,3...]</code>, then you can have <code>n, n+1, ...</code> sequence."}], "answers": [{"comments": [{"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1434399137, "post_id": 30854126, "comment_id": 49751708, "body": "Thanks for the answer. I know I can do it by calling another function. But I am trying to think of something smart so that I don&#39;t have to...if thats possible."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1434408220, "post_id": 30854126, "comment_id": 49755660, "body": "@xcoder you almost certainly <i>can</i> (combining functions like <code>fix</code>, <code>maybe</code>, <code>fst</code>, <code>snd</code>, <code>uncons</code>, <code>zipWith</code>, etc.), but whyyyy?"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 1, "last_activity_date": 1434399833, "last_edit_date": 1434399833, "creation_date": 1434398972, "answer_id": 30854126, "question_id": 30853910, "link": "https://stackoverflow.com/questions/30853910/keep-track-of-loop-without-a-counter/30854126#30854126", "title": "Keep track of loop without a counter", "body": "<p>You can certainly do this without changing the type signature of <code>func :: [Int] -&gt; [Int]</code>: have <code>func</code> call a different function, which takes an extra argument that is the counter you were talking about:</p>\n\n<pre><code>func :: [Int] -&gt; [Int]\nfunc = go 0\n  where go _ [] = []\n        go _ [x] = []\n        go n (a:b:xs) = n : a : b : go (succ n) xs\n\nfunc [11,12..20]\n[0,11,12,1,13,14,2,15,16,3,17,18,4,19,20]\n</code></pre>\n\n<p>If you are determined to do this without managing the counter variable yourself, you can do something more contorted, such as zipping your input list into 3-tuples <code>(a,b,n)</code>, where <code>a</code> and <code>b</code> are pairs of items from your input list and <code>n</code> comes from <code>[1,2..]</code>.</p>\n\n<pre><code>pairs :: [a] -&gt; [(a,a)]\npairs [] = []\npairs [_] = []\npairs (a:b:xs) = (a,b) : pairs xs\n\nfunc' :: [Int] -&gt; [Int]\nfunc' xs = concat $ zipWith (\\n (a,b) -&gt; [n,a,b]) [1,2..] $ pairs xs\n\nfunc' [11,12..20]\n[1,11,12,2,13,14,3,15,16,4,17,18,5,19,20]\n</code></pre>\n\n<p>This is quite a bit less readable in my opinion, and I would suggest you just do the easy, obvious thing in my first snippet.</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 0, "last_activity_date": 1434425600, "last_edit_date": 1434425600, "creation_date": 1434415567, "answer_id": 30857191, "question_id": 30853910, "link": "https://stackoverflow.com/questions/30853910/keep-track-of-loop-without-a-counter/30857191#30857191", "title": "Keep track of loop without a counter", "body": "<p>Ok, here's another solution:</p>\n\n<pre><code>func :: [a] -&gt; [Int]\nfunc (_:_:as) = 1 : map (+1) (func as)\nfunc _ = []\n</code></pre>\n\n<p>I'm a bit unclear what you want the base cases to be, so I guessed you wanted <code>func [] = []</code> and <code>func [_] = []</code>.  Correct me if I'm wrong, please.</p>\n\n<p>Working through your 10 element list example:</p>\n\n<pre><code>func ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j'] = \n1 : map (+1) (func ['c', 'd', 'e', 'f', 'g', 'h', 'i', 'j']) = \n1 : map (+1) (1 : map (+1) (func ['e', 'f', 'g', 'h', 'i', 'j'])) = \n1 : map (+1) (1 : map (+1) (1 : map (+1) (func ['g', 'h', 'i', 'j']))) = \n1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : map (+1) (func ['i', 'j'])))) = \n1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : map (+1) (func []))))) = \n1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : map (+1) [])))) = \n1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : [])))) = \n1 : map (+1) (1 : map (+1) (1 : map (+1) (1 : 2 : []))) = \n1 : map (+1) (1 : map (+1) (1 : 2 : 3 : [])) = \n1 : map (+1) (1 : 2 : 3 : 4 : [])) = \n1 : 2 : 3 : 4 : 5 : []) = \n[1,2,3,4,5]\n</code></pre>\n"}], "owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 30854126, "answer_count": 2, "score": -1, "last_activity_date": 1434425600, "creation_date": 1434398249, "question_id": 30853910, "link": "https://stackoverflow.com/questions/30853910/keep-track-of-loop-without-a-counter", "title": "Keep track of loop without a counter", "body": "<p>Say, I got a list which length can be odd or even. Every iteration , I remove two items from the list. If there is one or no item at the end, I end the execution.</p>\n\n<p>If I store (length list)/2 every loop, I will get e.g. [5,4,3...] for a list of length 10.</p>\n\n<p>But what I want is [1,2,3,...] and I couldn't figure out a relationship between the list size and this sequence...</p>\n\n<p>Is there a way to achieve this without having a variable storing the current count? </p>\n\n<p>i.e. with <code>func :: [Int] -&gt; [Int]</code> only</p>\n"}, {"tags": ["haskell", "functional-programming", "system.reactive", "reactive-programming", "rx-java"], "comments": [{"owner": {"reputation": 44043, "user_id": 1565698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7dace33805b9dcdec5aa63308daf88dc?s=128&d=identicon&r=PG", "display_name": "Sylwester", "link": "https://stackoverflow.com/users/1565698/sylwester"}, "edited": false, "score": 0, "creation_date": 1434393756, "post_id": 30852250, "comment_id": 49748640, "body": "This is more theory than a practical problem. Perhaps <a href=\"http://cs.stackexchange.com/\">CSSE</a> is better suited?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1434403193, "post_id": 30852250, "comment_id": 49753716, "body": "I don&#39;t think the question makes much sense as it&#39;s written. While reactive libraries try to be as general as possible, they usually are designed with particular kinds of domains in mind. For example, you have the netwire library for haskell that assumes most things are continuous values with the occasional need for events, whereas some other library might place a lot more emphasis on events and supply an abstraction on top of those allowing you to treat values as if they were continuous. It might simply be your domain doesn&#39;t fit the model this library is providing very well."}, {"owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1434438016, "post_id": 30852250, "comment_id": 49763962, "body": "@Cubic I didn&#39;t think about time-continuous frame-works. I&#39;ll exclude them from the question, as this might differ much from the discrete case. Otherwise I have to disagree with your assumption that the library did not fit my usecase \u2013 it fit perfectly well but was merely lacking some special functions (but maybe it wasn&#39;t)."}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1434440448, "post_id": 30852250, "comment_id": 49765470, "body": "I don&#39;t think that <code>Observable</code> can be an instance of <code>Foldable</code> -- you can&#39;t fold over <i>all</i> values that have occurred, because there may be infinitely many!"}, {"owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1434441249, "post_id": 30852250, "comment_id": 49765946, "body": "@HeinrichApfelmus Does this mean you cannot <code>fold</code> over an infinite <code>List</code>, too?"}, {"owner": {"reputation": 1683, "user_id": 3161142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/okk7A.png?s=128&g=1", "display_name": "Samuel Gruetter", "link": "https://stackoverflow.com/users/3161142/samuel-gruetter"}, "edited": false, "score": 1, "creation_date": 1434442309, "post_id": 30852250, "comment_id": 49766504, "body": "If you like thinking in terms of <code>Foldable</code>, <code>Applicative</code>, <code>Monad</code>, etc, you might like <a href=\"https://github.com/everpeace/rxscalaz\" rel=\"nofollow noreferrer\">rxscalaz</a>."}, {"owner": {"reputation": 1683, "user_id": 3161142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/okk7A.png?s=128&g=1", "display_name": "Samuel Gruetter", "link": "https://stackoverflow.com/users/3161142/samuel-gruetter"}, "edited": false, "score": 1, "creation_date": 1434442497, "post_id": 30852250, "comment_id": 49766606, "body": "And BTW a third possible implementation of the monadic join would be <code>concatMap</code>..."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 1683, "user_id": 3161142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/okk7A.png?s=128&g=1", "display_name": "Samuel Gruetter", "link": "https://stackoverflow.com/users/3161142/samuel-gruetter"}, "edited": false, "score": 0, "creation_date": 1434444082, "post_id": 30852250, "comment_id": 49767565, "body": "@SamuelGruetter: Could we see an example/explanation for <code>concatMap</code>?"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1434472813, "post_id": 30852250, "comment_id": 49788229, "body": "@ziggystar what did you use to create those graphics?"}, {"owner": {"reputation": 34013, "user_id": 674326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb1ffcb8355a833bc34334d75cefeb3d?s=128&d=identicon&r=PG", "display_name": "Brandon", "link": "https://stackoverflow.com/users/674326/brandon"}, "edited": false, "score": 0, "creation_date": 1434474693, "post_id": 30852250, "comment_id": 49789318, "body": "besides <code>concatMap</code>, there&#39;s also <code>exclusiveMap</code> (throwaway new inner observables while you are processing the current inner observable...sort of the opposite of <code>switch</code>).  <code>concatMapLatest</code>, like <code>exclusiveMap</code> but keep the last inner observable observed while processing the current inner observable, and once the current one finishes, switch to that last one`."}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1434528830, "post_id": 30852250, "comment_id": 49811690, "body": "@ziggystar That&#39;s correct, it&#39;s not possible to fold over an infinite list. Otherwise, what would <code>sum [1..]</code> be? It is possible to fold over finite lists, of course, but the thing is that <code>Observable</code>s are never finite -- at least not until the program ended. The best you can do is <code>scanl</code>."}, {"owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1434531857, "post_id": 30852250, "comment_id": 49813690, "body": "@HeinrichApfelmus Well, in rxscala, observables can indeed end. And if you <code>fold</code> over such a case, you will receive a result once the observable terminates; it follows that <code>fold :: (X -&gt; Y -&gt; X) -&gt; X -&gt; O Y -&gt; O X</code>, note the result type. I admit that&#39;s not the ordinary type of <code>fold</code>."}], "answers": [{"comments": [{"owner": {"reputation": 34013, "user_id": 674326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb1ffcb8355a833bc34334d75cefeb3d?s=128&d=identicon&r=PG", "display_name": "Brandon", "link": "https://stackoverflow.com/users/674326/brandon"}, "edited": false, "score": 0, "creation_date": 1434552992, "post_id": 30885392, "comment_id": 49829552, "body": "Thanks for this.  I was looking for this article and could not find it"}, {"owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "edited": false, "score": 0, "creation_date": 1434612995, "post_id": 30885392, "comment_id": 49856180, "body": "I&#39;ve skimmed over the article, and now I&#39;m a bit disappointed. Apparently the author is merely explaining monads and some useful related concepts. He doesn&#39;t address the problems mentioned in the OP (e.g. multiple sane definitions of <code>join</code>)."}], "tags": [], "owner": {"reputation": 841, "user_id": 1714634, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a16634c1e33b2b3bb2059b4ed2ea937?s=128&d=identicon&r=PG", "display_name": "Daniel C. Weber", "link": "https://stackoverflow.com/users/1714634/daniel-c-weber"}, "is_accepted": false, "score": 3, "last_activity_date": 1434527318, "creation_date": 1434527318, "answer_id": 30885392, "question_id": 30852250, "link": "https://stackoverflow.com/questions/30852250/is-there-a-complete-set-of-functions-operators-for-frp/30885392#30885392", "title": "Is there a &quot;complete&quot; set of functions/operators for FRP?", "body": "<p>Check out <a href=\"http://blogs.bartdesmet.net/blogs/bart/archive/2010/01/01/the-essence-of-linq-minlinq.aspx\" rel=\"nofollow\">this blog post</a> and <a href=\"http://channel9.msdn.com/Shows/Going+Deep/Bart-De-Smet-MinLINQ-The-Essence-of-LINQ\" rel=\"nofollow\">this video</a>. There, Bart de Smet proposes a minimal set of operations that can build every other operator there is. I guess, for performance reasons, one should probably not try to implement every operator there is by the basic operators but it's an interesting exercise to try for some.</p>\n"}], "owner": {"reputation": 26323, "user_id": 108915, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a00512b12118ebd20d2043802b38bd02?s=128&d=identicon&r=PG", "display_name": "ziggystar", "link": "https://stackoverflow.com/users/108915/ziggystar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 0, "answer_count": 1, "score": 12, "last_activity_date": 1434527318, "creation_date": 1434392380, "last_edit_date": 1592644375, "question_id": 30852250, "link": "https://stackoverflow.com/questions/30852250/is-there-a-complete-set-of-functions-operators-for-frp", "title": "Is there a &quot;complete&quot; set of functions/operators for FRP?", "body": "<p>Functional Reactive Programming is an approach to specify side-effecting programs in a pure functional way.</p>\n<p>Recently I've been using rxscala, which is the Java/Scala port port of ReactiveX. It is based around the concept of <code>Observable</code>s that can be regarded as streams of values of a certain type.</p>\n<p><strong>For this question I want to exclude FRP approaches that handle time-continuous changes (signals).</strong></p>\n<h2>Building new Observables from old ones</h2>\n<p>These Observables can be combined using a wealth of different functions to create new observables. These are similar to the functions that can be applied to collections. And those are already quite well understood, as we know <code>Foldable</code>, <code>Traversable</code>, <code>Applicative</code>, <code>Monads</code> and the like.</p>\n<p>Indeed observables are foldable, traversable monads, like ordinary collections. But these traits can be implemented in multiple ways for observables, as an observable holds much more information (the timing information for each element) than an ordinary collection. And the result also has to be fitted with timing information.</p>\n<h2>Two Monad implementations</h2>\n<p>For example the monadic <code>join</code> (<code>flatMap</code> in Scala) can be implemented in at least two different, plausible ways:</p>\n<ul>\n<li><p>By <code>switch</code>ing between the nested observables, which results in truncating the currently active observable, once the next one begins emission, or</p>\n<p><a href=\"http://reactivex.io/documentation/operators/images/switch.c.png\" rel=\"nofollow noreferrer\">RxJava Switch Visualization http://reactivex.io/documentation/operators/images/switch.c.png</a></p>\n</li>\n<li><p>by <code>merge</code>ing the nested observables without dropping or delaying any events.</p>\n<p><a href=\"http://reactivex.io/documentation/operators/images/mergeDelayError.C.png\" rel=\"nofollow noreferrer\">RxJava Merge Visualization http://reactivex.io/documentation/operators/images/mergeDelayError.C.png</a></p>\n</li>\n<li><p>... and much much more (see the comments)</p>\n</li>\n</ul>\n<h2>Limitations</h2>\n<p>I'm very pleased with the provided repertoire of combinator functions, but I keep running into situations where I'm not able to achieve what I want, and I have to fall back to some kind of concurrent programming.</p>\n<h2>Missing combinators or brains?</h2>\n<p>Now I'm wondering whether I'm just too stupid to construct the desired behavior using existing combinators. Or is it the case that the combinator functions available in rxscala are not sufficient to create every imaginable behavior?</p>\n<h1>Question</h1>\n<p>I'm asking for a proof that some basic set of combination functions <code>B</code> is enough to create &quot;every conceivable observable&quot; from some input observables.</p>\n<p>Possibly the hardest part might be the definition of &quot;every conceivable observable&quot;.\nMaybe the Haskell community has produced something like this?</p>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 11, "creation_date": 1434391196, "post_id": 30851650, "comment_id": 49747248, "body": "<a href=\"https://hackage.haskell.org/package/text-1.2.1.1/docs/Data-Text-Lazy-Builder.html\" rel=\"nofollow noreferrer\"><code>Builder</code></a> is specifically for this purpose."}, {"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434392021, "post_id": 30851650, "comment_id": 49747669, "body": "That&#39;s a good point, but I am working on a code base that is already heavily using non-lazy text appends. I wonder if there is a quick &amp; easy fix for that or not."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1434402314, "post_id": 30851650, "comment_id": 49753307, "body": "You could also use lists or DLists of Text-s, and then concatenate after you&#39;ve done building. If you can&#39;t separate building and concatenating, and definitely need appends, then probably Text isn&#39;t the right structure for the job."}, {"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434411050, "post_id": 30851650, "comment_id": 49756443, "body": "I have lots of substring replacement, e.g., replace <code>%key%i%</code> with <code>value-i</code> in a million Text instances. I have tens of such replacement rules. These can easily be replaces by <code>concat</code> of list of Texts or lazy Texts or Builders or whatever. My question is that if I can use <a href=\"https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/rewrite-rules.html\" rel=\"nofollow noreferrer\">GHC rewrite rules</a> to replace <code>append</code>s with <code>concat</code>s, and if it is a good idea if possible at all."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 3, "creation_date": 1434437131, "post_id": 30851650, "comment_id": 49763503, "body": "I think simply replacing <code>append</code>-s by <code>concat</code> in the source is definitely better than rewrite rules. Rewrite rules is a rather intricate feature meant for library writers who would like to provide optimizations for users without exposing the plumbing. In production code they&#39;d just add complexity and obscure the semantics as it is in the code."}, {"owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1435601759, "post_id": 30851650, "comment_id": 50257936, "body": "@Andr&#225;sKov&#225;cs: I updated the source code and replace most of the text building functionality with <code>Lazy Text Builder</code>s. Now, about 12 percent of the program runtime is in <a href=\"https://hackage.haskell.org/package/text-1.2.1.1/docs/src/Data-Text-Internal-Fusion.html#unstream\" rel=\"nofollow noreferrer\"><code>unstream&#47;resize</code></a> block. I wonder if there is a way to optimize this one? I guess the answer is no."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1457340166, "post_id": 30851650, "comment_id": 59344942, "body": "Rewrite rules are pretty tricky, and not the most reliable things in general."}], "owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 510, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1457337931, "creation_date": 1434390353, "last_edit_date": 1457337931, "question_id": 30851650, "link": "https://stackoverflow.com/questions/30851650/text-append-performance-in-haskell", "title": "Text append performance in Haskell", "body": "<p>I realized that appending multiple instances of <code>Text</code> in Haskell is much slower than concatenating a list of texts. For instance, <code>T.concat [\"'\", txt, \"'\"]</code> is almost twice faster than</p>\n\n<pre><code>\"'\" `T.append` txt `T.append` \"'\"\n</code></pre>\n\n<p>This is because any <code>append</code> actually creates a new intermediate instance of <code>Text</code>, while <code>concat</code> makes a single instance.</p>\n\n<p>I am working on a project that does a lot of text appends.\nI wonder if there is a simple way to optimize such cases?\nOne option is to replace all such occurrences by hand.\nThe other option is to use GHC rewriting rules to convert them to the <code>concat</code> form.\nIs the rewriting rule a reasonable option? How can I write such a rule then?\nWhat are the other options?</p>\n"}, {"tags": ["list", "parsing", "haskell", "ubuntu"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1434389923, "post_id": 30851379, "comment_id": 49746546, "body": "It looks like the differences start before it reaches <code>mapMaybe</code>/<code>catMaybes</code>. The number of lines read from the file is different."}, {"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 2, "creation_date": 1434390324, "post_id": 30851379, "comment_id": 49746760, "body": "I&#39;ve tried your code on my Ubuntu machine. With a sample line in a text file the filter works fine. Are you sure the files on your ubuntu machine follow the same format?  For example, do they have a non empty note field?"}, {"owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "edited": false, "score": 0, "creation_date": 1434399039, "post_id": 30851379, "comment_id": 49751643, "body": "Yeah, now I really feel stupid. In my haste to get this written up, I did use the wrong input file on my Windows machine. I have corrected that error and edited the OP to reflect that corrected result. I have been told that what I am reporting is not possible, and I agree. I am told that there must be some difference in the input files that explains the difference in output. In the last example, I copied the code and input file from my Windows laptop to that Ubuntu server; therefore, I am confident they are the same. wc -l on the input file confirms the line count. Thank for the comments."}], "answers": [{"tags": [], "owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "is_accepted": false, "score": 7, "last_activity_date": 1434400965, "creation_date": 1434400965, "answer_id": 30854624, "question_id": 30851379, "link": "https://stackoverflow.com/questions/30851379/mapmaybes-catmaybe-working-different-in-windows-and-ubuntu/30854624#30854624", "title": "mapMaybes / catMaybe working different in Windows and Ubuntu", "body": "<p>And the answer is...</p>\n\n<p>Windows vs Unix line endings.</p>\n\n<p>I added code to print out the first few lines of input and saw the \\r on the end of each line. I ran the file through dos2unix. Now I get the same results on the Ubuntu system.</p>\n\n<p>Thank you for pointing me to the input file as the source of the problem.</p>\n"}], "owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1434400965, "creation_date": 1434389467, "last_edit_date": 1434398920, "question_id": 30851379, "link": "https://stackoverflow.com/questions/30851379/mapmaybes-catmaybe-working-different-in-windows-and-ubuntu", "title": "mapMaybes / catMaybe working different in Windows and Ubuntu", "body": "<p>I have a Haskell program that reads the content of an input file and parses it to sort and remove duplicates. This program has been dormant for some time now, and I have a need to resurrect it. I tell you this just for some historical context on the problem.</p>\n\n<p>When I re-enabled the program, I found that it was not working. My debugging has isolated the problem to the code that parses and \"cleans\" the input file. What happens after this is insignificant to this problem, since I end up with an empty list of candidate records from the input file.</p>\n\n<p>I write and test this program on my Windows laptop, then deploy and build the source on the Ubuntu server where is needs to run. As part of my debugging, I have broken the text parsing into several descreet steps, and the part where is runs catMaybe on the output of the last step is where I get the empty list, but only when I run it on the Ubuntu server.</p>\n\n<p>Here is the source in main that demonstrates the problem:</p>\n\n<pre><code>    main = do\n        [ inFileName ] &lt;- getArgs\n        sFile &lt;- readFile inFileName\n        let lrec = lines sFile\n        putStrLn $ \"Number of lines read from the file: \" ++ show (length lrec)\n        let prec = map processLine lrec\n        putStrLn $ \"Number of processed lines is \" ++ show (length prec)\n        -- let persons = mapMaybe processLine lrec\n        let persons = catMaybes prec\n        putStrLn $ \"Number of filtered person records: \" ++ show (length persons)\n        let records = sortBy (compare `on` personEmployeeID) persons\n        putStrLn $ \"Number of records read and sorted is \" ++ show (length records)\n\n        {-\n            Compare and warn about employees with duplicate records.\n        -}\n        let srec = groupBy ((==) `on` personEmployeeID) records\n        putStrLn $ \"Number of unique record groups is \" ++ show (length srec)\n        let dups = map (personEmployeeID . head) $ filter ((&gt; 1) . length) srec\n        putStrLn $ \"Number of dups: \" ++ show (length dups)\n        unless (null dups) $ putStrLn $ \"WARNING: Duplicate employees: \" ++ show dups\n\n        -- Remove the duplicates\n        let cleanedRecords = map head srec\n        putStrLn $ \"Number of records in cleanedRecords is \" ++ show (length cleanedRecords)\n</code></pre>\n\n<p>As you may noticed from the commented line, I tried this using mapMaybe in place of catMaybes with no change whatsoever in the results. And here is the code from the processLine method where the comment shows the format of the input records:</p>\n\n<pre><code>    {-\n        Splits a line of the input file into fields.  The format includes 11 columns,\n        separated by semicolons.  The 10th columns is required to be 'A' or 'S',\n        indicating the user is active or short-term; otherwise we ignore that line.\n\n        Sample Line:\n        ------------------------------------------------------------------------------------------------------------------------------------------------\n        99XXXXX17;MXXX                          ;TXXXXX         ;MIXXXXXX                      ;RAA  CBP;RAA;19910929;19910929;19910929;A;             ;\n        ------------------------------------------------------------------------------------------------------------------------------------------------\n        emp id   ;first name                    ;middle name    ;last name                     ;loc code;dpt;hiredate;servdate;statdate;s;note         ;\n        ------------------------------------------------------------------------------------------------------------------------------------------------\n\n        * s = status\n    -}\n    processLine :: String -&gt; Maybe Person\n    processLine line = \n        let (_ :: String, _ :: String, _ :: String, result) = \n                line =~ \"^(.+);(.+);(.+);(.+);(.+);(.+);(.+);(.+);(.+);(A|S);(.+);$\" \n        in case result of\n            [empid, fname, mname, lname, lcode, dept, hdate, srvdate, stdate, status, note]\n                -&gt; Just $ Person empid (trim fname) (trim mname) (trim lname)\n                                 (trim lcode) dept hdate srvdate stdate  (readStatus status) (trim note)\n            _   -&gt; Nothing\n</code></pre>\n\n<p>When I run this code on my windows laptop, it produces the following output:</p>\n\n<pre><code>    Number of lines read from the file: 47793\n    Number of processed lines is 47793\n    Number of filtered person records: 32993\n    Number of records read and sorted is 32993\n    Number of unique record groups is 32949\n    Number of dups: 44\n    WARNING: Duplicate employees: [ {List removed for privacy } ]\n    Number of records in cleanedRecords is 32949\n    C:&gt;cabal --version\n    cabal-install version 1.22.4.0\n    using version 1.22.3.0 of the Cabal library\n    C:&gt;ghc --version\n    The Glorious Glasgow Haskell Compilation System, version 7.8.3\n</code></pre>\n\n<p>When I run the same code against the same input file on either of two different Ubuntu servers, each with a different version of Ubuntu and Haskell, I get the following output:</p>\n\n<pre><code>    Number of lines read from the file: 47793\n    Number of processed lines is 47793\n    Number of filtered person records: 0\n    Number of records read and sorted is 0\n    Number of unique record groups is 0\n    Number of dups: 0\n    Number of records in cleanedRecords is 0\n    xx:~/$ cabal --version\n    cabal-install version 0.14.0\n    using version 1.14.0 of the Cabal library\n    xx:~/$ ghc --version\n    The Glorious Glasgow Haskell Compilation System, version 7.4.1\n</code></pre>\n\n<p>...and from another Ubuntu server:</p>\n\n<pre><code>    Number of lines read from the file: 47793\n    Number of processed lines is 47793\n    Number of filtered person records: 0\n    Number of records read and sorted is 0\n    Number of unique record groups is 0\n    Number of dups: 0\n    Number of records in cleanedRecords is 0\n    yy:~/$ cabal --version\n    cabal-install version 0.10.2\n    using version 1.10.2.0 of the Cabal library\n    yy:~/$ ghc --version\n    The Glorious Glasgow Haskell Compilation System, version 7.6.1\n</code></pre>\n\n<p>As usual, I am baffled. I am ready to try anything.</p>\n\n<p>Any ideas?</p>\n\n<p>Dave</p>\n"}, {"tags": ["class", "haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1434381758, "post_id": 30848899, "comment_id": 49741506, "body": "What are you trying to achieve by writing <code>class (+) (Tree a) where</code>?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1434382504, "post_id": 30848899, "comment_id": 49742055, "body": "My understanding of your homework is that you have to write a <code>Num</code> instance for <code>Tree a</code>. You probably do not want to write a class declaration, here. However, if my guess is correct, you will also have to implement the other methods required for a <code>Num</code> instance declaration; see <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#g:7\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#g&zwnj;&#8203;:7</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1434382926, "post_id": 30848899, "comment_id": 49742354, "body": "<code>(Tree a) (Tree a) -&gt; ...</code> should also be <code>(Tree a) -&gt; (Tree a) -&gt; ...</code>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1434383015, "post_id": 30848899, "comment_id": 49742407, "body": "And <code>instance (Num a) =&gt; (+) (Tree a) (Tree a)</code> should probably be <code>instance (Num a) =&gt; Num (Tree a)</code>."}, {"owner": {"reputation": 53, "user_id": 4969650, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7f06fcfe8b5508d6c4d3d3c82bb73823?s=128&d=identicon&r=PG&f=1", "display_name": "Xeriotek", "link": "https://stackoverflow.com/users/4969650/xeriotek"}, "edited": false, "score": 0, "creation_date": 1434384609, "post_id": 30848899, "comment_id": 49743497, "body": "The exercise is just to implement a function (+)::(Tree a)-&gt;(Tree a) -&gt; (Tree a)"}], "answers": [{"tags": [], "owner": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "is_accepted": false, "score": 2, "last_activity_date": 1434535268, "last_edit_date": 1434535268, "creation_date": 1434383853, "answer_id": 30849700, "question_id": 30848899, "link": "https://stackoverflow.com/questions/30848899/haskell-unexpected-type-in-class-declaration/30849700#30849700", "title": "Haskell unexpected type in class declaration", "body": "<p>Take a look at <a href=\"http://book.realworldhaskell.org/read/using-typeclasses.html#typeclasses.whatarethey\" rel=\"nofollow\">What are typeclasses?</a>: there you gonna notice that typeclasses declaration takes:</p>\n\n<ol>\n<li>the typeclass name;</li>\n<li>a type variable.</li>\n</ol>\n\n<p>Hence, your declaration should start as</p>\n\n<pre><code>class (+) a where\n</code></pre>\n\n<p>not</p>\n\n<pre><code>class (+) (Tree a) where\n</code></pre>\n\n<p>although I would prefer</p>\n\n<pre><code>class Plus a where\n</code></pre>\n\n<p>That solves the first of your problems. :)</p>\n\n<hr>\n\n<p>Answering your updated version...</p>\n\n<p>Do you see the difference between <code>Plus</code> and <code>plus</code>? Yes, one is capitalized and the other is not. Do you know what it means in Haskell?</p>\n\n<p><code>Plus</code>, as every capitalized word in Haskell, refers to <strong>types</strong> (in this case, <em>type class</em> called <code>Plus</code>).</p>\n\n<p>By the other hand, functions must be always lowercase \u2014 and that is why you defined <code>plus :: (Tree a)  -&gt; (Tree a)  -&gt; (Tree a)</code> in lowercase.</p>\n\n<p>Have you already gotten your problem?</p>\n\n<p>Instead of</p>\n\n<pre><code>instance (Num a) =&gt; Plus (Tree a) where\n    Plus (Node a1 b1 c1)  (Node a2 b2 c2) = (Node (a1+a2) (Plus b1 b2)  (Plus c1 c2)) \n    Plus Empty (Node a b c) = (Node a b c) \n    Plus (Node a b c) Empty = (Node a b c)\n</code></pre>\n\n<p>you should have written</p>\n\n<pre><code>instance (Num a) =&gt; Plus (Tree a) where\n    plus (Node a1 b1 c1)  (Node a2 b2 c2) = (Node (a1+a2) (Plus b1 b2)  (Plus c1 c2)) \n    plus Empty (Node a b c) = (Node a b c) \n    plus (Node a b c) Empty = (Node a b c)\n</code></pre>\n\n<p>because you are defining the behaviour of the function <code>plus</code> when <code>Tree</code> is an instance of <code>Plus</code>. Got it? :)</p>\n"}], "owner": {"reputation": 53, "user_id": 4969650, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7f06fcfe8b5508d6c4d3d3c82bb73823?s=128&d=identicon&r=PG&f=1", "display_name": "Xeriotek", "link": "https://stackoverflow.com/users/4969650/xeriotek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2038, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1434535268, "creation_date": 1434381586, "last_edit_date": 1434408369, "question_id": 30848899, "link": "https://stackoverflow.com/questions/30848899/haskell-unexpected-type-in-class-declaration", "title": "Haskell unexpected type in class declaration", "body": "<p>I try to implement a function (Tree a) -> (Tree a) -> (Tree a). The function should sum the node values and return a tree with the sums. Unfortunatley i got the following error message:</p>\n\n<p>Aufgabe10.hs:4:11:\n    Unexpected type \u2018Tree a\u2019\n    In the class declaration for \u2018+\u2019\n    A class declaration should have form\n      class + a b c where ...</p>\n\n<p>This is my code:</p>\n\n<pre><code>data Tree a = Node a (Tree a) (Tree a) \n    |Empty\n\nclass (+) (Tree a) where\n    (+) :: (Tree a) (Tree a) -&gt; (Tree a)\n\ninstance (Num a) =&gt; (+) (Tree a) (Tree a) where\n    (+) (Node a1 b1 c1)  (Node a2 b2 c2) = (Node (a1+a2) ((+) b1 b2)  ((+) c1 c2)) \n    (+) Empty (Node a b c) = (Node a b c) \n    (+) (Node a b c) Empty = (Node a b c)\n</code></pre>\n\n<hr>\n\n<p>Ok i changed now the class to Plus and named the function plus, cause i don't want to implement all the numb functions. This is the new code:</p>\n\n<pre><code>data Tree a = Node a (Tree a) (Tree a) \n    |Empty\n\nclass Plus a where\n    plus:: (Tree a)  -&gt; (Tree a)  -&gt; (Tree a) \n\ninstance (Num a) =&gt; Plus (Tree a) where\n    Plus (Node a1 b1 c1)  (Node a2 b2 c2) = (Node (a1+a2) (Plus b1 b2)  (Plus c1 c2)) \n    Plus Empty (Node a b c) = (Node a b c) \n    Plus (Node a b c) Empty = (Node a b c)\n</code></pre>\n\n<p>I get the following errors:</p>\n\n<p>Aufgabe10.hs:8:9:\n    Pattern bindings (except simple variables) not allowed in instance declarations\n      Plus (Node a1 b1 c1) (Node a2 b2 c2)\n        = (Node (a1 + a2) (Plus b1 b2) (Plus c1 c2))</p>\n\n<p>Aufgabe10.hs:9:9:\n    Pattern bindings (except simple variables) not allowed in instance declarations\n      Plus Empty (Node a b c) = (Node a b c)</p>\n\n<p>Aufgabe10.hs:10:9:\n    Pattern bindings (except simple variables) not allowed in instance declarations\n      Plus (Node a b c) Empty = (Node a b c)</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1434367594, "post_id": 30842697, "comment_id": 49731263, "body": "by the way, if field1 and field2 were UTCTime, how could I parse it? I tried <code>Data1 &lt;$&gt; ((read $ v .: &quot;field1&quot;)::UTCTime) ...</code> but failed."}, {"owner": {"reputation": 2464, "user_id": 1076715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf07aa4cdf24f3a770c21cb26e61bc7f?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1076715/eric"}, "edited": false, "score": 2, "creation_date": 1434374198, "post_id": 30842697, "comment_id": 49735863, "body": "Declaring them as UTCTime like: <code>data Data1 = Data1 { field1 :: UTCTime, field2 :: UTCTime }</code> should make the trick."}], "tags": [], "owner": {"reputation": 1585, "user_id": 1413081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8d1f596731eaae04f3ade303d211ca?s=128&d=identicon&r=PG", "display_name": "Reite", "link": "https://stackoverflow.com/users/1413081/reite"}, "is_accepted": true, "score": 6, "last_activity_date": 1434363582, "creation_date": 1434363582, "answer_id": 30842697, "question_id": 30842330, "link": "https://stackoverflow.com/questions/30842330/from-and-tojson-in-haskell-a-nested-data/30842697#30842697", "title": "From and ToJSON in Haskell - a nested data", "body": "<p>You can use the same applicative notation to parse the nested values like this:</p>\n\n<pre><code>instance FromJSON DataMain where\n    parseJSON (Object v) =\n        DataMain &lt;$&gt; v .: \"a\"\n                 &lt;*&gt; v .: \"b\"\n                 &lt;*&gt; (Data1 &lt;$&gt; v .: \"c\" &lt;*&gt; v .: \"d\")\n\n    parseJSON _ = mzero\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 30842697, "answer_count": 1, "score": 2, "last_activity_date": 1434363582, "creation_date": 1434362411, "question_id": 30842330, "link": "https://stackoverflow.com/questions/30842330/from-and-tojson-in-haskell-a-nested-data", "title": "From and ToJSON in Haskell - a nested data", "body": "<p>I have this:</p>\n\n<pre><code>data Data1 = Data1 { field1 :: Int, field2 :: Int }\ndata DataMain = DataMain \n    { a :: String \n    , b :: Bool\n    , subData :: Data1\n    }\n</code></pre>\n\n<p>And JSON</p>\n\n<pre><code>{\n    a: 'some value',\n    b: 'some value2',\n    c: 'some value3',\n    d: 'some value4',\n}\n</code></pre>\n\n<p>And here are the </p>\n\n<pre><code>  instance ToJSON DataMain where\n  toJSON (DataMain a b subData) =\n    object [\"a\" .= a\n      , \"b\" .= b\n      , \"c\" .= (field1 subData)\n      , \"d\" .= (field2 subData)\n    ]\n</code></pre>\n\n<p>How can I do the same thing vise versa?</p>\n\n<pre><code>instance FromJSON DataMain where\n  parseJSON (Object v) =\n    DataMain &lt;$&gt; v .: \"a\"\n        &lt;*&gt; v .: \"b\"\n        &lt;*&gt; v .: ?????\n\n  parseJSON _ = mzero\n</code></pre>\n"}, {"tags": ["string", "function", "haskell", "recursion", "parameters"], "comments": [{"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 2, "creation_date": 1434362552, "post_id": 30841039, "comment_id": 49728299, "body": "What&#39;s the purpose of <code>take (length s) s ++ &quot;\\n&quot;</code> when you could just do <code>s ++ &quot;\\n&quot;</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": true, "score": 2, "last_activity_date": 1434380969, "creation_date": 1434380969, "answer_id": 30848694, "question_id": 30841039, "link": "https://stackoverflow.com/questions/30841039/decremented-value-called-in-the-recursion-in-haskell/30848694#30848694", "title": "Decremented value called in the recursion in Haskell", "body": "<p>Yes, once you call again f with a new value of n, it has no way to reference the old value of n unless you pass it explicitly. One way to do it is to have an internal recursive function with its width parameter, as you have, but that can reference the parameter to the outer function when needed.\nFor example, something like that works:</p>\n\n<pre><code>f n s = f' n s\n  where\n    f' width s\n        | length s &lt;= width = s ++ \"\\n\"\n        | n &gt;= (maximum . map length . words) s =\n            if s !! width == ' ' || s !! width == '\\t' || s !! width == '\\n'\n            then take width s ++ \"\\n\" ++ f' n (drop (width+1) s)\n            else f' (width - 1) s\n        | otherwise = error \"Try bigger width!\"\n</code></pre>\n\n<p>Here <code>width</code> is the current width in the calculation, and <code>n</code> is always unchanged, which allows <code>f'</code> to use it when resetting the calculation at the start of a new line.</p>\n\n<p>That's only answering your precise question. A good exercise would then be to rewrite your code in what would be more idiomatic Haskell, avoiding some performance pitfalls like the overreliance on <code>!!</code>. But first get it working, and then make it elegant!</p>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 30848694, "answer_count": 1, "score": 1, "last_activity_date": 1434380969, "creation_date": 1434358503, "last_edit_date": 1434362294, "question_id": 30841039, "link": "https://stackoverflow.com/questions/30841039/decremented-value-called-in-the-recursion-in-haskell", "title": "Decremented value called in the recursion in Haskell", "body": "<p>So, I have this function that aligns the text to the left for a given column width. I have already fixed some of its problems, but I am unable to make it not use the decremented parameter once it is called, but to return to the starting value of <code>n</code>. Here is my code:</p>\n\n<pre><code> f n s\n   | length s &lt;= n = take (length s) s ++ \"\\n\"                    \n   | n &gt;= (maximum . map length . words) s =                   \n       if s !! n == ' ' || s !! n == '\\t' || s !! n == '\\n'\n       then take n s ++ \"\\n\" ++ f n (drop (n+1) s)                   \n       else f (n - 1) s          --Here once called for some n-1 it proceeds to call it from then on only for it or even smaller n\n   | otherwise = error \"Try bigger width!\"\n</code></pre>\n\n<p>Here is an example ,where the <code>to</code> on the last line should be really on the second line:</p>\n\n<pre><code>*Main&gt; let s = \"This miscellaneous items are starting to get shitty .\"\n*Main&gt; putStr $ f 22 s\nThis miscellaneous\nitems are starting\nto get shitty .\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "doctest", "quickcheck"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434382867, "post_id": 30836900, "comment_id": 49742310, "body": "I believe that just like ghci, the multi-line syntax requires that the open and closing symbols be on their own line. Your example won&#39;t work because <code>:{</code> is not on its own line."}, {"owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434425246, "post_id": 30836900, "comment_id": 49759627, "body": "@user2407038 I believe you are right about that case. I can&#39;t avoid parse error and have <code>prop&gt;</code> recognize multiple lines as the input."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1506326246, "creation_date": 1506326246, "answer_id": 46400176, "question_id": 30836900, "link": "https://stackoverflow.com/questions/30836900/how-can-i-use-multi-line-input-with-quickcheck-in-doctest/46400176#46400176", "title": "How can I use multi-line input with QuickCheck in doctest?", "body": "<p>As of September 2017, <a href=\"https://github.com/sol/doctest/issues/131\" rel=\"nofollow noreferrer\">doctest does not allow multi-line properties</a>. However, you can use <code>quickCheck</code> as usual in a doctest:</p>\n\n<pre><code>-- &gt;&gt;&gt; import Test.QuickCheck\n-- &gt;&gt;&gt; import Data.List (sort)\n-- &gt;&gt;&gt; :{\n--  quickCheck $ \\xs -&gt; \n--      sort xs ==\n--            (sort . sort) (xs :: [Int])\n-- :}\n-- +++ OK, passed 100 tests.\n</code></pre>\n\n<p>That's verbose, but will enable you to write arbitrary long checks. Note that you can always create a <code>prop_*</code> function and use that in your doctest.</p>\n"}], "owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 1, "accepted_answer_id": 46400176, "answer_count": 1, "score": 11, "last_activity_date": 1506326246, "creation_date": 1434338459, "last_edit_date": 1434346637, "question_id": 30836900, "link": "https://stackoverflow.com/questions/30836900/how-can-i-use-multi-line-input-with-quickcheck-in-doctest", "title": "How can I use multi-line input with QuickCheck in doctest?", "body": "<p>From <a href=\"https://github.com/sol/doctest\">Doctest's readme</a>, one can use doctest with QuickCheck, like this:</p>\n\n<pre><code>-- |\n-- prop&gt; sort xs == (sort . sort) (xs :: [Int])\n</code></pre>\n\n<p>I would like to describe this property using multiple lines, probably like</p>\n\n<pre><code>-- |\n-- prop&gt; sort xs ==\n--            (sort . sort) (xs :: [Int])\n</code></pre>\n\n<p>Doctest itself supports multi-line input (again from readme)</p>\n\n<pre><code>-- |\n-- &gt;&gt;&gt; :{\n--  let\n--    x = 1\n--    y = 2\n--  in x + y + multiline\n-- :}\n-- 6\n</code></pre>\n\n<p>and I tried several similar syntaxes I came up with, such as</p>\n\n<pre><code>-- |\n-- prop&gt; :{ sort xs ==\n--           (sort . sort) (xs :: [Int])\n-- }:\n</code></pre>\n\n<p>without any success. (In the example above, the error message is  <code>parse error on input '{'</code>.)</p>\n\n<p>How can I use multi-line input with Quickcheck in doctest?</p>\n"}, {"tags": ["haskell", "yesod"], "owner": {"reputation": 440, "user_id": 2705125, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e25bc1b870c32ecc4381c14000e90342?s=128&d=identicon&r=PG&f=1", "display_name": "cschneid", "link": "https://stackoverflow.com/users/2705125/cschneid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 1, "answer_count": 0, "score": 8, "last_activity_date": 1446855678, "creation_date": 1434337901, "question_id": 30836843, "link": "https://stackoverflow.com/questions/30836843/yesod-devel-compiles-after-change-but-doesnt-actually-reflect-change", "title": "yesod devel compiles after change, but doesn&#39;t actually reflect change", "body": "<p>This happens in all handlers, but as an example, I have a simple handler I edit in vim:</p>\n\n<pre><code>getListingR :: Handler Html\ngetListingR = do\n  defaultLayout $ do\n    setTitle \"Thing\"\n    [whamlet|&lt;p&gt;Content|]\n</code></pre>\n\n<p><code>yesod devel</code> launches a server, and sometimes serves this.</p>\n\n<p>But then, when I change the <code>setTitle</code> call (not even the quasiquoter, just the literal string), the server process recognizes the change, starts the recompile, and serves up the \"wait while recompiling\" page.</p>\n\n<p>BUT when finished, it goes back to serving up the old content. </p>\n\n<p>I said 'sometimes' earlier because it doesn't seem to pick up the newest changes on a fresh <code>yesod devel</code> launch. A <code>cabal build</code> seems to always pick up changes.</p>\n\n<p>I am running GHC 7.10.1, in a cabal sandbox locked to stackage nightly.</p>\n"}, {"tags": ["c", "haskell", "ffi", "c2hs"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434317583, "post_id": 30834760, "comment_id": 49714073, "body": "In the usual way? c2hs may provide some help but you can do it very straightforwardly with just the FFI - see <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Foreign-Ptr.html\" rel=\"nofollow noreferrer\">FunPtr</a>."}, {"owner": {"reputation": 1350, "user_id": 1308616, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04aec969ee650e180ce48f721cf37a7e?s=128&d=identicon&r=PG", "display_name": "Casper Thule Hansen", "link": "https://stackoverflow.com/users/1308616/casper-thule-hansen"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434354278, "post_id": 30834760, "comment_id": 49723594, "body": "I was hoping to keep all the configuration using c2hs"}], "owner": {"reputation": 1350, "user_id": 1308616, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/04aec969ee650e180ce48f721cf37a7e?s=128&d=identicon&r=PG", "display_name": "Casper Thule Hansen", "link": "https://stackoverflow.com/users/1308616/casper-thule-hansen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1434819419, "creation_date": 1434317433, "last_edit_date": 1434819419, "question_id": 30834760, "link": "https://stackoverflow.com/questions/30834760/c2hs-bind-both-typedef-and-function", "title": "c2hs bind both typedef and function", "body": "<p>I am trying to properly create haskell bindings for function in C, that is split up in 2 files.</p>\n\n<p>file1.h: <code>typedef const char* fmi2GetTypesPlatformTYPE(void);</code></p>\n\n<p>file2.h: <code>__declspec(dllexport) fmi2GetTypesPlatformTYPE fmi2GetTypesPlatform;</code></p>\n\n<p>To match this in Haskell I have created a similar structure, but this is where the trouble is.</p>\n\n<p>file1.chs: <code>type fmi2GetTypesPlatformTYPE = {#type fmi2GetTypesPlatformTYPE#}</code></p>\n\n<p>How do I create a Haskell function pointer using this type? I have imported the file with <code>{#import file1 #}</code>, but I am lost on how to accomplish the last part.</p>\n\n<p>See <a href=\"https://github.com/haskell/c2hs/issues/142\" rel=\"nofollow\">https://github.com/haskell/c2hs/issues/142</a>\nI will post the answer once resolved (unless Ian-ross beats me to it :) )</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1434317059, "post_id": 30834581, "comment_id": 49713916, "body": "You should indeed just pattern match on <code>foo (x:y:z:xs)</code> and have a second pattern for everything else <code>foo _ = []</code>. Checking the length of a list to establish the existence of a certain amount of elements is not idiomatic."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434317220, "post_id": 30834581, "comment_id": 49713971, "body": "What? I can do that? One sec..."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1434317414, "post_id": 30834581, "comment_id": 49714015, "body": "So... smooth. I think I might like this language."}], "answers": [{"comments": [{"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "edited": false, "score": 0, "creation_date": 1434317506, "post_id": 30834705, "comment_id": 49714057, "body": "<code>xs&#39;</code> is just another variable name, right? Nothing fancy about the <code>&#39;</code>. But, aren&#39;t you calling <code>calc</code> with a list?"}, {"owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "reply_to_user": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "edited": false, "score": 0, "creation_date": 1434317671, "post_id": 30834705, "comment_id": 49714098, "body": "@GormCasper I believe the statement from <a href=\"http://stackoverflow.com/a/5673954/3041008\">another SO answer</a> <i>&quot;The convention in Haskell is that, like in math, the apostrophe on a variable name represents a variable that is somehow related, or similar, to a prior variable.&quot;</i> applies here."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1434317947, "post_id": 30834705, "comment_id": 49714168, "body": "Yes, <code>xs&#39;</code> is just another variable name. And yes, I was calling <code>calc</code> with a list, hadn&#39;t properly read its signature in the question."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "edited": false, "score": 0, "creation_date": 1434318001, "post_id": 30834705, "comment_id": 49714182, "body": "Right, that&#39;s what I thought.  @leftaroundabout: This doesn&#39;t seem to work. I get <code>[-8]</code> when calling it with <code>[1,1,5,3,3]</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1434318460, "post_id": 30834705, "comment_id": 49714305, "body": "Again didn&#39;t read the question properly... you must pass on <code>y</code> and <code>z</code> to the recursive call."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "edited": false, "score": 0, "creation_date": 1434318828, "post_id": 30834705, "comment_id": 49714386, "body": "Oh wow. I like the look of the last one, but I don&#39;t quite understand what&#39;s going on yet. I have yet to read about the <code>&lt;-</code>. It&#39;ll come."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1434318428, "last_edit_date": 1434318428, "creation_date": 1434317081, "answer_id": 30834705, "question_id": 30834581, "link": "https://stackoverflow.com/questions/30834581/first-three-items-of-a-list-in-haskell/30834705#30834705", "title": "First three items of a list in Haskell", "body": "<p>Well, <code>foo (x:y:z:xs)</code> plus a &ldquo;too short clause&rdquo; certainly wouldn't be a bad solution. Another would be</p>\n\n<pre><code>foo xs = case splitAt 3 xs of\n           ([x,y,z],xs') -&gt; calc x y z : foo (y:z:xs')\n           _ -&gt; []\n</code></pre>\n\n<p>Or, perhaps nicest,</p>\n\n<pre><code>import Data.List (tails)\n\nfoo xs = [ calc x y z | (x:y:z:_) &lt;- tails xs ]\n</code></pre>\n"}], "owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2282, "favorite_count": 0, "accepted_answer_id": 30834705, "answer_count": 1, "score": 1, "last_activity_date": 1434318508, "creation_date": 1434316226, "last_edit_date": 1434318508, "question_id": 30834581, "link": "https://stackoverflow.com/questions/30834581/first-three-items-of-a-list-in-haskell", "title": "First three items of a list in Haskell", "body": "<p>I am very new to Haskell, and struggling a bit with a function here. The premise is simple enough: Run through a list, and combine each 3 items next to each other with another function and return a list with the results. The problem is to do it in a nice way.</p>\n\n<p>Here is what I've got:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo :: [Int] -&gt; [Int]\nfoo xs\n    | length xs &lt; 3 = []\n    | otherwise     = n : foo (tail xs)\n    where n = calc (xs!!0) (xs!!1) (xs!!2)\n\n-- This function is actually significantly more complicated.\ncalc :: Int -&gt; Int -&gt; Int -&gt; Int\ncalc x y z = x + y - (z * 2)\n\n-- And we can use it like this:\nfoo [1,2,3]     -- [-3]\nfoo [1,2,3,4]   -- [-3,-3]\nfoo [1,1,5,3,3] -- [-8,0,2]\n</code></pre>\n\n<p>What I don't like, is the 5th line, containing all the <code>!!</code>'s. It feels like I'm thinking about it the wrong way, and that there should be a better way of doing this. I'd like to do something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo (x:y:z:xs)\n    -- ...\n</code></pre>\n\n<p>But that will fail when the list gets less than three items. So, then I'd have to declare other patterns for when the list has fewer items?</p>\n\n<p>Also, in case there is already a function that does what <code>foo</code> does (there probably is, it seems there is one for everything), then I'm not really all that interested in it. I'm trying to grok the Haskell way of doing things, more than expanding my repetoire of functions.</p>\n\n<p><strong>Edit:</strong> In JS, I'd do something like <code>n = calc.apply(null, take(3, xs))</code>. I wonder if Haskell has something like <code>apply</code> that takes an array and applies it to a function as parameters.</p>\n\n<p><strong>Edit 2 -- Solution:</strong> (based on comment below)</p>\n\n<pre><code>foo (x:y:z:xs) = calc x y z : foo (y:z:xs)\nfoo _          = []\n</code></pre>\n\n<p>Last pattern match is a catch-all, so if the first \"fails\" it will fall through and just return an empty list.</p>\n"}, {"tags": ["string", "function", "haskell", "if-statement", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "edited": false, "score": 0, "creation_date": 1434357897, "post_id": 30834773, "comment_id": 49725519, "body": "how to fix the problem with the decremented value of n used in the recursion"}], "tags": [], "owner": {"reputation": 1492, "user_id": 3426575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9cb90428f2174ecf08c990a0a6de3?s=128&d=identicon&r=PG&f=1", "display_name": "user3426575", "link": "https://stackoverflow.com/users/3426575/user3426575"}, "is_accepted": true, "score": 3, "last_activity_date": 1434317965, "last_edit_date": 1434317965, "creation_date": 1434317513, "answer_id": 30834773, "question_id": 30834572, "link": "https://stackoverflow.com/questions/30834572/stopping-condition-on-a-recursive-function-haskell/30834773#30834773", "title": "Stopping condition on a recursive function - Haskell", "body": "<p>Your code doesn't handle the case where a line is shorter than the maximum length.</p>\n\n<p>This is somewhat obscured by another bug: <code>n</code> is decremented until a whitespace is found, and then <code>f</code> is called recursively passing this decremented value of <code>n</code>, effectively limiting all subsequent lines to the length of the current line.</p>\n\n<p>(Also, you might want to drop <code>n + 1</code> characters from <code>s</code> so the original whitespace isn't included in the output.)</p>\n\n<p>You can avoid ifs by using patterns:</p>\n\n<pre><code>f n \"\" = \"\" -- weak condition\nf n s\n  | n &gt;= (maximum . map length . words) s =\n      if s !! n == ' ' || s !! n == '\\t' || s !! n == '\\n'\n      then take n s ++ \"\\n\" ++ f n (drop n s)\n      else f (n - 1) s\n  | otherwise = error \"Try bigger width!\"\n</code></pre>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "accepted_answer_id": 30834773, "answer_count": 1, "score": 0, "last_activity_date": 1434317965, "creation_date": 1434316160, "question_id": 30834572, "link": "https://stackoverflow.com/questions/30834572/stopping-condition-on-a-recursive-function-haskell", "title": "Stopping condition on a recursive function - Haskell", "body": "<p>So, I have this function which aims to align the text on the left without cutting words(only white spaces). However my problem is that I cannot find a stopping condition of the function and it goes infinitely. </p>\n\n<pre><code>f n \"\" = \"\"          --weak condition\nf n s  = if n &gt;= ((maximum . map length . words) s) then if (s !! n == ' ' || s !! n == '\\t' || s !! n == '\\n') \n                                                    then take n s ++ \"\\n\" ++ (f n ( drop n s)) else f (n-1) s \n                                                    else error \"Try bigger width!\"\n</code></pre>\n\n<p>Well, basically if the n is smaller than the longest word then it prompts error, else it ''cuts'' the string in the white spaces until it reaches a not white space character, then it calls itself recursively for <code>n-1</code>. I use also <code>putStr</code> to avoid \"\\n\" in the output.</p>\n\n<p>However, as I already said the stopping condition is too weak or non-existent. If there are other flows in the code or possible optimizations(e.g. less ifs), please tell.</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2388535"}, "edited": false, "score": 1, "creation_date": 1434314371, "post_id": 30834134, "comment_id": 49713112, "body": "Are you trying to sum a list of <code>Num a =&gt; Maybe a</code> values? If so, then <code>fmap sum . sequence</code> should do it."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1434313931, "creation_date": 1434313931, "answer_id": 30834236, "question_id": 30834134, "link": "https://stackoverflow.com/questions/30834134/applicative-style-understanding/30834236#30834236", "title": "Applicative style understanding", "body": "<p><code>&lt;**&gt;</code> from <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#g:4\"><code>Control.Applicative</code></a> is <code>flip &lt;*&gt;</code>. Your example can work with that, slightly rearranged:</p>\n\n<pre><code>&gt;((+) &lt;$&gt; Just 3 &lt;*&gt; Just 5) &lt;**&gt; ((+) &lt;$&gt; Just 6)\nJust 14\n</code></pre>\n"}], "owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 30834236, "answer_count": 1, "score": 1, "last_activity_date": 1434313931, "creation_date": 1434313398, "question_id": 30834134, "link": "https://stackoverflow.com/questions/30834134/applicative-style-understanding", "title": "Applicative style understanding", "body": "<p>I would like to write something as the following:</p>\n\n<pre><code>(+) &lt;$&gt; Just 3 &lt;*&gt; Just 5 &lt;*&gt;' (+) &lt;*&gt; Just 6\n</code></pre>\n\n<p>However the problem is that I need to somehow <code>flip</code> <code>&lt;*&gt;</code>. What is the idiomatic way in Haskell to do the type of chaining I'm trying?</p>\n"}, {"tags": ["string", "haskell", "lambda", "fold", "algebraic-data-types"], "comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1434303506, "post_id": 30832302, "comment_id": 49709738, "body": "Take a look at your signature, it is not the same signature as <code>foldr</code>, you should name the variables that have changed. Also remember to wrap your constructors in parenthesis. <code>v f go e</code> for instance has types <code>String</code>, <code>String -&gt; a</code>, <code>LExpr -&gt; a</code>, and <code>LExpr</code> which is a nonsensical call chain."}, {"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1434304469, "post_id": 30832302, "comment_id": 49710038, "body": "@Guvante ok then what corresponds to the signature?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 1, "creation_date": 1434400319, "post_id": 30832302, "comment_id": 49752335, "body": "<a href=\"http://stackoverflow.com/questions/16426463/what-constitutes-a-fold-for-types-other-than-list\" title=\"what constitutes a fold for types other than list\">stackoverflow.com/questions/16426463/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "edited": false, "score": 0, "creation_date": 1434307362, "post_id": 30833001, "comment_id": 49710885, "body": "<code>go (Var v)     = v</code>, <code>go (App e1 e2) = go e1 ++ go e2</code> and <code>go (Lam v e)   = v app go e</code> ? Am I right? And thanks for the explanation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "edited": false, "score": 1, "creation_date": 1434307698, "post_id": 30833001, "comment_id": 49710979, "body": "@user4325010 No, recall we mapped <code>Nil</code> to <code>nil</code> and <code>Cons</code> to <code>cons</code>. So <code>Var</code> must be mapped to ... In particular <code>Var v</code> must be mapped to <code>... v</code>."}, {"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "edited": false, "score": 1, "creation_date": 1434308588, "post_id": 30833001, "comment_id": 49711259, "body": "<code>go (Var v)  = var v</code>, <code>go (App e1 e2) = app (go e1) (go e2)</code>, <code>go (Lam v e)   = lam v (go e)</code>? right?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "edited": false, "score": 1, "creation_date": 1434309209, "post_id": 30833001, "comment_id": 49711477, "body": "@user4325010 Perfect!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1434306453, "creation_date": 1434306453, "answer_id": 30833001, "question_id": 30832302, "link": "https://stackoverflow.com/questions/30832302/haskell-lambda-fold/30833001#30833001", "title": "Haskell Lambda fold", "body": "<p>I will only provide a hint.</p>\n\n<p>Suppose you have a list of integers type as follows:</p>\n\n<pre><code>data List = Nil | Cons Int List\n</code></pre>\n\n<p>Then, the fold becomes</p>\n\n<pre><code>foldr :: \u03b2 -&gt; (\u03b1 -&gt; \u03b2 -&gt; \u03b2) -&gt; [\u03b1] -&gt; \u03b2\nfoldr nil cons = go\n  where\n    go Nil         = nil\n    go (Cons x xs) = cons x (go xs)\n</code></pre>\n\n<p>Notice that, once I carefully name the arguments <code>nil, cons</code> then it's just a matter of 1) mapping <code>Nil</code> (constructor) to <code>nil</code> (parameter), 2) mapping <code>Cons</code> to <code>cons</code>, 3) applying <code>go</code> to subterms of type <code>List</code> (i.e., <code>xs</code>).</p>\n\n<p>For your type,</p>\n\n<pre><code>data LExpr\n    = Var String         -- variable\n    | App LExpr LExpr    -- function application\n    | Lam String LExpr   -- Lambda abstraction \n</code></pre>\n\n<p>we can use the same trick:</p>\n\n<pre><code>lfold :: (String -&gt; a) -&gt; (a -&gt; a -&gt; a) -&gt; (String -&gt; a -&gt; a) -&gt; LExpr -&gt; a   \nlfold var app lam = go\n  where\n    go (Var v)     = ??\n    go (App e1 e2) = ??\n    go (Lam v e)   = ??\n</code></pre>\n\n<p>Notice how I named the three arguments: <code>var, app, lam</code>. By checking what happened in the <code>List</code> type above, you should now be able to fill in the blanks.</p>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 0, "accepted_answer_id": 30833001, "answer_count": 1, "score": 4, "last_activity_date": 1434306453, "creation_date": 1434302308, "last_edit_date": 1434303541, "question_id": 30832302, "link": "https://stackoverflow.com/questions/30832302/haskell-lambda-fold", "title": "Haskell Lambda fold", "body": "<p>I have the following algebraic data type representing the Lambda Calculus in Haskell:</p>\n\n<pre><code>data LExpr\n    = Var String         -- variable\n    | App LExpr LExpr    -- function application\n    | Lam String LExpr   -- Lambda abstraction \n    deriving (Eq, Show)  \n</code></pre>\n\n<p>I am trying to build the accompanying fold function. I am acquainted with the general fold form for algebraic data types, which can be in such way present: </p>\n\n<pre><code>foldr :: (\u03b1 -&gt; \u03b2-&gt; \u03b2) -&gt; \u03b2 -&gt; [\u03b1] -&gt; \u03b2\nfoldr (#) z = go\n  where\n    go []     = z\n    go (x:xs) = x # go xs \n</code></pre>\n\n<p>So, what I have done so far:</p>\n\n<pre><code>lfold :: (String -&gt; a) -&gt; (a -&gt; a -&gt; a) -&gt; (String -&gt; a -&gt; a) -&gt; LExpr -&gt; a   --given by definition\nlfold f z = go\n  where\n    go (Var _) = z            --Not sure here how to do the base case\n    go (Lam v e) = v f go e\n</code></pre>\n\n<p>Is this the correct way? If not, where I am wrong and how to fix it?</p>\n"}, {"tags": ["class", "haskell", "instance"], "answers": [{"tags": [], "owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "is_accepted": true, "score": 11, "last_activity_date": 1434301132, "creation_date": 1434301132, "answer_id": 30832110, "question_id": 30831956, "link": "https://stackoverflow.com/questions/30831956/importing-haskell-module-says-not-in-scope/30832110#30832110", "title": "importing haskell module says &quot;not in scope&quot;", "body": "<p>First,</p>\n\n<pre><code>module Tree2\n(\n Tree\n) where\n</code></pre>\n\n<p>only exports the <code>Tree</code> data type, not its constructors; you should use</p>\n\n<pre><code>module Tree2\n(\n  Tree(..)\n) where\n</code></pre>\n\n<p>instead.</p>\n\n<p>Second, as you're doing a qualified import, you need to use <code>Tree2.EmptyTree</code> instead of just <code>EmptyTree</code>.</p>\n"}], "owner": {"reputation": 2535, "user_id": 1760720, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2725d511128304107f17561e03888cdb?s=128&d=identicon&r=PG", "display_name": "Brian Yeh", "link": "https://stackoverflow.com/users/1760720/brian-yeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1217, "favorite_count": 0, "accepted_answer_id": 30832110, "answer_count": 1, "score": 2, "last_activity_date": 1434301132, "creation_date": 1434300291, "question_id": 30831956, "link": "https://stackoverflow.com/questions/30831956/importing-haskell-module-says-not-in-scope", "title": "importing haskell module says &quot;not in scope&quot;", "body": "<p>I created a Tree structure in a file called Tree2.hs</p>\n\n<pre><code>module Tree2\n(\n Tree\n) where\n\ndata Tree a = EmptyTree | Node a (Tree a) (Tree a) deriving (Show)\n</code></pre>\n\n<p>then I imported it and tried to use it as an instance of a class</p>\n\n<pre><code>import qualified Tree2\n\nclass YesNo a where\n  yesno :: a -&gt; Bool\n\ninstance YesNo (Tree2.Tree a) where\n  yesno EmptyTree = False\n  yesno _ = True\n</code></pre>\n\n<p>But I'm getting this Error when loading it in ghci:</p>\n\n<pre><code>Not in scope: data constructor \u2018EmptyTree\u2019\nFailed, modules loaded: Tree2.\n</code></pre>\n\n<p>Anyone know why? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "edited": false, "score": 0, "creation_date": 1434308217, "post_id": 30832016, "comment_id": 49711136, "body": "I lose you at the move from step 3 to 4. If I put a single integer into these nested lists (e.g., [ [1],[[2]] ]), the compiler no longer accepts it. Therefore, how can they have the same type?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "edited": false, "score": 3, "creation_date": 1434314525, "post_id": 30832016, "comment_id": 49713160, "body": "The compiler no longer accepts it because <code>[1]</code> and <code>[[2]]</code> can <i>not</i> have the same type (e.g. <code>[Int]</code> vs. <code>[[Int]]</code>). OTOH, <code>[]</code> and <code>[[]]</code> can both have type <code>[[Int]]</code>, i.e. both lists of lists: the former is the empty list (containing no lists) and the latter is a <i>non-empty</i> list, containing one list \u2013 though that in turn contains no integers (but could)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1434315475, "last_edit_date": 1434315475, "creation_date": 1434300642, "answer_id": 30832016, "question_id": 30831845, "link": "https://stackoverflow.com/questions/30831845/automatic-typing-of-nested-lists/30832016#30832016", "title": "automatic typing of nested lists", "body": "<p>Let's rewrite this:</p>\n\n<pre><code>l = [l1, l2, l3]\n where l1 = []\n       l2 = [[]]\n       l3 = [[[]]]\n</code></pre>\n\n<p>Now we assign type variables: ab initio</p>\n\n<pre><code>       l1 :: b\n       l2 :: b\n       l3 :: b\n</code></pre>\n\n<p>since they all have to have the same type, so <code>l</code> has some type <code>[b]</code>. Now, more specifically,</p>\n\n<pre><code>       l1 :: [c]\n       l2 :: [[d]]\n       l3 :: [[[e]]]\n</code></pre>\n\n<p>to justify the number of brackets. But these still have to be the same type <code>b</code>, i.e. in fact</p>\n\n<pre><code>       l1 :: [[[e]]]\n       l2 :: [[[e]]]\n       l3 :: [[[e]]]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>l = [ [] :: [[[e]]]\n    , [[]] :: [[[e]]]\n    , [[[]]] :: [[[e]]] ]\n</code></pre>\n\n<p>which as a whole has type <code>[[[[e]]]]</code>. Or, if you prefer, <code>[[[[a]]]]</code>.</p>\n\n<hr>\n\n<p>Perhaps it all gets clearer if you consider more interesting specific examples. The following are <code>[Int]</code> lists:</p>\n\n<ul>\n<li><code>[1,2,3]</code></li>\n<li><code>[1]</code></li>\n<li><code>[0]</code></li>\n<li><code>[]</code></li>\n</ul>\n\n<p>These are <code>[[Int]]</code> lists:</p>\n\n<ul>\n<li><code>[ [1,2], [1,2,3] ]</code></li>\n<li><code>[ [1], [2] ]</code></li>\n<li><code>[ [1], [] ]</code></li>\n<li><code>[ [] ]</code></li>\n<li><code>[ ]</code></li>\n</ul>\n\n<p>And these are <code>[[[Int]]]</code> lists:</p>\n\n<ul>\n<li><code>[ [[1]], [[2],[]], [[3],[],[]] ]</code></li>\n<li><code>[ [[]], [[1]], [[2,3]] ]</code></li>\n<li><code>[ [], [[]] ]</code></li>\n<li><code>[ [[]] ]</code></li>\n<li><code>[ ]</code></li>\n</ul>\n\n<p>Note that the empty list <code>[]</code> is possible for all types. The list containing only an empty list, <code>[[]]</code> is possible for <code>[[Int]]</code> and <code>[[[Int]]]</code>, and the list containing a list with only an empty list needs a doubly-nested list <code>[[[Int]]]</code>.</p>\n"}], "owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 30832016, "answer_count": 1, "score": 0, "last_activity_date": 1434315475, "creation_date": 1434299652, "question_id": 30831845, "link": "https://stackoverflow.com/questions/30831845/automatic-typing-of-nested-lists", "title": "automatic typing of nested lists", "body": "<p>While working through Richard Bird's <em>Thinking Functionally With Haskell</em>, I came across a demonstration of Haskell's type system that I find puzzling (p. 44): </p>\n\n<blockquote>\n  <p><code>[ [], [[]], [[[]]] ] :: [[[[a]]]]</code></p>\n  \n  <p>To explain, let the main list have type <code>[b]</code>. The first element is a\n  list, so <code>b=[c]</code>. The second element is a list of lists, so <code>c=[d]</code>. The\n  third element is a list of lists of lists, so <code>d=[a]</code></p>\n</blockquote>\n\n<p>Doesn't this type signature indicate that the first element of the main list has type <code>[[[a]]]</code>? I don't see how that's possible.</p>\n"}, {"tags": ["haskell", "bytestring", "wxhaskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1434356403, "post_id": 30831729, "comment_id": 49724685, "body": "What&#39;s in the ByteString? Raw pixel values, or something like the contents of a PNG file?"}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1434394172, "post_id": 30831729, "comment_id": 49748877, "body": "I have re-edited the question. Please look at it."}], "answers": [{"tags": [], "owner": {"reputation": 109, "user_id": 5573696, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AoIOc.png?s=128&g=1", "display_name": "HJvT", "link": "https://stackoverflow.com/users/5573696/hjvt"}, "is_accepted": false, "score": 1, "last_activity_date": 1451775561, "last_edit_date": 1451775561, "creation_date": 1448446156, "answer_id": 33913629, "question_id": 30831729, "link": "https://stackoverflow.com/questions/30831729/wxhaskell-convert-data-bytestring-to-image/33913629#33913629", "title": "wxHaskell: convert Data.ByteString to Image", "body": "<p>There seems to be no function to read such data from a ByteString, but there are functions to read images/bitmaps from file, see imageCreateFromFile and bitmapCreateFromFile from <a href=\"https://hackage.haskell.org/package/wx-0.92.1.0/docs/Graphics-UI-WX-Media.html\" rel=\"nofollow\">Graphics.UI.WX.Media</a>. (If necessary, you could use a temporary file for these functions.)</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1451814879, "creation_date": 1434298924, "last_edit_date": 1451814879, "question_id": 30831729, "link": "https://stackoverflow.com/questions/30831729/wxhaskell-convert-data-bytestring-to-image", "title": "wxHaskell: convert Data.ByteString to Image", "body": "<p>I have some raw data that represents an image as <code>Data.ByteString</code>. Is there a way in wxHaskell to convert it to an image/bitemap?</p>\n\n<p>This raw data can be an image like PNG/JPG/GIF, so it will start with byte sequences like \"PNG etc\".</p>\n\n<p>I tried to use \"gd-3000\" to create it, but I wasn't able to make \"compatible\" the output of that library with wx.</p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 877, "user_id": 1385900, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90128ed8aba2b5dea85920090967190e?s=128&d=identicon&r=PG", "display_name": "Daniel K", "link": "https://stackoverflow.com/users/1385900/daniel-k"}, "edited": false, "score": 0, "creation_date": 1434347099, "post_id": 30831627, "comment_id": 49720305, "body": "I see that your examples work (runState outer (Sum 10)). See my edit. Why won&#39;t that type check? I really do want a MonadState constraint (of Sum, not Int) on my outer function."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1434350067, "last_edit_date": 1434350067, "creation_date": 1434298335, "answer_id": 30831627, "question_id": 30827838, "link": "https://stackoverflow.com/questions/30827838/how-do-i-use-zoom-with-a-monadstate-constraint-of-a-newtype/30831627#30831627", "title": "How do I use zoom with a MonadState constraint of a newtype?", "body": "<p><code>zoom</code> has its own class for overloading, so no wonder just <code>MonadState</code> doesn't cut it. The <a href=\"https://hackage.haskell.org/package/lens-4.11/docs/Control-Lens-Zoom.html#t:Zoom\" rel=\"nofollow\"><code>Zoom</code></a> class covers roughly the same ground as <code>mtl</code>, although it has somewhat more complicated machinery. In any case, you're not obligated to program in concrete monads.</p>\n\n<p>You can try enabling <code>NoMonomorphismRestriction</code> and inferring a type:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport Control.Lens.Internal.Zoom\nimport Control.Lens\nimport Control.Monad.State\nimport Data.Monoid\nimport Control.Monad.Except -- for illustration\n\nouter = zoom _Wrapped' get\n</code></pre>\n\n<p>Now <code>:t outer</code> gives</p>\n\n<pre><code>outer :: \n  (Functor (Zoomed m (Unwrapped t)), Zoom m n (Unwrapped t) t, Wrapped t) \n  =&gt; n (Unwrapped t)\n</code></pre>\n\n<p>This isn't pretty, but it seems to work. </p>\n\n<pre><code>&gt; runState outer (Sum 10)\n(10, Sum {getSum = 10})\n&gt; runState (runExceptT outer) (Sum 10) :: (Either String Int, Sum Int)\n(Right 10,Sum {getSum = 10})\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>If you really want to specialize to <code>Sum Int</code> as the outer state, and also want to have <code>MonadState (Sum Int) n</code> constraint, this suffices:</p>\n\n<pre><code>sumOuter ::\n  (Functor (Zoomed m Int), Zoom m n Int (Sum Int)) =&gt; n Int\nsumOuter = zoom _Wrapped' sumInner\n\nsumInner :: (MTL.MonadState Int m) =&gt; m Int\nsumInner = MTL.get\n</code></pre>\n\n<p>What about the <code>MonadState</code> constraint? There's no need to write it out, because <code>Zoom m n s t</code> has <code>MonadState s m</code> and <code>MonadState t n</code> as superclasses. </p>\n\n<p>Likewise, the more general <code>outer</code> function already implies <code>MonadState t n</code>. </p>\n"}], "owner": {"reputation": 877, "user_id": 1385900, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90128ed8aba2b5dea85920090967190e?s=128&d=identicon&r=PG", "display_name": "Daniel K", "link": "https://stackoverflow.com/users/1385900/daniel-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "accepted_answer_id": 30831627, "answer_count": 1, "score": 1, "last_activity_date": 1434350067, "creation_date": 1434274252, "last_edit_date": 1434347066, "question_id": 30827838, "link": "https://stackoverflow.com/questions/30827838/how-do-i-use-zoom-with-a-monadstate-constraint-of-a-newtype", "title": "How do I use zoom with a MonadState constraint of a newtype?", "body": "<p>I have two functions, one with a MonadState constraint of the wrapped type, the other has a MonadState constraint of the unwrapped type. I'd like to seamlessly run the second function within the first.</p>\n\n<p>For example:</p>\n\n<pre><code>import qualified Control.Monad.State.Strict as MTL\nimport Data.Monoid (Sum)\nimport Control.Lens.Zoom (zoom)\nimport Control.Lens.Wrapped (_Wrapped')\n\nouter :: (MTL.MonadState (Sum Int) m) =&gt; m Int\nouter = zoom _Wrapped' inner\n\ninner :: (MTL.MonadState Int m) =&gt; m Int\ninner = MTL.get\n</code></pre>\n\n<p>The above seems to me like it should work, yet I get 3 type checker errors. The first:</p>\n\n<pre><code>Could not deduce (Control.Lens.Zoom.Zoom m0 m Int (Sum Int))\n  arising from a use of \u2018zoom\u2019\nfrom the context (MTL.MonadState (Sum Int) m)\n  bound by the type signature for\n             outer :: MTL.MonadState (Sum Int) m =&gt; m Int\nThe type variable \u2018m0\u2019 is ambiguous\n</code></pre>\n\n<p>From my searching, I get the impression that <code>zoom</code> can't do what I want. (found this quote on <a href=\"http://ircbrowse.net/browse/haskell\" rel=\"nofollow\">http://ircbrowse.net/browse/haskell</a> \"reltuk: yeah, thats the unfortunate downside of lenses is that zooming forces you to a concrete state monad\") I guess that lines up with the error message stating that \"m0 is ambiguous\".</p>\n\n<p>I'd really rather not change my MonadState constraint into a concrete monad.</p>\n\n<p>Is there some other standard way of doing what I want?</p>\n\n<h1>Edit:</h1>\n\n<p>This will not type check:</p>\n\n<pre><code>sumOuter :: (Functor (Zoomed m Int),\n           Zoom m m Int t,\n           Wrapped t,\n           Unwrapped t ~ Int,\n           MTL.MonadState (Sum Int) m) =&gt; m Int\nsumOuter = zoom _Wrapped' sumInner\n\nsumInner :: (MTL.MonadState Int m) =&gt; m Int\nsumInner = MTL.get\n</code></pre>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1434272211, "post_id": 30826652, "comment_id": 49700623, "body": "What do you mean with \u201cmaking a benchmark\u201d? Do you want your quickcheck test to fail if the runtime of the functions is not the expected?"}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1434806708, "post_id": 30826652, "comment_id": 49941979, "body": "I would like to validate 2-3 versions of a function with the same list of value and in the wake, comparing the speed of these differents version. To be accurate and strict, I would like to use the same list of values."}], "answers": [{"tags": [], "owner": {"reputation": 472, "user_id": 4775652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/825c3e92706311cc7fa61d0f5b96f9d8?s=128&d=identicon&r=PG&f=1", "display_name": "lodrik", "link": "https://stackoverflow.com/users/4775652/lodrik"}, "is_accepted": true, "score": 0, "last_activity_date": 1438192911, "creation_date": 1438192911, "answer_id": 31707883, "question_id": 30826652, "link": "https://stackoverflow.com/questions/30826652/test-several-functions-with-the-same-list-of-value-with-quickcheck/31707883#31707883", "title": "Test several functions with the same list of value with quickCheck", "body": "<p>If you don't insist on using QuickCheck, <a href=\"http://hackage.haskell.org/package/smallcheck-1.1.1/docs/Test-SmallCheck.html\" rel=\"nofollow\">SmallCheck</a> might be your way to go. It's the QuickCheck for (bounded) exhaustive checks and will always produce the same test values (when used with same parameters).</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 31707883, "answer_count": 1, "score": 0, "last_activity_date": 1438192911, "creation_date": 1434264282, "last_edit_date": 1434265475, "question_id": 30826652, "link": "https://stackoverflow.com/questions/30826652/test-several-functions-with-the-same-list-of-value-with-quickcheck", "title": "Test several functions with the same list of value with quickCheck", "body": "<p>Is it possible with quickCheck to perform tests on several function with the same list of value with the aim of making a benchmark on these function ?</p>\n\n<p>For example, I would like <code>prop_test1</code> <code>prop_test2</code> <code>prop_test3</code> to be checked with the same list of arbitrary values.</p>\n\n<pre><code>quickCheckWithResult args prop_test1\nquickCheckWithResult args prop_test2\nquickCheckWithResult args prop_test3\n</code></pre>\n"}, {"tags": ["function", "haskell", "infix-notation"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1434265570, "creation_date": 1434265570, "answer_id": 30826804, "question_id": 30826589, "link": "https://stackoverflow.com/questions/30826589/infix-operator-with-missing-argument/30826804#30826804", "title": "Infix operator with missing argument", "body": "<p>Not really, no. On the other hand, you could perfectly well define a different operation that provides the default argument, e.g.</p>\n\n<pre><code>withDef data2 = {- your default value -} &lt;*&gt; data2\n</code></pre>\n\n<p>If you really want to use a name that would otherwise be an operator, you can still name this partially applied function with an operator name:</p>\n\n<pre><code>($&lt;*&gt;) data2 = {- default value -} &lt;*&gt; data2\n</code></pre>\n\n<p>It can be used prefix, as in <code>($&lt;*&gt;) data2</code>, or postfix with appropriate GHC extensions, as in <code>(data2 $&lt;*&gt;)</code>. The parentheses are not optional.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 30826804, "answer_count": 1, "score": 0, "last_activity_date": 1434327654, "creation_date": 1434263618, "question_id": 30826589, "link": "https://stackoverflow.com/questions/30826589/infix-operator-with-missing-argument", "title": "Infix operator with missing argument", "body": "<p>Is it possible with Haskell to have an operator (infix function) working with a missing argument ? (rather like <code>-</code> meaning a subtraction or a negative sign)</p>\n\n<p>For example, I have this operator : </p>\n\n<pre><code>data1 &lt;*&gt; data2\n</code></pre>\n\n<p>Is it possible to make it work with a default value if first argument is omitted ?</p>\n\n<pre><code>&lt;*&gt; data2\n</code></pre>\n"}, {"tags": ["haskell", "out-of-memory", "parsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434254051, "post_id": 30825686, "comment_id": 49697469, "body": "Just a stab in the dark - the Parsec datatype is strict in the &quot;user state&quot; parameter, which is where you store your data. When you directly stored a tree in that user state, it was evalutated strictly while parsing. Now that you have boxed your data - it is irrelevant that you have three trees, only that you put the tree in a datatype - the trees will be evaluated lazily, which may cause all sorts of memory leaks. Try making your the fields of your datatype strict."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "edited": false, "score": 0, "creation_date": 1434282679, "post_id": 30825863, "comment_id": 49703229, "body": "I&#39;m just trying to learn stuff and parsec seemed worthwhile. Yes, it&#39;s \\t and \\n separated values but i don&#39;t know if &#39;tsv&#39; is a thing. i used my own tree type initially, but figured i&#39;d try somebody else&#39;s before complaining. I need to sort the elements and don&#39;t know the exact number, so a tree was the first thing that came to my mind after the list (as returned by manyTill) blew up right away."}, {"owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "edited": false, "score": 0, "creation_date": 1434296616, "post_id": 30825863, "comment_id": 49707503, "body": "PS: the avl package is a coincidence. I get that there might be better libraries than parsec for this job, but i wanted to look into parsec in order to know the most basic tools(first time using it here). The other thing is, that this appears to have little to do with the parsing itself and dodging the problem won&#39;t help me in the long run."}], "tags": [], "owner": {"reputation": 770, "user_id": 19872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iDn8H.png?s=128&g=1", "display_name": "Axman6", "link": "https://stackoverflow.com/users/19872/axman6"}, "is_accepted": false, "score": 1, "last_activity_date": 1434255858, "last_edit_date": 1434255858, "creation_date": 1434255051, "answer_id": 30825863, "question_id": 30825686, "link": "https://stackoverflow.com/questions/30825686/parsec-running-out-of-memory/30825863#30825863", "title": "parsec running out of memory", "body": "<p>Do you have a good reason to not use <a href=\"https://hackage.haskell.org/package/cassava\" rel=\"nofollow\">Cassava</a>? It can be used to stream CSV data and is probably more robust than an ad hoc CSV parser. My own experience with it has shown it has excellent performance and can be easily extended to parse your own types.</p>\n\n<p>Edit: It also looks like you're working with tab separated value data, not comma separated data, but Cassava lets you specify what delimiter to split columns by.It also appears that the data you have is potentially different on each line so you may need to use Cassava's 'raw' format which returns a Vector ByteString for each line, which you can then parse based on the first element.</p>\n\n<p>I've never seen anyone use the AVL tree package before, is there a good reason you aren't using more standard structures? That package is quite old (Last updated in 2008) and more recent packages are likely to perform better.</p>\n"}], "owner": {"reputation": 47, "user_id": 4862811, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47cb07a6d89a3248d45917da0fa71b0f?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoCamel", "link": "https://stackoverflow.com/users/4862811/cryptocamel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1434255858, "creation_date": 1434252359, "question_id": 30825686, "link": "https://stackoverflow.com/questions/30825686/parsec-running-out-of-memory", "title": "parsec running out of memory", "body": "<p>I wrote a parser for a large csv file which works on a smaller subset but runs out of memory for ~1.5m lines (the actual file).\nAfter initially parsing all elements into a list(using manyTill), i instead used the parser state to store them in a single binary search tree - this worked for the large file.</p>\n\n<p>i have since split the \"element type\" in three separate types and want to store them in their own tree, resulting in three trees of different type.\nThis version, though, only works for the small test file while running out of memory for the larger one.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.Tree.AVL as AVL\nimport qualified Text.ParserCombinators.Parsec as Parsec\n----\ndata ENW = ENW (AVL.AVL Extent) (AVL.AVL Node) (AVL.AVL Way)\n---- used to be Element = Extent | Node | Way  in a (Tree Element) - this worked\ncsvParser :: Parsec String ENW ENW\ncsvParser = do (Parsec.manyTill (parseL) Parsec.eof) &gt;&gt; Parsec.getState\n    where parseL = parseLine &gt;&gt; ((Parsec.newline &gt;&gt; return ()) &lt;|&gt; Parsec.eof)\n\nparseLine :: Parsec String ENW ()\nparseLine = parseNode &lt;|&gt; parseWay &lt;|&gt; parseExtents\n\nparseNode :: Parsec String ENW ()\nparseNode = Parsec.string \"node\" *&gt; (flip addNode &lt;$&gt; (Node &lt;$&gt; identifier &lt;*&gt; float &lt;*&gt; float)) &gt;&gt;= Parsec.updateState\n    where identifier = Parsec.tab *&gt; (read &lt;$&gt; Parsec.many1 Parsec.digit)\n          float      = Parsec.tab *&gt; (read &lt;$&gt; parseFloat)\n\naddNode :: ENW -&gt; Node -&gt; ENW\naddNode (ENW e n w) node  = (ENW e (AVL.push (sndCC node) node n) w)\n</code></pre>\n\n<p>parseWay and parseExtent follow the same pattern and the whole thing is started with </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Parsec.runParser csvParser (ENW AVL.empty AVL.empty AVL.empty) \"\" input\n</code></pre>\n\n<p>i dont understand how using three smaller trees instead of a single large one can cause memory issues.</p>\n"}, {"tags": ["macos", "haskell", "opengl", "glut", "gloss"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1434253511, "post_id": 30825272, "comment_id": 49697390, "body": "According to the <a href=\"https://github.com/haskell-opengl/GLUT/issues/19\" rel=\"nofollow noreferrer\">GLUT issue tracker</a>, this a GHC bug."}, {"owner": {"reputation": 865, "user_id": 664470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53821b46f4e74cdc9a01ef4263af98aa?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#244;me Mahuet", "link": "https://stackoverflow.com/users/664470/j%c3%a9r%c3%b4me-mahuet"}, "edited": false, "score": 0, "creation_date": 1434894848, "post_id": 30825272, "comment_id": 49962304, "body": "I have the same problem. Works fine in GHC 7.8.x tho."}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 0, "creation_date": 1435502526, "post_id": 30825272, "comment_id": 50217319, "body": "anyone know if it&#39;s been fixed in the current RC for 7.10.2? Hopefully the RC will be available at <a href=\"https://ghcformacosx.github.io/\" rel=\"nofollow noreferrer\">ghcformacosx.github.io</a> soon."}, {"owner": {"reputation": 865, "user_id": 664470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53821b46f4e74cdc9a01ef4263af98aa?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#244;me Mahuet", "link": "https://stackoverflow.com/users/664470/j%c3%a9r%c3%b4me-mahuet"}, "edited": false, "score": 0, "creation_date": 1436196859, "post_id": 30825272, "comment_id": 50496987, "body": "@daj Not yet fixed, see: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10568\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/10568</a>"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 303, "favorite_count": 1, "answer_count": 0, "score": 8, "last_activity_date": 1435536590, "creation_date": 1434246746, "last_edit_date": 1435536590, "question_id": 30825272, "link": "https://stackoverflow.com/questions/30825272/haskell-gloss-example-error-w-glut-dynamic-library-symbol-not-found-glutbitm", "title": "haskell/gloss example error w/ GLUT dynamic library &quot;Symbol not found: _glutBitmap8By13 error&quot;", "body": "<p>When I load the haskell / gloss examples (so far I've tried Wave and Snow), I seem to be getting an error with finding something in the GLUT shared libraries. What might cause this error and how can I fix it?</p>\n\n<pre><code>can't load .so/.DLL for: /Users/jd/sandbox/.cabal-sandbox/lib/x86_64-osx-ghc-7.10.1/GLUT_J2ZZFJOYOcH4hQYFlXhEPp/libHSGLUT-2.7.0.1-0waW9bZutCf5s5H5zSV4Oh-ghc7.10.1.dylib (dlopen(/Users/jd/sandbox/.cabal-sandbox/lib/x86_64-osx-ghc-7.10.1/GLUT_J2ZZFJOYOcH4hQYFlXhEPp/libHSGLUT-2.7.0.1-0waW9bZutCf5s5H5zSV4Oh-ghc7.10.1.dylib, 5): Symbol not found: _glutBitmap8By13\n  Referenced from: /Users/jd/sandbox/.cabal-sandbox/lib/x86_64-osx-ghc-7.10.1/GLUT_J2ZZFJOYOcH4hQYFlXhEPp/libHSGLUT-2.7.0.1-0waW9bZutCf5s5H5zSV4Oh-ghc7.10.1.dylib\n  Expected in: flat namespace\n in /Users/jd/sandbox/.cabal-sandbox/lib/x86_64-osx-ghc-7.10.1/GLUT_J2ZZFJOYOcH4hQYFlXhEPp/libHSGLUT-2.7.0.1-0waW9bZutCf5s5H5zSV4Oh-ghc7.10.1.dylib)\n</code></pre>\n\n<p>This is on mac OSX 10.9.5 with GHC 7.10.1</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1434265720, "post_id": 30824699, "comment_id": 49699271, "body": "You forget that <i>any</i> number <code>k</code> can be described as <code>2*k+1</code>! Plus <code>n+k</code> patterns are disabled by default, and <code>n*k</code> patterns don&#39;t exist, as far as I&#39;m aware."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1434240094, "last_edit_date": 1495540376, "creation_date": 1434239780, "answer_id": 30824736, "question_id": 30824699, "link": "https://stackoverflow.com/questions/30824699/define-function-in-haskell-with-computations-in-arguments/30824736#30824736", "title": "Define function in Haskell with computations in arguments", "body": "<p>You can define this as follows:</p>\n\n<pre><code>f 0 = 1\nf i | even i = sin(k) * cos(k)\n    | otherwise = cos(k/2) - tan(2*k)\n    where k = fromIntegral $ div i 2\n</code></pre>\n\n<p>I replaced <code>x</code> by <code>f</code> because <code>x</code> looks more like a <em>variable</em> than a function. Furthermore I used <code>i</code> as the incoming parameter.</p>\n\n<p><code>div i 2</code> means you divide <code>i</code> by <code>2</code> (and floor the result), such that <code>0</code> maps to <code>0</code>, <code>1</code> to <code>0</code> and <code>2</code> to <code>1</code>. Then one can use <code>fromIntegral</code> to convert it to a <code>Floating</code>; otherwise you cannot take the <code>sin</code>, etc.</p>\n\n<p>Now there are two cases (except from the <code>f 0</code> case): the one where <code>i</code> is <code>even</code> (<code>2*k</code>) and the one where <code>i</code> is <code>odd</code> (in this case <code>otherwise</code>). You can use <a href=\"https://stackoverflow.com/q/27609172/67579\">guards</a> for this. For the even case, we now use <code>sin(k) * cos(k)</code> and for the other one <code>cos(k/2)-tan(2*k)</code>. Note that for the <code>k/2</code> we use a floating point, so if <code>i</code> is <code>7</code>, <code>k</code> will be <code>3</code> and you will thus calculate the <code>cos(1.5)-tan(6)</code>.</p>\n"}], "owner": {"reputation": 866, "user_id": 2415602, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pSmrA.jpg?s=128&g=1", "display_name": "J. A. Corbal", "link": "https://stackoverflow.com/users/2415602/j-a-corbal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 30824736, "answer_count": 1, "score": 2, "last_activity_date": 1434240094, "creation_date": 1434239460, "question_id": 30824699, "link": "https://stackoverflow.com/questions/30824699/define-function-in-haskell-with-computations-in-arguments", "title": "Define function in Haskell with computations in arguments", "body": "<p>How can I define a function in Haskell like this:</p>\n\n<pre><code>x(0)     = 1\nx(2*k)   = sin(k) * cos(k)\nx(2*k+1) = cos(k/2) - tan(2*k)\n</code></pre>\n\n<p>Haskell does not allow to define a function with computation in its arguments. It will raise a \"Parse error in pattern\" error.</p>\n\n<p>If I try to define everything in terms of <code>x(k)</code>, like this:</p>\n\n<pre><code>x(k) = sin(k/2) * cos(k/2)\nx(k) = cos((k/2-1)/2) - tan(k/2-1)\n</code></pre>\n\n<p>I will have two definitions for <code>x(k)</code>, which is not valid.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1434237308, "post_id": 30824345, "comment_id": 49694771, "body": "Have you read any of the documentation about how GHC works? The slightly outdated spineless tagless G-machine paper and the GHC Commentary together cover this in significant detail."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1434240120, "post_id": 30824345, "comment_id": 49695346, "body": "@Daniel, I actually attempted to read them but dropped out. Like many people I learn best by slowly putting together small pieces of information. Reading papers requires a &quot;linear&quot; understanding of all presented concepts, including prerequisities. I believe an answer to this question SO will also help others make step forward in learning Haskell."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1434241067, "post_id": 30824345, "comment_id": 49695519, "body": "What are you hoping will be done differently in an SO answer here compared to the existing literature? It&#39;s a big topic, and &quot;one has to understand the prerequisites&quot; isn&#39;t really something that can be changed by writing the answer down a second time."}, {"owner": {"reputation": 1969, "user_id": 3041008, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cqLI9.png?s=128&g=1", "display_name": "mucaho", "link": "https://stackoverflow.com/users/3041008/mucaho"}, "edited": false, "score": 1, "creation_date": 1434246311, "post_id": 30824345, "comment_id": 49696363, "body": "I think @sevo has a valid point. Many papers target experts in their field and not practitioners. That&#39;s why we have books, tutorials, guides and this Q&amp;A site. However, I agree that getting an understanding of prerequisites is desirable (if time/effort allows this)."}], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1515942434, "post_id": 30840655, "comment_id": 83484234, "body": "So the code that eventually forces a thunk does so in a similar fashion to C calling convention? Or is it using GHC-specific conventions (and heap-allocated stack) that are otherwise similar in principle?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1516007943, "post_id": 30840655, "comment_id": 83502566, "body": "I&#39;m a little out of my depth here, but I believe it&#39;s something not unlike thiscall. (The thunk evaluation code gets a pointer to the thunk being evaluated. I think there&#39;s some other global pointers as an optimisation too.) If you&#39;re really interested in this stuff, check out the GHC code commentary."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1434357234, "creation_date": 1434357234, "answer_id": 30840655, "question_id": 30824345, "link": "https://stackoverflow.com/questions/30824345/continuation-versus-call-stack-in-haskell/30840655#30840655", "title": "Continuation versus call stack in Haskell", "body": "<p>GHC (or rather, the GHC RTS) has a normal call stack, like most things.</p>\n\n<p>What's different is the contents of this stack. It doesn't match what you might expect.</p>\n\n<p>Suppose that function <code>foo</code> calls function <code>bar</code> which calls function <code>baz</code>. You <em>might</em> be expecting the call stack to look like</p>\n\n<pre><code>foo\nbar\nbaz\n</code></pre>\n\n<p>at some point. But actually, when <code>foo</code> calls <code>bar</code>, all the \"call\" really does is create a thunk and return instantly. So <code>bar</code> doesn't appear on that stack at that point. But when <code>foo</code> returns some data to the caller, and the caller decides to do something with it, at that point <code>bar</code> may appear on the call stack, even though <code>foo</code> is nowhere to be seen.</p>\n\n<p>In short, the order of stuff on the call stack is unrelated to who calls who. It's determined by who looks at what.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1434357234, "creation_date": 1434235870, "question_id": 30824345, "link": "https://stackoverflow.com/questions/30824345/continuation-versus-call-stack-in-haskell", "title": "Continuation versus call stack in Haskell", "body": "<p>How does Haskell (GHC) runtime know what code should be executed next after evaluation of a thunk? </p>\n\n<p>On a conceptual level, how is that different from call stack in other programming languages (other than storing closed variables on heap and having tail recursion)?</p>\n"}, {"tags": ["multithreading", "haskell", "stm"], "comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1434234887, "post_id": 30824054, "comment_id": 49694186, "body": "What&#39;s your outer problem? Why would you want this?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1434238453, "post_id": 30824054, "comment_id": 49695054, "body": "Would you be willing to consider a solution which makes the send be an <code>IO</code> action rather than an <code>STM</code> one (but receiving is still an <code>STM</code> action)? What about vice versa (send is an <code>STM</code> action but receive is an <code>IO</code> action)?"}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434269269, "post_id": 30824054, "comment_id": 49699994, "body": "I need to be able to combine actions (in order to be able to read from several of these things at once and unblock as soon as the first thing becomes readable). AFAIK this can only be done with <code>STM</code>."}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1434315051, "post_id": 30824054, "comment_id": 49713335, "body": "@Daniel Wagner: in fact, yes. See below."}], "answers": [{"comments": [{"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434270355, "post_id": 30824189, "comment_id": 49700225, "body": "In other systems, I&#39;d build this by bolting together semaphores. I&#39;d need to sit down and think this through properly, but a write has two blocking stages (wait for empty, then post message, then wait for empty again) while a read just has one (wait for full, then read message). So it probably doesn&#39;t make sense for the write to be a single transaction, even though that loses me composability. The <code>TMVar</code> source code is admirably simple; I might try adding a &#39;block until empty&#39; action. If I try to do something impossible inside a transaction, will <code>STM</code> error out or just deadlock?"}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "reply_to_user": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434279889, "post_id": 30824189, "comment_id": 49702487, "body": "Both: STM errors out if it deadlocks. You can&#39;t add a &quot;block until empty&quot; inside the same transaction as a &quot;put&quot;, since it&#39;ll just deadlock because the transaction will never get committed (and also because STM has no concept of blocking)."}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434280177, "post_id": 30824189, "comment_id": 49702564, "body": "You, I&#39;d need to do it in two transactions and rely on higher-level stuff to keep it consistent. ...I&#39;m astonished such a thing doesn&#39;t already exist; basically what I want is Linda. Surely someone&#39;s done this?"}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "reply_to_user": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434283234, "post_id": 30824189, "comment_id": 49703349, "body": "If you make it two transactions it&#39;s no longer composable and you lose STM&#39;s transactional guarantees. It would be easier and more sensible to implement this in IO with an <code>MVar</code>."}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434283411, "post_id": 30824189, "comment_id": 49703389, "body": "Yep, I&#39;ll have to change my design. The only thing I need composability for is to wait for changes on multiple channels; given that the wait-until-consumed stage only happens after one channel has become writeable, that can happen in a different transaction. I haven&#39;t found a way to compose MVars."}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434284709, "post_id": 30824189, "comment_id": 49703728, "body": "No, dammit, that won&#39;t work. If the channel fills up again soon enough after the consumer removes the value, the producer won&#39;t notice it&#39;s empty and so won&#39;t wake up. (Which is likely to happen if the consumer replies back on the same channel.) This is why I hate building IPC systems."}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "reply_to_user": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434284784, "post_id": 30824189, "comment_id": 49703752, "body": "I&#39;m still not sure why you&#39;re so certain you can&#39;t use an <code>MVar</code>."}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434285199, "post_id": 30824189, "comment_id": 49703884, "body": "How do I block on multiple MVars?"}, {"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "reply_to_user": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434286680, "post_id": 30824189, "comment_id": 49704306, "body": "<code>TMVar</code>, rather, I understand why you can&#39;t use <code>MVar</code>."}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434315162, "post_id": 30824189, "comment_id": 49713371, "body": "So I wrote an implementation using three <code>TSem</code>s and a <code>TVar</code>. Some very very basic testing shows it <i>appears</i> to work, but it&#39;s not like it&#39;s being heavily used right now. I&#39;ll post it as an answer in a few days once I know it&#39;s a bit more reliable. Thank-you for the conversation --- it was really useful in figuring this out."}], "tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": false, "score": 3, "last_activity_date": 1434234562, "creation_date": 1434234562, "answer_id": 30824189, "question_id": 30824054, "link": "https://stackoverflow.com/questions/30824054/tmvar-but-without-the-buffer/30824189#30824189", "title": "TMVar, but without the buffer?", "body": "<p>If I understand your problem correctly, I don't think you can, since the transactional guarantees mean that transaction A can't read from transaction B's write until transaction B is committed, at which point it can no longer block.</p>\n\n<p><code>TMVar</code> is the closest you're going to get if you're using STM. With IO, you may be able to build a structure which only completes a write when a reader is available (this structure may already exist, but I'm not aware of it).</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 0, "last_activity_date": 1434286408, "creation_date": 1434286408, "answer_id": 30829613, "question_id": 30824054, "link": "https://stackoverflow.com/questions/30824054/tmvar-but-without-the-buffer/30829613#30829613", "title": "TMVar, but without the buffer?", "body": "<p>I'd suggest to reformulate the two requirements:</p>\n\n<blockquote>\n  <ul>\n  <li>will cause all writes to block until the message is consumed;</li>\n  <li>will cause all reads to block until a message is provided.</li>\n  </ul>\n</blockquote>\n\n<p>The problem is with terms <em>block</em> and <em>consumed/provided</em>. With STM there is no notion of <em>block</em>, there is just <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/GHC-Conc-Sync.html#v:retry\" rel=\"nofollow\"><code>retry</code></a>, which has a different semantics: It restarts the current transaction - it doesn't wait until something happens (this could cause deadlocks). So we can't say \"block until ...\", we can only say something like \"the transaction succeeds only when ...\".</p>\n\n<p>Similarly, what does \"until a message is consumed/provided\" mean? Since transactions are atomic, it can only be \"until the transaction that consumed/provided a message succeeded\".</p>\n\n<p>So let's try to reformulate:</p>\n\n<blockquote>\n  <ul>\n  <li>will cause all writes to retry until a transaction that consumes the message succeeds;</li>\n  <li>will cause all reads to retry until a transaction that provides a message succeeds.</li>\n  </ul>\n</blockquote>\n\n<p>But now the first point doesn't make sense: If a write retries, there is no message to be consumed, the transaction didn't pause, it's been discarded and started over - possibly producing a different message!</p>\n\n<p>In other words: Any data can ever leave a STM transaction only when it succeeds (completes). This is by design - the transactions are always <em>atomic</em> from the point of view of the outside world / other transactions - you can never observe results of only a part of a transaction. You can never observe two transactions interacting.</p>\n\n<p>So a 0-length queue is a bad analogy - it will never allow to pass any data though. At the end of any transaction, it'll have to have to be empty, so no data will ever pass through.</p>\n\n<p>Nevertheless I believe it'll be possible to reformulate the requirements according to your goals and subsequently find a solution.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1435003942, "last_edit_date": 1435003942, "creation_date": 1434316432, "answer_id": 30834614, "question_id": 30824054, "link": "https://stackoverflow.com/questions/30824054/tmvar-but-without-the-buffer/30834614#30834614", "title": "TMVar, but without the buffer?", "body": "<p>You say you would be happy with one side or the other being in <code>IO</code> rather than <code>STM</code>. So then it is not too hard to code this up. Let's start with the version that has receiving in <code>IO</code>. To make this happen, the receiver will have to initiate the handshake.</p>\n\n<pre><code>type SynchronousVar a = TChan (TMVar a)\n\nsend :: SynchronousVar a -&gt; a -&gt; STM a\nreceive :: SynchronousVar a -&gt; IO a\n\nsend svar a = do\n    tmvar &lt;- readTChan svar\n    putTMVar tmvar a\n\nreceive svar = do\n    tmvar &lt;- newEmptyTMVarIO\n    atomically $ writeTChan svar tmvar\n    atomically $ takeTMVar tmvar\n</code></pre>\n\n<p>A similar protocol can be written that has sending start the handshake.</p>\n\n<pre><code>type SynchronousVar a = TChan (a, TMVar ())\n\nsend :: SynchronousVar a -&gt; a -&gt; IO a\nreceive :: SynchronousVar a -&gt; STM a\n\nsend svar a = do\n    tmvar &lt;- newEmptyTMVarIO\n    atomically $ writeTChan svar (a, tmvar)\n    atomically $ takeTMVar tmvar\n\nreceive svar = do\n    (a, tmvar) &lt;- readTChan svar\n    putTMvar tmvar ()\n    return a\n</code></pre>\n\n<p>Probably, if you really need synchronous communication, this is because you want two-way communication (i.e. the action that's running in <code>IO</code> wants to know something about the thread it's synchronizing with). It is not hard to extend the above protocol to pass off a tad more information about the synchronization (by adding it to the one-tuple in the former case or to the <code>TMVar</code> in the latter case).</p>\n"}], "owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1435003942, "creation_date": 1434233333, "question_id": 30824054, "link": "https://stackoverflow.com/questions/30824054/tmvar-but-without-the-buffer", "title": "TMVar, but without the buffer?", "body": "<p>I'm trying to do communication between Haskell lightweight threads. Threads want to send each other messages for communication and synchronisation.</p>\n\n<p>I was originally using <code>TMVar</code> for this, but I've just realised that the semantics are wrong: a <code>TMVar</code> will store one message in it internally, so positing a message to an empty <code>TMVar</code> won't block. It'll only block if you post a message to a <em>full</em> <code>TMVar</code>.</p>\n\n<p>Can anyone suggest a similar <code>STM</code> IPC construct which:</p>\n\n<ul>\n<li>will cause all writes to block until the message is consumed;</li>\n<li>will cause all reads to block until a message is provided?</li>\n</ul>\n\n<p>i.e. a zero-length pipe would be ideal; but I don't think <code>BoundedChan</code> would be happy if I gave it a capacity of 0. (Also, it's not <code>STM</code>.)</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 2, "last_activity_date": 1434259973, "last_edit_date": 1434259973, "creation_date": 1434230147, "answer_id": 30823612, "question_id": 30823523, "link": "https://stackoverflow.com/questions/30823523/how-to-extract-the-final-part-of-the-urls-path-in-haskell/30823612#30823612", "title": "How to extract the final part of the URL&#39;s path in Haskell", "body": "<p>You can quite easily extract just the final part from a <code>URI</code>.</p>\n\n<p>Extract the <code>uriPath</code> from the parsed <code>URI</code>, and then just take in reverse until you hit a slash.</p>\n\n<p>For example, </p>\n\n<pre><code>getFinalPart :: URI -&gt; String\ngetFinalPart = reverse . takeWhile (/='/') . reverse . uriPath\n</code></pre>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 30823612, "answer_count": 1, "score": 1, "last_activity_date": 1434259973, "creation_date": 1434229505, "question_id": 30823523, "link": "https://stackoverflow.com/questions/30823523/how-to-extract-the-final-part-of-the-urls-path-in-haskell", "title": "How to extract the final part of the URL&#39;s path in Haskell", "body": "<p>I am using <code>Network.URI</code> to parse a url (<code>String</code>).\nHow can I get from the returned <code>URI</code> (<code>parseUri url</code>) the last part of the path? Or there are better alternatives than <code>Network.URI</code>? </p>\n\n<p>For example from:\n<a href=\"http://www.foo.com/foo1/foo2/bar.html?q=2&amp;q2=x#tag\" rel=\"nofollow\">http://www.foo.com/foo1/foo2/bar.html?q=2&amp;q2=x#tag</a> </p>\n\n<p>I would like to get just \"bar.html\"</p>\n"}, {"tags": ["haskell", "compression"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1434223039, "post_id": 30822148, "comment_id": 49691052, "body": "I notice you are using <code>String</code>s right now. Those are linked lists of <code>Chars</code>, so not generally a good way to store or manipulate large amounts of text. Have you tried using <code>ByteString</code>s or <code>Text</code>s? I also see that you&#39;re appending to the end of lists quite a bit, which is typically inefficient."}, {"owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1434223593, "post_id": 30822148, "comment_id": 49691210, "body": "So what could I do to avoid appending?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434224549, "post_id": 30822148, "comment_id": 49691503, "body": "Qndel: use Data.Sequence or Data.DList. Data.DList is faster, but it should be only inspected after you finished building it, or else it&#39;s just as slow for appending as lists."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1434224680, "post_id": 30822148, "comment_id": 49691549, "body": "You could also look into a <code>ByteString</code> <code>Builder</code>: <a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Builder.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bytestring-0.10.6.0/docs/&hellip;</a>. I feel like a <code>DList</code> might be a bit memory inefficient since it would still be making a very large linked list of characters."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1434253848, "post_id": 30822148, "comment_id": 49697440, "body": "or you could just prepend rather than append. If you reverse everything, it doesn&#39;t matter to the algorithm."}, {"owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "edited": false, "score": 0, "creation_date": 1434271756, "post_id": 30822148, "comment_id": 49700532, "body": "After modifying decompress by adding some prepending, I got 4 seconds instead of 18, but the program is still unable to process the 500 kb file.  And a question: When I ran the program for 500 kb file with trace, it was obviously much slower, because it had to write things to the screen - it took like 15 minutes to process the file. When I launched the program without trace, it has been running silently for 30 min and never ended - what could be the case?"}, {"owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1434273856, "post_id": 30822148, "comment_id": 49701013, "body": "@rampion, with C++ code I got 1 second, with modified haskell code I got 3 seconds, which is quite good! Your suggestion to prepend instead of appending saved my life :)"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1434359202, "post_id": 30822148, "comment_id": 49726255, "body": "@Qndel If removing <code>trace</code> changes the performance, it&#39;s to do with laziness somehow. By printing stuff out, you force it to be evaluated, possibly sooner than it would have been."}, {"owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "edited": false, "score": 0, "creation_date": 1434618527, "post_id": 30822148, "comment_id": 49859629, "body": "no, trace doesn&#39;t force evaluation :D I learned it the hard way"}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "edited": false, "score": 0, "creation_date": 1434618595, "post_id": 30841462, "comment_id": 49859669, "body": "changed appending to prepending and it went from 600 seconds to 3 seconds, so I think I&#39;m close to C++ :D"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1434359723, "creation_date": 1434359723, "answer_id": 30841462, "question_id": 30822148, "link": "https://stackoverflow.com/questions/30822148/haskell-lempel-ziv-78-compression-very-slow-why/30841462#30841462", "title": "Haskell - Lempel-Ziv 78 Compression - very slow, why?", "body": "<p>As others have already said in the comments:</p>\n\n<ul>\n<li><p>Avoid using <code>String</code>; it uses a lot of RAM and it's quite slow to process. Use <code>ByteString</code> (if you're expecting to process raw binary data) or <code>Text</code> (if you're expecting Unicode text).</p></li>\n<li><p>Don't append to lists. (<code>String</code> is also a list &mdash; but don't use <code>String</code> in the first place.) Prepend if it's easy. If not, use <code>Data.Sequence</code>, <code>Data.Set</code> or <code>Data.Map</code> as appropriate. Or maybe even <code>Text</code>, <code>ByteString</code> or <code>Vector</code>.</p></li>\n<li><p>If you see a Haskell program that's really slow <em>and</em> uses buckets of RAM even though the input and output files are tiny, you  probably have something somewhere being too lazy.</p></li>\n</ul>\n\n<p>As an example, I had a program to produce a byte histogram. It took about 20 minutes and consumed 8 GB of RAM. I changed a data constructor to be strict, simply by adding a single <code>!</code> to it. Now the program takes a fraction of a second! Laziness can make an absurdly large difference if you get it wrong.</p>\n\n<p>Looking at the code you've posted, that probably covers it all. (I'm not sure exactly what changes you've tried and where you're up to now.)</p>\n"}], "owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1434359723, "creation_date": 1434220134, "last_edit_date": 1592644375, "question_id": 30822148, "link": "https://stackoverflow.com/questions/30822148/haskell-lempel-ziv-78-compression-very-slow-why", "title": "Haskell - Lempel-Ziv 78 Compression - very slow, why?", "body": "<p>So I've finished my Lempel-Ziv compression/decompression, but compared to C++ its unbelievably slow,\nI've tried it on\n<a href=\"http://norvig.com/big.txt\" rel=\"nofollow noreferrer\">http://norvig.com/big.txt</a> file, but my program can't process it, while in C++ it took only 1 second. Could any of you Haskell Gurus look at my code and tell me if there are some obvious flaws?</p>\n<h1>After adding prepending instead of appending, I managed to reduce the time from 16 seconds to 0.4!</h1>\n<p>Haskell's laziness is so deceiving, it was printing 'compression finished' almost immediately, but in fact it was the compression that made the program run so slow</p>\n<pre><code>import System.IO  \nimport Control.Monad\nimport qualified Data.Map as Map\nimport Debug.Trace\nmain = do  \n  contents &lt;- readFile &quot;plik.txt&quot;  \n  let compressed = reverse $ compress contents Map.empty 1 &quot;&quot; []  \n  let decompressed = reverse $ decompress compressed Map.empty 1 &quot;&quot;\n  --print $ contents\n  print $ length compressed\n  print $ length decompressed\n  --print $ contents == decompressed\ncompress :: String -&gt; Map.Map String Int -&gt; Int -&gt; String -&gt; [(Int,Char)]-&gt; [(Int,Char)]\ncompress (s:x) m i c out = do\n    if Map.member (c++[s]) m == False \n        then do \n            if c == &quot;&quot;\n                then do\n                    let newMap = Map.insert [s] i m\n                    compress x newMap (i+1) c ((0,s):out)\n                else do\n                    let newMap = Map.insert (c++[s]) i m\n                    compress x newMap (i+1) &quot;&quot; ((newMap Map.! c, s):out)\n        else compress x m i (c++[s]) out\n    \ncompress s m i c out = compress2 out\n\ncompress2 ::  [(Int,Char)]-&gt; [(Int,Char)]\ncompress2 out = trace(&quot;COMPRESSION FINISHED&quot;) out\n\n\n\ndecompress :: [(Int,Char)] -&gt; Map.Map Int String -&gt; Int -&gt; String -&gt; String\ndecompress (s:x) m i out = do\n    if fst s ==  0\n        then do\n            let newMap = Map.insert i [snd s] m\n            decompress x newMap (i+1) ((snd s):out)\n        else do\n            let newMap =  Map.insert i ((m Map.! fst s)++[snd s]) m\n            decompress x newMap (i+1) ((snd s):(reverse (newMap Map.! fst s))++out)\n    \ndecompress s m i out = out\n\ndecompress2 ::  String -&gt; String\ndecompress2 out =  trace(&quot;DECOMPRESSION FINISHED&quot;) out\n</code></pre>\n"}, {"tags": ["string", "function", "haskell", "take"], "comments": [{"owner": {"reputation": 23895, "user_id": 472416, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa78d79fb4238d200e26fb87e3de947b?s=128&d=identicon&r=PG", "display_name": "utdemir", "link": "https://stackoverflow.com/users/472416/utdemir"}, "edited": false, "score": 1, "creation_date": 1434216438, "post_id": 30821491, "comment_id": 49689161, "body": "Can you show us what you tried and where you stuck?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1434216642, "post_id": 30821491, "comment_id": 49689233, "body": "I have removed your last sentence; it is too easy to interpret it as a snarky comment about Haskell and its practitioners. In case it was intended to be that way: don&#39;t do that again."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1434217548, "post_id": 30821491, "comment_id": 49689511, "body": "At chi&#39;s prompting: what exactly does &quot;without cutting words&quot; mean? I&#39;m not sure I understand the question yet."}, {"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "edited": false, "score": 0, "creation_date": 1434270956, "post_id": 30821491, "comment_id": 49700374, "body": "I am trying to align the text left for a given column width, that&#39;s why I try not to cut words, but if there is a word at the number n , just take some chars before it and then use <code>\\n</code> to start again for the next line."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1434283281, "post_id": 30821491, "comment_id": 49703360, "body": "@user4325010 Define &quot;word&quot;; it may be obvious to you, but &quot;word&quot; is a very fluid concept. Also, are you sure you don&#39;t want to write a (simple) parser for this kind of task, instead of relying only on <code>take</code> and <code>drop</code>?"}, {"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1434283542, "post_id": 30821491, "comment_id": 49703418, "body": "@Jubobs Words are substrings divided with space (<code>&quot; \\t\\n&quot;</code>). Well, such parser implementation would be interesting to see and I have turned to <code>take</code> and <code>drop</code> only because it was the obvious."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1434901257, "post_id": 30821491, "comment_id": 49964205, "body": "I think @Jubobs is right. You basically want a parser whose state includes a letter count along with the string."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1500234487, "post_id": 30821491, "comment_id": 77234716, "body": "In answer to the question <i>title</i>: yes, there is a function that drops and takes at the same time: it&#39;s called <code>splitAt</code>. There&#39;s also an equivalent function for <code>dropWhile</code>/<code>takeWhile</code>."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1500270794, "post_id": 30821491, "comment_id": 77242806, "body": "This works, although it&#39;s a tad convoluted: <a href=\"https://gist.github.com/SwiftsNamesake/4a3080fb7de41cb8e89604445d712940\" rel=\"nofollow noreferrer\">gist.github.com/SwiftsNamesake/4a3080fb7de41cb8e89604445d712&zwnj;&#8203;940</a>"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1434217136, "post_id": 30821525, "comment_id": 49689369, "body": "The OP specified &quot;without cutting words&quot;, so a bit more care is needed."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": -1, "last_activity_date": 1434216503, "creation_date": 1434216503, "answer_id": 30821525, "question_id": 30821491, "link": "https://stackoverflow.com/questions/30821491/haskell-take-and-drop-at-the-same-time/30821525#30821525", "title": "Haskell take and drop at the same time", "body": "<p><a href=\"http://hackage.haskell.org/package/split-0.2.2/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow\"><code>Data.List.Split.chunksOf</code></a> does this.</p>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1148, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1434272057, "creation_date": 1434216285, "last_edit_date": 1434272057, "question_id": 30821491, "link": "https://stackoverflow.com/questions/30821491/haskell-take-and-drop-at-the-same-time", "title": "Haskell take and drop at the same time", "body": "<p>I was wondering how can I achieve: </p>\n\n<p>Taking the first n characters of a string then <code>++</code>(concatenating them with) drop these first n and take the next n and so on (without cutting words). I have tried function composition and <code>$</code> but the only thing I get, is errors.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I am trying to align the text left for a given column width (n), that's why I try not to cut words, but if there is a word at the number n , just take some chars before it and then use \\n to start again for the next line. My main problems so far are checking for the cut-words condition(I can use <code>!!</code> but should I use it in guards with map(-1) or how else) and implementing the recursion because as a base I got </p>\n\n<pre><code>take n s ++ \"\\n\" ++ take n (drop n s)\n</code></pre>\n\n<p>and also the case where n is smaller than the longest word:</p>\n\n<pre><code>leftAlign n str = if n &lt; ((maximum . map length . words) str) then \"\" else leftAlign n str\n</code></pre>\n"}, {"tags": ["scala", "haskell", "types", "type-constraints"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434213824, "post_id": 30821013, "comment_id": 49688402, "body": "The data constructor <code>And :: Pred c1 -&gt; Pred c2 -&gt; Pred (c1 &#47;\\ c2)</code> is not well formed because type families cannot be partially applied. However, ghc earlier than 7.10 will erroneously accept this definition - then give the errors you see when you try to do anything with it. You should use a class instead of a type family; using <code>class (c1 a, c2 a) =&gt; (&#47;\\) (c1 :: k -&gt; Constraint) (c2 :: k -&gt; Constraint) (a :: k); instance (c1 a, c2 a) =&gt; (c1 &#47;\\ c2) a</code> and the straightforward implementation of <code>eval</code> will work."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1434214182, "post_id": 30821013, "comment_id": 49688516, "body": "Thanks so much! I didn&#39;t realise type families couldn&#39;t be partially applied. GHC made me turn on <code>UndecidableInstances</code> when I wrote out your suggestion, but it worked fine :) If you want to write that up as a full answer I&#39;ll accept it."}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 5, "last_activity_date": 1434215043, "creation_date": 1434215043, "answer_id": 30821296, "question_id": 30821013, "link": "https://stackoverflow.com/questions/30821013/extracting-a-constraint-from-a-conjunction/30821296#30821296", "title": "Extracting a constraint from a conjunction", "body": "<p>The data constructors <code>And :: Pred c1 -&gt; Pred c2 -&gt; Pred (c1 /\\ c2)</code> and <code>Or :: ...</code> are not well formed because type families cannot be partially applied. However, GHC earlier than 7.10 will <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9433\">erroneously accept this definition</a> - then give the errors you see when you try to do anything with it. </p>\n\n<p>You should use a class instead of a type family; for example </p>\n\n<pre><code>class (c1 a, c2 a) =&gt; (/\\) (c1 :: k -&gt; Constraint) (c2 :: k -&gt; Constraint) (a :: k)\ninstance (c1 a, c2 a) =&gt; (c1 /\\ c2) a \n</code></pre>\n\n<p>and the straightforward implementation of <code>eval</code> will work.</p>\n"}], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 30821296, "answer_count": 1, "score": 4, "last_activity_date": 1434289710, "creation_date": 1434213269, "last_edit_date": 1434289710, "question_id": 30821013, "link": "https://stackoverflow.com/questions/30821013/extracting-a-constraint-from-a-conjunction", "title": "Extracting a constraint from a conjunction", "body": "<p>Here's a tree of Boolean predicates.</p>\n\n<pre><code>data Pred a = Leaf (a -&gt; Bool)\n            | And (Pred a) (Pred a)\n            | Or (Pred a) (Pred a)\n            | Not (Pred a)\n\neval :: Pred a -&gt; a -&gt; Bool\neval (Leaf f) = f\neval (l `And` r) = \\x -&gt; eval l x &amp;&amp; eval r x\neval (l `Or` r) = \\x -&gt; eval l x || eval r x\neval (Not p) = not . eval p\n</code></pre>\n\n<p>This implementation is simple, but the problem is that predicates of different types don't compose. A toy example for a blogging system:</p>\n\n<pre><code>data User = U {\n    isActive :: Bool\n}\ndata Post = P {\n    isPublic :: Bool\n}\n\nuserIsActive :: Pred User\nuserIsActive = Leaf isActive\n\npostIsPublic :: Pred Post\npostIsPublic = Leaf isPublic\n\n-- doesn't compile because And requires predicates on the same type\n-- userCanComment = userIsActive `And` postIsPublic\n</code></pre>\n\n<p>You could get around this by defining something like <code>data World = W User Post</code>, and exclusively using <code>Pred World</code>. However, adding a new entity to your system then necessitates changing <code>World</code>; and smaller predicates generally don't require the whole thing (<code>postIsPublic</code> doesn't need to use the <code>User</code>); client code that's in a context without a <code>Post</code> lying around can't use a <code>Pred World</code>.</p>\n\n<hr>\n\n<p>It works a charm in Scala, which will happily infer subtype constraints of composed traits by unification:</p>\n\n<pre><code>sealed trait Pred[-A]\ncase class Leaf[A](f : A =&gt; Boolean) extends Pred[A]\ncase class And[A](l : Pred[A], r : Pred[A]) extends Pred[A]\ncase class Or[A](l : Pred[A], r : Pred[A]) extends Pred[A]\ncase class Not[A](p : Pred[A]) extends Pred[A]\n\ndef eval[A](p : Pred[A], x : A) : Boolean = {\n  p match {\n    case Leaf(f) =&gt; f(x)\n    case And(l, r) =&gt; eval(l, x) &amp;&amp; eval(r, x)\n    case Or(l, r) =&gt; eval(l, x) || eval(r, x)\n    case Not(pred) =&gt; ! eval(pred, x)\n  }\n}\n\nclass User(val isActive : Boolean)\nclass Post(val isPublic : Boolean)\n\ntrait HasUser {\n  val user : User\n}\ntrait HasPost {\n  val post : Post\n}\n\nval userIsActive = Leaf[HasUser](x =&gt; x.user.isActive)\nval postIsPublic = Leaf[HasPost](x =&gt; x.post.isPublic)\nval userCanCommentOnPost = And(userIsActive, postIsPublic)  // type is inferred as And[HasUser with HasPost]\n</code></pre>\n\n<p>(This works because <code>Pred</code> is declared as contravariant - which it is anyway.) When you need to <code>eval</code> a <code>Pred</code>, you can simply compose the required traits into an anonymous subclass - <code>new HasUser with HasPost { val user = new User(true); val post = new Post(false); }</code></p>\n\n<hr>\n\n<p>I figured I could translate this into Haskell by turning the traits into classes and parameterising <code>Pred</code> by the type classes it requires, rather than the concrete type it operates on.</p>\n\n<pre><code>-- conjunction of partially-applied constraints\n-- (/\\) :: (k -&gt; Constraint) -&gt; (k -&gt; Constraint) -&gt; (k -&gt; Constraint)\ntype family (/\\) c1 c2 a :: Constraint where\n    (/\\) c1 c2 a = (c1 a, c2 a)\n\ndata Pred c where\n    Leaf :: (forall a. c a =&gt; a -&gt; Bool) -&gt; Pred c\n    And :: Pred c1 -&gt; Pred c2 -&gt; Pred (c1 /\\ c2)\n    Or :: Pred c1 -&gt; Pred c2 -&gt; Pred (c1 /\\ c2)\n    Not :: Pred c -&gt; Pred c\n\ndata User = U {\n    isActive :: Bool\n}\ndata Post = P {\n    isPublic :: Bool\n}\n\nclass HasUser a where\n    user :: a -&gt; User\nclass HasPost a where\n    post :: a -&gt; Post\n\nuserIsActive :: Pred HasUser\nuserIsActive = Leaf (isActive . user)\n\npostIsPublic :: Pred HasPost\npostIsPublic = Leaf (isPublic . post)\n\nuserCanComment = userIsActive `And` postIsPublic\n-- ghci&gt; :t userCanComment\n-- userCanComment :: Pred (HasUser /\\ HasPost)\n</code></pre>\n\n<p>The idea is that each time you use <code>Leaf</code> you define a requirement (such as <code>HasUser</code>) on the type of the whole without specifying that type directly. The other constructors of the tree bubble those requirements upwards (using constraint conjuction <code>/\\</code>), so the root of the tree knows about all of the requirements of the leaves. Then, when you want to <code>eval</code> your predicate, you can make up a type containing all the data the predicate needs (or use tuples) and make it an instance of the required classes.</p>\n\n<p>However, I can't figure out how to write <code>eval</code>:</p>\n\n<pre><code>eval :: c a =&gt; Pred c -&gt; a -&gt; Bool\neval (Leaf f) = f\neval (l `And` r) = \\x -&gt; eval l x &amp;&amp; eval r x\neval (l `Or` r) = \\x -&gt; eval l x || eval r x\neval (Not p) = not . eval p\n</code></pre>\n\n<p>It's the <code>And</code> and <code>Or</code> cases that go wrong. GHC seems unwilling to expand <code>/\\</code> in the recursive calls:</p>\n\n<pre><code>Could not deduce (c1 a) arising from a use of \u2018eval\u2019\nfrom the context (c a)\n  bound by the type signature for\n             eval :: (c a) =&gt; Pred c -&gt; a -&gt; Bool\n  at spec.hs:55:9-34\nor from (c ~ (c1 /\\ c2))\n  bound by a pattern with constructor\n             And :: forall (c1 :: * -&gt; Constraint) (c2 :: * -&gt; Constraint).\n                    Pred c1 -&gt; Pred c2 -&gt; Pred (c1 /\\ c2),\n           in an equation for \u2018eval\u2019\n  at spec.hs:57:7-15\nRelevant bindings include\n  x :: a (bound at spec.hs:57:21)\n  l :: Pred c1 (bound at spec.hs:57:7)\n  eval :: Pred c -&gt; a -&gt; Bool (bound at spec.hs:56:1)\nIn the first argument of \u2018(&amp;&amp;)\u2019, namely \u2018eval l x\u2019\nIn the expression: eval l x &amp;&amp; eval r x\nIn the expression: \\ x -&gt; eval l x &amp;&amp; eval r x\n</code></pre>\n\n<p>GHC knows <code>c a</code> and <code>c ~ (c1 /\\ c2)</code> (and therefore <code>(c1 /\\ c2) a</code>) but can't deduce <code>c1 a</code>, which would require expanding the definition of <code>/\\</code>. I have a feeling it would work if <code>/\\</code> were a type <em>synonym</em>, not a <em>family</em>, but Haskell doesn't permit partial application of type synonyms (which is required in the definition of <code>Pred</code>).</p>\n\n<hr>\n\n<p>I attempted to patch it up using <a href=\"https://hackage.haskell.org/package/constraints-0.4.1.3/docs/Data-Constraint.html\" rel=\"nofollow\"><code>constraints</code></a>:</p>\n\n<pre><code>conjL :: (c1 /\\ c2) a :- c1 a\nconjL = Sub Dict\nconjR :: (c1 /\\ c2) a :- c1 a\nconjR = Sub Dict\n\neval :: c a =&gt; Pred c -&gt; a -&gt; Bool\neval (Leaf f) = f\neval (l `And` r) = \\x -&gt; (eval l x \\\\ conjL) &amp;&amp; (eval r x \\\\ conjR)\neval (l `Or` r) = \\x -&gt; (eval l x \\\\ conjL) || (eval r x \\\\ conjR)\neval (Not p) = not . eval p\n</code></pre>\n\n<p>Not only...</p>\n\n<pre><code>Could not deduce (c3 a) arising from a use of \u2018eval\u2019\nfrom the context (c a)\n  bound by the type signature for\n             eval :: (c a) =&gt; Pred c -&gt; a -&gt; Bool\n  at spec.hs:57:9-34\nor from (c ~ (c3 /\\ c4))\n  bound by a pattern with constructor\n             And :: forall (c1 :: * -&gt; Constraint) (c2 :: * -&gt; Constraint).\n                    Pred c1 -&gt; Pred c2 -&gt; Pred (c1 /\\ c2),\n           in an equation for \u2018eval\u2019\n  at spec.hs:59:7-15\nor from (c10 a0)\n  bound by a type expected by the context: (c10 a0) =&gt; Bool\n  at spec.hs:59:27-43\nRelevant bindings include\n  x :: a (bound at spec.hs:59:21)\n  l :: Pred c3 (bound at spec.hs:59:7)\n  eval :: Pred c -&gt; a -&gt; Bool (bound at spec.hs:58:1)\nIn the first argument of \u2018(\\\\)\u2019, namely \u2018eval l x\u2019\nIn the first argument of \u2018(&amp;&amp;)\u2019, namely \u2018(eval l x \\\\ conjL)\u2019\nIn the expression: (eval l x \\\\ conjL) &amp;&amp; (eval r x \\\\ conjR)\n</code></pre>\n\n<p>but also...</p>\n\n<pre><code>Could not deduce (c10 a0, c20 a0) arising from a use of \u2018\\\\\u2019\nfrom the context (c a)\n  bound by the type signature for\n             eval :: (c a) =&gt; Pred c -&gt; a -&gt; Bool\n  at spec.hs:57:9-34\nor from (c ~ (c3 /\\ c4))\n  bound by a pattern with constructor\n             And :: forall (c1 :: * -&gt; Constraint) (c2 :: * -&gt; Constraint).\n                    Pred c1 -&gt; Pred c2 -&gt; Pred (c1 /\\ c2),\n           in an equation for \u2018eval\u2019\n  at spec.hs:59:7-15\nIn the first argument of \u2018(&amp;&amp;)\u2019, namely \u2018(eval l x \\\\ conjL)\u2019\nIn the expression: (eval l x \\\\ conjL) &amp;&amp; (eval r x \\\\ conjR)\nIn the expression:\n  \\ x -&gt; (eval l x \\\\ conjL) &amp;&amp; (eval r x \\\\ conjR)\n</code></pre>\n\n<p>It's more or less the same story, except now GHC also seems unwilling to unify the variables brought in by the GADT with those required by <code>conjL</code>. It looks like <em>this</em> time the <code>/\\</code> in the type of <code>conjL</code> <em>has</em> been expanded to <code>(c10 a0, c20 a0)</code>. (I think this is because <code>/\\</code> appears fully-applied in <code>conjL</code>, not in curried form as it does in <code>And</code>.)</p>\n\n<p>Needless to say, it's surprising to me that Scala does this better than Haskell. How can I fiddle with the body of <code>eval</code> until it typechecks? Can I cajole GHC into expanding <code>/\\</code>? Am I going about it the wrong way? Is what I want even possible?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "edited": false, "score": 0, "creation_date": 1434215510, "post_id": 30821291, "comment_id": 49688887, "body": "sir, you are my hero :) you can say its my first day with haskell :D"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1434216377, "last_edit_date": 1434216377, "creation_date": 1434215007, "answer_id": 30821291, "question_id": 30819475, "link": "https://stackoverflow.com/questions/30819475/haskell-lempel-ziv-78-compression/30821291#30821291", "title": "Haskell Lempel Ziv 78 Compression", "body": "<p>It's a parenthesization error:</p>\n\n<pre><code>compress x newMap (i+1) \"\" out++[(newMap Map.! c, s)]\n</code></pre>\n\n<p>parses as</p>\n\n<pre><code>(compress x newMap (i+1) \"\" out) ++ [(newMap Map.! c, s)]\n</code></pre>\n\n<p>But you wanted</p>\n\n<pre><code>compress x newMap (i+1) \"\" (out++[(newMap Map.! c, s)])\n</code></pre>\n\n<hr>\n\n<p>Fun problem, by the way. I tried rewriting your code to make it a little more idiomatic:</p>\n\n<pre><code>import System.IO\nimport Data.Map as M\nimport Prelude as P\n\nmain = do\n  contents &lt;- readFile \"file.txt\"\n  print $ compress contents\n\ncompress :: String -&gt; [(Int, Char)]\ncompress = reverse . third . P.foldl step (singleton \"\" 0, \"\", [])\n  where step (dict, pat, log) char =\n          let pat' = char:pat\n          in if member pat' dict\n            -- `pat'` is already in our dictionary, so\n            -- we've previously extended `pat` by `char`, and \n            -- we don't need to record anything\n            then (dict, pat', log)\n            -- pat' is new to us, so \n            --  * assign it a new id in the dictionary \n            --  * start reading a new pattern\n            --  * record it in the log\n            else (insert pat' (size dict) dict, \"\", (dict ! pat, char):log)\n        third (_, _, log) = log\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 3515647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EY95q.jpg?s=128&g=1", "display_name": "Qndel", "link": "https://stackoverflow.com/users/3515647/qndel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 30821291, "answer_count": 1, "score": 2, "last_activity_date": 1434216377, "creation_date": 1434203975, "question_id": 30819475, "link": "https://stackoverflow.com/questions/30819475/haskell-lempel-ziv-78-compression", "title": "Haskell Lempel Ziv 78 Compression", "body": "<p><a href=\"http://pl.wikipedia.org/wiki/LZ78\" rel=\"nofollow\">http://pl.wikipedia.org/wiki/LZ78</a>\nHere's a polish wikipedia site, but it contains a python code that can be used to check if the haskell code works</p>\n\n<p>I'm using the text from the example:\nabbbcaabbcbbcaaac</p>\n\n<p>My problem is that while trace is showing the char/int pairs in correct order, they somehow get messed up in the output list. Can somebody explain what's going on?</p>\n\n<p>This is the correct order:\n(0,a)\n(0,b)\n(2,b)\n(0,c)\n(1,a)\n(3,c)\n(6,a)\n(5,c)</p>\n\n<pre><code>import System.IO  \nimport Control.Monad\nimport qualified Data.Map as Map\nimport Debug.Trace\nmain = do  \n  contents &lt;- readFile \"file.txt\"    \n  print $ compress contents Map.empty 1 \"\" []\ncompress :: String -&gt; Map.Map String Int -&gt; Int -&gt; String -&gt; [(Int,Char)]-&gt; [(Int,Char)]\ncompress (s:x) m i c out = do\n    if Map.member (c++[s]) m == False \n        then do \n            if c == \"\"\n                then do\n                    let newMap = trace( show s ++ \"  0  aaaaaa\\n\") Map.insert [s] i m\n                    compress x newMap (i+1) c (out++[(0,s)])\n                else do\n                    let newMap = trace(show s ++ \"  \" ++ show (m Map.! c) ++ \"  bbbbb\\n\") Map.insert (c++[s]) i m\n                    compress x newMap (i+1) \"\" out++[(newMap Map.! c, s)]\n        else compress x m i (c++[s]) out\n\ncompress s m i c out = compress2 out\n\ncompress2 ::  [(Int,Char)]-&gt; [(Int,Char)]\ncompress2 out = out\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1434190857, "post_id": 30817146, "comment_id": 49681753, "body": "well you usually you take the environment (where variables/values/... are bound) with you on each (usually recursive) call ;) - but there are plenty tutorials on this around"}, {"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434198637, "post_id": 30817146, "comment_id": 49683767, "body": "I should add that I&#39;m not trying to <i>actually</i> write a compiler; it was just the simplest example of the kind of problem which I&#39;m trying to solve."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1434200762, "post_id": 30817146, "comment_id": 49684419, "body": "still the same - if you don&#39;t want to go into the state/reader-monad (yet) you should just make those dependencies into parameters and pass them around - FP 101 ;)"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434212158, "post_id": 30817146, "comment_id": 49687909, "body": "@Carsten Why &quot;infamous&quot;?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1434218525, "post_id": 30817146, "comment_id": 49689791, "body": "@Jubobs you are right that&#39;s unfair of me - <b>sorry</b> (I was thinking of the claim - I never managed to do it in 48 hours ;)"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434218632, "post_id": 30817146, "comment_id": 49689824, "body": "@Carsten No problem! You&#39;re entitled to your opinions <code>:)</code> I was just curious  as to why you though it was &quot;infamous&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "edited": false, "score": 0, "creation_date": 1434222243, "post_id": 30821831, "comment_id": 49690841, "body": "Hmm. So I&#39;m still rewriting the tree, but using higher order types so that each time I do so I get a tree with different annotations. I bet I can use type classes to reduce boilerplate by providing a set of default tree traversal functions, right? I quite like that. However, I&#39;m afraid I&#39;m going to have to spend some time deciphering your code --- I&#39;m new to this and am still not comfortable with monads."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1434218745, "last_edit_date": 1434218745, "creation_date": 1434218304, "answer_id": 30821831, "question_id": 30817146, "link": "https://stackoverflow.com/questions/30817146/not-mutating-trees-in-haskell/30821831#30821831", "title": "Not mutating trees in Haskell", "body": "<p>Perhaps something like this (as with your code, it is completely untested and intended only for illustrative purposes):</p>\n\n<pre><code>data Node var\n    = Block { contents :: [Node] }\n    | VarDecl { name :: var }\n    | VarAssign { name :: var, value :: Node }\n    | VarRef { name :: var }\n    | Literal { value :: Int }\n</code></pre>\n\n<p>The idea of the above type is that AST nodes are parameterized by what information they store about variables. After a mere parse, they will store just variable names (so have type <code>Node String</code>); then there will be a name resolution phase that converts them to references of some other kind (so produce type <code>Node Variable</code>). Thus:</p>\n\n<pre><code>data GenVar a\ngenVar :: String -&gt; GenVar Variable\ngenVar = undefined\n\ntype Environment = Map String Variable\nresolveNames :: Environment -&gt; Node String -&gt; MaybeT GenVar (Node Variable)\nresolveNames env ast = case ast of\n    VarDecl   name       -&gt; mzero -- variable declarations serve no purpose after all variables have been resolved\n    VarAssign name value -&gt; VarAssign &lt;$&gt; lookup name env &lt;*&gt; pure value\n    VarRef    name       -&gt; VarRef    &lt;$&gt; lookup name env\n    Literal        value -&gt; Literal   &lt;$&gt;                     pure value\n    Block contents -&gt; do\n        vars &lt;- mapM (lift . genVar) names\n        -- union is left-biased, so this will overwrite old variables\n        -- (if your language can refer to outer scopes, you will need\n        -- a more exciting environment like [Map String Variable])\n        let env' = fromList (zip names vars) `union` env\n        Block &lt;$&gt; mapM (resolveNames env') stmts\n        where\n        (decls, stmts) = partition isDecl contents\n        names = map name decls\n\nisDecl VarDecl{} = True\nisDecl _ = False\n</code></pre>\n\n<p>I left the variable generation part, where you turn a variable name into some more structured representation of a variable, up to you (since you said little about what you want the <code>Variable</code> type to look like). But a few examples: one might choose <code>Variable</code> to be some kind of mutable reference, and <code>GenVar</code> to be a suitable mutability monad; or alternately perhaps <code>Variable</code> is simply an <code>Integer</code> and <code>GenVar</code> is a supply monad.</p>\n"}], "owner": {"reputation": 12211, "user_id": 404568, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/W1j32.jpg?s=128&g=1", "display_name": "David Given", "link": "https://stackoverflow.com/users/404568/david-given"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1434218745, "creation_date": 1434188119, "question_id": 30817146, "link": "https://stackoverflow.com/questions/30817146/not-mutating-trees-in-haskell", "title": "Not mutating trees in Haskell", "body": "<p>I'm currently teaching myself Haskell; let us say, purely for the sake of argument, that I'm writing a compiler in Haskell. I have an AST, defined with something like:</p>\n\n<pre><code>data Node =\n      Block { contents :: [Node], vars :: Map String Variable }\n    | VarDecl { name :: String }\n    | VarAssign { name :: String, value :: Node, var :: Variable }\n    | VarRef { name :: String, var :: Variable }\n    | Literal { value :: Int }\n</code></pre>\n\n<p>Each <code>Block</code> is a stack frame. I wish to resolve all the variable references.</p>\n\n<p>In a world with mutable data, the way I'd do this is:</p>\n\n<ul>\n<li>walk the tree keeping track of the most recent <code>Block</code> looking for <code>VarDecl</code> nodes; at each one, I'd add a <code>Variable</code> to the closest <code>Block</code>.</li>\n<li>walk the tree again, looking for <code>VarAssign</code> and <code>VarRef</code> nodes. Each time I see one, I'd look the variable up in the stack frame chain and annotate the AST node with the corresponding <code>Variable</code>.</li>\n</ul>\n\n<p>Now, whenever I'm doing work on the tree, and come across a <code>VarRef</code>, I know precisely which <code>Variable</code> is actually being referred to.</p>\n\n<p>Of course, in Haskell I'd need a different approach, due to the tree not being mutable. The naive approach is to rewrite the tree.</p>\n\n<pre><code>declareVariables Block contents _ = Block {\n    contents = declareVariables contents,\n    vars = createVariablesFor (findVariablesInBlock contents) }\ndeclareVariables VarAssign name value var =\n    VarAssign name (declareVariables value) var\ndeclareVariables Literal i = Literal i\n...etc...\n\nfindVariablesInBlock VarDecl name = [name]\nfindVariablesInBlock Block contents _ = []\nfindVariablesInBlock VarAssign name value _ =\n    findVariablesInBlock value\n...etc...\n</code></pre>\n\n<p>(All code completely untested and purely for illustrative purposes.)</p>\n\n<p>But this is pretty gruesome; I end up walking the tree twice, once to find <code>Block</code>s and once to find <code>VarDecl</code>s, and there's an awful lot of boilerplate. Plus, given that a <code>Variable</code> isn't mutable, there's a limited amount of use to annotating all my nodes with one in the first place --- I can't usefully annotate the <code>Variable</code> without rewriting the whole tree again.</p>\n\n<p>Alternative A: I could make everything mutable. Now I've got a tree of <code>STRef</code>s and everything has to live inside the <code>ST</code> monad. As a side effect, my code smells.</p>\n\n<p>Alternative B: don't try to store everything in the same data structure. Have completely separate storage of <code>StackFrame</code> and <code>Variable</code> structures, and build these when I walk the tree, leaving the AST untouched. Except that this means I can't easily map from a <code>VarRef</code> to a <code>Variable</code>, which was the whole point of the exercise. I could create a <code>Data.Map VarRef Variable</code> lookup table... but that's gruesome, too.</p>\n\n<p>What's a good Haskell-idiom way of solving this kind of problem?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1434211051, "post_id": 30816994, "comment_id": 49687533, "body": "Both times include the time it takes to compile the program Try timing <code>gen.pyc</code> (pre-compiled) vs a precompiled binary from <code>io.hs</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "edited": false, "score": 0, "creation_date": 1434190795, "post_id": 30817180, "comment_id": 49681741, "body": "Both versions cost about 520ms (about 10% of improvement). And I think that lazy IO is deprecated because of its way of releasing resources? <a href=\"http://stackoverflow.com/questions/5892653/whats-so-bad-about-lazy-i-o\" title=\"whats so bad about lazy i o\">stackoverflow.com/questions/5892653/whats-so-bad-about-lazy-&zwnj;&#8203;i-o</a>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "edited": false, "score": 1, "creation_date": 1434191202, "post_id": 30817180, "comment_id": 49681843, "body": "Try compiling with -O2."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "edited": false, "score": 9, "creation_date": 1434191973, "post_id": 30817180, "comment_id": 49682075, "body": "<code>runhaskell</code> is always slow, no matter what the job is. GHC optimizes for executables, not interpreter speed."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1434189734, "last_edit_date": 1434189734, "creation_date": 1434188312, "answer_id": 30817180, "question_id": 30816994, "link": "https://stackoverflow.com/questions/30816994/how-to-improve-the-performance-of-haskell-io/30817180#30817180", "title": "How to improve the performance of Haskell IO?", "body": "<p>Your example is slow because it uses lazy IO with <code>String</code>-s. Both have their own overheads. </p>\n\n<p>In particular, <code>String</code> is a linked list of <code>Char</code>-s, therefore it has two words of space overhead for each character (one word for the constructor tag and one for the forward pointer), and each character takes up at least one word (one word for cached low characters, three words for uncached characters). </p>\n\n<p>Strict IO with byte or unicode array input is much faster. Try to benchmark the following:</p>\n\n<pre><code>import qualified Data.ByteString as B\n\nmain = B.putStr =&lt;&lt; B.getContents\n</code></pre>\n\n<p>Or the following:</p>\n\n<pre><code>import qualified Data.Text as T\nimport qualified Data.Text.IO as T\n\nmain = T.putStr =&lt;&lt; T.getContents\n</code></pre>\n"}], "owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 1, "accepted_answer_id": 30817180, "answer_count": 1, "score": 7, "last_activity_date": 1434189734, "creation_date": 1434187018, "question_id": 30816994, "link": "https://stackoverflow.com/questions/30816994/how-to-improve-the-performance-of-haskell-io", "title": "How to improve the performance of Haskell IO?", "body": "<p>It seems that Haskell's IO is relatively slow.</p>\n\n<p>For example, comparing Haskell with Python</p>\n\n<pre><code>#io.py\nimport sys\ns=sys.stdin.read()\nsys.stdout.write(s)\n</code></pre>\n\n<p>,</p>\n\n<pre><code>-- io.hs\nmain = do\n    s &lt;- getContents\n    putStr s\n</code></pre>\n\n<p>Their performance (gen.py writes 512k data into stdout):</p>\n\n<p>The Python version:</p>\n\n<pre><code>$ time python gen.py | python io.py &gt; /dev/null\n\nreal    0m0.203s\nuser    0m0.015s\nsys     0m0.000s\n</code></pre>\n\n<p>The Haskell version:</p>\n\n<pre><code>$ time python gen.py | runhaskell io.hs &gt; /dev/null\n\nreal    0m0.562s\nuser    0m0.015s\nsys     0m0.000s\n</code></pre>\n\n<p>It seems that the Haskell one is far lower. Is there any problem with my test? Or is it just the inherent problem of Haskell?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "template-haskell", "deriving"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1434179426, "post_id": 30815107, "comment_id": 49679342, "body": "A side note: best practice is not to abuse <code>Show</code> and <code>Read</code> this way. Have separate pretty-printing/parsing classes if you must have a class; but leave <code>Show</code> and <code>Read</code> for emitting (and parsing) valid Haskell code representing the value in question."}], "answers": [{"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1434185109, "post_id": 30815212, "comment_id": 49680456, "body": "Please, don&#39;t use TH for problems that are more easily solved without it."}], "tags": [], "owner": {"reputation": 48293, "user_id": 964135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8caec1b0320fe1b8b498936fbb6b846?s=128&d=identicon&r=PG", "display_name": "Pubby", "link": "https://stackoverflow.com/users/964135/pubby"}, "is_accepted": false, "score": 1, "last_activity_date": 1434171012, "creation_date": 1434171012, "answer_id": 30815212, "question_id": 30815107, "link": "https://stackoverflow.com/questions/30815107/custom-derivingread-show-for-enum-type/30815212#30815212", "title": "Custom deriving(Read,Show) for enum type", "body": "<p>Aha! <a href=\"https://github.com/yesodweb/yesod/wiki/Create-String-Based-Enums-With-Template-Haskell\" rel=\"nofollow\">I found some pre-existing code written by Simon Nicholls</a>. This template haskell can be used to achieve what I wanted:</p>\n\n<pre><code>genData :: Name -&gt; [Name] -&gt; DecQ\ngenData name keys = dataD (cxt []) name [] cons [''Eq, ''Enum, ''Bounded]\n  where cons = map (\\n -&gt; normalC n []) keys\n\ngenShow :: Name -&gt; [(Name, String)] -&gt; DecQ\ngenShow name pairs =\n  instanceD (cxt [])\n    (appT (conT ''Show) (conT name))\n    [funD (mkName \"show\") $ map genClause pairs]\n  where\n    genClause (k, v) = clause [(conP k [])] (normalB [|v|]) []\n\nmkEnum :: String -&gt; [(String, String)] -&gt; Q [Dec]\nmkEnum name' pairs' =\n  do\n    ddec &lt;- genData name (map fst pairs)\n    sdec &lt;- genShow name pairs\n    rdec &lt;- [d|instance Read $(conT name) where\n                 readsPrec _ value =\n                   case Map.lookup value m of\n                     Just val -&gt; [(val, [])]\n                     Nothing  -&gt; []\n                   where\n                     m = Map.fromList $ map (show &amp;&amp;&amp; id) [minBound..maxBound]|]\n    return $ ddec : sdec : rdec\n  where name  = mkName name'\n        pairs = map (\\(k, v) -&gt; (mkName k, v)) pairs'\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>$(mkEnum \"TVShow\"\n  [ (\"BobsBurgers\", \"Bob's Burgers\")\n  , (\"MrRobot\", \"Mr. Robot\")\n  , (\"BatmanTAS\", \"Batman: The Animated Series\")\n  ])\n</code></pre>\n\n<p>(The QuasiQuotes weren't working, so I'll have to investigate that)</p>\n"}, {"comments": [{"owner": {"reputation": 4854, "user_id": 1502035, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/2ZmRs.jpg?s=128&g=1", "display_name": "Kiara Grouwstra", "link": "https://stackoverflow.com/users/1502035/kiara-grouwstra"}, "edited": false, "score": 0, "creation_date": 1526939558, "post_id": 30816020, "comment_id": 87927693, "body": "<code>invertible-syntax</code> worked for me, thanks! I tried some similar packages as well -- <code>partial-isomorphisms</code> is undocumented, <code>roundtrip</code> errors with newer haskell/base, <code>aeson-roundtrip</code> depends on that, <code>JsonGrammar</code> focuses on json objects, <code>Boomerang</code> seems more complex... great to have one that actually works!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1550266091, "last_edit_date": 1550266091, "creation_date": 1434179147, "answer_id": 30816020, "question_id": 30815107, "link": "https://stackoverflow.com/questions/30815107/custom-derivingread-show-for-enum-type/30816020#30816020", "title": "Custom deriving(Read,Show) for enum type", "body": "<p>The paper <a href=\"http://www.informatik.uni-marburg.de/~kos/papers/unparse.pdf\" rel=\"nofollow noreferrer\">Invertible Syntax Descriptions: Unifying Parsing and Pretty Printing</a> describes one particularly idiomatic solution. Your example looks like this, using the <a href=\"http://hackage.haskell.org/package/invertible-syntax\" rel=\"nofollow noreferrer\">invertible-syntax</a> package based on that paper:</p>\n\n<pre><code>import Prelude hiding (Applicative(..), print)\nimport Data.Maybe (fromJust)\nimport Text.Syntax\nimport Text.Syntax.Parser.Naive\nimport Text.Syntax.Printer.Naive\n\ndata TVShow = BobsBurgers | MrRobot | BatmanTAS deriving (Eq, Ord)\n\ntvShow :: Syntax f =&gt; f TVShow\ntvShow =  pure BobsBurgers &lt;* text \"Bob's Burgers\"\n      &lt;|&gt; pure MrRobot     &lt;* text \"Mr. Robot\"\n      &lt;|&gt; pure BatmanTAS   &lt;* text \"Batman: The Animated Series\"\n\nrunParser (Parser p) = p\ninstance Read TVShow where readsPrec _ = runParser tvShow\ninstance Show TVShow where show = fromJust . print tvShow\n</code></pre>\n\n<p>This is designed to be extensible to types more exciting than simple enumerations, as well.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "is_accepted": false, "score": 1, "last_activity_date": 1506075579, "creation_date": 1506075579, "answer_id": 46362367, "question_id": 30815107, "link": "https://stackoverflow.com/questions/30815107/custom-derivingread-show-for-enum-type/46362367#46362367", "title": "Custom deriving(Read,Show) for enum type", "body": "<p>I came to this:</p>\n\n<pre><code>data FeedbackType\n  = Abuse\n  | AuthFailure\n  | Fraud\n  | NotSpam\n  | Virus\n  | Other\n  deriving (Eq)\n\ninstance Show FeedbackType where\n  show Abuse = \"abuse\"\n  show AuthFailure = \"auth-failure\"\n  show Fraud = \"fraud\"\n  show NotSpam = \"not-spam\"\n  show Virus = \"virus\"\n  show Other = \"other\"\n\ninstance Read FeedbackType where\n  readsPrec _ s\n    | s == show Abuse = [(Abuse, \"\")]\n    | s == show AuthFailure = [(AuthFailure, \"\")]\n    | s == show Fraud = [(Fraud, \"\")]\n    | s == show NotSpam = [(NotSpam, \"\")]\n    | s == show Virus = [(Virus, \"\")]\n    | s == show Other = [(Other, \"\")]\n    | otherwise = []\n</code></pre>\n"}], "owner": {"reputation": 48293, "user_id": 964135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8caec1b0320fe1b8b498936fbb6b846?s=128&d=identicon&r=PG", "display_name": "Pubby", "link": "https://stackoverflow.com/users/964135/pubby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 2, "accepted_answer_id": 30816020, "answer_count": 3, "score": 4, "last_activity_date": 1550266091, "creation_date": 1434169967, "question_id": 30815107, "link": "https://stackoverflow.com/questions/30815107/custom-derivingread-show-for-enum-type", "title": "Custom deriving(Read,Show) for enum type", "body": "<p>Let's say I have this enumeration type:</p>\n\n<pre><code>data TVShow = BobsBurgers | MrRobot | BatmanTAS\n</code></pre>\n\n<p>and I want to define instances for <code>Read</code> and <code>Show</code> with the following behavior:</p>\n\n<pre><code>show BobsBurgers = \"Bob's Burgers\"\nshow MrRobot = \"Mr. Robot\"\nshow BatmanTAS = \"Batman: The Animated Series\"\n\nread \"Bob's Burgers\" = BobsBurgers\nread \"Mr. Robot\" = MrRobot\nread \"Batman: The Animated Series\" = BatmanTAS\n</code></pre>\n\n<p>There is lots of repetition in these definitions, and so I'd like to associate each type constructor with a string and then generate <code>Show</code> and <code>Read</code> automatically from those associations. Is such a thing possible?</p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1434148282, "post_id": 30813027, "comment_id": 49674203, "body": "I think you need to add a type annotation inside the <code>let</code> e.g. <code>let x :: Person ; x Name = &quot;Abigail&quot; ; x Age = 27</code>."}, {"owner": {"reputation": 1175, "user_id": 867335, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8f4cab875be2b37ec9d1dfc40ed30f64?s=128&d=identicon&r=PG", "display_name": "geoff_h", "link": "https://stackoverflow.com/users/867335/geoff-h"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1434148751, "post_id": 30813027, "comment_id": 49674331, "body": "That does it. Thanks! If you make the comment into an answer I&#39;ll accept it."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1434149130, "creation_date": 1434149130, "answer_id": 30813232, "question_id": 30813027, "link": "https://stackoverflow.com/questions/30813027/rank-n-types-in-let-bindings/30813232#30813232", "title": "Rank N types in let bindings", "body": "<p>You need explicit type annotations when GADTs are involved:</p>\n\n<pre><code>abigail :: Person\nabigail = let x :: Person\n              x Name = \"Abigail\"\n              x Age = 27 \n           in x\n</code></pre>\n\n<p>Without it, GHC roughly sees</p>\n\n<pre><code>let x Name = \"Abigail\"\n</code></pre>\n\n<p>and says \"OK, <code>x</code> is a function from the type of <code>Name</code>, i.e. <code>PersonField String</code> to the type of <code>\"Abigail\"</code>, i.e. <code>String</code>. In the next line,</p>\n\n<pre><code>let x Name = \"Abigail\"\n    x Age = 27\n</code></pre>\n\n<p>GHC now finds out <code>x</code> to accept also a <code>PersonField Int</code> and to return a number. This clashes with the previously inferred type, triggering a type error.</p>\n\n<p>With an explicit type annotation, type inference will not try to infer a wrong type for <code>x</code>: it was provided by the user. Instead, only type checking will be performed.</p>\n"}], "owner": {"reputation": 1175, "user_id": 867335, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8f4cab875be2b37ec9d1dfc40ed30f64?s=128&d=identicon&r=PG", "display_name": "geoff_h", "link": "https://stackoverflow.com/users/867335/geoff-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 30813232, "answer_count": 1, "score": 5, "last_activity_date": 1434149130, "creation_date": 1434147925, "question_id": 30813027, "link": "https://stackoverflow.com/questions/30813027/rank-n-types-in-let-bindings", "title": "Rank N types in let bindings", "body": "<p>So I've done this...</p>\n\n<pre><code>{-# LANGUAGE Rank2Types, GADTs  #-}\n\ntype Record fields = forall t. fields t -&gt; t\n\ndata PersonField t where\n    Name :: PersonField String\n    Age :: PersonField Int\ntype Person = Record PersonField\n</code></pre>\n\n<p>And then this...</p>\n\n<pre><code>nigel :: Person\nnigel Name = \"Nigel\"\nnigel Age = 39\n</code></pre>\n\n<p>And it all seems to work as expected. </p>\n\n<p>What I'm struggling with is how to define a Person value inside a let binding. For example this doesn't work:</p>\n\n<pre><code>abigail :: Person\nabigail = let x Name = \"Abigail\"\n              x Age = 27 \n           in x  \n</code></pre>\n\n<p>Gives me:</p>\n\n<blockquote>\n  <p>Couldn't match expected type `t1' with actual type `[Char]'\n   `t1' is untouchable ...</p>\n</blockquote>\n\n<p>Is there a way to make this work inside a let binding?</p>\n"}, {"tags": ["haskell", "coding-style"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1434136452, "post_id": 30810535, "comment_id": 49669309, "body": "Have a look at this package <a href=\"https://hackage.haskell.org/package/haskell-formatter\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/haskell-formatter</a>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 4, "creation_date": 1434139286, "post_id": 30810535, "comment_id": 49670745, "body": "Googling haskell formatting should have given you several useful results. Whitespace (including newlines) is ignored in haskell, except for the indentation rule (code needs to be at least as indented as the block it belongs to, simplified)."}], "answers": [{"tags": [], "owner": {"reputation": 187396, "user_id": 41661, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7dd45a27a5616b8a5608b84007e4e08f?s=128&d=identicon&r=PG", "display_name": "Norman Ramsey", "link": "https://stackoverflow.com/users/41661/norman-ramsey"}, "is_accepted": true, "score": 9, "last_activity_date": 1435372272, "last_edit_date": 1435372272, "creation_date": 1434930709, "answer_id": 30970470, "question_id": 30810535, "link": "https://stackoverflow.com/questions/30810535/where-are-line-breaks-allowed-within-haskell-expressions/30970470#30970470", "title": "Where are line breaks allowed within Haskell expressions?", "body": "<p>You can place a newline anywhere between lexical tokens of an expression.  However, there are constraints about how much indentation may follow the newline.  The easy rule of thumb is to indent the next line to start to the right of the line containing the expression.  Beyond that, some style things:</p>\n\n<ul>\n<li><p>If you are indenting an expression that appears in a definition <code>name = expression</code>, it's good style to indent to the right of the <code>=</code> sign.</p></li>\n<li><p>If you are indenting an expression that appears on the right-hand side of a <code>do</code> binding or a list comprehension, it's good style to indent to the right of the <code>&lt;-</code> sign.</p></li>\n</ul>\n\n<p>The authoritative documentation is probably the <a href=\"https://www.haskell.org/onlinereport/\" rel=\"noreferrer\">Haskell 98 Report</a> (<a href=\"https://www.haskell.org/onlinereport/lexemes.html\" rel=\"noreferrer\">Chapter 2</a> on lexical structure), but personally I don't find this material very easy to read.</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4914, "favorite_count": 2, "accepted_answer_id": 30970470, "answer_count": 1, "score": 16, "last_activity_date": 1462321105, "creation_date": 1434136236, "last_edit_date": 1434141699, "question_id": 30810535, "link": "https://stackoverflow.com/questions/30810535/where-are-line-breaks-allowed-within-haskell-expressions", "title": "Where are line breaks allowed within Haskell expressions?", "body": "<p><strong>Background</strong></p>\n\n<p>Most style guides recommend keeping line lengths to 79 characters or less.  In Haskell, indentation rules mean that expressions frequently need to be broken up with new lines.</p>\n\n<p><strong>Questions:</strong></p>\n\n<p>Within expressions, where is it legal to place a new line?</p>\n\n<p>Is this documented somewhere?</p>\n\n<hr>\n\n<p><strong>Extended question:</strong> I see GHC formatting my code when it reports an error so someone has figured out how to automate the process of breaking long lines. Is there a utility that I can put haskell code into and have it spit that code back nicely formatted? </p>\n"}, {"tags": ["haskell", "types", "catamorphism", "recursion-schemes"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1434143335, "post_id": 30810090, "comment_id": 49672444, "body": "Polymorphic recursion is definitely nontrivial. A less extreme example than yours you might want to add as an intermediate step is <code>data List a = Empty | Cons a (List (a,a))</code>."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1434181374, "post_id": 30810090, "comment_id": 49679692, "body": "@chi Thanks! I think <code>non-regular recursive types</code> are a term I should have mentioned - I adjusted the title of my question - I never liked the <code>this type</code> part. I also incorporated your less extreme example into my question."}, {"owner": {"reputation": 235, "user_id": 936505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9626e272a0c020447fb1322645672d?s=128&d=identicon&r=PG", "display_name": "Giorgio Mossa", "link": "https://stackoverflow.com/users/936505/giorgio-mossa"}, "edited": false, "score": 0, "creation_date": 1434720196, "post_id": 30810090, "comment_id": 49913300, "body": "In my understanding folds are defined only for those recursive data types that arise as initial algebra for an endofunctor F. I doubt that every recursive data types is of this form and so that every data type should have a fold....anyway I&#39;m not sure whether your data type admit a fold."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1438449362, "post_id": 30810090, "comment_id": 51460471, "body": "<a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2007-March/023405.html\" rel=\"nofollow noreferrer\">this 2007 haskell-cafe message</a> seems relevant."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1434204542, "last_edit_date": 1434204542, "creation_date": 1434147399, "answer_id": 30812943, "question_id": 30810090, "link": "https://stackoverflow.com/questions/30810090/whats-the-type-of-a-catamorphism-fold-for-non-regular-recursive-types/30812943#30812943", "title": "What&#39;s the type of a catamorphism (fold) for non-regular recursive types?", "body": "<p>This is a partial answer, only.</p>\n\n<p>The issue the OP raises is: how to define <code>fold</code>/<code>cata</code> in the case of non-regular recursive types?</p>\n\n<p>Since I don't trust myself in getting this right, I will resort to asking Coq instead. Let's start from a simple, regular recursive list type.</p>\n\n<pre><code>Inductive List (A : Type) : Type :=\n  | Empty: List A\n  | Cons : A -&gt; List A -&gt; List A\n.\n</code></pre>\n\n<p>Nothing fancy here, <code>List A</code> is defined in terms of <code>List A</code>.\n(Remember this -- we'll get back to it.)</p>\n\n<p>What about the <code>cata</code>? Let's query the induction pinciple.</p>\n\n<pre><code>&gt; Check List_rect.\nforall (A : Type) (P : List A -&gt; Type),\n   P (Empty A) -&gt;\n   (forall (a : A) (l : List A), P l -&gt; P (Cons A a l)) -&gt;\n   forall l : List A, P l\n</code></pre>\n\n<p>Let's see. The above exploits dependent types: <code>P</code> depends on the actual value of the list. Let's just manually simplify it in the case <code>P list</code> is a constant type <code>B</code>. We obtain:</p>\n\n<pre><code>forall (A : Type) (B : Type),\n   B -&gt;\n   (forall (a : A) (l : List A), B -&gt; B) -&gt;\n   forall l : List A, B\n</code></pre>\n\n<p>which can be equivalently written as</p>\n\n<pre><code>forall (A : Type) (B : Type),\n   B -&gt;\n   (A -&gt; List A -&gt; B -&gt; B) -&gt;\n   List A -&gt; B\n</code></pre>\n\n<p>Which is <code>foldr</code> except that the \"current list\" is also passed to the binary function argument -- not a major difference.</p>\n\n<p>Now, in Coq we can define a list in another subtly different way:</p>\n\n<pre><code>Inductive List2 : Type -&gt; Type :=\n  | Empty2: forall A, List2 A\n  | Cons2 : forall A, A -&gt; List2 A -&gt; List2 A\n.\n</code></pre>\n\n<p>It looks the same type, but there is a profound difference. Here we are not defining the type <code>List A</code> in terms of <code>List A</code>. Rather, we are defining a type function <code>List2 : Type -&gt; Type</code> in terms of <code>List2</code>. The main point of this is that the recursive references to <code>List2</code> do not have to be applied to <code>A</code> -- the fact that above we do so is only an incident.</p>\n\n<p>Anyway, let's see the type for the induction principle:</p>\n\n<pre><code>&gt; Check List2_rect.\nforall P : forall T : Type, List2 T -&gt; Type,\n   (forall A : Type, P A (Empty2 A)) -&gt;\n   (forall (A : Type) (a : A) (l : List2 A), P A l -&gt; P A (Cons2 A a l)) -&gt;\n   forall (T : Type) (l : List2 T), P T l\n</code></pre>\n\n<p>Let's remove the <code>List2 T</code> argument from <code>P</code> as we did before, basically assuming <code>P</code> is constant on it.</p>\n\n<pre><code>forall P : forall T : Type, Type,\n   (forall A : Type, P A ) -&gt;\n   (forall (A : Type) (a : A) (l : List2 A), P A -&gt; P A) -&gt;\n   forall (T : Type) (l : List2 T), P T\n</code></pre>\n\n<p>Equivalently rewritten:</p>\n\n<pre><code>forall P : (Type -&gt; Type),\n   (forall A : Type, P A) -&gt;\n   (forall (A : Type), A -&gt; List2 A -&gt; P A -&gt; P A) -&gt;\n   forall (T : Type), List2 T -&gt; P T\n</code></pre>\n\n<p>Which roughly corresponds, in Haskell notation</p>\n\n<pre><code>(forall a, p a) -&gt;                          -- Empty\n(forall a, a -&gt; List2 a -&gt; p a -&gt; p a) -&gt;   -- Cons\nList2 t -&gt; p t\n</code></pre>\n\n<p>Not so bad -- the base case now has to be a polymorphic function, much as <code>Empty</code> in Haskell is. It makes some sense. Similarly, the inductive case must be a polymorphic function, much as <code>Cons</code> is. There's an extra <code>List2 a</code> argument, but we can ignore that, if we want.</p>\n\n<p>Now, the above is still a kind of fold/cata on a <em>regular</em> type. What about non regular ones? I will study</p>\n\n<pre><code>data List a = Empty | Cons a (List (a,a))\n</code></pre>\n\n<p>which in Coq becomes:</p>\n\n<pre><code>Inductive  List3 : Type -&gt; Type :=\n  | Empty3: forall A, List3 A\n  | Cons3 : forall A, A -&gt; List3 (A * A) -&gt; List3 A\n.\n</code></pre>\n\n<p>with induction principle:</p>\n\n<pre><code>&gt; Check List3_rect.\nforall P : forall T : Type, List3 T -&gt; Type,\n   (forall A : Type, P A (Empty3 A)) -&gt;\n   (forall (A : Type) (a : A) (l : List3 (A * A)), P (A * A) l -&gt; P A (Cons3 A a l)) -&gt;\n   forall (T : Type) (l : List3 T), P T l\n</code></pre>\n\n<p>Removing the \"dependent\" part:</p>\n\n<pre><code>forall P : (Type -&gt; Type),\n   (forall A : Type, P A) -&gt;\n   (forall (A : Type), A -&gt; List3 (A * A) -&gt; P (A * A) -&gt; P A ) -&gt;\n   forall (T : Type), List3 T -&gt; P T\n</code></pre>\n\n<p>In Haskell notation:</p>\n\n<pre><code>   (forall a. p a) -&gt;                                      -- empty\n   (forall a, a -&gt; List3 (a, a) -&gt; p (a, a) -&gt; p a ) -&gt;    -- cons\n   List3 t -&gt; p t\n</code></pre>\n\n<p>Aside from the additional <code>List3 (a, a)</code> argument, this is a kind of fold.</p>\n\n<p>Finally, what about the OP type?</p>\n\n<pre><code>data List a = Empty | Cons a (List (List a))\n</code></pre>\n\n<p>Alas, Coq does not accept the type</p>\n\n<pre><code>Inductive  List4 : Type -&gt; Type :=\n  | Empty4: forall A, List4 A\n  | Cons4 : forall A, A -&gt; List4 (List4 A) -&gt; List4 A\n.\n</code></pre>\n\n<p>since the inner <code>List4</code> occurrence is not in a strictly positive position. This is probably a hint that I should stop being lazy and using Coq to do the work, and start thinking about the involved F-algebras by myself... ;-)</p>\n"}], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 7, "answer_count": 1, "score": 18, "last_activity_date": 1473959143, "creation_date": 1434134451, "last_edit_date": 1473959143, "question_id": 30810090, "link": "https://stackoverflow.com/questions/30810090/whats-the-type-of-a-catamorphism-fold-for-non-regular-recursive-types", "title": "What&#39;s the type of a catamorphism (fold) for non-regular recursive types?", "body": "<p>Many catamorphisms seem to be simple enough, mostly replacing each data constructor with a custom function, e.g.</p>\n\n<pre><code>data Bool = False | True\nfoldBool :: r              -- False constructor\n         -&gt; r              -- True constructor\n         -&gt; Bool -&gt; r\n\ndata Maybe a = Nothing | Just a\nfoldMaybe :: b             -- Nothing constructor\n          -&gt; (a -&gt; b)      -- Just constructor\n          -&gt; Maybe a -&gt; b\n\ndata List a = Empty | Cons a (List a)\nfoldList :: b              -- Empty constructor\n         -&gt; (a -&gt; b -&gt; b)  -- Cons constructor\n         -&gt; List a -&gt; b\n</code></pre>\n\n<p>However, what's not clear to me is what happens if the same type constructor is used, but with a different type argument. E.g. instead of passing a <code>List a</code> to <code>Cons</code>, what about</p>\n\n<pre><code>data List a = Empty | Cons a (List (a,a))\n</code></pre>\n\n<p>Or, maybe a more crazy case:</p>\n\n<pre><code>data List a = Empty | Cons a (List (List a))\nfoldList :: b              -- Empty constructor\n         -&gt; ???            -- Cons constructor\n         -&gt; List a -&gt; b\n</code></pre>\n\n<p>The two plausible ideas I have for the <code>???</code> part are</p>\n\n<ul>\n<li><code>(a -&gt; b -&gt; b)</code>, i.e. replacing all applications of the <code>List</code> constructor recursively)</li>\n<li><code>(a -&gt; List b -&gt; b)</code>, i.e. merely replacing all <code>List a</code> applications.</li>\n</ul>\n\n<p>Which of the two would be correct - and why? Or would it be something different altogether?</p>\n"}, {"tags": ["haskell", "maude-system"], "owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1490968284, "creation_date": 1434129323, "last_edit_date": 1490968284, "question_id": 30808740, "link": "https://stackoverflow.com/questions/30808740/use-predicates-maude-in-igor2-3-and-how-to-get-the-result-from-rewrite-result", "title": "Use predicates.maude in Igor2.3 and how to get the result from Rewrite Result", "body": "<p>How to use predicates.maude? \nIs there any example about the usage of it</p>\n\n<pre><code>Maude&gt; SETUP(PREDICATE) .\nWarning: &lt;standard input&gt;, line 163: skipped unexpected token: SETUP\nWarning: no loop state.\nWarning: &lt;standard input&gt;, line 163: syntax error\n</code></pre>\n\n<p>It seems rewrite do the work of reducing too</p>\n\n<p>How to get the result 7, I see that it is in iterations</p>\n\n<pre><code>RewriteResult {resultTerm = IterTerm {termSort = \"NzNat\", termOp = \"s_\", termChildren = [Term {termSort = \"Zero\", termOp = \"0\", termChildren = []}], iterations = 7}, rewriteStatistics = MaudeStatistics {totalRewrites = 1, realTime = 0, cpuTime = 0}}\n</code></pre>\n"}, {"tags": ["haskell", "unique", "predicate", "quickcheck"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434122306, "post_id": 30805230, "comment_id": 49661219, "body": "What do you mean by uniqueness? No repeating elements in the string?"}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1434128605, "post_id": 30805230, "comment_id": 49665131, "body": "@Andr&#225;sKov&#225;cs Non-repeating elements in the list. Something like <code>isUnique x = nub x == x</code>"}], "answers": [{"comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1434186621, "post_id": 30806228, "comment_id": 49680777, "body": "Note that in your definition is incorrect - it doesn&#39;t typecheck, as you&#39;re generating a single-letter strings, while you need a list of strings."}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1467763273, "post_id": 30806228, "comment_id": 63852729, "body": "Also, the probability you will randomly pick a set of unique elements is (n/n)((n-1)/n)...((n-k)/n). If that probability is low then this algorithm will take a while; something to consider if &#39;a&#39; is very small."}], "tags": [], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "is_accepted": false, "score": 2, "last_activity_date": 1434204316, "last_edit_date": 1434204316, "creation_date": 1434121147, "answer_id": 30806228, "question_id": 30805230, "link": "https://stackoverflow.com/questions/30805230/uniqueness-and-other-restrictions-for-arbitrary-in-quickcheck/30806228#30806228", "title": "Uniqueness and other restrictions for Arbitrary in QuickCheck", "body": "<p><code>suchThat :: Gen a -&gt; (a -&gt; Bool) -&gt; Gen a</code> is a way to embed Boolean predicates in a <code>Gen</code>. See the <a href=\"http://haddocks.fpcomplete.com/fp/7.8/20140916-162/QuickCheck/Test-QuickCheck-Gen.html#v:suchThat\" rel=\"nofollow\">haddocks</a> for more info.</p>\n\n<p>Here's how you would make the instance unique:</p>\n\n<pre><code>instance Arbitrary Foo where\n  arbitrary = Vars &lt;$&gt; (:[]) &lt;$&gt; (:[]) &lt;$&gt; choose ('A','z')\n              `suchThat` isUnique\n    where\n      isUnique x = nub x == x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 2, "last_activity_date": 1434188811, "last_edit_date": 1495540856, "creation_date": 1434188811, "answer_id": 30817265, "question_id": 30805230, "link": "https://stackoverflow.com/questions/30805230/uniqueness-and-other-restrictions-for-arbitrary-in-quickcheck/30817265#30817265", "title": "Uniqueness and other restrictions for Arbitrary in QuickCheck", "body": "<p>Definitely you want the instance to produce only instances that match the intention of the data type. If you want all the variables to be distinct, the <code>Arbitrary</code> instance must reflect this. (Another question is if in this case it wouldn't make more sense to define <code>Vars</code> as a set, like <code>newtype Vars = Set [String]</code>.)</p>\n\n<p>I'd suggest to check for duplicates using <code>Set</code> or <code>Hashtable</code>, as <code>nub</code> has <em>O(n^2)</em> complexity, which might slow down your test considerably for larger inputs. For example:</p>\n\n<pre><code>import Control.Applicative\nimport Data.List (nub)\nimport qualified Data.Set as Set\nimport Test.QuickCheck\n\nnewtype Foo = Vars [String]\n\n-- | Checks if a given list has no duplicates in _O(n log n)_.\nhasNoDups :: (Ord a) =&gt; [a] -&gt; Bool\nhasNoDups = loop Set.empty\n  where\n    loop _ []       = True\n    loop s (x:xs) | s' &lt;- Set.insert x s, Set.size s' &gt; Set.size s\n                    = loop s' xs\n                  | otherwise\n                    = False\n\n-- | Always worth to test if we wrote `hasNoDups` properly.\nprop_hasNoDups :: [Int] -&gt; Property\nprop_hasNoDups xs = hasNoDups xs === (nub xs == xs)\n</code></pre>\n\n<p>Your instance then needs to create a list of list, and each list should be randomized. So instead of <code>(: [])</code>, which creates just a singleton list (and just one level), you need to call <code>listOf</code> twice:</p>\n\n<pre><code>instance Arbitrary Foo where\n  arbitrary = Vars &lt;$&gt; (listOf . listOf $ choose ('A','z'))\n                       `suchThat` hasNoDups\n</code></pre>\n\n<p>Also notice that <code>choose ('A', 'z')</code> allows to use all characters between <em>A</em> and <em>z</em>, which includes many control characters. My guess is that you rather want something like</p>\n\n<pre><code>oneof [choose ('A','Z'), choose ('a','z')]\n</code></pre>\n\n<hr>\n\n<p>If you really want, you could also make <code>hasNoDups</code> <em>O(n)</em> using <a href=\"https://hackage.haskell.org/package/hashtables\" rel=\"nofollow noreferrer\">hash tables</a> in the <a href=\"https://hackage.haskell.org/package/base-4.7.0.1/docs/Control-Monad-ST-Safe.html#t:ST\" rel=\"nofollow noreferrer\"><code>ST</code></a> monad.  </p>\n\n<hr>\n\n<p>Concerning limiting the size: you could always have your own parametrized functions that produce different <code>Gen Foo</code>, but I'd say in most cases it's not necessary. <code>Gen</code> has it's own internal size parameter, which is increased throughout the tests (see <a href=\"https://stackoverflow.com/a/9992112/1333025\">this answer</a>), so different sizes (as generated using <code>listOf</code>) of lists are covered.</p>\n\n<p>But I'd suggest you to implement <a href=\"https://stackoverflow.com/q/16968549/1333025\"><code>shrink</code></a>, as this will give you much nicer counter-examples. For example, if we define (a wrong test) that tried to verify that no instance of <code>Var</code> contains <em>'a'</em> in any of its variable:</p>\n\n<pre><code>prop_Foo_hasNoDups :: Foo -&gt; Property\nprop_Foo_hasNoDups (Vars xs) = all (notElem 'a') xs === True\n</code></pre>\n\n<p>we'll get ugly counter-examples such as</p>\n\n<pre><code>Vars [\"RhdaJytDWKm\",\"FHHhrqbI\",\"JVPKGTqNCN\",\"awa\",\"DABsOGNRYz\",\"Wshubp\",\"Iab\",\"pl\"]\n</code></pre>\n\n<p>But adding</p>\n\n<pre><code>shrink (Vars xs) = map Vars $ shrink xs\n</code></pre>\n\n<p>to <code>Arbitrary Foo</code> makes the counter-example to be just</p>\n\n<pre><code>Vars [\"a\"]\n</code></pre>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 593, "favorite_count": 1, "accepted_answer_id": 30817265, "answer_count": 2, "score": 1, "last_activity_date": 1434204316, "creation_date": 1434118475, "question_id": 30805230, "link": "https://stackoverflow.com/questions/30805230/uniqueness-and-other-restrictions-for-arbitrary-in-quickcheck", "title": "Uniqueness and other restrictions for Arbitrary in QuickCheck", "body": "<p>I'm trying to write a modified <code>Arbitrary</code> instance for my data type, where (in my case) a subcomponent has a type <code>[String]</code>. I would ideally like to bring uniqueness in the instance itself, that way I don't need <code>==&gt;</code> headers / prerequisites for every test I write.</p>\n\n<p>Here's my data type:</p>\n\n<pre><code>data Foo = Vars [String]\n</code></pre>\n\n<p>and the trivial <code>Arbitrary</code> instance:</p>\n\n<pre><code>instance Arbitrary Foo where\n  arbitrary = Vars &lt;$&gt; (:[]) &lt;$&gt; choose ('A','z')\n</code></pre>\n\n<p>This instance is strange, I know. In the past, I've had difficulty when quickcheck combinatorically explodes, so I'd like to keep these values small. Another request - how can I make an instance where the generated strings are under 4 characters, for instance?</p>\n\n<p>All of this, fundamentally requires (boolean) predicates to augment <code>Arbitrary</code> instances. Is this possible?</p>\n"}, {"tags": ["haskell", "monads", "io-monad"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1434116538, "post_id": 30802142, "comment_id": 49657535, "body": "Each line in the interactive session is inside the same implicit <code>do</code> statement, which never ends, so every line passes its result to the next."}], "answers": [{"comments": [{"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "edited": false, "score": 0, "creation_date": 1434109845, "post_id": 30802336, "comment_id": 49652926, "body": "So it&#39;s a laziness problem right? <code>getStdRandom</code> should not be able to put back an error in <code>StdGen</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "edited": false, "score": 0, "creation_date": 1434110109, "post_id": 30802336, "comment_id": 49653102, "body": "@mariop Arguably allowing a single global variable for this is a hack in the first place (e.g., thread safety could be threatened). But yeah, I guess you could argue it should do some hoopy thing to avoid reinserting an exception into the global variable..."}, {"owner": {"reputation": 5480, "user_id": 532901, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5581aede1e72c9bbadf038129896b809?s=128&d=identicon&r=PG", "display_name": "Tiddo", "link": "https://stackoverflow.com/users/532901/tiddo"}, "edited": false, "score": 0, "creation_date": 1434110578, "post_id": 30802336, "comment_id": 49653425, "body": "How is this dealt with in real world applications? Does everyone initialize it&#39;s own random generator all the time? And is this a deliberate design decision, or was it an oversight not to catch errors in <code>getStdRandom</code>?"}, {"owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "edited": false, "score": 1, "creation_date": 1434112012, "post_id": 30802336, "comment_id": 49654369, "body": "You don&#39;t generally ever use <code>error</code> in real world applications. You would return a <code>Maybe</code> or <code>Either</code> value instead. In real applications you also usually use some other randomness source than <code>StdGen</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1434114243, "post_id": 30802336, "comment_id": 49655883, "body": "Ideally yes, you manage your own random seed rather than relying on a hidden global variable shared between all code in the entire program. (And <code>System.Random</code> generally isn&#39;t very performant; there are other libraries for that, implementing Mersenne-twister or MWC or whatever.)"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 13, "last_activity_date": 1434109713, "creation_date": 1434109713, "answer_id": 30802336, "question_id": 30802142, "link": "https://stackoverflow.com/questions/30802142/why-does-ghci-get-stuck-in-an-error-state-after-an-error/30802336#30802336", "title": "Why does GHCI get &quot;stuck&quot; in an error state after an error?", "body": "<p>The <code>getStdRandom</code> function basically looks up a <code>StdGen</code> value in a global variable, runs some function on it, puts the new seed back into the global variable, and returns the result to the caller.</p>\n\n<p>If the function in question returns with an error, that error gets put into the global variable. Now all attempts to use this global variable will throw an exception. (I <em>told</em> you global variables are evil! <code>;-)</code>)</p>\n\n<p>Try calling <code>getStdGen</code> manually yourself. It will either print out the current random seed, or throw an exception. If it throws an exception... there's your problem.</p>\n\n<p>I believe you can use <code>setStdGen</code> to reset the thing.</p>\n"}], "owner": {"reputation": 5480, "user_id": 532901, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5581aede1e72c9bbadf038129896b809?s=128&d=identicon&r=PG", "display_name": "Tiddo", "link": "https://stackoverflow.com/users/532901/tiddo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 30802336, "answer_count": 1, "score": 11, "last_activity_date": 1434140004, "creation_date": 1434109115, "last_edit_date": 1434140004, "question_id": 30802142, "link": "https://stackoverflow.com/questions/30802142/why-does-ghci-get-stuck-in-an-error-state-after-an-error", "title": "Why does GHCI get &quot;stuck&quot; in an error state after an error?", "body": "<p>First of all, my apologies for the non-descriptive title. Since I have no idea what's actually going on I can't really make it any more specific.</p>\n\n<p>Now for my question. I have implemented the following snippet for problem 23 of the <a href=\"https://wiki.haskell.org/99_questions/21_to_28\" rel=\"nofollow noreferrer\">99 Haskell problems</a>, which should randomly select <code>n</code> items from a list:</p>\n\n<pre><code>rndSelect' :: RandomGen g =&gt; [a] -&gt; Int -&gt; g -&gt; ([a], g)\nrndSelect' _ 0 gen = ([], gen)\nrndSelect' [] _ _ = error \"Number of items requested is larger than list\"\nrndSelect' xs n gen = ((xs !! i) : rest, gen'')\n                    where (i, gen') = randomR (0, length xs - 1) gen\n                          (rest, gen'') = (rndSelect' (removeAt xs i) (n - 1) gen')\n\nrndSelectIO' :: [a] -&gt; Int -&gt; IO [a]\nrndSelectIO' xs n = getStdRandom $ rndSelect' xs n\n\nremoveAt :: [a] -&gt; Int -&gt; [a]\nremoveAt xs n\n  | length xs &lt;= n || n &lt; 0 = error \"Index out of bounds\"\n  | otherwise = let (ys, zs) = splitAt n xs\n                    in ys ++ (tail zs)\n</code></pre>\n\n<p>Now when I load this in <code>ghci</code> this works correctly for valid arguments:</p>\n\n<pre><code>*Main&gt; rndSelectIO' \"asdf\" 2 &gt;&gt;= putStrLn \naf\n</code></pre>\n\n<p>However, strange things happen when I use an index that is out of bounds:</p>\n\n<pre><code>*Main&gt; rndSelectIO' \"asdf\" 5 &gt;&gt;= putStrLn\ndfas*** Exception: Number of items requested is larger than list\n*Main&gt; rndSelectIO' \"asdf\" 2 &gt;&gt;= putStrLn\n*** Exception: Number of items requested is larger than list\n</code></pre>\n\n<p>As you can see, the following 2 (for me) unexpected things happen:</p>\n\n<ol>\n<li>Instead of directly giving an error it first print a permutation of the input.</li>\n<li>After it has given an error once, it won't execute at all anymore.</li>\n</ol>\n\n<p>I suspect that 1. has to do with lazy evaluation, but I have absolutely no clue why 2. happens. What's going on here?</p>\n"}, {"tags": ["class", "haskell", "opengl", "types", "uniform"], "answers": [{"comments": [{"owner": {"reputation": 678, "user_id": 3241118, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/519fc989bbf1c18ad275b427d3e4fda4?s=128&d=identicon&r=PG&f=1", "display_name": "Gentatsu", "link": "https://stackoverflow.com/users/3241118/gentatsu"}, "edited": false, "score": 0, "creation_date": 1434135549, "post_id": 30805289, "comment_id": 49668840, "body": "Nope :/. Same error. Put it at the top and in my cabal file, and I tried changing the sig to <code>AsUniform (V4 (V4 a))</code>, but that didn&#39;t affect it. Maybe the GLUtil package page might shine a bit of light of why it wouldn&#39;t work, you think?"}], "tags": [], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "is_accepted": true, "score": 1, "last_activity_date": 1434118662, "creation_date": 1434118662, "answer_id": 30805289, "question_id": 30801181, "link": "https://stackoverflow.com/questions/30801181/haskell-could-not-deduce-from-context-error-opengl-asuniform-class-type/30805289#30805289", "title": "Haskell - Could not deduce ... from Context error - OpenGL AsUniform class type", "body": "<p>Try adding <code>-XFlexibleContexts</code> and the constraint, literally, to your existing answer:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nmvpUnif :: ( GL.UniformComponent a\n           , Num a\n           , Epsilon a\n           , Floating a\n           , AsUniform a\n           , AsUniform (V4 (V4 a))\n           ) =&gt; (GLState a) -&gt; ShaderProgram  -&gt; IO ()\n</code></pre>\n\n<p>Usually this is the routine for constraints that aren't inferrable, or where constraints need to be transitively included in all call sites. This happens to me all the time with <code>MonadState</code> et al. In this case, <code>setUniform</code> is the culprit.</p>\n"}], "owner": {"reputation": 678, "user_id": 3241118, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/519fc989bbf1c18ad275b427d3e4fda4?s=128&d=identicon&r=PG&f=1", "display_name": "Gentatsu", "link": "https://stackoverflow.com/users/3241118/gentatsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 30805289, "answer_count": 1, "score": 0, "last_activity_date": 1434118662, "creation_date": 1434105944, "question_id": 30801181, "link": "https://stackoverflow.com/questions/30801181/haskell-could-not-deduce-from-context-error-opengl-asuniform-class-type", "title": "Haskell - Could not deduce ... from Context error - OpenGL AsUniform class type", "body": "<p>I'm working on making my data types general instead of taking in the OpenGL type <code>GLfloat</code>. So I started making it take in type <code>a</code> and then just replacing everything with that. </p>\n\n<p>Now, I've come to a point where I'm setting uniform variables, but they take in GLfloat's. I'm using a library called GLUtil which makes it a bit easier, which has provided a class <code>AsUniform</code>, to check whether the type can be a uniform variable or not. I stick it in my type signature, but it stills gives me an error. Here's the code:</p>\n\n<pre><code>-- | Sets the modelview and projection matrix uniform variables.\nmvpUnif :: (GL.UniformComponent a, Num a, Epsilon a, Floating a, AsUniform a) =&gt; (GLState a) -&gt; ShaderProgram  -&gt; IO ()\nmvpUnif state p = do\n-- Check if view and projection matrices are there, else set them to the identity.\nlet vMat = case vMatrix state of\n    Just v -&gt; v\n    Nothing -&gt; getIdentity\nlet pMat = case pMatrix state of\n    Just p -&gt; p\n    Nothing -&gt; getIdentity\n-- Multiply model and view matrix together.\nlet mvMatrix = vMat !*! mMatrix state\nsetUniform p uModelViewMatrixVar mvMatrix\nsetUniform p uProjectionMatrixVar pMat\n</code></pre>\n\n<p>and the error:</p>\n\n<pre><code>Could not deduce (AsUniform (V4 (V4 a)))\n  arising from a use of `setUniform'\nfrom the context (GL.UniformComponent a,\n                  Num a,\n                  Epsilon a,\n                  Floating a,\n                  AsUniform a)\n  bound by the type signature for\n             mvpUnif :: (GL.UniformComponent a, Num a, Epsilon a, Floating a\n,\n                         AsUniform a) =&gt;\n                        GLState a -&gt; ShaderProgram -&gt; IO ()\n  at src\\Graphics\\FreeD\\Shaders\\DefaultShaders.hs:194:12-119\nIn a stmt of a 'do' block:\n  setUniform p uModelViewMatrixVar mvMatrix\nIn the expression:\n  do { let vMat = ...;\n       let pMat = ...;\n       let mvMatrix = vMat !*! mMatrix state;\n       setUniform p uModelViewMatrixVar mvMatrix;\n       .... }\nIn an equation for `mvpUnif':\n    mvpUnif state p\n      = do { let vMat = ...;\n             let pMat = ...;\n             let mvMatrix = ...;\n             .... }\n</code></pre>\n\n<p>V4 is made an instance of AsUniform, as well as M44, which is a type for (V4 (V4 a)), which I thought might be the issue, so I'm not sure why it's acting up.</p>\n\n<p>Here's the source for the class: </p>\n\n<p><a href=\"http://hackage.haskell.org/package/GLUtil-0.8.5/docs/Graphics-GLUtil-Linear.html\" rel=\"nofollow\">http://hackage.haskell.org/package/GLUtil-0.8.5/docs/Graphics-GLUtil-Linear.html</a></p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1434106914, "last_edit_date": 1434106914, "creation_date": 1434104125, "answer_id": 30800583, "question_id": 30800219, "link": "https://stackoverflow.com/questions/30800219/type-ambiguity-of-arithmetic-expression-when-wrapped-in-a-function/30800583#30800583", "title": "Type ambiguity of arithmetic expression when wrapped in a function", "body": "<p>it's tricky but the thing is that the two <code>10</code>s in <code>(round (3/10))*10</code> don't have to be the same type but of course the <code>b</code>s in <code>let roundBy b x = (round (x/b)) * b</code> have to be.</p>\n\n<p>That`s why:</p>\n\n<pre><code>\u03bb&gt; :t (round (3/10))*10\n(round (3/10))*10 :: Integral a =&gt; a\n</code></pre>\n\n<p>but</p>\n\n<pre><code>\u03bb&gt; :t roundBy 10 3\nroundBy 10 3 :: (RealFrac a, Integral a) =&gt; a\n</code></pre>\n\n<p>and GHCi just <em>knows</em> how to default to <code>Integral a</code> but obviously does not for <code>RealFrac a, Integral a</code></p>\n\n<hr>\n\n<p>so to really behave the <strong>same</strong> you would need:</p>\n\n<pre><code>let roundBy b b' x = (round (x/b)) * b'\n</code></pre>\n\n<p>and indeed:</p>\n\n<pre><code>\u03bb&gt; roundBy 10 10 3\n0\n</code></pre>\n\n<hr>\n\n<h2>how to fix it</h2>\n\n<p>I forgot to add how to fix the <em>problem</em> here - I think you really want this:</p>\n\n<pre><code>let roundBy b x = (round (x/fromIntegral b)) * b\n</code></pre>\n\n<p>with this you get:</p>\n\n<pre><code>\u03bb&gt; :t roundBy\nroundBy :: (Integral a, Integral a1) =&gt; a -&gt; a1 -&gt; a\n\u03bb&gt; roundBy 10 3\n0\n</code></pre>\n\n<p>by the way: it's usually a good idea to give the indented types for your function ;) so we can help you better</p>\n\n<h2>another way to do it</h2>\n\n<p>From the looks of it you can simplify this function a bit using <code>rem</code>:</p>\n\n<pre><code>\u03bb&gt; let roundBy b x = x - x `rem` b\n\u03bb&gt; roundBy 10 3\n0\n\u03bb&gt; roundBy 10 13\n10\n</code></pre>\n"}], "owner": {"reputation": 294, "user_id": 4196578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc38fbfa2d450c0ac40bd9399f7a3d2e?s=128&d=identicon&r=PG&f=1", "display_name": "thor", "link": "https://stackoverflow.com/users/4196578/thor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 1, "accepted_answer_id": 30800583, "answer_count": 1, "score": 1, "last_activity_date": 1434106914, "creation_date": 1434102863, "last_edit_date": 1434106764, "question_id": 30800219, "link": "https://stackoverflow.com/questions/30800219/type-ambiguity-of-arithmetic-expression-when-wrapped-in-a-function", "title": "Type ambiguity of arithmetic expression when wrapped in a function", "body": "<p>I am writing a simple function on the GHCi command line (7.8.3)</p>\n\n<pre><code>let roundBy b x = (round (x/b)) * b\n</code></pre>\n\n<p>When evaluated, it gives an error about ambiguity (error message at bottom).</p>\n\n<p>However, if I substitute the values, the same expression can be evaluated fine.</p>\n\n<pre><code>Prelude&gt; (round (3/10))*10\n0\n</code></pre>\n\n<p>My question is:</p>\n\n<p>Is there a way to make ghci behave the same when the expression is encapsulated in a function, in the above case?</p>\n\n<p>P.S.\nError message (when evaluated as a function):</p>\n\n<pre><code>Prelude&gt; roundBy 10 3\n\n&lt;interactive&gt;:19:1:\n    No instance for (Show a0) arising from a use of `print'\n    The type variable `a0' is ambiguous\n    Note: there are several potential instances:\n      instance Show Double -- Defined in `GHC.Float'\n      ...plus 23 others\n    In a stmt of an interactive GHCi command: print it\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1434113116, "post_id": 30802706, "comment_id": 49655108, "body": "thanks for your answer. So is it not possible &quot;piping&quot; the output of exitcode-stdio unless I parse the file generated by cabal?"}, {"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "reply_to_user": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1434113583, "post_id": 30802706, "comment_id": 49655421, "body": "The output is also written to standard output: you see the tests running as it does, and then at the end you have the output in a log file. So you should be able to pipe the output of cabal test into something else."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1434117829, "post_id": 30802706, "comment_id": 49658390, "body": "So even UserHooks from the API cannot avoid that. Still I need a sort of text parsing."}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": true, "score": 2, "last_activity_date": 1434110841, "creation_date": 1434110841, "answer_id": 30802706, "question_id": 30800127, "link": "https://stackoverflow.com/questions/30800127/how-to-work-with-cabal-api/30802706#30802706", "title": "How to work with Cabal API", "body": "<p>A <code>exitcode-stdio-1.0</code> test suite is only an executable, which needs to implement <code>main :: IO()</code>. Cabal test just runs the executable and captures the output in a log file. So if you use a test framework like tasty, you'll get the output the tasty way. Of course, you can just write your own executable, and output what you want. You just need to return the proper error code to tell Cabal if the tests were successful or not. </p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 1, "accepted_answer_id": 30802706, "answer_count": 1, "score": 0, "last_activity_date": 1434110841, "creation_date": 1434102585, "question_id": 30800127, "link": "https://stackoverflow.com/questions/30800127/how-to-work-with-cabal-api", "title": "How to work with Cabal API", "body": "<p>I would like to \"interact\" with Cabal during the test phase (like exitcode-stdio-1.0) using the relative API (<a href=\"https://www.haskell.org/cabal/release/cabal-latest/doc/API/Cabal/Distribution-Simple-Test-ExeV10.html\" rel=\"nofollow\">https://www.haskell.org/cabal/release/cabal-latest/doc/API/Cabal/Distribution-Simple-Test-ExeV10.html</a>) to customise for example the final output.\nHow can I do that? I cannot find the right documentation.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1434102149, "post_id": 30799517, "comment_id": 49648456, "body": "a side from the <code>flip</code> @MrTsjolder mentioned I don&#39;t think the function will do what you want (there are more errors in there) - what is this function supposed to do?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1434102315, "post_id": 30799517, "comment_id": 49648568, "body": "Even if that were typeable, your ultimate result would be either 0 or 1, which is probably not what you&#39;re aiming for."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1434102487, "post_id": 30799517, "comment_id": 49648668, "body": "this is homework right (which is no problem - no sorrow) - but it would help if you could explain what the function is supposed to do (you can post the exercise - we see what you&#39;ve tried) - but as you are new - please edit your question (most add things as comments or as an answer instead)"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1434102004, "post_id": 30799627, "comment_id": 49648367, "body": "no need for <code>hoogle</code> - just type <code>:t foldr</code> in ghci ;) - and <code>test</code> here will not fit in at all (the <code>b</code> is quite different from the <code>b</code> in the used <code>foldr</code>)"}, {"owner": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434103092, "post_id": 30799627, "comment_id": 49649018, "body": "You&#39;re completely right, I got lost in my answer a bit (as can be seen in the edit-history), but thanks for making that clear"}], "tags": [], "owner": {"reputation": 2648, "user_id": 4375377, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/H6Fa4.png?s=128&g=1", "display_name": "Mr Tsjolder", "link": "https://stackoverflow.com/users/4375377/mr-tsjolder"}, "is_accepted": true, "score": 5, "last_activity_date": 1434103704, "last_edit_date": 1495535389, "creation_date": 1434101082, "answer_id": 30799627, "question_id": 30799517, "link": "https://stackoverflow.com/questions/30799517/haskell-type-mismatch-in-function-using-foldr/30799627#30799627", "title": "Haskell: Type mismatch in function using foldr", "body": "<p><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code> as can be found on <a href=\"https://www.haskell.org/hoogle/?hoogle=foldr\" rel=\"nofollow noreferrer\">Hoogle</a> expects a function of the form <code>a -&gt; b -&gt; b</code>, but your <code>test</code> function rather looks like <code>a -&gt; a -&gt; b</code>. </p>\n\n<p>As <a href=\"https://stackoverflow.com/users/76051/carsten\">Carsten</a> mentioned, the <code>b</code> of your function doesn't even match the <code>b</code> from the accumulator and the info can be retrieved from GHCi when using <code>:t foldr</code> (this can be done for any function). Alternatives for what you are trying to do might be (if I got it right you try to count the number of doubles):</p>\n\n<pre><code>countEqualPairs [] = 0\ncountEqualPairs (s:ss) = if (s `elem` ss) then 1 + x else x\n                         where x = countEqualPairs ss\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 300, "user_id": 5002494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d342ea3707348ae8b30599b5bdd8fa37?s=128&d=identicon&r=PG&f=1", "display_name": "Ruediger Ziege", "link": "https://stackoverflow.com/users/5002494/ruediger-ziege"}, "is_accepted": false, "score": 0, "last_activity_date": 1487666159, "creation_date": 1487666159, "answer_id": 42362307, "question_id": 30799517, "link": "https://stackoverflow.com/questions/30799517/haskell-type-mismatch-in-function-using-foldr/42362307#42362307", "title": "Haskell: Type mismatch in function using foldr", "body": "<p>Thanks a lot for the helpful comments and the answer. I solved it this way: </p>\n\n<pre><code>countEqualPairs :: Eq a =&gt; [a] -&gt; Int countEqualPairs ss = sum (zipWith test (init ss) (tail ss)) test :: Eq a =&gt; a -&gt; a -&gt; Int test c1 c2 = if (c1 == c2) then 1 else 0 \n</code></pre>\n"}], "owner": {"reputation": 300, "user_id": 5002494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d342ea3707348ae8b30599b5bdd8fa37?s=128&d=identicon&r=PG&f=1", "display_name": "Ruediger Ziege", "link": "https://stackoverflow.com/users/5002494/ruediger-ziege"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 30799627, "answer_count": 2, "score": -3, "last_activity_date": 1487666159, "creation_date": 1434100725, "question_id": 30799517, "link": "https://stackoverflow.com/questions/30799517/haskell-type-mismatch-in-function-using-foldr", "title": "Haskell: Type mismatch in function using foldr", "body": "<p>I don't understand why there is an error in these functions:</p>\n\n<pre><code>countEqualPairs:: Eq a =&gt; [a] -&gt; Int\ncountEqualPairs (s:ss) = foldr test s ss\n\ntest :: Eq a =&gt; a -&gt; a -&gt; Int\ntest s c = if (c == s) then 1 else 0\n</code></pre>\n\n<p>Error Message:</p>\n\n<blockquote>\n<pre><code>Could not deduce (a ~ Int)\nfrom the context (Eq a)\n  bound by the type signature for\n            countEqualPairs :: Eq a =&gt; [a] -&gt; Int\n  at Blatt06.hs:30:20-37\n `a' is a rigid type variable bound by\n     the type signature for countEqualPairs :: Eq a =&gt; [a] -&gt; Int\n     at Blatt06.hs:30:20\nRelevant bindings include\n ss :: [a] (bound at Blatt06.hs:31:20)\n  s :: a (bound at Blatt06.hs:31:18)\n countEqualPairs :: [a] -&gt; Int (bound at Blatt06.hs:31:1)\n In the second argument of `foldr', namely `s'\n In the expression: foldr test s ss\n</code></pre>\n</blockquote>\n\n<p>Anybody there who can explain, what I got wrong?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1434092385, "post_id": 30796833, "comment_id": 49643068, "body": "what are you trying to do there? (It&#39;s really hard to understand)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434092491, "post_id": 30796833, "comment_id": 49643129, "body": "aside from my difficulties understanding your idea/algorithm there are several problems in that line: <code>map</code> wants a list as last parameter but you give it the <code>Float</code> <code>max</code>, ..."}, {"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434093336, "post_id": 30796833, "comment_id": 49643557, "body": "Yes, that line was meant to convey what I want it to do even if it was a disaster. I really can&#39;t see how to make a call to <code>cross</code> give a list of something when I finally want a list of lists of that something."}], "answers": [{"comments": [{"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1434099467, "post_id": 30798942, "comment_id": 49646865, "body": "Crossing does represent a state, but having the former state I get the same result as an actual crossing. And I don&#39;t need to represent the torch since it&#39;s always going to be two people crossing to safety and one going back. It could even be done just moving one of the elements of the safe list to the other and adding the correct time as if two went and one came back."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434099967, "post_id": 30798942, "comment_id": 49647175, "body": "the very last trip should not involve one going back ;) - personally I find this a very elegant description (although I would use record syntax to make it readable without the comments and to help me remember the parts ;) )"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1434100209, "post_id": 30798942, "comment_id": 49647296, "body": "That&#39;s what I meant when I said <code>RoundTrip</code> didn&#39;t quite fit. I think it&#39;s possible to do it just by relying on the &quot;two people cross to safety and one person crosses back&quot; pattern, and it might even make the <code>next</code> function simpler but it would make the <code>cross</code> function more complicated."}, {"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1434100453, "post_id": 30798942, "comment_id": 49647455, "body": "You&#39;re both quite right. I&#39;m now trying to complete Jeremy&#39;s solution and it looks way better and more elegant than mine. I&#39;ll let you know how it went and edit the answer if I get it."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434101514, "post_id": 30798942, "comment_id": 49648065, "body": "in case someone wants the full <i>solution</i> I used Jeremys great proposal, tweaked it a bit and but it in this <a href=\"https://gist.github.com/CarstenKoenig/51060861b4ef5802bb43\" rel=\"nofollow noreferrer\">gist</a> ... but please mind the <b>spoilers</b>!"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1434103985, "post_id": 30798942, "comment_id": 49649479, "body": "I&#39;d also use this helper function in a couple of places if I were doing this on my own: <code>select [] = []; select (a:r) = (a,r) : map (\\ ~(b,r&#39;) -&gt; (b,a:r&#39;)) (select r)</code>, it&#39;s more efficient than using <code>delete</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1434111227, "post_id": 30798942, "comment_id": 49653862, "body": "@JeremyList yeah - efficiency was not my primal concern ;)"}], "tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": true, "score": 2, "last_activity_date": 1434098736, "creation_date": 1434098736, "answer_id": 30798942, "question_id": 30796833, "link": "https://stackoverflow.com/questions/30796833/how-to-get-a-solution-to-a-puzzle-having-a-function-that-gives-the-next-possible/30798942#30798942", "title": "How to get a solution to a puzzle having a function that gives the next possible steps in Haskell", "body": "<p>I'm not going to leave much of your code intact here.</p>\n\n<p>The first problems are with the data structures. <code>Crossing</code> doesn't actually represent anything to do with crossing the bridge, but the state before or after a bridge crossing. And you can't use <code>RoundTrip</code> because the number of bridge crossings is always odd.</p>\n\n<p>I'm renaming the data structure I'm actually keeping, but I'm not keeping it unmodified.</p>\n\n<pre><code>data Bank = Danger | Safety deriving (Eq,Show)\ndata PuzzleState = PuzzleState\n  [Float] -- people still in danger\n  [Float] -- people on the safe bank\n  Bank -- current location of the torch\n  Float -- remaining time\ntype Crossing = ([Float],Bank)\n</code></pre>\n\n<p>Modifying/writing these functions is left as an exercise for the reader</p>\n\n<pre><code>next :: PuzzleState -&gt; [Crossing] -- Create a list of possible crossings\napplyCrossing :: PuzzleState -&gt; Crossing -&gt; PuzzleState -- Create the next state\n</code></pre>\n\n<p>Then something like this function can put it all together (assuming <code>next</code> returns an empty list if the remaining time is too low):</p>\n\n<pre><code>cross (PuzzleState [] _ _ _) = [[]]\ncross s1 = do\n  c &lt;- next s1\n  let s2 = applyCrossing s1 c\n  r &lt;- cross s2\n  return $ c : r\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2464, "user_id": 1076715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf07aa4cdf24f3a770c21cb26e61bc7f?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1076715/eric"}, "is_accepted": false, "score": 0, "last_activity_date": 1434179729, "creation_date": 1434179729, "answer_id": 30816093, "question_id": 30796833, "link": "https://stackoverflow.com/questions/30796833/how-to-get-a-solution-to-a-puzzle-having-a-function-that-gives-the-next-possible/30816093#30816093", "title": "How to get a solution to a puzzle having a function that gives the next possible steps in Haskell", "body": "<p>Just for the fun, an approach using a lazy tree:</p>\n\n<pre><code>import Data.List\nimport Data.Tree\n\ntype Pawn = (Char, Int)\n\ndata Direction = F | B\n\ndata Turn = Turn {\n  _start :: [Pawn],\n  _end   :: [Pawn],\n  _dir   :: Direction,\n  _total :: Int\n}\n\ntype Solution = ([String], Int)\n\n-- generate a tree\nmkTree :: [Pawn] -&gt; Tree Turn\nmkTree p = Node{ rootLabel = s, subForest = branches s }\n  where s = Turn p [] F 0\n\n-- generates a node for a Turn\nmkNode :: Turn -&gt; Tree Turn\nmkNode t = Node{ rootLabel = t, subForest = branches t }\n\n-- next possible moves\nbranches :: Turn -&gt; [Tree Turn]\n-- complete\nbranches (Turn [] e d t) = []\n-- moving forward\nbranches (Turn s e F t) = map (mkNode.turn) (next s)\n  where\n    turn n = Turn (s\\\\n) (e++n) B (t+time n)\n    time = maximum . map snd\n    next xs = [x| x &lt;- mapM (const xs) [1..2], head x &lt; head (tail x)]\n-- moving backward\nbranches (Turn s e B t) = map (mkNode.turn) e\n  where\n    turn n = Turn (n:s) (delete n e) F (t+time n)\n    time (_,b) = b\n\nsolve :: Int -&gt; Tree Turn -&gt; [Solution]\nsolve limit tree = solve' [] [] limit tree\n  where \n    solve' :: [Solution] -&gt; [String] -&gt; Int -&gt; Tree Turn -&gt; [Solution]\n    solve' sols cur limit (Node (Turn s e d t) f)\n      | and [t &lt;= limit, s == []] = sols ++ [(cur++[step],t)]\n      | t &lt;= limit = concat $ map (solve' sols (cur++[step]) limit) f\n      | otherwise = []\n      where step = \"[\" ++ (v s) ++ \"|\" ++ (v e) ++ \"]\"\n            v    = map fst\n</code></pre>\n\n<p>Then you you can get a list of solutions:</p>\n\n<pre><code>solve 16 $ mkTree [('a',2), ('b',4), ('c',8)]\n\n=&gt; [([\"[abc|]\",\"[c|ab]\",\"[ac|b]\",\"[|bac]\"],14),([\"[abc|]\",\"[c|ab]\",\"[bc|a]\",\"[|abc]\"],16),([\"[abc|]\",\"[b|ac]\",\"[ab|c]\",\"[|cab]\"],14),([\"[abc|]\",\"[a|bc]\",\"[ba|c]\",\"[|cab]\"],16)]\n</code></pre>\n\n<p>Or also generate a tree of solutions:</p>\n\n<pre><code>draw :: Int -&gt; Tree Turn -&gt; Tree String\ndraw limit (Node (Turn s e d t) f)\n  | t &gt; limit = Node \"Time Out\" []\n  | s == []   = Node (\"Complete: \" ++ step) []\n  | otherwise = Node step (map (draw limit) f)\n  where step = \"[\" ++ (v s) ++ \"|\" ++ (v e) ++ \"]\" ++ \" - \" ++ (show t)\n        v    = map fst\n</code></pre>\n\n<p>Then: </p>\n\n<pre><code>putStrLn $ drawTree $ draw 16 $ mkTree [('a',2), ('b',4), ('c',8)]\n</code></pre>\n\n<p>Will result in:</p>\n\n<pre><code>[abc|] - 0\n|\n+- [c|ab] - 4\n|  |\n|  +- [ac|b] - 6\n|  |  |\n|  |  `- Complete: [|bac] - 14\n|  |\n|  `- [bc|a] - 8\n|     |\n|     `- Complete: [|abc] - 16\n|\n+- [b|ac] - 8\n|  |\n|  +- [ab|c] - 10\n|  |  |\n|  |  `- Complete: [|cab] - 14\n|  |\n|  `- [cb|a] - 16\n|     |\n|     `- Time Out\n|\n`- [a|bc] - 8\n   |\n   +- [ba|c] - 12\n   |  |\n   |  `- Complete: [|cab] - 16\n   |\n   `- [ca|b] - 16\n      |\n      `- Time Out\n</code></pre>\n"}], "owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 30798942, "answer_count": 2, "score": 1, "last_activity_date": 1434179729, "creation_date": 1434091442, "last_edit_date": 1434104568, "question_id": 30796833, "link": "https://stackoverflow.com/questions/30796833/how-to-get-a-solution-to-a-puzzle-having-a-function-that-gives-the-next-possible", "title": "How to get a solution to a puzzle having a function that gives the next possible steps in Haskell", "body": "<p>I'm solving the <a href=\"https://en.wikipedia.org/wiki/Bridge_and_torch_problem\" rel=\"nofollow\">Brigde and torch problem</a></p>\n\n<p>in Haskell.</p>\n\n<p>I wrote a function that given a state of the puzzle, as in which people have yet to cross and those who have crossed, gives back a list of all possible moves from one side to the other (moving two people forwards and one person backwards).</p>\n\n<pre><code>module DarkBridgeDT where\n\n\ndata Crossing = Trip [Float] [Float] Float deriving (Show)\ndata RoundTrip = BigTrip Crossing Crossing deriving (Show)\n\ntrip :: [Float] -&gt; [Float] -&gt; Float -&gt; Crossing\ntrip x y z                  = Trip x y z    \n\nroundtrip :: Crossing -&gt; Crossing -&gt; RoundTrip\nroundtrip x y               = BigTrip x y\n\n\nnext :: Crossing -&gt; [RoundTrip]\nnext (Trip [] _ _)              = []\nnext (Trip (a:b:[]) s _ )   \n    |a&gt;b                    = [BigTrip (Trip [] (a:b:s) a) (Trip [] [] 0)]\n    |otherwise              = [BigTrip (Trip [] (b:a:s) b) (Trip [] [] 0)]\nnext (Trip d s _)               = [BigTrip (Trip [x,z] (i:j:s) j) b | i &lt;- d, j &lt;- d, i &lt; j, x &lt;- d, z &lt;- d, x &lt; z, z /= i, z /= j, x /= z, x /= i, x /= j, b &lt;- (back [x,z] (i:j:s))]\n    where\n        back [] s           = []\n        back d s            = [Trip (i:d) (filter (/= i) s) i | i &lt;- s]\n</code></pre>\n\n<p>Now I need a function that given a state as the one above and a maximum amount of time gives back all possible solutions to the puzzle in less than that given time.</p>\n\n<p>All I have for that is this:</p>\n\n<pre><code>cross :: Crossing -&gt; Float -&gt; [[RoundTrip]]\ncross (Trip [] _ _) _               = []\ncross (Trip _ _ acu) max \n    | acu &gt; max                 = [] \ncross (Trip a b acu) max                = map (cross (map (crec) (next (Trip a b acu)) acu)) max\n    where\n        crec (BigTrip (Trip _ _ t1) (Trip a b t2)) acu  = (Trip a b (t1+t2+acu))\n</code></pre>\n\n<p>Of course that doesn't compile, the 5th line is the one that's driving me insane. Any input?</p>\n\n<p>Edit:\nThe <code>cross</code> function is meant to apply the <code>next</code> function to every result of the last <code>next</code>function called.\nIf the first result of next was something like: <code>[A,B,C,D]</code> then it would call <code>next</code> on A B C and D to see if any or all of those get to a solution in less than <code>max</code> (A B C and D would be Crossings inside which contain the floats that are the time that ads up and is compared to max).</p>\n\n<p>My data structure is</p>\n\n<p>Crossing: Contains the first side of the bridge (the people in it represented by the time they take to cross the bridge) the other side of the bridge (the same as the other) and a time that represents the greatest time that last crossed the bridge (either the greatest of the two in the first crossing or the only one in the second) or the amount of time acumulated crossing the bridge (in the cross function).</p>\n\n<p>RoundTrip: Represents two crossings, the first and the second, the one getting to safety and the one coming back to danger.</p>\n\n<p><code>cross (Trip [1,2,5,10] [] 0) 16</code> should give an empty list for there is no solution that takes less than 17 minutes (or whatever time unit).</p>\n\n<p><code>cross (Trip [1,2,5,10] [] 0) 17</code> should give the normal solution to the puzzle as a list of roundtrips.</p>\n\n<p>I hope that makes it clearer.</p>\n\n<p>Edit2:\nI finally got it. I read Carsten's solution before I completed mine and we laid it out practically the same. He used fancier syntax and more complex structures but it's really similar:</p>\n\n<pre><code>module DarkBridgeST where\n\ndata Torch = Danger | Safety deriving (Eq,Show)\ndata State = State\n   [Float] -- people in danger\n   [Float] -- people safe\n   Torch   -- torch position\n   Float   -- remaining time\n   deriving (Show)\n\ntype Crossing = [Float]\n\nclassic :: State\nclassic = State [1,2,5,10] [] Danger 17\n\nnext :: State -&gt; [Crossing] -- List all possible moves\nnext (State []     _    _      _)           = []  -- Finished\nnext (State _        []   Safety _)         = []  -- No one can come back\nnext (State danger _    Danger rem)         = [[a,b] | a &lt;- danger, b &lt;- danger, a /= b, a &lt; b, max a b &lt;= rem]\nnext (State _        safe Safety rem)       = [[a] | a &lt;- safe, a &lt;= rem]\n\n\ncross :: State -&gt; Crossing -&gt; State  -- Crosses the bridge depending on where the torch is\ncross (State danger safe Danger rem) cross  = State (taking cross danger) (safe ++ cross) Safety (rem - (maximum cross))\ncross (State danger safe Safety rem) cross  = State (danger ++ cross) (taking cross safe) Danger (rem - (maximum cross))\n\ntaking :: [Float] -&gt; [Float] -&gt; [Float]\ntaking [] d                         = d\ntaking (x:xs) d                 = taking xs (filter (/=x) d)\n\nsolve :: State -&gt; [[Crossing]]\nsolve (State [] _ _ _)              = [[]]\nsolve sf = do\n    c &lt;- next sf\n    let sn = cross sf c\n    r &lt;- solve sn\n    return (c:r)\n</code></pre>\n\n<p>All in all thanks everyone. I'm new to Haskell programming and this helped me understand a lot of things. I hope this post can also help someone starting haskell like me one day :)</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 11, "last_activity_date": 1434087699, "creation_date": 1434087699, "answer_id": 30795991, "question_id": 30795914, "link": "https://stackoverflow.com/questions/30795914/how-to-use-proxy-properly/30795991#30795991", "title": "How to use Proxy properly?", "body": "<p>You need <code>ScopedTypeVariables</code> <em>and</em> <code>forall</code> introduction to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/other-type-extensions.html#scoped-type-variables\">get a scoped type variable:</a></p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nbar :: forall a. Foo a =&gt; a -&gt; Int\nbar _ = foo (Proxy :: Proxy a)\n</code></pre>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 30795991, "answer_count": 1, "score": 4, "last_activity_date": 1434087699, "creation_date": 1434087286, "question_id": 30795914, "link": "https://stackoverflow.com/questions/30795914/how-to-use-proxy-properly", "title": "How to use Proxy properly?", "body": "<p>Why this code doesn't work?</p>\n\n<pre><code>class Foo a where \n    foo :: Proxy a -&gt; Int\n\nbar :: Foo a =&gt; a -&gt; Int\nbar _ = foo (Proxy :: Proxy a)\n</code></pre>\n\n<p>It fails to compile with the message:</p>\n\n<pre><code>Could not deduce (Foo a0) arising from a use of `foo'\nfrom the context (Foo a)\n  bound by the type signature for bar :: Foo a =&gt; a -&gt; Int\nThe type variable `a0' is ambiguous\nIn the expression: foo (Proxy :: Proxy a)\nIn an equation for `bar': bar _ = foo (Proxy :: Proxy a)\n</code></pre>\n\n<p>I tried it with and without ScopedTypeVariables extension</p>\n"}, {"tags": ["haskell", "functional-programming", "agda"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1434076449, "post_id": 30794282, "comment_id": 49638270, "body": "It is possible to, for example, define a Set whose inhabitants are proofs of the Goldbach conjecture.  What does that tell you about <code>isTop</code>?"}, {"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "edited": false, "score": 3, "creation_date": 1434077611, "post_id": 30794282, "comment_id": 49638523, "body": "I&#39;m not sure how to define <code>isTop</code>, but the reason <code>\u22a4 eq \u22a4</code> is returning false is because you cannot pattern match on something of type <code>Set</code>.  Agda is interpreting <code>\u22a4</code> and <code>\u22a5</code> as ordinary variable names.  It would be same same as saying <code>x eq y = false</code>."}, {"owner": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1434083958, "post_id": 30794282, "comment_id": 49639913, "body": "@luqui I am not getting how to define a set with that proof. Can you elaborate??"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1434093363, "post_id": 30794282, "comment_id": 49643575, "body": "In short, this is impossible. You should instead state what broader goal you are trying to accomplish."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1434098273, "post_id": 30794282, "comment_id": 49646174, "body": "The universe <code>Set</code> is not an inductively defined type, so you can&#39;t use pattern matching on that. Suppose you could somehow have a definition for <code>_eq_</code> using pattern matching. Later on you could add a custom type <code>data Foo : Set where ...</code>, where <code>Foo</code> was not considered in the definition of <code>_eq_</code>."}], "answers": [{"comments": [{"owner": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "edited": false, "score": 0, "creation_date": 1434107643, "post_id": 30798989, "comment_id": 49651638, "body": "This is really helpful. Thanks a lot. But still my problem does not resolve. I want to write if(isTop (is (chkTop))) and definition of chkTop is <code>chkTop : something -&gt; Set chkTop x = if (x is true) then T else bot.</code> When i compile this i get error set != [[ <i>u x y</i>]]."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "edited": false, "score": 1, "creation_date": 1434113320, "post_id": 30798989, "comment_id": 49655246, "body": "@ajayv, I don&#39;t understand your code, but, AFAIK, there is no way to break parametricity in Agda, so it&#39;s not possible to somehow emulate your <code>isTop</code> function. But your original question looks like an <a href=\"http://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>. Why do you need this <code>isTop</code>?"}, {"owner": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "edited": false, "score": 0, "creation_date": 1434192068, "post_id": 30798989, "comment_id": 49682102, "body": "Actually this is the root problem of mine. If this get solved I do not require isTop function. Please take a look <a href=\"https://stackoverflow.com/questions/30817693/how-can-i-change-working-of-forall-in-agda\" title=\"how can i change working of forall in agda\">stackoverflow.com/questions/30817693/&hellip;</a>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "edited": false, "score": 1, "creation_date": 1434197130, "post_id": 30798989, "comment_id": 49683366, "body": "@ajayv, your definition of <code>isCut</code> looks ok to me (I would rather use <code>T</code> from <code>Data.Bool.Base</code>, but that&#39;s a minor point). You don&#39;t need the <code>isTop</code> function \u2014 you need to pattern match on this big expression <code>((((p mem (getLC x)) ...</code> using <code>with</code> in every function, that exploits the <code>isCut</code> property, and handle <code>false</code> and <code>true</code> cases differently."}, {"owner": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "edited": false, "score": 0, "creation_date": 1434207543, "post_id": 30798989, "comment_id": 49686412, "body": "Now I am relax that I dont need isTop function. Can you write some line of code I still dint get to handle false and true case seperately. Is it possible to write isCut : cut -&gt; Bool. If it is please help me I am struck on this from last 4 days. I need to resolve this ASAP."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "edited": false, "score": 1, "creation_date": 1434212981, "post_id": 30798989, "comment_id": 49688160, "body": "@ajayv, &quot;Is it possible to write isCut : cut -&gt; Bool&quot; \u2014 no, because the definition of <code>isCut</code> contains quantification. Please, minimize your problem and make the question self-contained, otherwise it&#39;s hard to help you."}, {"owner": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "edited": false, "score": 0, "creation_date": 1434213907, "post_id": 30798989, "comment_id": 49688432, "body": "thanks for your patience.. I have minimized my problem ..please look at this..<a href=\"http://stackoverflow.com/questions/30820714/how-to-use-logical-and-operation-between-two-sets-in-agda\" title=\"how to use logical and operation between two sets in agda\">stackoverflow.com/questions/30820714/&hellip;</a>"}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 8, "last_activity_date": 1434099855, "last_edit_date": 1495542249, "creation_date": 1434098913, "answer_id": 30798989, "question_id": 30794282, "link": "https://stackoverflow.com/questions/30794282/how-to-compare-two-sets-in-agda/30798989#30798989", "title": "How to compare two sets in Agda?", "body": "<p>It's impossible in Agda, but is <a href=\"https://stackoverflow.com/a/26012264/3237465\">not senseless</a> in general.</p>\n\n<p>You could write something not very meaninigful:</p>\n\n<pre><code>open import Data.Empty\nopen import Data.Unit\nopen import Data.Bool\n\ndata U : Set where\n  bot top : U\n\n\u27e6_\u27e7 : U -&gt; Set\n\u27e6 bot \u27e7 = \u22a5\n\u27e6 top \u27e7 = \u22a4\n\nrecord Is {\u03b1} {A : Set \u03b1} (x : A) : Set where\n\nis : \u2200 {\u03b1} {A : Set \u03b1} -&gt; (x : A) -&gt; Is x\nis _ = _\n\nisTop : \u2200 {u} -&gt; Is \u27e6 u \u27e7 -&gt; Bool\nisTop {bot} _ = false\nisTop {top} _ = true\n\nopen import Relation.Binary.PropositionalEquality\n\ntest-bot : isTop (is \u22a5) \u2261 false\ntest-bot = refl\n\ntest-top : isTop (is \u22a4) \u2261 true\ntest-top = refl\n</code></pre>\n\n<p><code>u</code> can be inferred from <code>Is \u27e6 u \u27e7</code>, because <code>\u27e6_\u27e7</code> is <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php?n=ReferenceManual.FindingTheValuesOfImplicitArguments\" rel=\"nofollow noreferrer\">constructor headed</a>.\n<code>Is</code> is a singleton, so it allows to lift values to the type level. You can find an example of using <a href=\"https://stackoverflow.com/a/28589398/3237465\">here</a>.</p>\n"}], "owner": {"reputation": 589, "user_id": 2487229, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/53d7511ec6e92c5ca295639a7b1c287a?s=128&d=identicon&r=PG", "display_name": "ajayv", "link": "https://stackoverflow.com/users/2487229/ajayv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1434099855, "creation_date": 1434074606, "question_id": 30794282, "link": "https://stackoverflow.com/questions/30794282/how-to-compare-two-sets-in-agda", "title": "How to compare two sets in Agda?", "body": "<p>I want to write a function which take set as input and <code>return true if it is top and false if it is bottom.</code>\nI have tried in this way..</p>\n\n<pre><code>isTop : Set \u2192 Bool\nisTop x = if (x eq \u22a4) then true\n              else false\n</code></pre>\n\n<p>But i am not able to define eq correctly. I tried as..</p>\n\n<pre><code>_eq_ : Set \u2192 Set \u2192 Bool\n\u22a4 eq \u22a5 = false\n</code></pre>\n\n<p>This is not working because when i check <code>T eq T it is also returning false.</code></p>\n\n<p>Please help me to write this eq function or any other ways to write isTop.</p>\n"}, {"tags": ["haskell", "syntax"], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 4992699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29b1990896b63e27b78ab4b7c1b8d10?s=128&d=identicon&r=PG", "display_name": "Tejing", "link": "https://stackoverflow.com/users/4992699/tejing"}, "is_accepted": true, "score": 6, "last_activity_date": 1434077843, "last_edit_date": 1434077843, "creation_date": 1434076026, "answer_id": 30794449, "question_id": 30794057, "link": "https://stackoverflow.com/questions/30794057/beginner-help-for-understanding-haskell-list-comprehension-syntax/30794449#30794449", "title": "Beginner help for understanding Haskell List Comprehension syntax", "body": "<p>You could roughly translate this to imperative pseudocode like so:</p>\n\n<pre><code>for c in 1..10\n  for a in 1..c\n    for b in 1..a\n      if a^2 + b^2 == c^2\n        put (a,b,c) on end of triple\n</code></pre>\n\n<p>except that it will run lazily as elements are requested by whatever consumes the list.</p>\n\n<p>List comprehensions are effectively a fairly simple syntactic sugar on top of the list monad. If you want more information about how they're interpreted you may want to look there.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1434083784, "last_edit_date": 1434083784, "creation_date": 1434077691, "answer_id": 30794636, "question_id": 30794057, "link": "https://stackoverflow.com/questions/30794057/beginner-help-for-understanding-haskell-list-comprehension-syntax/30794636#30794636", "title": "Beginner help for understanding Haskell List Comprehension syntax", "body": "<blockquote>\n  <p>In which order does Haskell evaluate each expression?</p>\n</blockquote>\n\n<p>As general rule, the answer to this question is</p>\n\n<blockquote>\n  <p>It's none of your business.</p>\n</blockquote>\n\n<p>Worrying about what order things are evaluated in is not the right way to think about what your Haskell program will do. In Java, that matters a lot, because evaluation can have side effects. In Haskell, the evaluation order does not affect the results (weird corners aside).</p>\n\n<p>The key to thinking about list comprehensions is to think about the <em>nesting</em> order, not the <em>evaluation</em> order. The leftmost terms of the list comprehension are the outermost ones.</p>\n"}], "owner": {"reputation": 640, "user_id": 1704227, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/98e091d359f91dce1da0ad768c2ba589?s=128&d=identicon&r=PG", "display_name": "Definity", "link": "https://stackoverflow.com/users/1704227/definity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 30794449, "answer_count": 2, "score": 1, "last_activity_date": 1434083784, "creation_date": 1434073082, "question_id": 30794057, "link": "https://stackoverflow.com/questions/30794057/beginner-help-for-understanding-haskell-list-comprehension-syntax", "title": "Beginner help for understanding Haskell List Comprehension syntax", "body": "<p>Here is the code I'm trying to understand.</p>\n\n<pre><code>let triple = [ (a,b,c) | c &lt;- [1..10], a &lt;- [1..c], b &lt;- [1..a], a^2 + b^2 == c^2]\n</code></pre>\n\n<p>My question is in which order does Haskell evaluate each expression?</p>\n"}, {"tags": ["haskell", "functional-programming", "composition", "functor", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 949, "user_id": 1219515, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/64ce0ac7d44d2076d23b21ac62214970?s=128&d=identicon&r=PG", "display_name": "Maciej Goszczycki", "link": "https://stackoverflow.com/users/1219515/maciej-goszczycki"}, "edited": false, "score": 0, "creation_date": 1434120091, "post_id": 30792695, "comment_id": 49659789, "body": "It seems using  <code>Applicative</code> is neater, and requires less parenthesis. I like the <code>&gt;$&lt;</code> proposed by @rampion too, but this seems more idiomatic."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 949, "user_id": 1219515, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/64ce0ac7d44d2076d23b21ac62214970?s=128&d=identicon&r=PG", "display_name": "Maciej Goszczycki", "link": "https://stackoverflow.com/users/1219515/maciej-goszczycki"}, "edited": false, "score": 1, "creation_date": 1434120488, "post_id": 30792695, "comment_id": 49660062, "body": "@mgoszcz2 This would definitely be more idiomatic as it only uses pre-defined functions in the standard library.  Most of the time you run across this problem you&#39;ll already be working with an applicative, not just a functor (there aren&#39;t very many useful functors that aren&#39;t also applicatives), so you don&#39;t have to worry about the added constraint too much. rampion&#39;s solution is good, but the line <code>f &gt;$&lt; a &gt;$&lt; b</code> is just weird for my eyes and fingers that are used to <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code>.  I would probably pick an easier to type operator for it in production code if I were going to use it a lot."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1434130957, "post_id": 30792695, "comment_id": 49666452, "body": "bheklilr: agreed on all points. I thought about using <code>&lt;&#162;&gt;</code> instead, but that&#39;s a bit cruel on the fingers on my keyboard :)"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1434062769, "creation_date": 1434062769, "answer_id": 30792695, "question_id": 30792554, "link": "https://stackoverflow.com/questions/30792554/easier-way-to-apply-multiple-arguments-in-haskell/30792695#30792695", "title": "Easier way to apply multiple arguments in Haskell", "body": "<p>The <code>Applicative</code> class has the <code>&lt;*&gt;</code> operator (usually pronounced \"ap\", and is equivalent to <code>Control.Monad.ap</code> for most <code>Monad</code>s), which combined with the <code>&lt;$&gt;</code> operator (itself just an infix alias for <code>fmap</code>) lets you write code like</p>\n\n<pre><code>-- f :: a -&gt; b -&gt; c\n-- fa :: Applicative f =&gt; f a\n-- fb :: Applicative f =&gt; f b\nf &lt;$&gt; fa &lt;*&gt; fb :: Applicative f =&gt; f c\n</code></pre>\n\n<p>If you need to apply pure arguments, then use the <code>pure</code> method of the <code>Applicative</code> class:</p>\n\n<pre><code>-- f :: a -&gt; b -&gt; c\n-- a :: a\n-- b :: b\nf &lt;$&gt; pure a &lt;*&gt; pure b :: Applicative f =&gt; f c\n</code></pre>\n\n<p>An example might be</p>\n\n<pre><code>sumOfSquares :: Num a =&gt; a -&gt; a -&gt; a\nsumOfSquares a b = a * a + b * b\n\n&gt; sumOfSquares &lt;$&gt; Just 1 &lt;*&gt; Just 2\nJust 5\n&gt; sumOfSquares &lt;$&gt; Just 1 &lt;*&gt; Nothing\nNothing\n&gt; sumOfSquares &lt;$&gt; pure 1 &lt;*&gt; pure 2 :: Maybe Int\n5\n&gt; sumOfSquares &lt;$&gt; readLn &lt;*&gt; readLn :: IO Int\n1&lt;ENTER&gt;\n2&lt;ENTER&gt;\n5\n</code></pre>\n\n<p>The <code>Applicative f =&gt; f (a -&gt; b -&gt; c)</code> is being constructed by <code>f &lt;$&gt;</code> here, so if you already had something like</p>\n\n<pre><code>&gt; let g :: IO (Int -&gt; Int -&gt; Int); g = undefined\n</code></pre>\n\n<p>Then you could just use it as</p>\n\n<pre><code>&gt; g &lt;*&gt; pure 1 &lt;*&gt; pure 2\n</code></pre>\n\n<p>The <code>&lt;*&gt;</code> operator has the type</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>so if your function has type <code>x -&gt; y -&gt; z</code>, then <code>a ~ x</code> and <code>b ~ y -&gt; z</code>, so repeated <strong>ap</strong>plication of <code>&lt;*&gt;</code> (get it?) passes more arguments to your wrapped function.</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 3, "last_activity_date": 1434072582, "creation_date": 1434072582, "answer_id": 30793996, "question_id": 30792554, "link": "https://stackoverflow.com/questions/30792554/easier-way-to-apply-multiple-arguments-in-haskell/30793996#30793996", "title": "Easier way to apply multiple arguments in Haskell", "body": "<p>We've got</p>\n\n<pre><code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>But you want the opposite</p>\n\n<pre><code>(&gt;$&lt;) :: Functor f =&gt; f (a -&gt; b) -&gt; a -&gt; f b\n</code></pre>\n\n<p>Which we can easily define:</p>\n\n<pre><code>(&gt;$&lt;) f a = ($a) &lt;$&gt; f\n</code></pre>\n\n<p>So given </p>\n\n<pre><code>f :: Functor f =&gt; f (a -&gt; b -&gt; c)\na :: a\nb :: b\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>f &gt;$&lt; a :: f (b -&gt; c)\nf &gt;$&lt; a &gt;$&lt; b :: f c\n</code></pre>\n\n<p>This isn't as idiomatic as <code>&lt;*&gt;</code>, but it works for all <code>Functor</code>s, not just <code>Applicative</code>s, which is nice.</p>\n"}], "owner": {"reputation": 949, "user_id": 1219515, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/64ce0ac7d44d2076d23b21ac62214970?s=128&d=identicon&r=PG", "display_name": "Maciej Goszczycki", "link": "https://stackoverflow.com/users/1219515/maciej-goszczycki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 30792695, "answer_count": 2, "score": 4, "last_activity_date": 1434123034, "creation_date": 1434061905, "last_edit_date": 1434123034, "question_id": 30792554, "link": "https://stackoverflow.com/questions/30792554/easier-way-to-apply-multiple-arguments-in-haskell", "title": "Easier way to apply multiple arguments in Haskell", "body": "<p>Given value <code>f</code> with type <code>:: Applicative f =&gt; f (a -&gt; b -&gt; c)</code>, What's the best way to map arguments to the inner function.</p>\n\n<p>So far I've found the following:</p>\n\n<p><code>(\\x -&gt; x a b) &lt;$&gt; f</code></p>\n\n<p><code>(flip ($ a) b) &lt;$&gt; f</code></p>\n\n<p><code>($ b) &lt;$&gt; ($ a) &lt;$&gt; f</code></p>\n\n<p>I guess my question is why Haskell doesn't have a <code>:: a -&gt; b -&gt; (a -&gt; b -&gt; c) -&gt; c</code> function. Or does it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "edited": false, "score": 0, "creation_date": 1446439245, "post_id": 30790381, "comment_id": 54727191, "body": "do not know where empty tuple coming from and how to filter them and print true result"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1446440880, "creation_date": 1446440880, "answer_id": 33471127, "question_id": 30790381, "link": "https://stackoverflow.com/questions/30790381/how-to-remove-empty-tuples-to-make-it-filter-to-print-out-all-true-result/33471127#33471127", "title": "how to remove empty tuples to make it filter to print out all true result?", "body": "<p>Note that the type of <code>altrees1</code> is <code>[()]</code>. By using <code>forM_</code> you are discarding the results of inner computations.</p>\n\n<p>Note that the type of <code>altrees</code> is <code>[ [ Mree Double ] ]</code>.</p>\n\n<p>Perhaps this is what you want:</p>\n\n<pre><code>allexprs :: [ Mree Double ]\nallexprs = concat alltrees   -- a list of all the Mrees in alters\n\nalltrees2 = [ (x, eval x == eval x) | x &lt;- allexprs ]\n   -- this is apparently what alltrees1 is doing\n\nbb = [ x | (x, True) &lt;- alltrees2 ]\n   -- same as: filter (\\(x,b) -&gt; b == True) altrees2\n   --          filter (\\(x,b) -&gt; b) alltrees2\n   --          filter (\\xb -&gt; snd xb) alltrees2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 436, "user_id": 5511980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0174993a67ce7b3ad2bcb2f12e135661?s=128&d=identicon&r=PG&f=1", "display_name": "W. Cybriwsky", "link": "https://stackoverflow.com/users/5511980/w-cybriwsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1446441778, "creation_date": 1446441778, "answer_id": 33471246, "question_id": 30790381, "link": "https://stackoverflow.com/questions/30790381/how-to-remove-empty-tuples-to-make-it-filter-to-print-out-all-true-result/33471246#33471246", "title": "how to remove empty tuples to make it filter to print out all true result?", "body": "<p>The basic haskell List (and most collections) won't let you store empty tuples and non-empty tuples in the same list, because they are different types\u2014so, in this case, it doesn't make sense to say </p>\n\n<pre><code>\\n -&gt; if n != () then snd n == True\n</code></pre>\n\n<p>Now: why is the list a list of empty tuples? Because of the type of forM_ (found via <a href=\"https://www.haskell.org/hoogle/?hoogle=forM_\" rel=\"nofollow\" title=\"hoogle\">hoogle</a>):</p>\n\n<pre><code>forM_ :: (Foldable t, Monad m) =&gt; t a -&gt; (a -&gt; m b) -&gt; m ()\n</code></pre>\n\n<p>In the context above (iterating over a list, producing a list), this is specifically:</p>\n\n<pre><code>forM_ :: [a] -&gt; (a -&gt; [b]) -&gt; [()]\n</code></pre>\n\n<p>The return value from forM_ (and, as a naming convention, many functions ending with underscore, like traverse_, for_, and sequenceA_) is \"useless\"; these functions are typically used to execute side effects in some monad like IO.</p>\n\n<p>Note: since you aren't using those indices for anything but to visit each list member, it'd be a little cleaner to just use map:</p>\n\n<pre><code>map (map (\\x -&gt; (x, eval x == eval x))) allTrees\n</code></pre>\n\n<p>For more info about lists, see <a href=\"http://learnyouahaskell.com/starting-out#an-intro-to-lists\" rel=\"nofollow\">the chapter from the book learn you a haskell</a>.</p>\n"}], "owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 33471127, "answer_count": 2, "score": 0, "last_activity_date": 1446441778, "creation_date": 1434052998, "last_edit_date": 1446439135, "question_id": 30790381, "link": "https://stackoverflow.com/questions/30790381/how-to-remove-empty-tuples-to-make-it-filter-to-print-out-all-true-result", "title": "how to remove empty tuples to make it filter to print out all true result?", "body": "<p>i do not know where the empty tuples coming from ?\nsince index is so big, i can not see the content of result</p>\n\n<p>how to remove empty tuples to make it filter to print out all true result?</p>\n\n<p>error:</p>\n\n<p>*Main> let bb = filter (\\n -> snd n == True) alltrees1</p>\n\n<p>:74:39:\n    Couldn't match expected type <code>(a0, Bool)' with actual type</code>()'\n    Expected type: [(a0, Bool)]\n      Actual type: [()]\n    In the second argument of <code>filter', namely</code>alltrees1'\n    In the expression: filter (\\ n -> snd n == True) alltrees1</p>\n\n<p>run:</p>\n\n<pre><code>:l trees.hs\nlet allparams = replicateM 3 [1.0, 2.0]\nlet alltrees = [getAllTrees c | x &lt;- allparams, c &lt;- [x]]\neval(alltrees!!1!!1) == eval(alltrees!!1!!1)\nlet alltrees1 = forM_ [0..(sizeoflist alltrees)] $ \\i -&gt; forM_ [0..(sizeoflist (alltrees!!i))] $ \\j -&gt; [(alltrees!!i!!j, eval(alltrees!!i!!j) == eval(alltrees!!i!!j))]\nlet bb = filter (\\n -&gt; if n != () then snd n == True) alltrees1\n</code></pre>\n\n<p>haskell:</p>\n\n<pre><code>import Data.List\nimport Control.Monad\nimport Math.Combinat\nimport System.IO\n\ndata Operation\n  = And\n  | Or\n  | MA\n  | MB\n  | Impl\n    deriving Show\n\ndata Mree x\n = Meaf x\n | Mode (Mree x) Operation (Mree x)\n   deriving Show\n\nsplits :: [a] -&gt; [([a], [a])]\nsplits xs = zip (inits xs) (tails xs)\n\ngetAllTrees :: [a] -&gt; [Mree a]\ngetAllTrees [] = []\ngetAllTrees [x] = return $ Meaf x\ngetAllTrees xs = do\n  (left, right) &lt;- splits xs\n  guard $ not (null left) &amp;&amp; not (null right)\n  leftT &lt;- getAllTrees left\n  rightT &lt;- getAllTrees right\n  op &lt;- [And, Or]\n  return $ Mode leftT op rightT\n\neval :: Mree Double -&gt; Double\neval (Meaf x) = x\neval (Mode l And r) = eval l\neval (Mode l Or r) = eval r\n\nsizeoflist :: [a] -&gt; Int\nsizeoflist = length\n</code></pre>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 2, "creation_date": 1434052566, "post_id": 30789741, "comment_id": 49630005, "body": "It would help if you annotated your code with types and included the actual error. Anyway, it appears that you expect <code>r</code> to be the String, but the return type of the case statement needs to be the same in all cases (otherwise type error.) In the Left case, the type is IO () due to <code>putStrLn &quot;...&quot;</code>. In the Right case, it&#39;s a String. That is not possible."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1434052849, "post_id": 30789741, "comment_id": 49630152, "body": "Try loading everything above the <code>{-- &#47;snippet all --}</code> line into GHCi and then type <code>:type parse pgmFile &quot;(stdin)&quot;</code>.  What is its type?"}, {"owner": {"reputation": 41, "user_id": 4992547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a23fbdb4b01ea9890f7a41b3d3801af?s=128&d=identicon&r=PG&f=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/4992547/florian"}, "reply_to_user": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1434063621, "post_id": 30789741, "comment_id": 49634968, "body": "@Sarah Thanks for your answer and your patience! I added the returnString function to show what i would like to get as a return value. I didn&#39;t know that the case types must be identical so this solution can not work. I do understand now what the error message for this is. Do you mean i should add the types for pgmFile, line cell and eol?"}, {"owner": {"reputation": 41, "user_id": 4992547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a23fbdb4b01ea9890f7a41b3d3801af?s=128&d=identicon&r=PG&f=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/4992547/florian"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1434063831, "post_id": 30789741, "comment_id": 49635036, "body": "@bheklilr Thanks for your answer. I have added the type in my question at the end. I hope this helps."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1434063961, "post_id": 30789741, "comment_id": 49635077, "body": "The error you&#39;re seeing is because your case statement has two different types for its branches.  The <code>Left</code> branch runs IO actions with <code>print</code> and <code>putStrLn</code>, but the right branch just returns your <code>[[[Char]]]</code>, and that doesn&#39;t typecheck.  Try <code>Right r-&gt; print r</code> instead of just <code>Right r -&gt; r</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1434064746, "post_id": 30789741, "comment_id": 49635287, "body": "@Florian you already have it as <code>r</code>!  You just aren&#39;t using it how the compiler likes you to."}, {"owner": {"reputation": 41, "user_id": 4992547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a23fbdb4b01ea9890f7a41b3d3801af?s=128&d=identicon&r=PG&f=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/4992547/florian"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1434105699, "post_id": 30789741, "comment_id": 49650369, "body": "@bheklilr Sorry i was totally confused. Am i correct in assuming that instead of writing <code>print r</code> i could call another function with which i can process the list further?"}], "owner": {"reputation": 41, "user_id": 4992547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a23fbdb4b01ea9890f7a41b3d3801af?s=128&d=identicon&r=PG&f=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/4992547/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 314, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1434105497, "creation_date": 1434050761, "last_edit_date": 1434105497, "question_id": 30789741, "link": "https://stackoverflow.com/questions/30789741/how-to-store-the-result-of-parsec-in-a-list-in-haskell", "title": "How to store the result of parsec in a list in Haskell?", "body": "<p>This question might sound trivial but i am a Haskell beginner and i've read some tutorials for parsec but can't figure out how to store the result from a parser in a list (or in my case a list of list of string).</p>\n\n<p>Here is the code of the parser:</p>\n\n<pre><code>-- Adapted from http://book.realworldhaskell.org/read/using-parsec.html -&gt; ch16/csv9.hs and ch16/csv6.hs\nimport Text.ParserCombinators.Parsec\n\npgmFile = endBy line eol\nline = sepBy cell (char ' ')\ncell = many (noneOf \" \\n\")\n\neol =   try (string \"\\n\\r\")\n    &lt;|&gt; try (string \"\\r\\n\")\n    &lt;|&gt; string \"\\n\"\n    &lt;|&gt; string \"\\r\"\n    &lt;?&gt; \"end of line\"\n\nparsePGM :: String -&gt; Either ParseError [[String]]\nparsePGM input = parse pgmFile \"(unknown)\" input\n\nmain =\n    do c &lt;- getContents\n       case parse pgmFile \"(stdin)\" c of\n            Left e -&gt; do putStrLn \"Error parsing input:\"\n                         print e\n            Right r -&gt; mapM_ print r\n{-- /snippet all --}\n\n\nreturnString = \n    do c &lt;- getContents\n       case parse pgmFile \"(stdin)\" c of\n            Left e -&gt; do putStrLn \"Error parsing input:\"\n                         print e\n            Right r -&gt; r\n</code></pre>\n\n<p>The returnString function does not work but the main function accepts a ascii pgm file and parses it in a list of list of strings where every line is a list and the words are the content of the list.\nI want to store the resulting list in a variable to later work with it.\nSo how can i do this?  </p>\n\n<p>I am really grateful for every help i can get!</p>\n\n<hr>\n\n<p>Edit:\nThe error message for the function returnString is:</p>\n\n<pre><code>pgmCH9.hs:32:24:\n    Couldn't match type \u2018[]\u2019 with \u2018IO\u2019\n    Expected type: IO ()\n      Actual type: [[[Char]]]\n    In the expression: r\n    In a case alternative: Right r -&gt; r\n</code></pre>\n\n<p>I guess this is exactly what Sarah wrote in her comment. The type in the Left and Right case must be identical. The output of the main Right case looked like the list which i want to store so that is why i tried to save it with the help of a return value.</p>\n\n<p>Here is the type of parse pgmFile \"(stdin)\":</p>\n\n<pre><code>ghci&gt; :type parse pgmFile \"(stdin)\"\nparse pgmFile \"(stdin)\" :: [Char] -&gt; Either ParseError [[[Char]]]\n</code></pre>\n\n<hr>\n\n<p>Edit2: So here is the revised code with the added content based on the comments:</p>\n\n<pre><code>-- Adapted from http://book.realworldhaskell.org/read/using-parsec.html -&gt; ch16/csv9.hs and ch16/csv6.hs\nimport Text.ParserCombinators.Parsec\nimport System.IO \n\n-- \n\n{- A PGM file contains a header witht the type, a comment, the width and height of the picture\n   and the maximum value for all pixels. The picture presists of width*height pixels, each of\n   which is seperated by a space or the end-of-line character (eol). -}\n--pgmFile :: Text.Parsec.Prim.ParsecT [Char] u Data.Functor.Identity.Identity [[[Char]]]\npgmFile = endBy line eol\n\n-- Each line contains 1 or more pixels, separated by a space\n--line :: Text.Parsec.Prim.ParsecT [Char] u Data.Functor.Identity.Identity [[Char]]\nline = sepBy pixel (char ' ')\n\n-- Each pixel contains of characters and is limited by space or a newline\n--pixel :: Text.Parsec.Prim.ParsecT [Char] u Data.Functor.Identity.Identity [Char]\npixel = many (noneOf \" \\n\")\n\n\n--eol :: Text.Parsec.Prim.ParsecT [Char] u Data.Functor.Identity.Identity String\neol =   try (string \"\\n\\r\")\n    &lt;|&gt; try (string \"\\r\\n\")\n    &lt;|&gt; string \"\\n\"\n    &lt;|&gt; string \"\\r\"\n    &lt;?&gt; \"end of line\"\n\nparsePGM :: String -&gt; Either ParseError [[String]]\nparsePGM input = parse pgmFile \"(unknown)\" input\n\nmain :: IO ()\nmain =\n    do c &lt;- getContents\n       case parse pgmFile \"(stdin)\" c of\n            Left e -&gt; do putStrLn \"Error parsing input:\"\n                         print e\n            Right r -&gt; mapM_ print r\n\nreturnString :: IO ()\nreturnString = \n    do c &lt;- readFile \"test_ascii.pgm\"\n       case parse pgmFile \"(stdin)\" c of\n            Left e -&gt; do putStrLn \"Error parsing input:\"\n                         print e\n            Right r -&gt; print r\n</code></pre>\n"}, {"tags": ["haskell", "maude-system"], "comments": [{"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 1, "creation_date": 1434031892, "post_id": 30782964, "comment_id": 49616481, "body": "Your ghc version is <i>ancient.</i> Have you tried with a fresh one? We&#39;re on 7.10 now."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 1, "creation_date": 1434034923, "post_id": 30782964, "comment_id": 49618841, "body": "@Sarah Well... GHC 6.4 was originally released 11 March 2005. So it&#39;s one decade old at this point."}, {"owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "edited": false, "score": 0, "creation_date": 1434036497, "post_id": 30782964, "comment_id": 49619970, "body": "i tried a new ghc , it is ok, just ask for one of my Virtual machine which can only use version 6.4"}, {"owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 0, "creation_date": 1434036971, "post_id": 30782964, "comment_id": 49620331, "body": "@user353573 Run a virtual machine with an OS able to run software from the current decade?"}, {"owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "edited": false, "score": 0, "creation_date": 1434039458, "post_id": 30782964, "comment_id": 49622152, "body": "current is latest version, Could not find module `Data.Graph.Inductive.Graph&#39;"}, {"owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "edited": false, "score": 0, "creation_date": 1434303637, "post_id": 30782964, "comment_id": 49709777, "body": "succeed to compile Scratch.hs, but running example in the directory of hets, got error"}], "owner": {"reputation": 127, "user_id": 353573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c615d56712fd3ed88d404e99c997607?s=128&d=identicon&r=PG", "display_name": "user353573", "link": "https://stackoverflow.com/users/353573/user353573"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1434305246, "creation_date": 1434031148, "last_edit_date": 1434305246, "question_id": 30782964, "link": "https://stackoverflow.com/questions/30782964/what-is-the-goal-and-output-of-process-in-scratch-hs-and-running-example-such-as", "title": "what is the goal and output of process in Scratch.hs and running example such as BasicSpec.casl got error with Scratch", "body": "<p><strong>update1</strong></p>\n\n<ol>\n<li><p>i have to cabal install maude in order to use rewrite, if not import maude, how can het tools's haskell code use rewrite and reduce in its haskell code?</p></li>\n<li><p>how to prove the logic with algebraic spec input file or default system\nand logic string as parameters to return output into console ? is there examples for this and do all these in Scratch?</p></li>\n<li><p>Moreover would like to read Owl file in Scratch and do inference in Scratch, is there example for this?</p></li>\n</ol>\n\n<p><a href=\"https://github.com/spechub/Hets/blob/master/Scratch.hs\" rel=\"nofollow\">https://github.com/spechub/Hets/blob/master/Scratch.hs</a></p>\n\n<p><strong>update2</strong>\nsucceed to run first example RelationAndOrders.casl, however, what is the goal and output of process in Scratch.hs</p>\n\n<pre><code>martin@ubuntu:~/Downloads/Hets-master$ sudo cp Scratch /usr/lib/hets/hets-lib/Basic/Scratch\nmartin@ubuntu:~/Downloads/Hets-master$ cd /usr/lib/hets/hets-lib/Basic\nmartin@ubuntu:/usr/lib/hets/hets-lib/Basic$ ./Scratch RelationsAndOrders.casl \n### file name 'RelationsAndOrders.casl' does not match library name 'Basic/RelationsAndOrders'\nAnalyzing library Basic/RelationsAndOrders version 1.0\nDownloading Basic/Numbers ...\nAnalyzing library Basic/Numbers version 1.0\nAnalyzing spec Basic/Numbers?Nat\nAnalyzing spec Basic/Numbers?Int\nAnalyzing spec Basic/Numbers?Rat\nAnalyzing spec Basic/Numbers?DecimalFraction\n... loaded Basic/Numbers\nAnalyzing spec Basic/RelationsAndOrders?Relation\nAnalyzing spec Basic/RelationsAndOrders?ReflexiveRelation\nAnalyzing spec Basic/RelationsAndOrders?IrreflexiveRelation\nAnalyzing spec Basic/RelationsAndOrders?SymmetricRelation\nAnalyzing spec Basic/RelationsAndOrders?AsymmetricRelation\nAnalyzing spec Basic/RelationsAndOrders?AntisymmetricRelation\nAnalyzing spec Basic/RelationsAndOrders?TransitiveRelation\nAnalyzing spec Basic/RelationsAndOrders?SimilarityRelation\nAnalyzing spec Basic/RelationsAndOrders?PartialEquivalenceRelation\nAnalyzing spec Basic/RelationsAndOrders?EquivalenceRelation\nAnalyzing spec Basic/RelationsAndOrders?PreOrder\nAnalyzing spec Basic/RelationsAndOrders?StrictOrder\nAnalyzing spec Basic/RelationsAndOrders?PartialOrder\nAnalyzing spec Basic/RelationsAndOrders?TotalOrder\nAnalyzing spec Basic/RelationsAndOrders?StrictTotalOrder\nAnalyzing spec Basic/RelationsAndOrders?RightUniqueRelation\nAnalyzing spec Basic/RelationsAndOrders?LeftTotalRelation\nAnalyzing spec Basic/RelationsAndOrders?BooleanAlgebra\nAnalyzing spec Basic/RelationsAndOrders?ExtPartialOrder\nAnalyzing spec Basic/RelationsAndOrders?ExtTotalOrder\nAnalyzing spec Basic/RelationsAndOrders?ExtBooleanAlgebra\nAnalyzing spec Basic/RelationsAndOrders?RichPartialOrder\nAnalyzing spec Basic/RelationsAndOrders?RichTotalOrder\nAnalyzing spec Basic/RelationsAndOrders?RichBooleanAlgebra\nAnalyzing view Basic/RelationsAndOrders?TotalOrder_in_Nat\nAnalyzing view Basic/RelationsAndOrders?TotalOrder_in_Int\nAnalyzing view Basic/RelationsAndOrders?TotalOrder_in_Rat\nAnalyzing view Basic/RelationsAndOrders?PartialOrder_in_ExtBooleanAlgebra\n</code></pre>\n\n<p><strong>update3</strong></p>\n\n<p>when running  BasicSpec.casl</p>\n\n<pre><code>martin@ubuntu:~/Downloads/Hets-master/CASL/test$ ./Scratch BasicSpec.casl\nAnalyzing file BasicSpec.casl as library BasicSpec\nAnalyzing spec BasicSpec?BasicSpec\n\nunexpected mixfix token: 252\n/home/martin/Downloads/Hets-master/CASL/test/BasicSpec.casl:710.31:\n*** Error:\nmissing %number annotation\n/home/martin/Downloads/Hets-master/CASL/test/BasicSpec.casl:710.31:\n*** Error:\nunexpected mixfix token: 253\n/home/martin/Downloads/Hets-master/CASL/test/BasicSpec.casl:711.31:\n*** Error:\nmissing %number annotation\n/home/martin/Downloads/Hets-master/CASL/test/BasicSpec.casl:711.31:\n*** Error:\nunexpected mixfix token: 254\n/home/martin/Downloads/Hets-master/CASL/test/BasicSpec.casl:712.31:\n*** Error:\nmissing %number annotation\n/home/martin/Downloads/Hets-master/CASL/test/BasicSpec.casl:712.31:\n*** Error:\nunexpected mixfix token: 255\nScratch: user error (Stopped due to errors)\n</code></pre>\n"}, {"tags": ["haskell", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1434047370, "post_id": 30785158, "comment_id": 49626942, "body": "Would Rich Eisen&#39;s stated goals with his dependent GHC project also meet your goals?"}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 5, "last_activity_date": 1434036646, "creation_date": 1434036646, "answer_id": 30785158, "question_id": 30781891, "link": "https://stackoverflow.com/questions/30781891/constructor-that-lifts-via-datakinds-to-a/30785158#30785158", "title": "Constructor that lifts (via DataKinds) to * -&gt; A", "body": "<p>At the moment, I'm afraid not. I haven't spotted an obvious workaround, either.</p>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/ticket/6024\">This ticket</a> documents the prospects for the declaration of data kinds, born kind, rather than being data types with kindness thrust upon them. It would be entirely reasonable for the constructors of such things to pack up types as you propose. We're not there yet, but it doesn't look all that problematic.</p>\n\n<p>My eyes are on a greater prize. I would like * to be perfectly sensible type of runtime values, so that the kind you want could exist by promotion as we have it today. Combine that with the mooted notion of <code>pi</code>-type (non-parametric abstraction over the portion of the language that's effectively shared by types and values) and we might get a more direct way to make ad hoc type abstractions than we have with <code>Data.Typeable</code>. The usual <code>forall</code> would remain parametric.</p>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 7, "last_activity_date": 1434044037, "creation_date": 1434044037, "answer_id": 30787627, "question_id": 30781891, "link": "https://stackoverflow.com/questions/30781891/constructor-that-lifts-via-datakinds-to-a/30787627#30787627", "title": "Constructor that lifts (via DataKinds) to * -&gt; A", "body": "<p>As Conor states, this is not directly possible. You can, however, define </p>\n\n<pre><code>data K a = ... | C a\n</code></pre>\n\n<p>Then this promotes to</p>\n\n<pre><code>C :: a -&gt; K a\n</code></pre>\n\n<p>If you then use <code>K *</code>, you can achieve what you want. </p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 30787627, "answer_count": 2, "score": 9, "last_activity_date": 1434044037, "creation_date": 1434028508, "question_id": 30781891, "link": "https://stackoverflow.com/questions/30781891/constructor-that-lifts-via-datakinds-to-a", "title": "Constructor that lifts (via DataKinds) to * -&gt; A", "body": "<p>Given an ADT like</p>\n\n<pre><code>data K = A | B Bool\n</code></pre>\n\n<p>the <code>DataKinds</code> extension allows us to lift it into kinds and types/type constructors</p>\n\n<pre><code>K :: BOX\n'A :: K\n'B :: 'Bool -&gt; K\n</code></pre>\n\n<p>Is there a way to add a constructor to <code>K</code> that lifts to the type constructor</p>\n\n<pre><code>'C :: * -&gt; K\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1434007212, "post_id": 30773835, "comment_id": 49598796, "body": "Now a whole lot of other compilation errors rise, but at least they seem to be a bit more detailed."}], "tags": [], "owner": {"reputation": 14704, "user_id": 908515, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f1L9v.png?s=128&g=1", "display_name": "undur_gongor", "link": "https://stackoverflow.com/users/908515/undur-gongor"}, "is_accepted": true, "score": 5, "last_activity_date": 1434006240, "creation_date": 1434006240, "answer_id": 30773835, "question_id": 30773395, "link": "https://stackoverflow.com/questions/30773395/haskell-list-comprehension-compilation-error/30773835#30773835", "title": "Haskell list comprehension compilation error", "body": "<p>The comprehension syntax is </p>\n\n<pre><code>[ &lt;expression&gt; | ... ]\n</code></pre>\n\n<p>For <code>&lt;expression&gt;</code> you have <code>([x,z], i:j:s, j), b</code> which is syntactically wrong. Did you mean <code>([x,z], i:j:s, b)</code>?</p>\n"}], "owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 30773835, "answer_count": 1, "score": 2, "last_activity_date": 1434008551, "creation_date": 1434004724, "last_edit_date": 1434008551, "question_id": 30773395, "link": "https://stackoverflow.com/questions/30773395/haskell-list-comprehension-compilation-error", "title": "Haskell list comprehension compilation error", "body": "<p>I want to create a function that given two lists (of floats, but could be anything) gives a list with all the combinations of taking two elements from the first list and putting it in the last and all the combinations of the former putting one of the elements from the last (now with more elements) and putting it back on the first. </p>\n\n<p>For every movement it also gives the greatest value that moved (in the second movement only one moves, that is the value). It should all end when the first list is empty (there would be no second movement).</p>\n\n<p>I can't expect anyone to understand that so, examples:</p>\n\n<pre><code>next [1,2,3,4] [] -&gt; [(([1,2], [3,4], 4), ([1,2,3],[4],3)), (([1,2], [3,4], 4), ([1,2,4],[3],4)), (([1,3], [2,4], 4), ([1,2,3],[4],2)), (([1,3], [2,4], 4), ([1,3,4],[2],4)).....\nnext [1,2] [3,4]  -&gt; [(([], [1,2,3,4],2),)], ())\n</code></pre>\n\n<p>What I have so far:</p>\n\n<pre><code>module Test where \n\nnext :: [Float] -&gt; [Float] -&gt; [(([Float],[Float], Float),([Float],[Float], Float))]\nnext [] _               = []\nnext (a:b:[]) s     \n    |a&gt;b                = [([],a:b:s, a)]\n    |otherwise          = [([],a:b:s, b)]\nnext d s                = [([x,z], i:j:s, j), b | i &lt;- d, j &lt;- d, i &lt; j, x &lt;- d, z &lt;- d, x &lt; z, z /= i, z /= j, x /= z, x /= i, x /= j, b &lt;- (back [x,z] i:j:s)]\n    where\n        back d s        = [(i:d, [x,z], i) | i &lt;- s, x &lt;- s, z &lt;- s, x &lt; z, z /= i, x /= z]\n</code></pre>\n\n<p>Compiling that code gives back an error on the first comprehension list at the <code>|</code> character. I'd kind of understand an error in the <code>back</code> function. Why won't that compile?</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "edited": false, "score": 0, "creation_date": 1434000093, "post_id": 30772166, "comment_id": 49595427, "body": "By the way, I&#39;m not fluent with the relevant terminology. I did the best I could with the question title, but edits are welcome."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1434002089, "post_id": 30772166, "comment_id": 49596189, "body": "a short search revealed a package: <a href=\"https://hackage.haskell.org/package/game-tree\" rel=\"nofollow noreferrer\">game-tree</a> - maybe you can make some use of it (or at least have a look at the design)"}, {"owner": {"reputation": 1747, "user_id": 215381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4ab17df223036dd5a9e9e93696a76525?s=128&d=identicon&r=PG", "display_name": "sigrlami", "link": "https://stackoverflow.com/users/215381/sigrlami"}, "edited": false, "score": 0, "creation_date": 1434004853, "post_id": 30772166, "comment_id": 49597486, "body": "You could use kinds <a href=\"https://wiki.haskell.org/Kind\" rel=\"nofollow noreferrer\">wiki.haskell.org/Kind</a>"}, {"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "edited": false, "score": 0, "creation_date": 1434029692, "post_id": 30772166, "comment_id": 49614626, "body": "A short read revealed that game-tree&#39;s types aren&#39;t nearly as cool as my types. :) But yeah, maybe I should use it anyway. I&#39;ll see! Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "edited": false, "score": 0, "creation_date": 1434027635, "post_id": 30774356, "comment_id": 49613006, "body": "Thanks! I hadn&#39;t thought of moving <code>GameMove</code> into the class like that. I was also hung up on Minimaxable knowing about <code>Game</code> so that <code>alphabeta</code> could see whose turn it was with pattern matching, but adding <code>whoseTurn :: g t -&gt; MoveTag</code> worked as well."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 1, "last_activity_date": 1434007783, "creation_date": 1434007783, "answer_id": 30774356, "question_id": 30772166, "link": "https://stackoverflow.com/questions/30772166/can-i-generalize-gadts-that-use-type-tags/30774356#30774356", "title": "Can I generalize GADTs that use type tags?", "body": "<p>It depends on what you mean by being able to plug in \"any game\". Is every game going to have a <code>MoveTag</code> denoting whose turn it is? If so, then you can give <code>g</code> a kind signature and define the type class as</p>\n\n<pre><code>class Minimaxable (g :: MoveTag -&gt; *) where\n    type GameMove g :: MoveTag -&gt; *\n\n    staticEvaluator :: Num f =&gt; g t -&gt; f\n    nextGameStates :: g t -&gt; [(GameMove g t, g (NextMoveTag t))]\n</code></pre>\n\n<p>The <code>Move</code> type is plugged in as an associated type synonym as it will probably vary between different types of games.</p>\n\n<p>Now you can define an instance for your existing game type as</p>\n\n<pre><code>instance Minimaxable Game where\n    type GameMove Game = Move\n\n    staticEvaluator = ...\n    nextGameStates  = ...\n</code></pre>\n"}], "owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 30774356, "answer_count": 1, "score": 3, "last_activity_date": 1434007783, "creation_date": 1434000049, "last_edit_date": 1434000678, "question_id": 30772166, "link": "https://stackoverflow.com/questions/30772166/can-i-generalize-gadts-that-use-type-tags", "title": "Can I generalize GADTs that use type tags?", "body": "<p>I wrote an alpha-beta search in Haskell that uses the <code>NextMoveTag</code> type family to ensure that the game state and moves generated from that game state are valid for the player whose turn it is:</p>\n\n<pre><code>{-# LANGUAGE GADTs, EmptyDataDecls, DataKinds, TypeFamilies #-}\n\ndata MoveTag = ComputerMoveTag | PlayerMoveTag\ntype family NextMoveTag a where\n    NextMoveTag PlayerMoveTag = ComputerMoveTag\n    NextMoveTag ComputerMoveTag = PlayerMoveTag\n\ndata Move (t :: MoveTag) where\n    ComputerMove :: CardFace -&gt; Row -&gt; Col -&gt; Move ComputerMoveTag\n    PlayerMove :: Direction -&gt; Move PlayerMoveTag\n\ndata Game (t :: MoveTag) where\n    PlayerTurnGame :: Board -&gt; Deck -&gt; Game PlayerMoveTag\n    ComputerTurnGame :: Board -&gt; Deck -&gt; Move PlayerMoveTag -&gt; Game ComputerMoveTag\n\nstaticEvaluator :: (Num f) =&gt; Game t -&gt; f\nnextGameStates :: Game t -&gt; [(Move t, Game (NextMoveTag t))]\n</code></pre>\n\n<p>Now I would like to generalize the code so that I can plug in any game, i.e.</p>\n\n<pre><code>class Minimaxable g where\n    staticEvaluator :: ???\n    nextGameStates :: ???\n</code></pre>\n\n<p>But how do I write the types? Can I?</p>\n\n<p>A problem I run into when I try to write this is that the first step of <code>alphabeta</code> is to check whose turn it is by pattern-matching on <code>g</code>:</p>\n\n<pre><code>alphabeta depth alpha beta game@(PlayerTurnGame _ _) = ...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1433997373, "post_id": 30771071, "comment_id": 49594574, "body": "I know you said you didn&#39;t want suggestions for other algorithms, but that&#39;s tough. I&#39;ll suggest merge sort, which is particularly pretty in Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 6, "last_activity_date": 1433993860, "creation_date": 1433993860, "answer_id": 30771124, "question_id": 30771071, "link": "https://stackoverflow.com/questions/30771071/haskell-beginner-my-simple-sort/30771124#30771124", "title": "haskell beginner - my simple sort", "body": "<p>The problem is you are only considering the same pairs of element on each pass.  Consider:</p>\n\n<pre><code>swap (a:b:t) | a &lt;= b = a : b : (swap t)\nswap (a:b:t) | b &lt;  a = b : a : (swap t)\n</code></pre>\n\n<p>What if we have a list <code>[4,1,1,1]</code>?</p>\n\n<pre><code>swap [4,1,1,1] = 1 : 4 : swap [1,1] = 1:4:1:1:[]\n</code></pre>\n\n<p>Ok, now lets look at the next iteration of <code>sortN</code> and its call to <code>swap</code>:</p>\n\n<pre><code>swap [1,4,1,1] = 1 : 4 : swap [1,1]\n</code></pre>\n\n<p>So you see, <code>swap</code> implicitly assumes every pair of elements is ordered within the list.  Instead consider the implementation <code>a: swap (b:t)</code> and <code>b : swap (a : t)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1433998658, "last_edit_date": 1433998658, "creation_date": 1433997442, "answer_id": 30771667, "question_id": 30771071, "link": "https://stackoverflow.com/questions/30771071/haskell-beginner-my-simple-sort/30771667#30771667", "title": "haskell beginner - my simple sort", "body": "<p>Let me offer you a working version (there was the one-element case missing from <code>swap</code> so as far as I see you will run into trouble else:</p>\n\n<pre><code>swap []  = []\nswap [a] = [a]\nswap (a:b:t)\n  | a &lt;= b    = a : swap (b:t)\n  | otherwise = b : swap (a:t)\n</code></pre>\n\n<p>I will not be tempted into giving you a different algorithm but still you don't need to run <code>swap xs</code> <code>length xs</code> times - you just have to run it till the output is not changing anymore:</p>\n\n<pre><code>sort :: Ord a =&gt; [a] -&gt; [a]\nsort = fix swap\n\nswap :: Ord a =&gt; [a] -&gt; [a]\nswap []  = []\nswap [a] = [a]\nswap (a:b:t)\n  | a &lt;= b    = a : swap (b:t)\n  | otherwise = b : swap (a:t)\n\nfix :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nfix f x = let x' = f x\n          in if x' /= x then fix f x' else x\n</code></pre>\n\n<p><code>fix</code> here will do exactly that - it applies <code>f</code> to <code>x</code> till the result is not changing anymore.</p>\n\n<p>for example:</p>\n\n<ul>\n<li><code>sort [3,6,1,3,2]</code> will call <code>swap</code> only 4 times</li>\n<li><code>sort [1..10]</code> it will be called only once</li>\n</ul>\n\n<hr>\n\n<h2>testing your implementations</h2>\n\n<p>maybe you are interested in how you can easily check your implementations - here is a QuickCheck test (I used to verify my solution too) that does this:</p>\n\n<pre><code>import Test.QuickCheck\n\nisSorted :: Ord a =&gt; [a] -&gt; Bool\nisSorted []  = True\nisSorted [_] = True\nisSorted (a:b:t) = a&lt;=b &amp;&amp; isSorted (b:t)\n\ncheckSortAlg :: ([Int] -&gt; [Int]) -&gt; IO ()\ncheckSortAlg sortAlg = quickCheck test\n  where\n    test xs = isSorted $ sortAlg xs\n</code></pre>\n\n<p>you just have to run it like this (for example in ghci):</p>\n\n<pre><code>checkSortAlg sort\n</code></pre>\n\n<p>it should print <code>+++ OK, passed 100 tests.</code></p>\n\n<p>here is what it does for for the version with the missing <code>swap [a] = [a]</code> case:</p>\n\n<pre><code>(after 3 tests and 1 shrink): \nException:\n  SimpleSort.hs:(9,1)-(12,30): Non-exhaustive patterns in function swap\n[0]\n</code></pre>\n\n<p>this tells you that after 3 tests it used some list that after shrinking to <code>[0]</code> still threw the <code>Non-exhaustive patterns</code> exception - so it basically tells you to look for the single element case here ;) - of course the compiler should have too</p>\n"}], "owner": {"reputation": 67, "user_id": 2402161, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/23b038127e91de0206abb477cf1f3c11?s=128&d=identicon&r=PG", "display_name": "Tedd Parsile", "link": "https://stackoverflow.com/users/2402161/tedd-parsile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 30771124, "answer_count": 2, "score": 0, "last_activity_date": 1433998658, "creation_date": 1433993503, "question_id": 30771071, "link": "https://stackoverflow.com/questions/30771071/haskell-beginner-my-simple-sort", "title": "haskell beginner - my simple sort", "body": "<p>I have this code for sorting list of even number of items:</p>\n\n<pre><code>sort [] = []\nsort l = sortN l (length l)\n\nsortN l 0 = l\nsortN l n = sortN (swap l) (n - 1)\n\nswap [] = []\nswap (a:b:t) | a &lt;= b = a : b : (swap t)\nswap (a:b:t) | b &lt;  a = b : a : (swap t)\n</code></pre>\n\n<p>and I am stuck. For some reason, which I don't understand it returns results as if only one swap was always called.</p>\n\n<p>Also, please do not post here better and more efficient ways how to sort. I am aware of them. I want to know why this is wrong, not other solutions.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "compilation", "ghc", "read-eval-print-loop", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1433990923, "creation_date": 1433990923, "answer_id": 30770715, "question_id": 30770361, "link": "https://stackoverflow.com/questions/30770361/within-a-project-can-i-compile-a-module-and-interactively-load-the-compiled-modu/30770715#30770715", "title": "within a project can I compile a module and interactively load the compiled module within ghci?", "body": "<p>Yes, you can load compiled modules in ghci; if there is an appropriately named <code>.hi</code> and <code>.o</code> file, ghci will use those instead of interpreting the code in the corresponding <code>.hs</code> file. You will then only have access to the operations that are exported from that module.</p>\n\n<p>In case you find yourself using a compiled loaded module when you wanted the interpreted one, you can <code>:load *foo.hs</code> to instruct ghci to ignore the compiled version and interpret <code>foo.hs</code>.</p>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 30770715, "answer_count": 1, "score": 3, "last_activity_date": 1433996754, "creation_date": 1433988240, "last_edit_date": 1433996754, "question_id": 30770361, "link": "https://stackoverflow.com/questions/30770361/within-a-project-can-i-compile-a-module-and-interactively-load-the-compiled-modu", "title": "within a project can I compile a module and interactively load the compiled module within ghci?", "body": "<p>Typically in a Haskell project, I either work interactively with ghci or compile the entire project with cabal build.</p>\n\n<p>However, in some use cases, I may have a computationally intensive routine along with some higher level scripting functionality, say for picking inputs to an analysis algorithm.</p>\n\n<p>Is it possible to use GHCi + GHC such that I compile the computationally intensive module, load the compiled code to re-run with different inputs from within GHCi?</p>\n"}]