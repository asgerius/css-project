[{"tags": ["haskell", "cabal", "cabal-install"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1528318501, "creation_date": 1528318501, "answer_id": 50729449, "question_id": 50729015, "link": "https://stackoverflow.com/questions/50729015/upgrade-package-dependencies-using-cabal/50729449#50729449", "title": "Upgrade package dependencies using Cabal", "body": "<p>You could use <code>cabal new-build</code> and if you only want to upgrade <em>most</em> dependencies then freeze the few you wish to hold constant in a cabal.project.freeze file.</p>\n\n<pre><code>cat &lt;&lt;EOF &gt;cabal.project.freeze\nconstraints: template-haskell == 2.13.0.0\nEOF\n</code></pre>\n\n<p>And</p>\n\n<pre><code>cabal update\n# Perhaps rm -rf dist-newstyle if you want a completely fresh build\ncabal new-build --upgrade-dependencies\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 1, "last_activity_date": 1528385382, "last_edit_date": 1528385382, "creation_date": 1528374672, "answer_id": 50741308, "question_id": 50729015, "link": "https://stackoverflow.com/questions/50729015/upgrade-package-dependencies-using-cabal/50741308#50741308", "title": "Upgrade package dependencies using Cabal", "body": "<p>Upgrade to Cabal 2.0.0.0 or above.</p>\n\n<p>From Cabal 2.0.0.0 it no longer upgrades <code>template-haskell</code>, as per <a href=\"https://github.com/haskell/cabal/blob/898fcc230fb537064f0992cfffb5955b6bc36d34/cabal-install/changelog#L121\" rel=\"nofollow noreferrer\">the changelog</a>:</p>\n\n<blockquote>\n  <ul>\n  <li>Made the 'template-haskell' package non-upgradable again (<a href=\"https://github.com/haskell/cabal/pull/4185\" rel=\"nofollow noreferrer\">#4185</a>).</li>\n  </ul>\n</blockquote>\n\n<p>So <code>--upgrade-dependencies --force-reinstalls</code> works with newer versions.</p>\n"}], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 593, "favorite_count": 0, "accepted_answer_id": 50741308, "answer_count": 2, "score": 3, "last_activity_date": 1528385382, "creation_date": 1528316772, "question_id": 50729015, "link": "https://stackoverflow.com/questions/50729015/upgrade-package-dependencies-using-cabal", "title": "Upgrade package dependencies using Cabal", "body": "<p>I have <a href=\"https://github.com/ndmitchell/hoogle/blob/3ebeabe624a2d766cff5b128146471fe99a91eba/misc/Upgrade.hs\" rel=\"nofollow noreferrer\">a script</a> that deploys a Haskell program once a day. It currently does:</p>\n\n<pre><code>cabal update\ncabal install --only-dependencies\ncabal configure\ncabal build\n</code></pre>\n\n<p>Which ensures it has the latest package index list, upgrades any dependency whose lower bound in the <code>project.cabal</code> has changed, and builds the code.</p>\n\n<p>However, I'd really like to upgrade any dependency that has a new suitable version.</p>\n\n<ul>\n<li>I tried adding <code>--upgrade-dependencies</code> but that refused to upgrade anything because it would break existing packages.</li>\n<li>I tried combining that with <code>--force-reinstalls</code>, but it installed a new version of <code>template-haskell</code> (not a good idea) and things like <code>QuickCheck</code> would no longer compile.</li>\n</ul>\n\n<p>What is the right way to upgrade packages automatically?</p>\n"}, {"tags": ["haskell", "criterion"], "comments": [{"owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "edited": false, "score": 0, "creation_date": 1528309137, "post_id": 50726837, "comment_id": 88462295, "body": "How is the list obtained from the environment? Will you know its length statically?"}, {"owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "reply_to_user": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "edited": false, "score": 1, "creation_date": 1528309637, "post_id": 50726837, "comment_id": 88462545, "body": "@oisdk In practice, I will be using numbers I know myself at compile-time. Think of this: [100, 1000, 10000, 1000000] My goal is to do a &quot;big O&quot; benchmark. (Feel free to suggest better ways of doing &quot;big O&quot; analysis, if you know of any.)"}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1528310848, "last_edit_date": 1528310848, "creation_date": 1528310430, "answer_id": 50727400, "question_id": 50726837, "link": "https://stackoverflow.com/questions/50726837/creating-multiple-criterion-benchmarks-at-once/50727400#50727400", "title": "Creating multiple Criterion Benchmarks at once", "body": "<p><code>env</code> is very picky with strictness. You can't use it here. The structure of the benchmarks created under <code>env</code> cannot depend on the environment. That is, the environment can be used by the code that <em>is being benchmarked</em>, but the way the <em>benchmarks</em> themselves are organized, named, etc. cannot use it. This is because <code>criterion</code> will sometimes pass <code>_|_</code> instead of the real environment, when it wants to just inspect the structure of the benchmarks without executing them. When you use <code>!!</code>, the organization of the benchmarks is given by hand, and is intact even when <code>is = _|_</code>:</p>\n\n<pre><code>benchmarks _|_ = [ bench \"foo\" $ nf timesTwo _|_ -- _|_ !! n = _|_; nf is not strict\n                 , bench \"foo\" $ nf timesTwo _|_ ] -- \"bench\"s are still there\n</code></pre>\n\n<p>But <code>map</code> breaks this:</p>\n\n<pre><code>benchmarks _|_ = map _etc _|_\n               = case _|_ of -- definition of map\n                      [] -&gt; []\n                      x:xs -&gt; _etc x : map _etc xs\n               = _|_ -- benchmark structure gone\n</code></pre>\n\n<p>Your best bet is just not using <code>env</code>:</p>\n\n<pre><code>main = do is &lt;- _ -- however you calculate is\n          defaultMain $ bgroup \"group\" $ benchmark is\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "is_accepted": true, "score": 2, "last_activity_date": 1528327548, "creation_date": 1528327548, "answer_id": 50730987, "question_id": 50726837, "link": "https://stackoverflow.com/questions/50726837/creating-multiple-criterion-benchmarks-at-once/50730987#50730987", "title": "Creating multiple Criterion Benchmarks at once", "body": "<p>For benchmarking at different sizes, I usually do something like this:</p>\n\n<pre><code>module Main (main) where\n\nimport Criterion.Main\nimport System.Random\nimport Control.Monad\n\nimport qualified Data.List\nimport qualified Data.Sequence\n\nint :: Int -&gt; IO Int\nint n = randomRIO (0,n)\n\nbenchAtSize :: Int -&gt; Benchmark\nbenchAtSize n =\n    env (replicateM n (int n)) $\n    \\xs -&gt;\n         bgroup (show n)\n           [ bench \"Data.List\"     $ nf Data.List.sort xs\n           , bench \"Data.Sequence\" $ nf (Data.Sequence.sort . Data.Sequence.fromList) xs\n           ]\n\nmain :: IO ()\nmain = defaultMain (map benchAtSize [100, 1000, 10000])\n</code></pre>\n\n<p><code>env</code> is useful for ensuring that two different functions are compared on the same sample, and it's not designed to compute your whole dataset before running the benchmarks. Also, because all of the data created by <code>env</code> is kept in memory during the benchmarking of anything in its scope, you want to minimize it as much as is possible, to reduce overhead while benchmarking.</p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 1, "accepted_answer_id": 50730987, "answer_count": 2, "score": 3, "last_activity_date": 1528327548, "creation_date": 1528308252, "last_edit_date": 1528308955, "question_id": 50726837, "link": "https://stackoverflow.com/questions/50726837/creating-multiple-criterion-benchmarks-at-once", "title": "Creating multiple Criterion Benchmarks at once", "body": "<p>This code compiles and runs without problems:</p>\n\n<pre><code>module Main where\n\nimport Criterion.Main\n\nmain :: IO ()\nmain =\n  defaultMain\n    [env (return $ [1,2])\n         (\\is -&gt;\n            bgroup \"group\" (benchmarks is))]\n\ntimesTwo :: Int -&gt; Int\ntimesTwo i = 2 * i\n\nbenchmarks :: [Int] -&gt; [Benchmark]\nbenchmarks is = [ bench \"foo\" $ nf timesTwo (is !! 0)\n                , bench \"foo\" $ nf timesTwo (is !! 1) ]\n</code></pre>\n\n<p>Yet if I change the <code>benchmarks</code> function to look like</p>\n\n<pre><code>benchmarks :: [Int] -&gt; [Benchmark]\nbenchmarks is = map (\\i -&gt; bench \"foo\" $ nf timesTwo i) is\n</code></pre>\n\n<p>it still compiles but I get this runtime error:</p>\n\n<pre><code>ghci&gt; main\n*** Exception: Criterion atttempted to retrieve a non-existent environment!\n        Perhaps you forgot to use lazy pattern matching in a function which\n        constructs benchmarks from an environment?\n        (see the documentation for `env` for details)\n</code></pre>\n\n<p>How do I resolve this?</p>\n\n<p>As you can see, <strong>my goal is to map over a list from obtained from the environment in order to turn it into a list of <code>Benchmark</code>s</strong> that I can use with Criterion.</p>\n\n<p>Note: I eventually want to use way more elements than just two, so tuples are not what I want here.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "edited": false, "score": 0, "creation_date": 1528315748, "post_id": 50724898, "comment_id": 88465444, "body": "i have changed the type signature to: <code>getVal :: (MonadHandler m, HandlerSite m ~ master) =&gt; Text -&gt; m Bool</code> and it works, however, the session data is returning <code>Nothing</code> :("}, {"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "edited": false, "score": 0, "creation_date": 1528324553, "post_id": 50724898, "comment_id": 88468772, "body": "this signature also works: <code>getVal :: Yesod master =&gt; Text -&gt; (HandlerT master IO) Bool</code>. But still the <code>lookupSession</code> value returns <code>Nothing</code>"}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1528326358, "post_id": 50724898, "comment_id": 88469316, "body": "have you tried <code>liftSubHandler</code>? since a sub site is an extra layer to a regular handler. <a href=\"https://www.stackage.org/haddock/lts-11.12/yesod-core-1.6.5/Yesod-Core.html#v:liftSubHandler\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-11.12/yesod-core-1.6.5/&hellip;</a>"}, {"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "reply_to_user": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1528327506, "post_id": 50724898, "comment_id": 88469624, "body": "hmmm... im using <code>yesod &gt;=1.4.3 &amp;&amp; &lt;1.5</code> and <code>yesod-core &gt;=1.4.30 &amp;&amp; &lt;1.5</code> and <code>liftSubHandler</code> is not in scope @sbditto85"}, {"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "reply_to_user": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1528379350, "post_id": 50724898, "comment_id": 88493428, "body": "Problem Closed. I worked around the problem with an alternative solution."}], "owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1528305561, "creation_date": 1528301149, "last_edit_date": 1528305561, "question_id": 50724898, "link": "https://stackoverflow.com/questions/50724898/yesod-subsite-function-handler", "title": "Yesod Subsite Function Handler", "body": "<p>I have an exposed function (a simple function with one Text argument, that performs IO operations and then returns a bool) in my subsite. But every time i call it from my main site <code>boolVal &lt;- Sub.getVal \"abc\"</code> it throws the following error:</p>\n\n<pre><code>Couldn't match type \u2018Sub\u2019 with \u2018App\u2019\nExpected type: HandlerT App IO Bool \nActual type: HandlerT Sub (HandlerT master0 IO) Bool\n</code></pre>\n\n<p>subsite code snippet</p>\n\n<pre><code>type SubHandler a = forall master. Yesod master =&gt; HandlerT Sub (HandlerT \nmaster IO) a\n\ngetVal :: Text -&gt; SubHandler Bool\ngetVal name = do\n    -- some operations including IO\n    return False\n</code></pre>\n\n<p>main site code snippet</p>\n\n<pre><code>import Sub\n\ngetHomeR :: Handler Html\ngetHomeR = do\n    boolVal &lt;- Sub.getVal \"abc\"\n    defaultLayout $ do\n        $(widgetFile \"home/index\")\n</code></pre>\n\n<p>The subsite routes are working fine and i foolishly presumed the SubHandler would have registered with the main App, magically, like most things in haskell ha</p>\n\n<p>thank you</p>\n\n<p>FYI i would really appreciate a technical answer to this, and not just \"the types don't match\", albeit my understanding of classes and instances declarations is not all that great atm - work in progress :)</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1528455264, "post_id": 50724825, "comment_id": 88525450, "body": "It&#39;s great that you post this here, but strictly speaking this doesn&#39;t conform with SO policy because only the external code examples answer the question. I think you should embed the crucial rules in the post."}, {"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528456655, "post_id": 50724825, "comment_id": 88526253, "body": "Thanks @leftaroundabout - I expanded the answers so now the bullet points completely answer the question in enough detail - which is probably way more useful. The code is still linked, but it&#39;s not the answer, and it&#39;s mostly so people who understand the answer can copy it more easily. I don&#39;t want to reproduce the full code in SO since it detracts from the understanding of the answer."}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 9, "last_activity_date": 1528456538, "last_edit_date": 1528456538, "creation_date": 1528300907, "answer_id": 50724825, "question_id": 50724824, "link": "https://stackoverflow.com/questions/50724824/how-do-i-compile-haskell-programs-using-shake/50724825#50724825", "title": "How do I compile Haskell programs using Shake", "body": "<p>There are two approaches to doing the compilation, and two approaches to getting the dependencies. You need to pick one from each set (all 4 combinations make sense), to come up with a combined approach.</p>\n\n<p><strong>Compilation</strong></p>\n\n<p>You can either:</p>\n\n<ul>\n<li>Call <code>ghc -c</code> on each file in turn, depending on the <code>.hs</code> file and any <code>.hi</code> files it transitively imports, generating both a <code>.hi</code> and <code>.o</code> file. At the end, call <code>ghc -o</code> depending on all the <code>.o</code> files. For actual code <a href=\"https://github.com/ndmitchell/shake/blob/dd6a446626f67ee053232cef979d5bdcf4a3663a/src/Test/Self.hs\" rel=\"nofollow noreferrer\">see this example</a>.</li>\n<li><em>OR</em> Call <code>ghc --make</code> once, depending on all <code>.hs</code> files. For actual code <a href=\"https://github.com/ndmitchell/shake/blob/dd6a446626f67ee053232cef979d5bdcf4a3663a/src/Test/SelfMake.hs\" rel=\"nofollow noreferrer\">see this example</a>.</li>\n</ul>\n\n<p>The advantage of <code>ghc --make</code> is that it is faster than multiple calls to <code>ghc -c</code> since GHC can load each <code>.hi</code> file only once, instead of once per command. Typically the speedup is 3x. The disadvantage is parallelism is harder (you can use <code>-j</code> to <code>ghc --make</code>, but Shake still assumes each action consumes one CPU), and that two <code>ghc --make</code> compilations can't both run at the same time if they overlap on any dependencies.</p>\n\n<p><strong>Dependencies</strong></p>\n\n<p>You can either:</p>\n\n<ul>\n<li>Parse the Haskell files to find dependencies recursively. To parse a file you can either look for <code>import</code> statements (and perhaps <code>#include</code> statements) following a coding convention, or use a library such as <a href=\"https://hackage.haskell.org/package/haskell-src-exts\" rel=\"nofollow noreferrer\"><code>haskell-src-exts</code></a>. For actual code with a very approximate <code>import</code> parser <a href=\"https://github.com/ndmitchell/shake/blob/dd6a446626f67ee053232cef979d5bdcf4a3663a/src/Test/Self.hs\" rel=\"nofollow noreferrer\">see this example</a>.</li>\n<li><em>OR</em> Use the output of <code>ghc -M</code> to detect the dependencies, which can be parsed using the Shake helper function <a href=\"https://hackage.haskell.org/package/shake/docs/Development-Shake-Util.html#v:parseMakefile\" rel=\"nofollow noreferrer\"><code>parseMakefile</code></a>. For actual code <a href=\"https://github.com/ndmitchell/shake/blob/75f62cbf285615b4df08c6f3dc5ee7d3bfde961a/src/Test/SelfMake.hs\" rel=\"nofollow noreferrer\">see this example</a>.</li>\n</ul>\n\n<p>The advantage of parsing the Haskell files is that it is possible to have generated Haskell files and it can be much quicker. The advantage of using <code>ghc -M</code> is that it is easier to support all GHC features.</p>\n"}], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 3, "accepted_answer_id": 50724825, "answer_count": 1, "score": 7, "last_activity_date": 1528456538, "creation_date": 1528300907, "last_edit_date": 1528454559, "question_id": 50724824, "link": "https://stackoverflow.com/questions/50724824/how-do-i-compile-haskell-programs-using-shake", "title": "How do I compile Haskell programs using Shake", "body": "<p>I have a Haskell program that I want to compile with GHC, orchestrated by the Shake build system. Which commands should I execute, and under what circumstances should they be rerun?</p>\n"}, {"tags": ["haskell", "gcc", "compilation", "linker", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "is_accepted": true, "score": 1, "last_activity_date": 1528359006, "creation_date": 1528359006, "answer_id": 50736062, "question_id": 50724549, "link": "https://stackoverflow.com/questions/50724549/undefined-symbol-errors-with-libhsghc-prim-when-compiling-ffi-sample/50736062#50736062", "title": "Undefined symbol errors with libHSghc-prim when compiling FFI sample", "body": "<p>I found the solution. As the ghc version in the Arch Linux repositories uses dynamic linking, which makes executable sizes much smaller and is also <a href=\"https://wiki.archlinux.org/index.php/Haskell\" rel=\"nofollow noreferrer\">documented</a>, I have to compile my programs with dynamic linking, so I just had to add a flag: </p>\n\n<pre><code>ghc -dynamic -no-hs-main Foo.c libfoo.so\n</code></pre>\n"}], "owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 50736062, "answer_count": 1, "score": 0, "last_activity_date": 1528359006, "creation_date": 1528300070, "question_id": 50724549, "link": "https://stackoverflow.com/questions/50724549/undefined-symbol-errors-with-libhsghc-prim-when-compiling-ffi-sample", "title": "Undefined symbol errors with libHSghc-prim when compiling FFI sample", "body": "<p>I'm trying to compile the sample code in the <a href=\"https://downloads.haskell.org/~ghc/8.4.1/docs/html/users_guide/shared_libs.html\" rel=\"nofollow noreferrer\">FFI chapter of the GHC User's Guide</a>, which I can compile fine using another computer:</p>\n\n<p><strong>Foo.hs</strong></p>\n\n<pre><code>module Foo where\n\nforeign export ccall foo :: Int -&gt; IO Int\n\nfoo :: Int -&gt; IO Int\nfoo n = return (length (f n))\n\nf :: Int -&gt; [Int]\nf 0 = []\nf n = n:(f (n-1))\n</code></pre>\n\n<p><strong>Foo.c</strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"HsFFI.h\"\n\n#ifdef __GLASGOW_HASKELL__\n#include \"Foo_stub.h\"\n#endif\n\nint main(int argc, char *argv[])\n{\n  int i;\n\n  hs_init(&amp;argc, &amp;argv);\n\n  for (i = 0; i &lt; 5; i++) {\n    printf(\"%d\\n\", foo(2500));\n  }\n\n  hs_exit();\n  return 0;\n}\n</code></pre>\n\n<p><strong>Compilation and execution</strong></p>\n\n<pre><code>ghc --make -dynamic -shared -fPIC Foo.hs -o libfoo.so\nghc -no-hs-main Foo.c libfoo.so\nLD_LIBRARY_PATH=. ./a.out\n</code></pre>\n\n<p>But when running <code>a.out</code> I get the error \"./a.out: symbol lookup error: /usr/lib/ghc-8.4.3/ghc-prim-0.5.2.0/libHSghc-prim-0.5.2.0-ghc8.4.3.so: undefined symbol: stg_traceMarkerzh\"\nWhen compiling other simple FFI code I get errors about other undefined symbols in libHSghc-prim. </p>\n\n<p>If I run <code>objdump -t libHSghc-prim-0.5.2.0-ghc8.4.3.so</code>, I see that there are no symbols in the symbol table. After receiving the error I updated GHC from 8.4.2 to 8.4.3 in the Arch Linux repositories, which updated libHSghc-prim from version 0.5.0.0 to 0.5.2.0, so I would have assumed these newly installed files are in order. How can I troubleshoot this problem?</p>\n\n<p><strong>ldd libHSghc-prim-0.5.2.0-ghc8.4.3.so</strong></p>\n\n<pre><code>linux-vdso.so.1 (0x00007ffc9e7a4000)\n/lib/$LIB/liblsp.so =&gt; /lib/lib/liblsp.so (0x00007ff31abdf000)\nlibm.so.6 =&gt; /usr/lib/libm.so.6 (0x00007ff31a84a000)\nlibc.so.6 =&gt; /usr/lib/libc.so.6 (0x00007ff31a48e000)\nlibdl.so.2 =&gt; /usr/lib/libdl.so.2 (0x00007ff31a28a000)\n/usr/lib64/ld-linux-x86-64.so.2 (0x00007ff31b272000)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads", "functor"], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "edited": false, "score": 0, "creation_date": 1528300452, "post_id": 50724619, "comment_id": 88457680, "body": "Thank you, that helped. Just an additional question, how does one create such point-free functions? I&#39;m having difficulties thinking about functions without arguments."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "edited": false, "score": 0, "creation_date": 1528300823, "post_id": 50724619, "comment_id": 88457886, "body": "@MohideenImranKhan It&#39;s not easy, in the general case. One usually tries specializing the polymorphic values at hand, giving less general types, and then combine them in some way. Also, one can start from a pointful definition, and then use an automatic tool like [this](pointfree.io) to remove the points. Using that tool we rarely get readable code, though."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "edited": false, "score": 0, "creation_date": 1528324465, "post_id": 50724619, "comment_id": 88468749, "body": "@MohideenImranKhan: In general, when writing point-free code, the easiest approach is to break down a problem into many small point-free definitions and combine them with composition or higher-level combinators like <code>&lt;$&gt;</code>/<code>&lt;*&gt;</code>/<code>=&lt;&lt;</code> from the <code>(-&gt;) a</code> (function/reader) instances of <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code>, or the combinators from <code>Control.Arrow</code> like <code>(&amp;&amp;&amp;)</code> and <code>(***)</code>. You can also start with a pointful function and see if any parts of it match the shape of combinators like <code>(f . g) x = f (g x)</code> or <code>(f &lt;*&gt; g) x</code> = <code>f x (g x)</code>, then incrementally refactor it to be point-free."}, {"owner": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "edited": false, "score": 0, "creation_date": 1528336893, "post_id": 50724619, "comment_id": 88471807, "body": "I see. Why do people prefer point-free functions when they make construction and interpretation harder?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "edited": false, "score": 0, "creation_date": 1528338661, "post_id": 50724619, "comment_id": 88472185, "body": "@MohideenImranKhan: In my experience, most experienced Haskellers only use point-free style when it <i>doesn\u2019t</i> make constructor or interpretation harder. That usually means sticking to simple pipelines with <code>(.)</code>, and using other point-free operators more sparingly\u2014for example, I consider <code>fmap (f &amp;&amp;&amp; g)</code> (\u201cget <code>f</code> and <code>g</code> of each element\u201d) cleaner than <code>fmap (\\x -&gt; (f x, g x))</code>. A lot of beginners go through a phase where they try to make <i>everything</i> point-free\u2014it\u2019s possible, and a good learning exercise, but the language isn\u2019t really designed for it."}, {"owner": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "edited": false, "score": 0, "creation_date": 1528339577, "post_id": 50724619, "comment_id": 88472375, "body": "Thank you, that clarifies."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "edited": false, "score": 2, "creation_date": 1528356886, "post_id": 50724619, "comment_id": 88478548, "body": "@MohideenImranKhan Point-free is not considered to be a good style in every case. Sometimes it is nice and elegant. However, in many cases it makes the code much harder to read, and it should not be used. When it fails to simplify the code, point-free style is jokingly called &quot;point-less style&quot;, since it became a futile exercise. Perhaps the programmer felt clever when reaching a pointfree form, and wants to show it to the world, but showing unreadable code is hardly a good way to show programmer&#39;s skills. When you are not sure it simplifies, avoid point-free code."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1528300485, "last_edit_date": 1528300485, "creation_date": 1528300305, "answer_id": 50724619, "question_id": 50724336, "link": "https://stackoverflow.com/questions/50724336/defining-fmap-with-id-and-return/50724619#50724619", "title": "Defining fmap with id and return", "body": "<p>Don't forget the universal quantifications.</p>\n\n<p>Fish <code>(&gt;=&gt;)</code> has type <code>(a -&gt; Writer b) -&gt; .....</code> <em>for any</em> <code>a</code> and <code>b</code>.</p>\n\n<p><code>id</code> has type <code>a -&gt; a</code> <em>for any</em> <code>a</code>.</p>\n\n<p>Hence, in particular, fish also has type <code>(Writer b -&gt; Writer b) -&gt; ...</code> for any <code>b</code> (just take <code>a = Writer b</code> as a special case).</p>\n\n<p>Further, <code>id</code> has also type <code>Writer b -&gt; Writer b</code> (again, as a special case).</p>\n\n<p>The \"trick\" here is to \"merge\" the two types using <em>unification</em>.\nWe start by requiring <code>(a -&gt; Writer b) = (a' -&gt; a')</code>, and then we infer <code>a = a'</code> and <code>Writer b = a'</code>. From here, we can see that these two types can be unified, so there is no contradiction in passing the arguments.</p>\n\n<p>(Also note that here we renamed the <code>a</code> in the type of <code>id</code> to <code>a'</code> to avoid confusion with the other <code>a</code> for the fish)</p>\n"}], "owner": {"reputation": 813, "user_id": 1468079, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/35a647b1d07f694c5cedfdae8f81d49e?s=128&d=identicon&r=PG", "display_name": "Mohideen Imran Khan", "link": "https://stackoverflow.com/users/1468079/mohideen-imran-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 50724619, "answer_count": 1, "score": 3, "last_activity_date": 1528300485, "creation_date": 1528299382, "question_id": 50724336, "link": "https://stackoverflow.com/questions/50724336/defining-fmap-with-id-and-return", "title": "Defining fmap with id and return", "body": "<p>In <em>Category Theory for Programmers</em> by Bartosz Milewski, Milewski writes the following code to define return and the 'fish' operator (composition in Kleisli category) for the Writer monad. </p>\n\n<pre><code>return :: a -&gt; Writer a\nreturn x = (x, \"\")\n\n(&gt;=&gt;) :: (a -&gt; Writer b) -&gt; (b -&gt; Writer c) -&gt; (a -&gt; Writer c)\nm1 &gt;=&gt; m2 = \\x -&gt;\n  let (y, s1) = m1 x\n      (z, s2) = m2 y\n  in  (z, s1 ++ s2)\n</code></pre>\n\n<p>He then proceeds to define <code>fmap</code> as follows:</p>\n\n<pre><code>fmap f = id &gt;=&gt; (\\x -&gt; return (f x))\n</code></pre>\n\n<p>I have difficulties understanding how the <code>id</code> function is used here. The first argument to the fish operator clearly is <code>(a -&gt; Writer b)</code> but id has the type signature <code>a -&gt; a</code>. </p>\n\n<p>Is this an error or a flaw in my understanding? Replacing <code>id</code> with <code>return</code> makes more sense to me.</p>\n"}, {"tags": ["haskell", "monads", "yesod"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1528285834, "post_id": 50716754, "comment_id": 88447713, "body": "I suspect you need to plug <code>liftHandler</code> or <code>liftSubHandler</code> somewhere."}], "answers": [{"tags": [], "owner": {"reputation": 705, "user_id": 2648019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wBjZ5.jpg?s=128&g=1", "display_name": "Daiwen", "link": "https://stackoverflow.com/users/2648019/daiwen"}, "is_accepted": true, "score": 1, "last_activity_date": 1528615136, "last_edit_date": 1528615136, "creation_date": 1528614262, "answer_id": 50781333, "question_id": 50716754, "link": "https://stackoverflow.com/questions/50716754/yesod-hardcoded-authentication-depending-on-appsettings/50781333#50781333", "title": "Yesod Hardcoded authentication depending on AppSettings", "body": "<p>The error came from my attempt at modifying the code snippet given by the <code>Yesod.Auth.Hardcoded</code> module. I introduced a <code>do</code> notation that conflicted with the omitted arguments. Specifying the arguments solves the issue, the code becomes:</p>\n\n<pre><code>instance YesodAuthHardcoded App where\n    validatePassword u p = do\n        app &lt;- getYesod\n        let user = appUser $ appSettings app\n        return . validPassword user u . fromString $ unpack p\n    doesUserNameExist u = do\n        app &lt;- getYesod\n        return . isJust $ lookupUser app u\n</code></pre>\n"}], "owner": {"reputation": 705, "user_id": 2648019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wBjZ5.jpg?s=128&g=1", "display_name": "Daiwen", "link": "https://stackoverflow.com/users/2648019/daiwen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 50781333, "answer_count": 1, "score": 2, "last_activity_date": 1528615136, "creation_date": 1528277068, "last_edit_date": 1528529386, "question_id": 50716754, "link": "https://stackoverflow.com/questions/50716754/yesod-hardcoded-authentication-depending-on-appsettings", "title": "Yesod Hardcoded authentication depending on AppSettings", "body": "<p>I am trying to setup the hardcoded authentification to rely on login information specified in <code>config/settings.yml</code> from the Yesod scaffolding. I wrote the following code:</p>\n\n<pre><code>instance YesodAuthHardcoded App where\n    validatePassword u = do\n        app &lt;- getYesod\n        let user = appUser $ appSettings app\n        return . validPassword user u . fromString . unpack\n    doesUserNameExist = do\n        app &lt;- getYesod\n        return . isJust . lookupUser app\n</code></pre>\n\n<p>And I receive the following error message for <code>validatePassord</code> and the equivalent for <code>doesUserNameExist</code>:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018HandlerSite ((-&gt;) Text)\u2019 with \u2018App\u2019\n  Expected type: Text -&gt; App\n    Actual type: Text -&gt; HandlerSite ((-&gt;) Text)\n\u2022 In a stmt of a 'do' block: app &lt;- getYesod\n  In the expression:\n    do { app &lt;- getYesod;\n         let user = appUser $ appSettings app;\n         return . validPassword user u . fromString . unpack }\n  In an equation for \u2018validatePassword\u2019:\n      validatePassword u\n        = do { app &lt;- getYesod;\n               let user = ...;\n               return . validPassword user u . fromString . unpack }\n</code></pre>\n\n<p>The prototype of <code>validatePassword</code> <a href=\"https://www.stackage.org/haddock/lts-11.12/yesod-auth-1.6.3/Yesod-Auth-Hardcoded.html\" rel=\"nofollow noreferrer\">is defined in <code>Yesod.Auth.Hardcoded</code></a>:</p>\n\n<pre><code>validatePassword :: Text -&gt; Text -&gt; AuthHandler site Bool\n</code></pre>\n\n<p>and <code>AuthHandler</code> <a href=\"https://www.stackage.org/haddock/lts-11.12/yesod-auth-1.6.3/Yesod-Auth.html#t:AuthHandler\" rel=\"nofollow noreferrer\">is defined in <code>Yesod.Auth</code></a>:</p>\n\n<pre><code>type MonadAuthHandler master m = (MonadHandler m, YesodAuth master, master ~ HandlerSite m, Auth ~ SubHandlerSite m, MonadUnliftIO m)\n\ntype AuthHandler master a = forall m. MonadAuthHandler master m =&gt; m a \n</code></pre>\n\n<p>Finally <code>getYesod</code> <a href=\"https://www.stackage.org/haddock/lts-9.11/yesod-core-1.4.37/Yesod-Core-Handler.html#v:getYesod\" rel=\"nofollow noreferrer\">is defined as follow in <code>Yesod.Core.Handler</code></a>:</p>\n\n<pre><code>getYesod :: MonadHandler m =&gt; m (HandlerSite m)\n</code></pre>\n\n<p>It seems from these definitions that there should be a way for me to call <code>getYesod</code> from the <code>AuthHandler</code> monad but I can't figure out how.</p>\n\n<hr>\n\n<p>EDIT:\nI have updated <code>yesod</code> and its scaffolding to the latest version. I also modified <code>validatePassword</code> as follow:</p>\n\n<pre><code>validatePassword u = do\n    app &lt;- liftHandler . getYesod\n    let user = appUser $ appSettings app\n    return . validPassword user u . fromString . unpack\n</code></pre>\n\n<p>And I get the following error message:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018m1 a1\u2019 with \u2018App\u2019\n      Expected type: HandlerFor (HandlerSite m1) a1 -&gt; App\n        Actual type: HandlerFor (HandlerSite m1) a1 -&gt; m1 a1\n    \u2022 In the first argument of \u2018(.)\u2019, namely \u2018liftHandler\u2019\n      In a stmt of a 'do' block: app &lt;- liftHandler . getYesod\n      In the expression:\n        do app &lt;- liftHandler . getYesod\n           let user = appUser $ appSettings app\n           return . validPassword user u . fromString . unpack\n    |\n259 |         app &lt;- liftHandler . getYesod\n    |\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1528257914, "post_id": 50711961, "comment_id": 88432994, "body": "Squaring is a monotone operation, so you can binary search for its inverse, which would be much faster than what you have here (and is pretty naturally recursive)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1528258131, "post_id": 50711961, "comment_id": 88433051, "body": "Also, to whet your appetite, the pattern that <code>perfectSquare</code> uses is actually known as <i>corecursive</i>  (but for the purposes of a class it will count as recursive I&#39;m sure)"}, {"owner": {"reputation": 1116, "user_id": 6457989, "user_type": "registered", "accept_rate": 54, "profile_image": "https://lh4.googleusercontent.com/-WqYZtN2xbQA/AAAAAAAAAAI/AAAAAAAAAJA/Q0Nr_eTCBsA/photo.jpg?sz=128", "display_name": "newbie", "link": "https://stackoverflow.com/users/6457989/newbie"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1528258811, "post_id": 50711961, "comment_id": 88433218, "body": "@luqui thanks, I just wrote a comment below"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1528263235, "post_id": 50712209, "comment_id": 88434513, "body": "No I was talking about <a href=\"https://www.geeksforgeeks.org/binary-search/\" rel=\"nofollow noreferrer\">this algorithm</a> (but using a function in lieu of an array), but I&#39;m happy you got something you&#39;re happy with."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1528272495, "post_id": 50712209, "comment_id": 88439173, "body": "The same linear search you implemented recursively above can also be performed by generating the infinite list of squares <code>squares = [n*n | n &lt;- [0..]]</code>, and dropping the squares which are too small <code>dropWhile (&lt; number) squares</code>. This results in a list whose first element is <code>number</code> is and only if <code>number</code> is a square. (Binary search is more efficient, though, as luqui pointed out)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528304909, "post_id": 50712209, "comment_id": 88460040, "body": "Your original solution is probably better than this one: it does a linear search up from 0 to the square root, whereas this one does a linear search down from the value to its square root. So your original is O(sqrt n) runtime, asymptotically better than this one&#39;s O(n) runtime."}], "tags": [], "owner": {"reputation": 1116, "user_id": 6457989, "user_type": "registered", "accept_rate": 54, "profile_image": "https://lh4.googleusercontent.com/-WqYZtN2xbQA/AAAAAAAAAAI/AAAAAAAAAJA/Q0Nr_eTCBsA/photo.jpg?sz=128", "display_name": "newbie", "link": "https://stackoverflow.com/users/6457989/newbie"}, "is_accepted": false, "score": 5, "last_activity_date": 1528258763, "creation_date": 1528258763, "answer_id": 50712209, "question_id": 50711961, "link": "https://stackoverflow.com/questions/50711961/how-to-tell-if-a-number-is-a-square-number-with-recursion/50712209#50712209", "title": "How to tell if a number is a square number with recursion?", "body": "<p>@luqui you mean like this?</p>\n\n<pre><code>pow n = n*n\nperfectSquare pRoot pSquare | pow(pRoot) == pSquare = True\n                            | pow(pRoot)&gt;pSquare = perfectSquare (pRoot-1) pSquare\n                            | otherwise = False\n--\nisPerfectSquare number = perfectSquare number number\n</code></pre>\n\n<p>I can't believe I didn't see it xD thanks a lot! I must be really tired</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1528281837, "creation_date": 1528281837, "answer_id": 50718421, "question_id": 50711961, "link": "https://stackoverflow.com/questions/50711961/how-to-tell-if-a-number-is-a-square-number-with-recursion/50718421#50718421", "title": "How to tell if a number is a square number with recursion?", "body": "<p>You can perform some sort of \"binary search\" on some implicit list of squares. There is however a problem of course, and that is that we first need an upper bound. We can use as upper bound the number itself, since for all integral squares, the square is larger than the value we square.</p>\n\n<p>So it could look like:</p>\n\n<pre><code>isPerfectSquare n = search 0 n\n    where search i k | i &gt; k = False\n                     | j2 &gt; n = search i (j-1)\n                     | j2 &lt; n = search (j+1) k\n                     | otherwise = True\n              where j = div (i+k) 2\n                    j2 = j * j\n</code></pre>\n\n<p>To verify that a number <em>n</em> is a perfect square, we thus have an algorithm that runs in <em>O(log n)</em> in case the integer operations are done in constant time (for example if the number of bits is fixed).</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1528294942, "last_edit_date": 1528294942, "creation_date": 1528294281, "answer_id": 50722584, "question_id": 50711961, "link": "https://stackoverflow.com/questions/50711961/how-to-tell-if-a-number-is-a-square-number-with-recursion/50722584#50722584", "title": "How to tell if a number is a square number with recursion?", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Integer_square_root\" rel=\"nofollow noreferrer\">Wikipedia suggests using Newton's method.</a> Here's how that would look. We'll start with some boilerplate. <code>ensure</code> is a little combinator I've used fairly frequently. It's written to be very general, but I've included a short comment that should be pretty explanatory for how we'll plan to use it.</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad\n\nensure :: Alternative f =&gt; (a -&gt; Bool) -&gt; a -&gt; f a\nensure p x = x &lt;$ guard (p x)\n-- ensure p x | p x = Just x\n--            | otherwise = Nothing\n</code></pre>\n\n<p>Here's the implementation of the formula given by Wikipedia for taking one step in Newton's method. <code>x</code> is our current guess about the square root, and <code>n</code> is the number we're taking the square root of.</p>\n\n<pre><code>stepApprox :: Integer -&gt; Integer -&gt; Integer\nstepApprox x n = (x + n `div` x) `div` 2\n</code></pre>\n\n<p>Now we can recursively call this stepping function until we get the floor of the square root. Since we're using integer division, the right termination condition is to watch for the next step of the approximation to be equal or one greater to the current step. This is the only recursive function.</p>\n\n<pre><code>iterateStepApprox :: Integer -&gt; Integer -&gt; Integer\niterateStepApprox x n = case x' - x of\n    0 -&gt; x\n    1 -&gt; x\n    _ -&gt; iterateStepApprox x' n\n    where x' = stepApprox x n\n</code></pre>\n\n<p>To wrap the whole development up in a nice API, to check if a number is a square we can just check that the floor of its square root squares to it. We also need to pick a starting approximation, but we don't have to be super smart -- Newton's method converges very quickly for square roots. We'll pick half the number (rounded up) as our approximation. To avoid division by zero and other nonsense, we'll make zero and negative numbers special cases.</p>\n\n<pre><code>isqrt :: Integer -&gt; Maybe Integer\nisqrt n | n &lt; 0 = Nothing\nisqrt 0 = Just 0\nisqrt n = ensure (\\x -&gt; x*x == n) (iterateStepApprox ((n+1)`div`2) n)\n</code></pre>\n\n<p>Now we're done! It's pretty fast even for large numbers:</p>\n\n<pre><code>&gt; :set +s\n&gt; isqrt (10^10000) == Just (10^5000)\nTrue\n(0.58 secs, 182,610,408 bytes)\n</code></pre>\n\n<p>Yours would spend rather a longer time than the universe has got left computing that. It is also marginally faster than the binary search algorithm in my tests. (Of course, <a href=\"http://hackage.haskell.org/package/arithmoi-0.7.0.0/docs/Math-NumberTheory-Powers-Squares.html#v:exactSquareRoot\" rel=\"nofollow noreferrer\">not hand-rolling it yourself</a> is several orders of magnitude faster still, probably in part because it uses a <a href=\"https://hal.inria.fr/inria-00072854/en/\" rel=\"nofollow noreferrer\">better, but more complicated, algorithm based on Karatsuba multiplication</a>.)</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1528302656, "post_id": 50725016, "comment_id": 88458835, "body": "Why <code>n &#47; sqrt n</code> instead of just <code>sqrt n</code>? And leaving aside all the rounding problems that go along with floating point, this falls over at <code>1e14</code> even though <code>sqrt 1e14</code> is exactly <code>1e7</code>, because <code>1e7</code> shows as <code>1.0e7</code>, not <code>10000000.0</code>. It would be better to use <code>properFraction</code> or <code>mod&#39;</code> or similar to check whether the number is a whole number."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528304739, "post_id": 50725016, "comment_id": 88459946, "body": "Indeed, the <code>n &#47; sqrt n</code> was residual from my iterative process. I glossed over it in the final version but ignored it after I got what I wanted. Requirements are missing. The examples were 1 and 3, that is, not large. The question, was more how to do it recursively. It was not specified what. I could not get <code>mod</code> to fit. My weakness. My goals are more toward the simple."}], "tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1528301613, "creation_date": 1528301613, "answer_id": 50725016, "question_id": 50711961, "link": "https://stackoverflow.com/questions/50711961/how-to-tell-if-a-number-is-a-square-number-with-recursion/50725016#50725016", "title": "How to tell if a number is a square number with recursion?", "body": "<p>If the function is recursive then it is primitive recursive as are 90% of all recursive functions. For these <code>fold</code>s are fast and effective. Considering the programmers time, while keeping things simple and correct is important.</p>\n\n<p>Now, that said, it might be fruitful to cinsider text patterns of functions like <code>sqrt</code>. <code>sqrt</code> return a floating point number. If a number is a perfect square then two characters are \".0\" at the end. The pattern might occur, however, at the start of any mantissa. If a string goes in, in reverse, then \"0.\" is at the top of the list.</p>\n\n<p>This function takes a Number and returns a Bool</p>\n\n<pre><code>fps n = (take 2.reverse.show $ (n / (sqrt n))) == \"0.\"\n</code></pre>\n\n<p><code>fps 10000.00001</code></p>\n\n<p>False</p>\n\n<pre><code>fps 10000\n</code></pre>\n\n<p>True</p>\n"}], "owner": {"reputation": 1116, "user_id": 6457989, "user_type": "registered", "accept_rate": 54, "profile_image": "https://lh4.googleusercontent.com/-WqYZtN2xbQA/AAAAAAAAAAI/AAAAAAAAAJA/Q0Nr_eTCBsA/photo.jpg?sz=128", "display_name": "newbie", "link": "https://stackoverflow.com/users/6457989/newbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1528301613, "creation_date": 1528256642, "question_id": 50711961, "link": "https://stackoverflow.com/questions/50711961/how-to-tell-if-a-number-is-a-square-number-with-recursion", "title": "How to tell if a number is a square number with recursion?", "body": "<p>I solved the following exercise, but I'm not a fan of the solution:</p>\n\n<blockquote>\n  <p>Write the function isPerfectSquare using recursion, to tell if an \n  Int is a  perfectSquare\n  isPerfectSquare 1 -> Should return True <br>\n  isPerfectSquare 3 -> Should return False</p>\n</blockquote>\n\n<p>the <code>num+1</code> part is for the case for <code>isPerfectSquare 0 and isPerfectSquare 1</code>, one of the parts I don't like one bit, this is my solutiuon:</p>\n\n<pre><code>perfectSquare 0 1 = [0] ++ perfectSquare 1 3\nperfectSquare current diff = [current] ++ perfectSquare (current + diff) (diff + 2)\n\nisPerfectSquare num = any (==num) (take (num+1) (perfectSquare 0 1))\n</code></pre>\n\n<p>What is a more elegant solution to this problem? of course we can't use sqrt, nor floating point operations.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 11, "last_activity_date": 1528259605, "creation_date": 1528259605, "answer_id": 50712294, "question_id": 50711955, "link": "https://stackoverflow.com/questions/50711955/maps-on-trees-in-haskell/50712294#50712294", "title": "Maps on Trees in Haskell", "body": "<p>That typeclass already exists in Prelude: <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Functor\" rel=\"noreferrer\"><code>Functor</code></a>.</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>To implement it, you could use the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/DeriveFunctor\" rel=\"noreferrer\"><code>DeriveFunctor</code></a> language extension so that GHC can implement it for you with just a <code>deriving</code> clause:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\ndata Tree a = Empty | Node a (Tree a) (Tree a) deriving (Functor)\n\nmapTree :: (a -&gt; b) -&gt; Tree a -&gt; Tree b\nmapTree = fmap\n</code></pre>\n\n<p>Or you can implement it manually:</p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a)\n\nmapTree :: (a -&gt; b) -&gt; Tree a -&gt; Tree b\nmapTree _ Empty = Empty\nmapTree f (Node x l r) = Node (f x) (mapTree f l) (mapTree f r)\n\ninstance Functor Tree where\n    fmap = mapTree\n</code></pre>\n"}], "owner": {"reputation": 205, "user_id": 9710552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8578fe2900e52ee3bd08329635673614?s=128&d=identicon&r=PG&f=1", "display_name": "RM777", "link": "https://stackoverflow.com/users/9710552/rm777"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 2, "accepted_answer_id": 50712294, "answer_count": 1, "score": 3, "last_activity_date": 1528259605, "creation_date": 1528256595, "question_id": 50711955, "link": "https://stackoverflow.com/questions/50711955/maps-on-trees-in-haskell", "title": "Maps on Trees in Haskell", "body": "<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a)\n\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>How can I define a function that operates like map but works on trees? The typesignature of the new funtion would be:</p>\n\n<pre><code>mapTree :: (a -&gt; b) -&gt; Tree a -&gt; Tree b\n</code></pre>\n\n<p>Is it even possible to create a generic typeclass for map?</p>\n"}, {"tags": ["haskell", "cabal", "ffi"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1528284299, "post_id": 50711797, "comment_id": 88446760, "body": "I didn&#39;t get what are you asking. What&#39;s <code>foo.so</code>? Anyways, take a look at Cabal&#39;s <code>foreign-library</code> stanza, it might be relevant."}, {"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1528302020, "post_id": 50711797, "comment_id": 88458506, "body": "you can see in my last clang step, foo.so is a shared library generated from clang and my foreign code."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1528315227, "post_id": 50711797, "comment_id": 88465203, "body": "If you want to link to it, add it to extra-libraries: <code>extra-libraries: stdc++ clang foo</code>."}, {"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1528347593, "post_id": 50711797, "comment_id": 88474183, "body": "Yeah for some reason it doesn\u2019t see the library even when the .so is in the path, any success getting static linking with ffi on Mac? Static linking doesn\u2019t work on Mac the same way it does for Linux."}], "owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 468, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1528308608, "creation_date": 1528255310, "last_edit_date": 1528308608, "question_id": 50711797, "link": "https://stackoverflow.com/questions/50711797/cabal-ghc-build-with-dynamic-and-shared-library", "title": "cabal: ghc build with -dynamic and shared library", "body": "<p>I'm trying to build a dynamic application with GHC, this is my cabal file:</p>\n\n<pre><code>executable app\n  main-is: Main.hs\n  c-sources: cbits/foo.cpp\n  cc-options: -shared -fPIC\n  include-dirs: /usr/local/lib/llvm-6.0/include\n  extra-libraries: stdc++ clang\n  extra-lib-dirs: /usr/local/lib/llvm-6.0/lib\n  other-modules:\n    ...\n</code></pre>\n\n<p>I need to use the FFI and I'm working on MacOS. I'm getting a linker error:</p>\n\n<blockquote>\n  <p>Undefined symbols for architecture x86_64:   \"_clangToJSON\",\n  referenced from:\n        _ClangziCParser_hppTree_info in CParser.o</p>\n</blockquote>\n\n<p>This is indeed a foreign function that I'm trying to access, I've had success with the following arguments to ghc in a Makefile:</p>\n\n<p>Building FFI impl, shared library:</p>\n\n<pre><code> clang -fPIC -shared foo.cpp -o foo.so\n</code></pre>\n\n<p>Building Main.hs with the shared library foo.so:</p>\n\n<pre><code>ghc -dynamic Main.hs -o  -lfoo -L. -optl-Wl,-rpath,'$ORIGIN' \n</code></pre>\n\n<p>I've managed to make cabal running in <code>dynamic</code> mode with <code>--enable-shared</code> but I need to make the clang inside cabal generate a .so. I'm searching in\n<code>dist/build/app</code> and I can't find a .so, even with the <code>-shared</code> option added to my <code>cc-options</code>. How can I generate a .so and then get cabal to link with it dynamically?</p>\n"}, {"tags": ["haskell", "travis-ci"], "comments": [{"owner": {"reputation": 7576, "user_id": 480398, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3468d23f15a9f631136b508b967b0fbe?s=128&d=identicon&r=PG", "display_name": "hvr", "link": "https://stackoverflow.com/users/480398/hvr"}, "edited": false, "score": 0, "creation_date": 1528241723, "post_id": 50709844, "comment_id": 88429635, "body": "Fwiw, I&#39;m using GHC 8.4.3 on Travis CI w/o any problems via <a href=\"https://github.com/haskell-CI/haskell-ci\" rel=\"nofollow noreferrer\">github.com/haskell-CI/haskell-ci</a>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 7576, "user_id": 480398, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3468d23f15a9f631136b508b967b0fbe?s=128&d=identicon&r=PG", "display_name": "hvr", "link": "https://stackoverflow.com/users/480398/hvr"}, "edited": false, "score": 0, "creation_date": 1528242553, "post_id": 50709844, "comment_id": 88429831, "body": "@hvr Hmmm. Do you see the same paths as above?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1528284498, "post_id": 50709844, "comment_id": 88446882, "body": "This is a question for GHC devs, not SO community. Try GHC mail-lists or IRC."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1528815753, "post_id": 50709844, "comment_id": 88645865, "body": "@orome Can you try adding <code>--verbose</code> to the Stack command to get a little more information about what&#39;s failing?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1528820164, "post_id": 50709844, "comment_id": 88648450, "body": "FYI, I just noticed an example of a Travis job of mine using GHC 8.4.3 and succeeding: <a href=\"https://travis-ci.org/yesodweb/yesod/jobs/391306911\" rel=\"nofollow noreferrer\">travis-ci.org/yesodweb/yesod/jobs/391306911</a>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1528900613, "post_id": 50709844, "comment_id": 88683572, "body": "@MichaelSnoyman: Added output from <code>--verbose</code>."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1528914436, "post_id": 50709844, "comment_id": 88691343, "body": "&quot;strip:/home/travis/.stack/programs/x86_64-linux/ghc-8.4.3/l&zwnj;&#8203;ib/ghc-8.4.3/ghc- 8.4.3/stFVIxC7: No space left on device&quot; I&#39;d try clearing the cache and rebuilding"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1528994640, "last_edit_date": 1528994640, "creation_date": 1528963532, "answer_id": 50852555, "question_id": 50709844, "link": "https://stackoverflow.com/questions/50709844/is-there-an-issue-with-haskell-ghc-8-4-3-on-travis/50852555#50852555", "title": "Is there an issue with Haskell GHC 8.4.3 on Travis?", "body": "<p>Moving to an answer from the comments: the issue is that Travis has run out of disk space. This can be observed by passing the <code>--verbose</code> flag to Stack. My recommendation is to clear the cache and try again.</p>\n\n<p>I've also opened up <a href=\"https://github.com/commercialhaskell/stack/issues/4085\" rel=\"nofollow noreferrer\">a Stack issue</a> to improve the output in this case.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 1, "accepted_answer_id": 50852555, "answer_count": 1, "score": 3, "last_activity_date": 1528994640, "creation_date": 1528237890, "last_edit_date": 1528900590, "question_id": 50709844, "link": "https://stackoverflow.com/questions/50709844/is-there-an-issue-with-haskell-ghc-8-4-3-on-travis", "title": "Is there an issue with Haskell GHC 8.4.3 on Travis?", "body": "<p>My <a href=\"https://travis-ci.org/orome/crypto-enigma-hs/jobs/388291576\" rel=\"nofollow noreferrer\">Travis builds</a> are failing when they attempt to install using the nightly resolver (since 8.4.3) with: </p>\n\n<pre><code>$ stack --resolver $RESOLVER --no-terminal --install-ghc test --only-dependencies\nSelected resolver: nightly-2018-06-05\nDownloading nightly-2018-06-05 build plan ...\nDownloaded nightly-2018-06-05 build plan.\nPreparing to install GHC to an isolated location.\nThis will not interfere with any system-level installation.\nPreparing to download ghc-8.4.3 ...\nghc-8.4.3: download has begun\nghc-8.4.3:   15.21 MiB / 144.83 MiB ( 10.50%) downloaded...\nghc-8.4.3:   37.85 MiB / 144.83 MiB ( 26.13%) downloaded...\nghc-8.4.3:   61.16 MiB / 144.83 MiB ( 42.23%) downloaded...\nghc-8.4.3:   76.60 MiB / 144.83 MiB ( 52.89%) downloaded...\nghc-8.4.3:   91.49 MiB / 144.83 MiB ( 63.17%) downloaded...\nghc-8.4.3:  115.03 MiB / 144.83 MiB ( 79.42%) downloaded...\nghc-8.4.3:  138.27 MiB / 144.83 MiB ( 95.47%) downloaded...\nghc-8.4.3:  144.83 MiB / 144.83 MiB (100.00%) downloaded...\nDownloaded ghc-8.4.3.\nUnpacking GHC into /home/travis/.stack/programs/x86_64-linux/ghc-8.4.3.temp/ ...\nConfiguring GHC ...\nInstalling GHC ...\nReceived ExitFailure 2 when running\nRaw command: /usr/bin/make install\nRun from: /home/travis/.stack/programs/x86_64-linux/ghc-8.4.3.temp/ghc-8.4.3/\nThe command \"stack --resolver $RESOLVER --no-terminal --install-ghc test --only-dependencies\" failed and exited with 1 during .\n</code></pre>\n\n<p>When run with <code>--verbose</code> this command produces the final lines</p>\n\n<pre><code>2018-06-13 13:52:53.964026: [debug] \"utils/ghc-cabal/dist-install/build/tmp/ghc-cabal-bindist\" copy compiler stage2 \"strip\" '' '/home/travis/.stack/programs/x86_64-linux/ghc-8.4.3' '/home/travis/.stack/programs/x86_64-linux/ghc-8.4.3/lib/ghc-8.4.3' '/home/travis/.stack/programs/x86_64-linux/ghc-8.4.3/share/doc/ghc-8.4.3/html/libraries' 'v p dyn'\n@(src/Stack/Setup.hs:1097:54)\n2018-06-13 13:52:57.445300: [debug] Installing library in /home/travis/.stack/programs/x86_64-linux/ghc-8.4.3/lib/ghc-8.4.3/ghc-8.4.3\n@(src/Stack/Setup.hs:1097:54)\n2018-06-13 13:53:08.362061: [debug] strip:/home/travis/.stack/programs/x86_64-linux/ghc-8.4.3/lib/ghc-8.4.3/ghc-\n8.4.3/stFVIxC7: No space left on device\n@(src/Stack/Setup.hs:1097:54)\n2018-06-13 13:53:08.442841: [debug] make[1]: *** [install_packages] Error 1\n@(src/Stack/Setup.hs:1097:54)\n2018-06-13 13:53:08.443962: [debug] make: *** [install] Error 2\n@(src/Stack/Setup.hs:1097:54)\nReceived ExitFailure 2 when running\nRaw command: /usr/bin/make install\nRun from: /home/travis/.stack/programs/x86_64-linux/ghc-8.4.3.temp/ghc-8.4.3/\nThe command \"stack --resolver $RESOLVER --no-terminal --install-ghc test --only-dependencies --verbose\" failed and exited with 1 during .\n</code></pre>\n\n<p>Is there <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15239#ticket\" rel=\"nofollow noreferrer\">a problem with 8.4.3 on Travis</a>?</p>\n\n<hr>\n\n<p>Relevant <code>.travis.yml</code>:</p>\n\n<pre><code>sudo: false\n\nlanguage: generic\n\ncache:\n  directories:\n  - \"$HOME/.stack\"\n\naddons:\n  apt:\n    packages:\n    - libgmp-dev\n\nenv:\n# ... several working resolvers\n- $RESOLVER=\"nightly\"\n\nbefore_install:\n# Download and unpack the stack executable -- https://docs.haskellstack.org/en/stable/travis_ci/?highlight=travis\n- mkdir -p ~/.local/bin\n- export PATH=$HOME/.local/bin:$PATH\n- travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'\n\ninstall:\n# Build dependencies\n- stack --resolver $RESOLVER --no-terminal --install-ghc test --only-dependencies --verbose\n\nscript:\n# Build the package, its tests, and its docs and run the tests\n- stack --resolver $RESOLVER --no-terminal --install-ghc test --haddock --no-haddock-deps\n# List components explicitly; ignoring failure\n- stack --resolver $RESOLVER exec ghc-pkg list || true\n\nnotifications:\n  webhooks:\n    urls:\n      - https://webhooks.gitter.im/e/33a1859c14283f0dbab6\n    on_success: change\n    on_failure: always\n    on_start: never\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "binary"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1528228175, "post_id": 50707754, "comment_id": 88424810, "body": "How many digits do you need for 153? Now how many do you need for <code>div 153 10 == 15</code>? Or <code>div 15 10 == 1</code>? Or <code>div 1 10 == 0</code> (hint: assume you need only 0 digits for 0 itself)."}], "answers": [{"tags": [], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "is_accepted": true, "score": 4, "last_activity_date": 1528231597, "last_edit_date": 1528231597, "creation_date": 1528228564, "answer_id": 50707977, "question_id": 50707754, "link": "https://stackoverflow.com/questions/50707754/how-to-properly-use-a-function-that-is-recursive-and-receives-a-single-argument/50707977#50707977", "title": "How to properly use a function that is recursive and receives a single argument?", "body": "<p>Here's an \"iterative\" solution:</p>\n\n<pre><code>binaryDigits = length . takeWhile (not . (==0)) . iterate (`div` 2)\n</code></pre>\n\n<p>You can also redefine it by recursing until you hit the bottom and sum the length on the way back. It will be a good exercise, so I kept the solution in a spoiler for you</p>\n\n<blockquote class=\"spoiler\">\n  <p><pre>binaryDigits 0 = 0;\nbinaryDigits x = 1 + binaryDigits (div x 2)</pre></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1528315551, "creation_date": 1528315551, "answer_id": 50728691, "question_id": 50707754, "link": "https://stackoverflow.com/questions/50707754/how-to-properly-use-a-function-that-is-recursive-and-receives-a-single-argument/50728691#50728691", "title": "How to properly use a function that is recursive and receives a single argument?", "body": "<p>No need for recursion or iteration. You may perhaps do with base 2 logarithm as follows;</p>\n\n<pre><code>binaryDigits :: (Floating a, Integral c, RealFrac a) =&gt; a -&gt; c\nbinaryDigits n | n == 0    = 1\n               | otherwise = 1 + (floor . logBase 2 $ n)\n&gt; binaryDigits 1453\n&gt; 11\n</code></pre>\n"}], "owner": {"reputation": 1116, "user_id": 6457989, "user_type": "registered", "accept_rate": 54, "profile_image": "https://lh4.googleusercontent.com/-WqYZtN2xbQA/AAAAAAAAAAI/AAAAAAAAAJA/Q0Nr_eTCBsA/photo.jpg?sz=128", "display_name": "newbie", "link": "https://stackoverflow.com/users/6457989/newbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 50707977, "answer_count": 2, "score": 0, "last_activity_date": 1528315551, "creation_date": 1528227604, "question_id": 50707754, "link": "https://stackoverflow.com/questions/50707754/how-to-properly-use-a-function-that-is-recursive-and-receives-a-single-argument", "title": "How to properly use a function that is recursive and receives a single argument?", "body": "<p>While trying to solve the following exercise...</p>\n\n<blockquote>\n  <p>Define the function <code>binaryDigits</code>, that receives an Integer and\n  returns the amount of digits required to write such umber in binary\n  code.</p>\n</blockquote>\n\n<p>... I found myself thinking that it is impossible to solve this problem by calling the function <code>binaryDigits</code> recursively because the only variable it receives is the actual number</p>\n\n<p>I say this because the website states that while the tests it runs were succeeded, I didn't use recursion in the function <code>binaryDigits</code>.</p>\n\n<p>so how could I even think of recursively call this function if I can't even tell how many times have I called it (and lets say that the number of times being called represent how many binary digits it takes to represent that number).</p>\n\n<p>This is what I thought: please note that <em>I'm using recursion but in an auxiliary function that returns a list of the decimal values that binary digits represent</em> when the sum of that list is greater than the received number:</p>\n\n<pre><code>double = (2*)\n\nlistOfBinaryDigits list num | num &gt; (sum list) = listOfBinaryDigits ([double(head list)]++list) num\n                            | otherwise = list\n\nbinaryDigits num = length (listOfBinaryDigits [1] num)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1528223222, "post_id": 50706590, "comment_id": 88422477, "body": "There are about 3 or 4 separate errors in this code. Please post the specific error you&#39;re asking about."}, {"owner": {"reputation": 93, "user_id": 5748372, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f8373ead3307a5d0d1669b790f29ddbd?s=128&d=identicon&r=PG&f=1", "display_name": "Isengardium", "link": "https://stackoverflow.com/users/5748372/isengardium"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1528223299, "post_id": 50706590, "comment_id": 88422509, "body": "@melpomene  &quot;error: Parse error in pattern: showList&quot; is the only error so far. On the line with: showList (x, y):[] = putStrLn (x, y)"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1528228544, "post_id": 50706590, "comment_id": 88424994, "body": "You will need to add a <code>Show a =&gt;</code> constraint to the beginning of the type signature, and you need to switch to <code>print</code>."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1528223707, "post_id": 50706717, "comment_id": 88422716, "body": "If you want to admonish the OP, do so in a comment to the question. It has no place in an answer."}], "tags": [], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "is_accepted": false, "score": 0, "last_activity_date": 1528223723, "last_edit_date": 1528223723, "creation_date": 1528223278, "answer_id": 50706717, "question_id": 50706590, "link": "https://stackoverflow.com/questions/50706590/process-list-of-pairs-in-haskell/50706717#50706717", "title": "Process list of pairs in Haskell", "body": "<p>Your biggest mistake is that you thought that a Tuple is a String.\nTuple <code>(x, y)</code> is not a string. \nThe signature of <code>putStrLn :: String -&gt; IO ()</code> wants a String as it's argument.</p>\n\n<p>You can use <code>print :: Show a =&gt; a -&gt; IO ()</code> that will print anything that has a Show instance.</p>\n\n<p>As a side note: You could've used <code>mapM_ print</code> instead.</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1528223334, "creation_date": 1528223334, "answer_id": 50706727, "question_id": 50706590, "link": "https://stackoverflow.com/questions/50706590/process-list-of-pairs-in-haskell/50706727#50706727", "title": "Process list of pairs in Haskell", "body": "<p>Spaces don't affect operator precedence.</p>\n\n<p><code>showList (x, y):[]</code> parses as <code>(showList (x, y)) : []</code>.</p>\n\n<p>Function application has higher precedence than any infix operator, including <code>:</code>.</p>\n\n<p>You want</p>\n\n<pre><code>showList ((x, y) : []) = ...\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 5748372, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f8373ead3307a5d0d1669b790f29ddbd?s=128&d=identicon&r=PG&f=1", "display_name": "Isengardium", "link": "https://stackoverflow.com/users/5748372/isengardium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 50706727, "answer_count": 2, "score": -2, "last_activity_date": 1528223723, "creation_date": 1528222841, "question_id": 50706590, "link": "https://stackoverflow.com/questions/50706590/process-list-of-pairs-in-haskell", "title": "Process list of pairs in Haskell", "body": "<p>I am trying to go thorough a list of pairs, [(a, a)], but I can't get to make it work. I tried something like:</p>\n\n<pre><code>showList :: [(a, a)] -&gt; IO ()\nshowList (x, y):[] = putStrLn (x, y)\nshowList (x, y):xs = do \n    putStrLn (x, y)\n    showList xs\n</code></pre>\n\n<p>Any solution to this? I'd like something like what I done there.</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "edited": false, "score": 0, "creation_date": 1528227779, "post_id": 50706929, "comment_id": 88424649, "body": "Ok so i have it working now... firstly, your answer was extremely close to what i am working on with very subtle differences... nevertheless, i got the following error when testing your code snippet: <code>Not in scope: type constructor or class \u2018Aeson.FromJSON\u2019</code>. instead i used the following: <code>let result = Data.Aeson.Types.fromJSON resBody :: Data.Aeson.Types.Result Coord</code>."}, {"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "edited": false, "score": 0, "creation_date": 1528228215, "post_id": 50706929, "comment_id": 88424834, "body": "apparently, i dont have a good enough rep to give your answer an UP vote haha ;-p"}, {"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "edited": false, "score": 0, "creation_date": 1528228802, "post_id": 50706929, "comment_id": 88425107, "body": "... just realised you had <code>import qualified Data.Aeson as Aeson</code> in your code snippet, i didnt have that while testing, i presume with that your code snippet would have worked for me too :) @DanBurton"}], "tags": [], "owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "is_accepted": false, "score": 2, "last_activity_date": 1528224129, "creation_date": 1528224129, "answer_id": 50706929, "question_id": 50706368, "link": "https://stackoverflow.com/questions/50706368/yesod-cast-responsebody-to-a-haskell-type/50706929#50706929", "title": "yesod cast &quot;responseBody&quot; to a haskell type", "body": "<p>Where the value came from doesn't seem to matter. You've got a hold of a piece of data with type <code>Aeson.Value</code>, so you just have to figure out how to succeed in your attempts with fromJSON.</p>\n\n<p>Here's a bit of code adapted from the docs for <a href=\"https://www.stackage.org/haddock/lts-11.11/aeson-1.2.4.0/Data-Aeson.html#t:FromJSON\" rel=\"nofollow noreferrer\">the FromJSON class</a></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.Aeson as Aeson\nimport qualified Data.HashMap.Strict as HashMap\n\nimport Data.Aeson ((.:))\nimport Data.Text (Text)\n\n-- this is the data you already have, which you named resBody\nresBody :: Aeson.Value\nresBody = Aeson.Object $\n  HashMap.fromList\n    [ (\"val1\", Aeson.Number 1.0)\n    , (\"val2\", Aeson.String \"text\")]\n\n-- Step 1: create a custom Haskell data type to house the data.\n-- I named it Coord to match the example code from the link above,\n-- but you should probably give it a more meaningful name.\ndata Coord = Coord { x :: Double, y :: Text }\n  deriving (Show)\n\n-- Step 2: write a FromJSON instance for your custom data type.\n-- In this case, it is almost identical to the example code in the docs.\ninstance Aeson.FromJSON Coord where\n  parseJSON = Aeson.withObject \"Coord\" $ \\v -&gt; Coord\n    &lt;$&gt; v .: \"val1\"\n    &lt;*&gt; v .: \"val2\"\n</code></pre>\n\n<p>Giving it a spin in the repl</p>\n\n<pre><code>ghci&gt; -- Here's our data\nghci&gt; resBody\nObject (fromList [(\"val1\",Number 1.0),(\"val2\",String \"text\")])\nghci&gt; -- Next, we decode using fromJSON, annotating the result as our desired type\nghci&gt; Aeson.fromJSON resBody :: Aeson.Result Coord\nSuccess (Coord {x = 1.0, y = \"text\"})\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528224129, "creation_date": 1528221951, "question_id": 50706368, "link": "https://stackoverflow.com/questions/50706368/yesod-cast-responsebody-to-a-haskell-type", "title": "yesod cast &quot;responseBody&quot; to a haskell type", "body": "<p>the following code makes an api call in yesod. the question is how do i \"cast\" the resulting object to a predefined haskell type?</p>\n\n<pre><code>Network.HTTP.Conduit.withManager $ \\manager -&gt; do\n    response &lt;- http req manager\n    resBody &lt;- responseBody response C.$$+- sinkParser json\n    liftIO $ putStrLn $ T.pack (show resBody)\n</code></pre>\n\n<p>example output log</p>\n\n<pre><code>Object (fromList [(\"val1\",Number 1.0),(\"val2\",String \"text\")])\n</code></pre>\n\n<p>all the attempts i have made to decode with Aeson or fromJSON are failing.</p>\n\n<p>much appreciated</p>\n\n<p>yunis</p>\n"}, {"tags": ["haskell", "httprequest", "elm", "web-development-server", "scotty"], "comments": [{"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1528221805, "post_id": 50706306, "comment_id": 88421783, "body": "Do you see any errors logged in the browser console? Are you serving the Elm code from the same port (localhost:3000)?"}, {"owner": {"reputation": 105, "user_id": 7977320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VlKB.png?s=128&g=1", "display_name": "Harold Fincher", "link": "https://stackoverflow.com/users/7977320/harold-fincher"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1528222018, "post_id": 50706306, "comment_id": 88421896, "body": "no its served on a different port but there actually is an error message in the console (didn&#39;t even thing about looking there :D)  backup.elm:1 Failed to load <a href=\"http://localhost:3000/get\" rel=\"nofollow noreferrer\">localhost:3000/get</a>: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;<a href=\"http://localhost:8000\" rel=\"nofollow noreferrer\">localhost:8000</a>&#39; is therefore not allowed access."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 2, "creation_date": 1528222031, "post_id": 50706306, "comment_id": 88421901, "body": "These errors are often due to Cross-Origin Request Sharing (CORS) restrictions. You may need to modify your server to allow cross-origin requests. <a href=\"https://hackage.haskell.org/package/wai-cors\" rel=\"nofollow noreferrer\">Here is an example using <code>wai-cors</code></a>"}, {"owner": {"reputation": 105, "user_id": 7977320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VlKB.png?s=128&g=1", "display_name": "Harold Fincher", "link": "https://stackoverflow.com/users/7977320/harold-fincher"}, "edited": false, "score": 0, "creation_date": 1528222321, "post_id": 50706306, "comment_id": 88422018, "body": "thx, solved it!"}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 11, "last_activity_date": 1528222173, "creation_date": 1528222173, "answer_id": 50706418, "question_id": 50706306, "link": "https://stackoverflow.com/questions/50706306/haskell-scotty-and-elm-http-networkerror/50706418#50706418", "title": "Haskell Scotty and Elm Http NetworkError", "body": "<p>It sounds like your problem is due to Cross-Origin Request Sharing (CORS) restrictions. You can use <a href=\"https://hackage.haskell.org/package/wai-cors\" rel=\"noreferrer\">wai-cors</a> to set your CORS policy.</p>\n\n<p>Example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Web.Scotty\nimport Network.Wai.Middleware.Cors\n\nmain = scotty 3000 $ do\n    middleware simpleCors\n    get \"/get\" $ json (\"hello world\" :: String)\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7977320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VlKB.png?s=128&g=1", "display_name": "Harold Fincher", "link": "https://stackoverflow.com/users/7977320/harold-fincher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 444, "favorite_count": 1, "accepted_answer_id": 50706418, "answer_count": 1, "score": 6, "last_activity_date": 1528222173, "creation_date": 1528221697, "question_id": 50706306, "link": "https://stackoverflow.com/questions/50706306/haskell-scotty-and-elm-http-networkerror", "title": "Haskell Scotty and Elm Http NetworkError", "body": "<p>I wanted to look into web development with haskell for the back-end and elm for the front-end. So i wrote this two simple \"hello world\" code code snippets</p>\n\n<p>elm:</p>\n\n<pre><code>import Html exposing (..)\nimport Html.Events exposing (..)\nimport Http\nimport Json.Decode as Decode\n\nmain : Program Never Model Msg\nmain = Html.program\n  { view = view\n  , update = update\n  , init = (\"default\", Cmd.none)\n  , subscriptions = \\_ -&gt; Sub.none }\n\ntype alias Model = String\n\ntype Msg = Get | Response (Result Http.Error String)\n\nupdate : Msg -&gt; Model -&gt; (Model, Cmd Msg)\nupdate msg model = case msg of\n  Get -&gt; (model, get)\n  Response (Ok s) -&gt; (s, Cmd.none)\n  Response (Err e) -&gt; (toString e, Cmd.none)\n\n\nview : Model -&gt; Html Msg\nview model = div []\n  [button [onClick (Get)] [text \"click me\"],\n   text model]\n\n\nget : Cmd Msg\nget =  let url = \"http://localhost:3000/get\"\n       in Http.send Response (Http.get url Decode.string)\n</code></pre>\n\n<p>haskell/scotty:</p>\n\n<pre><code>import Web.Scotty\n\nmain = scotty 3000 $ get \"/get\" $ json (\"hello world\" :: String)\n</code></pre>\n\n<p>both work perfectly on their own - meaning the elm code can get data from servers like httpbin and the scotty server handles requests i send with a browser or tools like wget/curl etc fine but when i try to use the two together the http.send call in elm returns a network error</p>\n\n<p>i suspected it may be a problem that both servers are hosted on the same computer (wouldn't know why but i wanted to eliminate the possibility) so i hosted the client site on another computer which i know has a working connection to the computer which hosts the spock back-end (works with wget etc) but it still didn't work. </p>\n\n<p>am i missing something obvious, or what is the problem?\nthx in advance</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "is_accepted": false, "score": 0, "last_activity_date": 1528234890, "last_edit_date": 1528234890, "creation_date": 1528222090, "answer_id": 50706395, "question_id": 50706265, "link": "https://stackoverflow.com/questions/50706265/confused-with-nested-lambda-types-in-haskell/50706395#50706395", "title": "Confused with nested lambda types in haskell", "body": "<p>The type of <code>x</code> in <code>\\x -&gt; \\y -&gt; x y</code> is <code>t1 -&gt; t2</code>, and it's the first argument.\nAs the outermost lambda, it gets applied first, followed by <code>y</code></p>\n\n<p>You could've written it as <code>\\x y -&gt; x y</code> which is just function application in the natural order.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1528222943, "creation_date": 1528222943, "answer_id": 50706619, "question_id": 50706265, "link": "https://stackoverflow.com/questions/50706265/confused-with-nested-lambda-types-in-haskell/50706619#50706619", "title": "Confused with nested lambda types in haskell", "body": "<blockquote>\n<pre><code>:t \\x -&gt; (\\y -&gt; x y)\n\\x -&gt; (\\y -&gt; x y) :: (t1 -&gt; t2) -&gt; t1 -&gt; t2\n</code></pre>\n  \n  <p>shouldn't the type here be t1->(t2->t1->t2) ?</p>\n</blockquote>\n\n<p>No, <code>t1-&gt;(t2-&gt;t1-&gt;t2)</code> is the same as <code>t1-&gt;t2-&gt;t1-&gt;t2</code> which is the type of a three-arguments function (of type <code>t1</code>, <code>t2</code>, and <code>t1</code>) returning <code>t2</code>. However, there are only two lambdas, for the two arguments <code>x</code> and <code>y</code>.</p>\n\n<p>The right type is instead</p>\n\n<pre><code>typeOfX -&gt; (typeofY -&gt; typeOfResult)\n\\x -&gt;      (\\y -&gt;      x y)\n</code></pre>\n\n<p>(By the way, none of the parentheses above are needed.)</p>\n\n<p>What is <code>typeOfResult</code>? Is is the type of <code>x y</code>, so it is the return type for <code>x</code> which must be a function. </p>\n\n<p>In order for the code to type check, we must then have that <code>typeOfX</code> is a function type, say <code>a -&gt; b</code>. In such case we can see that <code>typeOfResult = b</code>. Further, in <code>x y</code> we pass <code>y</code> to <code>x</code>, and this can type check only if <code>typeOfY = a</code>.</p>\n\n<p>So,</p>\n\n<pre><code>typeOfX  -&gt; typeofY -&gt; typeOfResult\n=\n(a -&gt; b) -&gt; a       -&gt; b\n</code></pre>\n\n<p>The compiler used names <code>t1</code> and <code>t2</code>, but this is the same type.</p>\n\n<p>Parentheses here matter, since we must remember that <code>x</code> is a function <code>a -&gt; b</code>.\nWithout parentheses we would get a three-argument function, as explained above.</p>\n\n<p>You can try to apply the same reasoning to the second example. Start from \n<code>typeOfX -&gt; typeofY -&gt; typeOfK -&gt; TypeOfResult</code>, and slowly discover what these types actually are.</p>\n"}], "owner": {"reputation": 310, "user_id": 7111260, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/4396b30cd1f9478a74c83da8bc2819dc?s=128&d=identicon&r=PG&f=1", "display_name": "oren revenge", "link": "https://stackoverflow.com/users/7111260/oren-revenge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 50706619, "answer_count": 2, "score": 0, "last_activity_date": 1528234890, "creation_date": 1528221537, "question_id": 50706265, "link": "https://stackoverflow.com/questions/50706265/confused-with-nested-lambda-types-in-haskell", "title": "Confused with nested lambda types in haskell", "body": "<p>Just trying to see the types of some lambda expressions like this one:</p>\n\n<pre><code>:t \\x -&gt; (\\y -&gt; x y)\n\\x -&gt; (\\y -&gt; x y) :: (t1 -&gt; t2) -&gt; t1 -&gt; t2\n</code></pre>\n\n<p>shouldn't the type here be <code>t1-&gt;(t2-&gt;t1-&gt;t2)</code> ? </p>\n\n<p>Similarly </p>\n\n<pre><code>:t \\x -&gt; (\\y -&gt; (\\k -&gt; y (x k)))\n\\x -&gt; (\\y -&gt; (\\k -&gt; y (x k)))\n  :: (t1 -&gt; t2) -&gt; (t2 -&gt; t3) -&gt; t1 -&gt; t3\n</code></pre>\n\n<p>Shouldn't the type be <code>t1-&gt;(t2-&gt;(t3-&gt;t2))</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1528252115, "post_id": 50705757, "comment_id": 88431777, "body": "You can find this list useful: <a href=\"https://github.com/takenobu-hs/haskell-symbol-search-cheatsheet\" rel=\"nofollow noreferrer\">github.com/takenobu-hs/haskell-symbol-search-cheatsheet</a>"}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1528219835, "post_id": 50705810, "comment_id": 88420840, "body": "It&#39;s a tad bit more than human convention though  - GHC won&#39;t give unused variable warnings for underscore-prefixed variables."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 3, "last_activity_date": 1528219715, "creation_date": 1528219715, "answer_id": 50705810, "question_id": 50705757, "link": "https://stackoverflow.com/questions/50705757/what-in-haskell-does-an-underscore-preceding-a-variable-mean/50705810#50705810", "title": "What, in Haskell, does an underscore preceding a variable mean?", "body": "<p>It's just a convention to mark an unused variable. As you see, <code>_f</code> isn't used in the definition of <code>#.</code>, so it is marked with the underscore.</p>\n"}, {"comments": [{"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1574878125, "post_id": 50705888, "comment_id": 104389617, "body": "To me it looks like the single underscore name has something more than names starting with underscore. The former can be used more than once in a single match without triggering the <i>Conflicting definitions for \u2018_\u2019</i> error; furthermore, it cannot be used in the rhs of <code>=</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1574886170, "post_id": 50705888, "comment_id": 104392940, "body": "@EnricoMariaDeAngelis Correct, a single underscore is special: it is not a valid variable name at all, in fact! It <i>is</i> a pattern, which matches anything, and binds no names. (And this pattern is even mentioned off-hand in the answer.)"}, {"owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "edited": false, "score": 0, "creation_date": 1574886327, "post_id": 50705888, "comment_id": 104392994, "body": "Ok, it was not apparent to me from your (nonetheless excellent) answer."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 19, "last_activity_date": 1528220340, "last_edit_date": 1528220340, "creation_date": 1528219973, "answer_id": 50705888, "question_id": 50705757, "link": "https://stackoverflow.com/questions/50705757/what-in-haskell-does-an-underscore-preceding-a-variable-mean/50705888#50705888", "title": "What, in Haskell, does an underscore preceding a variable mean?", "body": "<p>According to the Haskell spec, it is just another possible name for a variable. But the truth is a bit longer, because most Haskell developers write code specifically for GHC, and this is one of those times.</p>\n\n<p>GHC has lots of helpful warnings; one is to warn you when you write a pattern that binds a variable that isn't used in the body of the function. It's pretty handy, and has caught a couple bugs of mine. However, it has a knock-on effect: if you write a function that uses some of the variables only in one clause or the other, you get a warning. For example, here is a very natural definition of <code>foldr</code> on lists:</p>\n\n<pre><code> foldr f z [] = z\n foldr f z (x:xs) = x `f` foldr f z xs\n</code></pre>\n\n<p>Oops! We didn't use <code>f</code> in the first clause, and we'll get a warning. Okay, so it's easy enough to fix:</p>\n\n<pre><code>foldr _ z [] = z\nfoldr f z (x:xs) = x `f` foldr f z xs\n</code></pre>\n\n<p>Unfortunately now we've lost the information about what that first variable's role in the code is supposed to be. In this case, <code>foldr</code> is so familiar that it's no big loss, but in unfamiliar codebases with functions that take a lot of arguments, it can be nice to know what data is ignored by each \"hole\". So GHC adds a special rule: the warning about unused variables doesn't warn you about variable names that start with <code>_</code> -- by analogy to the <code>_</code> pattern that it also doesn't warn you about. So now I can write:</p>\n\n<pre><code>foldr _f z [] = z\nfoldr  f z (x:xs) = x `f` foldr f z xs\n</code></pre>\n\n<p>Now I get the best of both worlds: I get a nice warning if I forget to use a variable I bound, and I can still give the reader information about the meaning of the holes in patterns that I don't need for the current clause. (As a side note, I'd love an additional warning that reported if I <em>do</em> mistakenly use a variable starting with <code>_</code>, but I don't think it exists at the moment! It sounds stupid (\"just don't type <code>_</code> in a function body\"), but I've found my editor's tab-completion occasionally inserting them for me, and it would be easy not to notice if you were coding quickly.)</p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1116, "favorite_count": 1, "accepted_answer_id": 50705888, "answer_count": 2, "score": 8, "last_activity_date": 1528220340, "creation_date": 1528219516, "question_id": 50705757, "link": "https://stackoverflow.com/questions/50705757/what-in-haskell-does-an-underscore-preceding-a-variable-mean", "title": "What, in Haskell, does an underscore preceding a variable mean?", "body": "<p>I was browsing the source of Data.Foldable, where I came accross <code>Endo #. f</code>, and upon clicking this link, was confronted with:</p>\n\n<pre><code>(#.) _f = coerce\n</code></pre>\n\n<p>Now, first, I don't know what <code>coerce</code> and the before-that mentioned <code>Coercible</code> is, however, it baffles me more what the <code>_f</code> could mean. I have searched \"Haskell underscore before variable\" and similar and have only found discussions about the <code>_</code> pattern matching syntax.</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1528210274, "post_id": 50702929, "comment_id": 88415449, "body": "<code>f</code> has the wrong kind to be <code>Monoid</code>."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1528210507, "post_id": 50702929, "comment_id": 88415596, "body": "yeah but how could we express it in Applicative ? are we limited by what haskell can do ? I&#39;d like to understand why we see nothing about Monoid when we look at the definition.."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1528211209, "post_id": 50702929, "comment_id": 88416055, "body": "Because the term &quot;monoidal functor&quot; is one chunk that can&#39;t be broken into to pieces, &quot;a monoid and a functor&quot;. It means a functor that acts on a monoidal category and preserves the monoidal structure of that category; and again here &quot;monoidal category&quot; is a single term that can&#39;t be broken in two."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528211432, "post_id": 50702929, "comment_id": 88416206, "body": "See also: <a href=\"https://ncatlab.org/nlab/show/monoidal+functor\" rel=\"nofollow noreferrer\">definition of a monoidal functor</a>, <a href=\"https://stackoverflow.com/q/41400846/791604\">Applicative functors as monoidal functors</a>, and <a href=\"https://stackoverflow.com/questions/23316255/lax-monoidal-functors-with-a-different-monoidal-structure\">Lax monoidal functors with a different monoidal structure</a>. Probably should be a dupe of one of the latter two, but not sure which; which one do you find more helpful?"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528212111, "post_id": 50702929, "comment_id": 88416626, "body": "@DanielWagner I understand the definition but I don&#39;t understand why the implementation in ghc does not refer about Monoid in the definition of Applicative : Ex (&quot;ab&quot;,(+1)) &lt;*&gt; (&quot;cd&quot;, 5) gives (&quot;abcd&quot;, 6), you can clearly see the use of a Monoid &quot;(,) String&quot;, I like your links btw.. so can&#39;t we express the &quot;monoidal natural transformation&quot; of the functor structure in the definition of the Applicative typeclass ?"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528212484, "post_id": 50702929, "comment_id": 88416865, "body": "@DanielWagner I don&#39;t understand why you are saying that a &quot;monoidal functor&quot; can&#39;t be broken into 2 concepts, isn&#39;it what typeclass functor vs applicative are doing ?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1528212777, "post_id": 50702929, "comment_id": 88417057, "body": "<code>Monoid</code> does not cover all monoids that can be expressed in Haskell, but only those on ordinary types (that is, things with <code>*</code> kind, as Lee alludes to)."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528213434, "post_id": 50702929, "comment_id": 88417437, "body": "@duplode look at my update (I use a Integer with an apply which has no Monoid instance), I&#39;m showing that the concept of Monoid is used somewhere but not expressed in the signature of the typeclass. How it is possible ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1528219078, "post_id": 50702929, "comment_id": 88420497, "body": "@NicolasHenin It is expressed in the instance declaration for a particular <code>Applicative</code>, namely, <code>instance Monoid a =&gt; Applicative ((,) a)</code>; and the <code>Monoid</code> constraint in that instance declaration has no relation to the &quot;monoidal-functor-ness&quot; of <code>Applicative</code> as a concept."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528311049, "post_id": 50702929, "comment_id": 88463236, "body": "well @DanielWagner I disagree with you it&#39;s used as a part of the monoidal structure of the functor which is (,) a..."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528311098, "post_id": 50702929, "comment_id": 88463259, "body": "you can have a look here where they are talking about the same think : <a href=\"https://stackoverflow.com/questions/45010424/how-are-monoid-and-applicative-connected\" title=\"how are monoid and applicative connected\">stackoverflow.com/questions/45010424/&hellip;</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528342312, "post_id": 50702929, "comment_id": 88472854, "body": "@NicolasHenin Consider <code>Just (+1) &lt;*&gt; Just 5</code>. There is no <code>Monoid</code> in sight, and yet it works just fine. The structural monoid need not involve a <code>Monoid</code>."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528377450, "post_id": 50702929, "comment_id": 88492031, "body": "You should read the chapter 17 about Applicative, I&#39;m not inventing anything... (<a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>), The structural monoid here is that decision taken on the structure of the Functor Maybe where  Just &lt;&gt; Just = Just and Nothing &lt;&gt; _ = Nothing, and where Just is the identity Element ...."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528386889, "post_id": 50702929, "comment_id": 88498738, "body": "@NicolasHenin I&#39;m not objecting to that. My point is that you appear to be confusing the concept of monoid (a kind of algebraic structure that shows up in many places across Haskell) with the <code>Monoid</code> type class (which is just one specific manifestation of that concept)."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528395984, "post_id": 50702929, "comment_id": 88503323, "body": "I&#39;m not confusing... I wanted to know why the concept of Monoid (and not the typeclass Monoid) was not expressed in the Applicative typeclass... It&#39;s implicitly provided in the instances instead....Pigworker explained it to me.... Sorry but I have the impression I&#39;m repeating myself..."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528396433, "post_id": 50702929, "comment_id": 88503566, "body": "I would have used explicitly the term &quot;Monoid Typeclass&quot; if it was the case..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528478258, "post_id": 50702929, "comment_id": 88538678, "body": "@NicolasHenin Sorry if I&#39;m being annoying or pedantic, but I don&#39;t feel &quot;implicitly provided in the instances instead&quot; says all that much. If it comes to that, we might also say that the monoids in the <code>Monoid</code> class are also &quot;provided in the instances&quot; -- after all, a misguided implementer might write an unlawful <code>Monoid</code> instance that isn&#39;t actually a monoid. I&#39;d rather say that <code>Applicative</code> <i>inherently</i> expresses a certain sort of monoid, just like <code>Monoid</code> does. I&#39;d say that is also the takeaway from pigworker&#39;s answer (in particular, cf. the very last paragraph)."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528547605, "post_id": 50702929, "comment_id": 88555527, "body": "You are not annoying or pedantic and I really appreciate your participation btw :-) Also I finally understood that difference between the &quot;monoidal functor&quot; and these others monoids used to squash the structure... I agree with what you are saying @duplode :-) I love haskell it&#39;s so cool :-)"}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1528214026, "post_id": 50703828, "comment_id": 88417790, "body": "Categorical monoids are only associative up to isomorphism, so it&#39;s OK."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528264712, "post_id": 50703828, "comment_id": 88435060, "body": "I always find it awkward to pick a name (or an operator symbol) to talk about the <code>f a -&gt; f b -&gt; f (a,b)</code> combinator (or its uncurried version). <code>fzip</code> is not half bad -- in fact, I might end up adopting it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1528268875, "post_id": 50703828, "comment_id": 88437097, "body": "@duplode well, I thought a lot about these names when I wrote the <a href=\"http://hackage.haskell.org/package/constrained-categories-0.3.1.0/docs/Control-Applicative-Constrained.html#t:Monoidal\" rel=\"nofollow noreferrer\">constrained <code>Applicative</code> class</a>. (There I actually had to use uncurried and category-agnostic signatures, which makes it a whole lot more awkward.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528289972, "post_id": 50703828, "comment_id": 88450437, "body": "@leftaroundabout I had forgotten about looking in your <i>constrained-categories</i> while looking for existing names on Hackage (and, as you can imagine, my Hoogle/Hayoo searches by type signature didn&#39;t lead me to it)."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528291960, "post_id": 50703828, "comment_id": 88451849, "body": "It&#39;s a actually a concept of multiplication where you factorize the f, and this is maybe where the * from &lt;*&gt; is coming from.... and actually that operation of factorization is the application of the monoid on the functor  structure I was talking about earlier... &quot;that doesn&#39;t have much to do with Applicative in general,&quot; @leftaroundabout, I disagree with that statement, the functor in that context is (a,_) and then you need to provide a way to do that factorization with (,) and a together... This is why when you implement a applicative for tuple, a needs to be a monoid."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528292201, "post_id": 50703828, "comment_id": 88452038, "body": "have a look here : <a href=\"https://stackoverflow.com/questions/41400846/applicative-functors-as-monoidal-functors\" title=\"applicative functors as monoidal functors\">stackoverflow.com/questions/41400846/&hellip;</a>"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528292343, "post_id": 50703828, "comment_id": 88452149, "body": "and look at that one as well : <a href=\"https://stackoverflow.com/questions/45010424/how-are-monoid-and-applicative-connected\" title=\"how are monoid and applicative connected\">stackoverflow.com/questions/45010424/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528292523, "post_id": 50703828, "comment_id": 88452283, "body": "@NicolasHenin well yeah, that \u201cmultiplication\u201d is basically the type product <code>(,)</code>. But, there is nothing intrinsic to monoidal functors which has more to do with multiplication than with addition; in category theory \u201cproduct\u201d and \u201ccoproduct\u201d are very abstract. \u2014 Please elaborate what you disagree with; at the moment you have merely re-stated what I already wrote in my answer. (I&#39;m not sure if the confusion stems from the fact that we&#39;re discussing both <code>(,)</code> as the product operator, and the <code>(a,)</code> functor. These uses of the tuple type are actually unrelated, we might better discuss <code>Writer</code>.)"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528295192, "post_id": 50703828, "comment_id": 88454089, "body": "OK I understand the misunderstanding (I guess :-))... this is coming from that book : <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>, with that statement &quot;So, with Applicative, we have a Monoid for our structure and function application for our values!&quot;, the origin of this post was to ask what are the reasons why haskell didn&#39;t abstract this notion of &quot;moinoid in the structure&quot; in the typeclass Applicative. The exemple with tuple was just to show, that these laws for the structure are not enforced or expressed in the typeclass itself..."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528295201, "post_id": 50703828, "comment_id": 88454097, "body": "and the constraint added (Monoid under a) is a direct application of the general notion of Applicative. If we would write an Applicative for a bigger tuple let&#39;s say (a,b,c,d) I would add a constraint Monoid under a,b,c to implement the instance to respect the laws of an Applicative. Is it improving the misunderstanding ?"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528295582, "post_id": 50703828, "comment_id": 88454386, "body": "I didn&#39;t express it clearly about (&quot;ab&quot;,(+1)) &lt;*&gt; (&quot;cd&quot;, 5) sorry"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528296324, "post_id": 50703828, "comment_id": 88454885, "body": "Hm. I think it&#39;s better to think of the occurence of these <code>Monoid</code>s in the class of monoidal functors as a coincidence. This only works because the <code>(,)</code> type-level monoid happens to support <code>const mempty :: Monoid a =&gt; Mempty -&gt; a</code> and <code>uncurry (&lt;&gt;) :: Monoid a =&gt; (a,a) -&gt; a</code>. If working in a category where the type-monoid is something else, say, <code>Either</code>, then none of this makes any sense. \u2014 Of course, it&#39;s <i>not</i> really a coincidence that <code>(,)</code> works this way, but at any rate, it&#39;s much more specific and only works with monoidal <b>Hask</b> endofunctors, not with general monoidal functors."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528313345, "post_id": 50703828, "comment_id": 88464282, "body": "@leftaroundabout about Either, that&#39;s the way I would see it : <a href=\"https://stackoverflow.com/questions/22264376/is-there-a-standard-name-or-implementation-of-the-purely-applicative-either\" title=\"is there a standard name or implementation of the purely applicative either\">stackoverflow.com/questions/22264376/&hellip;</a> , Same idea, you define a &quot;monoidal structure&quot;  for Either a"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528313391, "post_id": 50703828, "comment_id": 88464306, "body": "but yeah there are also maybe multiples moinoid for that structure, it&#39;s not implemented that way in Data.Either though..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528314789, "post_id": 50703828, "comment_id": 88464974, "body": "@NicolasHenin that&#39;s a completely different subject, you&#39;re talking again about applicative <i>instances</i> of <code>Either e</code>. I meant <code>Either</code> as a type-level monoid. Can be used, but with it, <code>Monoidal</code> comes out completely different from <code>Applicative</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528343636, "post_id": 50703828, "comment_id": 88473161, "body": "@NicolasHenin If you use <code>Either</code> as a type-level monoid in the way leftaroundabout suggests, <a href=\"http://h2.jaguarpaw.co.uk/posts/alternatives-convert-products-to-sums/\" rel=\"nofollow noreferrer\">you get <code>Alternative</code></a>."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528377996, "post_id": 50703828, "comment_id": 88492453, "body": "@leftaroundabout, the point of that post was to say that apparently in haskell you can&#39;t define that concept of monoidal structure,   so instead of being clearly define in the Applicative typeclass, it is implicitly defined in the Applicative Instances... This is what it is explained in that book (<a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>) chapter 17, around 100 pages on that subject with many examples. So there are 2 conflictual views on the subject, the one from the book looks the right one in my opinion. we can&#39;t just pretend that they implement that in the instances just for the fun of it, can we ?"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528378484, "post_id": 50703828, "comment_id": 88492836, "body": "@leftaroundabout, that post about Applicative Either e, shows you the logic of the monoidal structure that I&#39;m talking about, the logic of merge Left and Right together, Right and Right together and how you merge Left and Left togteher, because the e is part of the functor, then e has to be a monoid as well... It was to clearly showing you an example of that implicit Monoidal structure defined in the instance...."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528378930, "post_id": 50703828, "comment_id": 88493115, "body": "&quot;Applicative provides a way to squash the structure of a functor together.&quot; =&gt; the monoid of the structure, that&#39;s how Christopher Allen,Julie Moronuki explain it. It&#39;s a super clean and simple way to see it and it explains How Applicative List ,Maybe,Either, Tuple... works"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528379214, "post_id": 50703828, "comment_id": 88493317, "body": "I haven&#39;t read it so I don&#39;t really want to judge, but I reckon they&#39;re wrong about the theory part. The reason that monoidal functors are named thus is deeper and more general than the <code>Applicative</code> class (which is rooted in <b>Hask</b> and pigworker is right that restricting yourself to that category is a bad idea \u2013 though I don&#39;t consider the term itself inappropriate). Only in <b>Hask</b> do you get the effect that monoidal functors spawn all kinds of value-level monoids; as I said the reason is that <code>const mempty</code> and <code>uncurry (&lt;&gt;)</code> link the type- and value-level monoids."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528379627, "post_id": 50703828, "comment_id": 88493587, "body": "That doesn&#39;t mean it&#39;s a bad view to say \u201cApplicative provides a way to squash the structure of a functor together\u201d. It does that, and this is very much a monoid-thing. It&#39;s just not a direct consequence of the monoidalness of the functors."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528404076, "post_id": 50703828, "comment_id": 88507375, "body": "@leftaroundabout I finally understood that &quot;monoidalness of the functors&quot; with this monoidal natural transformation F a x F b -&gt; F (a # b), my apologies for that stubbornness, but I had a conflictual version with my book... I wanted to understand :-) btw I have contacted the author to clarify his reasoning..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 16, "last_activity_date": 1528214198, "last_edit_date": 1528214198, "creation_date": 1528212524, "answer_id": 50703828, "question_id": 50702929, "link": "https://stackoverflow.com/questions/50702929/monoidal-functor-is-applicative-but-where-is-the-monoid-typeclass-in-the-definit/50703828#50703828", "title": "Monoidal Functor is Applicative but where is the Monoid typeclass in the definition of Applicative?", "body": "<p>The monoid that's referred to with \u201cmonoidal functor\u201d is not a <code>Monoid</code> monoid, i.e. a value-level monoid. It's a <em>type-level monoid</em> instead. Namely, the boring product monoid</p>\n\n<pre><code>type Mempty = ()\ntype a &lt;&gt; b = (a,b)\n</code></pre>\n\n<p>(You may notice that this is not strictly speaking a monoid; it's only if you consider <code>((a,b),c)</code> and <code>(a,(b,c))</code> as the same type. They are sure enough isomorphic.)</p>\n\n<p>To see what this has to do with <code>Applicative</code>, resp. monoidal functors, we need to write the class in other terms.</p>\n\n<pre><code>class Functor f =&gt; Monoidal f where\n  pureUnit :: f Mempty\n  fzip :: f a -&gt; f b -&gt; f (a&lt;&gt;b)\n\n-- an even more \u201cgeneral nonsense\u201d, equivalent formulation is\n-- upure :: Mempty -&gt; f Mempty\n-- fzipt :: (f a&lt;&gt;f b) -&gt; f (a&lt;&gt;b)\n-- i.e. the functor maps a monoid to a monoid (in this case the same monoid).\n-- That's really the mathematical idea behind this all.\n</code></pre>\n\n<p>IOW</p>\n\n<pre><code>class Functor f =&gt; Monoidal f where\n  pureUnit :: f ()\n  fzip :: f a -&gt; f b -&gt; f (a,b)\n</code></pre>\n\n<p>It's a simple exercise to define a generic instance of the standard <code>Applicative</code> class in terms of <code>Monoidal</code>, vice versa.</p>\n\n<hr>\n\n<p>Regarding <code>(\"ab\",(+1)) &lt;*&gt; (\"cd\", 5)</code>: that doesn't have much to do with <code>Applicative</code> in general, but only with the writer applicative specifically. The instance is</p>\n\n<pre><code>instance Monoid a =&gt; Monoidal ((,) a) where\n  pureUnit = (mempty, ())\n  fzip (p,a) (q,b) = (p&lt;&gt;q, (a,b))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 182, "user_id": 3016387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00431e21cdc60799fc8122044f77b917?s=128&d=identicon&r=PG", "display_name": "Max New", "link": "https://stackoverflow.com/users/3016387/max-new"}, "edited": false, "score": 0, "creation_date": 1528284320, "post_id": 50717675, "comment_id": 88446771, "body": "Who is the Hancock you are referencing?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528290709, "post_id": 50717675, "comment_id": 88450924, "body": "One library that offers the <code>AppM</code> newtype at the very beginning of this answer is <a href=\"https://hackage.haskell.org/package/reducers-3.12.1/docs/Data-Semigroup-Applicative.html#t:Ap\" rel=\"nofollow noreferrer\"><i>reducers</i>, where it is called <code>Ap</code></a>."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1528298855, "post_id": 50717675, "comment_id": 88456622, "body": "@pigworker are you referring to that document (<a href=\"https://www.sciencedirect.com/science/article/pii/S0304397505003373?via%3Dihub\" rel=\"nofollow noreferrer\">sciencedirect.com/science/article/pii/&hellip;</a>) when speaking about Abbott, Altenkirch and Ghani ?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1528301882, "post_id": 50717675, "comment_id": 88458437, "body": "I mean <a href=\"https://dblp.uni-trier.de/pers/hd/h/Hancock:Peter\" rel=\"nofollow noreferrer\">Peter Hancock</a>, who did a lot of work on modelling interaction in type theory at the same time as the container gang modelled data structures, using many of the same tools."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1528302061, "post_id": 50717675, "comment_id": 88458522, "body": "And yes, that&#39;s the correct &quot;Abbott, Altenkirch and Ghani&quot;, who were based in Leicester and Nottingham in the mid 2000s and colloquially referred to as the &quot;East Midlands Container Consortium&quot;. I joined in for the subsequent papers. Peter Morris and Peter Hancock got involved, too."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1528306577, "post_id": 50717675, "comment_id": 88460946, "body": "Some of this reminds me of Edward Kmett&#39;s talk on <code>Applicative</code> as a monoid object in the category of Hask endofunctors. <a href=\"https://youtu.be/cB8DapKQz-I\" rel=\"nofollow noreferrer\">youtu.be/cB8DapKQz-I</a>"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1528308694, "post_id": 50717675, "comment_id": 88462063, "body": "Will check that later, but it sounds likely. I wish people wouldn&#39;t call it &quot;Hask&quot;, though: it threatens to limit the imagination."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528381168, "post_id": 50717675, "comment_id": 88494811, "body": "I hope that subject about <b>Hask</b> will be discussed <a href=\"https://stackoverflow.com/questions/50735311/categorical-structure-in-haskell\">in that dedicated question asked today</a>. But, the more I think about it the more it seems you&#39;re being hypocritical, in particular here, when you want to dethrone <b>Hask</b> but on the other hand say things like \u201cthe monoid... <code>Ap</code>...Is fundamental to <code>Applicative</code>\u201d. I think there&#39;s nothing fundamental about this, instead it&#39;s a consequence of the particular properties of <b>Hask</b>, namely, of it being cartesian closed. That&#39;s also what allows this container stuff."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528484125, "post_id": 50717675, "comment_id": 88541064, "body": "@leftaroundabout I feel this is not so much about dethroning <b>Hask</b>, but rather a matter of presentation. It is not uncommon to see folks new to the categorical aspects of Haskell ask themselves questions like &quot;Where does X fit in [whatever they happen to believe to be <i>the</i> Haskell category]&quot; and end up confused as a result of the shoehorning attempt. On a related note, this discussion reminds me of <a href=\"https://stackoverflow.com/a/50595873/2751851\">this recent answer</a>, which tries to address the matter by talking about &quot;[the] default ambient category-esque structure&quot;."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 13, "last_activity_date": 1528302844, "last_edit_date": 1528302844, "creation_date": 1528279522, "answer_id": 50717675, "question_id": 50702929, "link": "https://stackoverflow.com/questions/50702929/monoidal-functor-is-applicative-but-where-is-the-monoid-typeclass-in-the-definit/50717675#50717675", "title": "Monoidal Functor is Applicative but where is the Monoid typeclass in the definition of Applicative?", "body": "<p>Perhaps the monoid you're looking for is this one.</p>\n\n<pre><code>newtype AppM f m = AppM (f m) deriving Show\n\ninstance (Applicative f, Monoid m) =&gt; Monoid (AppM f m) where\n  mempty                      = AppM (pure mempty)\n  mappend (AppM fx) (AppM fy) = AppM (pure mappend &lt;*&gt; fx &lt;*&gt; fy)\n</code></pre>\n\n<p>As a comment, below, observes, it can be found in the <a href=\"https://hackage.haskell.org/package/reducers-3.12.1/docs/Data-Semigroup-Applicative.html#t:Ap\" rel=\"noreferrer\">reducers</a> library under the name <code>Ap</code>. It's fundamental to <code>Applicative</code>, so let's unpack it.</p>\n\n<p>Note, in particular, that because <code>()</code> is trivially a <code>Monoid</code>, <code>AppM f ()</code> is a <code>Monoid</code>, too. And that's the monoid lurking behind <code>Applicative f</code>.</p>\n\n<p>We could have insisted on <code>Monoid (f ())</code> as a superclass of <code>Applicative</code>, but that would have fouled things up royally.</p>\n\n<pre><code>&gt; mappend (AppM [(),()]) (AppM [(),(),()])\nAppM [(),(),(),(),(),()]\n</code></pre>\n\n<p>The monoid underlying <code>Applicative []</code> is <em>multiplication</em> of natural numbers, whereas the &lsquo;obvious&rsquo; monoidal structure for lists is concatenation, which specialises to <em>addition</em> of natural numbers.</p>\n\n<p><strong>Mathematics warning. Dependent types warning. Fake Haskell warning.</strong></p>\n\n<p>One way to see what's going on is to consider those Applicatives which happen to be <em>containers</em> in the dependently typed sense of Abbott, Altenkirch and Ghani. We'll have these in Haskell sometime soon. I'll just pretend the future has arrived.</p>\n\n<pre><code>data (&lt;|) (s :: *)(p :: s -&gt; *) (x :: *) where\n  (:&lt;|:) :: pi (a :: s) -&gt; (p a -&gt; x) -&gt; (s &lt;| p) x\n</code></pre>\n\n<p>The data structure <code>(s &lt;| p)</code> is characterised by</p>\n\n<ul>\n<li><strong>Shapes</strong> <code>s</code> which tell you what the container looks like.</li>\n<li><strong>Positions</strong> <code>p</code> which tell you <em>for a given shape</em> where you can put data.</li>\n</ul>\n\n<p>The above type says that to give data for such a structure is to pick a shape, then fill all the positions with data.</p>\n\n<p>The container presentation of <code>[]</code> is <code>Nat &lt;| Fin</code> where</p>\n\n<pre><code>data Nat = Z | S Nat\ndata Fin (n :: Nat) where\n  FZ :: Fin (S n)\n  FS :: Fin n -&gt; Fin (S n)\n</code></pre>\n\n<p>so that <code>Fin n</code> has exactly <code>n</code> values. That is, the shape of a list is its <em>length</em>, and that tells you how many elements you need to fill up the list.</p>\n\n<p>You can find the shapes for a Haskell <code>Functor f</code> by taking <code>f ()</code>. By making the data trivial, the positions don't matter. Constructing the GADT of positions generically in Haskell is rather more difficult. </p>\n\n<p>Parametricity tells us that a polymorphic function between containers in</p>\n\n<pre><code>forall x. (s &lt;| p) x -&gt; (s' &lt;| p') x\n</code></pre>\n\n<p>must be given by</p>\n\n<ul>\n<li>a function <code>f :: s -&gt; s'</code> mapping input shapes to output shapes</li>\n<li>a function <code>g :: pi (a :: s) -&gt; p' (f a) -&gt; p a</code> mapping (for a given input shape) output positions back to the input positions where the output element will come from.</li>\n</ul>\n\n<p></p>\n\n<pre><code>morph f g (a :&lt;|: d) = f a :&lt;|: (d . g a)\n</code></pre>\n\n<p>(Secretly, those of us who have had our basic Hancock training also think of \"shapes\" as \"commands\" and \"positions\" as \"valid responses\". A morphism between containers is then exactly a \"device driver\". But I digress.)</p>\n\n<p>Thinking along similar lines, what does it take to make a container <code>Applicative</code>? For starters,</p>\n\n<pre><code>pure :: x -&gt; (s &lt;| p) x\n</code></pre>\n\n<p>which is equivalently</p>\n\n<pre><code>pure :: (() &lt;| Const ()) x -&gt; (s &lt;| p) x\n</code></pre>\n\n<p>That has to be given by</p>\n\n<pre><code>f :: () -&gt; s   -- a constant in s\ng :: pi (a :: ()) -&gt; p (f ()) -&gt; Const () a  -- trivial\n</code></pre>\n\n<p>where <code>f = const neutral</code> for some</p>\n\n<pre><code>neutral :: s\n</code></pre>\n\n<p>Now, what about</p>\n\n<pre><code>(&lt;*&gt;) :: (s &lt;| p) (x -&gt; y) -&gt; (s &lt;| p) x -&gt; (s &lt;| p) y\n</code></pre>\n\n<p>? Again, parametricity tells us two things. Firstly, the only useful data for calculating the output shapes are the two input shapes. We must have a function</p>\n\n<pre><code>outShape :: s -&gt; s -&gt; s\n</code></pre>\n\n<p>Secondly, the only way we can fill an output position with a <code>y</code> is to pick a position from the first input to find a function in `x -> y' and then a position in the second input to obtain its argument.</p>\n\n<pre><code>inPos :: pi (a :: s)(b :: s) -&gt; p (outShape a b) -&gt; (p a, p b)\n</code></pre>\n\n<p>That is, we can always identify the pair of input positions which determine the output in an output position.</p>\n\n<p>The applicative laws tell us that <code>neutral</code> and <code>outShape</code> must obey the monoid laws, and that, moreover, we can lift monoids as follows</p>\n\n<pre><code>mappend (a :&lt;|: f) (b :&lt;|: g) = outShape a b :&lt;|: \\ z -&gt;\n  let (x, y) = inPos a b z\n  in  mappend (f x) (g y)\n</code></pre>\n\n<p>There's something more to say here, but for that, I need to contrast two operations on containers.</p>\n\n<p><strong>Composition</strong></p>\n\n<pre><code>(s &lt;| p) . (s' &lt;| p')  =  ((s &lt;| p) s') &lt;| \\ (a :&lt;|: f) -&gt; Sigma (p a) (p' . f)\n</code></pre>\n\n<p>where <code>Sigma</code> is the type of dependent pairs</p>\n\n<pre><code>data Sigma (p :: *)(q :: p -&gt; *) where\n  Pair :: pi (a :: p) -&gt; q a -&gt; Sigma p q\n</code></pre>\n\n<p>What on earth does that mean?</p>\n\n<ul>\n<li>you choose an outer shape</li>\n<li>you choose an inner shape for each outer position</li>\n<li>a composite position is then the pair of an outer position and an inner position appropriate to the inner shape that sits there</li>\n</ul>\n\n<p>Or, in Hancock</p>\n\n<ul>\n<li>you choose an outer command</li>\n<li>you can wait to see the outer response before choosing the inner command</li>\n<li>a composite response is then a response to the outer command, followed by a response to the inner command chosen by your strategy</li>\n</ul>\n\n<p>Or, more blatantly</p>\n\n<ul>\n<li>when you make a list of lists, the inner lists can have different lengths</li>\n</ul>\n\n<p>The <code>join</code> of a <code>Monad</code> flattens a composition. Lurking behind it is not just a monoid on shapes, but an <em>integration</em> operator. That is,</p>\n\n<pre><code>join :: ((s &lt;| p) . (s &lt;| p)) x -&gt; (s &lt;| p) x\n</code></pre>\n\n<p>requires</p>\n\n<pre><code>integrate :: (s &lt;| p) s -&gt; s\n</code></pre>\n\n<p>Your free monad gives you strategy trees, where you can use the result of one command to choose the rest of your strategy. As if you're interacting at a 1970s teletype.</p>\n\n<p>Meanwhile...</p>\n\n<p><strong>Tensor</strong></p>\n\n<p>The tensor (also due to Hancock) of two containers is given by</p>\n\n<pre><code>(s &lt;| p) &gt;&lt; (s' &lt;| p')  =  (s, s') &lt;| \\ (a, b) -&gt; (p a, p' b)\n</code></pre>\n\n<p>That is</p>\n\n<ul>\n<li>you choose two shapes</li>\n<li>a position is then a pair of positions, one for each shape</li>\n</ul>\n\n<p>or</p>\n\n<ul>\n<li>you choose two commands, without seeing any responses</li>\n<li>a response is then the pair of responses</li>\n</ul>\n\n<p>or</p>\n\n<ul>\n<li><code>[] &gt;&lt; []</code> is the type of <em>rectangular matrices</em>: the &lsquo;inner&rsquo; lists must all have the same length</li>\n</ul>\n\n<p>The latter is a clue to why <code>&gt;&lt;</code> is very hard to get your hands on in Haskell, but easy in the dependently typed setting.</p>\n\n<p>Like composition, tensor is a monoid with the identity functor as its neutral element. If we replace the composition underlying <code>Monad</code> by tensor, what do we get?</p>\n\n<pre><code>pure :: Id x -&gt; (s &lt;| p) x\nmystery :: ((s &lt;| p) &gt;&lt; (s &lt;| p)) x -&gt; (s &lt;| p) x\n</code></pre>\n\n<p>But whatever can <code>mystery</code> be? It's not a mystery, because we know there's a rather rigid way to make polymorphic functions between containers. There must be</p>\n\n<pre><code>f :: (s, s) -&gt; s\ng :: pi ((a, b) :: (s, s)) -&gt; p (f (a, b)) -&gt; (p a, p b)\n</code></pre>\n\n<p>and those are exactly what we said determined <code>&lt;*&gt;</code> earlier.</p>\n\n<p><code>Applicative</code> is the notion of effectful programming generated by tensor, where <code>Monad</code> is generated by composition. The fact that you don't get to/need to wait for the outer response to choose the inner command is why <code>Applicative</code> programs are more readily parallelizable.</p>\n\n<p>Seeing <code>[] &gt;&lt; []</code> as rectangular matrices tells us why <code>&lt;*&gt;</code> for lists is built on top of multiplication.</p>\n\n<p>The free applicative functor is the free monoid with knobs on. For containers,</p>\n\n<pre><code>Free (s &lt;| p) = [s] &lt;| All p\n</code></pre>\n\n<p>where</p>\n\n<pre><code>All p [] = ()\nAll p (x : xs) = (p x, All p xs)\n</code></pre>\n\n<p>So a \"command\" is a big list of commands, like a deck of punch cards. You don't get to see any output before you choose your card deck. The \"response\" is your lineprinter output. It's the 1960s.</p>\n\n<p>So there you go. The very nature of <code>Applicative</code>, tensor not composition, demands an underlying monoid, and a recombination of elements compatible with monoids.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1538439816, "post_id": 52580471, "comment_id": 92135414, "body": "To get one of these with <code>Any</code> shapes, you also have to consider the positions. <code>All False</code> having zero positions and <code>All True</code> having one is fine because <code>All False &lt;&gt; All True</code> gives <code>All False</code>,  and so you aren&#39;t forced to produce a pair of positions when you have just one of them to begin with. One way to make <code>Any</code> work is swapping <code>True</code> and <code>False</code>. Another is having one position in both cases -- <code>a + a</code>, which amounts to <code>Sum Identity Identity</code>, or <code>Writer Any</code>, etc."}, {"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1538463575, "post_id": 52580471, "comment_id": 92140858, "body": "@duplode Thanks for your comment! Do you think that the general statement is true: given any <code>Monoid</code>, there exists an <code>Applicative</code> whose shape matches the given <code>Monoid</code>? In fact, as you have shown for <code>Any</code>, for some <code>Monoid</code>s there is more than a single corresponding <code>Applicative</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1538468245, "post_id": 52580471, "comment_id": 92143049, "body": "If you are okay with a trivial one, there is <code>Monoid m =&gt; Applicative (Const m)</code>. My gut feeling is that there is no guarantee of having something non-trivial -- for instance, I&#39;m having trouble to see a reasonable way of getting some other <code>Applicative</code> out of the <code>Sum</code> <code>Monoid</code>."}, {"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1538492716, "post_id": 52580471, "comment_id": 92156657, "body": "Right \u2013 we can always get an <code>Applicative</code> for <code>Const m</code>, provided <code>m</code> is a <code>Monoid</code>!"}, {"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1538492769, "post_id": 52580471, "comment_id": 92156693, "body": "Regarding the non-trivial instance of <code>Applicative</code> for the <code>Sum</code> <code>Monoid</code>, I was kinda hoping to be possible, as I stumbled upon <a href=\"https://stackoverflow.com/a/32825891/474311\">this puzzle</a> from Conor, in which he asks for &quot;at least four behaviourally distinct instances of <code>Applicative</code>&quot; for non-empty lists. I was expecting that he targeted the four main <code>Monoid</code>s on <code>Nat</code> (the shape of lists) \u2013 <code>Sum</code>, <code>Product</code>, <code>Min</code>, <code>Max</code> \u2013 but, of course, the puzzle doesn&#39;t imply that. In fact, for non-empty lists is not possible to obtain the empty list which would correspond to zero, the unit on <code>Sum</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1538572125, "post_id": 52580471, "comment_id": 92188997, "body": "I suspect some of those instances in the puzzle differ by sequencing of effects. (Also, I wonder how would that translate to the vantage point taken by Conor&#39;s answer here.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1555192091, "post_id": 52580471, "comment_id": 98026612, "body": "I believe two extra instances for that puzzle have just sprung forth in a /r/haskell thread: <a href=\"https://old.reddit.com/r/haskell/comments/bcaead/how_to_derive_pure_f_x_fmap_f_x/ekpo69v/\" rel=\"nofollow noreferrer\">one</a> and <a href=\"https://old.reddit.com/r/haskell/comments/bcaead/how_to_derive_pure_f_x_fmap_f_x/ekrgm6i/\" rel=\"nofollow noreferrer\">the other</a>."}], "tags": [], "owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "is_accepted": false, "score": 4, "last_activity_date": 1538329164, "creation_date": 1538329164, "answer_id": 52580471, "question_id": 50702929, "link": "https://stackoverflow.com/questions/50702929/monoidal-functor-is-applicative-but-where-is-the-monoid-typeclass-in-the-definit/52580471#52580471", "title": "Monoidal Functor is Applicative but where is the Monoid typeclass in the definition of Applicative?", "body": "<p>I wanted to complement Conor McBride's (pigworker) <a href=\"https://stackoverflow.com/a/50717675/474311\">instructive answer</a> with some more examples of <code>Monoid</code>s found in <code>Applicative</code>s.\n<a href=\"https://www.reddit.com/r/haskell/comments/9jfq7w/relationship_between_applicative_and_monoid_in/e6rv56x\" rel=\"nofollow noreferrer\">It has been observed</a> that the <code>Applicative</code> instance of some functors resembles a corresponding <code>Monoid</code> instance;\nfor example, we have the following analogies:</p>\n\n<pre><code>Applicative \u2192 Monoid\n---------------------\nList        \u2192 Product\nMaybe       \u2192 All\nEither a    \u2192 First a\nState s     \u2192 Endo s\n</code></pre>\n\n<p>Following Conor's comment, we can understand <em>why</em> we have these correspondences.\nWe use the following observations:</p>\n\n<ol>\n<li>The shape of an <code>Applicative</code> container forms a <code>Monoid</code> under the application operation <code>&lt;*&gt;</code>.</li>\n<li>The shape of a functor <code>F</code> is given by <code>F 1</code> (where <code>1</code> denotes the unit <code>()</code>).</li>\n</ol>\n\n<p>For each of the <code>Applicative</code> functors listed above, we compute their shape by instantiating the functor with the unit element.\nWe get that...</p>\n\n<p><code>List</code> has the shape of <code>Nat</code>:</p>\n\n<pre><code>List a = \u03bc r . 1 + a \u00d7 r\nList 1 = \u03bc r . 1 + 1 \u00d7 r\n       \u2245 \u03bc r . 1 + r\n       \u2245 Nat\n</code></pre>\n\n<p><code>Maybe</code> has the shape of <code>Bool</code>:</p>\n\n<pre><code>Maybe a = 1 + a\nMaybe 1 = 1 + 1\n        \u2245 Bool\n</code></pre>\n\n<p><code>Either</code> has the shape of <code>Maybe</code>:</p>\n\n<pre><code>Either a b = a + b\nEither a 1 = a + 1\n           \u2245 Maybe a\n</code></pre>\n\n<p><code>State</code> has the shape of <code>Endo</code>:</p>\n\n<pre><code>State s a = (a \u00d7 s) ^ s\nState s 1 = (1 \u00d7 s) ^ s\n          \u2245 s ^ s\n          \u2245 Endo s\n</code></pre>\n\n<hr>\n\n<p>The types of the shapes match precisely the types underlying the <code>Monoid</code>s listed in the beginning.\nOne thing still puzzles me: some of these types admit multiple <code>Monoid</code> instances (<em>e.g.</em>, <code>Bool</code> can be made into a <code>Monoid</code> as <code>All</code> or <code>Any</code>) and I'm not entirely sure why we get one of the instances and not the other. My guess would be that this is related to the applicative laws and how they interact with the other component of the container \u2013 its positions.</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1096, "favorite_count": 7, "accepted_answer_id": 50703828, "answer_count": 3, "score": 15, "last_activity_date": 1538329164, "creation_date": 1528209932, "last_edit_date": 1528548657, "question_id": 50702929, "link": "https://stackoverflow.com/questions/50702929/monoidal-functor-is-applicative-but-where-is-the-monoid-typeclass-in-the-definit", "title": "Monoidal Functor is Applicative but where is the Monoid typeclass in the definition of Applicative?", "body": "<p>Applicative is a Monoidal Functor : </p>\n\n<pre><code>mappend :: f         -&gt; f   -&gt; f\n$       ::  (a -&gt; b) -&gt;   a -&gt;   b\n&lt;*&gt;     :: f(a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>But I don't see any reference about Monoid in the definition of the Applicative typeclass, could you tell me why ?</p>\n\n<p>Definition :</p>\n\n<pre><code>class Functor f =&gt; Applicative (f :: * -&gt; *) where\n  pure :: a -&gt; f a\n  (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n  GHC.Base.liftA2 :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n  (*&gt;) :: f a -&gt; f b -&gt; f b\n  (&lt;*) :: f a -&gt; f b -&gt; f a\n  {-# MINIMAL pure, ((&lt;*&gt;) | liftA2) #-}\n</code></pre>\n\n<p>No mention of that structural Monoid is provided in this definition, but when you do </p>\n\n<pre><code>&gt; (\"ab\",(+1)) &lt;*&gt; (\"cd\", 5) \n&gt;(\"abcd\", 6)\n</code></pre>\n\n<p>You can clearly see the use of a Structural Monoid \"(,) String\" when implementing this instance of Applicative. </p>\n\n<p>Another example to show that a \"Structural Monoid\" is used :</p>\n\n<pre><code>Prelude Data.Monoid&gt; (2::Integer,(+1)) &lt;*&gt; (1::Integer,5)\n\n&lt;interactive&gt;:35:1: error:\n    \u2022 Could not deduce (Monoid Integer) arising from a use of \u2018&lt;*&gt;\u2019\n      from the context: Num b\n        bound by the inferred type of it :: Num b =&gt; (Integer, b)\n        at &lt;interactive&gt;:35:1-36\n    \u2022 In the expression: (2 :: Integer, (+ 1)) &lt;*&gt; (1 :: Integer, 5)\n      In an equation for \u2018it\u2019:\n          it = (2 :: Integer, (+ 1)) &lt;*&gt; (1 :: Integer, 5)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1528208624, "post_id": 50702447, "comment_id": 88414363, "body": "Complete <b>minimal</b> example? Really? Also, what is the error message?"}, {"owner": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528238243, "post_id": 50702447, "comment_id": 88428786, "body": "@leftaroundabout Sorry I tried to make a smaller example but I couldn&#39;t reproduce the same error (I&#39;m quite a Haskell newbie, and those extensions are totally new for me). I edited my question to add the full error message."}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "edited": false, "score": 0, "creation_date": 1528290281, "post_id": 50703021, "comment_id": 88450639, "body": "Thank you but I would like to avoid defining every implicit arguments in the signature of every function in case I want to add other parameters in the future, hence the <code>Env $ unenv $ ...</code> trick to (hopefully) bring them all into scope. I would be interested in a way to force <code>unenv $ ...</code> to use the same rigid variables."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1528210239, "creation_date": 1528210239, "answer_id": 50703021, "question_id": 50702447, "link": "https://stackoverflow.com/questions/50702447/haskell-couldnt-match-type-when-using-implicitparams-with-rank2types/50703021#50703021", "title": "Haskell: Couldn&#39;t match type when using ImplicitParams with Rank2Types", "body": "<p>Instead of</p>\n\n<pre><code>Env $ unenv $ f r\n</code></pre>\n\n<p>you should simply use</p>\n\n<pre><code>f r\n</code></pre>\n\n<p>Doing <code>Env $ unenv $ ...</code> introduces a new bunch of rigid type variables <code>i1 i2 c  s</code>, which have to be matched by <code>unenv $ ...</code> and GHC meets some ambiguity here, I guess. There should be some way to force <code>unenv $ ...</code> to use the exact same rigid variables, but it's not worth it, since we can avoid that.</p>\n\n<p>Further, to call <code>f r</code> you also have to define the other implicit arguments like <code>?cardinality, ?colors, ?hint</code>. Otherwise, you'll still get an error.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528294247, "post_id": 50721740, "comment_id": 88453433, "body": "Well, I would suggest you at least consider using some more conventional style. Implicit parameters are a longtime oddball in the Haskell language. I don&#39;t say they&#39;re bad \u2013 frankly I don&#39;t know, because hardly anybody uses them, including myself. But there definitely are good alternatives."}, {"owner": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528307577, "post_id": 50721740, "comment_id": 88461513, "body": "@leftaroundabout I was using a simple reader monad until I needed polymorphic values. Then I tried to use a type class (with a reader monad), but it couldn&#39;t be used with proxies... I don&#39;t know any alternatives for that particular use case, probably because I&#39;m still a beginner."}], "tags": [], "owner": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "is_accepted": false, "score": 0, "last_activity_date": 1528308512, "last_edit_date": 1528308512, "creation_date": 1528291772, "answer_id": 50721740, "question_id": 50702447, "link": "https://stackoverflow.com/questions/50702447/haskell-couldnt-match-type-when-using-implicitparams-with-rank2types/50721740#50721740", "title": "Haskell: Couldn&#39;t match type when using ImplicitParams with Rank2Types", "body": "<p>Ok so I came up with a solution using <code>PartialTypeSignatures</code>. I could have avoided signatures altogether, but in some cases I need to bring in some constraints. The only downside is that I still need to define full signatures on type class methods, but I can live with it. Here is an example :</p>\n\n<pre><code>{-# LANGUAGE PartialTypeSignatures #-}\n{-# LANGUAGE ScopedTypeVariables   #-}\n{-# LANGUAGE ImplicitParams        #-}\n\nclass SomeClass a where\n  method :: Real t =&gt; (?var1 :: t) =&gt; IO a\n\ninstance SomeClass Int where\n  method = return $ floor $ realToFrac $ ?var1 + 1\n\ninstance SomeClass Float where\n  method = return $ realToFrac $ ?var1 + 1\n\nsomeFun :: _ =&gt; SomeClass a =&gt; a -&gt; IO a\nsomeFun x = do\n  v &lt;- method\n  return $ v + ?var2\n\nf :: forall t. _ =&gt; SomeClass t =&gt; (?proxy :: t) =&gt; IO t\nf = (method :: IO t) &gt;&gt;= ?fun\n\ng :: _ =&gt; Num t =&gt; IO t\ng = do\n  v &lt;- f\n  return $ v + 1\n\nv1 :: IO Int\nv1 =\n  let\n    ?var1 = 10\n    ?var2 = 20\n    ?proxy = undefined :: Int\n  in let\n    ?fun = someFun\n  in g\n\nv2 :: IO Float\nv2 =\n  let\n    ?var1 = 10.1\n    ?var2 = 20.2\n    ?proxy = undefined :: Float\n  in let\n    ?fun = someFun\n  in g\n\nmain :: IO ()\nmain = do\n  r1 &lt;- v1\n  r2 &lt;- v2\n  print r1\n  print r2\n</code></pre>\n\n<p>I'm still open to suggestions though :) .</p>\n\n<p>Side note: One downside of implicit parameters is that you must bring them into scope as soon as you want to reference a function or a value with implicit parameters constraints. As a consequence you cannot compose those functions without bringing <em>all</em> their parameters into scope. A potential solution to this problem is explained in <a href=\"http://blog.ezyang.com/2010/07/delaying-implicit-parameter-binding/\" rel=\"nofollow noreferrer\">this blog post</a>.</p>\n"}], "owner": {"reputation": 101, "user_id": 3776835, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/29gyT.png?s=128&g=1", "display_name": "Timoth&#233;e Jourde", "link": "https://stackoverflow.com/users/3776835/timoth%c3%a9e-jourde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1528308512, "creation_date": 1528208366, "last_edit_date": 1528237999, "question_id": 50702447, "link": "https://stackoverflow.com/questions/50702447/haskell-couldnt-match-type-when-using-implicitparams-with-rank2types", "title": "Haskell: Couldn&#39;t match type when using ImplicitParams with Rank2Types", "body": "<p>I'm trying to use <code>ImplicitParams</code> together with <code>Rank2Types</code> in order to build a custom Monad for my application. However, I get the error below, which I don't understand.</p>\n\n<p>Here is a complete example:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables        #-}\n{-# LANGUAGE ImplicitParams             #-}\n{-# LANGUAGE Rank2Types                 #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n\nimport Control.Monad.Reader\nimport Control.Monad.Random hiding (random)\nimport Control.Monad.Random.Class\n\ndata Hint = Hint { good :: Int\n                 , bad  :: Int }\n  deriving (Eq, Show)\n\nclass Combination c where\n  random   :: Env c\n  fromList :: [Int] -&gt; Env c\n  toList   :: c -&gt; Env [Int]  \n\nclass Combination c =&gt; Set s c where\n  empty     :: (?combination :: c) =&gt; s\n  fromList' :: [c] -&gt; s\n  member    :: c -&gt; s -&gt; Bool\n  insert    :: c -&gt; s -&gt; s\n\n  notMember :: c -&gt; s -&gt; Bool\n  notMember c s = not (member c s)\n\ntype Env' a = Rand StdGen a\n\nnewtype Env a = Env { unenv :: forall i1 i2 c s .\n                      Integral i1\n                      =&gt; Integral i2\n                      =&gt; Combination c\n                      =&gt; Set s c\n                      =&gt; (?colors :: Int)\n                      =&gt; (?holes  :: Int)\n                      =&gt; (?hint   :: c -&gt; c -&gt; Env Hint)\n                      =&gt; (?combination :: c)\n                      =&gt; (?set    :: s)\n                      =&gt; (?cardinality :: i1)\n                      =&gt; (?powers :: [i2])\n                      =&gt; Env' a }\n\ninstance Functor Env where\n  fmap f (Env a) = Env $ fmap f a\n\ninstance Applicative Env where\n  pure = Env . pure\n  (Env f) &lt;*&gt; (Env a) = Env $ f &lt;*&gt; a\n\ninstance Monad Env where\n  (Env m) &gt;&gt;= f = Env $ m &gt;&gt;= \\a -&gt; let (Env b) = f a in b\n\ninstance MonadRandom Env where\n  getRandomR  = Env . getRandomR\n  getRandom   = Env getRandom\n  getRandomRs = Env . getRandomRs\n  getRandoms  = Env getRandoms\n\n\n\n-- Dummy instances\ninstance Combination Int where\n  random = undefined\n  fromList _ = undefined\n  toList _ = undefined\n\ninstance Set Float Int where\n  empty = undefined\n  fromList' = undefined\n  member = undefined\n  insert = undefined\n\n\n-- Tests\nf :: forall c i.\n     Combination c\n  =&gt; Integral i\n  =&gt; (?colors :: Int)\n  =&gt; (?cardinality :: i)\n  =&gt; (?combination :: c)\n  =&gt; (?hint :: c -&gt; c -&gt; Env Hint)\n  =&gt; c -&gt; Env String\nf _ = do\n  r &lt;- getRandomR (100::Int, 200)\n  secret &lt;- random :: Env c\n  r1 &lt;- random :: Env c\n  h &lt;- (?hint secret r1)\n  return $\n    show ?colors\n    ++ \" \" ++ (show $ fromIntegral ?cardinality)\n    ++ \" \" ++ show r\n\ng :: forall c.\n     Combination c\n  =&gt; (?combination :: c)\n  =&gt; Env String\ng = do\n  r &lt;- random :: Env c\n  Env $ unenv $ f r\n  --            ^^^\n  --            ERROR: Couldn't match type \u2018c1\u2019 with \u2018c\u2019...\n</code></pre>\n\n<p>I tried almost everything to make it work without any success, here is the error message :</p>\n\n<pre><code>Internal.hs:92:17: error:\n    \u2022 Couldn't match type \u2018c1\u2019 with \u2018c\u2019\n        arising from a functional dependency between constraints:\n          \u2018?combination::c\u2019 arising from a use of \u2018f\u2019 at Internal.hs:92:17-19\n          \u2018?combination::c1\u2019\n            arising from a type expected by the context:\n                           forall i1 i2 c s.\n                           (Integral i1, Integral i2, Combination c, Set s c, ?colors::Int,\n                            ?holes::Int, ?hint::c -&gt; c -&gt; Env Hint, ?combination::c, ?set::s,\n                            ?cardinality::i1, ?powers::[i2]) =&gt;\n                           Env' a0\n            at Internal.hs:92:3-19\n      \u2018c1\u2019 is a rigid type variable bound by\n        a type expected by the context:\n          forall i1 i2 c1 s.\n          (Integral i1, Integral i2, Combination c1, Set s c1, ?colors::Int,\n           ?holes::Int, ?hint::c1 -&gt; c1 -&gt; Env Hint, ?combination::c1,\n           ?set::s, ?cardinality::i1, ?powers::[i2]) =&gt;\n          Env' String\n        at Internal.hs:92:3-19\n      \u2018c\u2019 is a rigid type variable bound by\n        the type signature for:\n          g :: forall c. (Combination c, ?combination::c) =&gt; Env String\n        at Internal.hs:(86,1)-(89,15)\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018f r\u2019\n      In the second argument of \u2018($)\u2019, namely \u2018unenv $ f r\u2019\n      In a stmt of a 'do' block: Env $ unenv $ f r\n    \u2022 Relevant bindings include r :: c (bound at Internal.hs:91:3)\n   |\n92 |   Env $ unenv $ f r\n   |                 ^^^\n</code></pre>\n\n<p>The point is that I don't want to add every implicit parameter to the signature of every single function in my program in case I want to add other parameters in the future.</p>\n\n<p>Thanks.</p>\n\n<p>EDIT: I just discovered <code>PartialTypeSignatures</code> which could solve my problem in a much simpler way, I'm trying this out now!</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1528206983, "post_id": 50701827, "comment_id": 88413174, "body": "<a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528207168, "post_id": 50701827, "comment_id": 88413296, "body": "@duplode I think it&#39;s not quite a duplicate, because the instance asked about here isn&#39;t really <code>ZipList</code> (though that seems to be the idea)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528207422, "post_id": 50701827, "comment_id": 88413485, "body": "@leftaroundabout Oh, the <code>(:[])</code> versus <code>repeat</code> issue shows up here, too. Well-spotted; reopening. (For the sake of completeness, the suggested question was <a href=\"https://stackoverflow.com/questions/37627513/why-ziplist-is-not-the-default-applicative-instance-for-list\"><i>Why ZipList is not the default Applicative Instance for List</i></a>.)"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 2, "creation_date": 1528207814, "post_id": 50701827, "comment_id": 88413776, "body": "List has already an implementation for Monad which forces the Application instance (<code>ap</code> can me written in term of <code>return</code> and <code>&gt;&gt;=</code> for any Monad and as to be identical to <code>&lt;*&gt;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1528220860, "post_id": 50702253, "comment_id": 88421293, "body": "Another fix might be to make <code>app</code> symmetric in its handling of list ends. e.g. <code>app [] [] = []; app [f] [x] = [f x]; app [f] xs = map f xs; app fs [x] = map ($x) fs; app (f:fs) (x:xs) = f x : app fs xs</code>. Keep <code>pure x = [x]</code> as in the question. This seems like it would be a genuinely different <code>Applicative</code> than either the standard instance or <code>ZipList</code>, would work okay for <i>finite-only</i> lists, and my intuition says it shouldn&#39;t violate any of the laws (though I didn&#39;t actually check that)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528228435, "post_id": 50702253, "comment_id": 88424943, "body": "@DanielWagner my intuition says it would likely violate the composition law... it seems to behave inconsistently WRT whether to trim the longer list or to extend the shorter. But I&#39;m not sure, it might actually be isomorphic to <code>MaybeT (WriterT (Min Word) ZipList)</code> or something like that."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1528231422, "post_id": 50702253, "comment_id": 88426333, "body": "It is no more inconsistent than is required by the type: empty lists propagate (as they must in any total instance), and otherwise the shorter list is always extended."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528232464, "post_id": 50702253, "comment_id": 88426792, "body": "QuickCheck says it satisfies all the laws, with one minor tweak: it needs two base cases for <code>[] _</code> and <code>_ []</code> instead of just the one <code>[] []</code> base case. <a href=\"https://lpaste.net/2886508826557677568\" rel=\"nofollow noreferrer\">Here&#39;s some code.</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1528262412, "post_id": 50702253, "comment_id": 88434265, "body": "The (tweaked) instance is indeed legal -- <code>(&lt;*&gt;)</code> boils down to extending the shorter list and then using the <code>ZipList</code> instance; doing so can&#39;t possibly fail wrt associativity. That&#39;s neat."}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1528272348, "post_id": 50702253, "comment_id": 88439096, "body": "Thanks to the above comments, I was able to change the definition to perform extension of the shorter list:  <code>instance Applicative&#39; [] where  pure&#39; x = [x]  app _ [] = []  app [g] [x] = [(g x)]  app (g:gs) [x] = [(g x)] ++ app gs [x]  app [g] (x:xs) = [(g x)] ++ app [g] xs  app (g:gs) (x:xs) = [(g x)] ++ app gs xs</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1528291049, "post_id": 50702253, "comment_id": 88451196, "body": "@Ngm You also need an <code>app [] _ = []</code> case. Otherwise looks good to me!"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1528303649, "post_id": 50702253, "comment_id": 88459362, "body": "It&#39;s not ZipList."}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1528341833, "post_id": 50702253, "comment_id": 88472762, "body": "an anti-ziplist"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1528273149, "last_edit_date": 1528273149, "creation_date": 1528207809, "answer_id": 50702253, "question_id": 50701827, "link": "https://stackoverflow.com/questions/50701827/why-doesnt-the-list-applicative-instance-perform-a-one-to-one-application/50702253#50702253", "title": "Why doesn&#39;t the list Applicative instance perform a one-to-one application?", "body": "<p>This is basically the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\"><code>ZipList</code></a> applicative instance. The main difference is</p>\n\n<pre><code>pure x = repeat x\n</code></pre>\n\n<p>instead of your <code>pure x = [x]</code>.</p>\n\n<p>That's needed to fulfill the applicative laws. Namely, your implementation violates the interchange law:</p>\n\n<pre><code>[id, id] &lt;*&gt; pure 1 \u2261 [id,id] &lt;*&gt; [1]\n                    \u2261 [id 1] ++ ([id] &lt;*&gt; [])\n                    \u2261 [id 1] ++ []\n                    \u2261 [1]\n\u2021 pure ($ 1) &lt;*&gt; [id,id] \u2261 [1,1]\n</code></pre>\n\n<p>The requirement for an infinite <code>pure</code> makes <code>ZipList</code> somewhat funny in practice. The standard implementation is basically the most natural <em>finite-only</em> implementation. Arguably, it would be better if there were separate types for finite arrays and possibly-infinite lists in the prelude, and if lists had the <code>ZipList</code> instance.</p>\n\n<p>Going by the comments, your implementation actually is fine too though, if only you pad out both lists if needed. Nice!</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1528383699, "post_id": 50726062, "comment_id": 88496609, "body": "Although every <code>instance Applicative []</code> gives rise to a monoid on <code>[()]</code>, it is not at all clear to me that the other way is always possible. In particular, the types require that <code>[] &lt;*&gt; _ = []</code> and <code>_ &lt;*&gt; [] = []</code> in any (total) instance; but there are many monoids on numbers for which <code>0</code> is not an annihilator. Indeed, after <code>Product</code> (your first proposed example), the obvious next choice would be <code>Sum</code>, which does not have this property. So &quot;numbers are monoids in lots of ways&quot; doesn&#39;t imply &quot;<code>[]</code> is <code>Applicative</code> in lots of ways&quot; (even though the latter turns out to be true)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528384642, "post_id": 50726062, "comment_id": 88497286, "body": "On the other hand, your observation that any monoid on the positive numbers can be turned into a monoid on the naturals (that <i>does</i> have <code>0</code> as an annihilator, though you didn&#39;t mention it) was quite interesting, and further thought on a variant of <code>Sum</code> led me to the following bizarre <code>Applicative</code> instance: <code>pure x = [x]; fs@(f:ft) &lt;*&gt; xs@(x:_) = map f xs ++ map ($x) ft</code> (+ base cases). The laws do appear to hold (according to QuickCheck, I&#39;m too lazy for the full proof...), but I find its behavior pretty strange, and you were right: it was a  fun game!"}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1528961552, "post_id": 50726062, "comment_id": 88706535, "body": "@DanielWagner that sems similar to the applicative instance of this monad discussed in <a href=\"https://www.reddit.com/r/haskell/comments/7oym07/maybe_i_also_found_a_monad/\" rel=\"nofollow noreferrer\">this reddit post</a>."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 5, "last_activity_date": 1528305456, "creation_date": 1528305456, "answer_id": 50726062, "question_id": 50701827, "link": "https://stackoverflow.com/questions/50701827/why-doesnt-the-list-applicative-instance-perform-a-one-to-one-application/50726062#50726062", "title": "Why doesn&#39;t the list Applicative instance perform a one-to-one application?", "body": "<p>The basic reason why <code>Applicative []</code> has the generate-all-possible-combinations behaviour, rather than any kind of zippy behaviour, is that <code>Applicative</code> is a superclass of <code>Monad</code> and is intended to behave in accordance with the <code>Monad</code> instance when one exists. <code>Monad []</code> treats lists as failure-and-prioritized-choice, so the <code>Applicative []</code> instance does, too. People often refactor monadic code using the applicative interface to reduce the number of intermediate names needed for values, and to increase opportunities for parallelism. It would be pretty scary if that caused a significant shift in the functional semantics.</p>\n\n<p>That aside, the truth is, you're spoilt for choice for <code>Applicative []</code> instances, and even more so if you consider empty/nonempty and finite/coinductive/infinite variations. Why is that?</p>\n\n<p>Well, as I mentioned in <a href=\"https://stackoverflow.com/a/50717675/828361\">this answer</a>, every <code>Applicative f</code> begins its life as a <code>Monoid (f ())</code>, combining the <em>shapes</em> of the data, before we start to worry about the <em>values</em>. Lists are a case in point.</p>\n\n<p><code>[()]</code> is basically the type of numbers. Numbers are monoids in lots of ways.</p>\n\n<p>Taking <code>Applicative []</code> from <code>Monad []</code> amounts to choosing the monoid generated by <code>1</code> and <code>*</code>.</p>\n\n<p>Meanwhile, <code>Applicative ZipList</code> exploits Haskell's coinductive conflation and amounts to choosing the monoid generated by infinity and minimum.</p>\n\n<p>The question proposes an instance which is not lawful, but is close to one that is. You'll notice <code>&lt;*&gt;</code> isn't defined for an empty list of functions, but for nonempty lists of functions, it pads out to match the list of arguments. Asymmetrically, it truncates when the arguments run out. Something's not quite right.</p>\n\n<p>Two candidate fixes follow.</p>\n\n<p>One is to truncate on empty on both sides, and then you must take <code>pure = repeat</code> and you have <code>ZipList</code>.</p>\n\n<p>The other is to rule out empty lists and pad on both sides. Then you get the <code>Applicative</code> generated from the <code>Monoid</code> on <em>positive</em> numbers generated by 1 and <em>maximum</em>. So it's not <code>ZipList</code> at all. That's the thing I called <code>PadMe</code> in <a href=\"https://stackoverflow.com/a/21350096/828361\">this answer</a>. The reason you need to rule out 0 is that for every position in the output of <code>&lt;*&gt;</code>, you need to point to the position in both inputs where the function and its arguments (respectively) come from. You can't pad if you have nothing to pad with.</p>\n\n<p>It's a fun game. Pick a <code>Monoid</code> on numbers and see if you can grow it into an <code>Applicative</code> for lists!</p>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 1, "accepted_answer_id": 50726062, "answer_count": 2, "score": 3, "last_activity_date": 1528342223, "creation_date": 1528206687, "last_edit_date": 1528342223, "question_id": 50701827, "link": "https://stackoverflow.com/questions/50701827/why-doesnt-the-list-applicative-instance-perform-a-one-to-one-application", "title": "Why doesn&#39;t the list Applicative instance perform a one-to-one application?", "body": "<p>I was reading about <code>Applicative</code> in Haskell from Hutton's Programming in Haskell. To understand it better I came up with the following definition for <code>Applicative</code> for lists:</p>\n\n<pre><code>-- Named as pure' and \"app\" to avoid confusion with builtin versions \nclass Applicative' f where\n pure' :: a -&gt; f a\n app :: f (a-&gt;b) -&gt; f a -&gt; f b\n\ninstance Applicative' [] where\n pure' x = [x]\n app _ [] = []\n app [g] (x:xs) = [(g x)] ++ app [g] xs\n app (g:gs) (x:xs) = [(g x)] ++ app gs xs\n\n-- fmap functions could be defined as:\nfmap1' :: (Applicative' f)=&gt;(a-&gt;b) -&gt; f a -&gt; f b\nfmap1' g x = app (pure' g) x\n\nfmap2' :: (Applicative' f)=&gt;(a-&gt;b-&gt;c) -&gt; f a -&gt; f b -&gt; f c\nfmap2' g x y = app (app (pure' g) x) y\n\n\nfmap3' :: (Applicative' f)=&gt;(a-&gt;b-&gt;c-&gt;d) -&gt; f a -&gt; f b -&gt; f c -&gt; f d\nfmap3' g x y z = app (app (app (pure' g) x) y) z\n</code></pre>\n\n<p>An example of use of  <code>fmap2'</code>  is as follows:</p>\n\n<pre><code>Ok, one module loaded.\n*Main&gt; g = \\x y -&gt; x*y\n*Main&gt; arr1 = [1,2,3]\n*Main&gt; arr2 = [4,5,6]\n*Main&gt; fmap2' g arr1 arr2\n[4,10,18]\n*Main&gt;\n</code></pre>\n\n<p>But the standard definition for <code>Applicative</code> function <code>&lt;*&gt;</code> for a list is defined as:</p>\n\n<pre><code>gs &lt;*&gt; xs = [g x | g &lt;- gs, x &lt;- xs]\n</code></pre>\n\n<p>Thus resulting in </p>\n\n<pre><code>pure (*) &lt;*&gt; [1,2], [3,4]\n[3,4,6,8]\n</code></pre>\n\n<p>I was wondering why it defined in the manner of <code>for all arr1, for all arr2, apply function</code> rather than <code>take corresponding elements arr1, arr2 apply function</code>. \nI guess the first definition is probably more useful? Are there any specific reasons for this choice?</p>\n"}, {"tags": ["haskell", "typechecking"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528199095, "post_id": 50699251, "comment_id": 88407670, "body": "Well the signature suggest that <code>a</code> can be <i>anythong</i>, but here it is should be or an <code>Integer</code>, or a <code>Double</code>."}, {"owner": {"reputation": 53, "user_id": 4013348, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9lju.png?s=128&g=1", "display_name": "hjorthjort", "link": "https://stackoverflow.com/users/4013348/hjorthjort"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528199706, "post_id": 50699251, "comment_id": 88408103, "body": "Willem: Doesn&#39;t the signature imply that the function could be any function that takes two inputs of any instance of <code>Num</code> and returns a value of the same instance? Like, the type signature of <code>(+)</code> is exaclty <code>Num a =&gt; a -&gt; a -&gt; a</code>. Or am I missing something?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528200012, "post_id": 50699251, "comment_id": 88408315, "body": "Well not every numerical type is an <code>Integer</code>, or a <code>Double</code>."}, {"owner": {"reputation": 53, "user_id": 4013348, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9lju.png?s=128&g=1", "display_name": "hjorthjort", "link": "https://stackoverflow.com/users/4013348/hjorthjort"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528201013, "post_id": 50699251, "comment_id": 88409030, "body": "Sure, but could you elaborate on why that would cause the type checking error when the program never calls calculate with anything other that <code>Integer</code> or <code>Double</code>? I mean, it&#39;s not like <code>map</code> fails to compile because it accepts a function of type <code>(a-&gt; b)</code>, which could be any type. Something else must be going on here, right?"}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1528201004, "post_id": 50699568, "comment_id": 88409022, "body": "&quot;the runtime needs to be ready to instantiate the supplied function&quot;... What do you mean by this? Was under the impression that nothing special happened at runtime. Type erasure"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1528202305, "post_id": 50699568, "comment_id": 88409821, "body": "@BenjaminHodgson Type erasure happens, but it does not erase typeclass constraints. The first argument of <code>calculate</code>, roughly, is a function that takes a dictionary for <code>Num a</code> and then two more arguments. The dictionary is chosen and passed at runtime by <code>calculate</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528202358, "post_id": 50699568, "comment_id": 88409857, "body": "Exactly. I added some explanation to the answer."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1528202579, "post_id": 50699568, "comment_id": 88410005, "body": "Hmm, I still think the sentence is a little misleading. The dictionaries are manifest in the generated code. The runtime system itself doesn&#39;t need to know anything about <code>RankNTypes</code> or type classes. It just passes arguments around."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1528202691, "post_id": 50699568, "comment_id": 88410070, "body": "@BenjaminHodgson that was indeed badly phrased. I didn&#39;t mean <i>the runtime needs to do it</i> but <i>it needs to be done at runtime</i>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1528202635, "last_edit_date": 1528202635, "creation_date": 1528199993, "answer_id": 50699568, "question_id": 50699251, "link": "https://stackoverflow.com/questions/50699251/why-does-type-inference-fail-for-a-polymorphic-function-applied-to-different-inp/50699568#50699568", "title": "Why does type inference fail for a polymorphic function applied to different inputs withing the same function", "body": "<p>You've correctly identified that you need <em>universal quantification</em>. In fact, you already have universal quantification \u2013 your signature, like any polymorphic signature, is basically shorthand for</p>\n\n<pre><code>{-# LANGUAGE ExplicitForall, UnicodeSyntax #-}\ncalculate :: \u2200 a . Num a =&gt; (a -&gt; a -&gt; a) -&gt; Val -&gt; Val -&gt; Val\n</code></pre>\n\n<p>meaning: whenever someone wants to use this function, they get to choose some type to put in for <code>a</code> upfront. For example, they could pick <code>Int</code>, then the function would get specialised to</p>\n\n<pre><code>calculate :: (Int -&gt; Int -&gt; Int) -&gt; Val -&gt; Val -&gt; Val\n</code></pre>\n\n<p>and that's then used at runtime.</p>\n\n<p>But that's no use for you, because you're going to need to use this function for <em>different</em> number types. No single specialisation is going to cover all of them.</p>\n\n<p>The solution: delay the choosing of a type. That's accomplished by putting the universal quantor <code>\u2200</code> (you can also write it <code>forall</code>) inside the combinator-function part of the signature:</p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\ncalculate :: (\u2200 a . Num a =&gt; a -&gt; a -&gt; a) -&gt; Val -&gt; Val -&gt; Val\n</code></pre>\n\n<p>which will typecheck. It does require the <code>-XRank2Types</code> extension because this is a rather more complex beast: now you can't simply picture the polymorphic function as a family of specialisations with concrete monomorphic types, but instead the funtion needs to be ready to instantiate, <em>at runtime</em>, the supplied function with whatever types happen to occur in the data structure.</p>\n\n<p>I.e., it needs to pass an additional argument to the function: a \u201cdictionary\u201d containing the <code>Num</code> class methods. The underlying implementation GHC generates is something like this:</p>\n\n<pre><code>data NumDict a = NumDict {\n        addition :: a -&gt; a -&gt; a\n      , subtraction :: a -&gt; a -&gt; a\n      , multiplication :: a -&gt; a -&gt; a\n      , abs :: a -&gt; a\n      ...\n      }\n\ncalculate' :: (\u2200 a . NumDict a -&gt; a -&gt; a -&gt; a) -&gt; Val -&gt; Val -&gt; Val\ncalculate' f (I i1) (I i2) = I (f ndict i1 i2)\n where ndict = NumDict ((+) :: Integer -&gt; Integer -&gt; Integer)\n                       ((-) :: Integer -&gt; Integer -&gt; Integer)\n                       ...\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 4013348, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9lju.png?s=128&g=1", "display_name": "hjorthjort", "link": "https://stackoverflow.com/users/4013348/hjorthjort"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 50699568, "answer_count": 1, "score": 2, "last_activity_date": 1528202968, "creation_date": 1528199021, "last_edit_date": 1528202968, "question_id": 50699251, "link": "https://stackoverflow.com/questions/50699251/why-does-type-inference-fail-for-a-polymorphic-function-applied-to-different-inp", "title": "Why does type inference fail for a polymorphic function applied to different inputs withing the same function", "body": "<p>I'm making an interpreter for a subset of C++. The interpreter is written in Haskell.</p>\n\n<p>My <code>eval</code> function for expressions returns a new environment, and a value. I encode the values as a new type called <code>Val</code>. Minimal example:</p>\n\n<pre><code>data Val = I Integer | D Double\n</code></pre>\n\n<p>To evaluate arithmetic expressions, I want to create general function which applies a polymorphic function such as <code>(+)</code> or <code>(*)</code> to the numbers wrapped inside the <code>Val</code> constructors.</p>\n\n<p>I want to have a function like this:</p>\n\n<pre><code>-- calculate :: Num a =&gt; (a -&gt; a -&gt; a) -&gt; Val -&gt; Val -&gt; Val\ncalculate f (I i1) (I i2) = I (f i1 i2)\ncalculate f (D d1) (D d2) = D (f d1 d2)\n</code></pre>\n\n<p>This gives the following error:</p>\n\n<pre><code>tmp/example.hs:4:32: error:\n    \u2022 Couldn't match expected type \u2018Double\u2019 with actual type \u2018Integer\u2019\n    \u2022 In the first argument of \u2018D\u2019, namely \u2018(f d1 d2)\u2019\n      In the expression: D (f d1 d2)\n      In an equation for \u2018calculate\u2019:\n          calculate f (D d1) (D d2) = D (f d1 d2)\n  |\n4 | calculate f (D d1) (D d2) = D (f d1 d2)\n  |                                ^^^^^^^\n\ntmp/example.hs:4:34: error:\n    \u2022 Couldn't match expected type \u2018Integer\u2019 with actual type \u2018Double\u2019\n    \u2022 In the first argument of \u2018f\u2019, namely \u2018d1\u2019\n      In the first argument of \u2018D\u2019, namely \u2018(f d1 d2)\u2019\n      In the expression: D (f d1 d2)\n  |\n4 | calculate f (D d1) (D d2) = D (f d1 d2)\n  |                                  ^^\n\ntmp/example.hs:4:37: error:\n    \u2022 Couldn't match expected type \u2018Integer\u2019 with actual type \u2018Double\u2019\n    \u2022 In the second argument of \u2018f\u2019, namely \u2018d2\u2019\n      In the first argument of \u2018D\u2019, namely \u2018(f d1 d2)\u2019\n      In the expression: D (f d1 d2)\n  |\n4 | calculate f (D d1) (D d2) = D (f d1 d2)\n  |                                     ^^\n</code></pre>\n\n<p>I can't wrap my head around this. I have two questions:</p>\n\n<ol>\n<li>Why does this program fail to type check?</li>\n<li>How could I implement <code>calculate</code> correctly?</li>\n</ol>\n\n<p>I'm only vaguely familiar with universally quantified types, so if that is part of the problem, please explain gently.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 11, "creation_date": 1528174524, "post_id": 50692224, "comment_id": 88394067, "body": "The term you&#39;ll want to use for searching is &quot;list comprehension&quot;."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1528183889, "post_id": 50692224, "comment_id": 88398326, "body": "BTW, the parentheses around the <code>e</code> are completely superfluous. What&#39;s not superfluous though is indentation; always make sure something like a <code>do</code> block is indented."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528190255, "post_id": 50692224, "comment_id": 88402026, "body": "Personally I would find the list monad harder to understand than the list comprehension. Although list comprhension is basically a list monad with <i>cleaner</i> syntax."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1528197571, "post_id": 50692224, "comment_id": 88406719, "body": "Also it should be noted that this implementation of the permutations function returns incorrect results when the input list contains duplicates"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1528196025, "creation_date": 1528196025, "answer_id": 50698319, "question_id": 50692224, "link": "https://stackoverflow.com/questions/50692224/what-does-e-e-list-x-e-in-haskell/50698319#50698319", "title": "What does [(e) | e &lt;- list, x /= e] in haskell", "body": "<p>The expression</p>\n\n<pre><code>[(e) | e &lt;- list, x /= e]\n</code></pre>\n\n<p>is a <em>list comprehension</em>, which is a construct to create a new list from some existing ones.</p>\n\n<p>It returns the list made of all elements <code>(e)</code> generated by taking every <code>e</code> from <code>list</code>, taking only those for which <code>x /= e</code>.</p>\n\n<p>In this case, the resulting list is <code>list</code> where all <code>x</code> values have been removed. </p>\n\n<p>The whole list comprehension is equivalent to <code>filter (x /=) list</code>.</p>\n\n<p>I would recommend to read a <a href=\"http://learnyouahaskell.com/starting-out#im-a-list-comprehension\" rel=\"nofollow noreferrer\">Haskell tutorial on list comprehensions</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 9895424, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Pavel", "link": "https://stackoverflow.com/users/9895424/pavel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528196025, "creation_date": 1528174036, "last_edit_date": 1528184005, "question_id": 50692224, "link": "https://stackoverflow.com/questions/50692224/what-does-e-e-list-x-e-in-haskell", "title": "What does [(e) | e &lt;- list, x /= e] in haskell", "body": "<p>What does [(e) | e &lt;- list, x /= e] in this haskell code? </p>\n\n<pre><code>perms :: Eq a =&gt; [a] -&gt; [[a]]\nperms [] = [[]]\nperms list = do\n   x &lt;- list\n   tails &lt;- perms [(e) | e &lt;- list, x /= e]\n   return (x:tails)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528149774, "post_id": 50689354, "comment_id": 88388506, "body": "You made the signature too generic, since <code>x</code> in <code>[(x, Stream xs)]</code> is the output of <code>p</code>, it means that the signature of <code>whitespace</code> is <code>Parser Char Char -&gt; Parser Char Char</code>."}, {"owner": {"reputation": 73, "user_id": 7761918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VGjdT.png?s=128&g=1", "display_name": "chungonion", "link": "https://stackoverflow.com/users/7761918/chungonion"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528149843, "post_id": 50689354, "comment_id": 88388523, "body": "@Willem Van Onsem I was told not to change the signature, of course if I can change the signature, I would like to do that too."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1528154000, "post_id": 50689354, "comment_id": 88389643, "body": "I think you&#39;ve misunderstood the spec here. Notably, you&#39;re never using <code>p</code>. I think you need to go back to your assignment and figure out what it&#39;s actually asking you to do. That type implies a transformation of a parser in some manner, and the name of it isn&#39;t giving me any hint what it expects."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 7761918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VGjdT.png?s=128&g=1", "display_name": "chungonion", "link": "https://stackoverflow.com/users/7761918/chungonion"}, "edited": false, "score": 0, "creation_date": 1528150012, "post_id": 50689413, "comment_id": 88388584, "body": "I also hope I can make the signature be more specific but I was told not to do so. Appreciated if there is an workout that can keep the signature ;)"}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "reply_to_user": {"reputation": 73, "user_id": 7761918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VGjdT.png?s=128&g=1", "display_name": "chungonion", "link": "https://stackoverflow.com/users/7761918/chungonion"}, "edited": false, "score": 0, "creation_date": 1528150068, "post_id": 50689413, "comment_id": 88388601, "body": "But as the error message tells you, <code>x :: Char</code> is not a value for a free-variable type <code>forall a. a</code>."}], "tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 0, "last_activity_date": 1528149882, "creation_date": 1528149882, "answer_id": 50689413, "question_id": 50689354, "link": "https://stackoverflow.com/questions/50689354/haskell-rigid-type-error/50689413#50689413", "title": "Haskell, rigid type error", "body": "<p><code>runParser</code> returns <code>[(b, Stream Char)]</code>, in the meantime the returned values you substitute are both <code>[(x, Stream xs)]</code> where <code>x</code> is of type <code>Char</code>. You should probably declare <code>whitespace</code> of type <code>Parser Char Char</code> instead of a free-variable type.</p>\n"}], "owner": {"reputation": 73, "user_id": 7761918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VGjdT.png?s=128&g=1", "display_name": "chungonion", "link": "https://stackoverflow.com/users/7761918/chungonion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1528149882, "creation_date": 1528149611, "question_id": 50689354, "link": "https://stackoverflow.com/questions/50689354/haskell-rigid-type-error", "title": "Haskell, rigid type error", "body": "<p>Currently I am working on the following code segment</p>\n\n<pre><code>data Stream x = Stream [x]\n              deriving Show\n\n\ndata Parser a b = P {\n  runParser :: Stream a -&gt; [(b, Stream a)]\n}\n\nwhitespace :: Parser Char a -&gt; Parser Char a\nwhitespace p = P p' where p' (Stream (x:xs)) | (x==' '||x=='\\n'||x=='\\t') = [(x, Stream xs)]\n                         | otherwise = [(x, Stream xs)]\n</code></pre>\n\n<p>and I received an error like this </p>\n\n<pre><code>PComb.hs:72:16: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018Char\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          whitespace :: forall a. Parser Char a -&gt; Parser Char a\n        at PComb.hs:71:1-44\n      Expected type: Parser Char a\n        Actual type: Parser Char Char\n    \u2022 In the expression: P p'\n      In an equation for \u2018whitespace\u2019:\n          whitespace p\n            = P p'\n            where\n                p' (Stream (x : xs))\n                  | (x == ' ' || x == '\\n' || x == '\\t') = [(x, Stream xs)]\n                  | otherwise = [(x, Stream xs)]\n    \u2022 Relevant bindings include\n        p :: Parser Char a (bound at PComb.hs:72:12)\n        whitespace :: Parser Char a -&gt; Parser Char a\n          (bound at PComb.hs:72:1)\n   |\n72 | whitespace p = P p' where p' (Stream (x:xs)) | (x==' '||x=='\\n'||x=='\\t') = [(x, Stream xs)]\n   |                ^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>I was expecting that the <code>x</code> should be recognised as type <code>a</code> but how is that being recognised as a Char even I didn't really specify it is a <code>Char</code>? Appreciate for the help :)</p>\n"}, {"tags": ["haskell", "string-interpolation", "quasiquotes"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1528144588, "post_id": 50688200, "comment_id": 88386506, "body": "Well, what did you expect? It&#39;s precisely the point of the <code>r</code> quasi-quoter to replicate text as-is, without any escaping etc.. You&#39;re going to need a different quasi-quoter to get this behaviour. But that&#39;s off topic for an SO question. Why haven&#39;t you <a href=\"http://hackage.haskell.org/packages/search?terms=interpolation\" rel=\"nofollow noreferrer\">just searched hackage</a> though? \u2014 FWIW, I dislike both the term interpolation in this context, and the technique itself. It&#39;s generally better to build up such strings from chunks, this can be done nicely with <a href=\"http://hackage.haskell.org/package/fmt-0.6/docs/Fmt.html\" rel=\"nofollow noreferrer\">fmt</a>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1528181247, "post_id": 50688200, "comment_id": 88396830, "body": "@leftaroundabout I think interpolation could be useful. Sometimes you can big predefined chunk of text where you need to configure only small parts. See example in <a href=\"https://github.com/kowainik/summoner/blob/21c4bbf2888b232ee8937e0d880cb438d9514d81/src/Summoner/Template.hs#L363\" rel=\"nofollow noreferrer\"><code>summoner</code></a>. <code>fmt</code>package is good when you need to format small messages in custom way using a bunch of predefined operators (especially for dates). Something like that: <a href=\"https://github.com/serokell/importify/blob/3c26c156306b6a95ea1e02344c785354cac59d98/src/Importify/Main/Cache.hs#L92-L93\" rel=\"nofollow noreferrer\">github.com/serokell/importify/blob/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "is_accepted": false, "score": 2, "last_activity_date": 1528197410, "creation_date": 1528197410, "answer_id": 50698752, "question_id": 50688200, "link": "https://stackoverflow.com/questions/50688200/haskell-quasiquotes-text-rawstring-qq-interpolation/50698752#50698752", "title": "Haskell QuasiQuotes Text.RawString.QQ interpolation", "body": "<p>The only way I achieved my objective was just by concatenating:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nimport Text.RawString.QQ\n\nmyText :: Text -&gt; Text\nmyText myVariable = [r|line one\nline two\nline tree\n|] &lt;&gt; myVariable &lt;&gt; [r|\nline five|]\n\nmyText' :: Text\nmyText' = myText \"line four\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 3, "last_activity_date": 1528254495, "creation_date": 1528254495, "answer_id": 50711702, "question_id": 50688200, "link": "https://stackoverflow.com/questions/50688200/haskell-quasiquotes-text-rawstring-qq-interpolation/50711702#50711702", "title": "Haskell QuasiQuotes Text.RawString.QQ interpolation", "body": "<p>Quasi quoter <code>r</code> doesn't implement interpolation. It's only for raw strings. You need another quasi quoter.</p>\n\n<p>Complete code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n\nimport Data.Text (Text)\nimport Text.RawString.QQ (r)\nimport NeatInterpolation (text)\n\nrQuote :: Text -&gt; Text\nrQuote myVariable = [r|line one\nline two\nline tree\n${ myVariable }\nline five|]\n\nneatQuote :: Text -&gt; Text\nneatQuote myVariable = [text|line one\nline two\nline tree\n$myVariable\nline five|]\n\nrText, neatText :: Text\nrText    = rQuote    \"line four\"\nneatText = neatQuote \"line four\"\n</code></pre>\n\n<p>In <code>ghci</code>:</p>\n\n<pre><code>*Main&gt; import Data.Text.IO as TIO\n*Main TIO&gt; TIO.putStrLn rText\nline one\nline two\nline tree\n${ myVariable }\nline five\n*Main TIO&gt; TIO.putStrLn neatText\nline one\nline two\nline tree\nline four\nline five\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1528254495, "creation_date": 1528143675, "question_id": 50688200, "link": "https://stackoverflow.com/questions/50688200/haskell-quasiquotes-text-rawstring-qq-interpolation", "title": "Haskell QuasiQuotes Text.RawString.QQ interpolation", "body": "<p>How can I interpolate like this:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nimport Text.RawString.QQ\n\nmyText :: Text -&gt; Text\nmyText myVariable = [r|line one\nline two\nline tree\n${ myVariable }\nline five|]\n\nmyText' :: Text\nmyText' = myText \"line four\"\n</code></pre>\n\n<p><code>${ myVariable }</code> prints as a literal, not an interpolation, can I do something similar that to interpolate in this case?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1528127555, "post_id": 50684406, "comment_id": 88378571, "body": "What part specifically are you having problems understanding? There&#39;s a lot going on here, and an overview of it all would be too broad. Have you looked how records work?"}, {"owner": {"reputation": 73, "user_id": 7761918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VGjdT.png?s=128&g=1", "display_name": "chungonion", "link": "https://stackoverflow.com/users/7761918/chungonion"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1528127758, "post_id": 50684406, "comment_id": 88378696, "body": "@Carcigenicate  Stream a -&gt; [(b, Stream a)]  is this means if I type <code>:t runParser</code> in ghci, I will got <code>Parser a b -&gt; Stream a -&gt; [(b,Stream a)]</code> ???"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1528127870, "post_id": 50684406, "comment_id": 88378749, "body": "Did you try that to see? And <code>Stream a -&gt; [(b, Stream a)]</code> is a function that takes a Stream, and returns a list of tuples where the first element is of type b, and the second is a Stream of a&#39;s."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528128674, "post_id": 50684406, "comment_id": 88379134, "body": "The record syntax does not change anything. In functional programming: functions are &quot;<i>first class citizens</i>&quot;. You can pass them as arguments, return them as a result, and store them in a constructor."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 7761918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VGjdT.png?s=128&g=1", "display_name": "chungonion", "link": "https://stackoverflow.com/users/7761918/chungonion"}, "edited": false, "score": 0, "creation_date": 1528131588, "post_id": 50684854, "comment_id": 88380576, "body": "Thanks, I will take a look on that :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1528129112, "creation_date": 1528129112, "answer_id": 50684854, "question_id": 50684406, "link": "https://stackoverflow.com/questions/50684406/haskell-data-constructor-with-some-sort-of-function-header-issue/50684854#50684854", "title": "Haskell data constructor with some sort of function header issue?", "body": "<p>Well basically this is just regular record synax:</p>\n\n<pre><code>data Parser a b = P {\n  <b>runParser :: Stream a -&gt; [(b, Stream a)]</b>\n}</code></pre>\n\n<p>It means that the <code>Parser a b</code> data type has <em>one</em> data constructor. A data constructor named <code>P</code>, and that constructor has <em>one</em> argument: a \"field\" called <code>runParser</code>, and that field has type <code>Stream a -&gt; [(b, Stream a)]</code>.</p>\n\n<p>This pattern is quite common in Haskell and in functional programming in general. Functions are \"<em>first class citizens</em>\". It means that functions can be passed as arguments, a function can return another function (in fact due to currying this happens very often in Haskell), and we can store (references to) function in a data constructor.</p>\n\n<p>We can for example create a <code>Parser Int Char</code> type with:</p>\n\n<pre><code>P (\\_ -&gt; []) :: Parser Int Char\n</code></pre>\n\n<p>So here we constructed a <code>Parser Int Char</code> and the argument, a single function, maps any value to an empty list.</p>\n\n<p>Or another example:</p>\n\n<pre><code>P (\\x -&gt; [('a', x), ('b', x)]) :: Parser Int Char\n</code></pre>\n\n<p>Here we thus map our <code>Stream a</code> object <code>x</code>, to a list of 2-tuples, one with <code>'a'</code> as first element, and one with <code>'b'</code> as first element. Each time we pick <code>x</code> as second element.</p>\n\n<p>Or we can define a function, and pass a reference to that function:</p>\n\n<pre><code>f :: Stream Int -&gt; [(Char, Stream Int)]\nf x = [('a', x)]\n\nP f :: Parser Int Char\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 7761918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VGjdT.png?s=128&g=1", "display_name": "chungonion", "link": "https://stackoverflow.com/users/7761918/chungonion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "closed_date": 1528166333, "accepted_answer_id": 50684854, "answer_count": 1, "score": 0, "last_activity_date": 1528129112, "creation_date": 1528127376, "question_id": 50684406, "link": "https://stackoverflow.com/questions/50684406/haskell-data-constructor-with-some-sort-of-function-header-issue", "closed_reason": "Duplicate", "title": "Haskell data constructor with some sort of function header issue?", "body": "<p>Currently I have faced the following code that I have no idea on how this data constructor works. The code snippet is as follow:</p>\n\n<pre><code>data Parser a b = P {\n  runParser :: Stream a -&gt; [(b, Stream a)]\n}\n</code></pre>\n\n<p>I understand that Haskell can have something called recorded syntax, but for this one, that is a bit blow my mind up.</p>\n\n<p>Thanks for the help.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1528180565, "post_id": 50684352, "comment_id": 88396472, "body": "Maybe it&#39;s better to open issue at <code>lens</code> GitHub repository and receive answer with either link to such operator or explanation why it doesn&#39;t exist: <a href=\"https://github.com/ekmett/lens/issues\" rel=\"nofollow noreferrer\">github.com/ekmett/lens/issues</a>"}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1528185860, "post_id": 50684352, "comment_id": 88399458, "body": "@Shersh: Thanks for the suggestion. Opened an issue at <a href=\"https://github.com/ekmett/lens/issues/806\" rel=\"nofollow noreferrer\">github.com/ekmett/lens/issues/806</a>"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1528186120, "creation_date": 1528127212, "last_edit_date": 1528186120, "question_id": 50684352, "link": "https://stackoverflow.com/questions/50684352/lens-does-this-filteredhas-combinator-already-exist", "title": "Lens: Does this filteredHas combinator already exist?", "body": "<p>Does this combinator already exist somewhere in <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code></a> or in another library?</p>\n\n<pre><code>filteredHas :: Lens.Fold s i -&gt; Lens.IndexedTraversal' i s s\nfilteredHas fold f val =\n    case val ^? fold of\n    Nothing -&gt; pure val\n    Just proof -&gt; Lens.indexed f proof val\n</code></pre>\n\n<p>It's useful for cases where one may wish to modify a value only if it has a certain sub-value.</p>\n\n<p>i.e it can replace code like</p>\n\n<pre><code>Lens.filtered (Lens.has part) %~ \\x -&gt; something (x ^?! part) x\n</code></pre>\n\n<p>with <code>filteredHas part %@~ something</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528126138, "post_id": 50684026, "comment_id": 88377695, "body": "The <code>move</code> function is declared <b>in</b> the <code>where</code> clause."}, {"owner": {"reputation": 720, "user_id": 3626046, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fk70i.jpg?s=128&g=1", "display_name": "pitazzo", "link": "https://stackoverflow.com/users/3626046/pitazzo"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528126317, "post_id": 50684026, "comment_id": 88377810, "body": "@WillemVanOnsem which kind of functio is it? Shouldn&#39;t it be declared apart, with its own signature?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528126384, "post_id": 50684026, "comment_id": 88377859, "body": "no, not per se. Here it uses variables from the <i>outer</i> function, so it can not immediately be declared outside. Frequently a <code>where</code> clause contains functions that are tight to the outer function, but are not very generic, etc. to define separately."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1528126446, "post_id": 50684026, "comment_id": 88377899, "body": "Its definition is exactly <code>move f1 f2 item = (f1 item left, f2 item right)</code>, as shown above. Some authors tend to add type signatures to local functions in where blocks (I do, since I believe it helps greatly), but many do not, relying on type inference."}], "answers": [{"tags": [], "owner": {"reputation": 619, "user_id": 8514005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318a3ae487b2140f9d08079450b6903d?s=128&d=identicon&r=PG&f=1", "display_name": "JohEker", "link": "https://stackoverflow.com/users/8514005/joheker"}, "is_accepted": true, "score": 4, "last_activity_date": 1528128525, "last_edit_date": 1528128525, "creation_date": 1528127891, "answer_id": 50684560, "question_id": 50684026, "link": "https://stackoverflow.com/questions/50684026/haskell-function-reverse-engineering/50684560#50684560", "title": "Haskell function reverse engineering", "body": "<p>Maybe take a look at some easier example and see if we can figure out what's going on</p>\n\n<pre><code>foo :: Int -&gt; (Int, Int)\nfoo x =  apply add sub x\n    where\n    apply f1 f2 someThing = (f1 x someThing, f2 x someThing)\n    add k = (+) (1) --&lt;---------------^\n    sub s = (-) (10) -- &lt;-----------------------------^\n</code></pre>\n\n<p>With the input 5, this would give output (6,5). It can often be useful to say something like \"i want to apply x to some function\", where this function itself takes other functions as input. So we can make it more general by saying: here is a function, that together with 2 other functions, gives me my desired output.</p>\n\n<p>In the short example above we say, \"here is a function, that together with two other functions, applies those functions with some values to make a pair\". And we dont really care what those functions are, in this case we used the functions <code>add</code> and <code>sub</code>, but that doesnt have to be the case.</p>\n"}], "owner": {"reputation": 720, "user_id": 3626046, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fk70i.jpg?s=128&g=1", "display_name": "pitazzo", "link": "https://stackoverflow.com/users/3626046/pitazzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 50684560, "answer_count": 1, "score": 1, "last_activity_date": 1528128525, "creation_date": 1528126084, "last_edit_date": 1528126142, "question_id": 50684026, "link": "https://stackoverflow.com/questions/50684026/haskell-function-reverse-engineering", "title": "Haskell function reverse engineering", "body": "<p>I need to analyze the following Haskell function, which is part of a bigger program (extracted from <a href=\"https://stackoverflow.com/questions/6580208/cant-find-the-error-in-my-haskell-code?rq=1\">here</a>):</p>\n\n<pre><code>findMoves :: Position -&gt; [Position]\nfindMoves (left,right) = elems $ Data.Set.filter validPos moves where\n    moves | Farmer `member` left = Data.Set.map (move delItem addItem) left\n          | otherwise = Data.Set.map (move addItem delItem) right\n    move f1 f2 item = (f1 item left, f2 item right)\n    delItem item = delete Farmer . delete item \n    addItem item = insert Farmer . insert item \n</code></pre>\n\n<p>I understand everything until the end of the <code>where</code> statement, but I haven't seen anything like the <code>move f1 f2 item</code> declaration before, I'm starting right now with Haskell. What is that? Something like an in-line function declaration? I just need to know which kind of statement is that, I'm not asking you to explain what the developer was trying to do (that's my task).</p>\n\n<p>Thanks</p>\n"}, {"tags": ["email", "haskell", "yesod"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528119963, "post_id": 50681860, "comment_id": 88373747, "body": "This appears to be off-topic on StackOverflow \u2013 <i>questions asking for resource recommendations, opinion based</i> etc.. Even if it weren&#39;t, it&#39;s pretty unclear what you&#39;re asking here. Why do you need a <code>Handler</code> for sending emails? That can be done simply in a separate <code>IO</code> thread."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528134696, "post_id": 50681860, "comment_id": 88382000, "body": "@leftaroundabout I will create a handler just to call it easily and send it, because the Yesod App has the access to the database and I don&#39;t know how to call it as a program from the command line, as if I was calling a Handler. If you know how to do it please tell me, it is running with keter"}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1528134569, "post_id": 50683961, "comment_id": 88381934, "body": "I will try it out soon then I will ask any questions! Thank you!!"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1528143103, "post_id": 50683961, "comment_id": 88385875, "body": "I have an <code>Web App</code> running on <code>Keter</code>, can I call the App from the command line to achieve it?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1528125902, "creation_date": 1528125902, "answer_id": 50683961, "question_id": 50681860, "link": "https://stackoverflow.com/questions/50681860/haskell-yesod-running-a-handler-at-a-specific-day-of-week-and-at-a-specific-time/50683961#50683961", "title": "Haskell Yesod Running a Handler at a specific Day of Week and at a specific Time", "body": "<p>Here's what I would do:</p>\n\n<pre><code>main = do\n    forkIO . forever $ do\n        waitUntilFridayAt0800\n        sendOutReports\n        waitUntilItIsNotFridayAt0800JustToBeSafe\n    startYesod\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1528173076, "creation_date": 1528119121, "last_edit_date": 1528173076, "question_id": 50681860, "link": "https://stackoverflow.com/questions/50681860/haskell-yesod-running-a-handler-at-a-specific-day-of-week-and-at-a-specific-time", "title": "Haskell Yesod Running a Handler at a specific Day of Week and at a specific Time", "body": "<p>I will create a Handler that, when called, it will send HTML reports to my customer emails, I would like to know the cleanest way to schedule it, for instance, Friday at 08:00AM. I can use Linux crontab to call a URL at a specific time, but it will need to be exposed... (Even though I will make it available to myself to send reports whenever I want, at least in the beginning)</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "edited": false, "score": 0, "creation_date": 1528097291, "post_id": 50674822, "comment_id": 88360363, "body": "You are but a google query away from understanding how recursion works. There are plenty of wonderful tutorials on this topic, don&#39;t let them go to waste."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1528100588, "post_id": 50674822, "comment_id": 88361987, "body": "In Haskell you can not <i>increment</i> variables: <i>all</i> variables are <i>immutable</i>. So once you set it to some value, it stays that value. This requires some creativity at first, but eventually can result in less bugs in code, since you can always safely assume that the value remains unchanged."}, {"owner": {"reputation": 95, "user_id": 9821997, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Muribury Lex", "link": "https://stackoverflow.com/users/9821997/muribury-lex"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528104741, "post_id": 50674822, "comment_id": 88364339, "body": "great thought  @WillemVanOnsem, I write it in the first page of my notes, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 3120, "user_id": 4402721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WCNcL.jpg?s=128&g=1", "display_name": "drRobertz", "link": "https://stackoverflow.com/users/4402721/drrobertz"}, "is_accepted": true, "score": 2, "last_activity_date": 1528097940, "last_edit_date": 1528097940, "creation_date": 1528097304, "answer_id": 50675370, "question_id": 50674822, "link": "https://stackoverflow.com/questions/50674822/haskell-first-statement-static-result-changed-with-the-accumulator/50675370#50675370", "title": "Haskell first statement static result, changed with the accumulator", "body": "<p>As you write, it is recursion.</p>\n\n<p>Let's look at the execution of a call in principle:</p>\n\n<pre><code>myLength \"abc\"\n</code></pre>\n\n<p>matches the second overload, so we get</p>\n\n<pre><code>1 + myLength \"bc\"\n</code></pre>\n\n<p>where the recursive call again matches the second overload so that is equal to</p>\n\n<pre><code>1 + 1 + myLength \"c\"\n</code></pre>\n\n<p>which is equal to </p>\n\n<pre><code>1 + 1 + 1 + myLength \"\"\n</code></pre>\n\n<p>and we have reached the base case </p>\n\n<pre><code>myLength [] = 0\n</code></pre>\n\n<p>so the recursion terminates and the result is</p>\n\n<pre><code>1 + 1 + 1 + 0\n</code></pre>\n\n<p>Note that when the base case \"returns 0\" that is the result for <em>that particular application of the function</em>, not the result of the initial call.</p>\n\n<p>A key here is that each application of a function yields a value. \nThat is, you don't \"go to the next step and do whatever\", you add one to the length of the tail (which is a value). Therefore you don't need some global state (In fact, it would only complicate things).</p>\n\n<p>Also, please note that there is no <em>assignment</em> involved, the functions define equalities and thus the left-hand side can be replaced by the right-hand side.</p>\n"}], "owner": {"reputation": 95, "user_id": 9821997, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Muribury Lex", "link": "https://stackoverflow.com/users/9821997/muribury-lex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 50675370, "answer_count": 1, "score": 1, "last_activity_date": 1528097940, "creation_date": 1528095079, "last_edit_date": 1528097034, "question_id": 50674822, "link": "https://stackoverflow.com/questions/50674822/haskell-first-statement-static-result-changed-with-the-accumulator", "title": "Haskell first statement static result, changed with the accumulator", "body": "<p>I need to understand why this code works:</p>\n\n<pre><code>myLength           :: [a] -&gt; Int\nmyLength []        =  0\nmyLength (_:xs)    =  1 + myLength xs\n</code></pre>\n\n<p>If I understand the recursion correctly, this function \"repeat\" this code:</p>\n\n<ul>\n<li><p>If the list isn't empty, goes to the next step and do whatever</p></li>\n<li><p>but when the list is empty, it stops in the first one and would should return 0</p></li>\n</ul>\n\n<p>I could understand it if it uses a global variable like n and do something like:</p>\n\n<pre><code>myLength [] = n\nmyLength (_:xs) = (n+1) + myLength xs\n</code></pre>\n\n<p>It doesn't work, but the idea is there, have a value 'n' and increment it in each iteration</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 6, "creation_date": 1528092855, "post_id": 50674182, "comment_id": 88358262, "body": "<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-warnings.html#ghc-flag--Wincomplete-patterns\" rel=\"nofollow noreferrer\"><code>-Wincomplete-patterns</code></a>? Might be easier to just <code>-Wall</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1528095075, "post_id": 50674182, "comment_id": 88359300, "body": "<a href=\"http://community.haskell.org/~ndm/darcs/hlint/hlint.htm\" rel=\"nofollow noreferrer\"><code>hlint</code></a> will catch usages."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1528114570, "post_id": 50674182, "comment_id": 88370151, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/31866379/haskell-non-exhaustive-pattern-matching-in-haskell\">Haskell - Non-exhaustive pattern matching in haskell</a>"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1528091904, "creation_date": 1528091904, "question_id": 50674182, "link": "https://stackoverflow.com/questions/50674182/is-it-possible-for-ghc-to-find-all-the-places-that-uses-partial-functions", "title": "Is it possible for GHC to find all the places that uses partial functions?", "body": "<p>Is it possible for GHC to give warning when I define a partial function like this:</p>\n\n<pre><code>f :: Maybe Int -&gt; Int\nf (Just i) = i\n</code></pre>\n\n<p>and when I use a partial function like this:</p>\n\n<pre><code>f :: [Int] -&gt; Int\nf = head\n</code></pre>\n"}, {"tags": ["haskell", "haskell-snap-framework", "servant"], "comments": [{"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 1, "creation_date": 1528076983, "post_id": 50672527, "comment_id": 88354846, "body": "If you don&#39;t mind orphan instances, why not just define an instance yourself for <code>(FromHttpApiData a) =&gt; FromHttpApiData [a]</code>"}, {"owner": {"reputation": 2815, "user_id": 4394797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f29f3a02e559366d897f287948c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "cgold", "link": "https://stackoverflow.com/users/4394797/cgold"}, "reply_to_user": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 0, "creation_date": 1528077375, "post_id": 50672527, "comment_id": 88354901, "body": "@Probie thanks, that&#39;s a clean approach for a single request type. However, I have many request types. It feels odd that I need to write a <code>FromHttpApiData</code> instance for each data type <code>RequestData1, RequestData2,...</code>, all of which can be complex. Since a POST request body can be parsed automatically, it seems like I should be able to re-use the code used there, or is there a technical limitation that prevents doing that?"}], "answers": [{"comments": [{"owner": {"reputation": 2815, "user_id": 4394797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f29f3a02e559366d897f287948c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "cgold", "link": "https://stackoverflow.com/users/4394797/cgold"}, "edited": false, "score": 0, "creation_date": 1528687319, "post_id": 50680650, "comment_id": 88586180, "body": "This worked perfectly. Since this approach returns a <code>Maybe (JSONEncoded a))</code>, I added a helper of type <code>maybeHandler :: HasDefault d =&gt; (a -&gt; Handler b Service d) -&gt; Maybe (JSONEncoded a) -&gt; Handler b Service d</code> so I can continue using my existing API, which is defined through functions of type <code>a -&gt; Handler b Service d</code>. Whenever the JSON could not be parsed, the default value for <code>d</code> is returned."}, {"owner": {"reputation": 2815, "user_id": 4394797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f29f3a02e559366d897f287948c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "cgold", "link": "https://stackoverflow.com/users/4394797/cgold"}, "edited": false, "score": 0, "creation_date": 1528688267, "post_id": 50680650, "comment_id": 88586325, "body": "What happens if my query parameters contain a large list? Would there be any concerns about a URL that balloons to thousands of characters?"}], "tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": true, "score": 1, "last_activity_date": 1528125494, "last_edit_date": 1528125494, "creation_date": 1528115301, "answer_id": 50680650, "question_id": 50672527, "link": "https://stackoverflow.com/questions/50672527/haskell-servant-get-requests-with-arbitrary-request-data/50680650#50680650", "title": "Haskell Servant: GET Requests with arbitrary request data", "body": "<p>A simple solution if you want the same level of automatic derivation as for JSON post bodies is to just send the query params as JSON</p>\n\n<pre><code>import Data.Aeson\nimport Servant.API\nimport qualified Data.Text as T\nimport Data.Text.Encoding\nimport qualified Data.ByteString.Lazy as LBS\n\nnewtype JSONEncoded a = JSONEncoded { unJSONEncoded :: a }\n  deriving (Eq, Show)\n\ninstance (FromJSON a) =&gt; FromHttpApiData (JSONEncoded a) where\n  parseQueryParam x = case eitherDecode $ LBS.fromStrict $ encodeUtf8 x of\n    Left err -&gt; Left (T.pack err)\n    Right val -&gt; Right (JSONEncoded val)\n\ninstance (ToJSON a) =&gt; ToHttpApiData (JSONEncoded a) where\n  toQueryParam (JSONEncoded x) = decodeUtf8 $ LBS.toStrict $ encode x\n</code></pre>\n"}], "owner": {"reputation": 2815, "user_id": 4394797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f29f3a02e559366d897f287948c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "cgold", "link": "https://stackoverflow.com/users/4394797/cgold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 0, "accepted_answer_id": 50680650, "answer_count": 1, "score": 1, "last_activity_date": 1528125494, "creation_date": 1528076742, "question_id": 50672527, "link": "https://stackoverflow.com/questions/50672527/haskell-servant-get-requests-with-arbitrary-request-data", "title": "Haskell Servant: GET Requests with arbitrary request data", "body": "<p>I'm serving an API using Servant, all managed by Snap. In Servant, it's easy to include an arbitrary data type as part of a POST request, assuming it has a <code>FromJSON</code> instance. For instance, I might have the following endpoint:</p>\n\n<pre><code>ReqBody '[JSON] RequestData :&gt; Post '[JSON] [ResponseData]\n</code></pre>\n\n<p>How do I do the same for GET requests? From what I understand, I'd need to use the Query Parameters, but my request data consists of complex datatypes (lists, nested dictionaries) that don't seem to be readable easily, e.g. <code>QueryParam \"vals\" [Int] :&gt; Post '[JSON] [Int]</code> results in the error <code>No instance for (FromHttpApiData [Int])</code></p>\n\n<p>A workaround would be to use POST requests, which have easily readable request bodies. However, this would clash with my caching scheme in Nginx, since responses to POST requests aren't that easily cachable. Even if I can cache them, I don't want to cache all post requests, so it'd be a messy approach.</p>\n\n<p>Thanks for any help!</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1528075945, "creation_date": 1528075945, "answer_id": 50672462, "question_id": 50671906, "link": "https://stackoverflow.com/questions/50671906/why-does-lens-include-an-iso-for-fromenum-toenum-but-not-one-for-show-read/50672462#50672462", "title": "Why does lens include an Iso for fromEnum/toEnum, but not one for show/read?", "body": "<p><em>Warning: speculative answer follows.</em></p>\n\n<p>One difference between the two scenarios I can think of is that it is reasonably easy to clarify when <code>toEnum</code> breaks down (quoting <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Iso.html#v:enum\" rel=\"noreferrer\">the <em>lens</em> docs</a>: \"this is only an isomorphism from the numeric range actually used\"), while things are a fair bit murkier when it comes to <code>read</code>. Another difference is that <code>toEnum</code> is a method of <code>Enum</code> (and one required in a minimal instance definition, at that), while <code>read</code> isn't actually a method of <code>Read</code>, and so is, in a sense, less essential (in fact, the <em>base</em> docs <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:read\" rel=\"noreferrer\">explicitly discourage its usage</a>).</p>\n\n<p>On a more general note, when it comes to choosing between exposing a bullet-proof interface and including useful but potentially unsafe or unlawful combinators, <em>lens</em> usually goes for the latter, making them available for those who wish to use them while acknowleding any potential issues in the documentation (or, in hairier cases, in function and module names). Given that <em>lens</em> is a very general purpose library, this approach can be seen as a non-opinionated choice -- in a context like this, it can be hard to compensate for the absence of combinators.</p>\n\n<p>P.S.: It is also worth noting that <em>lens</em> encodes <code>read</code> and <code>show</code> through <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Prism.html#v:_Show\" rel=\"noreferrer\">the <code>_Show</code> prism</a>. <code>_Show</code> is equivalent to <code>prism' show readMaybe</code>, and is safe with respect to the partiality of <code>Read</code>-ing values.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1528128996, "post_id": 50684070, "comment_id": 88379311, "body": "A fair point. The <code>_Show</code> docs acknowledge this issue (&quot;This <code>Prism</code> is &#39;improper&#39; in the sense that it normalizes the text formatting, but round tripping is idempotent given sane <code>Read</code>/<code>Show</code> instances&quot;), so it can also be seen as another example of <i>lens</i>&#39; tolerance of peccadilloes."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1528126203, "creation_date": 1528126203, "answer_id": 50684070, "question_id": 50671906, "link": "https://stackoverflow.com/questions/50671906/why-does-lens-include-an-iso-for-fromenum-toenum-but-not-one-for-show-read/50684070#50684070", "title": "Why does lens include an Iso for fromEnum/toEnum, but not one for show/read?", "body": "<p>Besides the excellent comments in the other answer, I would hesitate about the lawfulness of these definitions. For the standard instances, where defined, <code>fromEnum . toEnum</code> (and vice versa) is actually <code>id</code>. But <code>show . read</code> is not, even for fully-defined values and using only standard instances, because it canonicalizes formatting and parenthesization:</p>\n\n<pre><code>&gt; show (read \"(5)\" :: Int)\n\"5\"\nData.Tree&gt; show (read \"Node     {      rootLabel=3 ,subForest=[]}\" :: Tree Int)\n\"Node {rootLabel = 3, subForest = []}\"\n</code></pre>\n"}], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 50672462, "answer_count": 2, "score": 2, "last_activity_date": 1528126203, "creation_date": 1528068708, "last_edit_date": 1528076038, "question_id": 50671906, "link": "https://stackoverflow.com/questions/50671906/why-does-lens-include-an-iso-for-fromenum-toenum-but-not-one-for-show-read", "title": "Why does lens include an Iso for fromEnum/toEnum, but not one for show/read?", "body": "<p>Suppose you declare two isomorphisms</p>\n\n<pre><code>showing :: (Read a, Show a) =&gt; Iso' String a\nshowing = iso read show\n\nreading :: (Read a, Show a) =&gt; Iso' a String\nreading = iso show read\n</code></pre>\n\n<p>They are unsafe, not every String will parse as an a. </p>\n\n<p>That begs the question: Why those two aren't included in the library if <code>enum = iso fromEnum toEnum</code> is?</p>\n\n<p>It is just as unsafe and can't be prevented by the type system. They all shift the burden onto the programmer who has to ensure that the transformation will not break the isomorphism.</p>\n\n<p>Quick example: <code>under enum (+1) True</code> will throw an exception </p>\n"}, {"tags": ["regex", "haskell", "types", "web-scraping"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1528055889, "post_id": 50670419, "comment_id": 88350623, "body": "I don&#39;t know about the type error, but your regex is wrong. What exactly are you trying to match?"}, {"owner": {"reputation": 99, "user_id": 1477320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aea41b95d3ac0816d486b2b77f9619c7?s=128&d=identicon&r=PG", "display_name": "ghn", "link": "https://stackoverflow.com/users/1477320/ghn"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1528056083, "post_id": 50670419, "comment_id": 88350672, "body": "Any string starting with wiki/list... I added the brackets after seeing a Haskell regex example somewhere."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1528056121, "post_id": 50670419, "comment_id": 88350683, "body": "OK, you need to remove the brackets then."}, {"owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "edited": false, "score": 0, "creation_date": 1528061369, "post_id": 50670419, "comment_id": 88351991, "body": "You could try turning off the monomorphism restriction"}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 4, "last_activity_date": 1528064428, "creation_date": 1528064428, "answer_id": 50671490, "question_id": 50670419, "link": "https://stackoverflow.com/questions/50670419/resolving-type-ambiguity-with-non-primitive-types/50671490#50671490", "title": "Resolving type ambiguity with non-primitive types", "body": "<p>The incantation should be</p>\n\n<pre><code>\"href\" @=~ (makeRegex (\"^/wiki/List_of_colleges_and_universities_in_\" :: String) :: Regex)\n</code></pre>\n\n<p><code>@=~</code> is polymorphic in its argument type, so you need <code>:: Regex</code> to nail it down. There is no <code>IsString Regex</code>, so you need to use <code>makeRegex</code>. <code>makeRegex</code> is extremely polymorphic. Its return type is already nailed down with <code>:: Regex</code>, so just you need to give its argument a <code>:: String</code> to get past <code>-XOverloadedStrings</code>'s polymorphism.</p>\n\n<p>You can clean up this mess with</p>\n\n<pre><code>regex :: String -&gt; Regex\nregex = makeRegex\n\n\"href\" @=~ regex \"^/wiki/List_of_colleges_and_universities_in_\"\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 1477320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aea41b95d3ac0816d486b2b77f9619c7?s=128&d=identicon&r=PG", "display_name": "ghn", "link": "https://stackoverflow.com/users/1477320/ghn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 50671490, "answer_count": 1, "score": 1, "last_activity_date": 1528064428, "creation_date": 1528055497, "question_id": 50670419, "link": "https://stackoverflow.com/questions/50670419/resolving-type-ambiguity-with-non-primitive-types", "title": "Resolving type ambiguity with non-primitive types", "body": "<p>I'm having difficulty figuring out how to resolve this type ambiguity in the following code. I'm trying to use the library Text.HTML.Scalpel to get all  elements with an href attribute that satisfies a regex.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport           Control.Monad\nimport qualified Data.ByteString.Char8  as B8\nimport           Data.List\nimport           Network.HTTP.Simple\nimport           Text.HTML.Scalpel.Core\nimport           Text.Regex.Posix\n\nmain :: IO ()\nmain = do\n  content &lt;- fetchUrlBody \"http://en.wikipedia.org/wiki/Lists_of_American_institutions_of_higher_education\"\n  print $ scrapeStringLike content getStateListings\n\nfetchUrl :: Request -&gt; IO (Response B8.ByteString)\nfetchUrl req = httpBS req\n\nfetchUrlBody :: Request -&gt; IO (B8.ByteString)\nfetchUrlBody req = fmap getResponseBody $ fetchUrl req\n\ngetStateListings :: Scraper B8.ByteString [B8.ByteString]\ngetStateListings =\n  attrs \"href\" (\"a\" @: [\"href\" @=~ \"[^/wiki/List_of_colleges_and_universities_in_]\"])\n</code></pre>\n\n<p>Gives the the following error:</p>\n\n<pre><code>     Ambiguous type variable re0 arising from a use of @=~\n      prevents the constraint (RegexLike re0 String) from being solved.\n      Probable fix: use a type annotation to specify what re0 should be.\n      These potential instance exist:\n        instance RegexLike Regex String\n          -- Defined in Text.Regex.Posix.String\n     In the expression:\n        \"href\" @=~ \"[^/wiki/List_of_colleges_and_universities_in_]\"\n      In the second argument of (@:), namely\n        [\"href\" @=~ \"[^/wiki/List_of_colleges_and_universities_in_]\"]\n      In the second argument of attrs, namely\n        (\"a\"\n            @: [\"href\" @=~ \"[^/wiki/List_of_colleges_and_universities_in_]\"])\n   |\n23 |   attrs \"href\" (\"a\" @: [\"href\" @=~ \"[^/wiki/List_of_colleges_and_universities_in_]\"])\n   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I've tried various things including changing troublesome line to:</p>\n\n<pre><code>getStateListings :: Scraper B8.ByteString [B8.ByteString]\ngetStateListings =\n  attrs \"href\" (\"a\" @: [\"href\" @=~ (makeRegex \"[^/wiki/List_of_colleges_and_universities_in_]\" :: Regex)])\n</code></pre>\n\n<p>Which seems to satisfy re0 in the RegexLike constraint, but now it needs the source type also. I have no idea how to specify a type annotation such that the regex is of type <code>RegexLike Regex ByteString</code>. The new error is:</p>\n\n<pre><code>     Ambiguous type variable source0 arising from a use of makeRegex\n      prevents the constraint (RegexMaker\n                                  Regex CompOption ExecOption source0) from being solved.\n      Probable fix: use a type annotation to specify what source0 should be.\n      These potential instances exist:\n        instance RegexMaker Regex CompOption ExecOption B8.ByteString\n          -- Defined in Text.Regex.Posix.ByteString\n        instance RegexMaker Regex CompOption ExecOption String\n          -- Defined in Text.Regex.Posix.String\n        ...plus two instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n     In the second argument of (@=~), namely\n        (makeRegex \"[^/wiki/List_of_colleges_and_universities_in_]\" ::\n            Regex)\n      In the expression:\n        \"href\"\n          @=~\n            (makeRegex \"[^/wiki/List_of_colleges_and_universities_in_]\" ::\n               Regex)\n      In the second argument of (@:), namely\n        [\"href\"\n            @=~\n              (makeRegex \"[^/wiki/List_of_colleges_and_universities_in_]\" ::\n                 Regex)]\n   |\n23 |   attrs \"href\" (\"a\" @: [\"href\" @=~ (makeRegex \"[^/wiki/List_of_colleges_and_universities_in_]\" :: Regex)])\n   |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["docker", "haskell", "docker-compose", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 0, "last_activity_date": 1528065625, "creation_date": 1528065625, "answer_id": 50671621, "question_id": 50669637, "link": "https://stackoverflow.com/questions/50669637/error-building-haskell-stack-project-using-docker-compose/50671621#50671621", "title": "Error building Haskell stack project using docker-compose", "body": "<p>This is related to a stack bug, which has been fixed in more recent releases.  So, I suspect that docker image has too old of a stack version.</p>\n\n<p>Unfortunately, the Cassava maintainer has refused to merge patches removing a double hyphen from a flag name.  Howeve,r </p>\n"}], "owner": {"reputation": 345, "user_id": 5717066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zXUcs.jpg?s=128&g=1", "display_name": "Matteo Ugolotti", "link": "https://stackoverflow.com/users/5717066/matteo-ugolotti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1528065625, "creation_date": 1528050382, "question_id": 50669637, "link": "https://stackoverflow.com/questions/50669637/error-building-haskell-stack-project-using-docker-compose", "title": "Error building Haskell stack project using docker-compose", "body": "<p>I'm starting a new Haskell project using stack, and I would like to build and run it using docker-compose, so that I can run it with other applications (db, load balancer, etc ...).</p>\n\n<p>However my stack project is failing to build inside the container.\nAfter running docker-compose up, I'm getting this error</p>\n\n<pre><code>...\nStep 6/8 : RUN stack build --dependencies-only ---&gt; Running in 6d42f4797edd\nDownloading lts-11.10 build plan ...\nDownloaded lts-11.10 build plan.\nAesonException \"Error in $.packages.cassava.constraints.flags['bytestring--lt-0_10_4']: Invalid flag name: \\\"bytestring--lt-0_10_4\\\"\"\nERROR: Service 'be' failed to build: The command '/bin/sh -c stack build --dependencies-only' returned a non-zero code: 1 \n</code></pre>\n\n<p>My project structure looks like</p>\n\n<pre><code>- README.md\n- docker-compose.yml\n/be\n  - Dockerfile\n  - /app\n  - /src\n  - be.cabal\n  - stack.yaml\n/fe\n  - ...\n</code></pre>\n\n<p>My docker-compose.yml looks like</p>\n\n<pre><code>version: '3'\nservices:\n    be:\n        build: ./be\n        image: be\n        command: stack exec be\n        ...\n    fe:\n      ...\n</code></pre>\n\n<p>My BE Dockerfile</p>\n\n<pre><code>FROM haskell:8.2\nRUN mkdir -p /app/user\nWORKDIR /app/user\nCOPY stack.yaml *.cabal ./\n\nRUN export PATH=$(stack path --local-bin):$PATH\nRUN stack build --dependencies-only\n\nCOPY . /app/user\nRUN stack install\n</code></pre>\n\n<p>My stack.yaml</p>\n\n<pre><code>resolver: lts-11.10\npackages:\n</code></pre>\n\n<p>My .cabal</p>\n\n<pre><code>...\nlibrary\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                       , aeson\n  default-language:    Haskell2010\n\nexecutable be\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                       , be\n  default-language:    Haskell2010\n</code></pre>\n\n<p>My stack build is working perfectly fine in local, so I guess there could be something wrong with the Haskell image I'm using for the Docker container ?</p>\n\n<p>Any suggestion or help would be really appreciated.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528038944, "post_id": 50667905, "comment_id": 88345574, "body": "Well do you understand what a monad is? It is not impossible to perform the function, but you will not obtain the &quot;value&quot;, but the <code>Monad value</code>."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528038990, "post_id": 50667905, "comment_id": 88345589, "body": "That is what I am trying to understand."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528039111, "post_id": 50667905, "comment_id": 88345624, "body": "Well to be honest, I think it is better to first have some understanding about monads, before mixing it with <code>where</code> clauses, etc. Monads like the state monad, actually are used partly to exactly prevent getting the state it wraps in a where clause, since that state might change, and by using a <code>where</code> clause, it would create unpredictable behaviour when exactly you obtain the state/value it stores."}, {"owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "edited": false, "score": 1, "creation_date": 1528039818, "post_id": 50667905, "comment_id": 88345827, "body": "In fact, you can access the value, and the error message is telling you something slightly different. I&#39;ll write an answer."}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1528040736, "post_id": 50668118, "comment_id": 88346125, "body": "I thought that it had something to do with <code>s</code> and <code>s1</code>, but I could not figure out how to fix it. This example is actually part of a larger program that I am writing to solve Sudoku puzzles, as an exercise to learn/improve my Haskell. In my larger code, I got an error about ambiguous declarations when I left out the type on the <code>readArray</code>, but I did not know or understand about <code>ScopedTypeVariables</code>. Thanks for the thorough explanation."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1528067827, "post_id": 50668118, "comment_id": 88353335, "body": "@Ralph FWIW you probably don&#39;t need to mess around with <code>ST</code> just to write a su doku solver. In fact I would expect it to be significantly easier to write it in a pure style, given that su doku involves backtracking. (<code>ST</code> is a monad for writing high performance imperative code which directly accesses mutable memory locations.)"}], "tags": [], "owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "is_accepted": true, "score": 6, "last_activity_date": 1528040415, "creation_date": 1528040415, "answer_id": 50668118, "question_id": 50667905, "link": "https://stackoverflow.com/questions/50667905/accessing-parameter-from-where-clause-function-in-haskell/50668118#50668118", "title": "Accessing parameter from where clause function in Haskell", "body": "<p>First note that the error message says something about lacking an instance declaration rather than unknown variable name. Furthemore, as a first hint, note that the error message contains two different <code>ST</code> tags: <code>s</code> arising from <code>STUArray</code> (which is related to the <code>arr</code> parameter of your function), and another <code>s1</code> in <code>ST s1</code>. Where does that <code>s1</code> come from? Indeed, there is no mention of it in your program!</p>\n\n<p>As a second hint, try removing the signature declaration for <code>readArr</code>, so that the <code>where</code> clause looks like just</p>\n\n<pre><code>  where\n    readArr = readArray arr 0\n</code></pre>\n\n<p>Suddenly that typechecks and works just fine. What's going on?</p>\n\n<p>The answer is that when you wrote <code>readArr :: ST s Int</code>, you meant the <code>s</code> from the <code>checkArr</code> signature, but the scoping rules are such that this actually introduces a new type variable, which the typechecker renames for you into <code>s1</code>, and <code>s</code> doesn't necessarily match with <code>s1</code>, hence the type error. If you omit this signature, then the typechecker is able to derive the correct type itself.</p>\n\n<p>If you really want to write the type in a <code>where</code>-binding like this, there's an extension for that! <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"noreferrer\"><code>ScopedTypeVariables</code></a> allows you to refer to a free variable (which the <code>s</code> from <code>checkArr</code> signature is) from within the function. So, add a <code>{-# LANGUAGE ScopedTypeVariables #-}</code> and let the typechecker know you want it scoped by writing an explicit <code>forall</code> in the top-level signature: <code>checkArr :: forall s. STUArray s Int Int -&gt; ST s Bool</code>. After that, your code will typecheck.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 50668118, "answer_count": 1, "score": 2, "last_activity_date": 1528040415, "creation_date": 1528038862, "question_id": 50667905, "link": "https://stackoverflow.com/questions/50667905/accessing-parameter-from-where-clause-function-in-haskell", "title": "Accessing parameter from where clause function in Haskell", "body": "<p>I understand that with \"normal\" functions, I can access parameters on the top-level from within a function defined in a <code>where</code> clause. However, when I try the same thing with monadic functions, I get a compile-time error.</p>\n\n<p>This works:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad.ST (ST, runST)\nimport Data.Array.ST    (STUArray, newArray, readArray)\n\nmain :: IO ()\nmain = do\n  print $ runST $ do\n              arr &lt;- newArray (0, 9) 0\n              checkArr arr\n  return ()\n\ncheckArr :: STUArray s Int Int -&gt; ST s Bool\ncheckArr arr = do\n  val &lt;- readArr arr\n  return $ val == 0\n  where\n    readArr :: STUArray s Int Int -&gt; ST s Int\n    readArr arr = readArray arr 0\n</code></pre>\n\n<p>But this does not:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad.ST (ST, runST)\nimport Data.Array.ST    (STUArray, newArray, readArray)\n\nmain :: IO ()\nmain = do\n  print $ runST $ do\n              arr &lt;- newArray (0, 9) 0\n              checkArr arr\n  return ()\n\ncheckArr :: STUArray s Int Int -&gt; ST s Bool\ncheckArr arr = do\n  val &lt;- readArr\n  return $ val == 0\n  where\n    readArr :: ST s Int\n    readArr = readArray arr 0\n</code></pre>\n\n<p>It results in the following error:</p>\n\n<pre><code>No instance for (Data.Array.Base.MArray (STUArray s) Int (ST s1)) arising from a use of \u2018readArray\u2019\n</code></pre>\n\n<p>Why can't I access the <code>arr</code> parameter of <code>checkArr</code> in <code>readArr</code>?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528036748, "post_id": 50667519, "comment_id": 88344925, "body": "Why do you write <code>y `mod` 2</code> here?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1528037272, "last_edit_date": 1528037272, "creation_date": 1528036871, "answer_id": 50667560, "question_id": 50667519, "link": "https://stackoverflow.com/questions/50667519/output-list-of-integers-divisible-by-y-and-z-haskell/50667560#50667560", "title": "Output list of integers divisible by Y and Z Haskell", "body": "<p>A number <code>x</code> is divisible by a number <code>y</code>, in case <code>mod x y == 0</code>. If you want numbers to be divisible by <code>y</code>, you thus should rewrite you filter <code>y `mod` 2 == 0</code>, to <code>x `mod` y == 0</code> (here <code>x</code> is the number you want to filter after all), or more compact <code>mod x y == 0</code>.</p>\n\n<p>So we can rewrite it to:</p>\n\n<pre><code>divisByYnZ y z = [x | x &lt;- [1..500], mod x y == 0, mod x z == 0]\n</code></pre>\n\n<h1>Optimizing the generator</h1>\n\n<p>This is however not very efficient: imagine that <code>y</code> is <code>100</code>, then it means we will each time generate hundred elements, before one of the elements matches. We thus better first \"prepare\" the generator to only generate numbers that are divisible by <code>y</code>. Which is <code>[y, y+y..500]</code> (we here make the assumption that <code>y</code> is <em>strictly</em> positive):</p>\n\n<pre><code>-- given y is strictly positive\ndivisByYnZ y z = [x | x &lt;- [y, y+y..500], mod x z == 0]\n</code></pre>\n\n<h1>Combining two modulo checks with the <em>least common multiple</em></h1>\n\n<p>A number is divisibly by two numbers <code>a</code> and <code>b</code>, if and only if it is divisible by the <em>least common multiple</em> (LCM). In Haskell the prelude has a function <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:lcm\" rel=\"nofollow noreferrer\"><strong><code>lcm :: Integral i =&gt; i -&gt; i -&gt; i</code></strong></a> that calculates the least common multiple. We can thus rewrite the list comprehension to:</p>\n\n<pre><code>-- given y and z are strictly positive\ndivisByYnZ y z = [t, t+t..500]\n    where t = lcm y z\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 9573782, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_PLDg0WL0G4/AAAAAAAAAAI/AAAAAAAABVM/rkO3KRgRlEs/photo.jpg?sz=128", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/9573782/mikhail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 50667560, "answer_count": 1, "score": -1, "last_activity_date": 1528037272, "creation_date": 1528036670, "question_id": 50667519, "link": "https://stackoverflow.com/questions/50667519/output-list-of-integers-divisible-by-y-and-z-haskell", "title": "Output list of integers divisible by Y and Z Haskell", "body": "<p>I am trying to write a function that would output a list of integers divisible by Y and Z from 1 to 500. However I get an empty list. What am I doing wrong? </p>\n\n<pre><code>divisByYnZ :: Int -&gt; Int -&gt; [Int]\ndivisByYnZ y z = [x | x &lt;- [1..500], y `mod` 2 == 0 &amp;&amp; z `mod` 2 == 0]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "edited": false, "score": 0, "creation_date": 1528034557, "post_id": 50667167, "comment_id": 88344257, "body": "@WillemVanOnsem type Day from Data.Time I need convert (Integer,Int,Int) ---&gt;&gt;&gt;&gt; Day"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1528035064, "creation_date": 1528035064, "answer_id": 50667284, "question_id": 50667167, "link": "https://stackoverflow.com/questions/50667167/how-to-convert-integer-int-int-to-day-couldnt-match-expected-type-day-w/50667284#50667284", "title": "How to convert (Integer, Int, Int ) to Day. Couldn&#39;t match expected type \u2018Day\u2019 with actual type \u2018(Integer, Int, Int)\u2019", "body": "<p>Well actually you already got a <code>Day</code> object, but by using <code>toGregorian</code>, you convert it into a triple <code>(Integer, Int, Int)</code> (the year, month, day according to the <em>Gregorian</em> calendar). So you can actually just drop the <code>toGregorian</code> function call:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  Prelude.putStrLn \"Please,enter date YYYY-MM-DD\"\n  currentTime &lt;- getCurrentTime\n  date &lt;- Prelude.getLine\n  let sTime = show currentTime \n  let retrievedDate = <b>utctDay currentTime</b>\n  let forecastDay = parseTimeM True defaultTimeLocale \"%Y-%-m-%-d\" date :: Maybe Day\n  let diifedDays = diffDays (fromJust forecastDay) retrievedDate\n  if date &gt;= show retrievedDate && diifedDays &gt; 0 && diifedDays &lt;= 16 \n     then print date\n     else print \"Time Error!\"</code></pre>\n\n<p>If you however need to convert the triple back, you can use the <a href=\"http://hackage.haskell.org/package/time-1.9.1/docs/Data-Time-Calendar.html#v:fromGregorian\" rel=\"nofollow noreferrer\"><strong><code>fromGregorian :: Integer -&gt; Int -&gt; Int -&gt; Day</code></strong></a> function. For a triple <code>(Integer, Int, Int)</code>, we can thus use:</p>\n\n<pre><code>\\(y, m, d) -&gt; fromGregorian y m d\n</code></pre>\n\n<p>Besides that your code makes however a rather chaotic impression with a lot of <code>let</code> statements, <code>show</code>s, etc. So I would really advice you to clean it up.</p>\n"}, {"tags": [], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "is_accepted": true, "score": 2, "last_activity_date": 1528035068, "creation_date": 1528035068, "answer_id": 50667285, "question_id": 50667167, "link": "https://stackoverflow.com/questions/50667167/how-to-convert-integer-int-int-to-day-couldnt-match-expected-type-day-w/50667285#50667285", "title": "How to convert (Integer, Int, Int ) to Day. Couldn&#39;t match expected type \u2018Day\u2019 with actual type \u2018(Integer, Int, Int)\u2019", "body": "<p>What you need to fix your error is simply remove <code>toGregorian</code> and it will typecheck just fine.</p>\n\n<p>You might want to work on your logic though. </p>\n"}], "owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 50667285, "answer_count": 2, "score": 0, "last_activity_date": 1528035068, "creation_date": 1528034264, "question_id": 50667167, "link": "https://stackoverflow.com/questions/50667167/how-to-convert-integer-int-int-to-day-couldnt-match-expected-type-day-w", "title": "How to convert (Integer, Int, Int ) to Day. Couldn&#39;t match expected type \u2018Day\u2019 with actual type \u2018(Integer, Int, Int)\u2019", "body": "<pre><code>main :: IO ()\nmain = do\n  Prelude.putStrLn \"Please,enter date YYYY-MM-DD\"\n  currentTime &lt;- getCurrentTime\n  date &lt;- Prelude.getLine\n  let sTime = show currentTime \n  let retrievedDate = toGregorian $ utctDay currentTime\n  let forecastDay = parseTimeM True defaultTimeLocale \"%Y-%-m-%-d\" date :: Maybe Day\n  let diifedDays = diffDays (fromJust forecastDay) retrievedDate\n  if date &gt;= show retrievedDate &amp;&amp; diifedDays &gt; 0 &amp;&amp; diifedDays &lt;= 16 \n     then print date\n     else print \"Time Error!\"\n</code></pre>\n\n<p>I need retrievedDate (Integer,Int,Int) conver to Day.\nThe task is: subtract from (forecastDay - retrievedDay)\nBut I can not do this, since I need retrievedDate convert to Day</p>\n\n<p>Error Message: \n Couldn't match expected type \u2018Day\u2019\n                  with actual type \u2018(Integer, Int, Int)\u2019</p>\n\n<p>42 |  let diifedDays = diffDays (fromJust forecastDay) retrievedDate</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1528996421, "post_id": 50772188, "comment_id": 88727847, "body": "Awesome! I recalling visiting that page, but couldn&#39;t figure out what any of those enums mean. If you happen to know, can you please expand the answer?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1529000824, "post_id": 50772188, "comment_id": 88729908, "body": "Sorry my bad it should be <code>End Newer</code> instead of <code>Master Newer</code>."}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 3, "last_activity_date": 1529000682, "last_edit_date": 1529000682, "creation_date": 1528531436, "answer_id": 50772188, "question_id": 50666868, "link": "https://stackoverflow.com/questions/50666868/how-to-modify-order-of-tabbed-windows-in-xmonad/50772188#50772188", "title": "How to modify order of tabbed windows in XMonad?", "body": "<p><a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Hooks-InsertPosition.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Hooks-InsertPosition.html</a></p>\n\n<p>You need to set this on your config's <code>manageHook</code>:</p>\n\n<pre><code>import XMonad.Hooks.InsertPosition\n\n... manageHook = insertPosition End Newer &lt;+&gt; myManageHook\n</code></pre>\n\n<p>The type signature of <code>insertFunction</code> is <code>Position -&gt; Focus -&gt; ManageHook</code>. In plain English:  it is a function that takes a <code>Focus</code> and <code>Position</code> (in this case <code>End</code> and <code>Newer</code>), and it returns a <code>ManageHook</code>.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 50772188, "answer_count": 1, "score": 3, "last_activity_date": 1529000682, "creation_date": 1528032096, "question_id": 50666868, "link": "https://stackoverflow.com/questions/50666868/how-to-modify-order-of-tabbed-windows-in-xmonad", "title": "How to modify order of tabbed windows in XMonad?", "body": "<p>I'm using <a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Layout-Tabbed.html\" rel=\"nofollow noreferrer\">tabbed</a> and I would like to change behavior so that the new window is created on the right side (like browser tabs).</p>\n\n<p>I see no easy way to do this. Do I need to write a new layout?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1528027399, "post_id": 50666180, "comment_id": 88342227, "body": "Typically one uses a type parameter."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528031834, "post_id": 50666180, "comment_id": 88343554, "body": "It&#39;s important to clarify here whether the <i>users</i> only interact with a complete compiled program, or they compile their own program using your library. Either way, the question could use some example code."}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": true, "score": 2, "last_activity_date": 1528193111, "creation_date": 1528193111, "answer_id": 50697423, "question_id": 50666180, "link": "https://stackoverflow.com/questions/50666180/is-there-a-common-pattern-allowing-to-extend-existing-state-in-haskell/50697423#50697423", "title": "Is there a common pattern allowing to extend existing state in Haskell?", "body": "<p><strong>Parsec</strong> is a pretty famous library that uses the kind of user state\nthat you mentioned in the question. It might be helpful to see what it\ndoes. I'm using <a href=\"http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec.html\" rel=\"nofollow noreferrer\" title=\"Parsec\">this documentation</a>.</p>\n\n<p>What does Hoogle say about the type of the <strong>ParsecT</strong> monad transformer?</p>\n\n<blockquote>\n  <p>ParsecT s u m a is a parser with stream type s, user state type u,\n  underlying monad m and return type a.</p>\n  \n  <p>Parsec is strict in the user state.</p>\n  \n  <p>If this is undesirable, simply use a data type like data Box a = Box a\n  and the state type Box YourStateType to add a level of indirection.</p>\n</blockquote>\n\n<p>Next, let's see how the module's authors allow its users to manipulate the\nuser state.  We can read this state by using the following function:</p>\n\n<pre><code>getState :: Monad m =&gt; ParsecT s u m u\n</code></pre>\n\n<p>The state can be written using the following function:</p>\n\n<pre><code>putState :: Monad m =&gt; u -&gt; ParsecT s u m ()\n</code></pre>\n\n<p>The state can be transformed using this function:</p>\n\n<pre><code>modifyState :: Monad m =&gt; (u -&gt; u) -&gt; ParsecT s u m ()\n</code></pre>\n\n<p>Finally, we take a look at the way in which the initial user state is passed\nto a function of the type <code>ParsecT s u m a</code>:</p>\n\n<pre><code>runParser :: Stream s Identity t =&gt; \n             Parsec s u a -&gt; u -&gt; SourceName -&gt; s -&gt; \n             Either ParseError a\n</code></pre>\n\n<p>I haven't seen complaints about the interface Parsec uses\nfor user state, so the functions above ought to be a good first step\nfor your library's design.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 50697423, "answer_count": 1, "score": 0, "last_activity_date": 1528193111, "creation_date": 1528027344, "question_id": 50666180, "link": "https://stackoverflow.com/questions/50666180/is-there-a-common-pattern-allowing-to-extend-existing-state-in-haskell", "title": "Is there a common pattern allowing to extend existing state in Haskell?", "body": "<p>Suppose I'm designing a library that tracks its internal state and I want to allow users add their own custom state. What kind of interface would users expect to have for this purpose?</p>\n\n<p>To be more precise, this question is primarily about adding independent state to an existing state such that the scope (or lifecycle) of the state would remain unchanged.</p>\n"}, {"tags": ["list", "haskell", "gadt", "data-kinds"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1528024159, "post_id": 50665537, "comment_id": 88341331, "body": "Well a <code>Val &#39;TList</code> is either made from a <code>[Val &#39;TInt]</code> or a <code>[Val &#39;TList]</code> and one can\u2019t decide this without inspecting the value. There isn\u2019t a straightforward way to express the type with the definition of <code>Val</code> you currently have and there is no way to implement <code>fromList</code> in a way that would always work. The type <code>forall a . Val a</code> means \u201cif you come up with a type <code>a</code> then I will give you a list of <code>Val a</code>\u201d, which you clearly don\u2019t satisfy"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1528025900, "post_id": 50665537, "comment_id": 88341827, "body": "@DanRobertson but does it really require to inspect value? Types can be known in advance, like <code>[I 3, I 42, I 10]</code>. Just need to check that every element of list has same type. I&#39;m okay with having compile time errors when <code>fromList</code> can&#39;t work because it doesn&#39;t know type of value."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1528026313, "post_id": 50665537, "comment_id": 88341928, "body": "Have <code>data P where P :: Val a -&gt; P</code> and define functions <code>[Val a] -&gt; [P]</code>, <code>P -&gt; ValType</code>, and <code>[P] -&gt; Val &#39;TList</code> which throws an error if it\u2019s not possible. Finally you can have <code>Item (Val &#39;TList) = P</code>"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1528026666, "post_id": 50665537, "comment_id": 88342022, "body": "@DanRobertson Thanks! I&#39;ve already have <code>data AnyValue = forall a . AnyValue (Val a)</code> which is the same as your <code>P</code>. I also thought about this direction of implementation. Though, this approach is not typesafe... I also have <code>S String</code> constructor. With <code>IsString</code> and <code>Num</code> instances it will be possible to write <code>[3, &quot;foo&quot;]</code> without static guarantees which I don&#39;t like..."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1528026809, "post_id": 50665537, "comment_id": 88342067, "body": "I did say it wouldn\u2019t be safe. I suppose you could also change <code>ValType</code> to have <code>TList ValType</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1528063333, "post_id": 50665537, "comment_id": 88352466, "body": "When you say nested, what do you mean? With this type, you cannot mix <code>I</code>s with <code>L</code>s in a single list (like <code>L [I 1, L [I 1, I 2]]</code>). Is that ok for what you&#39;re looking for? If it&#39;s ok for it to continue being like that, I think I might have an idea. (Also, on a different, slightly pedantic, topic: there are no arrays in this code. You only have linked lists in the snippet.)"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1528076286, "post_id": 50665537, "comment_id": 88354736, "body": "@DavidYoung No, <code>L [I 1, L [I 1, I 2]]</code> should not be possible. But this should be possible: <code>L [L [I 1], L [L [I 1, I 2]]]</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1528077945, "post_id": 50665537, "comment_id": 88354982, "body": "@Shersh Do you also want <code>[[I 1], [[I 1, I 2]]]</code> to work, through <code>fromList</code>? If so, I&#39;m pretty sure that would be impossible."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1528090738, "post_id": 50665537, "comment_id": 88357503, "body": "@DavidYoung Yeah, I would expect it to work. Okay, if it&#39;s not possible. I can live with that. I just hoped there exist some way to achieve this... Should know your limits!"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1528034631, "creation_date": 1528034631, "answer_id": 50667224, "question_id": 50665537, "link": "https://stackoverflow.com/questions/50665537/islist-instance-for-gadt/50667224#50667224", "title": "&#39;IsList&#39; instance for GADT", "body": "<p><code>IsList</code> doesn't seem suited to this since the item type <code>Item l</code> must be determined by the list type <code>l</code>. However, overloading of lists can be pushed further with <code>RebindableSyntax</code>:</p>\n\n<pre><code>{-# LANGUAGE RebindableSyntax, OverloadedLists #-}\n\nfromListN :: _Int -&gt; [Val a] -&gt; Val 'TList\nfromListN _ = L\n</code></pre>\n\n<p>Now <code>[[I 3, I 2]]</code> is sugar for <code>fromListN 1 [fromListN 2 [I 3, I 2]]</code>, which reduces to <code>L [L [I 3, I 2]]</code>.</p>\n\n<p>We can keep the original behavior using a type class like <code>IsList</code>, but which decouples the item and list types.</p>\n\n<pre><code>class IsList item l where\n  fromListN :: Int -&gt; [item] -&gt; l\n\ninstance IsList (Val a) (Val 'TList) where\n  fromListN _ = L\n\ninstance (item ~ item') =&gt; IsList item [item'] where\n  fromListN _ = id\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1528076606, "post_id": 50672328, "comment_id": 88354787, "body": "Thanks, that&#39;s a good solution to consider! Unfortunately, it doesn&#39;t work to me completely. It should be possible to have list of different types for me. So it&#39;s either every element of list is <code>I</code> or <code>L</code> but if every element of list is <code>L</code>, each <code>L</code> can contain different types."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 1, "last_activity_date": 1528074821, "last_edit_date": 1528074821, "creation_date": 1528074384, "answer_id": 50672328, "question_id": 50665537, "link": "https://stackoverflow.com/questions/50665537/islist-instance-for-gadt/50672328#50672328", "title": "&#39;IsList&#39; instance for GADT", "body": "<p>You are throwing away information by only storing the fact that an <code>L ...</code> contains a list of <code>Val a</code>s in its type. If you keep this information around</p>\n\n<pre><code>data ValType = TInt | TList ValType\n\ndata Val (t :: ValType) where\n    I :: Int     -&gt; Val 'TInt\n    L :: [Val a] -&gt; Val ('TList a)\n</code></pre>\n\n<p>then it becomes possible to implement an instance for the <code>IsList</code> type class from the standard library:</p>\n\n<pre><code>instance IsList (Val ('TList a)) where\n    type Item (Val ('TList a)) = Val a\n\n    fromList      = L\n    toList (L xs) = xs\n\n-- (For completeness, this example requires the OverloadedLists extension)\nexample :: String\nexample = show ([I 1, I 2, I 3] :: Val ('TList TInt))\n</code></pre>\n\n<p>Also note that you can implement <code>toList</code>. Because this <code>toList</code> has type <code>Val ('TList a) -&gt; [Val a]</code> it cannot be passed a non-list, so the above implementation is not partial. You can verify this type yourself by using a type hole: <code>toList = _</code>. You can also verify that an (attempt at) implementation like the following will give a type error: <code>toList (I x) = undefined</code>.</p>\n\n<p>Every item in the list must have the same type (you cannot have mix integers with lists within a single list, for example), but this was also the case for the original code from the question.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1528074821, "creation_date": 1528022834, "question_id": 50665537, "link": "https://stackoverflow.com/questions/50665537/islist-instance-for-gadt", "title": "&#39;IsList&#39; instance for GADT", "body": "<p>I have troubles implementing <code>IsList</code> instance for <code>GADT</code> which represents structure of values inside nested arrays. Here is complete code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds         #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE GADTs             #-}\n{-# LANGUAGE RankNTypes        #-}\n{-# LANGUAGE TypeFamilies      #-}\n\nimport GHC.Exts (IsList (..))\n\ndata ValType = TInt | TList\n\ndata Val (t :: ValType) where\n    I :: Int -&gt; Val 'TInt\n    L :: [Val a] -&gt; Val 'TList\n\ninstance Show (Val t) where\n  show (I i) = \"I \" ++ show i\n  show (L a) = show a\n\ninstance IsList (Val 'TList) where\n    type Item (Val 'TList) = forall a . Val a\n\n    fromList = L\n    toList = error \"Not implemented!\"\n</code></pre>\n\n<p>I see such error:</p>\n\n<pre><code>GADT.hs:20:10: error:\n    \u2022 Illegal polymorphic type: forall (a :: ValType). Val a\n    \u2022 In the type instance declaration for \u2018Item\u2019\n      In the instance declaration for \u2018IsList (Val  'TList)\u2019\n   |\n20 |     type Item (Val 'TList) = forall a . Val a\n   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I partially understand why I have this error. But I would like know if it's possible to implement <code>IsList</code> instance for <code>Val</code> type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1528021747, "post_id": 50665374, "comment_id": 88340710, "body": "Well if you have an idea, wouldn&#39;t it make sense to share it?"}, {"owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528022184, "post_id": 50665374, "comment_id": 88340811, "body": "I believe you would need to create a case for each variable in (d,m,y). But I&#39;m not sure how I could go about it."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1528022214, "post_id": 50665374, "comment_id": 88340819, "body": "Here&#39;s an idea: write functions <code>toMonth :: Int -&gt; String</code>, and <code>toOrdinal :: Int -&gt; String</code>, then bring them together. Do you think you could do that?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1528022807, "post_id": 50665374, "comment_id": 88340962, "body": "@goat: can you explain why you think every variable needs a case?"}, {"owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1528023367, "post_id": 50665374, "comment_id": 88341107, "body": "@AJFarmar I did the toMonth function, I edited the code above, but not sure what the toOrdinal function is supposed to do?   WillemVanOnsem, Because the users input would need to match a day,month,year? As in, in the case of a user inputting 1, the month would be January."}, {"owner": {"reputation": 835, "user_id": 5841943, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/A62rN.png?s=128&g=1", "display_name": "suhdonghwi", "link": "https://stackoverflow.com/users/5841943/suhdonghwi"}, "edited": false, "score": 0, "creation_date": 1528023864, "post_id": 50665374, "comment_id": 88341253, "body": "Idea for <code>toOrdinal</code>: if you <code>mod</code> a integer by 10, you can get the last digit of the number. You can make an another case for the last number, which maps integer(1, 2, 3, ..) to suffix(st, nd, rd, ..)."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1528025658, "last_edit_date": 1528025658, "creation_date": 1528025154, "answer_id": 50665864, "question_id": 50665374, "link": "https://stackoverflow.com/questions/50665374/how-to-render-a-date-from-integer-values-of-day-month-year/50665864#50665864", "title": "How to render a date from integer values of day, month, year?", "body": "<p>First, always watch out with indentation.</p>\n\n<pre><code>toMonth x = case x of\n             1 -&gt; \"January\"\n             2 -&gt; \"February\"\n             3 -&gt; \"March\"\n             ...\n</code></pre>\n\n<p>(You don't need that much indentation, just one space to the right of the <code>toMonth</code> would also do; but I like indenting case clauses to one more than the <code>case</code> keyword itself.)</p>\n\n<p>It's often more straightforward to not use the <code>case</code> construct but just a couple of function clauses, like</p>\n\n<pre><code>toMonth 1 = \"January\"\ntoMonth 2 = \"February\"\ntoMonth 3 = \"March\"\n...\n</code></pre>\n\n<p>This is a matter of taste.</p>\n\n<p>For the error case: you can't use <code>otherwise</code> here because you're using <em>pattern matching</em>. <code>otherwise</code> is just a shorthand for <code>True</code>, it can thus be used in <em>boolean</em> conditions, i.e. in <em>guards</em>, but here you need string patterns. The catch-all pattern is <code>_</code>, not <code>otherwise</code>. Also, don't give <em>strings containing <code>error</code></em> as the result. This is very confusing in practice. Instead, use the standard <code>error</code> function, which crashes the program with a helpful message of where things went awry. (This being an exception that can be caught and handled by the main program if necessary.)</p>\n\n<pre><code>toMonth 12 = \"December\"\ntoMonth _ = error \"Month number must be in range 1-12.\"\n</code></pre>\n\n<p>An alternative approach that's less verbose (though also rather less robust) is to just take the month names from a single string, like</p>\n\n<pre><code>toMonth n\n  | n&gt;0 &amp;&amp; n&lt;13  = names !! (n-1)\n  | otherwise    = error \"Month number must be in range 1-12.\"\n where names = words $ \"January February March April May June July\"\n                    ++ \" August September October November December\"\n</code></pre>\n\n<p>This isn't really worthwhile here, but this idiom is much more sensible when you don't just have 12 cases but hundreds. Then you should also store the names not in a list but a <a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#t:Vector\" rel=\"nofollow noreferrer\"><code>Vector</code></a> for faster lookup.</p>\n\n<p>So, once you have written and tested <code>toMonth</code>, you can use it in <code>showDate</code> like this:</p>\n\n<pre><code>showDate (d,m,y) = toDayNumber d ++ \" \" ++ toMonth m ++ \", \" ++ toYear y\n</code></pre>\n\n<p>Where you still need to implement <code>toDayNumber :: Int -&gt; String</code> and <code>toYear :: Int -&gt; String</code>. You should again think about that yourself, first.</p>\n"}], "owner": {"reputation": 95, "user_id": 9574376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1632c0741c5612ec6146d91410469b59?s=128&d=identicon&r=PG&f=1", "display_name": "goat", "link": "https://stackoverflow.com/users/9574376/goat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 50665864, "answer_count": 1, "score": 1, "last_activity_date": 1597062259, "creation_date": 1528021703, "last_edit_date": 1597062259, "question_id": 50665374, "link": "https://stackoverflow.com/questions/50665374/how-to-render-a-date-from-integer-values-of-day-month-year", "title": "How to render a date from integer values of day, month, year?", "body": "<pre><code>module Date where\n\ntype Date = (Int,Int,Int)\n\nshowDate :: Date -&gt; String\nshowDate (d,m,y) = undefined --TODO\n</code></pre>\n\n<p>Inputing <code>showDate (1,1,2001)</code> should output <code>\"1st January, 2001\"</code></p>\n\n<p>Anyone know how I could go about this? I have an idea, just not sure how to tackle it.</p>\n\n<p>Update:</p>\n\n<pre><code>toMonth :: Int -&gt; String\ntoMonth x = case x of\n1 -&gt; \"January\"\n2 -&gt; \"February\"\n3 -&gt; \"March\"\n4 -&gt; \"April\"\n5 -&gt; \"May\"\n6 -&gt; \"June\"\n7 -&gt; \"July\"\n8 -&gt; \"August\"\n9 -&gt; \"September\"\n10 -&gt; \"October\"\n11 -&gt; \"November\"\n12 -&gt; \"December\"\notherwise -&gt; \"error\"\n</code></pre>\n"}, {"tags": ["haskell", "polymorphism", "constants"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1528017134, "creation_date": 1528017134, "answer_id": 50664848, "question_id": 50664740, "link": "https://stackoverflow.com/questions/50664740/desugaring-rules-for-arithmetic-operations-on-num/50664848#50664848", "title": "Desugaring rules for arithmetic operations on &#39;Num&#39;", "body": "<p>It is desugared to</p>\n\n<pre><code>foo = fromInteger 42 - fromInteger 15\n</code></pre>\n\n<p>You can observe that by trying</p>\n\n<pre><code>f :: Double -&gt; Int -&gt; String\nf _ _ = \"hello\"\n\nfoo = 42 `f` 15\n</code></pre>\n\n<p>where we used a custom <code>f</code> instead of <code>-</code>. Here the two literals must be converted to the numeric types before calling <code>f</code>. Converting the result of <code>f</code> would be meaningless, since it is not a numeric type. </p>\n\n<p>Using <code>-</code> does not change the general rule.</p>\n"}, {"tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": false, "score": 5, "last_activity_date": 1528017146, "creation_date": 1528017146, "answer_id": 50664849, "question_id": 50664740, "link": "https://stackoverflow.com/questions/50664740/desugaring-rules-for-arithmetic-operations-on-num/50664849#50664849", "title": "Desugaring rules for arithmetic operations on &#39;Num&#39;", "body": "<p>Haskell has polymorphic literals. (just numbers by default, but GHC has language extensions for polymorphic string literals and polymorphic list literals)</p>\n\n<p>The coercing expressions (like <code>fromInteger</code>) only operate on the literal itself, and not the expression, so</p>\n\n<pre><code>foo = 42 - 15\n</code></pre>\n\n<p>and</p>\n\n<pre><code>foo = fromInteger 42 - fromInteger 15\n</code></pre>\n\n<p>are equivalent.</p>\n\n<p>We can show this is the case by defining a <code>Num</code> instance where the behaviour differs (for example, where <code>+</code> and <code>-</code> are swapped)</p>\n\n<pre><code>newtype Inverted a = Inverted {unInvert :: a}\n  deriving (Eq, Ord, Show)\n\ninstance (Num a) =&gt; Num (Inverted a) where\n  (Inverted x) + (Inverted y) = Inverted (x-y)\n  (Inverted x) - (Inverted y) = Inverted (x+y)\n  signum = Inverted . signum . unInvert\n  (Inverted x) * (Inverted y) = Inverted (x*y)\n  abs = Inverted . abs . unInvert\n  fromInteger = Inverted . fromInteger\n\nbase :: Inverted Double\nbase = 42 - 15\n\nfromBeforeOp :: Inverted Double\nfromBeforeOp = fromInteger 42 - fromInteger 15\n\nfromAfterOp :: Inverted Double\nfromAfterOp = fromInteger (42 - 15)\n</code></pre>\n\n<p>Both <code>base</code> and <code>fromBeforeOp</code> give the same (correct with respect to the definition of <code>Inverted</code>) answer of <code>57</code>, whilst <code>fromAfterOp</code> gives <code>27</code>.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1528017146, "creation_date": 1528015993, "question_id": 50664740, "link": "https://stackoverflow.com/questions/50664740/desugaring-rules-for-arithmetic-operations-on-num", "title": "Desugaring rules for arithmetic operations on &#39;Num&#39;", "body": "<p>Constants are polymorphic in Haskell. So when I write:</p>\n\n<pre><code>foo = 5\n</code></pre>\n\n<p>This desugars into:</p>\n\n<pre><code>foo = fromInteger 5\n</code></pre>\n\n<p>But what if add arithmetic expressions?</p>\n\n<pre><code>foo = 42 - 15\n</code></pre>\n\n<p>In what exactly this will be desugared?</p>\n\n<pre><code>foo = fromInteger (42 - 15)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>for = fromInteger 42 - fromInteger 15\n</code></pre>\n\n<p>Also, what is the easiest and reliable way to observe this?</p>\n"}, {"tags": ["haskell", "ffi", "state-monad", "st-monad"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1528017002, "post_id": 50663615, "comment_id": 88339691, "body": "Maybe it would be easier to use <code>withMyCLibInstance :: (forall s. Q s a) -&gt; a</code>, and modify <code>Q</code> accordingly? It seems you are trying to hide the <code>s</code> parameter, which is necessary for <code>ST</code> to work."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1528023460, "post_id": 50663615, "comment_id": 88341134, "body": "I&#39;m not quite able to put together a solution based on your suggestion. In the end, there must be some monad <code>M</code> such that <code>withMyCLibInstance :: M a -&gt; a</code>, so do we not end up with <code>newtype M a = forall s. ST s a</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528031864, "post_id": 50663615, "comment_id": 88343561, "body": "Why do you need a separate monad? Can you just write <code>withMyCLibInstance :: (forall s. STMyClib s -&gt; ST s a) -&gt; a</code> instead and not expose <code>myCLibInit</code>?"}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1528033714, "post_id": 50663615, "comment_id": 88344044, "body": "If I understand correctly, that would lead to something like <code>withMyCLibInstance $ \\obj -&gt; do ...</code>. Ok, that&#39;s a step forward. I still would have to use the <code>obj</code> inside the <code>do</code> all the time, though."}], "answers": [{"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1528046747, "post_id": 50667382, "comment_id": 88347926, "body": "<code>ReaderT</code>... that&#39;s a very good point. Why not use the simpler <code>type MyCLibST a = forall s. ReaderT (STMyCLib s) (ST s) a</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 1, "creation_date": 1528051310, "post_id": 50667382, "comment_id": 88349338, "body": "Type synonyms with quantifiers have various problems: they make type inference difficult, Haskell&#39;s type system is not impredicative (<code>[MyCLibST a]</code> is not a valid type) and <code>MyCLibST</code> is no <code>Monad</code> (because type synonyms must always be fully applied). As for the question of <code>type</code>  vs <code>newtype</code>, it&#39;s mostly a matter of taste, but while <code>type</code> makes code reuse easier, <code>newtype</code> enables better defined abstraction boundaries. I think <code>newtype</code> is the safer default."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1528035745, "creation_date": 1528035745, "answer_id": 50667382, "question_id": 50663615, "link": "https://stackoverflow.com/questions/50663615/re-dress-a-st-monad-as-something-similar-to-the-state-monad/50667382#50667382", "title": "Re-dress a ST monad as something similar to the State monad", "body": "<p>You can use a reader effect to access a singleton, instantiating it only in the <code>run</code> function:</p>\n\n<pre><code>newtype MyCLibST s a = MyCLibST { unMyCLibST :: ReaderT (STMyCLib s) (ST s) a }\n\nrunMyCLibST :: (forall s. MyCLibST s a) -&gt; a\nrunMyCLibST m = runST (myCLibInit &gt;&gt;= runReaderT (unMyCLibST m))\n\n-- Wrap the API with this.\nunsafeMkMyCLibST :: (MyCLibObj -&gt; IO a) -&gt; MyCLibST s a\n</code></pre>\n\n<p><code>s</code> should appear as a parameter to <code>MyCLibST</code> if you want to keep access to other <code>ST</code> features like mutable references and arrays.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 50667382, "answer_count": 1, "score": 4, "last_activity_date": 1528035745, "creation_date": 1528004616, "last_edit_date": 1528023981, "question_id": 50663615, "link": "https://stackoverflow.com/questions/50663615/re-dress-a-st-monad-as-something-similar-to-the-state-monad", "title": "Re-dress a ST monad as something similar to the State monad", "body": "<p>Here's the scenario: Given is a C library, with some struct at its core and operations thereon provided by an abundance of C functions. </p>\n\n<p><strong>Step 1:</strong> Using Haskell's <a href=\"https://wiki.haskell.org/Foreign_Function_Interface\" rel=\"nofollow noreferrer\">FFI</a> a wrapper is created. It has functions like <code>myCLibInit :: IO MyCLibObj</code>, <code>myCLibOp1 :: MyCLibObj -&gt; ... -&gt; IO ()</code>, and so on. <code>MyCLibObj</code> is an opaque type that carries (and hides) a <code>Ptr</code> or <code>ForeignPtr</code> to the actual C struct, for example as shown in this <a href=\"https://wiki.haskell.org/FFI_cook_book#Passing_opaque_structures.2Ftypes\" rel=\"nofollow noreferrer\">wiki</a> or in <a href=\"http://book.realworldhaskell.org/read/interfacing-with-c-the-ffi.html\" rel=\"nofollow noreferrer\">RWH ch. 17</a>.</p>\n\n<p><strong>Step 2:</strong> Using <code>unsafeIOToST</code> from <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Monad-ST-Unsafe.html\" rel=\"nofollow noreferrer\"><code>Control.Monad.ST.Unsafe</code></a> convert all the <code>IO</code> actions into <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Monad-ST-Safe.html#t:ST\" rel=\"nofollow noreferrer\"><code>ST</code></a> actions. This is done by introducing something like</p>\n\n<pre><code> data STMyCLib s = STMyCLib MyCLibObj\n</code></pre>\n\n<p>and then wrapping all <code>IO</code> functions in <code>ST</code> functions, for example:</p>\n\n<pre><code>myCLibInit' :: ST s (STMyCLib s)\nmyCLibInit' = unsafeIOToST $ STMyCLib &lt;$&gt; myCLibInit\n</code></pre>\n\n<p>This allows to write imperative-style programs that mirror the use of the OO-like C library, e.g.:</p>\n\n<pre><code>doSomething :: ST s Bool\ndoSomething = do\n    obj1 &lt;- myCLibInit'\n    success1 &lt;- myCLibOp1' obj1 \"some-other-input\"\n    ...\n    obj2 &lt;- myCLibInit'\n    result &lt;- myCLibOp2' obj2 42\n    ...\n    return True   -- or False\n\nmain :: IO ()\nmain = do\n    ...\n    let success = runST doSomething\n    ...\n</code></pre>\n\n<p><strong>Step 3:</strong> Often it doesn't make sense to mingle operations on several <code>MyCLibObj</code> in one do-block. For example when the C struct is (or should be thought of as) a singleton instance. Doing something like in <code>doSomething</code> above is either nonsensical, or just plain forbidden (for example, when the C struct is a <code>static</code>). In this case language resembling the one of the <a href=\"https://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-State-Lazy.html\" rel=\"nofollow noreferrer\"><code>State</code></a> monad is necessary:</p>\n\n<pre><code>doSomething :: ResultType\ndoSomething =  withMyCLibInstance $ do\n    success &lt;- myCLibOp1'' \"some-other-input\"\n    result &lt;- myCLibOp2'' 42\n    ...\n    return result\n</code></pre>\n\n<p>where</p>\n\n<pre><code>withMyCLibInstance :: Q a -&gt; a\n</code></pre>\n\n<p>And this leads to the <strong>question</strong>: How can the <code>ST s a</code> monad be re-dressed as something that resembles more the <code>State</code> monad. Since <code>withMyCLibInstance</code> would use the <code>runST</code> function the new monad, let's call it <code>Q</code> (for 'q'uestion), should be </p>\n\n<pre><code>newtype Q a = Q (forall s. ST s a)\n</code></pre>\n\n<p>This looks thoroughly weird to me. I'm already struggling with implementing the <code>Functor</code> instance for this <code>Q</code>, let alone <code>Applicative</code> and <code>Monad</code>. <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.ST.html#line-72\" rel=\"nofollow noreferrer\"><code>ST s</code></a> actually is a monad, already, but state <code>s</code> mustn't escape the <code>ST</code> monad, hence the <code>forall s. ST s a</code>. It's the only way to get rid of the <code>s</code> because <code>runST :: (forall s. ST s a) -&gt; a</code>, and <code>withMyCLibInstance</code> is just a <code>myCLibInit'</code> followed by a <code>runST</code>. But somehow this doesn't fit.</p>\n\n<p>What is the right way to tackle step 3? Should I even do step 2, or roll my <code>Q</code> right after step 1? My sense is that this should be quite simple. The <code>ST</code> monad has all I need, the <code>Q</code> just needs to be set up the right way...</p>\n\n<p><strong>Update 1:</strong> The singleton and static struct examples in step 3 are not very good. If two such do blocks were executed in parallel, very bad things might happen, i.e. both do blocks would work on the same C struct in parallel.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "do-notation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1527985546, "post_id": 50662133, "comment_id": 88334700, "body": "<code>readLn</code> is superior to <code>getLine</code>+<code>read</code>, because it throws an <code>IO</code> error immediately if you get text that isn&#39;t <code>read</code>able rather than waiting until some indeterminate later date when the value is used to throw an exception."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1527984227, "creation_date": 1527984227, "answer_id": 50662191, "question_id": 50662133, "link": "https://stackoverflow.com/questions/50662133/can-we-access-the-output-from-a-replicatem-defined-in-a-do-block/50662191#50662191", "title": "Can we access the output from a replicateM defined in a do-block", "body": "<p><code>replicateM n a</code> returns a list of the values returned by <code>a</code>. In your case that'd just be a list of units because you have the <code>return ()</code> at the end, but if you replace that with <code>return x</code>, you'll get a list of the read integers. You can then just use <code>&lt;-</code> to get it out of the <code>IO</code>.</p>\n\n<p>You can also simplify your code by using <code>readLine</code> instead of <code>getLine</code> and <code>read</code>. Similarly <code>putStrLn . show</code> can be replaced with <code>print</code>.</p>\n\n<pre><code>main = do\n    n &lt;- readLn\n    ints &lt;- replicateM n readLn :: IO [Int]\n    print ints\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1527984238, "creation_date": 1527984238, "answer_id": 50662192, "question_id": 50662133, "link": "https://stackoverflow.com/questions/50662133/can-we-access-the-output-from-a-replicatem-defined-in-a-do-block/50662192#50662192", "title": "Can we access the output from a replicateM defined in a do-block", "body": "<p>Specialized to <code>IO</code></p>\n\n<pre><code>replicateM :: Int -&gt; IO a -&gt; IO [a]\n</code></pre>\n\n<p>which means that it returns a list.    So in your example you could do:</p>\n\n<pre><code>results &lt;- replicateM n $ do\n    input_line &lt;- getLine\n    let x = read input_line :: Int\n    return x   -- &lt;- we have to return it if we want to access it\n\nprint results\n</code></pre>\n"}], "owner": {"reputation": 619, "user_id": 8514005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318a3ae487b2140f9d08079450b6903d?s=128&d=identicon&r=PG&f=1", "display_name": "JohEker", "link": "https://stackoverflow.com/users/8514005/joheker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 50662192, "answer_count": 2, "score": 0, "last_activity_date": 1527984610, "creation_date": 1527983357, "last_edit_date": 1527984610, "question_id": 50662133, "link": "https://stackoverflow.com/questions/50662133/can-we-access-the-output-from-a-replicatem-defined-in-a-do-block", "title": "Can we access the output from a replicateM defined in a do-block", "body": "<p>Assume i have something like this</p>\n\n<pre><code>main = do\n    input_line &lt;- getLine\n    let n = read input_line :: Int\n\n    replicateM n $ do\n        input_line &lt;- getLine\n        let x = read input_line :: Int \n\n        return ()\n\n ***putStrLn $ show -- Can i access my replicateM here?\n    return ()\n</code></pre>\n\n<p>Can i access the result of my replicateM such as if it was a returned value, and for example print it out. Or do i have to work with the replicateM inside the actual do-block?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1527961337, "post_id": 50659327, "comment_id": 88329081, "body": "I think you need to add <code>ghc-options: -main-is XXX</code> where <code>XXX</code> is the name of the module, e.g. <code>Test</code>."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1527962060, "post_id": 50659327, "comment_id": 88329262, "body": "That was the solution! Thank you! Feel free to post it as an answer instead."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1572123666, "post_id": 50659327, "comment_id": 103465471, "body": "The question is related to: <a href=\"https://stackoverflow.com/questions/46895199/no-output-will-be-generated-because-there-is-no-main-module\" title=\"no output will be generated because there is no main module\">stackoverflow.com/questions/46895199/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 130, "user_id": 2398486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CFj8p.png?s=128&g=1", "display_name": "willbush", "link": "https://stackoverflow.com/users/2398486/willbush"}, "edited": false, "score": 0, "creation_date": 1552452804, "post_id": 50659706, "comment_id": 97010024, "body": "Wow I looked at this about 4 times before realizing the <code>main-is</code> you gave is different from <code>main-is: Test.hs</code>. Thanks!"}, {"owner": {"reputation": 214, "user_id": 5122945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e4f5ee524d6551bbb1af83acf49de0?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Willerts", "link": "https://stackoverflow.com/users/5122945/leif-willerts"}, "edited": false, "score": 0, "creation_date": 1615105924, "post_id": 50659706, "comment_id": 117584619, "body": "Changing the <code>.cabal</code> file generated by <code>hpack</code> is bad practice. Change the <code>package.yaml</code> instead."}, {"owner": {"reputation": 214, "user_id": 5122945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e4f5ee524d6551bbb1af83acf49de0?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Willerts", "link": "https://stackoverflow.com/users/5122945/leif-willerts"}, "reply_to_user": {"reputation": 130, "user_id": 2398486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CFj8p.png?s=128&g=1", "display_name": "willbush", "link": "https://stackoverflow.com/users/2398486/willbush"}, "edited": false, "score": 0, "creation_date": 1615109883, "post_id": 50659706, "comment_id": 117585370, "body": "@willbush But I&#39;m actually surprised that you have to directly &quot;inject&quot; the information into <code>ghc</code> instead of telling cabal to pass it on."}], "tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": true, "score": 4, "last_activity_date": 1527964444, "last_edit_date": 1527964444, "creation_date": 1527962462, "answer_id": 50659706, "question_id": 50659327, "link": "https://stackoverflow.com/questions/50659327/stack-build-results-in-output-was-redirected-with-o-but-no-output-will-be-gen/50659706#50659706", "title": "stack build results in &quot;output was redirected with -o, but no output will be generated because there is no Main module.&quot;", "body": "<p>You need to set</p>\n\n<pre><code>executable test\n  ghc-options:  -main-is Test\n</code></pre>\n\n<p>in your cabal file. </p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 2, "accepted_answer_id": 50659706, "answer_count": 1, "score": 4, "last_activity_date": 1528011010, "creation_date": 1527959710, "last_edit_date": 1528011010, "question_id": 50659327, "link": "https://stackoverflow.com/questions/50659327/stack-build-results-in-output-was-redirected-with-o-but-no-output-will-be-gen", "title": "stack build results in &quot;output was redirected with -o, but no output will be generated because there is no Main module.&quot;", "body": "<p>Didn't see any relevant result when google searching for this error so thought I'd post it.</p>\n\n<pre><code>stack build\nBuilding all executables for `gitchapter' once. After a successful build of all of them, only specified executables will be rebuilt.\ngitchapter-0.1.0.0: build (exe)\nPreprocessing executable 'app' for gitchapter-0.1.0.0..\nBuilding executable 'app' for gitchapter-0.1.0.0..\nPreprocessing executable 'test' for gitchapter-0.1.0.0..\nWarning: Enabling workaround for Main module 'Main' listed in 'other-modules'\nBuilding executable 'test' for gitchapter-0.1.0.0..\nillegaly!\n\n&lt;no location info&gt;: error:\n    output was redirected with -o, but no output will be generated\nbecause there is no Main module.\n\n\n--  While building custom Setup.hs for package gitchapter-0.1.0.0 using:\n      /home/chris/.stack/setup-exe-cache/x86_64-linux-nopie/Cabal-simple_mPHDZzAJ_2.0.1.0_ghc-8.2.2 --builddir=.stack-work/dist/x86_64-linux-nopie/Cabal-2.0.1.0 build exe:app exe:test --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>It definitely is related to the 'test' executable definition - as if I remove this, it completes the <code>stack build</code> successfully - but without the required test executable.</p>\n\n<p><strong>gitchapter.cabal</strong></p>\n\n<pre><code>-- This file has been generated from package.yaml by hpack version 0.28.2.\n--\n-- see: https://github.com/sol/hpack\n--\n-- hash: a3e4a735ee8304dd50f5af53a64d7b639894cbcc24ba01d0171a588e67455018\n\nname:           gitchapter\nversion:        0.1.0.0\nauthor:         Chris Stryczynski\nmaintainer:     Chris Stryczynski\nlicense:        BSD3\nlicense-file:   LICENSE\nbuild-type:     Simple\ncabal-version:  &gt;= 1.10\n\nexecutable app\n  main-is: Main.hs\n  other-modules:\n      BlogLiterately\n      Example\n      FileSection\n      GHCi\n      GHCiSession\n      Git\n      GitTextPartial\n      Hart\n      Operations\n      Operations.Parsers\n      QuasiText\n      Render\n      Section\n      Test\n      Paths_gitchapter\n  hs-source-dirs:\n      src\n  build-depends:\n      HUnit\n    , QuickCheck\n    , base &gt;=4.9 &amp;&amp; &lt;4.11\n    , directory\n    , extra\n    , filepath\n    , foldl\n    , mtl\n    , optparse-applicative\n    , pandoc-include-code\n    , parsec\n    , pretty-simple\n    , process\n    , regex-pcre\n    , regex-posix\n    , safe\n    , string-conversions\n    , system-filepath\n    , template-haskell\n    , text\n    , transformers\n    , turtle\n    , unix\n    , unordered-containers\n  default-language: Haskell2010\n\nexecutable test\n  main-is: Test.hs\n  other-modules:\n      BlogLiterately\n      Example\n      FileSection\n      GHCi\n      GHCiSession\n      Git\n      GitTextPartial\n      Hart\n      Main\n      Operations\n      Operations.Parsers\n      QuasiText\n      Render\n      Section\n      Paths_gitchapter\n  hs-source-dirs:\n      src\n  build-depends:\n      HUnit\n    , QuickCheck\n    , base &gt;=4.9 &amp;&amp; &lt;4.11\n    , directory\n    , extra\n    , filepath\n    , foldl\n    , mtl\n    , optparse-applicative\n    , pandoc-include-code\n    , parsec\n    , pretty-simple\n    , process\n    , regex-pcre\n    , regex-posix\n    , safe\n    , string-conversions\n    , system-filepath\n    , template-haskell\n    , text\n    , transformers\n    , turtle\n    , unix\n    , unordered-containers\n  default-language: Haskell2010\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 2, "creation_date": 1527956640, "post_id": 50658624, "comment_id": 88327736, "body": "To have a better experience for handling dependencies, try stack instead of cabal if you can <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1527964460, "post_id": 50658624, "comment_id": 88329976, "body": "Stack helps some people with some things but it isn&#39;t a silver bullet to all things.  In this particular case it seems understanding the general ecosystem is helpful.  N.B. <code>stack install semigroup</code> ~&gt; <code>Unknown package: semigroup</code>."}], "answers": [{"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1527960089, "post_id": 50659372, "comment_id": 88328709, "body": "<code>semigroups</code> is the previous canonical source for that class. <code>Semigroup</code> has not been updated since 2011."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 0, "last_activity_date": 1527964372, "last_edit_date": 1527964372, "creation_date": 1527959994, "answer_id": 50659372, "question_id": 50658624, "link": "https://stackoverflow.com/questions/50658624/cabal-cannot-install-dates-and-semigroup/50659372#50659372", "title": "Cabal cannot install dates and semigroup", "body": "<p>The Semigroup class is now part of base in GHC 8.4.x:</p>\n\n<pre><code>class Semigroup a where\n  (&lt;&gt;) :: a -&gt; a -&gt; a\n  GHC.Base.sconcat :: GHC.Base.NonEmpty a -&gt; a\n  GHC.Base.stimes :: Integral b =&gt; b -&gt; a -&gt; a\n  {-# MINIMAL (&lt;&gt;) #-}\n        -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>But in older versions of GHC it was not part of base and originally lived in the <code>semigroups</code> package.  Older still than <code>semigroups</code> is <code>semigroup</code> which you are trying to install and similarly conflicts with what is now part of <code>base</code> (thanks @Li-yao for the comment).  So semigroup, the package, should not be used with the newer ghc/base.</p>\n\n<p>Your second problem is that version of <code>dates</code> is not updated for the new base, which requires all Monoid instances to also be an instance of Semigroup:</p>\n\n<pre><code>class Semigroup a =&gt; Monoid a where\n  mempty :: a\n  mappend :: a -&gt; a -&gt; a\n  mconcat :: [a] -&gt; a\n  {-# MINIMAL mempty #-}\n        -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>You could file an issue with the <code>dates</code> package.</p>\n"}], "owner": {"reputation": 858, "user_id": 4267929, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/98885eca3b83031612bef15ed5b21abc?s=128&d=identicon&r=PG&f=1", "display_name": "Henricus V.", "link": "https://stackoverflow.com/users/4267929/henricus-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 50659372, "answer_count": 1, "score": 0, "last_activity_date": 1527964372, "creation_date": 1527954756, "question_id": 50658624, "link": "https://stackoverflow.com/questions/50658624/cabal-cannot-install-dates-and-semigroup", "title": "Cabal cannot install dates and semigroup", "body": "<p>If I execute <code>$ cabal install semigroup</code>, I get the error</p>\n\n<pre><code>Data/Semigroup.hs:29:22: error:\nAmbiguous occurrence \u2018Semigroup\u2019\nIt could refer to either \u2018Prelude.Semigroup\u2019,\n                         imported from \u2018Prelude\u2019 at Data/Semigroup.hs:2:8-21\n                         (and originally defined in \u2018GHC.Base\u2019)\n                      or \u2018Data.Semigroup.Semigroup\u2019,\n                         defined at Data/Semigroup.hs:22:1\n   |\n29 | instance Monoid a =&gt; Semigroup (Identity a) where\n   |                      ^^^^^^^^^\n</code></pre>\n\n<p>(repeating itself at several other occurences)</p>\n\n<p>Similarly if I <code>$ cabal install dates</code>,</p>\n\n<pre><code>Data/Dates/Types.hs:62:10: error:\n\u2022 No instance for (Semigroup DateTime)\n    arising from the superclasses of an instance declaration\n\u2022 In the instance declaration for \u2018Monoid DateTime\u2019\n   |\n62 | instance Monoid DateTime where\n   |          ^^^^^^^^^^^^^^^\ncabal: Leaving directory '/tmp/cabal-tmp-16926/dates-0.2.2.1'\ncabal: Error: some packages failed to install:\ndates-0.2.2.1-ILbYRzHuQkwCfqySpiVks0 failed during the building phase. The\nexception was:\nExitFailure 1\n</code></pre>\n\n<p>Is this a bug? and how to work around it?</p>\n"}, {"tags": ["haskell", "complex-numbers"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1527955447, "post_id": 50658447, "comment_id": 88327430, "body": "... an example of why <code>Num</code> is a bit of a mixed-up class :)"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1527959744, "post_id": 50658447, "comment_id": 88328599, "body": "The reason for RealFloat rather than Floating is actually more subtle. :)  It\u2019s (/) that is the culprit."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1527978125, "post_id": 50658447, "comment_id": 88333347, "body": "@augustss you should make that an answer."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 6, "last_activity_date": 1527953580, "creation_date": 1527953580, "answer_id": 50658447, "question_id": 50658317, "link": "https://stackoverflow.com/questions/50658317/why-does-the-multiplication-implementation-for-complex-require-a-realfloat/50658447#50658447", "title": "Why does the multiplication implementation for Complex require a RealFloat?", "body": "<p>The problem is that <code>Complex a</code> only instantiates <code>Num</code> if <code>a</code> instantiates <code>RealFloat</code>. That is the <code>Num</code> instance is defined as:</p>\n\n<pre><code>instance RealFloat a =&gt; Num (Complex a) where\n    ...\n</code></pre>\n\n<p>Since <code>*</code> is defined by <code>Num</code>, you can only use <code>*</code> on a <code>Complex a</code> if it's an instance of <code>Num</code>, i.e. if <code>a</code> is an instance of <code>RealFloat</code>.</p>\n\n<p>So why does the <code>Num</code> instance have that restriction?</p>\n\n<p>It's because of this method:</p>\n\n<pre><code>abs :: a -&gt; a\n</code></pre>\n\n<p>The absolute value of a complex number can be non-integral even if both its components are integers. For example the absolute value of 1+1i is \u221a2. So a method <code>abs :: Complex Integer -&gt; Complex Integer</code> can't be defined (at least not in a way that produces correct results), therefore no complete instance of <code>Num (Complex Integer)</code> can be defined. So there's only one for <code>RealFloat</code>s.</p>\n\n<p>The same is true for the <code>signum</code> method.</p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 50658447, "answer_count": 1, "score": 3, "last_activity_date": 1527953580, "creation_date": 1527952543, "question_id": 50658317, "link": "https://stackoverflow.com/questions/50658317/why-does-the-multiplication-implementation-for-complex-require-a-realfloat", "title": "Why does the multiplication implementation for Complex require a RealFloat?", "body": "<p>In GHCi, one finds the following:</p>\n\n<pre><code> import Data.Complex\n :t 2 * (3 :+ 4)\n2 * (3 :+ 4) :: RealFloat a =&gt; Complex a\n :t (* (3 :+ 4))\n(* (3 :+ 4)) :: RealFloat a -&gt; Complex a -&gt; Complex a\n</code></pre>\n\n<p>However:</p>\n\n<pre><code> :t fmap (* 2) (3 :+ 4)\nfmap (* 2) (3 :+ 4) :: Num a =&gt; Complex a -&gt; Complex a\n</code></pre>\n\n<p>Now, why is this so? Is it just that <code>fromInteger</code> under <code>Num a =&gt; Complex a</code> has type <code>RealFloat a =&gt; a -&gt; Complex a</code>? If so, why?</p>\n"}, {"tags": ["csv", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 858, "user_id": 4267929, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/98885eca3b83031612bef15ed5b21abc?s=128&d=identicon&r=PG&f=1", "display_name": "Henricus V.", "link": "https://stackoverflow.com/users/4267929/henricus-v"}, "is_accepted": false, "score": 1, "last_activity_date": 1527949732, "creation_date": 1527949732, "answer_id": 50657915, "question_id": 50657827, "link": "https://stackoverflow.com/questions/50657827/parsing-nested-data-from-csv/50657915#50657915", "title": "Parsing nested data from CSV", "body": "<p>After some experimenting, the following seems to be the correct way to chain two parsers. Recall:</p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n</code></pre>\n\n<p>we can have that</p>\n\n<pre><code>instance FromNamedRecord DataIn where\n    parseNamedRecord m =\n        DataIn &lt;$&gt; m .: \"item\"\n               &lt;*&gt; m .: \"user\"\ninstance FromNamedRecord DataTrain where\n    parseNamedRecord m =\n        (parseNamedRecord m :: Csv.Parser DataIn)\n            &gt;&gt;= (\\x -&gt; DataTrain &lt;$&gt; m .: \"dval\")\n</code></pre>\n\n<p>The part where <code>&lt;$&gt;</code> begins the construction of a parser is still a mystery</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1528013670, "post_id": 50663452, "comment_id": 88338991, "body": "shouldn&#39;t it be <code>makeSomeParser =&lt;&lt; makeAnotherParser =&lt;&lt; yetAnotherParser</code>?"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 1, "last_activity_date": 1528003352, "last_edit_date": 1528003352, "creation_date": 1528002253, "answer_id": 50663452, "question_id": 50657827, "link": "https://stackoverflow.com/questions/50657827/parsing-nested-data-from-csv/50663452#50663452", "title": "Parsing nested data from CSV", "body": "<p>You can just invoke the <code>DataIn</code> parser from the <code>DataTrain</code> parser like so, because <code>parseNamedRecord</code> returns a <code>Parser</code>:</p>\n\n<pre><code>instance FromNamedRecord DataTrain where\n  parseNamedRecord m = DataTrain\n    &lt;$&gt; parseNamedRecord m\n    &lt;*&gt; m .: \"dval\"\n</code></pre>\n\n<p>Its type, and thus the correct instance to call, is inferred from the type of the first parameter of <code>DataTrain</code>.</p>\n\n<p>You don\u2019t need monadic bind (<code>&gt;&gt;=</code>) here because the parser doesn\u2019t have any \u201cdata dependencies\u201d\u2014you aren\u2019t deciding <em>how</em> to parse the input based on the input.</p>\n\n<hr>\n\n<p>Here\u2019s a little refresher on how you can combine parsers\u2014or any monadic type in fact. When you want to apply a pure function to a pure argument, you use juxtaposition or <code>$</code>:</p>\n\n<pre><code>SomeUnaryConstructor someValue\nSomeUnaryConstructor $ someValue\n</code></pre>\n\n<p>In a similar way, to apply a pure function to the result of a parser, use <code>fmap</code>, a.k.a. <code>&lt;$&gt;</code>:</p>\n\n<pre><code>SomeUnaryConstructor &lt;$&gt; someParser\nfmap SomeUnaryConstructor someParser\n\n-- =\n\ndo\n  result &lt;- someParser\n  pure $ SomeUnaryConstructor result\n</code></pre>\n\n<p>To apply multiple arguments, chain them with <code>&lt;*&gt;</code>:</p>\n\n<pre><code>SomeBinaryConstructor &lt;$&gt; someParser &lt;*&gt; anotherParser\n\n-- =\n\ndo\n  result1 &lt;- someParser\n  result2 &lt;- anotherParser\n  pure $ SomeBinaryConstructor result1 result2\n</code></pre>\n\n<p>This is left-associative\u2014<code>SomeBinaryConstructor &lt;$&gt; someParser</code> is a parser that returns a partially applied function; then that function <code>&lt;*&gt; anotherParser</code> fills the next argument of the function with the result of <code>anotherParser</code>.</p>\n\n<p>To apply a parser to the <em>result of another parser</em>, use <code>&gt;&gt;=</code> or its flipped version <code>=&lt;&lt;</code>:</p>\n\n<pre><code>someParser =&lt;&lt; anotherParser =&lt;&lt; yetAnotherParser\n\n-- =\n\ndo\n  result1 &lt;- yetAnotherParser\n  result2 &lt;- anotherParser result1\n  someParser result2\n</code></pre>\n\n<p>The whole table looks like:</p>\n\n<pre><code> ($)  ::                    (a -&gt;   b) -&gt;   a -&gt;   b\n(&lt;$&gt;) :: Functor     f =&gt;   (a -&gt;   b) -&gt; f a -&gt; f b\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt;   b) -&gt; f a -&gt; f b\n(=&lt;&lt;) :: Monad       f =&gt;   (a -&gt; f b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>In other words:</p>\n\n<ul>\n<li><code>function $ value</code></li>\n<li><code>function &lt;$&gt; parser that returns value</code></li>\n<li><code>parser that returns function &lt;*&gt; parser that returns value</code></li>\n<li><code>function that returns parser =&lt;&lt; parser that returns value</code></li>\n</ul>\n"}], "owner": {"reputation": 858, "user_id": 4267929, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/98885eca3b83031612bef15ed5b21abc?s=128&d=identicon&r=PG&f=1", "display_name": "Henricus V.", "link": "https://stackoverflow.com/users/4267929/henricus-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 50663452, "answer_count": 2, "score": 2, "last_activity_date": 1528003352, "creation_date": 1527949099, "question_id": 50657827, "link": "https://stackoverflow.com/questions/50657827/parsing-nested-data-from-csv", "title": "Parsing nested data from CSV", "body": "<p>Consider the following:</p>\n\n<pre><code>data DataTrain = DataTrain\n    {\n        item :: Text,\n        user :: Text,\n        dval :: Double\n    }\ninstance FromNamedRecord DataTrain where\n    parseNamedRecord m =\n        DataTrain\n            &lt;$&gt; m .: \"item\"\n            &lt;*&gt; m .: \"user\"\n            &lt;*&gt; m .: \"dval\"\n</code></pre>\n\n<p>This implements the CSV reading interface in cassava and allows reading <code>DataTrain</code> from a CSV file. Now, I would like to parse the following:</p>\n\n<pre><code>data DataIn = DataIn\n    {\n        item :: Text,\n        user :: Text\n    }\ndata DataTrain = DataTrain\n    {\n        dataIn :: DataIn,\n        dval :: Double\n    }\n</code></pre>\n\n<p>Is there a way to achieve the same effect as above using a concise syntax? The following:</p>\n\n<pre><code>instance FromNamedRecord DataIn where\n    parseNamedRecord m =\n        DataIn &lt;$&gt; m .: \"item\"\n               &lt;*&gt; m .: \"user\"\ninstance FromNamedRecord DataTrain where\n    parseNamedRecord m =\n        DataTrain\n            &lt;$&gt; m .: \"???\" -- What to put here?\n            &lt;*&gt; m .: \"dval\"\n</code></pre>\n\n<p>does not seem to work. I'm still a newbie to Haskell so I'm not sure what would help here.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1527947978, "creation_date": 1527947978, "answer_id": 50657676, "question_id": 50657618, "link": "https://stackoverflow.com/questions/50657618/haskell-couldnt-match-type-char-with-char-expected-type-string-actua/50657676#50657676", "title": "Haskell : Couldn&#39;t match type \u2018Char\u2019 with \u2018[Char]\u2019 Expected type: [String] Actual type: String", "body": "<pre><code>censWords :: [String] -&gt; [String]\n                      -- ^^^^^^^^ expected\ncensWords (x:xs) = if .. then replace(tail x) else ..\n                           -- ^^^^^^^^^^^^^^^ actual value\n</code></pre>\n\n<p>The returned value is a single string, but a list of strings was expected.</p>\n\n<p>The issue is not the call to <code>replace</code>, but the fact that it returns a value of the wrong type than the expected one.</p>\n"}], "owner": {"reputation": 3, "user_id": 9885310, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "ALEXANDRU-PETRU STEFANOIU", "link": "https://stackoverflow.com/users/9885310/alexandru-petru-stefanoiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 50657676, "answer_count": 1, "score": 0, "last_activity_date": 1527947978, "creation_date": 1527947597, "question_id": 50657618, "link": "https://stackoverflow.com/questions/50657618/haskell-couldnt-match-type-char-with-char-expected-type-string-actua", "title": "Haskell : Couldn&#39;t match type \u2018Char\u2019 with \u2018[Char]\u2019 Expected type: [String] Actual type: String", "body": "<p>I have this code:</p>\n\n<pre><code>censName :: String -&gt; String\ncensName [] = []\ncensName xs = unwords(censWords(words xs))\n\ncensWords :: [String] -&gt; [String]\ncensWords [] = []\ncensWords (x:xs) = if isUpper(head x) then replace(tail x) else censWords xs \n\nreplace :: String -&gt; String\nreplace [] = []\nreplace (x:xs) = '*':replace xs\n</code></pre>\n\n<p>and the error says:</p>\n\n<pre><code>Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\n  Expected type: [String]\n    Actual type: String\n</code></pre>\n\n<p>and my questions is: why!? i mean, in replace(tail x) x is a String, so why it expects [String]?</p>\n\n<p>i couldn't find nothing to fit to my problem on similar problems posted here.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1527946532, "post_id": 50657412, "comment_id": 88324894, "body": "What type do you expect that <code>&quot;Hello&quot;</code> has? What sort of data type is <code>Word</code>, according to the Haskell documentation?"}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 1, "creation_date": 1527946627, "post_id": 50657412, "comment_id": 88324920, "body": "Is <code>Word</code> just <code>String</code> or <code>[Char]</code> in this case?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1527948176, "post_id": 50657412, "comment_id": 88325355, "body": "<code>Word</code> is a numeric type, unless you have redefined it somehow. You want a list of strings, i.e. <code>getWords :: Int -&gt; [String] -&gt; [String]</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1527951286, "post_id": 50657412, "comment_id": 88326245, "body": "@RoadRunner It doesn&#39;t matter; <code>type String = [Char]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 9573782, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_PLDg0WL0G4/AAAAAAAAAAI/AAAAAAAABVM/rkO3KRgRlEs/photo.jpg?sz=128", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/9573782/mikhail"}, "edited": false, "score": 0, "creation_date": 1527959490, "post_id": 50658653, "comment_id": 88328524, "body": "I got it from the book <a href=\"https://books.google.com.au/books?id=B4RxBAAAQBAJ&amp;pg=PA18&amp;lpg=PA18&amp;dq=getWords+::+Int+-%3E+%5BWord%5D+-%3E+%5BWord%5D+haskell&amp;source=bl&amp;ots=y3NsDj8AMo&amp;sig=Vo_Fw-ukd09cqRTvlMhwh-2_cVc&amp;hl=ru&amp;sa=X&amp;ved=0ahUKEwjjyfinibXbAhWJ2LwKHbOlBVgQ6AEITzAF#v=onepage&amp;q=getWords&amp;f=false\" rel=\"nofollow noreferrer\">books.google.com.au/&hellip;</a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 53, "user_id": 9573782, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_PLDg0WL0G4/AAAAAAAAAAI/AAAAAAAABVM/rkO3KRgRlEs/photo.jpg?sz=128", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/9573782/mikhail"}, "edited": false, "score": 0, "creation_date": 1527960083, "post_id": 50658653, "comment_id": 88328707, "body": "So far as I see that book doesn&#39;t even define <code>Word</code>, so I&#39;m not sure what the author was wanting there."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1527996628, "post_id": 50658653, "comment_id": 88336181, "body": "Ah, well the error shows the asker didn&#39;t use that type alias.  If they had included that alias and used a modern GHC then we&#39;d have seen <code>Ambiguous occurrence \u2018Word\u2019</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1527954996, "creation_date": 1527954996, "answer_id": 50658653, "question_id": 50657412, "link": "https://stackoverflow.com/questions/50657412/function-that-returns-a-list-of-words-of-length-n/50658653#50658653", "title": "Function that returns a list of words of length n", "body": "<p>What you are doing wrong is using <code>Word</code> presumably from <code>Data.Word</code>.  This is a machine word, as in an unsigned integral value.  It is not a human word, as in letters from a string.  As stated in the comments by @chi, you should use a <code>[String]</code>:</p>\n\n<pre><code>getWords :: Int -&gt; [String] -&gt; [String]\ngetWords n w = filter (\\x -&gt; length x == n) w\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 9573782, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_PLDg0WL0G4/AAAAAAAAAAI/AAAAAAAABVM/rkO3KRgRlEs/photo.jpg?sz=128", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/9573782/mikhail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 50658653, "answer_count": 1, "score": 2, "last_activity_date": 1527954996, "creation_date": 1527946180, "question_id": 50657412, "link": "https://stackoverflow.com/questions/50657412/function-that-returns-a-list-of-words-of-length-n", "title": "Function that returns a list of words of length n", "body": "<p>Hey I am new to Haskell and trying to figure out how I would return a list with words of length n</p>\n\n<pre><code>getWords :: Int -&gt; [Word] -&gt; [Word]\ngetWords n w = filter (\\x -&gt; length x == n) w\n</code></pre>\n\n<p>I figured out I can use this in Prelude\nfilter (\\x -> length x == 5) [\"Hello\", \"23\"]</p>\n\n<p>It would return [\"Hello\"], however when I try to do it in a function getWords it gives me an error</p>\n\n<pre><code>* Couldn't match type `t0 a0' with `Word'\n      Expected type: [Word]\n        Actual type: [t0 a0]\n    * In the expression: filter (\\ x -&gt; length x == n) w\n      In an equation for `getWords':\n          getWords n w = filter (\\ x -&gt; length x == n) w\n    |\n163 | getWords n w = filter (\\x -&gt; length x == n) w\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nDate.hs:163:45: error:\n    * Couldn't match type `Word' with `t0 a0'\n      Expected type: [t0 a0]\n        Actual type: [Word]\n    * In the second argument of `filter', namely `w'\n      In the expression: filter (\\ x -&gt; length x == n) w\n      In an equation for `getWords':\n          getWords n w = filter (\\ x -&gt; length x == n) w\n    |\n163 | getWords n w = filter (\\x -&gt; length x == n) w\n</code></pre>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 205, "user_id": 9710552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8578fe2900e52ee3bd08329635673614?s=128&d=identicon&r=PG&f=1", "display_name": "RM777", "link": "https://stackoverflow.com/users/9710552/rm777"}, "edited": false, "score": 0, "creation_date": 1527936346, "post_id": 50655921, "comment_id": 88322108, "body": "What would be the first and second function, for the function with the definition f a b = a + b?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 205, "user_id": 9710552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8578fe2900e52ee3bd08329635673614?s=128&d=identicon&r=PG&f=1", "display_name": "RM777", "link": "https://stackoverflow.com/users/9710552/rm777"}, "edited": false, "score": 0, "creation_date": 1527937291, "post_id": 50655921, "comment_id": 88322372, "body": "@RM777 In such case, <code>f 3 = \\b -&gt; 3+b</code>, i.e. <code>f 3</code> is the function which adds 3. Essentially, <code>f</code> takes <code>3 :: Int</code> and returns the function <code>\\b -&gt; 3+b :: Int -&gt; Int</code>"}, {"owner": {"reputation": 205, "user_id": 9710552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8578fe2900e52ee3bd08329635673614?s=128&d=identicon&r=PG&f=1", "display_name": "RM777", "link": "https://stackoverflow.com/users/9710552/rm777"}, "edited": false, "score": 0, "creation_date": 1527938602, "post_id": 50655921, "comment_id": 88322774, "body": "So with the same logic: max 4 = \\b -&gt; compare 4 b?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 205, "user_id": 9710552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8578fe2900e52ee3bd08329635673614?s=128&d=identicon&r=PG&f=1", "display_name": "RM777", "link": "https://stackoverflow.com/users/9710552/rm777"}, "edited": false, "score": 0, "creation_date": 1527940555, "post_id": 50655921, "comment_id": 88323279, "body": "@RM777 No, <code>max 4 = \\b -&gt; max 4 b = \\b -&gt; if b&gt;4 then b else 4</code>. The function <code>compare</code> only returns one of <code>LT,EQ,GT</code> stating if the first argument is less than/equal to/greater than the second. It does not return a number."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1527935180, "creation_date": 1527935180, "answer_id": 50655921, "question_id": 50655831, "link": "https://stackoverflow.com/questions/50655831/currying-and-brackets-in-function-calls/50655921#50655921", "title": "Currying and Brackets in function calls", "body": "<pre><code>Int -&gt; (Int -&gt; Int)\n</code></pre>\n\n<p>is the same type as</p>\n\n<pre><code>Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>and is the type of a curried two-arguments function, both being integers. That is it is a function which takes an integer argument and returns a function, whose argument is another integer, and which finally returns an integer.</p>\n\n<p>Possible calls are <code>f 3 2</code> and <code>f (7+4) (5*8)</code>.</p>\n\n<p>Possible definitions are <code>f a b = a+b</code> and <code>f a b = a*a+42*b</code>.</p>\n\n<p>Instead,</p>\n\n<pre><code>(Int -&gt; Int) - &gt; Int\n</code></pre>\n\n<p>is not a binary function, curried or not. It is a function with a single argument, and this argument is a <em>function</em> <code>Int -&gt; Int</code>. The final result is an integer.</p>\n\n<p>Possible calls are <code>f (\\x -&gt; x+1)</code>, <code>f id</code>, and <code>f g where g n = n*4+5</code>.</p>\n\n<p>Possible definitions are <code>f h = h 45</code> and <code>f h = h (h 6) + h 7 + 9</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1528035739, "creation_date": 1528035739, "answer_id": 50667379, "question_id": 50655831, "link": "https://stackoverflow.com/questions/50655831/currying-and-brackets-in-function-calls/50667379#50667379", "title": "Currying and Brackets in function calls", "body": "<p>The idea of partial function application is a hallmark of Haskell.\nExploiting partial application is natural. It is much how we think.\nI fill my glass half with tea. Then I fill it completely with lemonaid.</p>\n\n<p><code>m2 = max 4</code> --partial application (Int -> Int)</p>\n\n<p><code>m2 5</code>       -- full application (Int -> Int) -> Int</p>\n\n<p>All functions in Haskell are curried. It is sometimes necessary to disable it with <code>uncurry</code></p>\n\n<p><code>m3 = uncurry max</code></p>\n\n<p><code>m4 = m3 4</code> -- does not become (Int -> Int)</p>\n\n<p><code>m4 3</code>  -- is not (Int -> Int) -> Int -> Int</p>\n\n<p>Does not work and the error has to do with partial application (Int -> Int) because the function now requires two parameters. </p>\n"}], "owner": {"reputation": 205, "user_id": 9710552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8578fe2900e52ee3bd08329635673614?s=128&d=identicon&r=PG&f=1", "display_name": "RM777", "link": "https://stackoverflow.com/users/9710552/rm777"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 50655921, "answer_count": 2, "score": 0, "last_activity_date": 1528035739, "creation_date": 1527934573, "last_edit_date": 1527935364, "question_id": 50655831, "link": "https://stackoverflow.com/questions/50655831/currying-and-brackets-in-function-calls", "title": "Currying and Brackets in function calls", "body": "<p>I have a hard time to understand Currying in Haskell. I was not able to understand the already existing answers to this topic. I want to understand what the difference is between:</p>\n\n<pre><code>(Int -&gt; Int) -&gt; Int\n</code></pre>\n\n<p>and </p>\n\n<pre><code>Int -&gt; (Int - &gt; Int)\n</code></pre>\n\n<p>I think the answer has something to do with currying. I have already consulted some resources about the topic and I have got an idea.</p>\n\n<p>Functions that have several parameters can be described as an array of elementary operations with one input and one output.</p>\n\n<p>According to the online tutorial learnyouahaskell:</p>\n\n<p>\"Doing max 4 5 first creates a function that takes a parameter and returns either 4 or that parameter, depending on which is bigger. Then, 5 is applied to that function and that function produces our desired result.\"</p>\n\n<p>So in this case the elementary basic operations are just comparing two values. And the first operation is </p>\n\n<p>if \"lowest value possible\" <code>&gt; 4</code> then \"lowest value possible\" otherwise 4</p>\n\n<p>The second operation is </p>\n\n<p>if 4 > 5 then 4 otherwise 5</p>\n\n<p>This would represent <code>Int -&gt; (Int -&gt; Int)</code> but what would <code>(Int -&gt; Int) -&gt; Int</code> be?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 3, "creation_date": 1527889327, "post_id": 50650960, "comment_id": 88313549, "body": "What were you having trouble with?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1527892215, "post_id": 50650960, "comment_id": 88314304, "body": "Your syntax is wrong, so you might want to look into your understanding of things like function application.  For example <code>(`mod` (a b))</code> would apply the function <code>a</code> to the value <code>b</code> and use that as the second argument to <code>mod</code> (via section application which syntacticly looks like <code>`someFunction`</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9883190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f86946e9a300a6c7bb5a3fc6c3c89a93?s=128&d=identicon&r=PG&f=1", "display_name": "Jocafrei", "link": "https://stackoverflow.com/users/9883190/jocafrei"}, "edited": false, "score": 0, "creation_date": 1527939045, "post_id": 50651116, "comment_id": 88322898, "body": "Thank you for you answer! It worked but I was looking for something simpler. But your answer helped me solving another problem so thanks a lot!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1527888010, "creation_date": 1527888010, "answer_id": 50651116, "question_id": 50650960, "link": "https://stackoverflow.com/questions/50650960/doing-greatest-common-divisor-function-with-haskell-using-until/50651116#50651116", "title": "Doing greatest common divisor function with Haskell using until", "body": "<p>I would try something like this (pseudocode)</p>\n\n<pre><code>mygcd a b = finalize (until endState nextState (a,b))\n   where\n   finalize (x,y)  = ...\n   endState (x,y)  = some condition here\n   nextState (x,y) = (x',y') computed in some way using mod\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 9883190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f86946e9a300a6c7bb5a3fc6c3c89a93?s=128&d=identicon&r=PG&f=1", "display_name": "Jocafrei", "link": "https://stackoverflow.com/users/9883190/jocafrei"}, "edited": false, "score": 0, "creation_date": 1527938965, "post_id": 50655437, "comment_id": 88322881, "body": "That did it! Thank you very much for both the explanation and the answer!"}], "tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 1, "last_activity_date": 1527931834, "creation_date": 1527931834, "answer_id": 50655437, "question_id": 50650960, "link": "https://stackoverflow.com/questions/50650960/doing-greatest-common-divisor-function-with-haskell-using-until/50655437#50655437", "title": "Doing greatest common divisor function with Haskell using until", "body": "<pre><code>mygcd a b = until (==0) (`mod` (a b)) b\n\n&gt; :t until\nuntil :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>So we have our predicate <code>(==0)</code>, our function <code>(`mod`(a b))</code>, and starting value <code>b</code>. My first issue with this, however: this won't terminate until the predicate holds true, so it can never produce anything but 0. What does that tell us? We also see that <code>a</code> must be of type <code>Integral a =&gt; a -&gt; a</code> since it's applied to <code>b</code> to get something we can use in <code>b `mod` x</code>. And repeating that won't yield a different result, so the expression either produces 0 immediately or after one <code>mod</code>, or never finishes. </p>\n\n<p>I think, to get something useful out of <code>until</code>, you need a more complicated predicate than an equality check. Perhaps a question like \"what's the lowest multiple of 13 over 100\", or you might make <code>a</code> a tuple and check one part of it. It looks a bit to me like:</p>\n\n<pre><code>until p f v = head (dropWhile (not . p) (iterate f v))\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9883190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f86946e9a300a6c7bb5a3fc6c3c89a93?s=128&d=identicon&r=PG&f=1", "display_name": "Jocafrei", "link": "https://stackoverflow.com/users/9883190/jocafrei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 0, "accepted_answer_id": 50651116, "answer_count": 2, "score": 0, "last_activity_date": 1527931834, "creation_date": 1527886978, "last_edit_date": 1527888034, "question_id": 50650960, "link": "https://stackoverflow.com/questions/50650960/doing-greatest-common-divisor-function-with-haskell-using-until", "title": "Doing greatest common divisor function with Haskell using until", "body": "<p>I need help proggraming a function in Haskell to calculate the greatest common divisor. The problem is I need to use the until function which I'm not being able to implement. I tried using the following code (that didn't work):</p>\n\n<pre><code>mygcd a b = until (==0) (`mod` (a b)) b\n</code></pre>\n\n<p>Thank for your help!</p>\n"}, {"tags": ["list", "function", "haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 5, "creation_date": 1527888191, "post_id": 50650938, "comment_id": 88313182, "body": "Meta: the use of <code>[x]</code> when just <code>x</code> was intended is a pretty common beginner mistake, for various reasons\u2014expecting <code>x</code> to match multiple elements, or thinking of <code>[]</code> as a sigil indicating a list\u2014and there are often questions about it here, but I can\u2019t seem to find a standard question to point to as a duplicate. :/"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1527889774, "post_id": 50650938, "comment_id": 88313686, "body": "@JonPurdy That is indeed one of the most frequently posted mistakes. We probably need a &quot;canonical&quot; reference, but no single question seems appropriate. (Maybe in the future someone will write a Q&amp;A for that purpose only?)"}], "tags": [], "owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "is_accepted": true, "score": 4, "last_activity_date": 1527904180, "last_edit_date": 1527904180, "creation_date": 1527886789, "answer_id": 50650938, "question_id": 50650842, "link": "https://stackoverflow.com/questions/50650842/trying-to-write-a-function-in-haskell-and-according-to-wall-i-need-a-pattern-th/50650938#50650938", "title": "Trying to write a function in Haskell and according to -Wall I need a pattern that matches (_:_:_) _ What does this pattern mean and why do I need it?", "body": "<p>Your function takes two arguments. GHCI is telling you that you haven't provided a definition for a function call that follows the pattern</p>\n\n<pre><code>tripleMultList (_:_:_) _\n</code></pre>\n\n<p>i.e. when the first argument matches the pattern <code>_:_:_</code> and the second argument matches the pattern <code>_</code>. The pattern <code>_</code> matches everything. The pattern <code>_:_:_</code> matches lists where the first element is anything, the second element is anything, and the rest of the list is anything. In other words, <code>_:_:_</code> matches lists of at least two elements.</p>\n\n<p>Look at the cases you defined:</p>\n\n<pre><code>tripleMultList [] x = []\ntripleMultList [y] x | x == (length [y] - 1) = [y] !! x : []\ntripleMultList [y] x = [y] !! x : tripleMultList [y] (x + 1)\n</code></pre>\n\n<p>That's:</p>\n\n<ul>\n<li>First argument: empty list; second argument: anything.</li>\n<li>First argument: list with a single element; second argument: anything; only if <code>x == (length [y] - 1)</code> is true.</li>\n<li>First argument: list with a single element; second argument: anything; only if the condition above is not met.</li>\n</ul>\n\n<p>This leaves out the case when the first argument is a list with at least two elements.</p>\n\n<p>If you want to follow the decomposition in your first definition, then you need to use <code>y</code> in the second and third definitions instead of <code>[y]</code>. The pattern <code>y</code> (a variable) matches anything (of the right type) and gives it the name <code>y</code>. The pattern <code>[y]</code> matches any list of one element and gives this element the name <code>y</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1527944006, "creation_date": 1527944006, "answer_id": 50657124, "question_id": 50650842, "link": "https://stackoverflow.com/questions/50650842/trying-to-write-a-function-in-haskell-and-according-to-wall-i-need-a-pattern-th/50657124#50657124", "title": "Trying to write a function in Haskell and according to -Wall I need a pattern that matches (_:_:_) _ What does this pattern mean and why do I need it?", "body": "<p>You almost never want to use <code>!!</code>, especially not for iterating over a list. Remember the definition of a list:</p>\n\n<pre><code> data [] a = [] | a : [] a\n</code></pre>\n\n<p>There are only two patterns you need to match: the empty list (<code>[]</code>) and the non-empty list (<code>x:y</code>). You have the empty-list case correct: multiplying every element of an empty list yields another empty list.</p>\n\n<pre><code>tripleMultList [] = []\n</code></pre>\n\n<p>For a non-empty list, you need something only slightly more complicated. You have the first element <code>x</code> and the rest of the elements as <code>y</code>. All you need to do is multiply <code>x</code> by 3, and add it to the list produced by multiplying everything in <code>y</code> by 3:</p>\n\n<pre><code>tripleMultList (x:y) = let x' = 3 * x\n                           y' = tripleMultList y\n                       in x' : y'\n</code></pre>\n\n<p>Note that we can generalize this for any operation on <code>x</code>:</p>\n\n<pre><code>doSomething :: (a -&gt; b) -&gt; [a] -&gt; [b]\ndoSomething _ [] = []\ndoSomething f (x:y) = let x' = f x\n                          y' = doSomething f y\n                      in x' : y'\n\ntripleMultList = doSomething (\\x -&gt; 3 * x)\n</code></pre>\n\n<p>This type of operation is so common that <code>doSomething</code> is already defined in Haskell, but it is called <code>map</code> instead.</p>\n"}], "owner": {"reputation": 23, "user_id": 9820648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/081577639dcef77faffd3682cd790d01?s=128&d=identicon&r=PG&f=1", "display_name": "pcoppi", "link": "https://stackoverflow.com/users/9820648/pcoppi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 50650938, "answer_count": 2, "score": 2, "last_activity_date": 1527944006, "creation_date": 1527886221, "question_id": 50650842, "link": "https://stackoverflow.com/questions/50650842/trying-to-write-a-function-in-haskell-and-according-to-wall-i-need-a-pattern-th", "title": "Trying to write a function in Haskell and according to -Wall I need a pattern that matches (_:_:_) _ What does this pattern mean and why do I need it?", "body": "<p>So I wanted to try to make this function myself (multiples everything in a list by 3 and returns a new list):</p>\n\n<pre><code>list = [1,2,3,4,5,6,7,8,9,10]\nlist2 = [3 * x | x &lt;- list]\n</code></pre>\n\n<p>And I managed to get this using guards (basically it stops when x reaches the bound of the list):</p>\n\n<pre><code>tripleMultList :: [Int] -&gt; Int -&gt; [Int]\ntripleMultList lst x\n   | null lst = []\n   | length lst - 1 == x = (lst !! x * 3) : []\n   | otherwise = (lst !! x * 3) : tripleMultList lst (x + 1)\n</code></pre>\n\n<p>Then I decided to try to do it with pattern matching:</p>\n\n<pre><code>tripleMultList :: [Int] -&gt; Int -&gt; [Int]\ntripleMultList [] x = []\ntripleMultList [y] x | x == (length [y] - 1) = [y] !! x : []\ntripleMultList [y] x = [y] !! x : tripleMultList [y] (x + 1)\n</code></pre>\n\n<p>But whenever I'd try to run this function I would get a non exhaustive pattern matching error so I checked ghci -Wall and it said that I needed a pattern matched to </p>\n\n<pre><code>(_:_:_) _ \n</code></pre>\n\n<p>which I assume would take the form of</p>\n\n<pre><code>tripleMultList (_:_:_) _ = something\n</code></pre>\n\n<p>I'm aware that </p>\n\n<pre><code>(_:_:_)\n</code></pre>\n\n<p>has to do with selecting elements from a list and separating them from the list itself, though I have no idea why this would apply to my function. I also don't know what \"_\" means or does and how it applies to my function either.</p>\n\n<p>So I guess my question is, what does this pattern mean and why do I need it when I have roughly the same thing in the version of my function which uses a guard and that one works fine? </p>\n"}, {"tags": ["haskell", "functional-programming", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1527897787, "post_id": 50650657, "comment_id": 88315333, "body": "If type classes are logical predicates, <code>CMap c xs</code> is a proof that all elements of <code>xs</code> satisfy <code>c</code>. For that reason I&#39;ve previously seen it called <code>All</code>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1527885194, "creation_date": 1527885194, "answer_id": 50650657, "question_id": 50650543, "link": "https://stackoverflow.com/questions/50650543/ensuring-a-heterogenous-list-contains-one-typeclass/50650657#50650657", "title": "Ensuring a heterogenous list contains one typeclass", "body": "<p>You can generalize <code>Eqed</code> by parameterizing it (requires a few extensions, GHC's error messages will tell):</p>\n\n<pre><code>import Data.Kind (Constraint)\n\nclass CMap (c :: * -&gt; Constraint) (xs :: [*])\ninstance CMap c '[]\ninstance (c x, CMap c xs) =&gt; CMap c (x ': xs)\n</code></pre>\n\n<p>However this doesn't quite behave nicely, because <code>CMap c (x ': xs)</code> doesn't imply <code>c x</code>, it's only the other way around. One way may be to add a method that can use those individual constraints but that seems hairy. Another is to use a type family:</p>\n\n<pre><code>type family CMap (c :: * -&gt; Constraint) (xs :: [*]) :: Constraint where\n  CMap c '[] = ()\n  CMap c (x ': xs) = (c x, CMap c xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1527885228, "creation_date": 1527885228, "answer_id": 50650664, "question_id": 50650543, "link": "https://stackoverflow.com/questions/50650543/ensuring-a-heterogenous-list-contains-one-typeclass/50650664#50650664", "title": "Ensuring a heterogenous list contains one typeclass", "body": "<p>You could use <code>ConstraintKinds</code> to make the constraint a parameter of the <code>HList</code>:</p>\n\n<pre><code>data HList c a where\n  (:&gt;) :: (c a) =&gt; a -&gt; HList c b -&gt; HList c (a ': b)\n  Nil :: HList c '[]\n\nexampleList :: HList Eq '[Int, String, Double]\nexampleList\n  = (1 :: Int)\n  :&gt; (\"two\" :: String)\n  :&gt; (3.0 :: Double)\n  :&gt; Nil\n</code></pre>\n\n<p>Or use <code>ExistentialTypes</code>/<code>GADTs</code> and a regular list, if you only need the typeclass and don\u2019t mind losing the static type information about which concrete types are in the list:</p>\n\n<pre><code>data SomeEq = forall a. Eq a =&gt; SomeEq a\n\ndata SomeEq where\n  SomeEq :: Eq a =&gt; a -&gt; SomeEq\n\nexampleList :: [SomeEq]\nexampleList =\n  [ SomeEq (1 :: Int)\n  , SomeEq (\"two\" :: String)\n  , SomeEq (3.0 :: Double)\n  ]\n</code></pre>\n\n<p>However, this isn\u2019t terribly useful in the case of <code>Eq</code>, unless you also propagate information about type equalities so that you have something useful to which you want to compare the abstract wrapped value. As it is, the only thing you can do with this is compare a wrapped value to itself.</p>\n\n<p>There may be better/simpler options depending on your particular application.</p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 50650657, "answer_count": 2, "score": 2, "last_activity_date": 1527905824, "creation_date": 1527884542, "last_edit_date": 1527905824, "question_id": 50650543, "link": "https://stackoverflow.com/questions/50650543/ensuring-a-heterogenous-list-contains-one-typeclass", "title": "Ensuring a heterogenous list contains one typeclass", "body": "<p>I've written my own heterogeneous list implementation (I first read about heterogeneous lists <a href=\"http://www.parsonsmatt.org/2017/04/26/basic_type_level_programming_in_haskell.html\" rel=\"nofollow noreferrer\">here</a> and my implementation is very similar to theirs)</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, TypeOperators #-}\n\ndata HList a where\n  (:&gt;) :: a -&gt; HList b -&gt; HList (a ': b)\n  Nil  :: HList '[]\ninfixr 6 :&gt;\n</code></pre>\n\n<p>This is great; however, once I found myself working with these heterogeneous lists, I found myself frequently wanting to express the idea of one where every type belongs to a particular type class.  My na\u00efve first solution here is to rewrite the <code>HList</code> datatype entirely for each new type class.  Here's it for <code>Eq</code> (just for example; it is not the only type class I am concerned with):</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, TypeOperators #-}\n\ndata EqHList a where\n  (:&gt;) :: (Eq a) =&gt; a -&gt; EqHList b -&gt; EqHList (a ': b)\n  Nil :: EqHList '[]\ninfixr 6 :&gt;\n</code></pre>\n\n<p>This has a whole slew of problems.  For one, I need to rewrite it each time I want a new type class. Also, functions that work on my old heterogeneous lists don't work on the new ones.</p>\n\n<p>My next solution was to use empty type classes.</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, TypeOperators, FlexibleInstances, FlexibleContexts #-}\n\ndata HList a where\n  (:&gt;) :: a -&gt; HList b -&gt; HList (a ': b)\n  Nil :: HList '[]\ninfixr 6 :&gt;\n\nclass Eqed a\n\ninstance Eqed (HList '[])\ninstance (Eq a, Eqed (HList b)) =&gt; Eqed (HList (a ': b))\n</code></pre>\n\n<p>Here an instance of <code>Eqed</code> is an <code>HList</code> of which all its elements are instances of <code>Eq</code>.  This is certainly nicer than the last solution, however I still feel it lacks.  I still have copy paste a bunch of code each time I want to talk about a different type class.  I feel like this is the type of problem that could be solved with some more type level programming.</p>\n\n<p>Is there a better way?</p>\n"}, {"tags": ["haskell", "tuples", "functor"], "comments": [{"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 3, "creation_date": 1527857630, "post_id": 50643795, "comment_id": 88298013, "body": "How would you define <code>fmap succ (&quot;Hello!&quot;, 42)</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1527857886, "post_id": 50643795, "comment_id": 88298205, "body": "Because <code>class Functor (a :: * -&gt; *) where ...</code> so it expects a type parameter, and the order of the type parameters is <code>data (,) a b = (a, b)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1527858083, "post_id": 50643795, "comment_id": 88298353, "body": "Have you tried writing <code>data MyTuple a b = MyTuple a b</code> (so that you can give a fresh instance), translating your proposed instance to <code>MyTuple</code>, and seeing what the compiler says? The sequence of errors you get should be quite enlightening."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1527889274, "post_id": 50643795, "comment_id": 88313531, "body": "Well it&#39;s just because functors are defined on a single type and tuples are there to contain multiple types. Hence... only one of them can get effected."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1527857866, "creation_date": 1527857866, "answer_id": 50643975, "question_id": 50643795, "link": "https://stackoverflow.com/questions/50643795/why-is-the-functor-instance-for-mapping-on-the-second-value/50643975#50643975", "title": "Why is the Functor instance for (,) mapping on the second value?", "body": "<p>This behavior is available from the <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Functor-Product.html#v:Pair\" rel=\"nofollow noreferrer\"><code>Product</code></a> functor:</p>\n\n<pre><code>Data.Functor.Product Data.Functor.Identity&gt; fmap (+1) (Pair 5 6) :: Product Identity Identity Integer\nPair (Identity 6) (Identity 7)\n</code></pre>\n\n<p>As you can see, the key difference between <code>Product</code> and <code>(,)</code> is that both elements of the <code>Pair</code> have the same leaf type (in this case, <code>Integer</code>). (Relatedly: note that in the type above, <code>Integer</code> is mentioned just once, whereas in the type of <code>(5,6)</code>, <code>Integer</code> is mentioned <em>twice</em>.) Since <code>(,)</code> may contain completely unrelated types, there's no guarantee that you can apply a single function to both parts in a well-typed way.</p>\n"}, {"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1527882626, "post_id": 50643998, "comment_id": 88311213, "body": "I feel like this particular <code>Functor</code> instance begins to make a bit more sense (especially regarding its utility) when you start to get to its <code>Applicative</code> and <code>Monad</code> instances (so that, for @MarkNeu, might be something worth keeping in mind for a little later on)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1527859814, "last_edit_date": 1527859814, "creation_date": 1527857956, "answer_id": 50643998, "question_id": 50643795, "link": "https://stackoverflow.com/questions/50643795/why-is-the-functor-instance-for-mapping-on-the-second-value/50643998#50643998", "title": "Why is the Functor instance for (,) mapping on the second value?", "body": "<p>The instance is actually not <code>instance Functor (,)</code> like you said. That wouldn't be well-kinded:</p>\n\n<pre><code>Prelude&gt; :k Functor\nFunctor :: (* -&gt; *) -&gt; Constraint\nPrelude&gt; :k (,)\n(,) :: * -&gt; * -&gt; *\n</code></pre>\n\n<p>i.e., <code>(,)</code> takes two type arguments (the types of both tuple-fields) to construct a tuple-type, but the <code>Functor</code> class is actually for type-constructors that take only <em>one</em> argument, like</p>\n\n<pre><code>Prelude&gt; :k []\n[] :: * -&gt; *\nPrelude&gt; :k IO\nIO :: * -&gt; *\n</code></pre>\n\n<p>So why is there a functor instance at all? Frankly, I think this is one of the instances which should <em>not</em> have been defined, precisely because it's confusing that tuples aren't symmetric. However, it <em>can</em> actually be defined and there's only one way to do it, so this choice by the standard libraries is certainly not <em>unreasonable</em>. The trick is currying: you can partially apply the <code>(,)</code> constructor to any fixed left-field type, and that gives you then a single-argument type constructor. For example</p>\n\n<pre><code>Prelude&gt; :k (,) Int\n(,) Int :: * -&gt; *\n</code></pre>\n\n<p>so you can for instance have</p>\n\n<pre><code>instance Functor ((,) Int)\n</code></pre>\n\n<p>Clearly it doesn't depend on what concrete type the left field has, so you can as well make it</p>\n\n<pre><code>instance Functor ((,) a)\n</code></pre>\n\n<p>In value-level Haskell, this section would be written</p>\n\n<pre><code>instance Functor (a,)\n</code></pre>\n\n<p>Unlike at the term level, partial application does <em>only</em> work for the leftmost argument (the section <code>(,b)</code> would actually be be sugar for <code>\\a -&gt; (a,b)</code>, but there are no type-level lambdas in Haskell), so <code>instance Functor ((,) a)</code> is the only instance that's possible here.</p>\n\n<p>To get the behaviour you asked for, i.e. function applied to both/all fields, you need both fields to actually have the same type. I.e., you need a type constructor that has only one argument to begin with, and just uses that type twice for the fields of its <em>value</em> constructor. A standard type with that behaviour is <a href=\"http://hackage.haskell.org/package/linear-1.20.7/docs/Linear-V2.html\" rel=\"nofollow noreferrer\"><code>V2</code></a>.</p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "closed_date": 1527858103, "accepted_answer_id": 50643998, "answer_count": 2, "score": 0, "last_activity_date": 1527859814, "creation_date": 1527857253, "question_id": 50643795, "link": "https://stackoverflow.com/questions/50643795/why-is-the-functor-instance-for-mapping-on-the-second-value", "closed_reason": "Duplicate", "title": "Why is the Functor instance for (,) mapping on the second value?", "body": "<p>In Haskell, the Functor instance of (,) is apparently</p>\n\n<pre><code>instance Functor (,) where\n    fmap f (a,b) = (a,f b)\n</code></pre>\n\n<p>This results in the unintuitive fact that:</p>\n\n<pre><code>&gt; fmap (const 5) [1, 2]\n[5,5]\n&gt; fmap (const 5) (1, 2)\n(1,5)\n</code></pre>\n\n<p>Now, using this definiton would work much better, in my opinion:</p>\n\n<pre><code>instance Functor (,) where\n    fmap f (a,b) = (f a,f b)\n</code></pre>\n\n<p>It would work like this:</p>\n\n<pre><code>&gt; fmap (const 5) (1, 2)\n(5,5)\n</code></pre>\n\n<p>Why is it not like this?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527847277, "post_id": 50640657, "comment_id": 88291794, "body": "Well <code>newtype</code> actually is a <code>data</code> with a constructor that takes one parameter. As a result this is a <i>new</i> type, wherea <code>type</code> is only a type alias. For the type alias the <code>a</code> does not matter whether <code>Reflective</code> holds, hence the confusion. Whereas for the <code>newtype</code>, you can define <code>instance</code>s yourself and thus &quot;tag&quot; the <code>a</code>s for which it is allowed."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527847616, "post_id": 50640657, "comment_id": 88291999, "body": "To make it more clear: say you use <code>reflectiveNames</code> with <code>Text</code>, then how is Haskell supposed to know what <code>a</code> to use? Whereas if you define a <code>VarName</code> type, then the <code>a</code> has to be passed (and can for a real function application be grounded) to a type, such that it can be checked if the <code>instance</code> constraint holds."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527847961, "post_id": 50640657, "comment_id": 88292189, "body": "@WillemVanOnsem I would have expected that if I said <code>reflectiveNames :: [Text]</code> then the ambiguity error would have appeared there, rather than in the declaration of <code>reflectiveNames</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1527848054, "post_id": 50640657, "comment_id": 88292252, "body": "well you basically have written, behind the curtains, <code>reflectiveNames :: Reflective a =&gt; [Text]</code>, since <code>type</code> is not a <i>new</i> type, but a type alias. And that thus means that Haskell can <i>not</i> derive what <code>a</code> is for the given type of the function, and this constructs ambiguity. What <code>reflectiveName</code> is it supposed to use? That for <code>a ~ Char</code>, or <code>a ~ Int</code>, or <code>a ~ ()</code>, etc.? This might sounds like a detail, but all these instances can have completely different semantics, if the compiler thus had the freedom to simply pick one, then depending on the system, <code>reflectiveNames</code> makes sense."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527848321, "post_id": 50640657, "comment_id": 88292414, "body": "@WillemVanOnsem If you can write this up as an answer then I&#39;ll accept it."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1527868542, "last_edit_date": 1527868542, "creation_date": 1527868086, "answer_id": 50647075, "question_id": 50640657, "link": "https://stackoverflow.com/questions/50640657/strange-behavior-of-type-parameters-in-type-versus-newtype-is-this-a-bug-or/50647075#50647075", "title": "Strange behavior of type parameters in &quot;type&quot; versus &quot;newtype&quot;: is this a bug or a feature?", "body": "<h1>Why this fails for a <code>type</code>...</h1>\n\n<p>If you write <code>type</code> then you do <em>not</em> construct a new type, you construct an alias. So you defined:</p>\n\n<pre><code><b>type</b> VarName a = Text</code></pre>\n\n<p>Hence now each time you write <code>VarName SomeType</code>, you have basically written <code>Text</code>. So <code>VarName Char ~ VarName Int ~ Text</code> (the tilde <code>~</code> means that the two types are equal).</p>\n\n<p>Type aliases are useful however since they typically minimize the code (frequently the name of the alias is shorter than its counterpart), it reduces the complexity of signatures (one does not have to remember a large hierarchy of types), and finally it can be used if some types are not yet fully decided (for example time can be modelled as an <code>Int32</code>, <code>Int64</code>, etc.) and we want to define some placeholder to easily change a large number of signatures.</p>\n\n<p>But the point is that each time you write a <code>VarName Char</code> for example, Haskell will replace this with <code>Text</code>. So now if we take a look at your function, you have written:</p>\n\n<pre><code>reflectiveNames :: Reflective <b>a</b> =&gt; [<b>Text</b>]\nreflectiveNames = map reflectiveName reflectiveDefaults</code></pre>\n\n<p>Now there is a problem with this function: there is a type variable <code>a</code> (in <code>Reflective a</code>), but nowhere in the signature do we use this type parameter. The problem is that Haskell does not know what <code>a</code> to fill in in case you call this function, and that is a real problem (here), since the semantics of <code>reflectiveName</code> and <code>reflectiveDefaults</code> can be completely different for an <code>a ~ Char</code>, then for an <code>a ~ Int</code>. The compiler can not just \"<em>pick</em>\" a type for <code>a</code>, since that would mean that two different Haskell compilers, could end up with functions that generate different output, and thus a different program (usually one of the fundamental desired aspects of a programming language is <em>unambiguity</em>, the fact that there are no two semantically different programs that map on the same source code).</p>\n\n<h1>... and why it works for a <code>newtype</code></h1>\n\n<p>Now why doesn't this happen if we use <strong><code>newtype</code></strong>? Basically a <code>newtype</code> is the same as a <code>data</code> declaration, except for some small details: behind the curtains for example, Haskell will <em>not</em> produce such constructor, it will simply store the value that is wrapped inside the constructor <em>but</em> it will see the value as a different type. The <code>newtype</code> definition</p>\n\n<pre><code><b>newtype</b> VarName a = VarName Text</code></pre>\n\n<p>is thus (conceptually) almost equivalent to:</p>\n\n<pre><code><b>data</b> VarName a = VarName Text</code></pre>\n\n<p>Although Haskell will (given it is a compiler that can deal with such optimization) factor the constructor away, we can conceptually assume that it is there.</p>\n\n<p>But the main difference is that we did <em>not</em> define a type signature: we defined a new type, so the function signature stays:</p>\n\n<pre><code>reflectiveNames :: Reflective a =&gt; [<b>VarName a</b>]\nreflectiveNames = map reflectiveName reflectiveDefaults</code></pre>\n\n<p>and we can not just write <code>Text</code> instead of <code>VarName a</code>, since a <code>Text</code> is <em>not</em> a <code>VarName a</code>. It also means that Haskell can perfectly derive what <code>a</code> is. If we would for instance trigger <code>reflectiveNames :: [VarName Char]</code>, then it know that <code>a</code> is a <code>Char</code>, and it will thus use the <code>instance</code> of <code>Reflective</code> for <code>a ~ Char</code>. There is no ambiguity. Of course we can define aliasses like:</p>\n\n<pre><code>type Foo = VarName <b>Char</b>   -- a ~ Char\ntype Bar <b>b</b> = VarName <b>Int</b>  -- a ~ Int</code></pre>\n\n<p>But then still <code>a</code> is resolved to <code>Char</code> and <code>Int</code> respectively. Since this is a new type, we will always carry the type of <code>a</code> through the code, and hence the code is unambiguous.</p>\n"}], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 50647075, "answer_count": 1, "score": 4, "last_activity_date": 1527868542, "creation_date": 1527846413, "question_id": 50640657, "link": "https://stackoverflow.com/questions/50640657/strange-behavior-of-type-parameters-in-type-versus-newtype-is-this-a-bug-or", "title": "Strange behavior of type parameters in &quot;type&quot; versus &quot;newtype&quot;: is this a bug or a feature?", "body": "<p>I'm writing a typeclass to add type reflection to Haskell data types. Part of it looks like this:</p>\n\n<pre><code>type VarName a = Text\n\n\nclass Reflective a where\n   -- | A reflective type may have a fixed name, or it may be a union \n   -- where each variant has a distinct name.\n   reflectiveName :: a -&gt; VarName a\n   -- | One default value of the type for each reflective name.\n   reflectiveDefaults :: [a]\n</code></pre>\n\n<p>The idea is that if I write</p>\n\n<pre><code>data ExampleType = Foo Int | Bar String\n</code></pre>\n\n<p>then in the <code>Reflective</code> instance <code>reflectiveName</code> will return either \"Foo\" or \"Bar\" as appropriate, and <code>reflectiveDefaults</code> will return <code>[Foo 0, Bar \"\"]</code></p>\n\n<p>So now I can write a function to give me all the names of the variants:</p>\n\n<pre><code>reflectiveNames :: (Reflective a) =&gt; [VarName a]\nreflectiveNames = map reflectiveName reflectiveDefaults\n</code></pre>\n\n<p>and I can call it like this:</p>\n\n<pre><code>exampleNames = reflectiveNames :: [VarName ExampleType]\n</code></pre>\n\n<p>When I compile this I get the following error in the type declaration for <code>reflectiveNames</code>:</p>\n\n<pre><code>\u2022 Could not deduce (Reflective a0)\n  from the context: Reflective a\n    bound by the type signature for:\n               reflectiveNames :: Reflective a =&gt; [VarName a]\n  The type variable \u2018a0\u2019 is ambiguous\n</code></pre>\n\n<p>However if I replace the VarName with a newtype:</p>\n\n<pre><code>newtype VarName a = VarName Text\n</code></pre>\n\n<p>then it works.</p>\n\n<p>Is this a feature of the Haskell type system, or is it a bug in GHC? And if the former, why is it inventing a new type variable a0?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 1, "creation_date": 1527843972, "post_id": 50637438, "comment_id": 88289666, "body": "If your matching names with ids, wouldn&#39;t it be better to have <code>[(id, [Maybe Name])]</code> instead of <code>[(Maybe Name, [Maybe Name])]</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 4, "last_activity_date": 1527838608, "creation_date": 1527838608, "answer_id": 50638364, "question_id": 50637438, "link": "https://stackoverflow.com/questions/50637438/from-a-list-of-tuples-containing-names-and-id-i-want-tuples-which-contains-nam/50638364#50638364", "title": "From a list of tuples containing names and id , i want tuples which contains names and list of names which got the similiar id", "body": "<p>The particular error you're asking about occurs because of this part:</p>\n\n<pre><code>                                case (id,fid) of\n                                  (val1,val2) -&gt;  if(val1==val2)\n                                                    then (fname,(nameAcc++[name]) )\n                                                  else (fname,nameAcc)\n                                  (Nothing , _) -&gt; (fname,nameAcc)\n--                                 ^^^^^^^\n</code></pre>\n\n<p><code>id</code> is an <code>Integer</code>, but you're trying to pattern match it against <code>Nothing</code>, which is a <code>Maybe something</code>.</p>\n\n<p>This <code>case</code> branch makes no sense. It's also unreachable because <code>(val1,val2)</code> before it always matches (it cannot fail), so we can simply remove the <code>Nothing</code> pattern:</p>\n\n<pre><code>                                case (id,fid) of\n                                  (val1,val2) -&gt;  if(val1==val2)\n                                                    then (fname,(nameAcc++[name]) )\n                                                  else (fname,nameAcc)\n</code></pre>\n\n<p>But why use <code>case</code> at all? All we're really doing is bind <code>id</code> to <code>val1</code> and <code>fid</code> to <code>val2</code>. We could just use the original variables and get rid of the <code>case</code> entirely:</p>\n\n<pre><code>                                if(val1==val2)\n                                   then (fname,(nameAcc++[name]) )\n                                   else (fname,nameAcc)\n</code></pre>\n\n<p>We can remove some redundant parens:</p>\n\n<pre><code>                                if val1==val2\n                                   then (fname,nameAcc++[name])\n                                   else (fname,nameAcc)\n</code></pre>\n\n<p>... and pull out common parts:</p>\n\n<pre><code>                                (fname, if val1 == val2\n                                            then nameAcc++[name]\n                                            else nameAcc)\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 9403534, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel D&#39;costa", "link": "https://stackoverflow.com/users/9403534/samuel-dcosta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "closed_date": 1527844578, "answer_count": 1, "score": 1, "last_activity_date": 1527838608, "creation_date": 1527835045, "last_edit_date": 1527837415, "question_id": 50637438, "link": "https://stackoverflow.com/questions/50637438/from-a-list-of-tuples-containing-names-and-id-i-want-tuples-which-contains-nam", "closed_reason": "Duplicate", "title": "From a list of tuples containing names and id , i want tuples which contains names and list of names which got the similiar id", "body": "<pre><code>datatest :: [(Maybe String,Integer)]\ndatatest = [(Just \"name1\" , 111), (Just \"name2\" , 222), (Nothing, 333), (Just \"name4\",111)]\n</code></pre>\n\n<p>need the output like this</p>\n\n<pre><code>[(Just \"name1\",[Just \"name1\",Just \"name4\"]),(Just \"name2\",[Just \"name2\"]),(Nothing,[]),(Just \"name4\", [Just \"name1\",Just \"name4\"])]\n</code></pre>\n\n<p>In test123, it takes a list of tuples containing (Maybe Name, Id) and giving [(Maybe Name, [Maybe Name])] in here the list of names are the names with similar id</p>\n\n<pre><code>test123 :: [(Maybe String, Integer)] -&gt; [(Maybe String,[Maybe String])]\ntest123 rows = \n  fmap (\\(name,id) -&gt; \n                DL.foldl' (\\(rowAcc,nameAcc) (fname,fid) -&gt; \n                                    case (id,fid) of\n                                      (val1,val2) -&gt;  if(val1==val2)\n                                                        then (fname,(nameAcc++[name]) )\n                                                      else (fname,nameAcc)\n                                      (Nothing , _) -&gt; (fname,nameAcc)          \n                  ) (\"\",[]) rows\n    ) rows\n</code></pre>\n\n<p>This is the code i had written, but I'm getting compilation errors.</p>\n\n<p>Below are the errors I'm getting at compile time:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error:\n    \u2022 Couldn't match type \u2018Integer\u2019 with \u2018Maybe t0\u2019\n      Expected type: [(Maybe String, Maybe t0)]\n        Actual type: [(Maybe String, Integer)]\n    \u2022 In the third argument of \u2018DL.foldl'\u2019, namely \u2018rows\u2019\n\nerror:\n    \u2022 Couldn't match type \u2018Integer\u2019 with \u2018Maybe t0\u2019\n      Expected type: [(Maybe String, Maybe t0)]\n        Actual type: [(Maybe String, Integer)]\n    \u2022 In the second argument of \u2018fmap\u2019, namely \u2018rows\u2019\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "criterion"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1527837064, "post_id": 50637221, "comment_id": 88285796, "body": "Could you please provide command how you build your file? Basically, you need to specify <code>criterion</code> package as a dependency for your <code>Main.hs</code> file. And I&#39;m not sure that <code>cabal install</code> is the right way. It&#39;s much easier to accomplish with <code>cabal</code> if you create package instead of single module file."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1527844844, "post_id": 50637221, "comment_id": 88290208, "body": "The actual error is in your <code>. . .</code>, so you will need to not snip that out. (The UI that cabal exposes for reporting errors is not super great in this particular way.)"}, {"owner": {"reputation": 21, "user_id": 8926582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbd5e444df28dab79604f309be0618a?s=128&d=identicon&r=PG&f=1", "display_name": "Mamtaj Akter", "link": "https://stackoverflow.com/users/8926582/mamtaj-akter"}, "edited": false, "score": 0, "creation_date": 1527996793, "post_id": 50637221, "comment_id": 88336195, "body": "I am using cabal. so, to build the package, the command I use is &quot;cabal build&quot; and &quot;cabal test&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 0, "last_activity_date": 1527854368, "creation_date": 1527854368, "answer_id": 50642944, "question_id": 50637221, "link": "https://stackoverflow.com/questions/50637221/could-not-find-module-criterion-main/50642944#50642944", "title": "Could not find module \u2018Criterion.Main\u2019", "body": "<p>One approach would be to use the Stack script interpreter to run this. In order to do so, you would first <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">install Stack</a>, then add the <a href=\"https://haskell-lang.org/tutorial/stack-script\" rel=\"nofollow noreferrer\">script interpreter bits</a> to the top of your file, e.g.:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-11.10 script --optimize\nimport Criterion.Main\n\n-- The function we're benchmarking.\nfib m | m &lt; 0     = error \"negative!\"\n    | otherwise = go m\nwhere\n    go 0 = 0\n    go 1 = 1\n    go n = go (n-1) + go (n-2)\n\n-- Our benchmark harness.\nmain = defaultMain [\nbgroup \"fib\" [ bench \"1\"  $ whnf fib 1\n            , bench \"5\"  $ whnf fib 5\n            , bench \"9\"  $ whnf fib 9\n            , bench \"11\" $ whnf fib 11\n                ]\n    ]\n</code></pre>\n\n<p>Note that I added the <code>--optimize</code> option on the second line to ensure that Stack would compile your code with optimizations on, instead of the default of using <code>runghc</code>.</p>\n\n<p>And finally run the file with <code>stack fiber.hs</code> (or whatever you called the file).</p>\n"}], "owner": {"reputation": 21, "user_id": 8926582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbd5e444df28dab79604f309be0618a?s=128&d=identicon&r=PG&f=1", "display_name": "Mamtaj Akter", "link": "https://stackoverflow.com/users/8926582/mamtaj-akter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 301, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1527854368, "creation_date": 1527834203, "last_edit_date": 1527837115, "question_id": 50637221, "link": "https://stackoverflow.com/questions/50637221/could-not-find-module-criterion-main", "title": "Could not find module \u2018Criterion.Main\u2019", "body": "<p>I have copied the following code from criterion tutorial:</p>\n\n<pre><code>import Criterion.Main\n\n-- The function we're benchmarking.\nfib m | m &lt; 0     = error \"negative!\"\n      | otherwise = go m\n  where\n    go 0 = 0\n    go 1 = 1\n    go n = go (n-1) + go (n-2)\n\n-- Our benchmark harness.\nmain = defaultMain [\n  bgroup \"fib\" [ bench \"1\"  $ whnf fib 1\n               , bench \"5\"  $ whnf fib 5\n               , bench \"9\"  $ whnf fib 9\n               , bench \"11\" $ whnf fib 11\n                ]\n     ]\n</code></pre>\n\n<p>I am getting the following error:</p>\n\n<p>fiber.hs:1:1: error:\nCould not find module \u2018Criterion.Main\u2019\nUse -v to see a list of the files searched for.\n|\n1 | import Criterion.Main\n| ^^^^^^^^^^^^^^^^^^^^^</p>\n\n<p>The GHC version I am using is 8.4.2 and cabal version is 2.2.0.0.</p>\n\n<p>I tried to install the criterion package by:</p>\n\n<pre><code>cabal update\nDownloading the latest package list from hackage.haskell.org\nTo revert to previous state run: cabal update --index-state='2018-06- \n01T04:23:08Z'\n\ncabal install -j --disable-tests criterion\nclang: warning: argument unused during compilation: '-nopie' [-Wunused- \ncommand-line-argument]\n.\n.\n.\n.\ncabal: Error: some packages failed to install:\nabstract-deque-0.3-IvBVpgU2tvq3eILHsBTjFR failed during the building \nphase.\nThe exception was:\nExitFailure 1\naeson-1.3.1.1-J9Jy9Bz77dxJho59OWZvUt depends on aeson-1.3.1.1 which \nfailed to install.\nattoparsec-0.13.2.2-5fvnJr9WRPCJj7fMCLKoI7 depends on attoparsec- \n0.13.2.2\nwhich failed to install.\ncassava-0.5.1.0-CNxiRQP2h44BSkY7PLw3nv depends on cassava-0.5.1.0 which \nfailed\nto install.\ncriterion-1.4.1.0-1CDqJgx5SYk1Xphp8S6hvK depends on criterion-1.4.1.0 \nwhich failed to install.\nmicrostache-1.0.1.1-DUzquwnO02sC17piNr03EI depends on microstache- \n1.0.1.1 which failed to install.\nmonad-par-0.3.4.8-5Qx7yEAZEkjJbqZykcUjIa depends on monad-par-0.3.4.8 \nwhich failed to install.\nmonad-par-extras-0.3.3-755mClpwIBoBMORFcN7gCY failed during the \nbuilding phase. The exception was:\nExitFailure 1\nscientific-0.3.6.2-65wDZeAE9ZIBkaesoEq4I0 failed during the building \nphase.\nThe exception was:\nExitFailure 1\nstatistics-0.14.0.2-GHJ1OiovyXP1FEjV1emzr8 depends on statistics- \n0.14.0.2 which failed to install.\ntext-short-0.1.2-JRY9FeZhxkoAZrj3rm5IJZ failed during the building \nphase. The exception was:\nExitFailure 1\nuuid-types-1.0.3-tE9Bfk2PgXDUPgbtamBdI failed during the building \nphase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "edited": false, "score": 0, "creation_date": 1527830348, "post_id": 50636360, "comment_id": 88282928, "body": "You might want to read up on what <code>$</code> does. The purpose of a <code>$</code> is to help reduce the number of parentheses <code>()</code> in your expressions. Here&#39;s its type signature: <code>($) :: (a -&gt; b) -&gt; a -&gt; b</code>. In other words, all it does is take a function and its <i>single</i> argument, and applies the function. Really boring. Terrifically boring. Does absolutely nothing useful (semantically)."}, {"owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "edited": false, "score": 0, "creation_date": 1527830493, "post_id": 50636360, "comment_id": 88282971, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/940382/what-is-the-difference-between-dot-and-dollar-sign\">What is the difference between . (dot) and $ (dollar sign)?</a>"}, {"owner": {"reputation": 63, "user_id": 5846225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0931ac15f9958059aede0691aafcc90c?s=128&d=identicon&r=PG&f=1", "display_name": "MaxC", "link": "https://stackoverflow.com/users/5846225/maxc"}, "reply_to_user": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "edited": false, "score": 0, "creation_date": 1527831241, "post_id": 50636360, "comment_id": 88283222, "body": "Hi, Mateen. Before I ask this question, I have read that question answer already. And I edited my question more accurately, thanks for your help."}, {"owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "edited": false, "score": 0, "creation_date": 1527833632, "post_id": 50636360, "comment_id": 88284145, "body": "I believe it&#39;s because <code>($)</code> is a function with <i>high precedence</i>, whereas <code>$</code> is an infix operator but with <i>low precedence</i>."}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1527837813, "post_id": 50637137, "comment_id": 88286201, "body": "A couple parts of this are a bit inaccurate: Low precedence does not mean that operations on the right get grouped together first. That would be right associativity. Precedence is a number that tells you which operations get done before which other operations. Also, <code>($$)</code> is both a function and an infix operator (just like <code>($)</code> is). When you define an operator, <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-240003.2\" rel=\"nofollow noreferrer\">it defaults to the highest precedence and left associativity</a>. You tell Haskell to use a different precedence/associativity with <code>infixr</code> or <code>infixl</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1527838038, "post_id": 50637137, "comment_id": 88286331, "body": "Additionally, there are some uses for <code>($)</code> other than removing parentheses. Consider something like <code>map ($ 5) [(+1), (*10), (`mod` 2)]</code> or <code>zipWith ($) [(+1), (*10), (`mod` 2)] [1..]</code>."}, {"owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1527840649, "post_id": 50637137, "comment_id": 88287705, "body": "@DavidYoung Thanks, I&#39;ve made some adjustments."}], "tags": [], "owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "is_accepted": true, "score": 3, "last_activity_date": 1593893571, "last_edit_date": 1593893571, "creation_date": 1527833816, "answer_id": 50637137, "question_id": 50636360, "link": "https://stackoverflow.com/questions/50636360/usage-of-dollar-sign-on-a-multi-arguments-function/50637137#50637137", "title": "Usage of dollar sign on a multi arguments function", "body": "<p>The purpose of a <code>$</code> is to help reduce the number of parentheses <code>()</code> in your expressions. Here's its type signature:</p>\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n<p>In other words, all it does is take a function and its single argument, and applies the function. Really boring. Terrifically boring. That is to say:</p>\n<pre><code>($) f x = f x    , or more simply,\n($) f = f        , or more simply,\n($) = id\n</code></pre>\n<p>The only thing which makes <code>($)</code> worthwhile is that it has a different precedence than a regular function like <code>id</code>. That is, <code>($)</code> has a very <em>low</em> precedence; in contrast, regular functions such as <code>id</code> have a very <em>high</em> precedence in application.</p>\n<p>When acting as an infix operator, <code>$</code> is right associative. That's another useful property.</p>\n<hr />\n<blockquote>\n<p><strong>Question 1: Why ($) not works on &quot;p $ 2 $ 2 $ 5&quot;?</strong></p>\n</blockquote>\n<p>Let's get rid of some <code>$</code> signs. The following are all equivalent:</p>\n<pre><code>  p $ 2 $ 2 $ 5\n= p (2 $ 2 $ 5)\n= p (2 (2 $ 5))\n= p (2 (2 5))\n</code></pre>\n<p>I suppose you can figure out why an expression like <code>(2 5)</code> doesn't make any sense.</p>\n<hr />\n<blockquote>\n<p><strong>Question 2: Why ($$) works on &quot;p $$ 2 $$ 2 $$ 5&quot;?</strong></p>\n</blockquote>\n<p>When you define a new function such as <code>($$)</code>, it is given left assosciativity (and also highest precedence) by default. Then:</p>\n<pre><code>  p $$ 2 $$ 2 $$ 5\n= (p 2) $$ 2 $$ 5\n= ((p 2) 2) $$ 5\n= ((p 2) 2) 5\n</code></pre>\n<p>This is of course plain old partial application.</p>\n<hr />\n<blockquote>\n<p><strong>Question 3: Why ($$) not works on &quot;p $$ [1]++[2..3] $$ 4 $$ 5&quot;?</strong></p>\n</blockquote>\n<pre><code>  p $$ [1] ++ [2..3] $$ 4 $$ 5\n= (((p $$ [1]) ++ [2..3]) $$ 4) $$ 5\n= (((p [1]) ++ [2..3]) 4) 5\n</code></pre>\n<hr />\n<blockquote>\n<p><strong>Question 4: Is there a more elegant way to write &quot;p $$ [1]++[2..3] $$ [1]++[2..3] $$ 5&quot; correctly?</strong></p>\n</blockquote>\n<p>Without the wacky <code>$$</code>, I suppose. :)</p>\n"}, {"tags": [], "owner": {"reputation": 356, "user_id": 536342, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f354d52ac79638d5bc6b967981ef9945?s=128&d=identicon&r=PG", "display_name": "pikapika", "link": "https://stackoverflow.com/users/536342/pikapika"}, "is_accepted": false, "score": 5, "last_activity_date": 1527844709, "last_edit_date": 1527844709, "creation_date": 1527835094, "answer_id": 50637455, "question_id": 50636360, "link": "https://stackoverflow.com/questions/50636360/usage-of-dollar-sign-on-a-multi-arguments-function/50637455#50637455", "title": "Usage of dollar sign on a multi arguments function", "body": "<p>The answers lie in operator precedence due to their fixity specifications.</p>\n\n<p><code>($)</code> has a precedence of 0 and associates to the right as can be seen by </p>\n\n<pre><code>Prelude&gt; :i ($)\n...                                                                                                                                                                                 \ninfixr 0 $   \n</code></pre>\n\n<p>If you want your custom operator to have the precedence and associativity that you're suggesting you will need to add the fixity declaration to your code:</p>\n\n<pre><code>infixl 0 $$\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 5846225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0931ac15f9958059aede0691aafcc90c?s=128&d=identicon&r=PG&f=1", "display_name": "MaxC", "link": "https://stackoverflow.com/users/5846225/maxc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 50637137, "answer_count": 2, "score": 3, "last_activity_date": 1593893571, "creation_date": 1527829179, "last_edit_date": 1527831029, "question_id": 50636360, "link": "https://stackoverflow.com/questions/50636360/usage-of-dollar-sign-on-a-multi-arguments-function", "title": "Usage of dollar sign on a multi arguments function", "body": "<pre><code>Prelude&gt; p a b c=1\nPrelude&gt; p $ 2 $ 2 $ 5\ntons of error......\nPrelude&gt; ($$)=($)\nPrelude&gt; p $$ 2 $$ 2 $$ 5\n1\nPrelude&gt;p $$ [2..3] $$ 4 $$ 5\n1\nPrelude&gt;p $$ [1]++[2..3] $$ 4 $$ 5 \ntons of error......\nPrelude&gt;p $$ [1]++[2..3] $$ [1]++[2..3] $$ 5\nof course, tons of error......\n</code></pre>\n\n<p>Question 1:\nWhy ($) not works on \"p $ 2 $ 2 $ 5\"?</p>\n\n<p>Question 2:\nWhy ($$)  works on \"p $$ 2 $$ 2 $$ 5\"?</p>\n\n<p>Question 3:\nWhy ($$) not works on \"p $$ [1]++[2..3] $$ 4 $$ 5\"?</p>\n\n<p>Question 4:\nIs there a more elegant way to write \"p $$ [1]++[2..3] $$ [1]++[2..3] $$ 5\" correctly?</p>\n"}, {"tags": ["haskell", "time", "haskell-stack"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1527795263, "post_id": 50630487, "comment_id": 88273069, "body": "You realize that you are always comparing the same day to itself, right? <code>date &gt;= currentTime</code> should always be true, because <code>currentTime</code> is really just proof that you can parse the user&#39;s input."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1527801400, "post_id": 50630487, "comment_id": 88276070, "body": "Why? Because capital <code>J</code> from the <code>Just</code> constructor of <code>Maybe</code> which is being displayed via <code>show</code> is lexicographically greater than the character <code>2</code> from <code>2018</code>.  In general you probably shouldn&#39;t compare dates via strings.  Instead of <code>Left InvalidDate</code> try printing the two strings you are comparing and see what&#39;s going on."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "edited": false, "score": 0, "creation_date": 1527793391, "post_id": 50630999, "comment_id": 88272212, "body": "I checked this code.  When I entered 2018-05-32 I got a date back.  But 32 days in a month does not exist and it turns out that the function of parsetTimeM does not work. And if I entered any text, then I get this text back."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "edited": false, "score": 1, "creation_date": 1527794606, "post_id": 50630999, "comment_id": 88272775, "body": "@AshotBes Could not reproduce. <code>parseTimeM True defaultTimeLocale &quot;%Y-%m-%d&quot; &quot;2018-05-32&quot; :: Maybe Day</code> produces <code>Nothing</code> here."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1527795445, "last_edit_date": 1527795445, "creation_date": 1527792880, "answer_id": 50630999, "question_id": 50630487, "link": "https://stackoverflow.com/questions/50630487/why-can-not-i-compare-the-date-that-i-received-from-the-function-parsetimem-with/50630999#50630999", "title": "Why can not I compare the date that I received from the function parseTimeM,with the sign &gt;=?", "body": "<p>Since <code>forecastDay</code> is a <code>Maybe Day</code> value, you want the string representation of the <code>Day</code> value wrapped inside it, not the string representation of the <code>Just</code> value. Lexicographically, any string starting with a number is going to be less than a string starting with <code>J</code>.</p>\n\n<p>One option is to use <code>maybe</code> to apply <code>show</code> <em>or</em> get a suitable default string value.</p>\n\n<pre><code>getDateFromUser :: IO (Either UserError Date)\ngetDateFromUser = do\nPrelude.putStrLn \"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0443\u043a\u0430\u0436\u0438\u0442\u0435 \u0434\u0430\u0442\u0443 \u0434\u043b\u044f \u043f\u0440\u043e\u0433\u043d\u043e\u0437\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \n\u0413\u0413\u0413\u0413-\u041c\u041c-\u0414\u0414:\"\ndate &lt;- Prelude.getLine\nlet forecastDay = parseTimeM True defaultTimeLocale \"%Y-%m-%d\" date :: Maybe Day\n\n    -- Instead of let currentTime = show forecastDay\n    let currentTime = maybe \"9999-99-99\" show forecastDay\n\n    if date &gt;= currentTime \n        then return $ Right (Data.Text.pack date)\n        else return $ Left InvalidDate\n</code></pre>\n\n<hr>\n\n<p>Given that <code>currentTime</code> should only equal <code>date</code> or <code>9999-99-99</code>, all you are doing is validating the user's input. You can do that simply with</p>\n\n<pre><code>date &lt;- Prelude.getLine\nreturn case parseTimeM True defaultTimeLocale \"%Y-%m-%d\" date :: Maybe Day of\n    Just x -&gt; Right (Data.Text.pack x)\n    Nothing -&gt; Left InvalidDate \n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1527795445, "creation_date": 1527790683, "question_id": 50630487, "link": "https://stackoverflow.com/questions/50630487/why-can-not-i-compare-the-date-that-i-received-from-the-function-parsetimem-with", "title": "Why can not I compare the date that I received from the function parseTimeM,with the sign &gt;=?", "body": "<pre><code>import           Data.Text\nimport           Data.Time         ( Day, UTCTime, getCurrentTime)\nimport           Data.Time.Clock\nimport           Data.Time.Calendar\nimport           Data.Time.Format    \n\ngetDateFromUser :: IO (Either UserError Date)\ngetDateFromUser = do\nPrelude.putStrLn \"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0443\u043a\u0430\u0436\u0438\u0442\u0435 \u0434\u0430\u0442\u0443 \u0434\u043b\u044f \u043f\u0440\u043e\u0433\u043d\u043e\u0437\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \n\u0413\u0413\u0413\u0413-\u041c\u041c-\u0414\u0414:\"\ndate &lt;- Prelude.getLine\nlet forecastDay = parseTimeM True defaultTimeLocale \"%Y-%m-%d\" date :: Maybe Day\n    let currentTime = show forecastDay\n    if date &gt;= currentTime \n        then return $ Right $ (Data.Text.pack date)\n        else return $ Left InvalidDate\n</code></pre>\n\n<p>start </p>\n\n<pre><code>~/Weather-report/Weather$ stack exec Weather-exe\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0443\u043a\u0430\u0436\u0438\u0442\u0435 \u0434\u0430\u0442\u0443 \u0434\u043b\u044f \u043f\u0440\u043e\u0433\u043d\u043e\u0437\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u0413\u0413\u0413\u0413-\u041c\u041c-\u0414\u0414:\n2018-05-31\nInvalidDate\n</code></pre>\n\n<p>But when I write like this:\n    date &lt;= currentTime ... </p>\n\n<pre><code>~/Weather-report/Weather$ stack exec Weather-exe\n2018-05-31\nJust \"2018-05-31\"\n2018-05-30\nJust \"2018-05-30\" and more \n</code></pre>\n\n<p>Question:  Why does not it work with >=\nWhy does not it work\nMaybe it's because of the function parseTimeM?\nCan this function work with dates from the past and from the future there is not?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1527790307, "post_id": 50630376, "comment_id": 88270671, "body": "Because <code>0</code> * any other number is <code>0</code>."}, {"owner": {"reputation": 2366, "user_id": 1153719, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/1e99b6d8a41fb3b299e6800c1ed510c2?s=128&d=identicon&r=PG", "display_name": "ARRG", "link": "https://stackoverflow.com/users/1153719/arrg"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527790635, "post_id": 50630376, "comment_id": 88270864, "body": "I guess that&#39;s a good point that if <code>fact 66</code> is 0 then everything upwards will be 0 as well. But is there a non-trivial reason why <code>fact 66</code> is zero? If I compute <code>toInteger((fact 65 :: Int)) * 66</code> I get a value that I don&#39;t understand why it would be 0 as an Int."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527790752, "post_id": 50630376, "comment_id": 88270916, "body": "wel this is due to the fact that <code>Int</code> has a fixed number of bits, and each time, the higher bits are ommited. At some point the value will be zero. Especially since frequently we multiply with a power of two, hence we &quot;shift&quot; the bits out of the lowest bits."}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 1, "creation_date": 1527796780, "post_id": 50630376, "comment_id": 88273851, "body": "Yep, there&#39;s a reason: the last 64 bits of <code>Numeric.showHex (product [1..66 :: Integer]) &quot;&quot; &quot;10b395943e6086f3f811b267cc58286d7c1eb06b9a4de25bacad2cd8d5d&zwnj;&#8203;c2b0000000000000000&quot;</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1527799774, "post_id": 50630376, "comment_id": 88275353, "body": "@ARRG It might be enlightening to compare <code>toInteger (fact 65 :: Int) * 66</code> and <code>(2^64) * 33 :: Integer</code>."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1527844832, "post_id": 50630376, "comment_id": 88290196, "body": "While it is true that fact (10 :: Int) will use 64 bit arithmetic, and this is faster than arbitrary precision Integer arithmetic, the difference is likely swamped by the overhead of making indirect calls to a multiply function. If you were doing this in a real program and this mattered then you would want to use the SPECIALIZE pragma to tell GHC to generate a version of fact hard-coded for Int. <a href=\"https://www.stackbuilders.com/tutorials/haskell/ghc-optimization-and-fusion/\" rel=\"nofollow noreferrer\">stackbuilders.com/tutorials/haskell/ghc-optimization-and-fus&zwnj;&#8203;ion</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1527796406, "post_id": 50630512, "comment_id": 88273641, "body": "Also expressible as: <code>sum [Data.Bits.countTrailingZeros n | n &lt;- [1 .. 66 :: Int]]</code>, which counts the powers of 2, at that point reaching 64."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 9, "last_activity_date": 1527790818, "creation_date": 1527790818, "answer_id": 50630512, "question_id": 50630376, "link": "https://stackoverflow.com/questions/50630376/int-overflow-coerced-to-0/50630512#50630512", "title": "Int overflow coerced to 0?", "body": "<p><code>Int</code> is a 64 bit integer (on your platform at least), so the results you're seeing are modulo 2^64 (and then interpreted as signed). <code>fact 66</code> is the first factorial that happens to be a multiple of <code>2^64</code>, therefore <code>fact 66 `mod` 2^64</code> is 0. Since every factorial is a multiple of the previous factorials, all larger factorials are also multiples of <code>2^64</code>.</p>\n\n<blockquote>\n  <p>Given a call to fact, is it correct that all recursive calls to fact will use the same type</p>\n</blockquote>\n\n<p>Yes, the type of <code>*</code> is <code>Num a =&gt; a -&gt; a -&gt; a</code>, so both operands of <code>*</code> must have the same type, which is also the type of its result. Therefore, in <code>n * fact (n-1)</code>, <code>fact (n-1)</code> must have the same type as <code>n</code> (and <code>n-1</code> which also has the same type as <code>n</code> because <code>-</code> has the same type as <code>*</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1527790913, "creation_date": 1527790913, "answer_id": 50630535, "question_id": 50630376, "link": "https://stackoverflow.com/questions/50630376/int-overflow-coerced-to-0/50630535#50630535", "title": "Int overflow coerced to 0?", "body": "<p>Answering question 2, there is only one way this type checks:</p>\n\n<pre><code>fact n = n * fact (n-1)\n</code></pre>\n\n<p>Specializing <code>fact</code> at <code>Int</code>, the recursive call must also be specialized at <code>Int</code>.</p>\n\n<pre><code>(fact :: Int -&gt; Int) n = n * (fact :: Int -&gt; Int) (n-1)\n</code></pre>\n\n<p>In other situations it may happen that a recursive call gets defaulted to <code>Integer</code>, but if you always compile with (at least) <code>-Wall</code>, defaulting triggers a warning.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1527839914, "last_edit_date": 1527839914, "creation_date": 1527792413, "answer_id": 50630882, "question_id": 50630376, "link": "https://stackoverflow.com/questions/50630376/int-overflow-coerced-to-0/50630882#50630882", "title": "Int overflow coerced to 0?", "body": "<blockquote>\n  <p>I get similar results up to <code>fact 65</code>. But starting at <code>fact 66</code> the function always returns <code>0</code>. How come?</p>\n</blockquote>\n\n<p>Well if <code>fact</code> for a given number produces <code>0</code>, then for every other <code>fact</code> with a larger index, the result will be <code>0</code> as well, since <code>n * 0</code> is still <code>0</code>. A type like <code>Int</code> has a fixed number of bits (for example 16 bits for <code>Int16</code>). In case we multiply two larger numbers, that produce a number with more than 16 bits, the higher bits are ignored. So For example:</p>\n\n<pre><code>  fact 7 |    5040 |   0001 0011 1011 0000\nx      8 |  x    8 | x                1000\n------------------------------------------\n  40 320 |  40 320 |   1001 1101 1000 0000\n------------------------------------------\n -25 216 | -25 216 |   1001 1101 1000 0000\n</code></pre>\n\n<p>here no values are shifted out of the <code>Int16</code>, but because of the signed interpretation, we get negative values. Later we multiply with <code>9</code>, and then get:</p>\n\n<pre><code>  fact 8 |  -25 216 |   1111 1111 1111 1111 1001 1101 1000 0000\nx      9 | x      9 | x                                    1001\n---------------------------------------------------------------\n  40 320 | -226 944 |   1111 1111 1111 1100 1000 1001 1000 0000\n---------------------------------------------------------------\n -30 336 |  -30 336 |                       1000 1001 1000 0000\n</code></pre>\n\n<p>So the CPU will perform the calculations in a larger register (for example 32 bits), and the take the lowest 16 bits of that result. Since every multiplication with an even number, will shift the values at least one position to the left, the set bits will eventually get shifted out of the integer representation with a fixed number of bits (although if we have more bits, this process will of course take longer).</p>\n\n<p>For a number with <em>n</em> bits, we reach zero in less than <em>2&times;n</em> steps (since each time the index is even, we shift it <em>at least</em> one position to the right).</p>\n\n<blockquote>\n  <p><strong>Q2:</strong> Given a call to fact, is it correct that all recursive calls to fact will use the same type, even when Int could've been substituted for Integer in some of the calls</p>\n</blockquote>\n\n<p>Types are <em>not</em> decided at run time (so \"<em>per call</em>\"), but at compile time. Haskell analyzes the function by first assuming it has a type <code>a -&gt; b</code> where <code>a</code> and <code>b</code> can be anything.</p>\n\n<p>Next it makes some analysis:</p>\n\n<pre><code>fact 0 = 1\n</code></pre>\n\n<p>means that the input type <code>a</code> and the output type <code>b</code> have to be of the <code>Num</code> typeclass. Furthermore we perform an <em>implicit</em> equality check (well Haskell will perform <code>(0 ==)</code> behind the curtains). So now we know that the type is:</p>\n\n<pre><code>fact :: (Num a, Num b, Eq a) =&gt; a -&gt; b\n</code></pre>\n\n<p>Now we can analyze the recursive call:</p>\n\n<pre><code>fact n = n * fact (n-1)\n</code></pre>\n\n<p>this is equivalent to:</p>\n\n<pre><code>-- equivalent to\nfact n = (*) n (fact (n-1))\n</code></pre>\n\n<p>Haskell does <em>not</em> assume that this recursive <code>fact</code> call has the same type. The recursive call thus has type <code>(Num c, Num d, Eq c) =&gt; c -&gt; d</code> so to speak.</p>\n\n<p>We however can analyze the function <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-42-\" rel=\"nofollow noreferrer\"><strong><code>(*) Num e =&gt; e -&gt; e -&gt; e</code></strong></a>. Note that in Haskell when we perform multiplication, the two operands and the result all have the same type. Since the first operand is <code>n</code>, we know that <code>e ~ a</code> and <code>e ~ d</code> (the result type of the recursive call), and <code>e ~ b</code> (the result of our outer <code>fact</code>). So we know that <code>e ~ a ~ b ~ d</code>. So that means that <code>a</code> and <code>b</code> are the same type, hence <code>fact</code> has type:</p>\n\n<pre><code>fact :: (Num a, Eq a) =&gt; a -&gt; a\n</code></pre>\n\n<p>and therefore we know that for the recursive call, <code>c ~ d ~ a</code>. Hence the recursive call also has type <code>fact :: (Num a, Eq a) =&gt; a -&gt; a</code> (recursive function call). So indeed, here the recursive call uses the same types.</p>\n"}], "owner": {"reputation": 2366, "user_id": 1153719, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/1e99b6d8a41fb3b299e6800c1ed510c2?s=128&d=identicon&r=PG", "display_name": "ARRG", "link": "https://stackoverflow.com/users/1153719/arrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "accepted_answer_id": 50630512, "answer_count": 3, "score": 1, "last_activity_date": 1527839914, "creation_date": 1527790235, "last_edit_date": 1527790437, "question_id": 50630376, "link": "https://stackoverflow.com/questions/50630376/int-overflow-coerced-to-0", "title": "Int overflow coerced to 0?", "body": "<p>If I write a recursive factorial like this : </p>\n\n<pre><code>fact 0 = 1\nfact n = n * (fact (n-1))\n</code></pre>\n\n<p>ghci tells me it has the type <code>(Eq p, Num p) =&gt; p -&gt; p</code>.</p>\n\n<p>I expect Haskell to be smart and enable this factorial implementation to be fast. So if I write : <code>fact (10 :: Int)</code> all of it is going to be fast math with <code>Int</code>s, if I write <code>fact (1000 :: Integer)</code>, all or some of the computation is going to be slow math with <code>Integer</code>s.</p>\n\n<p>ghci is helpful here : </p>\n\n<pre><code>\u03bb: :t fact (2 :: Int)\nfact (2 :: Int) :: Int\n\u03bb: :t fact (2 :: Integer)\nfact (2 :: Integer) :: Integer\n</code></pre>\n\n<p>I have two questions that come out of this : </p>\n\n<p>Q1 : What happens when I run  </p>\n\n<pre><code>\u03bb: fact (10 :: Int)\n&gt;3628800\n\u03bb: fact (40 :: Int)\n&gt;-7060926325325235253252...\n\u03bb: fact (66 :: Int)\n&gt;0\n</code></pre>\n\n<p>Obviously Haskell cannot compute the correct result for larger arguments as it will overflow. So I'm not surprised at the result for <code>fact 40</code>, I get similar results up to <code>fact 65</code>. But starting at <code>fact 66</code> the function always returns 0. How come?</p>\n\n<p>Q2 : Given a call to <code>fact</code>, is it correct that all recursive calls to fact will use the same type, even when Int could've been substituted for Integer in some of the calls (i.e. the whole computation is slower than it could be if the compiler was able to decide at runtime between Int and Integer on a per-call basis).</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1527802197, "post_id": 50630036, "comment_id": 88276368, "body": "Smallcheck does boldly include an orphan <code>instance (Serial Identity a, Show a, Show b) =&gt; Show (a -&gt; b)</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1527788909, "creation_date": 1527788909, "answer_id": 50630036, "question_id": 50629967, "link": "https://stackoverflow.com/questions/50629967/is-it-possible-to-generate-arbitrary-functions-in-quickcheck/50630036#50630036", "title": "Is it possible to generate arbitrary functions in QuickCheck", "body": "<p><code>Arbitrary</code> can generate functions just fine (provided the arguments are instances of <a href=\"https://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck-Arbitrary.html#t:CoArbitrary\" rel=\"nofollow noreferrer\"><code>CoArbitrary</code></a>), it's just the showing part that doesn't work. There's not really a good way to show a function.</p>\n\n<p>This is a common problem, and therefore QuickCheck provides the <a href=\"https://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck-Modifiers.html#t:Blind\" rel=\"nofollow noreferrer\"><code>Blind</code></a> modifier. It basically fakes a <code>Show</code> instances for any type, not actually showing any information about the value. Of course this somewhat diminishes the debugging-usefulness of a failing test case, but there's not much that can done about this.</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1527803977, "creation_date": 1527803977, "answer_id": 50633386, "question_id": 50629967, "link": "https://stackoverflow.com/questions/50629967/is-it-possible-to-generate-arbitrary-functions-in-quickcheck/50633386#50633386", "title": "Is it possible to generate arbitrary functions in QuickCheck", "body": "<p>QuickCheck has support to generate, shrink and show functions, using the <code>Fun</code> type. <code>CoArbitrary</code> enables generation of functions. It is then converted to a (possibly infinite) trie-like structure, that can be inspected and shrunk to a finite value (because a test failure only depends on finitely many inputs), which can then be shown as a counterexample.</p>\n\n<p>Concretely, you can write properties as function that take a <code>Fun</code> argument, which is a wrapper around <code>(-&gt;)</code> using the mechanism I described. Deconstruct it with the <code>Fn</code> pattern to get a function.</p>\n\n<pre><code>prop_dollarDoesNothing :: Property\nprop_dollarDoesNothing = property $ \\(Fn (f :: Int -&gt; Int)) x -&gt;\n  (f $ x) === f x\n</code></pre>\n\n<p>For more information</p>\n\n<ul>\n<li><p>The QuickCheck implementation: <a href=\"https://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck-Function.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck-Function.html</a></p></li>\n<li><p>The paper \"Shrinking and showing functions\" by Koen Claessen, which appears to be paywalled, but his talk is online: <a href=\"https://www.youtube.com/watch?v=CH8UQJiv9Q4\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=CH8UQJiv9Q4</a></p></li>\n</ul>\n"}], "owner": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 869, "favorite_count": 0, "accepted_answer_id": 50633386, "answer_count": 2, "score": 1, "last_activity_date": 1527803977, "creation_date": 1527788595, "question_id": 50629967, "link": "https://stackoverflow.com/questions/50629967/is-it-possible-to-generate-arbitrary-functions-in-quickcheck", "title": "Is it possible to generate arbitrary functions in QuickCheck", "body": "<p>I was trying to write a QuickCheck test for the identity </p>\n\n<pre><code>f $ y = f y\n</code></pre>\n\n<p>My initial plan was to write an arbitrary generator that returns functions &amp; Integer, having the signature <code>Gen (Int -&gt; Int, Int)</code></p>\n\n<p>and in the <code>prop_DollerDoesNothing</code> test that function application with / without the <code>$</code> gives the same result.</p>\n\n<p>This was my code:</p>\n\n<pre><code>  prop_DollarDoesNothing :: Property\n  prop_DollarDoesNothing =\n    forAll arbitraryFuncInt (\\(f, y) -&gt; (f $ y) == (f y))\n\n  arbitraryFuncInt :: Gen (Int -&gt; Int, Int)\n  arbitraryFuncInt = do\n    f &lt;- elements [(\\x -&gt; x*2), (\\x -&gt; x+3), (\\x -&gt; x-2)]\n    y &lt;- arbitrary :: Gen Int\n    return (f, y)\n</code></pre>\n\n<p>And it generated the following helpful error message:</p>\n\n<pre><code>    * No instance for (Show (Int -&gt; Int))\n        arising from a use of `forAll'\n        (maybe you haven't applied a function to enough arguments?)\n    * In the expression:\n        forAll arbitraryFuncInt (\\ (f, y) -&gt; (f $ y) == (f y))\n      In an equation for `prop_DollarDoesNothing':\n          prop_DollarDoesNothing\n            = forAll arbitraryFuncInt (\\ (f, y) -&gt; (f $ y) == (f y))\n</code></pre>\n\n<p>So, I fixed the error and got the test working by applying the arbitrary function and returning a pair of ints from <code>arbitraryFuncInt</code></p>\n\n<pre><code>  prop_DollarDoesNothing :: Property\n  prop_DollarDoesNothing =\n    forAll arbitraryFuncInt (\\(x, y) -&gt; x == y)\n\n  arbitraryFuncInt :: Gen (Int, Int)\n  arbitraryFuncInt = do\n    f &lt;- elements [(\\x -&gt; x*2), (\\x -&gt; x+3), (\\x -&gt; x-2)]\n    y &lt;- arbitrary :: Gen Int\n    return (f $ y, f y)\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li>is it simply not possible to return arbitrary functions that aren't fully applied due to not having an instance for <code>Show</code>?</li>\n<li>Can I write an instance for <code>Show (Int -&gt; Int)</code> to make <code># 1</code> possible?</li>\n<li>Can QuickCheck generate arbitrary functions given a type signature, for cases where I'm testing identities that are true for all functions (of a given type). Above, I specify the 3 test functions by hand, I'd like to automate that somehow, ideally something like this <code>f &lt;- arbitrary :: Gen (Int -&gt; Int)</code></li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1527786359, "post_id": 50629382, "comment_id": 88268802, "body": "Can you explain why you think the answer should be <code>either Cell Block</code>, and why you think this has to be the signature, instead of <code>Eq a =&gt; a -&gt; QTree a -&gt; Bool</code>?"}, {"owner": {"reputation": 21, "user_id": 5589734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa67d16978b0b28571fbf61b27073743?s=128&d=identicon&r=PG&f=1", "display_name": "wvstealth", "link": "https://stackoverflow.com/users/5589734/wvstealth"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527786692, "post_id": 50629382, "comment_id": 88268960, "body": "In a earlier question it was necessary to also define the in and out of another type, which was Blockchain=Bc{bc::Block}|Bcs{bcs::(Block,Blockchain)}  and in this one the inBlockChain=either Bc Bcs"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1527786958, "post_id": 50629382, "comment_id": 88269068, "body": "Well this <i>strange</i> as well, you seem to define some sort of &quot;constructor&quot;."}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 0, "creation_date": 1527826400, "post_id": 50629382, "comment_id": 88281854, "body": "&gt;&gt; But Haskell naturally complains that both Cell and Block are not being applied to enough arguments. &lt;&lt; Sure, because <code>either :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c</code>, and if you want <code>Cell</code> to be the first argument of <code>either</code> to produce your current <code>inQTree</code> type, <code>Cell</code> should be of type <code>(a, (Int, Int)) -&gt; QTree a</code>, but <code>Cell</code> is actually <code>a -&gt; Int -&gt; Int -&gt; QTree a</code>."}, {"owner": {"reputation": 21, "user_id": 5589734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa67d16978b0b28571fbf61b27073743?s=128&d=identicon&r=PG&f=1", "display_name": "wvstealth", "link": "https://stackoverflow.com/users/5589734/wvstealth"}, "reply_to_user": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 0, "creation_date": 1527862889, "post_id": 50629382, "comment_id": 88301490, "body": "@SnowOnion for the purposes of this exercise we are not allowed to change any predefined types, so sadly Cell must remain <code>a-&gt;Int-&gt;Int-&gt;QTree a</code>"}, {"owner": {"reputation": 21, "user_id": 5589734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa67d16978b0b28571fbf61b27073743?s=128&d=identicon&r=PG&f=1", "display_name": "wvstealth", "link": "https://stackoverflow.com/users/5589734/wvstealth"}, "edited": false, "score": 0, "creation_date": 1527863780, "post_id": 50629382, "comment_id": 88302070, "body": "I think i figured it out by defining 2 more functions  <code>inBlock (a,(b,(c,d)))=Block a b c d inCell (a,(b,c))=Cell a b c</code> and <code>inQTree= either inCell inBlock</code>"}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 0, "creation_date": 1527924351, "post_id": 50629382, "comment_id": 88319229, "body": "@wvstealth Ok. Just curious: Are you forced to use <code>either</code> in the answer? Otherwise you may pattern-match <code>Left</code> and <code>Right</code> cases respectively."}, {"owner": {"reputation": 21, "user_id": 5589734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa67d16978b0b28571fbf61b27073743?s=128&d=identicon&r=PG&f=1", "display_name": "wvstealth", "link": "https://stackoverflow.com/users/5589734/wvstealth"}, "reply_to_user": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 0, "creation_date": 1527947855, "post_id": 50629382, "comment_id": 88325264, "body": "@SnowOnion About 80% sure, at least as far as the inQTree is concerned, outQTree i had to use left and right for the answer."}], "owner": {"reputation": 21, "user_id": 5589734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa67d16978b0b28571fbf61b27073743?s=128&d=identicon&r=PG&f=1", "display_name": "wvstealth", "link": "https://stackoverflow.com/users/5589734/wvstealth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527786315, "creation_date": 1527786191, "last_edit_date": 1527786315, "question_id": 50629382, "link": "https://stackoverflow.com/questions/50629382/how-to-define-inqtree", "title": "How to define inQTree", "body": "<p>I'm currently doing a project where one of the objectives is to define the in and out of a QTree.<br>\nThe datatype QTree is defined as    </p>\n\n<pre><code>data QTree a=Cell a Int Int | Block (Qtree a) (Qtree a) (Qtree a) (Qtree a)\n</code></pre>\n\n<p>I was able to define outQTree however with inQTree I've had no such luck.  </p>\n\n<pre><code>inQTree :: Either (a, (Int, Int)) (QTree a, (QTree a, (QTree a, QTree a))) -&gt; QTree a\n</code></pre>\n\n<p>Predefined inQTree type.  </p>\n\n<p>The answer as far as I'm aware should look something like:  </p>\n\n<pre><code> inQTree=either Cell Block\n</code></pre>\n\n<p>But Haskell naturally complains that both Cell and Block are not being applied to enough arguments.<br>\nAny ideas on how to get it working?</p>\n"}, {"tags": ["json", "haskell", "aeson", "servant"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1527755056, "post_id": 50615514, "comment_id": 88249343, "body": "I believe <a href=\"https://stackoverflow.com/questions/41753516/custom-json-errors-for-servant-server\">this</a> might be related."}], "answers": [{"comments": [{"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1527775254, "post_id": 50626029, "comment_id": 88262285, "body": "The &quot;Error in $&quot; part of the error message comes from within the Parser in Aeson. No idea of how difficult it would be to replace."}, {"owner": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "edited": false, "score": 0, "creation_date": 1527790611, "post_id": 50626029, "comment_id": 88270851, "body": "Oh duh--in retrospect, obvious. I ended up using your solution in concert with the middleware solution from <a href=\"https://stackoverflow.com/questions/41753516/custom-json-errors-for-servant-server\">here</a> to remove the &quot;Error in $:&quot; and also embed the error in a JSON object. Thanks for the help!"}], "tags": [], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "is_accepted": true, "score": 2, "last_activity_date": 1527774965, "creation_date": 1527774965, "answer_id": 50626029, "question_id": 50615514, "link": "https://stackoverflow.com/questions/50615514/haskell-servant-custom-json-parsing-errors/50626029#50626029", "title": "Haskell Servant Custom JSON parsing errors", "body": "<p>Writing the FromJSON instance by hand solves at least half of your problem.</p>\n\n<pre><code>instance FromJSON Spec where\n  parseJSON (Object o) = do\n    schema &lt;- o .: \"schema\"\n    case schema of\n      (Object s) -&gt; pure $ Spec s\n      (String s) -&gt; fail $ \"Expected a JSON Object under the key \\\"schema\\\", but got the String \\\"\" ++ unpack s ++ \"\\\"\\n\"\n      _          -&gt; fail $ \"Expected a JSON Object under the key \\\"schema\\\", but got the other type\"\n  parseJSON wat = typeMismatch \"Spec\" wat\n</code></pre>\n\n<p>Your curl command then returns:</p>\n\n<pre><code>Error in $: Expected a JSON Object under the key \"schema\", but got the String \"I am not an object but I should be!\"\n</code></pre>\n\n<p>You can obviously check for the different <code>Value</code> type constructors from Aeson and factor it into a separate function.</p>\n\n<p>Got the code from looking at the implementation of <a href=\"http://hackage.haskell.org/package/aeson-1.3.1.1/docs/Data-Aeson-Types.html#v:typeMismatch\" rel=\"nofollow noreferrer\">Data.Aeson.Types.typeMismatch</a></p>\n"}], "owner": {"reputation": 85, "user_id": 4651145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYGN6.jpg?s=128&g=1", "display_name": "m-arnold", "link": "https://stackoverflow.com/users/4651145/m-arnold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 610, "favorite_count": 0, "accepted_answer_id": 50626029, "answer_count": 1, "score": 3, "last_activity_date": 1527774965, "creation_date": 1527731184, "question_id": 50615514, "link": "https://stackoverflow.com/questions/50615514/haskell-servant-custom-json-parsing-errors", "title": "Haskell Servant Custom JSON parsing errors", "body": "<p>Given the following Servant server:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule ServantSample (main) where\n\nimport Data.Aeson\nimport Data.Aeson.TH\nimport Network.Wai\nimport Network.Wai.Handler.Warp\nimport Servant\n\ndata Spec = Spec\n  { schema :: Object\n  } deriving (Eq, Show)\n$(deriveJSON defaultOptions ''Spec)\n\ntype Api = ReqBody '[JSON] Spec :&gt; Post '[JSON] NoContent\n\nserver :: Server Api\nserver = postDoc\n\npostDoc :: Spec -&gt; Handler NoContent\npostDoc _ = return NoContent\n\napi :: Proxy Api\napi = Proxy\n\napp :: Application\napp = serve api server\n\nmain :: IO ()\nmain = run 8080 app\n</code></pre>\n\n<p>...and the following curl to a running instance of the above server:</p>\n\n<pre><code>curl localhost:8080 -H 'Content-Type: application/json' --data '{\"schema\": \"I am not an object but I should be!\"}'\n</code></pre>\n\n<p>I get back:</p>\n\n<pre><code>Error in $.schema: expected HashMap ~Text v, encountered String\n</code></pre>\n\n<p>Is there a way to intercept the Aeson error and replace it with something that doesn't leak implementation details to the client? As far as I can tell, this all happens behind the scenes in Servant's machinery, and I can't find any documentation about how to hook into it. </p>\n\n<p>For instance, I'd love to return something like:</p>\n\n<pre><code>Expected a JSON Object under the key \"schema\", but got the String \"I am not an object but I should be!\"\n</code></pre>\n\n<p>Thanks!</p>\n"}]