[{"tags": ["haskell", "memory-leaks", "list-comprehension", "monads", "lazy-evaluation"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459377652, "post_id": 36320858, "comment_id": 60265304, "body": "Yes, this code looks fishy. What&#39;s <code>permute</code> supposed to do, exactly?"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459378583, "post_id": 36320858, "comment_id": 60265628, "body": "A list of all possible length-n sequences chosen from elements of <code>xs&#39;</code>. For example, <code>permute &quot;123&quot; 2</code> should give <code>[&quot;11&quot;,&quot;12&quot;,&quot;13&quot;,&quot;21&quot;,&quot;22&quot;,&quot;23&quot;,&quot;31&quot;,&quot;32&quot;,&quot;33&quot;]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1459386233, "post_id": 36321963, "comment_id": 60267940, "body": "Oh wow, it actually evaluates... But why does order matter? I don&#39;t quite understand this point"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1459386708, "post_id": 36321963, "comment_id": 60268053, "body": "I think the expansion is <code>permute xs&#39; (n-1) &gt;&gt;= \\xs-&gt;(xs&#39;&gt;&gt;=\\x-&gt;(x:xs))</code>, then the recursive call is done first... but why doesn&#39;t this one blow up the memory?"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1459386764, "post_id": 36321963, "comment_id": 60268073, "body": "BTW, I don&#39;t really find a mathematical name for this operation, so... words from alphabet, maybe?"}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": false, "score": 2, "last_activity_date": 1459382828, "creation_date": 1459382828, "answer_id": 36321963, "question_id": 36320858, "link": "https://stackoverflow.com/questions/36320858/haskell-list-comprehension-and-space-leak/36321963#36321963", "title": "Haskell List Comprehension and space leak", "body": "<p>This code is a little bit weird because <code>permute</code> doesn't actually.. well.. permute things but assuming that it's what you intended it actually performs in much the same way as your <code>[0..] !! 10000</code> example, it's just that computing the 10000th selection is a lot more work in your code!</p>\n\n<p>The important thing is that your code <em>is</em> lazy, we can easily compute the 1st element of <code>permute [0..] 10</code> even though there are clearly infinitely many of them. </p>\n\n<p>What you might be thinking of though is that when you actually run this it takes a really long time to produce <em>any</em> output even if you might hope that it would produce the 1st character... wait a bit.. produce the second character.. wait a bit.. and so on. This is not really a \"leak\" in the Haskell sense and cannot be avoided in this scenario. Youre list is essentially constructed with</p>\n\n<pre><code>map ('0':) (permute chars (n - 1)) ++ ... ++ map ('9':) (permute chars (n - 1))\n</code></pre>\n\n<p>The issue is that in order to know the first character, you need to figure out which \"block\" you'll be selecting from, which involves computing the length of the block, which involves evaluating <code>permute chars (n - 1)</code> fully. So what'll happen is you'll force each recursive call in turn until you have enough elements in the resulting list to evaluate the call to <code>!!</code>. This is not unexpected though. You can however significantly speed up this code with one fairly simple trick: reverse the <code>x</code> and <code>xs</code> in the list comprehension.</p>\n\n<pre><code>permute :: [a] -&gt; Integer -&gt; [[a]]\npermute _ 0 = [[]]\npermute xs' n = [x:xs | xs &lt;- permute xs' (n-1), x &lt;- xs']\n</code></pre>\n\n<p>Do note that the increased sharing could in theory lead to increased memory usage (something may not be GCed as soon in this version) but I'm unable to come up with a not-absurdly-contrived program which does this.</p>\n"}], "owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1459382828, "creation_date": 1459376834, "question_id": 36320858, "link": "https://stackoverflow.com/questions/36320858/haskell-list-comprehension-and-space-leak", "title": "Haskell List Comprehension and space leak", "body": "<p>I am trying to figure out how recursion combined with List Comprehension/Monadic operations cause space leaks.</p>\n\n<p>I have a small test program:</p>\n\n<pre><code>module Main where\npermute :: [a] -&gt; Integer -&gt; [[a]]\npermute _ 0 = [[]]\npermute xs' n = [x:xs | x &lt;- xs', xs &lt;- permute xs' (n-1)]\nchars1 = ['0'..'9']\nmain = do\n  putStrLn $ (permute chars1 10000)!!100000000 -- Leaks\n  print $ [1..]!!100000000 -- Does not leak\n</code></pre>\n\n<p>Now, my understanding is that the function <code>permute</code> can be expanded as</p>\n\n<pre><code>xs' &gt;&gt;= \\x -&gt; (permute xs' (n-1) &gt;&gt;= \\xs -&gt; (x:xs))\n</code></pre>\n\n<p>So lots of <code>(permute xs' n)</code> will be stacked before a result can be retrieved. Am I understanding correctly? If so, what can I do to make sure the function does not leak?</p>\n"}, {"tags": ["haskell", "data-kinds", "pattern-synonyms"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1459377547, "post_id": 36320811, "comment_id": 60265264, "body": "I think you at least need a pattern signature, but the documentation doesn&#39;t seem to make it very clear whether it&#39;s possible to make the type of a pattern synonym for a GADT constructor as polymorphic as the constructor itself."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 7, "last_activity_date": 1459378593, "last_edit_date": 1495541260, "creation_date": 1459377867, "answer_id": 36321053, "question_id": 36320811, "link": "https://stackoverflow.com/questions/36320811/pattern-synonym-cant-unify-types-within-type-level-list/36321053#36321053", "title": "Pattern synonym can&#39;t unify types within type-level list", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/questions/36320811/pattern-synonym-cant-unify-types-within-type-level-list#comment60265264_36320811\">dfeuer's comment</a> and <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8968\" rel=\"nofollow noreferrer\">this ticket</a>, I was able to get my example code to compile by adding a type signature to the pattern definition:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE PatternSynonyms #-}\nmodule Example where\n\ndata L (as :: [*]) where\n  L :: a -&gt; L '[a]\n\npattern LUnit :: L '[()]\npattern LUnit = L ()\n</code></pre>\n\n<p>Which also generalizes nicely to polymorphic patterns</p>\n\n<pre><code>data F (fs :: [* -&gt; *]) a where\n  F :: f a -&gt; F '[f] a\n\npattern FId :: a -&gt; F '[Identity] a\npattern FId a = F (Identity a)\n</code></pre>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 36321053, "answer_count": 1, "score": 8, "last_activity_date": 1459378593, "creation_date": 1459376652, "question_id": 36320811, "link": "https://stackoverflow.com/questions/36320811/pattern-synonym-cant-unify-types-within-type-level-list", "title": "Pattern synonym can&#39;t unify types within type-level list", "body": "<p>I'm getting an error when trying to define a pattern synonym based\non a GADT that has a type-level list.</p>\n\n<p>I managed to boil it down to this example:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE PatternSynonyms #-}\nmodule Example where\n\ndata L (as :: [*]) where\n  L :: a -&gt; L '[a]\n\npattern LUnit = L ()\n</code></pre>\n\n<p>Gives me:</p>\n\n<pre><code>Example.hs:11:17:\n    Couldn't match type \u2018a\u2019 with \u2018()\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for Example.$bLUnit :: (t ~ '[a]) =&gt; L t\n          at Example.hs:11:17\n    Expected type: L t\n      Actual type: L '[()]\n    In the expression: L ()\n    In an equation for \u2018$bLUnit\u2019: $bLUnit = L ()\n\nExample.hs:11:19:\n    Could not deduce (a ~ ())\n    from the context (t ~ '[a])\n      bound by a pattern with constructor\n                 L :: forall a. a -&gt; L '[a],\n               in a pattern synonym declaration\n      at Example.hs:11:17-20\n      \u2018a\u2019 is a rigid type variable bound by\n          a pattern with constructor\n            L :: forall a. a -&gt; L '[a],\n          in a pattern synonym declaration\n          at Example.hs:11:17\n    In the pattern: ()\n    In the pattern: L ()\n</code></pre>\n\n<p>Is this a bug, or am I doing something wrong?</p>\n"}, {"tags": ["macos", "haskell", "ghc"], "comments": [{"owner": {"reputation": 3931, "user_id": 382745, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/8794fd98ad2e727eb3f79ad29cfc033a?s=128&d=identicon&r=PG", "display_name": "angerman", "link": "https://stackoverflow.com/users/382745/angerman"}, "edited": false, "score": 2, "creation_date": 1459388484, "post_id": 36320055, "comment_id": 60268457, "body": "This is a bit orthogonal to the question, but why not give stack (<a href=\"http://docs.haskellstack.org\" rel=\"nofollow noreferrer\">docs.haskellstack.org</a>) a try?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459405344, "post_id": 36320055, "comment_id": 60273841, "body": "I agree with angerman - while the Platform did solve real problems in the past it sometimes create many more - just go with stack or <a href=\"https://ghcformacosx.github.io/\" rel=\"nofollow noreferrer\">Haskell for Mac</a>"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1459671718, "creation_date": 1459671718, "answer_id": 36383153, "question_id": 36320055, "link": "https://stackoverflow.com/questions/36320055/haskell-install-mac-failed/36383153#36383153", "title": "Haskell Install Mac Failed", "body": "<p>It does no harm to leave the older versions around.</p>\n\n<p>The missing bundle stuff looks like it may have to do with new mac security features by the way.</p>\n\n<p>To find out what the commands to run by hand are, you can run <code>uninstall-hs only VERSION --script</code> and that may work.</p>\n"}], "owner": {"reputation": 39, "user_id": 6048440, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/43b99784b7b48ffbb5159451ac9c5f78?s=128&d=identicon&r=PG&f=1", "display_name": "mk4280", "link": "https://stackoverflow.com/users/6048440/mk4280"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 232, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1459671718, "creation_date": 1459373235, "last_edit_date": 1459374228, "question_id": 36320055, "link": "https://stackoverflow.com/questions/36320055/haskell-install-mac-failed", "title": "Haskell Install Mac Failed", "body": "<p>This is my first time downloading the <code>Haskell Platform</code> on my <code>Mac OS X 10.8.5</code></p>\n\n<p>I downloaded the <code>Haskell Platform</code> for <code>Mac OS X is 7.10.3</code> I ran it, but it says: </p>\n\n<blockquote>\n  <p>There are older versions of GHC and/or Haskell Platform on this\n  system. Run the command line tool uninstall-hs to find out which and\n  how to remove them.</p>\n</blockquote>\n\n<p>So I did <code>uninstall-hs</code>, but it says: </p>\n\n<blockquote>\n  <p>Failed. Reason: EroorMissingBundle.</p>\n</blockquote>\n\n<p>I've also tried</p>\n\n<pre><code>sudo rm -rf /Library/Frameworks/GHC.framework\nsudo rm -rf /Library/Frameworks/HaskellPlatform.framework\nsudo rm -rf /Library/Haskell\nrm -rf ~/.cabal\nrm -rf ~/.ghc\nrm -rf ~/Library/Haskell\nfind /usr/bin /usr/local/bin -type l | \\\n  xargs -If sh -c '/bin/echo -n f /; readlink f' | \\\n  egrep '//Library/(Haskell|Frameworks/(GHC|HaskellPlatform).framework)' | \\\n  cut -f 1 -d ' ' &gt; /tmp/hs-bin-links\nsudo rm -f `cat /tmp/hs-bin-links`\n</code></pre>\n\n<p>But I am still getting the same results.</p>\n\n<p>Any suggestions? </p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 8, "creation_date": 1459369563, "post_id": 36318561, "comment_id": 60261377, "body": "Detailed profiling doesn&#39;t turn off optimization, but each interferes with the other. RTS flags never affect optimization directly because they are passed to a program after it&#39;s been compiled."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459671858, "post_id": 36318561, "comment_id": 60383343, "body": "@dfeuer you should post that as the answer :-)"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459792182, "post_id": 36318561, "comment_id": 60434876, "body": "@dfeuer indeed. I&#39;ll accept once you post it."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1459794813, "creation_date": 1459794813, "answer_id": 36410239, "question_id": 36318561, "link": "https://stackoverflow.com/questions/36318561/does-rts-t-flag-disable-ghc-optimization/36410239#36410239", "title": "Does RTS -T flag disable GHC optimization", "body": "<p>Detailed profiling doesn't turn off optimization, but each interferes with the other. Notably, inlining wreaks havoc on cost-center profiling, since the cost of inlined functions is assigned to their called. </p>\n\n<p>RTS flags never affect optimization directly because they are passed to a program after it's been compiled. Of course RTS flags can and often do affect <em>performance</em> by changing the behavior of the garbage collector, collecting information about the program for profiling, etc.</p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 36410239, "answer_count": 1, "score": 2, "last_activity_date": 1459794813, "creation_date": 1459367943, "question_id": 36318561, "link": "https://stackoverflow.com/questions/36318561/does-rts-t-flag-disable-ghc-optimization", "title": "Does RTS -T flag disable GHC optimization", "body": "<p>It's known that profiling will turn off any optimization by GHC. Does that also happen when using RTS -T flag to obtain GC stats?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1459366297, "post_id": 36317847, "comment_id": 60259483, "body": "typo? <code>(1, 2) with (3, 1)</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1459366537, "post_id": 36317847, "comment_id": 60259660, "body": "First write <code>isPairDuplicate :: (Int,Int) -&gt; (Int, Int) -&gt; Bool</code> (then post it in your question so we know what you&#39;re talking about)."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1459366698, "post_id": 36317847, "comment_id": 60259761, "body": "Then I would suggest thinking about writing a recursive solution which uses pattern matching on lists, and maybe <code>filter</code> if you&#39;re feeling crazy."}], "answers": [{"comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1459367774, "post_id": 36317958, "comment_id": 60260366, "body": "however, better to solve the problem at the source within list comprehension.  I answered the question based on the title and first paragraph description."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 4, "last_activity_date": 1459366108, "creation_date": 1459366108, "answer_id": 36317958, "question_id": 36317847, "link": "https://stackoverflow.com/questions/36317847/remove-pair-duplicates-haskell/36317958#36317958", "title": "Remove pair duplicates Haskell", "body": "<pre><code>import Data.List(nubBy)\nimport Data.Tuple(swap)\n\nnubBy (\\x y -&gt; x==y || swap x == y) [(1, 2), (1, 3), (1, 4), (2, 1), (3, 1), (4, 1)]\n[(1,2),(1,3),(1,4)]\n</code></pre>\n\n<p>or write your own versions </p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1459368449, "post_id": 36318229, "comment_id": 60260739, "body": "Here&#39;s one that doesn&#39;t require an <code>Ord</code> instance on elements and doesn&#39;t do extra work by producing wrong elements and then removing them: <code>fn xs = [(a, b) | a:xs&#39; &lt;- tails xs, b &lt;- xs&#39;]</code>. I&#39;ve used this standard trick or a slight variant of it quite a few times in real code. Of course it has the same problem yours does: if the input list has duplicates, the output will, too."}], "tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": false, "score": 8, "last_activity_date": 1459366904, "creation_date": 1459366904, "answer_id": 36318229, "question_id": 36317847, "link": "https://stackoverflow.com/questions/36317847/remove-pair-duplicates-haskell/36318229#36318229", "title": "Remove pair duplicates Haskell", "body": "<p>This is a perfect time to use <a href=\"http://www.haskell.org/hoogle\">Hoogle</a>! Let's think about what you're looking for. To remove duplicates, we want something that takes a list <code>[a]</code> and removes things from it, returning <code>[a]</code> based on some predicate <code>a -&gt; a -&gt; Bool</code>. This means we're looking for a function with the following form:</p>\n\n<pre><code>ourFunction :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>We can actually search <a href=\"http://www.haskell.org/hoogle\">Hoogle</a> using the function signature, <code>(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]</code>, and the first result is <code>nubBy</code>, which does exactly what we want!</p>\n\n<p>That being said, you don't need to use this to fix your problem. You're already on the right track. Think about what you're asking -- you want no duplicate tuples where <code>(x, y) == (y, x)</code>. So just choose whether or not you want <code>y &lt; x</code> or the other way around, and use this in your list comprehension:</p>\n\n<pre><code>&gt; let fn xs = [(a, b) | a &lt;- xs, b &lt;- xs, a &lt; b]\n&gt; fn [1, 2, 3]\n[(1,2),(1,3),(2,3)]\n</code></pre>\n\n<p>If you need both lists (one with duplicates and one without) I'd suggest using two separate list comprehensions. It is less performant, as the list comprehension as you have it written is O(n^2), but it's much cleaner and easier to learn from, in my opinion.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8581245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2788ae626f4bc74103e1814b538884c2?s=128&d=identicon&r=PG&f=1", "display_name": "Tyson Z", "link": "https://stackoverflow.com/users/8581245/tyson-z"}, "is_accepted": false, "score": 0, "last_activity_date": 1555395604, "creation_date": 1555395604, "answer_id": 55701735, "question_id": 36317847, "link": "https://stackoverflow.com/questions/36317847/remove-pair-duplicates-haskell/55701735#55701735", "title": "Remove pair duplicates Haskell", "body": "<p>It is not answering the questions directly, but there is a simpler solution that applies to this case (numerical tuples), just to add one more filter when generating the list to make sure the latter element is always larger than the previous element.</p>\n\n<pre><code>MyList = [(x, y)| x &lt;- integerList, y &lt;- integerList, x /= y, x &lt; y]\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 5958431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/773746a2f291713f39265c9980d6c30f?s=128&d=identicon&r=PG&f=1", "display_name": "itma96", "link": "https://stackoverflow.com/users/5958431/itma96"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 746, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1555395604, "creation_date": 1459365702, "question_id": 36317847, "link": "https://stackoverflow.com/questions/36317847/remove-pair-duplicates-haskell", "title": "Remove pair duplicates Haskell", "body": "<p>Giving a list of pairs, for example</p>\n\n<pre><code>[(1, 2), (1, 3), (1, 4), (2, 1), (3, 1), (4, 1)]\n</code></pre>\n\n<p>So, I am trying to remove the pair duplicates, I consider a pair to be duplicate if (x, y) == (y, x), for example: (1, 2) with (3, 1)</p>\n\n<p>I am generating the list with a comprehension list, it is derived from one single list</p>\n\n<pre><code>MyList = [(intA, intB) | x &lt;- integerList, y &lt;- integerList, x /= y]\nintegerList = [1, 2, 3];\n</code></pre>\n\n<p>Please note that the first thing I wrote is just an example of what I want to happen and it is not the output of the comprehension list above.</p>\n\n<p>I recently started using Haskell, how would I approach the problem? What would be the best choice? I tried using map, but without success, should I combine a map with a foldl / foldr that uses reverse inside it? How would I do that?</p>\n"}, {"tags": ["haskell", "compilation"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1459366839, "post_id": 36317569, "comment_id": 60259829, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/1534224/return-specific-type-within-haskell\">Return specific type within Haskell</a>"}], "answers": [{"comments": [{"owner": {"reputation": 548, "user_id": 4547068, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/651f7915c52ada9f3b616430481ec37f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Roca Lopez", "link": "https://stackoverflow.com/users/4547068/daniel-roca-lopez"}, "edited": false, "score": 0, "creation_date": 1459365742, "post_id": 36317687, "comment_id": 60259101, "body": "The problem is the return wont be always a numericExpr but it could also be booleanExpr (which is string)"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 548, "user_id": 4547068, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/651f7915c52ada9f3b616430481ec37f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Roca Lopez", "link": "https://stackoverflow.com/users/4547068/daniel-roca-lopez"}, "edited": false, "score": 1, "creation_date": 1459365979, "post_id": 36317687, "comment_id": 60259263, "body": "@DanielRocaLopez Then you need a type <code>data Expr = Num NumericExpr | Bool BolleanExpr</code>. Or better yet, don&#39;t have separate numeric and boolean expression types in the first place."}, {"owner": {"reputation": 548, "user_id": 4547068, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/651f7915c52ada9f3b616430481ec37f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Roca Lopez", "link": "https://stackoverflow.com/users/4547068/daniel-roca-lopez"}, "edited": false, "score": 0, "creation_date": 1459366079, "post_id": 36317687, "comment_id": 60259335, "body": "Why shouldnt i separate them? Though your last comment helped me, i will try it"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 548, "user_id": 4547068, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/651f7915c52ada9f3b616430481ec37f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Roca Lopez", "link": "https://stackoverflow.com/users/4547068/daniel-roca-lopez"}, "edited": false, "score": 1, "creation_date": 1459366516, "post_id": 36317687, "comment_id": 60259643, "body": "@DanielRocaLopez Because usually it leads to more problems than it solves. For example: your <code>NumericExpr</code> type has a case <code>Var</code> for variables. Presumably <code>BooleanExpr</code> would also need a case for variables, right? So let&#39;s call that <code>BoolVar</code>. Now your parser sees a variable name. Should it produce a <code>Var</code> or a <code>BoolVar</code>? You can&#39;t really know at this point unless you carry around type information for variables through the parser. That isn&#39;t usually information you need or want to keep track of in the parser and it makes your code much more painful than it needs to be."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 548, "user_id": 4547068, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/651f7915c52ada9f3b616430481ec37f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Roca Lopez", "link": "https://stackoverflow.com/users/4547068/daniel-roca-lopez"}, "edited": false, "score": 0, "creation_date": 1459371385, "post_id": 36317687, "comment_id": 60262431, "body": "@DanielRocaLopez <code>Expr</code> isn&#39;t a type class, it needs to be <code>readCommand :: Num b =&gt; a -&gt; Expr b</code>. If that&#39;s confusing, you should read up on types and type classes. You also need <code>Num (Var 3)</code> instead of just <code>Var 3</code>, so that the result has the right type. And you need to change the definition of <code>Expr</code>, so that <code>Num</code> and <code>Bool</code> take a <code>NumericExpr e</code> and <code>BooleanExpr e</code> respectively, instead of just an <code>e</code>."}, {"owner": {"reputation": 548, "user_id": 4547068, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/651f7915c52ada9f3b616430481ec37f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Roca Lopez", "link": "https://stackoverflow.com/users/4547068/daniel-roca-lopez"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1459371596, "post_id": 36317687, "comment_id": 60262555, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/107783/discussion-between-daniel-roca-lopez-and-sepp2k\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 2, "last_activity_date": 1459365174, "creation_date": 1459365174, "answer_id": 36317687, "question_id": 36317569, "link": "https://stackoverflow.com/questions/36317569/haskell-couldnt-match-expected-type-with-actual-type/36317687#36317687", "title": "Haskell - couldn&#39;t match expected type with actual type", "body": "<p>You're saying that <code>readCommand</code> can produce results of any type <code>b</code> that the user requests, but you produce the result <code>Var 3</code>, which is a <code>NumericExpr e</code> (for some numeric type <code>e</code>). So in fact you can only produce results of type <code>NumericExpr e</code>, not any type. So your type signature is incorrect. It needs to be <code>readCommand :: Num b =&gt; a -&gt; NumericExpr b</code> or just <code>readCommand :: a -&gt; NumericExpr Integer</code> if you want to decide on a specific type for <code>3</code>.</p>\n\n<p>Note that there is no possible function of type <code>a -&gt; b</code> (without any constraints on <code>b</code>) that ever produces a result. That is any possible function of that type would loop forever or crash.</p>\n"}], "owner": {"reputation": 548, "user_id": 4547068, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/651f7915c52ada9f3b616430481ec37f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Roca Lopez", "link": "https://stackoverflow.com/users/4547068/daniel-roca-lopez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1061, "favorite_count": 0, "accepted_answer_id": 36317687, "answer_count": 1, "score": -2, "last_activity_date": 1459434817, "creation_date": 1459364811, "last_edit_date": 1459434817, "question_id": 36317569, "link": "https://stackoverflow.com/questions/36317569/haskell-couldnt-match-expected-type-with-actual-type", "title": "Haskell - couldn&#39;t match expected type with actual type", "body": "<p>On this code there's no way to do it polymorphic:</p>\n\n<pre><code>data NumericExpr e = Var e | Const e | Times [e] | Div e e deriving (Show,Read)\n\nreadCommand:: a -&gt; b\nreadCommand entrada = Var 3\n</code></pre>\n\n<p>It gives me a big error which I can't copy:</p>\n\n<blockquote>\n  <p>couldn't match expected type b with actual type NumericExpr e0 b is a\n  rigid type variable bound by the type signature for readcommand :: a\n  -> b</p>\n</blockquote>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>not working yet with:</p>\n\n<pre><code>data NumericExpr e = Var e | Const e | Plus [e] | Minus [e] | Times [e] | Div e e deriving (Show,Read)\ndata Expr e = Num e | String e\n\nreadCommand:: Expr b =&gt; a -&gt; b\nreadCommand entrada = Var 3\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1459365612, "post_id": 36317680, "comment_id": 60259015, "body": "this approach will make it unnecessarily complicated."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 0, "last_activity_date": 1459365154, "creation_date": 1459365154, "answer_id": 36317680, "question_id": 36317482, "link": "https://stackoverflow.com/questions/36317482/getting-the-gcd-of-a-list/36317680#36317680", "title": "Getting the gcd of a list", "body": "<p>A GCD is a property of a pair of numbers. So, really, you want to look at <em>pairs</em> of numbers drawn from your list. Ultimately you want to end up with a single GCD for the entire list, but as a first step, you want pairs.</p>\n\n<p>There's a widely-known trick for working with consecutive pairs:</p>\n\n<pre><code>f1 list = zipWith f2 list (tail list)\n</code></pre>\n\n<p>The <code>zipWith</code> function is a bit like <code>map</code>, but works with a <em>pair</em> of lists. In this case, the original list, and the tail of the original list. (Note that this fails if the list is empty.) If you replace <code>f2</code> with your <code>gcd</code> function, you now have a new list which is the GCD of each consecutive pair of numbers. And this list is one element shorter than the original:</p>\n\n<pre><code>f1 [x, y, z, w] ==&gt; [gcd x y, gcd y z, gcd z w]\n</code></pre>\n\n<p>So each time you apply <code>f1</code> to a list, you get a new, shorter list of GCDs. Apply it enough times, and you should end up with just one element...</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 5463160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01c2d26fceaf440a6314595095310db?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy Walker", "link": "https://stackoverflow.com/users/5463160/timothy-walker"}, "edited": false, "score": 0, "creation_date": 1459365953, "post_id": 36317701, "comment_id": 60259245, "body": "I would do something like foldl gcd 1 [3, 6, 9] , but it is still not working. Actually, I just defined <code>gcdAll :: [Integer] -&gt; Integer gcdAll l = foldl gcd 1 l</code> And it always returns 1."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 73, "user_id": 5463160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01c2d26fceaf440a6314595095310db?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy Walker", "link": "https://stackoverflow.com/users/5463160/timothy-walker"}, "edited": false, "score": 0, "creation_date": 1459366160, "post_id": 36317701, "comment_id": 60259386, "body": "@TimothyWalker You&#39;re very close but there&#39;s a problem with your choice of initial value, what&#39;s the GCD of 1 and anything else?"}, {"owner": {"reputation": 73, "user_id": 5463160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01c2d26fceaf440a6314595095310db?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy Walker", "link": "https://stackoverflow.com/users/5463160/timothy-walker"}, "edited": false, "score": 0, "creation_date": 1459366298, "post_id": 36317701, "comment_id": 60259485, "body": "Oh, thank you, I figured it out, I have to do <code>gcdAll l = foldl gcd (first value of l) (list &quot;remaining&quot;)</code> , I am going to use head to get the first item from the list and tail to get the rest, omg. thank you xD"}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 73, "user_id": 5463160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01c2d26fceaf440a6314595095310db?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy Walker", "link": "https://stackoverflow.com/users/5463160/timothy-walker"}, "edited": false, "score": 0, "creation_date": 1459366411, "post_id": 36317701, "comment_id": 60259569, "body": "@TimothyWalker Im glad you got it! Be sure you check out the stuff with Maybe in my answer because you don&#39;t want your code to blow up if you give it an empty list"}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 4, "last_activity_date": 1459365223, "creation_date": 1459365223, "answer_id": 36317701, "question_id": 36317482, "link": "https://stackoverflow.com/questions/36317482/getting-the-gcd-of-a-list/36317701#36317701", "title": "Getting the gcd of a list", "body": "<p>Not quite, you don't want <code>map</code> but rather a fold. <code>map</code> will let you transform every element in the list uniformly, so you give it a local transformation <code>a -&gt; b</code> and it gives you a global transformation (<code>[a] -&gt; [b]</code>). This isn't really what you want.</p>\n\n<p>As a quick primer on folds, there's a whole family of them which all let us express computations which we build up by repeatedly applying a function to an initial value, the next element and the list, and then repeating with the result of that application as the new initial value. So <code>foldl' (+) 0 [1, 2, 3, 4]</code> would so something like</p>\n\n<pre><code> foldl' (+) 0 [1, 2, 3, 4] ==&gt;\n foldl' (+) 1 [2, 3, 4] ==&gt;\n foldl' (+) 3 [3, 4] ==&gt;\n foldl' (+) 6 [4] ==&gt;\n foldl' (+) 10 [] ==&gt; -- For empty lists we just return the seed given\n 10\n</code></pre>\n\n<p>Can you see how to slot your problem into this framework?</p>\n\n<h2>More hints</h2>\n\n<p>You want to take a list and compute a result which depends on every element of the list, something like</p>\n\n<pre><code>gcdAll :: [Int] -&gt; Int\ngcdAll l = foldl' step initial l\n</code></pre>\n\n<p>is closer to what you want where <code>step</code> takes the current gcd of the list you've processed so far and the next element of the list and returns the next value and initial is the value to start with (and what is returned if <code>l</code> is empty. Since there isn't really a sane value, I'd instead split this into</p>\n\n<pre><code>gcdAll :: [Int] -&gt; Maybe Int\ngcdAll [] = Nothing\ngcdAll (h : rest) = Just $ foldl' step h rest\n</code></pre>\n\n<p>so that you correctly signal the possibility of failure, after all, what's the gcd of nothing?</p>\n\n<p>Note that <code>foldl'</code> is imported from <code>Data.List</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459376208, "post_id": 36317794, "comment_id": 60264746, "body": "<code>lcm&#39; [] = 1</code>, but I don&#39;t think <code>gcd&#39; []</code> is sensible."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1459365498, "creation_date": 1459365498, "answer_id": 36317794, "question_id": 36317482, "link": "https://stackoverflow.com/questions/36317482/getting-the-gcd-of-a-list/36317794#36317794", "title": "Getting the gcd of a list", "body": "<p>You can recursively use gcd on a list (essentially a fold implementation)</p>\n\n<pre><code>gcd' :: (Integral a) =&gt; [a] -&gt; a\ngcd' [] = 1\ngcd' [x] = x\ngcd' (x:xs) = gcd x (gcd' xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1649, "user_id": 2394634, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/GhVqX.jpg?s=128&g=1", "display_name": "147pm", "link": "https://stackoverflow.com/users/2394634/147pm"}, "is_accepted": false, "score": 0, "last_activity_date": 1614897218, "creation_date": 1614897218, "answer_id": 66484042, "question_id": 36317482, "link": "https://stackoverflow.com/questions/36317482/getting-the-gcd-of-a-list/66484042#66484042", "title": "Getting the gcd of a list", "body": "<p>I just tackled this one and this would be the quickest, simplest</p>\n<pre><code>myGCDMultiple = foldr1 gcd\n\n&gt; myGCDMultiple [3,6,9]\n3\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 5463160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01c2d26fceaf440a6314595095310db?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy Walker", "link": "https://stackoverflow.com/users/5463160/timothy-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1184, "favorite_count": 1, "accepted_answer_id": 36317701, "answer_count": 4, "score": 5, "last_activity_date": 1614897218, "creation_date": 1459364477, "question_id": 36317482, "link": "https://stackoverflow.com/questions/36317482/getting-the-gcd-of-a-list", "title": "Getting the gcd of a list", "body": "<p>I am new to Haskell, actually I just started, and I would like to get a small hint to the question I am about to ask.</p>\n\n<p>I am currently trying to get the GCD of a given list. For example, having the list [3, 6, 9] it will return 3.</p>\n\n<p>For the moment, I tought of the following aproach, am I going in a good direction?</p>\n\n<pre><code>let getGCD l = map (\\x y -&gt; gcd x y) l\n</code></pre>\n"}, {"tags": ["haskell", "monads", "applicative", "monadplus"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1459348260, "post_id": 36311809, "comment_id": 60247151, "body": "You may follow the migration guide: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Migration/7.10\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/Migration/7.10</a>"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1459348326, "post_id": 36311809, "comment_id": 60247205, "body": "I guess you still need manual instances for Applicative (which will be very easy) and Alternative."}, {"owner": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1459349525, "post_id": 36311809, "comment_id": 60248125, "body": "Thanks for the suggestions! @zakyggaps I tried following the instructions on your link but unfortunately now have new errors which I&#39;m not sure how I should fix. I probably still have to change something?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1459349753, "post_id": 36311809, "comment_id": 60248309, "body": "In your original definition of &quot;&gt;&gt;=&quot;  you had the arguments &quot;p&quot; and &quot;f&quot;. But in your definition of &quot;*&gt;&quot; you don&#39;t have those arguments any more. What happens if you replace &quot;(*&gt;)&quot; with &quot;p *&gt; f&quot;? There is a similar confusion in your new definition of &quot;&gt;&gt;=&quot;. Are you sure you understand how operator syntax works?"}, {"owner": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1459349965, "post_id": 36311809, "comment_id": 60248453, "body": "@PaulJohnson I replaced it and now it doesn&#39;t complain about them anymore, thankyou! Now it only complains about a (56), p (66) and q (66). I&#39;m still very very new with Haskell and haven&#39;t used it very much so I still get confused with quite many things sometimes. I&#39;m doing my best to learn but it&#39;s very different."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1459350202, "post_id": 36311809, "comment_id": 60248636, "body": "@katyp OK, now try the same change on the other functions. Think about &quot;pure&quot; and &quot;return&quot;: they are actually the same thing."}], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1459350309, "post_id": 36312740, "comment_id": 60248726, "body": "So what is &quot;a&quot; in the definition of &quot;pure&quot;?"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1459350343, "post_id": 36312740, "comment_id": 60248756, "body": "@PaulJohnson Sorry, fixed."}, {"owner": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "edited": false, "score": 0, "creation_date": 1459350480, "post_id": 36312740, "comment_id": 60248864, "body": "This fix only gives error &quot;Parser.hs:56:29: Not in scope: \u2018a\u2019&quot; now, so there seems to be some kind of a problem with pure = Parser (\\cs -&gt; [(a,cs)]) or something? I&#39;m very new with this and am not sure where the root of the problem is."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "edited": false, "score": 0, "creation_date": 1459350714, "post_id": 36312740, "comment_id": 60249032, "body": "@katyp You should not remove the <code>MonadPlus</code> instance. The definition of <code>Alternative</code> depends on it."}, {"owner": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "edited": false, "score": 0, "creation_date": 1459351276, "post_id": 36312740, "comment_id": 60249472, "body": "@zakyggaps Thankyou so much for your help! Now ghci still gives a compiling error for MonadPlus. I edited the original post"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "edited": false, "score": 0, "creation_date": 1459351442, "post_id": 36312740, "comment_id": 60249623, "body": "@katyp You forgot to import it from <code>Control.Monad</code>. It&#39;s not in the list now: <code>import           Control.Monad (mplus, mzero, liftM, ap)</code>"}, {"owner": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "edited": false, "score": 0, "creation_date": 1459351921, "post_id": 36312740, "comment_id": 60250031, "body": "@zakyggaps You&#39;re right! This fixed the problem, now I get no errors :) Thankyou very much!"}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": false, "score": 3, "last_activity_date": 1459352762, "last_edit_date": 1459352762, "creation_date": 1459350234, "answer_id": 36312740, "question_id": 36311809, "link": "https://stackoverflow.com/questions/36311809/haskell-parser-monad-and-monadplus/36312740#36312740", "title": "Haskell parser, Monad and MonadPlus", "body": "<p>You may follow <a href=\"http://ghc.haskell.org/trac/ghc/wiki/Migration/7.10\" rel=\"nofollow\">the migration guide</a>. It's simple and straightforward: move the definition of <code>return</code> to <code>pure</code>, add the boilerplate definition of <code>&lt;*&gt;</code> and remove <code>return</code> from the monad instance:</p>\n\n<pre><code>instance Functor Parser where\n    fmap = liftM\n\ninstance Applicative Parser where\n    pure a = Parser (\\cs -&gt; [(a,cs)])\n    (&lt;*&gt;) = ap\n\ninstance Monad Parser where\n    p &gt;&gt;= f = Parser (\\cs -&gt; concat [parse (f a) cs' | (a,cs') &lt;- parse p cs])\n</code></pre>\n\n<p>For <code>Alternative</code> it's boilerplate and nothing else:</p>\n\n<pre><code>instance Alternative Parser where \n    (&lt;|&gt;) = mplus \n    empty = mzero\n</code></pre>\n\n<p>The working code as a whole:</p>\n\n<pre><code>module Parser where\n\nimport           Control.Monad\nimport           Tagger        (Tag, Token)\nimport           Control.Applicative\n\nnewtype Parser a = Parser ([(Token, Tag)] -&gt; [(a, [(Token, Tag)])])\n\nparse :: Parser a -&gt; [(Token, Tag)] -&gt; [(a, [(Token, Tag)])]\nparse (Parser p) = p\n\ninstance Functor Parser where\n    fmap = liftM\n\ninstance Applicative Parser where\n    pure a = Parser (\\cs -&gt; [(a,cs)])\n    (&lt;*&gt;) = ap\n\ninstance Monad Parser where\n    p &gt;&gt;= f = Parser (\\cs -&gt; concat [parse (f a) cs' | (a,cs') &lt;- parse p cs])\n\ninstance MonadPlus Parser where\n    p `mplus` q = Parser (\\cs -&gt; parse p cs ++ parse q cs)\n    mzero = Parser (const [])\n\ninstance Alternative Parser where\n    (&lt;|&gt;) = mplus\n    empty = mzero\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 6135144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdfd99f85da69e90f9a3689ada3807bf?s=128&d=identicon&r=PG&f=1", "display_name": "katyp", "link": "https://stackoverflow.com/users/6135144/katyp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 804, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1613796879, "creation_date": 1459347986, "last_edit_date": 1613796879, "question_id": 36311809, "link": "https://stackoverflow.com/questions/36311809/haskell-parser-monad-and-monadplus", "title": "Haskell parser, Monad and MonadPlus", "body": "<pre><code>    module Parser where\n\nimport           Control.Monad (MonadPlus, mplus, mzero)\nimport           Tagger        (Tag, Token)\n\n\nnewtype Parser a = Parser ([(Token, Tag)] -&gt; [(a, [(Token, Tag)])])\n\nparse :: Parser a -&gt; [(Token, Tag)] -&gt; [(a, [(Token, Tag)])]\nparse (Parser p) = p\n\ninstance Functor Parser where\n    fmap f p = do\n        result &lt;- p\n        return (f result)\n\ninstance Monad Parser where\n    return a = Parser (\\cs -&gt; [(a,cs)])\n    p &gt;&gt;= f = Parser (\\cs -&gt; concat [parse (f a) cs' | (a,cs') &lt;- parse p cs])\n\ninstance MonadPlus Parser where \n    p `mplus` q = Parser (\\cs -&gt; parse p cs ++ parse q cs)\n    mzero = Parser (const [])\n\n{-\n</code></pre>\n\n<p>This is my code for my parser. Apparently I've done it \"the old way\" and cannot really get it to work the new way. Can you tell me which things I need to fix in order to make it work? I read this article (<a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow\">https://wiki.haskell.org/Functor-Applicative-Monad_Proposal</a>) and tried to change my code but I think I'm doing something wrong here.</p>\n\n<p>The compiling errors I get:</p>\n\n<pre><code>Parser.hs:56:10:\n    No instance for (Applicative Parser)\n      arising from the superclasses of an instance declaration\n    In the instance declaration for \u2018Monad Parser\u2019\n\nParser.hs:60:10:\n    No instance for (GHC.Base.Alternative Parser)\n      arising from the superclasses of an instance declaration\n    In the instance declaration for \u2018MonadPlus Parser\u2019\n</code></pre>\n\n<p>EDIT //</p>\n\n<p>The code right now:</p>\n\n<pre><code>module Parser where\n\nimport           Control.Applicative\nimport           Control.Monad (mplus, mzero, liftM, ap)\nimport           Tagger        (Tag, Token)\n\n-- type Token = String \n-- type Tag = String\n\nnewtype Parser a = Parser ([(Token, Tag)] -&gt; [(a, [(Token, Tag)])])\n\nparse :: Parser a -&gt; [(Token, Tag)] -&gt; [(a, [(Token, Tag)])]\nparse (Parser p) = p\n\ninstance Functor Parser where\n    fmap = liftM\n\ninstance Applicative Parser where\n    pure a = Parser (\\cs -&gt; [(a,cs)])\n    (&lt;*&gt;) = ap\n\ninstance Monad Parser where\n    p &gt;&gt;= f = Parser (\\cs -&gt; concat [parse (f a) cs' | (a,cs') &lt;- parse p cs])\n\ninstance MonadPlus Parser where --64\n    p `mplus` q = Parser (\\cs -&gt; parse p cs ++ parse q cs)\n    mzero = Parser (const [])\n\ninstance Alternative Parser where\n    (&lt;|&gt;) = mplus\n    empty = mzero\n\n(+++) :: Parser a -&gt; Parser a -&gt; Parser a\np +++ q = Parser (\\cs -&gt; case parse (p `mplus` q) cs of\n                           [] -&gt; []\n                           (x:_) -&gt; [x])\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>Parser.hs:64:10:\nNot in scope: type constructor or class \u2018MonadPlus\u2019\n</code></pre>\n"}, {"tags": ["haskell", "gtk2hs"], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 1, "last_activity_date": 1459351568, "creation_date": 1459351568, "answer_id": 36313236, "question_id": 36311436, "link": "https://stackoverflow.com/questions/36311436/adding-a-menuitem-to-a-menu-in-gtk2hs/36313236#36313236", "title": "Adding a MenuItem to a Menu in Gtk2hs", "body": "<p>I've figured it out. I need to call \"widgetShow\" on the new menu item.</p>\n\n<pre><code>     testItem &lt;- menuItemNewWithLabel \"Test\"\n     widgetShow testItem\n     testItem `on` menuItemActivated $ putStrLn \"Test clicked\"\n     menuShellAppend (castToMenu pop) testItem\n</code></pre>\n"}], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1459351568, "creation_date": 1459347116, "question_id": 36311436, "link": "https://stackoverflow.com/questions/36311436/adding-a-menuitem-to-a-menu-in-gtk2hs", "title": "Adding a MenuItem to a Menu in Gtk2hs", "body": "<p>I want to create a popup <a href=\"https://hackage.haskell.org/package/gtk-0.14.2/docs/Graphics-UI-Gtk-MenuComboToolbar-Menu.html\" rel=\"nofollow\">GTK Menu</a> and then add some <a href=\"https://hackage.haskell.org/package/gtk-0.14.2/docs/Graphics-UI-Gtk-MenuComboToolbar-MenuItem.html\" rel=\"nofollow\">MenuItems</a> to it. I found this <a href=\"http://www.muitovar.com/gtk2hs/chap7-2.html\" rel=\"nofollow\">bit of sample code for popup menus</a> but it was bitrotted. The fixed version is below. Look for the comment \"This is the bit that doesn't work!\".</p>\n\n<p>The trouble is that the MenuItem I add doesn't appear when the menu is displayed. The action items created with the UI Manager are there, but not the \"Test\" item I created manually.</p>\n\n<p>Is there some step I'm missing? Or am I going about this the wrong way?</p>\n\n<pre><code>import Control.Monad.IO.Class\nimport Graphics.UI.Gtk\n\n\nmain :: IO ()\nmain= do\n     initGUI\n     window &lt;- windowNew\n     set window [windowTitle := \"Click Right Popup\",\n                 windowDefaultWidth := 250,\n                 windowDefaultHeight := 150 ]\n\n     eda &lt;- actionNew \"EDA\" \"Edit\" Nothing Nothing\n     pra &lt;- actionNew \"PRA\" \"Process\" Nothing Nothing\n     rma &lt;- actionNew \"RMA\" \"Remove\" Nothing Nothing\n     saa &lt;- actionNew \"SAA\" \"Save\" Nothing Nothing\n\n     agr &lt;- actionGroupNew \"AGR1\" \n     mapM_ (actionGroupAddAction agr) [eda,pra,rma,saa]\n\n     uiman &lt;- uiManagerNew\n     uiManagerAddUiFromString uiman uiDecl\n     uiManagerInsertActionGroup uiman agr 0\n\n     maybePopup &lt;- uiManagerGetWidget uiman \"/ui/popup\"\n     let pop = case maybePopup of \n                    (Just x) -&gt; x\n                    Nothing -&gt; error \"Cannot get popup from string\"\n\n     window `on` buttonPressEvent $ do\n        b &lt;- eventButton\n        if b == RightButton\n           then do\n              liftIO $ menuPopup (castToMenu pop) Nothing\n              return True\n           else return True\n\n\n     -- This is the bit that doesn't work!\n     testItem &lt;- menuItemNewWithLabel \"Test\"\n     testItem `on` menuItemActivated $ putStrLn \"Test clicked\"\n     menuShellAppend (castToMenu pop) testItem\n\n     mapM_ prAct [eda,pra,rma,saa]\n\n     widgetShowAll window\n     window `on` objectDestroy $ mainQuit\n     mainGUI\n\nuiDecl = \"&lt;ui&gt; \\\n\\          &lt;popup&gt;\\\n\\            &lt;menuitem action=\\\"EDA\\\" /&gt;\\\n\\            &lt;menuitem action=\\\"PRA\\\" /&gt;\\\n\\            &lt;menuitem action=\\\"RMA\\\" /&gt;\\\n\\            &lt;separator /&gt;\\\n\\            &lt;menuitem action=\\\"SAA\\\" /&gt;\\\n\\          &lt;/popup&gt;\\\n\\        &lt;/ui&gt;\"   \n\nprAct :: ActionClass self =&gt; self -&gt; IO (ConnectId self)\nprAct a = a `on` actionActivated $ do\n   name &lt;- actionGetName a\n   putStrLn (\"Action Name: \" ++ name)\n</code></pre>\n"}, {"tags": ["haskell", "monads", "continuation-passing"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459347423, "post_id": 36311300, "comment_id": 60246372, "body": "Have you tried using typed holes? Where did you run into trouble?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 2, "creation_date": 1459347427, "post_id": 36311300, "comment_id": 60246375, "body": "You can&#39;t define &quot;bind&quot; for a bare type synonym. You need to make it a newtype, and then declare it an Instance of Monad."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459347513, "post_id": 36311300, "comment_id": 60246458, "body": "Also, why would you want <code>() -&gt; Answer</code> instead of just <code>Answer</code>, and what is <code>Answer</code> anyway?"}, {"owner": {"reputation": 689, "user_id": 1216142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A61Ei.jpg?s=128&g=1", "display_name": "David Furlong", "link": "https://stackoverflow.com/users/1216142/david-furlong"}, "edited": false, "score": 0, "creation_date": 1459347675, "post_id": 36311300, "comment_id": 60246601, "body": "Yeah I know I need to make it an instance of Monad, but putting Haskell formalities aside, how would I define it. Answer can be anything."}, {"owner": {"reputation": 689, "user_id": 1216142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A61Ei.jpg?s=128&g=1", "display_name": "David Furlong", "link": "https://stackoverflow.com/users/1216142/david-furlong"}, "edited": false, "score": 0, "creation_date": 1459347759, "post_id": 36311300, "comment_id": 60246668, "body": "I&#39;m trying to learn to define bind given a Monad. This is from an old problem sheet. Why I would want to do this in practice is fairly irrelevant to me"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459347915, "post_id": 36311300, "comment_id": 60246821, "body": "Start by ditching <code>FCont</code>. It&#39;s silly noise. Use <code>Answer</code> instead. Have you tried typed holes yet? Where did you get stuck?"}, {"owner": {"reputation": 689, "user_id": 1216142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A61Ei.jpg?s=128&g=1", "display_name": "David Furlong", "link": "https://stackoverflow.com/users/1216142/david-furlong"}, "edited": false, "score": 0, "creation_date": 1459348047, "post_id": 36311300, "comment_id": 60246951, "body": "Trying typed holes right now, thanks for the suggestion"}, {"owner": {"reputation": 689, "user_id": 1216142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A61Ei.jpg?s=128&g=1", "display_name": "David Furlong", "link": "https://stackoverflow.com/users/1216142/david-furlong"}, "edited": false, "score": 0, "creation_date": 1459349837, "post_id": 36311300, "comment_id": 60248357, "body": "Using typed holes didn&#39;t really do much except tell me that haskell bind expected a M b type on the RHS of the def. (which is obvious given the type signature). Ditching FCont just gives me the monad of continuations, in which (x &gt;&gt;= f) k = xm (\\x -&gt; f x k). However I can&#39;t see how this helps me"}, {"owner": {"reputation": 689, "user_id": 1216142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A61Ei.jpg?s=128&g=1", "display_name": "David Furlong", "link": "https://stackoverflow.com/users/1216142/david-furlong"}, "edited": false, "score": 0, "creation_date": 1459349850, "post_id": 36311300, "comment_id": 60248368, "body": "Perhaps I&#39;m using typed holes wrong"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459353505, "post_id": 36311300, "comment_id": 60251251, "body": "The reason I suggested ditching <code>FCont</code> is that <code>() -&gt; a</code> is &quot;morally equivalent&quot; to <code>a</code>, for any type <code>a</code>. Because Haskell is lazy, the near-isomorphism almost preserves performance characteristics. So the only differences are: 1. <code>() -&gt; a</code> has an extra bottom element observable only by <code>seq</code> and 2. The result of <code>() -&gt; a</code> may not be memoized (but that&#39;s implementation-dependent). In a strict language like ML, the distinction matters much more."}], "answers": [{"tags": [], "owner": {"reputation": 689, "user_id": 1216142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A61Ei.jpg?s=128&g=1", "display_name": "David Furlong", "link": "https://stackoverflow.com/users/1216142/david-furlong"}, "is_accepted": false, "score": 1, "last_activity_date": 1459351068, "creation_date": 1459351068, "answer_id": 36313048, "question_id": 36311300, "link": "https://stackoverflow.com/questions/36311300/defining-bind-in-the-double-barrelled-continuation-monad-in-haskell/36313048#36313048", "title": "Defining bind in the double barrelled continuation Monad in Haskell", "body": "<p>Figured it out, thanks for trying to help</p>\n\n<p>(xm >>= f) ks kf = xm (\\a f' -> f a ks f') kf</p>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1459380763, "creation_date": 1459380763, "answer_id": 36321606, "question_id": 36311300, "link": "https://stackoverflow.com/questions/36311300/defining-bind-in-the-double-barrelled-continuation-monad-in-haskell/36321606#36321606", "title": "Defining bind in the double barrelled continuation Monad in Haskell", "body": "<p>The definition you give of <code>SCont</code> is weird to me: how comes the successful continuation takes the failure one as an argument? Plus, given you <code>return</code> and <code>bind</code>, it looks like the failure one is threaded all the way down the call tree and... applied to the success one in case you hit a return.</p>\n\n<p>I would expect the 'double barrelled continuation Monad' to be defined like so:</p>\n\n<pre><code>module SFCont where\n\nimport Control.Monad\n\nnewtype SFCont r a = SFCont { sfCont :: SCont r a -&gt; FCont r a -&gt; r }\ntype SCont r a = a -&gt; r\ntype FCont r a = r\n\ninstance Functor (SFCont r) where\n  fmap f (SFCont c) = SFCont $ \\ ks -&gt; c (ks . f)   \n\n-- this will be obtained from the definition of the `Monad` instance\ninstance Applicative (SFCont r) where\n  pure  = return\n  (&lt;*&gt;) = ap\n\ninstance Monad (SFCont r) where\n  return a = SFCont $ const . ($ a)\n  m &gt;&gt;= f  = SFCont $ \\ ks kf -&gt; sfCont m (\\ a -&gt; sfCont (f a) ks kf) kf\n</code></pre>\n\n<p>We can find a systematic way of defining it (and its cousin where failure can take an element of an error type <code>e</code>) by reasoning up to isomorphism and noticing that:</p>\n\n<pre><code>SCont r a -&gt; FCont r a -&gt; r    ~{ unfolding SCont, FCont }\n(a -&gt; r) -&gt; r -&gt; r             ~{ r iso (() -&gt; r) }\n(a -&gt; r) -&gt; (() -&gt; r) -&gt; r     ~{ uncurrying }\n((a -&gt; r), (() -&gt; r)) -&gt; r     ~{ ((a -&gt; r), (b -&gt; r)) iso (Either a b -&gt; r) }\n(Either a () -&gt; r) -&gt; r        ~{ Either a () iso Maybe a }\n(Maybe a -&gt; r) -&gt; r            ~{ folding MaybeT, Cont }\nMaybeT (Cont r) a              \n</code></pre>\n\n<p>And now, we can leverage existing instances by writing down this iso:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule SFCont where\n\nimport Data.Functor.Identity\nimport Control.Monad\nimport Control.Monad.Trans.Maybe\nimport Control.Monad.Trans.Cont\n\nnewtype SFCont r a = SFCont { sfCont :: SCont r a -&gt; FCont r a -&gt; r }\n\ntype SCont r a = a -&gt; r\ntype FCont r a = r\n\nnewtype SFCont' r a = SFCont' { sfCont' :: MaybeT (Cont r) a }\n  deriving (Functor, Applicative, Monad)\n\nto :: SFCont r a -&gt; SFCont' r a\nto m = SFCont' $ MaybeT $ ContT $ \\ k -&gt; Identity $\n       sfCont m (runIdentity . k . Just) (runIdentity $ k Nothing)\n\nfrom :: SFCont' r a -&gt; SFCont r a\nfrom m = SFCont $ \\ ks kf -&gt; runIdentity $\n         (runContT $ runMaybeT $ sfCont' m) (Identity . maybe kf ks)\n\ninstance Monad (SFCont r) where\n  return  = from . return\n  m &gt;&gt;= f = from $ to m &gt;&gt;= to . f\n</code></pre>\n\n<p>In the case where the failure continuation could take an element of an error type <code>e</code>, you'd follow the same process and arrive at the stack <code>EitherT e (Cont r) a</code> for your iso.</p>\n"}], "owner": {"reputation": 689, "user_id": 1216142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A61Ei.jpg?s=128&g=1", "display_name": "David Furlong", "link": "https://stackoverflow.com/users/1216142/david-furlong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1459380763, "creation_date": 1459346832, "question_id": 36311300, "link": "https://stackoverflow.com/questions/36311300/defining-bind-in-the-double-barrelled-continuation-monad-in-haskell", "title": "Defining bind in the double barrelled continuation Monad in Haskell", "body": "<p>Trying to define bind for this monad in haskell.\nIf the calculation succeeds it calls the SCont continuation, if it fails it calls the FCont continuation. </p>\n\n<pre><code>type M a = SCont a -&gt; FCont -&gt; Answer\ntype SCont a = a -&gt; FCont -&gt; Answer\ntype FCont = () -&gt; Answer\n\nresult :: a -&gt; M a\nresult x ks kf = ks x kf\n\n(&gt;&gt;=) :: M a -&gt; (a -&gt; M b) -&gt; M b\n</code></pre>\n"}, {"tags": ["multithreading", "haskell"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 2, "creation_date": 1459345122, "post_id": 36310299, "comment_id": 60244386, "body": "GHC can detect some deadlock thereby throw an exception to the thread and kill it. <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch15.html#sec_deadlock\" rel=\"nofollow noreferrer\">The Book</a> had some discussion on when it can and when it cannot."}, {"owner": {"reputation": 735, "user_id": 961761, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2631f359822e6f25df80319ec3f5dcfe?s=128&d=identicon&r=PG", "display_name": "pchiusano", "link": "https://stackoverflow.com/users/961761/pchiusano"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1459345621, "post_id": 36310299, "comment_id": 60244784, "body": "That makes sense. Based on reading that, it sounds like for <code>MVar</code> reads, it is guaranteed that a thread is GC-able when it is blocked indefinitely. What about <code>TQueue</code> and <code>Chan</code>?"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1459346914, "post_id": 36310299, "comment_id": 60245924, "body": "<code>Chan</code> are nested <code>MVar</code>s, and <code>TQueue</code> works in <code>STM</code> monad which is kind of magical and can detect almost any potential deadlock in the current scope (i.e. in a single call to <code>atomically</code>). However concurrency is still one of the most error-prone topic in haskell and I recommand read <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/pt02.html\" rel=\"nofollow noreferrer\">The Book</a> throughout before doing it in a real project."}, {"owner": {"reputation": 735, "user_id": 961761, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2631f359822e6f25df80319ec3f5dcfe?s=128&d=identicon&r=PG", "display_name": "pchiusano", "link": "https://stackoverflow.com/users/961761/pchiusano"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1459355655, "post_id": 36310299, "comment_id": 60252671, "body": "I&#39;ve got the book and will read it. I&#39;m still looking for a simple answer to my question though for <code>TQueue</code>. For <code>TQueue</code>, say the producer thread is doing an <code>atomically (writeTQueue msg)</code>, and the consumer thread is doing an <code>atomically readTQueue</code>. If the producer gets GC&#39;d, will the consumer, which is blocked on that <code>readTQueue</code>, be eligible for GC?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459373980, "post_id": 36310299, "comment_id": 60263792, "body": "@pchiusano Any number of things could happen depending on exactly the code that&#39;s running (and optimizations, etc.). &quot;You can\u2019t in general know how clever the compiler is going to be, so you should not rely on deadlock detection for the correct working of your program.&quot;. When a thread is <code>retry</code>ing and hold the last reference to a <code>TVar</code> (or anything build using <code>TVars</code>, like <code>TQueue</code>) it receives a <code>BlockedIndefinitelyOnSTM</code>. So if the consumer is the holding the last reference, it <i>will</i> be interrupted - but ensuring that all other references are GCed is the really hard part."}, {"owner": {"reputation": 735, "user_id": 961761, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2631f359822e6f25df80319ec3f5dcfe?s=128&d=identicon&r=PG", "display_name": "pchiusano", "link": "https://stackoverflow.com/users/961761/pchiusano"}, "edited": false, "score": 0, "creation_date": 1459401640, "post_id": 36310299, "comment_id": 60272138, "body": "I got it. But I would not say it is unpredictable/unreliable to reason about when references (to a <code>TQueue</code> or anything else) are reachable - it&#39;s not really any different than what you do all the time to reason about object lifetimes while programming."}], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 961761, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2631f359822e6f25df80319ec3f5dcfe?s=128&d=identicon&r=PG", "display_name": "pchiusano", "link": "https://stackoverflow.com/users/961761/pchiusano"}, "is_accepted": true, "score": 1, "last_activity_date": 1468338915, "creation_date": 1468338915, "answer_id": 38333757, "question_id": 36310299, "link": "https://stackoverflow.com/questions/36310299/will-a-haskell-thread-be-gcd-if-blocked-indefinitely-on-an-mvar-chan-tqueue-rea/38333757#38333757", "title": "Will a Haskell thread be GC&#39;d if blocked indefinitely on an MVar/Chan/TQueue read?", "body": "<p>So to summarize, the answer is that a sleeping thread which is determined to have the sole reference to an <code>MVar</code> and <code>TVar</code> (which back <code>Chan</code>, <code>TQueue</code>, <code>TMVar</code>, etc), and is blocked on some use of said reference <em>will</em> be thrown an exception, which, if uncaught, will kill the thread. It really is that simple.</p>\n\n<p>Caveats are that:</p>\n\n<ul>\n<li>You don't know when GC will run, or how aggressive it will be (perhaps the MVar has been promoted to an older generation which is collected infrequently?), so you shouldn't make assumptions about when an object becomes unreachable <em>in the eyes of the runtime</em>. Note that this is true of any runtime value that has become unreachable in a GC language, so it's not really specific to Haskell concurrency.</li>\n<li>It can in theory be difficult to reason about when objects are reachable, especially in the presence of optimizations. Okay, fine.</li>\n</ul>\n\n<p>So, it's perfectly reasonable to use these runtime-triggered exceptions to shut down a thread (and reclaim its memory) that would otherwise be asleep forever, as long as you don't care about the timing of when the thread is shut down and just want some vague assurance that the thread can be shut down at some point when the runtime needs to free up some memory. This is exactly the same sort of reasoning you'd do for any values that pass out of scope in a GC language---at some point, maybe soon, maybe never, maybe an hour from now, the GC will reclaim this memory. If you need tighter control over the timing, etc, don't outsource the task to the GC.</p>\n"}], "owner": {"reputation": 735, "user_id": 961761, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2631f359822e6f25df80319ec3f5dcfe?s=128&d=identicon&r=PG", "display_name": "pchiusano", "link": "https://stackoverflow.com/users/961761/pchiusano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 38333757, "answer_count": 1, "score": 2, "last_activity_date": 1468338915, "creation_date": 1459344477, "question_id": 36310299, "link": "https://stackoverflow.com/questions/36310299/will-a-haskell-thread-be-gcd-if-blocked-indefinitely-on-an-mvar-chan-tqueue-rea", "title": "Will a Haskell thread be GC&#39;d if blocked indefinitely on an MVar/Chan/TQueue read?", "body": "<p>I have a thread which repeatedly takes from an <code>MVar</code>/<code>Chan</code>/<code>TQueue</code>/etc, then does some processing. Will the thread be GC'd if it has the sole remaining reference to this <code>MVar</code>/<code>Chan</code>/<code>TQueue</code>, and so is blocked indefinitely? (Does it matter whether it's an <code>MVar</code>, a <code>Chan</code>, or a <code>TQueue</code>?) And can we <em>rely on</em> this GC to happen? Under what conditions might it not happen?</p>\n\n<p>If the GC doesn't happen or it's considered too fragile, what is the preferred way of shutting down a thread that is blocked on an indefinite read like this?</p>\n"}, {"tags": ["rest", "http", "haskell", "http-headers", "servant"], "answers": [{"comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1459409326, "post_id": 36307597, "comment_id": 60276123, "body": "IIRC, you get <code>Maybe String</code> but this answer is otherwise good."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 4, "last_activity_date": 1459409539, "last_edit_date": 1459409539, "creation_date": 1459337650, "answer_id": 36307597, "question_id": 36307378, "link": "https://stackoverflow.com/questions/36307378/how-can-i-get-access-to-http-headers-in-servant/36307597#36307597", "title": "How can I get access to http headers in Servant?", "body": "<p>Using <code>Header</code> (<a href=\"http://haskell-servant.github.io/tutorial/0.4/server.html\" rel=\"nofollow\">servant</a>)</p>\n\n<pre><code>type API = Header \"Auth-token\" String :&gt; \"items\" :&gt; Get '[JSON] [MyData]\n</code></pre>\n\n<p>then</p>\n\n<pre><code>handler :: Maybe String -&gt; ExceptT ServantErr IO [MyData]\nhandler (Just \"secret-code\") = right [mydata]\nhandler _                    = left $ err403 { errBody = \"no access\" }\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 740, "favorite_count": 0, "accepted_answer_id": 36307597, "answer_count": 1, "score": 2, "last_activity_date": 1459409539, "creation_date": 1459337078, "question_id": 36307378, "link": "https://stackoverflow.com/questions/36307378/how-can-i-get-access-to-http-headers-in-servant", "title": "How can I get access to http headers in Servant?", "body": "<p>I have a simple servant application with rest api:</p>\n\n<pre><code>type API = \"items\" :&gt; Get '[JSON] [MyData]\n\napp :: Application\napp = serve api server\n\napi :: Proxy API\napi = Proxy\n\nserver :: Server API\nserver = getItems\n\ngetItems :: ExceptT ServantErr IO [MyData]\ngetItems = ......\n\nstartApp :: IO ()\nstartApp = run 1234 app\n</code></pre>\n\n<p>How can I get access to http headers and return a certain response, say, http403, depending on a condition?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459336722, "post_id": 36306903, "comment_id": 60238037, "body": "I guess you where looking for <code>...= Input (read $ tokens!!1)</code> ... which will try <code>read</code> the words/tokens from your input-string into your type <code>a</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459336822, "post_id": 36306903, "comment_id": 60238111, "body": "BTW: maybe you should start with a parser which should handle different types of tokens (data-types) first?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459336916, "post_id": 36306903, "comment_id": 60238176, "body": "PS it means that you promised to return a <code>a</code> but then only produced a <code>String</code> - so if I say <code>readCommand &quot;INPUT 12&quot; :: Command Int</code> you should see the problem"}, {"owner": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459337501, "post_id": 36306903, "comment_id": 60238581, "body": "Thank you for your answer, and yes i got many other data-types i just didnt want to post unnecessary info about my problem"}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "edited": false, "score": 0, "creation_date": 1459337685, "post_id": 36307302, "comment_id": 60238722, "body": "Ok, got it, thanks for the help now I understand what was the problem. Thank you!"}, {"owner": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "edited": false, "score": 0, "creation_date": 1459352919, "post_id": 36307302, "comment_id": 60250837, "body": "is there any way to make haskell infer the type of the string?  I mean, for this case is easy because i can simply change the data type and make it expect a String (since it will be variables anyway), but how would you do to make it generic? For instance: if tokens!!1 is 5, make haskell get 5 as an int and not an String"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "edited": false, "score": 1, "creation_date": 1459353246, "post_id": 36307302, "comment_id": 60251064, "body": "@Outer2g Just use <code>read</code>, which has the type <code>Read a =&gt; String -&gt; a</code>."}, {"owner": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "edited": false, "score": 0, "creation_date": 1459353840, "post_id": 36307302, "comment_id": 60251482, "body": "Sorry about my insistence but, how do you use read? It compiles but, when i execute it with string : &quot;INPUT X&quot; : Input *** Exception: Prelude.read::no parse. I know that when using ghci and using read you have to cast it like so : read &quot;X&quot;::String, but I can&#39;t figure out how to use it in code. Thanks for your time"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "edited": false, "score": 0, "creation_date": 1459354206, "post_id": 36307302, "comment_id": 60251739, "body": "@Outer2g <code>read &quot;X&quot; :: String</code> isn&#39;t a cast, it just tells <code>read</code> which type you want when it&#39;s not clear from context. If you use it in a context where a String is needed, you don&#39;t need the type annotation. Anyway the problem isn&#39;t that GHC can&#39;t figure out the type (if it were, you&#39;d get a compile error telling you so), it&#39;s that X is not a valid input for String. If you try <code>read &quot;X&quot; :: String</code> in GHCi, you&#39;ll see that you get the same exception. <code>String</code>&#39;s <code>read</code> instance expects a Haskell-style string, double quotes included. So it&#39;d need to be <code>INPUT &quot;X&quot;</code>, <code>INPUT X</code>. ..."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "edited": false, "score": 0, "creation_date": 1459354297, "post_id": 36307302, "comment_id": 60251807, "body": "@Outer2g ... If you want the syntax to be <code>INPUT X</code>, you can&#39;t use <code>read</code>. You&#39;ll have to create your own <code>Read</code>-style type class that reads values in your specific syntax."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1459336910, "creation_date": 1459336910, "answer_id": 36307302, "question_id": 36306903, "link": "https://stackoverflow.com/questions/36306903/couldnt-match-type-a-with-string/36307302#36307302", "title": "couldn&#39;t match type &#39;a&#39; with &#39;String&#39;", "body": "<p>The error means that if you promise a <code>Command a</code> as the result, you must produce a result of type <code>Command a</code> that the caller of your function requests (as long as it meets the condition <code>Read a</code>). So your type signature allows the following code to compile:</p>\n\n<pre><code>x :: Integer\nx = readCommand \"\"\n\ny :: String\ny = readCommand \"\"\n\nz :: [Double]\nz = readCommand \"\"\n</code></pre>\n\n<p>All of those uses of <code>readCommand</code> are valid according to your type signature, so <code>readCommand</code> needs to be able to produce values of any of those types. The way you defined it, it will always produce a <code>Command String</code>, no matter which type was requested. And since that's not what you promised in your type, you get a compilation error.</p>\n\n<p>If you want to produce <code>Command String</code>s as your result, you need your type to be <code>readCommand :: String -&gt; Command String</code>. If you want your type to be what it is now, you need to actually produce values of the requested type.</p>\n\n<p>Note that you require <code>Read a</code>, but never actually use the <code>read</code> function, which would be the point of requiring <code>Read a</code>.</p>\n"}], "owner": {"reputation": 71, "user_id": 6134269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5f87518494725251a7976aee16e820b?s=128&d=identicon&r=PG&f=1", "display_name": "Outer2g", "link": "https://stackoverflow.com/users/6134269/outer2g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1459336910, "creation_date": 1459335757, "last_edit_date": 1592644375, "question_id": 36306903, "link": "https://stackoverflow.com/questions/36306903/couldnt-match-type-a-with-string", "title": "couldn&#39;t match type &#39;a&#39; with &#39;String&#39;", "body": "<p>I'm doing sort of a compiler in haskell and I came up to this problem:</p>\n<p>This is the code I have for the moment:</p>\n<pre class=\"lang-haskell prettyprint-override\"><code>data Command a = Input a | Print a\n\nreadCommand:: Read a =&gt; String -&gt; Command a\nreadCommand entrada\n    | tokens!!0 == &quot;INPUT&quot; = Input (tokens!!1)\n    | tokens!!0 == &quot;PRINT&quot; = Print (tokens!!1)\n    where\n        tokens = words entrada\n        listInstr = lines entrada\n</code></pre>\n<p>but I get this error:</p>\n<blockquote>\n<p>Couldn't match type 'a' with 'String';\n'a' is a rigid type variable bound by the type signature for readC:: Read a =&gt; String -&gt; Command a</p>\n<p>Expected type: [a] ; Actual type: [String]</p>\n</blockquote>\n<p>Does this error mean that if I declare on the function that I have a string, type 'a' cannot be a String too?</p>\n<p>Thanks for the help</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 6133691, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d12022bcc552642e8dc3a545df1c42e?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rengold", "link": "https://stackoverflow.com/users/6133691/r-rengold"}, "edited": false, "score": 0, "creation_date": 1459330966, "post_id": 36304542, "comment_id": 60233859, "body": "I see. Thank you very much."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1459329566, "creation_date": 1459329566, "answer_id": 36304542, "question_id": 36304413, "link": "https://stackoverflow.com/questions/36304413/haskell-implementing-function-which-extracts-values-from-an-algebraic-data-typ/36304542#36304542", "title": "Haskell - Implementing function which extracts values from an algebraic data type", "body": "<p>First, this is redundant</p>\n\n<pre><code>getHouseNumber :: Person -&gt; Integer\ngetHouseNumber (Person _ houseNumber _) = houseNumber\n</code></pre>\n\n<p>since <code>houseNumber</code> is <em>already</em> defined automatically as a similar projection. We get this from using the record notation in the <code>data</code> declaration. That is, Haskell already automatically defines</p>\n\n<pre><code>houseNumber :: Person -&gt; Integer\nhouseNumber (Person _ hN _) = hN\n</code></pre>\n\n<p>and there's no need to duplicate that. Similarly for <code>borrower</code> and other fields.</p>\n\n<p>About the actual question, we can simply compose the accessors:</p>\n\n<pre><code>getHouseNumberFromBook :: Book -&gt; Integer\ngetHouseNumberFromBook b = houseNumber (borrower b)\n</code></pre>\n\n<p>or, more idiomatically,</p>\n\n<pre><code>getHouseNumberFromBook :: Book -&gt; Integer\ngetHouseNumberFromBook = houseNumber . borrower\n</code></pre>\n\n<p>This is so short that one can probably use its definition directly, without having to define a custom function.</p>\n"}, {"tags": [], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "is_accepted": false, "score": 1, "last_activity_date": 1459329601, "creation_date": 1459329601, "answer_id": 36304554, "question_id": 36304413, "link": "https://stackoverflow.com/questions/36304413/haskell-implementing-function-which-extracts-values-from-an-algebraic-data-typ/36304554#36304554", "title": "Haskell - Implementing function which extracts values from an algebraic data type", "body": "<p>The fields of records are actually functions that extract a value from an ADT. So you have <code>borrower :: Book -&gt; Person</code> and <code>houseNumber :: Person -&gt; Integer</code>. Therefor you can use the composition operator <code>.</code> to create a new function <code>houseNumber . borrower :: Book -&gt; Integer</code>.</p>\n"}], "owner": {"reputation": 183, "user_id": 6133691, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d12022bcc552642e8dc3a545df1c42e?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rengold", "link": "https://stackoverflow.com/users/6133691/r-rengold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 36304542, "answer_count": 2, "score": 0, "last_activity_date": 1459329601, "creation_date": 1459329265, "question_id": 36304413, "link": "https://stackoverflow.com/questions/36304413/haskell-implementing-function-which-extracts-values-from-an-algebraic-data-typ", "title": "Haskell - Implementing function which extracts values from an algebraic data type", "body": "<p>Okay, as someone who came from Object-Oriented programming not a week ago, Haskell is somewhat overwhelming - its likely that this has been answered, but all my research has been fruitless. Please bear with me.</p>\n\n<p>Say that I have two algebraic data types:</p>\n\n<pre><code>data Person = Person {name :: String, houseNumber :: Integer, hasBorrowed :: Bool}\ndata Book   = Book   {borrower :: Person, title :: String}\n</code></pre>\n\n<p>Now, I know that you can simply extract a value from a single algebraic data type with a function:</p>\n\n<pre><code>getHouseNumber :: Person -&gt; Integer\ngetHouseNumber (Person _ houseNumber _) = houseNumber\n\ngetBorrower :: Book -&gt; Person\ngetBorrower (Book borrower _) = borrower\n</code></pre>\n\n<p>My question is (and I swear I'm going to smack myself in the head when I get the answer) how would I write a function which extracts houseNumber (as an example) straight from book? In other words:</p>\n\n<pre><code>getHouseNumberFromBook :: Book -&gt; Integer\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "tuples", "concatenation"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459316448, "post_id": 36300448, "comment_id": 60225309, "body": "what have you tried? You might want to play with <code>groupBy ((==) `on ` fst)</code> using <code>Data.List.groupBy</code> and <code>Data.Function.on</code>"}, {"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459318922, "post_id": 36300448, "comment_id": 60226494, "body": "Thanks, but not giving exactly the result I want. Running the function you suggested gave me on the same list above the following list:  [[(1,[2]),(1,[3]),(1,[4])],[(2,[1]),(2,[2])],[(3,[1])]]  while I want is:  [(1,[2,3,4]), (1,[1,2]), (3,[1])]"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459319018, "post_id": 36300448, "comment_id": 60226545, "body": "well the idea was obviously that you start there and see if you can complete it yourself ... but alas you got 2 spoilers below ;)"}, {"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459320629, "post_id": 36300448, "comment_id": 60227388, "body": "hehe. You are right. Thanks Carsten"}], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "edited": false, "score": 0, "creation_date": 1459320553, "post_id": 36301111, "comment_id": 60227353, "body": "Thanks. This in fact solves my original structure which has the signature [(Int,Int,Int),[Int]). When I raised the question I tried to pose a rather simpler structure."}], "tags": [], "owner": {"reputation": 729, "user_id": 1838505, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0012b91653dc7d12e75c5823bee3d8f2?s=128&d=identicon&r=PG", "display_name": "Shanthakumar", "link": "https://stackoverflow.com/users/1838505/shanthakumar"}, "is_accepted": false, "score": 2, "last_activity_date": 1459319163, "last_edit_date": 1459319163, "creation_date": 1459318702, "answer_id": 36301111, "question_id": 36300448, "link": "https://stackoverflow.com/questions/36300448/concatenating-2nd-element-of-a-tuple-in-a-list-in-haskell/36301111#36301111", "title": "Concatenating 2nd element of a tuple in a list in Haskell", "body": "<pre><code>import Data.List (groupBy)\nimport Data.Function (on)\nimport Control.Arrow ((***))\n\nf  = map ((head *** concat) . unzip) . groupBy ((==) `on` fst)\n</code></pre>\n\n<p>.</p>\n\n<pre><code>&gt; let l =  [(1,[2]), (1,[3]), (1,[4]), (2,[1]), (2,[2]), (3,[1])]\n\n&gt; groupBy ((==) `on` fst) l\n[[(1,[2]),(1,[3]),(1,[4])],[(2,[1]),(2,[2])],[(3,[1])]]\n\n&gt; map unzip $ groupBy ((==) `on` fst) l\n[([1,1,1],[[2],[3],[4]]),([2,2],[[1],[2]]),([3],[[1]])]\n</code></pre>\n\n<p>You can use (***) from Control.Arrow to manipulate tuple</p>\n\n<pre><code>&gt; (pred *** succ) (4,5)\n(3,6)\n\n&gt; let f  = map ((head *** concat) . unzip) . groupBy ((==) `on` fst) \n&gt; f l\n[(1,[2,3,4]),(2,[1,2]),(3,[1])]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "edited": false, "score": 0, "creation_date": 1459320557, "post_id": 36301112, "comment_id": 60227357, "body": "Thanks as well. It worked also on my original structure."}], "tags": [], "owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "is_accepted": false, "score": 1, "last_activity_date": 1459318705, "creation_date": 1459318705, "answer_id": 36301112, "question_id": 36300448, "link": "https://stackoverflow.com/questions/36300448/concatenating-2nd-element-of-a-tuple-in-a-list-in-haskell/36301112#36301112", "title": "Concatenating 2nd element of a tuple in a list in Haskell", "body": "<pre><code>Prelude&gt; :m + Data.Function Data.List    \nPrelude&gt; let xs = [(1,[2]), (1,[3]), (1,[4]), (2,[1]), (2,[2]), (3,[1])]\nPrelude&gt; map (\\lst -&gt; (fst $ head lst, concat $ map snd lst)) (groupBy ((==) `on` fst) xs)\n[(1,[2,3,4]),(2,[1,2]),(3,[1])]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 0, "last_activity_date": 1459377417, "last_edit_date": 1459377417, "creation_date": 1459342991, "answer_id": 36309712, "question_id": 36300448, "link": "https://stackoverflow.com/questions/36300448/concatenating-2nd-element-of-a-tuple-in-a-list-in-haskell/36309712#36309712", "title": "Concatenating 2nd element of a tuple in a list in Haskell", "body": "<p>Note that <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-List.html#v:groupBy\" rel=\"nofollow\"><code>groupBy</code></a> will not group if the keys of the same value are not consecutive. For example:</p>\n\n<pre><code>\\&gt; groupBy (==) [1, 2, 1]\n[[1],[2],[1]]\n</code></pre>\n\n<p>So you need to make sure you pass in a sorted list. \nAn alternative would be to use <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map.html\" rel=\"nofollow\"><code>Data.Map</code></a> and a right fold:</p>\n\n<pre><code>import Data.Map (empty, alter, toList)\n\nfun :: (Foldable t, Ord k) =&gt; t (k, [a]) -&gt; [(k, [a])]\nfun = toList . foldr go empty\n    where\n    go (k, x) acc  = alter (inc x) k acc\n    inc x Nothing  = Just x\n    inc x (Just y) = Just (x ++ y)\n</code></pre>\n\n<p>which will work regardless of the list being sorted or not:</p>\n\n<pre><code>\\&gt; fun [(1,[2]), (1,[3]), (1,[4]), (2,[1]), (2,[2]), (3,[1])]\n[(1,[2,3,4]),(2,[1,2]),(3,[1])]\n\n\\&gt; fun [(3,[1]), (1,[2]), (2,[1]), (1,[3]), (2,[2]), (1,[4])]\n[(1,[2,3,4]),(2,[1,2]),(3,[1])]\n</code></pre>\n"}], "owner": {"reputation": 181, "user_id": 5504664, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-uS2B2l7Eep8/AAAAAAAAAAI/AAAAAAAAAGA/IotCrHH3PYE/photo.jpg?sz=128", "display_name": "Hassan Shahin", "link": "https://stackoverflow.com/users/5504664/hassan-shahin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 732, "favorite_count": 0, "accepted_answer_id": 36309712, "answer_count": 3, "score": 2, "last_activity_date": 1459377417, "creation_date": 1459315927, "last_edit_date": 1459343035, "question_id": 36300448, "link": "https://stackoverflow.com/questions/36300448/concatenating-2nd-element-of-a-tuple-in-a-list-in-haskell", "title": "Concatenating 2nd element of a tuple in a list in Haskell", "body": "<p>I have a list like this:</p>\n\n<pre><code>[(1,[2]), (1,[3]), (1,[4]), (2,[1]), (2,[2]), (3,[1])]\n</code></pre>\n\n<p>what I want is a function that starts with the 1st element in the list and if it finds any other element in the list with a similar (fst) of the tuple then it concatenates the (snd) of the found element to the (snd) of the first element. In the example shown above, the end result would be the following list:</p>\n\n<pre><code>[(1,[2,3,4]), (2,[1,2]), (3,[1])]\n</code></pre>\n\n<p>I have tried many options with no success. Any suggestions? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "anonymous-function", "fibonacci"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459313134, "post_id": 36298976, "comment_id": 60223993, "body": "while I personally enjoy this kind of questions (and it did provoke some good answers) sadly those are not really a good fit for SO - see you don&#39;t really have a problem, you are asking for advice or and code review and I think the codereview site on StackExchange might indeed be a better place for those"}, {"owner": {"reputation": 87, "user_id": 5932056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a7acf33763c5d7d8fd65ed8828b4d06?s=128&d=identicon&r=PG&f=1", "display_name": "JohnZoidberg", "link": "https://stackoverflow.com/users/5932056/johnzoidberg"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459313287, "post_id": 36298976, "comment_id": 60224057, "body": "Oh well, okay. Thank you, I will post such questions there next time."}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 5932056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a7acf33763c5d7d8fd65ed8828b4d06?s=128&d=identicon&r=PG&f=1", "display_name": "JohnZoidberg", "link": "https://stackoverflow.com/users/5932056/johnzoidberg"}, "edited": false, "score": 0, "creation_date": 1459313627, "post_id": 36299031, "comment_id": 60224182, "body": "Thank you for the elegant solution but I was rather looking for a cleaner way of implementing my algorithm."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 5, "last_activity_date": 1459308433, "last_edit_date": 1459308433, "creation_date": 1459308017, "answer_id": 36299031, "question_id": 36298976, "link": "https://stackoverflow.com/questions/36298976/good-style-of-haskell-fibonacci-function/36299031#36299031", "title": "Good Style of Haskell Fibonacci Function", "body": "<p>You can't get prettier than this</p>\n\n<pre><code>fibs = 1:1:zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>and use as for any n</p>\n\n<pre><code>take n fibs\n</code></pre>\n\n<p>Or, if you want to implement from basics, perhaps better to define n'th Fibonacci number first</p>\n\n<pre><code>fib 1 = 1\nfib 2 = 1                                      \nfib n = fib (n-1) + fib (n-2)\n</code></pre>\n\n<p>and the series will be simply</p>\n\n<pre><code>map fib [1..n]\n</code></pre>\n\n<p>notice that the performance will be terrible for any large n.</p>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1459309007, "creation_date": 1459309007, "answer_id": 36299203, "question_id": 36298976, "link": "https://stackoverflow.com/questions/36298976/good-style-of-haskell-fibonacci-function/36299203#36299203", "title": "Good Style of Haskell Fibonacci Function", "body": "<p>The problem is not with the helper functions, which are perfectly valid. It is certainly common to have such functions, and especially to just define them locally. It is with the list indexing and having to deal with the end of the list where the problem lies. If you really need these operations, then a list is the wrong data structure.</p>\n\n<p>The concept of retrieving the \"last\" two items in the list and adding them is perfectly sound - you just have to deal with the front of the list, and reverse it at the end. So \"last\" becomes \"first\" and you just pattern match.</p>\n\n<pre><code>fibonacci :: Integer -&gt; [Integer]\nfibonacci = reverse . fib where\n  fib n | n &lt; 1 = [] \n  fib 1 = [0]\n  fib 2 = [1,0] \n  fib n = case fib (n-1) of \n            r@(a:b:_) -&gt; a+b:r\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 87, "user_id": 5932056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a7acf33763c5d7d8fd65ed8828b4d06?s=128&d=identicon&r=PG&f=1", "display_name": "JohnZoidberg", "link": "https://stackoverflow.com/users/5932056/johnzoidberg"}, "edited": false, "score": 0, "creation_date": 1459313513, "post_id": 36299220, "comment_id": 60224135, "body": "Wow thank you so much. This is exactly what I was hoping for. Seeing the eolution of my initial code taught me quite a lot."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1459326647, "post_id": 36299220, "comment_id": 60230880, "body": "Oh, man, those two reverses... it would be much better to have a Fibonacci function that simply returns the answers in the other order. If necessary, call it <code>fibonacci&#39;</code> and write <code>fibonacci = reverse . fibonacci&#39;</code> so that you only get one reverse per call to <code>fibonacci</code> instead of two reverses for every element in the result."}], "tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": true, "score": 3, "last_activity_date": 1459309118, "creation_date": 1459309118, "answer_id": 36299220, "question_id": 36298976, "link": "https://stackoverflow.com/questions/36298976/good-style-of-haskell-fibonacci-function/36299220#36299220", "title": "Good Style of Haskell Fibonacci Function", "body": "<p>Perhaps use the <code>let</code> keyword. It allows you to bind variables (including functions) that will only be in scope for the expression:</p>\n\n<pre><code>&gt; let x = 3 in x + 2\n5\n</code></pre>\n\n<p>Here <code>x</code> is bound to three before <code>x + 2</code> is evaluated, giving five.</p>\n\n<p>You can do something similar with your example:</p>\n\n<pre><code>fibonacci :: Integer -&gt; [Integer]\nfibonacci 1 = [0]\nfibonacci 2 = fibonacci 1 ++ [1]\nfibonacci n = let\n  addLastTwo :: (Num a) =&gt; [a] -&gt; a\n  addLastTwo xs = last xs + (xs !! ((length xs) - 2))\n\n  appendSumOfLastTwo :: (Num a) =&gt; [a] -&gt; [a]\n  appendSumOfLastTwo xs = xs ++ [addLastTwo xs]\n in appendSumOfLastTwo (fibonacci (n - 1))\n</code></pre>\n\n<p>Let's see if we can do better. We can also use <code>where</code> as syntactic sugar to improve readability. This keyword behaves exactly like <code>let ... in ...</code> except if you have a lot of variables to bind and a relatively short expression, it may be more readable:</p>\n\n<pre><code>fibonacci :: Integer -&gt; [Integer]\nfibonacci 1 = [0]\nfibonacci 2 = fibonacci 1 ++ [1]\nfibonacci n = appendSumOfLastTwo (fibonacci (n - 1))\n  where\n    addLastTwo :: (Num a) =&gt; [a] -&gt; a\n    addLastTwo xs = last xs + (xs !! ((length xs) - 2))\n\n    appendSumOfLastTwo :: (Num a) =&gt; [a] -&gt; [a]\n    appendSumOfLastTwo xs = xs ++ [addLastTwo xs]\n</code></pre>\n\n<p>OK, there is definitely room for improvement here. We are still not \"thinking with portals\" with respect to how to approach some of our functions. In particular, <code>addLastTwo</code> can be significantly improved with pattern matching:</p>\n\n<pre><code>addLastTwo :: (Num a) =&gt; [a] -&gt; a\naddLastTwo (x:y:[]) = x + y\naddLastTwo (_:rest) = addLastTwo rest\naddLastTwo _ = error \"List has less than two elements!\"\n</code></pre>\n\n<p>This reduces the number of iterations of the list down to one from three (one for <code>last</code>, one for <code>length</code>, and up to one for <code>!!</code>).</p>\n\n<p>Furthermore, it's much easier to append to the head of a list than it is to append to the end of it. You can always <code>reverse</code> the list if necessary. Anytime you write <code>list ++ [elem]</code> think about whether or not you actually mean <code>elem : list</code>.</p>\n\n<p>With that in mind, and a bit more pattern matching, a relatively clean version of your algorithm would look something like this:</p>\n\n<pre><code>fibonacci :: Integer -&gt; [Integer]\nfibonacci 1 = [0]\nfibonacci 2 = [0, 1]\nfibonacci n = reverse $ (x + y) : upToN\n  where\n    upToN@(x:y:_) = reverse $ fibonacci (n - 1)\n</code></pre>\n\n<p>Here, the <code>@</code> character binds a variable to a pattern. In the example above, <code>upToN</code> will be bound to the list <code>[x, y, ...]</code>, but also <code>x</code> and <code>y</code> will be in scope.</p>\n\n<p>I suggest you also take some time to see why @karakfa's answer works, and why it would be faster than the approach you've taken. </p>\n"}, {"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 4, "last_activity_date": 1459312844, "creation_date": 1459312844, "answer_id": 36299847, "question_id": 36298976, "link": "https://stackoverflow.com/questions/36298976/good-style-of-haskell-fibonacci-function/36299847#36299847", "title": "Good Style of Haskell Fibonacci Function", "body": "<p>Perhaps closest to your original design, but with linear performance, is to use <code>iterate</code> with a pair of numbers as the state:</p>\n\n<pre><code>almostFibs :: [(Integer, Integer)]\nalmostFibs = iterate (\\(x, y) -&gt; (y, x + y)) (0, 1)\n</code></pre>\n\n<p>This gives you a pair of \"previous\" and \"current\" values:</p>\n\n<pre><code>Prelude&gt; take 10 almostFibs\n[(0,1),(1,1),(1,2),(2,3),(3,5),(5,8),(8,13),(13,21),(21,34),(34,55)]\n</code></pre>\n\n<p>To really get <code>fibs</code>, you just drop the \"previous\" value:</p>\n\n<pre><code>fibs :: [Integer]\nfibs = map snd almostFibs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1459326323, "creation_date": 1459326323, "answer_id": 36303412, "question_id": 36298976, "link": "https://stackoverflow.com/questions/36298976/good-style-of-haskell-fibonacci-function/36303412#36303412", "title": "Good Style of Haskell Fibonacci Function", "body": "<p>I think the most idiomatic approach would be to generate the infinite list and then take the first <code>n</code> elements, as others have suggested.</p>\n\n<p>Otherwise, generating the <em>reversed</em> sequence of the first <code>n</code> fibonacci numbers also looks fine. This allows to add \"a number at the end of the list\" by simply prepending a new element.</p>\n\n<p>If instead we prefer to generate the list in the direct order, we could use a recursion as follows:</p>\n\n<pre><code>fibonacci :: Int -&gt; [Int]\nfibonacci n = fib 0 1 n\n   where fib _ _ 0 = []\n         fib a b n = a : fib b (a+b) (n-1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 5516551, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yA1U9.jpg?s=128&g=1", "display_name": "blackjack26", "link": "https://stackoverflow.com/users/5516551/blackjack26"}, "is_accepted": false, "score": 0, "last_activity_date": 1491438070, "creation_date": 1491438070, "answer_id": 43243674, "question_id": 36298976, "link": "https://stackoverflow.com/questions/36298976/good-style-of-haskell-fibonacci-function/43243674#43243674", "title": "Good Style of Haskell Fibonacci Function", "body": "<p>A good way would be to use Haskell's lazy evaluation and generate an infinite list. You can then <code>take</code> how every many numbers you want from that list.</p>\n\n<pre><code>fibonacci :: [Integer]\nfibonacci = 1 : scanl (+) 1 fibonacci\n</code></pre>\n\n<p>Once you have this function, you can retrieve how ever many elements <code>n</code> that you need.</p>\n\n<pre><code>&gt; take 7 fibonacci\n[1,1,2,3,5,8,13]\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 5932056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a7acf33763c5d7d8fd65ed8828b4d06?s=128&d=identicon&r=PG&f=1", "display_name": "JohnZoidberg", "link": "https://stackoverflow.com/users/5932056/johnzoidberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "accepted_answer_id": 36299220, "answer_count": 6, "score": 2, "last_activity_date": 1491438070, "creation_date": 1459307705, "last_edit_date": 1459308616, "question_id": 36298976, "link": "https://stackoverflow.com/questions/36298976/good-style-of-haskell-fibonacci-function", "title": "Good Style of Haskell Fibonacci Function", "body": "<p>I am just learning Haskell and tried implementing a function for getting a list containing the first N fibonacci numbers:</p>\n\n<pre><code>fibonacci :: Integer -&gt; [Integer]\nfibonacci 1 = [0]\nfibonacci 2 = fibonacci 1 ++ [1]\nfibonacci n = appendSumOfLastTwo (fibonacci (n - 1))\n\nappendSumOfLastTwo :: (Num a) =&gt; [a] -&gt; [a]\nappendSumOfLastTwo xs = xs ++ [addLastTwo xs]\n\naddLastTwo :: (Num a) =&gt; [a] -&gt; a\naddLastTwo xs = last xs + (xs !! ((length xs) - 2))\n</code></pre>\n\n<p>This works but is not really pretty since it requires two helper functions with weird names. Is it common in Haskell to have such singularly used functions?</p>\n\n<p>To get rid of these functions I tried anonymous functions:</p>\n\n<pre><code>fibonacci :: Integer -&gt; [Integer]\nfibonacci 1 = [0]\nfibonacci 2 = fibonacci 1 ++ [1]\nfibonacci n = (\\xs -&gt; xs ++ [(\\xs -&gt; last xs + (xs !! ((length xs) - 2))) xs]) (fibonacci ( n - 1))\n</code></pre>\n\n<p>But that is not really much better since its almost completely unreadable.</p>\n\n<p>What would you guys think? How could I structure my code the best?</p>\n"}, {"tags": ["haskell", "pattern-synonyms"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459305258, "post_id": 36298407, "comment_id": 60221660, "body": "The existence of these pattern synonyms, and their potential for disastrous effects on efficiency, makes me suspect that they should be controlled by type classes that exist purely to mark efficient implementations. Like <code>class Unsnoc a c =&gt; EfficientUnsnoc a c</code>, where <code>Unsnoc</code> gives you <code>unsnoc :: c -&gt; a</code> while <code>EfficientUnsnoc</code> is the required context for matching <code>:&gt;</code>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1459303836, "creation_date": 1459303836, "answer_id": 36298407, "question_id": 36298328, "link": "https://stackoverflow.com/questions/36298328/how-would-we-take-the-last-value-of-a-list-using-colon-notation/36298407#36298407", "title": "How would we take the last value of a list using colon notation?", "body": "<p>The Haskell datatype <code>[a]</code> represents lists as a singly-linked cons list: the pattern match <code>x:xs</code> is not merely notation, but that's really how it is stored in memory, as a cons of the head and the rest.</p>\n\n<p>As you mentioned in your update, you can write a function which goes through a list and splits it into an init part and a last element:</p>\n\n<pre><code>unsnoc :: [a] -&gt; Maybe ([a], a)\n</code></pre>\n\n<p>You can use a <a href=\"https://ocharles.org.uk/blog/posts/2014-12-02-view-patterns.html\" rel=\"nofollow\">view pattern</a> to use it in pattern matching:</p>\n\n<pre><code>f (unsnoc -&gt; Just (xs, x)) = ...\nf [] = ...\n</code></pre>\n\n<p>And you can even wrap it into a <a href=\"https://ocharles.org.uk/blog/posts/2014-12-03-pattern-synonyms.html\" rel=\"nofollow\">pattern synonym</a>:</p>\n\n<pre><code>pattern xs :&gt; x &lt;- (unsnoc -&gt; Just (xs, x))\n</code></pre>\n\n<p>(or the bidirectional version</p>\n\n<pre><code>pattern xs :&gt; x &lt;- (unsnoc -&gt; Just (xs, x)) where\n  xs :&gt; x = xs ++ [x]\n</code></pre>\n\n<p>)</p>\n\n<p>allowing you to write</p>\n\n<pre><code>f (xs :&gt; x) = ...\nf [] = ...\n</code></pre>\n\n<p>Note however that all these approaches still require traversing the spine of the whole list, since they are all ultimately just calling your <code>unsnoc</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1459304035, "creation_date": 1459304035, "answer_id": 36298437, "question_id": 36298328, "link": "https://stackoverflow.com/questions/36298328/how-would-we-take-the-last-value-of-a-list-using-colon-notation/36298437#36298437", "title": "How would we take the last value of a list using colon notation?", "body": "<p>For an arbitrary list you can't but for a fixed size list you can pattern match to the last element (or any other arbitrary element), for example</p>\n\n<pre><code>lastof4 [_,_,_,x] = x\n\nlastof4 [1..4]\n4\n</code></pre>\n"}], "owner": {"reputation": 659, "user_id": 6067119, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/893dbce2becf20ee2a3dcb6dee6ea5f2?s=128&d=identicon&r=PG&f=1", "display_name": "Qwertford", "link": "https://stackoverflow.com/users/6067119/qwertford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1459304035, "creation_date": 1459303274, "last_edit_date": 1459303600, "question_id": 36298328, "link": "https://stackoverflow.com/questions/36298328/how-would-we-take-the-last-value-of-a-list-using-colon-notation", "title": "How would we take the last value of a list using colon notation?", "body": "<p>Say we have a list in the parameter and pattern match on its head and tail separately so we use <code>x:xs</code>. This means that the inputs are split into a value <code>x</code> and a list <code>xs</code>. </p>\n\n<p>So whatever is before the colon is treated as a single value and whatever is last in the colon notation will be the rest of the list with the single value <code>x</code> removed.</p>\n\n<p>But what if I wanted to separate the last value from the rest of the values? It seems that this notation cant be used.</p>\n\n<p>Update: i think i know how i would be able to find the last number using recursion, but is the true that you can't simply get it through some kind of pattern matching?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1459290972, "post_id": 36296090, "comment_id": 60217573, "body": "Forgive my ignorance, but what&#39;s <code>Apply</code> <i>for</i>, exactly? It seems far less useful than <code>Applicative</code> because <code>Apply</code> lacks a unit: when you&#39;re smashing things together, you typically want something to smash them into."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1459291215, "post_id": 36296090, "comment_id": 60217655, "body": "@BenjaminHodgson, sometimes there isn&#39;t one. Notable examples (see the documentation for <code>Apply</code>) include <code>Map k</code> and <code>IntMap</code>, but also, e.g., <code>Const (NonEmpty a)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1459300245, "post_id": 36296090, "comment_id": 60220324, "body": "Taking the &quot;functors as containers&quot; analogy, it <i>seems</i> like one should always be able to implement <code>Apply</code>: simply count up the number of contained elements in the two arguments, pick the container shape of the smaller one (on ties defaulting, say, left), and fill in the container entries in a zip-y way. But this is just an intuition, I&#39;m afraid, not a proof."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1459304832, "post_id": 36296090, "comment_id": 60221536, "body": "@DanielWagner, based on the blog post <a href=\"http://bartoszmilewski.com/2014/01/14/functors-are-containers/\" rel=\"nofollow noreferrer\">Functors are Containers</a> by Bartosz Milewski, along with your latest comment, one potentially promising choice of functor might be an infinite sum of infinite products, where (somehow) comparison of cardinalities among the cases is never computable. So there&#39;d be no way to come up with an injection from one argument to the other, or to choose something smaller than both. This is all very hand-wavy, of course, and departs the nice world of inductive types."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1459525928, "post_id": 36296090, "comment_id": 60340722, "body": "@DanielWagner How do you zip together <code>(Real -&gt; a)</code> and  <code>((Real -&gt; Bool) -&gt; a)</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1459527132, "post_id": 36296090, "comment_id": 60341461, "body": "@Cirdec, I believe you do it by producing an injection from <code>Real</code> to <code>Real -&gt; Bool</code>, assuming that&#39;s possible in Haskell."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1459542097, "post_id": 36296090, "comment_id": 60349633, "body": "@Cirdec For example: <code>combine :: (a -&gt; b -&gt; c) -&gt; (Real -&gt; a) -&gt; ((Real -&gt; Bool) -&gt; b) -&gt; (Real -&gt; c); combine with f g = \\r -&gt; with (f r) (g (r ==))</code>. Substitute your favorite decidable function of type <code>Real -&gt; Real -&gt; Bool</code> if you don&#39;t believe <code>(==)</code> is decidable -- even <code>\\_ _ -&gt; False</code> if absolutely necessary."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1459293980, "post_id": 36296593, "comment_id": 60218605, "body": "<code>Const ()</code> is a bad choice, because <code>Sum (Const ()) f</code> is isomorphic to <code>Compose Maybe f</code>, which has a perfectly good <code>Apply</code> instance whenever <code>f</code> does. But this should work with a <i>non-constant</i> left branch."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1459297371, "post_id": 36296593, "comment_id": 60219611, "body": "A hypothesis: it is not possible to implement <code>instance (Apply f, Apply g) =&gt; Apply (Sum f g)</code>; but for any choice of <code>f</code> and <code>g</code> that are instances of <code>Apply</code> it is possible to implement <code>instance Apply (Sum f g)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1459297618, "post_id": 36296593, "comment_id": 60219677, "body": "@DanielWagner, that sounds plausible, but it would take considerably more theory than I know to prove it if it&#39;s true. Falsifying it will probably be easier, if it&#39;s false."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1459327129, "post_id": 36296593, "comment_id": 60231159, "body": "For <code>Apply</code> <code>f</code> and <code>g</code>, <code>Sum f g</code> is <code>Apply</code> if there exists an <code>Apply</code> homomorphism from <code>f</code> to <code>g</code> or the other way. Source: exercise 1.21 on page 19 <a href=\"https://www.cs.ox.ac.uk/projects/utgp/school/conor.pdf\" rel=\"nofollow noreferrer\">here</a> asks for an analogous proof for <code>Applicative</code>, which is easily adapted for <code>Apply</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1459542213, "post_id": 36296593, "comment_id": 60349703, "body": "@Andr&#225;sKov&#225;cs But this question is about the other direction: when is <code>Sum f g</code> patently <i>not</i> <code>Apply</code>? I doubt very much you can claim that this holds when neither <code>f</code> nor <code>g</code> has an <code>Apply</code> homomorphism to the other -- i.e. I suspect you can argue only that the &quot;obvious&quot; way to instantiate <code>Apply</code> doesn&#39;t work, not that all ways to instantiate <code>Apply</code> don&#39;t work."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1459545318, "post_id": 36296593, "comment_id": 60351318, "body": "@DanielWagner fair enough, I was just throwing this out as something potentially relevant."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1461026573, "post_id": 36296593, "comment_id": 61000977, "body": "@dfeuer On the other hand, Falsifying it will probably be extremely difficult if it turns out to be true. XD"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 10, "last_activity_date": 1459292898, "last_edit_date": 1459292898, "creation_date": 1459292206, "answer_id": 36296593, "question_id": 36296090, "link": "https://stackoverflow.com/questions/36296090/is-there-a-functor-that-cannot-be-a-law-abiding-apply/36296593#36296593", "title": "Is there a Functor that cannot be a law-abiding Apply?", "body": "<p>The \"sum\" of two functors (<a href=\"http://hackage.haskell.org/package/transformers-0.4.2.0/docs/Data-Functor-Sum.html#t:Sum\"><code>Data.Functor.Sum</code></a> from <code>transformers</code>) seems to be an example.</p>\n\n<p>One can easily map over one branch or the other, but how to implement <code>&lt;.&gt;</code> when the function-in-the-functor and the argument-in-the-functor lie in different branches?</p>\n\n<pre><code>ghci&gt; import Data.Functor.Sum\nghci&gt; import Data.Functor.Identity\nghci&gt; let f = InL (Const ())   :: Sum (Const ()) Identity (Int -&gt; Int)\nghci&gt; let x = InR (Identity 5) :: Sum (Const ()) Identity Int\nghci$ f &lt;.&gt; x = ..... ?\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459352893, "post_id": 36312580, "comment_id": 60250822, "body": "I was mostly curious about whether there is a <i>specific</i> functor (i.e., a type constructor) of this sort. That said, a result about constraints on a parameterized one could be interesting, if you were able to produce one."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 4, "last_activity_date": 1459349830, "creation_date": 1459349830, "answer_id": 36312580, "question_id": 36296090, "link": "https://stackoverflow.com/questions/36296090/is-there-a-functor-that-cannot-be-a-law-abiding-apply/36312580#36312580", "title": "Is there a Functor that cannot be a law-abiding Apply?", "body": "<p>This isn't exactly what you're looking for, but it's close so I thought I'd share it. The standard <code>Writer</code> monad has an extra constraint on its <code>Apply</code> instance (namely, that the <code>w</code> type be an instance of <code>Monoid</code> or <code>Semigroup</code>) that the <code>Functor</code> instance does not, so that <code>Writer Foo</code> is a <code>Functor</code> but not <code>Apply</code> if <code>Foo</code> is not a <code>Semigroup</code>/<code>Monoid</code>:</p>\n\n<pre><code>data Writer w a = Writer w a\n\ninstance Monoid w =&gt; Apply (Writer w) where\n  Writer w1 f &lt;.&gt; Writer w2 x = Writer (mappend w1 w2) (f x)\n</code></pre>\n\n<p>However, this isn't really an example of what you're asking for, because it's actually possible to create a law-abiding instance of <code>Apply</code> without a <code>Monoid</code> constraint:</p>\n\n<pre><code>instance Apply (Writer w) where\n  Writer w1 f &lt;.&gt; Writer w2 x = Writer w1 (f x)\n</code></pre>\n\n<p>The problem with this instance is that it does not allow for a matching <code>Applicative</code> instance, since there would be no way to implement <code>pure</code> such that you get a left identity, that is:</p>\n\n<pre><code>pure id &lt;.&gt; x /= x\n</code></pre>\n\n<p>This is just a long-ish way of giving you the same answer you already had from Conor: a demonstration that relies on <code>pure</code> to break the instance.</p>\n"}, {"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1461026854, "post_id": 36440023, "comment_id": 61001039, "body": "Here is a value that is neither inhabited nor isomorphic to <code>Void</code>: <code>forall a. Either a (a -&gt; Void)</code>. This is because Haskell&#39;s type system corresponds for the most part to intuitionistic logic. Intuitionistic logic specifically lacks that statement as an axiom or theorem, but since it is a subset of classical logical it doesn&#39;t contain its negation either."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1461027210, "post_id": 36440023, "comment_id": 61001116, "body": "@PyRulez, I wouldn&#39;t be surprised if Haskell were anti-classical. That is, I wouldn&#39;t be surprised if you <i>could</i> refute that. Certainly, Idris can refute it, and earlier versions of Agda. Agda tweaked things a bit to be consistent with the excluded middle."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1461027356, "post_id": 36440023, "comment_id": 61001153, "body": "@dfeuer How do you refute it in Idris?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1461028238, "post_id": 36440023, "comment_id": 61001406, "body": "@PyRulez, it&#39;s complicated and I don&#39;t understand it. It&#39;s some sort of diagonal argument, IIRC. I think David Christiansen translated it from Agda."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1461032329, "post_id": 36440023, "comment_id": 61002504, "body": "@PyRulez Interesting. I debated pointing out that this requires accepting the law of the excluded middle as well as the axiom of choice, but decided that was too trivial to be worth mentioning. I was wrong."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1461032471, "post_id": 36440023, "comment_id": 61002543, "body": "@Cirdec Feel free to implement it into your answer if you feel so inclined."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463671311, "post_id": 36440023, "comment_id": 62174235, "body": "You may want to check whether/how the new state of affairs described in my update affect this answer."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1463679905, "post_id": 36440023, "comment_id": 62179560, "body": "@dfeuer The proofs for the new laws are trivial for empty data-structures if we notice that <code>f &lt;$&gt; empty = empty</code>. The laws for non-empty structures can be proven simply by using <code>Identity . extract</code> in place of <code>extract</code>, <code>c . runIdentity</code> in place of <code>c</code> and appealing to the proofs for <code>Identity</code>."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1523391831, "post_id": 36440023, "comment_id": 86540006, "body": "As an example of why the law-abiding <code>Apply</code> would sometimes make little practical sense, consider the functor <code>type A a = Either a (a, a)</code>. This is an example of a &quot;data structure that is always non-empty&quot;. Also this is an example of a sum of two functors where there exists a natural transformation from one to the other. However, zipping two values of this functor will discard some data and so makes little intuitive sense: Right (x,y) <code>zip</code> Left(z) = Left((x,z)). We have discarded <code>y</code> here."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1523392807, "post_id": 36440023, "comment_id": 86540479, "body": "@winitzki It&#39;s worse than that. The law-abiding apply I describe is essentially <code>Right (x,y) `zip` Right (a, b) = Left ((x, a))</code>."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1523399529, "post_id": 36440023, "comment_id": 86543179, "body": "This reminds me of the correspondence (Applicative - Monoid) / (Apply - Semigroup). Compared to Monoid, Semigroup is missing the identity and its laws. So there are lots of semigroups, but far fewer monoids. Any type <code>a</code> is a semigroup with a definition of <code>combine</code> such as: a <code>combine</code> b = a, discarding one of the arguments. There are, however, use cases for this kind of thing."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 10, "last_activity_date": 1571544641, "last_edit_date": 1571544641, "creation_date": 1459907140, "answer_id": 36440023, "question_id": 36296090, "link": "https://stackoverflow.com/questions/36296090/is-there-a-functor-that-cannot-be-a-law-abiding-apply/36440023#36440023", "title": "Is there a Functor that cannot be a law-abiding Apply?", "body": "<p>Yes, there are <code>Functor</code>s with no <code>Apply</code> instance. Consider the sum of two functions (which are <a href=\"http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/\" rel=\"nofollow noreferrer\">exponents in algebraic data types</a>):</p>\n\n<pre><code>data EitherExp i j a\n    = ToTheI (i -&gt; a)\n    | ToTheJ (j -&gt; a)\n</code></pre>\n\n<p>There's a <code>Functor</code> instance for all <code>i</code>s and <code>j</code>s:</p>\n\n<pre><code>instance Functor (EitherExp i j) where\n    fmap f (ToTheI g) = ToTheI (f . g)\n    fmap f (ToTheJ g) = ToTheJ (f . g)\n</code></pre>\n\n<p>but there's no <code>Apply</code> instance for all <code>i</code>s and <code>j</code>s</p>\n\n<pre><code>instance Apply (EitherExp i j) where\n    ...\n    ToTheI f &lt;.&gt; ToTheJ x = ____\n</code></pre>\n\n<p>There's no way to fill in the blank <code>____</code> with an <code>i -&gt; b</code> or a <code>j -&gt; b</code> when all you have is <code>f :: i -&gt; a -&gt; b</code> and <code>x :: j -&gt; a</code>. To do so we'd have to know something about <code>i</code> and <code>j</code>, but there's no way to look inside every type <code>i</code> or <code>j</code> in Haskell. Intuition rejects this answer; if you know <em>anything</em> about <code>i</code> or <code>j</code>, like that they are inhabited by a single value, then you can write an <code>Apply</code> instance for <code>EitherExp</code></p>\n\n<pre><code>class Inhabited a where\n    something :: a\n\ninstance (Inhabited i, Inhabited j) =&gt; Apply (EitherExp i j) where\n    ...\n    ToTheI f &lt;.&gt; ToTheJ x = ToTheI (const ((f something) (x something)))\n</code></pre>\n\n<p>But we don't know that every <code>i</code> and every <code>j</code> is <code>Inhabited</code>. The <a href=\"https://hackage.haskell.org/package/void/docs/Data-Void.html#t:Void\" rel=\"nofollow noreferrer\"><code>Void</code></a> type isn't inhabited by anything. We don't even have a way to know that every type is either <code>Inhabited</code> or <code>Void</code>. </p>\n\n<p>Our intuition is actually very good; when we can inspect how types are constructed, for algebraic data types there are no <code>Functor</code>s that don't have <code>Apply</code> instances. What follow are two answers that might be more pleasing to our intuition.</p>\n\n<h2>No ...</h2>\n\n<p>... for algebraic data types. There are 3 possibilities. The structure is void, the structure can be empty, or the structure can't be empty. If the structure is void then it's <a href=\"https://hackage.haskell.org/package/void-0.7.1/docs/Data-Void.html#v:absurd\" rel=\"nofollow noreferrer\"><code>absurd</code></a>ly an <code>Apply</code>. If it can be empty, chose any empty instance and return it constantly for any apply. If it can't be empty then it's a sum of structures that each can't be empty, a law-abiding apply can be made by applying one of the values<sup>\u2020</sup> from the first to one of the values from the second and returning it in some constant structure.</p>\n\n<p>The apply law is very lax. Apply doesn't need to make any sense. It doesn't need to be \"zip-y\". It doesn't need to be <code>fmap</code> when combined with things suspiciously like <code>pure</code> from <code>Applicative</code>; there's no notion of <code>pure</code> with which to write a law requiring it to make sense.</p>\n\n<h3>When the structure can be empty</h3>\n\n<p>Chose any empty instance and return it constantly for any apply</p>\n\n<pre><code>u &lt;.&gt; v = empty\n</code></pre>\n\n<p>Proof</p>\n\n<pre><code>  (.) &lt;$&gt; u  &lt;.&gt; v  &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w)\n(((.) &lt;$&gt; u) &lt;.&gt; v) &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w) -- by infixl4 &lt;$&gt;, infixl4 &lt;.&gt;\n(_                ) &lt;.&gt; w = u &lt;.&gt; (_      ) -- by substitution\n                    empty = empty           -- by definition of &lt;.&gt;\n</code></pre>\n\n<h3>When the structure can't be empty</h3>\n\n<p>If the structure <code>f</code> can't be empty, there exists a function <code>extract :: forall a. f a -&gt; a</code>. Choose another function <code>c :: forall a. a -&gt; f a</code> that always constructs the same non-empty structure populated with the argument everywhere and define:</p>\n\n<pre><code>u &lt;.&gt; v = c (extract u $ extract v)\n</code></pre>\n\n<p>With the free theorems</p>\n\n<pre><code>extract (f &lt;$&gt; u) = f (extract u)\nextract . c = id\n</code></pre>\n\n<p>Proof</p>\n\n<pre><code>  (.) &lt;$&gt; u  &lt;.&gt; v  &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w)\n(((.) &lt;$&gt; u) &lt;.&gt; v) &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w) -- by infixl4 &lt;$&gt;, infixl4 &lt;.&gt;\n(c (extract ((.) &lt;$&gt; u) $ extract v)) &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w) -- by definition\n(c ((.) (extract u)     $ extract v)) &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w) -- by free theorem \nc (extract (c ((.) (extract u) $ extract v)) $ extract w) = u &lt;.&gt; (v &lt;.&gt; w) -- by definition\nc (           ((.) (extract u) $ extract v)  $ extract w) = u &lt;.&gt; (v &lt;.&gt; w) -- by extract . c = id\nc (((.) (extract u) $ extract v) $ extract w) = u &lt;.&gt; c (extract v $ extract w) -- by definition\nc (((.) (extract u) $ extract v) $ extract w) = c (extract u $ extract (c (extract v $ extract w))) -- by definition\nc (((.) (extract u) $ extract v) $ extract w) = c (extract u $            (extract v $ extract w) ) -- by extract . c = id\nlet u' = extract u\n    v' = extract v\n    w' = extract w\nc (((.) u' $ v') $ w') = c (u' $ (v' $ w'))\nc ((u' . v') $ w') = c (u' $ (v' $ w')) -- by definition of partial application of operators\nc (u' $ (v' $ w')) = c (u' $ (v' $ w')) -- by definition of (.)\n</code></pre>\n\n<p>A little more deserves to be said about defining <code>extract</code> for the exponential types, functions. For a function <code>i -&gt; a</code> there are two possibilities. Either <code>i</code> is inhabited or it isn't. If it is inhabited, choose some inhabitant <code>i</code><sup>\u2020</sup> and define</p>\n\n<pre><code>extract f = f i\n</code></pre>\n\n<p>If <code>i</code> is uninhabited (it's void) then <code>i -&gt; a</code> is the unit type with the single value <code>absurd</code>. <code>Void -&gt; a</code> is just another elaborate empty type that doesn't hold any <code>a</code>s; treat it as a structure that can be empty.</p>\n\n<h3>When the structure is void</h3>\n\n<p>When the structure is void there are no ways to construct it. We can write a single function from every possible construction (there are none to pass to it) to any other type.</p>\n\n<pre><code>absurd :: Void -&gt; a\nabsurd x = case x of {}\n</code></pre>\n\n<p>Void structures can be <code>Functor</code>s with <code>fmap f = absurd</code>. In the same way they can have an <code>Apply</code> instance with </p>\n\n<pre><code>(&lt;.&gt;) = absurd\n</code></pre>\n\n<p>We can trivially prove that for all <code>u</code>, <code>v</code>, and <code>w</code></p>\n\n<pre><code>(.) &lt;$&gt; u  &lt;.&gt; v  &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w)\n</code></pre>\n\n<p>There are no <code>u</code>, <code>v</code>, or <code>w</code> and the claim is <a href=\"https://en.wikipedia.org/wiki/Vacuous_truth\" rel=\"nofollow noreferrer\">vacuously true</a>.</p>\n\n<hr>\n\n<p><sup>\u2020</sup>With some caveats about accepting the axiom of choice to choose an index <code>a</code> for the exponential type <code>a -&gt; b</code></p>\n\n<hr>\n\n<h3>Yes ...</h3>\n\n<p>... for Haskell. Imagine there's another base <code>Monad</code> other than <code>IO</code>, let's call it <code>OI</code>. Then <code>Sum IO OI</code> is a <code>Functor</code> but can never be an <code>Apply</code>.</p>\n\n<p>... for the real world. If you have a machine to which you can send functions (or arrows in a category other than <b>Hask</b>), but cannot combine two of the machines together or extract their running state, then they are a Functor with no Apply.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 2, "accepted_answer_id": 36440023, "answer_count": 3, "score": 23, "last_activity_date": 1571544641, "creation_date": 1459289810, "last_edit_date": 1495535497, "question_id": 36296090, "link": "https://stackoverflow.com/questions/36296090/is-there-a-functor-that-cannot-be-a-law-abiding-apply", "title": "Is there a Functor that cannot be a law-abiding Apply?", "body": "<p>A <a href=\"https://stackoverflow.com/questions/36274369/what-are-some-types-that-discriminate-between-categories\">recent question</a> asked generally about boundaries between various Haskell classes. I came up with <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Exception.html#t:Handler\" rel=\"nofollow noreferrer\"><code>Handler</code></a> as an example of a valid <code>Functor</code> with no <em>sensible</em> instance of <a href=\"https://hackage.haskell.org/package/semigroupoids-5.0.1/docs/Data-Functor-Apply.html#g:2\" rel=\"nofollow noreferrer\"><code>Apply</code></a>**, where</p>\n\n<pre><code>class Functor f =&gt; Apply f where\n  (&lt;.&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n  -- optional bits omitted.\n</code></pre>\n\n<p>However, I've not yet been able to find an example of a valid <code>Functor</code> that cannot be made a <em>valid</em> (if senseless) instance of <code>Apply</code>. The fact that <code>Apply</code> <strike>has</strike> had (see update) but a single law,</p>\n\n<pre><code>(.) &lt;$&gt; u &lt;.&gt; v &lt;.&gt; w = u &lt;.&gt; (v &lt;.&gt; w)\n</code></pre>\n\n<p>seems to make this rather tricky.</p>\n\n<p>pigworker (Conor McBride) previously <a href=\"https://stackoverflow.com/a/7220865/1477667\">gave an example</a> of a <code>Functor</code> that is not <code>Applicative</code>, but he relied on <code>pure</code> to do so, and that's not available in <code>Apply</code>.</p>\n\n<p>** Then later I realized there actually might be a sensible (although slightly strange) <code>Apply</code> instance for <code>Handler</code>, that conceptually collects simultaneous exceptions.</p>\n\n<hr>\n\n<h3>Update</h3>\n\n<p>Edward Kmett has now <a href=\"https://github.com/ekmett/semigroupoids/commit/b500ec11c973332c25d987e9a3b00ce842f02c52\" rel=\"nofollow noreferrer\">accepted</a> two additional laws I proposed for <code>Apply</code> (to validate optimizations I made to the <code>Apply (Coyoneda f)</code> instance):</p>\n\n<pre><code>x &lt;.&gt; (f &lt;$&gt; y) = (. f) &lt;$&gt; x &lt;.&gt; y\nf &lt;$&gt; (x &lt;.&gt; y) = (f .) &lt;$&gt; x &lt;.&gt; y\n</code></pre>\n\n<p>It would be interesting to see whether these additions change the answer to this question.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1459287725, "post_id": 36295436, "comment_id": 60216263, "body": "This is caused by the <code>maybe d lookup x</code> in the recursive call.  I wouldn&#39;t twice do a <code>lookup</code> and fix it back with <code>maybe</code>... why not just do one single pattern matching?"}], "answers": [{"tags": [], "owner": {"reputation": 3629, "user_id": 808237, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e0eac050c6be0999da0c97c4aec4554e?s=128&d=identicon&r=PG", "display_name": "Tair", "link": "https://stackoverflow.com/users/808237/tair"}, "is_accepted": false, "score": 1, "last_activity_date": 1459290979, "last_edit_date": 1459290979, "creation_date": 1459289022, "answer_id": 36295941, "question_id": 36295436, "link": "https://stackoverflow.com/questions/36295436/create-a-haskell-function-that-receives-a-list-of-pairs-and-create-a-new-one-wit/36295941#36295941", "title": "Create a haskell function that receives a list of pairs and create a new one with new data and existing data", "body": "<p>This is what you need</p>\n\n<pre><code>getPairOfXAxesAndY :: (Num a, Ord a) =&gt; [(a,a)] -&gt; [(a,a)]\ngetPairOfXAxesAndY [] = []\ngetPairOfXAxesAndY xs = fillPairs (0,0) xs\n  where fillPairs _ [] = []\n        fillPairs (a,b) ((c,d):ys) | a &lt; c     = (a,b) : fillPairs (a+1,b) ((c,d):ys)\n                                   | otherwise = (c,d) : fillPairs (c+1,d) ys\n</code></pre>\n"}], "owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1459290979, "creation_date": 1459286954, "last_edit_date": 1459287330, "question_id": 36295436, "link": "https://stackoverflow.com/questions/36295436/create-a-haskell-function-that-receives-a-list-of-pairs-and-create-a-new-one-wit", "title": "Create a haskell function that receives a list of pairs and create a new one with new data and existing data", "body": "<p>i\u00b4m creating a haskell function that do the next:</p>\n\n<blockquote>\n  <p>given [(3,5),(6,9),(8,0)] \n  return [(0,0),(1,0),(2,0),(3,5),(4,5),(5,5),(6,9),(7,9)(8,0)]</p>\n</blockquote>\n\n<p>So, a list of tuples with keys from 0 to max of list argument first pair value, and second value for pairs would be 0 until first element of argument list doesn\u00b4t appears as key for current element of second list, from that moment, keep the last value used for second pair element until match the next one.</p>\n\n<p>I hope its well explained:</p>\n\n<p>This is my function</p>\n\n<pre><code>getPairOfXAxesAndY :: [(a,a)] -&gt; [(a,a)]\ngetPairOfXAxesAndY [] = []\ngetPairOfXAxesAndY list = getSizes list 0\n    where getSizes((x, h):[]) d = (x, h)\n          getSizes((x, h):rl) d = (x, maybe d (+0) (lookup x ((x, h):rl))) : getSizes rl (maybe d lookup x)\n</code></pre>\n\n<p>But im getting this errors:</p>\n\n<pre><code>Skyline.hs:39:22:\n    Couldn't match expected type \u2018[(a, a)]\u2019\n                with actual type \u2018(Maybe a0, [(a0, b0)] -&gt; Maybe b0)\u2019\n    Relevant bindings include\n      list :: [(a, a)] (bound at Skyline.hs:39:15)\n      dibujaSkyline :: [(a, a)] -&gt; [(a, a)] (bound at Skyline.hs:38:1)\n    In the expression: getAlturas list 0\n    In an equation for \u2018dibujaSkyline\u2019:\n        dibujaSkyline list\n          = getAlturas list 0\n          where\n              getAlturas ((x, h) : []) d = (x, h)\n              getAlturas ((x, h) : rl) d\n                = (x, maybe d (+ 0) (lookup x ((x, h) : rl)))\n                  : getAlturas rl (maybe d lookup x)\n\nSkyline.hs:41:37:\n    Couldn't match expected type \u2018(Maybe a1, [(a1, b)] -&gt; Maybe b)\u2019\n                with actual type \u2018[(Maybe a1, [(a1, b)] -&gt; Maybe b)]\u2019\n    Relevant bindings include\n      d :: [(a1, b)] -&gt; Maybe b (bound at Skyline.hs:41:33)\n      rl :: [(Maybe a1, [(a1, b)] -&gt; Maybe b)]\n        (bound at Skyline.hs:41:29)\n      h :: [(a1, b)] -&gt; Maybe b (bound at Skyline.hs:41:26)\n      x :: Maybe a1 (bound at Skyline.hs:41:23)\n      getAlturas :: [(Maybe a1, [(a1, b)] -&gt; Maybe b)]\n                    -&gt; ([(a1, b)] -&gt; Maybe b) -&gt; (Maybe a1, [(a1, b)] -&gt; Maybe b)\n        (bound at Skyline.hs:40:11)\n    In the expression:\n      (x, maybe d (+ 0) (lookup x ((x, h) : rl)))\n      : getAlturas rl (maybe d lookup x)\n    In an equation for \u2018getAlturas\u2019:\n        getAlturas ((x, h) : rl) d\n          = (x, maybe d (+ 0) (lookup x ((x, h) : rl)))\n            : getAlturas rl (maybe d lookup x)\n    In an equation for \u2018dibujaSkyline\u2019:\n        dibujaSkyline list\n          = getAlturas list 0\n          where\n              getAlturas ((x, h) : []) d = (x, h)\n              getAlturas ((x, h) : rl) d\n                = (x, maybe d (+ 0) (lookup x ((x, h) : rl)))\n                  : getAlturas rl (maybe d lookup x)\n\nSkyline.hs:41:80:\n    Couldn't match expected type \u2018[(Maybe a1, [(a1, b)] -&gt; Maybe b)]\u2019\n                with actual type \u2018(Maybe a1, [(a1, b)] -&gt; Maybe b)\u2019\n    Relevant bindings include\n      d :: [(a1, b)] -&gt; Maybe b (bound at Skyline.hs:41:33)\n      rl :: [(Maybe a1, [(a1, b)] -&gt; Maybe b)]\n        (bound at Skyline.hs:41:29)\n      h :: [(a1, b)] -&gt; Maybe b (bound at Skyline.hs:41:26)\n      x :: Maybe a1 (bound at Skyline.hs:41:23)\n      getAlturas :: [(Maybe a1, [(a1, b)] -&gt; Maybe b)]\n                    -&gt; ([(a1, b)] -&gt; Maybe b) -&gt; (Maybe a1, [(a1, b)] -&gt; Maybe b)\n        (bound at Skyline.hs:40:11)\n    In the second argument of \u2018(:)\u2019, namely\n      \u2018getAlturas rl (maybe d lookup x)\u2019\n    In the expression:\n      (x, maybe d (+ 0) (lookup x ((x, h) : rl)))\n      : getAlturas rl (maybe d lookup x)\nFailed, modules loaded: none.\nPrelude&gt; \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 3, "creation_date": 1459281784, "post_id": 36293798, "comment_id": 60213249, "body": "I&#39;d tend to write it as <code>onlyOneEl e = \\ x -&gt; ... where ...</code> and see if that helped."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459283456, "post_id": 36293798, "comment_id": 60214186, "body": "Are you compiling with optimizations enabled?"}, {"owner": {"reputation": 763, "user_id": 3799609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3143d9049a55a963685c987503743964?s=128&d=identicon&r=PG&f=1", "display_name": "Ten", "link": "https://stackoverflow.com/users/3799609/ten"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1459283600, "post_id": 36293798, "comment_id": 60214255, "body": "@LouisWasserman That looks indeed like the solution, but as I&#39;m not an expert in Haskell, could you detail more ? :) Having optimizations enabled doesn&#39;t change anything"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459283603, "post_id": 36293798, "comment_id": 60214257, "body": "From an elegance standpoint, <code>Data.List.group</code> is kind of a disgusting function. I would recommend using <a href=\"https://hackage.haskell.org/package/semigroups-0.18.1/docs/Data-List-NonEmpty.html#g:5\" rel=\"nofollow noreferrer\">Data.List.NonEmpty.group</a> instead, since it prevents you from having to use a partial function (<code>Prelude.head</code>) to inspect the result. <code>Data.List.NonEmpty.head</code>, in contrast, is perfectly safe."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459285402, "post_id": 36293798, "comment_id": 60215192, "body": "Also, <code>fromJust</code> shouldn&#39;t be used in real code."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1459285486, "post_id": 36293798, "comment_id": 60215235, "body": "@Ten it&#39;s simply that GHC is only able to inline functions where the left-hand side is fully-applied in the brain-dead syntactic sense. By doing that eta conversion GHC is likely moving the body of <code>onlyOneEl</code> into <code>multipleProducts</code>"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1459285631, "creation_date": 1459285631, "answer_id": 36295098, "question_id": 36293798, "link": "https://stackoverflow.com/questions/36293798/haskell-force-evaluation-avoid-garbage-collecting-when-composing-functions/36295098#36295098", "title": "Haskell : force evaluation/avoid garbage collecting when composing functions", "body": "<p>The definition</p>\n\n<pre><code>onlyOneEl e x = fromJust (lookup x counts) == 1\n    where gs = group (sort e)\n          counts = zip (map head gs) (map length gs)\n</code></pre>\n\n<p>says \"given <code>e</code> and <code>x</code>, set up the computations of <code>gs</code> and <code>counts</code> and use their (lazily calculated) results to calculate the expression <code>fromJust (lookup x counts) == 1</code>. You could write it completely equivalently as</p>\n\n<pre><code>onlyOneEl e x =\n  let gs = ...\n      counts = ...\n  in fromJust ...\n</code></pre>\n\n<p>On the other hand, if you move the <code>x</code> over to the other side with a lambda expression,</p>\n\n<pre><code>onlyOneEl e = \\x -&gt; fromJust ...\n  where ...\n</code></pre>\n\n<p>then you pull <code>gs</code> and <code>counts</code> into an outer scope. This code is equivalent to</p>\n\n<pre><code>onlyOneEl e =\n  let gs = ...\n      counts = ...\n  in \\x -&gt; fromJust ...\n</code></pre>\n\n<p>So <code>gs</code> and <code>counts</code> will only be calculated once per application of <code>onlyOneEl</code> to a single argument.</p>\n\n<p>GHC supports a transformation called \"full laziness\" that does this kind of modification, which it applies when it thinks it will be a good idea. Apparently, GHC made the wrong judgement in this case.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1459286086, "last_edit_date": 1459286086, "creation_date": 1459285647, "answer_id": 36295107, "question_id": 36293798, "link": "https://stackoverflow.com/questions/36293798/haskell-force-evaluation-avoid-garbage-collecting-when-composing-functions/36295107#36295107", "title": "Haskell : force evaluation/avoid garbage collecting when composing functions", "body": "<p>You can rewrite it with little more goal oriented.  Without getting into math, just with generation of data and filtering you can achieve the same with much less computation.</p>\n\n<p>When you generate the product, add the multipliers to the tuple as well, i.e.</p>\n\n<pre><code>combi n = [((x,y),x*y) | x&lt;-[2..n], y&lt;-[x..n]]\n</code></pre>\n\n<p>now you can sort and group based on product</p>\n\n<pre><code>multi = filter ((&gt;1) . length) . groupBy ((==) `on` snd) . sortBy (comparing snd) . combi\n</code></pre>\n\n<p>and extract the first element of the tuple, which will be the (x,y) pair to give same product more than once.</p>\n\n<pre><code>map (map fst) (multi 100)\n</code></pre>\n\n<p>if you don't care about the grouping, you can flatten the result, i.e.</p>\n\n<pre><code>concatMap (map fst) (multi 100)\n</code></pre>\n"}], "owner": {"reputation": 763, "user_id": 3799609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3143d9049a55a963685c987503743964?s=128&d=identicon&r=PG&f=1", "display_name": "Ten", "link": "https://stackoverflow.com/users/3799609/ten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 36295098, "answer_count": 2, "score": 3, "last_activity_date": 1459286086, "creation_date": 1459280901, "last_edit_date": 1459283419, "question_id": 36293798, "link": "https://stackoverflow.com/questions/36293798/haskell-force-evaluation-avoid-garbage-collecting-when-composing-functions", "title": "Haskell : force evaluation/avoid garbage collecting when composing functions", "body": "<p>I was looking for an elegant way to write this code :</p>\n\n<pre><code>import Data.List\nimport Data.Maybe\n\ncombi = [(x,y) | x &lt;- [2..100], y &lt;- [x..100]]\n\ngsp = group (sort [x*y | (x,y) &lt;- combi])\ncounts = zip (map head gsp) (map length gsp)\n\nmultipleProducts x = (fromJust (lookup x counts)) &gt; 1\npossibleComb1 = [(x,y) | (x,y) &lt;- combi, multipleProducts (x*y)]\n</code></pre>\n\n<p>As I am reusing the same pattern multiple times but based on different input sets than <code>[x*y | (x,y) &lt;- combi]</code>, I came out with this code.</p>\n\n<pre><code>import Data.List\nimport Data.Maybe\n\ncombi = [(x,y) | x &lt;- [2..100], y &lt;- [x..100]]\n\nonlyOneEl e x = (fromJust (lookup x counts)) == 1\n    where gs = group (sort e)\n          counts = zip (map head gs) (map length gs)\n\nmultipleProducts = not.(onlyOneEl [x*y |\u00a0(x,y) &lt;- combi])\npossibleComb1 = [(x,y) | (x,y) &lt;- combi, multipleProducts (x*y)]\n</code></pre>\n\n<p>However, Haskell seems to compute <code>gs</code> and <code>count</code> for every single time I call multipleProducts, taking a very big amount of time, instead of computing it only once, since the value of e is always the same with multipleProducts.</p>\n\n<p>What is the most elegant way of avoiding the recalculation ?\nIs there anything better than pre-calculating <code>counts</code> using one function and storing it in a local variable, and then passing it to <code>onlyOneEl</code> without the where ?</p>\n\n<p>Because I'm later reusing <code>onlyOneEl</code> based on different sets, and I wanted to avoid having multiple <code>counts</code> variables.</p>\n\n<p>I understood <a href=\"https://wiki.haskell.org/Let_vs._Where#Problems_with_where\" rel=\"nofollow\">here</a> why it did not evaluate it once per function, however, I do not use x as my last argument, and thus cannot do it exactly this way.</p>\n\n<p>Thanks in advance !</p>\n"}, {"tags": ["macos", "haskell", "emacs", "haskell-mode"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459281365, "post_id": 36293346, "comment_id": 60213013, "body": "does <code>C-c C-l</code> load it into the REPL? Is <code>&#39;haskell-process-type</code> set to <code>auto</code>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459281455, "post_id": 36293346, "comment_id": 60213077, "body": "btw: maybe you should update to a current <code>haskell-mode</code> - not sure when <code>stack</code>-support was included but maybe you got an older version - also: why is there a <code>stack.cabal</code>? It&#39;s <code>stack.yaml</code> right?"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459310800, "post_id": 36295691, "comment_id": 60223251, "body": "it was probably only your path-variable ^^ so restarting emacs (really restarting) and/or the shell you used would probably have been fine too (check with <code>which stack</code>) ;)"}, {"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459311075, "post_id": 36295691, "comment_id": 60223326, "body": "@Carsten I reproduced it from scratch after. M-x getenv ENT PATH immediately showed the missing path. That was fixable by logout.  Running the interactive shell needed a separate fix in .emacs <code>(setq exec-path (append exec-path &#39;(&quot;&#47;usr&#47;local&#47;bin&quot;)))</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459311193, "post_id": 36295691, "comment_id": 60223361, "body": "that&#39;s strange as emacs should use your existing path (maybe the order is wrong - is pointing <code>which stack</code> to the right one) - anyway the most important thing is that it&#39;s working for you again ;)"}, {"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459311384, "post_id": 36295691, "comment_id": 60223418, "body": "@Carsten Yep.  It&#39;s now solid.  I&#39;m partly conflating things here as that setq step is related to the fact that I&#39;m now using bitemyapp&#39;s .emacs and .emacs.d/ from <a href=\"https://github.com/bitemyapp/dotfiles\" rel=\"nofollow noreferrer\">github.com/bitemyapp/dotfiles</a>."}], "tags": [], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "is_accepted": true, "score": 0, "last_activity_date": 1459287984, "creation_date": 1459287984, "answer_id": 36295691, "question_id": 36293346, "link": "https://stackoverflow.com/questions/36293346/how-do-you-get-emacs-haskell-mode-to-find-modules-in-other-hs-source-dirs/36295691#36295691", "title": "How do you get Emacs haskell-mode to find modules in other hs-source-dirs?", "body": "<p>The greatest horror is that I fixed this by rebooting.</p>\n\n<p>I appear to have triggered it by breaking the path to Stack.  The path changed from my original manual install to <code>~/Applications/bin/stack</code> to <code>~/.local/bin/stack</code>.  I knew that had changed so I closed and relaunched Emacs, but the problem persisted.</p>\n\n<p>Rebooting fixed it.  This brings me sadness.  I imagine logging out might have worked just as well.</p>\n"}], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 36295691, "answer_count": 1, "score": 0, "last_activity_date": 1459288125, "creation_date": 1459279428, "last_edit_date": 1459288125, "question_id": 36293346, "link": "https://stackoverflow.com/questions/36293346/how-do-you-get-emacs-haskell-mode-to-find-modules-in-other-hs-source-dirs", "title": "How do you get Emacs haskell-mode to find modules in other hs-source-dirs?", "body": "<p><strong>UPDATE: clarified that this is on Mac OS X</strong></p>\n\n<p>I'm using Emacs Prelude (which uses <strong>haskell-mode</strong>) on Mac OS X and I've created a project with <code>stack new hello</code>.</p>\n\n<p>The project it generates is like this:</p>\n\n<ul>\n<li>hello:\n\n<ul>\n<li>LICENSE</li>\n<li>Setup.hs</li>\n<li>hello.cabal</li>\n<li>stack.cabal</li>\n<li>app:\n\n<ul>\n<li>Main.hs</li>\n</ul></li>\n<li>src:\n\n<ul>\n<li>Lib.hs</li>\n</ul></li>\n<li>test:\n\n<ul>\n<li>Spec.hs</li>\n</ul></li>\n</ul></li>\n</ul>\n\n<p>If I open <strong>Main.hs</strong> in Emacs it shows this:</p>\n\n<pre><code>module Main where\n\nimport Lib\n\nmain :: IO ()\nmain = someFunc\n</code></pre>\n\n<p>But <strong>Lib</strong> is underlined as an error and placing my caret there shows this:</p>\n\n<pre><code>Could not find module 'Lib'\nUse -v to see a list of the files searched for.\n</code></pre>\n\n<p>How do you get Emacs haskell-mode to find modules in other hs-source-dirs?</p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1459275713, "post_id": 36291832, "comment_id": 60209517, "body": "If newtype confuses you then I suggest you read a tutorial or two and hang out on #haskell at irc.freenode.net to ask questions.  Are the concepts of algebraic data types new to you?  It&#39;s ok to say yes!  I&#39;ve found this concept confuses many people I when I discuss Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "edited": false, "score": 0, "creation_date": 1459275009, "post_id": 36291863, "comment_id": 60209058, "body": "Do not understand a lick of what this thing does though. But I guess that is something for another question. Will wait with accepting till tomorrow."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1459275342, "post_id": 36291863, "comment_id": 60209288, "body": "It doesn&#39;t really do anything. It&#39;s just a wrapper around a function that takes an argument of type <code>a</code> and returns a value of type <code>b</code>. After, say <code>let f = Combine (\\x -&gt; x + 3)</code>, you could run <code>(unCombine f) 5</code> and it would return 8."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1459275424, "post_id": 36291863, "comment_id": 60209346, "body": "Note that record syntax is <b>not</b> strictly equivalent to the above code. For example using record syntax you can do <code>(Combine id){unCombine=const 1}</code> . That&#39;s just part of what they can do."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 4, "last_activity_date": 1459274736, "creation_date": 1459274736, "answer_id": 36291863, "question_id": 36291832, "link": "https://stackoverflow.com/questions/36291832/what-does-the-type-mean/36291863#36291863", "title": "What does the type mean?", "body": "<p>The braces allow for record syntax. It can be considered short-hand for the following:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>newtype Combine a b = Combine (a -&gt; b)\n\nunCombine :: Combine a b -&gt; (a -&gt; b)\nunCombine (Combine a) = a\n</code></pre>\n\n<p>Record syntax creates the <code>unCombine</code> function for you automatically so you don't have to define it for yourself. It comes in handy when your types have a lot of type parameters.</p>\n"}], "owner": {"reputation": 22825, "user_id": 992687, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/0Da71.png?s=128&g=1", "display_name": "The Unfun Cat", "link": "https://stackoverflow.com/users/992687/the-unfun-cat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 36291863, "answer_count": 1, "score": -1, "last_activity_date": 1459274736, "creation_date": 1459274615, "last_edit_date": 1459274726, "question_id": 36291832, "link": "https://stackoverflow.com/questions/36291832/what-does-the-type-mean", "title": "What does the type mean?", "body": "<p>This is the newtype:</p>\n\n<pre><code>newtype Combine a b = Combine { unCombine :: (a -&gt; b) }\n</code></pre>\n\n<p>I'm having problems understanding many things about this line, but the first is the braces. What are they and what do they do here - create a function from two input datatypes?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 1, "creation_date": 1459274627, "post_id": 36291686, "comment_id": 60208785, "body": "You also have some non-exhaustive patters. Try compiling with <code>-Wall</code> to see those before they cause runtime errors."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459276124, "post_id": 36291686, "comment_id": 60209751, "body": "If you want your helper function to only handle the case where there&#39;s at least one element, make that element a separate argument to the helper function so it&#39;s clear that it will always be there. Your main function should certainly handle the empty case somehow."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1504684453, "post_id": 36291686, "comment_id": 79099892, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/8561762/haskell-parse-error-in-pattern\">Haskell: Parse error in pattern</a>"}], "answers": [{"comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 45, "user_id": 5359459, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bd7f3429c8082bd7ca2fdb2c726de132?s=128&d=identicon&r=PG&f=1", "display_name": "gprex", "link": "https://stackoverflow.com/users/5359459/gprex"}, "edited": false, "score": 1, "creation_date": 1459274485, "post_id": 36291714, "comment_id": 60208718, "body": "It works here: <a href=\"http://rextester.com/KHHM55458\" rel=\"nofollow noreferrer\">rextester.com/KHHM55458</a>. All that was changed is the parentheses around <code>(l:ls)</code>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1459274878, "post_id": 36291714, "comment_id": 60208970, "body": "Well it won&#39;t work on empty lists if that&#39;s the only change you make."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1459274277, "creation_date": 1459274277, "answer_id": 36291714, "question_id": 36291686, "link": "https://stackoverflow.com/questions/36291686/haskell-says-parse-error/36291714#36291714", "title": "Haskell says parse error", "body": "<p>You are missing parentheses around your pattern matching for countmin. Change it to:</p>\n\n<pre><code>countmin (l:ls) = ...\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 5359459, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bd7f3429c8082bd7ca2fdb2c726de132?s=128&d=identicon&r=PG&f=1", "display_name": "gprex", "link": "https://stackoverflow.com/users/5359459/gprex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1459274806, "creation_date": 1459274196, "last_edit_date": 1459274806, "question_id": 36291686, "link": "https://stackoverflow.com/questions/36291686/haskell-says-parse-error", "title": "Haskell says parse error", "body": "<pre><code>smallestNumberH (x:xs) n = if(xs==[])then n else (if(x&lt;n) then smallestNumberH xs x else smallestNumberH xs n)\nsmallestNumber (x:xs) = smallestNumberH (x:xs) x\ncountmin::[Int]-&gt;Int\ncountmin l:ls = if (ls==[]) then 0 else (if(l==smallestNumber ls) then (1 + countmin ls) else (countmin ls))\n</code></pre>\n\n<p>It says \"Parse error in pattern: countmin\". I tried to add l: next to ls but it doesn't work.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1459273817, "post_id": 36291534, "comment_id": 60208256, "body": "OP&#39;s example is missing a base case though."}, {"owner": {"reputation": 93, "user_id": 6062637, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/53f9677f2cd0195df649552b12c1c88f?s=128&d=identicon&r=PG&f=1", "display_name": "JJ chips", "link": "https://stackoverflow.com/users/6062637/jj-chips"}, "edited": false, "score": 0, "creation_date": 1459274025, "post_id": 36291534, "comment_id": 60208399, "body": "How is this different to using an underscore without the colon? I believe you can do pattern matching of say, (Int, String), by just (_ &quot;hello&quot;) can&#39;t you?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1459274176, "post_id": 36291534, "comment_id": 60208503, "body": "The colon is the <a href=\"https://en.wikipedia.org/wiki/Cons\" rel=\"nofollow noreferrer\">cons</a> operator. <code>(x:xs)</code> matches the first item of a list as <code>x</code>, and the rest of the list as <code>xs</code>. Since your function doesn&#39;t use the first item in the list, it ignores it using the underscore."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 93, "user_id": 6062637, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/53f9677f2cd0195df649552b12c1c88f?s=128&d=identicon&r=PG&f=1", "display_name": "JJ chips", "link": "https://stackoverflow.com/users/6062637/jj-chips"}, "edited": false, "score": 0, "creation_date": 1459296536, "post_id": 36291534, "comment_id": 60219356, "body": "@JJchips You must include the <code>,</code> when pattern matching on an <code>(Int, String)</code> because it&#39;s the name of the pair constructor, much like how <code>:</code> is the name of one of the two constructors for lists."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1459273934, "last_edit_date": 1459273934, "creation_date": 1459273768, "answer_id": 36291534, "question_id": 36291482, "link": "https://stackoverflow.com/questions/36291482/what-is-the-xs-notation-in-haskell/36291534#36291534", "title": "What is the (_:xs) notation in haskell?", "body": "<p>The underscore allows you to pattern match but implies that you will not actually be using the value. Your pattern matching is not exhaustive, so it won't actually work. You'll need to define the missing patterns to fix it:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>last_element :: [a] -&gt; a\nlast_element [] = error \"Empty List\"\nlast_element [x] = x\nlast_element (_:xs)= last_element xs\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 6062637, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/53f9677f2cd0195df649552b12c1c88f?s=128&d=identicon&r=PG&f=1", "display_name": "JJ chips", "link": "https://stackoverflow.com/users/6062637/jj-chips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 978, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1459273950, "creation_date": 1459273641, "last_edit_date": 1459273950, "question_id": 36291482, "link": "https://stackoverflow.com/questions/36291482/what-is-the-xs-notation-in-haskell", "title": "What is the (_:xs) notation in haskell?", "body": "<p>I see the function</p>\n\n<pre><code>last_element :: [a] -&gt; a\nlast_element (_:xs)= last_element xs\n</code></pre>\n\n<p>I don't understand the underscore colon in \"(_:xs)\". I read that it seperates the head from the list inputted. Is the underscore colon just removing the first digit, or the \"head\", of the list in a primitive recursive way?</p>\n\n<p>edit, from my understanding, this function would lack a base case. Is this right?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459273019, "post_id": 36290869, "comment_id": 60207786, "body": "It&#39;s really hard to understand what you&#39;re saying about <code>&amp;</code> vs. <code>&amp;amp</code>. Can you expand on that? Also, how did you come to have this list of lazy <code>ByteString</code>s? Does it really make sense for them to be lazy?"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1459273210, "post_id": 36291257, "comment_id": 60207901, "body": "&quot;<i>The authors may have decided that it was too hard to make those functions work efficiently in the lazy case.&quot;</i> Well, given that a lazy bytestring is more or less a <code>[Strict.ByteString]</code>, that&#39;s likely."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1459273432, "post_id": 36291257, "comment_id": 60208040, "body": "@Zeta, yes, but it feels like abdication of their librarianly duties. They, not users, should consider the various implementation techniques and choose the best (for general use). I&#39;d think it best to offer one function for finding a strict <code>ByteString</code> within a lazy one, and another to find a lazy one within a lazy one."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1459272962, "creation_date": 1459272962, "answer_id": 36291257, "question_id": 36290869, "link": "https://stackoverflow.com/questions/36290869/using-filter-elem-on-lazy-byte-strings-in-haskell/36291257#36291257", "title": "using Filter / Elem on Lazy Byte Strings in Haskell", "body": "<p>The usual <code>filter</code> is great for filtering lists. Use it! Unfortunately, the <code>bytestring</code> package doesn't offer nice tools for finding arbitrary substrings of lazy <code>ByteString</code>s, though it does offer such for strict ones. The authors may have decided that it was too hard to make those functions work efficiently in the lazy case. It might be easiest to convert each lazy <code>ByteString</code> to either a strict <code>ByteString</code> or a <code>String</code> and then use the tools in <code>Data.ByteString</code> or <code>Data.List</code> to perform the search. It's pretty hard to understand what you're getting at regarding <code>&amp;amp;</code>, so you'll have to clarify.</p>\n"}], "owner": {"reputation": 2024, "user_id": 2726995, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/43b927bba59dd5210f0f12b705997407?s=128&d=identicon&r=PG&f=1", "display_name": "user2726995", "link": "https://stackoverflow.com/users/2726995/user2726995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1459272962, "creation_date": 1459271827, "question_id": 36290869, "link": "https://stackoverflow.com/questions/36290869/using-filter-elem-on-lazy-byte-strings-in-haskell", "title": "using Filter / Elem on Lazy Byte Strings in Haskell", "body": "<p>I am attempting to scrape a web site using the Scalpel Library and have returned a list of byte strings that I am having trouble filtering on. </p>\n\n<p>I have a list of Lazy Byte Strings, for example: </p>\n\n<pre><code> [\"&lt;a href=\\\"?ep=17&amp;amp;fmt=0\\\"&gt;Jerk&lt;/a&gt;\", \"&lt;a href=\\\"?fmt=0&amp;amp;yr=1997\\\" onmouseover=\\\"img_hov('t1997')\\\" onmouseout=\\\"img_norm('t1997')\\\"&gt;&lt;img src=\\\"image/1997.gif\\\" alt=\\\"1997\\\" width=\\\"84\\\" height=\\\"43\\\" name=\\\"t1997\\\" border=\\\"0\\\"&gt;&lt;/a&gt;\"]\n</code></pre>\n\n<p>and I want to filter this list to find only the lazy byte strings that contain 'ep=' </p>\n\n<p>I also need to have the &amp; symbol in the string not &amp;amp</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1459282648, "post_id": 36290449, "comment_id": 60213746, "body": "You say repetition is allowed, but you don&#39;t include <code>[3,3,3,7,7,7]</code> as one of the lists that adds up to 30 in your example. If that&#39;s not what you mean by repetition, what <i>do</i> you mean?"}, {"owner": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1459305869, "post_id": 36290449, "comment_id": 60221860, "body": "I meant that a number can appear in two combinations, for example 13 appears twice in [[13,17],[3,5,9,13]]. I think I shouldn&#39;t have said that because it is obvious that we can use a number in two combinations so I will remove it."}], "answers": [{"comments": [{"owner": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "edited": false, "score": 0, "creation_date": 1459270931, "post_id": 36290574, "comment_id": 60206553, "body": "But that is cheating :). I want to do it using just primitive recursion."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1459270982, "last_edit_date": 1459270982, "creation_date": 1459270847, "answer_id": 36290574, "question_id": 36290449, "link": "https://stackoverflow.com/questions/36290449/haskell-function-that-outputs-all-combinations-within-the-input-list-that-add-to/36290574#36290574", "title": "Haskell function that outputs all combinations within the input list that add to the input number", "body": "<p>You can use <code>subsequences</code> from <code>Data.List</code> to give you every possible combination of values, then filter based on your requirement that they add to 30.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>myFunc :: [Integer] -&gt; Integer -&gt; [[Integer]]\nmyFunc list sm =\n  filter (\\x -&gt; sum x == sm) $ subsequences list\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 2, "creation_date": 1459271251, "post_id": 36290655, "comment_id": 60206744, "body": "This would be a good base for writing a more efficient function, which cuts the subset building process when the resulting list is already greater than the target result."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 2, "last_activity_date": 1459272280, "last_edit_date": 1459272280, "creation_date": 1459271098, "answer_id": 36290655, "question_id": 36290449, "link": "https://stackoverflow.com/questions/36290449/haskell-function-that-outputs-all-combinations-within-the-input-list-that-add-to/36290655#36290655", "title": "Haskell function that outputs all combinations within the input list that add to the input number", "body": "<p>Write a function to create all subsets</p>\n\n<pre><code>f [] = [[]]\nf (x:xs) = f xs ++ map (x:) (f xs)\n</code></pre>\n\n<p>then use the filter</p>\n\n<pre><code>filter ((==30) . sum) $ f [3,7,5,9,13,17]\n\n[[13,17],[3,5,9,13]]\n</code></pre>\n\n<p>as suggested by @Ingo you can prune the list while it's generated, for example</p>\n\n<pre><code>f :: (Num a, Ord a) =&gt; [a] -&gt; [[a]]\nf [] = [[]]\nf (x:xs) = f xs ++ (filter ((&lt;=30) . sum) $ map (x:) $ f xs)\n</code></pre>\n\n<p>should work faster than generating all 2^N elements.</p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 1, "last_activity_date": 1459272005, "last_edit_date": 1459272005, "creation_date": 1459271498, "answer_id": 36290770, "question_id": 36290449, "link": "https://stackoverflow.com/questions/36290449/haskell-function-that-outputs-all-combinations-within-the-input-list-that-add-to/36290770#36290770", "title": "Haskell function that outputs all combinations within the input list that add to the input number", "body": "<p>Here is an alternate solution idea: Generate a list of lists that sum up to the target number, i.e.:</p>\n\n<pre><code>[30]\n[29,1]\n[28,2]\n[28,1,1]\n...\n</code></pre>\n\n<p>and only then filter the ones that could be build from your given list.</p>\n\n<p>Pro: could be much faster, especially if your input list is long and your target number comparatively small, such that the list of list of summands is much smaller than the list of subsets of your input list.</p>\n\n<p>Con: does only work when 0 is not in the game.</p>\n\n<p>Finally, you can it do both ways and write a function that decides which algorthm will be faster given some input list and the target number.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1459282252, "post_id": 36291398, "comment_id": 60213543, "body": "I&#39;m not totally convinced by your last sentence. You indeed don&#39;t create any <code>[a]</code> lists, but you do end up creating a linked list of thunks like <code>(a:) &lt;$&gt; (b:) &lt;$&gt; (c:) &lt;$&gt; ...</code>, which only get thrown away once <code>...</code> is discovered to be an empty list after all. So while as you say, you don&#39;t create any lists, you do seem to spend as much time and memory on these thunks as you would on a list anyway."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1459285535, "post_id": 36291398, "comment_id": 60215248, "body": "@amalloy you can benchmark <code>fun [1..24] 17</code> to see it for yourself. with <code>ghc --make -O2</code> the <code>filter ... subsequences</code> solution is 3 times slower than above right fold approach (ghc 7.10.3)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1459286168, "post_id": 36291398, "comment_id": 60215547, "body": "Seeing that it&#39;s faster can&#39;t tell me <i>why</i> it&#39;s faster. It still seems to me like you are allocating one thunk for each cons that you might or might not do."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1459286619, "post_id": 36291398, "comment_id": 60215763, "body": "@amalloy no that is not true! in <code>[1..24]</code> for all sub-sequences that start with 1 (which are <code>2^23</code> many of them) I only create <i>one single thunk</i>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1459286671, "post_id": 36291398, "comment_id": 60215786, "body": "Aha! Okay, I get it now. Thanks for clearing that up."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 2, "last_activity_date": 1459280751, "last_edit_date": 1459280751, "creation_date": 1459273368, "answer_id": 36291398, "question_id": 36290449, "link": "https://stackoverflow.com/questions/36290449/haskell-function-that-outputs-all-combinations-within-the-input-list-that-add-to/36291398#36291398", "title": "Haskell function that outputs all combinations within the input list that add to the input number", "body": "<p>An alternative would be to use a right fold:</p>\n\n<pre><code>fun :: (Foldable t, Num a, Eq a) =&gt; t a -&gt; a -&gt; [[a]]\nfun = foldr go $ \\a -&gt; if a == 0 then [[]] else []\n    where go x f a = f a ++ ((x:) &lt;$&gt; f (a - x))\n</code></pre>\n\n<p>then,</p>\n\n<pre><code>\\&gt; fun [3,7,5,9,13,17] 30\n[[13,17],[3,5,9,13]]\n\n\\&gt; fun [3,7,5,9,13,17] 12\n[[7,5],[3,9]]\n</code></pre>\n\n<p>An advantage of this approach is that it does <em>not</em> create any lists <em>unless</em> it adds up to the desired value.\nWhereas, an approach based on filtering, will create all the possible sub-sequence lists only to drop most of them during filtering step.</p>\n"}], "owner": {"reputation": 601, "user_id": 6005857, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/10940e23bda8cf7bbc35957025ef3348?s=128&d=identicon&r=PG&f=1", "display_name": "user6005857", "link": "https://stackoverflow.com/users/6005857/user6005857"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1168, "favorite_count": 1, "accepted_answer_id": 36290655, "answer_count": 4, "score": 1, "last_activity_date": 1459305881, "creation_date": 1459270446, "last_edit_date": 1459305881, "question_id": 36290449, "link": "https://stackoverflow.com/questions/36290449/haskell-function-that-outputs-all-combinations-within-the-input-list-that-add-to", "title": "Haskell function that outputs all combinations within the input list that add to the input number", "body": "<p>I want to write a function in haskell that takes a list of integers and an integer value as input and outputs a list of all the lists that contain combinations of elements that add up to the input integer.</p>\n\n<p>For example:</p>\n\n<p>myFunc [3,7,5,9,13,17] 30 = [[13,17],[3,5,9,13]]</p>\n\n<p>Attempt:</p>\n\n<pre><code>myFunc :: [Integer] -&gt; Integer -&gt; [[Integer]]\nmyFunc list sm = case list of\n    [] -&gt; []\n    [x]\n        | x == sm -&gt; [x]\n        | otherwise -&gt; []\n    (x : xs)\n        | x + myFunc xs == sm -&gt; [x] ++ myFunc[xs]\n        | otherwise -&gt; myFunc xs\n</code></pre>\n\n<p>My code produces just one combination and that combination must be consecutive, which is not what I want to achieve</p>\n"}, {"tags": ["haskell", "pattern-matching", "parse-error"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1459267230, "post_id": 36289190, "comment_id": 60204073, "body": "Basically he cant know what is the length of the list and <code>++</code> is actually a function so you cant pattern match against it, Haskell pattermatch constructors for example."}, {"owner": {"reputation": 2559, "user_id": 2660970, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/31deb30c1f8cf14c92fdf597e38568a8?s=128&d=identicon&r=PG", "display_name": "ig-melnyk", "link": "https://stackoverflow.com/users/2660970/ig-melnyk"}, "edited": false, "score": 0, "creation_date": 1459267243, "post_id": 36289190, "comment_id": 60204083, "body": "maybe because it&#39;s ambiguously?"}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1459267413, "post_id": 36289190, "comment_id": 60204202, "body": "So haskell doesn&#39;t see <code>[x] + [y]</code>, it sees the return value of <code>++</code> which in this case is a list of ambiguous size?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1459267478, "post_id": 36289190, "comment_id": 60204233, "body": "no it just sees the function (<code>(++)</code>) and will stop right there with an syntax-error - just as in your other question"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1459275585, "post_id": 36289346, "comment_id": 60209441, "body": "Indeed! If pattern matching were that magic, I would try something like <code>let foo (isProofOfPneqNP s) = &quot;Eureka! &quot; ++ s in foo True</code> ;-))"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1459278788, "post_id": 36289346, "comment_id": 60211382, "body": "I think this is what the mice build earth for ;)"}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1459328627, "post_id": 36289346, "comment_id": 60232156, "body": "... or <a href=\"https://en.wikipedia.org/wiki/Curry_%28programming_language%29\" rel=\"nofollow noreferrer\">Curry</a> (only to say that such constructs are possible in principle)."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 9, "last_activity_date": 1459267711, "last_edit_date": 1459267711, "creation_date": 1459267223, "answer_id": 36289346, "question_id": 36289190, "link": "https://stackoverflow.com/questions/36289190/using-in-pattern-matching/36289346#36289346", "title": "Using `++` in pattern matching", "body": "<p>let's assume you could pattern-match on <code>++</code> - now think about how you could match this:</p>\n\n<pre><code>a ++ b = [1,2]\n</code></pre>\n\n<p>you could have:</p>\n\n<ul>\n<li><code>a = [1,2]</code>, <code>b = []</code></li>\n<li><code>a = [1]</code>, <code>b = [2]</code></li>\n<li><code>a = []</code>, <code>b = [1,2]</code></li>\n</ul>\n\n<p>now what is the right one?</p>\n\n<hr>\n\n<p>the technical reason is that <code>++</code> is not data-constructor ;)</p>\n\n<hr>\n\n<p>in your specific situation you could use</p>\n\n<pre><code>let describe' all@[x,y] = \"The first letter of \" ++ all ++ \" is \" ++ [x]\n</code></pre>\n\n<p>(which will only match strings with length <em>exactly</em> 2)</p>\n\n<p>or better</p>\n\n<pre><code>let describe' all@(x:_) = \"The first letter of \" ++ all ++ \" is \" ++ [x]\n</code></pre>\n\n<p>(which will match all strings of length at least 1)</p>\n\n<p>a safe version would be this</p>\n\n<pre><code>describe' :: String -&gt; String\ndescribe' \"\"        = \"your input was empty\"\ndescribe' all@(x:_) = \"The first letter of \" ++ all ++ \" is \" ++ [x]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1459267571, "post_id": 36289383, "comment_id": 60204277, "body": "Although, an infix constructor must <i>start</i> with <code>:</code>, so you can at least identify which functions are <i>not</i> constructors. So <code>++</code> is definitely not a constructor, while something like <code>:+</code> <i>might</i> be a constructor."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 6, "last_activity_date": 1459267296, "creation_date": 1459267296, "answer_id": 36289383, "question_id": 36289190, "link": "https://stackoverflow.com/questions/36289190/using-in-pattern-matching/36289383#36289383", "title": "Using `++` in pattern matching", "body": "<p>You may only use constructors in pattern matches. The pattern <code>[x]</code> desugars to the pattern <code>x:[]</code>, where <code>:</code> and <code>[]</code> are both constructors. <code>++</code>, however, is a function. This is a small flaw of the Haskell language design in that we are unable to quickly distinguish between what symbols we have defined as functions and what symbols come to us from their datatype declarations. For a full treatment, see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-580003.17\" rel=\"noreferrer\">section 3 of the Haskell 2010 Language Report</a>.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1504684516, "creation_date": 1459266807, "last_edit_date": 1504684516, "question_id": 36289190, "link": "https://stackoverflow.com/questions/36289190/using-in-pattern-matching", "title": "Using `++` in pattern matching", "body": "<p>Typing the following into a GHC interpreter</p>\n\n<pre><code>let describe' all@([x] ++ [y]) = \"The first letter of \" ++ all ++ \" is \" ++ [x]\n</code></pre>\n\n<p>yields</p>\n\n<blockquote>\n  <p>Parser error in pattern: [x] ++ [y]</p>\n</blockquote>\n\n<p>Why is Haskell unable to match the pattern <code>all@([x] ++ [y])</code> against expressions like <code>\"HI\"</code> or <code>[1,2]</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1459268010, "post_id": 36289136, "comment_id": 60204578, "body": "how do you know that are left-associative?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 1, "creation_date": 1459268218, "post_id": 36289136, "comment_id": 60204708, "body": "You can always go to <a href=\"https://www.haskell.org/hoogle/?hoogle=%3C%24%3E\" rel=\"nofollow noreferrer\">Hoogle</a> and type in the function (e.g. <code>&lt;$&gt;</code>). Then you can look at the package and right by the definition of <code>&lt;$&gt;</code>, you&#39;ll see it listed as <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Functor.html#v:-60--36--62-\" rel=\"nofollow noreferrer\"><code>infixl 4</code></a>. <code>infixl</code> means left-associative, whereas <code>infixr</code> is right-associative."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459271881, "post_id": 36289136, "comment_id": 60207099, "body": "In GHCi, type <code>:i &lt;$&gt;</code>. That will tell you its type, and where it&#39;s defined, and then <code>infixl 4 &lt;$&gt;</code>. The details of what that means are explained in plain language in the <a href=\"https://www.haskell.org/onlinereport/decls.html#fixity\" rel=\"nofollow noreferrer\">Haskell Report</a>."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1459335664, "post_id": 36289136, "comment_id": 60237281, "body": "The <code>4</code> in the fixity declaration sets its precedence in regards to other infix  operators as to which of them gets evaluated first (9 binds most tightly, down to 0, which binds the least). <a href=\"https://www.haskell.org/onlinereport/decls.html#nested\" rel=\"nofollow noreferrer\">See section 4.4.2 here</a> for a more in-depth description as well as a helpful table showing visually the fixity of a number of common operators"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 2, "last_activity_date": 1459266668, "creation_date": 1459266668, "answer_id": 36289136, "question_id": 36289045, "link": "https://stackoverflow.com/questions/36289045/the-application-precedence-for-the-infix-form-for-multiple-expressions/36289136#36289136", "title": "the application precedence for the infix form for multiple expressions", "body": "<p>Both <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> are left-associative, so your numbering is correct. You could also write it using parentheses like this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>(((MyData &lt;$&gt; field) &lt;*&gt; field) &lt;*&gt; field)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 36289136, "answer_count": 1, "score": 0, "last_activity_date": 1459266668, "creation_date": 1459266436, "question_id": 36289045, "link": "https://stackoverflow.com/questions/36289045/the-application-precedence-for-the-infix-form-for-multiple-expressions", "title": "the application precedence for the infix form for multiple expressions", "body": "<p>Say I have this expression:</p>\n\n<pre><code>instance FromRow MyData where\n  fromRow =  MyData &lt;$&gt; field &lt;*&gt; field &lt;*&gt; field \n</code></pre>\n\n<p>I can't undertand the application precedence because everything is written in the infix form. Can you help me? Is this correct?</p>\n\n<pre><code>fromRow =  MyData (1) &lt;$&gt; (2) field  (3) &lt;*&gt;  (4) field  (5) &lt;*&gt;  (6) field \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1459266018, "post_id": 36288888, "comment_id": 60203294, "body": "because the other patter would be equal to <code>(head&#39; x) : _</code> (remember application has the highest precedence) and this would only make sense for an Data-Constructor"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1504685065, "post_id": 36288888, "comment_id": 79100263, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/8561762/haskell-parse-error-in-pattern\">Haskell: Parse error in pattern</a>"}], "answers": [{"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": true, "score": 10, "last_activity_date": 1459354595, "last_edit_date": 1459354595, "creation_date": 1459269059, "answer_id": 36289995, "question_id": 36288888, "link": "https://stackoverflow.com/questions/36288888/why-are-parentheses-needed-with-in-this-context/36289995#36289995", "title": "Why are parentheses needed with `:` in this context?", "body": "<p>In Haskell, function application has higher precedence than any operator, and pattern-matching reflects that.</p>\n\n<p>So, without the parentheses, <code>head' x:_</code> is parsed as <code>(head' x):_</code>, which doesn't make sense in this context, and causes an error.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 36289995, "answer_count": 1, "score": 2, "last_activity_date": 1459354595, "creation_date": 1459265971, "question_id": 36288888, "link": "https://stackoverflow.com/questions/36288888/why-are-parentheses-needed-with-in-this-context", "title": "Why are parentheses needed with `:` in this context?", "body": "<p>Typing the following into a GHC interpreter yields no error:</p>\n\n<pre><code>let head' (x:_) = x\n</code></pre>\n\n<p>But if we remove the parentheses:</p>\n\n<pre><code>let head' x:_ = x\n</code></pre>\n\n<p>...we obtain: </p>\n\n<blockquote>\n  <p>Parse error in pattern: head'</p>\n</blockquote>\n\n<p>Why are the parentheses necessary?</p>\n"}, {"tags": ["linux", "haskell", "xmonad", "xmobar"], "comments": [{"owner": {"reputation": 695, "user_id": 3550459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce58ce9306ba75b9d9ade1ce3e01221a?s=128&d=identicon&r=PG&f=1", "display_name": "deshtop", "link": "https://stackoverflow.com/users/3550459/deshtop"}, "edited": false, "score": 0, "creation_date": 1459466750, "post_id": 36286004, "comment_id": 60312589, "body": "If I understand correctly, only on the first workspace programs will be placed &quot;over&quot; xmobar? I cannot reproduce this with your settings (tested with xterm).  I&#39;d guess you start some other kind of window manager along with xmonad. Try if the behaviour is reproducable when starting xmonad from <code>~&#47;.xsession</code> without any other programs."}, {"owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "edited": false, "score": 0, "creation_date": 1462980269, "post_id": 36286004, "comment_id": 61869222, "body": "I&#39;ve had the same problems when I recompiled xmonad, after that xmobar was always hidden."}, {"owner": {"reputation": 2934, "user_id": 367316, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f09837eb8a4cfaac44c1e08b43f72091?s=128&d=identicon&r=PG", "display_name": "Konrad Eisele", "link": "https://stackoverflow.com/users/367316/konrad-eisele"}, "edited": false, "score": 0, "creation_date": 1465056131, "post_id": 36286004, "comment_id": 62746327, "body": "I think the status bar will drop below the background image. I dont know a fix any than the hard: &quot;lowerOnStart = False&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 2173, "user_id": 970346, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a9321f95a868f4ea30fb9ae960ccea4a?s=128&d=identicon&r=PG", "display_name": "Stephen Niedzielski", "link": "https://stackoverflow.com/users/970346/stephen-niedzielski"}, "reply_to_user": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "edited": false, "score": 4, "creation_date": 1471305205, "post_id": 38838260, "comment_id": 65284117, "body": "I just found out that overrideRedirect may be considered bad practice? This solution works just as well: <a href=\"http://unix.stackexchange.com/a/303242/24690\">unix.stackexchange.com/a/303242/24690</a>"}], "tags": [], "owner": {"reputation": 2173, "user_id": 970346, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a9321f95a868f4ea30fb9ae960ccea4a?s=128&d=identicon&r=PG", "display_name": "Stephen Niedzielski", "link": "https://stackoverflow.com/users/970346/stephen-niedzielski"}, "is_accepted": true, "score": 7, "last_activity_date": 1470689340, "last_edit_date": 1592644375, "creation_date": 1470689340, "answer_id": 38838260, "question_id": 36286004, "link": "https://stackoverflow.com/questions/36286004/xmobar-is-hidden-on-first-xmonad-workspace/38838260#38838260", "title": "XMobar is hidden on first XMonad workspace", "body": "<p>I had the same issue with xmobar v0.24 and xmonad v0.12. I also experienced the problem on all workspaces when quickly recompiling twice (meta-q). I fixed this by setting <code>overrideRedirect</code> to <code>False</code> in my <a href=\"http://projects.haskell.org/xmobar/#quick-start\" rel=\"noreferrer\">.xmobarrc</a>.</p>\n<blockquote>\n<p><strong>overrideRedirect</strong></p>\n<p>If you're running xmobar in a tiling window manager, you might need to set this option to False so that it behaves as a docked application. Defaults to True.</p>\n</blockquote>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6129358"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2298, "favorite_count": 1, "accepted_answer_id": 38838260, "answer_count": 1, "score": 8, "last_activity_date": 1470689340, "creation_date": 1459258671, "last_edit_date": 1459289216, "question_id": 36286004, "link": "https://stackoverflow.com/questions/36286004/xmobar-is-hidden-on-first-xmonad-workspace", "title": "XMobar is hidden on first XMonad workspace", "body": "<p>I installed XMonad and XMobar with configured settings. When I start XMonad a XMobar on any without first workspace is dock and opened programs have place below XMobar, but on first workspace when I open any program XMobar become hidden.\nThese are my XMonad and XMobar configs:</p>\n\n<pre><code>--XMonad:\nimport XMonad\nimport XMonad.Util.Run(spawnPipe)\nimport XMonad.Hooks.DynamicLog\nimport XMonad.Hooks.ManageDocks\nimport XMonad.Util.EZConfig(additionalKeys)\nimport System.IO\nmain = do\n    xmproc &lt;- spawnPipe \"xmobar ~/.xmobarrc\"\n    xmonad $ defaultConfig\n        {  manageHook = manageDocks &lt;+&gt; manageHook defaultConfig\n        , layoutHook = avoidStruts $ layoutHook defaultConfig\n        , logHook = dynamicLogWithPP xmobarPP\n                        { ppOutput = hPutStrLn xmproc\n                        , ppTitle = xmobarColor \"green\" \"\" . shorten 50 \n                        }\n        , borderWidth = 2\n        , terminal = \"terminator\"\n        , normalBorderColor = \"#cccccc\"\n        , focusedBorderColor = \"#cd8b00\"        \n        }\n--XMobar:\nConfig { font = \"-misc-fixed-*-*-*-*-33-*-*-*-*-*-*-*\"\n    , bgColor = \"black\"\n    , fgColor = \"grey\"\n    , position = TopW L 90\n    , commands = [ Run Cpu [\"-L\",\"3\",\"-H\",\"50\",\n                               \"--normal\",\"green\",\"--high\",\"red\"] 10\n                     , Run Memory [\"-t\",\"Mem: &lt;usedratio&gt;%\"] 10\n                     , Run Swap [] 10\n                     , Run Com \"uname\" [\"-s\",\"-r\"] \"\" 36000\n                     , Run Date \"%a %b %_d %Y %H:%M:%S\" \"date\" 10\n                     , Run Com \"~/.xmonad/batt\" [] \"\" 300\n                     , Run StdinReader\n                     ]\n    , sepChar = \"%\"\n    , alignSep = \"}{\"\n    , template = \"%StdinReader% }{ %cpu% | %memory% | %.xmonad/batt% | &lt;fc=#ee9a00&gt;%date%&lt;/fc&gt;\"\n    }\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1459254470, "post_id": 36284181, "comment_id": 60194341, "body": "&quot;Yes&quot;? After all, you can just write your own <code>length</code> and <code>sum</code>. Note that the combination of <code>sum</code> and <code>length</code> usually leads to problems, though."}, {"owner": {"reputation": 93, "user_id": 6062637, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/53f9677f2cd0195df649552b12c1c88f?s=128&d=identicon&r=PG&f=1", "display_name": "JJ chips", "link": "https://stackoverflow.com/users/6062637/jj-chips"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1459254930, "post_id": 36284181, "comment_id": 60194709, "body": "Why would i get problems?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459255326, "post_id": 36284181, "comment_id": 60195018, "body": "because <code>length</code> returns usually an <code>Int</code> and you will get trouble if you try to divide a <code>Float</code> (the sum) by said <code>Int</code>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459255854, "post_id": 36284181, "comment_id": 60195435, "body": "@Carsten: I&#39;m thinking more in terms of <code>average [1..10^10]</code>. See RWH&#39;s chapter on profiling."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459275657, "post_id": 36284181, "comment_id": 60209482, "body": "I&#39;m voting to close this question as off-topic because it&#39;s an assignment, not a programming question."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1459255525, "post_id": 36284646, "comment_id": 60195199, "body": "Too many thunks :p A left fold, with forced evaluation of the intermediate values, would make more sense, here, in my opinion. Richard Bird shows how to do exactly that in chapter 7 of his book <i>Thinking functionally with Haskell</i>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1459255944, "post_id": 36284646, "comment_id": 60195497, "body": "@Jubobs is Bird&#39;s approach equivalent to <code>data Pair a b = Pair !a !b</code> together with <code>foldl&#39;</code>?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1459262740, "post_id": 36284646, "comment_id": 60200903, "body": "@Zeta Essentially, yes."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459280469, "post_id": 36284646, "comment_id": 60212470, "body": "The current code still isn&#39;t strict enough. You force the pairs, but not their components."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1459340570, "post_id": 36284646, "comment_id": 60240689, "body": "@ChadGilbert What dfeuer means is that <code>foldl&#39;</code> doesn&#39;t force the evaluation of the elements of the pair (because the pair is already in <a href=\"http://stackoverflow.com/questions/6872898/haskell-what-is-weak-head-normal-form\">weak head normal form</a>). You need to either use a <a href=\"https://hackage.haskell.org/package/strict-0.3.2/docs/Data-Strict-Tuple.html\" rel=\"nofollow noreferrer\">&quot;strict pair&quot; type</a> for the accumulator, or use <code>seq</code> to force evaluation explicitly."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1459342292, "post_id": 36284646, "comment_id": 60242036, "body": "Thanks for the clarification on that, @Jubobs, it makes much more sense now."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1459342264, "last_edit_date": 1459342264, "creation_date": 1459255421, "answer_id": 36284646, "question_id": 36284181, "link": "https://stackoverflow.com/questions/36284181/how-do-i-take-the-average-of-a-list-without-using-predefined-functions/36284646#36284646", "title": "How do i take the average of a list without using predefined functions?", "body": "<p>You could use <code>foldl'</code> to build up a tuple that includes both the running count of items as well as the running sum, then divide to get the average. </p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>data StrictPair a b = StrictPair !a !b\n\nmyAvg :: Fractional a =&gt; [a] -&gt; a\nmyAvg [] = error \"Empty list\"\nmyAvg list =\n  let\n    tupleSum (StrictPair count sum) x = StrictPair (count + 1) (sum + x)\n    StrictPair totalCount totalSum = foldl' tupleSum (StrictPair 0 0) list\n  in\n    totalSum / totalCount\n</code></pre>\n\n<p>The use of <code>foldl'</code> and <code>StrictPair</code> force evaluation to avoid memory issues. (thanks for the recommendation, @Jubobs, @Zeta, and @dfeuer!)</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1459257984, "creation_date": 1459257984, "answer_id": 36285694, "question_id": 36284181, "link": "https://stackoverflow.com/questions/36284181/how-do-i-take-the-average-of-a-list-without-using-predefined-functions/36285694#36285694", "title": "How do i take the average of a list without using predefined functions?", "body": "<p>No, this is essentially impossible in general. Addition and division are necessary to calculate the mean of a list of numbers. The functions to calculate these for standard types like <code>Rational</code> are \"built in\".</p>\n"}], "owner": {"reputation": 93, "user_id": 6062637, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/53f9677f2cd0195df649552b12c1c88f?s=128&d=identicon&r=PG&f=1", "display_name": "JJ chips", "link": "https://stackoverflow.com/users/6062637/jj-chips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1459342264, "creation_date": 1459254188, "question_id": 36284181, "link": "https://stackoverflow.com/questions/36284181/how-do-i-take-the-average-of-a-list-without-using-predefined-functions", "title": "How do i take the average of a list without using predefined functions?", "body": "<p>Say I wanted to take the average of a  list of floating point values, then at some point i need to use \"sum\" and \"length\" (built in functions). Can you make a function that calculates the average of arbitrary length list of Floating point values?</p>\n"}, {"tags": ["list", "haskell", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1459241165, "post_id": 36279366, "comment_id": 60185218, "body": "After you <code>map f xs</code>, check for the result list: either you have some <code>Fail</code>s, or you have none. In the former, you want to return <code>Fail</code>, I guess (?). In the latter, you can access the list of pairs inside the <code>Done</code> constructors."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1459241362, "post_id": 36279366, "comment_id": 60185355, "body": "It&#39;s true that I want to return Fail when one of the elements in the list is a Fail, but how exactly do I access the list of pairs inside the constructor? I don&#39;t really know how to do that."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459241897, "post_id": 36279366, "comment_id": 60185678, "body": "what is the <code>a</code> here - is this the result of the parser? What is the <code>String</code>? Usually you have one return-value and one with the remaining/unparsed string and the parser is a function taking an input string and returning - for example - a tuple of some result and the remaining string"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "edited": false, "score": 0, "creation_date": 1459245600, "post_id": 36280095, "comment_id": 60188189, "body": "Thank you for your clarifying answer. It&#39;s indeed clearer to really define Functor and Parser."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1459242965, "creation_date": 1459242965, "answer_id": 36280095, "question_id": 36279366, "link": "https://stackoverflow.com/questions/36279366/monad-of-list-in-haskell/36280095#36280095", "title": "Monad of list in Haskell", "body": "<p>While it's not completely uncommon to define <code>fmap = liftM</code> and so on, this is a bit backwards IMO. If you first define the more fundamental instances and base the more involved ones on them, things often come out clearer. I'll leave <code>&lt;*&gt; = ap</code>, but transform everything else:</p>\n\n<pre><code>instance Functor Parser where  -- Note that you can `derive` this automatically\n  fmap f (Done vs rest) = Done (map f vs) rest\n  fmap f (Fail err) = Fail err\n\ninstance Applicative Parser where\n  pure xs = Done ([], xs)\n  (&lt;*&gt;) = ap\n</code></pre>\n\n<p>Now with <code>fmap</code> already present, I can define <code>Monad</code> in the &ldquo;more mathematical&rdquo; way: define <a href=\"http://hackage.haskell.org/package/base/docs/Control-Monad.html#v:join\" rel=\"nofollow\"><code>join</code></a> instead of <code>&gt;&gt;=</code>.</p>\n\n<pre><code>instance Monad Parser where\n  return = pure\n  q &gt;&gt;= f = joinParser $ fmap f q\n</code></pre>\n\n<p>That means you'll work with intuitively handleable concrete values, rather than having to worry about threading a function through a parser. You can therefore see quite clearly what's going on, just write out the recursion:</p>\n\n<pre><code>joinParser :: Parser (Parser a) -&gt; Parser a\n  joinParser (Fail err) = Fail err\n  joinParser (Done [] rest) = Done [] rest\n  joinParser (Done (Fail err : _) _) = Fail err\n  joinParser (Done (Done v0 rest0 : pss) rest) = ??\n</code></pre>\n\n<p>at this point you see clearly what Carsten already remarked: your <code>Parser</code> type doesn't really make sense as a parser. Both the inner and outer <code>Done</code> wrappers somehow have <code>rest</code> data; combining it would mean you combine the undone work... this is not what a parser does.</p>\n\n<p>Search the web a bit, there's plenty of material on how to implement parsers in Haskell. In doubt, look how some established library does it, <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/src/Text-Parsec-Prim.html#ParsecT\" rel=\"nofollow\">e.g. parsec</a>.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "edited": false, "score": 0, "creation_date": 1459245553, "post_id": 36280141, "comment_id": 60188154, "body": "Ow I see now, it makes more sense to define a parser this way. Thank you very much :)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1459243499, "last_edit_date": 1459243499, "creation_date": 1459243126, "answer_id": 36280141, "question_id": 36279366, "link": "https://stackoverflow.com/questions/36279366/monad-of-list-in-haskell/36280141#36280141", "title": "Monad of list in Haskell", "body": "<p>leftaroundabout already showed you some of the problems.</p>\n\n<p>Usually I expect a parser to be some kind of function that takes an input-<code>String</code>, maybe consuming some of this string and then returning an result together with the unconsumed input.</p>\n\n<p>Based on this idea you can extent your code to do just this:</p>\n\n<pre><code>data ParserResult a\n  = Done (a, String)\n  | Fail String\n  deriving Show\n\ndata Parser a = Parser { run :: String -&gt; ParserResult a }\n\ninstance Functor Parser where\n  fmap = liftM\n\ninstance Applicative Parser where\n  pure = return\n  (&lt;*&gt;) = ap\n\ninstance Monad Parser where\n  return a = Parser $ \\ xs -&gt; Done (a, xs)\n  p &gt;&gt;= f = Parser $ \\ xs -&gt;\n    case run p xs of\n      Done (a, xs') -&gt; run (f a) xs'\n      Fail msg      -&gt; Fail msg\n</code></pre>\n\n<hr>\n\n<h3>a simple example</h3>\n\n<p>here is a simple parser that would accept any character:</p>\n\n<pre><code>parseAnyChar :: Parser Char\nparseAnyChar = Parser f\n  where f (c:xs) = Done (c, xs)\n        f \"\"     = Fail \"nothing to parse\"\n</code></pre>\n\n<p>and this is how you would use it:</p>\n\n<pre><code>\u03bb&gt; run parseAnyChar \"Hello\"\nDone ('H',\"ello\")\n\u03bb&gt; run parseAnyChar \"\"\nFail \"nothing to parse\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 36280141, "answer_count": 2, "score": 1, "last_activity_date": 1459243499, "creation_date": 1459240819, "last_edit_date": 1459241961, "question_id": 36279366, "link": "https://stackoverflow.com/questions/36279366/monad-of-list-in-haskell", "title": "Monad of list in Haskell", "body": "<p>I'm trying to make this an instance of Monad in Haskell:</p>\n\n<pre><code>data Parser a = Done ([a], String) | Fail String\n</code></pre>\n\n<p>Now I try this code to make it an instance of Monad:</p>\n\n<pre><code>instance Functor Parser where\n  fmap = liftM\n\ninstance Applicative Parser where\n  pure = return\n  (&lt;*&gt;) = ap\n\ninstance Monad Parser where\n  return xs = Done ([], xs)\n  Done (xs, s) &gt;&gt;= f = Done (concat (map f xs)), s)\n</code></pre>\n\n<p>But this obviously doesn't work, because the function <code>f</code> in the bind-function is of the type <code>a -&gt; M b</code>. So the <code>(map f xs)</code> function yields a list of <code>M b</code>-things. It should actually make a list of <code>b</code>'s. How can I do this in Haskell?</p>\n\n<p>NOTE: The actual error given by GHC 7.10.3 is:</p>\n\n<pre><code>SuperInterpreter.hs:71:27:\nCouldn't match expected type `String' with actual type `a'\n  `a' is a rigid type variable bound by\n      the type signature for return :: a -&gt; Parser a\n      at SuperInterpreter.hs:71:5\nRelevant bindings include\n  xs :: a (bound at SuperInterpreter.hs:71:12)\n  return :: a -&gt; Parser a (bound at SuperInterpreter.hs:71:5)\nIn the expression: xs\nIn the first argument of `Done', namely `([], xs)'\n\nSuperInterpreter.hs:72:45:\nCouldn't match type `Parser b' with `[b]'\nExpected type: a -&gt; [b]\n  Actual type: a -&gt; Parser b\nRelevant bindings include\n  f :: a -&gt; Parser b (bound at SuperInterpreter.hs:72:22)\n  (&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\n    (bound at SuperInterpreter.hs:72:5)\nIn the first argument of `map', namely `f'\nIn the first argument of `concat', namely `(map f xs)'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["regex", "haskell", "expression-trees", "postfix-notation"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1459234682, "post_id": 36277160, "comment_id": 60181300, "body": "I think that algorithms for parsing expressions in RPN are fairly well known. How about the one <a href=\"https://en.wikipedia.org/wiki/Reverse_Polish_notation#Postfix_algorithm\" rel=\"nofollow noreferrer\">here</a>. If you&#39;ve tried to implement something you should include your attempts."}, {"owner": {"reputation": 547, "user_id": 2341022, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uWfXq.jpg?s=128&g=1", "display_name": "jankoritak", "link": "https://stackoverflow.com/users/2341022/jankoritak"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459262079, "post_id": 36277160, "comment_id": 60200409, "body": "I had hard time understanding implementation of stack in Haskell, that&#39;s why I didn&#39;t go for such solution. Thanks to Carsten, now I understand."}], "answers": [{"comments": [{"owner": {"reputation": 547, "user_id": 2341022, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uWfXq.jpg?s=128&g=1", "display_name": "jankoritak", "link": "https://stackoverflow.com/users/2341022/jankoritak"}, "edited": false, "score": 0, "creation_date": 1459261961, "post_id": 36278614, "comment_id": 60200304, "body": "Thank you kindly, Carsten. This solution really opened my eyes."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1459239016, "last_edit_date": 1459239016, "creation_date": 1459238405, "answer_id": 36278614, "question_id": 36277160, "link": "https://stackoverflow.com/questions/36277160/haskell-reverse-polish-notation-regular-expression-to-expression-tree/36278614#36278614", "title": "Haskell - Reverse polish notation regular expression to expression tree", "body": "<p>This is not hard to do using an stack-based algorithm (which translates into a <code>foldl</code> in Haskell):</p>\n\n<pre><code>data Tree\n  = Symbol Char\n  | Op Char Tree Tree\n  deriving Show\n\ntype Stack = [Tree]\n\nstep :: Stack -&gt; Char -&gt; Stack\nstep (r:l:s) '.' = (Op '.' l r):s\nstep (r:l:s) '+' = (Op '+' l r):s\nstep s c         = (Symbol c):s\n\nparse :: String -&gt; Stack\nparse = foldl step []\n</code></pre>\n\n<p>which would yield something like this:</p>\n\n<pre><code>\u03bb&gt; parse \"aa.bb.+\"\n[Op '+' (Op '.' (Symbol 'a') (Symbol 'a')) (Op '.' (Symbol 'b') (Symbol 'b'))]\n</code></pre>\n\n<p>you did not write <em>anything</em> about your data-structures so I took some liberties - it should be easy to adapt to your situation once you understood <code>step</code> and the <code>foldl</code> in <code>parse</code></p>\n\n<hr>\n\n<p>if you want to change <em>left</em>/<em>right</em> as in your example you just have to do it in <code>step</code>:</p>\n\n<pre><code>step :: Stack -&gt; Char -&gt; Stack\nstep (l:r:s) '.' = (Op '.' l r):s\nstep (l:r:s) '+' = (Op '+' l r):s\nstep s c         = (Symbol c):s\n</code></pre>\n\n<p>example:</p>\n\n<pre><code>\u03bb&gt; parse \"aa.bb.+\"\n[Op '+' (Op '.' (Symbol 'b') (Symbol 'b')) (Op '.' (Symbol 'a') (Symbol 'a'))]\n</code></pre>\n\n<p>but I would expect the first one if the order would matter (here you have <code>bb</code> before <code>aa</code> which is strange ... </p>\n\n<hr>\n\n<p>of course it's strange that the <em>star</em> operation is binary too so I would suggest:</p>\n\n<pre><code>data Tree\n  = Symbol Char\n  | Concat Tree Tree\n  | Star Tree\n  deriving Show\n\ntype Stack = [Tree]\n\nstep :: Stack -&gt; Char -&gt; Stack\nstep (r:l:s) '.' = (Concat r l):s\nstep (t:s)   '+' = (Star t):s\nstep s c         = (Symbol c):s\n\nparse :: String -&gt; Stack\nparse = foldl step []\n</code></pre>\n\n<p>which would change your syntax a bit:</p>\n\n<pre><code>\u03bb&gt; parse \"aa.bb..+\"\n[Star (Concat (Concat (Symbol 'b') (Symbol 'b')) (Concat (Symbol 'a') (Symbol 'a')))]\n</code></pre>\n\n<p>but which seems saner IMO</p>\n\n<hr>\n\n<h3>convert list to Maybe</h3>\n\n<p>of course you might not like the <code>[Stack]</code> return so you could do this:</p>\n\n<pre><code>parse :: String -&gt; Maybe Tree\nparse input =\n  case result of\n    [t] -&gt; Just t\n    []  -&gt; Nothing\n    _   -&gt; error \"syntax error\"\n  where result = foldl step [] input\n</code></pre>\n\n<p>examples:</p>\n\n<pre><code>\u03bb&gt; parse \"aa.bb..+\"\nJust (Star (Concat (Concat (Symbol 'b') (Symbol 'b')) (Concat (Symbol 'a') (Symbol 'a'))))\n\u03bb&gt; parse \"\"\nNothing\n\u03bb&gt; parse \"aa.bb.+\"\n*** Exception: syntax error\n</code></pre>\n"}], "owner": {"reputation": 547, "user_id": 2341022, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uWfXq.jpg?s=128&g=1", "display_name": "jankoritak", "link": "https://stackoverflow.com/users/2341022/jankoritak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 0, "accepted_answer_id": 36278614, "answer_count": 1, "score": 0, "last_activity_date": 1459239016, "creation_date": 1459233629, "question_id": 36277160, "link": "https://stackoverflow.com/questions/36277160/haskell-reverse-polish-notation-regular-expression-to-expression-tree", "title": "Haskell - Reverse polish notation regular expression to expression tree", "body": "<p>Im struggling with coming up with algorithm that converts a regular expression (in context of regular languages, there are only 3 operations '.' for concat, '+' for \"or\" and '*' for iteration) in reverse polish notation to the regular expression tree.</p>\n\n<p>For example i have a regular expression</p>\n\n<pre><code>aa.bb.+\n</code></pre>\n\n<p>for which i need to construct following expression tree</p>\n\n<pre><code>      +\n    /   \\\n   .     .\n  / \\   / \\\n b   b a   a  \n</code></pre>\n\n<p>Would appreciate any help. Thanks!</p>\n"}, {"tags": ["haskell", "functional-programming", "category-theory"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1459224567, "post_id": 36274369, "comment_id": 60177176, "body": "I have no idea what a <code>Chain</code> is. That&#39;s not a terribly well-known class."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1459234738, "post_id": 36274369, "comment_id": 60181330, "body": "Maps are instances of <code>Apply</code> but not of <code>Applicative</code>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459260485, "post_id": 36274369, "comment_id": 60199165, "body": "@dfeuer, perhaps <code>Chain</code> is <code>Monad</code> without <code>return</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1459260602, "post_id": 36274369, "comment_id": 60199242, "body": "@user3237465, sounds likely. I know those by Kmett&#39;s name, <code>Bind</code>. I&#39;ve never looked at instances though."}, {"owner": {"reputation": 14428, "user_id": 1191551, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/97ced8a229689b73b098a542636052e8?s=128&d=identicon&r=PG", "display_name": "Chet", "link": "https://stackoverflow.com/users/1191551/chet"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459278629, "post_id": 36274369, "comment_id": 60211285, "body": "@dfeuer I maked one question as duplicate -- the other question isnt as granular  -- it asks whats a functor that isnt an applicative. I want to know about Apply as well."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1459283454, "post_id": 36274369, "comment_id": 60214183, "body": "Perhaps you could add links to the definitions at Hackage for the lesser known types such as <code>Apply</code> or <code>Chain</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1459283984, "post_id": 36274369, "comment_id": 60214450, "body": "@PetrPudl&#225;k, it seems <code>Chain</code> is a term used in some JavaScript library. I&#39;m speculating it might be equivalent to <code>Bind</code> from <code>semigroupoids</code>, but I really don&#39;t feel like digging into JS to figure that out."}, {"owner": {"reputation": 14428, "user_id": 1191551, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/97ced8a229689b73b098a542636052e8?s=128&d=identicon&r=PG", "display_name": "Chet", "link": "https://stackoverflow.com/users/1191551/chet"}, "edited": false, "score": 0, "creation_date": 1459579639, "post_id": 36274369, "comment_id": 60358984, "body": "Fantasyland talks about some synonyms. <code>Bind</code> is one of them, I think its the plunger in Haskell <code>=&lt;&lt;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 3, "last_activity_date": 1459221560, "creation_date": 1459221560, "answer_id": 36274774, "question_id": 36274369, "link": "https://stackoverflow.com/questions/36274369/what-are-some-types-that-discriminate-between-categories/36274774#36274774", "title": "What are some types that discriminate between categories?", "body": "<p>Non-empty lists, defined as <code>data NEList a = Cons a [a]</code> are semigroups but not monoids.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 8, "last_activity_date": 1459580606, "last_edit_date": 1459580606, "creation_date": 1459282681, "answer_id": 36294331, "question_id": 36274369, "link": "https://stackoverflow.com/questions/36274369/what-are-some-types-that-discriminate-between-categories/36294331#36294331", "title": "What are some types that discriminate between categories?", "body": "<h3>1. Whats a Semigroup that isn't also a Monoid?</h3>\n\n<p>Cactus gives a great example of a semigroup that's not a monoid. Non-empty (finite) lists of any type represent the <em>free semigroup</em> over that type. Another example is <code>Data.Void.Void</code>, which isn't a <code>Monoid</code> because it doesn't have any elements and therefore doesn't have an identity element. Yet another example is the set of positive integers under addition.</p>\n\n<h3>3. Whats an Functor that isn't also an Apply?</h3>\n\n<p>One <code>Functor</code> that's not an <code>Apply</code> is  <code>Handler</code>.</p>\n\n<pre><code>data Handler a where\n  Handler :: Exception e =&gt; (e -&gt; IO a) -&gt; Handler a\n\ninstance Functor Handler where\n  fmap f (Handler h) = Handler (\\e -&gt; f &lt;$&gt; h e)\n</code></pre>\n\n<p>Given <code>Handler f :: Handler (a -&gt; b)</code> and <code>Handler g :: Handler a</code>, you have</p>\n\n<pre><code>f :: e1 -&gt; IO (a -&gt; b)\ng :: e2 -&gt; IO a\n</code></pre>\n\n<p>Where <code>e1</code> and <code>e2</code> are (possibly different) types of exception. You need to create <code>h :: e3 -&gt; IO b</code> for some exception type <code>e3</code>. There is no really <em>sensible</em> way to do this**.</p>\n\n<p>It seems harder to find <code>Functor</code>s that <em>can't</em> be made into law-abiding <code>Apply</code> instances, because <code>Apply</code> has just one law and therefore admits all sorts of weird things that <code>Applicative</code> would reject.</p>\n\n<h3>4. Whats an Apply that isn't also an Applicative?</h3>\n\n<h3>6. What an Applicative that isn't also a Monad?</h3>\n\n<p><code>Map k</code> and <code>IntMap</code>. Also, <code>(,) a</code> and <code>Const a</code> when <code>a</code> is a <code>Semigroup</code> but not a <code>Monoid</code>. Similarly, some other types fit the pattern of accepting a weaker context for <code>Apply</code> and/or <code>Bind</code> than for <code>Applicative</code> or <code>Monad</code>, respectively.</p>\n\n<h3>5. Whats an Apply that isn't also a Chain?</h3>\n\n<p><code>ZipList</code> is an <code>Apply</code> but not a <code>Bind</code>. I don't know what a <code>Chain</code> is.</p>\n\n<hr>\n\n<p>** One semi-sensible way might look like this:</p>\n\n<pre><code>data P x y = P x y deriving (Show, Typeable)\ninstance (Exception x, Exception y) =&gt;\n            Exception (P x y)\ninstance Apply Handler where\n  Handler f &lt;.&gt; Handler g =\n    Handler (\\(P e1 e2) -&gt; f e1 &lt;*&gt; g e2)\n</code></pre>\n\n<p>I <em>think</em> this obeys the <code>Apply</code> law, but I'm not yet completely certain.</p>\n"}], "owner": {"reputation": 14428, "user_id": 1191551, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/97ced8a229689b73b098a542636052e8?s=128&d=identicon&r=PG", "display_name": "Chet", "link": "https://stackoverflow.com/users/1191551/chet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 4, "answer_count": 2, "score": 12, "last_activity_date": 1459580606, "creation_date": 1459218679, "last_edit_date": 1495541906, "question_id": 36274369, "link": "https://stackoverflow.com/questions/36274369/what-are-some-types-that-discriminate-between-categories", "title": "What are some types that discriminate between categories?", "body": "<p>I'm still getting familiar with all this category theory stuff, and just about every example I see is with a Maybe or an Array. But I haven't found any examples that discriminate between these categories. For example, here are some of the questions I've still been unable to answer:</p>\n\n<ol>\n<li>whats a Semigroup that isn't also a Monoid?</li>\n<li>whats a Foldable that isn't also a Traversable? <a href=\"https://stackoverflow.com/questions/8359115/haskell-an-example-of-a-foldable-which-is-not-a-functor-or-not-traversable\">[Duplicate]</a></li>\n<li>whats an Functor that isn't also an Apply?</li>\n<li>whats an Apply that isn't also an Applicative?</li>\n<li>whats an Apply that isn't also a Chain?</li>\n<li>whats a Chain that isn't also a Monad?</li>\n<li>what an Applicative that isn't also a Monad? <a href=\"https://stackoverflow.com/questions/7220436/good-examples-of-not-a-functor-functor-applicative-monad\">[Duplicate]</a></li>\n</ol>\n\n<p>I'm learning this stuff through the context of <a href=\"https://github.com/fantasyland/fantasy-land\" rel=\"nofollow noreferrer\">JavaScript FantasyLand</a> so that's where I'm getting the lingo from -- I understand there are different words for these things.</p>\n\n<p><img src=\"https://raw.githubusercontent.com/fantasyland/fantasy-land/master/figures/dependencies.png\" alt=\"\"></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1459203304, "post_id": 36272111, "comment_id": 60171170, "body": "The error message is pretty clear: <code>Int</code> is a type with no parameters, but you&#39;ve tried to apply it to one. I&#39;m guessing you actually mean <code>mempty&#39; :: Int; mappend&#39; :: Int -&gt; Int -&gt; Int</code>."}, {"owner": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "edited": false, "score": 0, "creation_date": 1459203442, "post_id": 36272111, "comment_id": 60171220, "body": "What if you leave out lines <code>mempty&#39; :: Int a =&gt; a</code> and <code>mappend&#39; :: Int a =&gt; a -&gt; a -&gt; a</code>?"}, {"owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "reply_to_user": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "edited": false, "score": 0, "creation_date": 1459203979, "post_id": 36272111, "comment_id": 60171417, "body": "@J.J.Hakala Then I cannot use the function with parameter (<code>mappend&#39; 1 2</code>): <i>No instance for (Num a0) arising from a use of \u2018it\u2019</i>"}, {"owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "edited": false, "score": 0, "creation_date": 1459204503, "post_id": 36272111, "comment_id": 60171590, "body": "I need to a type every time to make it work: <code>mappend&#39; (1::Int) (2::Int)</code>"}, {"owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "edited": false, "score": 0, "creation_date": 1459204583, "post_id": 36272111, "comment_id": 60171622, "body": "Or I can change a type of instance to <code>instance Monoid&#39; Integer where </code>."}, {"owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "edited": false, "score": 0, "creation_date": 1459204635, "post_id": 36272111, "comment_id": 60171638, "body": "But I want to specify a type of functions explicitly: &#39;mempty&#39; :: Int a =&gt; a&#39; in instance."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1459210623, "post_id": 36272111, "comment_id": 60173579, "body": "Don&#39;t change your question in a way that doesn&#39;t include your original problem. If you have additional information add an update section, if you have new questions open a separate question."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459215175, "post_id": 36272111, "comment_id": 60174667, "body": "@barbara But what you say you are trying to specify fundamentally doesn&#39;t make sense (or at the very least, it isn&#39;t Haskell). The type <code>Int a =&gt; a</code> doesn&#39;t mean anything at all - it simply isn&#39;t a valid type. It looks like you are writing <code>mappend&#39; 1 2</code> and getting an error. This is a valid expression, whose type is <code>(Num a, Monoid&#39; a) =&gt; a</code>. You <i>must</i> specify the type manually every time - since you can have <code>mappend&#39; 1 2 :: Int</code> or <code>:: Integer</code> or basically anything else. Since type classes are open, the compiler can&#39;t assume that that the <code>1</code> is an <code>Int</code> just because it could be an <code>Int</code>."}], "answers": [{"tags": [], "owner": {"reputation": 10724, "user_id": 320226, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CScHV.jpg?s=128&g=1", "display_name": "Bolo", "link": "https://stackoverflow.com/users/320226/bolo"}, "is_accepted": false, "score": 3, "last_activity_date": 1459203445, "creation_date": 1459203445, "answer_id": 36272171, "question_id": 36272111, "link": "https://stackoverflow.com/questions/36272111/haskell-type-issue/36272171#36272171", "title": "Haskell Type issue", "body": "<p>It should be:</p>\n\n<pre><code>instance Monoid' Int where\n    mempty' :: Int\n    mempty' = 0\n\n    mappend' :: Int -&gt; Int -&gt; Int\n    mappend' a b = (+) a b\n</code></pre>\n"}], "owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1459210368, "creation_date": 1459203117, "last_edit_date": 1459210368, "question_id": 36272111, "link": "https://stackoverflow.com/questions/36272111/haskell-type-issue", "title": "Haskell Type issue", "body": "<p>I wrote the code:</p>\n\n<pre><code>{-# LANGUAGE InstanceSigs #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nmodule MonoidApp where\n\nclass Monoid' a where \n    mempty'  :: a\n    mappend' :: a -&gt; a -&gt; a\n\n    mconcat' :: [a] -&gt; a\n    mconcat' = foldr mappend' mempty'\n\ninstance Monoid' Int where \n    mempty' :: Int a =&gt; a\n    mempty' = 0\n\n    mappend' :: Int a =&gt; a -&gt; a -&gt; a\n    mappend' a b = (+) a b\n</code></pre>\n\n<p>But it runs into error:</p>\n\n<pre><code>\u2018Int\u2019 is applied to too many type arguments\n    In the type signature for \u2018mempty'\u2019: mempty' :: Int a =&gt; a\n    In the instance declaration for \u2018Monoid' Int\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Any ideas why?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1459203687, "post_id": 36272136, "comment_id": 60171314, "body": "I think you should take a look at the <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.5.1.2/docs/Database-PostgreSQL-Simple-FromField.html\" rel=\"nofollow noreferrer\">documentation</a> - here is an example for &quot;reading&quot; a UUID - try to adapt it to your needs"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459222707, "post_id": 36272136, "comment_id": 60176632, "body": "@OskarK, I&#39;ve updated my answer, but I suspect you need to learn some more Haskell basics before playing with this sort of library."}, {"owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "edited": false, "score": 0, "creation_date": 1459222891, "post_id": 36272136, "comment_id": 60176697, "body": "and if I had a string constructor, not a char?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459223061, "post_id": 36272136, "comment_id": 60176759, "body": "@OskarK, you&#39;d just need to change <code>char</code> to <code>str</code> (for clarity), <code>&#39;A&#39;</code> to <code>&quot;A&quot;</code>, etc, and change the error call to use <code>str</code> instead of <code>[char]</code>. My understanding is that this all depends on the database field configuration, but I know very little about databases."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459223318, "post_id": 36272136, "comment_id": 60176841, "body": "@OskarK, would you mind telling me what errors? I may have made some silly mistake."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1459223250, "last_edit_date": 1592644375, "creation_date": 1459203225, "answer_id": 36272136, "question_id": 36271946, "link": "https://stackoverflow.com/questions/36271946/fromrow-for-my-data-which-isnt-polymorphic/36272136#36272136", "title": "FromRow for my data which isn&#39;t polymorphic:", "body": "<p>You need to come up with</p>\n<pre><code>fromRow :: RowParser MyData\n</code></pre>\n<p>You have</p>\n<pre><code>field :: FromField a =&gt; RowParser a\n</code></pre>\n<p>which makes a <code>RowParser</code> (a fragment of a parser for a row) for any <code>FromField</code> instance.</p>\n<p>You could write</p>\n<pre><code>fromRow = field\n</code></pre>\n<p>to parse single-field rows as <code>MyData</code>. However, your <code>MyData</code> type doesn't really look like the sort of thing that should have a <code>FromRow</code> instance at all. It should probably have (only) a <code>FromField</code> instance.</p>\n<p>The biggest technical problem with your current code is that you're trying to map a <em>type constructor</em> over something. You can only map <em>functions</em> (including data constructors and record field accessors).</p>\n<hr />\n<h3>Response to update</h3>\n<p>You might want</p>\n<pre><code>instance FromField MyData where\n  fromField f mbs = do\n    char &lt;- fromField f mbs\n    case char of\n      'A' -&gt; pure A\n      'B' -&gt; pure B\n      'C' -&gt; pure C\n      _ -&gt; returnError ConversionFailed f [char]\n</code></pre>\n<p>This should work if you're trying to convert the contents of a field containing a character to your type. If you're dealing with a different sort of field format, you may have to make adjustments.</p>\n<p>This is a very common approach to using parser combinator libraries. Instead of building a parser for your type from scratch, you should usually look first to see if the library offers parsers for a similar type, or components of your type. You can then use the standard <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> operations, as well as any special ones the library provides, to build your parser on top.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user266003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 36272136, "answer_count": 1, "score": 0, "last_activity_date": 1459225297, "creation_date": 1459202349, "last_edit_date": 1459225297, "question_id": 36271946, "link": "https://stackoverflow.com/questions/36271946/fromrow-for-my-data-which-isnt-polymorphic", "title": "FromRow for my data which isn&#39;t polymorphic:", "body": "<p>I'm trying to create an instance for my data which isn't polymorphic:</p>\n\n<pre><code>import Database.PostgreSQL.Simple\nimport Database.PostgreSQL.Simple.FromRow\ndata MyData = A | B | C \n\ninstance FromRow MyData where\n  fromRow = MyData &lt;$&gt; field -- doesn't compile\n</code></pre>\n\n<p>But it doesn't compile.</p>\n\n<p>UPDATE:</p>\n\n<p>I can't get it to compile</p>\n\n<pre><code>instance FromField MyData where\n  fromField f mbs = \n    case mbs of\n      Just val -&gt; A --????\n      Nothing -&gt; returnError ConversionFailed f \"error\"\n</code></pre>\n\n<p>This throws an error  <code>Couldn't match expected type \u2018Conversion MyData with actual type MyData</code></p>\n\n<p>How to make it return <code>Conversion MyData</code>?</p>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 9, "creation_date": 1459199873, "post_id": 36271326, "comment_id": 60169734, "body": "<a href=\"https://wiki.haskell.org/MonomorphismRestriction\" rel=\"nofollow noreferrer\">wiki.haskell.org/MonomorphismRestriction</a>. BTW, Haskell doesn&#39;t really \u201cinfer types in a lazy manner\u201d, rather it always infers <i>the most general possible</i> type."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1459200417, "post_id": 36271326, "comment_id": 60169971, "body": "@leftaroundabout, only if there is a most general type. I seem to recall that there are some weird cases where it infers something less general even when there is a most general type, but I may be confused or that may only be true with certain GHC extensions."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1459200579, "post_id": 36271326, "comment_id": 60170050, "body": "@dfeuer: yeah, it won&#39;t infer a more general rank-N type, but it will give the most general rank-1 type (provided you turn off the monomorphism restriction)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459205192, "post_id": 36271326, "comment_id": 60171850, "body": "@dfeuer There are some cases where inference fails shown here: <a href=\"http://stackoverflow.com/questions/27067905/when-are-type-signatures-necessary-in-haskell\" title=\"when are type signatures necessary in haskell\">stackoverflow.com/questions/27067905/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "is_accepted": true, "score": 0, "last_activity_date": 1460039154, "creation_date": 1460039154, "answer_id": 36479199, "question_id": 36271326, "link": "https://stackoverflow.com/questions/36271326/haskell-type-inference-priority/36479199#36479199", "title": "Haskell type inference priority?", "body": "<p><a href=\"http://wiki.haskell.org/MonomorphismRestriction\" rel=\"nofollow\">http://wiki.haskell.org/MonomorphismRestriction</a></p>\n\n<p>as suggested by @leftaroundabout</p>\n"}], "owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 36479199, "answer_count": 1, "score": 3, "last_activity_date": 1460039154, "creation_date": 1459199746, "last_edit_date": 1459199922, "question_id": 36271326, "link": "https://stackoverflow.com/questions/36271326/haskell-type-inference-priority", "title": "Haskell type inference priority?", "body": "<p>As far as I know, haskell infers <em>the most general possible type</em>, being </p>\n\n<pre><code>integers      = [1,2,3]\nintegersOrNot = [1,2,3]\n\nroutine :: IO ()\nroutine = do\n   let x = map (\\i -&gt; i / 2) integersOrNot\n   return ()\n</code></pre>\n\n<p>When I test type of <code>integersOrNot</code>, I get</p>\n\n<pre><code>*Main&gt; :t integersOrNot\nintegers_ :: [Double]\n</code></pre>\n\n<p>Given</p>\n\n<pre><code>*Main&gt; :t 1\n1 :: Num a =&gt; a\n</code></pre>\n\n<p>Haskell didn't have much options. But how come </p>\n\n<pre><code>*Main&gt; :t integers\nintegers :: [Integer]\n</code></pre>\n\n<p>not <code>integers :: (Num a) =&gt; [a]</code>? Does that mean <code>Integer</code> is a \"default\" real type for <code>Num</code> kind?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1459200326, "post_id": 36271143, "comment_id": 60169921, "body": "I think this is a fairly complete answer. Perhaps the only other thing of note is that type inference will always create fresh type variables to check applications of polymorphic expressions - so if the class constraint relies on two type variables being the same, it will not work without a manual type annotation or from some other expression which correctly constrains the type. The typechecker will not unify two type variables, ever, just because it <i>could</i> - something has to tell it to."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459200828, "post_id": 36271143, "comment_id": 60170179, "body": "@user2407038, while writing this answer, a question occurred to me: how does GHC decide which type parameter to inspect (with MPTC), or which part to inspect (with flexible instances)? If I have overlapping <code>instance C Bool b</code> and <code>instance C a Bool</code>, does it try to identify the first argument or the second one first, or does it operate in some other fashion?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459201635, "post_id": 36271143, "comment_id": 60170538, "body": "For example, if <code>class C a b where see :: a -&gt; b -&gt; ()</code> then <code>see True False</code> is <i>always</i> overlapping. From the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-class-extensions.html#instance-overlap\" rel=\"nofollow noreferrer\">ghc docs</a>: &quot;GHC also provides a way to loosen the instance resolution, by allowing more than one instance to match, <i>provided there is a most specific one.</i>&quot; (emphasis theirs). In terms of &quot;specificity&quot;, GHC will not consider parameter order at all - <code>C Bool Bool</code> matches <code>C a Bool</code> and <code>C Bool a</code> exactly &quot;as well&quot; - it is not strictly less and therefore overlapping."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459202048, "post_id": 36271143, "comment_id": 60170719, "body": "@user2407038, sure. But I was thinking of <code>see True &#39;a&#39;</code>, but where the types are not immediately obvious. I guess it doesn&#39;t matter, though, since it needs to check both arguments to exclude one of the instances."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459202988, "post_id": 36271143, "comment_id": 60171054, "body": "Well in the cases of <code>see True &#39;a&#39;</code> and <code>see &#39;a&#39; True</code> only one instances matches - <code>C a Bool</code> cannot match the first because <code>Char ~ Bool</code> does not hold. But for example <code>see True 1</code> is again overlapping, because <code>see True (1 :: Bool)</code> is technically valid. I believe you are correct - all the params of a MPTC must be inspected to make any judgements about types."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459203485, "post_id": 36271143, "comment_id": 60171232, "body": "@user2407038, only ones that are ever distinctive, not constrained by fundep. If no instance &quot;matches&quot; on a certain parameter, then it should be possible to leave it be. And a parameter determined by a non-circular fundep should play no role in instance selection, I believe."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459204234, "post_id": 36271143, "comment_id": 60171501, "body": "&quot;And a parameter determined by a non-circular fundep should play no role in instance selection, I believe&quot; Indeed, it seems perfectly sensible to me to. But this sort of thing is probably not implemented just because it is a special case... based on the amounts of fundeps bugs that have existed over the years, I presume it is a highly non-trivial feature of the type system."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1459236396, "post_id": 36271143, "comment_id": 60182330, "body": "thank you all for the helpful comments which made me understand the issue better. nevertheless, i think it is confusing when in this context l the same name used twice is interpreted as two different names - usually a name in a scope means always the same thing,"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1459198983, "creation_date": 1459198983, "answer_id": 36271143, "question_id": 36270591, "link": "https://stackoverflow.com/questions/36270591/why-does-a-parameter-occuring-twice-in-an-instance-produce-error-later-when-usin/36271143#36271143", "title": "why does a parameter occuring twice in an instance produce error later when using functions from the class?", "body": "<p>I don't have a complete answer for you, but I know this much.</p>\n\n<p>When GHC is resolving the <code>Variable3</code> instance and sees</p>\n\n<pre><code>instance (Variable3 TVar m (B a m1)\n         , MonadIO m\n         , m ~ m1\n         ) =&gt; Variable3 (T m1 ) m a\n</code></pre>\n\n<p>It checks that the first parameter is of the form <code>T m1</code>. It then commits to that instance and dedicates itself to resolving the context.</p>\n\n<p>When it sees</p>\n\n<pre><code>instance (Variable3 TVar m (B a m)\n         , MonadIO m\n         ) =&gt; Variable3 (T m) m a\n</code></pre>\n\n<p>it won't commit to the instance unless it can see that the first argument is <code>T</code> applied to the second argument. After all, you could have another instance for <code>Variable3 (T (MaybeT m)) m a</code>! It can't go ahead and try to unify the type variables because that would change the type checker's state (no backtracking there). So something else would, I believe, have had to let it know about that equality already.</p>\n\n<p>The work-around you found is, in any case, quite a standard one, and usually recommended.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 36271143, "answer_count": 1, "score": 1, "last_activity_date": 1459198983, "creation_date": 1459196810, "question_id": 36270591, "link": "https://stackoverflow.com/questions/36270591/why-does-a-parameter-occuring-twice-in-an-instance-produce-error-later-when-usin", "title": "why does a parameter occuring twice in an instance produce error later when using functions from the class?", "body": "<p>i have  data structures (here <code>B</code> and <code>T</code>) which include a monad as a type parameter (here <code>m</code>) (it is a simplified form from <code>Data.Binding.Simple</code>) and it is used in a class (here <code>Variables3</code>) with functions with the same monad type. in the instance of the class using the data the type parameter for the monad (say m) appears twice (here <code>Variable3 (T m) m a</code>). this compiles but when i use the functions in code which has for some of the types parameters (here <code>test3</code>) i get an error (<code>could not deduce ... m ..m1</code>) which indicates that the compiler sees the two occurrences of the type variable as distinct. </p>\n\n<p>i found a solution: name the two occurrences with distinct type parameters (say <code>m</code> and <code>m1</code>) and add equivalence <code>m ~ m1</code> (using the <code>TypeFamilies</code> extension). compiles and runs. </p>\n\n<p>here some very much simplified code which produces the error for <code>test3</code></p>\n\n<pre><code>class (Monad m) =&gt; Variable3 v m a where  \n newVar3     :: a -&gt; m (v a)\n readVar3    :: v a -&gt; m a\n writeVar3   :: v a -&gt; a -&gt; m ()\n\ndata B a m = B {f1 :: a\n            ,  f2 :: a -&gt; m () }\n\ndata T m a = T {unT :: TVar (B a m)}   \n\ninstance (Variable3 TVar m (B a m)\n       , MonadIO m\n       ) =&gt; Variable3 (T m) m a  where\n   newVar3 a = do \n                n &lt;- newVar3 (B {f1 = a, f2 = \\a -&gt; return () })\n                return (T n) \n\n   readVar3 a        = do \n                        v &lt;- liftIO $ readTVarIO . unT $ a \n                        return . f1 $ v \n\ntest3 :: ( MonadIO m \n    , Variable3 TVar m (B a m) \n        , Eq a) =&gt;  [a] -&gt;   m Bool\ntest3   [v1, v2]  = do\n    n1 :: (T m1 a) &lt;- newVar3  v1\n    r1 &lt;- readVar3 n1\n    let b1 = r1 == v1\n   return True `\n</code></pre>\n\n<p>replacing the instance head with:</p>\n\n<pre><code>instance (Variable3 TVar m (B a m1)\n        , MonadIO m\n        , m ~ m1\n        ) =&gt; Variable3 (T m1 ) m a  where\n</code></pre>\n\n<p>allows to compile and run test3! </p>\n\n<p>what is the rule behind this? is this an error in the compiler? </p>\n"}, {"tags": ["haskell", "garbage-collection"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1459204125, "post_id": 36270447, "comment_id": 60171470, "body": "If you don&#39;t get a satisfying answer, consider opening a ticket on the ghc trac. Especially considering the example is from Simon&#39;s own book I&#39;m sure they&#39;d be interested in knowing about this if it&#39;s a regression."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 7586444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d33f9e15fcfce22ec47935ddeee0e90?s=128&d=identicon&r=PG&f=1", "display_name": "Anabra", "link": "https://stackoverflow.com/users/7586444/anabra"}, "edited": false, "score": 1, "creation_date": 1492786915, "post_id": 37751110, "comment_id": 74144093, "body": "Could you elaborate on that a little bit, please? I have a similar problem with my <code>mergeSort</code> algorithm, and I can&#39;t figure out how to make it work. Also I should mention that despite the fact that 3 sparks fizzle out of 4, I still see parallelization, and the code runs considerably faster as well. Any clues why?"}], "tags": [], "owner": {"reputation": 12607, "user_id": 353875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9df35342002f14695f8231f3b4518da7?s=128&d=identicon&r=PG", "display_name": "Simon Marlow", "link": "https://stackoverflow.com/users/353875/simon-marlow"}, "is_accepted": true, "score": 2, "last_activity_date": 1465569895, "creation_date": 1465569895, "answer_id": 37751110, "question_id": 36270447, "link": "https://stackoverflow.com/questions/36270447/frequent-gc-preventing-sparks-from-running-in-parallel/37751110#37751110", "title": "Frequent GC preventing sparks from running in parallel", "body": "<p>Yes, this is actually a bug in GHC 8.0.1 and earlier (I'm working on fixing it for 8.0.2).  The problem is that the <code>fib 35</code> and <code>fib 36</code> expressions are constant and so GHC lifts them to the top level as CAFs, and the RTS was wrongly assuming that the CAFs were unreachable and so garbage collecting the sparks.</p>\n\n<p>You can work around it by making the expressions non-constant by passing in parameters on the command line:</p>\n\n<pre><code>main = do\n     [a,b] &lt;- map read &lt;$&gt; getArgs\n     let pair = (fib a, fib b) `using` parPair\n     print pair\n</code></pre>\n\n<p>and then run the program with <code>./strat 35 36</code>.</p>\n"}], "owner": {"reputation": 1736, "user_id": 128536, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bcf12a94adf39f013c0f07af48f92755?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/128536/simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 3, "accepted_answer_id": 37751110, "answer_count": 1, "score": 13, "last_activity_date": 1465569895, "creation_date": 1459196304, "question_id": 36270447, "link": "https://stackoverflow.com/questions/36270447/frequent-gc-preventing-sparks-from-running-in-parallel", "title": "Frequent GC preventing sparks from running in parallel", "body": "<p>I tried running the first example here: <a href=\"http://chimera.labs.oreilly.com/books/1230000000929/ch03.html\" rel=\"noreferrer\">http://chimera.labs.oreilly.com/books/1230000000929/ch03.html</a></p>\n\n<p>Code: <a href=\"https://github.com/simonmar/parconc-examples/blob/master/strat.hs\" rel=\"noreferrer\">https://github.com/simonmar/parconc-examples/blob/master/strat.hs</a></p>\n\n<pre><code>import Control.Parallel\nimport Control.Parallel.Strategies (rpar, Strategy, using)\nimport Text.Printf\nimport System.Environment\n\n-- &lt;&lt;fib\nfib :: Integer -&gt; Integer\nfib 0 = 1\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n-- &gt;&gt;\n\nmain = print pair\n where\n  pair =\n-- &lt;&lt;pair\n   (fib 35, fib 36) `using` parPair\n-- &gt;&gt;\n\n-- &lt;&lt;parPair\nparPair :: Strategy (a,b)\nparPair (a,b) = do\n  a' &lt;- rpar a\n  b' &lt;- rpar b\n  return (a',b')\n-- &gt;&gt;\n</code></pre>\n\n<p>I've built using ghc 7.10.2 (on OSX, with a multicore machine) using the following command:</p>\n\n<pre><code>ghc -O2 strat.hs -threaded -rtsopts -eventlog\n</code></pre>\n\n<p>And run using:</p>\n\n<pre><code>./strat +RTS -N2 -l -s\n</code></pre>\n\n<p>I expected the 2 <code>fibs</code> calculations to be run in parallel (previous chapter examples worked as expected, so no setup issues), and I wasn't getting any speedup at all, as seen here:</p>\n\n<pre><code>  % ./strat +RTS -N2 -l -s\n(14930352,24157817)\n   3,127,178,800 bytes allocated in the heap\n       6,323,360 bytes copied during GC\n          70,000 bytes maximum residency (2 sample(s))\n          31,576 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      5963 colls,  5963 par    0.179s   0.074s     0.0000s    0.0001s\n  Gen  1         2 colls,     1 par    0.000s   0.000s     0.0001s    0.0001s\n\n  Parallel GC work balance: 2.34% (serial 0%, perfect 100%)\n\n  TASKS: 6 (1 bound, 5 peak workers (5 total), using -N2)\n\n  SPARKS: 2 (0 converted, 0 overflowed, 0 dud, 1 GC'd, 1 fizzled)\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    1.809s  (  1.870s elapsed)\n  GC      time    0.180s  (  0.074s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    1.991s  (  1.945s elapsed)\n\n  Alloc rate    1,728,514,772 bytes per MUT second\n\n  Productivity  91.0% of total user, 93.1% of total elapsed\n\ngc_alloc_block_sync: 238\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p><code>-N1</code> gets similar results (omitted).</p>\n\n<p>The # of GC collections seemed suspicious, as pointed out by others in #haskell-beginners, so I tried adding <code>-A16M</code> when running. The results looked much more in line with expectations:</p>\n\n<pre><code>  % ./strat +RTS -N2 -l -s -A16M\n(14930352,24157817)\n   3,127,179,920 bytes allocated in the heap\n         260,960 bytes copied during GC\n          69,984 bytes maximum residency (2 sample(s))\n          28,320 bytes maximum slop\n              33 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0       115 colls,   115 par    0.105s   0.002s     0.0000s    0.0003s\n  Gen  1         2 colls,     1 par    0.000s   0.000s     0.0002s    0.0002s\n\n  Parallel GC work balance: 71.25% (serial 0%, perfect 100%)\n\n  TASKS: 6 (1 bound, 5 peak workers (5 total), using -N2)\n\n  SPARKS: 2 (1 converted, 0 overflowed, 0 dud, 0 GC'd, 1 fizzled)\n\n  INIT    time    0.001s  (  0.001s elapsed)\n  MUT     time    1.579s  (  1.087s elapsed)\n  GC      time    0.106s  (  0.002s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    1.686s  (  1.091s elapsed)\n\n  Alloc rate    1,980,993,138 bytes per MUT second\n\n  Productivity  93.7% of total user, 144.8% of total elapsed\n\ngc_alloc_block_sync: 27\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>The question is: Why is this the behavior? Even with frequent GC, I still intuitively expect the 2 sparks to run in parallel in the other 90% of the running time.</p>\n"}, {"tags": ["haskell", "show", "floating"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61, "user_id": 5665704, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9fqqKEDfXAQ/AAAAAAAAAAI/AAAAAAAABpg/-MFtBPAntFI/photo.jpg?sz=128", "display_name": "Siti Aisyah", "link": "https://stackoverflow.com/users/5665704/siti-aisyah"}, "edited": false, "score": 2, "creation_date": 1459272140, "post_id": 36268869, "comment_id": 60207254, "body": "@SitiAisyah, Calling <code>printf</code> a perfect solution to anything is going way too far. I think the <a href=\"https://hackage.haskell.org/package/formatting\" rel=\"nofollow noreferrer\"><code>formatting</code> package</a> offers a much better replacement for C&#39;s <code>printf</code>. It avoids <code>printf</code>&#39;s error-prone runtime format string processing nonsense in favor of a strongly typed approach; the downside is that you may get impenetrable error messages from the compiler when you goof up. I&#39;d personally appreciate a nice big collection of really idiomatic, well-named <code>blah -&gt; String</code> functions, but I&#39;m not sure if anyone has one."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1459277864, "post_id": 36268869, "comment_id": 60210849, "body": "Agreed. I&#39;m <i>not</i> a great proponent of <code>printf</code> with its weird variadic signature, which is basically typechecked only at runtime; but for simple formatting of single numbers its quite sufficient and it&#39;s in <code>base</code>, so, for this particular task I recommend it."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 9, "last_activity_date": 1459197661, "last_edit_date": 1459197661, "creation_date": 1459190682, "answer_id": 36268869, "question_id": 36268789, "link": "https://stackoverflow.com/questions/36268789/printing-floating-point-numbers-in-haskell/36268869#36268869", "title": "Printing floating point numbers in Haskell", "body": "<p>That's a standard problem that people have had ever since the infancy of computers. Hence it's perfectly well solved by the age-old <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Text-Printf.html#v:printf\" rel=\"noreferrer\"><code>printf</code></a> (which Haskell more or less copied from C).</p>\n\n<pre><code>import Text.Printf\n\nformatPence = printf \"%.2f\" . (/100) . fromIntegral\n</code></pre>\n\n<p>Oh, to note... this has a precision problem for very large amounts, because <code>Double</code> (which is implicitly used for the division) doesn't have as high resolution as <code>Int</code>. </p>\n\n<pre><code>Prelude Text.Printf&gt; formatPence 10000000000000013\n\"100000000000000.13\"\nPrelude Text.Printf&gt; formatPence 100000000000000013\n\"1000000000000000.10\"\nPrelude Text.Printf&gt; formatPence 1000000000000000013\n\"10000000000000000.00\"\n</code></pre>\n\n<p>So if you're dealing with amounts of multiple trillion dollars, better not use this.</p>\n\n<p>(I suppose if you were dealing with such amounts, you probably wouldn't ask this question here... and you wouldn't be using <code>Int</code>.)</p>\n\n<p>To fix this, you can use your original approach, but still use <code>printf</code> to format the extra zero:</p>\n\n<pre><code>type Price' = Integer\n\nformatPence' :: Price' -&gt; String\nformatPence' a = show (a `div` 100) ++ \".\" ++ printf \"%02u\" (a `mod` 100) \n</code></pre>\n\n<p>This will then work with arbitrarily ludicrous amounts:</p>\n\n<pre><code>&gt; formatPence' 1000000000000000103\n\"10000000000000001.03\"\n&gt; formatPence' 6529857623987620347562395876204395876395762398417639852764958726398527634972365928376529384\n\"65298576239876203475623958762043958763957623984176398527649587263985276349723659283765293.84\"\n</code></pre>\n\n<p>Note that the manual div/mod leads in a problem for negative amounts, but that's easy to fix.</p>\n"}, {"comments": [{"owner": {"reputation": 126, "user_id": 4577109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d1e1327d30934016b261f5120179a05?s=128&d=identicon&r=PG&f=1", "display_name": "Famous Jameis", "link": "https://stackoverflow.com/users/4577109/famous-jameis"}, "edited": false, "score": 0, "creation_date": 1602292377, "post_id": 36283482, "comment_id": 113683476, "body": "This does not answer the question, he wants a function with type &quot;Float -&gt; String&quot; this avoids that step which makes this solution useless... what if he wants to print to a file."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 12, "last_activity_date": 1459252312, "creation_date": 1459252312, "answer_id": 36283482, "question_id": 36268789, "link": "https://stackoverflow.com/questions/36268789/printing-floating-point-numbers-in-haskell/36283482#36283482", "title": "Printing floating point numbers in Haskell", "body": "<p>Perhaps you wanted one of the various <code>show*Float</code> functions in <code>Numeric</code>?</p>\n\n<pre><code>&gt; :m Numeric\n&gt; showFFloat (Just 2) 123.456 \"\"\n123.45\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1459266340, "creation_date": 1459266340, "answer_id": 36289015, "question_id": 36268789, "link": "https://stackoverflow.com/questions/36268789/printing-floating-point-numbers-in-haskell/36289015#36289015", "title": "Printing floating point numbers in Haskell", "body": "<p>You need to pad the part after the decimal with a zero.</p>\n\n<pre><code>twoDP :: Int -&gt; String\ntwoDP v = if length str == 1 then '0':str else str\n   where str = show v\n</code></pre>\n\n<p>You could write a more general padding function:</p>\n\n<pre><code>leadingZeros :: Int -&gt; Int -&gt; String\nleadingZeros n v = replicate (n - length str) '0' ++ str\n   where str = show v\n</code></pre>\n\n<p>Don't mess around with floating point versions of \"show\" or \"printf\" for this kind of thing: that way lies madness.</p>\n"}], "owner": {"reputation": 61, "user_id": 5665704, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9fqqKEDfXAQ/AAAAAAAAAAI/AAAAAAAABpg/-MFtBPAntFI/photo.jpg?sz=128", "display_name": "Siti Aisyah", "link": "https://stackoverflow.com/users/5665704/siti-aisyah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5377, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1459266340, "creation_date": 1459190438, "question_id": 36268789, "link": "https://stackoverflow.com/questions/36268789/printing-floating-point-numbers-in-haskell", "title": "Printing floating point numbers in Haskell", "body": "<p>I have a function in Haskell which looks like this</p>\n\n<pre><code>type Price    = Int\n\nformatPence :: Price -&gt; String\nformatPence a = show (a `div` 100) ++ \".\" ++ show(a `mod` 100)\n</code></pre>\n\n<p>so that, for example, if I input <code>formatPence 1023</code>, the output would be <code>\"10.23\"</code>. But I have a problem if I input <code>1202</code> because the output would be <code>\"12.2\"</code>. What should I add? Thanks :)</p>\n"}, {"tags": ["haskell", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1459192535, "post_id": 36269145, "comment_id": 60165939, "body": "That totally works.  Thanks a lot!  Also I heard that a future release of ghc the Proxy type may not be necessary.  Does anyone have any references to any info regarding that?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "reply_to_user": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 3, "creation_date": 1459193126, "post_id": 36269145, "comment_id": 60166213, "body": "@mindreader, Yes that&#39;s the <code>TypeApplication</code> extension. It will land in GHC 8, which already has a release candidate available. <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeApplication\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/TypeApplication</a>"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 5, "last_activity_date": 1459191603, "creation_date": 1459191603, "answer_id": 36269145, "question_id": 36268734, "link": "https://stackoverflow.com/questions/36268734/type-families-causes-ambiguous-variable-error/36269145#36269145", "title": "Type families causes ambiguous variable error", "body": "<p>The problem is that your type family is not injective: knowing that <code>USHand a</code> is <code>Private</code> for instance doesn't tell you exactly what <code>a</code> is: it could be <code>USSR</code> but it could also be <code>Observer</code> because both instances declare:</p>\n\n<pre><code>type USHand USSR = Private\ntype USHand Observer = Private\n</code></pre>\n\n<p>Because the function <code>toUS</code> has type <code>Public -&gt; USHand a</code>, the <code>a</code> has to be somehow guessed and we just saw that it was not possible.</p>\n\n<p>In order to fix this, you are going to need to introduce proxies. A proxy is a simple data type defined as:</p>\n\n<pre><code>data Proxy a = Proxy\n</code></pre>\n\n<p>If you have a function <code>f :: F a</code> for which Haskell is not able to guess the <code>a</code>, you can turn it into an <code>f :: Proxy a -&gt; F a</code> in order to be able to specify at the call site which <code>a</code> you mean by writing for instance <code>f (Proxy :: Proxy Int)</code> in the case where you want <code>a</code> to be <code>Int</code>.</p>\n\n<p>You'll need scoped type variables because the <code>a</code> you'll use with <code>toUs</code> will come from the type annotation of your function. So you should add these two lines at the top of your file:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.Proxy\n</code></pre>\n\n<p>And then change the type of <code>toUS</code> from <code>Public -&gt; USHand a</code> to:</p>\n\n<pre><code>toUS :: Proxy a -&gt; Public -&gt; USHand a\n</code></pre>\n\n<p>Don't forget to add a dummy argument <code>_</code> to all your instance declarations of <code>toUs</code>. Finally, you can patch your definition of <code>serverToPlayerGS</code> like so:</p>\n\n<pre><code>serverToPlayerGS :: forall a. HandType a =&gt; GameState Server -&gt; GameState a\nserverToPlayerGS (GameState turn phase bs us ussr) =\n  GameState turn phase bs (toUS (Proxy :: Proxy a) us) undefined \n</code></pre>\n"}], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 36269145, "answer_count": 1, "score": 2, "last_activity_date": 1459191603, "creation_date": 1459190221, "question_id": 36268734, "link": "https://stackoverflow.com/questions/36268734/type-families-causes-ambiguous-variable-error", "title": "Type families causes ambiguous variable error", "body": "<p>Use case: I'm writing a game in a ghcjs frontend and a backend that use essentially the same state so that I can encode the rules of the game on both sides and communicate with changes in state.  To that end a gamestate would look like</p>\n\n<pre><code>data GameState = GameState {\n  gameTurn :: Int,            -- | Everyone sees\n  gamePhase :: GamePhase,     -- | this\n  boardState :: BoardState,   -- | stuff\n  -- a lot more stuff everyone can see, followed by\n  usHand :: [Card],\n  ussrHand :: [Card]\n}\n</code></pre>\n\n<p>Where each player is represented by us and ussr.  Each player has a hand and from the server perspective it is omnicient, and knows every card in both player's hands.  But from the us player's perspective, gamestate looks more like this</p>\n\n<pre><code>data GameState = GameState {\n  -- public stuff\n  usHand :: [Card],\n  ussrHand :: Int\n}\n</code></pre>\n\n<p>That is, he can see his own hand, but he can only see how many cards his opponent has.  An observer sees even less.  The rules of the game are complex and there are a lot of things that can happen so it'd be great to encode the rules once, such that rules which affect a player's hand, such as dealing new cards, forcing a player to show a card of a type, etc, would affect each hand in the way that is appropriate depending who they are.  To that end, I ended up writing the following using type families, which doesn't work</p>\n\n<pre><code>{-# LANGUAGE  TypeFamilies, RankNTypes #-}\nmodule Test where\n\ndata Card = Card\ndata BoardState = BoardState\ndata GamePhase = GamePhase\ndata Country\ndata Player = PUS | PUSSR\n\ndata US\ndata USSR\ndata Observer\ndata Server\n\ndata Private = Private Int\ndata Public = Public [Card]\n\nclass HandType a where\n  type USHand   a :: *\n  type USSRHand a :: *\n  toUS :: Public -&gt; USHand a\n--   toUSSR :: Public -&gt; USSRHand a -- TODO\n\ninstance HandType Server where\n  type USHand Server = Public\n  type USSRHand Server = Public\n  toUS (Public cs) = Public cs\n\ninstance HandType US where\n  type USHand US = Public\n  type USSRHand US = Private\n  toUS (Public cs) = Public cs\n\ninstance HandType USSR where\n  type USHand USSR = Private\n  type USSRHand USSR = Public\n  toUS (Public cs) = Private (length cs)\n\ninstance HandType Observer where\n  type USHand Observer = Private\n  type USSRHand Observer = Private\n  toUS (Public cs) = Private (length cs)\n\ndata GameState a = GameState {\n  gameTurn :: Int,            -- | Everyone sees\n  gamePhase :: GamePhase,     -- | this\n  boardState :: BoardState,   -- | stuff\n\n  usHand :: USHand a,\n  ussrHand :: USSRHand a\n}\n\ndata Event a =\n    PlaceInfluence Player Int Country -- | Most plays don't affect\n  | PlayCard Player Card              -- | either hand\n  | DealCards (USHand a) (USSRHand a) -- | This one does\n\n-- Works\nobsEvents :: [Event US]\nobsEvents = [PlayCard PUS Card, PlayCard PUSSR Card, DealCards (Public [Card]) (Private 3)]\n\n-- Works\nserverEvents :: [Event Server]\nserverEvents = [PlayCard PUS Card, PlayCard PUSSR Card, DealCards (Public [Card, Card]) (Public [Card])]\n\n-- The server must send out the gamestate modified for the player's consumption.\n-- serverToPlayerGS :: GameState Server -&gt; GameState a\nserverToPlayerGS (GameState turn phase bs us ussr) =\n  GameState turn phase bs (toUS us) undefined -- | &lt;- Doesn't work (line 75)\n\n-- serverToPlayerEvent :: Event Server -&gt; Event a\nserverToPlayerEvent (PlaceInfluence p amt c) = PlaceInfluence p amt c\nserverToPlayerEvent (PlayCard p c) = PlayCard p c\nserverToPlayerEvent (DealCards us ussr) =\n  DealCards (toUS us) undefined -- | &lt;- Doesn't work (line 78)\n</code></pre>\n\n<p>The error on both lines 75 and 78 are both something along the lines of</p>\n\n<pre><code>Couldn't match expected type \u2018USHand a\u2019\n            with actual type \u2018USHand a0\u2019\nNB: \u2018USHand\u2019 is a type function, and may not be injective\nThe type variable \u2018a0\u2019 is ambiguous\nRelevant bindings include\n  serverToPlayerGS :: GameState Server -&gt; GameState a\n    (bound at src/Test4.hs:74:1)\nIn the fourth argument of \u2018GameState\u2019, namely \u2018(toUS us)\u2019\nIn the expression: GameState turn phase bs (toUS us) undefined\n</code></pre>\n\n<p>Or if I omit a type declaration</p>\n\n<pre><code>Could not deduce (USHand a0 ~ USHand a1)\nfrom the context (HandType a1,\n                  USHand a1 ~ USHand a,\n                  USHand t ~ Public)\n  bound by the inferred type for \u2018serverToPlayerGS\u2019:\n             (HandType a1, USHand a1 ~ USHand a, USHand t ~ Public) =&gt;\n             GameState t -&gt; GameState a\n  at src/Test4.hs:(74,1)-(75,45)\nNB: \u2018USHand\u2019 is a type function, and may not be injective\nThe type variable \u2018a0\u2019 is ambiguous\nExpected type: USHand a\n  Actual type: USHand a0\nWhen checking that \u2018serverToPlayerGS\u2019 has the inferred type\n  serverToPlayerGS :: forall t a a1.\n                      (HandType a1, USHand a1 ~ USHand a, USHand t ~ Public) =&gt;\n                      GameState t -&gt; GameState a\nProbable cause: the inferred type is ambiguous\n</code></pre>\n\n<p>I see some other answers on the site that are similar, but I'm not sure how the fixes explained would ultimately lead to the answer I'm hoping for, which is a way to write serverToPlayerGS and serverToPlayerEvent in ways that typecheck and are useful.</p>\n"}, {"tags": ["ubuntu", "haskell", "sublimetext3", "sublimetext"], "answers": [{"tags": [], "owner": {"reputation": 4007, "user_id": 5963435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85709dccdd74c3f2fbb618a3c12d4e32?s=128&d=identicon&r=PG&f=1", "display_name": "r-stein", "link": "https://stackoverflow.com/users/5963435/r-stein"}, "is_accepted": true, "score": 1, "last_activity_date": 1459267381, "last_edit_date": 1495540418, "creation_date": 1459237650, "answer_id": 36278416, "question_id": 36268644, "link": "https://stackoverflow.com/questions/36268644/sublime-text-3-on-ubuntu-how-to-make-work-an-haskell-build-system/36278416#36278416", "title": "sublime text 3 on ubuntu : how to make work an haskell build system?", "body": "<p>Just a few points:</p>\n\n<ol>\n<li>You create plugins in subfolders of Packages, e.g. the User folder</li>\n<li>The command names in the keymap are snake_case with the ending <code>Command</code> stripped of</li>\n<li>You should use a <code>WindowCommand</code> instead of a <code>TextCommand</code> for build systems</li>\n<li>You should press <code>f1</code> not <code>fn+f1</code> </li>\n<li>The exec command does not expand the variables</li>\n</ol>\n\n<p>To create your behavior press <code>Tools &gt;&gt;&gt; New Plugin...</code>, paste and save:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import sublime\nimport sublime_plugin\n\n\nclass MakeHaskellCommand(sublime_plugin.WindowCommand):\n    def run(self):\n        variables = self.window.extract_variables()\n        args = sublime.expand_variables({\n            \"working_dir\": \"${project_path:${file_path}}\",\n            \"cmd\": [\"ghc\", \"$file\"]\n        }, variables)\n        self.window.run_command('exec', args)\n</code></pre>\n\n<p>Afterwards open your keymap and insert the keybinding:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{\n    \"keys\": [\"f1\"],\n    \"command\": \"make_haskell\",\n    \"context\":\n    [\n        { \"key\": \"selector\", \"operator\": \"equal\", \"operand\": \"source.haskell\" }\n    ]\n},\n</code></pre>\n\n<p>Edit:\nIf you want do cleanup afterwards using the shell <code>rm</code> command, then you should use the <code>shell_cmd</code> instead of <code>cmd</code>. (<code>exec</code> assumes the <code>shell_cmd</code> to be a string and <code>cmd</code> to an array (<a href=\"https://stackoverflow.com/questions/35841789/sublime-build-exec-command-array/35889481#35889481\">why</a>))\nI slightly modified the plugin to cleanup afterwards:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import sublime\nimport sublime_plugin\n\n\nclass MakeHaskellCommand(sublime_plugin.WindowCommand):\n    def run(self):\n        variables = self.window.extract_variables()\n        args = sublime.expand_variables({\n            \"working_dir\": \"$file_path\",\n            \"shell_cmd\": \"ghc $file &amp;&amp; rm $file_base_name.o $file_base_name.hi\"\n        }, variables)\n        self.window.run_command('exec', args)\n</code></pre>\n"}], "owner": {"reputation": 1481, "user_id": 1766495, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7f0952fdd4c1c33e3d6c07b6ea651ff8?s=128&d=identicon&r=PG&f=1", "display_name": "lolveley", "link": "https://stackoverflow.com/users/1766495/lolveley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 36278416, "answer_count": 1, "score": 0, "last_activity_date": 1459267381, "creation_date": 1459189890, "last_edit_date": 1495541266, "question_id": 36268644, "link": "https://stackoverflow.com/questions/36268644/sublime-text-3-on-ubuntu-how-to-make-work-an-haskell-build-system", "title": "sublime text 3 on ubuntu : how to make work an haskell build system?", "body": "<p>I would like to create a building system in order to compile haskell files; note that I don't want to replace the common \"CTRL+B\" shortcut which runs the current file in a ST window.</p>\n\n<p>so, following <a href=\"https://stackoverflow.com/questions/22403119/how-to-create-a-shortcut-for-users-build-system-in-sublime-text\">this messages</a>, I created this file, located in the directory \"/opt/sublime_text\":</p>\n\n<pre><code>import sublime, sublime_plugin\n\nclass MakeHaskellCommand(sublime_plugin.TextCommand):\n   def run(self, edit):\n      self.view.window().run_command('exec', {\"working_dir\":\"${project_path:${folder}}\",'cmd': [\"ghc\",\"$file\"]})\n</code></pre>\n\n<p>then, I modified the user key binding of the sublime-haskell package:</p>\n\n<pre><code>[\n    {\n        \"keys\": [\"f1\"],\n        \"context\": [\n            { \"key\": \"haskell_source\" },\n            { \"key\": \"scanned_source\" } ],\n        \"command\": \"MakeHaskellCommand\"\n    }\n]\n</code></pre>\n\n<p>but after a restart of ST, nothing happens as I hit FN+F1.</p>\n\n<p>can you help me?</p>\n\n<p>EDIT\nthanks for your first message!\nIt works, but now I have an other problem : I would like to delete all files in the directory, except the source file and the binary.\nI can launch this plugin:</p>\n\n<pre><code>import sublime\nimport sublime_plugin\n\n\nclass MakeHaskell2Command(sublime_plugin.WindowCommand):\n    def run(self):\n        variables = self.window.extract_variables()\n        args = sublime.expand_variables({\n            \"working_dir\": \"${project_path:${file_path}}\",\n            \"cmd\": [\"rm\", \"*.hi\"],\n            \"cmd\": [\"rm\", \"*.o\"]\n        }, variables)\n        self.window.run_command('exec', args)\n</code></pre>\n\n<p>but it does not remove the files. can you help me again for this?</p>\n"}, {"tags": ["haskell", "automatic-differentiation"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1459188074, "post_id": 36267384, "comment_id": 60163387, "body": "This can&#39;t work. Within <code>dtest</code>, the model is monomorphic with the rigid <code>a</code> type variable, so <code>ad</code> has no way to inject its infinitesimals (different type!) into the model. You&#39;ll need to consent yourself with some other signature like <code>dtest :: Num a =&gt; (\u2200 b . Num b =&gt; Model (Sample b) b) -&gt; Sample a -&gt; Sample a</code>."}, {"owner": {"reputation": 153, "user_id": 1529411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dd4e353c77c670f8e84ef32fc70fcc4?s=128&d=identicon&r=PG&f=1", "display_name": "tero", "link": "https://stackoverflow.com/users/1529411/tero"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1459278298, "post_id": 36267384, "comment_id": 60211102, "body": "Great, thanks! I got it work. Had to enable also RankNTypes, and modify the code a bit."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1459365136, "post_id": 36267384, "comment_id": 60258741, "body": "@leftroundabout: Sounds like you should post that as an answer :-)"}], "owner": {"reputation": 153, "user_id": 1529411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dd4e353c77c670f8e84ef32fc70fcc4?s=128&d=identicon&r=PG&f=1", "display_name": "tero", "link": "https://stackoverflow.com/users/1529411/tero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1459278766, "creation_date": 1459185866, "last_edit_date": 1495541272, "question_id": 36267384, "link": "https://stackoverflow.com/questions/36267384/automatic-differentiation-with-custom-data-types", "title": "Automatic differentiation with custom data types", "body": "<p>I'm facing a problem while trying to differentiate custom data types using the Haskell <a href=\"https://hackage.haskell.org/package/ad\" rel=\"nofollow noreferrer\">ad</a> library. There is a related question <a href=\"https://stackoverflow.com/questions/29391114/how-to-do-automatic-differentiation-on-complex-datatypes\">here</a>, which has been helpful, but I feel might be unsufficient in this case.</p>\n\n<p>Here is a simplified version of the issue that I'm facing:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveTraversable #-}\n\nimport Numeric.AD\nimport Data.Foldable\nimport Data.Traversable\n\ndata Sample a = Sample a deriving (Show, Traversable, Foldable, Functor)\n\ndata Model s a = Model {\n  sample_logp :: s -&gt; a\n}\n\ninstance Functor (Model s) where\n  fmap f m = Model {\n    sample_logp = f . (sample_logp m)\n  }\n\ndtest :: (Num a) =&gt; Model (Sample a) a -&gt; Sample a -&gt; Sample a\ndtest m x = grad (\\x' -&gt; test (fmap auto m) x') x\n\ntest :: Num a =&gt; Model (Sample a) a -&gt; Sample a -&gt; a\ntest m x = (sample_logp m)  x\n</code></pre>\n\n<p>This results in the following error message:</p>\n\n<pre><code>Test.hs:22:42:\nCould not deduce (a ~ Numeric.AD.Internal.Reverse.Reverse s a)\nfrom the context (Num a)\n  bound by the type signature for\n             dtest :: Num a =&gt; Model (Sample a) a -&gt; Sample a -&gt; Sample a\n  at Test.hs:21:10-62\nor from (Data.Reflection.Reifies\n           s Numeric.AD.Internal.Reverse.Tape)\n  bound by a type expected by the context:\n             Data.Reflection.Reifies s Numeric.AD.Internal.Reverse.Tape =&gt;\n             Sample (Numeric.AD.Internal.Reverse.Reverse s a)\n             -&gt; Numeric.AD.Internal.Reverse.Reverse s a\n  at Test.hs:22:13-49\n  \u2018a\u2019 is a rigid type variable bound by\n      the type signature for\n        dtest :: Num a =&gt; Model (Sample a) a -&gt; Sample a -&gt; Sample a\n      at Test.hs:21:10\nExpected type: Model\n                 (Sample (Numeric.AD.Internal.Reverse.Reverse s a)) a\n  Actual type: Model (Sample a) a\nRelevant bindings include\n  x' :: Sample (Numeric.AD.Internal.Reverse.Reverse s a)\n    (bound at Test.hs:22:20)\n  x :: Sample a (bound at Test.hs:22:9)\n  m :: Model (Sample a) a (bound at Test.hs:22:7)\n  dtest :: Model (Sample a) a -&gt; Sample a -&gt; Sample a\n    (bound at Test.hs:22:1)\nIn the second argument of \u2018fmap\u2019, namely \u2018m\u2019\nIn the first argument of \u2018test\u2019, namely \u2018(fmap auto m)\u2019\n</code></pre>\n\n<p>Edit: Got this to work with leftaroundabout's suggestion:</p>\n\n<pre><code>dtest :: forall a . (Num a) =&gt; (forall b . (Num b) =&gt; Model (Sample b) b) -&gt; Sample a -&gt; Sample a\ndtest m x = grad go x\n  where\n    go :: forall t. (Scalar t ~ a, Mode t) =&gt; Sample t -&gt; t\n    go = test m\n</code></pre>\n"}, {"tags": ["haskell", "sublimetext3", "sublimetext"], "answers": [{"tags": [], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "is_accepted": true, "score": 1, "last_activity_date": 1459184521, "creation_date": 1459184521, "answer_id": 36267012, "question_id": 36266309, "link": "https://stackoverflow.com/questions/36266309/sublime-text-3-haskell-change-compilation-directory/36267012#36267012", "title": "sublime text 3 &amp; haskell : change compilation directory", "body": "<p><code>ctrl + b</code> doesnt produce binaries, it runs <code>runhaskell</code> instead. If you want to create binaries you have to define your own Sublime's build system. To do so use <code>Tools -&gt; Build System -&gt; New Build System ...</code> and use any python script you want. More info about build systems can be found in Sublime's manual.</p>\n"}], "owner": {"reputation": 1481, "user_id": 1766495, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7f0952fdd4c1c33e3d6c07b6ea651ff8?s=128&d=identicon&r=PG&f=1", "display_name": "lolveley", "link": "https://stackoverflow.com/users/1766495/lolveley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 36267012, "answer_count": 1, "score": 0, "last_activity_date": 1459184521, "creation_date": 1459181911, "question_id": 36266309, "link": "https://stackoverflow.com/questions/36266309/sublime-text-3-haskell-change-compilation-directory", "title": "sublime text 3 &amp; haskell : change compilation directory", "body": "<p>I use sublime text 3 on linux mint 17.3, with the haskell plugin.</p>\n\n<p>I opened a directory containing a haskell file (.hs) and I edited it, but when I hit CTRL+B to launch it, it is run correctly but I don't see the binaries file produced in the folder of the source file.</p>\n\n<p>do you know:\n- where the files are?\n- how I can change this setting?(I searched in the settings but without success)</p>\n\n<p>thanks</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 8, "creation_date": 1459167072, "post_id": 36262016, "comment_id": 60152067, "body": "It cannot be a functor: <code>a</code> is at both covariant and contravariant position."}, {"owner": {"reputation": 153, "user_id": 1529411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dd4e353c77c670f8e84ef32fc70fcc4?s=128&d=identicon&r=PG&f=1", "display_name": "tero", "link": "https://stackoverflow.com/users/1529411/tero"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1459167538, "post_id": 36262016, "comment_id": 60152339, "body": "Thank you! In that case, is there some other type class which would achieve this?"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 3, "creation_date": 1459167777, "post_id": 36262016, "comment_id": 60152462, "body": "You may check <a href=\"http://hackage.haskell.org/package/profunctors-5.2/docs/Data-Profunctor.html\" rel=\"nofollow noreferrer\">Profunctor</a>, but the design choice depends heavily on what <code>s</code> is."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1459167805, "post_id": 36262016, "comment_id": 60152475, "body": "@tero If you can restrict <code>s</code> to be a <a href=\"http://hackage.haskell.org/package/contravariant-1.4/docs/Data-Functor-Contravariant.html\" rel=\"nofollow noreferrer\"><code>Contravariant</code></a>, you can define a functor instance for <code>Model s</code>. It&#39;s hard to tell whether that would be useful for your case."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459184852, "post_id": 36262016, "comment_id": 60161549, "body": "You can write an <a href=\"https://hackage.haskell.org/package/invariant-0.3.1/docs/Data-Functor-Invariant.html\" rel=\"nofollow noreferrer\"><code>Invariant</code></a> instance for it, but that may not win you much."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 9, "last_activity_date": 1459172961, "last_edit_date": 1459172961, "creation_date": 1459172578, "answer_id": 36263618, "question_id": 36262016, "link": "https://stackoverflow.com/questions/36262016/haskell-functor-from-this-data-type/36263618#36263618", "title": "Haskell: functor from this data type?", "body": "<p>The standard approach here is to add more type variables.</p>\n\n<pre><code>data Model s a b = Model {\n  sample_logp :: s a -&gt; b\n}\n</code></pre>\n\n<p>Once you have split the type variables, you have access to more tools.  The <a href=\"http://hackage.haskell.org/package/profunctors-5.2/docs/Data-Profunctor.html\">Profunctor</a> class is appropriate here. (Not typechecked since I don't have ghc on this system - comment or just fix it if my implementation is off.)</p>\n\n<pre><code>instance (Functor s) =&gt; Profunctor (Model s) where\n    dimap f g (Model h) = Model $ g . h . fmap f\n    lmap f (Model h) = Model $ h . fmap f\n    rmap g (Model h) = Model $ g . h\n</code></pre>\n\n<p>Now, given that you have a <code>Model s a a</code>, which is the equivalent of your <code>Model s a</code>, you can convert it to a <code>Model s b b</code> by using <code>dimap bToA aToB</code>.</p>\n\n<p>As the comments say, your original data type is invariant because it uses the same type variable in positive and negative positions.  This means you need to supply conversion functions in each direction. Adding an extra type variable lets you take advantage of existing tools for doing that, like <code>Profunctor</code>.</p>\n\n<hr>\n\n<p>Note that all of the above is based on the assumption that you are using covariant types for <code>s</code>.  If <code>s</code> is contravariant, then you can write a direct <code>Functor</code> instance for your original type, as chi's comment says.  That's a much less common situation, though.</p>\n"}], "owner": {"reputation": 153, "user_id": 1529411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dd4e353c77c670f8e84ef32fc70fcc4?s=128&d=identicon&r=PG&f=1", "display_name": "tero", "link": "https://stackoverflow.com/users/1529411/tero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1459172961, "creation_date": 1459166951, "question_id": 36262016, "link": "https://stackoverflow.com/questions/36262016/haskell-functor-from-this-data-type", "title": "Haskell: functor from this data type?", "body": "<p>Sorry about bad title. I have a problematic data type, which I'm trying to define as instance of functor.</p>\n\n<p>So basically, what I have is something, which has</p>\n\n<pre><code>sample_logp :: s a -&gt; a\n</code></pre>\n\n<p>and it should be transformed using</p>\n\n<pre><code>(a -&gt; b)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>sample_logp :: s b -&gt; b\n</code></pre>\n\n<p>. The following code does not quite accomplish this, and succeeds only in</p>\n\n<pre><code>sample_logp :: s a -&gt; b  \n</code></pre>\n\n<p>.</p>\n\n<pre><code>data Model s a = Model {\n  sample_logp :: s a -&gt; a\n}\n\ninstance Functor (Model s) where\n  fmap f m = Model {\n    sample_logp = sample_logp'\n  } where sample_logp' x = (f . (sample_logp m)) x\n</code></pre>\n\n<p>Is what I'm trying even possible? If so, how could this code be updated to achieve this?</p>\n"}, {"tags": ["haskell", "tail-recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1459154495, "post_id": 36258786, "comment_id": 60146181, "body": "I think you indeed did it the correct way. Only point of comment is that you place the type signature below the implementation. This is not wrong, but a bit weird."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1459157577, "post_id": 36258786, "comment_id": 60147455, "body": "Side note: why not simply <code>Node a (Tree a) (Tree a)</code>? Using a triple as you do adds one unnecessary level of indirection..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1459165407, "post_id": 36258786, "comment_id": 60151197, "body": "the implementation will produce what you expect but it&#39;s not tail-recursive (the second call to <code>inorder</code> for the right subtree is not in tail-call position) - but in Haskell we don&#39;t care about TCO here as this will produce a lazy-structure (the list) anway - indeed a simple <code>inorder left ++ [n] ++ inorder righ</code> might be more idiomatic"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1459178730, "post_id": 36258786, "comment_id": 60158496, "body": "@Carsten, that simple version runs into painful left-stacked list concatenation."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459180464, "post_id": 36258786, "comment_id": 60159500, "body": "@dfeuer true of course - the question is if this really is important at this point"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459184707, "post_id": 36264814, "comment_id": 60161482, "body": "That bit about compiling calls to <code>jmp</code> is a bit fishy. Thunks <i>can</i> stack up, causing trouble. This just isn&#39;t a problem in many cases Scheme or ML programmers might imagine."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459185259, "post_id": 36264814, "comment_id": 60161758, "body": "@dfeuer I think it&#39;s oversimplifying too so I&#39;ve removed it. But it&#39;s also not necessarily a problem that can be solved by putting something in tail recursive form though is it? After all, the code I wrote is essentially what you&#39;d get with a CPS transformation which is not so dis-similar to what you&#39;d get with STG, some of these things just allocate context and with Haskell we don&#39;t allocate that context in the place pointed to by <code>%esp</code> unlike C basically. Seem fairer?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459188191, "post_id": 36264814, "comment_id": 60163443, "body": "I don&#39;t know any of the assembly details, unfortunately. I fully agree that blindly making everything tail recursive is the wrong way to go! I try to think in terms of how computations stack up behind constructors, or, more heuristically, try to make small things strict and tail recursive and try to make large things lazy and incremental."}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 7, "last_activity_date": 1459185282, "last_edit_date": 1459185282, "creation_date": 1459176706, "answer_id": 36264814, "question_id": 36258786, "link": "https://stackoverflow.com/questions/36258786/tree-traversal-inorder-tail-recursion/36264814#36264814", "title": "Tree traversal inorder tail recursion", "body": "<p>This technically isn't tail recursive because you have a recursive call <code>inorder right temp</code> in a nontail position. One way to fix this would be with continuations. You write a function which takes an accumulator like before, but rather than the accumulator being just a list it's actually a function representing the work left to do in the computation. This means that instead of making a non-tail call and just returning, we can always tail call because the context we need is saved to the continuation.</p>\n\n<pre><code>  inorder = go id\n    where go :: ([a] -&gt; r) -&gt; Tree a -&gt; r\n          go k Leaf = k []\n          go k (Node a l r) = go l (\\ls -&gt; go r (\\rs -&gt; k $ ls ++ n : rs))\n</code></pre>\n\n<p>Here every call is a tail call as required but it's quite innefficient because it requires a <code>++</code> operation at every level, pushing us into quadratic costs. A more efficient algorithm would avoid building up an explicit list and instead build up a difference list, delaying the construction on the concrete structure and giving a more efficient algorithm</p>\n\n<pre><code>type Diff a = [a] -&gt; [a] -- A difference list is just a function\n\nnil :: Diff a\nnil xs = xs\n\ncons :: a -&gt; Diff a -&gt; Diff a\ncons a d = (:) a . d\n\nappend :: Diff a -&gt; Diff a -&gt; Diff a\nappend xs ys = xs . ys\n\ntoList :: Diff a -&gt; a\ntoList xs = xs []\n</code></pre>\n\n<p>Note that all of these operations are <code>O(1)</code> except for <code>toList</code> which is <code>O(n)</code> in the number of entries. The important point here is that diff lists are cheap and easy to append so we'll construct these in our algorithm and construct the concrete list at the very end</p>\n\n<pre><code> inorder = go toList\n    where go :: (Diff a -&gt; r) -&gt; Tree a -&gt; r\n          go k Leaf = k nil\n          go k (Node a l r) = \n             go l (\\ls -&gt; go r (\\rs -&gt; k $ ls `append` cons n rs))\n</code></pre>\n\n<p>And now, through gratuitous application of functions we've gotten a completely unidiomatic Haskell program. You see in Haskell we don't really care about tail calls because we generally want to handle infinite structures correctly and that's not really possible if we demand everything be tail recursive. In fact, I would say that while not tail recursive, the code you originally had is the most idiomatic, that's even how it's implemented in <code>Data.Set</code>! It has the property that we can lazily consume the result of that <code>toList</code> and it will work with us and lazily process the tree. So in your implementation, something like</p>\n\n<pre><code>min :: Tree a -&gt; a\nmin = listToMaybe . toList\n</code></pre>\n\n<p>is going to be pretty darn close to how you would implement it by hand efficiency wise! It will not construct traverse the whole tree first like my version will have to. These sort of compositional effects of laziness pay more dividends in real Haskell code than syntactically making our code use only tail calls (which does nothing to actually guarantee space usage anyways).</p>\n"}], "owner": {"reputation": 91, "user_id": 5865871, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4e206c4171c12bb43a0e13140a07abcd?s=128&d=identicon&r=PG&f=1", "display_name": "Chase", "link": "https://stackoverflow.com/users/5865871/chase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1312, "favorite_count": 1, "accepted_answer_id": 36264814, "answer_count": 1, "score": 0, "last_activity_date": 1459185282, "creation_date": 1459154246, "question_id": 36258786, "link": "https://stackoverflow.com/questions/36258786/tree-traversal-inorder-tail-recursion", "title": "Tree traversal inorder tail recursion", "body": "<p>Did I implement inorder level-order tree transversal using tail-recursion correctly?</p>\n\n<pre><code>inorder (Leaf n) temp = n:temp\ninorder (Node (n, left, right)) temp = inorder left (n:inorder right temp)\ninorder :: Tree a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Tree is declared as </p>\n\n<pre><code>data Tree a = Leaf a | Node (a, Tree a, Tree a) deriving Show\n</code></pre>\n\n<p>and returns\n<code>[2,1,3]</code> on call <code>inorder three []</code> where <code>three = Node (1, Leaf 2, Leaf 3)</code></p>\n"}, {"tags": ["haskell", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1459152937, "post_id": 36258427, "comment_id": 60145589, "body": "What does your function <code>bdd</code> try to accomplish ? And what error does it give."}, {"owner": {"reputation": 13, "user_id": 4884741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/369526a0ae2bf53857ae2fda937c4c70?s=128&d=identicon&r=PG&f=1", "display_name": "Can", "link": "https://stackoverflow.com/users/4884741/can"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1459153086, "post_id": 36258427, "comment_id": 60145646, "body": "in that tree there will be nodes which are string and the bottom leaves are the integers, so i tried to check whether it is integer or not so call the tree again but it says tree is not in scope."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1459180644, "post_id": 36258427, "comment_id": 60159579, "body": "What is the <code>Tree</code> resulting from <code>[0,1,0,0,1,1,0,1]</code> supposed to look like?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 4884741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/369526a0ae2bf53857ae2fda937c4c70?s=128&d=identicon&r=PG&f=1", "display_name": "Can", "link": "https://stackoverflow.com/users/4884741/can"}, "edited": false, "score": 0, "creation_date": 1459153301, "post_id": 36258497, "comment_id": 60145725, "body": "it should take the list and element by element add them from the bottom left to bottom right, because this tree will be expression tree like f(x1,x2,x3)"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1459152958, "creation_date": 1459152958, "answer_id": 36258497, "question_id": 36258427, "link": "https://stackoverflow.com/questions/36258427/binary-expression-tree/36258497#36258497", "title": "Binary Expression Tree", "body": "<p>Your code tries to put <code>x</code> in a <code>Leaf</code>, requiring it to be an <code>Int</code>, and also tries to put out in a <code>Node</code>, requiring it to be a <code>String</code>. Certainly <code>Int</code> and <code>String</code> are different types, so this won't compile. Also, <code>Tree</code> is a type constructor, so you can't use it in terms. What's your code actually supposed to do?</p>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 2, "last_activity_date": 1459153278, "last_edit_date": 1459153278, "creation_date": 1459152961, "answer_id": 36258498, "question_id": 36258427, "link": "https://stackoverflow.com/questions/36258427/binary-expression-tree/36258498#36258498", "title": "Binary Expression Tree", "body": "<p>You are not using the <code>Tree</code> constructor on the recursive call of your function, bdd should return a <code>Tree</code>, wich is build with <code>Leaf</code> or <code>Node</code>, but notice that Node should be build with 2 trees with also should be built with <code>Leaf</code> or <code>Node</code>, not <code>Tree</code></p>\n\n<pre><code>bdd :: [Int] -&gt; Tree\nbdd (x:xs)= if elem x [0..9] then Leaf x else Node (show x) (bdd xs) (bdd xs)\n</code></pre>\n\n<p>You should check how you want to properly build the tree, this is just an example.</p>\n"}], "owner": {"reputation": 13, "user_id": 4884741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/369526a0ae2bf53857ae2fda937c4c70?s=128&d=identicon&r=PG&f=1", "display_name": "Can", "link": "https://stackoverflow.com/users/4884741/can"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 36258498, "answer_count": 2, "score": 0, "last_activity_date": 1459153278, "creation_date": 1459152641, "question_id": 36258427, "link": "https://stackoverflow.com/questions/36258427/binary-expression-tree", "title": "Binary Expression Tree", "body": "<p>i'm very new in haskell and i have a problem. I want to take list for ex. [0,1,0,0,1,1,0,1] and put the elements in a Tree structure which is;</p>\n\n<p><code>data Tree = Leaf Int | Node String (Tree) (Tree)</code></p>\n\n<p>so far wrote the below code but it gives an error.</p>\n\n<pre><code>bdd (x:xs)= if elem x [0..9] then Leaf x else Node x (Tree) (Tree)\n</code></pre>\n\n<p>thank you for your help! </p>\n"}, {"tags": ["haskell", "singleton-type"], "comments": [{"owner": {"reputation": 597, "user_id": 512596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ce84bd6e6f9723451f1daf95a6670874?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/512596/joey"}, "edited": false, "score": 0, "creation_date": 1459146161, "post_id": 36256557, "comment_id": 60143088, "body": "BTW I have a reason to want to write the type signature down. In the code where I&#39;m using this, I need to add some additional constraints to a function, and since I can&#39;t write down the type of a function that uses this, I can&#39;t add my extra constraints."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1459147146, "post_id": 36256557, "comment_id": 60143395, "body": "I&#39;m justified in my request because falling to include the error message would justify closing the question as off-topic. Questions about debugging should include any relevant error messages or unexpected behavior."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1459147331, "post_id": 36256557, "comment_id": 60143454, "body": "You should now follow GHC&#39;s advice and run it with <code>-fprint-explicit-kinds</code>. Somewhere, there&#39;s a kind variable <code>k2</code> coming up that isn&#39;t getting pinned down the way it should be. <code>AllowAmbiguousTypes</code> may be able to help by moving the error to the call site, where its cause may be more intuitive (no guarantees, but it&#39;s likely)."}, {"owner": {"reputation": 597, "user_id": 512596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ce84bd6e6f9723451f1daf95a6670874?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/512596/joey"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459147560, "post_id": 36256557, "comment_id": 60143542, "body": "-fprint-explicit-kinds indeed shows differing kind variables, but I can&#39;t tell where they&#39;re coming from."}, {"owner": {"reputation": 597, "user_id": 512596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ce84bd6e6f9723451f1daf95a6670874?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/512596/joey"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459147684, "post_id": 36256557, "comment_id": 60143579, "body": "AllowAmbiguousTypes does not make ghc accept the type signature."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459148093, "post_id": 36257406, "comment_id": 60143726, "body": "Ew, gross! :-( Is that ... kind application or something?"}, {"owner": {"reputation": 597, "user_id": 512596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ce84bd6e6f9723451f1daf95a6670874?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/512596/joey"}, "edited": false, "score": 0, "creation_date": 1459148183, "post_id": 36257406, "comment_id": 60143779, "body": "That does make sense! After all, DemoteRep instances do the very same thing."}, {"owner": {"reputation": 597, "user_id": 512596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ce84bd6e6f9723451f1daf95a6670874?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/512596/joey"}, "edited": false, "score": 0, "creation_date": 1459148223, "post_id": 36257406, "comment_id": 60143795, "body": "So, thank you for a great answer.. But, my, it seems that ghc could do a better job with the types it shows for this."}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 6, "last_activity_date": 1459148954, "last_edit_date": 1459148954, "creation_date": 1459147793, "answer_id": 36257406, "question_id": 36256557, "link": "https://stackoverflow.com/questions/36256557/what-is-the-type-of-matches-m-s-m-fromsing-s/36257406#36257406", "title": "what is the type of: matches m s = m == fromSing s?", "body": "<p><code>'KProxy</code> at the type level is like <code>Proxy</code> at the value level: it has a phantom. Just as we write <code>Proxy :: Proxy a</code> with the phantom type <code>a</code> at the value level, we have to turn on kind signatures and write <code>'KProxy :: KProxy k</code> with a phantom kind <code>k</code> at the type level. Hopefully that analogy makes a kind of sense. Here's what it looks like:</p>\n\n\n\n<pre><code>{-# LANGUAGE DataKinds, PolyKinds, TypeOperators, TypeFamilies, GADTs, UndecidableInstances, FlexibleContexts, KindSignatures #-}\n\nimport Data.Proxy (KProxy(..))\nimport Data.Singletons\nimport Data.Singletons.Prelude\n\nmatches ::\n  ( Eq (DemoteRep ('KProxy :: KProxy k))\n  , SingKind ('KProxy :: KProxy k)\n  ) =&gt; DemoteRep ('KProxy :: KProxy k) -&gt; Sing (a :: k) -&gt; Bool\nmatches m s = m == fromSing s\n</code></pre>\n\n<p>This type variable <code>k</code> will occur in both <code>DemoteRep ...</code> and <code>Sing ...</code>, which is what lets us type-check <code>m == fromSing s</code>.</p>\n\n<p>GHCi, though sweet and usually smart, has no idea that the type signature needs \"another level of indirection\" and needs an introduced kind variable.</p>\n\n<h2>Aside</h2>\n\n<p>I would caution aginst the majority opinion here that <code>-fprint-explicit-kinds</code> is helpful:</p>\n\n<pre><code>\u03bb&gt; :t matches\nmatches\n  :: (Eq (DemoteRep * ('KProxy *)), SingKind * ('KProxy *)) =&gt;\n     DemoteRep * ('KProxy *) -&gt; Sing * a -&gt; Bool\n</code></pre>\n\n<p>That, to me, doesn't really point a finger at what's happening here. I was only able to piece together everything by looking up the signatures for <code>DemoteRep</code>, <code>'KProxy</code>, and <code>Sing</code> with the handy-dandy <code>:info</code> command.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1459150131, "last_edit_date": 1459150131, "creation_date": 1459147818, "answer_id": 36257414, "question_id": 36256557, "link": "https://stackoverflow.com/questions/36256557/what-is-the-type-of-matches-m-s-m-fromsing-s/36257414#36257414", "title": "what is the type of: matches m s = m == fromSing s?", "body": "<p>The trouble is that you're using (essentially) a kind class, but you're not pinning down kinds properly. In particular, the three occurrences of <code>'KProxy</code> could all refer to <em>different</em> kinds. A common approach would be to <em>name</em> the proxy using an equality constraint, and use that name repeatedly. This saves a bit of typing compared to giving every proxy a signature:</p>\n\n<pre><code>matches :: (kproxy ~ ('KProxy :: KProxy k),\n            Eq (DemoteRep kproxy),\n            SingKind kproxy)\n        =&gt; DemoteRep kproxy\n            -&gt; Sing (a :: k) -&gt; Bool\n</code></pre>\n\n<p>This makes it clear that the proxies should all be the same, and in particular should have the same kind as the type passed to <code>Sing</code>.</p>\n"}], "owner": {"reputation": 597, "user_id": 512596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ce84bd6e6f9723451f1daf95a6670874?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/512596/joey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 36257406, "answer_count": 2, "score": 1, "last_activity_date": 1459150131, "creation_date": 1459143160, "last_edit_date": 1459147492, "question_id": 36256557, "link": "https://stackoverflow.com/questions/36256557/what-is-the-type-of-matches-m-s-m-fromsing-s", "title": "what is the type of: matches m s = m == fromSing s?", "body": "<p>Using the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\">singletons</a> library, this simple function compiles and works. But, ghci and ghc disagree about the type signature of it, and if either of their suggestions is pasted into the code, it will fail to compile. </p>\n\n<p>What type signature will GHC accept? ghc-7.10.3, singletons-2.0.1</p>\n\n<pre><code>{-# LANGUAGE DataKinds, PolyKinds, TypeOperators, TypeFamilies, GADTs, UndecidableInstances, FlexibleContexts #-}\n\nimport Data.Proxy (KProxy(..))\nimport Data.Singletons\nimport Data.Singletons.Prelude\n\n-- ghc rejects this type signature, but if I leave it off, ghci :t shows exactly this.\nmatches :: (Eq (DemoteRep 'KProxy), SingKind 'KProxy) =&gt; DemoteRep 'KProxy -&gt; Sing a -&gt; Bool\nmatches m s = m == fromSing s\n\nt :: Sing True\nt = sing\n\ndemo :: Bool\ndemo = matches True t\n</code></pre>\n\n<p>GHC's error with above type signature: </p>\n\n<pre><code>Couldn't match type \u2018DemoteRep 'KProxy\u2019 with \u2018DemoteRep 'KProxy\u2019\nNB: \u2018DemoteRep\u2019 is a type function, and may not be injective\nThe kind variable \u2018k2\u2019 is ambiguous\nUse -fprint-explicit-kinds to see the kind arguments\nExpected type: DemoteRep 'KProxy -&gt; Sing a -&gt; Bool\n  Actual type: DemoteRep 'KProxy -&gt; Sing a -&gt; Bool\nIn the ambiguity check for the type signature for \u2018matches\u2019:\n  matches :: forall (k :: BOX)\n                    (k1 :: BOX)\n                    (k2 :: BOX)\n                    (k3 :: BOX)\n                    (a :: k3).\n             (Eq (DemoteRep 'KProxy), SingKind 'KProxy) =&gt;\n             DemoteRep 'KProxy -&gt; Sing a -&gt; Bool\nTo defer the ambiguity check to use sites, enable AllowAmbiguousTypes\nIn the type signature for \u2018matches\u2019:\n  matches :: (Eq (DemoteRep KProxy), SingKind KProxy) =&gt;\n             DemoteRep KProxy -&gt; Sing a -&gt; Bool\n</code></pre>\n\n<p><code>ghc -Wall</code> suggests a different type signature, but the <code>BOX</code> stuff won't be accepted either:</p>\n\n<pre><code>Top-level binding with no type signature:\n         matches :: forall (k :: BOX) (a :: k).\n                    (Eq (DemoteRep 'KProxy), SingKind 'KProxy) =&gt;\n                    DemoteRep 'KProxy -&gt; Sing a -&gt; Bool\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459133840, "post_id": 36255122, "comment_id": 60140058, "body": "Note also that <code>Node (Tree a) a (Tree a)</code> will be better than either if an inorder traversal of the tree is especially meaningful (e.g., for a search tree), as this will let you use <code>deriving (Foldable, Traversable)</code> and get the results you probably want."}], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 8, "last_activity_date": 1459134720, "last_edit_date": 1459134720, "creation_date": 1459133390, "answer_id": 36255201, "question_id": 36255122, "link": "https://stackoverflow.com/questions/36255122/difference-between-tree-declarations/36255201#36255201", "title": "Difference between tree declarations?", "body": "<p>There is a difference: in the first one <code>Node</code> is a constructor with one field, a tuple. This means that when we give it a type it has the form <code>Node :: (a, Tree a, Tree a) -&gt; Tree a</code>, a function of one directly to a tree. The latter is a constructor with 3 fields so the constructor is typed with an appropriate curried function.</p>\n\n<p>Now it may appear that these are equivalent but there's a significant difference in how much indirection there is in these two declarations. In the first we have a pointer to a tuple of 3 pointers. In the second we have 3 pointers directly in the constructor. This can have some impact on efficiency (as indirection always does) and also introduces an extra value into the first definition, <code>Node undefined</code> (or more generally speaking, <code>Node _|_</code>) which doesn't have a clear equivalent in the latter.</p>\n\n<p>The reason for this is that each level of indirection in Haskell gives us the ability construct a new funky pseudo value where the outermost wrapper evaluates but the indirection (which provides laziness) points to a divergent thunk. If you looked at these in a strict language you'd find them to be isomorphic but strictly speaking they ought to have different denotations in models of Haskell.</p>\n\n<p>For idiomatic and more efficient code, opt for the latter.</p>\n"}], "owner": {"reputation": 91, "user_id": 5865871, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4e206c4171c12bb43a0e13140a07abcd?s=128&d=identicon&r=PG&f=1", "display_name": "Chase", "link": "https://stackoverflow.com/users/5865871/chase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 36255201, "answer_count": 1, "score": 2, "last_activity_date": 1459134720, "creation_date": 1459132783, "last_edit_date": 1459133325, "question_id": 36255122, "link": "https://stackoverflow.com/questions/36255122/difference-between-tree-declarations", "title": "Difference between tree declarations?", "body": "<p>What's the difference between</p>\n\n<pre><code>data Tree a = Leaf a | Node (a, Tree a, Tree a) deriving Show\n</code></pre>\n\n<p>and</p>\n\n<pre><code>data Tree a = Leaf a | Node a (Tree a) (Tree a) deriving Show\n</code></pre>\n\n<p>Note: parenthesis for node</p>\n"}, {"tags": ["haskell", "memory-leaks", "conduit", "attoparsec"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1459148864, "post_id": 36254752, "comment_id": 60144034, "body": "Did you check your code using just lazy I/O and attoparsec itself? I wouldn&#39;t be surprised if the backtracking in attoparsec is holding onto the data longer than expected."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1459171071, "post_id": 36254752, "comment_id": 60154334, "body": "@MichaelSnoyman I updated my question with a bytestring/attoparsec version, but I am not sure wether it is equivalent to the conduit version (for I am not too familiar with conduit). At least it is producing the output I expect."}], "answers": [{"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1459232801, "post_id": 36261545, "comment_id": 60180339, "body": "Since the explanation is too long for a comment, I added it as another answer."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 4, "last_activity_date": 1459235832, "last_edit_date": 1459235832, "creation_date": 1459165117, "answer_id": 36261545, "question_id": 36254752, "link": "https://stackoverflow.com/questions/36254752/conduit-producing-memory-leak/36261545#36261545", "title": "conduit: producing memory leak", "body": "<blockquote>\n  <p>Why is m2 failing?</p>\n</blockquote>\n\n<p>The input file as a character stream is:</p>\n\n<pre><code>1\\n2\\n3\\n4\\n\n</code></pre>\n\n<p>Since the <code>decimal</code> parser do not expect a newline character, after consuming the first number the remaining stream is:</p>\n\n<pre><code>\\n2\\n3\\n4\\n\n</code></pre>\n\n<p>As the input stream is not exhausted,  <code>conduitParser</code> will run the parser on the stream again, this time it cannot even consume the first character so it failed.</p>\n\n<blockquote>\n  <p>Why is m4 behaving totally different compared to all other versions and producing a space leak?</p>\n</blockquote>\n\n<p><code>decimal `sepBy` (char '\\n')</code> will only consume <code>\\n</code> between two integers, after successfully parsed four numbers, the input stream has only one character in it:</p>\n\n<pre><code>\\n\n</code></pre>\n\n<p>and <code>decimal `sepBy` (char '\\n')</code> cannot consume it, even worse it will not fail: <code>sepBy</code> can consume nothing and return empty list. Therefore it parse nothing infinitely and never terminate.</p>\n\n<blockquote>\n  <p>Why is m1 not producing [1,2,3,4]?</p>\n</blockquote>\n\n<p>I want to know it too! I guess it has something to do with fusing, maybe you should contact the author of conduit package, who just commented your question.</p>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1459289904, "post_id": 36276950, "comment_id": 60217202, "body": "is it then incorrect to use <code>conduitParser</code> should I rather use vanilla <code>parseOnly</code> and <code>CL.map</code>, if I understand correctly <code>conduitParser</code> parses a stream incrementally and is not the right choice for parsing <code>[1,2,3,4]</code>."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1459313358, "post_id": 36276950, "comment_id": 60224094, "body": "That&#39;s not what I&#39;m saying. Combining <code>CB.lines</code> and <code>conduitParser</code> is problematic because the former strips out the newlines that the latter needs to do proper parsing."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 2, "last_activity_date": 1459232787, "creation_date": 1459232787, "answer_id": 36276950, "question_id": 36254752, "link": "https://stackoverflow.com/questions/36254752/conduit-producing-memory-leak/36276950#36276950", "title": "conduit: producing memory leak", "body": "<p>To answer the question about m1: when you use <code>CB.lines</code>, you're turning input that looks like:</p>\n\n<pre><code>[\"1\\n2\\n3\\n4\\n\"]\n</code></pre>\n\n<p>into:</p>\n\n<pre><code>[\"1\", \"2\", \"3\", \"4\"]\n</code></pre>\n\n<p>Then, attoparsec parses the \"1\", waits for more input, sees the \"2\", and so on.</p>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 36261545, "answer_count": 2, "score": 4, "last_activity_date": 1459235832, "creation_date": 1459129505, "last_edit_date": 1459170733, "question_id": 36254752, "link": "https://stackoverflow.com/questions/36254752/conduit-producing-memory-leak", "title": "conduit: producing memory leak", "body": "<p>Working on some observations on a previous question (<a href=\"https://stackoverflow.com/questions/36251583/\">haskell-data-hashset-from-unordered-container-performance-for-large-sets</a>) I stumbled upon a strange memory leak</p>\n\n<pre><code>module Main where\n\nimport System.Environment (getArgs)\nimport Control.Monad.Trans.Resource (runResourceT)\nimport Data.Attoparsec.ByteString (sepBy, Parser)\nimport Data.Attoparsec.ByteString.Char8 (decimal, char)\nimport Data.Conduit\nimport qualified Data.Conduit.Attoparsec as CA\nimport qualified Data.Conduit.Binary as CB\nimport qualified Data.Conduit.List as CL\n\nmain :: IO ()\nmain = do (args:_) &lt;- getArgs\n          writeFile \"input.txt\" $ unlines $ map show [1..4 :: Int]\n          case args of \"list\" -&gt; m1\n                       \"fail\" -&gt; m2\n                       \"listlist\" -&gt; m3\n                       \"memoryleak\" -&gt; m4\n                       --UPDATE\n                       \"bs-lines\":_ -&gt; m5\n                       \"bs\":_ -&gt; m6\n                       _ -&gt; putStr $ unlines [\"Usage: conduit list\"\n                                             ,\"               fail\"\n                                             ,\"               listlist\"\n                                             ,\"               memoryleak\"\n                                             --UPDATE\n                                             ,\"               bs-lines\"\n                                             ,\"               bs\"\n                                             ]\nm1,m2,m3,m4 :: IO ()\nm1 = do hs &lt;- runResourceT\n            $  CB.sourceFile \"input.txt\"\n            $$ CB.lines\n           =$= CA.conduitParser (decimal :: Parser Int)\n           =$= CL.map snd\n           =$= CL.consume\n        print hs\nm2 = do hs &lt;- runResourceT\n            $  CB.sourceFile \"input.txt\"\n            $$ CA.conduitParser (decimal :: Parser Int)\n           =$= CL.map snd\n           =$= CL.consume\n        print hs\nm3 = do hs &lt;- runResourceT\n            $  CB.sourceFile \"input.txt\"\n            $$ CB.lines\n           =$= CA.conduitParser (decimal `sepBy` (char '\\n') :: Parser [Int])\n           =$= CL.map snd\n           =$= CL.consume\n        print hs\nm4 = do hs &lt;- runResourceT\n            $  CB.sourceFile \"input.txt\"\n            $$ CA.conduitParser (decimal `sepBy` (char '\\n') :: Parser [Int])\n           =$= CL.map snd\n           =$= CL.consume\n        print hs\n-- UPDATE\nm5 = do inpt &lt;- BS.lines &lt;$&gt; BS.readFile \"input.txt\"\n        let Right hs =  mapM (parseOnly (decimal :: Parser Int)) inpt\n        print hs\nm6 = do inpt &lt;- BS.readFile \"input.txt\"\n        let Right hs =  (parseOnly (decimal `sepBy` (char '\\n') :: Parser [Int])) inpt\n        print hs\n</code></pre>\n\n<p>Here is some example output:</p>\n\n<pre><code>$ &gt; stack exec -- example list\n[1234]\n$ &gt; stack exec -- example listlist\n[[1234]]\n$ &gt; stack exec -- conduit fail\nconduit: ParseError {errorContexts = [], errorMessage = \"Failed reading: takeWhile1\", errorPosition = 1:2}\n$ &gt; stack exec -- example memoryleak\n(Ctrl+C)\n\n-- UPDATE\n$ &gt; stack exec -- example bs-lines\n[1,2,3,4]\n$ &gt; stack exec -- example bs\n[1,2,3,4]\n</code></pre>\n\n<p>Now the questions I have is:</p>\n\n<ul>\n<li><strong>Why is <code>m1</code> not producing <code>[1,2,3,4]</code>?</strong></li>\n<li><strong>Why is <code>m2</code> failing?</strong></li>\n<li><strong>Why is <code>m4</code> behaving totally different compared to all other versions  and producing a space leak?</strong></li>\n</ul>\n"}, {"tags": ["haskell", "ghc-generics"], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1459167217, "post_id": 36255015, "comment_id": 60152148, "body": "Won&#39;t getting the projection itself and ignoring the fieldInfo be sufficient to retrieve record function? As you said, type of <code>projections</code> here is <code>NP &#39;[Code Rec -&gt; Int, Code Rec -&gt; Maybe String]</code>. Also, <code>Rep a = SOP I (Code a))</code>. Pairing that with <code>to</code> should give us <code>a</code> which is <code>Rec -&gt; Int</code>, a function, no? That is why I am confused about need for <code>:*:</code>. Will appreciate further insights here."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1459179661, "post_id": 36255015, "comment_id": 60159068, "body": "Also, how did you calculate the type of <code>projections</code>, especially in <code>ghci</code>? That step will be very helpful in experimenting."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1459185620, "post_id": 36255015, "comment_id": 60161953, "body": "Oh sorry - I thought you wanted the functions <i>and</i> their names. Indeed, you could just have <code>NP ((-&gt;) t) r</code> - that&#39;s just the functions. Also, I didn&#39;t calculate the type in GHCi - just in my head, based on my understanding of the general type. But you could ask ghci, of course, with e.g. <code>:t projections :: (Code Rec ~ &#39;[ xs ]) =&gt; NP (Projection f xs) xs</code> - the type is the general type of <code>projections</code>, and the constraint is the same one used in the question - which says <code>:: NP (Projection f &#39;[Int, Maybe String]) &#39;[Int, Maybe String]</code>."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1459192371, "post_id": 36255015, "comment_id": 60165854, "body": "Will appreciate also adding how to get the functions out of it. Type after <code>fromJust</code> is <code>NP ((-&gt;) Rec) &#39;[Int, Maybe String]</code>. However, <code>Rep a</code> requires <code>SOP I (Code a)</code>. So, <code>NP ((-&gt; Rec))  &#39;[Int, Maybe String]</code> needs to be converted to <code>NP I &#39;[ (Rec -&gt; Int), (Rec -&gt; Maybe String)]</code>. I haven&#39;t been able to figure out the type knots here yet."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1459194091, "post_id": 36255015, "comment_id": 60166758, "body": "The types <code>NP ((-&gt;) Rec) &#39;[Int, Maybe String]</code> and <code>NP I &#39;[ (Rec -&gt; Int), (Rec -&gt; Maybe String)]</code> are isomorphic. However, the latter cannot be easily expressed in a general way. It could be <code>NP I (Map ((-&gt;) Rec) &#39;[ Int, Maybe String])</code> for example - but <code>Map</code> here is a type function, meaning it is non-injective. To &quot;map&quot; over a list with <code>generics-sop</code>, you are <i>supposed</i> to use the <code>f</code> parameter of <code>NS</code> and <code>NP</code>. You should simply work with the former type - the latter type will not really allow you to use the combinators provided by the library."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1459197476, "post_id": 36255015, "comment_id": 60168506, "body": "oh, ok, so how would you work with <code>NP ((-&gt;) Rec)</code> then to get the functions out? FYI, I have added an addendum to my question above, in case you haven&#39;t noticed that. I looked in <code>generics-sop</code> documentation for combinator functions for <code>NP f</code> but couldn&#39;t figure out yet how to do what I asked in the addendum. Learning process :) Appreciate your patient explanations."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1459198293, "post_id": 36255015, "comment_id": 60168916, "body": "Depends on exactly what you want to do with your functions! If you want to do something with each function, use <code>hmap</code>, <code>hap</code> or the like, which returns another <code>NP</code>. If you need to pass each record projection to some higher-order function <code>q</code>, for example, you can write <code>hmap q (recordSelectors ..)</code>. If you need a single one of those functions, you have to decide a way to pick one. For example to arbitrarily select the first one you can use <code>hd</code> (which is a type error if called on an empty product)."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459199540, "post_id": 36255015, "comment_id": 60169572, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/107581/discussion-between-sal-and-user2407038\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 5, "last_activity_date": 1459185853, "last_edit_date": 1459185853, "creation_date": 1459131848, "answer_id": 36255015, "question_id": 36254349, "link": "https://stackoverflow.com/questions/36254349/retrieving-record-function-in-generic-sop/36255015#36255015", "title": "Retrieving record function in generic SOP", "body": "<p>The <code>generics-sop</code> library implements general combinators for working with sums of products, so you should write such a function using those combinators.</p>\n\n<p>There is one issue - <code>generics-sop</code> does not have any information about records vs. constructors on the type level, so your function will be still be partial (unless you go digging in the GHC generics <code>Rep</code>).</p>\n\n<p>For this example I'll just go with the partial function route. </p>\n\n<p>First, you need this datatype:</p>\n\n<pre><code>data (:*:) f g x = f x :*: g x deriving (Show, Eq, Ord, Functor) \n</code></pre>\n\n<p>It seems like it should be included in the library, but it isn't (or I can't find it). </p>\n\n<p>The type of the function will be </p>\n\n<pre><code>recordSelectors :: forall t r . (Code t ~ '[ r ], Generic t, HasDatatypeInfo t) \n                =&gt; Proxy t -&gt; Maybe (NP (FieldInfo :*: (-&gt;) t) r)\n</code></pre>\n\n<p>The constraint <code>Code t ~ '[ r ]</code> simply says that the sum of productions representation of <code>t</code> is a singleton list (one constructor). The return type is (maybe) a product over the list <code>r</code> (the list of record field types) where there is a <code>FieldInfo x</code> and a <code>t -&gt; x</code> for each type <code>x</code> in <code>r</code>. </p>\n\n<p>One implementation is </p>\n\n<pre><code>  case datatypeInfo (Proxy :: Proxy t) of \n    ADT _ _ (Record _ fields :* Nil) -&gt; Just $ \n      hzipWith (\\nm (Fn prj) -&gt; nm :*: (unI . prj . K . (\\(Z x) -&gt; x) . unSOP . from)) \n               fields \n               projections \n    _ -&gt; Nothing \n</code></pre>\n\n<p>Here the function determines in the given datatype is really a record, and otherwise returns <code>Nothing</code>. If it is a record, zip togther the record fields and the <code>projections</code> (defined by the library), which defines projections for an arbitrary generic product, which is essentially just <code>NP '[ Code Rec -&gt; Int, Code Rec -&gt; Maybe String ]</code> for your type. All that is left is to compose the <code>from</code> function with each projection to get the \"real\" projections. The rest (<code>Fn</code>, <code>unSOP</code>, etc.) are just identities. </p>\n\n<hr>\n\n<p>Since it turns out you just want the record projection functions, sans function names, this is even simpler. And now the function isn't partial - any one constructor type has \"record projections\". </p>\n\n<pre><code>recordSelectors' :: forall t r . (Code t ~ '[ r ], Generic t) \n                 =&gt; Proxy t -&gt; NP ((-&gt;) t) r\nrecordSelectors' _ = hmap (\\(Fn prj) -&gt; unI . prj . K . (\\(Z x) -&gt; x) . unSOP . from) \n                          projections \n</code></pre>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 1, "accepted_answer_id": 36255015, "answer_count": 1, "score": 4, "last_activity_date": 1459185853, "creation_date": 1459125739, "last_edit_date": 1459180987, "question_id": 36254349, "link": "https://stackoverflow.com/questions/36254349/retrieving-record-function-in-generic-sop", "title": "Retrieving record function in generic SOP", "body": "<p>In <a href=\"https://www.andres-loeh.de/TrueSumsOfProducts/\" rel=\"nofollow\"><code>Sum of Products</code></a> approach, how would one retrieve the record function? An example code below with record datatype (<code>ghc 7.10.3</code>):</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nimport qualified GHC.Generics as GHC\nimport Generics.SOP\ndata Rec = Rec { frec :: Int, srec :: Maybe String}\n  deriving (Show, GHC.Generic)\n\ninstance Generic Rec     -- empty\ninstance HasDatatypeInfo Rec\n</code></pre>\n\n<p>Let us see <code>DataTypeInfo</code>  at ghci prompt:</p>\n\n<pre><code>*Main&gt; datatypeInfo (Proxy :: Proxy Rec)\nADT \"Main\" \"Rec\" (Record \"Rec\" (FieldInfo \"frec\" :* (FieldInfo \"srec\" :* Nil)) :* Nil)\n</code></pre>\n\n<p>We see that <code>frec</code> and <code>srec</code> are both of type <code>FieldInfo</code> which has a constructor <code>FieldInfo</code> which takes the <code>fieldName</code> as string. So, I don't see any way to get the actual functions <code>frec :: Rec -&gt; Int</code> and <code>srec :: Rec -&gt; Maybe String</code>. I also looked at <a href=\"https://github.com/well-typed/basic-sop/blob/master/src/Generics/SOP/Show.hs\" rel=\"nofollow\">show example</a> but it doesn't use record functions. </p>\n\n<p>Will appreciate pointers on how to get the record functions (could be HList of type <code>HList '[(Rec -&gt; Int), (Rec -&gt; Maybe String)]</code>)).</p>\n\n<p><strong>Addendum to the question</strong></p>\n\n<p>I am tied up in the type knots about how to get the functions out of the projections using the approach user2407038 has laid out. So, I will like to add to the question further: how do we build a function like below using <code>SOP</code> approach on <code>Rec</code> constructor - we use both record field name as well as the function here:</p>\n\n<pre><code>[ (\"frec\" ++) . show . frec, (\"srec\" ++) . show . srec] \n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack", "hakyll"], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 4, "last_activity_date": 1459126546, "creation_date": 1459126546, "answer_id": 36254443, "question_id": 36254337, "link": "https://stackoverflow.com/questions/36254337/stack-ghc-error-invalid-option-make/36254443#36254443", "title": "stack ghc error &quot;Invalid Option `--make`", "body": "<p>the chain of command you are looking for is</p>\n\n<pre><code>&gt; stack build\n&gt; stack exec -- mysite\n</code></pre>\n\n<p>assuming your cabal file looks like</p>\n\n<pre><code>...\nexecutable mysite\n  main-is: site.hs\n  hs-source-dirs:     app\n...\n</code></pre>\n\n<p>if you want to just try running the file without compilation you can use</p>\n\n<pre><code>&gt; stack runghc app/site.hs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 16, "last_activity_date": 1459148938, "creation_date": 1459148938, "answer_id": 36257650, "question_id": 36254337, "link": "https://stackoverflow.com/questions/36254337/stack-ghc-error-invalid-option-make/36257650#36257650", "title": "stack ghc error &quot;Invalid Option `--make`", "body": "<p>Stack is interpreting your <code>--make</code> as being an option to Stack, not to the GHC subcommand. In order to tell Stack \"I'm done giving you options, the rest is for the subcommand,\" you can use a <code>--</code>, e.g.:</p>\n\n<pre><code>stack ghc -- --make site.hs\n</code></pre>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 1, "accepted_answer_id": 36257650, "answer_count": 2, "score": 10, "last_activity_date": 1459148938, "creation_date": 1459125618, "question_id": 36254337, "link": "https://stackoverflow.com/questions/36254337/stack-ghc-error-invalid-option-make", "title": "stack ghc error &quot;Invalid Option `--make`", "body": "<p>I am learning <a href=\"https://jaspervdj.be/hakyll/tutorials/02-basics.html\" rel=\"noreferrer\">Hakyll</a> a library in Haskell.  I need to run</p>\n\n<pre><code>ghc --make site.hs\n</code></pre>\n\n<p>However, I instlled ghc with <a href=\"http://docs.haskellstack.org/en/stable/README/\" rel=\"noreferrer\">Stack</a> so I can no longer run <code>ghc</code> but instead <code>stack ghc</code></p>\n\n<pre><code>$ stack ghc --make site.hs\nInvalid option `--make'\n</code></pre>\n\n<p>How am I supposed to compile my <code>site.hs</code> ??</p>\n"}, {"tags": ["arrays", "haskell", "repa", "gloss"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1459121451, "post_id": 36253205, "comment_id": 60137501, "body": "I don&#39;t think Repa has a mutable format, a reference to a memory area that can be mutated without copying the entire array.  As a result even an operation that alters a single pixel either must copy the entire array or be a &quot;delayed&quot; array that will later need forced, which would cause a full copy even if the only delayed computation is the single pixel change.  I suggest you use a mutable vector instead, perhaps with the <code>friday</code> library."}, {"owner": {"reputation": 7287, "user_id": 258848, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/2Ckug.jpg?s=128&g=1", "display_name": "dimsuz", "link": "https://stackoverflow.com/users/258848/dimsuz"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1459157399, "post_id": 36253205, "comment_id": 60147390, "body": "@ThomasM.DuBuisson I do use delayed arrays for adding points. And this array is forced by gloss on each frame. So even if I do 500 delayed traverse-s (adding 500 pixels) or even if I modify my program to do adding 500 points in one traverse (using a State monad), no matter what the result will be copying a whole array on each frame. I see, thank you."}, {"owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1459190502, "post_id": 36253205, "comment_id": 60164806, "body": "There&#39;s also yarr <a href=\"https://hackage.haskell.org/package/yarr\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/yarr</a> - see here for examples <a href=\"https://github.com/leventov/yarr/tree/master/tests\" rel=\"nofollow noreferrer\">github.com/leventov/yarr/tree/master/tests</a>"}, {"owner": {"reputation": 7287, "user_id": 258848, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/2Ckug.jpg?s=128&g=1", "display_name": "dimsuz", "link": "https://stackoverflow.com/users/258848/dimsuz"}, "reply_to_user": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1459323762, "post_id": 36253205, "comment_id": 60229178, "body": "@idontgetoutmuch I&#39;ve heard about it, but I am using repa, because it is the only array library supported by gloss for easy rendering..."}], "owner": {"reputation": 7287, "user_id": 258848, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/2Ckug.jpg?s=128&g=1", "display_name": "dimsuz", "link": "https://stackoverflow.com/users/258848/dimsuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1459116150, "creation_date": 1459116150, "question_id": 36253205, "link": "https://stackoverflow.com/questions/36253205/effective-way-to-change-a-single-value-in-repa-array", "title": "Effective way to change a single value in repa array", "body": "<p>I try to use <code>Gloss.Raster.Array</code> to effectively plot a set of points on a screen. It uses an <code>Array D DIM2 Color</code> as a container of points to plot. Currently it is a 500x500 array, representing a 'bitmap'.</p>\n\n<p>Suppose that each frame I generate 1 new point to display. </p>\n\n<p>I didn't find another way to adjust an existing repa array to contain a single new point rather than doing repa's <code>traverse</code> which looks approximately like this:</p>\n\n<pre><code>{-# INLINE traverseFn #-}\ntraverseFn px py = (\\lookupfn i@(Z :. x :. y) -&gt; \n    if x == px &amp;&amp; y == py then red else lookupfn i)\n\nnewarr px py = R.traverse oldarr id (traverseFn px py)\n</code></pre>\n\n<p>I suspected this could turn to be rather inefficient: traversing whole 500x500 array for the sake of one point. But I thought maybe ghc will do some optimization magic and it won't.</p>\n\n<p>Turns out it is. I tried to profile and it says that <code>newarr</code> takes 97.2% of time. And it works very slow too.</p>\n\n<p>I'm kinda new to the whole haskell and repa ecosystem, taking my first steps, so I might not know something or do something wrong (either in my repo code or in my profiling attempts) - hence asking for help :)</p>\n\n<p>Is there some performant way to change single value in repa array on each frame? Or if I want to add 500 points on each frame - what would be the answer then?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459133589, "post_id": 36252413, "comment_id": 60139999, "body": "Aside from the type error, I think this function is too large and mysterious. Can you break it up into smaller, self-contained pieces? Can you write comments in the code explaining, in simple language, what each piece is for?"}], "answers": [{"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 2, "last_activity_date": 1459111503, "creation_date": 1459111503, "answer_id": 36252456, "question_id": 36252413, "link": "https://stackoverflow.com/questions/36252413/haskell-tuple-of-duple-type-error/36252456#36252456", "title": "Haskell tuple of duple type error", "body": "<p>You have something like</p>\n\n<pre><code>max (ai uad) \n</code></pre>\n\n<p>in your code. This applies <code>ai</code> to <code>uad</code>\nBut I guess what you wanted was simply:</p>\n\n<pre><code>max ai uad\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1459111680, "creation_date": 1459111680, "answer_id": 36252482, "question_id": 36252413, "link": "https://stackoverflow.com/questions/36252413/haskell-tuple-of-duple-type-error/36252482#36252482", "title": "Haskell tuple of duple type error", "body": "<p>You are attempting to call <code>max</code> using (among other things)</p>\n\n<pre><code>max(ai uad)\n</code></pre>\n\n<p>This says \"Apply the function <code>ai</code> to the value <code>uad</code> and apply <code>max</code> to the result.\" You probably meant to use</p>\n\n<pre><code>max ai uad\n</code></pre>\n"}], "owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1459111716, "creation_date": 1459111285, "last_edit_date": 1459111716, "question_id": 36252413, "link": "https://stackoverflow.com/questions/36252413/haskell-tuple-of-duple-type-error", "title": "Haskell tuple of duple type error", "body": "<p>i have this data type in haskell</p>\n\n<pre><code>type Coordinate = (Int,Int)\ntype Skyline = [Coordinate]\n</code></pre>\n\n<p>And im trying to do:</p>\n\n<pre><code>combina :: (Skyline, Skyline) -&gt; Skyline\ncombina ([], x) = x\ncombina (x, []) = x\ncombina ((ii, ia):ri, (di, da):rd) = subcombina(((ii, ia):ri,0), (((di, da):rd),0), 0)\n    where subcombina(((ii, ai):ri,uai), (((id, ad):rd),uad), uaa)\n            | ai &lt; ad &amp;&amp; max(uai uad) /= uaa                      = (ii, max ai uad) : subcombina((ri,ai), ((id, ad):rd, uad), max(ai uad))\n            | ai &lt; ad &amp;&amp; max(uai uad) == uaa                      =                    subcombina((ri,ai), ((id, ad):rd, uad), uaa)\n            | ((ai &gt; ad) || (ai == ad)) &amp;&amp; max(uai uad) /= uaa    = (id, max uai ad) : subcombina(((ii, ai):ri,uai),(rd, ad), max (uai ad))\n            | ((ai &gt; ad) || (ai == ad)) &amp;&amp; max (uai uad) /= uaa   =                    subcombina(((ii, ai):ri,uai),(rd, ad), uaa)\n</code></pre>\n\n<p>So, im trying to call to subcombina with</p>\n\n<pre><code>(((leftElementOfFirstLeftListTuple,rigthElementOfFirstLeftListTuple):restOfList,anyInteger),((leftElementOfFirstRigthListTuple,rigthElementOfFirsttRigthLListTuple):restOfList,anyInteger),\nanyInteger)\n</code></pre>\n\n<p>And im getting this errors:</p>\n\n<pre><code>:l Skyline                                                                                                                                                                           \n[1 of 1] Compiling Skyline          ( Skyline.hs, interpreted )\n\nSkyline.hs:26:38:\n    Couldn't match type \u2018t0 -&gt; a0\u2019 with \u2018Int\u2019\n    Expected type: Skyline\n      Actual type: [(Int, t0 -&gt; a0)]\n    In the expression:\n      subcombina (((ii, ia) : ri, 0), (((di, da) : rd), 0), 0)\n    In an equation for \u2018combina\u2019:\n        combina ((ii, ia) : ri, (di, da) : rd)\n          = subcombina (((ii, ia) : ri, 0), (((di, da) : rd), 0), 0)\n          where\n              subcombina (((ii, ai) : ri, uai), (((id, ad) : rd), uad), uaa)\n                | ai &lt; ad &amp;&amp; max (uai uad) /= uaa\n                = (ii, max ai uad)\n                  : subcombina ((ri, ai), ((id, ad) : rd, uad), max (ai uad))\n                | ai &lt; ad &amp;&amp; max (uai uad) == uaa\n                = subcombina ((ri, ai), ((id, ad) : rd, uad), uaa)\n                | ((ai &gt; ad) || (ai == ad)) &amp;&amp; max (uai uad) /= uaa\n                = (id, max uai ad)\n                  : subcombina (((ii, ai) : ri, uai), (rd, ad), max (uai ad))\n                | ((ai &gt; ad) || (ai == ad)) &amp;&amp; max (uai uad) /= uaa\n                = subcombina (((ii, ai) : ri, uai), (rd, ad), uaa)\n\nSkyline.hs:26:55:\n    Couldn't match expected type \u2018t0 -&gt; a0\u2019 with actual type \u2018Int\u2019\n    In the expression: ia\n    In the first argument of \u2018(:)\u2019, namely \u2018(ii, ia)\u2019\n\nSkyline.hs:26:59:\n    Couldn't match type \u2018Int\u2019 with \u2018t0 -&gt; a0\u2019\n    Expected type: [(Int, t0 -&gt; a0)]\n      Actual type: [Coordinate]\n    In the second argument of \u2018(:)\u2019, namely \u2018ri\u2019\n    In the expression: (ii, ia) : ri\n\nSkyline.hs:26:73:\n    Couldn't match expected type \u2018t0 -&gt; a0\u2019 with actual type \u2018Int\u2019\n    In the expression: da\n    In the first argument of \u2018(:)\u2019, namely \u2018(di, da)\u2019\n\nSkyline.hs:26:77:\n    Couldn't match type \u2018Int\u2019 with \u2018t0 -&gt; a0\u2019\n    Expected type: [(Int, t0 -&gt; a0)]\n      Actual type: [Coordinate]\n    In the second argument of \u2018(:)\u2019, namely \u2018rd\u2019\n    In the expression: ((di, da) : rd)\n\nSkyline.hs:28:103:\n    Occurs check: cannot construct the infinite type: t1 ~ t1 -&gt; a\n    Expected type: (t1 -&gt; a) -&gt; a\n      Actual type: t1 -&gt; a\n    Relevant bindings include\n      uaa :: a -&gt; a (bound at Skyline.hs:27:62)\n      uad :: t1 -&gt; a (bound at Skyline.hs:27:56)\n      rd :: [(t, t1 -&gt; a)] (bound at Skyline.hs:27:52)\n      ad :: t1 -&gt; a (bound at Skyline.hs:27:48)\n      uai :: (t1 -&gt; a) -&gt; a (bound at Skyline.hs:27:35)\n      ri :: [(t, t1 -&gt; a)] (bound at Skyline.hs:27:32)\n      (Some bindings suppressed; use -fmax-relevant-binds=N or -fno-max-relevant-binds)\n    In the expression: ai\n    In the expression: (ri, ai)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I think i'm mixing types but i cannot found where.</p>\n"}, {"tags": ["performance", "haskell", "memory-management", "hashset", "unordered-containers"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1459110023, "post_id": 36251583, "comment_id": 60134002, "body": "To downvoters: can you leave a comment explaining what&#39;s wrong with the question?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459112324, "post_id": 36251583, "comment_id": 60134830, "body": "Since you&#39;re using Haskell, you might want to generate your file using <code>ghc -e &quot;mapM_ putStrLn [0..3999999]&quot;</code>. I don&#39;t know if that&#39;s why people down-voted, but ... maybe?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1459113024, "post_id": 36251583, "comment_id": 60135076, "body": "This isn&#39;t relevant, but the uses of <code>seq</code> in your <code>HashSet</code> code are all redundant."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1459113165, "post_id": 36251583, "comment_id": 60135122, "body": "The errors in your calculation, after a rather fast skimming of your text, is that you aren&#39;t considering the memory overhead needed for garbage collection.  GHC uses generational GC and memory use isn&#39;t tight with the exact needs of the program, which should be obvious.  Adjusting the GC with RTS flags is one way to change the situation."}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 1, "creation_date": 1459113874, "post_id": 36251583, "comment_id": 60135360, "body": "For the first example at least I think you nailed memory consumption pretty well: I get 237 MB of maximum residency (GHC 7.10.3, compiled with -O)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1459114465, "post_id": 36251583, "comment_id": 60135540, "body": "Re: my &quot;which should be obvious&quot; statement.  That seems snarky and rude on re-read so sorry about that, not sure why I included it.  At any rate, the question is well phrased and fairly complete but people do seem to forget that GC isn&#39;t free.  GHC&#39;s GC is well tuned to things that come up in the generated code, but it still is a long ways from perfect and should not be forgotten."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459115238, "post_id": 36251583, "comment_id": 60135797, "body": "An important thing to remember, from the speed angle, is that code that violates the &quot;generational hypothesis&quot; by building up large values full of pointers will tend to be slow in the presence of tracing GC."}, {"owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1459124170, "post_id": 36251583, "comment_id": 60138103, "body": "@ThomasM.DuBuisson indeed, I haven&#39;t really considered the GC overhead. Mostly because in the example where everything is sinked into a list, there shouldn&#39;t really be anything to GC, is there? For the HashSet example this is probably different. And it does indeed use over 1000MiB but if I run it with heap profiling, the resulting PostScript file maxes out at around 500 MiB which is pretty close to my calculations. Are there any GC settings I should consider in particular?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1459127285, "post_id": 36251583, "comment_id": 60138685, "body": "I ran your final test program (with no special parameters) and the program runs with ~70% GC time, 6GB allocated by the GC, ~10s total. With <code>+RTS -s -H1G</code>, ~45%, 900MB (6x less!) allocated by the GC, ~5s total. Increasing the size of the heap allows the GC to .. just not. Total allocation actually goes <i>up</i> but that isn&#39;t necessarily the only indicator of performance. Then I went crazy with <code>+RTS -s -H12G</code> - gives me 2% GC time, 80KB (!) allocated by the GC, 2s total. Moral of the story - the heap must be big enough to hold your entire (strict) data structure if you want it to go super fast."}], "owner": {"reputation": 47690, "user_id": 55925, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d4fbbf7cbb15f7076a5bc273f7fa039?s=128&d=identicon&r=PG", "display_name": "Johannes Weiss", "link": "https://stackoverflow.com/users/55925/johannes-weiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 488, "favorite_count": 0, "answer_count": 0, "score": 9, "last_activity_date": 1459108403, "creation_date": 1459106558, "last_edit_date": 1459108403, "question_id": 36251583, "link": "https://stackoverflow.com/questions/36251583/haskell-data-hashset-from-unordered-container-performance-for-large-sets", "title": "Haskell: Data.HashSet (from unordered-container) Performance for Large Sets", "body": "<h3>The data</h3>\n\n<p>First of all, let's generate some input so we have concrete data to talk about:</p>\n\n<pre><code>python -c 'for f in xrange(4000000):  print f' &gt; input.txt\n</code></pre>\n\n<p>this will generate a file <code>input.txt</code> containing the numbers from 0 to 3999999, each on its own line. That means we should have a file with 4,000,000 lines, adding up to 30,888,890 bytes, roughly 29 MiB.</p>\n\n<h3>Everything as a list</h3>\n\n<p>Right, let's load everything into memory as a <code>[Text]</code>:</p>\n\n<pre><code>import Data.Conduit\nimport Data.Text (Text)\nimport Control.Monad.Trans.Resource (runResourceT)\nimport qualified Data.Conduit.Binary as CB\nimport qualified Data.Conduit.Text as CT\nimport qualified Data.Conduit.List as CL\n\nmain :: IO ()\nmain = do\nhs &lt;- (runResourceT\n          $ CB.sourceFile \"input.txt\"\n         $$ CT.decode CT.utf8\n         =$ CT.lines\n         =$ CL.fold (\\b a -&gt; a `seq` b `seq` a:b) [])\nprint $ head hs\n</code></pre>\n\n<p>and run it:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( Test.hs, Test.o )\nLinking Test ...\n\"3999999\"\n2,425,996,328 bytes allocated in the heap\n972,945,088 bytes copied during GC\n280,665,656 bytes maximum residency (13 sample(s))\n5,120,528 bytes maximum slop\n533 MB total memory in use (0 MB lost due to fragmentation)\n\nTot time (elapsed)  Avg pause  Max pause\nGen  0      4378 colls,     0 par    0.296s   0.309s     0.0001s    0.0009s\nGen  1        13 colls,     0 par    0.452s   0.661s     0.0508s    0.2511s\n\nINIT    time    0.000s  (  0.000s elapsed)\nMUT     time    0.460s  (  0.465s elapsed)\nGC      time    0.748s  (  0.970s elapsed)\nEXIT    time    0.002s  (  0.034s elapsed)\nTotal   time    1.212s  (  1.469s elapsed)\n\n%GC     time      61.7%  (66.0% elapsed)\n\nAlloc rate    5,271,326,694 bytes per MUT second\n\nProductivity  38.3% of total user, 31.6% of total elapsed\n\n\nreal    0m1.481s\nuser    0m1.212s\nsys 0m0.232s\n</code></pre>\n\n<p>runs in 1.4s, takes 533 MB of memory. As of <a href=\"https://wiki.haskell.org/GHC/Memory_Footprint\">Haskell Wiki's Memory Footprint</a>, the 4M <code>Text</code> instances should take 6 words + 2N bytes of memory. I'm on 64 bit so one word is 8 bytes. That means it should be (6 * 8 bytes * 4000000) + (2*26888890) bytes = 234 MiB. (The 26888890 are all the bytes in <code>input.txt</code> that are not newline characters). For the list which will hold them all, we'll need additional memory of   (1 + 3N) words + N * sizeof(v). sizeof(v) should be 8 because it'll be a pointer to the <code>Text</code>. The list should then use (1 + 3 * 4000000) * 8 bytes + 4000000 * 8 bytes = 122MiB. So in total (list + strings) we'd expect 356 MiB of memory used. I don't know where difference of 177 MiB (50%) of our memory went but let's ignore that for now.</p>\n\n<h3>The large hash set</h3>\n\n<p>Finally, we shall come to the use case that I'm actually interested in: Storing all the words in a large <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.7.0/docs/Data-HashSet.html\"><code>Data.HashSet</code></a>. For that, I changed the program ever so slightly</p>\n\n<pre><code>import Data.Conduit\nimport Data.Text (Text)\nimport Control.Monad.Trans.Resource (runResourceT)\nimport qualified Data.Conduit.Binary as CB\nimport qualified Data.Conduit.Text as CT\nimport qualified Data.Conduit.List as CL\nimport qualified Data.HashSet as HS\n\nmain :: IO ()\nmain = do\nhs &lt;- (runResourceT\n          $ CB.sourceFile \"input.txt\"\n         $$ CT.decode CT.utf8\n         =$ CT.lines\n         =$ CL.fold (\\b a -&gt; a `seq` b `seq` HS.insert a b) HS.empty)\nprint $ HS.size hs\n</code></pre>\n\n<p>if we run that again</p>\n\n<pre><code>$ ghc -fforce-recomp -O3 -rtsopts Test.hs &amp;&amp; time ./Test +RTS -sstderr\n[1 of 1] Compiling Main             ( Test.hs, Test.o )\nLinking Test ...\n4000000\n6,544,900,208 bytes allocated in the heap\n6,314,477,464 bytes copied during GC\n442,295,792 bytes maximum residency (26 sample(s))\n8,868,304 bytes maximum slop\n1094 MB total memory in use (0 MB lost due to fragmentation)\n\nTot time (elapsed)  Avg pause  Max pause\nGen  0     12420 colls,     0 par    5.756s   5.869s     0.0005s    0.0034s\nGen  1        26 colls,     0 par    3.068s   3.633s     0.1397s    0.6409s\n\nINIT    time    0.000s  (  0.000s elapsed)\nMUT     time    3.567s  (  3.592s elapsed)\nGC      time    8.823s  (  9.502s elapsed)\nEXIT    time    0.008s  (  0.097s elapsed)\nTotal   time   12.399s  ( 13.192s elapsed)\n\n%GC     time      71.2%  (72.0% elapsed)\n\nAlloc rate    1,835,018,578 bytes per MUT second\n\nProductivity  28.8% of total user, 27.1% of total elapsed\n\n\nreal    0m13.208s\nuser    0m12.399s\nsys 0m0.646s\n</code></pre>\n\n<p>it's quite bad: 13s and 1094MiB of memory used. The memory footprint page lists 4.5N words + N * sizeof(v) for a hash set, that should become (4.5 * 4000000 * 8bytes) + (4000000 * 8bytes) = 167 MiB. Adding the storage for the stings (234 MiB), I'd expect 401 MiB which is more than <em>double</em>, and it feels quite slow on top of that :(.</p>\n\n<h3>Thought experiment: manually managing the memory</h3>\n\n<p>As a thought experiment: Using a language where we can manually control memory layout and implement the HashSet with <a href=\"https://en.wikipedia.org/wiki/Open_addressing\">Open addressing</a> I'd expect the following to be the sizes. For fairness, I'll expect the strings to still be in UTF-16 (which is what <code>Data.Text</code> does). Given it's 26888890 characters in total (without newlines), the strings in UTF-16 should roughly be 53777780 bytes (2 * 26888890) = 51 MiB. We will need to store the length for every string, which will be 8 bytes * 4000000 = 30 MiB. And we will need space for the hash set (4000000 * 8 bytes), again 30 MiB. Given that the hash sets are normally increased exponentially, one would maybe expect 32 MiB or 64 MiB worst case. Let's go with the worst case: 64 MiB for the table + 30 MiB for the string lengths + 51 MiB for the actual string data, grand total of 145 MiB.</p>\n\n<p>So given that <code>Data.HashSet</code> is not a specialised implementation for storing strings, the calculated 401 MiB would not be too bad but the actually used 1094 MiB seem a bit much waste.</p>\n\n<h3>The questions finally :)</h3>\n\n<p>So we finally got there:</p>\n\n<ul>\n<li>Where is the error in my calculations?</li>\n<li>Is there some problem in my implementation or is 1094 MiB really the best we can get?</li>\n</ul>\n\n<h3>Versions and stuff</h3>\n\n<ul>\n<li>I should probably use <code>ByteString</code>s instead of <code>Text</code> as I only need ascii characters</li>\n<li>I'm on GHC 7.10.1 and <code>unordered-containers-0.2.5.1</code></li>\n</ul>\n\n<h3>For comparison: 4,000,000 <code>Int</code>s:</h3>\n\n<pre><code>import Data.List (foldl')\nimport qualified Data.HashSet as HS\n\nmain = do\n    let hs = foldl' (\\b a -&gt; a `seq` b `seq` HS.insert a b) (HS.empty :: HS.HashSet Int) [1..4000000]\n    print $ HS.size hs\n</code></pre>\n\n<p>doesn't look any better:</p>\n\n<pre><code>[...]\n798 MB total memory in use (0 MB lost due to fragmentation)\n[...]\nreal    0m9.956s\n</code></pre>\n\n<p>that's almost 800 MiB for 4M Ints!</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1459100686, "post_id": 36250268, "comment_id": 60130705, "body": "btw. your explanation of the functions is just a rephrasing of your code, next time try to give an explanation in context (what are you trying to achieve), and sprinkle it with an example or two."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1459101070, "post_id": 36250268, "comment_id": 60130830, "body": "I strongly recommend turning on warnings with <code>-Wall</code>: this will help you detect these issues at compile time."}, {"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1459102538, "post_id": 36250268, "comment_id": 60131388, "body": "@epsilonhalbe Im resolving skyline problem algorithm <a href=\"http://www.geeksforgeeks.org/divide-and-conquer-set-7-the-skyline-problem/#disqus_thread\" rel=\"nofollow noreferrer\">geeksforgeeks.org/divide-and-conquer-set-7-the-skyline-probl&zwnj;&#8203;em/&hellip;</a> this is merge function"}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 2, "last_activity_date": 1459099937, "creation_date": 1459099937, "answer_id": 36250413, "question_id": 36250268, "link": "https://stackoverflow.com/questions/36250268/why-im-getting-non-exhaustive-patterns-in-function-subcombina/36250413#36250413", "title": "Why im getting &#39; Non-exhaustive patterns in function subcombina&#39;?", "body": "<p>you are pattern matching on lists</p>\n\n<pre><code>subcombina ((_:_), (_:_)) = ..\n</code></pre>\n\n<p>matches on a non-empty tuple, what this error/warning tells you is that you have forgotten to take care of cases like</p>\n\n<pre><code>subcombina ([], something) = ..\nsubcombina (something, []) = ..\nsubcombina ([], []) = ..\n</code></pre>\n"}], "owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "closed_date": 1459112815, "accepted_answer_id": 36250413, "answer_count": 1, "score": 0, "last_activity_date": 1459099937, "creation_date": 1459099063, "question_id": 36250268, "link": "https://stackoverflow.com/questions/36250268/why-im-getting-non-exhaustive-patterns-in-function-subcombina", "closed_reason": "Duplicate", "title": "Why im getting &#39; Non-exhaustive patterns in function subcombina&#39;?", "body": "<p>im learning haskell and recursion with it, i have this function</p>\n\n<pre><code>type Coordenada = (Int,Int)\ntype Skyline = [Coordenada]\n\ncombina :: (Skyline, Skyline) -&gt; Skyline\ncombina ([], x) = x\ncombina (x, []) = x\ncombina ((ii, ia):ri,(di, da):rd) = subcombina((ii, ia):ri,0) ((di, da):rd,0)\n        where subcombina ((ii, ia):ri, ih) ((di, da):rd, dh)\n                           | ii &lt; di                = (ii, max ia dh)  : subcombina(ri,ih) ((di, da):rd, dh)\n                           | otherwise              = (di, max ih da)  : subcombina((ii, ia):ri, ih) (rd, dh)\n</code></pre>\n\n<p>And im getting this error:</p>\n\n<pre><code>Exception: Skyline.hs:(26,11)-(28,92): Non-exhaustive patterns in function subcombina\n</code></pre>\n\n<p>Witch pattern im missing?</p>\n\n<p>Explaining function:</p>\n\n<p>combina (merge) receives a tuple of list of tuples, if one of them its empty, result the other.\nThen, for left list of tuples, get first tuple by element and the tail, and same for right tuple, call subcombina (submerge) with this values and 0</p>\n\n<p>subcombina receives same as combina with a integer value per tuple (tuple1,int1) (tuple2, int2), with those patterns:</p>\n\n<p>If left value of head of left tuple is bigger than left value of head of right tuple return a tuple of (first value of head of left tuple, max of integers) concat with recursive call to subcombina with left list without head and same integer as parent and right list of parent right tuple side with same integer as parent.\nIf not something similar as above.</p>\n\n<p>I hope its well explained. </p>\n"}, {"tags": ["haskell", "monad-transformers", "maybe", "writer-monad"], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 1, "creation_date": 1459078777, "post_id": 36246849, "comment_id": 60123460, "body": "This is probably the only thing I didn&#39;t try, which I should have. It does work indeed, thank you! You saved me from some more banging of my head against the wall :-)"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 3, "last_activity_date": 1459078804, "last_edit_date": 1459078804, "creation_date": 1459078434, "answer_id": 36246849, "question_id": 36246810, "link": "https://stackoverflow.com/questions/36246810/wrapping-maybe-in-writert-to-add-logging/36246849#36246849", "title": "Wrapping Maybe in WriterT to add logging", "body": "<p>In order to type-check, inner monads should be <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers#Lifting\" rel=\"nofollow\"><strong>lifted</strong></a>:</p>\n\n<pre><code>lift :: (Monad m, MonadTrans t) =&gt; m a -&gt; t m a\n</code></pre>\n\n<p>So, instead of <code>return $ q x</code>  you need to write: <code>lift $ q x</code>; as in:</p>\n\n<pre><code>qlog :: Integer -&gt; WriterT [String] Maybe Integer\nqlog x = do\n  tell [\"Querying \" ++ show x]\n  lift $ q x\n</code></pre>\n"}], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 36246849, "answer_count": 1, "score": 3, "last_activity_date": 1459078804, "creation_date": 1459078096, "question_id": 36246810, "link": "https://stackoverflow.com/questions/36246810/wrapping-maybe-in-writert-to-add-logging", "title": "Wrapping Maybe in WriterT to add logging", "body": "<p>I'm totally stuck and I feel like I can use some help now, just to stay sane. I want something as simple as adding logging capabilities to a function that returns <code>Maybe</code>, but no matter how hard I try I just can't get the types right.</p>\n\n<p>This is (as I perceive it) the closest I could get:</p>\n\n<pre><code>import Data.Maybe\nimport Control.Monad\nimport Control.Monad.Writer\n\nq :: Integer -&gt; Maybe Integer\nq x = if x &gt; 7\n      then Just x\n      else Nothing\n\nqlog :: Integer -&gt; WriterT [String] Maybe Integer\nqlog x = do\n  tell [\"Querying \" ++ show x]\n  return $ q x\n</code></pre>\n\n<p>Which still yields me a typing error:</p>\n\n<pre><code>Couldn't match type \u2018Maybe Integer\u2019 with \u2018Integer\u2019\nExpected type: WriterT [String] Maybe Integer\n  Actual type: WriterT [String] Maybe (Maybe Integer)\nIn a stmt of a 'do' block: return $ q x\nIn the expression:\n  do { tell [\"Querying \" ++ show x];\n       return $ q x }\nIn an equation for \u2018qlog\u2019:\n    qlog x\n      = do { tell [\"Querying \" ++ show x];\n             return $ q x }\n</code></pre>\n\n<p>How should I adjust the code to make it compile and work?</p>\n\n<p>Thank you so much for your help, fellow Haskellers!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1, "user_id": 6120181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f369ce82f4be1dace9bed82db605528?s=128&d=identicon&r=PG&f=1", "display_name": "azorge", "link": "https://stackoverflow.com/users/6120181/azorge"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1459075644, "post_id": 36246144, "comment_id": 60122663, "body": "arg1,arg2,arg3,arg4 :: a -&gt; a -&gt; Bool"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1459075967, "post_id": 36246144, "comment_id": 60122765, "body": "I&#39;m voting to close this question as off-topic because it&#39;s home work. Not  a really a programming question."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1459079240, "post_id": 36246144, "comment_id": 60123578, "body": "@mb14 ... homework questions are fine on SO"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1459079381, "post_id": 36246144, "comment_id": 60123617, "body": "hint: assuming the function does not <i>cheat</i> - all it has is the choice to return one of it&#39;s arguments and <code>foo arg1 arg2 arg3 arg4  = (((foo arg1) arg2) arg3) arg4</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1459080074, "creation_date": 1459080074, "answer_id": 36247059, "question_id": 36246144, "link": "https://stackoverflow.com/questions/36246144/polymorphic-functions-in-haskell/36247059#36247059", "title": "polymorphic functions in Haskell", "body": "<p>Here's a hint, only. </p>\n\n<p>Function <code>foo</code> takes two arguments since its type is <code>a -&gt; a -&gt; a</code>. However, <code>foo arg1 arg2 arg3 arg4</code> passes <em>four</em> arguments. How can that work?</p>\n\n<p>Well, we can interpret <code>foo arg1 arg2 arg3 arg4</code> as</p>\n\n<pre><code>let bar = foo arg1 arg2\nin bar arg3 arg4\n</code></pre>\n\n<p>This can only work if the result of <code>foo arg1 arg2</code> is a function (<code>bar</code>) expecting two arguments. But we know that the type of <code>bar</code> must be <code>a</code> from the type of <code>foo</code>. Hence, the type variable <code>a</code> must be chosen to be the type of a binary function, i.e. something like <code>b -&gt; c -&gt; d</code>.</p>\n\n<p>Summing up, if <code>foo :: a -&gt; a -&gt; a</code>, then we also have</p>\n\n<pre><code>foo :: (b -&gt; c -&gt; d) -&gt; (b -&gt; c -&gt; d) -&gt; (b -&gt; c -&gt; d)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6120181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f369ce82f4be1dace9bed82db605528?s=128&d=identicon&r=PG&f=1", "display_name": "azorge", "link": "https://stackoverflow.com/users/6120181/azorge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "closed_date": 1459148045, "answer_count": 1, "score": -3, "last_activity_date": 1459080074, "creation_date": 1459073258, "question_id": 36246144, "link": "https://stackoverflow.com/questions/36246144/polymorphic-functions-in-haskell", "closed_reason": "Needs more focus", "title": "polymorphic functions in Haskell", "body": "<p>Have a parametrically polymorphic function <code>foo :: a -&gt; a -&gt; a</code>. Give four of the argument so that the resulting expression\n<code>foo arg1 arg2 arg3 arg4</code> would have type <code>Bool</code>.</p>\n\n<pre><code>-- foo :: a -&gt; a -&gt; a function is defined in a code \narg1 = undefined\narg2 = undefined\narg3 = undefined\narg4 = undefined\n</code></pre>\n"}, {"tags": ["rest", "haskell", "servant"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 7, "last_activity_date": 1459053533, "creation_date": 1459053533, "answer_id": 36243897, "question_id": 36243779, "link": "https://stackoverflow.com/questions/36243779/how-to-add-a-prefix-to-all-the-end-points-in-servant/36243897#36243897", "title": "How to add a prefix to all the end points in Servant?", "body": "<p>Just create another type:</p>\n\n<pre><code>type APIv1 = \"api\" :&gt; \"v1\" :&gt; API\n</code></pre>\n"}], "owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 36243897, "answer_count": 1, "score": 4, "last_activity_date": 1459053533, "creation_date": 1459052382, "question_id": 36243779, "link": "https://stackoverflow.com/questions/36243779/how-to-add-a-prefix-to-all-the-end-points-in-servant", "title": "How to add a prefix to all the end points in Servant?", "body": "<p>I have kind of a hello world app in Haskell servant, here's a part of it:</p>\n\n<pre><code>type API = \n  \"my_items\" :&gt; Get '[JSON] [MyItem]\n  :&lt;|&gt; \"my_items\" :&gt; Capture \"id\" Int :&gt; Get '[JSON] MyItem\n  -- ...................\n</code></pre>\n\n<p>and the urls are:</p>\n\n<pre><code>  localhost/my_items\n  localhost/my_items/123\n</code></pre>\n\n<p>How can I add a prefix to the existing urls and others I'll create:</p>\n\n<pre><code>  localhost/api/v1/my_items\n  localhost/api/v1/my_items/123\n  localhost/api/v1/.....\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["haskell", "nested", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 3883, "user_id": 1529734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d967945459535ac46463f40783caf2?s=128&d=identicon&r=PG", "display_name": "stites", "link": "https://stackoverflow.com/users/1529734/stites"}, "edited": false, "score": 1, "creation_date": 1459072019, "post_id": 36243837, "comment_id": 60121702, "body": "Gah \u2014 and it <i>was</i> as simple as I thought it would be. Thank you for the tips!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3883, "user_id": 1529734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d967945459535ac46463f40783caf2?s=128&d=identicon&r=PG", "display_name": "stites", "link": "https://stackoverflow.com/users/1529734/stites"}, "edited": false, "score": 0, "creation_date": 1459074821, "post_id": 36243837, "comment_id": 60122454, "body": "@stites, no problem!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1459053392, "last_edit_date": 1459053392, "creation_date": 1459053002, "answer_id": 36243837, "question_id": 36242906, "link": "https://stackoverflow.com/questions/36242906/converting-a-nested-type-into-a-monad-transformer-stack/36243837#36243837", "title": "Converting a nested type into a monad transformer stack", "body": "<p>This exercise really shows how monad transformers can sometimes work \"inside out\". Start by figuring out how to wrap up that expression so you get something of type</p>\n\n<pre><code>ReaderT () IO (Either String (Maybe Int))\n</code></pre>\n\n<p>Then figure out how to get <code>MaybeT</code>. Etc.</p>\n\n<p>Don't forget that you're allowed to use the <code>ReaderT</code>, <code>EitherT</code>, and <code>MaybeT</code> data constructors!</p>\n\n<p>This would be a great time to try out GHC's <em>typed holes</em> if you haven't already.</p>\n"}], "owner": {"reputation": 3883, "user_id": 1529734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d967945459535ac46463f40783caf2?s=128&d=identicon&r=PG", "display_name": "stites", "link": "https://stackoverflow.com/users/1529734/stites"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 36243837, "answer_count": 1, "score": 2, "last_activity_date": 1459066128, "creation_date": 1459042275, "last_edit_date": 1459066128, "question_id": 36242906, "link": "https://stackoverflow.com/questions/36242906/converting-a-nested-type-into-a-monad-transformer-stack", "title": "Converting a nested type into a monad transformer stack", "body": "<p>I\u2019m having some trouble with one of the exercises in the Monad Transformers chapter from <a href=\"http://haskellbook.com/\" rel=\"nofollow\"><em>Haskell Programming From First Principles</em></a>. Specifically, we are given a structure that looks like <code>(const (Right (Just 1)))</code> and are asked to finish the following: </p>\n\n<pre><code>import Control.Monad.Trans.Except\nimport Control.Monad.Trans.Maybe\nimport Control.Monad.Trans.Reader\n\nembedded :: MaybeT (ExceptT String (ReaderT () IO)) Int\nembedded = ??? (const (Right (Just 1)))\n</code></pre>\n\n<p>I assume this means that we cannot change the nested structure, although the instructions are only to \"make it work.\"</p>\n\n<p>I've gone through a few routes before concluding that I am stuck. So far, from what I gather, monad transformers are most commonly created with a combination of <code>lift</code>s and <code>do</code>s \u2014 aside from the SO Q&amp;As, <a href=\"http://dev.stephendiehl.com/fun/001_basics.html#monad-transformers\" rel=\"nofollow\">Diehl summarizes pretty well here</a>. </p>\n\n<p>I've also been working with the <code>map&lt;Monad&gt;T</code> variants from the <code>transformers</code> library to get some interesting / fun results, but I can't seem to find out how to solve the original problem. Any hints would be appreciated \u2014 however, if you post a solution, <a href=\"https://meta.stackexchange.com/questions/72877/whats-the-exact-syntax-for-spoiler-markup\">please use the spoiler markup</a> (although I've never seen it used on anywhere other than in Puzzling).</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "edited": false, "score": 0, "creation_date": 1459035533, "post_id": 36242073, "comment_id": 60114607, "body": "Thank you for the response, that blew my mind. But still, how do use <code>writerStateFunction&#39;</code>? Do I need to change <code>gameRoutine</code> definition? I don&#39;t get what type matches that constraints <code>(MonadWriter [String] m, MonadState Viable m)</code>. How is that possible? In my understanding, a transformer wraps a monad and is a monad, but how come it actually inherits inner monad&#39;s &#39;traits&#39;? Definitely a lot to learn yet."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "edited": false, "score": 0, "creation_date": 1459035655, "post_id": 36242073, "comment_id": 60114629, "body": "@IlyaSmagin Both the types <code>WriterT [String] (StateT m Viable) NUM</code> and <code>StateT Viable (WriterT m [String]) NUM</code> for any <code>Monad m</code> (and also either of those types <i>inside</i> another monad transformer) match that constraint! That&#39;s the entire point - you literally just instantiate the value at different types to get the different orderings (and different orderings give different semantics for some transformers!). The &quot;inheriting&quot; you describe is exactly the mechanism of <code>mtl</code> - I would recommend the <a href=\"https://hackage.haskell.org/package/mtl\" rel=\"nofollow noreferrer\">paper linked in the docs</a>."}, {"owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "edited": false, "score": 0, "creation_date": 1459036550, "post_id": 36242073, "comment_id": 60114826, "body": "@leftaroundabout ok will try read that :) The compiler requires <code>-XFlexibleContexts</code>, so that must be some sneaky hack, right?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "edited": false, "score": 1, "creation_date": 1459037159, "post_id": 36242073, "comment_id": 60114946, "body": "@IlyaSmagin: there&#39;s not much hacky about <code>FlexibleContexts</code>, it&#39;s one of the extensions you can turn on with little concern; it basically just disables some restrictions of standard Haskell which make it easier to write a compiler; but GHC doesn&#39;t need this. When it requests <code>Overlappable</code> or even <code>IncoherentInstances</code>, that&#39;s when you should get wary..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1459035068, "last_edit_date": 1459035068, "creation_date": 1459034592, "answer_id": 36242073, "question_id": 36241959, "link": "https://stackoverflow.com/questions/36241959/how-to-call-partially-un-nest-transformers/36242073#36242073", "title": "How to call partially un-nest transformers?", "body": "<p>Well, basically the idea of <code>mtl</code> is that you <em>don't</em> need to do that. Instead of defining <code>writerStateFunction</code> with that specific signature, you define it with a generic signature</p>\n\n<pre><code>writerStateFunction' :: (MonadWriter [String] m, MonadState Viable m)\n          =&gt; m NUM\n</code></pre>\n\n<p>Then it doesn't matter that the environment where you try to use this has an extra <code>Reader</code> layer: this doesn't prevent the monad from having both <code>MonadWriter</code> and <code>MonadState</code> functionality.</p>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 3, "last_activity_date": 1459038561, "last_edit_date": 1459038561, "creation_date": 1459037638, "answer_id": 36242403, "question_id": 36241959, "link": "https://stackoverflow.com/questions/36241959/how-to-call-partially-un-nest-transformers/36242403#36242403", "title": "How to call partially un-nest transformers?", "body": "<p>You can <em>lift</em> a <code>Writer w a</code> into a <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer-Class.html#t:MonadWriter\" rel=\"nofollow\"><strong><code>MonadWriter</code></strong></a> instance by, something like:</p>\n\n<pre><code>import Control.Monad.Writer (MonadWriter, Writer, runWriter, tell)\n\nlift' :: MonadWriter w m =&gt; Writer w a -&gt; m a\nlift' wr = do\n    let (a, w) = runWriter wr\n    tell w    -- manually re-log the log msg\n    return a  -- wrap value into new context\n</code></pre>\n\n<p>then, you may simply write:</p>\n\n<pre><code>gameRoutine :: WriterT [String] (ReaderT Env (State Viable)) NUM\ngameRoutine = do\n    a &lt;- lift' writerFunction\n</code></pre>\n\n<p>as long as <code>writerFunction :: Writer [String] a</code> can be specialized with <code>a ~ NUM</code>.</p>\n"}], "owner": {"reputation": 5386, "user_id": 288091, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3194291b923afe52e71f2338b0e90977?s=128&d=identicon&r=PG", "display_name": "Ilya Smagin", "link": "https://stackoverflow.com/users/288091/ilya-smagin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 36242073, "answer_count": 2, "score": 3, "last_activity_date": 1459038561, "creation_date": 1459033783, "question_id": 36241959, "link": "https://stackoverflow.com/questions/36241959/how-to-call-partially-un-nest-transformers", "title": "How to call partially un-nest transformers?", "body": "<p><strong>Given a nesting of transformers <code>:: T2 of T1 of M0</code>, how can I utilize <code>:: T2 of M0</code>, <code>:: M2</code> ?</strong></p>\n\n<p>Here's an example: I am writing some function which requires reading, logging, and state. The definition:</p>\n\n<pre><code>gameRoutine :: WriterT [String] (ReaderT Env (State Viable)) NUM\n</code></pre>\n\n<p>If I want to call some\n <code>stateFunction :: State Viable NUM</code></p>\n\n<p>Or even <code>stateWithReaderFunction :: ReaderT Env (State Viable) NUM</code>,</p>\n\n<p>I can use <code>lift</code>:</p>\n\n<pre><code>gameRoutine = do\n    x &lt;- lift . lift $ stateFunction\n    y &lt;- lift $ stateWithReaderFunction\n</code></pre>\n\n<p>But how do I call <code>writerFunction :: Writer [String] a</code> ?</p>\n\n<p>How do I call <code>writerStateFunction :: WriterT [String] (State Viable) NUM</code> (the difference between <code>gameRoutine</code> definition is <code>ReaderT</code> layer missing)?</p>\n\n<p>Clearly I don't want to lift their definitions to one of <code>gameRoutine</code>.</p>\n"}, {"tags": ["haskell", "indexing", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1459027276, "post_id": 36241024, "comment_id": 60112277, "body": "<a href=\"http://hackage.haskell.org/package/lens-4.13.2.1/docs/Control-Lens-At.html#t:Ixed\" rel=\"nofollow noreferrer\"><code>Ixed</code></a> pretty much is what you&#39;re asking for."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1459027472, "post_id": 36241024, "comment_id": 60112346, "body": "Is not (<code>lens</code>) a restriction too big?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1459027577, "post_id": 36241024, "comment_id": 60112381, "body": "What do you mean, that <code>lens</code> is a too big dependency for a small project or that a <code>Traversal</code> doesn&#39;t do what you want?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1459027625, "post_id": 36241024, "comment_id": 60112392, "body": "<code>lens</code> too big dependency (sorry)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1459027805, "post_id": 36241024, "comment_id": 60112458, "body": "Well. <a href=\"https://ro-che.info/articles/2014-04-24-lens-unidiomatic\" rel=\"nofollow noreferrer\">Arguably</a>, but IMO it&#39;s not sensible to avoid <code>lens</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1459028531, "post_id": 36241024, "comment_id": 60112644, "body": "@josejuan The less dependency-heavy <code>microlens-ghc</code> package has <code>at</code> and <code>ix</code> combinators."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459036613, "post_id": 36241024, "comment_id": 60114838, "body": "I think this doesn&#39;t exist because people care about performance (or at least, personal opinion, I wouldn&#39;t use it because of performance). Quadratic time to compute occurrences of a character in a <code>Text</code> would make me sad. The <code>Ixed</code> class from lens is more general - it allows <i>updating</i> a sequence-like structure at a certain position."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1459069147, "post_id": 36241024, "comment_id": 60120978, "body": "@user2407038, <code>ByteString</code> <code>index</code> is (e.g) <code>O(1)</code> but no matter here, the question is you can write generic algorithms (e.g. knuth-morris-pratt for any struct) with only one plain and simple interface. Like <code>Data.Traversable</code> I would expect some like <code>Data.Indexable</code>, much less restrictive than <code>Data.Array.IArray</code> or &quot;heavy&quot; than <code>lens</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459109570, "post_id": 36241024, "comment_id": 60133833, "body": "<code>lens</code> is heavy because it needs to declare lots of instances to avoid orphans. If we had a better way to deal with the orphan instance problem, lens could be much lighter."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459173628, "post_id": 36241024, "comment_id": 60155766, "body": "As an important corollary to @dfeuer &#39;s comment, <code>lens</code> isn&#39;t heavy at runtime. Don&#39;t mistake having lots of dependencies for being inefficient. It has all those dependencies for compatibility with all those libraries, not because it&#39;s a difficult concept."}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1459040884, "creation_date": 1459027141, "last_edit_date": 1459040884, "question_id": 36241024, "link": "https://stackoverflow.com/questions/36241024/where-is-or-why-not-exist-one-indexed-type-class-more-generic-than-data-arr", "title": "Where is (or why not exist) one `Indexed` type class more generic than `Data.Array`?", "body": "<p>I'm looking for something like</p>\n\n<pre><code>class Indexed a e | a \u2192 e where\n  size   :: a \u2192 Int\n  at     :: a \u2192 Int \u2192 e\n</code></pre>\n\n<p>(probably using <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Ix.html#t:Ix\" rel=\"nofollow\"><code>Ix</code></a>)</p>\n\n<p>Then, any <em>indexable struct</em> can be accessed by index.</p>\n\n<p>E.g.</p>\n\n<pre><code>instance Indexed T.Text Char where\n  size = T.length\n  at   = T.index\n\ninstance Indexed [a] a where\n  size = length\n  at   = (\u203c)\n\ncount :: (Eq e, Indexed a e) \u21d2 a \u2192 e \u2192 Int\ncount a e = length $ filter (e\u2261) $ map (a `at`) [0\u2026size a - 1]\n</code></pre>\n\n<p>then</p>\n\n<pre><code>&gt; count (\"foo bar foo\" :: T.Text) 'o'\n4\n&gt; count (\"foo bar foo\" :: String) 'o'\n4\n</code></pre>\n\n<p>But (e.g) <code>Data.Text</code> and <code>Data.ByteString</code> have not instances to some similar class (or I cannot find).</p>\n"}, {"tags": ["haskell", "pi", "taylor-series"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1459022755, "post_id": 36239970, "comment_id": 60110702, "body": "You should post the actual compiler error, as well as what you don&#39;t understand about the error. Have you searched SO for the same error message and tried to apply the answers there? <a href=\"http://stackoverflow.com/search?q=%5Bhaskell%5D+%22cannot+infer+instance%22\">stackoverflow.com/&hellip;</a> ?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1459024366, "post_id": 36239970, "comment_id": 60111251, "body": "The type of pie_h takes two arguments, but the type you give only has one. You are using &quot;mod&quot;, which requires Integral types but you are in a rational context."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1459024281, "creation_date": 1459024281, "answer_id": 36240561, "question_id": 36239970, "link": "https://stackoverflow.com/questions/36239970/trying-to-make-a-pi-approximation-in-haskell/36240561#36240561", "title": "Trying to make a pi approximation in Haskell", "body": "<p>The type signature is wrong. You say that <code>pie_h</code> is a function that takes a single argument, a <code>Rational</code>, and returns a <code>Rational</code>, but then define it as a function that takes two arguments, <code>x</code> and <code>y</code>.</p>\n\n<pre><code>pie_h :: Rational -&gt; Rational -&gt; Rational\npie_h x y = ...\n</code></pre>\n\n<p>You can also simplify this a little with pattern matching and factoring out the only thing that varies, the sign of the first term.</p>\n\n<pre><code>pie_h 0 _ = 0.0\npie_h x y = (if even y then -1 else 1) / y + pie_h (x - 1.0) (y + 2.0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 1, "last_activity_date": 1459029322, "creation_date": 1459029322, "answer_id": 36241345, "question_id": 36239970, "link": "https://stackoverflow.com/questions/36239970/trying-to-make-a-pi-approximation-in-haskell/36241345#36241345", "title": "Trying to make a pi approximation in Haskell", "body": "<p>If you're using the <a href=\"https://www.wikiwand.com/en/Leibniz_formula_for_%CF%80\" rel=\"nofollow\">Leibniz's formula</a> for pi, it's not going to converge for any practical value on n.</p>\n\n<p>Regardless of the efficiency you can implement it in a more straightforward way</p>\n\n<p>Define an invert function <code>(\\x-&gt;1/x)</code> and alternate sum function (x1-x2+x3...)</p>\n\n<p>For example,</p>\n\n<pre><code>import Ratio\n\ninvert :: Integer -&gt; Rational\ninvert x = 1%x\n\naltsum :: (Num a) =&gt; [a] -&gt; a\naltsum [] = 0\naltsum (x:xs) = x - altsum xs\n</code></pre>\n\n<p>Now, combining the two with the odd number series</p>\n\n<pre><code>fromRational $ (*) 4 $ altsum $ take 100 $ map invert [1,3..]\n</code></pre>\n\n<p>gives </p>\n\n<pre><code>3.131592903558553\n</code></pre>\n\n<p>You can define your approx_pi function as </p>\n\n<pre><code>approx_pi n = (fromRational . (*) 4 . altsum . take n . map invert) [1,3..]     \n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 4806799, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/10153204055811730/picture?type=large", "display_name": "Omar Hossam Ahmed", "link": "https://stackoverflow.com/users/4806799/omar-hossam-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1625, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1459029322, "creation_date": 1459020978, "question_id": 36239970, "link": "https://stackoverflow.com/questions/36239970/trying-to-make-a-pi-approximation-in-haskell", "title": "Trying to make a pi approximation in Haskell", "body": "<p>Ok so I am trying to approximate pi according to the number of terms in the taylor expansion you provide to the function . However I am getting many errors last of which is Cannot infer instance :</p>\n\n<p>here is my code : </p>\n\n<pre><code>pie :: Rational -&gt; Rational\npie n = 4.0 * (pie_h n 1.0)\n\npie_h :: Rational -&gt; Rational\npie_h x y = if(x==0) then 0.0 \n             else if ((y mod 2.0)/=0) then (1.0/y)+ pie_h (x-1.0) (y+2.0)\n             else (-1.0/y)+(pie_h (x-1.0) (y+2.0))\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "edited": false, "score": 0, "creation_date": 1459022158, "post_id": 36240071, "comment_id": 60110473, "body": "sidenote: This turns out to be a nice use of lists, GHC appears to be clever and stream away the lists for me so it&#39;s quite efficient."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1459027985, "post_id": 36240071, "comment_id": 60112496, "body": "I can&#39;t get either of your examples to compile. I must be doing something wrong. I have pasted the error message here: <a href=\"http://lpaste.net/156961\" rel=\"nofollow noreferrer\">lpaste.net/156961</a>. I wanted to use <code>foldr</code> like in your second example but I never could work out how to generate the list of random values up front."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1459035497, "post_id": 36240071, "comment_id": 60114595, "body": "@Mika&#39;il The errors don&#39;t seem to be related to this code - they seem to point to the <code>priceJump</code> function. It compiled fine for me, however. Either of the functions in the answer appended to your code also compile for me. @jozefg Indeed, once you figure out which fusion rules you can rely on (I still haven&#39;t done so) it becomes easier - but <code>foldr &#47; replicate</code> and <code>foldr &#47; sequence &#47; replicate</code> usually work well."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1459036149, "post_id": 36240071, "comment_id": 60114735, "body": "@user2407038, yes you are right. My environment got screwed up as I entered into cabal hell. I switched to stack and all is good. Thanks for your help!"}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1459086161, "post_id": 36240071, "comment_id": 60125582, "body": "@user2407038, I have to say that your Kleisli composition example is top draw :). I came back to it today and finally grokked it! Cheers."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1459021879, "last_edit_date": 1459021879, "creation_date": 1459021574, "answer_id": 36240071, "question_id": 36238256, "link": "https://stackoverflow.com/questions/36238256/calling-a-function-with-new-values-whilst-looping/36240071#36240071", "title": "Calling a function with new values whilst looping", "body": "<p>Thinking in terms of loops in Haskell will only sometimes be useful. If you want to repeat something <code>k</code> times, you should reach for <code>replicate</code> and the like. In this case, you want to repeat the function which takes a price and produces a new price 100 times (and performs some computation in some monad), then sequence those all together in a long chain.</p>\n\n<p>With this in mind, the code becomes</p>\n\n<pre><code>loop :: PrimMonad m =&gt; Gen (PrimState m) -&gt; Int -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; m Double\nloop gen turns price rate vol ts \n  = foldr (&gt;=&gt;) \n          return \n          (replicate turns (\\p -&gt; priceJump p rate vol ts &lt;$&gt; normal 0 1 gen)) \n          price \n</code></pre>\n\n<p>It turns out that Kleisli composition (<code>&gt;=&gt; :: Monad m =&gt; (a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c</code>) does exactly what you need here. In this way you can see <code>&gt;=&gt;</code> as being like regular function composition, but inside a monad. </p>\n\n<p>Another option is to generate the random values in advance, then just deal with pure values from there - i.e pure fold over the list of random seeds. But the code doesn't end up looking that different:</p>\n\n<pre><code>loop gen turns price rate vol ts \n   = foldr (\\rnd p -&gt; priceJump p rate vol ts rnd) price &lt;$&gt; \n     replicateM turns (normal 0 1 gen)  \n</code></pre>\n"}], "owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 36240071, "answer_count": 1, "score": 2, "last_activity_date": 1459021879, "creation_date": 1459012212, "last_edit_date": 1459012326, "question_id": 36238256, "link": "https://stackoverflow.com/questions/36238256/calling-a-function-with-new-values-whilst-looping", "title": "Calling a function with new values whilst looping", "body": "<p>I am trying to write a function which loops 100 times and in this loop calls a function called priceJump. When the loop is first started the price argument to this function takes an initial value of 100. But after every loop, the function produces a new price which should be passed to the priceJump function.</p>\n\n<p>I have tried to code this logic unsuccessfully (code below).  The problem is that the code to produce a new price does so in a monadic way and so the value is of type m Double where m is constrained by the type class PrimMonad.</p>\n\n<p>I'm probably not doing this in idiomatic Haskell which is why I am experiencing these problems so any pointers in the right direction would be appreciated also. To summarise the main goal is to call the pricing function with an initial price passed in and then for every new price it generates that new price should be passed back into it.</p>\n\n<pre><code>import Control.Monad.State\nimport Control.Monad.Primitive\nimport System.Random.MWC\nimport System.Random.MWC.Distributions\n\npriceJump :: Double -- price\n          -&gt; Double -- rate\n          -&gt; Double -- vol\n          -&gt; Double -- ts\n          -&gt; Double -- rnd\n          -&gt; Double -- new price\npriceJump price rate vol ts rnd = price * (1 + (rate * ts) + (vol * sqrt(ts) * rnd))\n\nloop :: PrimMonad m =&gt; Gen (PrimState m) -&gt; Int -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; m Double\nloop gen turns price rate vol ts\n  | turns &lt;= 0 = (priceJump price rate vol ts) &lt;$&gt; (normal 0 1 gen)\n  | turns == 100 = (priceJump price rate vol ts) &lt;$&gt; (normal 0 1 gen)\n  | otherwise  = loop gen (turns - 1) (priceJump price rate vol ts) &lt;$&gt; (normal 0 1 gen) rate vol ts\n</code></pre>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 4, "last_activity_date": 1459011224, "creation_date": 1459011224, "answer_id": 36238060, "question_id": 36237876, "link": "https://stackoverflow.com/questions/36237876/can-i-convert-template-haskell-to-hs/36238060#36238060", "title": "Can I convert template haskell to .hs?", "body": "<p>One common way to do this is to write you normal Haskell code that uses the template Haskell and then feed GHC the option <code>-ddump-splices</code> and <code>-ddump-to-file</code> to have it output a file containing all of your original code but with the template Haskell expanded so you can see exactly what is being compiled.</p>\n\n<p>Another option if you want to not see the full file is to use the pretty printer that comes with the template-haskell package. <a href=\"https://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/Language-Haskell-TH-Ppr.html\" rel=\"nofollow\">The module</a> contains a number of helper functions for constructing a <code>Doc</code> which may then be rendered to a string with <code>pprint :: Doc -&gt; String</code> and outputted using the IO features of the <code>Q</code> monad.</p>\n"}], "owner": {"reputation": 13, "user_id": 6118158, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e711d4e7d547dbfc63a26384ae8d31ec?s=128&d=identicon&r=PG&f=1", "display_name": "OMars", "link": "https://stackoverflow.com/users/6118158/omars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "closed_date": 1459026632, "accepted_answer_id": 36238060, "answer_count": 1, "score": 1, "last_activity_date": 1459011224, "creation_date": 1459010044, "question_id": 36237876, "link": "https://stackoverflow.com/questions/36237876/can-i-convert-template-haskell-to-hs", "closed_reason": "Duplicate", "title": "Can I convert template haskell to .hs?", "body": "<p>I created Data with a help of Template Haskell. I use it from another program by $(code here).</p>\n\n<p>So, can I convert Data to .hs file? I want to see the structure of Data.</p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1458973574, "post_id": 36232338, "comment_id": 60095529, "body": "Since <code>randomBad</code> uses I/O actions, its type should be <code>IO String</code>, not <code>String</code>. Also, please make your code self-contained by adding the required imports."}, {"owner": {"reputation": 321, "user_id": 5544691, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10156317637545389/picture?type=large", "display_name": "cjm", "link": "https://stackoverflow.com/users/5544691/cjm"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1458973857, "post_id": 36232338, "comment_id": 60095602, "body": "@Jubobs It&#39;s now added.  I believe <code>System.Random</code> is all I need for this example (the whole bot itself uses a bunch of other imports that are probably irrelevant to this question)."}], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 5544691, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10156317637545389/picture?type=large", "display_name": "cjm", "link": "https://stackoverflow.com/users/5544691/cjm"}, "edited": false, "score": 0, "creation_date": 1458974945, "post_id": 36232391, "comment_id": 60095839, "body": "My bot is based on the code in <a href=\"https://wiki.haskell.org/Roll_your_own_IRC_bot\" rel=\"nofollow noreferrer\">example 4 of this tutorial</a>, and it looks like I may need to change a whole bunch of things in there (specifically, the <code>privmsg</code> function) to deal with <code>IO String</code>s.  Is this true, or is there some other refactoring I can do to avoid changing a bunch of types?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 321, "user_id": 5544691, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10156317637545389/picture?type=large", "display_name": "cjm", "link": "https://stackoverflow.com/users/5544691/cjm"}, "edited": false, "score": 0, "creation_date": 1458977414, "post_id": 36232391, "comment_id": 60096358, "body": "I just glanced quickly, but it looks like everything is already in the IO monad in that tutorial, so you probably won&#39;t have to change much....  The trick is that you can only use one IO monad in another (and so on until main), so if you have some pure portion of the code, you will not be able to use any random generator in it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1458999804, "post_id": 36232391, "comment_id": 60102461, "body": "Just a note on terminology; <code>randomBad</code> itself is not in the IO monad; it is just a function that returns a monadic value. Such functions must be used &quot;in&quot; the monad, since there is no other way to extract (for example) a <code>String</code> from an <code>IO String</code> value."}, {"owner": {"reputation": 321, "user_id": 5544691, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10156317637545389/picture?type=large", "display_name": "cjm", "link": "https://stackoverflow.com/users/5544691/cjm"}, "edited": false, "score": 0, "creation_date": 1459232304, "post_id": 36232391, "comment_id": 60180042, "body": "I found that making the <code>privmsg</code> function really doesn&#39;t like to take both an <code>IO String</code> and a normal string as input.  Is there a way to let it do that, or will these need to be separate functions with identical functionality?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1459293004, "post_id": 36232391, "comment_id": 60218326, "body": "@cjm- sorry, I would need to see what you are doing to help with this....  Why don&#39;t you ask a new question?"}], "tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 2, "last_activity_date": 1458973768, "creation_date": 1458973768, "answer_id": 36232391, "question_id": 36232338, "link": "https://stackoverflow.com/questions/36232338/repeat-character-a-random-number-of-times-in-haskell/36232391#36232391", "title": "Repeat character a random number of times in Haskell", "body": "<p><code>randomBad</code> is not in the IO monad....  It is type <code>String</code>, but you are defining it to be type <code>IO String</code></p>\n\n<p>Change this</p>\n\n<pre><code>randomBad :: String\n</code></pre>\n\n<p>to this</p>\n\n<pre><code>randomBad :: IO String\n</code></pre>\n\n<p>Then you should be able to use this in another IO action, like main:</p>\n\n<pre><code>main = do\n  theString &lt;- randomBad\n  putStrLn theString\n</code></pre>\n"}], "owner": {"reputation": 321, "user_id": 5544691, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10156317637545389/picture?type=large", "display_name": "cjm", "link": "https://stackoverflow.com/users/5544691/cjm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 36232391, "answer_count": 1, "score": 0, "last_activity_date": 1458973768, "creation_date": 1458973396, "last_edit_date": 1495540770, "question_id": 36232338, "link": "https://stackoverflow.com/questions/36232338/repeat-character-a-random-number-of-times-in-haskell", "title": "Repeat character a random number of times in Haskell", "body": "<p>I'm trying to create a function for a silly IRC bot that will return a phrase where some of the letters are repeated a random number of times.  The problem I'm having is that I can't find a way to use random numbers that <code>ghc</code> likes.  It seems that even using <a href=\"https://stackoverflow.com/a/19594997/5544691\">this answer</a> isn't being particularly helpful for getting my code to compile.</p>\n\n<pre><code>import System.Random\n\n\n-- Write bad\nbaaad x y = \"B\" ++ (repeatA x) ++ \"D \" ++ (exclaim y)\n\n-- StartHere    \nrandomBad :: String\nrandomBad = do\n  x &lt;- randomRIO(5,10) :: IO Int\n  y &lt;- randomRIO(0,6) :: IO Int\n  return $ baaad x y\n\n\nrepeatA :: Int -&gt; String\nrepeatA x = rptChr \"A\" x\n\nexclaim :: Int -&gt; String\nexclaim x = rptChr \"!\" x\n\nrptChr :: String -&gt; Int -&gt; String\nrptChr x y = take y (cycle x)\n</code></pre>\n\n<p>Even with the trick of using a <code>do</code> block and passing the <code>IO Int</code>s to the function that way, I'm still getting compile errors that it found an <code>IO Int</code> when expecting <code>Int</code>.</p>\n"}, {"tags": ["user-interface", "haskell", "threepenny-gui"], "comments": [{"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458977333, "post_id": 36231818, "comment_id": 60096345, "body": "For &quot;out of band&quot; writing to stderr I suggest you take a look at <code>Debug.Trace</code>..."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 3, "creation_date": 1458988850, "post_id": 36231818, "comment_id": 60099249, "body": "In the example projects that come with threepenny-gui Both <code>putStrLn</code> and <code>hPutStrLn stderr</code> print to the console. Can you give some minimal code that reproduces the error?"}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1459153430, "post_id": 36231818, "comment_id": 60145772, "body": "I&#39;m not entirely sure, but I would guess that exceptions are re-raised as <code>ServerAppDone</code> exceptions. So, if the code you wrote throws an exception, e.g. <code>FileNotFound</code>, then you won&#39;t see this message, instead, you will see a rather non-descriptive <code>ServerAppDone</code> exception. Chances are that your code doesn&#39;t print anything because it has exiting before that due to an exception!"}], "owner": {"reputation": 66, "user_id": 5606288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/414fa94ff74b0626b93d8ad2515dfd39?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Schatz", "link": "https://stackoverflow.com/users/5606288/charles-schatz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1458968608, "creation_date": 1458968608, "question_id": 36231818, "link": "https://stackoverflow.com/questions/36231818/how-to-write-to-stderr-or-files-in-threepenny", "title": "How to Write to stderr or files in Threepenny", "body": "<p>I am using Threepenny (hello Heinrich!) to construct an image database GUI.</p>\n\n<p>As part of the diagnostic and development phase, whenever I attempt to write diagnostic files to /static (or anywhere else), Threepenny seems to throw a wobbly (only showing \"an exception escaped to toplevel: ServerAppDone\". When trying to write to stderr/stdout via print or putStrLn etc, nothing seems to come out onto the Threepenny command window launch screen's text.</p>\n\n<p>Am I missing something here, or does the way Threepenny operate prevent haskell output?</p>\n"}, {"tags": ["algorithm", "function", "haskell", "types", "functional-programming"], "comments": [{"owner": {"reputation": 432, "user_id": 2722832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/492718740ffcc1cd42f13ab9655f92b2?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2722832/martin"}, "edited": false, "score": 2, "creation_date": 1458943549, "post_id": 36228729, "comment_id": 60088750, "body": "I think there is no general strategy how to create a bijection between the two types because you have to define the bijection which is based on the logic of the two types. Can you explain what you are trying to do?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 432, "user_id": 2722832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/492718740ffcc1cd42f13ab9655f92b2?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2722832/martin"}, "edited": false, "score": 0, "creation_date": 1458943757, "post_id": 36228729, "comment_id": 60088839, "body": "I&#39;m trying to map elements of the datatype <code>Colbit</code> to binary strings, so I can perform a brute-force search on them looking for an element that satisfies some specific properties. I also want to be able to store an element on disk with the minimal amount of bits possible. (If I just serialize it naively, there will be some bitstrings that don&#39;t correspond to an element of Colbit, wasting space.)"}, {"owner": {"reputation": 432, "user_id": 2722832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/492718740ffcc1cd42f13ab9655f92b2?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2722832/martin"}, "edited": false, "score": 0, "creation_date": 1458944028, "post_id": 36228729, "comment_id": 60088937, "body": "And why don&#39;t you just map them? I didn&#39;t get the point."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 432, "user_id": 2722832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/492718740ffcc1cd42f13ab9655f92b2?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2722832/martin"}, "edited": false, "score": 0, "creation_date": 1458944436, "post_id": 36228729, "comment_id": 60089093, "body": "I don&#39;t know how to map elements of Colbit to binary strings in a way that every binary string corresponds to an element of Colbit and vice versa. That&#39;s what I&#39;m asking."}, {"owner": {"reputation": 432, "user_id": 2722832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/492718740ffcc1cd42f13ab9655f92b2?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/2722832/martin"}, "edited": false, "score": 0, "creation_date": 1458944630, "post_id": 36228729, "comment_id": 60089173, "body": "Sorry, my fault. Got it from the answer."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1458944856, "post_id": 36228729, "comment_id": 60089253, "body": "This paper is the correct answer to the question I think: <a href=\"http://research.microsoft.com/en-us/people/dimitris/every-bit-counts.pdf\" rel=\"nofollow noreferrer\">research.microsoft.com/en-us/people/dimitris/&hellip;</a> (anyone should feel free to summarize the key bits to make this a real answer)"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458944916, "post_id": 36228729, "comment_id": 60089274, "body": "(and the code from the paper is on hackage too: <a href=\"https://hackage.haskell.org/package/every-bit-counts\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/every-bit-counts</a>)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1458945090, "post_id": 36228729, "comment_id": 60089331, "body": "That paper answers every question ever? I&#39;ll think how it applies to this."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458950944, "post_id": 36228729, "comment_id": 60091223, "body": "I mean to say, that paper gives the general theory of encodings such as this. :-)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458961635, "post_id": 36228729, "comment_id": 60093423, "body": "@sclv the problem is finding the right game. I have no idea how to approach this one. The constraint makes it even harder."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458961711, "post_id": 36228729, "comment_id": 60093442, "body": "Gotcha! I&#39;ll give it a think. My first move would be to create a datatype that encodes the constraint fully, and from there i&#39;d take the datatype to the bit encoding as a second step."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1458963844, "post_id": 36228729, "comment_id": 60093763, "body": "How could the datatype encode the constraint without dependent type? And the paper doesn&#39;t cover dependent types, so..."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459033115, "post_id": 36231593, "comment_id": 60114040, "body": "@dfeuer Your proposed instance is not onto (e.g. <code>5</code> is not the image of any pair)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459192156, "post_id": 36231593, "comment_id": 60165744, "body": "I just realized it should be really easy to encode using little-endian naturals designed to ensure there are no extra zeros. <code>newtype Natural = Nat &#39;True</code> <code>data Nat mayzero where Zero :: Nat &#39;False -&gt; Nat may; One :: Nat may -&gt; Nat be; End :: Nat &#39;True</code>. Pairs can be formed by interleaving."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459192438, "post_id": 36231593, "comment_id": 60165891, "body": "@dfeuer Interleaving is trickier than you may expect. You need to know when the shorter sequence ends. See also <a href=\"http://www.sciencedirect.com/science/article/pii/002200009290027G\" rel=\"nofollow noreferrer\">the link from my previous answer</a> for a discussion of the subtle art of pairing functions, and for the definition of a particularly clean and streamable pairing function."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459216756, "post_id": 36231593, "comment_id": 60175096, "body": "That&#39;s an interesting paper. Thanks. My aim with the interleaving approach wasn&#39;t <i>efficiency</i>, as theirs is, but rather <i>correctness and simplicity</i>, which no approach using integer square roots is likely to attain simultaneously."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459224118, "post_id": 36231593, "comment_id": 60177061, "body": "@dfeuer Your goals are admirable, but your solution as I understand it is not correct. Their goals may differ from yours, but their solution meets your criteria of being both clearly correct and very simple. (I avoid it only because its implementation is less convenient on <code>Integer</code>s than it is on lists of bits -- which means either an inconveniently long implementation or the introduction of glue code. Either of those would distract from the main idea.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1459224515, "post_id": 36231593, "comment_id": 60177157, "body": "Grrr. I see now why my interleaving approach fails. I think there must be some way to make one work, but I guess it will require much more thought and care."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 10, "last_activity_date": 1458970475, "last_edit_date": 1495541726, "creation_date": 1458966276, "answer_id": 36231593, "question_id": 36228729, "link": "https://stackoverflow.com/questions/36228729/how-to-create-a-perfect-bijection-between-two-datatypes/36231593#36231593", "title": "How to create a perfect bijection between two datatypes?", "body": "<p>Step 1 is to convert the odd-ness constraint of <code>Colbit</code> to the type level:</p>\n\n<pre><code>{-# LANGUAGE TypeSynonymInstances #-}\n\ndata Color = Black | White deriving (Bounded, Enum, Eq, Ord, Read, Show)\ndata Odd = Evens Color Even Even | Odds Color Odd Odd deriving (Eq, Ord, Read, Show)\ndata Even = Tip | OddL Color Odd Even | OddR Color Even Odd deriving (Eq, Ord, Read, Show)\ntype Colbit = Odd\n</code></pre>\n\n<p>Then you can play the tricks I described in <a href=\"https://stackoverflow.com/a/23925554/791604\">my previous answer</a> to one of your questions to build a bijection with the naturals. Recalling the preamble:</p>\n\n<pre><code>type Nat = Integer\nclass Godel a where\n    to :: a -&gt; Nat\n    from :: Nat -&gt; a\n\ninstance Godel Nat where to = id; from = id\n\n-- you should probably fix this instance to not use\n-- Double if you plan to use it for anything serious\ninstance (Godel a, Godel b) =&gt; Godel (a, b) where\n    to (m_, n_) = (m + n) * (m + n + 1) `quot` 2 + m where\n        m = to m_\n        n = to n_\n    from p = (from m, from n) where\n        isqrt    = floor . sqrt . fromIntegral\n        base     = (isqrt (1 + 8 * p) - 1) `quot` 2\n        triangle = base * (base + 1) `quot` 2\n        m = p - triangle\n        n = base - m\n\ninstance (Godel a, Godel b) =&gt; Godel (Either a b) where\n    to (Left  l) = 0 + 2 * to l\n    to (Right r) = 1 + 2 * to r\n    from n = case n `quotRem` 2 of\n        (l, 0) -&gt; Left  (from l)\n        (r, 1) -&gt; Right (from r)\n</code></pre>\n\n<p>With that in place, the instances for our types are pretty easy.</p>\n\n<pre><code>monomorph :: Either a a -&gt; Either a a\nmonomorph = id\n\ntoColored :: Godel v =&gt; (Color, v) -&gt; Nat\ntoColored (Black, v) = to (monomorph (Left  v))\ntoColored (White, v) = to (monomorph (Right v))\n\nfromColored :: Godel v =&gt; Nat -&gt; (Color, v)\nfromColored n = case from n of\n    Left  v -&gt; (Black, v)\n    Right v -&gt; (White, v)\n\ninstance Godel Odd where\n    to (Evens c l r) = 0 + 2 * toColored (c, (l, r))\n    to (Odds  c l r) = 1 + 2 * toColored (c, (l, r))\n    from n = case n `quotRem` 2 of\n        (clr, 0) -&gt; Evens c l r where (c, (l, r)) = fromColored clr\n        (clr, 1) -&gt; Odds  c l r where (c, (l, r)) = fromColored clr\n\ninstance Godel Even where\n    to Tip = 0\n    to (OddL c l r) = 1 + 2 * toColored (c, (l, r))\n    to (OddR c l r) = 2 + 2 * toColored (c, (l, r))\n    from 0 = Tip\n    from n = case (n-1) `quotRem` 2 of\n        (clr, 0) -&gt; OddL c l r where (c, (l, r)) = fromColored clr\n        (clr, 1) -&gt; OddR c l r where (c, (l, r)) = fromColored clr\n</code></pre>\n\n<p>And that's pretty much it. Now you've got your bijection with the naturals, and you can pick your favorite bijection between the naturals and bitstreams to postcompose with.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1459036805, "creation_date": 1458943184, "last_edit_date": 1458944483, "question_id": 36228729, "link": "https://stackoverflow.com/questions/36228729/how-to-create-a-perfect-bijection-between-two-datatypes", "title": "How to create a perfect bijection between two datatypes?", "body": "<p>Is there any strategy for creating a bijection between two datatypes? For example, consider those datatypes:</p>\n\n<pre><code>data Colbit \n    = White Colbit Colbit \n    | Black Colbit Colbit \n    | Tip\n\ndata Bits\n    = B0 Bits\n    | B1 Bits\n    | BEnd\n</code></pre>\n\n<p>Plus the constraint that a valid element of <code>Colbit</code> must have an odd number of nodes (White/Black constructors). How can I create a map:</p>\n\n<pre><code>toColbit :: Bits -&gt; Colbit\nfromColbit :: Colbit -&gt; Bits\n</code></pre>\n\n<p>Such that for all <code>b : Bits</code>, <code>fromColbit (toColbit b) == b</code>, and for all <code>c : Colbit</code>, <code>toColbit (fromColbit c) == c</code>? (Also, what is this property called?)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1458943568, "post_id": 36227959, "comment_id": 60088759, "body": "<code>[x | xs &lt;- xss, length xs &gt; 2, x &lt;- xs, mod x 2 == 0]</code>. but chi&#39;s answer is better, more <i>productive</i> (will work for <code>[[1..]]</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1458940461, "creation_date": 1458940461, "answer_id": 36228141, "question_id": 36227959, "link": "https://stackoverflow.com/questions/36227959/haskell-how-to-filter-a-list-of-list/36228141#36228141", "title": "Haskell: How to filter a list of list?", "body": "<p>A single list comprehension suffices</p>\n\n<pre><code>[x | xs@(_:_:_:_) &lt;- xss, x &lt;- xs, mod x 2 == 0]\n</code></pre>\n\n<p>The pattern <code>(_:_:_:_)</code> matches all lists having at least three elements.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1458955890, "post_id": 36228323, "comment_id": 60092311, "body": "<code>length</code> is an expensive function to use if you only care that there are at least 3 elements: what if the list has a million items? Better to replace <code>((&gt; 2) . length)</code> with something like <code>(not . null . drop 2)</code>."}, {"owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1458960480, "post_id": 36228323, "comment_id": 60093211, "body": "That&#39;s a good point.  However, I prefer to take the hit in readability if and when handling large lists becomes an actual requirement."}], "tags": [], "owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "is_accepted": true, "score": 5, "last_activity_date": 1458941264, "creation_date": 1458941264, "answer_id": 36228323, "question_id": 36227959, "link": "https://stackoverflow.com/questions/36227959/haskell-how-to-filter-a-list-of-list/36228323#36228323", "title": "Haskell: How to filter a list of list?", "body": "<p>There's a built-in <code>even</code> function in Haskell, and you can also get help converting to point-free style using <a href=\"https://blunt.herokuapp.com\">Blunt</a>.  This gives you:</p>\n\n<pre><code>filter even . concat . filter ((&gt; 2) . length)\n</code></pre>\n"}], "owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 36228323, "answer_count": 2, "score": 1, "last_activity_date": 1458941264, "creation_date": 1458939712, "question_id": 36227959, "link": "https://stackoverflow.com/questions/36227959/haskell-how-to-filter-a-list-of-list", "title": "Haskell: How to filter a list of list?", "body": "<p>Given a list of list:</p>\n\n<pre><code>xss = [[1,2,3],[4,5,6],[7,8]]\n</code></pre>\n\n<p>I want to filter it by list size then by remainder and then return a list of Int.</p>\n\n<p>Here are my two attempts:</p>\n\n<pre><code>concat [[x | x &lt;- xs, mod x 2 == 0] | xs &lt;- xss, length xs &gt; 2]\n\nfilter (\\x -&gt; mod x 2 == 0) $ concat $ filter (\\x -&gt; length x &gt; 2) xss\n</code></pre>\n\n<p>Is there more expressive way to do the same but with less code?</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1458945252, "post_id": 36229054, "comment_id": 60089381, "body": "This bothers me on some level since it&#39;s pretty much a hack (since the instance will match anything). Actually, are you sure this works? If I have a <code>MonadSignal&#39; sigs m</code> constraint somewhere I won&#39;t be able to use the <code>MonadSignal</code> and the <code>CanSignal</code> context because those depend on the instance."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1458945635, "post_id": 36229054, "comment_id": 60089511, "body": "Yes, the instance will match anything, but a type synonym can be applied to any type - it&#39;s the same exact situation. The constraint <code>MonadSignal&#39;</code> will always be reduced immediately to the right-hand side of the instance, since the class head matches <i>any</i> types at all. I don&#39;t know if I would call this a hack - there really is no way to do something like this with type synonyms alone. You need a class or a type family."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458945924, "post_id": 36229054, "comment_id": 60089629, "body": "The trouble is you don&#39;t get any superclass constraints or any methods, so the <code>MonadSignal&#39;</code> constraint is totally worthless."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1458944827, "creation_date": 1458944827, "answer_id": 36229054, "question_id": 36227900, "link": "https://stackoverflow.com/questions/36227900/free-type-variables-bound-by-functional-dependencies-in-type-synonyms/36229054#36229054", "title": "&quot;Free&quot; type variables bound by functional dependencies in type synonyms", "body": "<p>You can replace the type synonym with a class:</p>\n\n<pre><code>class MonadSignal' sigs (m :: * -&gt; *)\ninstance (MonadSignal m sigs', CanSignal sigs sigs') =&gt; MonadSignal' sigs m \n</code></pre>\n\n<p>In the class instance, the type variable <code>sigs'</code> doesn't appear in the class head,\nso you have to use <code>{-# LANGUAGE UndecidableInstances #-}</code> for it to work. Although I don't believe this class can actually cause non-termination. </p>\n"}, {"comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1458945130, "post_id": 36229070, "comment_id": 60089344, "body": "This is a valid solution that I used before but I needed the extra flexibility I get from functional dependencies after all."}, {"owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "reply_to_user": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1458946240, "post_id": 36229070, "comment_id": 60089746, "body": "Ah thats a shame, What extra flexibility out of curiosity?"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1458946720, "post_id": 36229070, "comment_id": 60089931, "body": "I needed a few more type parameters so their mutual dependencies get a bit more complex than what can be expressed with associated types."}], "tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 3, "last_activity_date": 1458944950, "creation_date": 1458944950, "answer_id": 36229070, "question_id": 36227900, "link": "https://stackoverflow.com/questions/36227900/free-type-variables-bound-by-functional-dependencies-in-type-synonyms/36229070#36229070", "title": "&quot;Free&quot; type variables bound by functional dependencies in type synonyms", "body": "<p>It's not a conservative change but one solution would be to switch from functional dependencies to type families. You could make an associated family</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule TypeFamily where\n\nclass Monad m =&gt; MonadSignal m where\n  type Sig m :: *\n  make :: m sig\n\nclass CanSignal sigs sigs' where\n\ntype MonadSignal' sigs m = (MonadSignal m, CanSignal sigs (Sig m))\n</code></pre>\n\n<p>It's perhaps not quite so pretty as using multiparameter type classes for both but it should be just as equivalent in expressiveness and you don't have to worry about doing this \"transitive closure\" sort of thing.</p>\n"}, {"comments": [{"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "edited": false, "score": 0, "creation_date": 1458946816, "post_id": 36229225, "comment_id": 60089956, "body": "Yeah, as I said. I can&#39;t really use associated types for my concrete use case because I have a few more type parameters that have complex mutual dependencies."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1458946387, "last_edit_date": 1458946387, "creation_date": 1458945786, "answer_id": 36229225, "question_id": 36227900, "link": "https://stackoverflow.com/questions/36227900/free-type-variables-bound-by-functional-dependencies-in-type-synonyms/36229225#36229225", "title": "&quot;Free&quot; type variables bound by functional dependencies in type synonyms", "body": "<p>Unfortunately, I believe you have to give that wrong impression if you insist on a fundep proper (see the bottom of this answer if you'll accept a slightly different approach). I briefly thought maybe you could make <code>MonadSignal'</code> a class instead, but you wouldn't be able to give it the superclass constraint you want. You could make up for that by being really explicit with one or more <code>Dict</code> methods, but then your life will be difficult.</p>\n\n<p>Although this is not relevant, it's probably better to define</p>\n\n<pre><code>class MonadSignal sigs m | m -&gt; sigs\n</code></pre>\n\n<p>swapping the order of the parameters, which gets you more useful partial application and makes <code>GeneralizedNewtypeDeriving</code> work for your class.</p>\n\n<hr>\n\n<p>There's another way to use type families, based on a legitimate implementation of fundeps in terms of type families:</p>\n\n<pre><code>class (sigs ~ Sigs m) =&gt; MonadSignal sigs m where\n  type Sigs m :: * -- Or appropriate kind\n  ...\n\ntype MonadSignal' sigs m = (MonadSignal (Sigs m) m, CanSignal sigs (Sigs m))\n</code></pre>\n"}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 36229070, "answer_count": 3, "score": 4, "last_activity_date": 1458946387, "creation_date": 1458939421, "question_id": 36227900, "link": "https://stackoverflow.com/questions/36227900/free-type-variables-bound-by-functional-dependencies-in-type-synonyms", "title": "&quot;Free&quot; type variables bound by functional dependencies in type synonyms", "body": "<p>Given a class</p>\n\n<pre><code>class MonadSignal m sigs | m -&gt; sigs where ...\n</code></pre>\n\n<p>and a class</p>\n\n<pre><code>class CanSignal sigs sigs' where ...\n</code></pre>\n\n<p>I want to define a type synonym like this</p>\n\n<pre><code>type MonadSignal' sigs m = (MonadSignal m sigs', CanSignal sigs sigs')\n</code></pre>\n\n<p>Here the <code>sigs'</code> variable isn't mentioned in the head of the <code>MonadSignal'</code> type synonym but it's there just to connect the first and the second constraint, and it's uniquely determined by <code>m</code> which <em>is</em> mentioned in the head.</p>\n\n<p>Normally I think I'd be able to <code>forall</code> it on the RHS but since this is just a <code>Constraint</code> synonym, there's no actual body for the variable to appear in.</p>\n\n<p>Can anything be done here? (besides putting the variable in the head and giving the wrong impression when the synonym is actually used that it's an actual \"variable\")</p>\n"}, {"tags": ["haskell", "io", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1458939174, "creation_date": 1458939174, "answer_id": 36227848, "question_id": 36227775, "link": "https://stackoverflow.com/questions/36227775/write-output-from-putstrln-to-text-file/36227848#36227848", "title": "Write output from putStrLn to text file", "body": "<p>Sure, don't call <code>putStrLn</code>.</p>\n\n<pre><code>writeFile \"example.txt\" $ printf $ \"this is a example string\"\n</code></pre>\n\n<p>Of course, for this example the <code>printf</code> isn't needed in the first place.</p>\n\n<pre><code>writeFile \"example.txt\" \"this is a example string\"\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 6079242, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/866e1ad926011e12fccc371a1f76ded5?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil Gautam", "link": "https://stackoverflow.com/users/6079242/sunil-gautam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 856, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458939174, "creation_date": 1458938881, "question_id": 36227775, "link": "https://stackoverflow.com/questions/36227775/write-output-from-putstrln-to-text-file", "title": "Write output from putStrLn to text file", "body": "<p>In Haskell. Is there a way to write the output from putStrln (ghc/ghci) for example :</p>\n\n<p>putStrLn (printf $ \"this is a example string\")</p>\n\n<p>to</p>\n\n<p>writeFile \"example.txt\" $ \"[output from the putStrLn  above]\"</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458932795, "post_id": 36225960, "comment_id": 60083705, "body": "if you have an <code>obj1Id :: Object1Id</code> then <code>maybeObj2Id &lt;- fmap object1Other &lt;$&gt; get obj1Id</code> should give you a <code>Maybe Object2Id</code> (inside a <code>runDB $ do</code> block) - as you can see ther are two <code>fmap</code>s - one to get into the db-monad and the other for the <code>Maybe</code>"}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458932872, "post_id": 36225960, "comment_id": 60083741, "body": "i haven&#39;t tried that ... do you not need the runDB?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458932896, "post_id": 36225960, "comment_id": 60083754, "body": "inside yesods <code>Handler</code>? Yes!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458933074, "post_id": 36225960, "comment_id": 60083867, "body": "oops there is another <code>Maybe</code>in your <code>other</code> so you might want an additional <code>join</code> ^^"}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458933130, "post_id": 36225960, "comment_id": 60083904, "body": "ok so that would give you a <code>Maybe Object2Id</code> right? ... how do i get the object then? is there a <code>get</code> function that support a <code>Maybe EntityId</code>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458933537, "post_id": 36225960, "comment_id": 60084110, "body": "it&#39;s probably best if you just use <code>obj1 &lt;- get objectId1</code> and then do a <code>case obj1 of ...</code> and similar to parse through - but <code>mapM</code> will do (but I guess it won&#39;t get more readable)"}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458938384, "post_id": 36225960, "comment_id": 60086454, "body": "figured it out ... thanks to you comment about using a <code>runDB $ do</code> block ... i&#39;ll update question with answer, but if you&#39;d like to create an answer @Carsten I&#39;ll accept yours."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458942156, "post_id": 36225960, "comment_id": 60088223, "body": "I think it&#39;s fine - all your work ;)"}], "answers": [{"tags": [], "owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "is_accepted": true, "score": 1, "last_activity_date": 1458945114, "creation_date": 1458945114, "answer_id": 36229103, "question_id": 36225960, "link": "https://stackoverflow.com/questions/36225960/yesod-maybe-entityid-to-maybe-entity/36229103#36229103", "title": "Yesod - Maybe EntityId to Maybe Entity", "body": "<p>So I figured out how to get it to compile and work! Thanks for the comments and help.</p>\n\n<p>here is my code (in the handler):</p>\n\n<pre><code>(object1, maybeObject2) &lt;- runDB $ do\n    object1 &lt;- get404 object1Id\n    maybeObject2 &lt;- case (object1Other object1) of\n      Just object2Id -&gt; get object2Id\n      Nothing -&gt; return Nothing\n    return (object1,maybeObject2)\n</code></pre>\n\n<p>I'm sure there are better/faster/easier ways to do it, but this worked.</p>\n"}], "owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 36229103, "answer_count": 1, "score": 1, "last_activity_date": 1458945114, "creation_date": 1458931375, "last_edit_date": 1458938985, "question_id": 36225960, "link": "https://stackoverflow.com/questions/36225960/yesod-maybe-entityid-to-maybe-entity", "title": "Yesod - Maybe EntityId to Maybe Entity", "body": "<p>First of all I'm a Haskell noob so if there is something obvious I'm doing wrong sorry.</p>\n\n<p>Say I have something like:</p>\n\n<pre><code>Object1\n    stuff Text\n    other Object2Id Maybe\n\nObject2\n    otherStuff Text\n</code></pre>\n\n<p>in my config/models file</p>\n\n<p>How do I get the Object2 associated to Object1 if I have a handler of type:</p>\n\n<pre><code>getObject1R :: Object1Id -&gt; Handler Html\n</code></pre>\n\n<p>If I understand correctly I want to go from a <code>Maybe Object2Id</code> to a <code>Maybe Object</code> with calling <code>runDB $ get</code> in the middle and with everything I've tried the types don't line up properly.</p>\n\n<p>Thanks</p>\n\n<p><em>EDIT</em></p>\n\n<p>here is one attempt that I feel is close but isn't correct:</p>\n\n<pre><code>object1 &lt;- runDB $ get object1Id\nmaybeObj2 &lt;- case (object1Other object1) of\n    Just obj2Id -&gt; Just $ runDB $ get obj2Id\n    Nothing -&gt; Nothing\n</code></pre>\n\n<p><em>EDIT 2 (figured it out)</em></p>\n\n<p>So I figured out how to get it to compile and work! Thanks for the comments and help.</p>\n\n<p>here is my code (in the handler):</p>\n\n<pre><code>(object1, maybeObject2) &lt;- runDB $ do\n    object1 &lt;- get404 object1Id\n    maybeObject2 &lt;- case (object1Other object1) of\n      Just object2Id -&gt; get object2Id\n      Nothing -&gt; return Nothing\n    return (object1,maybeObject2)\n</code></pre>\n\n<p>I'm sure there are better/faster/easier ways to do it, but this worked.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1458928121, "post_id": 36224879, "comment_id": 60081365, "body": "Try and provide a working example (it doesn&#39;t need to compile!) or more context to motivate the question."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1458931920, "post_id": 36224879, "comment_id": 60083237, "body": "@haoformayor I actually think his question is well formulated, and writing any Template Haskell is quite a burden....  There is very little information available.  It took me days before I could write even the simplest working snippet."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458943754, "post_id": 36224879, "comment_id": 60088835, "body": "Just put it inside a splice: <code>[d| data Shape = Circle [Float] Double Int |]</code> will do the trick."}], "answers": [{"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": true, "score": 1, "last_activity_date": 1458932213, "last_edit_date": 1458932213, "creation_date": 1458931514, "answer_id": 36226000, "question_id": 36224879, "link": "https://stackoverflow.com/questions/36224879/how-can-i-create-data-by-template-haskell/36226000#36226000", "title": "How can I create Data by Template Haskell", "body": "<p>Here is a minimal example (sorry, I've never figured out how to make template haskell look pretty)....</p>\n\n<p>First, create a library file (this isn't optional, TH requires you to define expressions in a separate file).</p>\n\n<pre><code>module DataDefinition where\n\nimport Language.Haskell.TH\n\ndataDef::DecsQ\ndataDef = do\n  return $ --the following is the definition \"data Shape = Circle Float | Square\"\n        [DataD \n                [] \n                (mkName \"shape\") \n                [] \n                [\n                        NormalC (mkName \"circle\") \n                                [(NotStrict, ConT (mkName \"Float\"))],\n                        NormalC (mkName \"Square\") []\n                ] \n                []\n        ]\n</code></pre>\n\n<p>Then, use it like this</p>\n\n<pre><code>module Main where\n\nimport DataDefinition\n\n$(dataDef)  --This defines Shape\n\nmain = do\n  let x = Circle 1.0 --Now you can define and use Shape like any other data def....\n  return ()\n</code></pre>\n\n<hr>\n\n<p>extra-</p>\n\n<p>You can fill in that last empty array in the DataD creation with deriving instances....  Try changing the <code>[]</code> to</p>\n\n<pre><code>          [mkName \"Show\"]\n</code></pre>\n\n<p>and you can print the output in main....</p>\n\n<pre><code>main = do\n  let x = Circle 1.0\n  print x\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 5695808, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e1a4a97d855f086a7585f5efe4aa4e63?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/5695808/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 36226000, "answer_count": 1, "score": 1, "last_activity_date": 1458932213, "creation_date": 1458927129, "last_edit_date": 1458931623, "question_id": 36224879, "link": "https://stackoverflow.com/questions/36224879/how-can-i-create-data-by-template-haskell", "title": "How can I create Data by Template Haskell", "body": "<p>Can i create data haskell with a help of Template Haskell. Data like :</p>\n\n<pre><code>data Shape = Circle [Float] Double Int\n</code></pre>\n\n<p>I want write a program, which create Data and then use it</p>\n"}, {"tags": ["haskell", "ghc", "lambda-calculus"], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": false, "score": 4, "last_activity_date": 1458928704, "creation_date": 1458928704, "answer_id": 36225258, "question_id": 36224844, "link": "https://stackoverflow.com/questions/36224844/what-exactly-are-ghc-type-coercions/36225258#36225258", "title": "What exactly are GHC type coercions?", "body": "<p>Basically Haskell compiles by evaluating to this simple core language. In an effort to keep in simple it's generally not desirable to add constructs like GADTs or type classes directly to the language so instead they are compiled away at the very front end of the compiler into the simpler but more general (and verbose) constructs provided by core. Also keep in mind that Core is typed so we have to make sure we can encode all of these things in a typed way, a significant complication.</p>\n\n<p>In order to encode GADTs they get elaborated to normal data types with existentials <em>and coercions</em>. The basic idea is that a coercion is a type with what is called an equality kind, written <code>t ~ t'</code>. This <em>type</em> is meant to witness evidence that even though we may not know it, <code>t</code> and <code>t'</code> are the same type under the hood. They're passed around just like any other type so there's nothing special in how that is handled. There's also a suite of type constructors for manipulating these types constitution little proofs about equality, like <code>sym :: t ~ t' -&gt; t' ~ t</code> for example. Finally, there is an operator at the term level which takes a term of type <code>t</code> and a type of kind <code>t ~ t'</code> and is typed as a term of type <code>t'</code>. eg <code>cast e T :: t'</code> but this term behaves identically to <code>e</code>. We've just used our proof that <code>t'</code> and <code>t</code> are the same to cast <code>e</code> to make the type checker happy.</p>\n\n<p>That's the basic idea</p>\n\n<ul>\n<li>Kinds representing equality</li>\n<li>Types representing proofs of equality</li>\n<li><code>cast</code> at the term level to use these proofs</li>\n</ul>\n\n<p>Also note that by isolating proofs to the type level they cannot end up having a runtime cost as types are going to be erased down the line.</p>\n\n<p>I think a nice reference on all of this is <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/ext-f/tldi22-sulzmann-with-appendix.pdf\" rel=\"nofollow\">System F with Type Equality Coercions</a> but of course all of SPJ's publications could help.</p>\n"}, {"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 2, "last_activity_date": 1459308938, "last_edit_date": 1459308938, "creation_date": 1458929901, "answer_id": 36225585, "question_id": 36224844, "link": "https://stackoverflow.com/questions/36224844/what-exactly-are-ghc-type-coercions/36225585#36225585", "title": "What exactly are GHC type coercions?", "body": "<p>@jozefg deserves the answer, but here's an example of GADTs desugaring to existential quantification. Not quite Core yet, but a step toward it.</p>\n\n\n\n<pre><code>data Foo :: * -&gt; * where\n  Bar :: Int -&gt; Foo Int\n  Oink :: b -&gt; c -&gt; d -&gt; Foo (f b)\n</code></pre>\n\n<p>via</p>\n\n<pre><code>data Foo a where\n  Bar :: (a ~ Int) =&gt; Int -&gt; Foo a\n  Oink :: (a ~ f b) =&gt; b -&gt; c -&gt; d -&gt; Foo a\n</code></pre>\n\n<p>to</p>\n\n<pre><code>data Foo a\n  = (a ~ Int) =&gt; Bar Int\n  | forall b c d f. (a ~ f b) =&gt; Oink b c d\n</code></pre>\n\n<p>Courtesy of <a href=\"https://www.reddit.com/r/haskell/comments/4a73bs/the_case_expression_syntactic_sugar_can_usually/d0yeog9\" rel=\"nofollow\">/u/MitchellSalad on /r/haskell</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 5353920, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BopDBJIn2_U/AAAAAAAAAAI/AAAAAAAAANk/llQBVqh7FBw/photo.jpg?sz=128", "display_name": "Shyama Shastri", "link": "https://stackoverflow.com/users/5353920/shyama-shastri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1459308938, "creation_date": 1458926971, "question_id": 36224844, "link": "https://stackoverflow.com/questions/36224844/what-exactly-are-ghc-type-coercions", "title": "What exactly are GHC type coercions?", "body": "<p>I have been looking up haskell's core language to understand how it works. One feature that I found during my internet searches were type coercions. I know that they are used to implement GADTs, but I don't understand much else. All descriptions I found online were quite high level for me, although I have a decent understanding of system F, though. Can anyone explain type coercions in an understandable manner to me, please?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 591, "user_id": 3934142, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f7812386a3972f8ee1a2b956fad742c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dracke", "link": "https://stackoverflow.com/users/3934142/dracke"}, "edited": false, "score": 0, "creation_date": 1458926998, "post_id": 36224754, "comment_id": 60080761, "body": "That works. Didn&#39;t know that such functions like intersperse and concat exist."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 591, "user_id": 3934142, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f7812386a3972f8ee1a2b956fad742c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dracke", "link": "https://stackoverflow.com/users/3934142/dracke"}, "edited": false, "score": 1, "creation_date": 1458927098, "post_id": 36224754, "comment_id": 60080825, "body": "I just updated it to use <code>intercalate</code>, which is shorthand for <code>concat $ intersperse xs xss</code>"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1458927352, "last_edit_date": 1458927352, "creation_date": 1458926616, "answer_id": 36224754, "question_id": 36224351, "link": "https://stackoverflow.com/questions/36224351/haskell-how-to-change-the-show-to-get-the-right-output/36224754#36224754", "title": "Haskell - how to change the show to get the right output", "body": "<p><code>show</code> is by default going to give you quotes around strings and brackets around lists. If you just go back to concatenating strings and joining lists with commas or newlines, you should get the output you're expecting:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import Data.List (intercalate)\n\ninstance Show Rule where\n    show (Rule ls rs) = ls ++ \"-&gt;\" ++ intercalate \",\" rs\n\ninstance Show RightLinearGrammar where\n    show (RLG n t fn r) = intercalate \",\" n ++ \"\\n\" ++ t ++ \"\\n\" ++ fn ++ \"\\n\" ++ (intercalate \"\\n\" $ map show r) ++ \"\\n\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 1, "last_activity_date": 1458926997, "creation_date": 1458926997, "answer_id": 36224851, "question_id": 36224351, "link": "https://stackoverflow.com/questions/36224351/haskell-how-to-change-the-show-to-get-the-right-output/36224851#36224851", "title": "Haskell - how to change the show to get the right output", "body": "<p>You either need to replace your type synonyms with <code>newtypes</code>, and define <code>show</code> on them to do what you want, or more likely replace the calls to <code>show</code> in your instances with calls to a custom formatter function.</p>\n\n<p>Note: <code>show</code> is really not the right function for what you're trying to do, since it usually produces output you could paste back into <code>ghci</code> and arguably should be limitted to that use.  You could easily define your own function and use it like this:</p>\n\n<pre><code>formatRule :: Rule -&gt; String\nformatRule (Rule ls rs) = ls ++ \"-&gt;\" ++ concat (intersperse \",\" rs) ++ \"\\n\"\n\nformatRightLinearGrammar :: RightLinearGrammar -&gt; String\nformatRightLinearGrammar (RLG n t fn r) =\n       concat (intersperse \",\" n) ++ \"\\n\"\n    ++ intersperse ',' t ++ \"\\n\"\n    ++ fn ++ \"\\n\"\n    ++ concat (map formatRule r)\n</code></pre>\n\n<p>Note: this is going to be fairly inefficient for large grammars; you might want to consider re-writing it as</p>\n\n<pre><code>formatRule :: Rule -&gt; String -&gt; String\nformatRule (Rule ls rs) = (ls++) . (\"-&gt;\"++) . concatDS (intersperse \",\" rs) . (\"\\n\"++)\n\nformatRightLinearGrammar :: RightLinearGrammar -&gt; String\nformatRightLinearGrammar (RLG n t fn r) =\n    concatDS (intersperse \",\" n) $ (\"\\n\"++) $\n    (intersperse ',' t ++) $ (\"\\n\"++) $\n    (fn++) $ (\"\\n\"++) $\n    foldr formatRule \"\" r\n\nconcatDS ss s' = foldr (++) s' ss\n</code></pre>\n"}], "owner": {"reputation": 591, "user_id": 3934142, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f7812386a3972f8ee1a2b956fad742c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dracke", "link": "https://stackoverflow.com/users/3934142/dracke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "accepted_answer_id": 36224754, "answer_count": 2, "score": -1, "last_activity_date": 1458927352, "creation_date": 1458924994, "last_edit_date": 1458926407, "question_id": 36224351, "link": "https://stackoverflow.com/questions/36224351/haskell-how-to-change-the-show-to-get-the-right-output", "title": "Haskell - how to change the show to get the right output", "body": "<p>I have defined these datatypes which I am trying to create and print now.</p>\n\n<pre><code>type TNonTerminal = String -- will be creating own ones where [A-Z] won't be enough\ntype TTerminals = Char\ntype TSymbols = String -- both terminals and nonterminals\n\ndata Rule = Rule\n    { leftSide :: TNonTerminal\n    , rightSide :: [TSymbols]\n    } deriving (Eq)\n\ndata RightLinearGrammar = RLG\n    { nonterminals :: [TNonTerminal]\n    , terminals :: [TTerminals]\n    , firstNonterminal :: TNonTerminal\n    , rules :: [Rule]\n    } deriving (Eq)\n</code></pre>\n\n<p>So I also created those Show instances</p>\n\n<pre><code>instance Show Rule where\n    show (Rule ls rs) = show ls ++ \"-&gt;\" ++ show rs ++ \"\\n\"\n\ninstance Show RightLinearGrammar where\n    show (RLG n t fn r) = show n ++ \"\\n\" ++ show t ++ \"\\n\" ++ show fn ++ \"\\n\" ++ show r ++ \"\\n\"\n</code></pre>\n\n<p>And I get this output (for clarification I created the Type RightLinearGrammar and called <code>putStr $ show rlg</code>):</p>\n\n<pre><code>[\"A\",\"B\"]          -- [TNonTerminal]\n\"abc\"              -- [TTerminals]\n\"A\"                -- TNonTerminal\n[\"A\"-&gt;[\"aaB\"]      --\n,\"A\"-&gt;[\"ccB\"]\n,\"B\"-&gt;[\"bB\"]       --  [Rule]\n,\"B\"-&gt;[\"#\"]\n]                  --\n</code></pre>\n\n<p>How should I change the code to get better output like this one?</p>\n\n<pre><code>A,B\na,b,c\nA\nA-&gt;aaB\nA-&gt;ccB\nB-&gt;bB\nB-&gt;#\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458922487, "post_id": 36223485, "comment_id": 60078435, "body": "well does the <code>sql-fragment</code> package itself build ... is the cabal-file ok?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458923965, "post_id": 36223485, "comment_id": 60079200, "body": "@Carsten it builds, so I guess the cabal-file is ok."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458968127, "post_id": 36223485, "comment_id": 60094513, "body": "Try move <code>..&#47;sql-fragment</code> into your project root and change the path to <code>sql-fragment</code>. <code>..</code> in <code>stack.yaml</code> sometimes causes issues I don&#39;t know why."}], "answers": [{"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1459519748, "post_id": 36234804, "comment_id": 60336589, "body": "This is pretty ridiculous, but works! Thanks a lot. Did you open a bug on stack for that?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1459530916, "post_id": 36234804, "comment_id": 60343702, "body": "I did. I understand why the symbolic link didn&#39;t work. It&#39;s because stack follows the symbolic link instead of just trusting me ;-)."}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": true, "score": 2, "last_activity_date": 1459530933, "last_edit_date": 1459530933, "creation_date": 1458992162, "answer_id": 36234804, "question_id": 36223485, "link": "https://stackoverflow.com/questions/36223485/stack-invalidrelfile-error-when-adding-local-package/36234804#36234804", "title": "Stack InvalidRelFile error when adding local package", "body": "<p>It's probably a bug in stack. I managed to find a workaround by moving <code>sql-fragment</code> directory into <code>sql-fragment-mysql-simple</code>, change <code>../sql-fragment</code> to <code>sql-fragment</code> in the stack file launch the solver -<code>stack solver --update-config</code> and it works. What is strange is, I add to properly move the directory to make it work (just creating a symbolic link woudn't work) and once the solver has done its job. I moved  <code>sql-fragment</code> where it was, revert the path to <code>../sql-fragment</code> and <code>stack build</code> works perfectly ;-).</p>\n"}, {"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 1, "last_activity_date": 1461973035, "creation_date": 1461973035, "answer_id": 36949051, "question_id": 36223485, "link": "https://stackoverflow.com/questions/36223485/stack-invalidrelfile-error-when-adding-local-package/36949051#36949051", "title": "Stack InvalidRelFile error when adding local package", "body": "<p>Fixed with this commit. <a href=\"https://github.com/commercialhaskell/stack/commit/42a61fb278aeb99ad61bb088da9a87b2313ac325\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/commit/42a61fb278aeb99ad61bb088da9a87b2313ac325</a></p>\n\n<p>The issue tracker is a better place for this.</p>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 36234804, "answer_count": 2, "score": 2, "last_activity_date": 1484965423, "creation_date": 1458921831, "last_edit_date": 1484965423, "question_id": 36223485, "link": "https://stackoverflow.com/questions/36223485/stack-invalidrelfile-error-when-adding-local-package", "title": "Stack InvalidRelFile error when adding local package", "body": "<p>I'm having this strange issue : I'm trying to add a local package to my stack file and I get the following error. when I try to build it (<code>stack build</code>) it kind of work but fails suggesting me to use <code>stack solver</code> but when I run <code>stack solver</code> I got the following error</p>\n\n<pre><code>Using configuration file: stack.yaml\nInvalidRelFile \"/home/max/devel/sql-fragment/sql-fragment.cabal\"\n</code></pre>\n\n<p>My stack file looks like</p>\n\n<pre><code>flags: {}\npackages:\n- '.'\n- ../sql-fragment\nextra-deps:\n   ...\n</code></pre>\n\n<p>I'm on Ubuntu 15.02 trying to use GHC-7.8.4 and stack 1.0.4\nThe two packages, <a href=\"http://github.com/maxigit/sql-fragment.git\" rel=\"nofollow\">sql-fragment</a> and <a href=\"https://github.com/maxigit/sql-fragment-mysql-simple.git\" rel=\"nofollow\">sql-fragment-mysql-simple</a> can be found on github.</p>\n"}, {"tags": ["csv", "haskell", "memory"], "comments": [{"owner": {"reputation": 239, "user_id": 3691646, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7lUWA.jpg?s=128&g=1", "display_name": "guaraqe", "link": "https://stackoverflow.com/users/3691646/guaraqe"}, "edited": false, "score": 0, "creation_date": 1458924677, "post_id": 36221125, "comment_id": 60079582, "body": "The problem is linked to the lazy <code>ByteString</code>. I solved this problem by defining <code>strictRead path = evaluate . force &lt;$&gt; BL.read path</code>, but I don&#39;t think it is the best answer. You can try doing <code>ByteString.toLazy &lt;$&gt; ByteString.Strict.readFile path</code> too, but I never tested."}, {"owner": {"reputation": 115, "user_id": 4641312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ea862e7d1f25d7bfbde034deef3c7c?s=128&d=identicon&r=PG&f=1", "display_name": "Antoine Genton", "link": "https://stackoverflow.com/users/4641312/antoine-genton"}, "reply_to_user": {"reputation": 239, "user_id": 3691646, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7lUWA.jpg?s=128&g=1", "display_name": "guaraqe", "link": "https://stackoverflow.com/users/3691646/guaraqe"}, "edited": false, "score": 0, "creation_date": 1458929558, "post_id": 36221125, "comment_id": 60082035, "body": "I tried to strictify the ByteString but the decode function needs a Lazy ByteString, so I lazified my strictified ByteString. Again, the memory usage is huge, so I am not sure this works."}, {"owner": {"reputation": 239, "user_id": 3691646, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7lUWA.jpg?s=128&g=1", "display_name": "guaraqe", "link": "https://stackoverflow.com/users/3691646/guaraqe"}, "edited": false, "score": 0, "creation_date": 1458991608, "post_id": 36221125, "comment_id": 60100004, "body": "Try the first approach. <code>force</code> is from <code>Control.DeepSeq</code> and <code>evaluate</code> from <code>Control.Exception</code>. <code>evaluate</code> will put it in WHNM and <code>force</code> will make it be fully evaluated."}, {"owner": {"reputation": 115, "user_id": 4641312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ea862e7d1f25d7bfbde034deef3c7c?s=128&d=identicon&r=PG&f=1", "display_name": "Antoine Genton", "link": "https://stackoverflow.com/users/4641312/antoine-genton"}, "reply_to_user": {"reputation": 239, "user_id": 3691646, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7lUWA.jpg?s=128&g=1", "display_name": "guaraqe", "link": "https://stackoverflow.com/users/3691646/guaraqe"}, "edited": false, "score": 0, "creation_date": 1459019683, "post_id": 36221125, "comment_id": 60109512, "body": "Doesn&#39;t work either unfortunately.  I did this: <code>csv&#39; &lt;- BL.readFile &quot;train.csv&quot; csv &lt;- evaluate $ force csv&#39;</code> and I still get about 2600MB of memory usage."}, {"owner": {"reputation": 239, "user_id": 3691646, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7lUWA.jpg?s=128&g=1", "display_name": "guaraqe", "link": "https://stackoverflow.com/users/3691646/guaraqe"}, "edited": false, "score": 0, "creation_date": 1459106588, "post_id": 36221125, "comment_id": 60132845, "body": "I write <code>(evaluate . force) =&lt;&lt; BL.read path</code> in fact, but it should be equivalent to yours after desugaring. Yeah, so I think the solution is to use the other modules from <code>cassava</code>, sorry for not being able to help, I&#39;m interested in the answer too. If you have no answer here, try at the subreddit, it&#39;s quite active."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1460192052, "post_id": 36221125, "comment_id": 60635135, "body": "Could you provide an example of your CSV data? Even better, could you add a snippet that produces content similar to your CSV?"}, {"owner": {"reputation": 115, "user_id": 4641312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ea862e7d1f25d7bfbde034deef3c7c?s=128&d=identicon&r=PG&f=1", "display_name": "Antoine Genton", "link": "https://stackoverflow.com/users/4641312/antoine-genton"}, "edited": false, "score": 0, "creation_date": 1460226322, "post_id": 36221125, "comment_id": 60646833, "body": "The data is the training set of the kaggle competition Santander (<a href=\"https://www.kaggle.com/c/santander-customer-satisfaction/\" rel=\"nofollow noreferrer\">kaggle.com/c/santander-customer-satisfaction</a>) . It is a csv of dimension 71021 rows by 371 columns. Each cell of that csv can is either a number (float or int) either a short string (max 10 chars I would say)."}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 4641312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ea862e7d1f25d7bfbde034deef3c7c?s=128&d=identicon&r=PG&f=1", "display_name": "Antoine Genton", "link": "https://stackoverflow.com/users/4641312/antoine-genton"}, "edited": false, "score": 1, "creation_date": 1465260223, "post_id": 37548426, "comment_id": 62815731, "body": "Thank you Michael for your comprehensive explanation! I will be more systematic in my usage of stream libraries, I thought that Data.Csv.Streaming could be used in lieu of it."}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 6, "last_activity_date": 1464727844, "last_edit_date": 1464727844, "creation_date": 1464704759, "answer_id": 37548426, "question_id": 36221125, "link": "https://stackoverflow.com/questions/36221125/loading-a-csv-in-memory-with-cassava/37548426#37548426", "title": "Loading a CSV in memory with Cassava", "body": "<p>The difference between <code>Data.CSV</code> and <code>Data.CSV.Streaming</code> is probably not quite what you'd expect. The first produces a <code>Data.Vector.Vector</code> of the csv contents, as you see. I'm not sure why the construction of this vector should take up so much space -- though it starts not to surprise me when I reflect that the resulting vector-of-pointers-to-vectors-of-pointers-to-lazy-bytestrings here contains 28203420 distinct pointers to lazy bytestrings, 371 for each line, each pointing to a tiny morsel of the original stream of bytes, usually to '0'. Following <a href=\"http://blog.johantibell.com/2011/06/memory-footprints-of-some-common-data.html\" rel=\"nofollow\">http://blog.johantibell.com/2011/06/memory-footprints-of-some-common-data.html</a> this means that the typical <em>two byte</em> sequence in the original stream of bytes  - almost all of them look like this: \",0\" ie. <code>[44,48]</code> -  is replaced by a number of pointers and constructors: the lazy bytestring content alone makes each pair of bytes take up something like 11 words (the <code>Chunk</code> and <code>Empty</code> constructors for a lazy bytestring, plus the material for a strict bytestring which J Tibell puts at 9 words) ... plus the original bytes (minus those representing commas and spaces). In a 64 bit system this is a pretty gigantic escalation in size.</p>\n\n<p><code>Data.CSV.Streaming</code> is not really so different: basically it constructs a slightly decorated list rather than a vector, so in principle it can be lazily evaluated, and in ideal cases the whole thing won't need to be realized in memory, as you noticed. In a monadic context like this, though, you will be 'extracting a list from IO', which is not <em>quite</em> guaranteed to produce chaos and confusion.  </p>\n\n<p>If you want to properly stream csv contents, you should use ... one of the streaming libraries. (I have no advice for getting the whole thing into memory, except the obvious one of arranging that cassava reads each line into a nice compact data type rather than a vector of pointers to lazy bytestrings; here though we have 371 \"fields\").</p>\n\n<p>So here is your program using <code>cassava-streams</code>, which uses cassava's (genuine) incremental interface, and then uses <code>io-streams</code> to make a stream of records:</p>\n\n<pre><code>  {-# LANGUAGE BangPatterns #-}\n\n  import qualified Data.ByteString.Lazy as BL\n  import qualified Data.Vector as V\n  import Data.Foldable\n  import System.IO.Streams (InputStream, OutputStream)\n  import qualified System.IO.Streams as Streams\n  import qualified System.IO.Streams.Csv as CSV\n  import System.IO\n\n  type StreamOfCSV = InputStream (V.Vector(BL.ByteString))\n\n  main = withFile \"train.csv\" ReadMode $ \\h -&gt; do\n     input          &lt;- Streams.handleToInputStream h \n     raw_csv_stream &lt;- CSV.decodeStream HasHeader input\n     csv_stream     &lt;- CSV.onlyValidRecords raw_csv_stream :: IO StreamOfCSV\n     m &lt;- Streams.read csv_stream\n     print m\n</code></pre>\n\n<p>This finishes immediately using no more memory than <code>hello-world</code>, printing the first record.  You can see a little more manipulation in tutorial source <a href=\"https://github.com/pjones/cassava-streams/blob/master/src/System/IO/Streams/Csv/Tutorial.hs\" rel=\"nofollow\">https://github.com/pjones/cassava-streams/blob/master/src/System/IO/Streams/Csv/Tutorial.hs</a> There are similar libraries for the other streaming libraries. If the data structure (like a matrix) that you want to constitute can fit in memory, you should be able to construct it by folding over the lines with <code>Streams.fold</code> and there should be no problem if the information you are trying to extract from each line is properly evaluated before it is consumed by the fold operation.  If you can arrange that cassava outputs a non-recursive data structure with unboxed fields, then it will be possible to write an Unbox instance for that type, and fold the whole csv into a single closely packed unboxed vector. In this case, there are 371 distinct fields in each line, so that isn't an option I guess.</p>\n\n<p>The following is the equivalent of the <code>Data.CSV.Streaming</code> program:</p>\n\n<pre><code>  main = withFile \"train.csv\" ReadMode $ \\h -&gt; do\n    input          &lt;- Streams.handleToInputStream h \n    raw_csv_stream &lt;- CSV.decodeStream HasHeader input\n    csv_stream     &lt;- CSV.onlyValidRecords raw_csv_stream :: IO StreamOfCSV\n    csvs &lt;- Streams.toList csv_stream\n    print (csvs !! 0)\n</code></pre>\n\n<p>It has all the same trouble, since it uses <code>Streams.toList</code> to collect the gigantic list before trying to find out the first element. </p>\n\n<p>-- Addendum </p>\n\n<p>Here for what it's worth is a pipes-csv variant, which just compresses each parsed row into an unboxed vector of <code>Int</code>s by hand (this easier than finding <code>Doubles</code>, which is what this csv is really storing, using <code>readInt</code> from the bytestring package.)</p>\n\n<pre><code>import Data.ByteString (ByteString)\nimport qualified Data.ByteString.Char8 as B\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Unboxed as U\nimport Data.Csv\n\nimport qualified Pipes.Prelude as P\nimport qualified Pipes.ByteString as Bytes\nimport Pipes\nimport qualified Pipes.Csv as Csv\nimport System.IO\nimport Control.Applicative\n\nimport qualified Control.Foldl as L\n\nmain = withFile \"train.csv\" ReadMode $ \\h -&gt; do\n  let csvs :: Producer (V.Vector ByteString) IO ()\n      csvs = Csv.decode HasHeader (Bytes.fromHandle h) &gt;-&gt; P.concat\n      -- shamelessly reading integral part only, counting bad parses as 0\n      simplify bs = case B.readInt bs of\n        Nothing       -&gt; 0\n        Just (n, bs') -&gt; n\n      uvectors :: Producer (U.Vector Int) IO ()\n      uvectors = csvs  &gt;-&gt; P.map (V.map simplify) &gt;-&gt; P.map (V.foldr U.cons U.empty)\n  runEffect $ uvectors &gt;-&gt; P.print\n</code></pre>\n\n<p>You can fold over the rows using the folds in the <code>foldl</code> library or any you care to write by swapping out the last line for something like this</p>\n\n<pre><code>  let myfolds = liftA3 (,,) (L.generalize (L.index 13))   -- the thirteenth row, if it exists\n                            (L.randomN 3)   -- three random rows\n                            (L.generalize L.length) -- number of rows\n  (thirteen,mvs,len) &lt;- L.impurely P.foldM myfolds uvectors\n\n  case mvs of \n    Nothing -&gt; return ()\n    Just vs -&gt; print (vs :: V.Vector (U.Vector Int))\n  print thirteen\n  print len\n</code></pre>\n\n<p>in this case I am collecting the thirteenth line, three random lines and the total number of records - any number of other folds can be combined with these. In particular, we could as well collect all of the rows into a giant vector using <code>L.vector</code>, which will probably still be a bad idea given the size of this csv file. Below we come back to our starting point, we collect everything and print the 17th line of the completed vector of vectors, i.e. a sort of big matrix.</p>\n\n<pre><code>  vec_vec &lt;- L.impurely P.foldM  L.vector uvectors\n  print $ (vec_vec :: V.Vector (U.Vector Int)) V.! 17\n</code></pre>\n\n<p>This takes plenty of memory, but doesn't particularly strain my little laptop.</p>\n"}], "owner": {"reputation": 115, "user_id": 4641312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ea862e7d1f25d7bfbde034deef3c7c?s=128&d=identicon&r=PG&f=1", "display_name": "Antoine Genton", "link": "https://stackoverflow.com/users/4641312/antoine-genton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 906, "favorite_count": 3, "accepted_answer_id": 37548426, "answer_count": 1, "score": 7, "last_activity_date": 1464727844, "creation_date": 1458913441, "question_id": 36221125, "link": "https://stackoverflow.com/questions/36221125/loading-a-csv-in-memory-with-cassava", "title": "Loading a CSV in memory with Cassava", "body": "<p>I am trying to load a CSV into memory as a Vector of Vector with Cassava. My program does work but uses a huge amount of memory for a 50MB csv file and I don't understand why.</p>\n\n<p>I know that working with Data.Csv.Streaming should be better for big files, but I thought 50MB would still be ok. I tried both Data.Csv and Data.Csv.Streaming with more or less canonical examples from the github project page, I also tried to implement my own parser that outputs Vector of Vector (I based my code on attoparsec-csv <a href=\"https://hackage.haskell.org/package/attoparsec-csv\" rel=\"noreferrer\">https://hackage.haskell.org/package/attoparsec-csv</a>), and all these solutions use about 2000MB of memory! I am sure there is something wrong in what I am doing. What is the right way of doing this?</p>\n\n<p>My final goal is to have the data fully loaded into memory for further processing later on. For example, I could split my data into interesting matrices and work with those using Hmatrix.</p>\n\n<p>Here are the 2 programs I tried with Cassava:</p>\n\n<p>1/ Using Data.Csv</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL\nimport qualified Data.Vector as V\nimport Data.Csv\nimport Data.Foldable\n\n\nmain = do\n   csv &lt;- BL.readFile \"train.csv\"\n   let Right res = decode HasHeader csv :: Either String (V.Vector(V.Vector(BL.ByteString)))\n   print $ res V.! 0\n</code></pre>\n\n<p>2/ Using Data.Csv.Streaming</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.Vector as V\nimport Data.Csv.Streaming\nimport Data.Foldable\n\n\nmain = do\n   csv &lt;- BL.readFile \"train.csv\"\n   let !a = decode HasHeader csv :: Records(V.Vector(BL.ByteString))\n   let !res = V.fromList $ Data.Foldable.toList a\n   print $ res V.! 0\n</code></pre>\n\n<p>Note that I don't give you the program I made based on attoparsec-csv because it is almost exactly the same with Vector instead of List. The memory usage of that solution is still quite poor.</p>\n\n<p>Interestingly, in the Data.Csv.Streaming solution, if I simply print my data using a Data.Foldable.for_, everything is super fast with a 2MB memory usage. This made me think that my problem is linked to the way I construct my Vector. Probably accumulating thunks instead of stacking raw data into a compact data structure.</p>\n\n<p>Thank you for your help,</p>\n\n<p>Antoine</p>\n"}, {"tags": ["haskell", "generic-programming", "template-haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1458910660, "post_id": 36220327, "comment_id": 60072069, "body": "well as the compiler tells you your function is really <i>generic</i> - it claims that it can return any type <code>a</code> but then you go on and your cases return very specific types ... so the compiler complains. The first step would be to try and find out what the results should have in common - here you want to be able to put them into a database of some sort (you did not write anything about) - so my first try would be to return a function that given a db-context will write the value into it: <code>makePersistance :: String -&gt; String -&gt; (DbContext -&gt; IO ())</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458910785, "post_id": 36220327, "comment_id": 60072131, "body": "btw: it&#39;s probably enough to return a <i>SQL</i>-Statement that represent the <code>INSERT</code> into your database (assuming it&#39;s some kind of SQL-DB) - so it could be <code>String -&gt; String -&gt; String</code> as well and maybe this is easier for you to see - like <code>case tp of &quot;string&quot; -&gt; &quot;INSERT INTO table VALUES (&#39;&quot; ++ val ++ &quot;&#39;)&quot;</code> (of course I feel I have to tell you that this might be really dangerous as it opens the door for SQL-inject attacs)"}, {"owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458910908, "post_id": 36220327, "comment_id": 60072204, "body": "I have PostgreSQL and trying to insert with something like <code>res :: (Either SomeException [Only Int]) &lt;- try $ query conn query&#39; (a1::String, a2::String, i3::Int64, a4::String, a5::String, a6::String, i7::Int64, a8::String, a9::String, a10::String, a11::String, a12::String, a13::String, t14::UTCTime, a15::String)</code> and combination of types can be different, I want this tuple to be properly typed insted of writing by hand"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458910992, "post_id": 36220327, "comment_id": 60072236, "body": "use the first idea I gave you where you replace <code>DbContext -&gt; IO()</code> which whatever type your <code>query&#39;</code> will have"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3692497"}, "edited": false, "score": 2, "creation_date": 1458911495, "post_id": 36220327, "comment_id": 60072516, "body": "You could make a <code>data MyValue = IntVal Int64 | StrVal String | FloVal Double | TimeVal UTVTime</code> and return that. Your insertion function can then pattern match on the type."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458923179, "post_id": 36220327, "comment_id": 60078767, "body": "Are you using <code>postgreSQL-simple</code>? If so, you may want your function to produce a <code>Query</code>, rather than <code>IO</code>. But the general pattern Carsten suggests is a solid one."}], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 2, "last_activity_date": 1458916983, "creation_date": 1458916983, "answer_id": 36222108, "question_id": 36220327, "link": "https://stackoverflow.com/questions/36220327/convert-to-typed-value-from-string/36222108#36222108", "title": "Convert to typed value from String", "body": "<p>The issue here is the meaning of <code>-&gt; a</code> in your function type. If you're function actually had this type, then whoever <em>called</em> your function should be able to specify a concrete type of their choosing (that you may not even have in scope) and then expect your function to work as if it had the type</p>\n\n<pre><code>String -&gt; String -&gt; MyCustomType\n</code></pre>\n\n<p>However this clearly isn't what you had in mind. You don't mean \"for all types <code>a</code>, I have a function ...\", you mean \"For any two strings, there is some type <code>a</code> for which I have a value\". This idea, that you get to choose the type variable instead of the caller, is called \"existential quantification\" and GHC does support it. However I don't really think that's what you want to do. After all, when you go to actually use this function, you'll probably want to be able to case on whether or not you got back a <code>UTCTime</code> or a <code>Double</code> or something. Since you cannot do this with existential quantification (just like how you cannot case on type variables in polymoprhic functions) we should instead create a custom data type:</p>\n\n<pre><code>data Dyn = String String | Int Int | BigInt Integer | UTCDate UTCTime ...\n</code></pre>\n\n<p>and so on. That is, you list out an explicit constructor for each case that your type may return and then your function will read</p>\n\n<pre><code>toProperType :: String -&gt; String -&gt; Dyn  \ntoProperType tp val =\n  case tp of\n    \"string\" -&gt; String val            -- ::String\n    \"int\"    -&gt; Int $ toIntType val  -- ::Int64\n    \"bigint\" -&gt; BigInt $ toIntType val  -- ::Int64\n    \"integer\"-&gt; Integer $ toIntType val    \n    \"utcdate\"-&gt; UTCDate $ toDateType val -- :: UTCTime\n    \"double\" -&gt; Double $ toDoubleType val -- :: Double\n</code></pre>\n\n<p>This is how serious Haskell libraries handle things like JSON parsing or what not so you're in good company. Now it's well typed and whoever calls this function just cases on the <code>Dyn</code> value and decides what to do based on the returned type.</p>\n"}], "owner": {"reputation": 291, "user_id": 5385301, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-0U4TwNfi86g/AAAAAAAAAAI/AAAAAAAAAA8/F2R9qN64wMs/photo.jpg?sz=128", "display_name": "Filip van Hoft", "link": "https://stackoverflow.com/users/5385301/filip-van-hoft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 36222108, "answer_count": 1, "score": 1, "last_activity_date": 1458916983, "creation_date": 1458910365, "question_id": 36220327, "link": "https://stackoverflow.com/questions/36220327/convert-to-typed-value-from-string", "title": "Convert to typed value from String", "body": "<p>I have file with list of values and types, after reading them I need to put them into db. For that, I need to supply insertion function with properly typed tuple, so I'm trying to convert values with something like this</p>\n\n<pre><code>toProperType :: String -&gt; String -&gt; a  \ntoProperType tp val =\n  case tp of\n    \"string\" -&gt; val            -- ::String\n    \"int\"    -&gt; toIntType val  -- ::Int64\n    \"bigint\" -&gt; toIntType val  -- ::Int64\n    \"integer\"-&gt; toIntType val    \n    \"utcdate\"-&gt; toDateType val -- :: UTCTime\n    \"double\" -&gt; toDoubleType val -- :: Double\n</code></pre>\n\n<p>Which is failing with</p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018a\u2019 with actual type \u2018Double\u2019\n        \u2018a\u2019 is a rigid type variable bound by</p>\n</blockquote>\n\n<p>which I think is correct. </p>\n\n<p>What is proper way to achieve this functionality?</p>\n\n<p>Maybe I need some extension or generate separate functions with TH(but not sure how to dispatch them)</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 2, "creation_date": 1458907729, "post_id": 36219513, "comment_id": 60070639, "body": "Are you exposing both the <code>Empty</code> and <code>Node</code> constructors from your BinaryTree module?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 6, "creation_date": 1458907970, "post_id": 36219513, "comment_id": 60070778, "body": "and on top are you importing them as well <code>import MyModule(BinaryTree)</code> vs. <code>import MyModule(BinaryTree(..))</code> - also note that <code>import MyModule(BST)</code> is the same as the first!"}, {"owner": {"reputation": 167, "user_id": 3989314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26cfd5ed72fb8a1e4242eedb4d20777?s=128&d=identicon&r=PG&f=1", "display_name": "VigneshM", "link": "https://stackoverflow.com/users/3989314/vigneshm"}, "edited": false, "score": 0, "creation_date": 1458909628, "post_id": 36219513, "comment_id": 60071560, "body": "Okay, I&#39;m importing like <code>import MyModule(BinaryTree)</code>. How do i import the data constructors i.e. BinaryTree(..)"}, {"owner": {"reputation": 167, "user_id": 3989314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26cfd5ed72fb8a1e4242eedb4d20777?s=128&d=identicon&r=PG&f=1", "display_name": "VigneshM", "link": "https://stackoverflow.com/users/3989314/vigneshm"}, "edited": false, "score": 0, "creation_date": 1458909924, "post_id": 36219513, "comment_id": 60071692, "body": "Thanks for the help!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458932472, "post_id": 36219513, "comment_id": 60083535, "body": "Type synonyms are of only fairly limited utility in Haskell. There are some special situations in <code>lens</code> and <code>pipes</code> and probably elsewhere where they&#39;re valuable, but in typical circumstances, you probably just shouldn&#39;t use them. GHC&#39;s type families are much more often useful, but they&#39;re a more advanced feature."}], "answers": [{"tags": [], "owner": {"reputation": 167, "user_id": 3989314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26cfd5ed72fb8a1e4242eedb4d20777?s=128&d=identicon&r=PG&f=1", "display_name": "VigneshM", "link": "https://stackoverflow.com/users/3989314/vigneshm"}, "is_accepted": true, "score": 2, "last_activity_date": 1458909996, "creation_date": 1458909996, "answer_id": 36220233, "question_id": 36219513, "link": "https://stackoverflow.com/questions/36219513/haskell-no-data-constructors-for-type-synonym/36220233#36220233", "title": "Haskell no data constructors for type synonym", "body": "<p>After @Carsten's comment, I realised I'm not importing the constructors from the module</p>\n\n<p><code>import BinaryTreeModule(BinaryTree(Empty,Node))</code>\n fixed the issue</p>\n"}], "owner": {"reputation": 167, "user_id": 3989314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26cfd5ed72fb8a1e4242eedb4d20777?s=128&d=identicon&r=PG&f=1", "display_name": "VigneshM", "link": "https://stackoverflow.com/users/3989314/vigneshm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 36220233, "answer_count": 1, "score": 0, "last_activity_date": 1458909996, "creation_date": 1458907172, "last_edit_date": 1458909840, "question_id": 36219513, "link": "https://stackoverflow.com/questions/36219513/haskell-no-data-constructors-for-type-synonym", "title": "Haskell no data constructors for type synonym", "body": "<p>I've defined a haskell data type with constructors and a type synonym for it.I'm not able to use its data constructors.</p>\n\n<p>Type definition :</p>\n\n<pre><code>module BinaryTreeModule(BinaryTree,..) where\ndata BinaryTree a = Empty | Node (BinaryTree a) a (BinaryTree a)\n</code></pre>\n\n<p>type synonym:</p>\n\n<pre><code>import BinaryTreeModule(BinaryTree)\ntype BST = BinaryTree\n</code></pre>\n\n<p>usage:</p>\n\n<pre><code>insert :: a -&gt; BST a -&gt; BST a\ninsert _ Empty = ...\ninsert _ Node .. = ...\n</code></pre>\n\n<p>I'm getting an error saying Empty and Node constructors not found.</p>\n\n<p>I've also defined them in different files. If BST is just a synonym for BinaryTree shouldn't their constructors be the same ? </p>\n\n<p>Also is there a better way to \"inherit\" the BinaryTree type to different types? Are typeclasses the correct solution here?</p>\n\n<p>Edit: added how I'm importing between files</p>\n"}, {"tags": ["rest", "haskell", "monads", "servant"], "comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1458904352, "post_id": 36218369, "comment_id": 60069047, "body": "This is probably due to <a href=\"http://haskell-servant.github.io/posts/2016-03-19-servant-0.5-release.html#switch-from-eithert-to-exceptt\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458904731, "post_id": 36218369, "comment_id": 60069239, "body": "There is not nearly enough code here to reproduce the error (<code>API</code> type is missing completely). Nor is there enough information to really tell what <code>getItems</code> is supposed to do. But at a glance - <code>runEitherT</code> is not needed, you are producing a value of type <code>EitherT ...</code>, you don&#39;t need to run it. Values of type <code>IO x</code> need to wrapped in <code>liftIO</code>: <code>aa &lt;- liftIO nextRandom</code>."}], "answers": [{"comments": [{"owner": {"reputation": 4522, "user_id": 54848, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a5665b93f3d9a4e78e84d97c6efb43af?s=128&d=identicon&r=PG", "display_name": "elviejo79", "link": "https://stackoverflow.com/users/54848/elviejo79"}, "edited": false, "score": 0, "creation_date": 1479135044, "post_id": 36219065, "comment_id": 68418429, "body": "How can I expose a pure function? Let&#39;s say I have it myFunc:: String-&gt;String ?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4522, "user_id": 54848, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a5665b93f3d9a4e78e84d97c6efb43af?s=128&d=identicon&r=PG", "display_name": "elviejo79", "link": "https://stackoverflow.com/users/54848/elviejo79"}, "edited": false, "score": 1, "creation_date": 1479155336, "post_id": 36219065, "comment_id": 68429984, "body": "@elviejo <code>return</code> lets you put a pure value in a monadic context. So, if you have a one-argument pure handler, just compose it with <code>return</code>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 4, "last_activity_date": 1458909423, "last_edit_date": 1458909423, "creation_date": 1458905284, "answer_id": 36219065, "question_id": 36218369, "link": "https://stackoverflow.com/questions/36218369/a-simple-example-of-rest-api-in-servant-or-how-to-mix-monads-properly/36219065#36219065", "title": "A simple example of rest api in servant or &quot;how to mix monads properly&quot;?", "body": "<p>Here:</p>\n\n<pre><code>getItems :: ExceptT ServantErr IO [MyData]\ngetItems = runExceptT $ do\n</code></pre>\n\n<p>What <a href=\"http://haddock.stackage.org/lts-5.9/transformers-0.4.2.0/Control-Monad-Trans-Except.html\" rel=\"nofollow\"><code>runExceptT</code></a> does is going from <code>ExceptT ServantErr IO [MyData]</code> to <code>IO (Either ServantErr [MyData]</code>. It eliminates the <code>ExceptT</code> newtype. But you want to go the other way!</p>\n\n<p>You can use <a href=\"https://hackage.haskell.org/package/transformers-0.4.2.0/docs/Control-Monad-IO-Class.html\" rel=\"nofollow\"><code>liftIO</code></a> to lift any <code>IO a</code> action into a <code>ExceptT ServantErr IO a</code> action. It basically tells the <code>ExceptT</code> wrapper to \"just put the result of the <code>IO</code> action in a success context\".</p>\n\n<p>Since your whole do-block seems to live in <code>IO</code>, you could just write:</p>\n\n<pre><code>getItems :: ExceptT ServantErr IO [MyData]\ngetItems = liftIO $ do\n    aa &lt;- nextRandom -- IO\n    bb &lt;- getCurrentTime -- IO\n    cc &lt;- getDataFromDb -- IO\n    ...\n</code></pre>\n\n<p>Instead of lifting each <code>IO</code> action separately.</p>\n\n<p>Other common cases:</p>\n\n<ul>\n<li><p>If you have a pure <code>Either</code>, use <a href=\"http://hackage.haskell.org/package/errors-2.1.2/docs/Control-Error-Util.html#v:hoistEither\" rel=\"nofollow\"><code>hoistEither :: Monad m =&gt; Either e a -&gt; ExceptT e m a</code></a> to lift it into <code>ExceptT</code>.</p></li>\n<li><p>If you have a pure <code>Maybe</code>, use <a href=\"http://hackage.haskell.org/package/errors-2.1.2/docs/Control-Error-Util.html#v:-63--63-\" rel=\"nofollow\"><code>failWith :: Applicative m =&gt; e -&gt; Maybe a -&gt; ExceptT e m a</code></a> and provide the error.</p></li>\n<li><p>If you have a <code>IO (Maybe a)</code>, use <a href=\"http://hackage.haskell.org/package/errors-2.1.2/docs/Control-Error-Util.html#v:failWithM\" rel=\"nofollow\"><code>failWithM :: Applicative m =&gt; e -&gt; m (Maybe a) -&gt; ExceptT e m a</code></a> and provide the error.</p></li>\n<li><p>If you have a <code>IO (Either e a)</code>, just wrap it in the <code>ExceptT</code> constructor.</p></li>\n<li><p>To change the error type carried by an <code>ExceptT</code>, use <a href=\"https://hackage.haskell.org/package/transformers-0.4.2.0/docs/Control-Monad-Trans-Except.html#v:withExcept\" rel=\"nofollow\"><code>withExcept :: (e -&gt; e') -&gt; Except e a -&gt; Except e' a</code></a>.</p></li>\n</ul>\n\n<p>All these functions are quite simple and looking at their source code is instructive.</p>\n"}], "owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 1, "accepted_answer_id": 36219065, "answer_count": 1, "score": 2, "last_activity_date": 1458909423, "creation_date": 1458902461, "last_edit_date": 1458908623, "question_id": 36218369, "link": "https://stackoverflow.com/questions/36218369/a-simple-example-of-rest-api-in-servant-or-how-to-mix-monads-properly", "title": "A simple example of rest api in servant or &quot;how to mix monads properly&quot;?", "body": "<p>I want to build a simple example of a rest api in servant 0.5:</p>\n\n<pre><code>data MyData = MyData { var1 :: Int, var2 :: String } \n\napp :: Application\napp = serve api server\n\napi :: Proxy API\napi = Proxy\n\nserver :: Server API\nserver = getItems\n\ngetItems :: EitherT ServantErr IO [MyData]\ngetItems = runEitherT $ do\n    aa &lt;- nextRandom -- IO\n    bb &lt;- getCurrentTime -- IO\n    cc &lt;- getDataFromDb -- IO\n\n    --noteT ??? How??? \n    --MaybeT ??? How??? \n\n    return $ Just [MyData 111 222] \n\n\nstartApp :: IO ()\nstartApp = run 8080 app  \n</code></pre>\n\n<p>I can't make it compile because of lots errors of \"Couldn't match expected type\" in different places. I guess it's because I'm mixing 2 different monads in \"getItems\". But not only.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458897688, "post_id": 36217095, "comment_id": 60066218, "body": "the error is just that you have to provide two <i>arguments</i> to your <code>combina</code> but you only provided one - sadly I have a hard time to translate this both to the problem-set and to some language I understand (I guess it&#39;s spanish?) so can you try tear the problem down and explain what your functions are supposed to be doing?"}, {"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458897889, "post_id": 36217095, "comment_id": 60066298, "body": "Yes, i will, just a moment :)"}, {"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458898229, "post_id": 36217095, "comment_id": 60066437, "body": "Im using combina(firstMiddleOfList,secondMiddleOfList) that is not right?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1458898351, "post_id": 36217095, "comment_id": 60066489, "body": "@colymore: no. That would be <code>(Skyline, Skyline) -&gt; Skyline</code>."}, {"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "edited": false, "score": 0, "creation_date": 1458898539, "post_id": 36217095, "comment_id": 60066570, "body": "Can you explain me why?Im beginner :D. Works, thanks"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458898697, "post_id": 36217095, "comment_id": 60066656, "body": "@Carsten: <code>Edificio = Building</code>, <code>Coordenada = Coordinates</code>, <code>resuelveSkyline = toSkyline</code>, <code>edificioAskyline = buildingToSkyline</code>. A <code>Skyline</code> the projection of a row of buildings, the skyline problem tries to yield a representation of that projection with a bunch of rectangles."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1458898820, "post_id": 36217095, "comment_id": 60066705, "body": "@Zeta thanks but I have trouble seeing how I can contribute anything meaningful aside from solving the problem and explaining every step - I think that there are so much fundamental misconceptions left that this problem is way to hard to start with"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458898929, "post_id": 36217095, "comment_id": 60066742, "body": "@colymore if you have a function <code>f :: (a,b) -&gt; c</code> then you can think of it having one argument which is a tuple of an <code>a</code> and a <code>b</code> - so you have to invoke <code>f</code> like this: <code>f (a,b)</code> - if you have <code>f :: a -&gt; b -&gt; c</code> than you can think of it as having two arguments (there is a deeper meaning which you will learn about later but stick with this idea for now) and you should invoke it like <code>f a b</code> instead"}, {"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458898988, "post_id": 36217095, "comment_id": 60066757, "body": "@Carsten im just looking for get anwsers for my questions, not a resolution for the problem :)."}, {"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "edited": false, "score": 0, "creation_date": 1458899098, "post_id": 36217095, "comment_id": 60066801, "body": "And about use fields of a type synonyms?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458899300, "post_id": 36217095, "comment_id": 60066896, "body": "@colymore I think you have enough problems with understanding the language and you should start there - if I remember correctly this was one of the non-trivial facebook(?) problems that started appearing a few years back - so now you have 2 problems: rewire your brain to FP and solve a harder problem"}, {"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "edited": false, "score": 0, "creation_date": 1458899450, "post_id": 36217095, "comment_id": 60066976, "body": "This problem is my homework for career..I should do it, but thank for the recomendation :)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458899468, "post_id": 36217095, "comment_id": 60066986, "body": "@Carsten: Nah. Don&#39;t rewire your brain. Just open up a new, unused section. Imperative and OO thinking is still handy in the economy."}], "answers": [{"comments": [{"owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "edited": false, "score": 0, "creation_date": 1458899587, "post_id": 36217603, "comment_id": 60067054, "body": "Thanks, i will do it :)"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1458899357, "creation_date": 1458899357, "answer_id": 36217603, "question_id": 36217095, "link": "https://stackoverflow.com/questions/36217095/skyline-in-haskell-probably-cause-%c2%b4function%c2%b4is-applied-to-too-few-arguments/36217603#36217603", "title": "Skyline in haskell, probably cause &#180;function&#180;is applied to too few arguments", "body": "<p>Let's say you want to define <code>func :: A -&gt; B -&gt; C</code>. The syntax to define func would be:</p>\n\n<pre><code>func :: A -&gt; B -&gt; C\nfunc a b = ...\n  -- ^^^\n</code></pre>\n\n<p>However, if you use <code>(a,b)</code>, you're not using two separate arguments, but a single pair:</p>\n\n<pre><code>--      vvvvv\nfunc :: (A,B) -&gt; C\nfunc (a,b) = ...\n--   ^^^^^\n</code></pre>\n\n<p>However, GHC only looks <code>combina</code>'s type signature in this line:</p>\n\n<pre><code>resuelveSkyline xs = combina (resuelveSkyline(fst(divide(xs))),resuelveSkyline(snd(divide(xs))))\n</code></pre>\n\n<p>So although you've defined <code>combina</code> to work on tuples, it does not type check. Note that <code>combina's</code> definition would also not unify with its stated type.</p>\n\n<p>That being said, if you change the type of <code>combina</code> and introduce a helper, you can make your code a lot easier:</p>\n\n<pre><code>combina :: (Skyline, Skyline) -&gt; Skyline\ncombina  (a,b) = ...\n\nboth :: (a -&gt; b) -&gt; (a,a) -&gt; (b,b)\nboth f (x,y) = (f x, f y)\n\nresuelveSkyline xs = combina (both resuelveSkyline (divide xs))\n</code></pre>\n\n<h2>Exercises</h2>\n\n<ol>\n<li><p>You can change any function from <code>(a, b) -&gt; c</code> to <code>a -&gt; b -&gt; c</code>. Write a function that does exactly that:</p>\n\n<pre><code>fromPairFunc :: ((a,b) -&gt; c) -&gt; (a -&gt; b -&gt; c)\nfromPairFunc f = ...\n</code></pre></li>\n<li><p>You can also do the opposite. Write the according function:</p>\n\n<pre><code>toPairFunc :: (a -&gt; b -&gt; c) -&gt; ((a,b) -&gt; c)\ntoPairFunc f = ...\n</code></pre></li>\n<li>In your original code, don't change the type of <code>combina</code>, but correct its definition and use <code>toPairFunc</code> at the correct place.</li>\n<li>In your original code, change the type of <code>combina</code>, but not the defintion. Instead of <code>(resuelveSkyline(fst(divide(xs))),resuelveSkyline(snd(divide(xs))))</code>, call it with two arguments <code>(resuelveSkyline(fst(divide(xs))))</code> and <code>(resuelveSkyline(snd(divide(xs))))</code>. You have to use <code>toPairFunc</code> at the correct place.</li>\n</ol>\n"}], "owner": {"reputation": 9494, "user_id": 988283, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/539251bc88379bc1f60805a7701c1afd?s=128&d=identicon&r=PG", "display_name": "colymore", "link": "https://stackoverflow.com/users/988283/colymore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 893, "favorite_count": 0, "accepted_answer_id": 36217603, "answer_count": 1, "score": 0, "last_activity_date": 1458899357, "creation_date": 1458897124, "last_edit_date": 1458898159, "question_id": 36217095, "link": "https://stackoverflow.com/questions/36217095/skyline-in-haskell-probably-cause-%c2%b4function%c2%b4is-applied-to-too-few-arguments", "title": "Skyline in haskell, probably cause &#180;function&#180;is applied to too few arguments", "body": "<p>i'm learning haskell for the university, i\u00b4m trying to do a Skyline problem -> <a href=\"https://briangordon.github.io/2014/08/the-skyline-problem.html\" rel=\"nofollow\">https://briangordon.github.io/2014/08/the-skyline-problem.html</a></p>\n\n<p>I have serious problems with haskell syntax because i come from OO languages, FP is weird for me, so, this is my current code:</p>\n\n<pre><code>    type Edificio = (Int,Int,Int)\ntype Coordenada = (Int,Int)\ntype Skyline = [Coordenada]\n\nresuelveSkyline :: [Edificio] -&gt; Skyline\nresuelveSkyline [] = []\nresuelveSkyline [x] = edificioAskyline(x)\nresuelveSkyline xs = combina (resuelveSkyline(fst(divide(xs))),resuelveSkyline(snd(divide(xs))))\n\nedificioAskyline :: Edificio -&gt; Skyline\nedificioAskyline (x1,x2,h) = [(x1,h),(x2,0)]\n\ndivide :: [Edificio] -&gt; ([Edificio], [Edificio])\ndivide edificios = splitAt (((length edificios) + 1) `div` 2) edificios\n\ncombina :: Skyline -&gt; Skyline -&gt; Skyline\ncombina (_,_) = []\n</code></pre>\n\n<p>I have two questions, first one is:</p>\n\n<p>I have a type Coordenada for example, what should i do if i want to pass a Coordenada as argument for other function and inside it get his first tuple value inside it?</p>\n\n<p>The second one is, i\u00b4m having this error while compiles:</p>\n\n<pre><code> Main.hs:8:22:\n    Couldn't match type \u2018Skyline -&gt; Skyline\u2019 with \u2018[Coordenada]\u2019\n    Expected type: Skyline\n      Actual type: Skyline -&gt; Skyline\n    Probable cause: \u2018combina\u2019 is applied to too few arguments\n    In the expression:\n      combina\n        (resuelveSkyline (fst (divide (xs))), \n         resuelveSkyline (snd (divide (xs))))\n    In an equation for \u2018resuelveSkyline\u2019:\n        resuelveSkyline xs\n          = combina\n              (resuelveSkyline (fst (divide (xs))), \n               resuelveSkyline (snd (divide (xs))))\n</code></pre>\n\n<p>I known that merge isn\u00b4t still finished but i want to try do it little by little.</p>\n\n<p>I have it in Spanish because i must use these function names mandatory (Professor obligates us).\nI will explain each method.</p>\n\n<p>resuelveSkyline has as a input a list of Edificio and return a Skyline, its the main function.\nedificioASkyline has as a input a building and convert it a skyline\ndivide takes a list and return a 2 lists with same size.\ncombina takes 2 skylines and return a new one merged with both.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49501, "user_id": 784338, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae195ac7c8a5e9002a808544572cc5fc?s=128&d=identicon&r=PG", "display_name": "Daniel Gratzer", "link": "https://stackoverflow.com/users/784338/daniel-gratzer"}, "is_accepted": true, "score": 4, "last_activity_date": 1458895075, "last_edit_date": 1458895075, "creation_date": 1458894357, "answer_id": 36216478, "question_id": 36216436, "link": "https://stackoverflow.com/questions/36216436/haskell-how-to-open-file-if-its-provided-or-use-stdin-instead/36216478#36216478", "title": "Haskell - how to open file if it&#39;s provided or use stdin instead", "body": "<p><code>if</code> is an expression so the branches also have to be expressions which <code>... &lt;- ...</code> and <code>let ... = ...</code> are not. Instead I would do something like</p>\n\n<pre><code>hInFile &lt;- if inFileExists \n           then openFile inFile ReadMode\n           else return stdin\n</code></pre>\n\n<p>where <code>return stdin</code> says \"just give me back <code>stdin</code>\", it's needed to make all the types work out though.</p>\n"}], "owner": {"reputation": 591, "user_id": 3934142, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f7812386a3972f8ee1a2b956fad742c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dracke", "link": "https://stackoverflow.com/users/3934142/dracke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 36216478, "answer_count": 1, "score": 0, "last_activity_date": 1458895075, "creation_date": 1458894160, "question_id": 36216436, "link": "https://stackoverflow.com/questions/36216436/haskell-how-to-open-file-if-its-provided-or-use-stdin-instead", "title": "Haskell - how to open file if it&#39;s provided or use stdin instead", "body": "<p>I am trying to open file if it exists or use stdin instead. I want to call hGetContents on hInFile united. This is what I came up with, but don't know how to make it work.</p>\n\n<pre><code>main :: IO ()\nmain = do\n    args &lt;- getArgs\n    let (inFileExists, inFile) = procArgs args\n    if inFileExists \n        then hInFile &lt;- openFile inFile ReadMode --this gives me parse error\n        else let hInFile = stdin\n    input' &lt;- hGetContents hInFile\n    print hInFile\n    return ()\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458923232, "post_id": 36211194, "comment_id": 60078804, "body": "@chi, ah, missed it. Sorry."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1458859261, "creation_date": 1458859261, "answer_id": 36211194, "question_id": 36211130, "link": "https://stackoverflow.com/questions/36211130/haskell-how-to-make-a-type-an-instance-of-two-typeclasses/36211194#36211194", "title": "Haskell: How to make a type an instance of two typeclasses?", "body": "<p>Use two instances</p>\n\n<pre><code>instance Eq Level where\n   x == y = ...\ninstance Ord Level where\n   compare x y = ...\n</code></pre>\n\n<p>Alternatively, use the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#stand-alone-deriving\" rel=\"noreferrer\">standalone deriving extension</a>:</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving #-}\n...       -- ^^^^^^^^^^^^^^^^^^ must be at the top of the file\nderiving instance (Eq Level)\nderiving instance (Ord Level)\n</code></pre>\n"}], "owner": {"reputation": 2781, "user_id": 3712077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/49c422162b017baade68cd67a2e358df?s=128&d=identicon&r=PG&f=1", "display_name": "barbara", "link": "https://stackoverflow.com/users/3712077/barbara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 36211194, "answer_count": 1, "score": 0, "last_activity_date": 1458888981, "creation_date": 1458858883, "last_edit_date": 1458888981, "question_id": 36211130, "link": "https://stackoverflow.com/questions/36211130/haskell-how-to-make-a-type-an-instance-of-two-typeclasses", "title": "Haskell: How to make a type an instance of two typeclasses?", "body": "<p>Is it possible to make <code>Level</code> an instance of <code>Eq</code> and <code>Ord</code>?</p>\n\n<pre><code>instance Eq Ord Level where\n    compare First Second = LT\n    ...\n</code></pre>\n\n<p>I've tried this</p>\n\n<pre><code>instance (Ord, Eq) =&gt; Level where ...\n</code></pre>\n\n<p>But I've got an error</p>\n\n<pre><code>\u2018compare\u2019 is not a (visible) method of class \u2018Level\u2019\n</code></pre>\n\n<p>I know I can use <code>deriving (Eq)</code> on my <code>data Level</code>. But I cannot change my <code>data</code>.</p>\n"}, {"tags": ["parsing", "haskell", "bison", "yacc", "happy"], "comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1458857508, "post_id": 36210629, "comment_id": 60054913, "body": "Is this a puzzle? Why don&#39;t you show us the ambiguities? However I believe that <code>a = b, c</code> could be parsed as <code>(a=b), c</code> and as well as <code>a = (b,c)</code>"}, {"owner": {"reputation": 1492, "user_id": 1091396, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/YtJY5.gif?s=128&g=1", "display_name": "ymg", "link": "https://stackoverflow.com/users/1091396/ymg"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1458857624, "post_id": 36210629, "comment_id": 60054956, "body": "@Ingo it&#39;s not a puzzle, I will mark what I&#39;m referring to now."}], "answers": [{"comments": [{"owner": {"reputation": 1492, "user_id": 1091396, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/YtJY5.gif?s=128&g=1", "display_name": "ymg", "link": "https://stackoverflow.com/users/1091396/ymg"}, "edited": false, "score": 0, "creation_date": 1458860251, "post_id": 36211289, "comment_id": 60055952, "body": "I see what you mean, never thought of the point you mentioned (was focusing on other ones like the sequences of <code>Pars</code> and <code>Structs</code>) and yes indeed Happy supports pragmas like the ones you&#39;ve mentioned. Thanks for your help."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 1492, "user_id": 1091396, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/YtJY5.gif?s=128&g=1", "display_name": "ymg", "link": "https://stackoverflow.com/users/1091396/ymg"}, "edited": false, "score": 0, "creation_date": 1458860663, "post_id": 36211289, "comment_id": 60056088, "body": "@ymg As far as I can see there is a similar problem with <code>pars</code> and <code>structs</code> basically you have a list of things, but a thing can end with another list of things, so it is never quite clear if and where the outer list should end."}, {"owner": {"reputation": 1492, "user_id": 1091396, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/YtJY5.gif?s=128&g=1", "display_name": "ymg", "link": "https://stackoverflow.com/users/1091396/ymg"}, "edited": false, "score": 0, "creation_date": 1458861474, "post_id": 36211289, "comment_id": 60056327, "body": "thanks, you&#39;ve been a great help! I&#39;ve just noticed a number of things after your remarks."}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 3, "last_activity_date": 1458859753, "creation_date": 1458859753, "answer_id": 36211289, "question_id": 36210629, "link": "https://stackoverflow.com/questions/36210629/ambiguous-grammar-and-possible-fixes/36211289#36211289", "title": "Ambiguous grammar and possible fixes", "body": "<p>So, how would you want</p>\n\n<pre><code>a = true, false\n</code></pre>\n\n<p>to get parsed? It could be</p>\n\n<pre><code>(a=true), false\n</code></pre>\n\n<p>or</p>\n\n<pre><code>a = (true, false)\n</code></pre>\n\n<p>If this was yacc, I would suggest to resolve the conflict by giving '=' and ',' associativity and precedence with the <code>%right</code> <code>%left</code> and <code>%nonassoc</code> pragmas, maybe Happy supports something like this.</p>\n"}], "owner": {"reputation": 1492, "user_id": 1091396, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/YtJY5.gif?s=128&g=1", "display_name": "ymg", "link": "https://stackoverflow.com/users/1091396/ymg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 36211289, "answer_count": 1, "score": 1, "last_activity_date": 1458859753, "creation_date": 1458856334, "last_edit_date": 1458857854, "question_id": 36210629, "link": "https://stackoverflow.com/questions/36210629/ambiguous-grammar-and-possible-fixes", "title": "Ambiguous grammar and possible fixes", "body": "<p>So I have this grammar for a language, the grammar certainly contains some ambiguity however I am finding it a bit unusually difficult to fix this one. Below is the BNF grammar of the language and below that part of my happy parser file. </p>\n\n<p>BNF of the proposed language:</p>\n\n<pre><code>&lt;program&gt; ::=                                   Skel program\n      \"program\" &lt;id&gt; \":\" &lt;pars&gt; \".\"\n\n--&gt; &lt;pars&gt; ::=\n      &lt;par&gt; [\";\" &lt;pars&gt;]                        parallel statements\n\n&lt;par&gt; ::=\n    \"func\" &lt;id&gt; &lt;structs&gt;                       structured expression\n--&gt; |   &lt;pars&gt; \"||\" &lt;pars&gt;                          parallel pipeline\n|   \"farm\" &lt;int&gt; &lt;pars&gt;                         task farm\n\n--&gt; &lt;structs&gt; ::=\n    &lt;struct&gt; [\";\" &lt;structs&gt;]                    statements\n\n&lt;struct&gt; ::=\n      &lt;exprs&gt;                                   expression\n--&gt; |     &lt;structs&gt; \"\u2022\" &lt;structs&gt;                   composition\n|     \"iter\" &lt;int&gt; &lt;structs&gt;                    iteration\n\n--&gt; &lt;exprs&gt; ::=\n      &lt;expr&gt; [\",\" &lt;exprs&gt;]                      expressions\n\n&lt;expr&gt; ::=\n    &lt;int&gt;                                       integer value\n    |  &lt;string&gt;                                 string value\n    |  &lt;bool&gt;                                   boolean value\n    |  &lt;id&gt; [ \"=\" &lt;exprs&gt; ]                     identifier/assignment\n    |  \"raise\" &lt;id&gt; \"=\" &lt;exprs&gt;                 raise exception\n    |  &lt;exprs&gt; \"catch\" &lt;id&gt; &lt;id&gt; \":\" &lt;exprs&gt;    catch exception\n    |  &lt;exprs&gt; &lt;op&gt; &lt;exprs&gt;                     binary operator\n    |  \"(\" &lt;exprs&gt; \")\"                          grouping\n\n&lt;op&gt; ::=                        operators\n    \"+\" | \"*\" | \"-\" | \"div\"| \"&lt;\"| \"&lt;=\" | \"==\" | \"!=\"\n</code></pre>\n\n<p><strong>Parser.y</strong></p>\n\n<pre><code>TProgram: program ID ':' TPars '.'    { Program $2 $4 }\n\nTPars   : TPar ';'                    {   [$1]  }\n        | TPars TPar                  { $2 : $1 }\n\nTPar    : func ID TStructs            { Function $2 $3   }\n      --| \"||\" TPars                  { Parall $2        }\n        | farm DIGIT TPars            { Farm $2 $3       }\n\nTStructs: TStruct ';'                 {  [$1]  }\n        | TStructs TStruct            { $2 : $1 }\n\nTStruct : TExprs                      { ExprList $1   }\n      --| '\u2022' TStructs                { CompOp $2     }\n        | iter DIGIT TStructs         { Iter $2 $3    }\n\nTExprs  : TExpr                       {   [$1]    }\n        | TExprs ',' TExpr            {  $3 : $1  }\n\nBinExpr : Term                        {  $1  }\n        | BinExpr Op BinExpr          { BinOp $2 $1 $3  }\n\nOp      : '/'                         { Divide }\n        | '*'                         { Times  }\n        | '-'                         { Minus  }\n        | '+'                         { Plus   }\n\nTerm    : ID                          { Var $1 }\n        | DIGIT                       { Digit $1 }\n        | FLOAT                       { Float $1 }\n\nTExpr   : '(' TExprs ')'              { ParenExpr $2 }\n        | true                        { Bool $1  }\n        | false                       { Bool $1  }\n        | ID '=' TExprs               { Assign $1 $3  }\n        | raise ID '=' TExprs         { Raise $2 $4   }\n        | BinExpr                     {  $1  }\n</code></pre>\n\n<p><strong>Edit</strong> : I've added arrows to the BNF format showing what I believe is causing the ambiguity in the grammar.</p>\n"}, {"tags": ["haskell", "signature", "agda"], "answers": [{"comments": [{"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 0, "creation_date": 1459165195, "post_id": 36212502, "comment_id": 60151091, "body": "Thank-you very much; I look forwards to reading the cited thesis and cited blog ^_^"}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 7, "last_activity_date": 1550700018, "last_edit_date": 1550700018, "creation_date": 1458867563, "answer_id": 36212502, "question_id": 36209339, "link": "https://stackoverflow.com/questions/36209339/haskell-deriving-mechanism-for-agda/36212502#36212502", "title": "Haskell Deriving Mechanism for Agda", "body": "<p>The \"7.3.2. Deriving operations on datatypes\" chapter of <a href=\"https://pages.lip6.fr/Pierre-Evariste.Dagand/stuffs/thesis-2011-phd/thesis.pdf\" rel=\"nofollow noreferrer\">A Cosmology of Datatypes</a> shows how to derive operations using descriptions. Though, the derived <code>Eq</code> is rather weak there.</p>\n\n<p>The basic idea is to represent data types using some first-order encoding, i.e. in terms of some generic data type, and define operations on this data type, so everything encoded in terms of it can be handled by these generic operations. I elaborated a simple version of this machinery <a href=\"http://effectfully.blogspot.ru/2016/02/simple-generic-programming.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>You can derive a stronger <code>Eq</code>, if you have a closed universe. Using a similar to descriptions approach (should be equally expressive, but I didn't check) and a closed universe I defined generic <code>show</code> <a href=\"https://github.com/effectfully/OTT/blob/master/Property/Showable.agda\" rel=\"nofollow noreferrer\">here</a>, which allows e.g. to print a vector of tuples after you name the constructors:</p>\n\n<pre><code>instance\n  named-vec : {A : Type} -&gt; Named (vec-cs A)\n  named-vec = record { names = \"nil\" \u2237 \"cons\" \u2237 [] }\n\ntest\u2082 : show (Vec (nat &amp; nat) 3 \u220b (7 , 8) \u2237\u1d65 (9 , 10) \u2237\u1d65 (11 , 12) \u2237\u1d65 []\u1d65)\n      \u2261 \"(cons 2 (7 , 8) (cons 1 (9 , 10) (cons 0 (11 , 12) nil)))\"\ntest\u2082 = prefl\n</code></pre>\n\n<p>where <code>Vec</code> is defined in terms of a similar to <code>Desc</code> data type. The <code>Eq</code> case should be similar, but more sophisticated.</p>\n\n<p>Here is how <code>Lift</code> can be used:</p>\n\n<pre><code>\u27e6_\u27e7Type : Type \u2192 Set\u2081\n\u27e6 Nat \u27e7Type = Lift \u2115\n\u27e6 Prp \u27e7Type = Set\n\nex\u2081 : \u2200 A -&gt; \u27e6 A \u27e7Type\nex\u2081 Nat = lift 0\nex\u2081 Prp = \u2115\n\nex\u2082 : \u2200 A -&gt; \u27e6 A \u27e7Type -&gt; Maybe \u2115\nex\u2082 Nat n = just (lower n) -- or (ex\u2082 Nat (lift n) = just n)\nex\u2082 Prp t = nothing\n</code></pre>\n\n<p>If <code>A : Set \u03b1</code> then <code>Lift A : Set (\u03b1 \u2294 \u2113)</code> for any <code>\u2113</code>. So when you have <code>\u2115 : Set</code> and <code>Set : Set\u2081</code>, you want to lift <code>\u2115</code> from <code>Set</code> to <code>Set\u2081</code>, which is just <code>Lift \u2115</code> \u2014 in simple cases you don't need to provide <code>\u2113</code> explicitly.</p>\n\n<p>To construct an element of a data type wrapped in <code>Lift</code> you use <code>lift</code> (like in <code>lift 0</code>). And to get this element back you use <code>lower</code>, so <code>lift</code> and <code>lower</code> are inverses of each other. Note though that <code>lift (lower x)</code> doesn't necessarily lie in the same universe as <code>x</code>, because <code>lift (lower x)</code> \"refreshes\" <code>\u2113</code>.</p>\n\n<p><strong>UPDATE</strong>: the <code>show</code> link is broken now (I should have used a permalink). But there is a better example now: <a href=\"https://github.com/effectfully/Generic/\" rel=\"nofollow noreferrer\">an entire library</a> that derives <code>Eq</code> for regular Agda data types.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1458916043, "post_id": 36221194, "comment_id": 60075008, "body": "Is it able to derive <code>Eq (Vec A n)</code> having <code>Eq A</code> in scope?"}], "tags": [], "owner": {"reputation": 2064, "user_id": 2882516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ff9cff8095a344cc2819aaa7956a50f?s=128&d=identicon&r=PG", "display_name": "Jesper", "link": "https://stackoverflow.com/users/2882516/jesper"}, "is_accepted": false, "score": 2, "last_activity_date": 1458913687, "creation_date": 1458913687, "answer_id": 36221194, "question_id": 36209339, "link": "https://stackoverflow.com/questions/36209339/haskell-deriving-mechanism-for-agda/36221194#36221194", "title": "Haskell Deriving Mechanism for Agda", "body": "<p>For a practical implementation of \"deriving Eq\" in Agda, you can take a look at Ulf's agda-prelude at <a href=\"https://github.com/UlfNorell/agda-prelude\" rel=\"nofollow\">https://github.com/UlfNorell/agda-prelude</a>. In particular, the module Tactic.Deriving.Eq contains code for automatically generating decidable equality for a quite general class of (simple and indexed) data types.</p>\n"}], "owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 3, "accepted_answer_id": 36212502, "answer_count": 2, "score": 6, "last_activity_date": 1550700018, "creation_date": 1458850914, "question_id": 36209339, "link": "https://stackoverflow.com/questions/36209339/haskell-deriving-mechanism-for-agda", "title": "Haskell Deriving Mechanism for Agda", "body": "<p>I am wondering if there is anything in Agda that resembles Haskell's <code>deriving Eq</code> clause ---then I have an associated question below, as well.</p>\n\n<p>For example, suppose I have types for a toy-language,</p>\n\n<pre><code>data Type : Set where\n  Nat  : Type\n  Prp : Type\n</code></pre>\n\n<p>Then I can implement decidable equality by pattern matching and <code>C-c C-a</code>,</p>\n\n<pre><code>_\u225f\u209c_ : Decidable {A = Type} _\u2261_\nNat \u225f\u209c Nat = yes refl\nNat \u225f\u209c Prp = no (\u03bb ())\nPrp \u225f\u209c Nat = no (\u03bb ())\nPrp \u225f\u209c Prp = yes refl\n</code></pre>\n\n<p>I'm curious if this can be mechanised or automated somehow similar to the manner it is done in Haskell:</p>\n\n<pre><code>data Type = Nat | Prp deriving Eq\n</code></pre>\n\n<p>Thank-you!</p>\n\n<p>While we're on the topic of types, I'd like to realise my formal types as Agda types: Nat is just natural numbers while Prp is small propositions.</p>\n\n<pre><code>\u27e6_\u27e7Type : Type \u2192 Set ?\n\u27e6 Nat \u27e7Type = \u2115\n\u27e6 Prp \u27e7Type = Set\n</code></pre>\n\n<p>Sadly this does not work. I tried to fix this with lifting but failed since I haven't a clue on how to use level lifting. Any help is appreciated!</p>\n\n<p>An example usage of the above function would be,</p>\n\n<pre><code>record InterpretedFunctionSymbol : Set where\n  field\n   arity   : \u2115\n   src tgt : Type\n   reify   : Vec \u27e6 src \u27e7Type arity \u2192 \u27e6 tgt \u27e7Type\n</code></pre>\n\n<p>Thank-you for humouring me!</p>\n"}, {"tags": ["function", "haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1458848090, "post_id": 36208564, "comment_id": 60050507, "body": "You need to wrap that in a <code>data</code> or (better) <code>newtype</code>. E.g. <code>newtype P a = P { unP :: Position -&gt; E a }</code>. Prepare to add wrapping/unwrapping <code>P</code>/<code>unP</code> here and there, as needed, to your <code>unitP, bindP</code> functions."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1458849604, "post_id": 36208564, "comment_id": 60051402, "body": "Like <a href=\"http://hackage.haskell.org/package/transformers-0.5.1.0/docs/src/Control-Monad-Trans-Reader.html#line-137\" rel=\"nofollow noreferrer\">this</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1815, "user_id": 1666393, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/jD7aX.jpg?s=128&g=1", "display_name": "Brian Joseph Spinos", "link": "https://stackoverflow.com/users/1666393/brian-joseph-spinos"}, "is_accepted": false, "score": 1, "last_activity_date": 1513891962, "creation_date": 1513891962, "answer_id": 47932992, "question_id": 36208564, "link": "https://stackoverflow.com/questions/36208564/make-specific-function-an-instance-of-monad-in-haskell/47932992#47932992", "title": "Make specific function an instance of Monad in Haskell", "body": "<p>Here is a custom monad implementation:</p>\n\n<pre><code>    -- Otherwise you can't do the Applicative instance.\n    import Control.Applicative\n\n\n    -- Simple function\n    foo :: String -&gt; String\n    foo x = do\n        x ++ \"!!!\"\n\n    -- Helper for printing Monads\n    print2 :: (Show a) =&gt; MyBox a -&gt; IO()\n    print2 (MyBox x) = print x\n\n\n    -- Custom type declaration\n    data MyBox a = MyBox a\n\n\n    -- MyBox functor\n    instance Functor MyBox where  \n        fmap f (MyBox x) = MyBox (f x)\n\n\n    -- MyBox Applicative \n    instance Applicative MyBox where  \n        pure = MyBox \n        (MyBox f) &lt;*&gt; x = f &lt;$&gt; x\n\n\n    -- MyBox Monad\n    instance Monad MyBox where  \n        return x = MyBox x\n        MyBox x &gt;&gt;= f  = f x \n\n    -- (MyBox as a functor) Use a function with a wrapped value\n    result1 = foo &lt;$&gt; (MyBox \"Brian\")\n\n    -- (MyBox as an Applicative) Use a wrapped function with a wrapped value\n    result2 = (MyBox foo) &lt;*&gt; (MyBox \"Erich\")\n\n    -- (MyBox as a Monad)  Use a wrapped value with a lambda (it can be chainable)\n    myLambda1 = (\\ x -&gt; MyBox (x ++  \" aaa\"))\n    myLambda2 = (\\ x -&gt; MyBox (x ++  \" bbb\"))\n    myLambda3 = (\\ x -&gt; MyBox (x ++  \" ccc\"))\n    result3 = (MyBox \"Rick\") \n        &gt;&gt;= myLambda1\n        &gt;&gt;= myLambda2\n        &gt;&gt;= myLambda3\n\n\n    -- Another Monad syntax\n    result4 = do\n        x &lt;- MyBox \"A\" \n        y &lt;- MyBox \"B\"  \n        z &lt;- MyBox \"C\"  \n        MyBox (x ++ y ++ z)\n\n\n    main = do\n        print2(result1) -- \"Brian!!!\"\n        print2(result2) -- \"Erich!!!\"\n        print2(result3) -- \"Rick aaa bbb ccc\"\n        print2(result4) -- \"ABC\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1513891962, "creation_date": 1458847869, "last_edit_date": 1458968691, "question_id": 36208564, "link": "https://stackoverflow.com/questions/36208564/make-specific-function-an-instance-of-monad-in-haskell", "title": "Make specific function an instance of Monad in Haskell", "body": "<p>I'm following Philip Wadler's paper on Monads (<a href=\"http://www.eliza.ch/doc/wadler92essence_of_FP.pdf\" rel=\"nofollow\">The essence of functional programming)</a> but instead of using functions such as <code>unitM</code> or <code>bindM</code>, I'm trying to make the Monad <code>M</code> an instance of the Haskell <code>Monad</code>. I did this for the first and second variation. But now I'm trying to do this for the third variation where we have to create a Monad which also keeps the position of an error message.</p>\n\n<p>The paper describes the following functions: (<code>E</code> is the error Monad from the second variation)</p>\n\n<pre><code>type Position = Integer\n\ntype P a = Position -&gt; E a\n\nunitP a = \\p -&gt; unitE a\nerrorP s = \\p -&gt; errorE (showpos p ++ \": \" ++ s)\nm `bindP` k = \\p -&gt; m p `bindE` (\\x -&gt; k x p)\n\nshowP m = showE (m 0)\n\nresetP  :: Position -&gt; P x -&gt; P x\nresetP q m = \\p -&gt; m q\n</code></pre>\n\n<p>Now, my question is: \"How can I make <code>P a = Position -&gt; E a</code> an instance of <code>Monad</code>?\"</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458841237, "post_id": 36206578, "comment_id": 60046451, "body": "just throw a <code>.cabal</code> into the folder exposing your module and it should work"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 2, "creation_date": 1458841317, "post_id": 36206578, "comment_id": 60046504, "body": "I don&#39;t understand. If <code>:load</code> works, why not just use that?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1458846304, "post_id": 36206578, "comment_id": 60049562, "body": "You can still use <code>:m</code> or <code>import</code> on &quot;local&quot; modules, it&#39;s just that now all modules must be loaded before calling either of these commands on them (I believe it would previously load the module automatically if it wasn&#39;t loaded?). So just do <code>:l Module.hs ; :m + Module</code>."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1469729238, "post_id": 36206578, "comment_id": 64670564, "body": "The answer and comment above have it right; I just want to point out that <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7416\" rel=\"nofollow noreferrer\">#7416</a> is relevant. You can load multiple modules with <code>:l Module1.hs Module2.hs ...</code>, but only <code>Module1.hs</code> is imported. You have to <code>:m +Module2 ...</code> to import the rest."}, {"owner": {"reputation": 1165, "user_id": 2990344, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4541d7050a05707748ef30b0529407bd?s=128&d=identicon&r=PG&f=1", "display_name": "xdavidliu", "link": "https://stackoverflow.com/users/2990344/xdavidliu"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1609911100, "post_id": 36206578, "comment_id": 115966522, "body": "@sclv <code>:load</code> is slightly different, it loads all functions in the file, not just the ones exported by the module (i.e. <code>module Foo (a,b,c) where...</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 2436, "user_id": 1657165, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/V12P3.jpg?s=128&g=1", "display_name": "Rigotti", "link": "https://stackoverflow.com/users/1657165/rigotti"}, "is_accepted": false, "score": 6, "last_activity_date": 1458846334, "creation_date": 1458846334, "answer_id": 36208129, "question_id": 36206578, "link": "https://stackoverflow.com/questions/36206578/ghci-how-to-import-modules-in-a-folder/36208129#36208129", "title": "ghci: how to import modules in a folder", "body": "<p>Not a very useful way, but if you want to achieve this old behavior, you have to load the file that contains the module</p>\n\n<pre><code>ghci&gt; :l File.hs\n</code></pre>\n\n<p>Hide/remove all the modules you don't want</p>\n\n<pre><code>ghci&gt; :m\n</code></pre>\n\n<p>The module imported from the file is now available</p>\n\n<pre><code>ghci&gt; :m YourModule\n</code></pre>\n"}], "owner": {"reputation": 10218, "user_id": 1684670, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0de21f6ec42b67830c9308664e0abf72?s=128&d=identicon&r=PG", "display_name": "thkang", "link": "https://stackoverflow.com/users/1684670/thkang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3870, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1458846334, "creation_date": 1458841106, "question_id": 36206578, "link": "https://stackoverflow.com/questions/36206578/ghci-how-to-import-modules-in-a-folder", "title": "ghci: how to import modules in a folder", "body": "<p>After updating from ghc 7.6 to 7.10 it seems you can't <code>:m [Module]</code> or <code>ghci&gt; import [Module]</code> where [Module.hs] is your hand-written module file that resides in current working directory.</p>\n\n<p>It seems ghci searches only for modules that are part of haskell standard library and modules that are globally installed via cabal. (you can still <code>:load [Module.hs]</code> in ghci prompts though)</p>\n\n<p>I think it's kinda annoying since you can't test whether my module definition is correct by directly importing them from ghci. Is there any switch or configuration that I can fiddle with, so I can tell where my haskell working dirctory is to ghci?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458840387, "post_id": 36206281, "comment_id": 60045914, "body": "I&#39;m afraid it did not really understand what you are trying to ask and the few things I did understand seems wrong to me ... can you probably make this a bit more concrete? Let&#39;s talk about the <code>Maybe</code>-monad to make this simple - <code>Maybe</code> is the type constructor, <code>return = Just</code> so can you please rephrase your question using this?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458840716, "post_id": 36206281, "comment_id": 60046119, "body": "btw: those will never do the same - you can view the type-constructor as a function but it&#39;s a function on the type-level - <code>return</code> will wrap a value into the monad"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1458841539, "post_id": 36206281, "comment_id": 60046638, "body": "I don&#39;t know if I agree with the duplicate ... it seems to be a different issue with the level of understanding here"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458841950, "post_id": 36206281, "comment_id": 60046920, "body": "@Carsten if in doubt, reopen."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1458844249, "post_id": 36206281, "comment_id": 60048364, "body": "A type constructor constructs <i>types</i>, not values! It&#39;s vaguely similar to the <code>List</code> part of <code>List&lt;String&gt;</code> in Java: given a type (<code>String</code>), it produces a type (<code>List&lt;String&gt;</code>). Generics is the closest thing Java has to type constructors."}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 2641381, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cd926ae368a04ba197724e34460ea51a?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2641381/jonas"}, "edited": false, "score": 0, "creation_date": 1458842369, "post_id": 36206456, "comment_id": 60047167, "body": "So if you compare country and return &quot;China&quot; from the question, what&#39;s the difference? Since Maybe is a monad country should contain a monadic value. But so is the result of return &quot;China&quot;."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 115, "user_id": 2641381, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cd926ae368a04ba197724e34460ea51a?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2641381/jonas"}, "edited": false, "score": 0, "creation_date": 1458843814, "post_id": 36206456, "comment_id": 60048098, "body": "@Jonas - <code>Just</code> is a constructor, <code>Maybe</code> is the type constructor. <code>Just x</code> and <code>return x</code> are the same thing for <code>Maybe</code>, but <code>return</code> has a more general type in that it applies to any monad so you can use it generically."}, {"owner": {"reputation": 115, "user_id": 2641381, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cd926ae368a04ba197724e34460ea51a?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2641381/jonas"}, "edited": false, "score": 0, "creation_date": 1458846324, "post_id": 36206456, "comment_id": 60049574, "body": "So the return function simply creates an instance of the basic the monad contains? (Just the abstract way of creating the instances of the basic type?)"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 115, "user_id": 2641381, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cd926ae368a04ba197724e34460ea51a?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2641381/jonas"}, "edited": false, "score": 0, "creation_date": 1458847011, "post_id": 36206456, "comment_id": 60049921, "body": "@Jonas - Yes <code>return</code> is used to create values of <code>m a</code> for some type constructor <code>m</code> for which there is a <code>Monad</code> instance."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 6, "last_activity_date": 1458844856, "last_edit_date": 1458844856, "creation_date": 1458840704, "answer_id": 36206456, "question_id": 36206281, "link": "https://stackoverflow.com/questions/36206281/difference-between-type-constructor-and-return-function-of-a-monad-in-haskell/36206456#36206456", "title": "Difference between type constructor and return function of a monad (in Haskell)", "body": "<p>Type constructors are type-level functions which return a type. <code>Maybe</code> is a type constructor which takes a single type parameter and returns a type e.g. <code>Maybe String</code>, <code>Maybe Int</code> etc.</p>\n\n<p>data constructors are used to create values of a particular type. For some type <code>Maybe a</code> these constructors are <code>Just</code> and <code>Nothing</code> i.e.</p>\n\n<pre><code>data Maybe a = Just a | Nothing\n</code></pre>\n\n<p>The <code>return</code> function constructs a monadic value from a 'plain' value e.g.</p>\n\n<pre><code>return 1 :: Maybe Int\nreturn \"s\" :: [String]\n</code></pre>\n\n<p>So in the definition of the <code>Monad</code> class </p>\n\n<pre><code>class Monad m where\n  return :: a -&gt; m a\n</code></pre>\n\n<p><code>m</code> is a type constructor e.g. (<code>IO</code>, <code>Maybe</code>, <code>[]</code>) which is used to construct types, while <code>return</code> is a function which constructs a monadic value of type <code>m a</code> from a value of type <code>a</code>.</p>\n\n<p>For the monad instance of <code>Maybe</code>, <code>return</code> constructs a value of <code>Maybe a</code> with just i.e.</p>\n\n<pre><code>instance Monad Maybe where\n  return x = Just x\n</code></pre>\n\n<p>so if you know you are dealing with <code>Maybe</code> it doesn't matter which you use. However, <code>return</code> has a more general type since it can be used to construct an arbitrary value <code>m a</code> for some monad <code>m</code>. </p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1496845109, "post_id": 36206662, "comment_id": 75829392, "body": "<code>return</code>/<code>pure</code> are just generalizations of value constructors. It is that simple. This should be the accepted answer."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 2, "last_activity_date": 1458841375, "creation_date": 1458841375, "answer_id": 36206662, "question_id": 36206281, "link": "https://stackoverflow.com/questions/36206281/difference-between-type-constructor-and-return-function-of-a-monad-in-haskell/36206662#36206662", "title": "Difference between type constructor and return function of a monad (in Haskell)", "body": "<p>A type constructor constructs a type out of other types. It is not a function and has nothing to do with values.</p>\n\n<p>In Haskell, <code>[]</code> is a type constructor. When applied to a type, say <code>Int</code>, it makes another type <code>[Int]</code>.</p>\n\n<p>Incidentally, in Java <code>[]</code> is a type constructor too. It can make a new type <code>Int[]</code> out of existing type <code>Int</code>.</p>\n\n<p>Perhaps you wanted to ask about data constructors. Indeed, <code>[]</code> is also a data constructor (different from the type constructor spelled <code>[]</code>) and in certain contexts it is equivalent to <code>return</code>. Why do we need <code>return</code> then?  <code>return</code> works for any monad and can be used to write generic monadic code that works for any monad. It is a <em>generalization</em> of <code>[]</code> and <code>Just</code> and <code>Left</code> and...</p>\n"}, {"tags": [], "owner": {"reputation": 2540, "user_id": 1803897, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/921ed2f776bd064b49d8aadb378dd15a?s=128&d=identicon&r=PG", "display_name": "Roland Puntaier", "link": "https://stackoverflow.com/users/1803897/roland-puntaier"}, "is_accepted": false, "score": 0, "last_activity_date": 1591626757, "creation_date": 1591626757, "answer_id": 62264439, "question_id": 36206281, "link": "https://stackoverflow.com/questions/36206281/difference-between-type-constructor-and-return-function-of-a-monad-in-haskell/62264439#62264439", "title": "Difference between type constructor and return function of a monad (in Haskell)", "body": "<p>In</p>\n\n<pre><code>  (&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<ul>\n<li><code>m</code> is a constructor of a type that is instance of the <code>Monad</code> class</li>\n<li><code>m a</code> is NOT a constructor application but a pattern matching to extract <code>m</code> and <code>a</code></li>\n<li><code>a-&gt;m b</code> is a pattern against a function of <code>m b</code>. Let's call it <code>k</code>.</li>\n<li><code>&gt;&gt;=</code> needs to map to what <code>k</code> maps to ('returns'), i.e. apply <code>k a</code></li>\n</ul>\n\n<p>The implementation from <code>Maybe</code></p>\n\n<pre><code>    (Just x) &gt;&gt;= k      = k x\n</code></pre>\n\n<p>In a <code>do</code></p>\n\n<ul>\n<li><code>&gt;&gt;=</code> binds <code>someMonad &lt;- mConstructorSmartOrNot someParam</code> to the next line</li>\n<li><code>&gt;&gt;</code> binds <code>mConstructorSmartOrNot someParam</code> to the next line</li>\n</ul>\n\n<pre><code>    return :: Monad m =&gt; a -&gt; m a\n</code></pre>\n\n<p><code>return</code> is basically the same as <code>m</code>,\nbut since <code>m</code> can be any\nconstructor (of a value of a variable of an <code>m</code>-constructed type),\nwe can refer to it generally with this one name.</p>\n\n<p>A monad constructs and forwards context.</p>\n"}], "owner": {"reputation": 115, "user_id": 2641381, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cd926ae368a04ba197724e34460ea51a?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/2641381/jonas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "accepted_answer_id": 36206456, "answer_count": 3, "score": 3, "last_activity_date": 1591626757, "creation_date": 1458840140, "last_edit_date": 1458841499, "question_id": 36206281, "link": "https://stackoverflow.com/questions/36206281/difference-between-type-constructor-and-return-function-of-a-monad-in-haskell", "title": "Difference between type constructor and return function of a monad (in Haskell)", "body": "<p>I'm trying to figure out monads in Haskell but didn't get too far yet.</p>\n\n<p>I found <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads#cite_note-1\" rel=\"nofollow\">https://en.wikibooks.org/wiki/Haskell/Understanding_monads#cite_note-1</a>\nand several other tutorials/explanations, but none seems to be explaining the difference between the type constructor and the return function.</p>\n\n<p>As I understood the</p>\n\n<ul>\n<li>type constructor constructs a monad from a given value of the basic data type. So it's sort of a normal constructor like in Java, which builds from the given parameter a new instance.</li>\n<li><code>return</code> function applies the type constructor on the given value of the basic data type and returns the constructed monad.</li>\n</ul>\n\n<p>So what's the point of having two functions doing basically the same?</p>\n\n<p><strong>EDIT</strong>\nSo using the example of a Maybe-monad, the</p>\n\n<ul>\n<li><code>country = Just \"China\"</code>: (constructor) creates the monad for the value \"China\". </li>\n<li><code>return \"China\"</code>: returns the monad which is corresponding to the value of China, so it's basically the monad containing the <code>\"China\"</code> value.</li>\n</ul>\n\n<p>Generally speaking I understand a monad as a container for values. \nOne usage of monads is to combine simple/existing computations to more complex computations.</p>\n"}, {"tags": ["haskell", "haskell-lens", "gadt"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1458842564, "post_id": 36205854, "comment_id": 60047280, "body": "May I ask why you choose a GADT rather than a nested type here?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458842853, "post_id": 36205854, "comment_id": 60047466, "body": "dfeuer: I think I need to make assertions at compile time that are easier with naturals than with nested pairs... but I&#39;ll consider it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458843308, "post_id": 36205854, "comment_id": 60047781, "body": "Actually, I think I misunderstood you. When you say &quot;subtree&quot;, are you actually talking about the uppermost portion of the tree (i.e., all nodes down to a particular depth)?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458843700, "post_id": 36205854, "comment_id": 60048035, "body": "dfeuer: Yes, that&#39;s what I tried to specify by &quot;subtree of depth n at the root&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458876342, "post_id": 36205854, "comment_id": 60059924, "body": "I&#39;ve looked at this a bit more and given it some additional thought. My conclusion is that your original two-pass implementation is very likely the best one possible for this exact function, up to a bit of wiggle. The <i>inherent</i> difficulty is that you have no information about how <code>f</code>s consumption and production rates relate. If <code>f</code> were known to be <code>fmap g</code> that would be different."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458933195, "post_id": 36205854, "comment_id": 60083936, "body": "I&#39;d love to see more information about what you&#39;re actually using this tree for, and what sorts of assertions you wish to make about it."}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1458846268, "post_id": 36207994, "comment_id": 60049546, "body": "I like this better than the hack I figured out to lazy match my GADT with <code>swapRoot (Branch a (l,r)) t = ... where ~(a&#39;,(l&#39;,r&#39;)) = (\\(Branch a p) -&gt; (a,p)) t</code> since the lack of dependence is now explicit."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458876021, "post_id": 36207994, "comment_id": 60059854, "body": "The <code>case</code> here looks too strict. I think it leads to two passes (one explicit; one implicit)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458882696, "post_id": 36207994, "comment_id": 60061401, "body": "@dfeuer I agree the case is strict - but wouldn&#39;t that be desired in this case? Due to <code>go</code> being strict, it must compute both the root tree and the function recomputing the final result from the transformed tree at once, meaning it must make only one pass. Perhaps I&#39;ve misunderstood something."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458883895, "post_id": 36207994, "comment_id": 60061694, "body": "@user2407038, I actually think the OP&#39;s original code is probably about the best possible for this exact function and this exact type. When passed a sufficiently lazy function (e.g., application of <code>fmap</code>), it only does one actual pass. I don&#39;t see how yours will perform any better with a non-lazy function, and I think it will be rather worse with a lazy one. I guess I could be missing something, though. It seems yours performs one pass over the tree, and then a second rebuilding pass after that is entirely complete. The original code interleaves these nicely."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1458910745, "post_id": 36207994, "comment_id": 60072112, "body": "dfeuer: Another advantage of user2407038&#39;s approach over my original is that I can also adapt it to <a href=\"http://lpaste.net/156726#line71\" rel=\"nofollow noreferrer\">map all the subtrees of depth <code>n</code> that share a leaf layer with the original tree</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1458927238, "post_id": 36207994, "comment_id": 60080906, "body": "@rampion, if you&#39;re referring to your <code>mapLeaf</code>, that&#39;s much closer to a traditional lens, and I think it&#39;s much better written directly, like this: <a href=\"http://lpaste.net/8472576886969466880\" rel=\"nofollow noreferrer\">lpaste.net/8472576886969466880</a> (with <code>ScopedTypeVariables</code> enabled)."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1458845829, "creation_date": 1458845829, "answer_id": 36207994, "question_id": 36205854, "link": "https://stackoverflow.com/questions/36205854/single-pass-lens-for-the-root-of-a-balanced-binary-tree/36207994#36207994", "title": "Single pass lens for the root of a balanced binary tree", "body": "<p>Your \"tying the knot\" approach is sound - you just need all the parameters in the right place so the function can be sufficiently lazy.</p>\n\n<pre><code>data (:&lt;=) (n :: Nat) (m :: Nat) where \n  LTEQ_0 :: 'Zero :&lt;= n \n  LTEQ_Succ :: !(n :&lt;= m) -&gt; 'Succ n :&lt;= 'Succ m\n\nmapRoot :: n :&lt;= m -&gt; (Tree n a -&gt; Tree n a) -&gt; Tree m a -&gt; Tree m a \nmapRoot p0 f0 t0 = restore (f0 root) where \n  (root, restore) = go p0 t0 \n\n  go :: n :&lt;= m -&gt; Tree m a -&gt; (Tree n a, Tree n a -&gt; Tree m a) \n  go LTEQ_0 t = (Leaf, const t) \n  go (LTEQ_Succ p) (Branch a (l,r)) = \n    case (go p l, go p r) of \n      ((l', fl), (r', fr)) -&gt; \n        ( Branch a (l', r')\n        , \\(Branch a1 (l1, r1)) -&gt; Branch a1 (fl l1, fr r1)\n        )\n</code></pre>\n\n<p>Note that <code>go</code> returns a pair - the root tree, and a function taking the processed root and returning the result. This makes it explicit (to the programmar and runtime!) that the resulting <code>Tree n a</code> does not depend on the input <code>Tree n a</code>. </p>\n\n<p>Also, I've replaced your class with a GADT just for brevity. </p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 36207994, "answer_count": 1, "score": 2, "last_activity_date": 1458881489, "creation_date": 1458838711, "last_edit_date": 1458839645, "question_id": 36205854, "link": "https://stackoverflow.com/questions/36205854/single-pass-lens-for-the-root-of-a-balanced-binary-tree", "title": "Single pass lens for the root of a balanced binary tree", "body": "<p>I have a balanced binary tree that includes the tree's depth in its type:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\ndata Tree (n :: Nat) a where\n  Leaf :: Tree Zero a\n  Branch :: a -&gt; (Tree n a, Tree n a) -&gt; Tree (Succ n) a\n</code></pre>\n\n<p>I'd like a way to run arbitrary functions <code>f :: Tree n a -&gt; Tree n a</code> on the subtree of depth <code>n</code> at the root of any <code>Tree m a</code>, <code>m</code> &geq;<code>n</code>.</p>\n\n<p>I was able to implement this one way using a type class for extracting and replacing the root-subtree:</p>\n\n<pre><code>mapRoot :: X m n =&gt; (Tree n a -&gt; Tree n a) -&gt; Tree m a -&gt; Tree m a\nmapRoot f t = putRoot (f (getRoot t)) t\n\nclass X m n where \n  getRoot :: Tree m a -&gt; Tree n a\n  putRoot :: Tree n a -&gt; Tree m a -&gt; Tree m a\n\ninstance X m Zero where\n  getRoot t = Leaf\n  putRoot Leaf t = t\n\ninstance X m n =&gt; X (Succ m) (Succ n) where\n  getRoot (Branch a (l,r)) = (Branch a (getRoot l, getRoot r))\n  putRoot (Branch a (l,r)) (Branch _ (l',r')) = Branch a (putRoot l l', putRoot r r')\n</code></pre>\n\n<p>While this works, it requires two passes through the root subtree, and I'd like to do it in one, if possible.</p>\n\n<p>This is <em>almost</em> possible by using lazy evaluation (tying the knot):</p>\n\n<pre><code>mapRoot' :: Y m n =&gt; (Tree n a -&gt; Tree n a) -&gt; Tree m a -&gt; Tree m a\nmapRoot' f t = t' where\n  (r, t') = swapRoot t r'\n  r' = f r \n\nclass Y m n where\n  swapRoot :: (Tree m a, Tree n a) -&gt; (Tree n a, Tree m a)\n\ninstance Y m Zero where \n  swapRoot t leaf = (leaf, t)\n\ninstance Y m n =&gt; Y (Succ m) (Succ n) where\n  swapRoot (Branch a (l,r)) (Branch a' (l',r')) = (Branch a (lx,rx), Branch a' (lx',rx')) where\n    (lx,lx') = swapRoot l l'\n    (rx,rx') = swapRoot r r'\n</code></pre>\n\n<p>But if you actually try to run <code>mapRoot'</code> you'll find that it doesn't halt; this is because <code>swapRoot</code> isn't lazy in its second argument (which it can't be, because <code>Tree n a</code> is a GADT).</p>\n\n<p>However, given <code>getRoot</code> and <code>putRoot</code>, I've got <em>a</em> lens for the root subtree, which leads me to suspect there's others, including one that can be used to implement <code>mapRoot</code> in a single pass.</p>\n\n<p>What is such a lens?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1458837589, "post_id": 36205359, "comment_id": 60044136, "body": "What is your definition of <code>factorial</code>? (For that matter, it&#39;s not clear why you are using <code>factorial</code> at all, or what your actual question is. Only 1, 2, 4, and 8 have a chance at dividing 10, and only 2 actually does.) If you want the powers of 2 that are divisible by 10, <i>none</i> of them are; 10 = 2 * 5, and no power of two is divisible by 5."}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458837788, "post_id": 36205359, "comment_id": 60044279, "body": "I agree with everything that @chepner said, and wanted to add that if you do fill in a factorial function and run this, there isn&#39;t even a divide by zero error...."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1458837843, "post_id": 36205359, "comment_id": 60044320, "body": "the error is most likely because you used <code>Int</code> instead of <code>Integer</code> to define your <code>factorial</code> or you have a <code>Int</code> type annotation somewhere"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458838340, "post_id": 36205359, "comment_id": 60044637, "body": "this should get your list <code>let m = product [1..10] in filter (\\n -&gt; m `mod` n == 0) $ takeWhile (&lt;= m) [2^i | i &lt;- [1..]]</code> - should give you <code>[2,4,8,16,32,64,128,256]</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458838458, "post_id": 36205359, "comment_id": 60044712, "body": "of course it&#39;s quite easy with a bit of math: 10! = 1*2*3*...*10 - and you want to collect all prim-factor 2s in there - it&#39;s 2,2*2,2*3,2*2*2,2*5 - so you can take 1 to 8 2`s and that is exactly [2^1,...,2^8] which is the result the script gave you"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458845696, "post_id": 36205359, "comment_id": 60049222, "body": "(Ugh. Ignore the part of my comment talking about 10; I read the <code>!</code> in the first sentence as punctuation, not an operator.)"}, {"owner": {"reputation": 23, "user_id": 6024312, "user_type": "registered", "profile_image": "https://graph.facebook.com/1008736972531926/picture?type=large", "display_name": "Niteesh Tiwari", "link": "https://stackoverflow.com/users/6024312/niteesh-tiwari"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1458850557, "post_id": 36205359, "comment_id": 60051895, "body": "sorry everyone ,i am new here so i didn&#39;t new about everything .I have updated my question .Now can anyone tell me about the exception  @chepner"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458851861, "post_id": 36205359, "comment_id": 60052538, "body": "for large enough <code>i</code> your <code>2^i :: Int</code> will first get negativ then stay at 0 (look at this expression in GHCi: <code>take 100 $ [2^i | i &lt;- [1..]] :: [Int]</code>) - as I said you don&#39;t want to use <code>Int</code> here (try <b>Integer</b>) - please look at the snippet I gave above you can easily adapt this without using <code>log</code> (which you should not)"}, {"owner": {"reputation": 23, "user_id": 6024312, "user_type": "registered", "profile_image": "https://graph.facebook.com/1008736972531926/picture?type=large", "display_name": "Niteesh Tiwari", "link": "https://stackoverflow.com/users/6024312/niteesh-tiwari"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458881669, "post_id": 36205359, "comment_id": 60061140, "body": "@Carsten i wrote this command <code>let m = product [1..10] in filter (\\n -&gt; m </code>mod` n == 0) $ takeWhile (&lt;= m) [5^i | i &lt;- [1..],(factorial(10)  <code>mod</code>  (5^i))==0]`...and it gives the output as [5,25   i.e.  it is not stopping and last is empty list .Can you please see"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458890487, "post_id": 36205359, "comment_id": 60063649, "body": "@NiteeshTiwari the hole idea of my little snippet is to move the <code>filter</code> away from the list comprehension and you did put it back again - see with this the list comprehension will soon not find another element and there it will <i>hang</i> - just use <code>let m = product [1..10] in filter (\\n -&gt; m `mod` n == 0) $ takeWhile (&lt;= m) [5^i | i &lt;- [1..]]</code> - also: the <code>factorial(10)</code> is <code>m</code> here ...."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6024312, "user_type": "registered", "profile_image": "https://graph.facebook.com/1008736972531926/picture?type=large", "display_name": "Niteesh Tiwari", "link": "https://stackoverflow.com/users/6024312/niteesh-tiwari"}, "edited": false, "score": 0, "creation_date": 1458909124, "post_id": 36215952, "comment_id": 60071364, "body": "thank you so much.....You have completely cleared all my doubts"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 1, "last_activity_date": 1458893608, "last_edit_date": 1458893608, "creation_date": 1458891799, "answer_id": 36215952, "question_id": 36205359, "link": "https://stackoverflow.com/questions/36205359/exception-divide-by-zero/36215952#36215952", "title": "Exception: divide by zero", "body": "<h2>What went wrong with <code>Int</code>?</h2>\n\n<p>Well <code>Int</code> has a bounded range - on most systems <code>-(2^63)</code> to <code>2^63-1</code>.</p>\n\n<p>Now you start with <code>1</code> (which is <code>1</code> in binary too) and then add zeroes in binary (which is the same as multiplying by 2) - you always only have one <code>1</code> followed by <code>0</code>s. At some point you hid the representation of the lower-bound (the highest bit will represent a marker for positive or negative values) and then you will add yet another <code>0</code> which will overflow the <code>Int</code> end end you with only <code>0</code>s.</p>\n\n<p>You can check this easily:</p>\n\n<pre><code>Prelude&gt; take 64 $ [2^i | i &lt;- [1..]] :: [Int]\n[2,4,8,16,32,64,128,\n...\n,4611686018427387904,-9223372036854775808,0]\n</code></pre>\n\n<p>That's where the <code>division by zero</code> in your original answer came from.</p>\n\n<h2>Why is you list comprehension ending up in bottom</h2>\n\n<p>The next problem you have is, that at one point the list-comprehension</p>\n\n<pre><code>[2^i | i&lt;-[1..],(factorial(10) `mod` (2^i))==0]\n</code></pre>\n\n<p>will <em>hang</em> and not produce any more values.</p>\n\n<p>The reason is simple: for big enough <code>i</code>: <code>2^i &gt; factorial(10)</code> and will never again divide it.</p>\n\n<p>That's why I would recommend pulling out the filter for the <code>mod</code> and first bounding the list to a this hard-limit:</p>\n\n<p>I don't want to write <code>factorial 10</code> over and over again so I first define</p>\n\n<ul>\n<li><code>let m = product [1..10]</code> which is the definition of <code>factorial 10</code></li>\n<li><code>[2^i | i &lt;- [1..]]</code> is a list of <em>all</em> numbers in the form <code>2^i</code></li>\n<li>only those smaller <code>m</code> are interesting so let's take only those: <code>takeWhile (&lt;= m) [2^i | i &lt;- [1..]]</code></li>\n<li>now the list is finite and it's no problem to use <code>filter</code>: <code>filter (\\n -&gt; m `mod` n == 0) $ takeWhile (&lt;= m) [5^i | i &lt;- [1..]]</code></li>\n</ul>\n\n<p>which yields:</p>\n\n<pre><code>\u03bb&gt; let m = product [1..10] \n   in filter (\\n -&gt; m `mod` n == 0) \n      $ takeWhile (&lt;= m) \n     [2^i | i &lt;- [1..]]\n[2,4,8,16,32,64,128,256]\n</code></pre>\n\n<h2>solving your problem</h2>\n\n<p>of course it turns out that your <em>problem</em> was given as:</p>\n\n<blockquote>\n  <p>the question was to define a function <code>largest_Power</code> such that\n  <code>largest_Power :: Int -&gt; Int -&gt; Int</code> with <code>largest_Power n p</code> is the largest\n  power of <code>p</code> that divides <code>factorial n</code></p>\n</blockquote>\n\n<p>I assume for now that you have to deal with the <code>Int</code>s there so you have to springle in some <code>fromIntegral</code> to deal with the conversions.</p>\n\n<p>A solution based on your idea and the above snippet could be:</p>\n\n<pre><code>largest_Power :: Int -&gt; Int -&gt; Int\nlargest_Power n p = fromIntegral . last $ factorList n p\n\nfactorList :: Int -&gt; Int -&gt; [Integer]\nfactorList n p =\n  filter (\\n -&gt; m `mod` n == 0)\n  $ takeWhile (&lt;= m) [p'^i | i &lt;- [1..]]\n  where m = fromIntegral $ factorial n\n        p' = fromIntegral p\n\nfactorial :: Int -&gt; Integer\nfactorial n = product [1..fromIntegral n]\n</code></pre>\n\n<hr>\n\n<p>if you indeed are only interested in the <code>i</code> from <code>p^i</code> then you can just push this into a tuple and adapt the algorithm a bit:</p>\n\n<pre><code>factorList :: Int -&gt; Int -&gt; [Integer]\nfactorList n p =\n  map fst\n  . filter (\\(_,n) -&gt; m `mod` n == 0)\n  $ takeWhile ((&lt;= m) . snd) [(i,p'^i) | i &lt;- [1..]]\n  where m = fromIntegral $ factorial n\n        p' = fromIntegral p\n</code></pre>\n\n<p>the rest of the program can stay unchanged</p>\n\n<h2>rethinking the algorithm</h2>\n\n<p>now if you think about what's going on it honestly doesn't seem to make sense to first create a huge number <code>factorial n</code> and then test for divisibility when all we need is the number or times we can divide this number by another (without rest) and when we know that this huge number is just a factor of really small numbers - because the we just can check the smaller numbers and then add up.</p>\n\n<p>So if you are only interested in the <code>i</code> from <code>p^i</code> again than this will do as well:</p>\n\n<pre><code>factorCount :: Integral a =&gt; a -&gt; a -&gt; a\nfactorCount n p =\n  let (n',r) = n `divMod` p\n  in if r == 0 then 1 + factorCount n' p else 0\n\nlargest_Power :: Integral a =&gt; a -&gt; a -&gt; a\nlargest_Power n p = sum [ factorCount i p | i &lt;- [1..n] ]\n</code></pre>\n\n<p>but should be a lot faster for bigger numbers.</p>\n\n<p>Note that you can get this faster still if you memoize the <code>factorCount</code> which you probably should if this is an problem for an online contest .. which I suspect ^^</p>\n"}], "owner": {"reputation": 23, "user_id": 6024312, "user_type": "registered", "profile_image": "https://graph.facebook.com/1008736972531926/picture?type=large", "display_name": "Niteesh Tiwari", "link": "https://stackoverflow.com/users/6024312/niteesh-tiwari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "closed_date": 1459489655, "accepted_answer_id": 36215952, "answer_count": 1, "score": -3, "last_activity_date": 1458893608, "creation_date": 1458837271, "last_edit_date": 1458882168, "question_id": 36205359, "link": "https://stackoverflow.com/questions/36205359/exception-divide-by-zero", "closed_reason": "Needs details or clarity", "title": "Exception: divide by zero", "body": "<p>I wanted to find out the list with all powers of 2 that divide 10! it is showing exception i.e. divide by zero</p>\n\n<pre><code>[2^i | i&lt;-[1..],(factorial(10) `mod` (2^i))==0]\n</code></pre>\n\n<p>the complete question was to get the function largest_Power such that\nlargest_Power :: Int -> Int -> Int\nlargest_Power n p\nis the largest power of p that divides n! (factorial of n)</p>\n\n<p>And i tried to make this</p>\n\n<pre><code>largest_Power :: Int-&gt;Int-&gt;Int\nlargest_Power 0 _ =1  \nlargest_Power _ 0 =1\nlargest_Power n p = floor (logBase (fromIntegral p) (fromIntegral (last([p^i | i&lt;-[1..],(factorial(n) `mod` (p^i))==0]))))\n\nfactorial::Int-&gt;Int\nfactorial 0=1\nfactorial 1=1\nfactorial x=x*factorial(x-1)\n</code></pre>\n\n<p>Now when i ran this for largestPower 10 2 .I am getting exception.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1458831308, "post_id": 36203139, "comment_id": 60039662, "body": "The translation to JSON is up to you, usually I expect some sort of tag that indicates the constructor.  <code>toJSON A1 -&gt; &quot;{ &#39;tag&#39; : &#39;A1&#39; }&quot;</code> so on and so forth."}], "answers": [{"comments": [{"owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1458834441, "post_id": 36203797, "comment_id": 60041963, "body": "in <code>instance ToJSON A1 where</code> the A1 is the name of the class, whereas the next 3 are constructors, correct? That is, the 2nd A1 is a constructor."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 1, "creation_date": 1458834541, "post_id": 36203797, "comment_id": 60042034, "body": "@AlanCoromano The first <code>A1</code> is the name of the <i>data type</i>, <code>class</code> has specific meaning in Haskell that is different.  The next three are constructors.  It may be better to have <code>data A = A1 | A2 | A2</code> and <code>instance ToJSON A where ...</code> and <code>instance FromJSON A where ...</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1458834865, "post_id": 36203797, "comment_id": 60042252, "body": "@AlanCoromano In your question you said <code>data A1 = A1 | A2 | A3</code> so the term <code>A1</code> is both a type and a constructor.  Your comment used the term <code>class</code> which means something else in Haskell."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1458834874, "post_id": 36203797, "comment_id": 60042263, "body": "@AlanCoromano You said that the first A1 is the name of the class.  Classes in Haskell are more like interfaces in Java, whereas classes in Java are more like data types in Haskell, although you can&#39;t translate them directly.  I think it might make it more clear if the name of your data type is <code>A</code> to avoid having the same name as any of the constructors of that type (although that is perfectly valid Haskell), that way it&#39;s easy to see which is which in code."}, {"owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1458835104, "post_id": 36203797, "comment_id": 60042414, "body": "@bheklilr, I knowwwwwwwwwwwwww. The name of the class == the name of the &quot;data&quot;."}, {"owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1458835122, "post_id": 36203797, "comment_id": 60042425, "body": "I have plenty of error in your code, any ideas? See my updae."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1458835239, "post_id": 36203797, "comment_id": 60042509, "body": "@AlanCoromano Put <code>{-# LANGUAGE OverloadedStrings #-}</code> before your module declaration.  Aeson doesn&#39;t use the <code>String</code> type very much, most people don&#39;t because it&#39;s very inefficient compared to <code>Data.Text</code> or <code>Data.ByteString</code>.  That language directive will allow your string literals to act as any string-y type."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 1, "creation_date": 1458835583, "post_id": 36203797, "comment_id": 60042746, "body": "@AlanCoromano As for your comment about the name of the class being the name of the data, you should use the proper names for things in the programming language you&#39;re using.  <code>data A</code> and <code>class A</code> have very, very different meanings in Haskell compared to most languages.  <code>data A</code> declares a new concrete data type, like <code>Int</code>, while <code>class</code> declares an interface that can be met by other data types, like <code>Monad</code>, <code>ToJSON</code>, or <code>Num</code>.  They are not interchangeable."}, {"owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1460864152, "post_id": 36203797, "comment_id": 60935765, "body": "why did you call it &quot;tag&quot; in json?"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 3, "last_activity_date": 1458832899, "creation_date": 1458832899, "answer_id": 36203797, "question_id": 36203139, "link": "https://stackoverflow.com/questions/36203139/how-to-create-a-tojson-fromjson-entry-for-an-algebraic-data-type-with-multiple/36203797#36203797", "title": "How to create a ToJSON / FromJSON entry for an algebraic data type with multiple constructors without arguments?", "body": "<p>The <code>toJSON</code> and <code>parseJSON</code> functions take an argument each, the easiest for <code>toJSON</code> is probably:</p>\n\n<pre><code>instance ToJSON A1 where\n    toJSON A1 = object [\"tag\" .= \"A1\"]\n    toJSON A2 = object [\"tag\" .= \"A2\"]\n    toJSON A3 = object [\"tag\" .= \"A3\"]\n</code></pre>\n\n<p>And then you just have to do the reverse in <code>parseJSON</code>:</p>\n\n<pre><code>instance FromJSON A1 where\n    parseJSON (Object o) = do\n        tag &lt;- o .: \"tag\"\n        case tag of\n            \"A1\" -&gt; return A1\n            \"A2\" -&gt; return A2\n            \"A3\" -&gt; return A3\n            _    -&gt; mzero\n</code></pre>\n\n<p>This just extracts the value at the key \"tag\" and then performs pattern matching on the Text returned to determine which constructor to use.</p>\n"}, {"comments": [{"owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 1, "creation_date": 1460864113, "post_id": 36205810, "comment_id": 60935755, "body": "why did you  call it &quot;tag&quot; in json?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "edited": false, "score": 0, "creation_date": 1460865473, "post_id": 36205810, "comment_id": 60935978, "body": "Its a common term.  You are &#39;tagging&#39; the data structure to indicate which of the possible values of the union (sum type) is actually being expressed.  I basically said this in my first comment under your question."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1458838545, "creation_date": 1458838545, "answer_id": 36205810, "question_id": 36203139, "link": "https://stackoverflow.com/questions/36203139/how-to-create-a-tojson-fromjson-entry-for-an-algebraic-data-type-with-multiple/36205810#36205810", "title": "How to create a ToJSON / FromJSON entry for an algebraic data type with multiple constructors without arguments?", "body": "<p>The problems shown in the edit are all about type ambiguities which can be resolved by either using function application to make the types inferrable or adding type annotations.</p>\n\n<ul>\n<li>the right hand side of <code>.=</code> is a string literal so could be <code>String</code> or <code>Text</code> or others - annotate that with <code>::Text</code> or do as I do below and use <code>Text.pack . show</code>.</li>\n<li>The result of <code>.:</code> is polymorphic and the case patterns are all string literals which cause the same problem.  In the below I added <code>:: Text</code> to <code>tag</code>, thus removing the ambiguity.</li>\n</ul>\n\n<p>The complete code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson\nimport Data.Aeson.Types\nimport Control.Monad\nimport Data.Text as Text\n\ndata A1 = A1 | A2 | A3\n  deriving (Eq, Ord, Show)\n\n\ninstance ToJSON A1 where\n    toJSON a  = object [\"tag\" .= Text.pack (show a)]\n\ninstance FromJSON A1 where\n    parseJSON (Object o) = do\n        tag &lt;- o .: \"tag\"\n        case (tag :: Text) of\n            \"A1\" -&gt; return A1\n            \"A2\" -&gt; return A2\n            \"A3\" -&gt; return A3\n            _    -&gt; mzero\n    parseJSON v = typeMismatch \"A1\" v\n</code></pre>\n"}], "owner": {"reputation": 21726, "user_id": 1708058, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4a0b611077fcb9f7ede011fdc46e4d4c?s=128&d=identicon&r=PG", "display_name": "Alan Coromano", "link": "https://stackoverflow.com/users/1708058/alan-coromano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 859, "favorite_count": 0, "accepted_answer_id": 36205810, "answer_count": 2, "score": 1, "last_activity_date": 1458838545, "creation_date": 1458831180, "last_edit_date": 1458835458, "question_id": 36203139, "link": "https://stackoverflow.com/questions/36203139/how-to-create-a-tojson-fromjson-entry-for-an-algebraic-data-type-with-multiple", "title": "How to create a ToJSON / FromJSON entry for an algebraic data type with multiple constructors without arguments?", "body": "<p>Given this data:</p>\n\n<pre><code>data A1 = A1 | A2 | A3\n</code></pre>\n\n<p>How can I create an instance for it?</p>\n\n<pre><code>instance ToJSON A1 where\n  toJSON = ???\n\ninstance FromJSON A1 where\n  parseJSON = ???\n</code></pre>\n\n<p>If it was a single constructor, I'd be able to do that, but I can't figure out how to do that with multiple ones which don't accept any parameters.</p>\n\n<p>UPDATE:\nFor each constructor I have these errors:</p>\n\n<pre><code>my-app/src/Lib.hs:54:32:\n    No instance for (ToJSON a1) arising from a use of \u2018.=\u2019\n    The type variable \u2018a1\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance ToJSON UUID -- Defined in \u2018Data.UUID.Aeson\u2019\n      instance ToJSON MyType -- Defined at src/Lib.hs:53:10\n      instance ToJSON MyType2 -- Defined at src/Lib.hs:70:10\n    In the expression: \"tag\" .= \"A1\"\n    In the first argument of \u2018object\u2019, namely \u2018[\"tag\" .= \"A1\"]\u2019\n    In the expression: object [\"tag\" .= \"A1\"]\n\nmy-app/src/Lib.hs:54:35:\n    No instance for (Data.String.IsString a1)\n      arising from the literal \u2018\"A1\"\u2019\n    The type variable \u2018a1\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Data.String.IsString Value\n        -- Defined in \u2018aeson-0.9.0.1:Data.Aeson.Types.Internal\u2019\n      instance (a\n                ~ bytestring-0.10.6.0:Data.ByteString.Internal.ByteString) =&gt;\n               Data.String.IsString\n                 (attoparsec-0.13.0.1:Data.Attoparsec.ByteString.Internal.Parser a)\n        -- Defined in \u2018attoparsec-0.13.0.1:Data.Attoparsec.ByteString.Char8\u2019\n      instance Data.String.IsString\n                 bytestring-0.10.6.0:Data.ByteString.Builder.Internal.Builder\n        -- Defined in \u2018bytestring-0.10.6.0:Data.ByteString.Builder\u2019\n      ...plus 13 others\n    In the second argument of \u2018(.=)\u2019, namely \u2018\"A1\"\u2019\n    In the expression: \"tag\" .= \"A1\"\n    In the first argument of \u2018object\u2019, namely \u2018[\"tag\" .= \"A1\"]\u2019\n</code></pre>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5591265"}, "edited": false, "score": 0, "creation_date": 1458824929, "post_id": 36200942, "comment_id": 60035198, "body": "Is there any other way without using pattern matching"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1458824966, "last_edit_date": 1458824966, "creation_date": 1458824811, "answer_id": 36200942, "question_id": 36200856, "link": "https://stackoverflow.com/questions/36200856/a-new-data-type-element-access-in-haskell/36200942#36200942", "title": "A new data type element access in Haskell", "body": "<p>Just use pattern matching:</p>\n\n<pre><code>accreal:: User -&gt; RealName\naccreal (User un rn uns ps) = rn\n</code></pre>\n\n<p>You might also want to prefix unused variables with <code>_</code> to suppress warnings.</p>\n\n<pre><code>accreal:: User -&gt; RealName\naccreal (User _un rn _uns _ps) = rn\n</code></pre>\n\n<p>You can also simply use <code>_</code> to discard a value, e.g. <code>accreal (User _ rn _  _) = rn</code>.</p>\n\n<p>Alternatively, change your <code>data</code> type into a record:</p>\n\n<pre><code>data User = User \n   { user :: UserName\n   , real :: RealName\n   , others :: [UserName]\n   , posts :: [Post] }\n</code></pre>\n\n<p>This automatically defines a projection <code>real :: User -&gt; RealName</code> for you.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5591265"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 1, "accepted_answer_id": 36200942, "answer_count": 1, "score": 1, "last_activity_date": 1458825175, "creation_date": 1458824567, "last_edit_date": 1458825175, "question_id": 36200856, "link": "https://stackoverflow.com/questions/36200856/a-new-data-type-element-access-in-haskell", "title": "A new data type element access in Haskell", "body": "<p>I am new with haskell.\nI have new types: </p>\n\n<pre><code>type RealName = String\ntype UserName = String\ntype GroupName = String\ntype Message = String\n</code></pre>\n\n<p>and </p>\n\n<pre><code>data User = User UserName RealName [UserName] [Post]\n</code></pre>\n\n<p>and in a new function I want to access the real name of a user;</p>\n\n<pre><code>accreal :: User -&gt; RealName\naccreal us = ??\n</code></pre>\n\n<p>How can I do it, I tried many ways but didnt work.</p>\n"}, {"tags": ["haskell", "function-composition"], "answers": [{"tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": false, "score": 9, "last_activity_date": 1458824210, "last_edit_date": 1458824210, "creation_date": 1458823795, "answer_id": 36200641, "question_id": 36200374, "link": "https://stackoverflow.com/questions/36200374/puzzling-function-composition/36200641#36200641", "title": "Puzzling function composition", "body": "<pre><code>f :: [a-&gt;a] -&gt; a -&gt; a\nf = foldr (.) id\n</code></pre>\n\n<p>This takes list of functions and compose them together</p>\n\n<p>for example</p>\n\n<pre><code>foldr (.) id [(+1),(+2)] == ((+1) . ((+2) . id)) == (+3)\n</code></pre>\n\n<p>Function application has higest fixity and map is made last</p>\n\n<pre><code>map . foldr (.) id == \\x -&gt; map ( foldr (.) id x )\n</code></pre>\n\n<p>It maps <code>foldr (.) id</code> over list (2nd argument) after first argument (list of functions) is applied</p>\n"}], "owner": {"reputation": 3, "user_id": 3101684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcb41bd38c0e3a8ec12a1d609738ff7f?s=128&d=identicon&r=PG&f=1", "display_name": "Harris Dong", "link": "https://stackoverflow.com/users/3101684/harris-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1458841662, "creation_date": 1458822958, "last_edit_date": 1458841662, "question_id": 36200374, "link": "https://stackoverflow.com/questions/36200374/puzzling-function-composition", "title": "Puzzling function composition", "body": "<p>How can I make sense of function composition in the following expression?</p>\n\n<pre><code>map . foldr (.) id :: [b -&gt; b] -&gt; [b] -&gt; [b]\n</code></pre>\n"}, {"tags": ["list", "haskell", "take", "function-definition"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5818725"}, "edited": false, "score": 0, "creation_date": 1458835827, "post_id": 36199782, "comment_id": 60042919, "body": "I&#39;m sorry I still don&#39;t understand, in your example of [1,2,3] you drop 1 from the list first and then take 1 from that list. I&#39;m not understanding how that works. Does that you mean litrally taking the number 1 element from the list or any single element from the list? Also on the line == take 1 [2,3] why is the result just 2?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5818725"}, "edited": false, "score": 0, "creation_date": 1458836108, "post_id": 36199782, "comment_id": 60043113, "body": "Also could I have a more detailed explanation on this sentance &quot;The second part drops the first n elements and takes the following n elements.&quot; It&#39;s really confusing me."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1458839837, "post_id": 36199782, "comment_id": 60045548, "body": "@GR412 <code>take 1</code> is a function that takes one element from the front, not the element <code>1</code>! Consider <code>take 2 [&#39;a&#39;, &#39;b&#39;, &#39;c] == [&#39;a&#39;, &#39;b&#39;]</code>. Thus the sentence simply means that the <code>take</code> in that case is called on a list that you get when you take the original list and drop <code>n</code> first elements from it. However, the remaining &quot;tail&quot; has 2n elements, the second 1/3 and the third 1/3, so by taking only n you get the actual middle part."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 6, "last_activity_date": 1458821134, "creation_date": 1458821134, "answer_id": 36199782, "question_id": 36199659, "link": "https://stackoverflow.com/questions/36199659/haskell-use-of-take-and-drop-to-split-a-list-into-three-parts/36199782#36199782", "title": "Haskell - Use of Take and Drop to split a list into three parts", "body": "<p>The second part drops the first <code>n</code> elements and takes the following <code>n</code> elements.</p>\n\n<pre><code>[------- n -------][------- n -------][------- n -------]\n^                  ^\ndropped            taken by `take`    ^ dropped by `take`\n</code></pre>\n\n<p>A concrete example could be a list of <code>[1,2,3]</code>, <code>n == 1</code>.</p>\n\n<pre><code>take n (drop n xs)\n== take 1 (drop 1 [1,2,3])\n== take 1 [2,3]\n== 2\n</code></pre>\n\n<hr>\n\n<p>The third part drops twice <code>n</code> and takes the rest</p>\n\n<pre><code>[----             2n            -----][---- n -----]\n^                                     ^\ndropped                               taken by `drop`\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5818725"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3187, "favorite_count": 0, "accepted_answer_id": 36199782, "answer_count": 1, "score": 2, "last_activity_date": 1458821134, "creation_date": 1458820783, "question_id": 36199659, "link": "https://stackoverflow.com/questions/36199659/haskell-use-of-take-and-drop-to-split-a-list-into-three-parts", "title": "Haskell - Use of Take and Drop to split a list into three parts", "body": "<p>So I've came across this function definition that takes a list (xs) and splits it into three parts as an output. </p>\n\n<p>The thing is I'm having difficulty understanding it. I understand the first part which takes n of the list (xs) where n is defined as dividing the length of the list (xs) by 3. But after that I'm not sure entirly sure whats going on.</p>\n\n<p>If anyone could walk me through this function that would be great.</p>\n\n<p>Here is the code: </p>\n\n<pre><code>--SPLITS A LIST INTO THREE PARTS---------------------------------------------------------\n\nsplit3 xs = (take n xs , take n (drop n xs) , drop (n*2) xs)\n    where n = length xs `div` 3\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "type-constraints", "type-families"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1458822480, "post_id": 36197795, "comment_id": 60033643, "body": "I can&#39;t reproduce this: <code>:t frames (undefined :: Conf m) &amp; view focus</code> is correctly resolved to <code>Set m</code> in ghci."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1463125341, "post_id": 36197795, "comment_id": 61939787, "body": "I have simplified the problem and moved the example to <a href=\"https://github.com/jakubdaniel/test\" rel=\"nofollow noreferrer\">github.com/jakubdaniel/test</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 0, "last_activity_date": 1463406806, "creation_date": 1463406806, "answer_id": 37255621, "question_id": 36197795, "link": "https://stackoverflow.com/questions/36197795/missing-instance-of-monadreader/37255621#37255621", "title": "Missing instance of MonadReader", "body": "<p>I still do not know why this problem arises. But with the kind help of a user <code>puregreen</code> over on <code>#haskell</code> irc channel I was able to overcome this problem in this setting by simply replacing <code>view focus</code> with <code>(^. focus)</code>.</p>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 1, "accepted_answer_id": 37255621, "answer_count": 1, "score": 1, "last_activity_date": 1463406806, "creation_date": 1458814698, "last_edit_date": 1463144926, "question_id": 36197795, "link": "https://stackoverflow.com/questions/36197795/missing-instance-of-monadreader", "title": "Missing instance of MonadReader", "body": "<p>The code available from <a href=\"https://github.com/jakubdaniel/test\" rel=\"nofollow\">github</a>:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies\n           , TypeOperators #-}\n\nmodule Test where\n\nimport Control.Monad.Reader\n\nimport Control.Lens\nimport Control.Zipper\n\nclass Monad f =&gt; Family f where\n    type Set f\n\n-- This does not work\nf :: Family f =&gt; (Top :&gt;&gt; [Set f] :&gt;&gt; Set f) -&gt; f (Set f)\nf = return . view focus\n\n-- This here works\ng :: Top :&gt;&gt; [Int] :&gt;&gt; Int -&gt; Int\ng = view focus\n</code></pre>\n\n<p>compiles fine with <code>ghc-8</code> but fails to compile with <code>ghc-7.10</code> with the error</p>\n\n<pre><code>Test.hs:16:14:\nCould not deduce (MonadReader\n                    (Zipper (Top :&gt;&gt; [Set f]) Int (Set f))\n                    ((-&gt;) ((Top :&gt;&gt; [Set f]) :&gt;&gt; Set f)))\n  arising from a use of `view'\nfrom the context (Family f)\n  bound by the type signature for\n             f :: Family f =&gt; (Top :&gt;&gt; [Set f]) :&gt;&gt; Set f -&gt; f (Set f)\n  at Test.hs:15:6-57\nIn the second argument of `(.)', namely `view focus'\nIn the expression: return . view focus\nIn an equation for `f': f = return . view focus\n</code></pre>\n\n<p>in both cases exactly the same dependencies are used (<code>mtl 2.2.1</code>, <code>transformers 0.5.2</code>, <code>lens 4.14</code>, <code>zippers 0.2</code>) except <code>base</code> which can only be <code>4.8</code> for <code>ghc-7.10</code> and <code>4.9</code> for <code>ghc-8</code>. I really cannot figure out why it should compile with one compiler and not the other. I would like to make the code work for <code>ghc-7.10</code> as well.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1458812910, "post_id": 36197044, "comment_id": 60027869, "body": "see <a href=\"https://en.wikipedia.org/wiki/Turing_completeness\" rel=\"nofollow noreferrer\">Truing completeness</a> (I guess) - also way to broad sorry"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1458812915, "post_id": 36197044, "comment_id": 60027874, "body": "There is no single fixed feature which <i>must</i> be present for a language to be Turing complete. Name your feature -- short of &quot;Turing completeness&quot; -- and I bet I can design you a Turing-complete language that does not have that feature. Given this, naming a set of features all of which must be present seems hopeless; and coming up with a short description of sets of features that result in Turing completeness doubly so."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1458813292, "post_id": 36197044, "comment_id": 60028107, "body": "@DanielWagner Well, it probably depends on what you mean by &quot;feature&quot;. For example if non-termination is a feature then I bet that doesn&#39;t exist a single Turing-complete system without that &quot;feature&quot;, in some way."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1458813084, "creation_date": 1458813084, "answer_id": 36197265, "question_id": 36197044, "link": "https://stackoverflow.com/questions/36197044/programming-language-features/36197265#36197265", "title": "Programming language features", "body": "<p>Haskell is Turing complete.</p>\n\n<p>My current beliefs have high weight on the outcome that any sound and complete description of \"feature sets that guarantee Turing completeness\" is either infinite or includes a non-terminating algorithm; so I believe it is not reasonable to expect an answer to your other question.</p>\n"}], "owner": {"reputation": 1, "user_id": 5393470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a40159802507f3f52c37216419d5aa23?s=128&d=identicon&r=PG&f=1", "display_name": "Pan", "link": "https://stackoverflow.com/users/5393470/pan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "closed_date": 1458813608, "answer_count": 1, "score": -4, "last_activity_date": 1458813084, "creation_date": 1458812391, "question_id": 36197044, "link": "https://stackoverflow.com/questions/36197044/programming-language-features", "closed_reason": "Needs more focus", "title": "Programming language features", "body": "<p>Which features need to be present in a programming language such that it can  express any sequential computation which a computer can excute today? And what if the language is Haskell in specific</p>\n"}, {"tags": ["macos", "haskell", "ghci"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 3, "creation_date": 1458811005, "post_id": 36196255, "comment_id": 60026909, "body": "Nope, it&#39;s in the <a href=\"https://hackage.haskell.org/package/memoize-0.7\" rel=\"nofollow noreferrer\">memoize</a> package."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1458813024, "post_id": 36196255, "comment_id": 60027943, "body": "in cases like this <a href=\"http://hayoo.fh-wedel.de/?query=memoize2\" rel=\"nofollow noreferrer\">Hayoo</a> is your friend (Hoogle will not find it)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1458813588, "post_id": 36196255, "comment_id": 60028260, "body": "Strictly speaking haskell 98 doesn&#39;t even support hierarchical names, so any module which uses a dotted name on import cannot be part of the Haksell98 stdlib because it <i>isn&#39;t</i> valid Haskell98. Moreover the stdlib is really small, see <a href=\"https://www.haskell.org/onlinereport/\" rel=\"nofollow noreferrer\">the report</a>... it has 16 modules only.  Haskell 2010 supports hierarchical names, as you can see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellpa2.html#x20-192000II\" rel=\"nofollow noreferrer\">here</a> but it&#39;s stdlib is still extremely small (30 modules)."}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1458809580, "creation_date": 1458809580, "question_id": 36196255, "link": "https://stackoverflow.com/questions/36196255/data-function-memoize-missing-from-ghci-on-mac", "title": "Data.Function.Memoize missing from ghci on mac?", "body": "<p>I'm trying to import memoize2 in ghci on my mac:</p>\n\n<pre><code>Prelude Data.Function&gt; import Data.Function.Memoize (memoize2)\n\n&lt;no location info&gt;:\n    Could not find module \u2018Data.Function.Memoize\u2019\n    It is not a module in the current program, or in any known package.\n</code></pre>\n\n<p>This is my ghci version, latest available on brew.</p>\n\n<pre><code>$ ghci --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.3\n</code></pre>\n\n<p>The memoization library seems to be in the <code>Haskell98</code> stdlib.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1458812267, "post_id": 36196207, "comment_id": 60027532, "body": "This is indeed a problem, and has historically led to a bit of fragmentation. <a href=\"https://hackage.haskell.org/package/either-4.4.1/docs/Control-Monad-Trans-Either.html#t:EitherT\" rel=\"nofollow noreferrer\"><code>EitherT</code></a>, <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Error.html#t:ErrorT\" rel=\"nofollow noreferrer\"><code>ErrorT</code></a>, and <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Except.html#t:ExceptT\" rel=\"nofollow noreferrer\"><code>ExceptT</code></a> all represent subtly different points in the space of solutions that you might want to explore."}], "answers": [{"comments": [{"owner": {"reputation": 10218, "user_id": 1684670, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0de21f6ec42b67830c9308664e0abf72?s=128&d=identicon&r=PG", "display_name": "thkang", "link": "https://stackoverflow.com/users/1684670/thkang"}, "edited": false, "score": 0, "creation_date": 1458813278, "post_id": 36196545, "comment_id": 60028098, "body": "so I should introduce some error-reporting protocol (such as <code>throwError</code> in case of <code>mtl</code>)  for errors, and leave <code>fail = error</code> (the default implementation in haskell)?"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1458810665, "creation_date": 1458810665, "answer_id": 36196545, "question_id": 36196207, "link": "https://stackoverflow.com/questions/36196207/can-fail-take-non-string-argument/36196545#36196545", "title": "Can fail take non-String argument?", "body": "<p><a href=\"https://hackage.haskell.org/package/either-4.4.1/docs/Control-Monad-Trans-Either.html\" rel=\"nofollow\"><code>EitherT</code></a> is also an instance of <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Error-Class.html#t:MonadError\" rel=\"nofollow\"><code>MonadError</code></a>, giving you <code>throwError :: e -&gt; EitherT e m a</code>. If you are implementing your own <code>EitherT</code> for educational reasons, you can look up <code>MonadError</code> at the link above and figure out how to make your own <code>ErrorT</code> type also an instance of that.</p>\n\n<p><code>fail</code> is generally considered a poor interface, because a, it is tied to <code>String</code> as you noticed and b, because it is in <code>Monad</code>, forcing monads to implement it even when it doesn't make sense. </p>\n"}, {"tags": [], "owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "is_accepted": false, "score": 0, "last_activity_date": 1458823945, "creation_date": 1458823945, "answer_id": 36200683, "question_id": 36196207, "link": "https://stackoverflow.com/questions/36196207/can-fail-take-non-string-argument/36200683#36200683", "title": "Can fail take non-String argument?", "body": "<p>If you want to use <code>fail</code> in that way, you can define the monad as <code>EitherT String m</code>:</p>\n\n<pre><code>instance (Monad m) =&gt; Monad (EitherT String m) where\n    -- ...\n</code></pre>\n\n<p>This is not as useless as it looks, since errors are usually strings anyway.</p>\n\n<p>The benefit of doing it this way is that you can handle pattern match failures. This could be handy if you want to (for example) call an action that needs to return <code>Just</code></p>\n\n<pre><code>do\n    Just a &lt;- lift getTheThing\n    lift (print a)\n</code></pre>\n\n<p>The downside is you get a less-than-useful error message <code>\"pattern match failure in ...\"</code> rather than something like <code>\"couldn't get the thing, try restarting the server\"</code>.</p>\n\n<p>If you just want to have something to call manually on failure though, use <code>throwError</code> like Cactus suggests.</p>\n"}], "owner": {"reputation": 10218, "user_id": 1684670, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0de21f6ec42b67830c9308664e0abf72?s=128&d=identicon&r=PG", "display_name": "thkang", "link": "https://stackoverflow.com/users/1684670/thkang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 1, "accepted_answer_id": 36196545, "answer_count": 2, "score": 1, "last_activity_date": 1458823945, "creation_date": 1458809415, "last_edit_date": 1458810689, "question_id": 36196207, "link": "https://stackoverflow.com/questions/36196207/can-fail-take-non-string-argument", "title": "Can fail take non-String argument?", "body": "<p>I was trying to write <a href=\"http://book.realworldhaskell.org/read/monad-transformers.html#x_fu\" rel=\"nofollow\">some <code>EitherT</code> monad transformer, as suggested from real world haskell chapter 18</a>.</p>\n\n<pre><code>newtype EitherT e m a = EitherT {\n    runEitherT :: m (Either e a) \n}\n</code></pre>\n\n<p>my <code>EitherT</code> will have <code>Left error</code> and <code>Right result</code> for its <code>Either</code> type, and will bind all computation that yields <code>Right</code> values while stopping at <code>left</code> values, keeping them as error.</p>\n\n<p>my code is below(sorry for the imperative style):</p>\n\n<pre><code>bindET :: (Monad m) =&gt; (EitherT e m a) -&gt; (a -&gt; EitherT e m b) -&gt; (EitherT e m b)\nx `bindET` f = EitherT $ do\n    mx &lt;- runEitherT x\n    case mx of\n        Right success -&gt; runEitherT (f success)\n        Left error -&gt; return (Left error)\n\n\ninstance (Monad m) =&gt; Monad (EitherT e m) where\n    return a = EitherT $ return (Right a)\n    (&gt;&gt;=) = bindET\n    fail e = EitherT $ return (Left e)\n</code></pre>\n\n<p>I thought writing <code>Monad</code> instances for <code>EitherT</code> transformer was quite simple, however I get this cryptic error message when I load the code into ghci:</p>\n\n<pre><code>EitherT.hs:30:18:\n    Could not deduce (e ~ [Char])\n    from the context (Monad m)\n      bound by the instance declaration at EitherT.hs:27:10-41\n      `e' is a rigid type variable bound by\n          the instance declaration at EitherT.hs:27:10\n    Expected type: EitherT e m a\n      Actual type: EitherT String m a\n    In the expression: EitherT $ return (Left e)\n    In an equation for `fail': fail e = EitherT $ return (Left e)\n    In the instance declaration for `Monad (EitherT e m)'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>it seems <code>fail</code> function is fixed to take <code>String</code> as an argument - well, if that's the case then my <code>EitherT e m a</code> will be <code>EitherT String m a</code> and all the <code>Left</code> values will be <code>Left String</code>. but I want <code>EitherT</code> monad to take any types of value as <code>Left</code> to indicate errors in computation. How can I achieve that?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 167922, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1458792290, "post_id": 36193079, "comment_id": 60020497, "body": "<a href=\"http://math.stackexchange.com/questions/523906/show-that-function-compositions-are-associative\" title=\"show that function compositions are associative\">math.stackexchange.com/questions/523906/&hellip;</a>"}, {"owner": {"reputation": 167922, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1458792584, "post_id": 36193079, "comment_id": 60020572, "body": "With <code>comp f g x = f (g x)</code>, <code>f `comp` g</code> is same as <code>f.g</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1458797442, "post_id": 36193079, "comment_id": 60021696, "body": "You can click the &quot;<a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/src/GHC.Base.html#.\" rel=\"nofollow noreferrer\">Source</a>&quot; link next to <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Prelude.html#v:.\" rel=\"nofollow noreferrer\">the documentation for <code>(.)</code></a> to see how it&#39;s implemented."}], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 4, "last_activity_date": 1458792694, "creation_date": 1458792694, "answer_id": 36193164, "question_id": 36193079, "link": "https://stackoverflow.com/questions/36193079/how-to-prove-the-associative-law-of-the-compositon-operation-in-haskell/36193164#36193164", "title": "how to prove the associative law of the compositon operation (.) in Haskell", "body": "<p>You can define the composition operator yourself as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\ng . f = \\x -&gt; g (f x)\n</code></pre>\n\n<p>Now, to prove associativity:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>lhs = h . (g . f)\n    = \\x -&gt; h ((g . f) x)         -- substitution\n    = \\x -&gt; h ((\\y -&gt; g (f y)) x) -- substitution\n    = \\x -&gt; h (g (f x))           -- beta reduction\n\nrhs = (h . g) . f\n    = \\x -&gt; (h . g) (f x)         -- substitution\n    = \\x -&gt; (\\y -&gt; h (g y)) (f x) -- substitution\n    = \\x -&gt; h (g (f x))           -- beta reduction\n</code></pre>\n\n<p>Now, we have <code>lhs = rhs</code>. QED.</p>\n"}], "owner": {"reputation": 23, "user_id": 6071571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/461f8bbb1a9bc0b94ab6506a0432046a?s=128&d=identicon&r=PG&f=1", "display_name": "ren", "link": "https://stackoverflow.com/users/6071571/ren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "accepted_answer_id": 36193164, "answer_count": 1, "score": 2, "last_activity_date": 1458792694, "creation_date": 1458792168, "question_id": 36193079, "link": "https://stackoverflow.com/questions/36193079/how-to-prove-the-associative-law-of-the-compositon-operation-in-haskell", "title": "how to prove the associative law of the compositon operation (.) in Haskell", "body": "<p>say ,</p>\n\n<pre><code>    f :: a -&gt; b \n    g :: b -&gt; c \n    h :: c -&gt; d\n</code></pre>\n\n<p>why the equation </p>\n\n<pre><code>    h.(g.f) = (h.g).f  \n</code></pre>\n\n<p>is right?\nhow to prove it?\nand the composition operation is just a basic operation in Haskell,\nor we can get one by ourselves? if so how to achieve it?</p>\n"}, {"tags": ["debugging", "haskell", "runtime-error", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1458797795, "creation_date": 1458797795, "answer_id": 36193885, "question_id": 36192503, "link": "https://stackoverflow.com/questions/36192503/haskell-ghci-cant-seem-to-enter-interactive-execution-of-main-module/36193885#36193885", "title": "Haskell GHCI, can&#39;t seem to enter interactive execution of Main module", "body": "<p>The former line means you are loading the file in compiled mode. You can fix this by making sure that there is no compiled version of the file around; or you can tell ghci to use interpreted mode by prepending a <code>*</code> when loading the file:</p>\n\n<pre><code>Prelude Main&gt; :l *Main\n*Main&gt;\n</code></pre>\n\n<p>(Or run <code>ghci '*Main.hs'</code> -- adapted to your shell's escaping needs as appropriate.)</p>\n"}], "owner": {"reputation": 149, "user_id": 3760933, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Ck4aM.png?s=128&g=1", "display_name": "cephalopodMD", "link": "https://stackoverflow.com/users/3760933/cephalopodmd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 1, "accepted_answer_id": 36193885, "answer_count": 1, "score": 2, "last_activity_date": 1458797905, "creation_date": 1458788164, "last_edit_date": 1458797905, "question_id": 36192503, "link": "https://stackoverflow.com/questions/36192503/haskell-ghci-cant-seem-to-enter-interactive-execution-of-main-module", "title": "Haskell GHCI, can&#39;t seem to enter interactive execution of Main module", "body": "<p>I need to debug some haskell code and figure out where an issue is occuring at runtime. When I run my program is says this</p>\n\n<pre><code>main: Prelude.(!!): index too large\n</code></pre>\n\n<p>which leads me to believe that there is a place I'm sending a list to a function that I really shouldn't be, and I don't know where. This is a 600+ line semantic analysis program. Trouble is, I can't for the life of me figure out where this !! error is. The debugging documentation is really confusing, and I can't get GHCI to cooperate so I can maybe figure this out. Whenever I run <code>ghci main.hs</code>, this happens:</p>\n\n<pre><code>GHCi, version 7.6.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nOk, modules loaded: Main.\nPrelude Main&gt;\n</code></pre>\n\n<p>I cannot seem to get it to turn to </p>\n\n<pre><code>*Main&gt;\n</code></pre>\n\n<p>so that I can actually set breakpoints and all that fun stuff. How do I get this to work?</p>\n"}]