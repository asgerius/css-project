[{"tags": ["haskell", "types", "message-queue", "data-kinds"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476306338, "post_id": 40008261, "comment_id": 67294748, "body": "Is there a reason you need a parameterized <code>Queue</code> type, instead of two distinct types <code>newtype DirectQueue = DQ Text</code> and <code>newtype TopicQueue = TQ [Text]</code>?"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476307052, "post_id": 40008261, "comment_id": 67295156, "body": "@chepner - They have a lot in common with each other. I took out the extra info to simplify the problem. I&#39;ll add it back in to the example to demonstrate."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476307178, "post_id": 40008261, "comment_id": 67295222, "body": "I added back in a <code>Name</code> for the queues to show that they have information in common. In my real application, there are several functions that should work with any queue, and a Queue has two non-distinct fields in addition to queue type."}, {"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1476317448, "post_id": 40008261, "comment_id": 67298606, "body": "Have a read of this, it is similar to your question: <a href=\"http://stackoverflow.com/questions/39531032/using-types-to-force-correctness\" title=\"using types to force correctness\">stackoverflow.com/questions/39531032/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476308405, "post_id": 40008728, "comment_id": 67295772, "body": "This is great. I was definitely overthinking it. Thanks!"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476308671, "post_id": 40008728, "comment_id": 67295893, "body": "This is a good talk on how adding a type parameter to another type can be useful <a href=\"https://www.youtube.com/watch?v=BHjIl81HgfE\" rel=\"nofollow noreferrer\">youtube.com/watch?v=BHjIl81HgfE</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 6, "last_activity_date": 1476308897, "last_edit_date": 1476308897, "creation_date": 1476308017, "answer_id": 40008728, "question_id": 40008261, "link": "https://stackoverflow.com/questions/40008261/functions-that-only-work-with-one-constructor-of-a-type/40008728#40008728", "title": "Functions that only work with one constructor of a type", "body": "<p>How about making <code>Queue</code> a plain polymorphic type</p>\n\n<pre><code>data Queue a = Queue Name a\n</code></pre>\n\n<p>And then defining separate <code>Queue DirectKey</code> and <code>Queue TopicKey</code> types? Then you wouldn't need to pattern-match in <code>publish :: Queue DirectKey -&gt; IO ()</code>.</p>\n\n<p>If, apart from that, you need functions that should work in any <code>Queue</code>, perhaps you could define some common operations in a typeclass of which <code>DirectKey</code> and <code>TopicKey</code> would be instances, and then have signatures like</p>\n\n<pre><code>commonFunction :: MyTypeclass a =&gt; Queue a -&gt; IO ()\n</code></pre>\n\n<p>Maybe you could put such functions directly in the typeclass</p>\n\n<pre><code>class MyTypeclass a where\n    commonFunction :: Queue a -&gt; IO ()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1476323303, "post_id": 40010703, "comment_id": 67299938, "body": "I think <code>PolyKinds</code> is rather more than necessary. <code>KindSignatures</code> should be sufficient."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1476330801, "post_id": 40010703, "comment_id": 67301803, "body": "@dfeuer The OP&#39;s code as written has a kind variable <code>a</code> in the kind of <code>kind :: a -&gt; QueueType</code>. My system (ghc 8.0.1) certainly won&#39;t accept it with <code>KindSignatures</code> and no <code>PolyKinds</code>."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 3, "last_activity_date": 1476320747, "creation_date": 1476320747, "answer_id": 40010703, "question_id": 40008261, "link": "https://stackoverflow.com/questions/40008261/functions-that-only-work-with-one-constructor-of-a-type/40010703#40010703", "title": "Functions that only work with one constructor of a type", "body": "<p>Your code doesn't compile as-is (it requires <code>PolyKinds</code> to be turned on as well) so I don't know if it's only an accident, but it looks like you were trying to go for the approach where you know from the type of a queue which constructors could be involved, and so can statically guarantee that a function can only be called on a certain kind of queue.</p>\n\n<p>You can in fact get that approach to work, using multiple constructors of a GADT (as opposed to using multiple completely separate types, with a type class to bring them together when necessary, in teh approach suggested in @danidiaz' answer).</p>\n\n<p>But first why your current code doesn't work. In your queue type:</p>\n\n<pre><code>data Queue (kind :: a -&gt; QueueType)\n  = Queue Name QueueType\n</code></pre>\n\n<p>you're parameterising the <code>Queue</code> type by a type variable (called <code>kind</code>), allowing you to tag a <code>Queue</code> at the type level by what kind of <code>QueueType</code> you want to be in it. But only constructor <code>Queue Name QueueType</code> makes no reference to <code>kind</code> at all; it's a phantom type. That <code>QueueType</code> slot can be filled by any valid queue type regardless of what <code>kind</code> is in the <code>Queue kind</code> type of the queue.</p>\n\n<p>This means that GHC was correct in wanting you to add a case to <code>publish</code> that would match a topic key inside a <code>Queue 'Direct</code>; your data type definition says that such values can exist.</p>\n\n<p>What GADTs allow you to do is to explicitly declare the full type of each constructor separately, <em>including the return type</em>. So you can set up a relation between the type of the value you're constructing and the constructors (or their parameters) that could possibly be used to make a value of that type.</p>\n\n<p>In concrete terms, we can make a type for your queues such that <code>Queue 'Direct</code> can <em>only</em> contain a direct queue type, and <code>Queue 'Topic</code> can <em>only</em> contain a topic queue type, and you can handle either by polymorphically accepting a <code>Queue a</code>.</p>\n\n<p>It's simplest to make <code>QueueType</code> <em>just</em> be used for the tag, and have a separate GADT storing the data. In your original code you were able to reuse the data-holding constructors lifted to the type level and unapplied, but that makes your kind signatures unnecessarily complicated (bringing in the need for <code>PolyKinds</code>), and if you need to add more (and different numbers of!) parameters to the data constructors it will become increasingly difficult to shoehorn their unapplied types to fit the same kind when lifted to type level. So:</p>\n\n<pre><code>data QueueType\n  = Direct\n  | Topic\n\ndata QueueData (a :: QueueType)\n  where DirectData :: DirectKey -&gt; QueueData 'Direct\n        TopicData :: TopicKey -&gt; QueueData 'Topic\n</code></pre>\n\n<p>So we've got <code>QueueType</code> just to lift with <code>DataKinds</code> (there's often no need to ever actually use such a type at the value level). Then we've got the type <code>QueueData</code> parametersised by a type-level <code>QueueType</code>. One constructor takes a <code>DirectKey</code> and constructs a <code>QueueData 'Direct</code>, the other takes a <code>TopicKey</code> and constructs a <code>QueueData 'Topic</code>.</p>\n\n<p>Then it's simple to have a <code>Queue</code> type that similarly is tagged with \nthe type of queue being represented:</p>\n\n<pre><code>data Queue (a :: QueueType)\n  = Queue Name (QueueData a)\n</code></pre>\n\n<p>Now if a function works on any queue (say because it only needs access to the name outside of the <code>QueueData</code>), it can take a <code>Queue a</code>:</p>\n\n<pre><code>getName :: Queue a -&gt; Text\ngetName (Queue name _) = name\n</code></pre>\n\n<p>You can also take a <code>Queue a</code> if you can explicitly handle all cases, and you'll get warnings when you miss a case:</p>\n\n<pre><code>getKeyText :: Queue a -&gt; Text\ngetKeyText (Queue _ (DirectData key)) = key\ngetKeyText (Queue _ (TopicData keys)) = mconcat keys\n</code></pre>\n\n<p>And finally, when taking a <code>Queue 'Direct</code> as in your <code>publish</code> function, GHC knows that <code>DirectData</code> is the only possible constructor for the <code>QueueData</code>. So you don't need to add an error case as in the OP, and it would in fact be detected as a type error if you tried to handle a <code>TopicData</code> inside there.</p>\n\n<p>Full example:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures #-}\n\nimport Data.Text (Text)\n\ntype Name = Text\ntype DirectKey = Text\ntype TopicKey = [Text]\n\ndata QueueType\n  = Direct\n  | Topic\n\ndata QueueData (a :: QueueType)\n  where DirectData :: DirectKey -&gt; QueueData 'Direct\n        TopicData :: TopicKey -&gt; QueueData 'Topic\n\ndata Queue (a :: QueueType)\n  = Queue Name (QueueData a)\n\n\ngetName :: Queue a -&gt; Text\ngetName (Queue name _) = name\n\ngetKeyText :: Queue a -&gt; Text\ngetKeyText (Queue _ (DirectData key)) = key\ngetKeyText (Queue _ (TopicData keys)) = mconcat keys\n\npublish :: Queue 'Direct -&gt; IO ()\npublish (Queue name (DirectData key))\n  = doSomething name key\n  where doSomething = undefined\n</code></pre>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 1, "accepted_answer_id": 40008728, "answer_count": 2, "score": 6, "last_activity_date": 1476320747, "creation_date": 1476306034, "last_edit_date": 1476307085, "question_id": 40008261, "link": "https://stackoverflow.com/questions/40008261/functions-that-only-work-with-one-constructor-of-a-type", "title": "Functions that only work with one constructor of a type", "body": "<p>I'm writing a lib for message queues. Queues can be either <code>Direct</code> or <code>Topic</code>. <code>Direct</code> queues have a static binding key, while <code>Topic</code> queues can have dynamic ones. </p>\n\n<p>I want to write a function <code>publish</code> that only works on <code>Direct</code> queues. This works:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\ntype Name = Text\ntype DirectKey = Text\ntype TopicKey = [Text]\n\ndata QueueType\n  = Direct DirectKey\n  | Topic TopicKey\n\ndata Queue (kind :: a -&gt; QueueType)\n  = Queue Name QueueType\n</code></pre>\n\n<p>This requires two separate constructors</p>\n\n<pre><code>directQueue :: Name -&gt; DirectKey -&gt; Queue 'Direct\n\ntopicQueue :: Name -&gt; TopicKey -&gt; Queue 'Topic\n</code></pre>\n\n<p>But when I go to write publish, there's an extra pattern that I need to match which should be impossible</p>\n\n<pre><code>publish :: Queue 'Direct -&gt; IO ()\npublish (Queue name (Direct key)) =\n   doSomething name key\npublish _ =\n   error \"should be impossible to get here\"\n</code></pre>\n\n<p>Is there a better way to model this problem so that I don't need that pattern match? <code>Direct</code> queues should always have that <code>Text</code> metadata, and <code>Topic</code> queues should always have that <code>[Text]</code> metadata. Is there a better way to enforce this at both the type and value level?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476305762, "post_id": 40008022, "comment_id": 67294410, "body": "Isn&#39;t <code>liftBase</code> all you need instead of <code>liftIO</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476306104, "post_id": 40008222, "comment_id": 67294602, "body": "Thanks! I didn&#39;t realize it was a superclass, I thought it was a separate effort. Thanks!"}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 4, "last_activity_date": 1476305863, "creation_date": 1476305863, "answer_id": 40008222, "question_id": 40008022, "link": "https://stackoverflow.com/questions/40008022/how-to-call-liftio-from-monadbasecontrol-io-m/40008222#40008222", "title": "How to call liftIO from MonadBaseControl IO m?", "body": "<p>What you are looking for is the <a href=\"https://hackage.haskell.org/package/transformers-base-0.4.4/docs/Control-Monad-Base.html#t:MonadBase\" rel=\"nofollow\"><code>MonadBase</code></a> class which is a superclass of <code>MonadBaseControl</code>:</p>\n\n<pre><code>class (Applicative b, Applicative m, Monad b, Monad m) =&gt;\n      MonadBase (b :: * -&gt; *) (m :: * -&gt; *) | m -&gt; b where\n  liftBase :: b \u03b1 -&gt; m \u03b1\n</code></pre>\n\n<p>So you can <code>liftBase $ someIOAction r</code>.</p>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 40008222, "answer_count": 1, "score": 1, "last_activity_date": 1476305863, "creation_date": 1476304999, "last_edit_date": 1495541791, "question_id": 40008022, "link": "https://stackoverflow.com/questions/40008022/how-to-call-liftio-from-monadbasecontrol-io-m", "title": "How to call liftIO from MonadBaseControl IO m?", "body": "<p>I'm writing a function <code>publish</code>, which needs to do some <code>IO</code>, and also call a function in <code>MonadBaseControl IO m</code>.The following works, but I would like to get rid of the constraint for <code>MonadIO</code>, since it should be redundant with <code>MonadBaseControl</code></p>\n\n<pre><code>publish :: (MonadIO m, MonadBaseControl IO m) =&gt; m ()\npublish =\n  withResource $ \\r -&gt;\n    liftIO $ someIOAction r\n</code></pre>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-7.3/resource-pool-0.2.3.2/Data-Pool.html#v:withResource\" rel=\"nofollow noreferrer\"><code>withResource</code></a> is defined in Data.Pool, and has a <code>MonadBaseControl IO m</code> constraint. </p>\n\n<p><code>someIOAction</code> has the type <code>r -&gt; IO ()</code></p>\n\n<p>I've read this question, but I can't figure out how to get rid of the second constraint: <a href=\"https://stackoverflow.com/questions/20931277/is-there-any-difference-between-monadio-m-and-monadbasecontrol-io-m\">Is there any difference between &quot;MonadIO m&quot; and &quot;MonadBaseControl IO m&quot;?</a></p>\n\n<p>If I remove <code>MonadIO m</code> then I don't have <code>liftIO</code> anymore. How do I execute an IO action from <code>MonadBaseControl?</code></p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": true, "score": 11, "last_activity_date": 1476306482, "creation_date": 1476306482, "answer_id": 40008378, "question_id": 40007703, "link": "https://stackoverflow.com/questions/40007703/how-do-i-add-the-containers-package-to-my-cabal-file-without-getting-overwri/40008378#40008378", "title": "How do I add the &quot;containers&quot; package to my .cabal file (without getting overwritten by stack at compile time)?", "body": "<p>This is hinting at the problem:</p>\n\n<pre><code>-- This file has been generated from package.yaml by hpack version 0.14.0.\n--\n-- see: https://github.com/sol/hpack\n</code></pre>\n\n<p><a href=\"https://github.com/sol/hpack\">hpack</a> is an alternative, YAML-based specification format for Haskell packages which can be used instead of the traditional cabal format. The <code>hpack</code> program can then be used to convert a specification from the hpack format to the cabal format to be able to integrate with the rest of the Haskell toolchain.</p>\n\n<p>Some <a href=\"https://github.com/commercialhaskell/stack/pull/1773\">basic support for hpack</a> was added to stack some time ago. It checks for a file called <code>package.yaml</code> in the current directory, which is the standard name for hpack format package specifications, and if it exists, it runs <code>hpack</code> to convert it to a cabal file and then proceeds building as normal. This is what's trampling over your .cabal file.</p>\n\n<p>To solve this, either:</p>\n\n<ul>\n<li>Modify <code>package.yaml</code> instead of <code>roman-numerals.cabal</code> to achieve the same effect.</li>\n<li>Delete <code>package.yaml</code> and continue working directly with <code>roman-numerals.cabal</code>.</li>\n</ul>\n\n<p>The syntax for adding dependencies in the hpack format is:</p>\n\n<pre><code>dependencies:\n  - base\n  - containers\n</code></pre>\n"}], "owner": {"reputation": 136, "user_id": 7010056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88e94deed73341ac5b12cadd099af4ae?s=128&d=identicon&r=PG&f=1", "display_name": "ktiu", "link": "https://stackoverflow.com/users/7010056/ktiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1497, "favorite_count": 3, "accepted_answer_id": 40008378, "answer_count": 1, "score": 10, "last_activity_date": 1483466085, "creation_date": 1476303891, "last_edit_date": 1592644375, "question_id": 40007703, "link": "https://stackoverflow.com/questions/40007703/how-do-i-add-the-containers-package-to-my-cabal-file-without-getting-overwri", "title": "How do I add the &quot;containers&quot; package to my .cabal file (without getting overwritten by stack at compile time)?", "body": "<p>I am working on the &quot;roman-numerals&quot; task from the exercism Haskell track and followed their <a href=\"http://exercism.io/languages/haskell/installing\" rel=\"noreferrer\">instructions to installing stack</a>. I am working on a Fedora 24 box.</p>\n<p>As long as I was working with Haskell modules from base, I didn't have a problem. Now I am trying to import the Data.Map module. It works fine using the ghci command line:</p>\n<pre><code>$ ghci\nGHCi, version 7.8.4: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; import Data.Map\nPrelude Data.Map&gt; \n</code></pre>\n<p>However, when I try to import it from inside my src file with the command:</p>\n<pre><code>import qualified Data.Map as M (foldlWithKey, fromList)\n</code></pre>\n<p>I am running into problems when I try to run the test:</p>\n<pre><code>$ stack test\nroman-numerals-0.0.0: build (lib + test)\nPreprocessing library roman-numerals-0.0.0...\n[2 of 2] Compiling Roman            (...)\n(...) /roman-numerals/src/Roman.hs:3:1: error:\n    Failed to load interface for \u2018Data.Map\u2019\n    It is a member of the hidden package \u2018containers-0.5.7.1\u2019.\n    Perhaps you need to add \u2018containers\u2019 to the build-depends in your .cabal file.\n    Use -v to see a list of the files searched for.\nProgress: 1/2\n(...)\n</code></pre>\n<p>I googled the problem and found a straightforward solution at <a href=\"https://www.haskell.org/cabal/FAQ.html#hidden-packages-a\" rel=\"noreferrer\">the Cabal FAQ at haskell.org</a>:</p>\n<blockquote>\n<p>What you need to do is to add containers to the build-depends in your .cabal file.</p>\n</blockquote>\n<p>I am assuming they mean the file roman-numerals.cabal that is in my working directory. The contents are:</p>\n<pre><code>-- This file has been generated from package.yaml by hpack version 0.14.0.\n--\n-- see: https://github.com/sol/hpack\n\nname:           roman-numerals\nversion:        0.0.0\nbuild-type:     Simple\ncabal-version:  &gt;= 1.10\n\nlibrary\n  hs-source-dirs:\n      src\n  build-depends:\n      base\n  exposed-modules:\n      Roman\n  other-modules:\n      Paths_roman_numerals\n  default-language: Haskell2010\n\ntest-suite test\n  type: exitcode-stdio-1.0\n  main-is: Tests.hs\n  hs-source-dirs:\n      test\n  build-depends:\n      base\n    , roman-numerals\n    , hspec\n  default-language: Haskell2010\n</code></pre>\n<p>I tried to add &quot;containers&quot; to the build-depends in either and both the &quot;library&quot; and &quot;test-suite&quot; sections, but when I run</p>\n<pre><code>$ stack test\n</code></pre>\n<p>the error persists, and the .cabal file is reverted to the same contents shown above.</p>\n<p>Any pointers? Much appreciated!</p>\n"}, {"tags": ["arrays", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 1, "creation_date": 1476305324, "post_id": 40007880, "comment_id": 67294163, "body": "Adding only <code>iarr &lt;- freeze arr :: ST s (Array Int Int)</code> doesn&#39;t work. Other solutions are working."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1476305604, "post_id": 40007880, "comment_id": 67294331, "body": "Right, you <i>can&#39;t</i> make a monomorphic signature for an <code>ST</code> action (without making it unusable, since <code>runST</code> is rank-2 polymorphic)."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 3, "last_activity_date": 1476306045, "last_edit_date": 1476306045, "creation_date": 1476304466, "answer_id": 40007880, "question_id": 40007277, "link": "https://stackoverflow.com/questions/40007277/ambiguous-type-variable-from-use-of-array-freeze-in-st-monad/40007880#40007880", "title": "Ambiguous type variable from use of array freeze in ST monad", "body": "<p>The problem is that you didn't give a signature for <code>createCustomInitializedArray</code>. And due to the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">Monomorphism Restriction</a> Haskell will try to infer a concrete type for <code>createCustomInitializedArray</code>. However it can't, because <code>freeze</code> is polymorphic in it's result.</p>\n\n<p>There are four ways to solve this:</p>\n\n<ol>\n<li>Provide a monomorphic type signature for <code>createCustomInitializedArray</code>. Eg.: <code>ST s (Array Int Int)</code></li>\n<li><p>Annotate <code>iarr</code> with a concrete type like this:</p>\n\n<pre><code>return (iarr :: Array Int Int) \n</code></pre></li>\n<li><p>Provide a polymorphic type signature for <code>createCustomInitilizedArray</code>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n...\ncreateCustomInitializedArray :: IA.IArray a Int =&gt; ST s (a Int Int)\n...\n</code></pre></li>\n<li>Enable the <code>NoMonomorphismRestriction</code> language extension to let Haskell infer the polymorphic type. I think this would be the least favorable option because you should provide type signatures for all your top-level functions anyway.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1476305858, "last_edit_date": 1476305858, "creation_date": 1476305486, "answer_id": 40008134, "question_id": 40007277, "link": "https://stackoverflow.com/questions/40007277/ambiguous-type-variable-from-use-of-array-freeze-in-st-monad/40008134#40008134", "title": "Ambiguous type variable from use of array freeze in ST monad", "body": "<p>Your function has the following most general type:</p>\n\n<pre><code>createCustomeInitializedArray :: IA.IArray a Int =&gt; ST s (a Int Int)\n</code></pre>\n\n<p>This has a typeclass constraint <code>IA.IArray a Int</code> in it. This is a bit tricky actually, as it applies a typeclass partially in the second argument to a fixed type. Haskell98 doesn't allow this; GHC does if you enable the <code>-XFlexibleContexts</code> extension. Apart from that, this is obviously a polymorphic type, but because <code>createCustomeInitializedArray</code> has no (explicit) arguments, the compiler would like to make it a <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"nofollow\">constant applicative form</a>, via the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">dreaded monomorphism restriction</a>. I.e. it refuses to infer a polymorphic type, you need to request it with an explicit signature. Using top-level signatures is an extremely good idea anyway, so do that:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\ncreateCustomeInitializedArray :: IA.IArray a Int =&gt; ST s (a Int Int)\ncreateCustomeInitializedArray = do\n    arr &lt;- newArray (0,10) 0 :: ST s (STArray s Int Int)\n    -- ...\n    iarr &lt;- freeze arr\n    return iarr\n</code></pre>\n\n<p>I'd add that this local signature you have for <code>newArray (0,10) 0</code> doesn't do quite what it looks: Haskell type variables aren't scoped, so the <code>s</code> there knows nothing about the <code>s</code> from the outlying state; the following is more faithful to what the compiler sees:</p>\n\n<pre><code>createCustomeInitializedArray :: IA.IArray a Int =&gt; ST s (a Int Int)\ncreateCustomeInitializedArray = do\n    arr &lt;- newArray (0,10) 0 :: ST s\u2081 (STArray s\u2081 Int Int)\n    -- ...\n</code></pre>\n\n<p>So it makes the local action fully polymorphic independent of <code>s</code> from the outside, only to then instantiate it to that state argument. Well, this is actually no problem in this particular example, but generally it can be a nasty issue (in particular, constraints on the outer <code>s</code> aren't propagated to the inner one). Hence this is the code I'd recommend:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, ScopedTypeVariables, UnicodeSyntax #-}\n\ncreateCustomeInitializedArray :: \u2200 s a . IA.IArray a Int =&gt; ST s (a Int Int)\ncreateCustomeInitializedArray = do\n  arr &lt;- newArray (0,10) 0 :: ST s (STArray s Int Int)\n  -- ...\n  iarr &lt;- freeze arr\n  return iarr\n</code></pre>\n\n<p>This can also be written a bit more concisely as</p>\n\n<pre><code>  arr :: STArray s Int Int &lt;- newArray (0,10) 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "is_accepted": false, "score": 0, "last_activity_date": 1476308402, "creation_date": 1476308402, "answer_id": 40008824, "question_id": 40007277, "link": "https://stackoverflow.com/questions/40007277/ambiguous-type-variable-from-use-of-array-freeze-in-st-monad/40008824#40008824", "title": "Ambiguous type variable from use of array freeze in ST monad", "body": "<p>Just for a reminder. Using vector seems a lot easier to me, less knowledge required.</p>\n\n<pre><code>import qualified Data.Vector.Unboxed.Mutable as M\nimport Data.Vector.Unboxed\nimport Control.Monad.ST\nimport Control.Monad\n\ncreateCustomeInitializedArray :: ST s (Vector Int)\ncreateCustomeInitializedArray = do\n     arr &lt;- M.new 10\n     -- ... \n     iarr &lt;- freeze arr\n     return iarr\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": false, "score": 0, "last_activity_date": 1547298783, "creation_date": 1547298783, "answer_id": 54159927, "question_id": 40007277, "link": "https://stackoverflow.com/questions/40007277/ambiguous-type-variable-from-use-of-array-freeze-in-st-monad/54159927#54159927", "title": "Ambiguous type variable from use of array freeze in ST monad", "body": "<p>You may use <code>freezeSTArray</code> from <code>GHC.Arr</code> instead of <code>freeze</code> to specify ambigous type:</p>\n\n<pre><code>import Data.Array\nimport Control.Monad.ST\nimport Data.Array.ST\nimport qualified Data.Array.IArray as IA\nimport GHC.Arr(freezeSTArray)\n\ncreateCustomeInitializedArray = do\n  arr &lt;- newArray (0,10) 0 :: ST s (STArray s Int Int)\n  -- ...\n  freezeSTArray arr\n</code></pre>\n"}], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 40008134, "answer_count": 4, "score": 2, "last_activity_date": 1547298783, "creation_date": 1476302285, "last_edit_date": 1476303081, "question_id": 40007277, "link": "https://stackoverflow.com/questions/40007277/ambiguous-type-variable-from-use-of-array-freeze-in-st-monad", "title": "Ambiguous type variable from use of array freeze in ST monad", "body": "<p>Following code creates array, initializes, then returns immutable array.</p>\n\n<pre><code>import Data.Array\nimport Control.Monad.ST\nimport Data.Array.ST\nimport qualified Data.Array.IArray as IA\n\ncreateCustomeInitializedArray = do\n  arr &lt;- newArray (0,10) 0 :: ST s (STArray s Int Int)\n  -- some mutation writeArray arr 0 1 etc\n  iarr &lt;- freeze arr -- :: ST s (IA.IArray Array s)\n  return iarr\n</code></pre>\n\n<p><code>iarr &lt;- freeze arr</code> causes type error </p>\n\n<pre><code>&gt; No instance for (IA.IArray b0 Int) arising from a use of `freeze'\n&gt;     The type variable `b0' is ambiguous\n</code></pre>\n\n<p>I have tried commented out type signature and other variations, no luck so far. Please include the thought process involving how to fix it in the answer.</p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1476299444, "post_id": 40006138, "comment_id": 67291066, "body": "Hint: <code>zip ratios diffs</code> will be a list of <code>(ratio, derivative)</code> pairs. So you&#39;ll wanna <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:dropWhile\" rel=\"nofollow noreferrer\">find the first element</a> in <code>zip ratios diffs</code> for which the derivative is below the threshold."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1476299403, "creation_date": 1476299403, "answer_id": 40006540, "question_id": 40006138, "link": "https://stackoverflow.com/questions/40006138/haskell-find-value-of-converging-sequence/40006540#40006540", "title": "Haskell find value of converging sequence", "body": "<p>How? By using another <code>zip</code>. Here is a one-liner based on what you already have:</p>\n\n<pre><code>snd . head . dropWhile (\\(p1,p0) -&gt; abs (p0 - p1) &gt;= epsilon) $ zip ratio (tail ratio)\n</code></pre>\n\n<p>Reading from right to left, this says:</p>\n\n<ul>\n<li><code>zip</code> together the list of ratios with their successors</li>\n<li>from the list continue dropping elements if the difference between the ratios is greater than <code>epsilon</code></li>\n<li>once that is done, we take the first element of the list and pick the more precise of the two.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 343, "user_id": 5085294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOFvi.png?s=128&g=1", "display_name": "Christof Schramm", "link": "https://stackoverflow.com/users/5085294/christof-schramm"}, "is_accepted": false, "score": 3, "last_activity_date": 1476300016, "creation_date": 1476300016, "answer_id": 40006707, "question_id": 40006138, "link": "https://stackoverflow.com/questions/40006138/haskell-find-value-of-converging-sequence/40006707#40006707", "title": "Haskell find value of converging sequence", "body": "<p>One possibility would be to use <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow\">list comprehensions</a>:</p>\n\n<pre><code>getApprox threshold = head $ [ratio | (ratio, diff) &lt;- zip (tail ratios) diffs\n                                    , abs diff &lt; threshold\n                             ]\n</code></pre>\n"}], "owner": {"reputation": 217, "user_id": 3916445, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/457c04fab5a8f301f264674174733af6?s=128&d=identicon&r=PG&f=1", "display_name": "nico7et8", "link": "https://stackoverflow.com/users/3916445/nico7et8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 40006540, "answer_count": 2, "score": 4, "last_activity_date": 1476305713, "creation_date": 1476297905, "last_edit_date": 1476305713, "question_id": 40006138, "link": "https://stackoverflow.com/questions/40006138/haskell-find-value-of-converging-sequence", "title": "Haskell find value of converging sequence", "body": "<p>Brand new to Haskell. I'm playing around with fibonacci sequence to learn the basics of the language and I can't find the idiomatic way to do something.</p>\n\n<p>The Fibonacci sequence can be defined like this:</p>\n\n<pre><code>fibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>(That's already pretty cool). Then, I want to use the sequence to approximate the Golden ratio (Phi). So :</p>\n\n<pre><code>ratios = zipWith (/) (tail fibs) fibs\n</code></pre>\n\n<p>is a list of better and better approximations of Phi. Let's say I want to get the first value when the list has \"stabilized\" under a given threshold epsilon. (ie: the difference between two successive values of ratios is smaller that epsilon). I can see how I would do that in an imperative language (using indexes), but how would one do that idiomaticly in Haskell?</p>\n\n<p>(Do we need to use the following list ? But how ?)</p>\n\n<pre><code>diffs = zipWith (-) ratios (tail ratios)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 2, "creation_date": 1476296335, "post_id": 40005612, "comment_id": 67289235, "body": "The problems are that 1) you need a <code>::</code> between <code>sequence</code> and <code>Int -&gt; Int</code>, 2) the <code>+1</code> as you wrote it doesn&#39;t mean anything, and 3) building a list directly with <code>until</code> this way won&#39;t ever be efficient, you need to carry a state with it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1476297417, "post_id": 40005612, "comment_id": 67289878, "body": "Why do you want to use until for this? It does not look as a good candidate for the task. Is the goal itself to learn how to use until?"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476300990, "post_id": 40006289, "comment_id": 67291907, "body": "The second version is more than &#39;a little&#39; more efficient - it is asymptotically faster than the first."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476301615, "post_id": 40006289, "comment_id": 67292226, "body": "When I wrote that, I think I was already comparing it to <code>sequence x = seq 1 where seq y = y : if y == x then [] else seq (y + 1)</code> in my mind."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1476299371, "last_edit_date": 1476299371, "creation_date": 1476298497, "answer_id": 40006289, "question_id": 40005612, "link": "https://stackoverflow.com/questions/40005612/haskell-using-until-on-a-list/40006289#40006289", "title": "Haskell - using Until on a list", "body": "<p>Take note of the type of <code>until</code>:</p>\n\n<pre><code>until :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>For your case, <code>a</code> is <code>[Int]</code>, so everything has to take a list as input and return a list.</p>\n\n<pre><code>sequence x = until (\\y -&gt; last y == x) (\\y -&gt; y ++ [last y + 1]) [1]\n</code></pre>\n\n<ul>\n<li>The predicate takes a list and checks if its last element is equal to <code>x</code>. </li>\n<li>The modifier takes a list and adds a new element to the end, with that new element being one greater than the last element of the list.</li>\n</ul>\n\n<p>This is not very efficient, as you are continually working with the wrong end of the list. You can make it a little more efficient by building the list backwards, then reversing it at the end. (Since we are guaranteed to be using non-empty lists, I use <code>head</code> in place of pattern matching for simplicity.)</p>\n\n<pre><code>sequence x = reverse $ until ((== x) . head) (\\y -&gt; (head y + 1) : y) [1] \n</code></pre>\n\n<p>or build the list down from <code>x</code> to 1:</p>\n\n<pre><code>sequence x = until ((==1) . head) (\\y -&gt; head y-1 : y) [x]\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5343720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8cb0e79384730275d9b6f4e70900616?s=128&d=identicon&r=PG&f=1", "display_name": "StarCharm", "link": "https://stackoverflow.com/users/5343720/starcharm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1923, "favorite_count": 0, "accepted_answer_id": 40006289, "answer_count": 1, "score": 0, "last_activity_date": 1476299371, "creation_date": 1476296111, "question_id": 40005612, "link": "https://stackoverflow.com/questions/40005612/haskell-using-until-on-a-list", "title": "Haskell - using Until on a list", "body": "<p>I've been trying to do a function that creates a list of n numbers ([1...n]) using an until. So far I haven't found any examples of until manipulating lists and I've been improvising:</p>\n\n<pre><code>sequence Int -&gt; [Int]\nsequence x = until (== x) (++ [ +1 ]) [1]\n</code></pre>\n\n<p>But keep getting the Syntax error in expression (unexpected token) error</p>\n\n<p>I know I could simply use a [1..n] to create the list, but I really want to make this work out. Thanks in advance for any help.</p>\n"}, {"tags": ["haskell", "exception-handling", "ocaml"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1476295046, "post_id": 40005218, "comment_id": 67288492, "body": "There&#39;s <a href=\"http://hackage.haskell.org/package/spoon-0.3.1/docs/Control-Spoon.html\" rel=\"nofollow noreferrer\">spoon</a>, but this is pretty hackish and not reliable in a multithreaded context. The preferred thing to do is to avoid partial functions, or if you use them then first perform a sanity check on the arguments to make sure no exception is ever thrown."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1476296045, "post_id": 40005438, "comment_id": 67289078, "body": "...or in this case simply <code>take 1</code>."}], "tags": [], "owner": {"reputation": 974, "user_id": 3829232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?s=128&d=identicon&r=PG", "display_name": "soupi", "link": "https://stackoverflow.com/users/3829232/soupi"}, "is_accepted": false, "score": 2, "last_activity_date": 1476295481, "creation_date": 1476295481, "answer_id": 40005438, "question_id": 40005218, "link": "https://stackoverflow.com/questions/40005218/ocamls-try-with-in-haskell/40005438#40005438", "title": "Ocaml&#39;s `try ... with` in Haskell", "body": "<p>You can use functions and total functions to achieve the same thing most of the time. For your example:</p>\n\n<p><code>fromMaybe [] (listToMaybe l)</code></p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 5684291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb3789eb2d513210de2a93019dec6400?s=128&d=identicon&r=PG&f=1", "display_name": "mhn70", "link": "https://stackoverflow.com/users/5684291/mhn70"}, "edited": false, "score": 0, "creation_date": 1476296689, "post_id": 40005599, "comment_id": 67289449, "body": "I don&#39;t want to show the message I want to run another function and I just bring this example to make it simple."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 29, "user_id": 5684291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb3789eb2d513210de2a93019dec6400?s=128&d=identicon&r=PG&f=1", "display_name": "mhn70", "link": "https://stackoverflow.com/users/5684291/mhn70"}, "edited": false, "score": 0, "creation_date": 1476296898, "post_id": 40005599, "comment_id": 67289578, "body": "Well you can do any inside the function you pass to <code>catch</code>... But if that is what you are doing, you really need to be using total functions instead. Take a look at the other answer for an example of that."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1476296079, "creation_date": 1476296079, "answer_id": 40005599, "question_id": 40005218, "link": "https://stackoverflow.com/questions/40005218/ocamls-try-with-in-haskell/40005599#40005599", "title": "Ocaml&#39;s `try ... with` in Haskell", "body": "<p>You should really be avoiding such errors via total functions. Then, if a function can return an error, have its return type be an <code>Either e a</code> where <code>e</code> is the type of the exception and <code>a</code> is the otherwise successful type. If you don't need to pass any information about the exception, you can just return <code>Maybe a</code>.</p>\n\n<p>That said, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html\" rel=\"nofollow\"><code>Control.Exception</code></a> has some facilities for catching errors via <code>try</code> or <code>catch</code>, at the cost of only being able to do such handling in the <code>IO</code> monad. At GHCi you can see this:</p>\n\n<pre><code>ghci&gt; import Control.Exception\nghci&gt; catch (head []) (\\msg -&gt; putStrLn $ \"caught: \" ++ show (msg :: SomeException))\ncaught: Prelude.head: empty list\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1476334772, "creation_date": 1476334772, "answer_id": 40012618, "question_id": 40005218, "link": "https://stackoverflow.com/questions/40005218/ocamls-try-with-in-haskell/40012618#40012618", "title": "Ocaml&#39;s `try ... with` in Haskell", "body": "<p>In this simple case, you could just use <code>foldr</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldr const [] l\n</code></pre>\n\n<p>Or even use pattern matching directly:</p>\n\n<pre><code>case l of\n  [] -&gt; []\n  x : _ -&gt; x\n</code></pre>\n\n<p>More generally, using <code>Maybe</code> or <code>Either</code>, as others have suggested, can make for more modular code. You may want to check out the <code>MaybeT</code> and <code>ExceptT</code> types, and the <code>MonadError</code> class, to integrate failure into monadic computations.</p>\n"}], "owner": {"reputation": 29, "user_id": 5684291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb3789eb2d513210de2a93019dec6400?s=128&d=identicon&r=PG&f=1", "display_name": "mhn70", "link": "https://stackoverflow.com/users/5684291/mhn70"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1476334772, "creation_date": 1476294761, "last_edit_date": 1476333222, "question_id": 40005218, "link": "https://stackoverflow.com/questions/40005218/ocamls-try-with-in-haskell", "title": "Ocaml&#39;s `try ... with` in Haskell", "body": "<p>My question: is there any \"try with\" equivalent in Haskell? Something like this :</p>\n\n<pre>\ntry \n{\n head l\n}\nwith \nFailure _ -> []\n</pre>\n\n<p>If the operation in try failed we pattern match the error and do appropriate job in with section? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1476294986, "post_id": 40005164, "comment_id": 67288462, "body": "This is no different than recursion in any other language. The value <code>x - y</code> you pass to the recursive call does not affect the value of <code>x</code> in the caller."}, {"owner": {"reputation": 71, "user_id": 4904881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15acf96307a3452e7a10407410594f6a?s=128&d=identicon&r=PG", "display_name": "fushigi", "link": "https://stackoverflow.com/users/4904881/fushigi"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476295403, "post_id": 40005164, "comment_id": 67288707, "body": "So x IS mutable inside the recursion?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1476295421, "post_id": 40005164, "comment_id": 67288716, "body": "No, it&#39;s simply a different variable that also happens to be called <code>x</code>. This has nothing to do with mutability, like it has nothing to do with mutability if you define two functions <code>f x = sin x</code> and <code>g x = tanh x</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476295509, "post_id": 40005164, "comment_id": 67288769, "body": "Do you understand how recursion works in a language other than Haskell?"}, {"owner": {"reputation": 71, "user_id": 4904881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15acf96307a3452e7a10407410594f6a?s=128&d=identicon&r=PG", "display_name": "fushigi", "link": "https://stackoverflow.com/users/4904881/fushigi"}, "edited": false, "score": 0, "creation_date": 1476295892, "post_id": 40005164, "comment_id": 67288997, "body": "Well, haskell is my first date with recursion in practise."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1476296960, "post_id": 40005164, "comment_id": 67289618, "body": "Variables are called variables because they can assume <i>various</i> values -- they <i>vary</i>. In Haskell, they vary like in maths, where given f(x) we can refer to f(1), f(4), ... choosing x=1, and then x=4, .... This has nothing to do with mutability: within the same scope (&quot;function call&quot;), a variable in maths/Haskell has always the same value. In imperative language, assignment can alter such value."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476300773, "post_id": 40005164, "comment_id": 67291791, "body": "Haskell has no variables, mutable or otherwise. What you call a &#39;variable&#39; is really a formal parameter - it &#39;gets&#39; a value when you call the function with the appropriate number of arguments. You cannot do any of the following: create a variable, assign to a variable, read from a variable."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1476306850, "post_id": 40005164, "comment_id": 67295033, "body": "@user2407038 Haskell doesn&#39;t just have parameters. You can also define local variables with <code>let</code> and <code>where</code> and of course you can also define them at the top-level. And of course parameters are just a kind of variable."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 4904881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15acf96307a3452e7a10407410594f6a?s=128&d=identicon&r=PG", "display_name": "fushigi", "link": "https://stackoverflow.com/users/4904881/fushigi"}, "edited": false, "score": 0, "creation_date": 1476329863, "post_id": 40007769, "comment_id": 67301579, "body": "Yes, that definately was imperative programmer in me talking. I was looking at my code and seeing nothing behind that <code>x</code>. Thank you for the answer."}], "tags": [], "owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "is_accepted": true, "score": 4, "last_activity_date": 1476304080, "creation_date": 1476304080, "answer_id": 40007769, "question_id": 40005164, "link": "https://stackoverflow.com/questions/40005164/mutable-variables-in-haskell/40007769#40007769", "title": "Mutable variables in Haskell?", "body": "<p>Your <code>x</code> here doesn't change <em>during one function call</em> (i.e., after creation) - that's exactly what <a href=\"https://en.wikipedia.org/wiki/Immutable_object\" rel=\"nofollow\"><em>immutable</em></a> means. What does change is value of <code>x</code> during multiple (recursive) calls. In a single stack frame (function call) the value of <code>x</code> is constant. </p>\n\n<p>An example of execution of your code, for a simple case</p>\n\n<pre><code>call divide 8 3 -- (x = 8, y = 3), stack: divide 8 3\nstep 1: x &lt; y ? NO\nstep 2: 1 + divide 5 3 \n    call: divide 5 3 -- (x = 5, y = 3), stack: divide 8 3, divide 5 3\n    step 1: x &lt; y ? NO\n    step 2: 1 + divide 2 3\n        call divide 2 3 -- (x = 2, y = 3), stack: divide 8 3, divide 5 3, divide 2 3\n        step 1: x &lt; y ? YES\n        return: 0 -- unwinding bottom call\n    return 1 + 0 -- stack: divide 8 3, divide 5 3, unwinding middle call\nreturn 1 + 1 + 0 -- stack: divide 8 3\n</code></pre>\n\n<p>I am aware that the above notation is not anyhow formalized, but I hope it helps to understand what recursion is about and that <code>x</code> might have different values in different calls, because it's simply a different instance of whole call, thus also different instance of <code>x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 5221348, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kOCIlDdx-ns/AAAAAAAAAAI/AAAAAAAAAyo/ueDHObVyNM8/photo.jpg?sz=128", "display_name": "lvsz", "link": "https://stackoverflow.com/users/5221348/lvsz"}, "is_accepted": false, "score": 4, "last_activity_date": 1476330877, "last_edit_date": 1476330877, "creation_date": 1476307225, "answer_id": 40008538, "question_id": 40005164, "link": "https://stackoverflow.com/questions/40005164/mutable-variables-in-haskell/40008538#40008538", "title": "Mutable variables in Haskell?", "body": "<p><code>x</code> is actually not a variable, but a parameter, and isn't that different from parameters in imperative languages.</p>\n\n<p>Maybe it'd look more obvious with explicit return statements?</p>\n\n<pre><code>-- for illustrative purposes only, doesn't actually work\ndivide x y =\n    if x &lt; y\n    then return 0\n    else return 1 + divide (x - y) y\n</code></pre>\n\n<p>You're not mutating <code>x</code>, just stacking up several function calls to calculate your desired result with the values they return.</p>\n\n<p>Here's the same function in Python:</p>\n\n<pre><code>def divide(x, y):\n    if x &lt; y:\n        return 0\n    else:\n        return 1 + divide(x - y, y)\n</code></pre>\n\n<p>Looks familiar, right? You can translate this to any language that allows recursion, and none of them would require you to mutate a variable.</p>\n\n<p>Other than that, yes, your compiler is lying to you. Because you're not allowed to directly mutate values, the compiler can make a lot of extra assumptions based on your code, which helps translating it to efficient machine code, and at that level, there's no escaping mutability. The major benefit is that compilers are way less likely to introduce mutability-related bugs than us mortals.</p>\n"}], "owner": {"reputation": 71, "user_id": 4904881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15acf96307a3452e7a10407410594f6a?s=128&d=identicon&r=PG", "display_name": "fushigi", "link": "https://stackoverflow.com/users/4904881/fushigi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1225, "favorite_count": 0, "accepted_answer_id": 40007769, "answer_count": 2, "score": 2, "last_activity_date": 1476330877, "creation_date": 1476294572, "question_id": 40005164, "link": "https://stackoverflow.com/questions/40005164/mutable-variables-in-haskell", "title": "Mutable variables in Haskell?", "body": "<p>I'm starting to wrap my head around Haskell and do some exciting experiments. And there's one thing I just seem to be unable to comprehend (previous \"imperativist\" experience talks maybe). \nRecently, I was yearning to implement integer division function as if there where no multiply/divide operations. An immensely interesting brain-teaser which led to great confusion.</p>\n\n<pre><code>divide x y =\n    if x &lt; y then 0\n    else 1 + divide (x - y) y\n</code></pre>\n\n<p>I compiled it and it.. works(!). That's mind-blowing. However, I was told, I was sure that variables are immutable in Haskell. How comes that with each recursive step variable x keeps it's value from previous step? Or is my glorious compiler lying to me? Why does it work at all?</p>\n"}, {"tags": ["haskell", "dependency-management", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1476294741, "post_id": 40003225, "comment_id": 67288318, "body": "Is it possible that you didn&#39;t add the module to the exposed-modules list?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1476296452, "post_id": 40003225, "comment_id": 67289308, "body": "@MichaelSnoyman I think that&#39;s it. It is the only way I could reproduce the problem while fiddling with the default <code>stack new</code> project."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1476308683, "post_id": 40003225, "comment_id": 67295900, "body": "@MichaelSnoyman I had specified the module in the exposed-modules list. If it matters, here&#39;s what actually happened: My parent project was lts-7.2, I created the sub-project with stack new, which based it on lts-7.3. At some point I started getting errors and updated my parent project to lts-7.3. I think the error was from some kind of build artifact."}], "answers": [{"tags": [], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "is_accepted": false, "score": 1, "last_activity_date": 1476308578, "creation_date": 1476308578, "answer_id": 40008859, "question_id": 40003225, "link": "https://stackoverflow.com/questions/40003225/stack-how-to-depend-on-a-package-during-development/40008859#40008859", "title": "Stack: How to depend on a package during development?", "body": "<p>The above example should work. I attempted this again from scratch and it works fine. The error was due to some kind of build artifact. </p>\n\n<p>If it happened again I would delete .stack-work in the sub-project and rebuild. </p>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1476308578, "creation_date": 1476288224, "question_id": 40003225, "link": "https://stackoverflow.com/questions/40003225/stack-how-to-depend-on-a-package-during-development", "title": "Stack: How to depend on a package during development?", "body": "<p>There is a portion of my application that would be better if published to Hackage. I still don't know exactly what it will look like, so I need to make many changes to it while working on my application. </p>\n\n<p>It's very easy to just create a module in my project and iterate there, but I would like to put it in its own project so it can have its own dependencies. </p>\n\n<p>How can I have my project depend on this separate package during development? It should allow for quick iteration. Here's what I tried so far:</p>\n\n<pre><code># stack.yaml\npackages:\n- '.'\n- location: ../amqp-worker\n\n# my-application.cabal\nlibrary\n  build-depends:\n      base &gt;= 4.7 &amp;&amp; &lt; 5\n    , amqp-worker\n</code></pre>\n\n<p>But I get an error when I build:</p>\n\n<pre><code>$ stack build\ncra-reporting-0.1.0.0: build\n\n--  While building package cra-reporting-0.1.0.0 using:\n      /Users/seanhess/.stack/setup-exe-cache/x86_64-osx/setup-Simple-Cabal-1.24.0.0-ghc-8.0.1 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.24.0.0 build lib:cra-reporting exe:cra-reporting-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /Users/seanhess/projects/simple/cra-reporting/.stack-work/logs/cra-reporting-0.1.0.0.log\n\n    Preprocessing library cra-reporting-0.1.0.0...\n    [8 of 8] Compiling Simple.DataX.Worker ( src/Simple/DataX/Worker.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.0.0/build/Simple/DataX/Worker.o )\n\n    /Users/seanhess/projects/simple/cra-reporting/src/Simple/DataX/Worker.hs:6:1: error:\n        Failed to load interface for \u2018Network.Worker\u2019\n        Perhaps you meant\n          Network.Socket (needs flag -package-key network-2.6.3.1)\n          Network.Wreq (from wreq-0.4.1.0)\n          Network.Socks5 (needs flag -package-key socks-0.5.5)\n        Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>The external package seems to build fine if I run <code>stack build</code> from within its project folder. </p>\n\n<p>Both projects are targeting lts-7.3</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1476288792, "post_id": 40002704, "comment_id": 67284690, "body": "Perhaps simply give <code>foo</code> a more general type, e.g. <code>Monoid w =&gt; Writer w Int -&gt; Writer w Int -&gt; Writer w Int</code> - in this case you can instantiate <code>foo</code> with different monoids."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1476322673, "post_id": 40003465, "comment_id": 67299766, "body": "@krokodil The RHS type in the first law is <code>n a</code> (the function on the right of <code>(&gt;&gt;=)</code> is <code>f</code> <i>then</i> <code>morph</code>), and the comparison uses the full <code>n a</code> monadic value. (By the way: it is worth emphasising that, as long as you don&#39;t plan to use <code>bar</code> with <code>hoist</code>, <code>embed</code> and the other tools in <code>Control.Monad.Morph</code>, you don&#39;t need to worry it not being a monad morphism.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1476289259, "last_edit_date": 1476289259, "creation_date": 1476288943, "answer_id": 40003465, "question_id": 40002704, "link": "https://stackoverflow.com/questions/40002704/monad-morphisms-applicability-questiion/40003465#40003465", "title": "Monad Morphisms applicability questiion", "body": "<p>If what you actually want is to reuse <code>foo</code>, you can just make it polymorphic...</p>\n\n<pre><code>foo :: (Monoid b) =&gt; Writer b Int -&gt; Writer b Int -&gt; Writer b Int\n</code></pre>\n\n<p>... and give your instances to two different types (I will write them as <code>newtypes</code> around tuples, but you can do it differently if you want):</p>\n\n<pre><code>newtype F = F { unF :: (Bool, Bool) }\n    deriving (Eq, Show)\n\ninstance Monoid F where -- etc.\n\nnewtype G = G { unG :: (Bool, Bool) }\n    deriving (Eq, Show)\n\ninstance Monoid G where -- etc.\n</code></pre>\n\n<p>As for using a monad morphism, you can certainly write a function such as...</p>\n\n<pre><code>bar :: Writer F a -&gt; Writer G a\nbar = writer . fmap (G . unF) . runWriter\n</code></pre>\n\n<p>... which effectively just swaps the <code>Monoid</code> instance, as you originally wanted to. However, you won't be able to use the <em>mmorph</em> machinery, as it isn't actually a monad morphism. Quoting <a href=\"http://hackage.haskell.org/package/mmorph-1.0.2/docs/Control-Monad-Morph.html\" rel=\"nofollow\"><code>Control.Monad.Morph</code></a>:</p>\n\n<pre><code>-- A monad morphism is a natural transformation:\n\n morph :: forall a . m a -&gt; n a\n\n-- ... that obeys the following two laws:\n\n morph (m &gt;&gt;= f)  = morph m &gt;&gt;= morph . f\n morph (return x) = return x\n</code></pre>\n\n<p>The obvious implementation of <code>bar</code> violates the first of these laws, as the <code>mappend</code>s implicit in <code>m &gt;&gt;= f</code> and <code>morph m &gt;&gt;= morph . f</code> can give different results even if the underlying pairs of booleans are the same.  </p>\n"}], "owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 40003465, "answer_count": 1, "score": 1, "last_activity_date": 1476289348, "creation_date": 1476286599, "last_edit_date": 1476289348, "question_id": 40002704, "link": "https://stackoverflow.com/questions/40002704/monad-morphisms-applicability-questiion", "title": "Monad Morphisms applicability questiion", "body": "<p>I am trying to do something, and I think Monad Morphisms are the answer, but I am unsure how to correctly apply them here. Briefly, I have the following setup:</p>\n\n<pre><code>import Control.Monad.Identity\nimport Control.Monad.Writer\n\ndata F = F Bool Bool\n\ninstance Monoid F where\n    mempty =  F True False\n    (F s0 c0) `mappend` (F s1 c1) = F (s0 &amp;&amp; s1)\n                                    (c0 || c1 || not (s0 || s1))\ntype S = Writer F\ntype SInt = S Int\n</code></pre>\n\n<p>Above I define datatype F with two boolean flags, which state I track using Writer monad. For example, I will use them in the function foo:</p>\n\n<pre><code>foo :: SInt -&gt; SInt -&gt; SInt\nfoo = liftM2 (+)\n</code></pre>\n\n<p>Now, I would like in certain situations, to implement different flags handling logic and use it with <code>foo</code> without changing <code>foo</code>'s type signature. In particular, I would like to change Monoid definition above to this:</p>\n\n<pre><code>instance Monoid F where\n    mempty =  F True False\n    (F s0 c0) `mappend` (F s1 c1) = F (s0 &amp;&amp; s1) (c0 || c1)\n</code></pre>\n\n<p>Is this something I could do with the help of <a href=\"http://hackage.haskell.org/package/mmorph-1.0.2/docs/Control-Monad-Morph.html\" rel=\"nofollow\">Monad Morphisms</a>? How?</p>\n"}, {"tags": ["haskell", "iteration"], "comments": [{"owner": {"reputation": 807, "user_id": 4130613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/830c7c32261bc5af7d8ad59e11ff6e93?s=128&d=identicon&r=PG", "display_name": "Ch0k0l8", "link": "https://stackoverflow.com/users/4130613/ch0k0l8"}, "edited": false, "score": 0, "creation_date": 1476270568, "post_id": 39996692, "comment_id": 67271891, "body": "Depends on what&#39;s your purpose. For example, if you have a list of Ints and want to get the result out of it you can use fold. Or if you want to apply a function to every element of the list you can use map or generalized one that you can apply to Haskell data type such as Maybe, Either, etc. you can use fmap. Take a look at Functor type class. Functor is for those data types that can be mapped over which list is one of the data types. Based on your example you can for example use map _ -&gt; True yourlist"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1476272966, "post_id": 39996692, "comment_id": 67273441, "body": "<code>&quot;abcsdsdsdsd&quot;</code> is equivalent to <code>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;s&#39;, &#39;d&#39;, &#39;s&#39;, &#39;d&#39;, &#39;s&#39;, &#39;d&#39;, &#39;s&#39;, &#39;d&#39;]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1476275687, "last_edit_date": 1476275687, "creation_date": 1476272137, "answer_id": 39997606, "question_id": 39996692, "link": "https://stackoverflow.com/questions/39996692/iteration-using-counters-in-functional-programming/39997606#39997606", "title": "Iteration using counters in functional programming?", "body": "<p>The counter isn't necessary. The length of the list isn't particularly important; you just use it to determine if the list is non-empty (<code>textlen &gt;= 0</code>) or not. You can do the same thing by pattern matching on the argument itself.</p>\n\n<pre><code>exampleFunction :: [String] -&gt; [Bool]\nexampleFunction (x:xs) = True : exampleFunction xs\nexampleFunction []  = []\n</code></pre>\n\n<p>As pointed out in a comment, this particular <em>recursion scheme</em> is abstracted out as the <code>map</code> function:</p>\n\n<pre><code>exampleFunction :: [String] -&gt; [Bool]\nexampleFunction xs = map (const True) xs\n</code></pre>\n\n<p>where <code>const True</code> returns a function that returns <code>True</code> no matter what its argument is. (<code>const True</code> can also be written as an explicit lambda expression (<code>\\_ -&gt; True</code>). <code>map</code> applies this function to each element of <code>xs</code> and combines the results into a new list.</p>\n\n<p>Other recursion schemes capture different styles of recursion (<code>filter</code>, <code>foldr</code>, etc), so while it is always possible to write an explicit recursive function to accomplish your task, you can often avoid it by using the appropriate higher order function.</p>\n\n<hr>\n\n<p>I'm abusing the term <em>recursion scheme</em> a bit; <code>map</code> and <code>filter</code> can be thought of as special cases of <code>foldr</code>, which is an example of a general recursion scheme known as a <em>catamorphism</em>.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 1, "accepted_answer_id": 39997606, "answer_count": 1, "score": 0, "last_activity_date": 1476278424, "creation_date": 1476269277, "question_id": 39996692, "link": "https://stackoverflow.com/questions/39996692/iteration-using-counters-in-functional-programming", "title": "Iteration using counters in functional programming?", "body": "<p>I'm iterating through a list of [Char], I'm wondering the best way to perform the iteration.</p>\n\n<p>This function calls itself recursively and passes back to itself a counter that gets decreased per iteration.</p>\n\n<p>Its just for illustrative purposes, so always return True for each Char:</p>\n\n<pre><code>text = [\"abcsdsdsdsd\"]\n\nexampleFunction :: Int -&gt; String -&gt; [Bool]\nexampleFunction textlen text\n  | textlen &gt;= 0        = True : exampleFunction (textlen - 1) text\n  | otherwise   = []\n</code></pre>\n\n<p>Using 'textlen' as a counter seems rather imperative, is this the best way and/or the most Haskell-like to implement this?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1476267650, "post_id": 39993569, "comment_id": 67270066, "body": "what is the resolver you are using ? Is there a stack.yaml file associated ? Can you share it with us ?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476290156, "post_id": 39993569, "comment_id": 67285541, "body": "<code>Control.Exception.block</code> has been deprecated for a long time and was <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Exception.html\" rel=\"nofollow noreferrer\">removed by GHC 7.8.4</a>. This package is simply extremely outdated (5 yr!!) - either update it yourself or revert back to an older GHC (fortunately, stack makes the latter extremely easy for you). Or, of course, use a package which is properly maintained."}], "owner": {"reputation": 130, "user_id": 4310774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cb81de4ac734c1ec217fb3ed818d49c?s=128&d=identicon&r=PG&f=1", "display_name": "roman-mkh", "link": "https://stackoverflow.com/users/4310774/roman-mkh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1476278887, "creation_date": 1476259641, "last_edit_date": 1476278887, "question_id": 39993569, "link": "https://stackoverflow.com/questions/39993569/compile-haskell-direct-fastcgi-package-with-stack", "title": "Compile Haskell &quot;direct-fastcgi&quot; package with stack", "body": "<p>I tried to compile Haskell <a href=\"https://hackage.haskell.org/package/direct-fastcgi\" rel=\"nofollow\" title=\"This package is a native implementation of the FastCGI protocol\">direct-fastcgi</a> package with stack (setup-Simple-Cabal-1.18.1.5-ghc-7.8.4) and got follow errors (see below).</p>\n\n<p>Is it a compatibility issues with GHC 7.8.4? Could somebody advice me how to fix it? Thank you in advance.</p>\n\n<hr>\n\n<pre><code>Configuring direct-fastcgi-1.0.3...\nBuilding direct-fastcgi-1.0.3...\nPreprocessing library direct-fastcgi-1.0.3...\n[1 of 1] Compiling Network.FastCGI  ( Network/FastCGI.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Network/FastCGI.o )    \n\nNetwork/FastCGI.hs:248:16:\n    Not in scope: \u2018Exception.block\u2019\n    Perhaps you meant one of these:\n      data constructor \u2018Exception.Deadlock\u2019 (imported from Control.Exception),\n      \u2018Exception.catch\u2019 (imported from Control.Exception),\n      \u2018Exception.bracket\u2019 (imported from Control.Exception)    \nNetwork/FastCGI.hs:251:16:\n    Not in scope: \u2018Exception.unblock\u2019\n    Perhaps you meant data constructor \u2018Exception.Deadlock\u2019 (imported from Control.Exception)    \nNetwork/FastCGI.hs:368:3: Not in scope: \u2018System.catch\u2019    \nNetwork/FastCGI.hs:389:3: Not in scope: \u2018System.catch\u2019\n</code></pre>\n\n<hr>\n\n<h2>stack.yaml:</h2>\n\n<pre><code>flags: {}\nextra-package-dbs: []\npackages:\n- '.'\nextra-deps:\n- direct-fastcgi-1.0.3\n- utf8-string-0.3.8\nresolver: lts-6.13\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1476263397, "post_id": 39991581, "comment_id": 67267256, "body": "The problem here is the tuples.  The Haskell tuples are defined to be distinct types that have nothing in common (type-wise), and that makes a generic zipN impossible."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1476270200, "post_id": 39991581, "comment_id": 67271663, "body": "Related earlier question: <a href=\"http://stackoverflow.com/questions/2468226/how-to-zip-multiple-lists-in-haskell\" title=\"how to zip multiple lists in haskell\">stackoverflow.com/questions/2468226/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476271506, "post_id": 39992104, "comment_id": 67272485, "body": "This doesn&#39;t generalize the various <code>zipN</code> functions; it just replaces them with the corresponding hard-coded tuple constructor. (<code>zip</code> with <code>(,)</code>, <code>zip2</code> with <code>(,,)</code>, etc."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476284019, "post_id": 39992104, "comment_id": 67281271, "body": "@chepner I think the OP is really asking for ways of zipping together lists once the builtin <code>zip1</code> through to <code>zip7</code> solutions fail. Given that machinery like <code>ZipList</code> exists in vanilla Haskell for this very purpose, I think it would not be a good idea to instead recommend something that needs have a dozen extensions and is bogged down by all sorts of mandatory annotations."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476285053, "post_id": 39992104, "comment_id": 67281989, "body": "<code>ZipList</code> is about how you apply a list of functions to a list of inputs, not how you apply a single function of arbitrary arity to the necessary number of lists."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476285629, "post_id": 39992104, "comment_id": 67282394, "body": "@chepner Again, avoiding the arbitrary arity that is difficult to navigate, I think this is as close as you get. Even the documentation describes it as a way of doing generalized <code>zipWith</code>: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\"><code>f &lt;$&gt; ZipList xs1 &lt;*&gt; ... &lt;*&gt; ZipList xsn = ZipList (zipWithn f xs1 ... xsn)</code></a>. That said, I realize this isn&#39;t a true arbitrary arity function. I even say that in the answer."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1476397947, "last_edit_date": 1476397947, "creation_date": 1476254707, "answer_id": 39992104, "question_id": 39991581, "link": "https://stackoverflow.com/questions/39991581/how-can-i-implement-generalized-zipn-and-unzipn-in-haskell/39992104#39992104", "title": "How can I implement generalized &quot;zipn&quot; and &quot;unzipn&quot; in Haskell?", "body": "<p>This is one very useful aspect of applicatives. Check out <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow\"><code>ZipList</code></a> which is just a <code>newtype</code> wrapper around a simple list. The reason for the wrapper is that <code>ZipList</code> has an applicative instance for, you guessed it, zipping lists together. Then, if you want <code>zip7 as bs cs ds es fs gs hs</code>, you can just do something like</p>\n\n<pre><code>(,,,,,,) &lt;$&gt; as &lt;*&gt; bs &lt;*&gt; cs &lt;*&gt; ds &lt;*&gt; es &lt;*&gt; fs &lt;*&gt; gs &lt;*&gt; hs\n</code></pre>\n\n<p>As you can tell, this mechanism is meant to be also for extending <code>zipWith</code>, which is a general case of <code>zip</code>. To be honest, I think we should rip out all of the <code>zipN</code> functions and teach people the above instead. <code>zip</code> itself is fine, but beyond that...</p>\n\n<h3>Template Haskell solution</h3>\n\n<p>As the comments and other answers indicate, this is not a particularly satisfying answer. The one thing I was expecting someone else to implement was a <code>TemplateHaskell</code> version of <code>zip</code> and <code>unzip</code>. As no one has done so yet, here it is.</p>\n\n<p>All it does is mechanically produce AST for <code>zip</code> or <code>unzip</code> functions. The idea behind <code>zip</code> is to use <code>ZipList</code> and behind <code>unzip</code> is to use <code>foldr</code>:</p>\n\n<pre><code>zip as ... zs === \\as ... zs -&gt; getZipList $ (, ... ,) &lt;$&gt; ZipList as &lt;*&gt; ... &lt;*&gt; ZipList zs\nunzip         === foldr (\\ (a, ... ,z) ~(as, ... ,zs) -&gt; (a:as, ... ,z:zs) ) ([], ... ,[])\n</code></pre>\n\n<p>The implementation looks like this.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nmodule Zip (zip, unzip) where\n\nimport Prelude hiding (zip, unzip)\nimport Language.Haskell.TH\nimport Control.Monad\nimport Control.Applicative (ZipList(..))\n\n-- | Given number, produces the `zip` function of corresponding arity\nzip :: Int -&gt; Q Exp\nzip n = do\n  lists &lt;- replicateM n (newName \"xs\")\n\n  lamE (varP &lt;$&gt; lists)\n       [| getZipList $\n            $(foldl (\\a b -&gt; [| $a &lt;*&gt; ZipList $(varE b) |])\n                    [| pure $(conE (tupleDataName n)) |]\n                    lists) |]\n\n-- | Given number, produces the `unzip` function of corresponding arity\nunzip :: Int -&gt; Q Exp\nunzip n = do\n  heads &lt;- replicateM n (newName \"x\")\n  tails &lt;- replicateM n (newName \"xs\")\n\n  [| foldr (\\ $(tupP (varP &lt;$&gt; heads)) ~ $(tupP (varP &lt;$&gt; tails)) -&gt; \n                $(tupE (zipWith (\\x xs -&gt; [| $x : $xs |])\n                                (varE &lt;$&gt; heads)\n                                (varE &lt;$&gt; tails))))\n           $(tupE (replicate n [| [] |])) |]\n</code></pre>\n\n<p>You can try this at GHCi:</p>\n\n<pre><code>ghci&gt; :set -XTemplateHaskell\nghci&gt; $(zip 3) [1..10] \"abcd\" [4,6..]\n[(1,'a',4),(2,'b',6),(3,'c',8),(4,'d',10)]\nghci&gt; $(unzip 3) [(1,'a',4),(2,'b',6),(3,'c',8),(4,'d',10)]\n([1,2,3,4],\"abcd\",[4,6,8,10])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476271642, "post_id": 39997122, "comment_id": 67272570, "body": "You&#39;ve just replace, e.g., <code>zip3</code> with <code>zip @(_,_,_)</code>. It&#39;s still not general, you&#39;ve just changed where the hard-coded tuple size that the function works with to an argument."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1476271902, "post_id": 39997122, "comment_id": 67272746, "body": "@chepner It&#39;s not easier from the point of view of the user, but it does reduce the need of duplicated code in the implementation. Also, the user might  specify the type when it uses the value, by pattern-matching for example."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476272351, "post_id": 39997122, "comment_id": 67273054, "body": "That&#39;s fair enough. I do think this is probably the closest one can get to the OP&#39;s intention."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1476276905, "last_edit_date": 1476276905, "creation_date": 1476270643, "answer_id": 39997122, "question_id": 39991581, "link": "https://stackoverflow.com/questions/39991581/how-can-i-implement-generalized-zipn-and-unzipn-in-haskell/39997122#39997122", "title": "How can I implement generalized &quot;zipn&quot; and &quot;unzipn&quot; in Haskell?", "body": "<p>This is a <code>zipN</code> function that depends on the machinery of the <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.2.0\" rel=\"nofollow\">generics-sop</a> package:</p>\n\n<pre><code>{-# language TypeFamilies #-}\n{-# language DataKinds #-}\n{-# language TypeApplications #-}\n\nimport Control.Applicative\nimport Generics.SOP\n\n-- \"a\" is some single-constructor product type, like some form of n-ary tuple\n-- \"xs\" is a type-level list of the types of the elements of \"a\"\nzipN :: (Generic a, Code a ~ '[ xs ]) =&gt; NP [] xs -&gt; [a]\nzipN np = to . SOP . Z &lt;$&gt; getZipList (hsequence (hliftA ZipList np))\n\nmain :: IO ()\nmain = do\n   let zipped = zipN @(_,_,_) ([1,2,3,4,5,6] :* ['a','b','c'] :* [True,False] :* Nil)\n   print $ zipped\n</code></pre>\n\n<p>The result:</p>\n\n<pre><code>[(1,'a',True),(2,'b',False)]\n</code></pre>\n\n<p>This solution has two disadvantages:</p>\n\n<ul>\n<li>You have to wrap the argument lists in the special <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.2.0/docs/Generics-SOP.html#t:NP\" rel=\"nofollow\"><code>NP</code></a> type from <em>generics-sop</em> that is constructed with <code>:*</code> and <code>Nil</code>.</li>\n<li>You need to specify somehow that the result value is a list of tuples, and not a list of some other <code>Generic</code>-compatible type. Here, it is done with the <code>@(_,_,_)</code> type application.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1476292982, "last_edit_date": 1476292982, "creation_date": 1476271391, "answer_id": 39997340, "question_id": 39991581, "link": "https://stackoverflow.com/questions/39991581/how-can-i-implement-generalized-zipn-and-unzipn-in-haskell/39997340#39997340", "title": "How can I implement generalized &quot;zipn&quot; and &quot;unzipn&quot; in Haskell?", "body": "<p>2-ary, 3-ary.. n-ary tuples are all distinct data types, so you can't handle them uniformly directly, but you can introduce a type class that provides an interface that allows to define generic <code>zip</code> and <code>unzip</code>. Here is how it looks for generic <code>unzip</code>:</p>\n\n<pre><code>class Tuple t where\n  type Map (f :: * -&gt; *) t\n\n  nilMap   :: Proxy t -&gt; (forall a. f a) -&gt; Map f t\n  consMap  :: (forall a. a -&gt; f a -&gt; f a) -&gt; t -&gt; Map f t -&gt; Map f t\n</code></pre>\n\n<p><code>Map</code> maps all types in a tuple type with <code>f</code>. <code>nilMap</code> constructs a Mapped tuple that contains empty values (I have no idea why Haskell requires that <code>Proxy t</code> there). <code>consMap</code> receives a function, a tuple and a Mapped tuple and zip the tuples with the function pointwise. Here is how instances look for 2- and 3-tuples:</p>\n\n<pre><code>instance Tuple (a, b) where\n  type Map f (a, b) = (f a, f b)\n\n  nilMap _ a = (a, a)\n  consMap f (x, y) (a, b) = (f x a, f y b)\n\ninstance Tuple (a, b, c) where\n  type Map f (a, b, c) = (f a, f b, f c)\n\n  nilMap _ a = (a, a, a)\n  consMap f (x, y, z) (a, b, c) = (f x a, f y b, f z c)\n</code></pre>\n\n<p>The <code>gunzip</code> itself:</p>\n\n<pre><code>gunzip :: forall t. Tuple t =&gt; [t] -&gt; Map [] t\ngunzip  []    = nilMap (Proxy :: Proxy t) []\ngunzip (p:ps) = consMap (:) p (gunzip ps)\n</code></pre>\n\n<p>This looks a lot like <code>transpose</code>:</p>\n\n<pre><code>transpose :: [[a]] -&gt; [[a]]\ntranspose  []      = repeat [] -- `gunzip` handles this case better\ntranspose (xs:xss) = zipWith (:) xs (transpose xss)\n</code></pre>\n\n<p>which it basically is, except with tuples. <code>gunzip</code> can be equivalently defined in terms of <code>foldr</code> as follows:</p>\n\n<pre><code>gunzip :: forall t. Tuple t =&gt; [t] -&gt; Map [] t\ngunzip = foldr (consMap (:)) $ nilMap (Proxy :: Proxy t) []\n</code></pre>\n\n<p>To define generic <code>zip</code> we need a type class of splittable data types (is there something like this on Hackage?).</p>\n\n<pre><code>class Splittable f g where\n  split :: f a -&gt; g a (f a)\n</code></pre>\n\n<p>E.g. for lists we have</p>\n\n<pre><code>newtype MaybeBoth a b = MaybeBoth { getMaybeBoth :: Maybe (a, b) }\n\ninstance Splittable [] MaybeBoth where\n  split  []    = MaybeBoth  Nothing\n  split (x:xs) = MaybeBoth (Just (x, xs))\n</code></pre>\n\n<p>And here is what we add to the <code>Tuple</code> type class:</p>\n\n<pre><code>splitMap :: (Biapplicative g, Splittable f g) =&gt; Proxy (f t) -&gt; Map f t -&gt; g t (Map f t)\n</code></pre>\n\n<p>The <code>Biapplicative g</code> constraint ensures that it's possible to combine <code>g a b</code> and <code>g c d</code> into <code>g (a, c) (b, d)</code>. For 2- and 3- tuples it looks like this:</p>\n\n<pre><code>splitMap _ (a, b) = biliftA2 (,) (,) (split a) (split b)\n\nsplitMap _ (a, b, c) = biliftA3 (,,) (,,) (split a) (split b) (split c)\n</code></pre>\n\n<p>After providing a <code>Biapplicative</code> instance for <code>MaybeBoth</code></p>\n\n<pre><code>instance Biapplicative MaybeBoth where\n  bipure x y = MaybeBoth $ Just (x, y)\n  MaybeBoth f &lt;&lt;*&gt;&gt; MaybeBoth a = MaybeBoth $ uncurry (***) &lt;$&gt; f &lt;*&gt; a\n</code></pre>\n\n<p>we can finally define <code>gzip</code>:</p>\n\n<pre><code>gzip :: forall t. Tuple t =&gt; Map [] t -&gt; [t]\ngzip a = maybe [] (\\(p, a') -&gt; p : gzip a') . getMaybeBoth $ splitMap (Proxy :: Proxy [t]) a\n</code></pre>\n\n<p>It repeteadly cuts first elements of lists in a tuple, forms a tuple from them and prepends it to the result.</p>\n\n<p>It should be possible to generalize <code>gunzip</code> by adding a dual to <code>Splittable</code> (<code>Uniteable</code> or something like that), but I'll stop here.</p>\n\n<p><strong>EDIT</strong>: <a href=\"https://github.com/effectfully/random-stuff/blob/master/Tuple.hs\" rel=\"nofollow\">I couldn't stop</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476294798, "post_id": 40000312, "comment_id": 67288350, "body": "Doing <code>zipN</code> is considerably tougher than <code>zipWithN</code>, since (and I think this is the gist of augustss&#39; comment) tuples types are independent, unlike function types which are defined recursively."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476297989, "post_id": 40000312, "comment_id": 67290209, "body": "Yes, that&#39;s what my final paragraph is about.  It seems to me that the compiler could provide some help there, for example by exposing a primitive type-level function  <code>mkTupleType</code> of kind <code>(n : Nat) -&gt; (tys : Vec * n) -&gt; NFun tys *</code>."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476384054, "post_id": 40000312, "comment_id": 67334315, "body": "Sorry, to correct myself, what I mean is the combination of a type-level primitive like <code>mkTupleType :: (n : Nat) -&gt; Vec * n -&gt; *</code> and a value-level primitive like <code>mkTuple :: forall (n : Nat) (tys : Vec * n). NFun tys (mkTuple n tys)</code>.  Here, NFun is a hypothetical type-level function that constructs a function type from a vector of argument types and a result type (which probably exists in some form in a few generics libraries)."}, {"owner": {"reputation": 1869, "user_id": 235207, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/71c12dcecdccfa8a1932476a4cd2da27?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/235207/josh"}, "edited": false, "score": 0, "creation_date": 1476678255, "post_id": 40000312, "comment_id": 67429726, "body": "&quot;zip2, zip3 etc. all have a different number of arguments, making this an instance of arity-generic programming...&quot; not necessarily. The function could just as easily be written to take a single argument, which is a list of lists, as the &quot;unzip&quot; functions do this with their return value."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1476818328, "post_id": 40000312, "comment_id": 67504100, "body": "You can do that, of course, but then you&#39;re giving up some type safety. As I understand this question, it is about whether you can do zipn without giving up type safety."}], "tags": [], "owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "is_accepted": false, "score": 0, "last_activity_date": 1476280007, "creation_date": 1476280007, "answer_id": 40000312, "question_id": 39991581, "link": "https://stackoverflow.com/questions/39991581/how-can-i-implement-generalized-zipn-and-unzipn-in-haskell/40000312#40000312", "title": "How can I implement generalized &quot;zipn&quot; and &quot;unzipn&quot; in Haskell?", "body": "<p>You are right that these functions (zip2, zip3 etc.) are all instances of the same pattern and in an ideal world, they should be implementable generically. By the way, as an exercise to the reader, figure out what zip1 and zip0 should be ;).</p>\n\n<p>However, it is hard to implement zipN generically, because the common pattern between all the different cases is rather non-trivial.  This does not mean it's impossible to implement it generically, but you'll need some of the more advanced type system features of <strike>Haskell</strike> GHC to do it.</p>\n\n<p>To be more concrete, zip2, zip3 etc. all have a different number of arguments, making this an instance of \"arity-generic programming\" (the arity of a function is its number of arguments). As you might expect in the world of functional programming,  there is <a href=\"http://dl.acm.org/citation.cfm?id=1707799\" rel=\"nofollow\">an interesting research paper</a> that covers precisely this topic (\"arity-generic programming\"), and conveniently, one of their main examples is... zipWithN.  It doesn't directly answer your question because it uses Agda rather than Haskell, but you might still find it interesting. In any case, similar ideas can be implemented in terms of one or more of <strike>Haskell's</strike> GHC's more advanced type-system features (TypeFamilies and DataKinds come to mind).  <a href=\"http://www.seas.upenn.edu/~sweirich/papers/aritygen.pdf\" rel=\"nofollow\">PDF version here</a>.</p>\n\n<p>By the way, this is just about an arity-generic zipWithN.  For an arity-generic zipN, you probably need some support from the compiler, particularly an arity-generic interface to the tuple constructor, which I suspect might not be in GHC. This is what I believe augustss's comment to the question and chepner's comment to Alec's answer refer to.</p>\n"}], "owner": {"reputation": 1869, "user_id": 235207, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/71c12dcecdccfa8a1932476a4cd2da27?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/235207/josh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 921, "favorite_count": 1, "accepted_answer_id": 39992104, "answer_count": 4, "score": 5, "last_activity_date": 1476397947, "creation_date": 1476252574, "last_edit_date": 1476292166, "question_id": 39991581, "link": "https://stackoverflow.com/questions/39991581/how-can-i-implement-generalized-zipn-and-unzipn-in-haskell", "title": "How can I implement generalized &quot;zipn&quot; and &quot;unzipn&quot; in Haskell?", "body": "<p>I find this documentation in the basic Haskell libraries:</p>\n\n<pre><code>zip :: [a] -&gt; [b] -&gt; [(a, b)]\n    zip takes two lists and returns a list of corresponding pairs. If one input list is short, excess elements of the longer list are discarded.\n\nzip3 :: [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]\n    zip3 takes three lists and returns a list of triples, analogous to zip.\n\nzip4 :: [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [(a, b, c, d)]\n    The zip4 function takes four lists and returns a list of quadruples, analogous to zip.\n\n[...snip...]\n\nunzip :: [(a, b)] -&gt; ([a], [b])\n    unzip transforms a list of pairs into a list of first components and a list of second components.\n\nunzip3 :: [(a, b, c)] -&gt; ([a], [b], [c])\n    The unzip3 function takes a list of triples and returns three lists, analogous to unzip.\n\nunzip4 :: [(a, b, c, d)] -&gt; ([a], [b], [c], [d])\n    The unzip4 function takes a list of quadruples and returns four lists, analogous to unzip.\n</code></pre>\n\n<p>... and so on, up to zip7 and unzip7.</p>\n\n<p>Is this a fundamental limitation of Haskell's type system? Or is there a way to implement zip and unzip once, to work on different configurations of input?</p>\n"}, {"tags": ["haskell", "inline"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476253406, "post_id": 39991318, "comment_id": 67261606, "body": "Looks like forcing the inlining to happen earlier is causing some other rules to not fire properly..."}], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1476301017, "post_id": 39994457, "comment_id": 67291924, "body": "Ok awesome thank you! In that case should I always leave foldlp not inlined? Or does it depend on the situation (across module boundaries for example). Is there a way to tell GHC to inline but try other optimizations first? <code>INLINABLE</code> perhaps?"}, {"owner": {"reputation": 343, "user_id": 5085294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOFvi.png?s=128&g=1", "display_name": "Christof Schramm", "link": "https://stackoverflow.com/users/5085294/christof-schramm"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1476338147, "post_id": 39994457, "comment_id": 67304096, "body": "From how I understand the docs, GHC automatically detects when it&#39;s advantageous to inline a function, and does so. So I would recommend not to use the <code>INLINE</code> pragma unless you have a specific reason."}], "tags": [], "owner": {"reputation": 343, "user_id": 5085294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOFvi.png?s=128&g=1", "display_name": "Christof Schramm", "link": "https://stackoverflow.com/users/5085294/christof-schramm"}, "is_accepted": true, "score": 5, "last_activity_date": 1476294988, "last_edit_date": 1476294988, "creation_date": 1476262584, "answer_id": 39994457, "question_id": 39991318, "link": "https://stackoverflow.com/questions/39991318/why-does-adding-inline-slow-down-my-program/39994457#39994457", "title": "Why does adding INLINE slow down my program", "body": "<p>According to <a href=\"https://downloads.haskell.org/~ghc/7.10.3/docs/html/users_guide/pragmas.html\" rel=\"nofollow\">the GHC docs</a> the <code>INLINE</code> pragma prevents other compiler optimizations in order to still let rewrite rules take effect.</p>\n\n<p>So my guess would be, that by using <code>INLINE</code> you remove some optimization, that GHC would have applied to make your code faster.</p>\n\n<p>After some poking around in the core (use <code>-ddump-simpl</code> in compilation) I found the optimization, that GHC performs. For this I took a look at the core for <code>foldlp</code> with inlining and without inlining:</p>\n\n<p>Inlined:</p>\n\n<pre><code>foldlp =\n  \\ (@ b_a10N)\n    (@ a_a10O)\n    (eta_B2 :: b_a10N -&gt; a_a10O -&gt; b_a10N)\n    (eta1_B1 :: b_a10N -&gt; Bool)\n    (eta2_X3 :: b_a10N)\n    (eta3_X5 :: [a_a10O]) -&gt;\n    letrec {\n      go_s1Ao [Occ=LoopBreaker] :: b_a10N -&gt; [a_a10O] -&gt; b_a10N\n      [LclId, Arity=2, Str=DmdType &lt;L,U&gt;&lt;S,1*U&gt;]\n      go_s1Ao =\n        \\ (b1_avT :: b_a10N) (ds_d1xQ :: [a_a10O]) -&gt;\n        -- Removed the actual definition of go for brevity,\n        -- it's the same in both cases\n          }; } in\n    go_s1Ao eta2_X3 eta3_X5\n</code></pre>\n\n<p>Non-inlined:</p>\n\n<pre><code>foldlp =\n  \\ (@ b_a10N)\n    (@ a_a10O)\n    (f_avQ :: b_a10N -&gt; a_a10O -&gt; b_a10N)\n    (p_avR :: b_a10N -&gt; Bool) -&gt;\n    letrec {\n      go_s1Am [Occ=LoopBreaker] :: b_a10N -&gt; [a_a10O] -&gt; b_a10N\n      [LclId, Arity=2, Str=DmdType &lt;L,U&gt;&lt;S,1*U&gt;]\n      go_s1Am =\n        \\ (b1_avT :: b_a10N) (ds_d1xQ :: [a_a10O]) -&gt;\n        -- Removed the actual definition of go for brevity,\n        -- it's the same in both cases\n          }; } in\n    go_s1Am\n</code></pre>\n\n<p>The relevant difference is in the very last line. The optimizer takes away the step of actually having to call <code>foldlp</code> to call <code>go</code> and just makes a function with two arguments out of foldlp that returns a function with two arguments. With inlining this optimization is not performed and the core looks exactly like the code you wrote.</p>\n\n<p>I verified this by writing three variants of <code>foldlp</code>:</p>\n\n<pre><code>module Main where\n\nfoldlp :: (b -&gt; a -&gt; b) -&gt; (b -&gt; Bool) -&gt; b -&gt; [a] -&gt; b\nfoldlp f p = go where\n      go b [] = b\n      go b (x : xs)\n        | p b = go (f b x) xs\n        | otherwise = b\n\n{-# INLINE foldlpInline #-}\nfoldlpInline :: (b -&gt; a -&gt; b) -&gt; (b -&gt; Bool) -&gt; b -&gt; [a] -&gt; b\nfoldlpInline f p = go where\n      go b [] = b\n      go b (x : xs)\n        | p b = go (f b x) xs\n        | otherwise = b\n\n\n{-# INLINE foldlp' #-} -- So that the code is not optimized\nfoldlp' b [] = b\nfoldlp' b (x : xs)\n        | (/= 0) b = foldlp' (mult b x) xs\n        | otherwise = b\n\nmult :: Integer -&gt; Integer -&gt; Integer\nmult 0 _ = 0\nmult x y = x * y\n\n--main = print $ foldlp mult (/= 0) 1 $ replicate (10 ^ 7) 1\n--main = print $ foldlpInline mult (/= 0) 1 $ replicate (10 ^ 7) 1\nmain = print $ foldlp' 1 $ replicate (10 ^ 7) 1\n</code></pre>\n\n<p>The results are:</p>\n\n<p>First case (normal non-inlined):</p>\n\n<pre><code>./test  0,42s user 0,01s system 96% cpu 0,446 total\n</code></pre>\n\n<p>Second case (inlined):</p>\n\n<pre><code>./test  0,83s user 0,02s system 98% cpu 0,862 total\n</code></pre>\n\n<p>Third case (what the compiler produces for non-inlined)</p>\n\n<pre><code>./test  0,42s user 0,01s system 99% cpu 0,432 total\n</code></pre>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 39994457, "answer_count": 1, "score": 5, "last_activity_date": 1476294988, "creation_date": 1476251325, "question_id": 39991318, "link": "https://stackoverflow.com/questions/39991318/why-does-adding-inline-slow-down-my-program", "title": "Why does adding INLINE slow down my program", "body": "<p>I was looking into making a <code>foldl</code> that worked on infinite lists, for situations where you could not obtain guarded recursion but where depending the first argument the second argument might not be used.</p>\n\n<p>For example multiplication, where usually you need both arguments and guarded recursion does not work, but if the first argument is 0 you can short circuit.</p>\n\n<p>So I wrote the following function:</p>\n\n<pre><code>foldlp :: (b -&gt; a -&gt; b) -&gt; (b -&gt; Bool) -&gt; b -&gt; [a] -&gt; b\nfoldlp f p = go where\n    go b [] = b\n    go b (x : xs) \n        | p b = go (f b x) xs\n        | otherwise = b\n</code></pre>\n\n<p>And tested it with my custom short circuiting multiplication function:</p>\n\n<pre><code> mult :: Integer -&gt; Integer -&gt; Integer\n mult 0 _ = 0\n mult x y = x * y\n\n main :: IO ()\n main = print . &lt;test_function&gt;\n</code></pre>\n\n<p>The results I got with <code>-prof -fprof-auto -O2</code>, <code>+RTS -p</code> were:</p>\n\n<pre><code>foldlp mult (/= 0) 1 $ replicate (10 ^ 7) 1\ntotal time = 0.40 secs\ntotal alloc = 480,049,336 bytes\n\nfoldlp mult (`seq` True) 1 $ replicate (10 ^ 7) 1\ntotal time = 0.37 secs\ntotal alloc = 480,049,336 bytes\n\nfoldl' mult 1 $ replicate (10 ^ 7) 1\ntotal time = 0.37 secs\ntotal alloc = 480,049,352 bytes\n\nfoldl mult 1 $ replicate (10 ^ 7) 1\ntotal time = 0.74 secs\ntotal alloc = 880,049,352 bytes\n\nfoldr mult 1 $ replicate (10 ^ 7) 1\ntotal time = 0.87 secs\ntotal alloc = 880,049,336 bytes\n</code></pre>\n\n<p>Which was very promising, as my custom function allows for flexible types of strictness, and also works on infinite lists</p>\n\n<p>The first example will terminate as soon as it hits a <code>0</code>, as will <code>foldr</code>, but <code>foldr</code> is much slower.</p>\n\n<p>It avoids issues such as thunks within tuples, seeing as <code>((1 + 2) + 3, (10 + 20) + 30)</code> is technically in WHNF, breaking <code>foldl'</code>.</p>\n\n<p>You can re-obtain <code>foldl</code> with <code>flip foldl (const True)</code> and <code>foldl'</code> with <code>flip foldl (</code>seq<code>True)</code>. And the performance characteristics of the original restricted functions seem to be re-obtained by doing so.</p>\n\n<p>So as a side note I think <code>foldlp</code> would be a worthwhile addition to <code>Foldable</code>.</p>\n\n<p>But my actual question was why when I added <code>{-# INLINE foldlp #-}</code> the functions performance went down significantly, giving me:</p>\n\n<pre><code>foldlp mult (/= 0) 1 $ replicate (10 ^ 7) 1\ntotal time = 0.67 secs\ntotal alloc = 800,049,336 bytes\n</code></pre>\n\n<p>So my real question is why that is happening. I thought the downside of inlining was code bloat, not significant negative effects on runtime performance and increased memory usage.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1476248596, "post_id": 39990625, "comment_id": 67259969, "body": "For you to ponder: should <code>(\\x y -&gt; x + y + 0)</code> be equal to <code>(\\x y -&gt; x + y)</code>? If so, by what algorithm do you propose to determine this? If not, are you really comfortable with a refactoring that changes <code>reduce (\\x y -&gt; x + y)</code> to <code>reduce (\\x y -&gt; x + y + 0)</code> -- an apparently harmless local rewrite -- changing the behavior in such a drastic way? (I&#39;m not saying these questions are unanswerable, but thinking carefully about how to answer them may be enlightening.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1476248826, "post_id": 39990625, "comment_id": 67260041, "body": "Possibly related question: <a href=\"http://stackoverflow.com/q/17045941/791604\">How to compare two functions for equivalence?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1476248171, "creation_date": 1476248171, "answer_id": 39990778, "question_id": 39990625, "link": "https://stackoverflow.com/questions/39990625/haskell-function-that-sums-and-multiplies-numbers-of-a-list/39990778#39990778", "title": "haskell function that sums AND multiplies numbers of a list", "body": "<blockquote>\n  <p>What does it mean exactly? Any ideas? Thanks in advance</p>\n</blockquote>\n\n<p>You're trying to compare some <code>(Int -&gt; Int -&gt; Int)</code> to another one. But functions cannot get checked on equality. Provide the initial value instead:</p>\n\n<pre><code>reduce :: (Int -&gt; Int -&gt; Int) -&gt; (Int -&gt; Bool) -&gt; Int -&gt; [Int] -&gt; Int\nreduce op f x xs = foldl op x (filter f xs)\n</code></pre>\n\n<p>By the way, you can generalize your function's type:</p>\n\n<pre><code>reduce :: (b -&gt; a -&gt; b) -&gt; (a -&gt; Bool) -&gt; b -&gt; [a] -&gt; a\nreduce op f x xs = foldl op x (filter f xs)\n</code></pre>\n\n<p>Alternatively, use a monoid and <code>foldMap</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1476249336, "last_edit_date": 1476249336, "creation_date": 1476248305, "answer_id": 39990810, "question_id": 39990625, "link": "https://stackoverflow.com/questions/39990625/haskell-function-that-sums-and-multiplies-numbers-of-a-list/39990810#39990810", "title": "haskell function that sums AND multiplies numbers of a list", "body": "<p>It means that with your current imports you cannot compare functions for equality (and even with suitable imports, there is no really good way to do the equality you ask for).</p>\n\n<p>One simple solution is to demand that the user provide both the operation and the unit, thus:</p>\n\n<pre><code>reduce op u x y = foldl op u (filter x y)\n</code></pre>\n\n<p>In many cases of interest, there is already a <code>Monoid</code> instance that specifies the operator and unit. For example, there are the <code>Sum</code> and <code>Product</code> instances, so you might consider writing</p>\n\n<pre><code>reduce inject p = foldMap inject . filter p\n</code></pre>\n\n<p>which would be used like this:</p>\n\n<pre><code>&gt; reduce Sum even [1..5]\nSum {getSum = 6}\n&gt; reduce Product odd [1..5]\nProduct {getProduct = 15}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5343720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8cb0e79384730275d9b6f4e70900616?s=128&d=identicon&r=PG&f=1", "display_name": "StarCharm", "link": "https://stackoverflow.com/users/5343720/starcharm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 39990810, "answer_count": 2, "score": 1, "last_activity_date": 1476249336, "creation_date": 1476247144, "question_id": 39990625, "link": "https://stackoverflow.com/questions/39990625/haskell-function-that-sums-and-multiplies-numbers-of-a-list", "title": "haskell function that sums AND multiplies numbers of a list", "body": "<p>I'm trying to do a function that given an operator and a function will go through a list like such: </p>\n\n<pre><code>reduce (*) even [1,2,3,4,5] =&gt; 8\nreduce (+) odd [1,2,3,4,5]  =&gt; 9\n</code></pre>\n\n<p>At first I had something like this:</p>\n\n<pre><code>reduce :: (Int-&gt; Int-&gt; Int) -&gt; (Int-&gt;Bool) -&gt; [Int] -&gt; Int\nreduce op x y = foldl op 1 (filter x y)\n</code></pre>\n\n<p>and it worked fine for multiplying, but added one number when trying to do a sum. So I thought of adding an if: </p>\n\n<pre><code>reduce :: (Int-&gt; Int-&gt; Int) -&gt; (Int-&gt;Bool) -&gt; [Int] -&gt; Int\nreduce op x y = \n    if op == (*) then foldl op 1 (filter x y)\n        else if op == (+) then foldl op 0 (filter x y)\n            else 0\n</code></pre>\n\n<p>However when I do this I get the following error:</p>\n\n<p>Instance of Eq (Int -> Int -> Int) required for definition of reduce</p>\n\n<p>What does it mean exactly? Any ideas? Thanks in advance</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1476380299, "post_id": 39990740, "comment_id": 67332347, "body": "@ Zeta Wow! Thank you so much! I wish I could accept both answers. I marked the other one, since it built of my solution but this answer was extremely useful too. Thanks again for the detailed response!"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1476247881, "creation_date": 1476247881, "answer_id": 39990740, "question_id": 39990592, "link": "https://stackoverflow.com/questions/39990592/how-to-count-the-number-of-even-integers-in-a-list-in-haskell-with-state-monad/39990740#39990740", "title": "How to count the number of even integers in a list in Haskell with State monad?", "body": "<p>Let's get back to the drawing board. The actual function you want to use is something like</p>\n\n<pre><code>countEven :: [Int] -&gt; Int\ncountEven xs = runStateMagic xs\n</code></pre>\n\n<p>where <code>runStateMagic</code> uses some <code>State</code> hidden in its depths. How could that function look like? Well, it has to use either <code>execState</code> or <code>evalState</code>. Since we're interested in the state only (aka, our current count of numbers), so let's replace <code>runStateMagic</code> with <code>execState</code>:</p>\n\n<pre><code>countEven :: [Int] -&gt; Int\ncountEven xs = execState someState 0\n</code></pre>\n\n<p>Now, <code>execState</code>'s type fixes our <code>stateFunc</code> to <code>State Int a</code>. The actual value type of the state is arbitrary, since we're not going to use it anyway. So what should <code>someState</code> do? It should probably work on the list, and use <code>modify' (+1)</code> if we have an even number. Let's write a helper for that:</p>\n\n<pre><code>increaseIfEven :: Int -&gt; State Int ()\nincreaseIfEven n\n  | even n    = modify' inc\n  | otherwise = return ()\n</code></pre>\n\n<p>This will now modify the state iff the number was even. All we have to do is to apply this to every element on the list. Therefore, for a list <code>xs</code>, we can simply do</p>\n\n<pre><code>mapM_ increaseIfEven xs\n</code></pre>\n\n<p>Remember, <code>mapM_ :: (a -&gt; m b) -&gt; [a] -&gt; m ()</code>. But in our case, that <code>m</code> is <code>State Int</code>, so it already contains our counter.</p>\n\n<p>All in all, we end up with</p>\n\n<pre><code>countEven :: [Int] -&gt; Int\ncountEven xs = execState (mapM_ increaseIfEven xs) 0\n</code></pre>\n\n<p>But keep in mind: the important part was to fix the type of the original function, <code>f'</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 890, "user_id": 1412133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/703fbc991fd63e0e1db54dca9ea31b53?s=128&d=identicon&r=PG", "display_name": "lab419", "link": "https://stackoverflow.com/users/1412133/lab419"}, "edited": false, "score": 0, "creation_date": 1476279778, "post_id": 39991170, "comment_id": 67278105, "body": "maybe even nicer as follows ;)       f&#39; :: [Int] -&gt; State Int () f&#39; = mapM_ (\\x -&gt; when (even x) (modify (+1)))"}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1476380339, "post_id": 39991170, "comment_id": 67332378, "body": "Thanks so much for the detailed explanations!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1476250489, "creation_date": 1476250489, "answer_id": 39991170, "question_id": 39990592, "link": "https://stackoverflow.com/questions/39990592/how-to-count-the-number-of-even-integers-in-a-list-in-haskell-with-state-monad/39991170#39991170", "title": "How to count the number of even integers in a list in Haskell with State monad?", "body": "<p>The other answer starts from scratch to build up an implementation. I think it is also worth seeing a minimal change to your existing code to make it sensible. We will even keep your existing type -- though the other answer proposes that it be changed, I think it is acceptable (if not great).</p>\n\n<p>In my opinion, the real problem is that you have recursed only in one branch of your <code>if</code>. What we really want is to recurse whether or not the current element is even. So:</p>\n\n<pre><code>f' (x:xs) = do\n    if x `mod` 2 == 0 then state (\\s -&gt; ((), s+1)) -- increase the count by one\n                      else state (\\s -&gt; ((), s  )) -- don't increase the count by one\n    rest &lt;- f' xs -- compute the answer for the rest of the list\n    return (x:rest) -- reconstruct the answer for the whole list\n</code></pre>\n\n<p>We can check that it does the right thing in ghci:</p>\n\n<pre><code>&gt; runState (f' [1..5]) 0\n([1,2,3,4,5],2)\n</code></pre>\n\n<p>This is just about the smallest change you can make to get your implementation idea working.</p>\n\n<p>From there, I would suggest a number of refactorings. First, your pervasive use of <code>state</code> is a code smell. I would write the various uses in this way instead:</p>\n\n<pre><code>f' [] = return []\nf' (x:xs) = do\n    if x `mod` 2 == 0 then modify (+1) else return ()\n    rest &lt;- f' xs\n    return (x:rest)\n</code></pre>\n\n<p>From here, I would use the <code>even</code> function in the conditional, and notice that the <code>when</code> function implements the \"do some action or <code>return ()</code>\" operation. So:</p>\n\n<pre><code>f' [] = return []\nf' (x:xs) = do\n    when (even x) (modify (+1))\n    rest &lt;- f' xs\n    return (x:rest)\n</code></pre>\n\n<p>Additionally, we actually have a combinator for running a monadic action on each element of a list; that is <code>mapM</code>. So we can turn the above explicit recursion into an implicit one in this way:</p>\n\n<pre><code>f' xs = mapM (\\x -&gt; when (even x) (modify (+1)) &gt;&gt; return x) xs\n</code></pre>\n\n<p>Finally, I think it a little bit odd that the function returns the list it consumed. Not <em>unidiomatic</em>, per se, as the previous objections have been, but maybe not what you want. If it turns out that you don't plan on using the resulting list in any followup computation, it will be more efficient to throw it away as you go; and the <code>mapM_</code> combinator does this. So:</p>\n\n<pre><code>f' :: [Int] -&gt; State Int ()\nf' xs = mapM_ (\\x -&gt; when (even x) (modify (+1))) xs\n</code></pre>\n\n<p>At this point, I would consider <code>f'</code> to be quite a nice implementation of the idea you have proposed.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 886, "favorite_count": 2, "accepted_answer_id": 39991170, "answer_count": 2, "score": 2, "last_activity_date": 1476250489, "creation_date": 1476246875, "question_id": 39990592, "link": "https://stackoverflow.com/questions/39990592/how-to-count-the-number-of-even-integers-in-a-list-in-haskell-with-state-monad", "title": "How to count the number of even integers in a list in Haskell with State monad?", "body": "<p>I am trying to grok some of the fundamentals of the State Monad in Haskell, by constructing my own examples. </p>\n\n<p>Consider a simple example where I want to count the number of even integers in an array of integers. Sure this can be done very easily using pure functions, but I wanted to try the round-about State monad route, where we keep a counter that keeps incrementing for every element that has been checked. </p>\n\n<p>Here is a partial (but obviously  wrong) attempt that I have managed to come up with thus far. </p>\n\n<pre><code>import Control.Monad.State\n\nf' :: [Int] -&gt; State Int [Int]\nf' []     = state (\\s -&gt; ([],s)) \nf' (x:xs) = if x `mod` 2 == 0 then state (\\s -&gt; ((x:xs), s+1)) -- how can I fix this line? \n            else f' xs\n</code></pre>\n\n<p>This code compiles, but clearly does not give the right answer. How then can I fix this code, to do something similar to the following Python code</p>\n\n<pre><code>counter = 0 # incremented when we encounter an even integer.\nfor elt in integer_list:\n   if elt % 2 == 0 :\n      counter = counter + 1 \n</code></pre>\n"}, {"tags": ["list", "haskell", "function-parameter"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1476233671, "post_id": 39988742, "comment_id": 67256482, "body": "What is your actual question?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1476260738, "post_id": 39988742, "comment_id": 67265610, "body": "What do you want <code>xyz</code> to actually <i>do</i>? What is stopping it working now?"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1476235757, "post_id": 39988841, "comment_id": 67256911, "body": "<code>xyz a b = (length a, length b)</code>"}], "tags": [], "owner": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "is_accepted": false, "score": 1, "last_activity_date": 1476237379, "last_edit_date": 1476237379, "creation_date": 1476232947, "answer_id": 39988841, "question_id": 39988742, "link": "https://stackoverflow.com/questions/39988742/how-to-take-lists-of-any-types-as-function-parameters-haskell/39988841#39988841", "title": "How to Take Lists of Any Types as Function Parameters Haskell", "body": "<p>Well, you pretty much got it already. Just write the signature like that and define your function. Except in a real-life application you will (probably; see @amalloy's comment) need to require <code>a</code> to belong to some type class, in order to do something meaningful with it:</p>\n\n<pre><code>xyz :: Integral a =&gt; [a] -&gt; [a] -&gt; (Int, Int)\nxyz ls1 ls2 = (x, y) where\n    x = fromInteger $ toInteger $ sum ls1\n    y = fromInteger $ toInteger $ sum ls2\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 2680579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c0026374c801af06cb2c93ee1944ffe?s=128&d=identicon&r=PG&f=1", "display_name": "user2680579", "link": "https://stackoverflow.com/users/2680579/user2680579"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1476237379, "creation_date": 1476232020, "question_id": 39988742, "link": "https://stackoverflow.com/questions/39988742/how-to-take-lists-of-any-types-as-function-parameters-haskell", "title": "How to Take Lists of Any Types as Function Parameters Haskell", "body": "<p>Hello I want to take lists of any type e.g. <code>[Int]</code>, <code>[Char]</code>, etc as parameters to a function. </p>\n\n<p>Basically all I want to do is something along the lines of: </p>\n\n<pre><code>xyz :: [a] -&gt; [a] -&gt; (Int, Int)\n</code></pre>\n\n<p>Were <code>[a]</code> could be a list of any type. </p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1476238544, "post_id": 39988558, "comment_id": 67257542, "body": "I changed the framing around your solution rather drastically. Feel free to revert the changes if you don&#39;t like them."}], "tags": [], "owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "is_accepted": true, "score": 4, "last_activity_date": 1476238455, "last_edit_date": 1476238455, "creation_date": 1476230479, "answer_id": 39988558, "question_id": 39988557, "link": "https://stackoverflow.com/questions/39988557/analog-of-not-requiring-monoid-for-traversal/39988558#39988558", "title": "Analog of `&lt;&lt;%~` not requiring Monoid for Traversal", "body": "<p>If we don't want to require a <code>Monoid</code> constraint on the targets, we have to specify ourselves the <code>Monoid</code> that will be used for combining the old elements in a traversal. As the goal is something analogous to <code>^?</code>, the appropriate monoid is <code>First</code>.</p>\n\n<pre><code>(&lt;&lt;?%~) :: LensLike ((,) (First a)) s t a b -&gt; (a -&gt; b) -&gt; s -&gt; (Maybe a, t)\nl &lt;&lt;?%~ f = first getFirst . (l $ \\a -&gt; (First (Just a), f a))\n</code></pre>\n"}], "owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 1, "accepted_answer_id": 39988558, "answer_count": 1, "score": 5, "last_activity_date": 1476238455, "creation_date": 1476230479, "question_id": 39988557, "link": "https://stackoverflow.com/questions/39988557/analog-of-not-requiring-monoid-for-traversal", "title": "Analog of `&lt;&lt;%~` not requiring Monoid for Traversal", "body": "<p>I need a function like <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Operators.html#v:-60--60--37--126-\"><code>&lt;&lt;%~</code></a> which would act with <code>Traversal</code>s in similar fashion to <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Fold.html#v:-94--63-\"><code>^?</code></a>, like this:</p>\n\n<pre><code>(&lt;&lt;?%~) :: Traversal s t a b -&gt; (a -&gt; b) -&gt; s -&gt; (Maybe a, t)\n\n&gt; ix 0 &lt;&lt;?%~ succ $ [1,2]\n(Just 1,[2,2])\n&gt; ix 1 &lt;&lt;?%~ succ $ [1,2]\n(Just 2,[1,3])\n&gt; ix 2 &lt;&lt;?%~ succ $ [1,2]\n(Nothing,[1,2])\n</code></pre>\n\n<p>How should I implement it? The obvious way is to apply <code>^?</code> and <code>%~</code> separately, but I'd like a solution in one go.</p>\n"}, {"tags": ["haskell", "binary-tree", "fold"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476229361, "post_id": 39988364, "comment_id": 67255597, "body": "Given that this is a homework assignment, I&#39;m not sure you should be seeking this much help from StackOverflow... Perhaps you could formulate a question about a specific error you are getting?"}, {"owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476229612, "post_id": 39988364, "comment_id": 67255648, "body": "@Alec well, I&#39;ve been told that not in scope a, left and right."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1476230608, "post_id": 39988364, "comment_id": 67255839, "body": "@o1xhack one way to stay clean (during haskell development) is to add type signatures to all of your (top-level) functions, and if something is not in scope - you might try to add it on the left hand side of your function definition. Another hint I want to give - <code>sum</code> is something already defined - you are shadowing the original definition, which is usually a bad idea. Turn on <code>-Wall</code> when compiling - this saves you a lot of hassle in the long run."}, {"owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1476231019, "post_id": 39988364, "comment_id": 67255938, "body": "@epsilonhalbe what do you mean turn on -Wall? I&#39;m using sublime to build. Like I first said , I define Tree a wither leaf or node, this isn&#39;t enough?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1476231206, "post_id": 39988364, "comment_id": 67255976, "body": "<code>-Wall</code> is a <code>ghc-option</code> that shows all warnings, but nevermind; the problem you have I think is that you try to think too advanced, take a simple recursive function and define a case for <code>countLeaves Leaf = \u2026</code> and one <code>countLeaves (Node x l r) = \u2026</code> and you should be fine, don&#39;t worry yet about <code>folding</code>, <code>traversing</code> and whatnot - you&#39;ll learn it soon enough."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476245312, "post_id": 39988364, "comment_id": 67259138, "body": "Seems like there is a misunderstanding of the role and semantics of <code>fold</code> - since you are to use the <code>fold</code> function, perhaps you should review its semantics."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1476259688, "post_id": 39988865, "comment_id": 67265017, "body": "Maybe we should clarify that this does not fix the code, there are other issues the OP has to solve."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1476233152, "creation_date": 1476233152, "answer_id": 39988865, "question_id": 39988364, "link": "https://stackoverflow.com/questions/39988364/haskell-leafcount-function-take-tree-output-int-using-fold-fun/39988865#39988865", "title": "Haskell: leafCount function take Tree output Int using fold fun", "body": "<p>Your immediate problem is that you are doing the pattern matching on the wrong side of the <code>=</code>:</p>\n\n<pre><code>leafCount (Node a left right) = fold sum left right a\n       where sum l r elem = leafCount left + leafCount right + 1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "is_accepted": true, "score": 0, "last_activity_date": 1476325080, "creation_date": 1476325080, "answer_id": 40011223, "question_id": 39988364, "link": "https://stackoverflow.com/questions/39988364/haskell-leafcount-function-take-tree-output-int-using-fold-fun/40011223#40011223", "title": "Haskell: leafCount function take Tree output Int using fold fun", "body": "<p>It's really easy actually, I forget to add the base case of the fold function when using it!</p>\n\n<p>After I reading the fold stuff and ask other person, I figure this out!</p>\n"}], "owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 40011223, "answer_count": 2, "score": -1, "last_activity_date": 1476325080, "creation_date": 1476229032, "last_edit_date": 1495542817, "question_id": 39988364, "link": "https://stackoverflow.com/questions/39988364/haskell-leafcount-function-take-tree-output-int-using-fold-fun", "title": "Haskell: leafCount function take Tree output Int using fold fun", "body": "<p>I define Tree type as:</p>\n\n<pre><code>data Tree a = Leaf | Node a (Tree a) (Tree a)\n        deriving (Show, Eq)\n</code></pre>\n\n<p>Here are a fold function : <a href=\"https://stackoverflow.com/questions/39967560/how-to-write-a-function-of-type-a-b-b-b-for-folding-a-tree\">How to write a function of type a-&gt; b -&gt; b -&gt; b for folding a tree</a>, basically same as what I using.</p>\n\n<p>Now I want to write a function <code>leafCount :: Tree a -&gt; Integer</code>, using fold and at most one helper function, I think I need to distinct leaf and node in different situation but I'm struggle with doing this, here is my code for now:</p>\n\n<pre><code>leafCount = fold sum (Node a left right)\n            where \n            sum left right elem = leafCount left + leafCount right + 1\n</code></pre>\n\n<p>There are lot of errors in this code now that I cannot figure out at all. Please give me the basic idea and the code that can improve mine.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1476225585, "post_id": 39987636, "comment_id": 67254633, "body": "Because it&#39;s fun to see what changes are important, you can also try applying various optimizations by hand. From my experiments, the important two are lifting the definition of the set and making sure it&#39;s monomorphic. In ghci <code>let s = fromAscList [2..i-1] :: Set Integer in [x | x &lt;- [1..i], x `notMember` s]</code> is instant, while <code>let s = [2..i-1] :: [Integer] in [x | x &lt;- [1..i], x `notElem` s</code> is about twice as fast as OP&#39;s list-based code but still orders of magnitude slower than the <code>Set</code> version."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476244725, "post_id": 39987636, "comment_id": 67258983, "body": "I believe it should be <code>ghci -fobject-code</code> in order to load the compiled version instead of interpreting. (of course you could have a <code>main</code> in the module, so it doesn&#39;t affect the answer)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476244965, "post_id": 39987636, "comment_id": 67259055, "body": "@user2407038 I think if the object file file is already there the compiled version is loaded (at least that seems to be the case)."}, {"owner": {"reputation": 1075, "user_id": 1299428, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/330bcefb9bb0b6a8e071e5c8b2ff9d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Sophie", "link": "https://stackoverflow.com/users/1299428/sophie"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1476259905, "post_id": 39987636, "comment_id": 67265158, "body": "@DanielWagner answer is very useful to me. \u200aThe <code>let</code> gives the compiler the hint that <code>s</code> does not depend on <code>x</code>. Haven&#39;t seen things like that mentioned in Haskell books. Maybe I am reading the wrong books."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1476224136, "creation_date": 1476224136, "answer_id": 39987636, "question_id": 39987459, "link": "https://stackoverflow.com/questions/39987459/haskell-data-set-notmember-slower-then-notelem/39987636#39987636", "title": "Haskell: Data.Set `notMember` slower then `notElem`?", "body": "<p>This is just because optimizations haven't happened yet. If you put the following into a file <code>F.hs</code>:</p>\n\n<pre><code>module F (f1,f2) where\n\nimport Data.Set\n\n-- should be slow\nf1 :: Int -&gt; [Int]\nf1 i = [ x | x &lt;- [1..i] , x `notElem` [2..i-1] ]\n-- should be fast\nf2 :: Int -&gt; [Int]\nf2 i = [ x | x &lt;- [1..i] , x `notMember` fromAscList [2..i-1] ]\n</code></pre>\n\n<p>And compile it first with optimizations, you get the following:</p>\n\n<pre><code>$ ghc -O2 F.hs       # compile with optimizations\n[1 of 1[ Compiling F            ( F.hs, F.o )\n\n$ ghci F.hs          # now load it up in GHCi\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nOk, modules loaded: F (F.o)\nPrelude F&gt; :set +s\nPrelude F&gt; f1 20000\n[1,20000]\n(2.16 secs, 2,030,440 bytes)\nPrelude F&gt; f2 20000\n[1,20000]\n(0.05 secs, 4,591,312 bytes)\n</code></pre>\n\n<p>My guess is that in your situation you had GHCi recalculating <code>fromAscList [2..i-1]</code> multiple times, or something similar.</p>\n"}], "owner": {"reputation": 1075, "user_id": 1299428, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/330bcefb9bb0b6a8e071e5c8b2ff9d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Sophie", "link": "https://stackoverflow.com/users/1299428/sophie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 39987636, "answer_count": 1, "score": 3, "last_activity_date": 1476259519, "creation_date": 1476223193, "last_edit_date": 1476259519, "question_id": 39987459, "link": "https://stackoverflow.com/questions/39987459/haskell-data-set-notmember-slower-then-notelem", "title": "Haskell: Data.Set `notMember` slower then `notElem`?", "body": "<p>I expect <code>f1</code> is <em>O(i\u00b2)</em> and <code>f2</code> is <em>O(i\u200a\u00b7\u200alog\u200ai)</em>. What is going on here?</p>\n\n<pre><code>import Data.Set\n\ni = 20000\n\n-- should be slow\nf1 = [ x | x &lt;- [1..i] , x `notElem` [2..i-1] ]\n-- should be fast\nf2 = [ x | x &lt;- [1..i] , x `notMember` fromAscList [2..i-1] ]\n</code></pre>\n\n<p>ghci output:</p>\n\n<pre><code>*Main&gt; f1\n[1,20000]\n(7.12 secs, 16,013,697,360 bytes)\n*Main&gt; f2\n[1,20000]\n(44.27 secs, 86,391,426,456 bytes)\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1476216034, "post_id": 39985296, "comment_id": 67250138, "body": "Related question: <a href=\"https://stackoverflow.com/questions/27095011/what-exactly-is-the-kind-in-haskell\" title=\"what exactly is the kind in haskell\">stackoverflow.com/questions/27095011/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 8, "last_activity_date": 1476216901, "creation_date": 1476216901, "answer_id": 39985957, "question_id": 39985296, "link": "https://stackoverflow.com/questions/39985296/what-are-lifted-and-unlifted-product-types-in-haskell/39985957#39985957", "title": "What are lifted and unlifted product types in Haskell?", "body": "<p>From the GHC <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/TypeType\" rel=\"noreferrer\">documentation</a>:</p>\n\n<pre><code>Lifted\n\nA type is lifted iff it has bottom as an element.\n</code></pre>\n\n<p>A value of a lifted type can be <a href=\"https://wiki.haskell.org/Bottom\" rel=\"noreferrer\">bottom</a>. That is, it can be <code>undefined</code>, or perhaps a computation that never finishes, or one that throws an exception. </p>\n\n<p>Meanwhile, unlifted types do not have those potentially troublesome extra values. This can be useful in a purely \"semantic\" level (if you don't want those extra values) and it can also facilitate more efficient implementations by reducing costly indirections. A GHC optimization called <a href=\"http://www.cs.nott.ac.uk/~pszgmh/wrapper.pdf\" rel=\"noreferrer\">the worker-wrapper transformation</a> exploits this (see section 5.1 of the linked paper).</p>\n\n<p>Lifted and unlifted types have different kinds. Lifted types live in <code>*</code>, unlifted types in <code>#</code>.</p>\n\n<p>Currently GHC doesn't let you define your own complex unlifted datatypes easily. But there are <a href=\"https://ghc.haskell.org/trac/ghc/wiki/UnliftedDataTypes\" rel=\"noreferrer\">proposals</a> to allow for that.</p>\n"}, {"comments": [{"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 1, "creation_date": 1476378649, "post_id": 39986010, "comment_id": 67331433, "body": "&quot;Polymorphism does not play with unlifted types&quot;: bzzzt.  Polymorphism does not play with <i>unboxed</i> types.  Polymorphism works just fine with unlifted types, e.g., in ML (although Haskell&#39;s kind system may not be flexible enough to support it)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 0, "creation_date": 1476379077, "post_id": 39986010, "comment_id": 67331670, "body": "@jcast True enough - I meant the comment in the context of Haskell&#39;s kind system where type variables have kind <code>*</code> unless otherwise specified. The link that follows actually shows how this restriction can be lifted with the newer levity polymorphism features of GHC 8.0. Does that clarify?"}, {"owner": {"reputation": 577, "user_id": 12391863, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p5P4O.png?s=128&g=1", "display_name": "Poscat", "link": "https://stackoverflow.com/users/12391863/poscat"}, "edited": false, "score": 0, "creation_date": 1614230465, "post_id": 39986010, "comment_id": 117323685, "body": "polymorphism can play with unlifted types if you want it to, by using kind polymorphism: <code>forall (k :: RuntimeRep) (t :: TYPE k)</code> :)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 10, "last_activity_date": 1476219849, "last_edit_date": 1495535655, "creation_date": 1476217161, "answer_id": 39986010, "question_id": 39985296, "link": "https://stackoverflow.com/questions/39985296/what-are-lifted-and-unlifted-product-types-in-haskell/39986010#39986010", "title": "What are lifted and unlifted product types in Haskell?", "body": "<p>From the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#unboxed-types-and-primitive-operations\" rel=\"nofollow noreferrer\">GHC docs</a>:</p>\n\n<blockquote>\n  <p>\u201clifted\u201d type means that terms of that type may be bottom. </p>\n  \n  <p>\u201cboxed\u201d type means that a value is represented by a pointer to a heap object.</p>\n</blockquote>\n\n<p>Some implications include:</p>\n\n<ul>\n<li>A lifted type is boxed (but not necessarily the other way - check out the link above for more)</li>\n<li>Unboxed types cannot have thunks (since those are pointers to data telling you how to produce the value), so no laziness. They really just hold values. This also means they can be faster.</li>\n<li>Polymorphism does not play with unlifted types. Whenever you see a type variable, all the types involved are unlifted. Something like <code>id 0 :: Int#</code> does not work. Check out <a href=\"https://stackoverflow.com/a/35320729/3072788\">this answer</a> to see how you can (since GHC 8.0) sometimes maneuver around this.</li>\n</ul>\n\n<p>Note that you <em>can</em> create unlifted products in GHC using <code>MagicHash</code> and <code>UnboxedTuples</code> extensions (although I don't think they play well with GHCi):</p>\n\n<pre><code>{-# LANGUAGE MagicHash, UnboxedTuples #-}\n\nextGCD :: Int -&gt; Int -&gt; (# Int, Int, Int #)\nextGCD a 0 = (# 1, 0, a #)\nextGCD a b = let (q, r) = a `quotRem` b\n                 (# s, t, g #) = extGCD b r\n             in  (# t, s - q * t, abs g #)\n</code></pre>\n\n<p>With the exception of this extension, I believe the only unlifted types you will find are in <code>GHC.Exts</code> and are the primitive types. There is some discussion to allow custom unlifted data types to be integrated into GHC <a href=\"https://ghc.haskell.org/trac/ghc/wiki/UnliftedDataTypes\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>One final remark: while lifted types have kind <code>*</code>, unlifted types have kind <code>#</code>. <a href=\"https://stackoverflow.com/a/27095012/3072788\">This answer</a> to the question linked in the comments goes into more detail about this.</p>\n"}], "owner": {"reputation": 945, "user_id": 463800, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1327ce755b24b956995d68accae3eab2?s=128&d=identicon&r=PG", "display_name": "jml", "link": "https://stackoverflow.com/users/463800/jml"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1619, "favorite_count": 3, "accepted_answer_id": 39986010, "answer_count": 2, "score": 13, "last_activity_date": 1476219849, "creation_date": 1476214566, "last_edit_date": 1495535248, "question_id": 39985296, "link": "https://stackoverflow.com/questions/39985296/what-are-lifted-and-unlifted-product-types-in-haskell", "title": "What are lifted and unlifted product types in Haskell?", "body": "<p>I recently came across the term \"lifted product type\" recently, as contrasted to an unlifted one.</p>\n\n<p>I can't recall the context, but I see there are other questions on Stack Overflow asking about the disadvantages of unlifted product types (<a href=\"https://stackoverflow.com/questions/2488228/disadvantage-of-unlifted-type-products\">example</a>).</p>\n\n<p>I know more or less what a product type is. It's something like <code>(a, b)</code> or <code>Foo a b c</code> that corresponds roughly to a Cartesian product from set theory.</p>\n\n<p>What do the terms \"lifted\" and \"unlifted\" mean in this context?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476210185, "post_id": 39983529, "comment_id": 67246772, "body": "I think that in any case you will need to keep <code>Refl</code> around, since that is really where the proof of the type equivalence lies..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1476212204, "post_id": 39983529, "comment_id": 67247991, "body": "<code>assertEq</code> looks pointless to me: when <code>a</code> and <code>b</code> are statically different, instead of generating a type mismatch error, we instead generate a fake witness for their equality, which will call <code>error</code> at runtime. This seems to effectively turn a compile-time error into a run-time one, which is a criminal offense in the world of types ;-) So... why should one want to use that? I think I missed the point entirely..."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1476212745, "post_id": 39983529, "comment_id": 67248333, "body": "@chi I agree 100%, which is why I called this an abomination in the question. ;) I normally loathe partial functions of all kinds, but this is code used in my test suite, not a real application. I tried to give more context in the question, but it was too long a cluttered, so I decided to leave it out. I will mostly just have to ask you to trust me that this is not an XY problem. :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1476216554, "post_id": 39983529, "comment_id": 67250420, "body": "@AlexisKing You can keep your Haskell membership card. For now. :-PP"}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1476213375, "post_id": 39984178, "comment_id": 67248676, "body": "Ah, perfect, it looks like I missed <code>gcastWith</code>, but this is exactly what I was looking for. And yes, partial functions are evil, but see my comment on the question for slightly more context. :)"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1476210939, "last_edit_date": 1476210939, "creation_date": 1476210446, "answer_id": 39984178, "question_id": 39983529, "link": "https://stackoverflow.com/questions/39983529/is-it-possible-to-extract-data-type-equality-pattern-matching-into-a-separate-fu/39984178#39984178", "title": "Is it possible to extract Data.Type.Equality pattern-matching into a separate function?", "body": "<p>Have a look at <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Type-Equality.html#v:gcastWith\" rel=\"noreferrer\"><code>gcastWith</code></a>.</p>\n\n<pre><code>gcastWith :: a :~: b -&gt; (a ~ b =&gt; r) -&gt; r\ngcastWith Refl x = x\n</code></pre>\n\n<p>That type takes a bit of reading. <code>gcastWith</code> takes an equality proof (<code>a :~: b</code>) and a value which typechecks under the assumption that <code>a ~ b</code> (<code>a ~ b =&gt; r</code>) and returns that value with its assumption discharged (<code>r</code>).</p>\n\n<p>The only work that's going on in <code>gcastWith</code>'s body is pattern-matching on <code>Refl</code>. This seeds the context with the <code>a ~ b</code> equality in <code>gcastWith</code>'s body, which GHC dutifully plumbs into <code>x</code>'s type. Pretty cool!</p>\n\n<p>So you can use <code>gcastWith</code>'s type as a template for your <code>withAssertEq</code>:</p>\n\n<pre><code>withAssertEq :: forall a b r. (Typeable a, Typeable b) =&gt; Proxy a -&gt; Proxy b -&gt; (a ~ b =&gt; r) -&gt; r\nwithAssertEq _ _ = gcastWith (fromJust eqT :: a :~: b)\n</code></pre>\n\n<p>The <code>Proxy</code>s are there to enable call-sites to tell GHC which <code>Typeable</code> dictionaries to use for <code>a</code> and <code>b</code>. The type fails the ambiguity check without them.</p>\n\n<p>The usual caveats apply, don't use partial functions, blah blah blah.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 39984178, "answer_count": 1, "score": 1, "last_activity_date": 1476210939, "creation_date": 1476208289, "question_id": 39983529, "link": "https://stackoverflow.com/questions/39983529/is-it-possible-to-extract-data-type-equality-pattern-matching-into-a-separate-fu", "title": "Is it possible to extract Data.Type.Equality pattern-matching into a separate function?", "body": "<p>For some test code, I wrote a function that allows me to implement polymorphic functions using monomorphic implementations. I implemented it using <a href=\"https://hackage.haskell.org/package/base/docs/Data-Type-Equality.html\" rel=\"nofollow\"><code>Data.Type.Equality</code></a> like this:</p>\n\n<pre><code>assertEq :: forall a b. (Show a, Typeable a, Typeable b) =&gt; a -&gt; (a :~: b)\nassertEq x = fromMaybe (error errorMessage) eqT\n  where errorMessage =\n            \"expected value of type \u2018\" &lt;&gt; show (typeRep (Proxy :: Proxy b))\n         &lt;&gt; \"\u2019, but got \u2018\" &lt;&gt; show x\n         &lt;&gt; \"\u2019, which is of type \u2018\" &lt;&gt; show (typeRep (Proxy :: Proxy a)) &lt;&gt; \"\u2019\"\n</code></pre>\n\n<p>Using it looks like this:</p>\n\n<pre><code>insertUser :: forall record m. (RelationalEntity record, Monad m) =&gt; record -&gt; m (Either (Entity record) (Key record))\ninsertUser user = case (assertEq user :: record :~: User) of\n  Refl -&gt; return . Right $ UserId 1234\n</code></pre>\n\n<p>Importantly, the type signature works for any <code>RelationalEntity</code>, but it actually expects a <code>User</code>. Normally, this sort of function would be an abomination, but it works great in test code, since any exceptions that are raised will simply make the test fail, which is exactly what I want.</p>\n\n<p>Of course, using <code>assertEq</code> is a little wordy. Fortunately, Haskell has referential transparency, so it should be really easy to pack up that <code>case</code> match into a helper function, right? Well, I tried to do that:</p>\n\n<pre><code>withAssertEq :: forall a b c. (Show a, Typeable a, Typeable b) =&gt; a -&gt; (b -&gt; c) -&gt; c\nwithAssertEq x f = case (assertEq x :: a :~: b) of Refl -&gt; f x\n</code></pre>\n\n<p>Now I should be able to use <code>withAssertEq</code> from within <code>insertUser</code>:</p>\n\n<pre><code>insertUser :: forall record m. (RelationalEntity record, Monad m) =&gt; record -&gt; m (Either (Entity record) (Key record))\ninsertUser x = withAssertEq x $ \\(_ :: User) -&gt;\n  return . Right $ UserId 1234\n</code></pre>\n\n<p>Unfortunately, this does not typecheck. The information the typechecker gains from the <code>Refl</code> pattern-match within <code>withAssertEq</code> does not propagate to the use within <code>insertUser</code>, so the typechecker cannot unify the expected result, <code>Key record</code>, with the actual result, <code>Key User</code>.</p>\n\n<p>Is there any way to write a function that <em>can</em> propagate this sort of type information? Or do I <em>need</em> to use a <code>case</code> expression directly in order to tell the typechecker about the type equality information?</p>\n"}, {"tags": ["haskell", "ghc", "ghci", "wxhaskell"], "comments": [{"owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 1, "creation_date": 1476349860, "post_id": 39981994, "comment_id": 67310620, "body": "<code>undefined reference</code> means usually that linker doesn&#39;t have access to proper libraries. Your linker invocation probably lacks something like <code>-lC:\\Users...\\Downloads\\wxInstall-Achelanne-64-0.1\\wxWidgets&zwnj;&#8203;\\lib\\gcc_dll</code> - a direct request to use your <code>wxWidgets</code> library during linkage (more details on linking are here: <a href=\"https://downloads.haskell.org/~ghc/7.6.1/docs/html/users_guide/options-phases.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.6.1/docs/html/users_guide/&hellip;</a>)"}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "reply_to_user": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 0, "creation_date": 1476372478, "post_id": 39981994, "comment_id": 67327507, "body": "@TomaszLewowski I thought just having this folder on the search path was good enough.  Perhaps not."}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "reply_to_user": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 0, "creation_date": 1476372921, "post_id": 39981994, "comment_id": 67327831, "body": "@TomaszLewowski Regardless I tried what you suggest and I get the same errors.  I confirm in the verbose output that the -L option is included in the gcc execution for linking.  Whatever it is looking for is not in those libraries"}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "reply_to_user": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 0, "creation_date": 1476378634, "post_id": 39981994, "comment_id": 67331426, "body": "@TomaszLewowski Thanks for your guidance.  I figured out the issue.  See my answer below."}], "answers": [{"tags": [], "owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "is_accepted": true, "score": 2, "last_activity_date": 1476378585, "creation_date": 1476378585, "answer_id": 40027078, "question_id": 39981994, "link": "https://stackoverflow.com/questions/39981994/unable-to-runhaskell-my-wxhaskell-program-that-works-in-ghci/40027078#40027078", "title": "Unable to runhaskell my wxHaskell program that works in GHCI", "body": "<p>I figured out what the problem was.  I forgot that for GHC to create an executable that you need to explicitly specify Cabal packages that you wish to include.  Commenter Tomasz Lewowski was partially correct.  The -L option for linking libraries was required by gcc, however the ghc application intelligently adds ALL the required library paths for a given Cabal package by using the <code>-package</code> option.</p>\n\n<p>The second part of making this work was that I needed to compile the .o file specifying -main-is for the main method.  I wrote up the simple batch file and got it working.</p>\n\n<pre><code>ghc -v -main-is HelloWorld.main HelloWorld.hs\n\nghc -v -o HelloWorld HelloWorld.o -package strict-0.3.2 -package wx-0.92.2.0 -package wxc-0.92.2.0 -package wxcore-0.92.2.0 -package wxdirect-0.92.2.0\n</code></pre>\n\n<p>This created the Windows executable just fine and it works like a charm.</p>\n"}], "owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 40027078, "answer_count": 1, "score": 3, "last_activity_date": 1481971730, "creation_date": 1476202744, "question_id": 39981994, "link": "https://stackoverflow.com/questions/39981994/unable-to-runhaskell-my-wxhaskell-program-that-works-in-ghci", "title": "Unable to runhaskell my wxHaskell program that works in GHCI", "body": "<p>I am trying to create a HelloWorld.exe on Windows 7 that demonstrates a very simple wxHaskell program I have found online.  The code is below:</p>\n\n<pre><code>module HelloWorldWX where\nimport Graphics.UI.WX\n\nmain :: IO ()\nmain\n  = start hello\n\nhello :: IO ()\nhello = do\n       f    &lt;- frame    [text := \"Hello!\"]\n       quit &lt;- button f [text := \"Quit\", on command := close f]\n       set f [layout := widget quit]\n</code></pre>\n\n<p>in a file called HelloWorldWX.hs.  I downloaded the binary distribution of wxHaskell (wxInstall-Achelanne-64-0.1).  After running Install.bat I noticed it used Cabal to set up a new package location where it installed wx-0.92.0.1 and all of its depedencies.  The first time it ran it failed for some non-specified reason.  I ran <code>ghc-pkg list</code> and found all of the packages were listed in the new cabal package location.  I decided to unregister all of the packages and try again.  This second time it was successful and prompted me to include the following directories in my search path which I did:</p>\n\n<blockquote>\n  <p>C:\\Users...\\Downloads\\wxInstall-Achelanne-64-0.1\\DLLs;C:\\Users...\\Downloads\\wxInstall-Achelanne-64-0.1\\wxWidgets\\lib\\gcc_dll</p>\n</blockquote>\n\n<p>At this point when I loaded HelloWorldWX.hs into GHCI and ran main, I got the window frame with the Quit button like I expect.</p>\n\n<p>I then compiled the .hs file into a .o file.  I then attempted to create an executable with the following command:</p>\n\n<pre><code>ghc -v -o HelloWorldWX HelloWorldWX.o\n\nGlasgow Haskell Compiler, Version 7.10.3, stage 2 booted by GHC version 7.10.2\nUsing binary package database: C:\\Users\\...\\Haskell Platform\\7.10.3\\lib\\pack\nage.conf.d\\package.cache\nUsing binary package database: C:\\Users\\...\\AppData\\Roaming\\ghc\\x86_64-mingw\n32-7.10.3\\package.conf.d\\package.cache\nwired-in package ghc-prim mapped to ghc-prim-0.4.0.0-428c198583a031a3ea42dd32ae6\nf9bab\nwired-in package integer-gmp mapped to integer-gmp-1.0.0.0-3c8c40657a9870f5c33be\n17496806d8d\nwired-in package base mapped to base-4.8.2.0-14035a44a8b95c6832da6dae1420f59e\nwired-in package rts mapped to builtin_rts\nwired-in package template-haskell mapped to template-haskell-2.10.0.0-bcb07fec12\nf32563bb45d7fb009640b1\nwired-in package ghc mapped to ghc-7.10.3-7a0d3c701e4b1d1f2c3f3bd2deae9bed\nwired-in package dph-seq not found.\nwired-in package dph-par not found.\nHsc static flags:\nCreated temporary directory: C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\n*** C Compiler:\n\"C:\\Users\\...\\Haskell Platform\\7.10.3\\lib/../mingw/bin/gcc.exe\" \"-fno-stack-\nprotector\" \"-DTABLES_NEXT_TO_CODE\" \"-c\" \"C:\\Users\\...\\AppData\\Local\\Temp\\1\\g\nhc13152_0\\ghc_1.c\" \"-o\" \"C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_2.\no\" \"-IC:\\Users\\...\\Haskell Platform\\7.10.3\\lib/include\"\n*** Windres:\n\"C:\\Users\\...\\Haskell Platform\\7.10.3\\lib/../mingw/bin/windres.exe\" \"--prepr\nocessor=\\\"C:\\Users\\...\\Haskell Platform\\7.10.3\\lib/../mingw/bin/gcc.exe\\\" \\\"\n-fno-stack-protector\\\" \\\"-DTABLES_NEXT_TO_CODE\\\" \\\"-E\\\" \\\"-xc\\\" \\\"-DRC_INVOKED\\\"\n\" \"--use-temp-file\" \"--input=C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\gh\nc_4.rc\" \"--output=C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_5.o\" \"--o\nutput-format=coff\"\n*** Linker:\n\"C:\\Users\\...\\Haskell Platform\\7.10.3\\lib/../mingw/bin/gcc.exe\" \"-fno-stack-\nprotector\" \"-DTABLES_NEXT_TO_CODE\" \"-Wl,--hash-size=31\" \"-Wl,--reduce-memory-ove\nrheads\" \"-Xlinker\" \"--stack=0x800000,0x800000\" \"-static-libgcc\" \"-o\" \"HelloWorld\nWX.exe\" \"-Wl,--enable-auto-import\" \"HelloWorldWX.o\" \"C:\\Users\\...\\AppData\\Lo\ncal\\Temp\\1\\ghc13152_0\\ghc_5.o\" \"-LC:\\Users\\...\\Haskell Platform\\7.10.3\\lib\\b\nase_HQfYBxpPvuw8OunzQu6JGM\" \"-LC:\\Users\\...\\Haskell Platform\\7.10.3\\lib\\inte\ng_2aU3IZNMF9a7mQ0OzsZ0dS\" \"-LC:\\Users\\...\\Haskell Platform\\7.10.3\\lib\\ghcpr_\n8TmvWUcS1U1IKHT0levwg3\" \"-LC:\\Users\\...\\Haskell Platform\\7.10.3\\lib/rts\" \"C:\n\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_2.o\" \"-Wl,-u,ghczmprim_GHCziT\nypes_Izh_static_info\" \"-Wl,-u,ghczmprim_GHCziTypes_Czh_static_info\" \"-Wl,-u,ghcz\nmprim_GHCziTypes_Fzh_static_info\" \"-Wl,-u,ghczmprim_GHCziTypes_Dzh_static_info\"\n\"-Wl,-u,base_GHCziPtr_Ptr_static_info\" \"-Wl,-u,ghczmprim_GHCziTypes_Wzh_static_i\nnfo\" \"-Wl,-u,base_GHCziInt_I8zh_static_info\" \"-Wl,-u,base_GHCziInt_I16zh_static_\ninfo\" \"-Wl,-u,base_GHCziInt_I32zh_static_info\" \"-Wl,-u,base_GHCziInt_I64zh_stati\nc_info\" \"-Wl,-u,base_GHCziWord_W8zh_static_info\" \"-Wl,-u,base_GHCziWord_W16zh_st\natic_info\" \"-Wl,-u,base_GHCziWord_W32zh_static_info\" \"-Wl,-u,base_GHCziWord_W64z\nh_static_info\" \"-Wl,-u,base_GHCziStable_StablePtr_static_info\" \"-Wl,-u,ghczmprim\n_GHCziTypes_Izh_con_info\" \"-Wl,-u,ghczmprim_GHCziTypes_Czh_con_info\" \"-Wl,-u,ghc\nzmprim_GHCziTypes_Fzh_con_info\" \"-Wl,-u,ghczmprim_GHCziTypes_Dzh_con_info\" \"-Wl,\n-u,base_GHCziPtr_Ptr_con_info\" \"-Wl,-u,base_GHCziPtr_FunPtr_con_info\" \"-Wl,-u,ba\nse_GHCziStable_StablePtr_con_info\" \"-Wl,-u,ghczmprim_GHCziTypes_False_closure\" \"\n-Wl,-u,ghczmprim_GHCziTypes_True_closure\" \"-Wl,-u,base_GHCziPack_unpackCString_c\nlosure\" \"-Wl,-u,base_GHCziIOziException_stackOverflow_closure\" \"-Wl,-u,base_GHCz\niIOziException_heapOverflow_closure\" \"-Wl,-u,base_ControlziExceptionziBase_nonTe\nrmination_closure\" \"-Wl,-u,base_GHCziIOziException_blockedIndefinitelyOnMVar_clo\nsure\" \"-Wl,-u,base_GHCziIOziException_blockedIndefinitelyOnSTM_closure\" \"-Wl,-u,\nbase_GHCziIOziException_allocationLimitExceeded_closure\" \"-Wl,-u,base_ControlziE\nxceptionziBase_nestedAtomically_closure\" \"-Wl,-u,base_GHCziEventziThread_blocked\nOnBadFD_closure\" \"-Wl,-u,base_GHCziWeak_runFinalizzerBatch_closure\" \"-Wl,-u,base\n_GHCziTopHandler_flushStdHandles_closure\" \"-Wl,-u,base_GHCziTopHandler_runIO_clo\nsure\" \"-Wl,-u,base_GHCziTopHandler_runNonIO_closure\" \"-Wl,-u,base_GHCziConcziIO_\nensureIOManagerIsRunning_closure\" \"-Wl,-u,base_GHCziConcziIO_ioManagerCapabiliti\nesChanged_closure\" \"-Wl,-u,base_GHCziConcziSync_runSparks_closure\" \"-Wl,-u,base_\nGHCziConcziSignal_runHandlersPtr_closure\" \"-lHSbase-4.8.2.0-HQfYBxpPvuw8OunzQu6J\nGM\" \"-lHSinteger-gmp-1.0.0.0-2aU3IZNMF9a7mQ0OzsZ0dS\" \"-lHSghc-prim-0.4.0.0-8TmvW\nUcS1U1IKHT0levwg3\" \"-lHSrts\" \"-lCffi-6\" \"-lwsock32\" \"-luser32\" \"-lshell32\" \"-lm\"\n \"-lwsock32\" \"-lgdi32\" \"-lwinmm\"\nHelloWorldWX.o:fake:(.text+0x35): undefined reference to `wxcorzuLc8buVrXMQOAAoN\njm2eSy1_GraphicsziUIziWXCoreziLayout_zdfWidgetObject_closure'\nHelloWorldWX.o:fake:(.text+0x91): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziAttributes_ZCze_con_info'\nHelloWorldWX.o:fake:(.text+0x9a): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziTopLevelWindow_zdfFormObject_closure'\nHelloWorldWX.o:fake:(.text+0xca): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziAttributes_set_closure'\nHelloWorldWX.o:fake:(.text+0x11d): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziTopLevelWindow_zdfCloseableObject_closure'\nHelloWorldWX.o:fake:(.text+0x15f): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziControls_zdfCommandingObject4_closure'\nHelloWorldWX.o:fake:(.text+0x164): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziEvents_on_closure'\nHelloWorldWX.o:fake:(.text+0x1ef): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziWindow_zdfTextualObject_closure'\nHelloWorldWX.o:fake:(.text+0x27e): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziAttributes_ZCze_con_info'\nHelloWorldWX.o:fake:(.text+0x2ce): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziAttributes_ZCze_con_info'\nHelloWorldWX.o:fake:(.text+0x2ff): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziControls_button_closure'\nHelloWorldWX.o:fake:(.text+0x427): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziWindow_zdfTextualObject_closure'\nHelloWorldWX.o:fake:(.text+0x4b9): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziAttributes_ZCze_con_info'\nHelloWorldWX.o:fake:(.text+0x4eb): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziFrame_frame_closure'\nHelloWorldWX.o:fake:(.text+0x5da): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWX_start_closure'\nHelloWorldWX.o:fake:(.text+0x1f8): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziClasses_text_info'\nHelloWorldWX.o:fake:(.text+0x430): undefined reference to `wxzu6QQu5v1wfyA22ZZSl\neeGHgzz_GraphicsziUIziWXziClasses_text_info'\nHelloWorldWX.o:fake:(.data+0x70): undefined reference to `wxcorzuLc8buVrXMQOAAoN\njm2eSy1_GraphicsziUIziWXCoreziLayout_zdfWidgetObject_closure'\nHelloWorldWX.o:fake:(.data+0x78): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziAttributes_set_closure'\nHelloWorldWX.o:fake:(.data+0x80): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziTopLevelWindow_zdfFormObject_closure'\nHelloWorldWX.o:fake:(.data+0x88): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziTopLevelWindow_zdfCloseableObject_closure'\nHelloWorldWX.o:fake:(.data+0x90): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziEvents_on_closure'\nHelloWorldWX.o:fake:(.data+0x98): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziControls_zdfCommandingObject4_closure'\nHelloWorldWX.o:fake:(.data+0xa8): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziWindow_zdfTextualObject_closure'\nHelloWorldWX.o:fake:(.data+0xb0): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziControls_button_closure'\nHelloWorldWX.o:fake:(.data+0xc8): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWXziFrame_frame_closure'\nHelloWorldWX.o:fake:(.data+0xd8): undefined reference to `wxzu6QQu5v1wfyA22ZZSle\neGHgzz_GraphicsziUIziWX_start_closure'\nC:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_2.o:ghc_1.c:(.rdata$.refptr\n.ZCMain_main_closure[.refptr.ZCMain_main_closure]+0x0): undefined reference to `\nZCMain_main_closure'\ncollect2.exe: error: ld returned 1 exit status\n*** Deleting temp files:\nDeleting: C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_6.rsp C:\\Users\\pp\n77316\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_5.o C:\\Users\\...\\AppData\\Local\\Tem\np\\1\\ghc13152_0\\ghc_4.rc C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_3.r\nsp C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\\ghc_2.o C:\\Users\\...\\App\nData\\Local\\Temp\\1\\ghc13152_0\\ghc_1.c\n*** Deleting temp dirs:\nDeleting: C:\\Users\\...\\AppData\\Local\\Temp\\1\\ghc13152_0\n</code></pre>\n\n<p>I am not really sure why it is having problems finding these references.</p>\n\n<p>I tried executing then with</p>\n\n<blockquote>\n  <p>runhaskell HelloWorldWX.hs</p>\n</blockquote>\n\n<p>and received the following error popup from ghc:</p>\n\n<p><a href=\"https://i.stack.imgur.com/6EtXk.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/6EtXk.png\" alt=\"enter image description here\"></a></p>\n\n<p>The Verbose flag being set here gives a bunch of information that doesn't really elaborate on any specific problems.</p>\n\n<p>I am running Haskell GHC 7.10.3 full package from Windows Installer to a local Users directory.  I do not have Local Administrator privileges on this workstation but I could try on another machine.</p>\n\n<p>Any clues?  I imagine the first failed install of wxHaskell has corrupted something or I am running into a privilege issue.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1476203150, "post_id": 39981453, "comment_id": 67242709, "body": "Perhaps I&#39;m missing something, but isn&#39;t that just a side effect of incremental building? <code>stack build</code> will only build the modules that were changed since the last invocation, and so if that happened to involve <code>--profile</code> then the changed modules would need to be built with <code>--profile</code> as well, even if you don&#39;t specify the option the second time."}, {"owner": {"user_type": "does_not_exist", "display_name": "user224969"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1476205321, "post_id": 39981453, "comment_id": 67243977, "body": "@duplode Yeah it is obviously a side effect of previous builds, sorry maybe I wasn&#39;t clear that&#39;s exactly what I <i>don&#39;t</i> want.  I want a command, whatever it is, to build a &quot;release build&quot; and a &quot;profile build&quot;, and if I run the command to build the &quot;release build&quot; I don&#39;t want to have to think about the state of things right now I just want it to produce a release build.  I could just clean every time, but that slows down my build process, I want stack to figure this out for me!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476245568, "post_id": 39981453, "comment_id": 67259200, "body": "There is no formal distinguishment in the stack system between a &#39;release build&#39; and any other build. The command <code>stack build</code> will simply build your targets according to the build plan, if it exists, and if not, create some build plan according to some defaults and then build that. If you have an existing build plan (but not the one you want) you must first replace it. Does <code>-no-executable-profiling</code> do what you want? Or perhaps adding a cabal flag which formally specifies the difference between release and devel? Changing any flag requires a re-configure (stack will see this, I presume)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user224969"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476301230, "post_id": 39981453, "comment_id": 67292035, "body": "@user2407038 I know there&#39;s no formal distinction between a &#39;release build&#39; and a &#39;profiling build&#39;, but the ghc options change right?  I guess what I&#39;m asking is, if I change the ghc options, why is stack not rebuilding everything in my project with the new ghc options, even though the option I thought that would enable this <code>rebuild-ghc-options</code>, does not seem to work or works differently than I expect.  What should be my workflow?  Always simply remember to run build clean after building with custom ghc options?"}], "owner": {"user_type": "does_not_exist", "display_name": "user224969"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 1, "answer_count": 0, "score": 8, "last_activity_date": 1476301398, "creation_date": 1476201031, "last_edit_date": 1476301398, "question_id": 39981453, "link": "https://stackoverflow.com/questions/39981453/what-state-is-stored-between-running-stack-build-vs-stack-build-profile-or", "title": "What state is stored between running &#39;stack build&#39; vs &#39;stack build --profile&#39; or similarly changing ghc options?", "body": "<p>If I run <code>stack clean &amp;&amp; stack build --profile</code>, I get an executable that is slower than if I had run <code>stack clean &amp;&amp; stack build</code>, this is normal and fine.</p>\n\n<p>If I run <code>stack clean &amp;&amp; stack build --profile &amp;&amp; stack build</code> then I get an executable that is just as slow, and this persists until I run <code>stack clean &amp;&amp; stack build</code></p>\n\n<p>I have set the option <code>rebuild-ghc-options: true</code> in stack.yaml, but I'm either not understanding the proper use of stack or I'm misusing it somehow, because I don't have a clear mental model of what state is affected when I run <code>stack build</code>.  It is clearly affecting future builds until I run <code>stack clean</code>, is it also affecting dependencies?  How do I make sure that when I build with default settings that I get the same executable out every time?</p>\n\n<p>Edit: Let me be clear, I understand what is going on mechanically, I understand that <code>stack build</code> rebuilds only what \"needs to be rebuilt\", the thing is if I run <code>stack build</code> what I <em>want</em> is for it to rebuild everything that required to make a <em>release build</em>, and if I had just built with profiling, and that means to rebuild everything, so be it.</p>\n\n<p>Edit 2: Okay, I know that stack has no idea about a release or profiling build etc, that there's no fundamental distinction, but --profile just changes ghc flags right?  I guess what I'm asking is, why doesn't <code>rebuild-ghc-options</code> do what it says on the tin?  If the ghc options change, why isn't it fully rebuilding the project?  What does that flag actually do?</p>\n"}, {"tags": ["git", "haskell", "rabbitmq", "protocol-buffers", "microservices"], "answers": [{"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476201517, "post_id": 39981369, "comment_id": 67241646, "body": "Thanks, this is helpful. How do you handle invalid input to queues? The workers can&#39;t return an error code to the client who put the message on."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476207213, "post_id": 39981369, "comment_id": 67245042, "body": "Can you send me a link about #2? I&#39;m not sure what you mean."}, {"owner": {"reputation": 48529, "user_id": 63074, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e77511a13f8c53b87610e52b4b38aa43?s=128&d=identicon&r=PG", "display_name": "Mike Dinescu", "link": "https://stackoverflow.com/users/63074/mike-dinescu"}, "reply_to_user": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476219760, "post_id": 39981369, "comment_id": 67252166, "body": "@SeanClarkHess - what kind of queue are you using? In true micro-services fashion I expect you&#39;re either using a service such as AWS SES, or Azure Queues, or you&#39;ve implemented your own as a service"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476221967, "post_id": 39981369, "comment_id": 67253256, "body": "We&#39;re using RabbitMQ"}, {"owner": {"reputation": 48529, "user_id": 63074, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e77511a13f8c53b87610e52b4b38aa43?s=128&d=identicon&r=PG", "display_name": "Mike Dinescu", "link": "https://stackoverflow.com/users/63074/mike-dinescu"}, "reply_to_user": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476222575, "post_id": 39981369, "comment_id": 67253530, "body": "I&#39;m not super familiar with RabbitMQ but here is a resource for auth: <a href=\"https://www.rabbitmq.com/access-control.html\" rel=\"nofollow noreferrer\">rabbitmq.com/access-control.html</a> - regarding your question about: &quot;how do I prevent somebody from putting an invalid message on the queue&quot; - that really depends on who has access to it but I would really encourage you to code as if you expect broken stuff to be placed on the queue. How defensive you decide to be depends on who you expect to be accessing the queue."}], "tags": [], "owner": {"reputation": 48529, "user_id": 63074, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e77511a13f8c53b87610e52b4b38aa43?s=128&d=identicon&r=PG", "display_name": "Mike Dinescu", "link": "https://stackoverflow.com/users/63074/mike-dinescu"}, "is_accepted": true, "score": 1, "last_activity_date": 1476200798, "creation_date": 1476200798, "answer_id": 39981369, "question_id": 39981115, "link": "https://stackoverflow.com/questions/39981115/interfaces-for-microservice-boundaries-how-to-import-code/39981369#39981369", "title": "Interfaces for microservice boundaries - how to import code?", "body": "<p>I'd say it's idiomatic for micro-services to not expect compile-time, or build-time support for <em>boundary</em> checking or enforcement. </p>\n\n<p>Instead you would enforce these rules in two ways at run-time:</p>\n\n<ol>\n<li>validation and error handling:  services must always expect incorrect input or abuse and be prepared to handle it gracefully, by returning proper error codes and throttling</li>\n<li>take advantage of digital signatures to authenticate requests and enforce access policies</li>\n</ol>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 39981369, "answer_count": 1, "score": 1, "last_activity_date": 1476200798, "creation_date": 1476200052, "question_id": 39981115, "link": "https://stackoverflow.com/questions/39981115/interfaces-for-microservice-boundaries-how-to-import-code", "title": "Interfaces for microservice boundaries - how to import code?", "body": "<p>I'm building some small services in Haskell. I'd like to make the boundary between services formal, such that the build process will tell the developer if the contract has been violated</p>\n\n<p>For a simple example, say we have an API with a route POST /users. It's supposed to add the user to the users queue. Then we have one worker, which reads from the queue and processes the new user. </p>\n\n<p>The contract between the two looks like:</p>\n\n<ol>\n<li>The exchange is named \"exchange\"</li>\n<li>The queue is named \"users\"</li>\n<li>Messages should be user objects serialized to JSON (or msgpack, or protobuf)</li>\n<li>users are: <code>{ name : String, age : Int }</code></li>\n</ol>\n\n<p>How can I enforce this so that I get build errors if either service:</p>\n\n<ol>\n<li>Connects to the wrong queue or exchange</li>\n<li>Uses an incorrect schema for User</li>\n</ol>\n\n<p>This would be easy if all the code were in one repository, but one of the main goals of microservices as I understand them is to make them independent. How could it be done with separate repos? </p>\n\n<p>I had the idea to create a 3rd repo for the contract, and have both services depend on it. If it contained some Haskell types, the API and the worker could both include it and typecheck their implementations against it. If I do this, how should I handle versioning? Should they include it as a git submodule, or through the package manager (which would allow depending on old versions, which might be bad)?</p>\n\n<p>If I wanted to update the schema of User, how would I architect things so that I then get errors in the two services until they are updated?</p>\n\n<p>For folks who use protobuf, where do you store those files in relation to the two services? Can protobuf surface errors in the implementations? </p>\n"}, {"tags": ["haskell", "concurrency", "ghc"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 6, "creation_date": 1476195918, "post_id": 39978900, "comment_id": 67237870, "body": "How about just reducing the stack chunk size (from the RTS help: <code>-kc&lt;size&gt; Sets the stack chunk size (default 32k)</code>)?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1476211731, "post_id": 39978900, "comment_id": 67247687, "body": "Above we see 300M for STACKS. Dividing this by 10k threads, we get ~36k per thread. Not so bad, just ~1 chunk per thread -- from these numbers, @ReidBarton&#39;s suggestion looks quite promising."}], "owner": {"reputation": 847, "user_id": 489571, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3c801d70c64c75f4d4ab86923f8f57b?s=128&d=identicon&r=PG", "display_name": "Aufheben", "link": "https://stackoverflow.com/users/489571/aufheben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1476195592, "creation_date": 1476193998, "last_edit_date": 1476195592, "question_id": 39978900, "link": "https://stackoverflow.com/questions/39978900/haskell-large-number-of-long-running-threads-taking-up-big-stack-space", "title": "Haskell: large number of long-running threads taking up big STACK space", "body": "<p>A server program keeps long-running TCP connections with many clients. Each client connection is served by a thread created with <code>forkIO</code>. The server takes up a lot of memory when running, so naturally I did a profiling to hunt down possible space leaks. However, with around 10k clients (hence 10k threads), the result shows that a major portion of the heap is actually STACK allocated by threads. If I understand correctly, this is not surprising since the stack of a thread starts with 1k by default, and increases by 32k chunks. As these are long-running threads, these memory won't be GCed.</p>\n\n<p>My question: <em>STACK takes up too much space, is there a way to reduce it?</em> </p>\n\n<p>I had some thoughts on this: previously I could use the event notification APIs from GHC to write the program without using threads, however it seems this option is no longer possible as GHC has stopped exporting some of the event handling functions such as <code>loop</code>. On the other hand, such change means a major shift in concurrency model (threads vs events), which is very undesirable since the Haskell threads are simply so enjoyable to work with. Another way that came to my mind is to split/rewrite the threads so that one thread does all the handshaking+authentication stuff, creates a new thread and then exits. The new thread, which will keep looping, hopefully doesn't require more STACK space. However I'm not sure if this idea is correct or doable.</p>\n\n<p><a href=\"https://i.stack.imgur.com/0GfcB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0GfcB.png\" alt=\"profiling\"></a></p>\n"}, {"tags": ["list", "haskell", "syntactic-sugar"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1476193311, "post_id": 39978441, "comment_id": 67236049, "body": "<code>print</code> will need you to add <code>deriving Show</code> at the end of the data declaration for <code>List</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1476193366, "post_id": 39978441, "comment_id": 67236091, "body": "Unrelated tip: you don&#39;t need <code>do</code> if you have just one <code>IO</code> action (in your case, the <code>print</code>ing)."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1476208627, "post_id": 39978441, "comment_id": 67245866, "body": "btw. <code>fromList = foldr Cons Nil</code> is a really handy function when doing this like that."}], "answers": [{"tags": [], "owner": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "is_accepted": false, "score": 1, "last_activity_date": 1476194291, "creation_date": 1476194291, "answer_id": 39978993, "question_id": 39978441, "link": "https://stackoverflow.com/questions/39978441/data-list-checking-if-a-list-is-empty/39978993#39978993", "title": "data List - checking if a list is empty", "body": "<p>Changing to:</p>\n\n<pre><code>main = print $ vnull $ Cons 1 $ Cons 2 Nil\n</code></pre>\n\n<p>produces:</p>\n\n<pre><code>False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 394, "user_id": 3099227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2fa8baddabb7e43d079d297a5791c11?s=128&d=identicon&r=PG", "display_name": "iuriisusuk", "link": "https://stackoverflow.com/users/3099227/iuriisusuk"}, "is_accepted": false, "score": 1, "last_activity_date": 1476383433, "last_edit_date": 1476383433, "creation_date": 1476196293, "answer_id": 39979689, "question_id": 39978441, "link": "https://stackoverflow.com/questions/39978441/data-list-checking-if-a-list-is-empty/39979689#39979689", "title": "data List - checking if a list is empty", "body": "<p>it is working like it is implemented:</p>\n\n<pre><code>vnull Nil\nTrue\n\nvnull (Cons 1 Nil)\nFalse\n\nvnull (Cons 2 (Cons 1 Nil)\nFalse\n\n...\n</code></pre>\n\n<p>you can try following commands in <code>ghci</code>, to get all information about <code>[]</code> datatype:</p>\n\n<pre><code>Prelude&gt; :t []\n[] :: [t]\nPrelude&gt; :i []\ndata [] a = [] | a : [a]    -- Defined in \u2018GHC.Types\u2019\ninstance Eq a =&gt; Eq [a] -- Defined in \u2018GHC.Classes\u2019\ninstance Monad [] -- Defined in \u2018GHC.Base\u2019\ninstance Functor [] -- Defined in \u2018GHC.Base\u2019\ninstance Ord a =&gt; Ord [a] -- Defined in \u2018GHC.Classes\u2019\ninstance Read a =&gt; Read [a] -- Defined in \u2018GHC.Read\u2019\ninstance Show a =&gt; Show [a] -- Defined in \u2018GHC.Show\u2019\ninstance Applicative [] -- Defined in \u2018GHC.Base\u2019\ninstance Foldable [] -- Defined in \u2018Data.Foldable\u2019\ninstance Traversable [] -- Defined in \u2018Data.Traversable\u2019\ninstance Monoid [a] -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>for your function to be applicable to <code>[]</code> parameter you need something like:</p>\n\n<pre><code>vnull ::  [a] -&gt; Bool\nvnull [] = True\nvnull _ = False\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1476319990, "post_id": 39989690, "comment_id": 67299171, "body": "The class is called <code>Foldable</code>. More importantly, its <code>fold</code> method doesn&#39;t do what you&#39;re asking of it."}], "tags": [], "owner": {"reputation": 17, "user_id": 6206633, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2fuaX.jpg?s=128&g=1", "display_name": "Jorge Santiago", "link": "https://stackoverflow.com/users/6206633/jorge-santiago"}, "is_accepted": false, "score": -1, "last_activity_date": 1476240156, "creation_date": 1476240156, "answer_id": 39989690, "question_id": 39978441, "link": "https://stackoverflow.com/questions/39978441/data-list-checking-if-a-list-is-empty/39989690#39989690", "title": "data List - checking if a list is empty", "body": "<p>You can:\n<code>\ninstance Foldeable List where\n  foldMap f Nil = mempty\n  foldMap f (Cons x ls) = mappend (f x) (foldMap ls)\n</code>\nThen use <code>(fold [1,2])::List Int</code></p>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": false, "score": 0, "last_activity_date": 1476417790, "last_edit_date": 1476417790, "creation_date": 1476319323, "answer_id": 40010541, "question_id": 39978441, "link": "https://stackoverflow.com/questions/39978441/data-list-checking-if-a-list-is-empty/40010541#40010541", "title": "data List - checking if a list is empty", "body": "<pre><code>List a\n</code></pre>\n\n<p>and</p>\n\n<pre><code>[]\n</code></pre>\n\n<p>Are two different constructors and not the same data type, The function would work for a <strong>List a</strong> type, so instead of \"<strong>[]</strong>\" try this:</p>\n\n<pre><code> vnull :: List a -&gt; Bool\n vnull Nil = True\n vnull (Cons a expand) = False\n</code></pre>\n\n<p>Then in main</p>\n\n<pre><code>main = do print (vnull $ Cons 1 (Cons 2 Nil)) --This is just an example you can throw in a -List a- type of any length. \n</code></pre>\n\n<p>And this should fix it.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1476320528, "creation_date": 1476320528, "answer_id": 40010679, "question_id": 39978441, "link": "https://stackoverflow.com/questions/39978441/data-list-checking-if-a-list-is-empty/40010679#40010679", "title": "data List - checking if a list is empty", "body": "<p>If you want to be able to use your <code>List</code> type with the usual list syntax, you'll have to use GHC extensions.</p>\n\n<pre><code>{-# LANGUAGE OverloadedLists, TypeFamilies #-} -- at the very top of the file\n\nimport qualified GHC.Exts as E\nimport Data.Foldable\n\ndata List a = Nil | Cons a (List a) deriving (Show, Eq, Ord)\n\ninstance Foldable List where\n  foldr _ n Nil = n\n  foldr c n (Cons x xs) = x `c` foldr c n xs\n\ninstance E.IsList List where\n  type Item (List a) = a\n\n  fromList = foldr Cons Nil\n  toList = toList\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 137, "user_id": 5771177, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f66c6628f434a7998195c89f2af5427b?s=128&d=identicon&r=PG&f=1", "display_name": "suffi", "link": "https://stackoverflow.com/users/5771177/suffi"}, "is_accepted": false, "score": 0, "last_activity_date": 1476393757, "last_edit_date": 1476393757, "creation_date": 1476393060, "answer_id": 40031061, "question_id": 39978441, "link": "https://stackoverflow.com/questions/39978441/data-list-checking-if-a-list-is-empty/40031061#40031061", "title": "data List - checking if a list is empty", "body": "<p>This is what you are missing: </p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving Show\n\nfromList = foldr Cons Nil\n\nvnull :: List a -&gt; Bool\nvnull Nil = True \nvnull _ = False \n\nmain = do print (vnull $ fromList [1,2])\n</code></pre>\n\n<p>The deriving Show is not necessary now, but will be, when you actually want to print a List and not a Bool. The fromList function does nothing, but to convert the Haskell Listimplementation (here [1,2]) into your own, so you can call vnull on it. You could have also called</p>\n\n<p><code>main = do print $ vnull (Cons 1 (Cons 2 (Nil)))</code></p>\n"}], "owner": {"reputation": 11, "user_id": 6423447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e111bfd2bcb866d958b2de5d1b0a5c0?s=128&d=identicon&r=PG&f=1", "display_name": "Vendetta", "link": "https://stackoverflow.com/users/6423447/vendetta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1112, "favorite_count": 0, "answer_count": 6, "score": 0, "last_activity_date": 1476417790, "creation_date": 1476192681, "last_edit_date": 1476330826, "question_id": 39978441, "link": "https://stackoverflow.com/questions/39978441/data-list-checking-if-a-list-is-empty", "title": "data List - checking if a list is empty", "body": "<p>I have the following. It just simply checks if a <code>List</code> is empty. However if I try to run it with <code>main</code>, I get an error. How do I need to change the <code>main</code> function to run it properly? </p>\n\n<pre><code>data List a = Nil | Cons a (List a)\n\nvnull :: List a -&gt; Bool\nvnull Nil = True \nvnull _ = False \n\nmain = do print (vnull [1,2])\n</code></pre>\n\n<p>The error is the following: </p>\n\n<pre><code>Couldn't match expected type `List a0' with actual type `[Integer]'\n   In the first argument of `vnull', namely `[1, 2]'\n   In the first argument of `print', namely `(vnull [1, 2])'\n   In a stmt of a 'do' block: print (vnull [1, 2])\n</code></pre>\n"}, {"tags": ["haskell", "sbv"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1476192911, "post_id": 39976211, "comment_id": 67235747, "body": "You could write a Template Haskell helper."}, {"owner": {"reputation": 131, "user_id": 4938013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69806c5fee49d4807312b8b2508c1f3e?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Bidlingmaier", "link": "https://stackoverflow.com/users/4938013/martin-bidlingmaier"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1476194544, "post_id": 39976211, "comment_id": 67236921, "body": "I&#39;ve only used template haskell as a client before. My question is basically whether this is already built into SBV."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476199165, "post_id": 39976211, "comment_id": 67240118, "body": "Scouring the source of the package, doesn&#39;t look like what you are looking for is there. That said, I&#39;m not sure I understand why you don&#39;t just use a tuple. If you really want the type distinction, that is what <code>GeneralizedNewtypeDeriving</code> is for."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1476199292, "post_id": 39976211, "comment_id": 67240183, "body": "There is an instance of the form <code>Provable ((SBV a, SBV b) -&gt; p)</code> and your type <code>X</code> is isomorphic to <code>(SBV Integer, SBV Integer)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476238836, "post_id": 39984490, "comment_id": 67257606, "body": "Care to explain the intuition behind the generalization? As a side note, you missed the incredible opportunity to write <code>fmap10 = (.).(.).(.).(.).(.).(.).(.).(.).(.).(.)</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476247711, "post_id": 39984490, "comment_id": 67259719, "body": "@Alec Maybe not intuition, but the mechanics go like this: since there is a <code>Provable (SInteger -&gt; p)</code> instance lying around, this means that functions with any number  of <code>SInteger</code> arguments are already handled. To use that instance to make a <code>Provable (Y -&gt; p)</code> instance, we&#39;d like to compose our <code>Y -&gt; p</code> function with the <code>SInteger -&gt; SInteger -&gt; ... -&gt; Y</code> function we already have (namely, the constructor <code>Y</code>) to make a <code>SInteger -&gt; SInteger -&gt; ... -&gt; p</code> function. The chain of <code>fmap</code>s (or <code>(.)</code>s, as you observe) does this composition."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1476212742, "last_edit_date": 1476212742, "creation_date": 1476211517, "answer_id": 39984490, "question_id": 39976211, "link": "https://stackoverflow.com/questions/39976211/automatically-deriving-provable-for-predicates-over-records-in-sbv/39984490#39984490", "title": "Automatically deriving Provable for predicates over records in SBV", "body": "<p>It can at least be made less error-prone:</p>\n\n<pre><code>onX :: (((SInteger, SInteger) -&gt; a) -&gt; b) -&gt; ((X -&gt; a) -&gt; b)\nonX f g = f (g . uncurry X)\n\ninstance Provable p =&gt; Provable (X -&gt; p) where\n    forAll_  = onX forAll_\n    forSome_ = onX forSome_\n    forAll   = onX . forAll\n    forSome  = onX . forSome\n</code></pre>\n\n<p>There's also a generalizable pattern, in case SBV's existing instances for up to 7-tuples are not sufficient.</p>\n\n<pre><code>data Y = Y {a, b, c, d, e, f, g, h, i, j :: SInteger}\n-- don't try to write the types of these, you will wear out your keyboard\nfmap10 = fmap . fmap . fmap . fmap . fmap . fmap . fmap . fmap . fmap . fmap\nonY f g = f (fmap10 g Y)\n\ninstance Provable p =&gt; Provable (Y -&gt; p) where\n    forAll_  = onY forAll_\n    forSome_ = onY forSome_\n    forAll   = onY . forAll\n    forSome  = onY . forSome\n</code></pre>\n\n<p>Still tedious, though.</p>\n"}, {"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 0, "last_activity_date": 1479878446, "last_edit_date": 1479878446, "creation_date": 1479878137, "answer_id": 40756541, "question_id": 39976211, "link": "https://stackoverflow.com/questions/39976211/automatically-deriving-provable-for-predicates-over-records-in-sbv/40756541#40756541", "title": "Automatically deriving Provable for predicates over records in SBV", "body": "<p>Daniel's answer is \"as good as it gets\" if you really want to use quantifiers directly with your lambda-expressions. However, instead of creating a <code>Provable</code> instance, I'd strongly recommend defining a variant of <code>free</code> for your type:</p>\n\n<pre><code>freeX :: Symbolic X\nfreeX = do f &lt;- free_\n           b &lt;- free_\n           return $ X f b\n</code></pre>\n\n<p>Now you can use it like this:</p>\n\n<pre><code>test = prove $ do x &lt;- freeX\n                  return $ foo x + bar x .== bar x + foo x\n</code></pre>\n\n<p>This is much easier to use, and composes well with constraints. For instance, if your data type has the extra constraint that both components are positive, and the first one is larger than the second, then you can write <code>freeX</code> thusly:</p>\n\n<pre><code>freeX :: Symbolic X\nfreeX = do f &lt;- free_\n           b &lt;- free_\n           constrain $ f .&gt; b\n           constrain $ b .&gt; 0\n           return $ X f b\n</code></pre>\n\n<p>Note that this will work correctly in both <code>prove</code> and <code>sat</code> contexts, since <code>free</code> knows how to behave correctly in each case.</p>\n\n<p>I think this is much more readable and easier to use, even though it forces you to use the do-notation. You can also create a version that accepts names, like this:</p>\n\n<pre><code>freeX :: String -&gt; Symbolic X\nfreeX nm = do f &lt;- free $ nm ++ \"_foo\"\n              b &lt;- free $ nm ++ \"_bar\"\n              constrain $ f .&gt; b\n              constrain $ b .&gt; 0\n              return $ X f b\n\ntest = prove $ do x &lt;- freeX \"x\"\n                  return $ foo x + bar x .== bar x * foo x\n</code></pre>\n\n<p>Now we get:</p>\n\n<pre><code>*Main&gt; test\nFalsifiable. Counter-example:\n  x_foo = 3 :: Integer\n  x_bar = 1 :: Integer\n</code></pre>\n\n<p>You can also make <code>X</code> \"parseable\" by SBV. In this case the full code looks like this:</p>\n\n<pre><code>data X = X {foo :: SInteger, bar :: SInteger} deriving Show\n\nfreeX :: Symbolic X\nfreeX = do f &lt;- free_\n           b &lt;- free_\n           return $ X f b\n\ninstance SatModel X where\n  parseCWs xs = do (x, ys) &lt;- parseCWs xs\n                   (y, zs) &lt;- parseCWs ys\n                   return $ (X (literal x) (literal y), zs)\n</code></pre>\n\n<p>The following test demonstrates:</p>\n\n<pre><code>test :: IO (Maybe X)\ntest = extractModel `fmap` (prove $ do\n                x &lt;- freeX\n                return $ foo x + bar x .== bar x * foo x)\n</code></pre>\n\n<p>We have:</p>\n\n<pre><code>*Main&gt; test &gt;&gt;= print\nJust (X {foo = -4 :: SInteger, bar = -5 :: SInteger})\n</code></pre>\n\n<p>Now you can take your counter-examples and post-process them as you wish.</p>\n"}], "owner": {"reputation": 131, "user_id": 4938013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69806c5fee49d4807312b8b2508c1f3e?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Bidlingmaier", "link": "https://stackoverflow.com/users/4938013/martin-bidlingmaier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1479878446, "creation_date": 1476185157, "question_id": 39976211, "link": "https://stackoverflow.com/questions/39976211/automatically-deriving-provable-for-predicates-over-records-in-sbv", "title": "Automatically deriving Provable for predicates over records in SBV", "body": "<p>I'm in a situation where I have a data type like</p>\n\n<pre><code>data X = X {foo :: SInteger, bar :: SInteger}\n</code></pre>\n\n<p>and I want to prove e.g.</p>\n\n<pre><code>forAll_ $ \\x -&gt; foo x + bar x .== bar x + foo x\n</code></pre>\n\n<p>using haskell's <a href=\"https://www.stackage.org/package/sbv\" rel=\"nofollow\">sbv</a>.\nThis doesn't compile because <code>X -&gt; SBool</code> is not an instance of Provable. I can make it an instance with e.g.</p>\n\n<pre><code>instance (Provable p) =&gt; Provable (X -&gt; p) where\n  forAll_ k = forAll_ $ \\foo bar -&gt; forAll_ $ k $ X foo bar\n  forAll (s : ss) k =\n    forAll [\"foo \" ++ s, \"bar \" ++ s] $ \\foo bar -&gt; forAll ss $ k $ X foo bar\n  forAll [] k = forAll_ k\n  -- and similarly `forSome_` and `forSome`\n</code></pre>\n\n<p>but this is tedious and error prone (e.g. using <code>forSome</code> when <code>forAll</code> should've been used). Is there a way to automatically derive <code>Provable</code> for my type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1476170941, "post_id": 39972086, "comment_id": 67223718, "body": "Foldr etc. have <i>nothing</i> to do with appending to the end of the list, so no they don&#39;t have that problem."}], "answers": [{"comments": [{"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1476172865, "post_id": 39972397, "comment_id": 67224700, "body": "Thank you. But I don&#39;t understand still. I added the <b>UPD</b> section into my topic. Look it please."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1476189871, "last_edit_date": 1495541970, "creation_date": 1476171283, "answer_id": 39972397, "question_id": 39972086, "link": "https://stackoverflow.com/questions/39972086/why-the-foldr-foldr1-scanr-and-scanr1-functions-havent-a-problem-wit/39972397#39972397", "title": "Why the `foldr`, `foldr1`, `scanr` and `scanr1` functions haven&#39;t a _problem with productivity when they are applied to big lists?", "body": "<p>It's tricky since Haskell is lazy.</p>\n\n<p>Evaluating <code>head ([1..1000000]++[1..1000000])</code> will return immediately, with <code>1</code>. The lists will never be fully created in memory: only the first element of the first list will be.</p>\n\n<p>If you instead demand the full list <code>[1..1000000]++[1..1000000]</code> then <code>++</code> will indeed have to create a two-million long list.</p>\n\n<p><code>foldr</code> may or may not evaluate the full list. It depends on whether the function we use is lazy. For example, here's <code>map f xs</code> written using <code>foldr</code>:</p>\n\n<pre><code>foldr (\\y ys -&gt; f y : ys) [] xs\n</code></pre>\n\n<p>This is efficient as <code>map f xs</code> is: lists cells are produced on demand, in a streaming fashion. If we need only the first ten elements of the resulting list, then we indeed create only the first ten cells -- <code>foldr</code> will not be applied to the rest of the list. If we need the full resulting list, then <code>foldr</code> will be run over the full list.</p>\n\n<p>Also note that <code>xs++ys</code> can be defined similarly in terms of <code>foldr</code>:</p>\n\n<pre><code>foldr (:) ys xs\n</code></pre>\n\n<p>and has similar performance properties.</p>\n\n<p>By comparison, <code>foldl</code> instead <a href=\"https://stackoverflow.com/a/37968486/3234959\">always runs over the whole list</a>.</p>\n\n<p>In the example you mention we have <code>longList ++ [something]</code>, appending to the end of the list. This only costs constant time if all we demand is the first element of the resulting list. But if we really need the last element we added, then appending will need to run over the whole list. This is why appending at the end is considered O(n) instead of O(1).</p>\n\n<hr>\n\n<p>In the last update, the question speaks about computing the sum with <code>foldr</code> vs <code>foldl</code>, using the <code>(+)</code> operator. In such case, since <code>(+)</code> is strict (it needs both arguments to compute result) then both folds witll need to scan the whole list. The performance in such cases can be comparable. Indeed, they would compute, respectively</p>\n\n<pre><code>1 + (2 + (3 + (4 + .....       -- foldr\n(...(((1 + 2) + 3) +4) + ....  -- foldl \n</code></pre>\n\n<p>By comparison <code>foldl'</code> would be more memory efficient, since it starts reducing the above sum <em>before</em> building the above giant expression. That is, it would compute <code>1+2</code> first (3), then <code>3+3</code> (6), then <code>6 + 4</code> (10),... keeping in memory only the last result (a single integer) while the list is being scanned.</p>\n\n<p>To the OP: the topic of laziness is not easy to grasp the first time. It is quite vast -- you just met a ton of different examples which have subtle but significant performance differences. It's hard to explain everything succinctly -- it's just too broad. I'd recommend to focus on small examples and start digesting those first.</p>\n"}], "owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 1, "accepted_answer_id": 39972397, "answer_count": 1, "score": 0, "last_activity_date": 1476189871, "creation_date": 1476169930, "last_edit_date": 1476173832, "question_id": 39972086, "link": "https://stackoverflow.com/questions/39972086/why-the-foldr-foldr1-scanr-and-scanr1-functions-havent-a-problem-wit", "title": "Why the `foldr`, `foldr1`, `scanr` and `scanr1` functions haven&#39;t a _problem with productivity when they are applied to big lists?", "body": "<p>I read the old Russian translate of the <a href=\"http://learnyouahaskell.com/introduction\" rel=\"nofollow\">Learn You a Haskell for Great Good!</a> book. I see that the current English version (online) is newer, therefore I look it time of time also. </p>\n\n<p>The <a href=\"http://learnyouahaskell.com/starting-out#an-intro-to-lists\" rel=\"nofollow\">quote</a>:</p>\n\n<blockquote>\n  <p>When you put together two lists (even if you append a singleton list\n  to a list, for instance: <code>[1,2,3] ++ [4])</code>, internally, <strong>Haskell has to\n  walk through the whole list</strong> on the left side of <code>++</code>. That's not a\n  problem when dealing with lists that aren't too big. <strong>But putting\n  something at the end of a list that's fifty million entries long is\n  going to take a while</strong>. However, putting something at the beginning of\n  a list using the <code>:</code> operator (also called the cons operator) is\n  instantaneous.</p>\n</blockquote>\n\n<p><em>I assumed</em> that Haskell has to walk through the whole list <strong>to get the last item of the list</strong> for the <code>foldr</code>, <code>foldr1</code>, <code>scanr</code> and <code>scanr1</code> functions. Also <em>I assumed</em> that Haskell will do the same for getting a previous element (and so on for each item). </p>\n\n<p>But I see I was mistaken:</p>\n\n<p><strong>UPD</strong></p>\n\n<p>I try this code and I see the similar time of processing for both cases:</p>\n\n<pre><code>data' = [1 .. 10000000]\nsum'r = foldr1 (\\x acc -&gt; x + acc ) data' \nsum'l = foldl1 (\\acc x -&gt; x + acc ) data'\n</code></pre>\n\n<p>Is each list of Haskell bidirectional? <em>I assume</em> that for getting last item of list Haskell at first are to iterate each item and to remember the necessary item (last item for example) for getting (later) the previous item of bidirectional list (for lazy computation). Am I right?</p>\n"}, {"tags": ["file", "haskell", "multiple-columns", "rows"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6952338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/185Nx.jpg?s=128&g=1", "display_name": "EvilHappyHippo", "link": "https://stackoverflow.com/users/6952338/evilhappyhippo"}, "edited": false, "score": 0, "creation_date": 1476164500, "post_id": 39970894, "comment_id": 67221325, "body": "Thank you so much, you are a lifesaver! One more question though, where exactly should I feed my data and the numbers? If I use for example: data &lt;- getData &quot;test.txt&quot;, it just throws an error back."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13, "user_id": 6952338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/185Nx.jpg?s=128&g=1", "display_name": "EvilHappyHippo", "link": "https://stackoverflow.com/users/6952338/evilhappyhippo"}, "edited": false, "score": 0, "creation_date": 1476165030, "post_id": 39970894, "comment_id": 67221461, "body": "Added some description. The file is expected as standard input, so some shell commands can save the day."}, {"owner": {"reputation": 13, "user_id": 6952338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/185Nx.jpg?s=128&g=1", "display_name": "EvilHappyHippo", "link": "https://stackoverflow.com/users/6952338/evilhappyhippo"}, "edited": false, "score": 0, "creation_date": 1476165370, "post_id": 39970894, "comment_id": 67221555, "body": "Again, thank you very much. This really helped me a lot! Last question: is there any way to do this automatically after compiling the script in GHCi? Cheers!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13, "user_id": 6952338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/185Nx.jpg?s=128&g=1", "display_name": "EvilHappyHippo", "link": "https://stackoverflow.com/users/6952338/evilhappyhippo"}, "edited": false, "score": 0, "creation_date": 1476165510, "post_id": 39970894, "comment_id": 67221586, "body": "@EvilHappyHippo in GHCi it might be a bit annoying - I really recommend you just compile it with GHC and then run it. The problem is that I know of no easy way to redirect input from a file for GHCi."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1476164975, "last_edit_date": 1476164975, "creation_date": 1476162975, "answer_id": 39970894, "question_id": 39970655, "link": "https://stackoverflow.com/questions/39970655/haskell-file-reading-and-finding-values/39970894#39970894", "title": "Haskell file reading and finding values", "body": "<p>Here is an example of a script to do what you want. Note that this will in its current form does not fail gracefully (but given this is a script, I doubt this is a concern). Make sure there is a trailing newline at the end of your file!</p>\n\n<pre><code>import Control.Monad (replicateM, when)\nimport Data.Traversable (for)\nimport System.Environment (getArgs)\n\nmain = do\n\n  -- numbers we are looking for\n  numbers &lt;- getArgs \n\n  -- get the key-value metadata\n  metadata &lt;- replicateM 6 $ do\n    [key,value] &lt;- words &lt;$&gt; getLine\n    return (key,value)\n\n  let Just rows = read &lt;$&gt; lookup \"nrows\" metadata\n      Just cols = read &lt;$&gt; lookup \"ncols\" metadata\n\n  -- loop over all the entries\n  for [1..rows] $ \\row -&gt;do\n    rawRow &lt;- words &lt;$&gt; getLine\n    for (zip [1..cols] rawRow) $ \\(col,cell) -&gt;\n      when (cell `elem` numbers)\n        (putStrLn (\"The value \" ++ cell ++ \" is in row \" ++ show row ++ \" and column \" ++ show col))\n</code></pre>\n\n<p>To use it, pass it as command line arguments the numbers you are looking for and then feed as input your data file.</p>\n\n<pre><code>$ ghc script.hs\n$ ./script 9 1 2 3 &lt; data.txt\n</code></pre>\n\n<p>Let me know if you have any questions!</p>\n\n<hr>\n\n<p>I wasn't really sure if you wanted to look up just a fixed set of numbers, or any non-zero number. As your question asked for the former, that is what I did.</p>\n"}], "owner": {"reputation": 13, "user_id": 6952338, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/185Nx.jpg?s=128&g=1", "display_name": "EvilHappyHippo", "link": "https://stackoverflow.com/users/6952338/evilhappyhippo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 39970894, "answer_count": 1, "score": 0, "last_activity_date": 1476164975, "creation_date": 1476161262, "question_id": 39970655, "link": "https://stackoverflow.com/questions/39970655/haskell-file-reading-and-finding-values", "title": "Haskell file reading and finding values", "body": "<p>I have recently started learning Haskell and I'm having a hard time figuring out how to interpret text files.</p>\n\n<p>I have following .txt file:</p>\n\n<pre><code>ncols         5\nnrows         5\nxllcorner     809970\nyllcorner     169790\ncellsize      20\nNODATA_value  -9999\n9 0 0 0 0\n0 1 0 0 0\n0 0 0 0 0\n0 0 0 0 0\n0 2 0 0 3\n</code></pre>\n\n<p>The first 6 lines just display some information I need when working with the file in a GIS software. The real deal starts when I try to work with the numbers below in Haskell.</p>\n\n<p>I want to tell Haskell to look up where the numbers 9, 1, 2 and 3 are and print back the number of the row and column where those numbers actually are. In this case Haskell should print:</p>\n\n<pre><code>The value 9 is in row 1 and column 1\nThe value 1 is in row 2 and column 2\nThe value 2 is in row 5 and column 2\nThe value 3 is in row 5 and column 5\n</code></pre>\n\n<p>I tried finding the solution (or at least similar methods for interpreting files) in tutorials and other Haskell scripts without any success, so any help would be greatly appreciated.</p>\n"}, {"tags": ["haskell", "pattern-matching", "do-notation"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1476148364, "post_id": 39968972, "comment_id": 67217584, "body": "Off topic: [1] Nitpicking: Haskell Wiki /= Haskell Wikibook (it is a common mix-up). [2] If there is indeed a bug in the book it was a very appropriate moment to report it, as the MonadPlus chapter will be updated for the AMP in a short while. Thanks!"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1476148779, "post_id": 39968972, "comment_id": 67217676, "body": "@duplode Ok, I am going to change it to Haskell Wikibook as you said"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1476148887, "post_id": 39968972, "comment_id": 67217700, "body": "@duplode Sorry for my ignorance, but what does AMP mean?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1476149210, "post_id": 39968972, "comment_id": 67217761, "body": "@FtheBuilder <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow noreferrer\">Applicative-Monad Proposal</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1476149221, "post_id": 39968972, "comment_id": 67217765, "body": "Applicative-Monad Proposal, that is, the changes in GHC 7.10 that made <code>Applicative</code> a superclass of <code>Monad</code>. To pick an arbitrary example, <code>guard</code>, which used to have a <code>MonadPlus</code> constraint, now has an <code>Alternative</code> one. That means there is some slightly broken code in the Monad Transformers chapter of the book (which uses <code>guard</code> in one example), and fixing it in the proper way will require discussing <code>Alternative</code> in the MonadPlus chapter."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1476149993, "post_id": 39968972, "comment_id": 67217933, "body": "(By the way, I have just fixed the code in the book.)"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1476149018, "post_id": 39969059, "comment_id": 67217722, "body": "Yup, it is wrong indeed. Most likely the author of the exercise mistyped <code>let</code> instead of <code>&lt;-</code>, and in the intervening eight years it slipped through the fingers of everyone (myself included!)."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1476148515, "creation_date": 1476148515, "answer_id": 39969059, "question_id": 39968972, "link": "https://stackoverflow.com/questions/39968972/haskell-strange-do-block-behavior/39969059#39969059", "title": "Haskell - Strange do block behavior", "body": "<p>I think the wiki is wrong. They are probably confusing this with the fact that <em>binds</em> fail via the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:fail\"><code>fail</code></a> function a <code>Monad</code> affords. So the following example <em>will</em> use the <code>fail</code> function from <code>Maybe</code>, which returns <code>Nothing</code>:</p>\n\n<pre><code>char :: Char -&gt; String -&gt; Maybe (Char, String)\nchar c s = do\n  (c':s') &lt;- return s\n  if c == c' then Just (c, s') else Nothing\n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 1, "accepted_answer_id": 39969059, "answer_count": 1, "score": 5, "last_activity_date": 1476148814, "creation_date": 1476147713, "last_edit_date": 1476148814, "question_id": 39968972, "link": "https://stackoverflow.com/questions/39968972/haskell-strange-do-block-behavior", "title": "Haskell - Strange do block behavior", "body": "<p>While reading the <strong>Haskell Wikibook</strong> about <a href=\"https://en.wikibooks.org/wiki/Haskell/MonadPlus\" rel=\"nofollow\">MonadPlus</a>, I found the following function which basically takes a <code>Char</code> and a <code>String</code> and returns <code>Just (char,tail)</code> if such char is equal the string head, or <code>Nothing</code> otherwise:</p>\n\n<pre><code>char :: Char -&gt; String -&gt; Maybe (Char, String)\nchar c s = do\n  let (c':s') = s\n  if c == c' then Just (c, s') else Nothing\n</code></pre>\n\n<p>and they explain that <code>let (c':s') = s</code> will not produce an exception, cause it is in a <code>do</code> block which would evaluate to <code>Nothing</code> when the pattern fails, but, that isn't the case, because when I tried it:</p>\n\n<pre><code>*Main&gt; char 'a' \"\"\n*** Exception: exercice2.hs:5:7-17: Irrefutable pattern failed for pattern (c' : s')\n</code></pre>\n\n<p>So I had to rewrite it to:</p>\n\n<pre><code>char' :: Char -&gt; String -&gt; Maybe (Char, String)\nchar' _ [] = Nothing\nchar' c (c':s') \n  | c == c' = Just (c,s')\n  | otherwise = Nothing\n</code></pre>\n\n<p>and it worked as expected... Why is it happening to me?</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476200150, "post_id": 39968280, "comment_id": 67240735, "body": "Minor nitpick: you don&#39;t absolutely need to calculate the total <i>in advance</i> - you can compute the list result and the total in a single traversal of the input list, all thanks to the magic of laziness."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476208249, "post_id": 39968280, "comment_id": 67245647, "body": "@user2407038 I don&#39;t fully understand that - how can you use the sum-total  without it being previously calculated and run this in a single traversal. do you mean that the computation of the percentage is deferred until the list is fully evaluated?"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 2, "last_activity_date": 1476142510, "last_edit_date": 1476142510, "creation_date": 1476142198, "answer_id": 39968280, "question_id": 39968195, "link": "https://stackoverflow.com/questions/39968195/haskell-unmodified-variable-in-a-recursive-function/39968280#39968280", "title": "Haskell - unmodified variable in a recursive function", "body": "<p>You need to calculate the total in advance - you can use something like </p>\n\n<pre><code>f :: Integral b =&gt; [(a,b)] -&gt; [(a,b)]\nf lst = let total = sum $ map snd list\n         in map (\\(x,y) -&gt; (x,(100 * y)`div` total)) lst\n</code></pre>\n\n<p>Note: it would be a good idea to collect the <code>Integral</code>-values associated to each character beforehand, this makes the output a bit more clear (in my opinion), but this would be an exercise for the astute reader.</p>\n\n<p>To make this function more clear - I would also recommend introducing <code>newtypes</code> for <code>Value</code> and <code>Percentage</code> such that you never try to add values with percentages.</p>\n\n<pre><code>newtype Value a = V {extractV :: a}\nnewtype Percentage = P {percent :: Integer}\n\nf :: Integral b =&gt; [(a,Value b)] -&gt; [(a,Percentage)]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6929012"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 1, "accepted_answer_id": 39968280, "answer_count": 1, "score": 1, "last_activity_date": 1476142510, "creation_date": 1476141631, "question_id": 39968195, "link": "https://stackoverflow.com/questions/39968195/haskell-unmodified-variable-in-a-recursive-function", "title": "Haskell - unmodified variable in a recursive function", "body": "<p>I have a list of char and integer like <code>[('1',1),('2',2),('3',3),('4',4),('5',5)]</code> and want to turn the integers into the percentage each number count for the total such as <code>[('1',7),('2',13),('3',20),('4',27),('5',33)]</code>. I have tried a recursive function which takes a parameter as <code>(c,i):rest</code> and then divide the <code>i</code> by the total and then call the function with <code>rest</code>. But after every single loop, the total has changed. So is there any way I declare the total from start and use it over and over like other languages.</p>\n"}, {"tags": ["haskell", "tree", "append", "fold"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1476137987, "post_id": 39967560, "comment_id": 67214945, "body": "While the type of <code>foldT</code> makes it possible to make a good guess, you should add the definition of your tree data type."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1476138159, "post_id": 39967560, "comment_id": 67215008, "body": "You probably want something like <code>toList = foldT (\\c l r -&gt; l ++ [c] ++ r) []</code>, although you haven&#39;t told us if you want the conversion to list to be in-order, pre-order, or post-order."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476151425, "post_id": 39967560, "comment_id": 67218313, "body": "What does the first argument <i>do</i> with its arguments? It seems like it is almost certainly duplicating some of what <code>foldT</code> itself already does: recursively doing to the subtrees what it does to the root and combining the three."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1476200267, "last_edit_date": 1495540921, "creation_date": 1476139344, "answer_id": 39967839, "question_id": 39967560, "link": "https://stackoverflow.com/questions/39967560/how-to-write-a-function-of-type-a-b-b-b-for-folding-a-tree/39967839#39967839", "title": "How to write a function of type a-&gt; b -&gt; b -&gt; b for folding a tree", "body": "<p>As you haven't posted it, I will assume your tree is...</p>\n\n<pre><code>data Tree a = Leaf | Node a (Tree a) (Tree a)\n</code></pre>\n\n<p>... and that the <code>a -&gt; b -&gt; b -&gt; b</code> argument to <code>foldT</code> takes the fields of the <code>Node</code> constructor in the same order they were declared.</p>\n\n<blockquote>\n  <p>I am trying to find a way to convert my tree into a list</p>\n</blockquote>\n\n<p>Let's begin tackling this by following the types:</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n</code></pre>\n\n<p>You want to flatten it into a list, so the result type of your function must be <code>[a]</code>:</p>\n\n<pre><code>treeToList :: Tree a -&gt; [a]\n</code></pre>\n\n<p>That give us a good idea on how to continue:</p>\n\n<pre><code>treeToList t = foldT f z t\n</code></pre>\n\n<p>With:</p>\n\n<pre><code>f :: a -&gt; [a] -&gt; [a] -&gt; [a]\nz :: [a]\nt :: Tree a\n</code></pre>\n\n<p>Now, onward to the arguments. <code>z</code> is what will be inserted in lieu of the valueless <code>Leaf</code>s, and so it must be <code>[]</code>. As for <code>f</code>, it must combine the sublists created from the left and right branches with the value directly in the <code>Node</code>. Assuming an in-order traversal, we have:</p>\n\n<pre><code> treeToList t = foldT (\\x l r -&gt; l ++ x : r) [] t\n</code></pre>\n\n<p>Or, without mentioning <code>t</code>:</p>\n\n<pre><code> treeToList = foldT (\\x l r -&gt; l ++ x : r) []\n</code></pre>\n\n<p>And that's it. One caveat is that repeatedly using left-nested <code>(++)</code> (which will happen in this case, as <code>foldT</code> walks down the branches recursively) can get quite inefficient. In a situation in which you would care about performance it would be worth considering alternative ways of implementing the concatenating function, such as <a href=\"https://hackage.haskell.org/package/dlist-0.8.0.2/docs/Data-DList.html\" rel=\"nofollow noreferrer\">difference lists</a>.</p>\n\n<p>P.S.: A note about terminology. Saying that a function is \"like foldr but for trees\" is ambiguous, as there are two well-known kinds of functions analogous to <code>foldr</code>. First, you have the methods of the <code>Foldable</code> class (cf. <a href=\"https://stackoverflow.com/a/39977162/2751851\">Benjamin Hodgson's answer</a>), which flatten the tree into a list as they fold it, no matter what you do. Then there are the more powerful <em>catamorphisms</em>, such as the <code>foldT</code> you are using, which are able to make use of the tree structure.</p>\n"}, {"tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": false, "score": -1, "last_activity_date": 1476157604, "creation_date": 1476157604, "answer_id": 39970226, "question_id": 39967560, "link": "https://stackoverflow.com/questions/39967560/how-to-write-a-function-of-type-a-b-b-b-for-folding-a-tree/39970226#39970226", "title": "How to write a function of type a-&gt; b -&gt; b -&gt; b for folding a tree", "body": "<p>The first thing you start with every time is just to start matching patterns :)  At that point, it's pretty much mechanical!</p>\n\n<p>Assuming you have:</p>\n\n<pre><code>data Tree a = Leaf | Node (Tree a) a (Tree a)\n</code></pre>\n\n<p>Let's start matching patterns! :)</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldT f z ...\n</code></pre>\n\n<p>What's the first <code>Tree</code> constructor?  It's <code>Leaf</code>!</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldT f z Leaf = ...\n</code></pre>\n\n<p>What could we put there?  We need something of type <code>b</code>...and we only have one one way to get it.  by using <code>z</code> :)</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldT f z Leaf = z\n</code></pre>\n\n<p>And so, mechanically, we can move on to the next possible pattern:</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldT f z Leaf           = z\nfoldT f z (Node t1 x t2) =\n</code></pre>\n\n<p>Well, we can just make it <code>z</code>, but that's a little boring.  We probably want to use <code>t1</code>, <code>x</code>, and <code>t2</code>.  We can use <code>f</code>, which needs something of type <code>a</code>...and we have <code>x :: a</code> :)</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldT f z Leaf           = z\nfoldT f z (Node t1 x t2) = f x ??? ???\n</code></pre>\n\n<p><code>f</code> has two more arguments, of type <code>b</code>, so what do you think we could put there?  We can put <code>z</code> twice, but that's a little boring.  How can we get <code>b</code>'s from <code>t1</code> and <code>t2</code>?</p>\n"}, {"comments": [{"owner": {"reputation": 2247, "user_id": 1592783, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9k38I.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/1592783/jack"}, "edited": false, "score": 1, "creation_date": 1490876190, "post_id": 39971327, "comment_id": 73314316, "body": "I didn&#39;t but I would guess you were downvoted for either providing the wrong answer. Or that you &quot;don&#39;t think I should be giving you the answer&quot; as this is a Q&amp;A site, so providing the answer if kind of the point of it..."}, {"owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "reply_to_user": {"reputation": 2247, "user_id": 1592783, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9k38I.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/1592783/jack"}, "edited": false, "score": 1, "creation_date": 1544013926, "post_id": 39971327, "comment_id": 94124667, "body": "@Jack I know this is old and is been a while but the answer was correct and I did provide the answer. I was just downvoted by a funny guy who probably didn&#39;t like me writing &quot;I don&#39;t think I should be giving you the answer&quot;, but I had my reasons for saying that."}], "tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": false, "score": 0, "last_activity_date": 1476199691, "last_edit_date": 1476199691, "creation_date": 1476166154, "answer_id": 39971327, "question_id": 39967560, "link": "https://stackoverflow.com/questions/39967560/how-to-write-a-function-of-type-a-b-b-b-for-folding-a-tree/39971327#39971327", "title": "How to write a function of type a-&gt; b -&gt; b -&gt; b for folding a tree", "body": "<p>If you want to convert the tree onto a list then the function is relatively easy,\nso basically if you have tree structure such as:</p>\n\n<pre><code>data Tree a = Leaf | Node (Tree a) a (Tree a) deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>Then you'd have to extract the value from the tree and add the first value onto an empty list, then apply the same method to the other branches of the tree  recursively with the help of the list (++) operator to append all results onto a single list, i.e.:</p>\n\n<pre><code>toList :: Tree a -&gt; [a]\ntoList Leaf                    =    []\ntoList (Node left value right) =    [value] ++ toList left ++ toList right\n</code></pre>\n\n<p>then to fold it, first:</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n</code></pre>\n\n<p>The function signature is missing an argument here lets look at the signature: <strong>a(first argument) -> b (second) -> b (third) -> b (return type)</strong>  the function takes <strong>3 arguments</strong>/parameters but <strong>the signature</strong> you provided <strong>only has 1 b type</strong> (which im guessing is your accumulator), so basically this would be the function signature you're looking for:</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n</code></pre>\n\n<p>Now we can work with this signature, then let's move onto the function:</p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\nfoldT f acc Leaf                    =   acc\nfoldT f acc (Node left value right) =   foldT f (foldT f (f value acc) left) right\n</code></pre>\n\n<p>Although I don't think I should be giving you the answer and you should practice a bit more with recursive data structures so you can better understand how to traverse through them. </p>\n\n<p><strong>PS: If you're going to down vote me, then at least explain why!</strong></p>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 6946322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b746cb456e851751731df0e14235956?s=128&d=identicon&r=PG&f=1", "display_name": "Jenn24", "link": "https://stackoverflow.com/users/6946322/jenn24"}, "edited": false, "score": 0, "creation_date": 1476203226, "post_id": 39977162, "comment_id": 67242749, "body": "Thank you, but my assignment requires me to write my own foldr for trees."}, {"owner": {"reputation": 9560, "user_id": 2023370, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4840a671d94ce5df0818cce059cab62b?s=128&d=identicon&r=PG&f=1", "display_name": "user2023370", "link": "https://stackoverflow.com/users/2023370/user2023370"}, "edited": false, "score": 0, "creation_date": 1563813735, "post_id": 39977162, "comment_id": 100816032, "body": "I get an error with this code: <code>error: Variable not in scope: toList :: Tree a -&gt; [a]</code>. I&#39;m using GCH 8.4.4."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 9560, "user_id": 2023370, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4840a671d94ce5df0818cce059cab62b?s=128&d=identicon&r=PG&f=1", "display_name": "user2023370", "link": "https://stackoverflow.com/users/2023370/user2023370"}, "edited": false, "score": 1, "creation_date": 1563813785, "post_id": 39977162, "comment_id": 100816055, "body": "@user2023370 thanks, fixed the code. I forgot to import the module"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 4, "last_activity_date": 1563813787, "last_edit_date": 1563813787, "creation_date": 1476188579, "answer_id": 39977162, "question_id": 39967560, "link": "https://stackoverflow.com/questions/39967560/how-to-write-a-function-of-type-a-b-b-b-for-folding-a-tree/39977162#39977162", "title": "How to write a function of type a-&gt; b -&gt; b -&gt; b for folding a tree", "body": "<p>Yuck, why are you writing <em>code</em>? GHC can automatically fill in an instance of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#t:Foldable\" rel=\"nofollow noreferrer\">the <code>Foldable</code> class</a>, which contains the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:toList\" rel=\"nofollow noreferrer\"><code>toList</code></a> you're looking for.</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\nimport Data.Foldable\n\ndata Tree a = Leaf | Node a (Tree a) (Tree a) deriving Foldable\n\ntreeToList :: Tree a -&gt; [a]\ntreeToList = toList\n</code></pre>\n\n<p>This definition of <code>treeToList</code> will perform a <a href=\"https://en.wikipedia.org/wiki/Tree_traversal#Pre-order\" rel=\"nofollow noreferrer\">pre-order traversal</a> because of the order of the fields of the <code>Node</code> constructor.</p>\n"}], "owner": {"reputation": 53, "user_id": 6946322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b746cb456e851751731df0e14235956?s=128&d=identicon&r=PG&f=1", "display_name": "Jenn24", "link": "https://stackoverflow.com/users/6946322/jenn24"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 2, "accepted_answer_id": 39967839, "answer_count": 4, "score": 2, "last_activity_date": 1563813787, "creation_date": 1476137644, "last_edit_date": 1476139806, "question_id": 39967560, "link": "https://stackoverflow.com/questions/39967560/how-to-write-a-function-of-type-a-b-b-b-for-folding-a-tree", "title": "How to write a function of type a-&gt; b -&gt; b -&gt; b for folding a tree", "body": "<p>Some background: I have a foldT function (like foldr but for trees) of the following type in Haskell. </p>\n\n<pre><code>foldT :: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b \n</code></pre>\n\n<p>This foldT only takes type (a -> b -> b -> b) as an input function.</p>\n\n<p>I am trying to find a way to convert my tree into a list, and cannot figure out a way to make my append function take the form (a -> b -> b -> b). </p>\n\n<p>The following is ineffective because it is not the correct type: </p>\n\n<pre><code>append x y z = append x:y:z \n</code></pre>\n\n<p>Any help would be appreciated. </p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "ghc-mod"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1476150041, "post_id": 39966813, "comment_id": 67217949, "body": "I know this is going to sound very not fun, but allow me to recommend you use <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\"><code>stack</code></a>. It makes it <i>much</i> easier to get out of cabal hell with LTS snapshots..."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1476158723, "post_id": 39966813, "comment_id": 67219982, "body": "Can you tell us a little more about your working environment.  I saw the &quot;.stack&quot; in one of the paths in the first transcript that you included above and assumed that you <i>were</i> already using stack (in addition to cabal somehow) but maybe that&#39;s wrong."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1476245712, "post_id": 39966813, "comment_id": 67259240, "body": "I&#39;m using stack for the majority of my stuff, it didn&#39;t seem to be working and I figured it would be easier to get help with cabal, maybe I&#39;m incorrect,  At any rate, I&#39;ve run stack install ghc-mod and have added  ~/.local/bin/ to my path, but I still get errors most of the time"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1476246717, "post_id": 39966813, "comment_id": 67259469, "body": "And of course I updated to MacOs Sierra this week, so that&#39;s causing all sorts of problems with stack now."}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1477655212, "post_id": 39966813, "comment_id": 67865757, "body": "Same problem here with neovim, ghci has no problems but ghc-mod says with the same error messages that this is not ok. Checking the versions, my ghc and ghci are 8.0.1 while ghc-mod refers to 7.10.3. Maybe upgrading to a newer ghc-mod helps? (Cannot remember how to do the upgrade -&gt; it will take some time to try.)"}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1477657447, "post_id": 39966813, "comment_id": 67867002, "body": "Ah, it was just cabal update; cabal install ghc-mod and it seems that the above license-error-msg went away. Cannot tell thou, if the problem was because of a mixture of compiler and its tools (my path seemed to pick something from stack-related directories pointing to older version and something elsewhere). Cabal update compiled the tools with ghc 8.0.1."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1477763365, "post_id": 39966813, "comment_id": 67899511, "body": "Interesting, I&#39;m also using neovim, so maybe that&#39;s related, I&#39;ll try out a few things."}], "answers": [{"tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": true, "score": 0, "last_activity_date": 1478737638, "creation_date": 1478737638, "answer_id": 40518192, "question_id": 39966813, "link": "https://stackoverflow.com/questions/39966813/haskell-ghc-mod-fails-with-error/40518192#40518192", "title": "Haskell ghc-mod fails with error", "body": "<p>This error was caused by having a mismatch between my local stack ghc version and the global ghc-mod ghc version, I updated the ghc version in the stack project to latest and everything is working fine.</p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 40518192, "answer_count": 1, "score": 4, "last_activity_date": 1483466184, "creation_date": 1476133927, "last_edit_date": 1483466184, "question_id": 39966813, "link": "https://stackoverflow.com/questions/39966813/haskell-ghc-mod-fails-with-error", "title": "Haskell ghc-mod fails with error", "body": "<p>I've had nothing but trouble using cabal, not sure if it's due to a lack of understanding, or a faulty mental model, but things have been tough.</p>\n\n<p>At the moment I'm just trying to get ghc-mod to work for my vim plugins. It usually works for a day or two and then starts failing for seemingly no reason with an error, the error I receive seems to change from time to time, right now I'm getting this one:</p>\n\n<pre><code>$ ghc-mod check Main.hs\nghc-mod: /Users/chris/.stack/snapshots/x86_64-osx/lts-6.15/7.10.3/pkgdb/package.cache: \nGHC.PackageDb.readPackageDb: inappropriate type (Not a valid Unicode code point!)\n</code></pre>\n\n<p>Any ideas about how to fix this sort of thing? I've tried installing it again, but I get this (I think my cabal packages are all screwed up but don't know how to fix it):</p>\n\n<pre><code>$ cabal install ghc-mod\nResolving dependencies...\nDownloading haskell-src-exts-1.17.1...\nConfiguring haskell-src-exts-1.17.1...\nFailed to install haskell-src-exts-1.17.1\nBuild log ( /Users/chris/.cabal/logs/haskell-src-exts-1.17.1.log ):\ncabal: Entering directory '/var/folders/6l/rdh2g5wn41s8vxchngkt02_c0000gn/T/cabal-tmp-45583/haskell-src-exts-1.17.1'\nConfiguring haskell-src-exts-1.17.1...\ncabal: The program 'happy' version &gt;=1.19 is required but it could not be\nfound.\ncabal: Leaving directory '/var/folders/6l/rdh2g5wn41s8vxchngkt02_c0000gn/T/cabal-tmp-45583/haskell-src-exts-1.17.1'\ncabal: Error: some packages failed to install:\nghc-mod-5.6.0.0 depends on haskell-src-exts-1.17.1 which failed to install.\nhaskell-src-exts-1.17.1 failed during the configure step. The exception was:\nExitFailure 1\nhlint-1.9.35 depends on haskell-src-exts-1.17.1 which failed to install.\n</code></pre>\n\n<p>Edit:\nLooked away for a second and tried again, now I'm getting this error, getting kinda sick of cabal changing its mind all the time:</p>\n\n<pre><code>$ ghc-mod check Main.hs\n[1 of 5] Compiling CabalHelper.Common ( CabalHelper/Common.hs, /Users/chris/.ghc-mod/cabal-helper/CabalHelper/Common.o  )\n[2 of 5] Compiling CabalHelper.Licenses ( CabalHelper/Licenses.hs, /Users/chris/.ghc-mod/cabal-helper/CabalHelper/Licenses.o  )\n\nCabalHelper/Licenses.hs:53:18: error:\nAmbiguous occurrence \u2018lookupInstalledPackageId\u2019\nIt could refer to either \u2018Distribution.Simple.PackageIndex.lookupInstalledPackageId\u2019,\nimported from \u2018Distribution.Simple.PackageIndex\u2019 at CabalHelper/Licenses.hs:24:1-39\nor \u2018CabalHelper.Licenses.lookupInstalledPackageId\u2019,\ndefined at CabalHelper/Licenses.hs:38:1\n\nCabalHelper/Licenses.hs:74:10: error:\nAmbiguous occurrence \u2018lookupInstalledPackageId\u2019\nIt could refer to either \u2018Distribution.Simple.PackageIndex.lookupInstalledPackageId\u2019,\nimported from \u2018Distribution.Simple.PackageIndex\u2019 at CabalHelper/Licenses.hs:24:1-39\nor \u2018CabalHelper.Licenses.lookupInstalledPackageId\u2019,\ndefined at CabalHelper/Licenses.hs:38:1\nghc-mod: readCreateProcess: /Users/chris/.stack/snapshots/x86_64-osx/lts-6.15/7.10.3/libexec/cabal-helper-wrapper \"--with-ghc=/usr/local/bin/ghc\" \"--with-ghc-pkg=/usr/local/bin/ghc-pkg\" \"--with-cabal=cabal\" \"/Users/chris/dev/formatter\" \"/Users/chris/dev/formatter/.stack-work/dist/x86_64-osx/Cabal-1.24.0.0\" \"package-db-stack\" \"entrypoints\" \"source-dirs\" \"ghc-options\" \"ghc-src-options\" \"ghc-pkg-options\" \"ghc-merged-pkg-options\" \"ghc-lang-options\" \"licenses\" \"flags\" \"config-flags\" \"non-default-config-flags\" \"compiler-version\" (exit 1): failed\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 6, "creation_date": 1476132627, "post_id": 39966389, "comment_id": 67212929, "body": "<code>map (head &amp;&amp;&amp; length) . group . sort</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1476135128, "post_id": 39966389, "comment_id": 67213977, "body": "@karakfa Arrows might not be the best concept to throw at beginners."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1476135485, "post_id": 39966389, "comment_id": 67214121, "body": "OK then, replace with <code>\\x -&gt; (head x, length x)</code>"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1476135615, "post_id": 39966389, "comment_id": 67214161, "body": "Hint: <code>x,(letterOccur x (x:xs))</code> doesn&#39;t define a tuple in Haskell.  It does in OCaml though."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1476135888, "post_id": 39966389, "comment_id": 67214265, "body": "This looks like it&#39;s a typo. Just do <code>[(x, letterOccur x (x:xs))]</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1476136047, "post_id": 39966389, "comment_id": 67214319, "body": "@Rhymoid: right, who would <a href=\"http://1.droppdf.com/files/rlXDU/what-if-randall-munroe.pdf#page=1362&amp;zoom=auto,0,331.2536\" rel=\"nofollow noreferrer\"><i>throw</i> an arrow</a>? ...seriously though, I&#39;d argue that makes perfect sense to teach beginners about <code>&amp;&amp;&amp;</code> and <code>***</code>, though perhaps only with the simplified signature <code>(a-&gt;b) -&gt; (a-&gt;c) -&gt; a-&gt;(b,c)</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1476140706, "post_id": 39966389, "comment_id": 67215789, "body": "@leftaroundabout That reminds me of an answer in which I didn&#39;t use <code>(&amp;&amp;&amp;)</code> for fear of confusing a beginner, only to end up using <code>liftA2 (,)</code> instead :) (Nowadays I agree with you.)"}], "answers": [{"tags": [], "owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "is_accepted": true, "score": 0, "last_activity_date": 1476168894, "creation_date": 1476168894, "answer_id": 39971869, "question_id": 39966389, "link": "https://stackoverflow.com/questions/39966389/haskell-output-a-type-which-takes-2-parametes/39971869#39971869", "title": "Haskell - output a type which takes 2 parametes", "body": "<p>I'm guessing you're trying to do something like <strong>this</strong>:</p>\n\n<pre><code>letterStats :: [Char] -&gt; [LetterCount]\nletterStats :: [] = []\nletterStats (x:xs) = (x, (+1) $ letterOccur x xs) : letterStats xs\n</code></pre>\n\n<p>All you want to do is <strong>add +1</strong> as you are not counting x when checking xs for all x occurances. Also what you want is to return a list of <strong>the letterCount type</strong> which <strong>is a Tuple</strong> not a list, therefore I changed</p>\n\n<pre><code>[x, letterOccur x xs] ++ letterStats xs\n</code></pre>\n\n<p>to</p>\n\n<pre><code>(x, (+1) $ letterOccur x xs) : letterStats xs\n</code></pre>\n\n<p>Although you could also do this:</p>\n\n<pre><code>[(x, (+1) $ letterOccur x xs)] ++ letterStats xs\n</code></pre>\n\n<p>But is unnecessary.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6929012"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 39971869, "answer_count": 1, "score": 0, "last_activity_date": 1476168894, "creation_date": 1476131931, "question_id": 39966389, "link": "https://stackoverflow.com/questions/39966389/haskell-output-a-type-which-takes-2-parametes", "title": "Haskell - output a type which takes 2 parametes", "body": "<p>I'm trying to make an array of my own type <code>letterCount</code> in form of [('letter',occurance),(),...]. How can I make an output of a type which takes 2 parameters. Here's my code:</p>\n\n<pre><code>type LetterCount = (Char,Int)\n\n letterOccur :: Char-&gt;[Char] -&gt; Int\n letterOccur c [] = 0\n letterOccur c (x:xs) = if (c == x) then ((letterOccur c xs) + 1)\n                          else letterOccur c xs\n\n letterStats :: [Char] -&gt; [LetterCount]\n letterStats :: [] = []\n letterStats (x:xs) = [x,(letterOccur x (x:xs))] ++ letterStats xs\n</code></pre>\n"}, {"tags": ["haskell", "applicative", "category-theory"], "answers": [{"tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 2, "last_activity_date": 1476129043, "last_edit_date": 1476129043, "creation_date": 1476128714, "answer_id": 39965642, "question_id": 39965641, "link": "https://stackoverflow.com/questions/39965641/applicative-instance-for-sets-nested-lists/39965642#39965642", "title": "Applicative instance for sets (nested lists)", "body": "<p>Your instance is almost correct, just a few more suggestions:</p>\n\n<pre><code>instance Applicative Set where\n  pure x = Elem x Empty\n  -- the cartesian product of the empty set and x is empty\n  Empty         &lt;*&gt; x = Empty\n  -- the cartesian product of x and the empty set is empty\n  x             &lt;*&gt; Empty = Empty\n  -- if you encounter a function, apply it to the entire list\n  -- and append the result of the recursive call to the rest.\n  Elem fx  fxs  &lt;*&gt; x = fmap fx x `mappend` (fxs &lt;*&gt; x)\n  -- If you reach a level of nesting, go into the nested list\n  -- and prepend that to the rest.\n  Set  fxs fxss &lt;*&gt; x = Set (fxs &lt;*&gt; x) (fxss &lt;*&gt; x)\n</code></pre>\n\n<p>This instance satisfies all the applicative laws:</p>\n\n<pre><code>pure id  &lt;*&gt; x      = x\npure f   &lt;*&gt; pure x = pure $ f x\npure (.) &lt;*&gt; pure u &lt;*&gt; pure v &lt;*&gt; pure w = u &lt;*&gt; (v &lt;*&gt; w)\nu        &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u\n</code></pre>\n"}], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 39965642, "answer_count": 1, "score": 3, "last_activity_date": 1476130777, "creation_date": 1476128714, "last_edit_date": 1476130777, "question_id": 39965641, "link": "https://stackoverflow.com/questions/39965641/applicative-instance-for-sets-nested-lists", "title": "Applicative instance for sets (nested lists)", "body": "<p>I am currently working on a personal project for my discreet maths class and am trying to formalize set theory in Haskell. A set as defined in our class is an arbitrary nesting of elements of a particular universe. I chose to represent this as the de facto standard nested list:</p>\n\n<pre><code>data Set a where\n  Empty :: Set a\n  Elem  ::   a   -&gt; Set a -&gt; Set a\n  Set   :: Set a -&gt; Set a -&gt; Set a\n</code></pre>\n\n<p>As a lazy Haskell programmer I want to write instances for all the standard typeclasses.</p>\n\n<p>The <code>Functor</code> instance is trivial:</p>\n\n<pre><code>instance Functor Set where\n  fmap _ Empty        = Empty\n  fmap f (Elem x set) = Elem (f x) set\n  fmap f (Set s set)  = Set (fmap f s) $ fmap f set\n</code></pre>\n\n<p><code>Foldable</code> and <code>Traversable</code> are also relatively easy to implement.</p>\n\n<p>Not I'm stuck on <code>Applicative</code>. <code>pure</code> is also straightforward:</p>\n\n<pre><code>instance Applicative Set where\n  pure x = Elem x Empty\n</code></pre>\n\n<p>However, I'm stuck on defining <code>ap</code> for nested lists.</p>\n\n<pre><code>-- set has a monoid instance\n(&lt;*&gt;) :: Set (a -&gt; b) -&gt; Set a -&gt; Set b\nElem fx  fxs  &lt;*&gt; x = fmap fx x `mappend` (fxs &lt;*&gt; x)\nSet  fxs fxss &lt;*&gt; x = Set ???\n</code></pre>\n\n<p>For a normal, not nested list, the applicative instance takes the cartesian product of every function with every element and applies it:</p>\n\n<pre><code>fx &lt;*&gt; xs = [f x | f &lt;- fx, x &lt;- xs]\n</code></pre>\n\n<p>Somehow the nested list must preserve it's underlying structure. <em>What is the correct instance</em>?</p>\n"}, {"tags": ["haskell", "gadt", "type-families", "type-level-computation", "data-kinds"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1476126685, "post_id": 39965006, "comment_id": 67210024, "body": "You cannot with a type family - the kind <code>(Symbol, *)</code> is inhabited by infinitely many types which are not of the form <code>&#39;( _, _)</code> (e.g. <code>Any</code>, <code>Any Any</code>, etc) - <code>Keys</code> and <code>Values</code> must both become <i>classes</i>, in which the body of the class <i>assumes</i> the truth of the constraints in the head and context, as opposed to <i>requiring</i> them as in the case of a type family application. If you want to access these proofs outside of the class, you will have to have a function in the class which constructs a value level representation of such a proof (a GADT, typically)."}], "answers": [{"tags": [], "owner": {"reputation": 229, "user_id": 1615135, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a7cd528eb692ce030109d975269a77d?s=128&d=identicon&r=PG", "display_name": "stonegrizzly", "link": "https://stackoverflow.com/users/1615135/stonegrizzly"}, "is_accepted": false, "score": 1, "last_activity_date": 1476137091, "creation_date": 1476137091, "answer_id": 39967464, "question_id": 39965006, "link": "https://stackoverflow.com/questions/39965006/decorating-type-level-list-with-extra-information-from-type-level-map/39967464#39967464", "title": "Decorating type level list with extra information from type level map", "body": "<p>Taking some cues what user2407038 said, I created a concrete representation of the <code>depMap</code> type and then created a type class to describe a not-quite-singleton-but-at-least-canonical value from the type. </p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n\nimport GHC.Exts\nimport GHC.TypeLits\n\nimport Data.Proxy\n\ntype family AllSatisfy (f :: k -&gt; Constraint) (xs :: [k]) :: Constraint where\n    AllSatisfy f '[] = ()\n    AllSatisfy f (x ': xs) = (f x, AllSatisfy f xs)\n\ndata HList (as :: [*]) where\n    HNil :: HList '[]\n    HCons :: a -&gt; HList as -&gt; HList (a ': as)\n\ntype family Keys (xs :: [(a, b)]) :: [a] where\n    Keys '[] = '[]\n    Keys ( '(a, b) ': xs) = a ': Keys xs\n\ntype family Values (xs :: [(a, b)]) :: [b] where\n    Values '[] = '[]\n    Values ( '(a, b) ': xs) = b ': Values xs\n\nshowHList :: AllSatisfy Show xs =&gt; HList xs -&gt; [String]\nshowHList HNil = []\nshowHList (HCons x xs) = show x : showHList xs\n\ndata SKeyMap :: [(*, Symbol)] -&gt; * where\n  SKeyNil :: SKeyMap '[]\n  SKeyCons :: Proxy a -&gt; Proxy s -&gt; SKeyMap xs -&gt; SKeyMap ( '(a, s) ': xs )\n\nclass KnownKeyMap (keyMap :: [(*, Symbol)]) where\n    sKeyMap :: SKeyMap keyMap\n\n\ninstance KnownKeyMap '[] where\n    sKeyMap = SKeyNil\n\ninstance KnownKeyMap keyMap =&gt; KnownKeyMap ( '(a, s) ': keyMap ) where\n    sKeyMap = SKeyCons Proxy Proxy sKeyMap\n\nshowWithKey' :: forall (keyMap :: [(*, Symbol)]) .\n               (AllSatisfy Show (Keys keyMap)\n               ,AllSatisfy KnownSymbol (Values keyMap)\n               ) =&gt;\n               SKeyMap keyMap -&gt; HList (Keys keyMap) -&gt; [(String, String)]\nshowWithKey' SKeyNil HNil = []\nshowWithKey' (SKeyCons _ sp skRest) (HCons (x :: a) (xs :: HList as)) =\n    (show x, symbolVal sp) : (showWithKey' skRest xs)\n\nshowWithKey :: forall (keyMap :: [(*, Symbol)]) .\n               (KnownKeyMap keyMap\n               ,AllSatisfy Show (Keys keyMap)\n               ,AllSatisfy KnownSymbol (Values keyMap)\n               ) =&gt;\n               HList (Keys keyMap) -&gt; [(String, String)]\nshowWithKey = showWithKey' (sKeyMap @keyMap)\n</code></pre>\n"}], "owner": {"reputation": 229, "user_id": 1615135, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a7cd528eb692ce030109d975269a77d?s=128&d=identicon&r=PG", "display_name": "stonegrizzly", "link": "https://stackoverflow.com/users/1615135/stonegrizzly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1476137091, "creation_date": 1476125962, "last_edit_date": 1476135698, "question_id": 39965006, "link": "https://stackoverflow.com/questions/39965006/decorating-type-level-list-with-extra-information-from-type-level-map", "title": "Decorating type level list with extra information from type level map", "body": "<p>I have this heterogenous list which has its type reflect the types of the values it contains. I can convert all of the elements to strings by checking that every type contained satisfies a constraint: </p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}   \n\nimport GHC.Exts\nimport GHC.TypeLits\n\nimport Data.Proxy\n\ntype family AllSatisfy (f :: k -&gt; Constraint) (xs :: [k]) :: Constraint where\n    AllSatisfy f '[] = ()\n    AllSatisfy f (x ': xs) = (f x, AllSatisfy f xs)\n\ndata HList (as :: [*]) where\n    HNil :: HList '[]\n    HCons :: a -&gt; HList as -&gt; HList (a ': as)\n\ntype family Keys (xs :: [(a, b)]) :: [a] where\n    Keys '[] = '[]\n    Keys ( '(a, b) ': xs) = a ': Keys xs\n\ntype family Values (xs :: [(a, b)]) :: [b] where\n    Values '[] = '[]\n    Values ( '(a, b) ': xs) = b ': Values xs\n\nshowHList :: AllSatisfy Show xs =&gt; HList xs -&gt; [String]\nshowHList HNil = []\nshowHList (HCons x xs) = show x : showHList xs\n</code></pre>\n\n<p>What I'd like to be able to do is specify some extra information via a type level association list, which is indexed by the types in the HList. Something like: </p>\n\n<pre><code>showWithKey :: forall (keyMap :: [(*, Symbol)]) (b :: Symbol) (rest :: [(*, Symbol)]).\n               (AllSatisfy Show (Keys keyMap)\n               ,AllSatisfy KnownSymbol (Values keyMap)\n               ) =&gt;\n               Proxy keyMap -&gt; HList (Keys keyMap) -&gt; [(String, String)]\nshowWithKey _ HNil = []\nshowWithKey _ (HCons (x :: a) (xs :: HList as)) =\n    let p = (Proxy @keyMap) :: Proxy ( '(a, b) ': rest )\n    in (show x, symbolVal (Proxy @b)) : (showWithKey (Proxy @rest) xs)\n</code></pre>\n\n<p>Now, it's clear to see that if <code>(Keys keyMap)</code> is non-empty, then <code>keyMap</code>, but GHC struggles to figured this out: </p>\n\n<pre><code>Could not deduce: keyMap ~ ('(a, b) : rest)\n      from the context: (AllSatisfy Show (Keys keyMap),\n                         AllSatisfy KnownSymbol (Values keyMap))\n        bound by the type signature for:\n                   showWithKey :: (AllSatisfy Show (Keys keyMap),\n                                   AllSatisfy KnownSymbol (Values keyMap)) =&gt;\n                                  Proxy keyMap -&gt; HList (Keys keyMap) -&gt; [(String, String)]\n      or from: Keys keyMap ~ (a : as)\n        bound by a pattern with constructor:\n                   HCons :: forall a (as :: [ghc-prim-0.5.0.0:GHC.Types.*]).\n                            a -&gt; HList as -&gt; HList (a : as),\n                 in an equation for \u2018showWithKey\u2019\n      \u2018keyMap\u2019 is a rigid type variable bound by\n        the type signature for:\n          showWithKey :: forall (keyMap :: [(ghc-prim-0.5.0.0:GHC.Types.*,\n                                             Symbol)]) (b :: Symbol) (rest :: [(ghc-prim-0.5.0.0:GHC.Types.*,\n                                                                                Symbol)]).\n                         (AllSatisfy Show (Keys keyMap),\n                          AllSatisfy KnownSymbol (Values keyMap)) =&gt;\n                         Proxy keyMap -&gt; HList (Keys keyMap) -&gt; [(String, String)]\n      Expected type: Proxy ('(a, b) : rest)\n        Actual type: Proxy keyMap \n</code></pre>\n\n<p>How can I rewrite this so that GHC can figure things out?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1476124285, "post_id": 39962671, "comment_id": 67208811, "body": "One solution is to use a newtype as the output of the function, so that the type family doesn&#39;t overlap (i.e. could exist as an open family). Can it be done without a silly wrapper that simply goes on and immediately comes back off?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476126360, "post_id": 39962671, "comment_id": 67209859, "body": "Do you have an actual implementation for <code>wrap</code>? It seems to me this function is inhabited by only <code>const ...</code> (and various bottoms of course). <code>ResultOf a ~ a</code> asserts that <code>a</code> is not a function type, because this cannot be true if the first pattern ever matched, but it doesn&#39;t contain a proof of such - you must construct that yourself. Typically the way to do this is to write a GADT modelling the proof and have a type class which constructs values of this proof implicitly."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476129643, "post_id": 39962671, "comment_id": 67211495, "body": "@user2407038 <code>wrap</code> uses a simple type class (not shown, since it isn&#39;t relevant to the inference issue) to randomly generate function arguments, much like QuickCheck&#39;s Testable class."}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1476116680, "creation_date": 1476116680, "question_id": 39962671, "link": "https://stackoverflow.com/questions/39962671/monomorphizing-with-type-families", "title": "Monomorphizing with Type Families", "body": "<p>The following code compiles, but only with an explicit type signature in <code>bar</code>:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n\ntype family ResultOf a where\n  ResultOf (a -&gt; b) = ResultOf b\n  ResultOf a = a\n\nwrap :: (Monad rnd, ResultOf bnch ~ rnd Int) =&gt; bnch -&gt; rnd Int\nwrap = undefined\n\nfoo :: (Monad m) =&gt; m Int\nfoo = undefined\n\nbar :: forall rnd . (Monad rnd, ResultOf (rnd Int) ~ rnd Int) =&gt; rnd Int\nbar = wrap (foo :: rnd Int)\n</code></pre>\n\n<p>I understand roughly why the type signature is required: <code>foo</code> is polymorphic, and GHC can't tell that the only way <code>ResultOf (forall m . (MonadRandom m) =&gt; m Int) ~ rnd Int</code> is if we instantiate <code>m</code> at <code>rnd</code>. I'd like this to be true, so that GHC will monomorphize 'foo` with the correct monad without an explicit type signature. Is there some way to convince GHC of this?</p>\n"}, {"tags": ["mysql", "haskell", "yesod", "esqueleto"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1476118232, "post_id": 39962389, "comment_id": 67205865, "body": "You can always use the <code>rawSql</code> function from the <code>persistent</code> library. Another way would be to just create a PR for Esqueleto which returns around 20 tuples. But I guess this is not the answer you are looking for. :)"}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1476118441, "post_id": 39962389, "comment_id": 67205965, "body": "rawSql seemed to have a limit of 8 columns unless i am mistaken (i&#39;ve been digging around this question for a while)"}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1476118768, "post_id": 39962389, "comment_id": 67206155, "body": "yup only 8 <a href=\"https://hackage.haskell.org/package/persistent-2.2.4/docs/Database-Persist-Sql.html#t:RawSql\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/persistent-2.2.4/docs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1476123166, "post_id": 39963739, "comment_id": 67208316, "body": "&quot;As a convenience, you&#39;ll likely want to define the result using Persistent&#39;s Entity definition quasiquoter. You&#39;ll want to use that definition in a manner that it doesn&#39;t try to generate migrations for that.&quot;  I&#39;m not sure what that means. I&#39;m rather new to haskell/yesod/persistent ... is that the <code>share [mkPersist sqlSettings, mkMigrate &quot;migrateAll&quot;]     $(persistFileWith lowerCaseSettings &quot;config&#47;models&quot;)</code> part of yesod? in the Model.hs?"}, {"owner": {"reputation": 2567, "user_id": 3780203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3f3f9ab585dc56fa27e203ce4eb27fd?s=128&d=identicon&r=PG&f=1", "display_name": "ephrion", "link": "https://stackoverflow.com/users/3780203/ephrion"}, "reply_to_user": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1476124160, "post_id": 39963739, "comment_id": 67208747, "body": "Yes, but you don&#39;t want to <code>mkMigrate</code> since this isn&#39;t a table definition, but a definition of a return type on query. So you&#39;d have a <code>share [mkPersist sqlSettings] [persistLowerCase| {- your model definition -} |]</code> in addition to that."}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1476124595, "post_id": 39963739, "comment_id": 67208971, "body": "Cool, I&#39;ll try it out and most likely mark your answer as correct. Hopefully i get get it to work."}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1476139706, "post_id": 39963739, "comment_id": 67215501, "body": "UPDATE: i got to a point where it wanted me to implement <code>SqlSelect</code> (<a href=\"https://hackage.haskell.org/package/esqueleto-2.4.3/docs/Database-Esqueleto-Internal-Sql.html#t:SqlSelect\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/esqueleto-2.4.3/docs/&hellip;</a>) which I could not figure out how to do. However it does say you can return tuples of tuples which might work out ...... to be continued"}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1476197966, "post_id": 39963739, "comment_id": 67239296, "body": "FINAL UPDATE: I tried to implement the SqlSelect class but couldn&#39;t figure it out in an hour or so and decided to just use nested tuples and then convert that to a datatype."}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 0, "creation_date": 1476198445, "post_id": 39963739, "comment_id": 67239632, "body": "Marked this as the answer because if i could figure out how to implement <code>SqlSelect</code> I think it would indeed &quot;just work&quot;"}], "tags": [], "owner": {"reputation": 2567, "user_id": 3780203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3f3f9ab585dc56fa27e203ce4eb27fd?s=128&d=identicon&r=PG&f=1", "display_name": "ephrion", "link": "https://stackoverflow.com/users/3780203/ephrion"}, "is_accepted": true, "score": 2, "last_activity_date": 1476120835, "creation_date": 1476120835, "answer_id": 39963739, "question_id": 39962389, "link": "https://stackoverflow.com/questions/39962389/esqueleto-how-to-execute-a-query-with-more-then-16-columns/39963739#39963739", "title": "Esqueleto: How to execute a query with more then 16 columns?", "body": "<p>You can create a custom data type to represent the result of that query, which will have as many fields as you want. You then need to implement the relevant type classes for that data (<a href=\"https://hackage.haskell.org/package/persistent-2.2.4/docs/Database-Persist-Class.html#t:PersistEntity\" rel=\"nofollow\">PersistEntity</a> seems to be the main one). This gives you an opportunity to provide relevant/meaningful names to the fields as well, to help prevent potential errors.</p>\n\n<pre><code>data MyResult\n    = MyResult\n    { fieldOne :: SomeType\n    , fieldTwo :: OtherType\n    , ...\n    , fieldSixteen :: Text\n    }\n</code></pre>\n\n<p>and instead of returning the <code>(a, b, c, ..., e)</code>, you'd return <code>MyResult a b c ... e</code>.</p>\n\n<p>As a convenience, you'll likely want to define the result using Persistent's Entity definition quasiquoter. You'll want to use that definition in a manner that it doesn't try to generate migrations for that.</p>\n"}], "owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 39963739, "answer_count": 1, "score": 1, "last_activity_date": 1476198397, "creation_date": 1476115729, "last_edit_date": 1476198397, "question_id": 39962389, "link": "https://stackoverflow.com/questions/39962389/esqueleto-how-to-execute-a-query-with-more-then-16-columns", "title": "Esqueleto: How to execute a query with more then 16 columns?", "body": "<p>Well basically it boils down to is it possible to have a query that returns more then 16 columns in esqueleto?</p>\n\n<p>I have a legacy db that I have to interact with and it requires joining tables with 30-40 columns then picking out like 20 of the possible 80-100 columns that I need so I'm not pulling columns that are large unless needed. It would seem that with esqueleto I am limited to 16 columns? Is there any way to overcome that without orphan instances?</p>\n\n<p>Thanks in advance!</p>\n\n<p>PS if a contrived example is necessary I will provide one.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I found in the docs that you can do tuples of tuples which essentially allows me to get more the 16 columns, then take those nested tuples and pattern match on the results to convert it to the data type i need or use the individual values as needed.</p>\n\n<p><em>FYI</em> </p>\n\n<p>if you look at the documentation for <a href=\"https://hackage.haskell.org/package/esqueleto-2.4.3/docs/Database-Esqueleto-Internal-Sql.html#t:SqlSelect\" rel=\"nofollow\"><code>SqlSelect</code></a> if you look at the instances then look ALL the way to the right you will see a 'hint' that is what helped me know i could do tuples of tuples.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1476121696, "post_id": 39962250, "comment_id": 67207649, "body": "Enter your code into a .hs file and load it into GHCi."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1476121738, "post_id": 39962250, "comment_id": 67207670, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/6184940/haskell-error-parse-error-on-input\">Haskell error parse error on input `=&#39;</a>"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 3, "creation_date": 1476123320, "post_id": 39962250, "comment_id": 67208400, "body": "please don&#39;t include pictures of code but text instead which can be read better and copy&amp;pasted..."}, {"owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "edited": false, "score": 0, "creation_date": 1476505852, "post_id": 39962250, "comment_id": 67385442, "body": "You can&#39;t just paste the contents of a Haskell source file into WinGHCI and hope it will work. You&#39;ll need to put that code into a file and then load the file with GHCi using commands like :load and :reload . It&#39;s possible to define multi-line things in GHCi but the syntax is not the same as a file."}], "owner": {"reputation": 1, "user_id": 6950050, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZsDvOdO8ts/AAAAAAAAAAI/AAAAAAAADww/JiWdiJsRxAk/photo.jpg?sz=128", "display_name": "emily y", "link": "https://stackoverflow.com/users/6950050/emily-y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1476310007, "creation_date": 1476115303, "last_edit_date": 1476310007, "question_id": 39962250, "link": "https://stackoverflow.com/questions/39962250/data-list-error-not-picking-up-command", "title": "Data.list error not picking up command?", "body": "<p><img src=\"https://i.stack.imgur.com/qoLJM.png\" alt=\"error image\"></p>\n\n<p>The code I am using keeps popping up with this error of not being able to find \"change\", how can I fix this problem? Is there something I need to download for it to work? Also, if needed, do I need to fix any other component of this for it to run smoothly?  I'm new to Haskell! </p>\n"}, {"tags": ["haskell", "category-theory", "arrows", "comonad"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1476113804, "post_id": 39961774, "comment_id": 67203489, "body": "In short: <i>yes, the co-Kleisli category is what you want</i>."}, {"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1476113970, "post_id": 39961774, "comment_id": 67203584, "body": "@leftaroundabout: If it is equivalent, why didn&#39;t the authors of the <code>arrows</code> package just made types aliases ? (for arrow transformers I guess, but not sure)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1476114732, "post_id": 39961774, "comment_id": 67204021, "body": "Well, ask Ross Paterson... I don&#39;t know about the motivation for the <code>arrows</code> package specifically, but I think it&#39;s definitely interesting to <i>see</i> how these special Kleisli arrows look in \u201cdirect form\u201d, hence the desire to not just newtype a Kleisli. However, I think <a href=\"http://hackage.haskell.org/package/arrows-0.4.4.1/docs/Control-Arrow-Transformer-CoState.html\" rel=\"nofollow noreferrer\"><code>CoStateArrow</code></a> is actually not quite right \u2013 this is a curried form with one base arrow replaced by a <b>Hask</b> one. I&#39;d think it should be <code>a (s-&gt;b, s) c</code>. Or even actually <code>a (a s b, c)</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1476124483, "post_id": 39961774, "comment_id": 67208923, "body": "I think if you want a good discussion on this topic you will have to give a better (read: formal) definition of &#39;arrowizing&#39; - from the example it isn&#39;t clear precisely what you want. It doesn&#39;t seem to be the act of replacing arrows with type parameters of kind <code>* -&gt; * -&gt; *</code> , nor does it seem to refer to the fact that every arrow gives rise to a monad and v.v. (<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#t:WrappedMonad\" rel=\"nofollow noreferrer\">WrappedMonad</a>, WrappedArrow, etc)."}], "answers": [{"tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 5, "last_activity_date": 1476165129, "last_edit_date": 1495539963, "creation_date": 1476128832, "answer_id": 39965668, "question_id": 39961774, "link": "https://stackoverflow.com/questions/39961774/arrowizing-the-store-comonad/39965668#39965668", "title": "Arrowizing the Store comonad", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/questions/39961774/arrowizing-the-store-comonad?noredirect=1#comment67203489_39961774\">leftaroundabout's comment</a>, I found the \"arrowized\" version of the <code>Store</code> comonad.</p>\n\n<p>My problem was that I couldn't find the \"direct form\" - as leftaroundabout mentions it - of my arrow. But, if what I want is <code>Cokleisli Store</code> then the answer is straightforward (not very formal notation but you get the idea):</p>\n\n<pre><code>newtype CokleisliT a w b c = CokleisliT { runCokleisliT :: a (w b) c }\nnewtype Store s a = Store (s -&gt; a, s)\n\n    Arrow a =&gt; CokleisliT a (Store s) b c\n&lt;=&gt; Arrow a =&gt; a (Store s b) c\n&lt;=&gt; Arrow a =&gt; a (s -&gt; b, s) c\n</code></pre>\n\n<p>From here, we can deduce the signatures of the <code>ArrowStore</code> class:</p>\n\n<pre><code>class Arrow a =&gt; ArrowStore s a | a -&gt; s where\n    pos   :: a () s\n    peek  :: a () b -&gt; a s b\n    peeks :: a () b -&gt; a (s -&gt; s) b\n    seek  :: a (s, b) c -&gt; a b c\n    seeks :: a (s, b) c -&gt; a (s -&gt; s, b) c\n</code></pre>\n\n<p>As for <a href=\"https://stackoverflow.com/questions/39961774/arrowizing-the-store-comonad#comment67208923_39961774\">user's comment</a>, apparently arrowizing a (co)monad is wrapping it in a (co)Kleisli arrow.</p>\n\n<p>Here's the library for the other arrows: <a href=\"https://github.com/felko/atl\" rel=\"nofollow noreferrer\">https://github.com/felko/atl</a>.</p>\n"}], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 39965668, "answer_count": 1, "score": 4, "last_activity_date": 1529509918, "creation_date": 1476113573, "last_edit_date": 1529509918, "question_id": 39961774, "link": "https://stackoverflow.com/questions/39961774/arrowizing-the-store-comonad", "title": "Arrowizing the Store comonad", "body": "<p>I've been contributing for a past few weeks to a library that ports monads (mainly from <code>mtl</code>) to arrows.</p>\n\n<p>Here's a quick example with the <code>StateT</code> monad from <code>mtl</code>:</p>\n\n<pre><code>newtype StateT s m a = StateT { runStateT :: s -&gt; m (a, s) }\n-- arrowization --&gt;\nnewtype StateTA s a b c = StateTA { runStateTA :: a (b, s) (c, s) }\n</code></pre>\n\n<p>The \"arrowizing\" process wasn't really painful for most of the monads, but I can't figure out my arrow based on the Store comonad.</p>\n\n<p>Every time I asked this question, people redirected me to the <code>Cokleisli</code> arrow, but will <code>Cokleisli Store</code> be equivalent to the arrow I'm looking for ?</p>\n\n<p>The library being based on a <code>mtl</code>-style architecture (each arrow has a general class, like <code>ArrowState</code>, <code>ArrowReader</code>, etc...), I tried to figure out what will be the signatures of my functions in <code>ArrowStore</code>, but again, I can't.</p>\n\n<p>I took a look at the <code>arrows</code> package which implements the same arrows as in the library I'm working on, but their <code>CoState</code> arrow (I heard CoState was another name for Store) defines no operations, so I guess the author also has troubles with this problem.</p>\n\n<p>tl;dr:</p>\n\n<ul>\n<li>Is <code>Monad m =&gt; Kleisli m a b</code> equivalent to the arrowized version <code>m</code> ?</li>\n<li>Is it also true for comonads with the <code>Cokleisli</code> arrow ?</li>\n<li>If so, how can I express the <code>Store</code> comonad as an arrow ?</li>\n<li>If not, can we even \"arrowize\" comonads ?</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1476111752, "post_id": 39961157, "comment_id": 67202131, "body": "<code>type IsVector v a = (HasPosX v a, HasPosY v a)</code>"}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476112626, "post_id": 39961157, "comment_id": 67202683, "body": "That, using the <code>ConstraintKinds</code> extension?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1476113011, "post_id": 39961157, "comment_id": 67202946, "body": "@user2407038 You could turn that into an answer."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1476176533, "post_id": 39961157, "comment_id": 67226606, "body": "He could do that ... I would accept it ... it works ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1476176417, "post_id": 39961766, "comment_id": 67226534, "body": "Sorry ... not what I am looking for. But I can see that I formulated my question quite general."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1476113549, "creation_date": 1476113549, "answer_id": 39961766, "question_id": 39961157, "link": "https://stackoverflow.com/questions/39961157/how-to-combine-several-type-constraints/39961766#39961766", "title": "How to combine several type constraints?", "body": "<p>You do this by defining a new record that contains only coordinates:</p>\n\n<pre><code>data Position = Position {\n  _positionX :: Int\n  _positionY :: Int\n}\n</code></pre>\n\n<p>And then replace pairs of coordinate fields by a position field each. Then <code>IsVector</code> is <code>HasPosition</code> and the lenses look like <code>position . x</code> instead of <code>positionX</code>.</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1476113549, "creation_date": 1476111430, "question_id": 39961157, "link": "https://stackoverflow.com/questions/39961157/how-to-combine-several-type-constraints", "title": "How to combine several type constraints?", "body": "<p>Using <code>lenses</code> automatic lens generation methods I ended up with several type classes of the <code>HasX</code> type:</p>\n\n<pre><code>class HasPositionX s a | s -&gt; a where\n  positionX :: Lens' s a\n\nclass HasPositionY s a | s -&gt; a where\n  positionY :: Lens' s a\n</code></pre>\n\n<p>Which of course is part of a 2d vector type. Now I am looking for a way to combine those constraints into one that basically says <code>IsVector s a</code> usable like this:</p>\n\n<pre><code>showVec :: (Num a, IsVector v a) =&gt; v -&gt; String\nshowVec a = show (view positionX a) ++ \",\" ++ show (view positionY a)\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "optimization", "tail-recursion", "microbenchmark"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1476105765, "post_id": 39959126, "comment_id": 67198160, "body": "I&#39;d try to make all the argument of <code>fibLin&#39;</code> strict and benchmark again. You can do that e.g. using <code>fibLin&#39; (!_) (!_) (!_) | ...</code> in the first case, and enabling the relative extension <code>BangPatterns</code>."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1476105852, "post_id": 39959126, "comment_id": 67198208, "body": "What&#39;s your optimization level? Tail recursion only acts like a loop performance wise when it&#39;s strict and GHC might only make your code strict at certain optimization levels. The lazy version definitely does not get memoized and I&#39;m not sure how much that&#39;d even help (you wouldn&#39;t need to re-calculate the beginning of the list, but you&#39;d still need to iterate over it and the calculation doesn&#39;t take that much time). It&#39;s just relatively fast by default."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1476105892, "post_id": 39959126, "comment_id": 67198237, "body": "Also why does <code>fibLin&#39;</code> produce a tuple? I don&#39;t see you ever using the second element of it."}, {"owner": {"reputation": 747, "user_id": 1644720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c78e4be01bb6d0fd2ad2c2f99a5f37?s=128&d=identicon&r=PG", "display_name": "Crazycolorz5", "link": "https://stackoverflow.com/users/1644720/crazycolorz5"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1476106046, "post_id": 39959126, "comment_id": 67198352, "body": "@chi I agree, the (i+1) and (z+y) may be stored in a thunk, causing more work to be done to evaluate them."}, {"owner": {"reputation": 747, "user_id": 1644720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c78e4be01bb6d0fd2ad2c2f99a5f37?s=128&d=identicon&r=PG", "display_name": "Crazycolorz5", "link": "https://stackoverflow.com/users/1644720/crazycolorz5"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1476106051, "post_id": 39959126, "comment_id": 67198358, "body": "@sepp2k the function has the first element as the 2nd to last one in the series, and the second element as the previous element. Once you get to the right number, you can just discard the second element, as it&#39;s only used in computation."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 747, "user_id": 1644720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c78e4be01bb6d0fd2ad2c2f99a5f37?s=128&d=identicon&r=PG", "display_name": "Crazycolorz5", "link": "https://stackoverflow.com/users/1644720/crazycolorz5"}, "edited": false, "score": 0, "creation_date": 1476106212, "post_id": 39959126, "comment_id": 67198485, "body": "@Crazycolorz5 That information is passed via parameters. Unless I&#39;m blind, there is no point in the code where the second element of the tuple is ever accessed. The recursive case just passed the tuple through untouched."}, {"owner": {"reputation": 747, "user_id": 1644720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c78e4be01bb6d0fd2ad2c2f99a5f37?s=128&d=identicon&r=PG", "display_name": "Crazycolorz5", "link": "https://stackoverflow.com/users/1644720/crazycolorz5"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1476106418, "post_id": 39959126, "comment_id": 67198623, "body": "@sepp2k So you&#39;re right. The last recursive call isn&#39;t directly providing a tuple."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1476106695, "post_id": 39959126, "comment_id": 67198797, "body": "There is no point in strictifying <code>i</code>, because at each step it&#39;s compared with <code>x</code> and hence forced. But other arguments can indeed be big thunks, however I wouldn&#39;t be surprised if Core contains <code>Int#</code>s rather than <code>Int</code>s and hence bangs won&#39;t help. But you&#39;re also comparing <code>x</code> to <code>0</code> and <code>1</code> at each recursive step, which is redundant: you can do it just ones. And can&#39;t full-laziness actually memoize <code>fib&#39;</code>? Though, I think such memoization wouldn&#39;t improve performance that much or at all."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1476108153, "post_id": 39959126, "comment_id": 67199763, "body": "Thanks all for the feedback; I&#39;ve updated the code to (1) make <code>fib&#39;</code> return a single number instead of a tuple (thanks @sepp2k), and (2) check i only once (thanks @user3237465). However, the benchmark results haven&#39;t significantly changed (still within the same territory when std. dev is taken into account), and more importantly, still slower than the lazy list method. I haven&#39;t tried the &quot;BangPatterns&quot; thing because I don&#39;t know what that entails (not enough Haskell-foo) so more pointers would be appreciated. BTW, full results are <a href=\"https://github.com/lloydmeta/fib-hs#full-results\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1476108269, "post_id": 39959126, "comment_id": 67199846, "body": "@sepp2k I&#39;ve set optimisation level to <code>-O2</code>; <a href=\"https://github.com/lloydmeta/fib-hs/blob/master/fib-hs.cabal#L51-L52\" rel=\"nofollow noreferrer\">see the cabal file</a> for more info."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "edited": false, "score": 0, "creation_date": 1476111077, "post_id": 39959126, "comment_id": 67201697, "body": "I&#39;ve managed to add and benchmark the linear, tail-recursive <code>BangPattern</code> variant <a href=\"https://github.com/lloydmeta/fib-hs/blob/master/src/Fibonacci.hs#L25-L32\" rel=\"nofollow noreferrer\">code</a>. <code>fibLinearBang</code> <i>is</i> definitely faster than the non-bang-pattern version but is still 3.5 times slower than the lazy list implementation (<code>fibLinear</code> is ~6 times slower)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1476124022, "post_id": 39959126, "comment_id": 67208690, "body": "Your benchmarks are not benchmarking what you think they are - try <code>fib 100k</code> or some other large value. For a single invocation, the &#39;classic lazy&#39; version allocates more memory, takes 5x as long (on my machine, for n=80k) and has nearly 80% GC time (compared to 5% for <code>fibBang</code>. Criterion reports that <code>fibClassic</code> runs much faster because <code>fib&#39;</code> is floated out to the top level and retained for all calls of <code>fibClassic</code> (look at the core!). If this result is still surprising, recall that GHC Haskell is heavily optimized for lazy data structures."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476147432, "post_id": 39959126, "comment_id": 67217395, "body": "@user2407038 (1) &quot;Your benchmarks are not benchmarking what you think they are&quot; Sounds catchy ;) Would you be more specific? (2) &quot;<code>fib&#39;</code> is floated out to the top level and retained for all calls of <code>fibClassic</code> (look at the core!)&quot; This is exactly what I was speculating in my question, but the other commenters seem to be in disagreement with us on this. Is there any way you can prove (doesn&#39;t need to be disassembly, could even be literature) that this is happening and put that in an answer?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1476168986, "post_id": 39959126, "comment_id": 67222860, "body": "@lloydmeta, &quot;This is exactly what I was speculating in my question, but the other commenters seem to be in disagreement with us on this&quot; \u2014 it&#39;s not a matter of opinion: Core indeed crearly witnesses that <code>fib&#39;</code> is floated out. However it&#39;s still not very clear to me why <code>fibClassic</code> can be faster for some input. My only guess is that storing&amp;processing a lazy list is faster, because you use addition over <code>Integer</code>s rather than <code>Int</code>s and the former is somewhat expensive. What will happen if you make your functions return <code>Int</code>? Is <code>fibClassic</code> still faster?"}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1476171584, "post_id": 39959126, "comment_id": 67224036, "body": "@user3237465: (1) &quot;Core indeed crearly witnesses that <code>fib&#39;</code> is floated out&quot;: sounds intriguing to me. Can you explain what this means and how one can check and verify it is happening? This is intriguing because it sounds like  Haskell will, in some cases, lift/float out a function&#39;s &quot;local variable&quot; into a constant variable, and there are repercussions wrt memory and computation ! (2) &quot;What will happen if you make your functions return <code>Int</code>? &quot; That makes <code>fibLinearBang</code> faster at 30ns and <code>fibClassic</code> slower at 80ns."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1476172582, "post_id": 39959126, "comment_id": 67224545, "body": "@lloydmeta, see <a href=\"http://book.realworldhaskell.org/read/profiling-and-optimization.html#id679074\" rel=\"nofollow noreferrer\">Understanding Core</a> and maybe some blog posts lying around. &quot;Haskell will, in some cases, lift/float a function&#39;s &quot;local variable&quot;&quot; \u2014 this is what the <code>full-laziness</code> optimization does. I don&#39;t have a good reference unfortunately."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1476187789, "post_id": 39959126, "comment_id": 67232477, "body": "@user3237465, thanks for the link :), and more importantly that pointing out <code>full-laziness</code> is an actual optimisation term ! I did a bit of searching and found out how to turn it off and the tables have finally turned: Fib30 for <code>fibLinearBang</code> is at 259.8 ns and <code>fibClassic</code> gets 738.4 ns. I think that&#39;s pretty definitive proof that <code>fib&#39;</code> is being kept around and reused :)"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476198812, "post_id": 39977108, "comment_id": 67239900, "body": "&quot;Pretty compelling evidence&quot; seems a weak condition when you can just <i>look at the core</i> and know for sure. The result of compilation depends on compiler version, flags, optimization, guessing as to what happens and which &#39;optimizations&#39; fire will typically result in long headaches like this. I&#39;m not sure why you believe that <code>-fno-full-laziness</code> is a &#39;solution&#39; - you made the performance of <code>fibClassic</code> worse while having no change on that of <code>fibLinearBang</code>. Making a program worse than another with compiler flags because you believe it should be so seems completely counterproductive."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476228021, "post_id": 39977108, "comment_id": 67255296, "body": "&quot;&quot;Pretty compelling evidence&quot; seems a weak condition when you can just look at the core and know for sure.&quot;: The point was to find out <i>why</i> <code>fibClassic</code> was (imho counterintuitively) beating <code>fibLinearBang</code>; the fact that <code>fno-full-laziness</code> affected the former and not the latter shows that we have likely found the reason. If you have better evidence for this particular case that <code>fib&#39;</code> is being reused or another reason to explain the performance discrepancy, maybe start by providing an answer. I&#39;m interested in what you mean by &quot;look at the core&quot; and how it can be applied here."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476234318, "post_id": 39977108, "comment_id": 67256617, "body": "You look at the core, in which you see the program which is actually produced by your code, and observe that in this program <code>fib&#39; :: [Integer]</code> is floated to the top level, making it a CAF (constant applicative form) which means it (i.e. a single copy) will be retained for the duration of the program&#39;s execution. &#39;full laziness&#39; can&#39;t possible affect <code>fibLinearBang</code> because even if you were to manually float out the function to the top level, it wouldn&#39;t be computed less often - it&#39;s only called once by <code>fibLinearBang</code>."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476236036, "post_id": 39977108, "comment_id": 67256975, "body": "You keep saying &quot;look at core&quot;, but I have yet to see you describe how to do so in this case. Also, you can keep criticising the question, but it has nonetheless puzzled commenters with higher SO and Haskell scores than yourself, showing that the full-lazy optimisation is not intuitive and that not everyone knows when they can rely on it (and in <a href=\"http://stackoverflow.com/questions/35115172/why-is-full-laziness-a-default-optimization\">these</a>, <a href=\"http://stackoverflow.com/questions/26321784/haskell-compiling-with-o2-drastically-increases-memory-usage\">cases</a> has caused head aches/scratches)."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476236516, "post_id": 39977108, "comment_id": 67257082, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/125461/discussion-between-lloydmeta-and-user2407038\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "is_accepted": false, "score": 0, "last_activity_date": 1476188367, "creation_date": 1476188367, "answer_id": 39977108, "question_id": 39959126, "link": "https://stackoverflow.com/questions/39959126/haskell-fibonacci-tail-recursive-slower-than-the-classic-lazy-list-approach/39977108#39977108", "title": "Haskell Fibonacci: Tail-Recursive slower than the classic lazy list approach?", "body": "<p><strong>tl;dr: <code>fib'</code> was indeed reused across invocations</strong></p>\n\n<p>Thanks to the commenters, I've learnt that <code>full-laziness</code> is not (just) a term used to describe how Haskell evaluates, but an actual compiler optimisation term, one that is on by default, but can be disabled (by using the <code>-fno-full-laziness</code> GHC-option flag. </p>\n\n<p>Re-running the benchmarks with that flag, we see the tables have turned:</p>\n\n<ul>\n<li><code>fibLinearBang</code> 259.8 ns</li>\n<li><code>fibClassic</code> 738.4 ns</li>\n</ul>\n\n<p>This performance, along with <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/options-optimise.html\" rel=\"nofollow\">this guide on GHC compiler options</a> is pretty compelling evidence that <code>fib'</code> does get transformed into something like a top-level reference that is reused (and being a list, memoised) across different invocations of the method. </p>\n\n<p>Both that guide and the <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/float.ps.gz\" rel=\"nofollow\">paper it links to describing let-lifting</a> admit that let-lifting could result in increased memory residency, which to me is somewhat scary (do not write a fib-as-a-service using <code>fibClassic</code> and expose it to the internet...), but I might come around to it..</p>\n"}], "owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 602, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1476188367, "creation_date": 1476105126, "last_edit_date": 1476117230, "question_id": 39959126, "link": "https://stackoverflow.com/questions/39959126/haskell-fibonacci-tail-recursive-slower-than-the-classic-lazy-list-approach", "title": "Haskell Fibonacci: Tail-Recursive slower than the classic lazy list approach?", "body": "<p>Disclaimer: some possibly dubious Haskell ahead.</p>\n\n<p>I've implemented 2 versions of Fibonacci, one that is linear and tail-recursive (incl. a banged variant), and another using the classic lazy-list approach:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\n-- Linear\nfibLinear :: Int -&gt; Integer\nfibLinear 0 = 0\nfibLinear 1 = 1\nfibLinear x = fibLin' 2 1 2\n  where\n      fibLin' i y z | i == x = y\n      fibLin' i y z          = fibLin' (i+1) z (z+y)\n\n-- Linear banged\nfibLinearBang :: Int -&gt; Integer\nfibLinearBang 0 = 0\nfibLinearBang 1 = 1\nfibLinearBang x = fibLin' 2 1 2\n  where\n      fibLin' (!i) (!y) (!z) | i == x = y\n      fibLin' (!i) (!y) (!z)          = fibLin' (i+1) z (z+y)\n\n-- Haskeller classic lazy\nfibClassic :: Int -&gt; Integer\nfibClassic n = fib' !! n\n    where fib' = 0:1:zipWith (+) fib' (tail fib')\n</code></pre>\n\n<p>When using <a href=\"https://hackage.haskell.org/package/criterion\" rel=\"nofollow\">criterion</a> to benchmark it (<a href=\"https://github.com/lloydmeta/fib-hs/blob/master/bench/MainBenchmarkSuite.hs\" rel=\"nofollow\">code</a>), I get somewhat unintuitive results: Fib 30 takes 443.0 ns for <code>fibLinear</code> and 279.5 ns for <code>fibLinearBang</code>, vs 73.51 ns for <code>fibClassic</code>. This is strange because I would think <code>fibLinear</code> &amp; <code>fibLinearBang</code> could be optimised into something like a loop or a jump.</p>\n\n<p>My only guess is maybe <code>fib'</code> in <code>fibClassic</code> is memoised as a constant list despite being inside a function definition so that subsequent invocations of the function reuse the same list for lookup.</p>\n\n<p>Can someone give me a definitive explanation for my benchmark results?</p>\n\n<p>For those interested, I've put the project on <a href=\"https://github.com/lloydmeta/fib-hs\" rel=\"nofollow\">Github</a>.</p>\n"}, {"tags": ["haskell", "lambda", "applicative"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1476090705, "post_id": 39954857, "comment_id": 67189417, "body": "What should it do if you applied it to Nill?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 1, "creation_date": 1476090995, "post_id": 39954857, "comment_id": 67189593, "body": "You are not handling the case <code>(&lt;*&gt;) Nill</code> in the <code>Applicative Random</code> instance."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1476111461, "post_id": 39954857, "comment_id": 67201935, "body": "Your <code>Random</code> type is just <code>Maybe</code> in disguise."}], "answers": [{"comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1476093274, "post_id": 39955456, "comment_id": 67190858, "body": "What if I want to skip/ignore the Nill values? Otherwise, with your solution above, any instance of a Nill value results in the cumulative output being Nill."}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1476093379, "post_id": 39955456, "comment_id": 67190929, "body": "So what would your expected output look like for the given input?"}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1476093666, "post_id": 39955456, "comment_id": 67191090, "body": "[Nill, Random 2, Random 4] = Random 6 (versus your solution which = Nill)"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 2, "creation_date": 1476094801, "post_id": 39955456, "comment_id": 67191682, "body": "I am not sure that kind of skipping is possible. Based on type signature the output can only be Random x or Nill, and unless you somehow inject another term similar to f in the first case, any operation will not satisfy the type condition (output of type f b where b is not the same as a)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 3, "creation_date": 1476095958, "post_id": 39955456, "comment_id": 67192335, "body": "@barbrac As shree.pat18 says that is not possible in this way. A different approach is implementing <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow noreferrer\">Alternative</a> for your type (cf. <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:asum\" rel=\"nofollow noreferrer\">asum</a> in Data.Foldable)."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 3, "last_activity_date": 1476092511, "creation_date": 1476092511, "answer_id": 39955456, "question_id": 39954857, "link": "https://stackoverflow.com/questions/39954857/applicative-functors-within-lambda-expressions-non-exhaustive-patterns/39955456#39955456", "title": "Applicative functors within lambda expressions, non-exhaustive patterns?", "body": "<p>Here's one way you can solve this:</p>\n\n<pre><code> instance Applicative Random where\n     pure a = Random a\n     (Random f) &lt;*&gt; (Random a) = Random (f a)\n     _ &lt;*&gt; _ = Nill\n</code></pre>\n\n<p>First, bring into the format <code>f (a -&gt; b) &lt;*&gt; f a)</code> and define result for first case as <code>Random (f a)</code>. Then, handle the case where your input is Nill by setting the result to Nill, regardless of the <code>f (a -&gt; b)</code> and <code>f a</code> terms. This will address all possible values for the <code>Random</code> constructor and solve your non-exhaustive pattern problem.</p>\n\n<p>Alternatively, you may choose to break the cases down further like so, with the same result:</p>\n\n<pre><code>instance Applicative Random where\n    pure a = Random a\n    (Random f) &lt;*&gt; (Random a) = Random (f a)\n    _ &lt;*&gt; Nill = Nill\n    Nill &lt;*&gt; (Random a) = Nill\n</code></pre>\n\n<p><a href=\"http://rextester.com/VSZ65664\" rel=\"nofollow\">Demo</a></p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "accepted_answer_id": 39955456, "answer_count": 1, "score": 3, "last_activity_date": 1476092511, "creation_date": 1476090476, "question_id": 39954857, "link": "https://stackoverflow.com/questions/39954857/applicative-functors-within-lambda-expressions-non-exhaustive-patterns", "title": "Applicative functors within lambda expressions, non-exhaustive patterns?", "body": "<p>I'm testing out applicative functors in lambda functions, but I'm stuck with the below code I've written. 'myAddition' need to take the cumulative total of 'Random a':</p>\n\n<p><strong>I appreciate there are better ways to do the below, however I'm learning functors so this is relevant</strong></p>\n\n<pre><code>data Random a = Nill | Random a deriving (Show, Ord, Eq)\n\nrandomOrNot = [Nill, Random 22, Random 101, Nill, Random 44]\n\ninstance Functor Random where\n  fmap f (Nill) = Nill\n  fmap f (Random a) = Random (f a)\n\ninstance Applicative Random where\n  pure a = Random a\n  (&lt;*&gt;) (Random a) = fmap a\n\ncumulativeTotal :: [Random a] -&gt; Random a\ncumulativeTotal li = foldr (\\el acc -&gt; (pure (+) &lt;*&gt; el) &lt;*&gt; acc) (Random 0) li\n\nmain = do\n  print $ cumulativeTotal randomOrNot\n</code></pre>\n\n<p>The error:</p>\n\n<pre><code>\"Non-exhaustive patterns in function &lt;*&gt;\"\n</code></pre>\n\n<p>I understand what the error means, however I'm unsure how to make the applicative functor lambda exhaustive?</p>\n"}, {"tags": ["haskell", "typeclass", "dependent-type"], "answers": [{"comments": [{"owner": {"reputation": 465, "user_id": 3541888, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/341f9846dc6bfc0a531e074a507a3e1e?s=128&d=identicon&r=PG&f=1", "display_name": "dmw64", "link": "https://stackoverflow.com/users/3541888/dmw64"}, "edited": false, "score": 0, "creation_date": 1476097639, "post_id": 39956285, "comment_id": 67193176, "body": "Wow :D! Thank you very much for your detail explanation and all your work!  To be honest, I&#39;m afraid I have to read a lot before fully understanding the construction (I&#39;m not familiar with neither phantoms nor promotions....). I&#39;ve seen on your githut side that your are also using Agda. Can something like this be done with a dependent type language like Agda much more easily? Thanks a lot again!!!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 465, "user_id": 3541888, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/341f9846dc6bfc0a531e074a507a3e1e?s=128&d=identicon&r=PG&f=1", "display_name": "dmw64", "link": "https://stackoverflow.com/users/3541888/dmw64"}, "edited": false, "score": 0, "creation_date": 1476098931, "post_id": 39956285, "comment_id": 67193864, "body": "@dmw64, you&#39;re welcome. As Agda has full dependent types, you don&#39;t need to lift values to the type level via singletons and can just use them directly there, so it saves you some boilerplate, but other than that you&#39;d end up with something very similar (and AFAIK Agda doesn&#39;t have built-in arrays, so you&#39;d have to use FFI and same phantom types)."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 4, "last_activity_date": 1476095568, "last_edit_date": 1495541206, "creation_date": 1476095568, "answer_id": 39956285, "question_id": 39953147, "link": "https://stackoverflow.com/questions/39953147/arrays-and-type-class-lifting-and-dependent-types/39956285#39956285", "title": "Arrays and type class-lifting (and dependent types?)", "body": "<p>A common way is to wrap a not-very-typed representation into a more typed one like this:</p>\n\n<pre><code>data Nat = Z | S Nat\nnewtype Vec (n :: Nat) a = Vec [a]\nnewtype Sized m (ns :: [Nat]) a = Sized { getArray :: Array (Vec m Int) a }\n</code></pre>\n\n<p>Here <code>ns</code> is a promoted (see <a href=\"http://www.seas.upenn.edu/~sweirich/papers/tldi12.pdf\" rel=\"nofollow noreferrer\">Giving Haskell a Promotion</a>) phantom (see <a href=\"https://stackoverflow.com/questions/28247543/motivation-behind-phantom-types\">Motivation behind Phantom Types?</a>) value \u2014 a list of sizes of dimensions and <code>m</code> is the length of this list (promoted and phantom as well). So any array under the <code>Sized</code> wrapper is assumed to be a multidimensional matrix with <code>ns</code> representing its dimensions. The <code>Monoid</code> instance then looks like this:</p>\n\n<pre><code>instance (SingI m, SingI ns, Monoid a) =&gt; Monoid (Sized m ns a) where\n  mempty                      = listSized $ repeat mempty\n  Sized as `mappend` Sized bs = listSized $ zipWith mappend (elems as) (elems bs)\n</code></pre>\n\n<p>That <code>SingI</code> stuff is from the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\">singletons</a> library. Singletons allow to lift values to the type-level, so we can kinda emulate dependent types, and <code>SingI</code> allows to get lifted values back at the value level via the <code>fromSing</code> function. <code>listSized</code> is essentially <code>listArray</code>, but for arrays with statically known dimensions and hence it requires all those <code>SingI</code>s to be in scope. Here is its definition:</p>\n\n<pre><code>toInt :: Nat -&gt; Int\ntoInt = go 0 where\n  go !a  Z    = a\n  go  a (S n) = go (1 + a) n\n\nvecBounds :: forall m (ns :: [Nat]). (SingI m) =&gt; Sing ns -&gt; (Vec m Int, Vec m Int)\nvecBounds singNs = (Vec $ replicate m 0, Vec ns') where\n    m   = toInt $ fromSing (sing :: Sing m)\n    ns' = map (pred . toInt) $ fromSing singNs\n\nlistSized :: forall m (ns :: [Nat]) a. (SingI m, SingI ns) =&gt; [a] -&gt; Sized m ns a\nlistSized = Sized . listArray (vecBounds (sing :: Sing ns))\n</code></pre>\n\n<p><code>vecBounds</code> computes bounds for a given promoted list of sizes of dimensions. It returns a tuple which first component is the lowerest index which is always of the form <code>[0,0..0]</code> (there as many zeros as there are dimensions, i.e. <code>m</code>). The second component is the greatest index, so if you e.g. have a list of sizes of dimensions like <code>[2, 1, 3]</code> (represented as <code>[S (S Z), S Z, S (S (S Z))]</code>), then the maximum index is <code>[1, 0, 2]</code>.</p>\n\n<p>It only remains to provide an <code>Ix</code> instance for <code>Vec n a</code> which is a direct generalization of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Arr.html#line-280\" rel=\"nofollow noreferrer\">the product instances</a>:</p>\n\n<pre><code>instance Ix a =&gt; Ix (Vec n a) where\n  range   (Vec ns, Vec ms)          = map Vec . sequence $ zipWith (curry range) ns ms\n  index   (Vec ns, Vec ms) (Vec ps) = foldr (\\(i, r) a -&gt; i + r * a) 0 $\n    zipWith3 (\\n m p -&gt; (index (n, m) p, rangeSize (n, m))) ns ms ps\n  inRange (Vec ns, Vec ms) (Vec ps) = and $ zipWith3 (curry inRange) ns ms ps\n</code></pre>\n\n<p>And we can write some tests:</p>\n\n<pre><code>type M  = S (S (S Z))\ntype Ns = [S (S Z), S Z, S (S (S Z))]\n\narr1 :: Sized M Ns (Sum Int)\narr1 = listSized $ map Sum [5,3,6,7,1,4]\n\narr2 :: Sized M Ns (Sum Int)\narr2 = listSized $ map Sum [8,2,9,7,3,6]\n\nmain = mapM_ (print . getArray) $ [arr1, arr2, arr1 `mappend` arr2 `mappend` mempty]\n</code></pre>\n\n<p>This prints</p>\n\n<pre><code>array (Vec [0,0,0],Vec [1,0,2]) [(Vec [0,0,0],Sum {getSum = 5}),(Vec [0,0,1],Sum {getSum = 6}),(Vec [0,0,2],Sum {getSum = 1}),(Vec [1,0,0],Sum {getSum = 3}),(Vec [1,0,1],Sum {getSum = 7}),(Vec [1,0,2],Sum {getSum = 4})]\narray (Vec [0,0,0],Vec [1,0,2]) [(Vec [0,0,0],Sum {getSum = 8}),(Vec [0,0,1],Sum {getSum = 9}),(Vec [0,0,2],Sum {getSum = 3}),(Vec [1,0,0],Sum {getSum = 2}),(Vec [1,0,1],Sum {getSum = 7}),(Vec [1,0,2],Sum {getSum = 6})]\narray (Vec [0,0,0],Vec [1,0,2]) [(Vec [0,0,0],Sum {getSum = 13}),(Vec [0,0,1],Sum {getSum = 15}),(Vec [0,0,2],Sum {getSum = 4}),(Vec [1,0,0],Sum {getSum = 5}),(Vec [1,0,1],Sum {getSum = 14}),(Vec [1,0,2],Sum {getSum = 10})]\n</code></pre>\n\n<p>I.e. elements were summed pointwise as required. And if you accidentally try to sum arrays with different dimensions, you'll get a type error:</p>\n\n<pre><code>type Ns  = [S (S Z), S Z, S (S (S Z))]\ntype Ns' = [S (S (S Z)), S Z, S (S Z)]\n\narr1 :: Sized M Ns (Sum Int)\narr1 = listSized $ map Sum [5,3,6,7,1,4]\n\narr2 :: Sized M Ns' (Sum Int)\narr2 = listSized $ map Sum [8,2,9,7,3,6]\n\nmain = print . getArray $ arr1 `mappend` arr2\n\n-- Couldn't match type 'S 'Z with 'Z \u2026\n-- Expected type: Sized M Ns (Sum Int)\n--   Actual type: Sized M Ns' (Sum Int)\n-- In the second argument of `mappend', namely `arr2'\n-- In the first argument of `mappend', namely `arr1 `mappend` arr2'\n</code></pre>\n\n<p><a href=\"https://github.com/effectfully/random-stuff/blob/master/SizedMonoid.hs\" rel=\"nofollow noreferrer\">Full code</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 465, "user_id": 3541888, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/341f9846dc6bfc0a531e074a507a3e1e?s=128&d=identicon&r=PG&f=1", "display_name": "dmw64", "link": "https://stackoverflow.com/users/3541888/dmw64"}, "edited": false, "score": 0, "creation_date": 1476257728, "post_id": 39961671, "comment_id": 67263858, "body": "Thanks a lot for this solution :D !!! I will need a bit of time to understand it since I never used or even heard of kind polymorphism and promotions before... A new world has just opened up for me and I&#39;m feeling like Alice ;-). Thanks you again!"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 465, "user_id": 3541888, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/341f9846dc6bfc0a531e074a507a3e1e?s=128&d=identicon&r=PG&f=1", "display_name": "dmw64", "link": "https://stackoverflow.com/users/3541888/dmw64"}, "edited": false, "score": 0, "creation_date": 1476272592, "post_id": 39961671, "comment_id": 67273206, "body": "@dmw64 I&#39;ll be happy to answer any questions you have :)"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1476150924, "last_edit_date": 1476150924, "creation_date": 1476113210, "answer_id": 39961671, "question_id": 39953147, "link": "https://stackoverflow.com/questions/39953147/arrays-and-type-class-lifting-and-dependent-types/39961671#39961671", "title": "Arrays and type class-lifting (and dependent types?)", "body": "<p>@user3237465's is a full and direct answer to your question about attaching static size information to <code>Array</code>s. But since you mentioned that you're quite new to dependent types, I wanted to give a simpler example of matrix addition which I feel may serve as a better introduction to the topic. Much of the below can be found (better-explained!) in <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow\">the <em>Hasochism</em> paper</a>.</p>\n\n<p>As usual we have natural numbers, which GHC will automatically lift to the type level. Not only does the following <code>data</code> declaration define a type <code>Nat</code> and two value constructors <code>Z</code> and <code>S</code>, we also get a <em>kind</em> <code>Nat</code> and two <em>type</em> constructors <code>Z</code> and <code>S</code>.</p>\n\n<pre><code>data Nat = Z | S Nat\n\ntype One = S Z\ntype Two = S (S Z)\ntype Three = S (S (S Z))\n</code></pre>\n\n<p>I'm going to define the customary <em>vector</em> GADT, which is operationally a linked list with static knowledge of its length.</p>\n\n<pre><code>infixr 5 :&gt;\ndata Vec n a where\n    VNil :: Vec Z a\n    (:&gt;) :: a -&gt; Vec n a -&gt; Vec (S n) a\nderiving instance Show a =&gt; Show (Vec n a)\n\ninstance Functor (Vec n) where\n    fmap f VNil = VNil\n    fmap f (x :&gt; xs) = f x :&gt; fmap f xs\n</code></pre>\n\n<p>Here are some example vectors.</p>\n\n<pre><code>v1 :: Vec Two String\nv1 = \"foo\" :&gt; \"bar\" :&gt; VNil\nv2 :: Vec Two String\nv2 = \"baz\" :&gt; \"quux\" :&gt; VNil\nv3 :: Vec One String\nv3 = \"nabble\" :&gt; VNil\n</code></pre>\n\n<p>We're going to need to do runtime analysis of type-level numbers. For example, we'd like to write a function <code>vreplicate :: n -&gt; a -&gt; Vec n a</code> which repeats a given element <code>n</code> times. <code>vreplicate</code> has to know <em>at runtime</em> how many copies of the value to make! However, the above type signature is invalid because Haskell maintains a separation between runtime values and compile-time types. Types belonging to the kind <code>Nat</code> can't be passed around at runtime. Enter <em>singleton values</em>.</p>\n\n<pre><code>data Natty n where\n    Zy :: Natty Z\n    Sy :: Natty n -&gt; Natty (S n)\n</code></pre>\n\n<p>(This is more-or-less the code that the <code>singletons</code> library generates for you.) For a given (well-defined) <code>n</code> of kind <code>Nat</code>, there is precisely one (well-defined) value of type <code>Natty n</code>. Pattern-matching on a <code>Natty</code> tells you about its <code>n</code>. A <code>forall n. Natty n -&gt;</code> quantifier tells you that <code>n</code> is used at runtime. So our <code>vreplicate</code> function will have a type of <code>Natty n -&gt; a -&gt; Vec n a</code>, with the <code>Natty n</code> as a runtime stand-in for <code>n</code>. (A real dependently typed language would not make you jump through such a hoop!)</p>\n\n<p>As I mentioned, if you know the value of a <code>Natty</code> you know its <code>n</code>. We can additionally make information flow the other way, from types to values, using the following hacky type class:</p>\n\n<pre><code>class NATTY n where\n    natty :: Natty n\ninstance NATTY Z where\n    natty = Zy\ninstance NATTY n =&gt; NATTY (S n) where\n    natty = Sy natty\n</code></pre>\n\n<p>A <code>NATTY n</code> dictionary is an implicit copy of <code>n</code>'s singleton <code>Natty</code>.</p>\n\n<p>OK. The <code>Applicative</code> instance for <code>Vec</code> zips two vectors together, combining their contents pointwise.</p>\n\n<pre><code>vzip :: Vec n a -&gt; Vec n b -&gt; Vec n (a, b)\nvzip VNil VNil = VNil\nvzip (x :&gt; xs) (y :&gt; ys) = (x, y) :&gt; vzip xs ys\n\nvreplicate :: Natty n -&gt; a -&gt; Vec n a\nvreplicate Zy _ = VNil\nvreplicate (Sy n) x = x :&gt; vreplicate n x\n\ninstance NATTY n =&gt; Applicative (Vec n) where\n    pure = vreplicate natty\n    fs &lt;*&gt; xs = fmap (uncurry ($)) (vzip fs xs)\n</code></pre>\n\n<p>And so we can lift a <code>Monoid</code> for <code>a</code>s into a <code>Monoid</code> for vectors of <code>a</code>. This is a standard trick to turn an <code>Applicative</code> into a <code>Monoid</code>.</p>\n\n<pre><code>instance Monoid a =&gt; Monoid (Vec n a) where\n    mempty = pure mempty\n    mappend = liftA2 mappend\n</code></pre>\n\n<p>The payoff:\u00a0You can only <code>mappend</code> vectors whose lengths match. Compare this with the list <code>zip</code>, which truncates the longer of the two lists being zipped.</p>\n\n<pre><code>ghci&gt; v1 `mappend` v2\n\"foobaz\" :&gt; (\"barquux\" :&gt; VNil)\n\n-- \u250c       \u2510     \u250c        \u2510     \u250c           \u2510\n-- | \"foo\" |  +  | \"baz\"  |  =  | \"foobar\"  |\n-- | \"bar\" |     | \"quux\" |     | \"bazquux\" |\n-- \u2514       \u2518     \u2514        \u2518     \u2514           \u2518\n\nghci&gt; v1 `mappend` v3\n&lt;interactive&gt;:35:14: error:\n    \u2022 Couldn't match type \u2018'Z\u2019 with \u2018'S 'Z\u2019\n      Expected type: Vec Two String\n        Actual type: Vec One String\n    \u2022 In the second argument of \u2018mappend\u2019, namely \u2018v3\u2019\n      In the expression: v1 `mappend` v3\n      In an equation for \u2018it\u2019: it = v1 `mappend` v3\n\n-- \u250c       \u2510     \u250c          \u2510\n-- | \"foo\" |  +  | \"nabble\" |  =  ?\n-- | \"bar\" |     \u2514          \u2518\n-- \u2514       \u2518\n</code></pre>\n\n<hr>\n\n<p>Now let's work with 2D matrices. The trick is to build them out of smaller reusable bits. A matrix is a vector of vectors, the type-level composition of two vectors.</p>\n\n<pre><code>newtype (f :.: g) a = Compose { getCompose :: f (g a) } deriving Show\n\ntype Mat n m = Vec n :.: Vec m\n</code></pre>\n\n<p>That is, <code>Mat n m a</code> is isomorphic to <code>Vec n (Vec m a)</code>.</p>\n\n<p>Functoriality and applicativity are preserved through composition,</p>\n\n<pre><code>instance (Functor f, Functor g) =&gt; Functor (f :.: g) where\n    fmap f = Compose . fmap (fmap f) . getCompose\ninstance (Applicative f, Applicative g) =&gt; Applicative (f :.: g) where\n    pure = Compose . pure . pure\n    Compose fgf &lt;*&gt; Compose fgx = Compose (liftA2 (&lt;*&gt;) fgf fgx)\n</code></pre>\n\n<p>and we can once more employ the standard trick to lift a <code>Monoid</code> into an <code>Applicative</code> of composed <code>Applicative</code>s.</p>\n\n<pre><code>instance (Monoid a, Applicative f, Applicative g) =&gt; Monoid ((f :.: g) a) where\n    mempty = pure mempty\n    mappend = liftA2 mappend\n</code></pre>\n\n<p>Now we get matrix addition for free!</p>\n\n<pre><code>m1 :: Mat Two Two String\nm1 = Compose (v1 :&gt; v2 :&gt; VNil)\nm2 :: Mat Two Two String\nm2 = Compose (v2 :&gt; v1 :&gt; VNil)\n\nghci&gt; m1 `mappend` m2\nCompose {getCompose = (\"foobaz\" :&gt; (\"barquux\" :&gt; VNil)) :&gt; ((\"bazfoo\" :&gt; (\"quuxbar\" :&gt; VNil)) :&gt; VNil)}\n\n-- \u250c              \u2510     \u250c              \u2510     \u250c                    \u2510\n-- | \"foo\" \"bar\"  |  +  | \"baz\" \"quux\" |  =  | \"foobaz\" \"barquux\" |\n-- | \"baz\" \"quux\" |     | \"foo\" \"bar\"  |     | \"bazfoo\" \"quuxbar\" |\n-- \u2514              \u2518     \u2514              \u2518     \u2514                    \u2518\n</code></pre>\n\n<p>There's another valid matrix <code>Monoid</code> (for square matrices, <code>newtype Square n = Square (Mat n n)</code>) which performs matrix multiplication, with the identity matrix as <code>mempty</code>. I won't show it here. You can figure it out yourself.</p>\n\n<hr>\n\n<p>Lastly let's do addition of tensors, which are <em>n</em>-dimensional matrices. A tensor is a family of types indexed by a list of dimensions. That is, <code>Tensor</code> is a <em>function</em> from a list of dimensions to a type constructor <code>* -&gt; *</code>. Adding a new dimension to the list adds a layer of <code>Vec</code>s.</p>\n\n<pre><code>type family Tensor (dims :: [Nat]) :: * -&gt; * where\n    Tensor '[d] = Vec d\n    Tensor (d ': ds) = Vec d :.: Tensor ds\n</code></pre>\n\n<p>So, <code>Tensor '[One, Two, Three] a</code>, a one-by-two-by-three tensor, is <code>newtype</code>-isomorphic to <code>Vec One (Vec Two (Vec Three a))</code>.</p>\n\n<p>Once again, by defining <code>Tensor</code> in terms of <code>Vec</code> and <code>:.:</code> we get the instance we need for free.</p>\n\n<pre><code>t1 :: Tensor '[Two, Two, Two] String\nt1 = Compose (m1 :&gt; m2 :&gt; VNil)\nt2 :: Tensor '[Two, Two, Two] String\nt2 = Compose (m2 :&gt; m1 :&gt; VNil)\n\nghci&gt; t1 `mappend` t2\nCompose {getCompose = Compose {getCompose = (\"foobaz\" :&gt; (\"barquux\" :&gt; VNil)) :&gt; ((\"bazfoo\" :&gt; (\"quuxbar\" :&gt; VNil)) :&gt; VNil)} :&gt; (Compose {getCompose = (\"bazfoo\" :&gt; (\"quuxbar\" :&gt; VNil)) :&gt; ((\"foobaz\" :&gt; (\"barquux\" :&gt; VNil)) :&gt; VNil)} :&gt; VNil)}\n\n-- i'm not going to try drawing that\n</code></pre>\n"}], "owner": {"reputation": 465, "user_id": 3541888, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/341f9846dc6bfc0a531e074a507a3e1e?s=128&d=identicon&r=PG&f=1", "display_name": "dmw64", "link": "https://stackoverflow.com/users/3541888/dmw64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 1, "accepted_answer_id": 39956285, "answer_count": 2, "score": 2, "last_activity_date": 1476150924, "creation_date": 1476084284, "last_edit_date": 1476089486, "question_id": 39953147, "link": "https://stackoverflow.com/questions/39953147/arrays-and-type-class-lifting-and-dependent-types", "title": "Arrays and type class-lifting (and dependent types?)", "body": "<p>Let say that the type <code>b</code> is an instance of <code>Monoid</code> and for a fixed indices range of <code>(v1,v2) :: (i,i)</code> with <code>i</code> belonging to the type class <code>Ix</code> I want to define the corresponding Data.Array type to be a Monoid as well. How can this be done? Here, <code>mempty</code> should be the Array with entries <code>mempty::b</code> and also <code>mappend</code> for arrays should be the <code>mappend</code>-operation component-wise.</p>\n\n<p>(For instance if <code>i=(Int,Int)</code> the type <code>Data.Array i b</code> represents of all (2 dimensional) matricies with different sizes (and different ranges of the index). Only for fixed size such a <code>Monoid</code>-declaration makes sense. Actually, I am interested in the vector-space case instead of Monoids, but Monoid already shows the difficulty. I have only a vague idea about dependent type but this seems to be a prototypical example for a situation in which individual types corresponding to the only a subset of the range of one parameter would be useful.)</p>\n"}, {"tags": ["haskell", "for-loop", "equivalent"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1476082223, "post_id": 39952651, "comment_id": 67185218, "body": "Can you show your Haskell attempt ? People will be able to help you better if they understand what you have tried."}, {"owner": {"reputation": 1835, "user_id": 5875691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d1cd84a517b9c5c9dd902869effa33?s=128&d=identicon&r=PG&f=1", "display_name": "alex", "link": "https://stackoverflow.com/users/5875691/alex"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1476082300, "post_id": 39952651, "comment_id": 67185252, "body": "Yes, of course, I am now add code"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1476084530, "post_id": 39952651, "comment_id": 67186271, "body": "<code>Int a =&gt; [a] -&gt; [a]</code> is invalid. Either you meant <code>Integral a =&gt;</code> or <code>Ord a =&gt;</code> I think."}], "answers": [{"tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 2, "last_activity_date": 1476086223, "creation_date": 1476086223, "answer_id": 39953658, "question_id": 39952651, "link": "https://stackoverflow.com/questions/39952651/haskell-loop-and-local-variable/39953658#39953658", "title": "Haskell loop and local variable", "body": "<p>First of all, you want to get a list of differences between the elements. Let's look at your try:</p>\n\n<pre><code>f x = zipWith (-) (tail x) x\n</code></pre>\n\n<p>Now if we used recursion, we could define it like this:</p>\n\n<pre><code>findMax :: [Int] -&gt; Int\nfindMax list = helper 0 -1 minusInfinity $ zipWith (-) (tail list) list\n  where\n    helper _            maxIndex _          []          = maxIndex\n    helper currentIndex maxIndex currentMax (elem:list)\n      | elem &gt; currentMax = helper (currentIndex + 1) currentIndex elem list\n      | otherwise = helper (currentIndex + 1) maxIndex currentMax list\n    minusInfinity = minBound :: Int -- the smallest element possible\n</code></pre>\n\n<p>But somehow recursion is rather ugly and verbose. Let's see if we can do better:</p>\n\n<p><code>f</code> already generates the correct subtraction list.</p>\n\n<p>Now you want to associate each element with it's index. In Haskell, combining information can easily be done with a tuple <code>(Int, Int)</code> using <code>zip</code>:</p>\n\n<pre><code>zip [0..] list = [(0, 1st element), (1, 2nd element), ..]\n</code></pre>\n\n<p>The element you want to consider is now the right part of a tuple, accessible by <code>snd</code>:</p>\n\n<pre><code>snd (index, elem) == elem\n</code></pre>\n\n<p>Using the function <code>maximumBy</code>, we now get:</p>\n\n<pre><code>g x = maximumBy (comparing snd) $ zip [0..] $ f x\n</code></pre>\n\n<p><code>maximumBy (comparing snd)</code> means \"getting the maximum element by <code>comparing</code> the <code>snd</code> part of each tuple\". This now returns the tuple <code>(index, element)</code> where <code>element</code> is maximal. To access the first element of a tuple, we can use:</p>\n\n<pre><code>fst (index, element) == index\n</code></pre>\n\n<p>So the entire function can be written as:</p>\n\n<pre><code>f x = fst $ maximumBy (comparing snd) $ zip [0..] $ zipWith (-) (tail x) x\n</code></pre>\n\n<p>Which is way more elegant than the recursive formula above.</p>\n"}, {"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 0, "last_activity_date": 1476088123, "creation_date": 1476088123, "answer_id": 39954183, "question_id": 39952651, "link": "https://stackoverflow.com/questions/39952651/haskell-loop-and-local-variable/39954183#39954183", "title": "Haskell loop and local variable", "body": "<p>Here's another way to do it:</p>\n\n<pre><code>import Data.List\n\ncalc :: (Integral a) =&gt; [a] -&gt; a\ncalc = snd . foldl (\\(max,index) (x,y) -&gt; if (y-x) &gt; max then (y+x,index) else (max,index + 1) ) (0,-1) . helper\n\nhelper :: [a] -&gt; [(a,a)]\nhelper x = zip (tail x) (init x)\n</code></pre>\n\n<p><code>helper</code> builds up a list of successive pairs of elements. Then, <code>calc</code> does the comparison and other manipulations from your imperative loop. The accumulator is a tuple consisting of your local variables <code>max</code> and <code>index</code>. Since you only need the index at the end, we use <code>snd</code> to get that part out. Notice that we represent the input as a tuple as well to make it easier to work with.</p>\n\n<p><a href=\"http://rextester.com/FVEN35934\" rel=\"nofollow\">Demo</a></p>\n"}], "owner": {"reputation": 1835, "user_id": 5875691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d1cd84a517b9c5c9dd902869effa33?s=128&d=identicon&r=PG&f=1", "display_name": "alex", "link": "https://stackoverflow.com/users/5875691/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 743, "favorite_count": 0, "accepted_answer_id": 39953658, "answer_count": 2, "score": 1, "last_activity_date": 1476088123, "creation_date": 1476082152, "last_edit_date": 1476082711, "question_id": 39952651, "link": "https://stackoverflow.com/questions/39952651/haskell-loop-and-local-variable", "title": "Haskell loop and local variable", "body": "<p>I just started learning Haskell and I do not understand how to write the equivalent of such a program in the Haskell in which there are loops and local variables in it. Can anyone suggest how such a program would look at Haskell? How to replace the second cycle, because it involves the local variables?</p>\n\n<pre><code>#include &lt;iostream&gt;\nusing namespace std;\n\nint main() {\n\nint n;\nint a [100];\ncin &gt;&gt; n;\n\nfor (int i = 0; i &lt; n; i ++) {\n    cin &gt;&gt; a[i];\n}\n\nint max = 0;\nint index = -1;\n\nfor (int i = 0; i &lt; n - 1; i ++) {\n    if (a[i+1] - a[i] &gt; max) {\n        max = a[i+1] + a[i];\n        index = i;\n    }\n}\n\ncout &lt;&lt; index &lt;&lt; endl;\n\nreturn 0;\n\n}\n</code></pre>\n\n<p>My attempts to write code in Haskell:</p>\n\n<pre><code>module MyProgram where \n\nimport Data.List\nimport Data.Ord\n\n-- Getting a new modernized list\n\nf :: Int a =&gt; [a] -&gt; [a]\nf x = zipWith (-) (tail x) (x)\n</code></pre>\n\n<p>Now I just need to run through the list and find the maximum element and store its index. I understand how to do it in C and Java and gave the example above, how would I have implemented, but in Haskell because there are no cycles. Need recursion?</p>\n\n<p>My main difficulty lies in the fact that I do not understand what design in Haskell can replace me with a cycle variables within it. I was looking for information on the Internet, but could not find anything comprehensible to me.</p>\n"}, {"tags": ["haskell", "category-theory", "foldable"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1476077569, "post_id": 39951758, "comment_id": 67183514, "body": "FYI, <code>concatMap&#39;</code> is <code>foldMap</code> from the <code>Foldable</code> class in <code>Data.Foldable</code>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1476077711, "post_id": 39951758, "comment_id": 67183545, "body": "Ah silly me question simplified."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 7, "last_activity_date": 1476080843, "last_edit_date": 1476080843, "creation_date": 1476079880, "answer_id": 39952209, "question_id": 39951758, "link": "https://stackoverflow.com/questions/39951758/foldable-monoid-and-monad/39952209#39952209", "title": "Foldable, Monoid and Monad", "body": "<p>When a container is <code>Foldable</code>, there is a relationship between <code>foldMap</code> and <code>Applicative</code> (which is a superclass of <code>Monad</code>).</p>\n\n<p><code>Foldable</code> has a function called <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:traverse_\"><code>traverse_</code></a>, with signature:</p>\n\n<pre><code>traverse_ :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f ()\n</code></pre>\n\n<p>One possible <code>Applicative</code> is <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Data-Functor-Constant.html\"><code>Constant</code></a>. To be an Applicative, it requires the \"accumulator\" parameter to be a <code>Monoid</code>:</p>\n\n<pre><code>newtype Constant a b = Constant { getConstant :: a } -- no b value at the term level!\n\nMonoid a =&gt; Applicative (Constant a)\n</code></pre>\n\n<p>for example:</p>\n\n<pre><code>gchi&gt; Constant (Sum 1) &lt;*&gt; Constant (Sum 2) :: Constant (Sum Int) whatever\nConstant (Sum {getSum = 3})\n</code></pre>\n\n<p>We can define <code>foldMap</code> in terms of <code>traverse_</code> and <code>Constant</code> this way:</p>\n\n<pre><code>foldMap' :: (Monoid m, Foldable t) =&gt; (a -&gt; m) -&gt; t a -&gt; m\nfoldMap' f = getConstant . traverse_ (Constant . f)\n</code></pre>\n\n<p>We use <code>traverse_</code> to go through the container, accumulating values with <code>Constant</code>, and then we use <code>getConstant</code> to get rid of the newtype.</p>\n"}, {"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 6, "creation_date": 1476085776, "post_id": 39952898, "comment_id": 67186895, "body": "&quot;Wow, this is actually one of the rare times&quot; - <i>giggles nervously</i>"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 26, "last_activity_date": 1476098683, "last_edit_date": 1495540122, "creation_date": 1476083294, "answer_id": 39952898, "question_id": 39951758, "link": "https://stackoverflow.com/questions/39951758/foldable-monoid-and-monad/39952898#39952898", "title": "Foldable, Monoid and Monad", "body": "<h3><code>Monoid</code> and <code>Monad</code></h3>\n\n<p>Wow, this is actually one of the rare times we can use the quote:</p>\n\n<blockquote>\n  <p>A monad is just a monoid in the category of endofunctors, [...]</p>\n</blockquote>\n\n<p>Let's start with a monoid. A monoid in the category <code>Set</code> of sets is a set of elements <code>m</code> with an empty element <code>mempty</code> and an associative function <code>mappend</code> to combine elements such that</p>\n\n<pre><code>mempty `mappend` x == x -- for any x\nx `mappend` mempty == x -- for any x\n-- and\na `mappend` (b `mappend` c) == (a `mappend` b) `mappend` c -- for all a, b, c\n</code></pre>\n\n<p>Note that a monoid is not limited to sets, there also exist monoids in the category <code>Cat</code> of categories (monads) and so on. Basically anytime you have an associative binary operation and an identity for it.</p>\n\n<p>Now a monad, which is a \"monoid in the category of endofunctors\" has following properties:</p>\n\n<p>It's an endofunctor, that means it has type <code>* -&gt; *</code> in the Category <code>Hask</code> of Haskell types.</p>\n\n<p>Now, to go further you must know a little bit of category theory I will try to explain here: Given two functors <code>F</code> and <code>G</code>, there exists a natural transformation from <code>F</code> to <code>G</code> iff there exists a function <code>\u03b1</code> such that every <code>F a</code> can be mapped to a <code>G a</code>. <code>\u03b1</code> can be many-to-one, but it has to map every element of <code>F a</code>. Roughly said, a natural transformation is a function between functors.</p>\n\n<p>Now in category theory, there can be many functors between two categories. Ina  simplified view it can be said that we don't even care about which functors map from where to where, we only care about the natural transformations between them.</p>\n\n<p>Coming back to monad, we can now see that a \"monoid in the category of endofunctors\" must posess two natural transformations. Let's call our monad endofunctor <code>M</code>:</p>\n\n<p>A natural transformation from the identity (endo)functor to the monad:</p>\n\n<pre><code>\u03b7 :: 1 -&gt; M -- this is return\n</code></pre>\n\n<p>And a natural transformation from the conposition of two monads and produce a third one:</p>\n\n<pre><code>\u03bc :: M \u00d7 M -&gt; M\n</code></pre>\n\n<p>Since <code>\u00d7</code> is the composition of functors, we can (roughly speaking) also write:</p>\n\n<pre><code>\u03bc :: m a \u00d7 m a -&gt; m a\n\u03bc :: (m \u00d7 m) a -&gt; m a\n\u03bc :: m (m a) -&gt; m a -- join in Haskell\n</code></pre>\n\n<p>Satisfying these laws:</p>\n\n<pre><code>\u03bc . M \u03bc == \u03bc . \u03bc M\n\u03bc . M \u03b7 == \u03bc . \u03b7 M\n</code></pre>\n\n<p>So, a monad is a special case of a monoid in the category of endofunctors. You can't write a monoid instance for monad in normal Haskell, since Haskell's notion of composition is too weak (I think; This is because functions are restricted to <code>Hask</code> and it's weaker than <code>Cat</code>). See <a href=\"https://stackoverflow.com/questions/3870088/a-monad-is-just-a-monoid-in-the-category-of-endofunctors-whats-the-issue\">this</a> for more information.</p>\n\n<h3>What about <code>Foldable</code>?</h3>\n\n<p>Now as for <code>Foldable</code>: there exist definitions of <code>fold</code>s using a custom binary function to combine the elements. Now you could of course supply any function to combine elements, or you could use an existing concept of combining elements, the monoid. Again, please note that this monoid restricted to the set monoid, <em>not</em> the catorical definition of monoid.</p>\n\n<p>Since the monoid's <code>mappend</code> is associative, <code>foldl</code> and <code>foldr</code> yield the same result, which is why the folding of monoids can be reduced to <code>fold :: Monoid m, Foldable t =&gt; t m -&gt; m</code>. This is an obvious connection between monoid and foldable.</p>\n\n<p>@danidiaz already pointed out the connection between <code>Applicative</code>, <code>Monoid</code> and <code>Foldable</code> using the <code>Const</code> functor <code>Const a b = Const a</code>, whose applicative instance requires the first parameter of <code>Const</code> to be a monoid (no <code>pure</code> without <code>mempty</code> (disregarding <code>undefined</code>)).</p>\n\n<p>Comparing monad and foldable is a bit of a stretch in my opinion, since monad is more powerful than foldable in the sense that foldable can only accumulate a list's values according to a mapping function, but the monad bind can structurally alter the context (<code>a -&gt; m b</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 10, "last_activity_date": 1476299462, "last_edit_date": 1495541209, "creation_date": 1476092559, "answer_id": 39955475, "question_id": 39951758, "link": "https://stackoverflow.com/questions/39951758/foldable-monoid-and-monad/39955475#39955475", "title": "Foldable, Monoid and Monad", "body": "<p><strong>Summary</strong>: <code>(&gt;&gt;=)</code> and <code>traverse</code> look similar because they both are arrow mappings of functors, while <code>foldMap</code> is (almost) a specialised <code>traverse</code>. </p>\n\n<p>Before we begin, there is one bit of terminology to explain. Consider <code>fmap</code>:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; (f a -&gt; f b)\n</code></pre>\n\n<p>A Haskell <code>Functor</code> is a functor from the <strong>Hask</strong> category (the category with Haskell functions as arrows) to itself. In category theory terms, we say that the (specialised) <code>fmap</code> is the <em>arrow mapping</em> of this functor, as it is the part of the functor that takes arrows to arrows. (For the sake of completeness: a functor consists of an arrow mapping plus an <em>object mapping</em>. In this case, the objects are Haskell types, and so the object mapping takes types to types -- more specifically, the object mapping of a <code>Functor</code> is its type constructor.)</p>\n\n<p>We will also want to keep in mind the category and functor laws:</p>\n\n<pre><code>-- Category laws for Hask:\nf . id = id\nid . f = f\nh . (g . f) = (h . g) . f\n\n-- Functor laws for a Haskell Functor:\nfmap id = id\nfmap (g . f) = fmap g . fmap f\n</code></pre>\n\n<p>In what follows, we will work with categories other than <strong>Hask</strong>, and functors which are not <code>Functor</code>s. In such cases, we will replace <code>id</code> and <code>(.)</code> by the appropriate identity and composition, <code>fmap</code> by the appropriate arrow mapping and, in one case, <code>=</code> by an appropriate equality of arrows.</p>\n\n<h2>(=&lt;&lt;)</h2>\n\n<p>To begin with the more familiar part of the answer, for a given monad <code>m</code> the <code>a -&gt; m b</code> functions (also known as Kleisli arrows) form a category (the Kleisli category of <code>m</code>), with <code>return</code> as identity and <code>(&lt;=&lt;)</code> as composition. The three category laws, in this case, are just <a href=\"https://stackoverflow.com/a/23051842/2751851\">the monad laws</a>:</p>\n\n<pre><code>f &lt;=&lt; return = return\nreturn &lt;=&lt; f = f\nh &lt;=&lt;  (g &lt;=&lt;  f) = (h &lt;=&lt;  g) &lt;=&lt;  f\n</code></pre>\n\n<p>Now, your asked about flipped bind:</p>\n\n<pre><code>(=&lt;&lt;) :: Monad m =&gt; (a -&gt; m b) -&gt; (m a -&gt; m b)\n</code></pre>\n\n<p>It turns out that <code>(=&lt;&lt;)</code> is the arrow mapping of a functor from the Kleisli category of <code>m</code> to <strong>Hask</strong>. The functor laws applied to <code>(=&lt;&lt;)</code> amount to two of the monad laws:</p>\n\n<pre><code>return =&lt;&lt; x = x -- right unit\n(g &lt;=&lt; f) =&lt;&lt; x = g =&lt;&lt; (f =&lt;&lt; x) -- associativity \n</code></pre>\n\n<h2>traverse</h2>\n\n<p>Next, we need a detour through <code>Traversable</code> (a sketch of a proof of the results in this section is provided at the end of the answer). First, we note that the <code>a -&gt; f b</code> functions for <em>all</em> applicative functors <code>f</code> taken at once (as opposed to one at each time, as when specifying a Kleisli category) form a category, with <code>Identity</code> as identity and <code>Compose . fmap g . f</code> as composition. For that to work, we also have to adopt a more relaxed equality of arrows, which ignores the <code>Identity</code> and <code>Compose</code> boilerplate (which is only necessary because I am writing this in pseudo-Haskell, as opposed to proper mathematical notation). More precisely, we will consider that that any two functions that can be interconverted using any composition of the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Identity.html\" rel=\"nofollow noreferrer\"><code>Identity</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\"><code>Compose</code></a> isomorphisms as equal arrows (or, in other words, we will not distinguish between <code>a</code> and <code>Identity a</code>, nor between <code>f (g a)</code> and <code>Compose f g a</code>).</p>\n\n<p>Let's call that category the \"traversable category\" (as I cannot think of a better name right now). In concrete Haskell terms, an arrow in this category is a function which adds an extra layer of <code>Applicative</code> context \"below\" any previous existing layers. Now, consider <code>traverse</code>:</p>\n\n<pre><code>traverse :: (Traversable t, Applicative f) =&gt; (a -&gt; f b) -&gt; (t a -&gt; f (t b))\n</code></pre>\n\n<p>Given a choice of traversable container, <code>traverse</code> is the arrow mapping of a functor from the \"traversable category\" to itself. The functor laws for it amount to the traversable laws.</p>\n\n<p>In short, both <code>(=&lt;&lt;)</code> and <code>traverse</code> are analogues of <code>fmap</code> for functors involving categories other than <strong>Hask</strong>, and so it is not surprising that their types are a bit similar to each other.</p>\n\n<h2>foldMap</h2>\n\n<p>We still have to explain what all of that has to do with <code>foldMap</code>. The answer is that <code>foldMap</code> can be recovered from <code>traverse</code> (cf. <a href=\"https://stackoverflow.com/a/39952209/2751851\">danidiaz's answer</a> -- it uses <code>traverse_</code>, but as the applicative functor is <code>Const m</code> the result is essentially the same):</p>\n\n<pre><code>-- cf. Data.Traversable\nfoldMapDefault :: (Traversable t, Monoid m) =&gt; (a -&gt; m) -&gt; (t a -&gt; m)\nfoldMapDefault f = getConst . traverse (Const . f)\n</code></pre>\n\n<p>Thanks to the <code>const</code>/<code>getConst</code> isomorphism, this is clearly equivalent to:</p>\n\n<pre><code>foldMapDefault' :: (Traversable t, Monoid m)\n                =&gt; (a -&gt; Const m b) -&gt; (t a -&gt; Const m (t b))\nfoldMapDefault' f = traverse f\n</code></pre>\n\n<p>Which is just <code>traverse</code> specialised to the <code>Monoid m =&gt; Const m</code> applicative functors. Even though <code>Traversable</code> is not <code>Foldable</code> and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:foldMapDefault\" rel=\"nofollow noreferrer\"><code>foldMapDefault</code></a> is not <code>foldMap</code>, this provides a decent justification for why the type of <code>foldMap</code> resembles that of <code>traverse</code> and, transitively, that of <code>(=&lt;&lt;)</code>.</p>\n\n<p>As a final observation, note that the arrows of the \"traversable category\" with applicative functor <code>Const m</code> for some <code>Monoid</code> <code>m</code> do <em>not</em> form a subcategory, as there is no identity unless <code>Identity</code> is among the possible choices of applicative functor. That probably means there is nothing else of interest to say about <code>foldMap</code> from the perspective of this answer. The only single choice of applicative functor that gives a subcategory is <code>Identity</code>, which is not at all surprising, given how a traversal with <code>Identity</code> amounts to <code>fmap</code> on the container.</p>\n\n<h2>Appendix</h2>\n\n<p>Here is a rough sketch of the derivation of the <code>traverse</code> result, yanked from my notes from several months ago with minimal editing. <code>~</code> means \"equal up to (some relevant) isomorphism\".</p>\n\n<pre><code>-- Identity and composition for the \"traversable category\".\nidT = Identity\ng .*. f = Compose . fmap g . f\n\n-- Category laws: right identity\nf .*. idT ~ f\nf .*. idT\nCompose . fmap f . idT\nCompose . fmap f . Identity\nCompose . Identity . f\nf -- using getIdentity . getCompose \n\n-- Category laws: left identity\nidT .*. f ~ f\nidT .*. f\nCompose . fmap Identity . f\nf -- using fmap getIdentity . getCompose\n\n-- Category laws: associativity\nh .*. (g .*. f) ~ (h .*. g) .*. f\nh .*. (g .*. f) -- LHS\nh .*. (Compose . fmap g . f)\nCompose . fmap h . (Compose . fmap g . f)\nCompose . Compose . fmap (fmap h) . fmap g . f\n(h .*. g) .*. f -- RHS\n(Compose . fmap h . g) .*. f\nCompose . fmap (Compose . fmap h . g) . f\nCompose . fmap (Compose . fmap h) . fmap g . f\nCompose . fmap Compose . fmap (fmap h) . fmap g . f\n-- using Compose . Compose . fmap getCompose . getCompose\nCompose . Compose . fmap (fmap h) . fmap g . f -- RHS ~ LHS\n</code></pre>\n\n\n\n<pre><code>-- Functor laws for traverse: identity\ntraverse idT ~ idT\ntraverse Identity ~ Identity -- i.e. the identity law of Traversable\n\n-- Functor laws for traverse: composition\ntraverse (g .*. f) ~ traverse g .*. traverse f\ntraverse (Compose . fmap g . f) ~ Compose . fmap (traverse g) . traverse f \n-- i.e. the composition law of Traversable\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2364, "favorite_count": 10, "answer_count": 3, "score": 27, "last_activity_date": 1559612235, "creation_date": 1476077243, "last_edit_date": 1559612235, "question_id": 39951758, "link": "https://stackoverflow.com/questions/39951758/foldable-monoid-and-monad", "title": "Foldable, Monoid and Monad", "body": "<p>Consider the following signature of <code>foldMap</code></p>\n\n<pre><code>foldMap :: (Foldable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m\n</code></pre>\n\n<p>This is very similar to \"bind\", just with the arguments swapped:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>It seems to me that there therefore must be some sort of relationship between <code>Foldable</code>, <code>Monoid</code> and <code>Monad</code>, but I can't find it in the superclasses. Presumably I can transform one or two of these into the other but I'm not sure how.</p>\n\n<p>Could that relationship be detailed?</p>\n"}, {"tags": ["haskell", "machine-learning", "parallel-processing", "monoids"], "answers": [{"comments": [{"owner": {"reputation": 2514, "user_id": 6004650, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/668db278c31bc9040a9dea1b77b4ddd4?s=128&d=identicon&r=PG&f=1", "display_name": "MikeJRamsey56", "link": "https://stackoverflow.com/users/6004650/mikejramsey56"}, "edited": false, "score": 0, "creation_date": 1478314825, "post_id": 39944047, "comment_id": 68116944, "body": "Good first answer."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 15, "last_activity_date": 1476018955, "creation_date": 1476018955, "answer_id": 39944047, "question_id": 39943545, "link": "https://stackoverflow.com/questions/39943545/how-does-monoid-assist-in-parallel-training/39944047#39944047", "title": "How does Monoid assist in parallel training?", "body": "<p>It's explained in <a href=\"https://izbicki.me/public/papers/icml2013-algebraic-classifiers.pdf\">this article</a> which is linked in the page you linked in the question. Since you want a beginner friendly description I'll give you a very high level description of what I understood after reading the article. Consider this as a rough overview of the idea, to understand exactly everything you <em>have</em> to <strong>study</strong> the articles.</p>\n\n<p>The basic idea is to use algebraic properties to avoid re-doing the same work over and over. They do it by using the associativity of the monoidal operation and homomorphisms.</p>\n\n<p>Given two sets <code>A</code> and <code>B</code> with two binary operations <code>+</code> and <code>*</code> an homomorphism is a function <code>f: A -&gt; B</code> such that <code>f(x + y) = f(x) * f(y)</code>, i.e. it's a function that preserves the structure between the two sets.\nIn the case of that article the function <code>f</code> is basically the function that maps the sets of inputs to the trained models.</p>\n\n<p>So the idea is that you can divide the input data into different portions <code>x</code> and <code>y</code>, and instead of having to compute the model of the whole thing as in <code>T(x + y)</code> you can do the training on just <code>x</code> and <code>y</code> and then combine the results: <code>T(x) * T(y)</code>.</p>\n\n<p>Now this as it is doesn't really help that much <em>but</em>, in training you often repeat work. For example in cross validation you, for <code>k</code> times, sample the data into a set of inputs for the trainer and a set of data used to test the trainer. But this means that in these <code>k</code> iterations you are executing <code>T</code> over the same portions of inputs multiple times.</p>\n\n<p>Here monoids come into play: you can first split the domain into subsets, and compute <code>T</code> over these subsets, and then to compute the result of cross validation you can just put together the results from the corresponding subsets.</p>\n\n<p>To give an idea: if the data is <code>{1,2,3,4}</code> and <code>k = 3</code> instead of doing:</p>\n\n<ul>\n<li><code>T({1,2})</code> plus test on <code>{3, 4}</code></li>\n<li><code>T({1,3})</code> plus test on <code>{2, 4}</code></li>\n<li><code>T({1,4})</code> plus test on <code>{2, 3}</code></li>\n</ul>\n\n<p>Here you can see that we trained over <code>1</code> for three times. Using the homomorphism we can compute <code>T({1})</code> <em>once</em> and then combine the result with the other partial result to obtain the final trained model.</p>\n\n<p>The correctness of the final result is assured by the associativity of the operations and the homomorphism.</p>\n\n<p>The same idea can be applied when parallelizing: you divide the inputs into <code>k</code> groups, perform the training in parallel and then compound the results: <code>T(x_1 + x_2 + ... + x_k) = T(x_1) * T(x_2) * ... * T(x_k)</code> where the <code>T(x_i)</code> calls are performed completely in parallel and only at the end you have to compound the results.</p>\n\n<p>Regarding online training algorithms, the idea is that given a \"batch\" training algorithm <code>T</code> you can make it into an online one by doing:</p>\n\n<pre><code>T_O(m, d) = m * T(d)\n</code></pre>\n\n<p>where <code>m</code> is an already trained model (which generally will be the trained model until that point) and <code>d</code> is the new data point you add for training.</p>\n\n<p>Again the exactness of the result is due to the homorphism that tells you that if <code>m = T(x)</code> then <code>m * T(d) = T(x+d)</code>, i.e. the online algorithm gives the same result of the batch algorithm with all those data points.</p>\n\n<hr>\n\n<p>The more interesting (and complex) part of all of this is <em>how</em> can you see a training task as such a homomorphism etc. I'll leave that to your personal study.</p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 3, "accepted_answer_id": 39944047, "answer_count": 1, "score": 4, "last_activity_date": 1476018955, "creation_date": 1476015590, "question_id": 39943545, "link": "https://stackoverflow.com/questions/39943545/how-does-monoid-assist-in-parallel-training", "title": "How does Monoid assist in parallel training?", "body": "<p>The Readme of <a href=\"https://github.com/mikeizbicki/HLearn\" rel=\"nofollow\">HLearn</a> states that the Monoid typeclass is used for parallel batch training. I've seen <code>trainMonoid</code> mentioned in several files, but I'm having a difficulty to dissect this huge codebase. Could someone explain in beginner-friendly terms how does it work? I guess it's somehow related to the associativity property.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 2, "creation_date": 1476013058, "post_id": 39941395, "comment_id": 67166712, "body": "As an approximation, you could define an <code>instance Num</code> and use <code>fromInteger</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1476030402, "post_id": 39943129, "comment_id": 67171799, "body": "That thing about pattern matching surprises me, since <code>Word</code> is not integer, yet you can pattern match it. Is that built-in functionality?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "edited": false, "score": 0, "creation_date": 1476033313, "post_id": 39943129, "comment_id": 67172750, "body": "@FordO. Indeed. Patterns are usually made using value constructors, but numbers are also allowed, as a special case. Basically, <code>case x of 1 -&gt; ...</code> is roughly converted to <code>if (fromInteger 1 == x) then ...</code> exploiting the <code>Num</code> instance."}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 8, "last_activity_date": 1476013273, "last_edit_date": 1476013273, "creation_date": 1476012925, "answer_id": 39943129, "question_id": 39941395, "link": "https://stackoverflow.com/questions/39941395/haskell-is-it-possible-to-use-numbers-as-data-constructors/39943129#39943129", "title": "Haskell: Is it possible to use numbers as data constructors?", "body": "<p>It's not possible to get the exact syntax you want, but there are ways to generically define a \"between 0 and n\" type in a way that they share constructors, and then use numeric literals as abstract constructors.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/finite-typelits\">finite-typelits</a> package offers a type parameterized over the number of elements it has, so:</p>\n\n<pre><code>x :: Finite 4\n</code></pre>\n\n<p>would be a type with four inhabitants: 0, 1, 2, and 3.  If you ever have a value of type <code>Finite 4</code>, you can be sure that it is one of those four values (or something silly like <code>undefined</code> or some other bottom).  You can't pattern match on it directly, but you can project a <code>Finite 4</code> into the integers by using <code>getFinite :: Finite n -&gt; Integer</code>.</p>\n\n<p>So in this scheme, you'd have:</p>\n\n<pre><code>type Binary = Finite 2\ntype Quad   = Finite 4\ntype Octal  = Finite 8\n</code></pre>\n\n<p>You can can indirectly pattern match:</p>\n\n<pre><code>processBinary :: Binary -&gt; String\nprocessBinary d = case getFinite d of\n    0 -&gt; \"It's a zero\"\n    1 -&gt; \"it's a one\"\n    _ -&gt; -- this case should be impossible, even though the compiler can't verify that.\n</code></pre>\n\n<p>And, you can even \"construct\" them using numeric literals using their (partial) <code>Num</code> instance:</p>\n\n<pre><code>&gt; putStrLn (processBinary 0)\nIt's a zero\n&gt; putStrLn (processBinary 0)\nIt's a one\n</code></pre>\n\n<p>So this might be the closest thing to what you want!  But there are a couple of drawbacks -- the compiler can't verify that your pattern matching statements are complete, and it also can't verify that your numeric literals are actually valid and won't be out of range for the type you're using.</p>\n\n<pre><code>&gt; putStrLn (processBinary 2)\n** Error: Runtime error!  Sucks :'(\n</code></pre>\n\n<p>There's also the convenient <code>weakenN</code> and <code>strengthenN</code> functions, which allow you to use a <code>Finite 2</code> as if it were a <code>Finite 8</code> (use a Binary digit as if it were an Octal digit), and also to use a <code>Finite 8</code> as if it were a <code>Maybe (Finite 2)</code>.</p>\n\n<pre><code>binDigitToOctalDigit :: Binary -&gt; Octal   -- Finite 2 -&gt; Finite 8\nbinDigitToOctalDigit = weakenN\n</code></pre>\n\n<hr>\n\n<p>There's another method that doesn't match what you want exactly, but there are some advantages.  What you can do is have an recursive/inductively defined defined type (like lists) that are \"constructed\" to only have so many constructors, parameterized again on some type-level numeral.  <a href=\"http://hackage.haskell.org/package/type-combinators-0.2.4.3/docs/Data-Type-Fin.html\">type-combinators</a> offers one such type.  There, you'd have:</p>\n\n<pre><code>type Binary = Fin (S (S Z))     -- \"2\"\ntype Octal  = Fin (S (S (S (S (S (S (S (S Z))))))))   -- \"8\"\n</code></pre>\n\n<p>The library does offer convenient type synonyms, so you could instead write:</p>\n\n<pre><code>type Binary = Fin N2\ntype Quad   = Fin N4\ntype Octal  = Fin N8\n</code></pre>\n\n<p>and the <code>Fin</code> type is constructed to have exactly the number of constructors indicated by the type.  <code>Fin N2</code> has two constructors:</p>\n\n<ol>\n<li><code>FZ    :: Fin N2</code></li>\n<li><code>FS FZ :: Fin N2</code></li>\n</ol>\n\n<p>And <code>Fin N8</code> has eight constructors, <code>FZ</code>, <code>FS FZ</code>, <code>FS (FS FZ)</code>, etc.</p>\n\n<p><code>Fin</code> has a projection function as well, <code>fin :: Fin n -&gt; Int</code>, so you can use it the same way as you'd use <code>Finite</code>, and pattern match on an <code>Int</code> literal.  <em>But!</em>  The advantage of having this is that you can also directly pattern match on the constructors, and the compiler will ensure completeness:</p>\n\n<pre><code>processBinary :: Fin N2 -&gt; String\nprocessBinary d = case d of\n  FZ    -&gt; \"It's a zero\"\n  FS FZ -&gt; \"It's a one\"\n</code></pre>\n\n<p>And GHC can actually verify that you've handled every option :)</p>\n\n<p>And, you also can't ever accidentally use a constructor that's \"out of range\":</p>\n\n<pre><code>&gt; putStrLn (processBinary FZ)\nIt's a zero\n&gt; putStrLn (processBinary (FS (FS FZ))\n-- that is a compile error!  neat, the compiler would tell you that this isn't allowed!\n</code></pre>\n\n<p>The library defines <code>weaken</code> similar to how the <em>finite-typelits</em> library does.  It doesn't define <code>strengthen</code>, but it's possible to implement it if you need it :)</p>\n\n<pre><code>binDigitToQuadDigit :: Binary -&gt; Quad      -- Fin N2 -&gt; Fin N4\nbinDigitToQuadDigit = weaken . weaken\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 0, "accepted_answer_id": 39943129, "answer_count": 1, "score": 4, "last_activity_date": 1476013273, "creation_date": 1476000310, "last_edit_date": 1476001607, "question_id": 39941395, "link": "https://stackoverflow.com/questions/39941395/haskell-is-it-possible-to-use-numbers-as-data-constructors", "title": "Haskell: Is it possible to use numbers as data constructors?", "body": "<p>I have some data, and I want to test, what is the best way to store them. I am deciding between binary, quad, octal and hexadecimal data types. </p>\n\n<p>The only way to check which is the best, is to use each of them in my algorithm and then see the results.</p>\n\n<p>So far my implementation looks like this:</p>\n\n<pre><code>{-# LANGUAGE DeriveAnyClass #-}\n\ndata Binary = O | I         \n              deriving (Bounded, Enum, Eq, Ord, Show)\ndata Octal  = OA | OB | OC | OD | OE | OF | OG | OH \n              deriving ( ... )\n</code></pre>\n\n<p>But I would like more general constructors like <code>data Binary = 0 | 1</code>. Is it possible to do that?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1476204703, "post_id": 39938328, "comment_id": 67243604, "body": "If you do this, <code>:r</code> won&#39;t reload changes to your lib. Do you know how to do it so that <code>:r</code> recompiles the lib and tests?"}, {"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "reply_to_user": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1477483778, "post_id": 39938328, "comment_id": 67784180, "body": "@SeanClarkHess There&#39;s a couple ways of setting up tests. You can set it up by adding the library you&#39;re testing to the test-suite build-depends, or you can just add the library source folder to the test-suite hs-source-dirs. I <i>believe</i> <code>:r</code> works with the latter and not the former, but I&#39;m not certain.  Sorry for taking so long to notice your question."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1487888564, "post_id": 39938328, "comment_id": 72000163, "body": "I think you need to do a <code>stack install</code> of the library under test prior to running the command above, don&#39;t you?"}], "tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": true, "score": 25, "last_activity_date": 1513889043, "last_edit_date": 1513889043, "creation_date": 1475968149, "answer_id": 39938328, "question_id": 39938101, "link": "https://stackoverflow.com/questions/39938101/how-to-load-tests-in-ghci-with-stack/39938328#39938328", "title": "How to load tests in ghci with stack", "body": "<p>Try <code>stack ghci (your project name):(the test suite name)</code>. Then you should be able to enter <code>main</code> and your tests will run.</p>\n\n<p>Example:</p>\n\n<p>If your .cabal project file had the following values:</p>\n\n<pre><code>name: ExampleProject\n...\ntest-suite Example-test\n</code></pre>\n\n<p>Then the command to run would be <code>stack ghci ExampleProject:Example-test</code></p>\n\n<p>(edit suggested by @Chris Stryczynski)</p>\n\n<p>To watch the <code>test</code> and <code>src</code> directories so they are updated when you reload with <code>:r</code>, run:</p>\n\n<pre><code>stack ghci --ghci-options -isrc --ghci-options -itest ExampleProduct:Example-test\n</code></pre>\n"}], "owner": {"reputation": 9732, "user_id": 250560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9b2db31315eb85364b2e849342736be2?s=128&d=identicon&r=PG", "display_name": "Konstantin Solomatov", "link": "https://stackoverflow.com/users/250560/konstantin-solomatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2773, "favorite_count": 2, "accepted_answer_id": 39938328, "answer_count": 1, "score": 21, "last_activity_date": 1513889043, "creation_date": 1475966329, "question_id": 39938101, "link": "https://stackoverflow.com/questions/39938101/how-to-load-tests-in-ghci-with-stack", "title": "How to load tests in ghci with stack", "body": "<p>I created a very simple project with stack. It contains: an executable, a library and test targets in the associated cabal file. When I load the code to ghci via stack ghci, I can't access test there, even if they are in separate module. Is there any way to use it in such a way?</p>\n"}, {"tags": ["haskell", "reflex"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475956722, "post_id": 39936716, "comment_id": 67155324, "body": "Maybe I missing something, but what is your class for? Why not just use <code>elAttr&#39;</code> if that&#39;s what you want?"}, {"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475956782, "post_id": 39936716, "comment_id": 67155357, "body": "dfeuer: I&#39;d like to be able to compose widgets. I&#39;ll update the question to make that clear."}, {"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475957013, "post_id": 39936716, "comment_id": 67155422, "body": "dfeuer: Also, I&#39;d like my new functions to work the same as the original functions, if possible. If the original <code>el&#39;</code> can be called this way, why can&#39;t my new <code>el&#39;</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475957193, "post_id": 39936716, "comment_id": 67155480, "body": "I still don&#39;t understand what your class is for. What does it give you that <code>MonadWidget</code> does not? Why does it have so many parameters?"}, {"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475957442, "post_id": 39936716, "comment_id": 67155566, "body": "dfeuer: The typeclass lets me define <code>elAttr&#39;</code> for a new kind of widget, and have <code>el</code>, <code>el&#39;</code>, <code>elAttr</code>, etc defined for it automatically. <code>Button</code> is just a <code>&lt;button&gt;</code> tag, but most widgets will consist of many tags, have attached JavaScript, etc."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475957983, "post_id": 39936716, "comment_id": 67155735, "body": "Oh, I think I see what you mean. The names being borrowed confused me."}, {"owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475958159, "post_id": 39936716, "comment_id": 67155789, "body": "Sorry about that. Updated the question again to call out that the same names are used. I&#39;d change the names, but I&#39;m afraid I&#39;d break the code in the process."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1475960808, "post_id": 39936716, "comment_id": 67156595, "body": "In all the functions you&#39;ve mentioned, the implementation in <code>Reflex</code> leaves the parameters <code>t</code>, <code>m</code>, and <code>a</code> are free -  it doesn&#39;t seem like there&#39;s any reason for <code>t</code> or <code>m</code> to be bound in your class. Furthermore, you use <code>el</code> as a sort of &#39;label&#39; to pick what you are constructing, but then you would have to write <code>el Button ...</code> or <code>el SomethingElse ...</code> anyways - why not just have <code>el_Button</code>, <code>el_SomethingElse</code>, etc, and assign each the correct type? The other function defaults can just be functions themselves - taking a function of appropriate type (type of <code>elAttr&#39;</code>) as input."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1475960892, "post_id": 39936716, "comment_id": 67156621, "body": "... then you could write simply <code>el_Something = elDefault elAttr&#39;_Something</code> - this would of course cost you 3 extra lines of boilerplate per &#39;instance&#39; but then you are not fighting upstream against the type system to acheieve some almost arbitrary name overloading."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1475961823, "last_edit_date": 1475961823, "creation_date": 1475958957, "answer_id": 39937121, "question_id": 39936716, "link": "https://stackoverflow.com/questions/39936716/how-do-you-define-a-haskell-typeclass-with-a-type-that-cannot-be-deduced/39937121#39937121", "title": "How do you define a Haskell typeclass with a type that cannot be deduced?", "body": "<p>What you probably want to do (and this is something you very often want to do; it's becoming something of a FAQ) is replace a constructor on the right side of <code>=&gt;</code> with an equality constraint on the left side.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ninstance (D.MonadWidget t m, input ~ m output)\n   =&gt; ElMaker t m Text input output where ...\n\ninstance (D.MonadWidget t m, input' ~ m input, output ~ Event t ())\n   =&gt; ElMaker t m Button input' output where ...\n</code></pre>\n\n<p>Once you know you're building <code>Text</code> or <code>Button</code>, you want to commit to a particular instance, and then to certain class parameters having particular shapes. Putting those in the instance constraints lets you do that.</p>\n\n<p>For the particular case here, once you know that you're dealing with <code>Text</code>, you know which instance you want to use, and that you can calculate <code>output</code> by matching on <code>input</code>. You want GHC to know that, rather than wondering if some other <code>Text</code> instance will have a different input/output relationship.</p>\n\n<p>Note: it's generally best for the critical class parameter that determines others to go <em>last</em>. So I'd make <code>el</code> the last parameter of <code>ElMaker</code>. This is good for newtype deriving, and is also conventional.</p>\n"}], "owner": {"reputation": 2942, "user_id": 129889, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68971fe7ee8fd814c26391c727c065bb?s=128&d=identicon&r=PG", "display_name": "alltom", "link": "https://stackoverflow.com/users/129889/alltom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 39937121, "answer_count": 1, "score": 2, "last_activity_date": 1475961823, "creation_date": 1475956333, "last_edit_date": 1475958071, "question_id": 39936716, "link": "https://stackoverflow.com/questions/39936716/how-do-you-define-a-haskell-typeclass-with-a-type-that-cannot-be-deduced", "title": "How do you define a Haskell typeclass with a type that cannot be deduced?", "body": "<p>I'm using <a href=\"https://hackage.haskell.org/package/reflex-dom-0.3/candidate/docs/Reflex-Dom-Widget-Basic.html\" rel=\"nofollow\">the Reflex.Dom library</a>, which defines a set of functions for creating HTML DOM elements</p>\n\n<ul>\n<li><code>el</code> creates an element</li>\n<li><code>el'</code> creates and returns an element</li>\n<li><code>elAttr</code> creates an element with the given attributes</li>\n<li><code>elAttr'</code> creates and returns an element with the given attributes</li>\n<li>etc</li>\n</ul>\n\n<p>I'm making my own widget library and I don't want to define all those variations for every widget. So I wrote a typeclass that uses the same names, but defines all the functions in terms of one another, leaving only one of them to be defined in each instance:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule ElMaker where\n\nimport Data.Map (Map)\nimport qualified Data.Map as Map\nimport qualified Reflex.Dom as D\n\n-- el: type of element to create\n-- input: input parameter\n-- output: return value\nclass (D.MonadWidget t m) =&gt; ElMaker t m el input output where\n  el :: el -&gt; input -&gt; m output\n  el e = elAttr e Map.empty\n\n  elAttr :: el -&gt; Map Text Text -&gt; input -&gt; m output\n  elAttr e attrs input = snd &lt;$&gt; elAttr' e attrs input\n\n  el' :: el -&gt; input -&gt; m (D.El t, output)\n  el' e = elAttr' e Map.empty\n\n  -- This is the only one to implement, yay!\n  elAttr' :: el -&gt; Map Text Text -&gt; input -&gt; m (D.El t, output)\n</code></pre>\n\n<p>I created an instance that uses the original <code>elAttr'</code> to test it out. It worked:</p>\n\n<pre><code>import Data.Text (Text)\nimport qualified Reflex.Dom as D\n\ninstance (D.MonadWidget t m) =&gt; ElMaker t m Text (m output) output where\n  elAttr' = D.elAttr'\n</code></pre>\n\n<p>And then I created a <code>Button</code> widget instance that returns an event for when the button is clicked. It worked:</p>\n\n<pre><code>data Button = Button\ninstance (MonadWidget t m) =&gt; ElMaker t m Button (m input) (Event t ()) where\n  elAttr' _ attrs contents = do\n    (e, _) &lt;- D.el' \"button\" contents\n    return $ (e, D.domEvent D.Click e)\n</code></pre>\n\n<p>I'd like to be able to compose widgets, so I tried rewriting the <code>Button</code> instance to use the <code>Text</code> instance of <code>ElMaker</code> to create the element. But it fails to compile:</p>\n\n<pre><code>data Button = Button\ninstance (MonadWidget t m) =&gt; ElMaker t m Button (m input) (Event t ()) where\n  elAttr' _ attrs contents = do\n    (e, _) &lt;- el' (\"button\" :: Text) contents\n    return $ (e, D.domEvent D.Click e)\n</code></pre>\n\n<p>Compiler output:</p>\n\n<pre><code>MDL.hs:119:15: error:\n    \u2022 Could not deduce (ElMaker t m Text (m input) output0)\n        arising from a use of \u2018el'\u2019\n      from the context: MonadWidget t m\n        bound by the instance declaration at MDL.hs:116:10-71\n      The type variable \u2018output0\u2019 is ambiguous\n      Relevant bindings include\n        contents :: m input (bound at MDL.hs:117:19)\n        elAttr' :: Button\n                   -&gt; Map.Map Text Text -&gt; m input -&gt; m (D.El t, Event t ())\n          (bound at MDL.hs:117:3)\n      These potential instance exist:\n        instance MonadWidget t m =&gt; ElMaker t m Text (m output) output\n          -- Defined in \u2018ElMaker\u2019\n    \u2022 In a stmt of a 'do' block:\n        (e, _) &lt;- el' (\"button\" :: Text) contents\n      In the expression:\n        do { (e, _) &lt;- el' (\"button\" :: Text) contents;\n             return $ (e, D.domEvent D.Click e) }\n      In an equation for \u2018elAttr'\u2019:\n          elAttr' _ attrs contents\n            = do { (e, _) &lt;- el' (\"button\" :: Text) contents;\n                   return $ (e, D.domEvent D.Click e) }\n</code></pre>\n\n<p>I think this is because the function doesn't do anything with the value that would constrain its type, and the compiler really wants it to have a concrete type. But this typeclass doesn't care what the value of that type parameter is. Is there any way to compile this anyway?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1475954253, "post_id": 39936303, "comment_id": 67154552, "body": "<code>map f [x]</code> is <code>[f x]</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1475954302, "post_id": 39936303, "comment_id": 67154563, "body": "<code>[x] ++</code> is <code>x :</code>."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1475954326, "post_id": 39936303, "comment_id": 67154576, "body": "SIde note: consider defining <code>OrdTree</code> using the record syntax, in order to get accessors <code>root</code> and <code>children</code> &quot;for free&quot;."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1475954332, "post_id": 39936303, "comment_id": 67154577, "body": "If your bfsTreeList wasn&#39;t a type error, it would be identical to dfsTreeList."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1475954362, "post_id": 39936303, "comment_id": 67154585, "body": "<code>map bfsTreeList</code> has the type <code>[OrdTree a] -&gt; [[a]]</code> - but you state that the return type (and hence the inferred type of <code>map bfsTreeList ...</code>) is <code>[a]</code>, so you get a type mismatch between <code>[a]</code> and <code>[[a]]</code> - you use <code>concat</code> in <code>dfsTreeList</code> , perhaps that would help here?"}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": false, "score": 1, "last_activity_date": 1476017612, "last_edit_date": 1476017612, "creation_date": 1475959151, "answer_id": 39937147, "question_id": 39936303, "link": "https://stackoverflow.com/questions/39936303/getting-a-couldnt-match-type-a-with-a-error/39937147#39937147", "title": "Getting a \u201eCouldn&#39;t match type \u2018a\u2019 with \u2018[a]\u2019...\u201c error", "body": "<p>Try thinking in terms of levels of the tree. What is a level? It is a list of subtrees.</p>\n\n<pre><code>type Level a = [OrdTree a]\n</code></pre>\n\n<p>Next you'll need a function that, given a level, produces the next level. You may find the function <code>concatMap</code> useful here but it is not strictly necessary.</p>\n\n<pre><code>nextLevel :: Level a -&gt; Level a\nnextLevel = ...\n</code></pre>\n\n<p>After you have this, you'll want a function that, given a tree, produces a list of its levels. This will probably be an infinite list (since the next level of an empty level is again an empty level), but after a certain point it will only be populated with empty levels. Here you might find the function <code>iterate</code> useful.</p>\n\n<pre><code>levels :: OrdTree a -&gt; [Level a]\nlevels = ...\n</code></pre>\n\n<p>Finally, you're able to construct your <code>bfsTreeList</code> function using these pieces. You'll produce a list of levels from your tree using <code>levels</code>, then you'll cut off the portion that only contains empty levels making the list finite, then you'll concatenate the list and retrieve the values stored:</p>\n\n<pre><code>bfsTreeList :: OrdTree a -&gt; [a]\nbfsTreeList = map root . concat . takeWhile (not . null) . levels\n</code></pre>\n\n<p>Here's an example tree you can use as a test case:</p>\n\n<pre><code>exampleTree :: OrdTree Int\nexampleTree = OrdTree 1 [ OrdTree 2 [ OrdTree 5 []\n                                    , OrdTree 6 []]\n                        , OrdTree 3 [ OrdTree 7 []\n                                    , OrdTree 8 [OrdTree 9 []]]\n                        , OrdTree 4 []]\n</code></pre>\n\n<p>The result should look like this:</p>\n\n<pre><code>\u03bb. bfsTreeList exampleTree \n[1,2,3,4,5,6,7,8,9]\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4666007, "user_type": "registered", "profile_image": "https://graph.facebook.com/10202626990634893/picture?type=large", "display_name": "Anton Sherstiuk", "link": "https://stackoverflow.com/users/4666007/anton-sherstiuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1476017612, "creation_date": 1475953722, "last_edit_date": 1475954124, "question_id": 39936303, "link": "https://stackoverflow.com/questions/39936303/getting-a-couldnt-match-type-a-with-a-error", "title": "Getting a \u201eCouldn&#39;t match type \u2018a\u2019 with \u2018[a]\u2019...\u201c error", "body": "<p>I'm a Haskell beginner and I'm having a trouble with this piece of code. The task is to make a BFS function for the given data type. I've tried many variations, but the problem essentially remains the same: type mismatch.</p>\n\n<pre><code>data OrdTree a = OrdTree a [OrdTree a] \n             deriving (Show)\n\nroot :: OrdTree a -&gt; a\nroot (OrdTree x _) = x\n\nchildren :: OrdTree a -&gt; [OrdTree a]\nchildren (OrdTree _ x) = x\n\nbfsTreeList ::  OrdTree a -&gt;  [a]\nbfsTreeList ot = (map root [ot]) ++ (map bfsTreeList (children ot))\n</code></pre>\n\n<p>DFS seems to work just fine:</p>\n\n<pre><code>dfsTreeList ::  OrdTree a -&gt;  [a]\ndfsTreeList ot = root ot : concat (map dfsTreeList (sons ot))\n</code></pre>\n"}, {"tags": ["haskell", "io", "monads", "bytestring"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1475950405, "post_id": 39935695, "comment_id": 67153327, "body": "If this were possible then we wouldn&#39;t need an <code>IO</code> monad in the first place."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1475957113, "post_id": 39935695, "comment_id": 67155451, "body": "You can &quot;bring it out of the local scope of the function,&quot; it&#39;s just that the function you bring it into has to also be in the IO monad."}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "closed_date": 1475950361, "answer_count": 0, "score": 0, "last_activity_date": 1475950266, "creation_date": 1475950266, "question_id": 39935695, "link": "https://stackoverflow.com/questions/39935695/extracting-bytestring-from-io-context", "closed_reason": "Duplicate", "title": "Extracting ByteString from IO context?", "body": "<p>I have a function that makes a http request, I need to access the returned byte string. However, the monadic function I have doesn't seem to be able to return the  ByteString separated from its IO.</p>\n\n<p>See below:</p>\n\n<pre><code>executeRequest :: IO LAZ.ByteString\nexecuteRequest = do\n   response &lt;- simpleHttp \"http://www.bbc.co.uk\"\n   return (response)\n\nhtml = executeRequest\n\nextractBytesFromIO :: IO LAZ.ByteString -&gt; LAZ.ByteString\nextractBytesFromIO html = do\n    bytes &lt;- html\n    bytes\n</code></pre>\n\n<p>The above won't compile, with an error:</p>\n\n<pre><code>Couldn't match expected type \u2018LAZ.ByteString\u2019 with actual type \u2018IO b0\u2019\n</code></pre>\n\n<p>I need to bring the ByteString out of the local scope of the function, so the below will not work:</p>\n\n<pre><code>html - executeRequest\n\nextractBytesFromIO :: IO LAZ.ByteString\nextractBytesFromIO = do\n   bytes &lt;- html\n   let doStuff = //do stuff with bytes\n   html\n</code></pre>\n\n<p>Any suggestions on how extractBytesFromIO can return the ByteString without the IO context?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 5, "creation_date": 1475946046, "post_id": 39934981, "comment_id": 67151780, "body": "Please also post the error message."}], "answers": [{"comments": [{"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1475953899, "post_id": 39935390, "comment_id": 67154448, "body": "Thanks. It works. But why doesn&#39;t this problem show up when the code loads? If there is no declaration in the source, the code loads fine.Then <code>:t toDigits</code> -&gt;  <code>toDigits :: (RealFrac a, Integral a, Floating a) =&gt; a -&gt; [a]</code>"}, {"owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "reply_to_user": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 1, "creation_date": 1475954723, "post_id": 39935390, "comment_id": 67154694, "body": "Because there are no concrete types. It loads, because for some hypothetic type <code>a</code>, which is <code>Integral</code> and also <code>RealFrac</code> this function will work."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475966608, "post_id": 39935390, "comment_id": 67157890, "body": "In addition to Alexander&#39;s comment, you call the function with <code>1234</code> as the argument, which has type <code>Num a =&gt; a</code>, where <code>a</code> could be the hypothetical type that has instances for both <code>Integral</code> and <code>RealFrac</code>."}], "tags": [], "owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1475948359, "creation_date": 1475948359, "answer_id": 39935390, "question_id": 39934981, "link": "https://stackoverflow.com/questions/39934981/confused-about-haskell-number-types/39935390#39935390", "title": "Confused about Haskell number types", "body": "<p><code>logBase</code> requires Floating, but it's not</p>\n\n<p>This works:</p>\n\n<pre><code>[0 .. floor (logBase 10 $ fromIntegral num)]\n</code></pre>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1475948359, "creation_date": 1475945971, "question_id": 39934981, "link": "https://stackoverflow.com/questions/39934981/confused-about-haskell-number-types", "title": "Confused about Haskell number types", "body": "<p>I'm trying to create a <code>foldr</code> example that converts an <code>Integral</code> to a list of digits (i.e., <code>[Int]</code>).</p>\n\n<pre><code>pickDigit num pos = (num `div` (10^pos)) `mod` 10\n\ntoDigits num = foldr (\\pos acc -&gt; (pickDigit num pos):acc) [] [0 .. floor (logBase 10 num)]\n</code></pre>\n\n<p>This loads successfully. But when I try to run it, for example </p>\n\n<pre><code>&gt; toDigits 1234\n</code></pre>\n\n<p>I get a type error message I don't understand.</p>\n\n<p>When I ask Haskell for the types of the loaded code and explicitly include those types in the source file, I get error messages on loading. When I try to explicitly restrict the types to <code>Integer</code> or <code>Int</code>, I get more error messages. </p>\n\n<p>I'd appreciate some suggestions.  Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1475942211, "post_id": 39933894, "comment_id": 67150656, "body": "Oh wow!!! This worked perfectly. Thank you so much! Just to be sure, I can do arbitrary IO with this function right??, i..e writing / reading from files etc. I mean we are not restricted to printing to the terminal?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1475950194, "post_id": 39933894, "comment_id": 67153256, "body": "@smilingbuddha You <i>can</i> but remember that you have little control over how the callback function is called. If you need to actually manage real resources inside your game (not just printing to stdout) you should do so within a thread started outside of the gloss runtime."}], "tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 3, "last_activity_date": 1475941795, "last_edit_date": 1475941795, "creation_date": 1475939003, "answer_id": 39933894, "question_id": 39933753, "link": "https://stackoverflow.com/questions/39933753/how-to-print-to-the-terminal-in-this-haskell-code/39933894#39933894", "title": "How to print to the terminal in this Haskell code?", "body": "<p>You are using the pure version of <code>play</code>.  If you want to do IO in the event handler, you must use <code>Graphics.Gloss.Interface.IO.Game.playIO</code>.  With that, the event handler has type</p>\n\n<pre><code>Event -&gt; world -&gt; IO world\n</code></pre>\n\n<p>Which takes a pure <code>world</code>, and returns an <code>IO</code> action that will be executed.</p>\n\n<p>Note that this will also require your drawing and step functions to return <code>IO</code> actions as well (<code>(return . const Blank)</code>, and <code>(return . const id)</code> respectively).  Also, you must no longer <code>return</code> your initial world into <code>IO</code>.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "accepted_answer_id": 39933894, "answer_count": 1, "score": 2, "last_activity_date": 1475941795, "creation_date": 1475938017, "question_id": 39933753, "link": "https://stackoverflow.com/questions/39933753/how-to-print-to-the-terminal-in-this-haskell-code", "title": "How to print to the terminal in this Haskell code?", "body": "<p>I am trying to get a simulation running with Gloss in Haskell. </p>\n\n<p>I tried writing a simple script where I want to print \"Clicked!\" to the terminal every time I click anywhere on the Gloss canvas. The world I pass to the Gloss' play function, is an IO action so I can enable printing to the terminal in response to events.</p>\n\n<p>However, nothing prints to the terminal! :-(</p>\n\n<pre><code>module Main where\nimport Graphics.Gloss\nimport Graphics.Gloss.Interface.Pure.Game\nimport System.IO.Unsafe\n\ndata World  = World { test :: String\n                   } deriving (Show)\n\nmain :: IO ()\nmain = do\n          let initialioWorld   = return World{test=\"\"} :: IO World\n          let windowSize      = (1800,1800)\n          let windowPosition  = (0,0)\n          let backgroundColor = orange\n          let framesPerSecond = 20\n          play (InWindow \"\" windowSize windowPosition) backgroundColor framesPerSecond\n                initialioWorld ( const Blank ) handleEvent  (const id)\n\n\nhandleEvent :: Event -&gt; IO World  -&gt; IO World\nhandleEvent event ioworld\n\n | (EventKey (MouseButton LeftButton) Down _ (x,y)) &lt;- event,\n               World str &lt;- unsafePerformIO ioworld\n   = do\n       putStrLn \"Clicked!\"\n       return (World str)\n\n | otherwise = ioworld\n</code></pre>\n\n<p>Now I understand, what Haskell is probably doing is just <em>evaluating</em> that IO action and NOT <em>executing</em> it, and that this has something to do with Haskell's laziness. </p>\n\n<p>So how do I force printing to the terminal in this case? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475936127, "post_id": 39933396, "comment_id": 67148635, "body": "basically I am trying to find the second largest number in a list and finding this I do not understand what it is doing."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1475936265, "post_id": 39933396, "comment_id": 67148676, "body": "It&#39;ll return the second biggest element of a list. For example, given <code>[1,2,3,4,5]</code> it will return <code>4</code>."}, {"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1475943738, "post_id": 39933396, "comment_id": 67151108, "body": "I posted the new code I have now but it does not work with things that have duplicates."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1475957821, "post_id": 39933396, "comment_id": 67155683, "body": "&quot;Unable to sort&quot; and unwilling to use an import. Huh. I guess this is homework, then? You should probably try to find a way to do it yourself. Tip: you can calculate the <code>n-1</code>th order statistic in a single pass over the list. I challenge you to do so. An extra challenge: write it as a fold."}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475936640, "post_id": 39933492, "comment_id": 67148796, "body": "Perfect explanation for me. Thank you very much"}, {"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475936756, "post_id": 39933492, "comment_id": 67148837, "body": "what would happen lets say if the list was [1,2,3,4,5,5], the second 5 should be the second largest in the list but since it filters everything less than 5 it would be missed."}, {"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475936796, "post_id": 39933492, "comment_id": 67148853, "body": "and if you changed the &lt; to &lt;= it would then not work in the first situation where the list is [1,2,3,4,5] as it would return 5"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475937045, "post_id": 39933492, "comment_id": 67148944, "body": "It always finds the second largest element in the list. In the list <code>[1,2,3,4,5,5]</code> the second largest element is <code>4</code> and not <code>5</code>. It doesn&#39;t matter whether you have just one <code>5</code> or a million, the second largest element is always <code>4</code>."}, {"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "reply_to_user": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475937187, "post_id": 39933492, "comment_id": 67149001, "body": "@Juscallmesteve It still works if you think of &quot;second largest&quot; as speaking about the mathematical ordering of integers, i.e. 4 is still the second-largest integer in the list as the two 5s are the same integer. If you want to account for duplicates, perhaps you should sort the list from largest to smallest and take the second element (if it exists)."}, {"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475937285, "post_id": 39933492, "comment_id": 67149025, "body": "would it be possible to do something like     if maximum xs = f xs, then remove that one instance of the max and then just return the max of the new list?"}, {"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "reply_to_user": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475938779, "post_id": 39933492, "comment_id": 67149506, "body": "@Juscallmesteve See my answer regarding that."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 4, "last_activity_date": 1475936497, "creation_date": 1475936497, "answer_id": 39933492, "question_id": 39933396, "link": "https://stackoverflow.com/questions/39933396/can-someone-explain-this-simple-haskell-code-to-me-in-detail/39933492#39933492", "title": "Can someone explain this simple Haskell code to me in detail", "body": "<p>It's really simple:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f xs = maximum . filter (&lt; maximum xs) $ xs\n</code></pre>\n\n<p>Let's suppose <code>xs = [1,2,3,4,5]</code>. Hence, <code>maximum xs = 5</code>. Thus, we have:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f [1,2,3,4,5] = maximum . filter (&lt; 5) $ [1,2,3,4,5]\n</code></pre>\n\n<p>Next, we filter out all the elements less than <code>5</code>. Hence we get:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f [1,2,3,4,5] = maximum $ [1,2,3,4] -- notice that 5 is no more in the list\n</code></pre>\n\n<p>Finally, we get the maximum of the remaining elements:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f [1,2,3,4,5] = 4\n</code></pre>\n\n<p>This happens to be the second largest element of the original list.</p>\n"}, {"tags": [], "owner": {"reputation": 2399, "user_id": 3065657, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XDEr0.jpg?s=128&g=1", "display_name": "lycuid", "link": "https://stackoverflow.com/users/3065657/lycuid"}, "is_accepted": false, "score": 1, "last_activity_date": 1475936512, "creation_date": 1475936512, "answer_id": 39933496, "question_id": 39933396, "link": "https://stackoverflow.com/questions/39933396/can-someone-explain-this-simple-haskell-code-to-me-in-detail/39933496#39933496", "title": "Can someone explain this simple Haskell code to me in detail", "body": "<p>It finds the second largest number from a array <code>xs</code>, to break it down.</p>\n\n<pre><code>let xs = [1, 2, 3, 4]\nlet a = filter (&lt; maximum xs) xs\n-- a is an array of all elements from 'xs' except of the max elem of 'xs'\n-- which is [1, 2, 3]\n\nlet b = maximum (a) -- gets the largest elem of a\n--  b is th largest element of 'a'\n-- which is 3\n</code></pre>\n\n<p>and applying <code>maximum</code> on that gives the second largest <code>elem</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475941061, "post_id": 39933852, "comment_id": 67150284, "body": "I am not able to use import in the program. Other than that your program is flawless"}, {"owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "edited": false, "score": 0, "creation_date": 1475943068, "post_id": 39933852, "comment_id": 67150897, "body": "Any idea how to go about this without using an import?"}], "tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": false, "score": 3, "last_activity_date": 1475953746, "last_edit_date": 1475953746, "creation_date": 1475938743, "answer_id": 39933852, "question_id": 39933396, "link": "https://stackoverflow.com/questions/39933396/can-someone-explain-this-simple-haskell-code-to-me-in-detail/39933852#39933852", "title": "Can someone explain this simple Haskell code to me in detail", "body": "<p>If you want to account for duplicates as you've asked in the comments, you can use <code>Data.List.delete</code> instead of <code>filter</code> to remove the largest element. This will only remove a single instance of it:</p>\n\n<pre><code>import Data.List (delete)\n\nf xs = maximum . delete (maximum xs) $ xs\n</code></pre>\n\n<p>This yields:</p>\n\n<pre><code>\u03bb. f [1,2,3,4,5]\n4\n\u03bb. f [1,2,3,4,5,5]\n5\n</code></pre>\n\n<p>Of course, this only works for lists of length 2 or longer. If you want to account for all cases so the function is total, you can do something like this:</p>\n\n<pre><code>f xs | length xs &gt;= 2 = maximum . delete (maximum xs) $ xs\n     | null xs        = 0   -- default case when the list is empty\n     | otherwise      = maximum xs\n</code></pre>\n\n<p>To do it without the import, you can implement <code>delete</code> by hand:</p>\n\n<pre><code>delete :: Eq a =&gt; a -&gt; [a] -&gt; [a]\ndelete x [] = []\ndelete x (y:ys) | x == y    = ys\n                | otherwise = y : delete x ys\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 6870670, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4bd2aa029e6cc1c9a91b249c1c829926?s=128&d=identicon&r=PG&f=1", "display_name": "Juscallmesteve", "link": "https://stackoverflow.com/users/6870670/juscallmesteve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 39933492, "answer_count": 3, "score": 2, "last_activity_date": 1475953746, "creation_date": 1475935864, "last_edit_date": 1475941250, "question_id": 39933396, "link": "https://stackoverflow.com/questions/39933396/can-someone-explain-this-simple-haskell-code-to-me-in-detail", "title": "Can someone explain this simple Haskell code to me in detail", "body": "<p>I found this on a really old post and did not want to ask there because it might never get answered.</p>\n\n<pre><code>f xs = maximum . filter (&lt; maximum xs) $ xs\n</code></pre>\n\n<p>It looks to me like it is </p>\n\n<ul>\n<li>taking the maximum of a filtered list</li>\n<li>that is less than the maximum of the list</li>\n</ul>\n\n<p>&#x200B;</p>\n\n<pre><code>secondLargest :: (Num a, Ord a) =&gt; [a] -&gt; a\nsecondLargest [] = error \"Empty List\"\nsecondLargest [x] = error \"Empty List\"\nsecondLargest xs\n    | ((maximum . filter (&lt; maximum xs) $ xs) &gt;= (maximum xs)) = maximum xs\n    | otherwise = (maximum . filter (&lt; maximum xs) $ xs)\n</code></pre>\n\n<p>the code above is what I am working with now. Basically I am unable to sort the list and the code above finds the second largest element as long as the largest and the second largest are not the same.</p>\n\n<p>would anyone be able to help shed some light?</p>\n"}, {"tags": ["haskell", "streaming", "bytestring", "haskell-pipes", "bytestream"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475940819, "post_id": 39932707, "comment_id": 67150215, "body": "Is the demo program supposed to divide the whole input into 4 byte chunks and yield the word32s?"}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475942442, "post_id": 39932707, "comment_id": 67150712, "body": "Yes it is. The broader goal is to read Word32s and variably-sized blobs (lazy ByteStrings)."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1475951701, "post_id": 39932707, "comment_id": 67153736, "body": "Unrelated, but for simple arg parsing I would write <code>filename : _ &lt;- getArgs</code> instead of <code>filename &lt;- fmap (!!0) getArgs</code>."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1475992062, "post_id": 39932707, "comment_id": 67162038, "body": "@danidiaz yes indeed. Or how about <code>head &lt;$&gt; getArgs</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1475997729, "post_id": 39935983, "comment_id": 67163106, "body": "Oh I see, &quot;... in the current monadic binding&quot;, that explains it. Thank you.   I plugged in the <code>transform</code> as you suggest and it works, but it consumes vast amounts of memory (~500MB memory for a 35MB file). It seems the laziness is lost when using <code>Data.Conduit.List</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "edited": false, "score": 0, "creation_date": 1476013815, "post_id": 39935983, "comment_id": 67166937, "body": "@mcmayer That&#39;s pretty much it. The rule of thumb is that when using streaming libraries you shouldn&#39;t collect your output in a list (as with <code>outputToList</code> in the bad <i>io-streams</i> example you added in the edit), as you really don&#39;t want that to happen if there are lots of output. Rather, you should use the appropriate streaming consumer (or &quot;sink&quot;, in the <i>conduit</i> terminology). Michael&#39;s answer shows the gist of doing that with <i>pipes</i> (the consumer being <code>P.print</code> in his demo); a <i>conduit</i> solution would be analogous."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1475953076, "last_edit_date": 1475953076, "creation_date": 1475951895, "answer_id": 39935983, "question_id": 39932707, "link": "https://stackoverflow.com/questions/39932707/efficient-streaming-and-manipulation-of-a-byte-stream-in-haskell/39935983#39935983", "title": "Efficient streaming and manipulation of a byte stream in Haskell", "body": "<p>Your immediate problem is caused by how you are using <a href=\"https://hackage.haskell.org/package/conduit-1.2.8/docs/Data-Conduit.html#v:leftover\" rel=\"nofollow\"><code>leftover</code></a>. That function is used to \"Provide a single piece of leftover input to be consumed by the next component in the current monadic binding\", and so when you give it <code>bs</code> before looping with <code>transform</code> you are effectively throwing away the rest of the bytestring (i.e. what is after <code>bs</code>).</p>\n\n<p>A correct solution based on your code would use <a href=\"https://hackage.haskell.org/package/binary-0.8.4.1/docs/Data-Binary-Get.html#g:3\" rel=\"nofollow\">the incremental input interface</a> of <code>Data.Binary.Get</code> to replace your <code>yield</code>/<code>leftover</code> combination with something that consumes each chunk fully. A more pragmatic approach, though, is using the <em>binary-conduit</em> package, which provides that in the shape of <a href=\"https://hackage.haskell.org/package/binary-conduit-1.2.4.1/docs/Data-Conduit-Serialization-Binary.html#v:conduitGet\" rel=\"nofollow\"><code>conduitGet</code></a> (its <a href=\"https://hackage.haskell.org/package/binary-conduit-1.2.4.1/docs/src/Data-Conduit-Serialization-Binary.html#conduitGet\" rel=\"nofollow\">source</a> gives a good idea of what a \"manual\" implementation would look like):</p>\n\n<pre><code>import           Data.Conduit.Serialization.Binary\n\n-- etc.\n\ntransform :: (Monad m, MonadResource m) =&gt; Conduit BS.ByteString m Word32\ntransform = conduitGet G.getWord32be\n</code></pre>\n\n<p>One caveat is that this will throw a parse error if the total number of bytes is not a multiple of 4 (i.e. the last <code>Word32</code> is incomplete). In the unlikely case of that not being what you want, a lazy way out would be simply using <code>\\bs -&gt; C.take (4 * truncate (C.length bs / 4)) bs</code> on the input bytestring.</p>\n"}, {"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 3, "last_activity_date": 1475964129, "last_edit_date": 1475964129, "creation_date": 1475958795, "answer_id": 39937094, "question_id": 39932707, "link": "https://stackoverflow.com/questions/39932707/efficient-streaming-and-manipulation-of-a-byte-stream-in-haskell/39937094#39937094", "title": "Efficient streaming and manipulation of a byte stream in Haskell", "body": "<p>With <code>pipes</code> (and <code>pipes-group</code> and <code>pipes-bytestring</code>) the demo problem reduces to combinators. First we resolve the incoming undifferentiated byte stream into little 4 byte chunks:</p>\n\n<pre><code>chunksOfStrict :: (Monad m) =&gt; Int -&gt; Producer ByteString m r -&gt; Producer ByteString m r\nchunksOfStrict n = folds mappend mempty id . view (Bytes.chunksOf n) \n</code></pre>\n\n<p>then we map these to <code>Word32</code>s and (here) count them.</p>\n\n<pre><code>main :: IO ()\nmain = do\n   filename:_ &lt;- getArgs\n   IO.withFile filename IO.ReadMode $ \\h -&gt; do\n     n &lt;- P.length $ chunksOfStrict 4 (Bytes.fromHandle h) &gt;-&gt; P.map getWord32\n     print n\n</code></pre>\n\n<p>This will fail if we have less than 4 bytes or otherwise fail to parse but we can as well map with </p>\n\n<pre><code>getMaybeWord32 :: ByteString -&gt; Maybe Word32\ngetMaybeWord32 bs = case  G.runGetOrFail G.getWord32be $ BL.fromStrict bs of\n  Left r -&gt; Nothing\n  Right (_, off, w32) -&gt; Just w32\n</code></pre>\n\n<p>The following program will then print the parses for the valid 4 byte sequences</p>\n\n<pre><code>main :: IO ()\nmain = do\n   filename:_ &lt;- getArgs\n   IO.withFile filename IO.ReadMode $ \\h -&gt; do\n     runEffect $ chunksOfStrict 4 (Bytes.fromHandle h) \n                 &gt;-&gt; P.map getMaybeWord32\n                 &gt;-&gt; P.concat  -- here `concat` eliminates maybes\n                 &gt;-&gt; P.print \n</code></pre>\n\n<p>There are other ways of dealing with failed parses, of course.</p>\n\n<p>Here, though, is something closer to the program you asked for. It takes a four byte segment from a byte stream (<code>Producer ByteString m r</code>) and reads it as a <code>Word32</code> if it is long enough; it then takes <em>that many</em> of the incoming bytes and accumulates them into a lazy bytestring, yielding it. It just repeats this until it runs out of bytes. In <code>main</code> below, I print each yielded lazy bytestring that is produced:</p>\n\n<pre><code>module Main (main) where \nimport Pipes \nimport qualified Pipes.Prelude as P\nimport Pipes.Group (folds) \nimport qualified Pipes.ByteString as Bytes ( splitAt, fromHandle, chunksOf )\nimport Control.Lens ( view ) -- or Lens.Simple (view) -- or Lens.Micro ((.^))\nimport qualified System.IO as IO ( IOMode(ReadMode), withFile )\nimport qualified Data.Binary.Get as G ( runGet, getWord32be )\nimport Data.ByteString ( ByteString )\nimport qualified Data.ByteString.Lazy.Char8 as BL \nimport System.Environment ( getArgs )\n\nsplitLazy :: (Monad m, Integral n) =&gt;\n   n -&gt; Producer ByteString m r -&gt; m (BL.ByteString, Producer ByteString m r)\nsplitLazy n bs = do\n  (bss, rest) &lt;- P.toListM' $ view (Bytes.splitAt n) bs\n  return (BL.fromChunks bss, rest)\n\nmeasureChunks :: Monad m =&gt; Producer ByteString m r -&gt; Producer BL.ByteString m r\nmeasureChunks bs = do\n (lbs, rest) &lt;- lift $ splitLazy 4 bs\n if BL.length lbs /= 4\n   then rest &gt;-&gt; P.drain -- in fact it will be empty\n   else do\n     let w32 = G.runGet G.getWord32be lbs\n     (lbs', rest') &lt;- lift $ splitLazy w32 bs\n     yield lbs\n     measureChunks rest\n\nmain :: IO ()\nmain = do\n  filename:_ &lt;- getArgs\n  IO.withFile filename IO.ReadMode $ \\h -&gt; do\n     runEffect $ measureChunks (Bytes.fromHandle h) &gt;-&gt; P.print\n</code></pre>\n\n<p>This is again crude in that it uses <code>runGet</code> not <code>runGetOrFail</code>, but this is easily repaired. The pipes standard procedure would be to stop the stream transformation on a failed parse and return the unparsed bytestream. </p>\n\n<p>If you were anticipating that the <code>Word32s</code> were for large numbers, so that you did not want to accumulate the corresponding stream of bytes as a lazy bytestring, but say write them to different files without accumulating, we could change the program pretty easily to do that. This would require a sophisticated use of conduit but is the preferred approach with <code>pipes</code> and <code>streaming</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476109020, "post_id": 39959731, "comment_id": 67200337, "body": "Right, this is conceptually very close to what you would do with <code>pipes-parse</code> which uses <code>StateT (Producer ByteString m x) m r</code> to consume a byte stream (= <code>Producer ByteString m r</code>) bit by bit. If you change this a bit, you might end up accumulating the list of lazy bytestrings again."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476110604, "post_id": 39959731, "comment_id": 67201390, "body": "Note also that you are sort of re-writing <code>unfoldr</code>, which takes an argument close to the one you have hidden in <code>State</code>, <code>(s -&gt; Maybe (a, s)) -&gt; s -&gt; [a])</code>. <code>unfoldr</code> corresponds to this mix of <code>whileMaybe</code> and <code>State</code>. Here&#39;s a pipes equivalent that expressly uses <code>Pipes.Prelude.unfoldr</code> (which uses Either instead of Maybe to keep the final return value) sprunge.us/GcjM You can see the features of the step function match the ones you are writing, modulo various pipes features."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476110851, "post_id": 39959731, "comment_id": 67201549, "body": "Here&#39;s a variant of the unfoldr approach using the <code>streaming</code> + <code>streaming-bytestring</code> libraries, which just isolate this non-piping aspect of pipes and make it easier to use. <a href=\"http://sprunge.us/QKCQ\" rel=\"nofollow noreferrer\">sprunge.us/QKCQ</a> <code>streaming-bytestring</code> is supposed to be as close to a lazy bytestring as can be, while properly streaming, with IO between the internal chunks. It would be very easy to alter this so that the segments are not accumulated as lazy bytestrings but can be separately written chunkwise to separate files or sent out some other way."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476113494, "post_id": 39959731, "comment_id": 67203283, "body": "What really puzzles me - with all approaches - is why this does not perform near the limitation of disk I/O. Disk is the bottleneck, the computations themselves are rather trivial. So far my explanation is that the GC shuffles around vast amounts of RAM... (The profiler says so.) But I find this conclusion odd. Outside GPUs I&#39;ve never had RAM speed as the bottleneck."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476114097, "post_id": 39959731, "comment_id": 67203670, "body": "What arguments are you passing to ghc? What is the file like that you are reading?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476114845, "post_id": 39959731, "comment_id": 67204069, "body": "A program like yours, which basically counts the number of segments in a long file, could certainly be written much more cheaply with a simple loop and hSeek or the like. So could a program that e.g. writes each segment to a different file. The streaming IO libraries accept different costs in order to make this all very plastic and high level. Pipes and conduit wrap each chunk in a free monad step; io-streams puts each chunk in an IORef before proceeding, etc. etc."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476115897, "post_id": 39959731, "comment_id": 67204651, "body": "Yes, I&#39;ve been thinking about going more low level to avoid all the overhead. I use <code>-threaded -O2</code>. The data is a concatenation of &#39;blobs&#39; of random content and random size in 1..256. For example, with my <code>whileJust</code> <code>splitAt</code> version I see 10GB bytes allocated in the heap for a 1GB file - neither disk nor CPU are anywhere near max - very weird. (GC is actually not that busy - 12 MB &quot;copied during GC&quot;)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476130351, "post_id": 39959731, "comment_id": 67211886, "body": "The <code>pipes</code> and <code>streaming</code> programs do seem to be doing pretty much the same as your state+lazy bytestring program. I tried them all with a 2gb file I arranged to contain 63471 &#39;lazy bytestrings&#39;, and got very close to 0m0.487s for each (with <code>-O2</code> but no <code>-threaded</code>). They strike me as comparatively &#39;normal&#39; and well behaved."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476199440, "post_id": 39959731, "comment_id": 67240271, "body": "I get a similar result for long lazy bytestrings. But when I make them <a href=\"http://sprunge.us/ABWJ\" rel=\"nofollow noreferrer\">shorter</a>, e.g. 100 bytes long, the performance degrades significantly. I have the <a href=\"http://sprunge.us/CNNX\" rel=\"nofollow noreferrer\">impression</a> that the performance correlates with the number of bytes allocated in the heap."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476302456, "post_id": 39959731, "comment_id": 67292670, "body": "I&#39;m not knowledgeable about the meaning of the total bytes allocated figure. If I make my 2 gigabyte file out of fragments 100 bytes long, then program isolates 20000000 fragments, which is 315 times as many fragments, but takes 10 times as long. There is a lot more calculation, of course. I don&#39;t think there&#39;s a whole lot more in memory at each moment. Lazy bytestring readFile &amp; co make a new &#39;foreign pointer&#39; for each 32k chunk. The &quot;parsing&quot; doesn&#39;t make new chunks but at each step defines different offsets. At a boundary it will need to make a 2 chunk bytestring, no more I think."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1476493410, "post_id": 39959731, "comment_id": 67383649, "body": "Here is some recent discussion of profiling statistics <a href=\"http://stackoverflow.com/questions/40044364/making-sense-from-ghc-profiler\" title=\"making sense from ghc profiler\">stackoverflow.com/questions/40044364/&hellip;</a> from hyper-knowledgeable people."}], "tags": [], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "is_accepted": false, "score": 1, "last_activity_date": 1476116648, "last_edit_date": 1476116648, "creation_date": 1476106984, "answer_id": 39959731, "question_id": 39932707, "link": "https://stackoverflow.com/questions/39932707/efficient-streaming-and-manipulation-of-a-byte-stream-in-haskell/39959731#39959731", "title": "Efficient streaming and manipulation of a byte stream in Haskell", "body": "<p>Here's a relatively straightforward solution that I want to throw into the ring. It's a repeated use of <code>splitAt</code> wrapped into a <code>State</code> monad that gives an interface identical to (a subset of) <code>Data.Binary.Get</code>. The resulting <code>[ByteString]</code> is obtained in <code>main</code> with a <code>whileJust</code> over <code>getBlob</code>. </p>\n\n<pre><code>module Main (main) where\n\nimport           Control.Monad.Loops\nimport           Control.Monad.State\nimport qualified Data.Binary.Get      as G (getWord32be, runGet)\nimport qualified Data.ByteString.Lazy as BL\nimport           Data.Int             (Int64)\nimport           Data.Word            (Word32)\nimport           System.Environment   (getArgs)\n\n-- this is going to mimic the Data.Binary.Get.Get Monad\ntype Get = State BL.ByteString\n\ngetWord32be :: Get (Maybe Word32)\ngetWord32be = state $ \\bs -&gt; do\n    let (w, rest) = BL.splitAt 4 bs\n    case BL.length w of\n        4 -&gt; (Just w', rest) where\n            w' = G.runGet G.getWord32be w\n        _ -&gt; (Nothing, BL.empty)\n\ngetLazyByteString :: Int64 -&gt; Get BL.ByteString\ngetLazyByteString n = state $ \\bs -&gt; BL.splitAt n bs\n\ngetBlob :: Get (Maybe BL.ByteString)\ngetBlob = do\n    ml &lt;- getWord32be\n    case ml of\n        Nothing -&gt; return Nothing\n        Just l -&gt; do\n            blob &lt;- getLazyByteString (fromIntegral l :: Int64)\n            return $ Just blob\n\nrunGet :: Get a -&gt; BL.ByteString -&gt; a\nrunGet g bs = fst $ runState g bs\n\nmain :: IO ()\nmain = do\n    fname &lt;- head &lt;$&gt; getArgs\n    bs &lt;- BL.readFile fname\n    let ls = runGet loop bs where\n        loop = whileJust getBlob return\n    print $ length ls\n</code></pre>\n\n<p>There's no error handling in <code>getBlob</code>, but it's easy to extend. Time and space complexity is quite good, as long as the resulting list is used carefully. (The python script that creates some random data for consumption by the above is <a href=\"http://sprunge.us/ABWJ\" rel=\"nofollow\">here</a>).</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1476116648, "creation_date": 1475931919, "last_edit_date": 1475995912, "question_id": 39932707, "link": "https://stackoverflow.com/questions/39932707/efficient-streaming-and-manipulation-of-a-byte-stream-in-haskell", "title": "Efficient streaming and manipulation of a byte stream in Haskell", "body": "<p>While writing a deserialiser for a large <code>(&lt;bloblength&gt;&lt;blob&gt;)*</code> encoded binary file I got stuck with the various Haskell produce-transform-consume libraries. So far I'm aware of four streaming libraries:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/conduit-1.2.8/docs/Data-Conduit.html\" rel=\"nofollow\">Data.Conduit</a>: Widely used, has very careful resource management</li>\n<li><a href=\"https://hackage.haskell.org/package/pipes-4.2.0/docs/Pipes.html\" rel=\"nofollow\">Pipes</a>: Similar to <code>conduit</code> (<a href=\"https://www.youtube.com/watch?v=Qn2Oc4vWoGg\" rel=\"nofollow\">Haskell Cast #6</a> nicely reveals the differences between <code>conduit</code> and <code>pipes</code>)</li>\n<li><a href=\"https://hackage.haskell.org/package/binary-0.8.4.1/docs/Data-Binary-Get.html\" rel=\"nofollow\">Data.Binary.Get</a>: Offers useful functions such as getWord32be, but the streaming example is awkward</li>\n<li><a href=\"https://hackage.haskell.org/package/io-streams-1.3.5.0/docs/System-IO-Streams.html\" rel=\"nofollow\">System.IO.Streams</a>: Seems to be the easiest one to use</li>\n</ul>\n\n<p>Here's a stripped down example of where things go wrong when I try to do <code>Word32</code> streaming with <code>conduit</code>. A slightly more realistic emample would first read a <code>Word32</code> that determines the blob length and then yield a lazy <code>ByteString</code> of that length (which is then deserialised further).\nBut here I just try to extract Word32's in streaming fashion from a binary file:</p>\n\n<pre><code>module Main where\n\n-- build-depends: bytestring, conduit, conduit-extra, resourcet, binary\n\nimport           Control.Monad.Trans.Resource (MonadResource, runResourceT)\nimport qualified Data.Binary.Get              as G\nimport qualified Data.ByteString              as BS\nimport qualified Data.ByteString.Char8        as C\nimport qualified Data.ByteString.Lazy         as BL\nimport           Data.Conduit\nimport qualified Data.Conduit.Binary          as CB\nimport qualified Data.Conduit.List            as CL\nimport           Data.Word                    (Word32)\nimport           System.Environment           (getArgs)\n\n-- gets a Word32 from a ByteString.\ngetWord32 :: C.ByteString -&gt; Word32\ngetWord32 bs = do\n    G.runGet G.getWord32be $ BL.fromStrict bs\n\n-- should read BytesString and return Word32\ntransform :: (Monad m, MonadResource m) =&gt; Conduit BS.ByteString m Word32\ntransform = do\n    mbs &lt;- await\n    case mbs of\n        Just bs -&gt; do\n            case C.null bs of\n                False -&gt; do\n                    yield $ getWord32 bs\n                    leftover $ BS.drop 4 bs\n                    transform\n                True -&gt; return ()\n        Nothing -&gt; return ()\n\nmain :: IO ()\nmain = do\n    filename &lt;- fmap (!!0) getArgs  -- should check length getArgs\n    result &lt;- runResourceT $ (CB.sourceFile filename) $$ transform =$ CL.consume\n    print $ length result   -- is always 8188 for files larger than 32752 bytes\n</code></pre>\n\n<p>The output of the program is just the number of Word32's that were read. It turns out the stream terminates after reading the first chunk (about 32KiB). For some reason <code>mbs</code> is never <code>Nothing</code>, so I must check <code>null bs</code> which stops the stream when the chunk is consumed. Clearly, my conduit <code>transform</code> is faulty. I see two routes to a solution:</p>\n\n<ol>\n<li>The <code>await</code> doesn't want to go to the second chunk of the <code>ByteStream</code>, so is there another function that pulls the next chunk? In examples I've seen (e.g.  <a href=\"https://voyageintech.wordpress.com/2015/03/17/intro-to-haskells-conduit-library-conduit-101/\" rel=\"nofollow\">Conduit 101</a>) this is not how it's done</li>\n<li>This is just the wrong way to set up <code>transform</code>.</li>\n</ol>\n\n<p>How is this done properly? Is this the right way to go?  (Performance does matter.)</p>\n\n<p>Update: Here's a <strong>BAD</strong> way to do it using <code>Systems.IO.Streams</code>:</p>\n\n<pre><code>module Main where\n\nimport           Data.Word                (Word32)\nimport           System.Environment       (getArgs)\nimport           System.IO                (IOMode (ReadMode), openFile)\nimport qualified System.IO.Streams        as S\nimport           System.IO.Streams.Binary (binaryInputStream)\nimport           System.IO.Streams.List   (outputToList)\n\nmain :: IO ()\nmain = do\n    filename : _ &lt;- getArgs\n    h &lt;- openFile filename ReadMode\n    s &lt;- S.handleToInputStream h\n    i &lt;- binaryInputStream s :: IO (S.InputStream Word32)\n    r &lt;- outputToList $ S.connect i\n    print $ last r\n</code></pre>\n\n<p>'Bad' means: Very demanding in time and space, does not handle Decode exception.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "is_accepted": true, "score": 3, "last_activity_date": 1475963117, "last_edit_date": 1475963117, "creation_date": 1475931652, "answer_id": 39932664, "question_id": 39931452, "link": "https://stackoverflow.com/questions/39931452/encoding-a-state-machine-which-its-nodes-can-be-other-nested-machines/39932664#39932664", "title": "Encoding a state machine which its nodes can be other nested machines", "body": "<p>You don't need pattern match. As I understood, all you need is perform step and serialize/deserialize. This can be done without knowing exact type.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE UnicodeSyntax #-}\n{-# OPTIONS_GHC -fno-warn-tabs #-}\n\nmodule States (\n    ) where\n\nimport Prelude.Unicode\n\nimport Control.Arrow\nimport Text.Read (Read(readsPrec), readMaybe)\n\n-- | State is something, which have next action and string representation\ndata State = State {\n    next \u2237 Cont,\n    save \u2237 String }\n\ninstance Show State where\n    show = save\n\n-- | Stack is list of states\ntype Stack = [State]\n\n-- | Action operates on 'State'\ndata Cont = Cont State | Start State State | End State deriving (Show)\n\n-- | Converts actual data to 'State'\ncont \u2237 IsState s \u21d2 s \u2192 Cont\ncont = Cont \u2218 state\n\nstart \u2237 (IsState s, IsState s') \u21d2 s \u2192 s' \u2192 Cont\nstart x x' = Start (state x) (state x')\n\nend \u2237 IsState s \u21d2 s \u2192 Cont\nend = End \u2218 state\n\nrun \u2237 Stack \u2192 Stack\nrun [] = error \"empty stack\"\nrun (s : ss) = proceed (next s) ss\n\nproceed \u2237 Cont \u2192 Stack \u2192 Stack\nproceed (Cont s) rest = s : rest\nproceed (Start s s') rest = s' : s : rest\nproceed (End s) rest = rest\n\nserialize \u2237 Stack \u2192 [String]\nserialize = map save\n\n-- | Here we have to provide some type in order to know, which\n-- read functions to use\ndeserialize \u2237 IsState s \u21d2 [String] \u2192 Maybe [s]\ndeserialize = mapM readMaybe\n\nclass (Read s, Show s) \u21d2 IsState s where\n    step \u2237 s \u2192 Cont\n    -- | No need of implementation, just to allow using when implementing step\n    state \u2237 s \u2192 State\n    state x = State (step x) (show x)\n\n-- | Convert actual data to stack\nstack \u2237 IsState s \u21d2 [s] \u2192 Stack\nstack = map state\n\n-- | Union of states, to specify type of 'deserialize'\ndata BiState l r = LState l | RState r\n\ninstance (Read l, Read r) \u21d2 Read (BiState l r) where\n    readsPrec p s = map (first LState) (readsPrec p s) ++ map (first RState) (readsPrec p s)\n\ninstance (Show l, Show r) \u21d2 Show (BiState l r) where\n    show (LState x) = show x\n    show (RState y) = show y\n\ninstance (IsState l, IsState r) \u21d2 IsState (BiState l r) where\n    step (LState x) = step x\n    step (RState y) = step y\n\n-- Test data\n\ndata BarState = BInit | BMid | BEnd deriving (Read, Show)\ndata FooState = FInit | FBar | FEnd deriving (Read, Show)\n\ninstance IsState BarState where\n    step BInit = cont BMid\n    step BMid = end BEnd\n\ninstance IsState FooState where\n    step FInit = start FBar BInit\n    step FBar = end FEnd\n\n-- Usage\n\ntest' \u2237 IO ()\ntest' = do\n    let\n        start' = [state FInit]\n        next' = run start'\n    print next' -- [BInit,FBar]\n    let\n        saved' = serialize next'\n        Just loaded' = deserialize saved' \u2237 Maybe [BiState FooState BarState]\n        next'' = run next'\n    print next'' -- [BMid,FBar]\n    print $ run $ stack loaded' -- [BMid,FBar] too\n    let\n        go [] = putStrLn \"done!\"\n        go st = print st' &gt;&gt; go st' where\n            st' = run st\n    go next''\n\n-- output:\n-- [BInit,FBar]\n-- [BMid,FBar]\n-- [BMid,FBar]\n-- [FBar]\n-- []\n-- done!\n</code></pre>\n"}], "owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 39932664, "answer_count": 1, "score": 3, "last_activity_date": 1475963117, "creation_date": 1475923582, "last_edit_date": 1475962589, "question_id": 39931452, "link": "https://stackoverflow.com/questions/39931452/encoding-a-state-machine-which-its-nodes-can-be-other-nested-machines", "title": "Encoding a state machine which its nodes can be other nested machines", "body": "<p>I'm trying to model a state machine which its nodes can be other machines with call stacks in Haskell.</p>\n\n<p>For example <code>Bar</code> is a fairly simple machine that is encoded by</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Bar (BarState(..), run) where\nimport Cont\n\ndata BarState = BInit | BMid | BEnd deriving Show\n\nrun BInit = Cont BMid\nrun BMid = End BEnd\n</code></pre>\n\n<p><code>Cont</code> type describes state transitions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Cont (Cont(..)) where\n\ndata Cont where\n  -- continue in the same machine\n  Cont  :: Show s =&gt; s -&gt; Cont\n\n  -- fork a new machine\n  Start :: (Show s, Show s') =&gt; s -&gt; s' -&gt; Cont\n\n  -- final state\n  End   :: Show s =&gt; s -&gt; Cont\n</code></pre>\n\n<p>We can either </p>\n\n<ul>\n<li>Continue in the same machine by <code>Cont s</code></li>\n<li>Call a new machine <code>Start s s'</code></li>\n<li>End the machine at state <code>s</code> by <code>End s</code></li>\n</ul>\n\n<p><code>Bar</code> doesn't call any other flow so it only uses <code>Cont</code> and <code>End</code>, but<code>Foo</code> is a machine that makes a call to <code>Bar</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Foo (FooState(..), run) where\nimport qualified Bar as Bar\nimport Cont\n\ndata FooState = FInit | FBar | FEnd deriving Show\n\nrun FInit = Start FBar Bar.BInit\nrun FBar = End FEnd\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/aUOsb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aUOsb.png\" alt=\"FooFlow is a node in BarFlow \"></a></p>\n\n<p>A machine can be in one state at time and any machine can call another machine (by <code>Start s s'</code>). I describe my whole user state with a stack of states:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Bar as Bar\nimport qualified Foo as Foo\nimport Cont\n\ndata Stack s = Empty | s ::: Stack s ; infixr 5 :::\n\ndata States = FooState Foo.FooState | BarState Bar.BarState\n\nrun :: Stack States -&gt; Stack States\nrun Empty = error \"Empty stack\"\nrun (s ::: rest) = proceed (run' s) rest\n\nrun' :: States -&gt; Cont\nrun' (FooState s) = Foo.run s\nrun' (BarState s) = Bar.run s\n\nproceed :: Cont -&gt; Stack States -&gt; Stack States\nproceed (Cont s) rest = undefined ::: rest\nproceed (Start s s') rest = undefined ::: undefined ::: rest\nproceed (End s) rest = rest\n</code></pre>\n\n<p>The problem is that I cannot pattern match on on <code>s</code> in <code>Cont</code> constructors.</p>\n\n<p>My end goal is to have a serializable stack which enables me to continue the flow from any valid state. Here for example:</p>\n\n<pre><code>run [FInit] -&gt; [BInit, FInit]\nrun [BInit, FInit] -&gt; [BEnd, FInit]\nrun [BMid, FInit] -&gt; [BEnd, FInit]\nrun [BEnd, FInit] -&gt; [FEnd]\n</code></pre>\n\n<p>The source code of modules in this example is available <a href=\"https://glot.io/snippets/ej52lnwoqo\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>There might be better ways of encoding this model and I am not limited to mine.</p>\n"}, {"tags": ["haskell", "phantom-types"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1475936341, "post_id": 39931404, "comment_id": 67148692, "body": "Maybe you want a GADT instead?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1475927673, "creation_date": 1475927673, "answer_id": 39932026, "question_id": 39931404, "link": "https://stackoverflow.com/questions/39931404/phantom-type-confusion/39932026#39932026", "title": "Phantom type confusion?", "body": "<pre><code>data Phantom a = P1 Words | P2 Numbers deriving (Show) \n</code></pre>\n\n<p>This makes <code>P1 \"aa\"</code> of any type of the form <code>Phantom a</code>, for any <code>a</code>, including <code>Numbers</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 1, "last_activity_date": 1475928467, "creation_date": 1475928467, "answer_id": 39932155, "question_id": 39931404, "link": "https://stackoverflow.com/questions/39931404/phantom-type-confusion/39932155#39932155", "title": "Phantom type confusion?", "body": "<p>There is no implicit connection between the argument of a constructor and the type argument of the type that constructor belongs to. If you want the type denoted by the type argument to appear anywhere in the arguments of a constructor, you need to explicitly state it.</p>\n\n<p>You can see this also in the following expressions:</p>\n\n<pre><code>Nothing\n[]\n</code></pre>\n\n<p>The first one can create a <code>Maybe a</code>  for any <code>a</code> and the second a list <code>[a]</code> for any <code>a</code>.</p>\n\n<p>Likewise</p>\n\n<pre><code>P1 \"xyz\"\n</code></pre>\n\n<p>from your example can make a <code>Phantom a</code> for any <code>a</code></p>\n"}, {"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1506553615, "last_edit_date": 1506553615, "creation_date": 1476070738, "answer_id": 39950982, "question_id": 39931404, "link": "https://stackoverflow.com/questions/39931404/phantom-type-confusion/39950982#39950982", "title": "Phantom type confusion?", "body": "<p>The other answers have already explained that the type of your constructor</p>\n\n<pre><code>P1 :: Words -&gt; Phantom a\n</code></pre>\n\n<p>means it is able to construct a value of type <code>P1 a</code> for <em>any</em> choice of <code>a</code>; in particular, for the choice of <code>a ~ Numbers</code>. This is why your function call</p>\n\n<pre><code>phantomFunction (P1 \"sdsdsd\")\n</code></pre>\n\n<p>typechecks.</p>\n\n<p>Now, how do you solve this? I assume you would like <code>P1 :: Words -&gt; Phantom Words</code>? GADTs allow you to constrain the type variables occurring in the type of the constructed value, by allowing you to write</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\ndata Phantom a where\n    P1 :: Words -&gt; Phantom Words\n    P2 :: Numbers -&gt; Phantom Numbers\n</code></pre>\n\n<p>This will </p>\n\n<ul>\n<li>Ensure <code>P1 _</code> has type <code>Phantom Words</code> so you can't construct a <code>Phantom Numbers</code> with it</li>\n<li>Allow functions that consume a <code>Phantom Words</code> to do exhaustive pattern matching by only matching on <code>P1</code></li>\n<li><p>Allow functions that are polymorphic over <code>Phantom a</code> to refine their type based on pattern matching (this is the big one), so you can write e.g.</p>\n\n<pre><code>dup :: Phantom a -&gt; a\ndup (P1 ws) = ws ++ ws -- Here, we have to return a Words, and ws is a Words, so ++ will work\ndup (P2 n) = n + n -- Here, we have to return a Numbers, and x is a Numbers, so + will work\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 39932026, "answer_count": 3, "score": 3, "last_activity_date": 1506553615, "creation_date": 1475923314, "last_edit_date": 1476069895, "question_id": 39931404, "link": "https://stackoverflow.com/questions/39931404/phantom-type-confusion", "title": "Phantom type confusion?", "body": "<p>I'm confused over the use of phantom types: </p>\n\n<pre><code>type Words = String\ntype Numbers = Int\n\ndata NonPhantom = NP1 Words | NP2 Numbers deriving (Show)\n\ndata Phantom a = P1 Words | P2 Numbers deriving (Show) \n\nnonPhantomFunction :: NonPhantom -&gt; Int\nnonPhantomFunction r = 100\n\n\nphantomFunction :: Phantom Numbers -&gt; Int\nphantomFunction a = 2001\n\n\nmain = do\n   print $ nonPhantomFunction (NP1 \"sdsdds\") --can also pass NP2 here! \n   print $ phantomFunction (P1 \"sdsdsd\") --This shouldn't work!?\n</code></pre>\n\n<p>I expect this code <strong>NOT</strong> to compile, as the <code>phantomFunction</code> explicitly states its expecting data type <code>Phantom</code> of <code>Numbers</code>.</p>\n\n<p>However this compiles fine? What am I doing wrong?</p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475919024, "post_id": 39930569, "comment_id": 67144120, "body": "Constraints! The constraints you add on the constructors are enforced when you construct something and are available when you pattern match."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1475919291, "post_id": 39930569, "comment_id": 67144174, "body": "<a href=\"http://www.cs.ox.ac.uk/ralf.hinze/publications/With.pdf\" rel=\"nofollow noreferrer\">This</a> paper talks about another use of GADTs."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1475920455, "creation_date": 1475920455, "answer_id": 39931015, "question_id": 39930569, "link": "https://stackoverflow.com/questions/39930569/gadts-applications-and-usefulness/39931015#39931015", "title": "GADT&#39;s - applications and usefulness?", "body": "<h2><code>Glambda</code></h2>\n\n<p>Richard Eisenberg makes a very compelling case for GADTs in <a href=\"https://github.com/goldfirere/glambda\" rel=\"noreferrer\"><code>glambda</code></a> a simply typed lambda calculus interpreter which uses GADTs to make sure ill-typed programs simply <em>cannot</em> be constructed. Phil Wadler has something similar and simpler <a href=\"https://github.com/shayan-najd/MiniFeldspar/blob/master/Philip/GADT.hs\" rel=\"noreferrer\">here</a>, from which  the following sample was taken</p>\n\n<pre><code>data Exp e a where\n  Con :: Int -&gt; Exp e Int\n  Add :: Exp e Int -&gt; Exp e Int -&gt; Exp e Int\n  Var :: Var e a -&gt; Exp e a\n  Abs :: Typ a -&gt; Exp (e,a) b -&gt; Exp e (a -&gt; b)\n  App :: Exp e (a -&gt; b) -&gt; Exp e a -&gt; Exp e b\n</code></pre>\n\n<p>The idea is that the type of the expression (in the interpreter) is encoded in the type of the expression as represented in the Haskell program.</p>\n\n<h2>Vectors typed according to their lengths</h2>\n\n<p>By using GADTs, we can add a phantom type that tells us keeps track of the length of the vector we have. <a href=\"https://hackage.haskell.org/package/sized-vector-1.4.3.1/docs/Data-Vector-Sized.html\" rel=\"noreferrer\">This</a> package has a nice implementation. This can be reimplemented in a bunch of ways (for example using <code>GHC.TypeLits</code> type-level natural numbers). The interesting data type (copied from the source of the package linked) is</p>\n\n<pre><code>data Vector (a :: *) (n :: Nat)  where\n  Nil  :: Vector a Z\n  (:-) :: a -&gt; Vector a n -&gt; Vector a (S n)\n</code></pre>\n\n<p>Then, I can write a safe version of <code>head' :: Vector a (S n) -&gt; a</code>.</p>\n\n<h2>Constraints</h2>\n\n<p>I don't have a good example demonstrating the usefulness of this, but you can tack on constraints to individual constructors in the GADT. The constraints you add on the constructors are enforced when you construct something and are available when you pattern match. This lets us do all sorts of fun stuff.</p>\n\n<pre><code>data MyGADT b where\n  SomeShowable :: Show a =&gt; a -&gt; b -&gt; MyGADT b     -- existential types!\n  AMonad :: Monad b =&gt; b -&gt; MyGADT b\n</code></pre>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 3, "accepted_answer_id": 39931015, "answer_count": 1, "score": 2, "last_activity_date": 1475920455, "creation_date": 1475917245, "last_edit_date": 1475918863, "question_id": 39930569, "link": "https://stackoverflow.com/questions/39930569/gadts-applications-and-usefulness", "title": "GADT&#39;s - applications and usefulness?", "body": "<p>I'm covering GADT's using learnyouahaskell and I'm interested in their possible uses. I understand that their main characteristic is allowing explicit type setting.</p>\n\n<p>Such as:</p>\n\n<pre><code>data Users a where \n  GetUserName :: Int -&gt; Users String\n  GetUserId :: String -&gt; Users Int\n\nusersFunction :: Users a -&gt; a \nusersFunction (GetUserName id) \n   | id == 100      = \"Bob\"\n   | id == 200      = \"Phil\"\n   | otherwise      = \"No corresponding user\"\nusersFunction (GetUserId name)\n   | name == \"Bob\"      = 100\n   | name == \"Phil\"     = 200\n   | otherwise          = 0\n\nmain = do\n   print $ usersFunction (GetUserName 100)\n</code></pre>\n\n<p>Apart from adding additional type safety when working with these data types, what are the other uses of GADT's?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 16572, "user_id": 83741, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/60adb60c59462ef0cb9db65853736cf4?s=128&d=identicon&r=PG", "display_name": "Alexander Torstling", "link": "https://stackoverflow.com/users/83741/alexander-torstling"}, "edited": false, "score": 0, "creation_date": 1475911267, "post_id": 39929738, "comment_id": 67142444, "body": "Foldl will pass you a one. You put it in the start of the list. You get a two and put it at the start of the list. Now you have [2,1]. See where it is going?"}, {"owner": {"reputation": 16572, "user_id": 83741, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/60adb60c59462ef0cb9db65853736cf4?s=128&d=identicon&r=PG", "display_name": "Alexander Torstling", "link": "https://stackoverflow.com/users/83741/alexander-torstling"}, "edited": false, "score": 1, "creation_date": 1475911360, "post_id": 39929738, "comment_id": 67142464, "body": "Second case: First you get a one, prepend it to the empty list to get [1]. Then you get two, which you prepend to the empty list. You get [2]. See where this is going?"}], "answers": [{"tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": true, "score": 5, "last_activity_date": 1475911548, "creation_date": 1475911548, "answer_id": 39929847, "question_id": 39929738, "link": "https://stackoverflow.com/questions/39929738/use-foldl-reverses-the-list/39929847#39929847", "title": "Use foldl reverses the list?", "body": "<p>Foldl in Haskell works similarly to a for loop:</p>\n\n<pre><code>acc = []\nfor each x in xs:\n    acc = (x:[])\nreturn acc\n</code></pre>\n\n<p>Since the step you use to update <code>acc</code> doesn't depend on the previous value, the final result is only going to depend on the last element of the list (or will be the initial value of <code>acc</code>, if the list is empty).</p>\n"}], "owner": {"reputation": 61, "user_id": 5769445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c16d1c1d7854542c53f6b3d431af2872?s=128&d=identicon&r=PG&f=1", "display_name": "Cpcp Cp", "link": "https://stackoverflow.com/users/5769445/cpcp-cp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 39929847, "answer_count": 1, "score": 2, "last_activity_date": 1475912683, "creation_date": 1475910624, "last_edit_date": 1475912683, "question_id": 39929738, "link": "https://stackoverflow.com/questions/39929738/use-foldl-reverses-the-list", "title": "Use foldl reverses the list?", "body": "<pre><code>reverse'::[a] -&gt; [a]\nreverse' xs=foldl (\\acc x -&gt; x:acc) [] xs\nexample\uff1a\nreverse' [1,2,3,4,5]\noutput:[5,4,3,2,1]\n</code></pre>\n\n<p>if I change the <code>acc</code> for <code>[]</code></p>\n\n<pre><code>reverse' xs=foldl (\\acc x -&gt; x:[]) [] xs\n</code></pre>\n\n<p>it outputs</p>\n\n<pre><code>[5]\n</code></pre>\n\n<p>why?</p>\n"}, {"tags": ["haskell", "monads", "typeclass", "functor"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475904987, "post_id": 39928488, "comment_id": 67141172, "body": "I was expecting something to break in <a href=\"https://hackage.haskell.org/package/mmorph-1.0.6/docs/Control-Monad-Trans-Compose.html\" rel=\"nofollow noreferrer\"><code>Control.Monad.Trans.Compose</code></a>, but everything compiles fine without <code>Monad m</code> on <code>hoist</code>..."}, {"owner": {"reputation": 122984, "user_id": 500104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ff1143d80ee378720a879e79fe6da68f?s=128&d=identicon&r=PG", "display_name": "Xeo", "link": "https://stackoverflow.com/users/500104/xeo"}, "edited": false, "score": 0, "creation_date": 1475905679, "post_id": 39928488, "comment_id": 67141308, "body": "Maybe because it only makes sense for monads? It&#39;s a functor over a monad transformer (stack), as far as I can see."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475911120, "post_id": 39928488, "comment_id": 67142408, "body": "@Alec <code>Control.Monad.Trans.Compose</code> doesn&#39;t have an <code>MFunctor</code> instance."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475910748, "post_id": 39929720, "comment_id": 67142326, "body": "Do you know what that&#39;s doing? Is the <code>Monad</code> (or <code>Functor</code>) constraint required for the semantics, or only efficiency?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475911053, "post_id": 39929720, "comment_id": 67142391, "body": "It&#39;s mapping <code>hoist nat</code> recursively inside <code>m</code>. A <code>Functor</code> constraint shouldn&#39;t be a surprising requirement for any transformer <code>t m a</code> of a form like <code>m (t m a)</code>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 7, "last_activity_date": 1475910508, "creation_date": 1475910508, "answer_id": 39929720, "question_id": 39928488, "link": "https://stackoverflow.com/questions/39928488/why-does-control-monad-morph-hoist-have-a-monad-constraint/39929720#39929720", "title": "Why does Control.Monad.Morph.hoist have a Monad constraint?", "body": "<p><code>Control.Monad.Morph</code> is a spinoff from <a href=\"https://hackage.haskell.org/package/pipes\">pipes</a>, so I'd guess it's there because the <code>MFunctor</code> instance for <code>Proxy</code> needs it... And sure enough it's <a href=\"https://hackage.haskell.org/package/pipes-4.2.0/docs/src/Pipes-Internal.html#unsafeHoist\">used there</a>.</p>\n\n<blockquote>\n<pre><code>instance MFunctor (Proxy a' a b' b) where\n    hoist nat p0 = go (observe p0)\n      where\n        go p = case p of\n            Request a' fa  -&gt; Request a' (\\a  -&gt; go (fa  a ))\n            Respond b  fb' -&gt; Respond b  (\\b' -&gt; go (fb' b'))\n            M          m   -&gt; M (nat (m &gt;&gt;= \\p' -&gt; return (go p')))\n            Pure    r      -&gt; Pure r\n</code></pre>\n</blockquote>\n\n<p>I don't think it's needed though. <code>m &gt;&gt;= return . f</code> is <code>fmap f m</code>. It probably should be a <code>Functor</code> constraint and that code predates the implementation of the monad-applicative proposal.</p>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 39929720, "answer_count": 1, "score": 7, "last_activity_date": 1475910508, "creation_date": 1475898594, "last_edit_date": 1475910484, "question_id": 39928488, "link": "https://stackoverflow.com/questions/39928488/why-does-control-monad-morph-hoist-have-a-monad-constraint", "title": "Why does Control.Monad.Morph.hoist have a Monad constraint?", "body": "<p><code>Control.Monad.Morph</code> includes</p>\n\n<pre><code>class MFunctor t where\n  hoist :: Monad m =&gt; (forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b\n</code></pre>\n\n<p>As far as I can tell, none of the included instances use the <code>Monad m</code> constraint. How might one do so? Are there valid instances that use the constraint (it's a bit hard for me to imagine how, given that <code>hoist id = id</code>)? What's the significance of the constraint being on <code>m</code> and not <code>n</code>?</p>\n"}, {"tags": ["string", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1475882354, "post_id": 39926494, "comment_id": 67137516, "body": "Just wrote that up as <a href=\"http://stackoverflow.com/documentation/haskell/3406/data-text/24312/checking-if-one-text-is-a-substring-of-another#t=201610072318129590912\">an SO Documentation example</a> :)"}], "tags": [], "owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "is_accepted": true, "score": 8, "last_activity_date": 1475881539, "last_edit_date": 1475881539, "creation_date": 1475878286, "answer_id": 39926494, "question_id": 39926456, "link": "https://stackoverflow.com/questions/39926456/in-haskell-how-do-you-check-whether-a-string-is-a-substring-of-another/39926494#39926494", "title": "In Haskell, how do you check whether a string is a substring of another?", "body": "<p>Just found it, the answer is <a href=\"http://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html#v:isInfixOf\" rel=\"noreferrer\"><code>isInfixOf</code></a>.</p>\n"}], "owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3857, "favorite_count": 0, "accepted_answer_id": 39926494, "answer_count": 1, "score": 3, "last_activity_date": 1475881539, "creation_date": 1475878071, "question_id": 39926456, "link": "https://stackoverflow.com/questions/39926456/in-haskell-how-do-you-check-whether-a-string-is-a-substring-of-another", "title": "In Haskell, how do you check whether a string is a substring of another?", "body": "<p>I'm using Data.Text and all I could find are <code>find</code>, which only takes a Char as predicate, and <code>breakOn</code>, which would allow me to do what I want but seems overkill. Surely there must be a better way?</p>\n\n<p>I'd be interested in the answer to the same question with other string libraries as well (String, ByteString, etc.).</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1475875654, "post_id": 39925749, "comment_id": 67135726, "body": "Could you make sure you have all the imports in your example? It is a bit of a bummer if we have to figure out everything you import..."}, {"owner": {"reputation": 117, "user_id": 2679546, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d78ea8cc8c787cb3a98c93de0eabfd5d?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/2679546/artem"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1475876113, "post_id": 39925749, "comment_id": 67135856, "body": "@Alec I&#39;ve added all missing parts so that the code compiles and works."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475881464, "post_id": 39925749, "comment_id": 67137305, "body": "Did you try changing the operator definition from <code>reservedOp &quot;*&quot;</code> to <code>reservedOp &quot;*&quot; &lt;|&gt; spaces</code>?"}, {"owner": {"reputation": 117, "user_id": 2679546, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d78ea8cc8c787cb3a98c93de0eabfd5d?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/2679546/artem"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475883526, "post_id": 39925749, "comment_id": 67137791, "body": "@BenjaminHodgson this leads to infinite recursion. I think I need to somehow change what term is but I don&#39;t understand how"}, {"owner": {"reputation": 6181, "user_id": 1025555, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GBIIj.png?s=128&g=1", "display_name": "Good Night Nerd Pride", "link": "https://stackoverflow.com/users/1025555/good-night-nerd-pride"}, "edited": false, "score": 0, "creation_date": 1517144711, "post_id": 39925749, "comment_id": 83966064, "body": "Did you ever figure out a solution? I&#39;m hitting a similar problem."}], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 2679546, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d78ea8cc8c787cb3a98c93de0eabfd5d?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/2679546/artem"}, "edited": false, "score": 0, "creation_date": 1475952808, "post_id": 39930794, "comment_id": 67154093, "body": "Thank you, it works fine, but actually I need other operators and operator precedence, there are also binary <code>-</code>, <code>&#47;</code> and <code>^</code>, I removed them to make example code shorter, this is actually reason why I have <code>BinOp</code> type"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1475918934, "creation_date": 1475918934, "answer_id": 39930794, "question_id": 39925749, "link": "https://stackoverflow.com/questions/39925749/how-to-parse-expression-with-implicit-multiplication-with-parsec-in-haskell/39930794#39930794", "title": "How to parse expression with implicit multiplication with Parsec in Haskell", "body": "<p>Unless you have a very good reason for the machinery behind <code>makeTokenParser</code>, it seems like a bit overkill. Usually, that is useful when you have a language that is very similar to an existing language, or you have many different levels of operator precedence. In your case, you can write <code>expression</code> in a couple of lines...</p>\n\n<pre><code>import Text.Parsec.String (Parser) \nimport Text.Parsec\nimport Control.Applicative (some)\n\n-- ...\n\nexpression :: Parser Expr\nexpression = sum\n  where\n    product = foldl1 (Binary Multiply) &lt;$&gt; factor `sepBy1` optional (char '*')\n    sum     = foldl1 (Binary Add)      &lt;$&gt; product `sepBy1` char '+'\n    factor  = int &lt;|&gt; between (char '(') (char ')') expression\n    int     = Const . read &lt;$&gt; some digit\n\n -- ...\n</code></pre>\n\n<p>Then, at GHCi:</p>\n\n<pre><code>ghci&gt; parseString \"1+2*3\"\nBinary Add (Const 1) (Binary Multiply (Const 2) (Const 3))\nghci&gt; parseString \"(1+2)(3+4)\"\nBinary Multiply (Binary Add (Const 1) (Const 2)) (Binary Add (Const 3) (Const 4))\nghci&gt; parseString \"(1+2)*(3+4)\"\nBinary Multiply (Binary Add (Const 1) (Const 2)) (Binary Add (Const 3) (Const 4))\nghci&gt; parseString \"(1+2)7\"\nBinary Multiply (Binary Add (Const 1) (Const 2)) (Const 7)\nghci&gt; parseString \"(1+2)*7\"\nBinary Multiply (Binary Add (Const 1) (Const 2)) (Const 7)\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 2679546, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d78ea8cc8c787cb3a98c93de0eabfd5d?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/2679546/artem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1475918934, "creation_date": 1475874070, "last_edit_date": 1475876045, "question_id": 39925749, "link": "https://stackoverflow.com/questions/39925749/how-to-parse-expression-with-implicit-multiplication-with-parsec-in-haskell", "title": "How to parse expression with implicit multiplication with Parsec in Haskell", "body": "<p>I have a grammar which allows implicit multiplication, <code>(1+2)(3+4)</code> is the same as <code>(1+2)*(3+4)</code> or <code>(1+2)7</code> is the same as <code>(1+2)*7</code>\nHow do I implement this in Haskell? Here is what I have so far:</p>\n\n<pre><code>import Control.Monad\nimport Text.ParserCombinators.Parsec\nimport Text.ParserCombinators.Parsec.Expr\nimport Text.ParserCombinators.Parsec.Language\nimport qualified Text.ParserCombinators.Parsec.Token as Token\n\nlanguageDef =\n  emptyDef { Token.identStart      = letter\n           , Token.identLetter     = alphaNum\n           , Token.reservedOpNames = [\"+\", \"*\"]\n           }\n\nlexer = Token.makeTokenParser languageDef\n\nreservedOp = Token.reservedOp lexer\nparens     = Token.parens     lexer\ninteger    = Token.integer    lexer\n\ndata Expr = Const Int\n          | Binary BinOp Expr Expr\n            deriving (Show)\n\ndata BinOp = Add | Multiply\n             deriving (Show)\n\nexpression = buildExpressionParser operators term\n\noperators = [ [Infix  (reservedOp \"*\"   &gt;&gt; return (Binary Multiply)) AssocLeft]\n            , [Infix  (reservedOp \"+\"   &gt;&gt; return (Binary Add     )) AssocLeft]\n            ]\n\nterm =   liftM (Const . fromIntegral) integer\n     &lt;|&gt; parens expression\n     &lt;|&gt; (do e1 &lt;- expression\n             e2 &lt;- term\n             return $ Binary Multiply e1 e2)\n\nparseString str =\n  case parse expression \"\" str of\n    Left e  -&gt; error $ show e\n    Right r -&gt; r\n</code></pre>\n\n<p>but it doesn't work, I have an error while parsing, when I try to parse <code>((1 + 5) 8)</code> I have <code>unexpected \"8\" expecting operator or \")\"</code></p>\n"}, {"tags": ["performance", "haskell", "lazy-evaluation", "space-leak"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1475874529, "post_id": 39925271, "comment_id": 67135320, "body": "I can not reproduce your problem.  What version of GHC are you using? What flags are you compiling with?"}, {"owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475874762, "post_id": 39925271, "comment_id": 67135411, "body": "@ThomasM.DuBuisson This is being done through a HackerRank contest.  The environment uses ghc 7.8 and only give 512 MB of memory. No flags as far as I&#39;m aware."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475874766, "post_id": 39925271, "comment_id": 67135414, "body": "Or perhaps I misunderstand your problem.  Certainly memory is obviously linear with <code>n</code> since you are reading <code>n</code> lines of strings from stdin before performing any operations.  Is that all or are you observing editDistance take too much memory over some dimension?"}, {"owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475874982, "post_id": 39925271, "comment_id": 67135482, "body": "@ThomasM.DuBuisson The bulk of the memory usage is in the dynamic table that is constructed in editDistance.  It seems that I have enough room for 3-4 or these tables, since it will not crash for <code>n</code> less than 4.  But after one table is constructed, the answer can be pulled out and I will no longer need that table, but it seems to persist."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475875443, "post_id": 39925271, "comment_id": 67135642, "body": "What evidence do you have for that diagnosis?  It seems to be an assumption. If the program crashes on <code>n&gt;4</code> then perhaps that many input strings plus one table is too large.  Certainly with GHC 8.x I see the tables are GCed and things run in ~constant space modulo jitter during evaluation.  Have you considered an unboxed table?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1475875619, "post_id": 39925271, "comment_id": 67135714, "body": "Also, instead of forcing the entire list via <code>last</code> just use the value - you know it after all: <code>array ((0,0),(xBnd,yBnd)) xs</code>.  Notice the list is <code>strLen^2</code> length, so you are allocating a whole lot of memory only to free it a moment later."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1475873886, "creation_date": 1475873886, "answer_id": 39925704, "question_id": 39925271, "link": "https://stackoverflow.com/questions/39925271/space-leak-in-dynamic-haskell/39925704#39925704", "title": "Space leak in dynamic Haskell", "body": "<p>My feeling is that the problem is that your <code>min'</code> is not strict enough. Because it doesn't force its arguments it simply builds up a thunks for each array element. This causes more memory to be used, GC times to increase, etc.</p>\n\n<p>I would try:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\n...\nmin' !a !b !c = min a (min b c)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1475875732, "last_edit_date": 1475875732, "creation_date": 1475875210, "answer_id": 39925963, "question_id": 39925271, "link": "https://stackoverflow.com/questions/39925271/space-leak-in-dynamic-haskell/39925963#39925963", "title": "Space leak in dynamic Haskell", "body": "<p>Certainly your memory  will increase with <code>n</code> if you read all <code>n</code> inputs prior to computing any results and printing outputs.  You could try interleaving the input and output operations:</p>\n\n<pre><code>main = do\n  n &lt;- readLn\n  replicateM_ n $ do\n    s1 &lt;- B.getLine\n    s2 &lt;- B.getLine\n    print (editDistance (s1,s2))\n</code></pre>\n\n<p>Or alternatively using lazy IO (untested, probably needs gratuitous <code>B.</code>):</p>\n\n<pre><code>main = do\n  n &lt;- readLn\n  cont &lt;- getContents\n  let lns = take n (lines cont)\n      pairs = unfoldr (\\case (x:y:rs) -&gt; Just ((x,y),rs) ; _ -&gt; Nothing) lns\n  mapM_ (print . editDistance) pairs\n</code></pre>\n\n<p>EDIT: Other possible savings include using an unboxed array and not forcing your whole <code>strLen^2</code> size list via <code>last</code> during array construction.  Consider <code>array ((0,0),(xBnd,yBnd)) xs</code>.</p>\n"}], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 39925963, "answer_count": 2, "score": 1, "last_activity_date": 1475875732, "creation_date": 1475871912, "last_edit_date": 1495540840, "question_id": 39925271, "link": "https://stackoverflow.com/questions/39925271/space-leak-in-dynamic-haskell", "title": "Space leak in dynamic Haskell", "body": "<p>I posted this question a few days ago: <a href=\"https://stackoverflow.com/questions/39798956/haskell-performance-using-dynamic-programming\">Haskell performance using dynamic programming</a> and was recommended to use ByteStrings instead of Strings.  After implementing the algorithm with ByteStrings, the program crashes, going over the memory limits.</p>\n\n<pre><code>import Control.Monad\nimport Data.Array.IArray\nimport qualified Data.ByteString as B\n\nmain = do\n  n &lt;- readLn\n  pairs &lt;- replicateM n $ do\n    s1 &lt;- B.getLine\n    s2 &lt;- B.getLine\n    return (s1,s2)\n  mapM_ (print . editDistance) pairs\n\neditDistance :: (B.ByteString, B.ByteString) -&gt; Int\neditDistance (s1, s2) = dynamic editDistance' (B.length s1, B.length s2)\n  where\n    editDistance' table (i,j)\n      | min i j == 0 = max i j\n      | otherwise = min' (table!((i-1),j) + 1) (table!(i,(j-1)) + 1) (table!((i-1),(j-1)) + cost)\n      where\n        cost =  if B.index s1 (i-1) == B.index s2 (j-1) then 0 else 1\n        min' a b = min (min a b)\n\ndynamic :: (Array (Int,Int) Int -&gt; (Int,Int) -&gt; Int) -&gt; (Int,Int) -&gt; Int\ndynamic compute (xBnd, yBnd) = table!(xBnd,yBnd)\n  where\n    table = newTable $ map (\\coord -&gt; (coord, compute table coord)) [(x,y) | x&lt;-[0..xBnd], y&lt;-[0..yBnd]]\n    newTable xs = array ((0,0),fst (last xs)) xs\n</code></pre>\n\n<p>The memory consumption appears to scale with <code>n</code>. The length of the input strings are 1000 characters.  I would expect Haskell to free all memory used in <code>editDistance</code> after each solution is printed.  Is this not the case? If not, how can I force this?</p>\n\n<p>The only other real calculation I see is for <code>cost</code> but forcing that with <code>seq</code> did nothing.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1475848393, "post_id": 39917687, "comment_id": 67121664, "body": "<a href=\"http://stackoverflow.com/questions/28624408/equal-vs-left-arrow-symbols-in-haskell/28625714#28625714\">About <code>let =</code> vs <code>&lt;-</code></a>"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1475875203, "post_id": 39917687, "comment_id": 67135569, "body": "No, they are not the same. Consider <code>do</code> / <code>let p = putStrLn &quot;hello world&quot;</code> / <code>p</code> / <code>p</code> (imagine each / is a line break with appropriate indentation)"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1475846234, "last_edit_date": 1475846234, "creation_date": 1475844826, "answer_id": 39917805, "question_id": 39917687, "link": "https://stackoverflow.com/questions/39917687/why-you-cant-use-substitution-inside-a-do-block-while-you-can-use-let-binding/39917805#39917805", "title": "Why you can&#39;t use substitution inside a do block while you can use let (binding)?", "body": "<p><code>let</code> is how you assign a value to a name inside a <code>do</code> block. <code>let x = y</code> is not equivalent to <code>x &lt;- y</code>. Inside a <code>do</code> block, <code>let</code> desugars like this.</p>\n\n<pre><code>do let x = y\n   ...\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>let x = y\nin do ...\n</code></pre>\n\n<p>whereas</p>\n\n<pre><code>do x &lt;- y\n   ...\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>do y &gt;&gt;= (\\x -&gt; ...)\n</code></pre>\n\n<hr>\n\n<p>Bare <code>=</code> is only for top-level assignments, for defining functions and constants (which are a lot like 0-argument functions).</p>\n"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "closed_date": 1475855658, "accepted_answer_id": 39917805, "answer_count": 1, "score": 0, "last_activity_date": 1475846234, "creation_date": 1475844464, "question_id": 39917687, "link": "https://stackoverflow.com/questions/39917687/why-you-cant-use-substitution-inside-a-do-block-while-you-can-use-let-binding", "closed_reason": "Duplicate", "title": "Why you can&#39;t use substitution inside a do block while you can use let (binding)?", "body": "<p>Why can't you use substitution inside a do block?\nThis code works fine.</p>\n\n<pre><code>test :: (x -&gt; x) -&gt; [x] -&gt; [x]\ntest f a = map f a\nmain :: IO ()\nmain = do\n  let sq x = x * x :: Int\n  let ret = test sq [1,2,3]\n  print ret\n</code></pre>\n\n<p>But if you remove the let's inside the do block, I got compile errors.</p>\n\n<pre><code>parse error on input \u2018=\u2019\nPerhaps you need a 'let' in a 'do' block?\ne.g. 'let x = 5' instead of 'x = 5'\n</code></pre>\n\n<p>Is \"let x = y\" equivalent to \"x &lt;- y\" inside a do block?\nSo if the right hand side returns a IO something, you need to use let's (or &lt;-) ?\nI know it's a dummy question but I always get compile error with this.\neii</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 444, "user_id": 1554137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb537e77e97db2071395a0b2a4c8a593?s=128&d=identicon&r=PG", "display_name": "Alexander VoidEx Ruchkin", "link": "https://stackoverflow.com/users/1554137/alexander-voidex-ruchkin"}, "is_accepted": true, "score": 9, "last_activity_date": 1475838204, "creation_date": 1475838204, "answer_id": 39915686, "question_id": 39915548, "link": "https://stackoverflow.com/questions/39915548/list-type-signatures/39915686#39915686", "title": "List type signatures", "body": "<p><code>[[Int]]</code> is list of lists (of Int's) and</p>\n\n<ul>\n<li><code>[[]]</code> - list with one empty list inside</li>\n<li><code>[]</code> - empty list</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": false, "score": 4, "last_activity_date": 1475838807, "creation_date": 1475838807, "answer_id": 39915861, "question_id": 39915548, "link": "https://stackoverflow.com/questions/39915548/list-type-signatures/39915861#39915861", "title": "List type signatures", "body": "<p>The type of <code>[]</code> is polymorphic, i.e. <code>forall t. [t]</code>, meaning it represents an empty list of any type <code>t</code>. Since <code>test</code> is of type <code>[[Int]]</code>, we can unify <code>t ~ [Int]</code> and therefore <code>[]</code> is an empty list of type <code>[[Int]]</code> also.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 39915686, "answer_count": 2, "score": 3, "last_activity_date": 1475838807, "creation_date": 1475837728, "question_id": 39915548, "link": "https://stackoverflow.com/questions/39915548/list-type-signatures", "title": "List type signatures", "body": "<p>This makes sense:</p>\n\n<pre><code>test :: [[Int]]\ntest = [[]]\n\nmain = print test\n</code></pre>\n\n<p>But why does this compile (and run)?</p>\n\n<pre><code>test :: [[Int]]\ntest = []\n\nmain = print test\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475863631, "post_id": 39914421, "comment_id": 67130463, "body": "Alternately, <code>prob2 = foldl (+) 0 . map (+ 10)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "is_accepted": true, "score": 5, "last_activity_date": 1475835271, "last_edit_date": 1475835271, "creation_date": 1475834570, "answer_id": 39914593, "question_id": 39914421, "link": "https://stackoverflow.com/questions/39914421/creating-a-haskell-function-using-foldl-to-turn-a-list-of-ints-to-a-single-int/39914593#39914593", "title": "Creating a Haskell function using foldl to turn a list of ints to a single int", "body": "<p>The problem is that you are still thinking in terms of recursion. You seem to think of the problem as applying the function to the head of the element and the tail.<br>\nBut <code>foldl</code> takes a binary operator and applies it to elements of the list in a cumulative fashion. It requires a binary operator for items of the same type. </p>\n\n<p>You need a lambda expression with 2 parameters, like this:</p>\n\n<pre><code>foldl (\\x y -&gt; 10*x+y) 0  [2,3,4,5]\n</code></pre>\n\n<p>This will yield your integer 2345.</p>\n"}, {"comments": [{"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 0, "creation_date": 1475841737, "post_id": 39916380, "comment_id": 67117493, "body": "+1 for &quot;replacing the commas in the list with this operator&quot;. BTW the question states that the end result should be an Integer, not a String."}, {"owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "reply_to_user": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 1, "creation_date": 1475842123, "post_id": 39916380, "comment_id": 67117761, "body": "@S.L.Barth: I know, but I thought that your answer already takes care of answering OP&#39;s concrete question, so I meant that latter example as a way of demonstrating that the types of the accumulator and the elements of the list don&#39;t have to be the same."}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 0, "creation_date": 1475842217, "post_id": 39916380, "comment_id": 67117820, "body": "Seems a useful addition indeed."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5276520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaa9803983597167dbb65d52c24a3da?s=128&d=identicon&r=PG", "display_name": "dkasak", "link": "https://stackoverflow.com/users/5276520/dkasak"}, "is_accepted": false, "score": 2, "last_activity_date": 1475840489, "creation_date": 1475840489, "answer_id": 39916380, "question_id": 39914421, "link": "https://stackoverflow.com/questions/39914421/creating-a-haskell-function-using-foldl-to-turn-a-list-of-ints-to-a-single-int/39916380#39916380", "title": "Creating a Haskell function using foldl to turn a list of ints to a single int", "body": "<p>There's also a way of looking at this symbolically that I like to use. Instead of <code>foldl</code>, let's take a look at <code>foldl1</code> first for simplicity. Note, that using <code>foldl1</code> is often not a good idea since it is a partial function (passing an empty list results in an exception).</p>\n\n<p>You can imagine <code>foldl1</code> takes an operator and a list and replaces the commas in the list with this operator (along with appropriately placed parentheses, of course), e.g.</p>\n\n<pre><code>foldl1 (+) [1, 2, 3, 4] =\n(((1 + 2) + 3) + 4)     =\n((3 + 3) + 4)           =\n(6 + 4)                 =\n10\n</code></pre>\n\n<p>If associativity holds for the operator, you can naturally omit the parentheses altogether. From this, it is obvious that the operator/function you pass to <code>foldl</code> is always operating on two single elements at the time.</p>\n\n<p>Note that the <code>foldl</code> function is more general since the type of the initial/resulting value doesn't have to be the same as the type of the list's elements, but the above visualization still applies if you imagine the initial value as \"standing\" in front of the list:</p>\n\n<pre><code>(+&gt;) :: Show a =&gt; String -&gt; a -&gt; String\n(+&gt;) accumulator x = accumulator ++ show x\n\nfoldl (+&gt;) \"\" [1, 2, 3, 4]     =\n((((\"\" +&gt; 1) +&gt; 2) +&gt; 3) +&gt; 4) =\n(((\"1\" +&gt; 2) +&gt; 3) +&gt; 4)       =\n((\"12\" +&gt; 3) +&gt; 4)             =\n(\"123\" +&gt; 4)                   =\n\"1234\"\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 3818146, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/540fd7e9877f81b49f4ee0d9363849b5?s=128&d=identicon&r=PG&f=1", "display_name": "user47835", "link": "https://stackoverflow.com/users/3818146/user47835"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 0, "accepted_answer_id": 39914593, "answer_count": 2, "score": 1, "last_activity_date": 1475840489, "creation_date": 1475834074, "last_edit_date": 1475834983, "question_id": 39914421, "link": "https://stackoverflow.com/questions/39914421/creating-a-haskell-function-using-foldl-to-turn-a-list-of-ints-to-a-single-int", "title": "Creating a Haskell function using foldl to turn a list of ints to a single int", "body": "<p>I have to define a function, prob2, that takes a list of Ints and returns an Int using foldl:</p>\n\n<pre><code>HW3*&gt; prob2 [2,3,4,5]\n\n2345\n</code></pre>\n\n<p>I lack experience using folds.  What I have is this:</p>\n\n<pre><code>prob2 :: [Integer] -&gt; Integer\n\nprob2 (x:xs) = foldl (\\x-&gt;10*x+xs) 0\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "grammar", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475866792, "post_id": 39913967, "comment_id": 67131940, "body": "Here&#39;s a hint: when translating your grammar, bare tokens convert to pattern matches, and nonterminals convert to function calls."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1475953383, "post_id": 39913967, "comment_id": 67154297, "body": "You check <code>isDigit</code> inside the parser <i>and</i> the tokenizer. The need for this arises because your representation of a sequence of tokens is not sufficient - it should be <code>[Token]</code> where <code>Token</code> is your own type, e.g. <code>data Token = Number Natural | OParen | CParen | Semicolon...</code> etc. It would also help you to write a <code>Parser</code> abstraction instead of inlining parsing code everywhere. Also note your tokenize function is simply <code>filter (not . all isSpace) . groupBy (\\a b -&gt; all isDigit [a,b])</code> - try rewriting the parsing functions using HOFs in the same way - it will be much easier to reason about."}, {"owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "edited": false, "score": 0, "creation_date": 1476047308, "post_id": 39913967, "comment_id": 67177384, "body": "Ok so im supposed to traverse the list , string by string, and do the appropriate function calls. No trickery with extracting the last element and so forth? I think im supposed to be able to solve it with the given data type, even if its not optimal from a haskell pro pov (We&#39;re noobs and the subject is more about languages/ FP than it is about haskell itself). Im still stuck though, dont know how to deal with nested expressions."}, {"owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1476620650, "post_id": 39913967, "comment_id": 67413767, "body": "I figured it out. Thanks guys.  What do you mean with filter (not . all isSpace) . groupBy (\\a b -&gt; all isDigit [a,b]) @user2407038 ? I tried to make it work, but I dont fully understand."}], "owner": {"reputation": 271, "user_id": 3727064, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/685893932/picture?type=large", "display_name": "Amoz", "link": "https://stackoverflow.com/users/3727064/amoz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 840, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475832649, "creation_date": 1475832649, "question_id": 39913967, "link": "https://stackoverflow.com/questions/39913967/parsing-string-to-ast", "title": "Parsing string to AST", "body": "<p>Stuck trying to parse a string into an Abstract Syntax Tree</p>\n\n<p>This is the grammar that im using, in BNF</p>\n\n<pre><code>&lt;Block&gt; ::= &lt;Expr&gt;;\n&lt;Expr&gt; ::= &lt;Number&gt; | &lt;App&gt;\n&lt;App&gt; ::= (&lt;Expr&gt;, &lt;Expr&gt;) &lt;Func&gt;\n&lt;Func&gt; ::= + | - | * | \\\n&lt;Number&gt; ::= &lt;Digit&gt; | &lt;Digit&gt;&lt;Number&gt;\n&lt;Digit&gt; ::= 0 | 1 | .... | 9\n</code></pre>\n\n<p>I have to use this:</p>\n\n<pre><code>data Ast = Number Integer | Func String | App Ast [Ast] | Block [Ast]\n</code></pre>\n\n<p>I wrote a tokenize method (that perhaps is not completely finished, but gives the right idea)</p>\n\n<pre><code>tokenize :: String -&gt; [String]\ntokenize [] = []\ntokenize xs @ (x : xs')\n    | x `elem` t = [x] : tokenize xs'\n    | isDigit x = [y | y &lt;- takeWhile isDigit xs] : (tokenize (dropWhile isDigit xs))\n    | otherwise = tokenize xs'\n        where t = ['+', '-', '*', '/', '(', ')', ';']\n</code></pre>\n\n<p>I'm stuck on the parseApp function. It's not obvious to me how I could use pattern matching, and I don't see any other way to do it (with my very limited haskell experience)</p>\n\n<pre><code>parse :: String -&gt; Ast\nparse xs = parseBlock (tokenize xs)\n\nparseBlock :: [String] -&gt; (Ast, [String]) \nparseBlock xss = let (a, b) = parseExpr (init xss) in (Block [a], b)\n\nparseExpr :: [String] -&gt; (Ast, [String]) \nparseExpr xss @ (xs : xss')\n    | all isDigit xs = (Number (read xs :: Integer), xss')\n    | otherwise = parseApp xss\n\nparseApp :: [String] -&gt; (Ast, [String])\nparseApp xss = -- ...\n</code></pre>\n\n<p>If the input string is </p>\n\n<pre><code>\"((10, 2)- , (0, 2)-)+;\"\n</code></pre>\n\n<p>it should tokenize to</p>\n\n<pre><code>[\"(\", \"(\", \"10\", \",\", \"2\", \")\", \"-\", \",\", \"(\", \"0\", \",\", \"2\", \")\", \"-\", \")\", \"+\", \";\"]\n</code></pre>\n\n<p>and that would become </p>\n\n<pre><code>(Block [ App (Name \"+\") [App (Name \"-\") [Number 10, Number 2], App (Name \"-\") [Number 0, Number 2]]], []) \n</code></pre>\n\n<p>It's an assignment so I can't change the types and so on. I'm supposed to assume that the given input has correct syntax. I have read similiar threads here, but the answers seem to assume a higher level of understanding </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1475831131, "post_id": 39913349, "comment_id": 67111139, "body": "Monadic code modeling side effects often feels imperative, but there&#39;s nothing wrong with that."}, {"owner": {"reputation": 1649, "user_id": 3684713, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qo7tw.jpg?s=128&g=1", "display_name": "overactor", "link": "https://stackoverflow.com/users/3684713/overactor"}, "edited": false, "score": 4, "creation_date": 1475832440, "post_id": 39913349, "comment_id": 67111900, "body": "You might want to take this over to <a href=\"http://codereview.stackexchange.com/\">codereview.SE</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1649, "user_id": 3684713, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qo7tw.jpg?s=128&g=1", "display_name": "overactor", "link": "https://stackoverflow.com/users/3684713/overactor"}, "edited": false, "score": 2, "creation_date": 1475848110, "post_id": 39913349, "comment_id": 67121515, "body": "@overactor, that sounds nice, but my experience has been that very few Haskell programmers are answering questions on that site."}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475863519, "post_id": 39913349, "comment_id": 67130400, "body": "As @chi mentioned, monadic assignments (username &lt;-) can feel imperative as monads are similar to OOP as they have a &#39;state&#39;, additionally case statements are also similar"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475866931, "post_id": 39913349, "comment_id": 67132015, "body": "@dfeuer &quot;It won&#39;t get an answer there&quot; doesn&#39;t imply &quot;it&#39;s appropriate here&quot;."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6307701"}, "edited": false, "score": 0, "creation_date": 1475869228, "post_id": 39913349, "comment_id": 67133061, "body": "chi and barbra: thanks folks, I just thought it was me and my imperative way of thinking. overactor and Daniel: thanks, I wasn&#39;t aware of codereview.SE. I will move it there! Edit: Not sure how i can move it however..."}], "owner": {"user_type": "does_not_exist", "display_name": "user6307701"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "closed_date": 1475866856, "answer_count": 0, "score": 3, "last_activity_date": 1475831375, "creation_date": 1475830675, "last_edit_date": 1475831375, "question_id": 39913349, "link": "https://stackoverflow.com/questions/39913349/haskell-beginner-is-this-too-imperative-like", "closed_reason": "Duplicate", "title": "Haskell beginner: Is this too imperative like?", "body": "<p>*Sorry for the extremely elementary question, but I am just starting out with Haskell.</p>\n\n<p>I have a Snap web app with a handler <code>handleUsernameCheck</code>. I am trying to get the <code>username</code> as parameter and use it to query Postgresql.</p>\n\n<p>The code I came up looks something like this:</p>\n\n<pre><code>handleUsernameCheck :: Handler App App ()\nhandleUsernameCheck = do\n    username &lt;- getParam \"username\"\n    case username of\n        Nothing -&gt; writeBS \"Capout\"\n        Just name -&gt; do\n            usernames &lt;- query \"SELECT username FROM users WHERE username = ?\" [(name)]\n            case usernames of\n                [] -&gt; writeBS \"Capout again\"\n                (h:_) -&gt; writeBS $ theName (h :: Username)\n</code></pre>\n\n<p>This looks pretty much to what I would write in C or python so I was wondering what would be a better way for Haskell.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "common-lisp", "arbitrary-precision"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 8, "creation_date": 1475794622, "post_id": 39906812, "comment_id": 67099141, "body": "This should be two separate questions."}, {"owner": {"reputation": 91, "user_id": 6934417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b31cef1a04debff678e135674522ada5?s=128&d=identicon&r=PG&f=1", "display_name": "zweiblumen", "link": "https://stackoverflow.com/users/6934417/zweiblumen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1475817585, "post_id": 39906812, "comment_id": 67104550, "body": "You&#39;re right. I asked them together because  I thought maybe both problems had something to do with the memory limit in emacs and could be fixed by changing some parameter about that. Of course that was before seeing luqui&#39;s answer about the Haskell part."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 6934417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b31cef1a04debff678e135674522ada5?s=128&d=identicon&r=PG&f=1", "display_name": "zweiblumen", "link": "https://stackoverflow.com/users/6934417/zweiblumen"}, "edited": false, "score": 0, "creation_date": 1475818153, "post_id": 39908382, "comment_id": 67104736, "body": "Thanks four your effort. I&#39;m reading about <code>BangPatterns</code>. I&#39;m keeping the question open though, in the hope of getting an answer about the Common LISP part."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 5, "last_activity_date": 1475806882, "creation_date": 1475806882, "answer_id": 39908382, "question_id": 39906812, "link": "https://stackoverflow.com/questions/39906812/number-type-boundaries-in-common-lisp-and-stack-flowing-over-in-ghci/39908382#39908382", "title": "Number type boundaries in Common LISP and Stack flowing over in GHCI", "body": "<p>I will answer your second question, I'm not sure about the first.  In Haskell, because it's a lazy language, when you use tail recursion with an accumulator parameter, an \"accumulation of thunks\" can take place.  A thunk is an expression that is suspended and not yet evaluated.  To take a much simpler example, summing all the numbers from 0 to <code>n</code>:</p>\n\n<pre><code>tri :: Int -&gt; Int -&gt; Int\ntri 0 accum = accum\ntri n accum = tri (n-1) (accum + n)\n</code></pre>\n\n<p>If we trace the evaluation, we can see what's going on:</p>\n\n<pre><code>tri 3 0\n  = tri (3-1) (0+3)\n  = tri 2 (0+3)\n  = tri (2-1) ((0+3)+2)\n  = tri 1 ((0+3)+2)\n  = tri (1-1) (((0+3)+2)+1)\n  = tri 0 (((0+3)+2)+1)\n  = ((0+3)+2)+1     -- here is where ghc uses the C stack\n  = (0+3)+2        (+1) on stack\n  = 0+3            (+2) (+1) on stack\n  = 0              (+3) (+2) (+1) on stack\n  = 3              (+2) (+1) on stack\n  = 5              (+1) on stack\n  = 6             \n</code></pre>\n\n<p>This is a simplification of course, but it's an intuition that can help you understand both stack overflows and space leaks caused by thunk buildup.  GHC only evalues a thunk when it's needed. We ask whether the value of <code>n</code> is 0 each time through <code>tri</code> so there is no thunk buildup in that parameter, but nobody needs to know the value of <code>accum</code> until the very end, which might be a really huge thunk as you can see from the example.  In evaluating that huge thunk the stack can overflow.</p>\n\n<p>The solution is to make <code>tri</code> evaluate <code>accum</code> sooner. This is usually done using a <code>BangPattern</code> (but can be done with <code>seq</code> if you don't like extensions).</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\ntri :: Int -&gt; Int -&gt; Int\ntri 0 !accum = accum\ntri n !accum = tri (n-1) (accum + n)\n</code></pre>\n\n<p>The <code>!</code> before <code>accum</code> means \"evaluate this parameter at the moment of pattern matching\" (even though the pattern doesn't technically need to know its value).  Then we get this evaluation trace:</p>\n\n<pre><code>tri 3 0\n  = tri (3-1) (0+3)\n  = tri 2 3          -- we evaluate 0+3 because of the bang pattern\n  = tri (2-1) (3+2)\n  = tri 1 5\n  = tri (1-1) (5+1)\n  = tri 0 6\n  = 6\n</code></pre>\n\n<p>I hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 127093, "user_id": 69545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXXbv.jpg?s=128&g=1", "display_name": "Rainer Joswig", "link": "https://stackoverflow.com/users/69545/rainer-joswig"}, "edited": false, "score": 1, "creation_date": 1475827997, "post_id": 39911989, "comment_id": 67109354, "body": "Yep, note also that in some implementations the result of (sqrt 9.0) may be an integer."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1475837540, "post_id": 39911989, "comment_id": 67114977, "body": "as an illustration, <code>(- (floor 370222244442964) (floor 370222244442963))</code> is <code>1</code>, but <code>(- (floor 370222244442964.0) (floor 370222244442963.0))</code> is <code>0</code>."}], "tags": [], "owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "is_accepted": true, "score": 9, "last_activity_date": 1476174962, "last_edit_date": 1476174962, "creation_date": 1475826078, "answer_id": 39911989, "question_id": 39906812, "link": "https://stackoverflow.com/questions/39906812/number-type-boundaries-in-common-lisp-and-stack-flowing-over-in-ghci/39911989#39911989", "title": "Number type boundaries in Common LISP and Stack flowing over in GHCI", "body": "<p>Let's define an intermediate Common Lisp function:</p>\n\n<pre><code>(defun area (a b c)\n  (let ((s (/ (+ a b c) 2)))\n    (sqrt (* s (- s a) (- s b) (- s c)))))\n</code></pre>\n\n<p>Your tests give:</p>\n\n<pre><code>CL-USER&gt; (area 333 333 333)\n48016.344\n\nCL-USER&gt; (area 3333 3333 3333)\n4810290.0\n</code></pre>\n\n<p>In the second case, it should be clear that both the ceiling and floor are equal. This is not the case in Haskell where the second test, with 3333,  returns:</p>\n\n<pre><code>4810290.040910754\n</code></pre>\n\n<h3>Floating point</h3>\n\n<p>In Common Lisp, the value from which we take a square root is:</p>\n\n<pre><code>370222244442963/16 \n</code></pre>\n\n<p>This is because computations are made with rational numbers. Up to this point, the precision is maximal. However, <a href=\"http://clhs.lisp.se/Body/f_sqrt_.htm\" rel=\"nofollow\"><code>SQRT</code></a> is free to return either a rational, when possible, or an approximate result. As a special case, the result can be an integer on some implementations, as Rainer Joswig pointed out in a comment. It makes sense because both <em>integer</em> and <em>ratio</em> are disjoint subtypes of the <em>rational</em> type. But as your problem shows, some square roots are irrational (e.g. \u221a2), and in that case CL can return a float approximating the value (or a complex float).</p>\n\n<p>The relevant section regarding floats and mathematical functions is <a href=\"http://clhs.lisp.se/Body/12_acc.htm\" rel=\"nofollow\">12.1.3.3 Rule of Float Substitutability</a>. Long story short, the result is converted to a <code>single-float</code> when you compute the square root, which happens to loose some precision. In order to have a double, you have to be more explicit:</p>\n\n<pre><code>(defun area (a b c)\n   (let ((s (/ (+ a b c) 2)))\n     (sqrt (float (* s (- s a) (- s b) (- s c)) 0d0))))\n</code></pre>\n\n<p>I could also have used <code>(coerce ... 'double-float)</code>, but here\nI chose to call the <a href=\"http://clhs.lisp.se/Body/f_float.htm\" rel=\"nofollow\"><code>FLOAT</code></a> conversion function. The optional second argument is a float prototype, ie. a value of the target type. Above, it is <code>0d0</code>, a double float. You could also use <code>0l0</code> for long doubles or <code>0s0</code> for short. This parameter is useful if you want to have the same precision as an input float, but can be used with literals too, like in the example. The exact meaning of short, single, double or long float types is implementation-defined, but they shall respect <a href=\"http://www.lispworks.com/documentation/HyperSpec/Body/t_short_.htm\" rel=\"nofollow\">some rules</a>. Current implementations generally give more precision that the minimum required.</p>\n\n<pre><code>CL-USER&gt; (area 3333 3333 3333)\n4810290.040910754d0\n</code></pre>\n\n<p>Now, if I wanted to test if the result is integral, I would truncate the float and look if the second returned value, the remainder, is zero.</p>\n\n<pre><code>CL-USER&gt; (zerop (nth-value 1 (truncate 4810290.040910754d0)))\nNIL\n</code></pre>\n\n<h3>Arbitrary-precision</h3>\n\n<p>Note that regardless of the implementation language (Haskell, CL or another one) the approach is going to give incorrect results for some inputs, given how floats are represented. Indeed, the same problem you had with CL could arise for some inputs with more precise floats, where the result would be very close to an integer. You might need another mathematical approach or something like <a href=\"http://www.mpfr.org/\" rel=\"nofollow\">MPFR</a> for arbitrary precision floating point computations. SBCL ships with <code>sb-mpfr</code>:</p>\n\n<pre><code>CL-USER&gt; (require :sb-mpfr)\n(\"SB-MPFR\" \"SB-GMP\")\n\nCL-USER&gt; (in-package :sb-mpfr)\n#&lt;PACKAGE \"SB-MPFR\"&gt;\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>SB-MPFR&gt; (with-precision 256\n           (sqrt (coerce 370222244442963/16 'mpfr-float)))\n.4810290040910754427104204965311207243133723228299086361205561385039201180068712e+7\n-1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 6934417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b31cef1a04debff678e135674522ada5?s=128&d=identicon&r=PG&f=1", "display_name": "zweiblumen", "link": "https://stackoverflow.com/users/6934417/zweiblumen"}, "edited": false, "score": 0, "creation_date": 1475869695, "post_id": 39912542, "comment_id": 67133310, "body": "Thanks. I see it now."}], "tags": [], "owner": {"reputation": 127093, "user_id": 69545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXXbv.jpg?s=128&g=1", "display_name": "Rainer Joswig", "link": "https://stackoverflow.com/users/69545/rainer-joswig"}, "is_accepted": false, "score": 4, "last_activity_date": 1475827930, "creation_date": 1475827930, "answer_id": 39912542, "question_id": 39906812, "link": "https://stackoverflow.com/questions/39906812/number-type-boundaries-in-common-lisp-and-stack-flowing-over-in-ghci/39912542#39912542", "title": "Number type boundaries in Common LISP and Stack flowing over in GHCI", "body": "<p><strong>About style:</strong></p>\n\n<pre><code>(if (predicate? ...) t nil)\n</code></pre>\n\n<p>is just</p>\n\n<pre><code>(predicate? ...)\n</code></pre>\n\n<p>You are checking with your <code>IF</code>, if <code>T</code> is <code>T</code> and then return <code>T</code>. But <code>T</code> is already <code>T</code>, so you can just return it.</p>\n"}], "owner": {"reputation": 91, "user_id": 6934417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b31cef1a04debff678e135674522ada5?s=128&d=identicon&r=PG&f=1", "display_name": "zweiblumen", "link": "https://stackoverflow.com/users/6934417/zweiblumen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "accepted_answer_id": 39911989, "answer_count": 3, "score": 6, "last_activity_date": 1476174962, "creation_date": 1475794261, "last_edit_date": 1475845908, "question_id": 39906812, "link": "https://stackoverflow.com/questions/39906812/number-type-boundaries-in-common-lisp-and-stack-flowing-over-in-ghci", "title": "Number type boundaries in Common LISP and Stack flowing over in GHCI", "body": "<p>First question ever here, and newbie in both Common LISP and Haskell, please be kind.\nI have a function in Common LISP - code below - which is intended to tell whether the area of a triangle is an integral number (integer?).</p>\n\n<pre><code>(defun area-int-p (a b c)\n  (let* ((s (/ (+ a b c) 2))\n         (area (sqrt (* s (- s a) (- s b) (- s c)))))\n    (if (equal (ceiling area) (floor area))\n        t\n        nil)))\n</code></pre>\n\n<p>This is supposed to use <a href=\"https://en.wikipedia.org/wiki/Triangle#Using_Heron.27s_formula\" rel=\"nofollow\">Heron's formula</a> to calculate the area of the triangle, given the size of the three sides, and decide whether it is an integer comparing the ceiling and the floor. We are told that the area of an equilateral triangle is never an integer. Therefore, to test whether the function is working, I ran it with the arguments <code>333</code>. Here is what I got in return:</p>\n\n<pre><code>CL-USER&gt; (area-int-p 333 333 333)\nNIL\n</code></pre>\n\n<p>Perfect! It works. To test it even more, I ran it with the arguments <code>3333</code>. This is what I got in return:</p>\n\n<pre><code>CL-USER&gt; (area-int-p 3333 3333 3333)\nT\n</code></pre>\n\n<p>Something is wrong, this is not supposed to happen!\nSo, I try the following, hopefully equivalent Haskell function to see what happens:</p>\n\n<pre><code>areaIntP :: (Integral a) =&gt; a -&gt; a -&gt; a -&gt; Bool\nareaIntP a b c =\n  let aa = fromIntegral a\n      bb = fromIntegral b\n      cc = fromIntegral c\n      perimeter = aa + bb + cc\n      s = perimeter/2\n      area = sqrt(s * (s - aa) * (s - bb) * (s - cc))\n  in  if ceiling area == floor area\n      then True\n      else False\n</code></pre>\n\n<p>This is what I get:</p>\n\n<pre><code>*Main&gt; areaIntP 3333 3333 3333\nFalse\n*Main&gt; areaIntP 333 333 333\nFalse\n</code></pre>\n\n<p>Looks perfect. Encouraged by this, I use the below functions in Haskell to sum the perimeters of of isosceles triangles with the third side differing just one unit from the other sides, an integral area, and perimeter below 1,000,000,000.</p>\n\n<pre><code>toplamArtilar :: Integral a =&gt; a -&gt; a -&gt; a -&gt; a\ntoplamArtilar altSinir ustSinir toplam =\n  if ustSinir == altSinir\n  then toplam\n  else if areaIntP ustSinir ustSinir (ustSinir + 1) == True\n       then toplamArtilar altSinir (ustSinir - 1) (toplam + (3 * ustSinir + 1))\n       else toplamArtilar altSinir (ustSinir - 1) toplam\n\ntoplamEksiler :: Integral a =&gt; a -&gt; a -&gt; a -&gt; a\ntoplamEksiler altSinir ustSinir toplam =\n  if ustSinir == altSinir\n  then toplam\n  else if areaIntP ustSinir ustSinir (ustSinir - 1) == True\n       then toplamEksiler altSinir (ustSinir - 1) (toplam + (3 * ustSinir - 1))\n       else toplamEksiler altSinir (ustSinir - 1) toplam\n\nsonuc altSinir ustSinir =\n  toplamEksiler altSinir ustSinir (toplamArtilar altSinir ustSinir 0)\n</code></pre>\n\n<p>(<code>ustSinir</code> means upper limit, <code>altSinir</code> lower limit by the way.)\nRunning <code>sonuc</code> with the arguments <code>2</code> and <code>333333333</code> however, my stack flows over. Runnning the equivalent functions in Common LISP the stack is OK, but <code>area-int-p</code> function is not reliable, probably because of the boundaries of the number type the interpreter deduces.\nAfter all this, my question is two-fold:</p>\n\n<p>1) How do I get round the problem in the Common LISP function <code>area-int-p</code>?</p>\n\n<p>2) How do I prevent the stack overflow with the Haskell functions above, either within Emacs or with GHCi run from the terminal?</p>\n\n<p>Note for those who figure out what I am trying to achieve here: please don't tell me to use Java <code>BigDecimal</code> and <code>BigInteger</code>. </p>\n\n<p>Edit after very good replies: I asked two questions in one, and received perfectly satisfying, newbie friendly answers and a note on style from very helpful people. Thank you.</p>\n"}, {"tags": ["haskell", "scripting", "libraries"], "answers": [{"comments": [{"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "edited": false, "score": 0, "creation_date": 1475835590, "post_id": 39909246, "comment_id": 67113835, "body": "Thanks, this is very helpful. The <a href=\"http://hackage.haskell.org/package/open-browser\" rel=\"nofollow noreferrer\">package</a> refers to a Github repo which does not exist, while <a href=\"https://github.com/yamadapc/open-browser\" rel=\"nofollow noreferrer\">this repo</a> seems to match the package"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1475813406, "creation_date": 1475813406, "answer_id": 39909246, "question_id": 39906079, "link": "https://stackoverflow.com/questions/39906079/are-there-haskell-equivalents-for-the-webbrowser-python-package/39909246#39909246", "title": "Are there Haskell equivalents for the `webbrowser` Python package?", "body": "<p>There is a package named <a href=\"https://www.stackage.org/haddock/lts-7.2/open-browser-0.2.1.0/Web-Browser.html\" rel=\"nofollow\">open-browser</a>:</p>\n\n<pre><code>$ stack ghci open-browser\nRun from outside a project, using implicit global project config\nUsing resolver: lts-6.14 from implicit global project's config file: /home/sibi/.stack/global-project/stack.yaml\nopen-browser-0.2.1.0: using precompiled package\nConfiguring GHCi with the following packages:\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n\u03bb&gt; import Web.Browser\n\u03bb&gt; openBrowser \"https://www.google.com\"\nTrue\n</code></pre>\n\n<p>This opens the google page in my default browser Firefox.</p>\n"}], "owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "closed_date": 1475827943, "accepted_answer_id": 39909246, "answer_count": 1, "score": 1, "last_activity_date": 1475835232, "creation_date": 1475790351, "last_edit_date": 1475835232, "question_id": 39906079, "link": "https://stackoverflow.com/questions/39906079/are-there-haskell-equivalents-for-the-webbrowser-python-package", "closed_reason": "Not suitable for this site", "title": "Are there Haskell equivalents for the `webbrowser` Python package?", "body": "<p>Python has the very convenient <code>webbrowser</code> package, which includes a <code>webbrowser.open()</code> function which allows to open a browser on a location, even on a file in the local filesystem. This way Python programs can for example generate a web document as an output and present it to the user. Which Haskell packages expose a similar functionality?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6934294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f238e6f550f2fea71df2c1e53e4903c?s=128&d=identicon&r=PG&f=1", "display_name": "Matt1234", "link": "https://stackoverflow.com/users/6934294/matt1234"}, "edited": false, "score": 0, "creation_date": 1475788528, "post_id": 39905668, "comment_id": 67096942, "body": "oh ofcourse haha. Upon making the change to &#39;, it returns NaN when I try to use the function. Do you have any idea what&#39;s causing that?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1, "user_id": 6934294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f238e6f550f2fea71df2c1e53e4903c?s=128&d=identicon&r=PG&f=1", "display_name": "Matt1234", "link": "https://stackoverflow.com/users/6934294/matt1234"}, "edited": false, "score": 2, "creation_date": 1475789092, "post_id": 39905668, "comment_id": 67097193, "body": "@Matt You are calling sqrt with negative arguments (your formula is wrong)."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 2, "last_activity_date": 1475788152, "creation_date": 1475788152, "answer_id": 39905668, "question_id": 39905594, "link": "https://stackoverflow.com/questions/39905594/haskell-error-parse-error-on-input/39905668#39905668", "title": "Haskell: error: parse error on input \u2018,\u2019", "body": "<p>You are using backticks, `, rather than single quotes, '. Backticks allow you to use an identifier in an infix position, e.g.,</p>\n\n<pre><code>x `elem` xs\n</code></pre>\n\n<p>while single quotes are a valid character in an identifier, e.g.,</p>\n\n<pre><code>(x', y')\n</code></pre>\n\n<p>Note that they are also used for character literals, e.g., <code>'a'</code>, so you can't begin an identifier with a single quote.</p>\n"}], "owner": {"reputation": 1, "user_id": 6934294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f238e6f550f2fea71df2c1e53e4903c?s=128&d=identicon&r=PG&f=1", "display_name": "Matt1234", "link": "https://stackoverflow.com/users/6934294/matt1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 39905668, "answer_count": 1, "score": -2, "last_activity_date": 1475788152, "creation_date": 1475787835, "question_id": 39905594, "link": "https://stackoverflow.com/questions/39905594/haskell-error-parse-error-on-input", "title": "Haskell: error: parse error on input \u2018,\u2019", "body": "<pre><code>type Vertex = (Float, Float)\n\ndistance :: Vertex -&gt; Vertex -&gt; Float\ndistance (x, y) (x`, y`)\n   = (sqrt ((x^2 - x`^2) + (y^2 - y`^2)))\n</code></pre>\n\n<p>hey for distance between two vertices, I get the error \"error: parse error on input \u2018,\u2019\"</p>\n\n<p>Sorry very basic :) Thanks in advance. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475821327, "post_id": 39901953, "comment_id": 67105936, "body": "This question strikes me as rather peculiar. Why do you want such a thing? Records aren&#39;t usually what you want for such an operation. Perhaps you want length-indexed vectors?"}], "answers": [{"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1475774285, "post_id": 39902028, "comment_id": 67089462, "body": "Aha pattern matching to extract the values seems like a much better solution to me. Thanks! I&#39;ll leave this question open for awhile to see if it attracts any other answers as well since you hit it after ~5 minutes."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1475774324, "post_id": 39902028, "comment_id": 67089486, "body": "Could you expand on that second part? It seems useful but I&#39;ve never seen it before."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475774649, "post_id": 39902028, "comment_id": 67089665, "body": "You could use <code>RecordWildCards</code> as in <code>allFooEqual (Foo {..}) = all (a==) [b,c,d]</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1475775591, "post_id": 39902028, "comment_id": 67090173, "body": "@jkeuhlen I added something, but scrap-your-boilerplate can not be summarized easily. If you want to learn it, there should be good tutorials around, but be prepared for a non-trivial journey. I&#39;d do without it, when possible."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475775714, "post_id": 39902028, "comment_id": 67090237, "body": "@ThomasM.DuBuisson I&#39;m not a big fan of that extension, since it shadows the accessors, and can only be used when you have a single record in scope."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1475775398, "last_edit_date": 1475775398, "creation_date": 1475774119, "answer_id": 39902028, "question_id": 39901953, "link": "https://stackoverflow.com/questions/39901953/how-to-check-if-all-values-in-a-custom-type-are-equal/39902028#39902028", "title": "How to check if all values in a custom type are equal", "body": "<p>An alternative:</p>\n\n<pre><code>allFooEqual :: Foo -&gt; Bool\nallFooEqual (Foo xa xb xc xd) = all (xa==) [xb,xc,xd]\n</code></pre>\n\n<p>This will compare <code>xa == xb &amp;&amp; xa == xc &amp;&amp; xa == xd</code>.</p>\n\n<p>Another:</p>\n\n<pre><code>atMostOne :: Eq a =&gt; [a] -&gt; Bool\natMostOne xs = and $ zipWith (==) xs (drop 1 xs)\n\nallFooEqual :: Foo -&gt; Bool\nallFooEqual (Foo xa xb xc xd) = atMostOne [xa,xb,xc,xd]\n</code></pre>\n\n<p>This will compare <code>xa == xb &amp;&amp; xb == xc &amp;&amp; xc == xd</code>.</p>\n\n<p>Accessing \"all the <code>Int</code>s in a <code>Foo</code>\" can be done exploiting the scrap-your-boilerplate framework, or GHC Generics, but it looks overkill unless you really have a lot of fields.</p>\n\n<pre><code>allFooEqual :: Foo -&gt; Bool\nallFooEqual f = atMostOne [ x \n   | Just x &lt;- gmapQ (mkQ Nothing (Just :: Int -&gt; Maybe Int)) f ]\n</code></pre>\n\n<p>There's so much type level stuff here that I strongly recommend against it unless it is really, really needed.</p>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1475854348, "last_edit_date": 1475854348, "creation_date": 1475818963, "answer_id": 39910186, "question_id": 39901953, "link": "https://stackoverflow.com/questions/39901953/how-to-check-if-all-values-in-a-custom-type-are-equal/39910186#39910186", "title": "How to check if all values in a custom type are equal", "body": "<p>This is obviously overkill, but here is a <code>GHC.Generics</code> based solution that lets you automatically generate a typeclass <code>FieldsMatch</code> which provides such a function <code>fieldsMatch :: FieldsMatch a =&gt; a -&gt; Bool</code> that returns true if all the fields of the same type in your record have the same value.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, ExistentialQuantification, DefaultSignatures, \n      FlexibleContexts #-}\nmodule FieldsMatch (FieldsMatch(..)) where\n\nimport GHC.Generics\nimport Data.Typeable\n\n-- `Some` is an existential type that we need to store each field\ndata Some = forall a. (Eq a, Typeable a) =&gt; Some a\n\n-- This is the class we will be deriving\nclass FieldsMatch a where\n  -- in general, this is the type of `fieldsMatch`...\n  fieldsMatch :: a -&gt; Bool\n\n  -- ... except the default implementation has slightly different constraints.\n  default fieldsMatch :: (Generic a, GetFields (Rep a)) =&gt; a -&gt; Bool\n  fieldsMatch = noneDiffering . getFields . from\n    where\n      noneDiffering :: [Some] -&gt; Bool\n      noneDiffering [] = True\n      noneDiffering (x:xs) = all (notDiffering x) xs &amp;&amp; noneDiffering xs\n\n      notDiffering :: Some -&gt; Some -&gt; Bool\n      Some x `notDiffering` Some y = case cast y of\n        Nothing -&gt; True\n        Just z -&gt; x == z\n\nclass GetFields f where\n  -- | This function takes the generic representation of a datatype and\n  -- recursively traverses it to collect all its fields. These need to\n  -- have types satisfying `Eq` and `Typeable`.\n  getFields :: f a -&gt; [Some]\n\ninstance (GetFields a, GetFields b) =&gt; GetFields (a :*: b) where\n  getFields (l :*: r) = getFields l ++ getFields r\n\ninstance (GetFields a, GetFields b) =&gt; GetFields (a :+: b) where\n  getFields (L1 l) = getFields l\n  getFields (R1 r) = getFields r\n\ninstance GetFields U1 where\n  getFields U1 = []\n\ninstance (Typeable a, Eq a) =&gt; GetFields (K1 i a) where\n  getFields (K1 x) = [Some x]\n\ninstance GetFields a =&gt; GetFields (M1 i t a) where\n  getFields (M1 x) = getFields x\n\n  default fieldsMatch :: (Generic a, GetFields (Rep a)) =&gt; a -&gt; Bool\n  fieldsMatch = noneDiffering . getFields . from\n    where\n      noneDiffering :: [Some] -&gt; Bool\n      noneDiffering [] = True\n      noneDiffering (x:xs) = all (notDiffering x) xs || noneDiffering xs\n\n      notDiffering :: Some -&gt; Some -&gt; Bool\n      Some x `notDiffering` Some y = case cast y of\n        Nothing -&gt; True\n    Just z -&gt; x == z\n</code></pre>\n\n<p>You can try this out in GHCi:</p>\n\n<pre><code>ghci&gt; :set -XDeriveGeneric\nghci&gt; data Foo b = Foo Int Int b Bool deriving (Generic)\nghci&gt; instance (Eq b, Typeable b) =&gt; FieldsMatch (Foo b)\nghci&gt; Foo 1 1 True True -- fields of the same type are equal\nTrue\nghci&gt; Foo 1 2 True (1,2) -- 1 /= 2 even though they are the same type\nFalse \n</code></pre>\n"}], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 39902028, "answer_count": 2, "score": 1, "last_activity_date": 1475854348, "creation_date": 1475773848, "last_edit_date": 1475774692, "question_id": 39901953, "link": "https://stackoverflow.com/questions/39901953/how-to-check-if-all-values-in-a-custom-type-are-equal", "title": "How to check if all values in a custom type are equal", "body": "<p>I'm searching for a better way to check if all of the values of a given type are equal. </p>\n\n<p>For example, consider:</p>\n\n<pre><code>data Foo = Foo {a :: Int, b :: Int, c :: Int, d :: Int}\n\nallFooEqual :: Foo -&gt; Bool\nallFooEqual foo = (a foo == b foo) &amp;&amp; (a foo == c foo) &amp;&amp; (a foo == d foo)\n</code></pre>\n\n<p>This works, but it isn't exactly a scaleable solution. Is there a more idiomatic way to perform this type of action that I'm missing? </p>\n"}, {"tags": ["haskell", "operator-precedence", "frege"], "answers": [{"comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 2, "creation_date": 1475774040, "post_id": 39901104, "comment_id": 67089324, "body": "The type diffeence in Frege is probably because the AMP (or an even more radical Monad class hierarchy) was implemented right from the start there, years before it was done in GHC. I ask you kindly to consider whether it is fair to deny Frege the &quot;Haskell property&quot; on this ground. In this strong sense, no post-AMP Haskell program is actually written in Haskell. This makes no sense, IMHO. (To be sure, I&#39;m aware that there are other reasons to deny Frege the full Haskell-ship.)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1475777671, "post_id": 39901104, "comment_id": 67091319, "body": "@Ingo: I was attempting to say &quot;Frege is not Haskell, therefore it is unsurprising that it would be different; and indeed, it is different in these ways.&quot;  In other words, I would put the causality the other way around :-)  The &quot;Haskell property&quot; comment was a comment about English-language usage: Frege is the only language I&#39;ve seen described as &quot;a Haskell&quot;, so that&#39;s an unusual way to describe it, and I thought that was important to call out as a potential source of confusion."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 1, "creation_date": 1475778608, "post_id": 39901104, "comment_id": 67091855, "body": "I have to admit that I&#39;m not 100% happy with the &quot;Haskell for JVM&quot; slogan either, that is one reason why I choose a different name in the first place. But it was actually SPJ himself who encouraged us to be more offensive in this regard, dismissing the (still existing) differences as negligible. I also agree that the &quot;a&quot; may be a bit disturbing."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1475783210, "post_id": 39901104, "comment_id": 67094298, "body": "@Ingo: I&#39;m sorry, I didn&#39;t realize that <i>you</i> were the author of Frege!  To be super clear about what I was saying: I don&#39;t <i>object</i> to the naming <i>per se</i> \u2013 I don&#39;t know enough to have an opinion \u2013 I just thought that it was perhaps confusing, particularly in the context of this question.  I don&#39;t know enough to decide whether or not Frege has &quot;the full Haskell-ship&quot;; you&#39;re rather more of an expert than I am :-)"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 1, "creation_date": 1475784282, "post_id": 39901104, "comment_id": 67094838, "body": "Hey, no need to be sorry, I didn&#39;t take any offence! As I said, I know very well that Frege is not there yet. For the record, I initially came up with &quot;Frege, a pure functional language for the JVM in the spirit of Haskell&quot; but this was dismissed later on the ground that it might indicate a rivalry towards Haskell. But to the contrary! My objective was, of course, to be as &quot;haskellish&quot; as possible. OTOH, this wouldn&#39;t imply copying already exposed shortcomings in Haskell, like Monad not being an Applicative, etc."}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 6, "last_activity_date": 1475770982, "creation_date": 1475770982, "answer_id": 39901104, "question_id": 39898771, "link": "https://stackoverflow.com/questions/39898771/haskell-frege-and-associativity/39901104#39901104", "title": "Haskell/Frege &lt;=&lt; and =&lt;&lt; associativity", "body": "<p>Frege is <em>like</em> Haskell, but Frege is <em>not</em> Haskell.  And in Frege, the fixities of those operators are different: <a href=\"http://www.frege-lang.org/doc/frege/prelude/PreludeMonad.html#$eq$lt$lt\" rel=\"noreferrer\"><code>=&lt;&lt;</code> is <code>infixr 2</code></a> and <a href=\"http://www.frege-lang.org/doc/frege/prelude/PreludeMonad.html#$lt$eq$lt\" rel=\"noreferrer\"><code>&lt;=&lt;</code> is <code>infixr 3</code></a>.  So since <code>&lt;=&lt;</code> has lower precedence, <code>bar &lt;=&lt; baz =&lt;&lt; foo</code> is naturally parsed as <code>(bar &lt;=&lt; baz) =&lt;&lt; foo</code>.</p>\n\n<p>(In fact, <code>=&lt;&lt;</code> and <code>&lt;=&lt;</code> have different <em>types</em> in Frege than they do in Haskell: instead of a <code>Monad</code> constraint, they have a <a href=\"http://www.frege-lang.org/doc/frege/prelude/PreludeMonad.html#Bind\" rel=\"noreferrer\"><code>Bind</code></a> constraint, where <code>Bind</code> is like <code>Monad</code> without <code>pure</code>/<code>return</code>.)</p>\n\n<hr>\n\n<p>Yes, <a href=\"https://github.com/Frege/frege\" rel=\"noreferrer\">Frege describes itself</a> as \"a Haskell for the JVM\", but they mean \"<em>a</em> Haskell\" in the sense that Common Lisp is a Lisp, and Scheme is a Lisp, and Clojure is a Lisp.  It's odd to see \"Haskell\" used in that way; it would be more normal to see \"a Haskell-like language for the JVM\", or something stronger.  But Frege is so similar that I can see why.</p>\n\n<hr>\n\n<p>Also, you're right: that <em>does</em> appear to be a bug in <a href=\"https://github.com/bmillwood/pointfree\" rel=\"noreferrer\"><code>pointfree</code></a> (the program that backs <a href=\"http://pointfree.io\" rel=\"noreferrer\">pointfree.io</a>)!  <code>pointfree</code> is supposed to generate <em>Haskell</em> code, not Frege, so the fact that that transformation is invalid means it's doing the wrong thing.</p>\n"}], "owner": {"reputation": 1343, "user_id": 4480394, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-QwHzVkP4n0Y/AAAAAAAAAAI/AAAAAAAAAGo/xwQ_WdtwEjQ/photo.jpg?sz=128", "display_name": "Mona the Monad", "link": "https://stackoverflow.com/users/4480394/mona-the-monad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 39901104, "answer_count": 1, "score": 5, "last_activity_date": 1475770982, "creation_date": 1475764349, "question_id": 39898771, "link": "https://stackoverflow.com/questions/39898771/haskell-frege-and-associativity", "title": "Haskell/Frege &lt;=&lt; and =&lt;&lt; associativity", "body": "<p>According to Hoogle, the fixity of <code>&lt;=&lt;</code> (Kleisli monad composition, or \"left fish\") and <code>=&lt;&lt;</code> (reverse monad bind) is <code>infixr 1</code>. If I'm looking at them correctly, an expression like, say</p>\n\n<pre><code>print &lt;=&lt; return =&lt;&lt; return \"foo\"\n</code></pre>\n\n<p>should be invalid, since it would've been equivalent to the equally invalid</p>\n\n<pre><code>print &lt;=&lt; (return =&lt;&lt; return \"foo\")\n</code></pre>\n\n<p>But for some reason, though the first expression seems to be invalid in Haskell, as expected, Frege seems to have no complaints, and evaluates <code>&lt;=&lt;</code> before the <code>=&lt;&lt;</code>.</p>\n\n<p>I discovered this when I was messing around on pointfree.io to figure out how to make something like</p>\n\n<pre><code>foo &gt;&gt;= (bar &lt;=&lt; baz)\n</code></pre>\n\n<p>point-free, and it gave me</p>\n\n<pre><code>bar &lt;=&lt; baz =&lt;&lt; foo\n</code></pre>\n\n<p>which doesn't look quite right, considering the fixities.</p>\n"}, {"tags": ["haskell", "fold", "maybe", "monoids"], "answers": [{"comments": [{"owner": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "edited": false, "score": 0, "creation_date": 1475750796, "post_id": 39893463, "comment_id": 67073564, "body": "Cool, thanks for pointing that out, that definitely seems more idiomatic. So I could write  <code>sum&#39; = (liftA getSum) . foldMap (liftA Sum)</code>. However, this means that if I do want to reuse some code that uses <code>sum&#39;</code> where there are no missing values, I still have to wrap the values in Maybe first, right? (Not saying that it would be terrible if that were the case, just checking...)"}, {"owner": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "edited": false, "score": 0, "creation_date": 1475750875, "post_id": 39893463, "comment_id": 67073607, "body": "Also, how would I go about using this approach with another operation, such as for example getting the minimum/maximum value of the list? (And also suppose that I wanted both, a lenient and a strict version, like in my example. If you could show how to do that, I would be happy to accept the answer!)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "edited": false, "score": 1, "creation_date": 1475751817, "post_id": 39893463, "comment_id": 67074213, "body": "Not sure if it&#39;s possible to apply the same function to <code>[a]</code> and <code>[Maybe a]</code> and get the same type of result. What if <code>a</code> is <code>Maybe b</code>?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "edited": false, "score": 0, "creation_date": 1475752537, "post_id": 39893463, "comment_id": 67074670, "body": "You can use <code>liftA Product</code> for example. <code>Min</code> is not a monoid (what&#39;s a minimum of the empty list?) but you can write your own Min-like wrapper so that <code>Maybe (MyMin a)</code> is a monoid, and use <code>liftA MyMin</code> for a foldable of maybes."}, {"owner": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "edited": false, "score": 0, "creation_date": 1475754949, "post_id": 39893463, "comment_id": 67076234, "body": "Yes, fair point about the type ambiguity, I suppose that&#39;s at the root of the overlapping instances in my solution. You are also right about <code>Min</code> not being a <code>Monoid</code>, so there is another thing I probably should not have put in the title. The point is that it doesn&#39;t have to be a Monoid, because on an empty list the result can be <code>Nothing</code>. Your answer has helped me understand the problem better, and I have now implemented a pretty good solution using <code>Data.Semigroup</code> (see edit). Unless any other clever solution comes up, I will accept it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "edited": false, "score": 0, "creation_date": 1475785532, "post_id": 39893463, "comment_id": 67095559, "body": "@kloffy If you believe you have a better solution, the correct way to indicate this is to write it as an answer and accept it, not to edit the solution into the question. (Answering your own question is not considered impolite here on SO.)"}, {"owner": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475814892, "post_id": 39893463, "comment_id": 67103792, "body": "@DanielWagner Thanks for pointing that out! I still think this is the right answer to accept, since the code in my edit is a variation on the basic approach suggested here (just a slightly more general one). I just wanted to document it for others that might be interested."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 5, "last_activity_date": 1475753258, "last_edit_date": 1475753258, "creation_date": 1475749321, "answer_id": 39893463, "question_id": 39892550, "link": "https://stackoverflow.com/questions/39892550/fold-a-foldable-of-maybe-monoid-ignoring-the-missing-values-in-haskell/39893463#39893463", "title": "Fold a Foldable of Maybe (Monoid) ignoring the missing values in Haskell", "body": "<p>There is an instance of <code>Monoid</code> that does exactly the right thing:</p>\n\n<pre><code>instance Monoid a =&gt; Monoid (Maybe a) where\n  mempty = Nothing\n  Nothing `mappend` m = m\n  m `mappend` Nothing = m\n  Just m1 `mappend` Just m2 = Just (m1 `mappend` m2)\n</code></pre>\n\n<p>It's in <code>Data.Monoid</code>.</p>\n\n<p>Thus,</p>\n\n<pre><code>foldMap (liftA Sum) [Just 1, Nothing, Just 2, Nothing, Just 3] = \n   fold [Just (Sum 1), Nothing, Just (Sum 2), Nothing, Just (Sum 3)] = \n      Just (Sum 6)\n</code></pre>\n\n<p>For strict left-folding versions, instead of <code>fold</code> one can use <code>foldl' mappend mempty</code>, and instead of <code>foldMap f</code> use <code>foldl' (mappend . f) mempty</code>. In the <code>Maybe</code> monoid, <code>mempty</code> is <code>Nothing</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "edited": false, "score": 0, "creation_date": 1475752278, "post_id": 39894306, "comment_id": 67074494, "body": "Yes, I was aware of <code>catMaybes</code>, but it didn&#39;t quite feel like it was getting to the root of the problem. For example, suppose instead of just a plain sum I wanted to do a cumulative sum and just keep adding zeros for the Nothing elements? (Although, in that case I suppose I shouldn&#39;t have said fold in the tile, my mistake.)"}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 1, "last_activity_date": 1475751882, "creation_date": 1475751882, "answer_id": 39894306, "question_id": 39892550, "link": "https://stackoverflow.com/questions/39892550/fold-a-foldable-of-maybe-monoid-ignoring-the-missing-values-in-haskell/39894306#39894306", "title": "Fold a Foldable of Maybe (Monoid) ignoring the missing values in Haskell", "body": "<p>How about just using <code>catMaybes</code> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html\" rel=\"nofollow\"><code>Data.Maybe</code></a> to discard all the <code>Nothing</code> values? Then you can run any aggregations and calculations on a list of just plain values.</p>\n"}], "owner": {"reputation": 2878, "user_id": 191584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f5f4f7f52bd218b462400abf6c8e3065?s=128&d=identicon&r=PG", "display_name": "kloffy", "link": "https://stackoverflow.com/users/191584/kloffy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 0, "accepted_answer_id": 39893463, "answer_count": 2, "score": 3, "last_activity_date": 1475756227, "creation_date": 1475746677, "last_edit_date": 1495541954, "question_id": 39892550, "link": "https://stackoverflow.com/questions/39892550/fold-a-foldable-of-maybe-monoid-ignoring-the-missing-values-in-haskell", "title": "Fold a Foldable of Maybe (Monoid) ignoring the missing values in Haskell", "body": "<p>I am working with some data that has missing values, which is simply represented as lists of Maybe values. I would like to perform various aggregates/statistical operations, which simply ignore the missing values.</p>\n\n<p>This is related to the following questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/20034756/idiomatic-way-to-sum-a-list-of-maybe-int-in-haskell\">Idiomatic way to sum a list of Maybe Int in haskell</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/19706501/how-to-use-the-maybe-monoid-and-combine-values-with-a-custom-operation-easily\">How to use the maybe monoid and combine values with a custom operation, easily?</a></p>\n\n<p>However, the former question is content with returning <code>Nothing</code> if any value is missing, which is not an option in my case. I have a solution which involves creating a <code>Num</code> instance for <code>Maybe</code>. However, that means it is specific to addition and multiplication and it has some other problems, too.</p>\n\n<pre><code>instance Num a =&gt; Num (Maybe a) where\n  negate      = fmap negate\n  (+)         = liftA2 (+)\n  (*)         = liftA2 (*)\n  fromInteger = pure . fromInteger\n  abs         = fmap abs\n  signum      = fmap signum\n</code></pre>\n\n<p>Based on that, we can do something like this:</p>\n\n<pre><code>maybeCombineW :: (a -&gt; a -&gt; a) -&gt; Maybe a -&gt; Maybe a -&gt; Maybe a\nmaybeCombineW f (Just x)  (Just y)  = Just (f x y)\nmaybeCombineW _ (Just x)  Nothing   = Just x\nmaybeCombineW _ Nothing   (Just y)  = Just y\nmaybeCombineW _ Nothing   Nothing   = Nothing\n\n\nmaybeCombineS :: (a -&gt; a -&gt; a) -&gt; Maybe a -&gt; Maybe a -&gt; Maybe a\nmaybeCombineS f (Just x)  (Just y)  = Just (f x y)\nmaybeCombineS _ _          _        = Nothing\n\n\nclass (Num a) =&gt; Num' a where\n  (+?) :: a -&gt; a -&gt; a\n  (*?) :: a -&gt; a -&gt; a\n  (+!) :: a -&gt; a -&gt; a\n  (*!) :: a -&gt; a -&gt; a\n  (+?) = (+)\n  (*?) = (*)\n  (+!) = (+)\n  (*!) = (*)\n\ninstance {-# OVERLAPPABLE  #-} (Num a) =&gt; Num' a\ninstance {-# OVERLAPPING  #-} (Num' a) =&gt; Num' (Maybe a) where\n  (+?) = maybeCombineW (+?)\n  (*?) = maybeCombineW (*?)\n  (+!) = maybeCombineS (+!)\n  (*!) = maybeCombineS (*!)\n\n\nsum' :: (Num' b, Foldable t) =&gt; t b -&gt; b\nsum' = foldr (+?) 0\n\nsum'' :: (Num' b, Foldable t) =&gt; t b -&gt; b\nsum'' = foldr (+!) 0\n</code></pre>\n\n<p>What I like about this: It gives me two functions, a lenient <code>sum'</code> and a strict <code>sum''</code>, from which I can choose as needed. I can use the same functions to sum any <code>Num</code> instances, so I can reuse the same code for lists without <code>Maybe</code> without converting them first.</p>\n\n<p>What I don't like about this: The instance overlap. Also, for any operation other than addition and multiplication, I have to specify a new type class and make new instances.</p>\n\n<p>Therefore, I was wondering whether it is somehow possible to get a nice and general solution, perhaps along the lines suggested in the second question, which treats <code>Nothing</code> as the <code>mempty</code> for any operation in question.</p>\n\n<p>Is there a nice idiomatic way of doing this?</p>\n\n<p><em>Edit:</em> Here is the best solution so far:</p>\n\n<pre><code>inout i o = ((fmap o) . getOption) . foldMap (Option . (fmap i))\nsum' = Sum `inout` getSum\nmin' = Min `inout` getMin\n-- etc.\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1475744204, "creation_date": 1475744204, "answer_id": 39891729, "question_id": 39891409, "link": "https://stackoverflow.com/questions/39891409/simple-pattern-matching-in-haskell/39891729#39891729", "title": "Simple pattern matching in Haskell", "body": "<p>When you write in GHCi</p>\n\n<pre><code>&gt; let x = 4\n&gt; let x = 5\n</code></pre>\n\n<p>the second definition overrides the first one, removing it from the environment. This also holds for functions.</p>\n\n<pre><code>&gt; let f 0 = 1\n&gt; let f n = 1 + f (n-1)\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>&gt; let f n = 1 + f (n-1)\n</code></pre>\n\n<p>which will recurse forever on any input.</p>\n\n<p>In GHCi, you can have both using</p>\n\n<pre><code>&gt; let f 0 = 1 ; f n = 1 + f (n-1)\n</code></pre>\n\n<p>but the best approach is to edit a <code>.hs</code> file, write your definitions there, and then load it in GHCi.</p>\n"}], "owner": {"reputation": 61, "user_id": 5769445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c16d1c1d7854542c53f6b3d431af2872?s=128&d=identicon&r=PG&f=1", "display_name": "Cpcp Cp", "link": "https://stackoverflow.com/users/5769445/cpcp-cp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 39891729, "answer_count": 1, "score": 0, "last_activity_date": 1475749223, "creation_date": 1475743246, "last_edit_date": 1475749223, "question_id": 39891409, "link": "https://stackoverflow.com/questions/39891409/simple-pattern-matching-in-haskell", "title": "Simple pattern matching in Haskell", "body": "<p>I'm a beginner in Haskell, and I tried entering the following in WinGHCi:</p>\n\n<pre><code>Prelude&gt; factorial 0=1\nPrelude&gt; factorial n=n*factorial (n-1)\nPrelude&gt; factorial 5\n</code></pre>\n\n<p>But when I did this, WinGHCi got stuck and didn't do anything.  Why didn't it print out the factorial of 5?</p>\n"}, {"tags": ["haskell", "type-constraints", "type-families"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1475741683, "post_id": 39890638, "comment_id": 67067594, "body": "Why not just have <code>doSmth :: Eq (Foo a) =&gt; Proxy a -&gt; Foo a -&gt; Bool</code>? Furthermore, with your current definition for <code>Bar</code>, you could even have <code>doSmth :: Bar a =&gt; Proxy a -&gt; Foo a -&gt; Bool</code>..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1475742228, "post_id": 39890638, "comment_id": 67067940, "body": "FTR, this does <i>not</i> work in GHC-7.10.2. (In fact I&#39;m surprised that it ever worked at all.) <code>Foo</code> doesn&#39;t actually pack any constraints, these come all from the <code>Bar</code> class head (which <code>Foo</code> doesn&#39;t have access to). \u2014 If you have these constraints hidden under existential quantification (GADTs, I presume) then what&#39;s the problem unpacking them with a GADT case pattern match?"}, {"owner": {"reputation": 257, "user_id": 4684686, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c5c42cb8794518f6a295e9c8667cff17?s=128&d=identicon&r=PG", "display_name": "Martoon", "link": "https://stackoverflow.com/users/4684686/martoon"}, "edited": false, "score": 0, "creation_date": 1475746681, "post_id": 39890638, "comment_id": 67070993, "body": "Somehow, when I extracted <code>Foo a</code> from <code>GADT</code>, constaint <code>Bar a</code> got lost (although I had this constraint in GADT type). But after some magic at GADT extraction site it became working, I&#39;ve no idea why )  Thanks for help ^^"}], "owner": {"reputation": 257, "user_id": 4684686, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c5c42cb8794518f6a295e9c8667cff17?s=128&d=identicon&r=PG", "display_name": "Martoon", "link": "https://stackoverflow.com/users/4684686/martoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 143, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475740820, "creation_date": 1475740820, "question_id": 39890638, "link": "https://stackoverflow.com/questions/39890638/set-constraint-on-type-family-in-ghc-8", "title": "Set constraint on type family in GHC 8", "body": "<p>Suppose I have the following code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Eq (Foo a) =&gt; Bar a where\n    type Foo a :: *\n\ndoSmth:: Proxy a -&gt; Foo a -&gt; Bool\ndoSmth _ a = a == a\n</code></pre>\n\n<p>In GHC 7 it works fine, but GHC 8 complains:</p>\n\n<pre><code>\u2022 No instance for (Eq (Foo a)) arising from a use of \u2018==\u2019\n\u2022 In the expression: a == a\n  In an equation for \u2018doSmth\u2019: doSmth _ a = a == a\n</code></pre>\n\n<p>How can I say that <code>Foo a</code> is always instance of <code>Eq</code>?</p>\n"}, {"tags": ["haskell", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1475737236, "post_id": 39886919, "comment_id": 67065090, "body": "The fact that second example doesn&#39;t compile is really annoying."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1475728719, "last_edit_date": 1475728719, "creation_date": 1475723437, "answer_id": 39886919, "question_id": 39885474, "link": "https://stackoverflow.com/questions/39885474/injective-type-families-and-constraints/39886919#39886919", "title": "Injective type families and constraints", "body": "<p>The best I know how to do is</p>\n\n<pre><code>type family FI a\ntype D s = (s ~ F (FI s), C (FI s))\n</code></pre>\n\n<p>You'll have to form the (possibly partial) section <code>FI</code> yourself, so I don't think the injective type family really helps. Injective type families seem quite limited and unnatural at this point. To take an obvious example, GHC won't even accept that they're injective!</p>\n\n<pre><code>blah :: F a ~ F b =&gt; a :~: b\nblah = Refl\n</code></pre>\n\n<p>does not pass the type checker.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1475728719, "creation_date": 1475712002, "question_id": 39885474, "link": "https://stackoverflow.com/questions/39885474/injective-type-families-and-constraints", "title": "Injective type families and constraints", "body": "<p>Lets say we've got some existing class or constraint <code>C</code>, and the following:</p>\n\n<pre><code>{-# TypeFamilyDependencies #-}\n\ntype family F t = s | s -&gt; t\n\ntype D s = (s ~ T t, C t)\n</code></pre>\n\n<p>Of course <code>type D s ...</code> fails to compile because of the unknown variable <code>t</code>, but how can I write something like <code>D s</code>? I basically want to write:</p>\n\n<pre><code>type D s = (C (T_Inverse s))\n</code></pre>\n\n<p>Which I think should be valid as because of injectivity <code>T_Inverse</code> exists. I just don't know how to express it. </p>\n"}]