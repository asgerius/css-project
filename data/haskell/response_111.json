[{"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1487819257, "post_id": 42404258, "comment_id": 71959337, "body": "I think this question is &quot;help me understand IO in haskell&quot; which is too broad imo. My brief but cryptic answer is: you don&#39;t get to &quot;execute&quot; IO, only the caller of <code>main</code> gets to (whose magic elves are the only ones who know how to get inside an <code>IO</code> value and make it go). The API you&#39;re given for IO is <code>&gt;&gt;=</code> and <code>return</code> and that&#39;s about all there is too it."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1487820419, "post_id": 42404258, "comment_id": 71959663, "body": "&quot;a IO&quot; doesn&#39;t execute. The computer executes the IO. More specifically, the computer executes the IO called <code>main</code>. If your IO isn&#39;t part of <code>main</code> then the computer won&#39;t execute it."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1487820492, "post_id": 42404258, "comment_id": 71959683, "body": "Here&#39;s a brainteaser: what does <code>main = print (length [print &quot;hi&quot;, print &quot;bye&quot;])</code> print?"}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 10, "last_activity_date": 1487865606, "last_edit_date": 1487865606, "creation_date": 1487807103, "answer_id": 42404450, "question_id": 42404258, "link": "https://stackoverflow.com/questions/42404258/why-will-a-io-nested-in-other-monads-not-execute-is-there-a-way-to-force-them-t/42404450#42404450", "title": "Why will a IO nested in other monads not execute? Is there a way to force them to?", "body": "<p>Perhaps it would help to think of <code>IO</code> as <code>type IO a = World -&gt; (a, World)</code>; that is, a function that takes as its only parameter the current state of your computer and returns a new state along with some value <code>a</code>. This is not too dissimilar from the actual implementation of <code>IO</code> in GHC internals, so hopefully we can forgive the (abject) method of communicating by analogy here.</p>\n\n<p>So <code>readFile :: FilePath -&gt; IO String</code>, for example, becomes <code>readFile :: FilePath -&gt; World -&gt; (a, World)</code>.</p>\n\n<p>And <code>main :: IO ()</code> is really <code>main :: World -&gt; ((), World)</code>.</p>\n\n<p>What this means, however, is that values with type <code>IO _</code> are inert. They are just functions! Functions cannot do anything until they are given a value; in our case, the value the function wants is a <code>World</code> object, which we have <em>no way of constructing</em>. Therein lies the beauty of IO in Haskell: we can build up an <code>IO</code> action by using the monadic operators we know and love (return, bind) but it cannot do anything until the runtime passes in the <code>World</code> object.</p>\n\n<p>Which means that any <code>IO</code> action we build that isn't threaded through <code>main</code> won't be executed.</p>\n\n<p>So, with <code>foobar :: [Char] -&gt; IO [IO ()]</code>, we can certainly observe the return value:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  ios &lt;- foobar \"string\"\n  print \"goodbye\"\n</code></pre>\n\n<p>But it's not until we deconstruct <code>ios</code> and bind the internal <code>IO</code> values that those actions receive the <code>World</code> they desire:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  ios &lt;- foobar\n  ios !! 0\n  ios !! 1\n  ios !! 2\n  ...\n  print \"goodbye\"\n</code></pre>\n\n<p>Or, for short,</p>\n\n<pre><code>main = do\n  ios &lt;- foobar\n  sequence ios\n  print \"goodbye\"\n</code></pre>\n\n<p>Hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1487809379, "last_edit_date": 1495540810, "creation_date": 1487809379, "answer_id": 42404828, "question_id": 42404258, "link": "https://stackoverflow.com/questions/42404258/why-will-a-io-nested-in-other-monads-not-execute-is-there-a-way-to-force-them-t/42404828#42404828", "title": "Why will a IO nested in other monads not execute? Is there a way to force them to?", "body": "<p>Let's begin with a slightly different example. As you know, a <code>String</code> is a list of <code>Char</code>:</p>\n\n<pre><code>GHCi&gt; :set +t\nGHCi&gt; \"Mississippi\"\n\"Mississippi\"\nit :: [Char]\n</code></pre>\n\n<p>A list of <code>Strings</code> is a list of lists of <code>Char</code>; that is, a <code>[[Char]]</code>:</p>\n\n<pre><code>GHCi&gt; group \"Mississippi\"\n[\"M\",\"i\",\"ss\",\"i\",\"ss\",\"i\",\"pp\",\"i\"]\nit :: [[Char]]\n</code></pre>\n\n<p><code>group \"Mississippi\"</code> is a <code>[[Char]]</code>, and I don't want it handled as a <code>[Char]</code> -- that would defeat the point of using <code>group</code>.</p>\n\n<p>An <code>IO a</code> value is, for most purposes, a value just like any other, and so analogous considerations apply. To give a concrete (<a href=\"https://hackage.haskell.org/package/reactive-banana-1.1.0.1/docs/Control-Event-Handler.html\" rel=\"nofollow noreferrer\">and realistic</a>) example, suppose we have a function with this type...</p>\n\n<pre><code>(KeyCode -&gt; IO ()) -&gt; IO (IO ())\n</code></pre>\n\n<p>... which registers event handlers for a key press event in a GUI. The idea is that you call the function with a <code>KeyCode -&gt; IO ()</code> argument, which specifies what should happen in response to the key press, and run the the resulting <code>IO (IO ())</code> so that the your chosen <code>KeyCode -&gt; IO ()</code> handler becomes active. The <em>inner</em> <code>IO ()</code> <em>produced by</em> the <code>IO (IO ())</code> action, however, serves a different purpose: it unregisters the event handler, and it is meant to be used at a later point of the application at your discretion -- perhaps never. In this case, you definitely do not want to run the inner action immediately after the outer one!</p>\n\n<p>Summing it up, an <code>IO (IO a)</code> is an <code>IO</code> action that, when run, produces another <code>IO</code> action, which you may or may not want to run as well.</p>\n\n<p>P.S.: As sheyll mentioned <a href=\"https://stackoverflow.com/a/42382982/2751851\">in the other Q&amp;A</a>, <code>join</code> can be used to flatten a nested <code>IO</code> action, or any other nested monadic value. Incidentally, lists also have a <code>Monad</code> instance. What do you think <code>join (group \"Mississippi\")</code> will do?</p>\n"}, {"tags": [], "owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "is_accepted": false, "score": 0, "last_activity_date": 1487822073, "creation_date": 1487822073, "answer_id": 42406727, "question_id": 42404258, "link": "https://stackoverflow.com/questions/42404258/why-will-a-io-nested-in-other-monads-not-execute-is-there-a-way-to-force-them-t/42406727#42406727", "title": "Why will a IO nested in other monads not execute? Is there a way to force them to?", "body": "<p>Well ... you ask the question:</p>\n\n<blockquote>\n  <p>Why did I need to unnest the monads? Is there a way to execute the IO without unnesting?</p>\n</blockquote>\n\n<p>Well, let me put it as blunt as possibe: <strong>Unnesting</strong> or <strong><code>join</code>ing</strong> how we call it in Haskell-land, is not just yet another monad combinator, it is <strong>a holy special moand thing</strong> that differentiates <code>Monad</code>s from <code>Functor</code> and <code>Applicative</code>!</p>\n\n<p>Yes, that totally means that the <code>Monad</code> type class could have been designed with a <strong><code>join</code></strong> method instead of <strong><code>&gt;&gt;=</code></strong>.</p>\n\n<p>Actually <em>unnesting</em> and <em>binding</em> <strong>are two different perspectives for the same thing</strong>!</p>\n\n<p>Let me spoil the rest of this post:</p>\n\n<pre><code>join = (&gt;&gt;= id)                  \n</code></pre>\n\n<p>... and:</p>\n\n<pre><code>(ma &gt;&gt;= amb) = join (amb &lt;$&gt; ma)\n</code></pre>\n\n<p>Let's <em>prove</em> them equal by showing that we can make a <code>join</code> of <code>&gt;&gt;=</code> and vice versa.</p>\n\n<h2>Making <code>join</code> from <code>&gt;&gt;=</code></h2>\n\n<p>Ok now <code>join = (&gt;&gt;= id)</code> in more detail:</p>\n\n<pre><code>join mmx = do mx &lt;- mmx\n              x &lt;- mx\n              return x\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>join mmx = do mx &lt;- mmx\n              mx\n</code></pre>\n\n<p>and now with <strong><code>bind</code></strong> aka <strong><code>&gt;&gt;=</code></strong>:</p>\n\n<pre><code>join mmx = mmx &gt;&gt;= id\n</code></pre>\n\n<p>and point free using <em>sections</em>:</p>\n\n<pre><code>join = (&gt;&gt;= id)\n</code></pre>\n\n<h2>Making <code>&gt;&gt;=</code> from <code>join</code></h2>\n\n<p>Now the other way around, it is harder, we need that fact that every <code>Monad</code> is a <code>Functor</code> too. </p>\n\n<p>Remember what <code>&gt;&gt;=</code> actaully <strong>do</strong>es (pun intended):</p>\n\n<pre><code>ma &gt;&gt;= amb = do a &lt;- ma\n                amb a\n</code></pre>\n\n<p>We know that <code>amb</code> is a function of type <code>a -&gt; m b</code>, the idea is to use <code>fmap</code> which has <code>(c -&gt; d) -&gt; m c -&gt; m d</code>, if we <code>fmap</code> <code>amb</code> we get an expression <code>fmap amb</code> then <code>c</code> becomes <code>a</code> and <code>d</code> becomes <code>m b</code> and <code>m c -&gt; m d</code> hence becomes <code>m a -&gt; m (m b)</code>!</p>\n\n<p>Now we are thrilled: <code>m (m b)</code> just screams <code>join</code>, we only need to put in the <code>m a</code> which we can do with normal application:</p>\n\n<pre><code>ma &gt;&gt;= amb = do mb &lt;- fmap amb ma\n                mb\n</code></pre>\n\n<p>and this is something we saw in the previous section:</p>\n\n<pre><code>join mmb = do mb &lt;- mmb\n              mb\n</code></pre>\n\n<p>with <code>mmb == fmap amb ma</code></p>\n\n<pre><code>ma &gt;&gt;= amb == do mb &lt;- fmap amb ma == join (fmap amb ma)\n                 mb\n</code></pre>\n\n<p>There you go.</p>\n"}], "owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 42404450, "answer_count": 3, "score": 5, "last_activity_date": 1487865606, "creation_date": 1487806065, "last_edit_date": 1495542308, "question_id": 42404258, "link": "https://stackoverflow.com/questions/42404258/why-will-a-io-nested-in-other-monads-not-execute-is-there-a-way-to-force-them-t", "title": "Why will a IO nested in other monads not execute? Is there a way to force them to?", "body": "<p>This is a follow up of my last question.\n<a href=\"https://stackoverflow.com/questions/42382396/io-action-nested-in-other-monads-not-executing\">IO action nested in other monads not executing</a> </p>\n\n<p>The solution to that question was to remove some of the monads, and that allowed the IO action to execute. </p>\n\n<p>Why did I need to unnest the monads? Is there a way to execute the IO without unnesting?</p>\n\n<p><strong>Note</strong>: This is a <em>what-if</em> more than it is a question about good or bad practice.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487804759, "post_id": 42403968, "comment_id": 71954800, "body": "Perfect answer, exactly the one I wanted to write. <code>let</code> can also appear in list/monad comprehensions."}, {"owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487804923, "post_id": 42403968, "comment_id": 71954862, "body": "This is what I never get. I can&#39;t change the value? If I write x = 2 and then type x ghci shows me 2. I can then just type x = 3 and type x and ghci shows me 3. So did I not just change the value of the variable x?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1487805018, "post_id": 42403968, "comment_id": 71954899, "body": "You created a new variable with the same name."}, {"owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487805276, "post_id": 42403968, "comment_id": 71954985, "body": "This is confusing, to me it looks like x is a variable now has value 3 instead of 2. So what is then mutable variables? How can you change those variables? Are you actually changing that very same place in the memory if its mutable or what?"}, {"owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487805492, "post_id": 42403968, "comment_id": 71955068, "body": "Also, in my previous question with the x:es, if I indeed create a new variable with the same name, how do I reach both of those x:es? It seems to me I can only refer to the lastly assigned x with the value 3 but not the &quot;old&quot; x that has the value 2."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 1, "creation_date": 1487805608, "post_id": 42403968, "comment_id": 71955122, "body": "First question\u2014Haskell doesn&#39;t have mutable variables.  You can create an <code>IORef</code> or an <code>MVar</code> or something but you can&#39;t create mutable variables.  Second question\u2014if you create a new variable with the same name, you can&#39;t use the old variable any more.  If you need the old variable then don&#39;t create a new variable with the same name."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1487807556, "post_id": 42403968, "comment_id": 71955894, "body": "Might be worth mentioning that <code>ghci</code> now also lets you omit the <code>let</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1487812346, "post_id": 42403968, "comment_id": 71957346, "body": "Successive bindings in the interactive interpreter are more like syntactic sugar for nested <code>let</code> expressions. Using the example above, it&#39;s similar to <code>let x = 3 in let f y = x + y in let x = 10 in f 1</code>. The value of <code>f</code> was fixed before you created a new variable named <code>x</code> and assigned it a value of 10, and the value of <code>x</code> when you finally call <code>f</code> comes from the scope in which <code>f</code> was <i>defined</i>, not the one in which it is <i>called</i>."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": false, "score": 14, "last_activity_date": 1487805113, "last_edit_date": 1487805113, "creation_date": 1487804669, "answer_id": 42403968, "question_id": 42403924, "link": "https://stackoverflow.com/questions/42403924/in-haskell-what-is-the-difference-between-using-and-not-using-let/42403968#42403968", "title": "In Haskell, what is the difference between using and not using let?", "body": "<p>The only real difference is where they occur.</p>\n\n<pre><code>-- At top (file) level or in \"where\" blocks, omit \"let\".\nx = 5\n\nf1 y = x + y\n  where\n    x = 5\n\n-- Inside expressions or do-blocks, \"let\" is required.\nf2 y = let x = 5\n       in x + y\n\nf3 y = do someAction\n          let x = 5\n          return (x + y)\n</code></pre>\n\n<p>In all cases, <code>x</code> is a variable.  However, you cannot change (mutate) the value of the variable.</p>\n\n<p>In the GHCi prompt, it seems like you change the value of a variable, but you cannot.  You can only create new variables with the same name, the old variables still exist.</p>\n\n<pre>\nPrelude&gt; let x = 3\nPrelude&gt; let f y = x + y\nPrelude&gt; let x = 10\nPrelude&gt; f 1\n4\n</pre>\n\n<p>If you had really changed the value of <code>x</code>, then <code>f 1</code> would be 11.</p>\n"}, {"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 6, "last_activity_date": 1487807024, "last_edit_date": 1487807024, "creation_date": 1487806287, "answer_id": 42404305, "question_id": 42403924, "link": "https://stackoverflow.com/questions/42403924/in-haskell-what-is-the-difference-between-using-and-not-using-let/42404305#42404305", "title": "In Haskell, what is the difference between using and not using let?", "body": "<p>Haskell has variables, but we say they are <em>bound</em> rather than <em>assigned</em>. These are extremely similar notions, but they differ in whether they support <em>multiple assignment</em> - Haskell does not.</p>\n\n<pre><code>do let x = 1\n   let x = 2\n   print x     -- prints \"2\"\n</code></pre>\n\n<p>When we say it does not, what we mean is that all variables are bound <em>statically</em>. This means that any time there's a reference to a variable, you can look back up through the code and find the <em>one</em> binding that it refers to.</p>\n\n<p>Take, for example, Python, which does have multiple assignment.</p>\n\n<pre><code>def f(a):\n    x = 1          # first assignment\n    x = 2          # second assignment\n\n    for i in a:\n        x = i      # third assignment\n        print x \n\n    print x\n</code></pre>\n\n<p>In the above example, there are three places where <code>x</code> is assigned. When we refer to <code>x</code> on the last line, we could be getting the <code>2</code> from the second assignment, or we could be getting one of the values from <code>a</code> from the assignment in the loop. Whether the third assignment took place depends on whether <code>a</code> was empty or not.</p>\n\n<p>So let's look at similar code in Haskell:</p>\n\n<pre><code>f a = do let x = 1                    -- first binding\n         let x = 2                    -- second binding\n         for_ a $ \\i -&gt; do let x = i  -- third binding\n                           print x\n         print x\n</code></pre>\n\n<p>The final line of this output will always be \"2\", because at that point in the code, the second binding is the innermost binding that <code>x</code> received in that scope. If we were to introduce another closer binding, then we could change that:</p>\n\n<pre><code>f a = do let x = 1                    -- first binding\n         let x = 2                    -- second binding\n         for_ a $ \\i -&gt; do let x = i  -- third binding\n                           print x\n         let x = head a               -- fourth binding\n         print x\n</code></pre>\n\n<p>But what we can never do is introduce <em>ambiguity</em> about <em>which binding</em> something refers to.</p>\n"}], "owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 1, "answer_count": 2, "score": 8, "last_activity_date": 1487807024, "creation_date": 1487804475, "last_edit_date": 1487804913, "question_id": 42403924, "link": "https://stackoverflow.com/questions/42403924/in-haskell-what-is-the-difference-between-using-and-not-using-let", "title": "In Haskell, what is the difference between using and not using let?", "body": "<p>Someone told me Haskell does not have variables but bindings. Now what ever that means, I always wondered what the difference is when writing these bindings, like so:</p>\n\n<pre><code>x = 5\n</code></pre>\n\n<p>and</p>\n\n<pre><code>let x = 5\n</code></pre>\n\n<p>What is the difference here?</p>\n\n<p>And a followup question: Am I even creating variables by doing this? If x is not a variable, what is it?</p>\n"}, {"tags": ["haskell", "lambda", "syntax"], "answers": [{"tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": false, "score": 1, "last_activity_date": 1495980769, "creation_date": 1495980769, "answer_id": 44228220, "question_id": 42403173, "link": "https://stackoverflow.com/questions/42403173/inner-bindings-in-haskell/44228220#44228220", "title": "Inner bindings in Haskell", "body": "<p>You can safely remove the outer parentheses:</p>\n\n<pre><code>f = \\x -&gt; ((\\x -&gt; x*x) 3) + x\n</code></pre>\n\n<p>Now, the <code>\\x -&gt; stuff</code> construct is an anonymous function of one argument <code>x</code>. The very inner function <code>\\x -&gt; x*x</code> squares any given number. <code>(\\x -&gt; x*x) 3</code> calls it, which gives you <code>3 * 3 == 9</code>. </p>\n\n<p>The outer function calls the inner one first and adds <code>x</code> to the result. So, you get <code>9 + 1 == 10</code>.</p>\n\n<p>I don't see anything special about binding here. The functions are independent, as well as the variables <code>x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 6, "last_activity_date": 1495986400, "creation_date": 1495986400, "answer_id": 44229170, "question_id": 42403173, "link": "https://stackoverflow.com/questions/42403173/inner-bindings-in-haskell/44229170#44229170", "title": "Inner bindings in Haskell", "body": "<p>You code is quite obfuscated, so let\u2019s clean it up. We start with</p>\n\n<pre><code>f = (\\x -&gt; ((\\x -&gt; x*x) 3)+x)\n</code></pre>\n\n<p>and notice that there are two variables that are both called <code>x</code> \u2013 how confusing! So let\u2019s write this as</p>\n\n<pre><code>f = (\\x -&gt; ((\\y -&gt; y*y) 3)+x)\n</code></pre>\n\n<p>Next, there is this inner lambda expression. We can give it a name and bind it at the same level as <code>f</code> is bound:</p>\n\n<pre><code>square = (\\y -&gt; y*y)\nf = (\\x -&gt; (square 3)+x)\n</code></pre>\n\n<p>At this point, I would like to remove unnecessary parenthesis:</p>\n\n<pre><code>square = \\y -&gt; y*y\nf = \\x -&gt; square 3 + x\n</code></pre>\n\n<p>and finally, instead using a lambda abstraction, we can define <code>square</code> and <code>f</code> as functions. Again, this is equivalent code\u00b9:</p>\n\n<pre><code>square y = y*y\nf x = square 3 + x\n</code></pre>\n\n<p>At this point, you can probably make more sense of this code.</p>\n\n<p>\u00b9 <sup>In fact, the compiler might optimize the two different when it comes to <em>inlining</em>, which happens only when all <em>manifest</em> arguments are provided, but that is beyond the scope of this question.</sup></p>\n"}], "owner": {"reputation": 448, "user_id": 4339476, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7af53c0293141e765d27609212eb131f?s=128&d=identicon&r=PG&f=1", "display_name": "Gallaoui", "link": "https://stackoverflow.com/users/4339476/gallaoui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 44229170, "answer_count": 2, "score": 1, "last_activity_date": 1496025010, "creation_date": 1487801108, "last_edit_date": 1496025010, "question_id": 42403173, "link": "https://stackoverflow.com/questions/42403173/inner-bindings-in-haskell", "title": "Inner bindings in Haskell", "body": "<p>I'm new in Haskell, and\nI don't get it how this code works. Can anyone please explain it to me <strong>how the inner binding works</strong> in this example:</p>\n\n<pre><code>f = (\\x -&gt; ((\\x -&gt; x*x) 3)+x)\n</code></pre>\n\n<p>when I try  <code>f 1</code> I get <code>10</code> </p>\n"}, {"tags": ["haskell", "testing", "hspec", "acid-state"], "comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1487802218, "post_id": 42401526, "comment_id": 71953838, "body": "I don&#39;t know what you want to test. If I wanted to test the <code>setName</code> behaviour, I would apply the update (using the <code>update</code> function), then query the new <code>UserState</code> and compare it with my expected <code>UserState</code>"}, {"owner": {"reputation": 184, "user_id": 4989909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fc8f5b7ec14b5edeb606a4131c85a9e?s=128&d=identicon&r=PG&f=1", "display_name": "alex.b", "link": "https://stackoverflow.com/users/4989909/alex-b"}, "reply_to_user": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1488219520, "post_id": 42401526, "comment_id": 72125150, "body": "@Jean-BaptistePotonnier But how do i modell my expected UserState? Something like this? &quot;UserState{ name = &quot;Mike&quot;}&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 184, "user_id": 4989909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fc8f5b7ec14b5edeb606a4131c85a9e?s=128&d=identicon&r=PG&f=1", "display_name": "alex.b", "link": "https://stackoverflow.com/users/4989909/alex-b"}, "edited": false, "score": 0, "creation_date": 1489092481, "post_id": 42497701, "comment_id": 72532139, "body": "Thank you. I have one more comment: &quot;openLocalState&quot; takes the UserState from harddisk and not the passed Userstate. Data.acid documentation describe in detail: &quot;Initial state value. This value is only used if no checkpoint is found.&quot;"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 184, "user_id": 4989909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fc8f5b7ec14b5edeb606a4131c85a9e?s=128&d=identicon&r=PG&f=1", "display_name": "alex.b", "link": "https://stackoverflow.com/users/4989909/alex-b"}, "edited": false, "score": 0, "creation_date": 1489246538, "post_id": 42497701, "comment_id": 72592062, "body": "@boddAh234 I guess you could delete the file before or after each test, to better control the database state during tests."}], "tags": [], "owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "is_accepted": true, "score": 1, "last_activity_date": 1488238223, "creation_date": 1488238223, "answer_id": 42497701, "question_id": 42401526, "link": "https://stackoverflow.com/questions/42401526/testing-acid-state-with-hspec/42497701#42497701", "title": "Testing Acid-State with hspec", "body": "<p>I don't think you can access the database state without querying for it.\nSo you need to add a query to ask for your database state, for example like this:</p>\n\n<pre><code>getUserState :: Query UserState UserState\ngetUserState = ask\n</code></pre>\n\n<p>Then it is possible to write a test like this :</p>\n\n<pre><code>withDatabaseConnection :: (AcidState UserState -&gt; IO ()) -&gt; IO ()\nwithDatabaseConnection = \n    bracket (openLocalState UserState{name = \"initial name\"}) \n            closeAcidState\n\nspec :: Spec\nspec = do\n    around withDatabaseConnection $ do\n        describe \"test\" $\n            it \"test\" $ \\c -&gt; do\n                _ &lt;- update c (SetName \"Mike\") \n                userState &lt;- query c GetUserState\n                userState `shouldBe` UserState{ name = \"Mike\"}\n</code></pre>\n"}], "owner": {"reputation": 184, "user_id": 4989909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fc8f5b7ec14b5edeb606a4131c85a9e?s=128&d=identicon&r=PG&f=1", "display_name": "alex.b", "link": "https://stackoverflow.com/users/4989909/alex-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 42497701, "answer_count": 1, "score": 1, "last_activity_date": 1488238223, "creation_date": 1487794983, "last_edit_date": 1488219366, "question_id": 42401526, "link": "https://stackoverflow.com/questions/42401526/testing-acid-state-with-hspec", "title": "Testing Acid-State with hspec", "body": "<p>i'm a haskell noob and have problems with testing functions with acid-states.This ist my Datastructure</p>\n\n<pre><code>data UserState = UserState { name :: String }\n    deriving (Eq, Ord, Read, Show, Data, Typeable)\n</code></pre>\n\n<p>and this is the function i want to test:</p>\n\n<pre><code>setName :: String -&gt; Update UserState String                  \nsetName n =      \n    do c@UserState{..} &lt;- get \n       let newName = n \n       put $ c { name = newName } \n       return newName\n$(makeAcidic ''UserState ['setName ])\n</code></pre>\n\n<p>This is my test:</p>\n\n<pre><code>spec :: Spec\nspec = do\n  describe \"test\" $\n    it \"test\" $ do\n            setName \"Mike\" `shouldBe` UserState{ name = \"Mike\"}\n</code></pre>\n\n<p>I have no idea how to model my expected values. <code>UserState{ name = \"Mike\"}</code> doesn't work</p>\n"}, {"tags": ["haskell", "functional-programming", "precision", "theory", "codata"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1487788735, "post_id": 42399472, "comment_id": 71946371, "body": "Have you seen <a href=\"http://hackage.haskell.org/package/cyclotomic\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/cyclotomic</a>?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1487789706, "post_id": 42399472, "comment_id": 71946908, "body": "I&#39;m not sure your requirements are well-defined. It&#39;s possible <code>Rational</code> is what you&#39;re looking for; it supports all those operations without losing precision (you won&#39;t be able to construct an irrational number with them)"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 2, "creation_date": 1487791825, "post_id": 42399472, "comment_id": 71948187, "body": "More generally, you can never do &quot;x == y&quot; because no matter how many digits you calculate you can never be sure that the next one won&#39;t differ. The practical solution seems to be to have families of numbers so that programmers can pick the one they want."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1487792313, "post_id": 42399472, "comment_id": 71948461, "body": "@PaulJohnson I think the OP&#39;s reasoning is to (for example) store numbers as two lists of digits before and after the <code>.</code>. Then, if either of the lists is finite, <code>==</code> won&#39;t diverge. I agree with the spirit of your comment though. I would even add that &quot;families&quot; should be designed to be closed under a set of (not imprecise) operations. <code>Rational</code> is closed over the operations in <code>Fractional</code>, for example."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487792384, "post_id": 42399472, "comment_id": 71948497, "body": "@Alec Unfortunately, <code>==</code> can still diverge even if only one list is infinite. For example, <code>1 = 0.9999...</code> should never return <code>False</code> (and ideally would return <code>True</code>, but not with the obvious infinite list of digits approach). <code>Rational</code> is fine if you expect both lists to be finite (or repeating)."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487792508, "post_id": 42399472, "comment_id": 71948576, "body": "@Alec: While I&#39;m not up on category theory, the term &quot;codata&quot; suggests a potentially infinite representation. However I agree about the need for these families to be closed over at least Num, and possibly Fractional. I seem to recall reading about a family of transcendental numbers closed over Num that is based on the square root of 2, which would be a good example if only I could find it."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487811721, "post_id": 42401683, "comment_id": 71957135, "body": "Where (i.e. in which Hackage package) is this <code>CReal</code> type which represents <a href=\"https://en.wikipedia.org/wiki/Computable_number\" rel=\"nofollow noreferrer\">computable reals</a>? Perhaps you meant <a href=\"https://hackage.haskell.org/package/numbers-3000.2.0.1/docs/Data-Number-CReal.html#t:CReal\" rel=\"nofollow noreferrer\">&#39;constructive&#39;</a>? (Great answer, I am just genuinely curious if there is a well-known Haskell implementation of computable reals which I&#39;ve managed to not know about all this time...)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487811968, "post_id": 42401683, "comment_id": 71957208, "body": "@user2407038 As far as I know, &quot;constructive reals&quot; is a synonym for &quot;computable reals&quot;."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487812381, "post_id": 42401683, "comment_id": 71957356, "body": "My understanding is that &#39;constructive&#39; reals have the property &quot;knowing for sure what the first digit should be [is] technically undecidable&quot; (as you stated in the answer) at least for an arbitrary constructive real, but &#39;computable&#39; reals have the property &quot;we can calculate them precise to k digits given any natural number k.&quot; (as stated in the OP). Constructive reals represent the actual set of reals, whereas computable reals are only a (dense) subset of the reals. These two are different, but I am uncertain to which of them the <code>data CReal = CR (Int -&gt; Integer)</code> corresponds."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487813105, "post_id": 42401683, "comment_id": 71957589, "body": "@user2407038 The definition of computable reals at the Wikipedia link you provide does not appear to agree with what you say. (Beware the misleading informal definition given at the top -- go straight to the formal definition!) It merely says that given an error bound we can find a rational within that bound of the true answer. This is not enough to choose the first digit correctly: consider the function that takes an error bound e and returns <code>0.5-e&#47;2</code>. This represents the number <code>0.5</code>, but there is no error bound we can run this function on to decide whether the first digit should be 4 or 5."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487817863, "post_id": 42401683, "comment_id": 71958947, "body": "If we have a computable real <code>a</code>, to discover its <code>k</code>th digit, is it not enough to compute the rational <code>r</code> approximating it to within <code>10^(-k-1)</code>? e.g. we pick <code>e = 0.001</code> and then the approximation is <code>0.4995</code>. The actual value is <code>0.4995 +- 0.001</code> which is between <code>0.4994</code> and <code>0.4996</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487817982, "post_id": 42401683, "comment_id": 71958971, "body": "@user2407038 No, <code>0.4995 +- 0.001</code> is between <code>0.4985</code> and <code>0.5005</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487828692, "post_id": 42401683, "comment_id": 71962450, "body": "Oops (arithmetic is hard...) thanks for the discussion, looks like I&#39;ve got some gaps to fill in my understanding. (I leave my silly comments for the posterity of future readers)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1487795871, "last_edit_date": 1487795871, "creation_date": 1487795541, "answer_id": 42401683, "question_id": 42399472, "link": "https://stackoverflow.com/questions/42399472/is-there-any-idea-to-solve-the-floating-number-precision-prob-in-the-future/42401683#42401683", "title": "Is there any idea to solve the floating-number-precision-prob in the future?", "body": "<p>Haskell offers <code>Rational</code>, <code>Cyclotomic</code>, and <code>CReal</code> for doing exact arithmetic.</p>\n\n<p><code>CReal</code>, the computable reals, comes about as close as it's possible to come to representing real numbers on a machine; just about any stupid real number you can think up and describe can be stuffed into a <code>CReal</code>. The tradeoff of being able to represent so many things is that your power of observation is severely limited. Checking for equality, checking whether one is bigger than another, even knowing for sure what the first digit should be are technically undecidable problems; though the package provided on Hackage provides approximation algorithms for all of these observations.</p>\n\n<p><code>Cyclotomic</code> can represent a much smaller chunk of the reals, and can represent a fair chunk of the complex numbers, all while retaining exact computation, and supports many more observations in a decidable way. Much of the stuff you want to do can be done with cyclotomic numbers.</p>\n\n<p><code>Rational</code> represents all the numbers that can be written as fractions. This is a significantly smaller chunk of the reals than <code>CReal</code> or <code>Cyclotomic</code>: square roots (and other roots) are pretty much out, trigonometric functions are pretty much out, pi and e are out, etc. But the observations are correspondingly more efficient than for <code>CReal</code> and <code>Cyclotomic</code>, so they are sometimes just the ticket.</p>\n\n<p>...of course, if efficiency matters, <code>Double</code> is going to blow all of these out of the water with today's hardware. Choose your poison carefully!</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487795871, "creation_date": 1487788104, "question_id": 42399472, "link": "https://stackoverflow.com/questions/42399472/is-there-any-idea-to-solve-the-floating-number-precision-prob-in-the-future", "title": "Is there any idea to solve the floating-number-precision-prob in the future?", "body": "<p>We can not store a decimal in infinite precision, but there may be some way to represent them just like we represent infinite lists in haskell.</p>\n\n<p>The first idea came to me is to represent a decimal number via something similar to <em>Codata</em>, so that for any given natural number k, we can calculate the decimal number precise to k digits.</p>\n\n<p>But there is some obvious problem, think about the number <code>a = 0.333...</code> and <code>b = 0.666...</code> , if we plus them together, we got <code>ans = 0.999...</code> (a sequence of digits) , but we can never tell whether <code>a + b == 1</code> in this case.</p>\n\n<p>What I want is, to define the decimal number somehow, so that it support the <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>&gt;</code>, <code>==</code> operations, and no matter what <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> operation we applied to these decimal numbers, we get new decimal numbers, which  we can calculate them precise to k digits given any natural number k.</p>\n\n<p>I'm wondering: is there any idea which may work this out?</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 7606488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b752019aaa6371fd7d4a21a0c6de751d?s=128&d=identicon&r=PG&f=1", "display_name": "asu04", "link": "https://stackoverflow.com/users/7606488/asu04"}, "edited": false, "score": 1, "creation_date": 1487790889, "post_id": 42399873, "comment_id": 71947656, "body": "Thanks for the response! I think that CycleWS lets me cycle through workspaces, but what I actually want to do is be able to move focus across windows, without actually cycling workspaces. So if I had two screens, with workspace 1 and 2 visible and I&#39;m currently focused on a window in workspace 1, I would like to be able to bind alt-tab to move focus across all windows open in workspace 1 and 2. Does that make sense?"}], "tags": [], "owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "is_accepted": false, "score": 1, "last_activity_date": 1610961250, "last_edit_date": 1610961250, "creation_date": 1487789465, "answer_id": 42399873, "question_id": 42398711, "link": "https://stackoverflow.com/questions/42398711/xmonad-cycle-through-all-windows-on-visible-workspaces/42399873#42399873", "title": "XMonad cycle through all windows on visible workspaces", "body": "<p>You can use the <code>CycleWS</code> module in <a href=\"https://hackage.haskell.org/package/xmonad-contrib\" rel=\"nofollow noreferrer\">xmonad-contrib</a></p>\n<p>It has bindings that you can use to cycle through non-empty workspaces:</p>\n<pre><code>import XMonad.Actions.CycleWS\n\nmyKeys homeDir conf@(XConfig {XMonad.modMask = modm}) = M.fromList $\n    [ -- (your own bindings here)\n    -- Cycle non-empty workspaces with mod+tab or mod+shift+tab\n    , ((modm              , xK_Tab   ), moveTo Next NonEmptyWS)\n    , ((modm .|. shiftMask, xK_Tab   ), moveTo Prev NonEmptyWS)\n    ]\n</code></pre>\n<p>My full config is <a href=\"https://github.com/alexj136/dotfiles/blob/c2bbd1dd9e1c2a151e0f796f30c38af74865e41c/xmonad/xmonad.hs\" rel=\"nofollow noreferrer\">here</a> if you want a complete example.</p>\n"}, {"tags": [], "owner": {"reputation": 1823, "user_id": 1254222, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/1c3c8bacbcf3022ad6985e238ab7494d?s=128&d=identicon&r=PG", "display_name": "79E09796", "link": "https://stackoverflow.com/users/1254222/79e09796"}, "is_accepted": false, "score": 0, "last_activity_date": 1617531165, "creation_date": 1617531165, "answer_id": 66940122, "question_id": 42398711, "link": "https://stackoverflow.com/questions/42398711/xmonad-cycle-through-all-windows-on-visible-workspaces/66940122#66940122", "title": "XMonad cycle through all windows on visible workspaces", "body": "<p>This functionality has since been added to xmonad-contrib by this <a href=\"https://github.com/xmonad/xmonad-contrib/issues/293\" rel=\"nofollow noreferrer\">pull request</a>.</p>\n<p>Example usage:</p>\n<pre><code>import XMonad.Actions.GroupNavigation\n</code></pre>\n<p>within the keys section</p>\n<pre><code>-- use Alt+Tab and Alt+Shift+Tab to change focus to different windows across workspaces\n((alt,           xK_Tab   ), nextMatch Forward isOnAnyVisibleWS),\n((alt .|. shift, xK_Tab   ), nextMatch Backward isOnAnyVisibleWS),\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 7606488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b752019aaa6371fd7d4a21a0c6de751d?s=128&d=identicon&r=PG&f=1", "display_name": "asu04", "link": "https://stackoverflow.com/users/7606488/asu04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 681, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1617531165, "creation_date": 1487785527, "last_edit_date": 1613308119, "question_id": 42398711, "link": "https://stackoverflow.com/questions/42398711/xmonad-cycle-through-all-windows-on-visible-workspaces", "title": "XMonad cycle through all windows on visible workspaces", "body": "<p>I'm using XMonad on a dual screen set up, and would like to be able to cycle focus through every window visible on either screen (say, with alt+tab). The behavior would be similar to XMonad.Actions.WindowNavigation, except it wouldn't be bound to a direction, and just cycle through them in some order that makes sense (left to right, top to bottom for instance).</p>\n\n<p>I've found some code <a href=\"https://mail.haskell.org/pipermail/xmonad/2009-October/008995.html\" rel=\"nofollow noreferrer\">here</a> that claims to manipulate the StackSet to solve this problem, and I got it to compile but it wouldn't do what I wanted. Unfortunately my understanding of Haskell is pretty limited, so I've been unable to either write my own or fix whatever is wrong with the code above.</p>\n"}, {"tags": ["haskell", "ghc", "nix"], "answers": [{"tags": [], "owner": {"reputation": 483, "user_id": 1864375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b37e4610ebedf3ed6b54a22d3978e53?s=128&d=identicon&r=PG", "display_name": "Itai Zukerman", "link": "https://stackoverflow.com/users/1864375/itai-zukerman"}, "is_accepted": false, "score": 0, "last_activity_date": 1488001968, "creation_date": 1488001968, "answer_id": 42452487, "question_id": 42396986, "link": "https://stackoverflow.com/questions/42396986/using-nix-to-build-haskell-project-without-split-object-files/42452487#42452487", "title": "Using nix to build haskell project without split object files", "body": "<p>I think you want <code>enableDeadCodeElimination=false</code> in your mkDerivation.</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488001968, "creation_date": 1487780663, "question_id": 42396986, "link": "https://stackoverflow.com/questions/42396986/using-nix-to-build-haskell-project-without-split-object-files", "title": "Using nix to build haskell project without split object files", "body": "<p>In <a href=\"https://github.com/Gabriel439/haskell-nix/blob/429d98c04afd51b2ff4ba57da937a37db9382faa/project3/README.md\" rel=\"nofollow noreferrer\">project 3</a> of Gabriel Gonzalez's tutorial on building haskell projects with nix, he writes:</p>\n\n<blockquote>\n  <p>By default, these libraries are compiled with GHC's <code>-fsplit-objs</code> flag to enable split object files, which reduces the library size but increases the compile time. This is another reason why I recommend building the root project using cabal during development because by default cabal won't compile with split objects and will therefore build faster. However, <code>-fsplit-objs</code> is a good default when Nix builds the project, so you don't need to change this setting.</p>\n</blockquote>\n\n<p>What isn't mentioned is how to make nix build your haskell project without <code>-fsplit-objs</code>. In my case, I have a backend project (built with GHC), a frontend project (built with GHCJS), and a shared project (built with both). Rebuilds of the shared project are somewhat common, so being able to turn off <code>-fsplit-objs</code> would save me a lot compilation time.</p>\n"}, {"tags": ["haskell", "refactoring", "maybe"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1487782379, "post_id": 42396730, "comment_id": 71942216, "body": "I think this doesn&#39;t typecheck. <code>hasValidated</code> has type <code>Maybe (Maybe Bool)</code>, not <code>Maybe Bool</code>."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 5, "last_activity_date": 1487781336, "creation_date": 1487781336, "answer_id": 42397237, "question_id": 42396730, "link": "https://stackoverflow.com/questions/42396730/removing-the-usage-of-fromjust/42397237#42397237", "title": "Removing the usage of fromJust", "body": "<p>I guess this will somehow not be satisfactory for your real codebase, but how about</p>\n\n<pre><code>  (record :: Maybe Record) &lt;- getRecord\n  case record of\n     Just (Record { validate = Just True, mobile = m }) -&gt; do\n        sendSMS m\n     _ -&gt; return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 0, "last_activity_date": 1487783613, "last_edit_date": 1487783613, "creation_date": 1487782304, "answer_id": 42397588, "question_id": 42396730, "link": "https://stackoverflow.com/questions/42396730/removing-the-usage-of-fromjust/42397588#42397588", "title": "Removing the usage of fromJust", "body": "<p>Why not make validation</p>\n\n<pre><code>validate :: Monad m =&gt; Record -&gt; MaybeT m Record\ngetRecord :: Monad m =&gt; MaybeT m Record\n\nsomeFunction = fromMaybe () &lt;$&gt; runMaybeT (getRecord &gt;&gt;= validate &gt;&gt;= doStuff)\n</code></pre>\n\n<p>such that validate returns record if validated or <code>Nothing</code> when non-valid.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487796939, "post_id": 42398252, "comment_id": 71951090, "body": "This will check <code>mrecord</code> for <code>Nothing</code>ness twice."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487802952, "post_id": 42398252, "comment_id": 71954157, "body": "@DanielWagner Yup, this just squeezes the redundant check into a syntactically convenient form. It is a lazy (not in the technical sense) solution :) (If I&#39;m counting it right, both my solution and yours perform four checks each, including both the boolean check and the nothingness ones, while Reid Barton&#39;s does only three.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487804009, "post_id": 42398252, "comment_id": 71954542, "body": "I think yours does five: three binds, a guard, and a case."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487804612, "post_id": 42398252, "comment_id": 71954751, "body": "@DanielWagner You&#39;re right -- using <code>guard</code> in this way effectively duplicates the boolean check."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1487806189, "last_edit_date": 1495535385, "creation_date": 1487784116, "answer_id": 42398252, "question_id": 42396730, "link": "https://stackoverflow.com/questions/42396730/removing-the-usage-of-fromjust/42398252#42398252", "title": "Removing the usage of fromJust", "body": "<p>You can give the boolean to <code>guard</code>: </p>\n\n<pre><code>someFunction = do\n    mrecord &lt;- getRecord\n    let hasValidated = mrecord &gt;&gt;= validate\n    case hasValidated &gt;&gt;= guard &gt;&gt; mrecord of\n        Just record -&gt; do\n            sendSMS (mobile record)\n        _ -&gt; return ()\n</code></pre>\n\n<p>This is a tidy solution, though as Daniel Wagner points out it performs at least one redundant check (two if we compare it with <a href=\"https://stackoverflow.com/a/42397237/2751851\">Reid Barton's answer</a>). Just for fun, here is a golfed version of <a href=\"https://stackoverflow.com/a/42397237/2751851\">Daniel Wagner's first solution</a>:</p>\n\n<pre><code>someFunction = do\n    mrecord &lt;- getRecord\n    case mrecord &gt;&gt;= liftA2 fmap (,) validate of\n        Just (record, True) -&gt; do\n            sendSMS (mobile record)\n        _ -&gt; return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1487797219, "creation_date": 1487797219, "answer_id": 42402196, "question_id": 42396730, "link": "https://stackoverflow.com/questions/42396730/removing-the-usage-of-fromjust/42402196#42402196", "title": "Removing the usage of fromJust", "body": "<p>Have your validation return both whether it's valid and the value of the record:</p>\n\n<pre><code>someFunction = do\n  mrecord &lt;- getRecord\n  let hasValidated = do\n        record &lt;- mrecord\n        valid &lt;- validated record\n        return (valid, record)\n  case hasValidated of\n     Just (True, record) -&gt; do\n        sendSMS (mobile record)\n     _ -&gt; return ()\n</code></pre>\n\n<p>Once you've made this change, you can refactor a fair bit:</p>\n\n<pre><code>someFunction = do\n  mrecord &lt;- getRecord\n  traverse_ (sendSMS . mobile) $ do\n    record &lt;- mrecord\n    True &lt;- validated record\n    return record\n</code></pre>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 42398252, "answer_count": 4, "score": 1, "last_activity_date": 1487806189, "creation_date": 1487780001, "last_edit_date": 1487783163, "question_id": 42396730, "link": "https://stackoverflow.com/questions/42396730/removing-the-usage-of-fromjust", "title": "Removing the usage of fromJust", "body": "<p>Say, I have some code like this:</p>\n\n<pre><code>data Record = Record {\n  validate :: Maybe Bool,\n  mobile :: Text\n}\n\nsomeFunction :: Monad m =&gt; m ()\nsomeFunction = do\n  (record :: Maybe Record) &lt;- getRecord\n  let hasValidated = join $ validate &lt;$&gt; record\n  case hasValidated of\n     Just True -&gt; do\n        sendSMS (mobile $ fromJust record)\n     _ -&gt; return ()\n</code></pre>\n\n<p>Now when <code>hasValidate</code> has some value of <code>Just _</code>, I can know for sure\nthat <code>record</code> isn't <code>Nothing</code>. Is there a way to remove <code>fromJust</code>\nwithout using multiple case or without changing the signature of\n<code>sendSMS</code> function.</p>\n\n<p>Note that the above code is a simplistic scenario of my\ncodebase.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 11, "last_activity_date": 1487778193, "creation_date": 1487778193, "answer_id": 42396030, "question_id": 42395931, "link": "https://stackoverflow.com/questions/42395931/how-to-use-import-a-personal-library-in-another-project-with-stack/42396030#42396030", "title": "How to use import a personal library in another project with Stack?", "body": "<p>I do this all the time. In your <code>stack.yaml</code> file, add the path to the <code>Foo</code> package:</p>\n\n<pre><code>-- stack.yaml\npackages:\n- '.'\n- lib/foo\n</code></pre>\n\n<p>And then in your <code>Bar.cabal</code> file you say that your build depends on <code>Foo</code></p>\n\n<pre><code>-- project.cabal\n...\nbuild-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                   , foo\n</code></pre>\n"}], "owner": {"reputation": 4734, "user_id": 736508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2b30f4fcb5b2b34a8468a8d378cab9d1?s=128&d=identicon&r=PG", "display_name": "Gal", "link": "https://stackoverflow.com/users/736508/gal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 6, "accepted_answer_id": 42396030, "answer_count": 1, "score": 5, "last_activity_date": 1487784298, "creation_date": 1487777953, "last_edit_date": 1487784298, "question_id": 42395931, "link": "https://stackoverflow.com/questions/42395931/how-to-use-import-a-personal-library-in-another-project-with-stack", "title": "How to use import a personal library in another project with Stack?", "body": "<p>So I have a personal stack library, let's call it <code>Foo</code>. In <code>Foo</code>, I have a <code>FooModule</code> module file named <code>FooModule.hs</code>. \nI have another stack project called <code>Bar</code>. How do I import the <code>FooModule.hs</code> module to project <code>Bar</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 3, "creation_date": 1487775553, "post_id": 42394951, "comment_id": 71937192, "body": "Click the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.Tuple.html#curry\" rel=\"nofollow noreferrer\">source</a> link on the right-hand side."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487776478, "post_id": 42394951, "comment_id": 71937876, "body": "Worth mentioning: the souce link is not there every time. for example <code>mtl</code> re-exports functions from <code>transformers</code> and only hackage doc of <code>transformers</code> provides the link."}], "answers": [{"comments": [{"owner": {"reputation": 1068, "user_id": 3737468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/536e1c04e8d64882d5172f0a3327969c?s=128&d=identicon&r=PG", "display_name": "devssh", "link": "https://stackoverflow.com/users/3737468/devssh"}, "edited": false, "score": 0, "creation_date": 1488177260, "post_id": 42396297, "comment_id": 72098480, "body": "Thanks, just what I was looking for! It&#39;s placed in a way that makes it invisible, no link color, small font. It almost looks like a comment."}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 8, "last_activity_date": 1487778868, "creation_date": 1487778868, "answer_id": 42396297, "question_id": 42394951, "link": "https://stackoverflow.com/questions/42394951/how-to-read-the-implementation-code-source-code-for-inbuilt-functions-in-haskell/42396297#42396297", "title": "How to read the implementation code/source code for inbuilt functions in Haskell?", "body": "<p>Like @Lee mentioned in the comments, there is a link for <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.Tuple.html#curry\" rel=\"noreferrer\">source</a> for many of the functions on hackage.\n<a href=\"https://i.stack.imgur.com/TF22w.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/TF22w.png\" alt=\"enter image description here\"></a></p>\n\n<p>Following this will take you to the source code for <code>curry</code>:</p>\n\n<pre><code>-- | 'curry' converts an uncurried function to a curried function.\ncurry                   :: ((a, b) -&gt; c) -&gt; a -&gt; b -&gt; c\ncurry f x y             =  f (x, y)\n</code></pre>\n"}], "owner": {"reputation": 1068, "user_id": 3737468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/536e1c04e8d64882d5172f0a3327969c?s=128&d=identicon&r=PG", "display_name": "devssh", "link": "https://stackoverflow.com/users/3737468/devssh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 1, "accepted_answer_id": 42396297, "answer_count": 1, "score": 2, "last_activity_date": 1488177698, "creation_date": 1487775429, "last_edit_date": 1488177698, "question_id": 42394951, "link": "https://stackoverflow.com/questions/42394951/how-to-read-the-implementation-code-source-code-for-inbuilt-functions-in-haskell", "title": "How to read the implementation code/source code for inbuilt functions in Haskell?", "body": "<p>For instance if I would like to read the source code for the default <code>curry</code> function in Prelude, where do I refer? Is there a way to read it's implementation? I tried to search it in Hoogle, but it doesn't give the exact implementation, just the input and output types. I am using GHCI on stack to run haskell.-</p>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:curry\" rel=\"nofollow noreferrer\">Hoogle curry</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1487774373, "post_id": 42394469, "comment_id": 71936310, "body": "&quot;I am getting this error&quot; Rightly so, because the code as written makes no sense. &quot;It works if I do not use the type parameters like below&quot; Also perfectly OK, this is absolutely the right thing to do. So what&#39;s the problem?"}, {"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1487774604, "post_id": 42394469, "comment_id": 71936467, "body": "Apologies, I have updated the problem, it works when I try to use data types but not when I try to use type parameters."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1487774879, "post_id": 42394469, "comment_id": 71936667, "body": "Again, what&#39;s the problem? Do you expect <code>company</code> or <code>model</code> to be something else than <code>String</code>s, and <code>year</code> something else than <code>Int</code>? Why?"}], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 3, "last_activity_date": 1487774667, "creation_date": 1487774667, "answer_id": 42394646, "question_id": 42394469, "link": "https://stackoverflow.com/questions/42394469/type-parameters-issue-in-haskell/42394646#42394646", "title": "Type parameters issue in Haskell", "body": "<p>You have two problems. <code>Car</code> by itself isn't a type but a type constructor. Also, you need to add a <code>Show</code> constraint to the type parameters in order to make <code>String</code>s out of them.</p>\n\n<p>Try this:</p>\n\n<pre><code>myCar :: (Show c, Show m, Show y) =&gt; Car c m y -&gt; String\nmyCar (Car c m y) = \"This \" ++ (show c) ++ \" was made in \" ++ (show m) ++ \" \" ++ (show y)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 3707634, "user_type": "registered", "profile_image": "https://graph.facebook.com/1533047132/picture?type=large", "display_name": "ThomasD", "link": "https://stackoverflow.com/users/3707634/thomasd"}, "is_accepted": false, "score": 2, "last_activity_date": 1487774935, "creation_date": 1487774935, "answer_id": 42394747, "question_id": 42394469, "link": "https://stackoverflow.com/questions/42394469/type-parameters-issue-in-haskell/42394747#42394747", "title": "Type parameters issue in Haskell", "body": "<p>In the type signature <code>myCar :: Car -&gt; String</code>, you have forgotten to add type parameters to the <code>Car</code> type. Since you specify the <code>Car</code> type to take 3 type parameters in:</p>\n\n<pre><code>data Car a b c = ...\n</code></pre>\n\n<p>at every point in which you use this type, you have to give it 3 type arguments; You can think of <code>Car a b c</code> as a type-level function for which you must supply 3 types before you get a type of kind <code>*</code>. The error you get that says type <code>Car</code> is of kind <code>* -&gt; * -&gt; * -&gt; *</code> means that the <code>Car</code> type is \"higher kinded\", which is a fancy way of saying that the type needs to be applied, like a function, to 1 or more types before it becomes a type of kind <code>*</code> (a type that takes 0 types as arguments). In this case, you need to apply the type constructor to 3 other types before it becomes a type of kind <code>*</code>.</p>\n\n<p>So, a step in the right direction would be to change the type signature to be something like:</p>\n\n<pre><code>myCar :: Car String String Int -&gt; String\n</code></pre>\n\n<p>This should resolve your issue.</p>\n"}, {"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 3, "last_activity_date": 1487781362, "last_edit_date": 1487781362, "creation_date": 1487775408, "answer_id": 42394941, "question_id": 42394469, "link": "https://stackoverflow.com/questions/42394469/type-parameters-issue-in-haskell/42394941#42394941", "title": "Type parameters issue in Haskell", "body": "<p>You defined the type <code>Car a b c</code>, not <code>Car</code>. What you are trying to use later is just <code>Car</code>, which the compiler warns you about with (for you a bit cryptic) message <code>Expecting three more arguments to 'Car'</code>. It actually makes no sense to expect <code>Car</code> alone to magically work as a type, what would the fields be? It only starts to make sense once you specify what <code>a</code>, <code>b</code>, and <code>c</code> are. So <code>Car</code> can be used to construct a type (say <code>Car String String String</code>) and thus it is called a <em>type constructor</em>. To distinguish between these and to draw an analogy to the value-level constructions, Haskell uses <em>kinds</em> much like it uses <em>types</em> to group individual values.</p>\n\n<p><code>Car</code> being of kind <code>* -&gt; * -&gt; * -&gt; *</code> means that it takes 3 types in order to produce a concrete 4th type.</p>\n\n<p>To use the compiler magic to auto-derive <code>Show</code> you need to ensure that the constituents also instantiate <code>Show</code>. Without this the compiler cannot be expected to magically come up with a way to convert arbitrary type into string in any reasonable way (as you expect from <code>show</code>). You can achieve this using <em>constraints</em> but as far as I know you can add those only when using a language extension <code>GADTs</code></p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\ndata Car a b c where\n    Car :: (Show a, Show b, Show c)\n        =&gt; { company :: a, model :: b, year :: c }\n        -&gt; Car a b c\n</code></pre>\n\n<p>but you still cannot use <code>deriving Show</code> directly, since that seems to work only when the type <code>Car a b c</code> works for any <code>a</code>, <code>b</code>, <code>c</code>, which is not the case here. At least not with <code>ghc-7.10</code>. What this does, is that it merely disallows bad choices of <code>a</code>, <code>b</code>, <code>c</code> when constructing some car. One example of a type without a <code>Show</code> instance is the function type, and it makes sense to disallow it by requesting <code>Show a, Show b, Show c</code>. Unfortunately, you would need to add</p>\n\n<pre><code>instance (Show a, Show b, Show c) =&gt; Show (Car a b c) where\n    show (Car a b c) = \"Car \" ++ show a ++ \" \" ++ show b ++ \" \" ++ show c\n</code></pre>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 42394941, "answer_count": 3, "score": 0, "last_activity_date": 1487781362, "creation_date": 1487774196, "last_edit_date": 1487774556, "question_id": 42394469, "link": "https://stackoverflow.com/questions/42394469/type-parameters-issue-in-haskell", "title": "Type parameters issue in Haskell", "body": "<p>I am getting an error when I try to execute this function that uses the type parameter to call the data.</p>\n\n<pre><code>data Car a b c = Car { company :: a\n                 , model :: b\n                 , year :: c\n                 } deriving (Show)\n\nmyCar :: Car -&gt; String\nmyCar (Car {company = c, model = m, year = y}) = \"This \" ++ c ++ \" was made in \" ++ m ++ \" \" ++ show (y)\n</code></pre>\n\n<p>I am getting this error </p>\n\n<pre><code>* Expecting three more arguments to `Car'\n  Expected a type, but `Car' has kind `* -&gt; * -&gt; * -&gt; *'\n* In the type signature:\n    myCar :: Car -&gt; String\n</code></pre>\n\n<p>It works if I use the type parameters like below</p>\n\n<pre><code>data Car = Car { company :: String\n                 , model :: String\n                 , year :: Int\n                 } deriving (Show)\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "functional-programming", "lazy-evaluation", "asymptotic-complexity", "lambda-calculus"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1487779119, "post_id": 42393528, "comment_id": 71939867, "body": "Why go for asymptotic complexity? Intuitively, call-by-need should have the minimal complexity overall, in absolute numbers."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1487780884, "post_id": 42393528, "comment_id": 71941208, "body": "I&#39;m pretty sure call-by-need is not optimal under any reasonable cost model, assuming it is understood to mean not reducing inside the body of a lambda (which could get applied many times). It&#39;s not so obvious to me exactly how to make a case where it is asymptotically non-optimal, though."}, {"owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "edited": false, "score": 0, "creation_date": 1487803319, "post_id": 42393528, "comment_id": 71954287, "body": "I think that tricky part in this proof is &quot;among all reduction strategies&quot;. Does global memoization counts as evaluation strategy? If yes what complexity it has?"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1487817418, "last_edit_date": 1487817418, "creation_date": 1487816870, "answer_id": 42405937, "question_id": 42393528, "link": "https://stackoverflow.com/questions/42393528/can-it-be-proved-that-call-by-need-has-the-minimal-asymptotic-time-complexity-am/42405937#42405937", "title": "Can it be proved that call-by-need has the minimal asymptotic time complexity among all reduction strategies?", "body": "<p>Certainly not. Consider</p>\n\n<pre><code>f x y = sum [1..x] + y\ng x = sum (map (f x) [1..x])\n</code></pre>\n\n<p>Call-by-need reduction of <code>g x</code> will perform <em>O(x^2)</em> additions, but really only <em>O(x)</em> are necessary. For example, lazy HNF will get us this complexity.</p>\n\n<pre><code>-- The definition f3 will get lazily refined.\nlet f3 y = f 3 y = sum [1,2,3] + y\n\ng 3 = sum (map f3 [1,2,3])\n    = sum [f3 1, f3 2, f3 3]\n\n-- Now let's refine f3 to HNF *before* applying it\nf3 y = sum [1,2,3] + y\n     = 6 + y\n\n-- And continue g 3\ng 3 = sum [f3 1, f3 2, f3 3]\n    -- no need to compute sum [1..x] three times\n    = sum [6 + 1, 6 + 2, 6 + 3]\n    = ...\n</code></pre>\n\n<p>I handwaved the evaluation order quite a bit here, but hopefully you get the idea.  We reduce a function body to HNF before applying it, thus sharing any computations that don't depend on the argument.</p>\n\n<p>For a whole lot more about this, see Michael Jonathan Thyer's <a href=\"http://thyer.name/phd-thesis/\" rel=\"nofollow noreferrer\">Lazy Specialization</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 745, "user_id": 7439915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32415e1345c858c5161bb0c7cd3284c6?s=128&d=identicon&r=PG&f=1", "display_name": "Andrea Asperti", "link": "https://stackoverflow.com/users/7439915/andrea-asperti"}, "is_accepted": true, "score": 1, "last_activity_date": 1488137344, "last_edit_date": 1495539968, "creation_date": 1488107483, "answer_id": 42467731, "question_id": 42393528, "link": "https://stackoverflow.com/questions/42393528/can-it-be-proved-that-call-by-need-has-the-minimal-asymptotic-time-complexity-am/42467731#42467731", "title": "Can it be proved that call-by-need has the minimal asymptotic time complexity among all reduction strategies?", "body": "<p>I think your question is a bit confused. Please, let me clarify a few points.</p>\n\n<p>First of all the theorem you mention is traditionally known as standardization theorem, and is due to Curry and Feys (Combinatory Logic I, 1958), generalized to eta reduction by Hindley (<a href=\"http://www.ams.org/journals/tran/1978-241-00/S0002-9947-1978-0492300-7/S0002-9947-1978-0492300-7.pdf\" rel=\"nofollow noreferrer\">Standard and normal reductions</a>), and then revised by many other authors (see e.g. this <a href=\"https://stackoverflow.com/questions/35104037/lambda-calculus-normal-order-normal-form/42003564#42003564\">question</a> ).</p>\n\n<p>Secondly, outermost reduction is different from call by need (call by need is not even a reduction strategy in the traditional sense of the word). </p>\n\n<p>Coming to the complexity issue, that is the core of the question, call by need is optimal only with respect to weak reduction. However, weak reduction is not always the best way for reducing lambda terms. A well know example is the following term</p>\n\n<pre><code>                                n 2 I I\n</code></pre>\n\n<p>where n and 2 are church integers, and I is an identity. I add two I at the end, otherwise weak-reduction languages would stop the computation too early. </p>\n\n<p>Observe that the term reduces to </p>\n\n<pre><code>                          2 (2 (... (2 I))..) I\n</code></pre>\n\n<p>and (2 I) reduces to I. So, with innermost reduction you would be able to reduce the term in linear time w.r.t n. </p>\n\n<p>On the other side, I invite you to perform the previous computation in Haskell, and you will discover that the reduction time grows exponentially in n. I leave to you to understand the reasons of this phenomenon.</p>\n\n<p>A similar discussion has been done in this <a href=\"https://stackoverflow.com/questions/31223539/is-it-possible-to-evaluate-lambda-calculus-terms-efficiently/41737550#41737550\">thread</a>.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 1, "accepted_answer_id": 42467731, "answer_count": 2, "score": 11, "last_activity_date": 1488137344, "creation_date": 1487771864, "last_edit_date": 1592644375, "question_id": 42393528, "link": "https://stackoverflow.com/questions/42393528/can-it-be-proved-that-call-by-need-has-the-minimal-asymptotic-time-complexity-am", "title": "Can it be proved that call-by-need has the minimal asymptotic time complexity among all reduction strategies?", "body": "<p>When I read the Church Rosser II Theorem <a href=\"https://en.wikibooks.org/wiki/Haskell/Graph_reduction\" rel=\"noreferrer\">here</a></p>\n<blockquote>\n<p>Theorem (Church Rosser II)</p>\n<p>If there is one terminating reduction, then outermost reduction will terminate, too.</p>\n</blockquote>\n<p>I'm wondering: Is there some theorem which strengthens the Church Rosser II Theorem so that it tells about the asymptotic time complexity instead of termination?</p>\n<p>Or, can it be proved that the call-by-need strategy has the minimal asymptotic time complexity among all reduction strategies?</p>\n"}, {"tags": ["haskell", "command-line-arguments", "optparse-applicative"], "answers": [{"tags": [], "owner": {"reputation": 3924, "user_id": 117564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca5b1fa03d489616c4367b475eba9a4a?s=128&d=identicon&r=PG", "display_name": "Paolo Capriotti", "link": "https://stackoverflow.com/users/117564/paolo-capriotti"}, "is_accepted": false, "score": 1, "last_activity_date": 1487799301, "creation_date": 1487799301, "answer_id": 42402720, "question_id": 42392193, "link": "https://stackoverflow.com/questions/42392193/option-applicative-how-to-parse-a-combined-parser-with-a-flag/42402720#42402720", "title": "Option.Applicative: How to parse a combined parser with a flag?", "body": "<p>It's not possibile, at least not directly. You might find some indirect encoding that works for you, but I'm not sure.  Options take arguments, not subparsers.  You can have subparsers, but they are introduced by a \"command\", not an option (i.e. without the leading <code>--</code>). </p>\n"}, {"comments": [{"owner": {"reputation": 669, "user_id": 1173624, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5aa76ca348911cce8f3ce7337f117d46?s=128&d=identicon&r=PG", "display_name": "Pieter", "link": "https://stackoverflow.com/users/1173624/pieter"}, "edited": false, "score": 0, "creation_date": 1487805592, "post_id": 42402743, "comment_id": 71955111, "body": "I asked the author of the library. It&#39;s not possible (for now). See the anwer by Paolo Capriotti"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 2, "last_activity_date": 1487799375, "last_edit_date": 1495539971, "creation_date": 1487799375, "answer_id": 42402743, "question_id": 42392193, "link": "https://stackoverflow.com/questions/42392193/option-applicative-how-to-parse-a-combined-parser-with-a-flag/42402743#42402743", "title": "Option.Applicative: How to parse a combined parser with a flag?", "body": "<p>Your question turned out to be more complicated than you think. Current <code>optparse-applicative</code> API is not supposed to be used with such cases. So you probably may want to change the way you handle CLI arguments or switch to another CLI parsing library. But I will describe most closest way of achieving your goal.</p>\n\n<p>First, you need to read other two SO questions:</p>\n\n<p><em>1.</em> <a href=\"https://stackoverflow.com/questions/32422339/how-to-parse-maybe-with-optparse-applicative\">How to parse Maybe with optparse-applicative</a></p>\n\n<p><em>2.</em> <a href=\"https://stackoverflow.com/questions/41185015/is-it-possible-to-have-a-optparse-applicative-option-with-several-parameters\">Is it possible to have a optparse-applicative option with several parameters?</a></p>\n\n<p>From first question you know how to parse optional arguments using <code>optional</code> function. From second you learn some problems with parsing multiple arguments. So I will write here several approaches how you can workaround this problem.</p>\n\n<p><strong>1. Naive and ugly</strong></p>\n\n<p>You can represent pair of strings as pair of <code>String</code> type and use just naive <code>show</code> of this pair. Here is code:</p>\n\n<pre><code>mainParser :: Parser Arguments\nmainParser = Arguments\n    &lt;$&gt; switch (long \"someflag\" &lt;&gt; help \"Some argument flag\")\n    &lt;*&gt; optional (uncurry SubArguments &lt;$&gt;\n                   (option auto $ long \"subarguments\" &lt;&gt; help \"some desc\"))\n\ngetArguments :: IO Arguments\ngetArguments = do\n    (res, ()) &lt;- simpleOptions \"main example\" \"\" \"desc\" mainParser empty\n    return res\n\nmain :: IO ()\nmain = getArguments &gt;&gt;= print\n</code></pre>\n\n<p>Here is result in <code>ghci</code>:</p>\n\n<pre><code>ghci&gt; :run main --someflag --subarguments \"(\\\"a\\\",\\\"b\\\")\"\nArguments True (Just (SubArguments \"a\" \"b\"))\n</code></pre>\n\n<p><strong>2. Less naive</strong></p>\n\n<p>From answer to second question you should learn how pass multiple arguments inside one string. Here is code for parsing:</p>\n\n<pre><code>subArgParser :: ReadM SubArguments\nsubArgParser = do\n    input &lt;- str\n    -- no error checking, don't actually do this\n    let [a,b] = words input\n    pure $ SubArguments a b\n\nmainParser :: Parser Arguments\nmainParser = Arguments\n    &lt;$&gt; switch (long \"someflag\" &lt;&gt; help \"Some argument flag\")\n    &lt;*&gt; optional (option subArgParser $ long \"subarguments\" &lt;&gt; help \"some desc\")\n</code></pre>\n\n<p>And here is <code>ghci</code> output:</p>\n\n<pre><code>ghci&gt; :run main --someflag --subarguments \"x yyy\"\nArguments True (Just (SubArguments \"x\" \"yyy\"))\n</code></pre>\n\n<p>The only bad thing in second solution is that error checking is absent. Thus you can use another general purpose parsing library, for example <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\"><code>megaparsec</code></a>, instead of just <code>let [a,b] = words input</code>.</p>\n"}], "owner": {"reputation": 669, "user_id": 1173624, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5aa76ca348911cce8f3ce7337f117d46?s=128&d=identicon&r=PG", "display_name": "Pieter", "link": "https://stackoverflow.com/users/1173624/pieter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1487805658, "creation_date": 1487768337, "last_edit_date": 1487805658, "question_id": 42392193, "link": "https://stackoverflow.com/questions/42392193/option-applicative-how-to-parse-a-combined-parser-with-a-flag", "title": "Option.Applicative: How to parse a combined parser with a flag?", "body": "<p>I have complicated command line options, as</p>\n\n<pre><code>data Arguments = Arguments Bool (Maybe SubArguments)\ndata SubArguments = SubArguments String String\n</code></pre>\n\n<p>I want to parse these subarguments with a flag:</p>\n\n<pre><code>programName --someflag --subarguments \"a\" \"b\"\nprogramName --someflag\n</code></pre>\n\n<p>I already have</p>\n\n<pre><code>subArgParser = SubArguments &lt;$&gt; argument str &lt;*&gt; argument str\nmainParser = MainArgs &lt;$&gt; switch\n                  (long \"someflag\"\n                   &lt;&gt; help \"Some argument flag\")\n               &lt;*&gt; ???\n                   (long \"subarguments\"\n                   &lt;&gt; help \"Sub arguments\"\n</code></pre>\n\n<p>What do I have to write at the ???</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487764200, "post_id": 42390523, "comment_id": 71928646, "body": "What is wrong with <code>module A.B where</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1487817982, "post_id": 42390523, "comment_id": 71958972, "body": "See also <a href=\"http://blog.ezyang.com/2016/10/try-backpack-ghc-backpack/\" rel=\"nofollow noreferrer\">backpack</a>, a work in progress in bleeding-edge GHC."}, {"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 1, "creation_date": 1487839784, "post_id": 42390523, "comment_id": 71967870, "body": "I have a module which defines a few records and, in order to avoid name collisions, I thought I could group the records in sub-modules"}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487809253, "post_id": 42390808, "comment_id": 71956431, "body": "The second example is the closest translation I can think of the for the original pseuo-Haskell. <code>M</code> becomes <code>M.Core</code> or the like, <code>A</code>/<code>B</code> -&gt; <code>M.A</code>/<code>M.B</code> and a new module <code>M</code> simply re-exports all the definitions."}], "tags": [], "owner": {"reputation": 4545, "user_id": 1825727, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/bVGmM.png?s=128&g=1", "display_name": "Akash", "link": "https://stackoverflow.com/users/1825727/akash"}, "is_accepted": true, "score": 13, "last_activity_date": 1487764756, "creation_date": 1487764756, "answer_id": 42390808, "question_id": 42390523, "link": "https://stackoverflow.com/questions/42390523/is-it-possible-to-have-sub-modules-in-haskell/42390808#42390808", "title": "Is it possible to have sub-modules in Haskell?", "body": "<p>What you proposed isn't currently supported in Haskell AFAIK. That said, nothing's stopping you from creating seemingly namespaced modules. For example:</p>\n\n<pre><code>module Top where\n\nmyTopFunc :: a -&gt; Int\nmyTopFunc _ = 1\n</code></pre>\n\n<p>and in another file:</p>\n\n<pre><code>module Top.Sub where\n\nmySubFunc :: a -&gt; String\nmySubFunc _ = \"Haskell\"\n</code></pre>\n\n<p>In addition to this, you have a few more tricks up your sleeves to arrange your modules. If you import a module A into B, you can export A's visible entities from B as if they were its own. Subsequently, on importing B, you'll be able to use those functions/datatypes etc. being oblivious to where they originally came from. An example of this using the modules from above would be:</p>\n\n<pre><code>module Top (\n  myTopFunc,\n  TS.mySubFunc\n  ) where\n\nimport qualified Top.Sub as TS\n\nmyTopFunc :: a -&gt; Int\nmyTopFunc _ = 1\n</code></pre>\n\n<p>Now you can use both functions just by importing <code>Top</code>.</p>\n\n<pre><code>import Top (myTopFunc, mySubFunc)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 4, "last_activity_date": 1487767391, "creation_date": 1487767391, "answer_id": 42391837, "question_id": 42390523, "link": "https://stackoverflow.com/questions/42390523/is-it-possible-to-have-sub-modules-in-haskell/42391837#42391837", "title": "Is it possible to have sub-modules in Haskell?", "body": "<p>There are hierarchical module <em>names</em>. You can have modules named <code>M</code> and <code>M.A</code> and <code>M.X</code>, but modules themselves don't nest, and <code>M</code> is unrelated to <code>M.A</code> as far as the language is concerned. </p>\n\n<p>If you want <code>M</code> to export everything <code>M.A</code> and <code>M.X</code> export, you have to do this explicitly:</p>\n\n<pre><code>module M (module M.A, module M.X) where\nimport M.A\nimport M.X\n-- rest of M\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 0, "creation_date": 1487977947, "post_id": 42448209, "comment_id": 72043482, "body": "I know of this extension but it doesn&#39;t work if I&#39;m generating Lens for my records with makeLenses"}, {"owner": {"reputation": 9966, "user_id": 171121, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/63c0a0bf0ddd889a0ea8f78d1ea73b8a?s=128&d=identicon&r=PG", "display_name": "Dax Fohl", "link": "https://stackoverflow.com/users/171121/dax-fohl"}, "reply_to_user": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 0, "creation_date": 1487978215, "post_id": 42448209, "comment_id": 72043578, "body": "@vidi Yeah I was looking for the same thing when I stumbled across it and your question simultaneously. And indeed, it&#39;s pretty limited. It looks like PureScript has way better support for regular record-type stuff; as a newbie to Haskell implementing a web service, I think I might investigate PureScript some more."}], "tags": [], "owner": {"reputation": 9966, "user_id": 171121, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/63c0a0bf0ddd889a0ea8f78d1ea73b8a?s=128&d=identicon&r=PG", "display_name": "Dax Fohl", "link": "https://stackoverflow.com/users/171121/dax-fohl"}, "is_accepted": false, "score": 1, "last_activity_date": 1487970078, "creation_date": 1487970078, "answer_id": 42448209, "question_id": 42390523, "link": "https://stackoverflow.com/questions/42390523/is-it-possible-to-have-sub-modules-in-haskell/42448209#42448209", "title": "Is it possible to have sub-modules in Haskell?", "body": "<p>No you cannot.  But your comment mentions you're just looking for a way to avoid naming collisions.  For this, you can use the <code>{-# LANGUAGE DuplicateRecordFields #-}</code> extension and the compiler will allow duplicate record field names.</p>\n"}], "owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1506, "favorite_count": 0, "accepted_answer_id": 42390808, "answer_count": 3, "score": 6, "last_activity_date": 1487970078, "creation_date": 1487764082, "question_id": 42390523, "link": "https://stackoverflow.com/questions/42390523/is-it-possible-to-have-sub-modules-in-haskell", "title": "Is it possible to have sub-modules in Haskell?", "body": "<p>I have this code</p>\n\n<pre><code>module M where\n\na = 1\nb = 2\nx = 10\ny = 20\n</code></pre>\n\n<p>...but as the module grows it's difficult to deal with duplicate names.</p>\n\n<p>Is it possible to have namespaces like this?</p>\n\n<pre><code>module M where\n  module A where\n    a = 1\n    b = 2\n\n  module X where\n    x = 10\n    y = 20\n</code></pre>\n\n<p>..and then </p>\n\n<pre><code>...\nimport M\n\ns = A.a + X.y\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1487750344, "post_id": 42385509, "comment_id": 71919714, "body": "<a href=\"https://downloads.haskell.org/~ghc/7.0.3/docs/html/users_guide/separate-compilation.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.0.3/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 868, "user_id": 1767808, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/KfCkc.jpg?s=128&g=1", "display_name": "Christoph W.", "link": "https://stackoverflow.com/users/1767808/christoph-w"}, "edited": false, "score": 5, "creation_date": 1487753639, "post_id": 42385509, "comment_id": 71921660, "body": "The name of the module and the name of the file should be the same. In your case, rename the file surface to Shapes and import Shapes in your surfaceImport Module. Another problem is that you have a function called surface in your exports. Your file name and the function should not have the same name."}], "answers": [{"tags": [], "owner": {"reputation": 868, "user_id": 1767808, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/KfCkc.jpg?s=128&g=1", "display_name": "Christoph W.", "link": "https://stackoverflow.com/users/1767808/christoph-w"}, "is_accepted": false, "score": 1, "last_activity_date": 1487842210, "creation_date": 1487842210, "answer_id": 42411700, "question_id": 42385509, "link": "https://stackoverflow.com/questions/42385509/error-when-importing-a-haskell-module/42411700#42411700", "title": "Error when importing a Haskell module", "body": "<p>so first of all I think your code is from: <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/making-our-own-types-and-typeclasses</a></p>\n\n<p>and there is also a part in the introduction concerning the definition of modules: <a href=\"http://learnyouahaskell.com/modules\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/modules</a></p>\n\n<p>It is recommended that the file and the module have the same name as stated in the link above. This will resolve your problem with the parse error on \"surface\". The next point that you should not do is to name your file like a function in your module.</p>\n\n<p>You use a qualified import in your example. Qualified imports are explained here: <a href=\"https://www.haskell.org/tutorial/modules.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/tutorial/modules.html</a></p>\n\n<p>In general, one uses qualified imports if there are two modules containing different entities but with the same name. The qualified import allows you to prefix the imported names with the imported module. Consequently, I am not sure if you need a qualified import in your example at all.</p>\n\n<p>In summary you should make the following changes:</p>\n\n<ul>\n<li>Rename the file containing the Shapes module to \"Shapes.hs\"</li>\n<li>Rename your second file from \"surfaceImport.hs\" to something like \"ShapesUsageExample.hs\"</li>\n<li>Change your import to <code>import Shapes</code></li>\n</ul>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487842210, "creation_date": 1487749613, "question_id": 42385509, "link": "https://stackoverflow.com/questions/42385509/error-when-importing-a-haskell-module", "title": "Error when importing a Haskell module", "body": "<p>I am trying to import a Haskell module named Shapes from a file called surface (which compiles fine)</p>\n\n<pre><code>import qualified surface.Shapes as Shapes\n\nsurfaceImport :: Shape -&gt; Float\nsurfaceImport (Circle _ r) = pi * r ^ 2\nsurfaceImport (Rectangle (Point x1 x2) (Point y1 y2)) = (abs $ x1 - x2) * (abs $ y1 - y2)\n</code></pre>\n\n<p>I am getting the following error when I try to compile this program</p>\n\n<pre><code>surfaceImport.hs:1:18: error: parse error on input `surface'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>The module I am trying to import is this</p>\n\n<pre><code>module Shapes\n(\nPoint(..),\nShape(..),\nsurface,\nnudge,\nbaseCircle,\nbaseRectangle\n)\n</code></pre>\n\n<p>Thanks in advance\n    where</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "edited": false, "score": 0, "creation_date": 1487765321, "post_id": 42386467, "comment_id": 71929513, "body": "thanks! after reading it I realize I just didn&#39;t understand it&#39;s value that is discarded but the state still gets passed around."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "edited": false, "score": 0, "creation_date": 1487765857, "post_id": 42386467, "comment_id": 71929886, "body": "happy to help, if the answer is to your satisfaction, please consider accepting it to close the question (this applies to all questions on stackoverflow), it helps tracking unresolved issues, and helps others find answers before asking their own questions."}, {"owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "edited": false, "score": 0, "creation_date": 1487769131, "post_id": 42386467, "comment_id": 71932326, "body": "Thanks for this tip, too LOL"}], "tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 5, "last_activity_date": 1487754626, "last_edit_date": 1487754626, "creation_date": 1487752813, "answer_id": 42386467, "question_id": 42384473, "link": "https://stackoverflow.com/questions/42384473/confusion-over-the-passing-of-state-monad-in-haskell/42386467#42386467", "title": "confusion over the passing of State monad in Haskell", "body": "<p>It really boils down to understanding that state is isomorphic to <code>s -&gt; (a, s)</code>. So any value \"wrapped\" in a monadic action is a result of applying a transformation to some state <code>s</code> (a stateful computation producing <code>a</code>).</p>\n\n<p>Passing a state between two stateful computations</p>\n\n<pre><code>f :: a -&gt; State s b\ng :: b -&gt; State s c\n</code></pre>\n\n<p>corresponds to composing them with <code>&gt;=&gt;</code></p>\n\n<pre><code>f &gt;=&gt; g\n</code></pre>\n\n<p>or using <code>&gt;&gt;=</code></p>\n\n<pre><code>\\a -&gt; f a &gt;&gt;= g\n</code></pre>\n\n<p>the result here is</p>\n\n<pre><code>a -&gt; State s c\n</code></pre>\n\n<p>it is a stateful action that transforms some underlying state <code>s</code> in some way, it is allowed access to some <code>a</code> and it produces some <code>c</code>. So the entire transformation is allowed to depend on <code>a</code> and the value <code>c</code> is allowed to depend on some state <code>s</code>. This is exactly what you would want to express a stateful computation. The neat thing (and the sole purpose of expressing this machinery as a monad) is that you do not have to bother with passing the state around. But to understand how it is done, please refer to the definition of <code>&gt;&gt;=</code> on <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/src/Control-Monad-Trans-State-Lazy.html#StateT\" rel=\"nofollow noreferrer\">hackage</a>), just ignore for a moment that it is a transformer rather than a final monad).</p>\n\n<pre><code>m &gt;&gt;= k  = StateT $ \\ s -&gt; do\n    ~(a, s') &lt;- runStateT m s\n    runStateT (k a) s'\n</code></pre>\n\n<p>you can disregard the wrapping and unwrapping using <code>StateT</code> and <code>runStateT</code>, here <code>m</code> is in form <code>s -&gt; (a, s)</code>, <code>k</code> is of form <code>a -&gt; (s -&gt; (b, s))</code>, and you wish to produce a stateful transformation <code>s -&gt; (b, s)</code>. So the result is going to be a function of <code>s</code>, to produce <code>b</code> you can use <code>k</code> but you need <code>a</code> first, how do you produce <code>a</code>? you can take <code>m</code> and apply it to the state <code>s</code>, you get a modified state <code>s'</code> from the first monadic action <code>m</code>, and you pass that state into <code>(k a)</code> (which is of type <code>s -&gt; (b, s)</code>). It is here that the state <code>s</code> has passed through <code>m</code> to become <code>s'</code> and be passed to <code>k</code> to become some final <code>s''</code>.</p>\n\n<p>For you as a user of this mechanism, this remains hidden, and that is the neat thing about monads. If you want a state to evolve along some computation, you build your computation from small steps that you express as <code>State</code>-actions and you let <code>do</code>-notation or bind (<code>&gt;&gt;=</code>) to do the chaining/passing.</p>\n\n<p>The sole difference between <code>&gt;&gt;=</code> and <code>&gt;&gt;</code> is that you either care or don't care about the non-state result.</p>\n\n<pre><code>a &gt;&gt; b\n</code></pre>\n\n<p>is in fact equivalent to</p>\n\n<pre><code>a &gt;&gt;= \\_ -&gt; b\n</code></pre>\n\n<p>so what ever value gets output by the action <code>a</code>, you throw it away (keeping only the modified state) and continue (pass the state along) with the other action <code>b</code>.</p>\n\n<hr>\n\n<p>Regarding you examples</p>\n\n<pre><code>tick :: State Int Int \ntick = get &gt;&gt;= \\n -&gt;\n    put (n+1) &gt;&gt;\n    return n\n</code></pre>\n\n<p>you can rewrite it in <code>do</code>-notation as</p>\n\n<pre><code>tick = do\n    n &lt;- get\n    put (n + 1)\n    return n\n</code></pre>\n\n<p>while the first way of writing it makes it maybe more explicit what is passed how, the second way nicely shows how you do not have to care about it.</p>\n\n<ol>\n<li><p>First <code>get</code> the <strong>current</strong> state and expose it (<code>get :: s -&gt; (s, s)</code> in a simplified setting), the <code>&lt;-</code> says that you do care about the value and you do not want to throw it away, the underlying state is also passed in the background without a change (that is how <code>get</code> works).</p></li>\n<li><p>Then <code>put :: s -&gt; (s -&gt; ((), s))</code>, which is equivalent after dropping unnecessary parens to <code>put :: s -&gt; s -&gt; ((), s)</code>, takes a value to replace the current state with (the first argument), and produces a stateful action whose result is the uninteresting value <code>()</code> which you drop (because you do not use <code>&lt;-</code> or because you use <code>&gt;&gt;</code> instead of <code>&gt;&gt;=</code>). Due to <code>put</code> the underlying state has changed to <code>n + 1</code> and as such it is passed on.</p></li>\n<li><p><code>return</code> does nothing to the underlying state, it only <em>returns</em> its argument.</p></li>\n</ol>\n\n<p>To summarise, <code>tick</code> starts with some initial value <code>s</code> it updates it to <code>s+1</code> internally and outputs <code>s</code> on the side.</p>\n\n<p>The other example works exactly the same way, <code>&gt;&gt;</code> is only used there to throw away the <code>()</code> produced by <code>put</code>. But state gets passed around all the time.</p>\n"}], "owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 2, "accepted_answer_id": 42386467, "answer_count": 1, "score": 4, "last_activity_date": 1487754626, "creation_date": 1487745973, "question_id": 42384473, "link": "https://stackoverflow.com/questions/42384473/confusion-over-the-passing-of-state-monad-in-haskell", "title": "confusion over the passing of State monad in Haskell", "body": "<p>In Haskell the State is monad is passed around to extract and store state. And in the two following examples, both pass the State monad using <code>&gt;&gt;</code>, and a close verification (by function inlining and reduction) confirms that the state is indeed passed to the next step. </p>\n\n<p>Yet this seems not very intuitive. So does this mean when I want to pass the State monad I just need <code>&gt;&gt;</code> (or the <code>&gt;&gt;=</code> and lambda expression <code>\\s -&gt; a</code> where <code>s</code> is not free in <code>a</code>)? Can anyone provide an intuitive explanation for this fact without bothering to reduce the function?</p>\n\n<pre><code>-- the first example\ntick :: State Int Int \ntick = get &gt;&gt;= \\n -&gt;\n   put (n+1) &gt;&gt;\n   return n\n\n-- the second example\ntype GameValue = Int \ntype GameState = (Bool, Int)\n\nplayGame' :: String -&gt; State GameState GameValue \nplayGame' []      = get &gt;&gt;= \\(on, score) -&gt; return score\nplayGame' (x: xs) = get &gt;&gt;= \\(on, score) -&gt;\n    case x of\n        'a' | on -&gt; put (on, score+1)\n        'b' | on -&gt; put (on, score-1)\n        'c'      -&gt; put (not on, score)\n        _        -&gt; put (on, score) \n    &gt;&gt; playGame xs \n</code></pre>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["haskell", "io-monad"], "answers": [{"comments": [{"owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "edited": false, "score": 0, "creation_date": 1487785567, "post_id": 42382982, "comment_id": 71944398, "body": "Do you happen to have an explanation as to why the nesting causes the IO action to not perform?"}, {"owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "edited": false, "score": 0, "creation_date": 1487817311, "post_id": 42382982, "comment_id": 71958787, "body": "<a href=\"http://stackoverflow.com/questions/42404258/why-will-a-io-nested-in-other-monads-not-execute-is-there-a-way-to-force-them-t/42404828#42404828\" title=\"why will a io nested in other monads not execute is there a way to force them t\">stackoverflow.com/questions/42404258/&hellip;</a>"}], "tags": [], "owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "is_accepted": true, "score": 3, "last_activity_date": 1487740189, "last_edit_date": 1487740189, "creation_date": 1487739135, "answer_id": 42382982, "question_id": 42382396, "link": "https://stackoverflow.com/questions/42382396/io-action-nested-in-other-monads-not-executing/42382982#42382982", "title": "IO action nested in other monads not executing", "body": "<p>I could get <code>writeReport2</code> working without modification.</p>\n\n<p>I think what might have been your problem is the <strong>nested IO action</strong> in the return value of <code>writeResport2</code>!</p>\n\n<p>In order to <em>flatten</em> the nested <code>IO</code> actions, I had to use the function <a href=\"https://www.stackage.org/haddock/lts-8.2/base-4.9.1.0/Control-Monad.html#v:join\" rel=\"nofollow noreferrer\"><code>join :: Monad m =&gt; m (m a) -&gt; m a</code> from <code>Control.Monad</code></a>:</p>\n\n<pre><code>main :: IO ()\nmain = join $ fromParseResult &lt;$&gt; writeReport2 \"test\"\n</code></pre>\n\n<p>Here is my complete code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport           Language.Haskell.Exts.Parser\nimport           Text.LaTeX.Base.Writer\nimport           Text.LaTeX\nimport           Data.String\nimport           Control.Monad\n\nfoobar :: IO (ParseResult [(String, String)])\nfoobar = return (ParseOk testFoo)\n\ntestFoo = [ ( \" | HaskellExample Example File\\n | Two examples are given below:\\n\\n &gt;&gt;&gt; fib 10\\n 55\\n\\n &gt;&gt;&gt; putStrLn \\\"foo\\\\nbar\\\"\\n foo\\n bar \"\n            , \"fib :: Int -&gt; Int\"\n            )\n          , (\"\\n | This is a thing: \", \"fib = undefined\")\n          , (\"\\n | This is a thing:\\n\", \"fibar :: String -&gt; Float\")\n          ]\n\ndocAndGraph :: Monad m =&gt; [(String, String)] -&gt; LaTeXT m ()\ndocAndGraph x = do\n    documentclass [] article\n    document $\n        raw (fromString (show x))\n\nwriteReport2 :: [Char] -&gt; IO (ParseResult (IO ()))\nwriteReport2 name = do\n    x &lt;- foobar\n    return $ do\n        y &lt;- x\n        return $ do\n            z &lt;- (execLaTeXT . docAndGraph) y\n            renderFile fileName z\n  where\n    fileName = name ++ \".tex\"\n\nmain :: IO ()\nmain = join $ fromParseResult &lt;$&gt; writeReport2 \"test\"\n</code></pre>\n\n<p>Loading into GHCi:</p>\n\n<pre><code>$ stack ghci\nio-action-nested-in-other-monads-not-executing-0.1.0.0: initial-build-steps (exe)\nConfiguring GHCi with the following packages: io-action-nested-in-other-monads-not-executing\nUsing main module: 1. Package `io-action-nested-in-other-monads-not-executing' component exe:io-action-nested-in-other-monads-not-executing with main-is file: /home/sven/dev/stackoverflow-questions/io-action-nested-in-other-monads-not-executing/src/Main.hs\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /home/sven/.ghc/ghci.conf\n[1 of 1] Compiling Main             ( /home/sven/dev/stackoverflow-questions/io-action-nested-in-other-monads-not-executing/src/Main.hs, interpreted )\nOk, modules loaded: Main.\nLoaded GHCi configuration from /tmp/ghci22616/ghci-script\n</code></pre>\n\n<p>And running it:</p>\n\n<pre><code>\u03bb main\n</code></pre>\n\n<p>Creates this file:</p>\n\n<pre><code>$ cat test.tex \n\\documentclass{article}\\begin{document}[(\" | HaskellExample Example File\\n | Two examples are given below:\\n\\n &gt;&gt;&gt; fib 10\\n 55\\n\\n &gt;&gt;&gt; putStrLn \\\"foo\\\\nbar\\\"\\n foo\\n bar \",\"fib :: Int -&gt; Int\"),(\"\\n | This is a thing: \",\"fib = undefined\"),(\"\\n | This is a thing:\\n\",\"fibar :: String -&gt; Float\")]\\end{document}%                                                                        \n</code></pre>\n\n<p>I know it is not the scope of the question, but you could circumvent the nested <code>IO</code> if you want, by doinf this, for example:</p>\n\n<pre><code>writeReport3 :: [Char] -&gt; IO ()\nwriteReport3 name = do\n    let fileName = name ++ \".tex\"\n    x &lt;- foobar\n    case x of\n      ParseOk y -&gt; do\n        z &lt;- execLaTeXT (docAndGraph y)\n        renderFile fileName z\n      ParseFailed _ _ -&gt;\n        return ()\n\nmain :: IO ()\nmain = writeReport3 \"test\"\n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 42382982, "answer_count": 1, "score": 0, "last_activity_date": 1487740189, "creation_date": 1487735548, "question_id": 42382396, "link": "https://stackoverflow.com/questions/42382396/io-action-nested-in-other-monads-not-executing", "title": "IO action nested in other monads not executing", "body": "<p>I have a </p>\n\n<pre><code>foobar :: IO (ParseResult [(String,String)])\n</code></pre>\n\n<p>ParseResult is a monad defined here: <a href=\"https://hackage.haskell.org/package/haskell-src-exts-1.13.5/docs/Language-Haskell-Exts-Parser.html#t:ParseResult\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/haskell-src-exts-1.13.5/docs/Language-Haskell-Exts-Parser.html#t:ParseResult</a></p>\n\n<p>I want to take those strings and write them to a <code>LaTeXT m ()</code> defined in <a href=\"https://hackage.haskell.org/package/HaTeX-3.17.1.0/docs/Text-LaTeX-Base-Writer.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/HaTeX-3.17.1.0/docs/Text-LaTeX-Base-Writer.html</a></p>\n\n<p>Running this function results in no file being created.</p>\n\n<pre><code>writeReport2 :: [Char] -&gt; IO (ParseResult (IO ()))\nwriteReport2 name = do x &lt;- foobar\n                       return $ do y &lt;- x\n                                   return $ do z &lt;- (execLaTeXT.docAndGraph) y\n                                               renderFile fileName z\n  where\n    fileName = name ++ \".tex\"\n</code></pre>\n\n<p>However the code:</p>\n\n<pre><code>writeReport :: t -&gt; LaTeXT IO a -&gt; IO ()\nwriteReport name report = createLatex &gt;&gt;= renderFile fileName\n  where\n    createLatex = execLaTeXT report\n    fileName = \"AAAAA\" ++ \".tex\"\n\n\ntestFoo = [(\" | HaskellExample Example File\\n | Two examples are given below:\\n\\n &gt;&gt;&gt; fib 10\\n 55\\n\\n &gt;&gt;&gt; putStrLn \\\"foo\\\\nbar\\\"\\n foo\\n bar \",\"fib :: Int -&gt; Int\"),(\"\\n | This is a thing: \",\"fib = undefined\"),(\"\\n | This is a thing:\\n\",\"fibar :: String -&gt; Float\")]\n\nitWorks = writeReport \"AAAA.txt\" $ docAndGraph testFoo\n</code></pre>\n\n<p>Will create a new file.</p>\n\n<p>Both sets of code type check.  </p>\n"}, {"tags": ["list", "haskell", "dictionary", "types", "instance"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487720948, "post_id": 42380068, "comment_id": 71909507, "body": "Unless all these types can be rewritten in the form <code>F x y ...</code> for a single type <code>F</code>, with different parameters, I think the only option is generating the instances through Template Haskell. It is not very convenient, so it is worth the candle only if you have many instances to write."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1487779037, "post_id": 42380068, "comment_id": 71939792, "body": "What would <code>map (instance ClassName)</code> do, exactly? <code>map</code> takes a list and does the same thing to each item. Are all your instances identical? Then the types must be identical, too, so why have different types? Or is <code>ClassName</code> an empty class? Then what&#39;s it for?"}, {"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1487795630, "post_id": 42380068, "comment_id": 71950306, "body": "I&#39;m using aeson to do json transformations, you can use generic to have types automatically declared as instances of from and to json, so creating different types to represent json data. in this case all you do is make the type an instance of those classes and they don&#39;t require further definition, with several types needed to represent different json data it makes sense to me to just map instance over each type."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 10, "last_activity_date": 1487721009, "creation_date": 1487721009, "answer_id": 42380169, "question_id": 42380068, "link": "https://stackoverflow.com/questions/42380068/can-i-make-a-list-of-types-in-haskell/42380169#42380169", "title": "can I make a list of types in haskell?", "body": "<p>Well actually you can, with something like</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule T where\n\nclass C a\n\ndata X = X\ndata Y = Y\ndata Z = Z\n\n$(fmap concat $ mapM (\\t -&gt; [d|instance C $t|]) [[t|X|], [t|Y|], [t|Z|]])\n</code></pre>\n\n<p>but it strikes me as massive overkill unless you actually need them to be generated automatically (e.g., the list of types might vary depending on something).</p>\n"}], "owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 1, "accepted_answer_id": 42380169, "answer_count": 1, "score": 5, "last_activity_date": 1487721009, "creation_date": 1487720479, "question_id": 42380068, "link": "https://stackoverflow.com/questions/42380068/can-i-make-a-list-of-types-in-haskell", "title": "can I make a list of types in haskell?", "body": "<p>I have different data types that I have defined, and I want to make them all an instance of a class. is it possible to make a list of types and map instance over them instead of having to declare them all individually?</p>\n\n<p>I mean something like this:</p>\n\n<pre><code>data Type1 = ...\ndata Type2 = ...\n\nmap (instance ClassName) [Type1, Type2]\n</code></pre>\n"}, {"tags": ["css", "string", "haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487719985, "post_id": 42379906, "comment_id": 71909161, "body": "Add <code>{-# LANGUAGE OverloadedStrings #-}</code> to the top of your file and watch these errors vanish."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487720013, "post_id": 42379906, "comment_id": 71909173, "body": "More generally, <code>[Char]</code> and <code>String</code> are identical, but <code>Text</code> is different."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487720133, "post_id": 42379906, "comment_id": 71909208, "body": "@Alec it&#39;s already there"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487720587, "post_id": 42379906, "comment_id": 71909374, "body": "Apologies. My first comment is misplaced. My second comment still holds. To construct a <code>Map Text Text</code>, you&#39;ll need to add a type annotation. <code>&quot;a&quot; =: &quot;b&quot; :: Map Text Text</code>. Basically, with <code>OverloadedStrings</code> enabled, all strings have the type <code>IsString a =&gt; a</code>. Unless otherwise constrained, GHC has some defaulting magic to pick <code>a ~ String</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1487720650, "post_id": 42379906, "comment_id": 71909399, "body": "But apparently <code>elAttr</code> wants a <code>Map String String</code>, so you just need to get rid of the <code>pack</code>. (<code>pack</code> converts <code>String</code> to <code>Text</code>.)"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487720793, "post_id": 42379906, "comment_id": 71909456, "body": "@ReidBarton thank you very much"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487728302, "post_id": 42379906, "comment_id": 71911621, "body": "As @ReidBarton says, the hackage documentation for <code>elAttr</code> states that the second argument should be a <code>Map String String</code> .  However in the <b>latest</b> version of <code>reflex-dom</code>, that second argument has been changed to <code>Map Text Text</code>.  If you installed reflex using &#39;reflex-platform/try-reflex&#39; per <a href=\"http://stackoverflow.com/a/42323953/509928\">this answer</a> you should have the <code>Map Text Text</code> version."}], "answers": [{"tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": false, "score": 0, "last_activity_date": 1487957136, "creation_date": 1487957136, "answer_id": 42444729, "question_id": 42379906, "link": "https://stackoverflow.com/questions/42379906/how-to-construct-a-map-text-text-object/42444729#42444729", "title": "how to construct a Map Text Text object?", "body": "<p>You may look at the repository <a href=\"https://github.com/hansroland/reflex-dom-inbits\" rel=\"nofollow noreferrer\">https://github.com/hansroland/reflex-dom-inbits</a>. </p>\n\n<p>For an answer to your question see the examples <em>dom03.hs</em> and <em>dom04.hs</em> in the <em>src</em> directory.</p>\n\n<p>The file <em>tutorial.md</em> contains a beginner friendly introduction to reflex-dom and explains the examples. The tutorial is still <em>work in progress</em>.</p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487957136, "creation_date": 1487719412, "question_id": 42379906, "link": "https://stackoverflow.com/questions/42379906/how-to-construct-a-map-text-text-object", "title": "how to construct a Map Text Text object?", "body": "<p>I am a newcomer to Haskell and I am trying to build a simple website with a library called Reflex.Dom and the Cascading Style Sheets (CSS) are represented as a <code>Map Text Text</code> object, that's nice but Haskell is distinguishing between three, nearly-identical objects:</p>\n\n<ul>\n<li><code>String</code></li>\n<li><code>Text</code></li>\n<li><code>[Char]</code></li>\n</ul>\n\n<p>Certainly, in Python or JavaScript these are the same or nearly the same and functions can be used interchangeably between one object and the other.  Not the case in Haskell. </p>\n\n<pre><code> \"style\" =: pack(\"color:red\")\n</code></pre>\n\n<p>how about</p>\n\n<pre><code> \"style\" =: pack(\"color:red; font-family: Helvetica;\")\n</code></pre>\n\n<p>If I add another style element, I get an error message:</p>\n\n<pre><code>square-01.hs:6:47:\n    Couldn't match type \u2018Text\u2019 with \u2018[Char]\u2019\n    Expected type: String\n      Actual type: Text\n    In the second argument of \u2018(=:)\u2019, namely \u2018pack (\"color:red\")\u2019\n    In the second argument of \u2018elAttr\u2019, namely\n      \u2018(\"style\" =: pack (\"color:red\"))\u2019\n</code></pre>\n\n<p>Here is a little bit from Prelude but I don't really get it.</p>\n\n<pre><code>Prelude Reflex.Dom Data.Text Data.Map&gt; \"a\" =: pack(\"b\")\nfromList [(\"a\",\"b\")]\n\nPrelude Reflex.Dom Data.Text Data.Map&gt; :t \"a\" =: pack(\"b\")\n\"a\" =: pack(\"b\") :: Map [Char] Text\n\nPrelude Reflex.Dom Data.Text Data.Map&gt; \"a\" =: \"b\"\nfromList [(\"a\",\"b\")]\n\nPrelude Reflex.Dom Data.Text Data.Map&gt; :t \"a\" =: \"b\"\n\"a\" =: \"b\" :: Map [Char] [Char]\n\nPrelude Reflex.Dom Data.Text Data.Map&gt; :t (=:)\n(=:) :: k -&gt; a -&gt; Map k a\n</code></pre>\n"}, {"tags": ["haskell", "monads", "backtracking", "n-queens"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487713982, "post_id": 42378073, "comment_id": 71906616, "body": "Are you sure you want the <code>Select</code> monad? My understanding of <code>Select</code> is that it tries to prove existence of a possible solution (as a witness proof). The typical example of <code>Select</code> is a SAT solver. You can probably force something through with <code>SelectT</code> over the list monad, but I&#39;m more sure you would be really making use of the select monad."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487714172, "post_id": 42378073, "comment_id": 71906742, "body": "@Alec I read that <code>Select</code> was good for backtracking search, and n-queens is an archetypal problem of that type, so I assumed it was a good use case for the monad."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487714720, "post_id": 42378073, "comment_id": 71907035, "body": "The distinction might be between backtracking to find all solutions and backtracking until you find a solution. Then again, I&#39;ve only played with <code>Select</code> once before, so don&#39;t take anything I say seriously."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 2, "creation_date": 1487785849, "post_id": 42378073, "comment_id": 71944590, "body": "Not the <code>Select</code> monad but this project : <a href=\"https://github.com/sshastry/queenslogic\" rel=\"nofollow noreferrer\">queenslogic</a> uses the <code>Logic</code> monad to solve the n-queens with backtracking."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1617136101, "post_id": 42378073, "comment_id": 118218321, "body": "Related: <a href=\"https://julesh.com/2021/03/30/selection-functions-and-lenses/\" rel=\"nofollow noreferrer\">julesh.com/2021/03/30/selection-functions-and-lenses</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 4, "last_activity_date": 1487764966, "creation_date": 1487764966, "answer_id": 42390906, "question_id": 42378073, "link": "https://stackoverflow.com/questions/42378073/how-to-use-the-select-monad-to-solve-n-queens/42390906#42390906", "title": "How to use the Select monad to solve n-queens?", "body": "<p><code>Select</code> can be viewed as an abstraction of a search in a \"compact\" space, guided by some predicate. You mentioned SAT in your comments, have you tried modelling the problem as a SAT instance and throw it at a solver based on <code>Select</code> (in the spirit of <a href=\"http://eptcs.web.cse.unsw.edu.au/paper.cgi?MSFP2014.3.pdf\" rel=\"nofollow noreferrer\">this paper</a>)? You can specialise the search to hardwire the N-queens specific constraints inside your <img src=\"https://chart.googleapis.com/chart?cht=tx&amp;chl=%5Cvarphi\" alt=\"phi\"> and turn the SAT solver into a N-queens solver.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487929987, "post_id": 42402145, "comment_id": 72015297, "body": "&quot;In particular, the way <code>sequence</code> works for <code>Select</code> [...] seems quite magical&quot; -- Yup, that applicative instance is positively mind-bending."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1488072900, "last_edit_date": 1488072900, "creation_date": 1487797033, "answer_id": 42402145, "question_id": 42378073, "link": "https://stackoverflow.com/questions/42378073/how-to-use-the-select-monad-to-solve-n-queens/42402145#42402145", "title": "How to use the Select monad to solve n-queens?", "body": "<p>Inspired by jd823592's answer, and after looking at the SAT example in the <a href=\"http://eptcs.web.cse.unsw.edu.au/paper.cgi?MSFP2014.3.pdf\" rel=\"nofollow noreferrer\">paper</a>, I have written this code:</p>\n\n<pre><code>import Data.List \nimport Control.Monad.Trans.Select\n\nvalidBoard :: [Int] -&gt; Bool\nvalidBoard qs = all verify (tails qs)\n  where\n    verify [] = True\n    verify (x : xs) = and $ zipWith (\\i y -&gt; x /= y &amp;&amp; abs (x-y) /= i) [1..] xs\n\nnqueens :: Int -&gt; [Int]\nnqueens boardSize = runSelect (traverse selectColumn columns) validBoard\n  where\n  columns = replicate boardSize [1..boardSize]\n  selectColumn candidates = select $ \\s -&gt; head $ filter s candidates ++ candidates\n</code></pre>\n\n<p>It seems to arrive (albeit slowly) to a valid solution:</p>\n\n<pre><code>ghci&gt; nqueens 8\n[1,5,8,6,3,7,2,4]\n</code></pre>\n\n<p>I don't understand it very well, however. In particular, the way <code>sequence</code> works for <code>Select</code>, transmuting a function (<code>validBoard</code>) that works over a whole board into functions that take a single column index, seems quite magical.</p>\n\n<hr>\n\n<p>The <code>sequence</code>-based solution has the defect that putting a queen in a column doesn't rule out the possibility of choosing the same column for subsequent queens; we end up unnecesarily exploring doomed branches.</p>\n\n<p>If we want our column choices to be affected by previous decisions, we need to go beyond <code>Applicative</code> and use the power of <code>Monad</code>:</p>\n\n<pre><code>nqueens :: Int -&gt; [Int]\nnqueens boardSize = fst $ runSelect (go ([],[1..boardSize])) (validBoard . fst)\n  where\n  go (cps,[]) = return (cps,[])\n  go (cps,fps) = (select $ \\s -&gt;\n    let candidates = map (\\(z,zs) -&gt; (z:cps,zs)) (oneOf fps)\n    in  head $ filter s candidates ++ candidates) &gt;&gt;= go\n</code></pre>\n\n<hr>\n\n<p>The monadic version still has the problem that it only checks completed boards, when the original list-based solution backtracked as soon as a partially completed board was found to be have a conflict. I don't know how to do that using <code>Select</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1607067968, "post_id": 65134906, "comment_id": 115161078, "body": "Nice answer. One quibble with the wording: <code>shift</code> doesn&#39;t seem to be capturing a continuation in the sense of &quot;the rest of the computation&quot;. It just gets explicit hold of the scoring function, as you wrote."}, {"owner": {"reputation": 3370, "user_id": 722938, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MtO4E.jpg?s=128&g=1", "display_name": "is7s", "link": "https://stackoverflow.com/users/722938/is7s"}, "edited": false, "score": 0, "creation_date": 1607121667, "post_id": 65134906, "comment_id": 115182745, "body": "How easy is it to make this return all solutions?"}, {"owner": {"reputation": 11511, "user_id": 359878, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/HICpP.jpg?s=128&g=1", "display_name": "Matt Diamond", "link": "https://stackoverflow.com/users/359878/matt-diamond"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1607122447, "post_id": 65134906, "comment_id": 115182948, "body": "@danidiaz good point! I was actually thinking of removing <code>shift</code> anyway, as it&#39;s just a convenience function and doesn&#39;t really do that much (and the name itself is probably misleading)."}, {"owner": {"reputation": 11511, "user_id": 359878, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/HICpP.jpg?s=128&g=1", "display_name": "Matt Diamond", "link": "https://stackoverflow.com/users/359878/matt-diamond"}, "reply_to_user": {"reputation": 3370, "user_id": 722938, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MtO4E.jpg?s=128&g=1", "display_name": "is7s", "link": "https://stackoverflow.com/users/722938/is7s"}, "edited": false, "score": 0, "creation_date": 1607137479, "post_id": 65134906, "comment_id": 115185655, "body": "@is7s That&#39;s an interesting question... I don&#39;t think there&#39;s an easy way to do it, but I&#39;ll give it some thought."}, {"owner": {"reputation": 11511, "user_id": 359878, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/HICpP.jpg?s=128&g=1", "display_name": "Matt Diamond", "link": "https://stackoverflow.com/users/359878/matt-diamond"}, "reply_to_user": {"reputation": 3370, "user_id": 722938, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MtO4E.jpg?s=128&g=1", "display_name": "is7s", "link": "https://stackoverflow.com/users/722938/is7s"}, "edited": false, "score": 2, "creation_date": 1607141919, "post_id": 65134906, "comment_id": 115186209, "body": "@is7s Keep in mind that Select wraps a function of type <code>(a -&gt; r) -&gt; a</code>... if it returned all solutions, the type would be <code>([a] -&gt; Bool) -&gt; [[a]]</code>, which is more like <code>(a -&gt; r) -&gt; m a</code>. However, it might be possible to make it work using the <code>SelectT</code> transformer, which wraps <code>(a -&gt; m r) -&gt; m a</code>."}], "tags": [], "owner": {"reputation": 11511, "user_id": 359878, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/HICpP.jpg?s=128&g=1", "display_name": "Matt Diamond", "link": "https://stackoverflow.com/users/359878/matt-diamond"}, "is_accepted": true, "score": 7, "last_activity_date": 1607135121, "last_edit_date": 1607135121, "creation_date": 1607033381, "answer_id": 65134906, "question_id": 42378073, "link": "https://stackoverflow.com/questions/42378073/how-to-use-the-select-monad-to-solve-n-queens/65134906#65134906", "title": "How to use the Select monad to solve n-queens?", "body": "<p>I realize this is question is almost 4 years old and already has an answer, but I wanted to chime in with some additional information for the sake of anyone who comes across this question in the future. Specifically, I want to try to answer 2 questions:</p>\n<ul>\n<li>how are multiple Selects that return single values combined to create a single Select that returns a sequence of values?</li>\n<li>is it possible to return early when a solution path is destined to fail?</li>\n</ul>\n<h3>Chaining Selects</h3>\n<p>Select is implemented as a monad transformer in the <code>transformers</code> library (go figure), but let's take a look at how one might implement <code>&gt;&gt;=</code> for <code>Select</code> by itself:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>(&gt;&gt;=) :: Select r a -&gt; (a -&gt; Select r b) -&gt; Select r b\nSelect g &gt;&gt;= f = Select $ \\k -&gt;\n  let choose x = runSelect (f x) k\n  in  choose $ g (k . choose)\n</code></pre>\n<p>We start by defining a new <code>Select</code> which takes an input <code>k</code> of type <code>a -&gt; r</code> (recall that <code>Select</code> wraps a function of type <code>(a -&gt; r) -&gt; a</code>). You can think of <code>k</code> as a function that returns a &quot;score&quot; of type <code>r</code> for a given <code>a</code>, which the Select function may use to determine which <code>a</code> to return.</p>\n<p>Inside our new <code>Select</code>, we define a function called <code>choose</code>. This function passes some <code>x</code> to the function <code>f</code>, which is the <code>a -&gt; m b</code> portion of monadic binding: it transforms the result of the <code>m a</code> computation into a new computation <code>m b</code>. So <code>f</code> is going to take that <code>x</code> and return a new <code>Select</code>, which <code>choose</code> then runs using our scoring function <code>k</code>. You can think of <code>choose</code> as a function that asks &quot;what would the final result be if I selected <code>x</code> and passed it downstream?&quot;</p>\n<p>On the second line, we return <code>choose $ g (k . choose)</code>. The function <code>k . choose</code> is the composition of <code>choose</code> and our original scoring function <code>k</code>: it takes in a value, calculates the downstream result of selecting that value, and returns the score of that downstream result. In other words, we've created a kind of &quot;clairvoyant&quot; scoring function: instead of returning the score of a given value, it returns the score of the final result we would get <em>if we selected that value</em>. By passing in our &quot;clairvoyant&quot; scoring function to <code>g</code> (the original <code>Select</code> that we're binding to), we're able to select the intermediate value that leads to the final result we're looking for. Once we have that intermediate value, we simply pass it back into <code>choose</code> and return the result.</p>\n<p>That's how we're able to string together single-value Selects while passing in a scoring function that operates on an array of values: each Select is scoring the hypothetical final result of selecting a value, not necessarily the value itself. The applicative instance follows the same strategy, the only difference being how the downstream Select is computed (instead of passing a candidate value into the <code>a -&gt; m b</code> function, it maps a candidate function over the 2nd Select.)</p>\n<h3>Returning Early</h3>\n<p>So, how can we use Select while returning early? We need some way of accessing the scoring function within the scope of the code that constructs the Select. One way to do that is to construct each Select within another Select, like so:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>sequenceSelect :: Eq a =&gt; [a] -&gt; Select Bool [a]\nsequenceSelect [] = return []\nsequenceSelect domain@(x:xs) = select $ \\k -&gt;\n  if k [] then runSelect s k else []\n  where\n    s = do\n      choice &lt;- elementSelect (x:|xs)\n      fmap (choice:) $ sequenceSelect (filter (/= choice) domain)\n</code></pre>\n<p>This allows us to test the sequence in progress and short-circuit the recursion if it fails. (We can test the sequence by calling <code>k []</code> because the scoring function includes all of the prepends that we've recursively lined up.)</p>\n<p>Here's the whole solution:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List\nimport Data.List.NonEmpty (NonEmpty(..))\nimport Control.Monad.Trans.Select\n\nvalidBoard :: [Int] -&gt; Bool\nvalidBoard qs = all verify (tails qs)\n  where\n    verify [] = True\n    verify (x:xs) = and $ zipWith (\\i y -&gt; x /= y &amp;&amp; abs (x - y) /= i) [1..] xs\n\nnqueens :: Int -&gt; [Int]\nnqueens boardSize = runSelect (sequenceSelect [1..boardSize]) validBoard\n\nsequenceSelect :: Eq a =&gt; [a] -&gt; Select Bool [a]\nsequenceSelect [] = return []\nsequenceSelect domain@(x:xs) = select $ \\k -&gt;\n  if k [] then runSelect s k else []\n  where\n    s = do\n      choice &lt;- elementSelect (x:|xs)\n      fmap (choice:) $ sequenceSelect (filter (/= choice) domain)\n\nelementSelect :: NonEmpty a -&gt; Select Bool a\nelementSelect domain = select $ \\p -&gt; epsilon p domain\n\n-- like find, but will always return something\nepsilon :: (a -&gt; Bool) -&gt; NonEmpty a -&gt; a\nepsilon _ (x:|[]) = x\nepsilon p (x:|y:ys) = if p x then x else epsilon p (y:|ys)\n</code></pre>\n<p>In short: we construct a Select recursively, removing elements from the domain as we use them and terminating the recursion if the domain has been exhausted or if we're on the wrong track.</p>\n<p>One other addition is the <code>epsilon</code> function (based on Hilbert's <a href=\"https://en.wikipedia.org/wiki/Epsilon_calculus\" rel=\"nofollow noreferrer\">epsilon operator</a>). For a domain of size N it will check at most N - 1 items... it might not sound like a huge savings, but as you know from the above explanation, <code>p</code> will usually kick off the remainder of the entire computation, so it's best to keep predicate calls to a minimum.</p>\n<p>The nice thing about <code>sequenceSelect</code> is how generic it is: it can be used to create any <code>Select Bool [a]</code> where</p>\n<ul>\n<li>we're searching within a finite domain of distinct elements</li>\n<li>we want to create a sequence that includes every element exactly once (i.e. a permutation of the domain)</li>\n<li>we want to test partial sequences and abandon them if they fail the predicate</li>\n</ul>\n<p>Hope this helps clarify things!</p>\n<hr />\n<p>P.S. Here's a link to an Observable notebook in which I implemented the Select monad in Javascript along with a demonstration of the n-queens solver: <a href=\"https://observablehq.com/@mattdiamond/the-select-monad\" rel=\"nofollow noreferrer\">https://observablehq.com/@mattdiamond/the-select-monad</a></p>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 948, "favorite_count": 5, "accepted_answer_id": 65134906, "answer_count": 3, "score": 12, "last_activity_date": 1607135121, "creation_date": 1487711533, "last_edit_date": 1487727389, "question_id": 42378073, "link": "https://stackoverflow.com/questions/42378073/how-to-use-the-select-monad-to-solve-n-queens", "title": "How to use the Select monad to solve n-queens?", "body": "<p>I'm trying to understand how the <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Select.html\" rel=\"noreferrer\"><code>Select</code></a> monad works. Apparently, it is a cousin of <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Cont.html\" rel=\"noreferrer\"><code>Cont</code></a> and it can be used for backtracking search.</p>\n\n<p>I have this list-based solution to the n-queens problem:</p>\n\n<pre><code>-- All the ways of extracting an element from a list.\noneOf :: [Int] -&gt; [(Int,[Int])] \noneOf [] = [] \noneOf (x:xs) = (x,xs) : map (\\(y,ys) -&gt; (y,x:ys)) (oneOf xs)\n\n-- Adding a new queen at col x, is it threathened diagonally by any of the\n-- existing queens?\nsafeDiag :: Int -&gt; [Int] -&gt; Bool\nsafeDiag x xs = all (\\(y,i) -&gt; abs (x-y) /= i) (zip xs [1..])\n\nnqueens :: Int -&gt; [[Int]]\nnqueens queenCount = go [] [1..queenCount]\n  where\n    -- cps = columsn of already positioned queens. \n    -- fps = columns that are still available\n    go :: [Int] -&gt; [Int] -&gt; [[Int]]\n    go cps [] = [cps]\n    go cps fps = [ps | (p,nfps) &lt;- oneOf fps, ps &lt;- go (p:cps) nfps, safeDiag p cps]\n</code></pre>\n\n<p>I'm struggling to adapt this solution to use <code>Select</code> instead.</p>\n\n<p>It seems that <code>Select</code> lets you abstract over the \"evaluation function\" that is used to compare answers. That function is passed to <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Select.html#v:runSelect\" rel=\"noreferrer\"><code>runSelect</code></a>. I have the feeling that something like <code>safeDiag</code> in my solution could work as the evaluation function, but how to structure the <code>Select</code> computation itself? </p>\n\n<p>Also, is it enough to use the <code>Select</code> monad alone, or do I need to use the transformer version over lists?</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1487713183, "post_id": 42378110, "comment_id": 71906158, "body": "Right, though sometimes the most general polymorphic signature is just a bit too crazy. If the constraint list alone is twice as long than the full specialised type would be, I&#39;d think about it whether this is really sensible. (Though <code>ConstraintKind</code>-<code>type</code>defs can make such signatures quite a bit more readable, this comes at a price of obscurity in error messages etc..)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 8, "last_activity_date": 1487712741, "last_edit_date": 1487712741, "creation_date": 1487711652, "answer_id": 42378110, "question_id": 42377833, "link": "https://stackoverflow.com/questions/42377833/function-type-restrictions/42378110#42378110", "title": "Function Type Restrictions", "body": "<p><em>Readability</em> is a matter of opinion. In general, I find that more general type signatures are more readable because there are fewer possible definitions (sometimes there is even only one non-diverging definition). For example, seeing that <code>mean</code> only has a <code>Fractional</code> constraint immediately limits the operations being performed in that function (compared to the <code>Double</code> version which could be performing <code>sqrt</code> operations for all I know). Of course, generalizing types <a href=\"http://www.willamette.edu/~fruehr/haskell/evolution.html\" rel=\"noreferrer\">is not always</a> <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Getter.html#v:ito\" rel=\"noreferrer\">more readable</a>. (<a href=\"https://i.imgur.com/Zv9JH9A.png\" rel=\"noreferrer\">And just for fun</a>)</p>\n\n<p>The main disadvantage of having more general versions of functions is that they may remain unoptimized at runtime so that <code>Double</code>'s dictionary of the <code>Floating</code> functions has to be passed to <code>mean</code> every time it is called.</p>\n\n<p>You can have the best of all worlds by adding a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#specialize-pragma\" rel=\"noreferrer\"><code>SPECIALIZE</code> pragma</a>. This tells the compiler to basically duplicate your function code with some of the type variables instantiated. If you know you are going to be calling your <code>mean</code> function pretty much only with <code>Double</code>, then this is what I would do</p>\n\n<pre><code>{-# SPECIALIZE mean :: [Double] -&gt; Double #-}\nmean :: Fractional a =&gt; [a] -&gt; a\nmean xs = s / n\n  where\n    (s , n) = foldl' k (0,0) xs\n    k (s, n) x = s `seq` n `seq` (s + x, n + 1)\n</code></pre>\n\n<p>And you get to see the specialized version of the signature in your code too! Yay!</p>\n"}], "owner": {"reputation": 41, "user_id": 4740136, "user_type": "registered", "profile_image": "https://graph.facebook.com/1708121358/picture?type=large", "display_name": "Jeffrey Brown", "link": "https://stackoverflow.com/users/4740136/jeffrey-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1487879219, "creation_date": 1487710674, "last_edit_date": 1492087236, "question_id": 42377833, "link": "https://stackoverflow.com/questions/42377833/function-type-restrictions", "title": "Function Type Restrictions", "body": "<p>Is it generally preferable to have the strictest or loosest type definition for a function?  What are the pros and cons of each approach?  I found that when I rewrote <a href=\"https://codereview.stackexchange.com/questions/155662/pearson-correlation-in-haskell\">my pearson correlation code</a> using strictly doubles, it was easier for me to write, follow, and reason about (this could just be inexperience).  But I can also see how having a more broad type definition would make the functions more generally applicable.  Would stricter type definitions be characterized as a form of tech debt?</p>\n\n<p>With Typeclasses:</p>\n\n<pre><code>import Data.List\n\nmean :: Fractional a =&gt; [a] -&gt; a\nmean xs = s / n\n    where\n        (s , n) = foldl' k (0,0) xs\n        k (s, n) x = s `seq` n `seq` (s + x, n + 1)\n\ncovariance :: Fractional a =&gt; [a] -&gt; [a] -&gt; a\ncovariance xs ys = mean productXY\n  where\n   productXY = zipWith (*) [x - mx | x &lt;- xs] [y - my | y &lt;- ys]\n   mx        = mean xs\n   my        = mean ys\n\nstddev :: Floating a =&gt; [a] -&gt; a\nstddev xs = sqrt (covariance xs xs)\n\npearson :: RealFloat a =&gt; [a] -&gt; [a] -&gt; a\npearson x y = fifthRound $ covariance x y / (stddev x * stddev y)\n\npearsonMatrix :: RealFloat a =&gt; [[a]] -&gt; [[a]]\npearsonMatrix (x:xs) = [pearson x y | y &lt;- x:xs]:(pearsonMatrix xs)\npearsonMatrix [] = []\n\nfifthRound :: RealFrac a =&gt; a -&gt; a\nfifthRound x = (/100000) $ fromIntegral $ round (x * 100000)\n</code></pre>\n\n<p>With Doubles:</p>\n\n<pre><code>import Data.List\n\nmean :: [Double] -&gt; Double\nmean xs = s / n\n    where\n        (s , n) = foldl' k (0,0) xs\n        k (s, n) x = s `seq` n `seq` (s + x, n + 1)\n\ncovariance :: [Double] -&gt; [Double] -&gt; Double\ncovariance xs ys = mean productXY\n  where\n   productXY = zipWith (*) [x - mx | x &lt;- xs] [y - my | y &lt;- ys]\n   mx        = mean xs\n   my        = mean ys\n\nstddev :: [Double] -&gt; Double\nstddev xs = sqrt (covariance xs xs)\n\npearson :: [Double] -&gt; [Double] -&gt; Double\npearson x y = fifthRound (covariance x y / (stddev x * stddev y))\n\npearsonMatrix :: [[Double]] -&gt; [[Double]]\npearsonMatrix (x:xs) = [pearson x y | y &lt;- x:xs]:(pearsonMatrix xs)\npearsonMatrix [] = []\n\nfifthRound :: Double -&gt; Double\nfifthRound x = (/100000) $ fromIntegral $ round (x * 100000)\n</code></pre>\n"}, {"tags": ["haskell", "animation", "gloss"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1487701098, "creation_date": 1487701098, "answer_id": 42374978, "question_id": 42374734, "link": "https://stackoverflow.com/questions/42374734/how-can-i-draw-two-shapes-in-a-time-sequence-using-gloss/42374978#42374978", "title": "How can I draw two shapes in a time sequence using Gloss?", "body": "<p>You use <a href=\"https://hackage.haskell.org/package/gloss-1.10.2.5/docs/Graphics-Gloss.html#v:animate\" rel=\"nofollow noreferrer\"><code>animate</code></a> in order to draw a picture depending on the animation time:</p>\n\n<pre><code>main = animate (InWindow \"t\" (400,400) (800,0)) white draw\n\ndraw :: Float -&gt; Picture\ndraw t\n   | t &lt;= 1    = blank                                                -- in the first second\n   | t &lt;= 2    = pictures [Translate 80 0 one]                        -- between 1s and 2s\n   | otherwise = pictures [Translate 80 0 one, Translate (-80) 0 two] -- afterwards\n</code></pre>\n"}], "owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1487701098, "creation_date": 1487700358, "last_edit_date": 1487700659, "question_id": 42374734, "link": "https://stackoverflow.com/questions/42374734/how-can-i-draw-two-shapes-in-a-time-sequence-using-gloss", "title": "How can I draw two shapes in a time sequence using Gloss?", "body": "<p>I have a simple window displaying two shapes like so:</p>\n\n<pre><code>import Graphics.Gloss\n\ncircles = pictures [Translate 80 0 one, Translate (-80) 0 two]\n\nmain = display (InWindow \"t\" (400,400) (800,0)) white circles\n\none = Color red $ Circle 80\ntwo = Color blue $ Circle 50\n</code></pre>\n\n<p>I am new to Gloss, but from what I gather \"display\" just displays a static image once main (i.e. my module) is run so you cant make an animation using \"display\" right?</p>\n\n<p>What I want to do is to run my program with these shapes, but instead of displaying them both at once, I want to first display one circle, the next second the other circle like some kind of animation. </p>\n\n<p>So far I can only do something static and display both circles at once immediately when the program is run. But I want them to appear after each other like <code>Run the program -&gt; (0 sec) Blank screen -&gt; (1 sec) One of the circles is drawn -&gt; (2 sec) the other circle is drawn -&gt; The window now displays circles until I close it.</code></p>\n\n<p>This should be so simple using the \"animate\" function but I can't figure it out. If anyone is out there with knowledge, please consider helping! It would really make my day.</p>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "reactive-programming", "frp"], "comments": [{"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1487711432, "post_id": 42373923, "comment_id": 71905097, "body": "Is it supposed to count more than 1 click? It only counts 1 for me, no matter how many times I click."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1487711694, "post_id": 42373923, "comment_id": 71905272, "body": "@naomik &quot;Is it supposed to count more than 1 click?&quot; -- It is, and at least for me it works that way (Firefox 51.0.1 on Linux, in case that matters)."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487711787, "post_id": 42373923, "comment_id": 71905337, "body": "@duplode ah wups. I waited until the 4 seconds was over. If I click 10 times within the 4-second window, it will display 10 in the log."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1487717076, "post_id": 42373923, "comment_id": 71908072, "body": "Nitpick: in your signature comment, the result type should be <code>(a -&gt; b) -&gt; b</code> rather than <code>a -&gt; b</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1487725187, "post_id": 42373923, "comment_id": 71910790, "body": "I highly recommend reading <a href=\"http://conal.net/papers/icfp97/\" rel=\"nofollow noreferrer\">this paper</a>, which was deeply inspiring to me and will show you some of the &quot;philosophy&quot; of FRP.  It might give you a better grasp of whether your JS implementation is true to the spirit of FRP.  I don&#39;t think it requires an awful lot of Haskell knowledge, just basics, as far as I remember."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1487756588, "post_id": 42373923, "comment_id": 71923918, "body": "I skimmed through the paper @luqui has suggested. My <code>behavior</code> implementation is remotely similar to the <code>stepper</code> combinator. <code>Behavior</code> in Haskell seems to be an unary type constructor that implements the <code>Applicative</code> type class. So I somehow mixed a type class and a combinator - it&#39;s a big mess. I will continue to study the subject and probably answer the question myself."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1487756998, "post_id": 42373923, "comment_id": 71924256, "body": "@naomik I am glad that you brought up this particular property of higher order functions to create data types in one of your answers. I wonder if we can define <code>sum types</code> in Javascript and how they would affect the implementation of monads and other algebras."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1487771325, "post_id": 42373923, "comment_id": 71933956, "body": "@ftor which answer are you referring to?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 1, "creation_date": 1487772365, "post_id": 42373923, "comment_id": 71934820, "body": "@naomik <a href=\"http://stackoverflow.com/a/42193108/6445533\">Inject functions with side-effects</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4074041"}, "edited": false, "score": 0, "creation_date": 1493735164, "post_id": 42373923, "comment_id": 74523747, "body": "Haskell FRP Behavior is just a property calculated event results."}], "answers": [{"tags": [], "owner": {"reputation": 931, "user_id": 2631185, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75f07727c65d676aa81eeb97b794cfa7?s=128&d=identicon&r=PG", "display_name": "Regis Kuckaertz", "link": "https://stackoverflow.com/users/2631185/regis-kuckaertz"}, "is_accepted": false, "score": 1, "last_activity_date": 1521325981, "creation_date": 1521325981, "answer_id": 49342564, "question_id": 42373923, "link": "https://stackoverflow.com/questions/42373923/how-to-implement-haskells-frp-behavior-type-in-javascript/49342564#49342564", "title": "How to implement Haskell&#39;s FRP Behavior type in Javascript?", "body": "<p>Your implementation of <code>behavior</code> is closer to events in the FRP terminology, even though FRP events and DOM events have nothing in common. At its core, FRP abstracts the notion of continuous (as opposed to discrete) time. <code>Behavior a</code> represents a continuous flow of values of type <code>a</code>; hence its <em>meaning</em> is as a function from time to value.</p>\n\n<p>It is literally how Conal Eliott defined it:</p>\n\n<pre><code>\u03bc :: Behaviour a -&gt; (Time -&gt; a)\n</code></pre>\n\n<p>That notation is the one he used to describe the meaning of something as a function from that thing to a concrete computational value.</p>\n\n<p>Events are \"behaviours frozen in time\", i.e. they represent values that occured at specific moments:</p>\n\n<pre><code>\u03bc :: Event a -&gt; [(Time, a)]\n</code></pre>\n\n<p>Because Haskell is a lazy language, streams of values can be represented as lists, which is what the above is saying.</p>\n\n<p>Oddly enough, there are not many implementations of FRP that remain true to the original idea, as (I think) it is hard to come up with a performant realisation of continuous time\u2014<a href=\"https://www.youtube.com/watch?v=tyaYLGQSr4g\" rel=\"nofollow noreferrer\">this C++ one seems to come close</a>.</p>\n\n<p>I encourage you to watch Conal Eliott's talks available online, his are some of the most elegant API designs I've ever seen and he explains it with crystal clarity.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 2, "answer_count": 1, "score": 19, "last_activity_date": 1522514200, "creation_date": 1487697666, "question_id": 42373923, "link": "https://stackoverflow.com/questions/42373923/how-to-implement-haskells-frp-behavior-type-in-javascript", "title": "How to implement Haskell&#39;s FRP Behavior type in Javascript?", "body": "<p>I'd like to understand the original meaning of functional reactive programming in Haskell and how it differs from the actual application of FRP in Javascript. Unfortunately, I have only a superficial understanding of Haskell and have to stick with Javascript.</p>\n\n<p>Here is my attempt to implement Haskell's <code>Behavior</code> data type in an untyped language:</p>\n\n<pre><code>// behavior :: String -&gt; DOMHTMLElement -&gt; a -&gt; (a -&gt; Event -&gt; a) -&gt; (a -&gt; b)\n\nconst behavior = type =&gt; target =&gt; x =&gt; f =&gt; {\n  const destructiveSet = y =&gt; (x = f(x) (y), x), // A\n   handler = event =&gt; destructiveSet(event);\n\n  target.addEventListener(type, handler, true);\n  return g =&gt; g(x);\n};\n</code></pre>\n\n<p>Line <code>A</code> is necessary, because I have to mutate the initial value <code>x</code>, which is held by the call stack. The function body evaluates from left to right and returns the value of the last operand of the comma operator <code>,</code>, i.e. the destructively updated version of <code>x</code>.</p>\n\n<p><code>target.addEventListener</code> merely subscribes the given handler to the given DOM HTML-element.</p>\n\n<p><code>behavior</code> returns a function that enables read-only access to <code>x</code>.</p>\n\n<p>This implementation introduces a read-only abstract data type in Javascript, whose values solely exist in the call stacks of higher order functions. Provided that DOM Events are only triggered by GUI users, a program has no means to mutate values of type <code>behavior</code>. It can only poll them to observe the time-varying effect.</p>\n\n<p><strong>Is this approach remotely comparable to Haskell's <code>Behavior</code>?</strong></p>\n\n<p>Here is a small example - a mouse click counter (counts for four seconds):</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>const behavior = type =&gt; target =&gt; x =&gt; f =&gt; {\r\n  const destructiveSet = y =&gt; (x = f(x) (y), x),\r\n   handler = event =&gt; destructiveSet(event);\r\n\r\n  target.addEventListener(type, handler, true);\r\n  return g =&gt; g(x);\r\n};\r\n\r\n\r\nconst comp = f =&gt; g =&gt; x =&gt; f(g(x));\r\n\r\nconst K = x =&gt; y =&gt; x;\r\n\r\nconst I = x =&gt; x;\r\n\r\nconst get = I;\r\n\r\nconst defer = n =&gt; f =&gt; x =&gt; setTimeout(f, n, x);\r\n\r\nconst log = prefix =&gt; x =&gt; console.log(prefix, x);\r\n\r\nconst inc = x =&gt; x + 1;\r\n\r\nconst counter = behavior(\"click\") (document) (0) (comp(K) (inc));\r\n\r\n\r\nconsole.log(\"click on the section above\");\r\n\r\ncounter(get); // 0\r\n\r\ndefer(4000) (counter) (log(\"counted clicks:\"));</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487690510, "post_id": 42371248, "comment_id": 71892024, "body": "<code>map</code> and <code>Data.List.map</code> are identical."}, {"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487691128, "post_id": 42371248, "comment_id": 71892503, "body": "Yes, I read that, can you please tell why I am getting the error?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487691165, "post_id": 42371248, "comment_id": 71892539, "body": "The compiler is complaining about the type signature <code>(Ord k) =&gt; [(k,a)] -&gt; Map k [a]</code> - the type <code>Map</code> is only imported qualified, hence you must write <code>Map.Map</code> (as you did in the other type)."}], "answers": [{"comments": [{"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487692462, "post_id": 42371579, "comment_id": 71893599, "body": "Thanks for the help. I got confused with the error message."}], "tags": [], "owner": {"reputation": 3100, "user_id": 933616, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ac358baf891ce02fb4a686c1ad6b9ac4?s=128&d=identicon&r=PG", "display_name": "Benjamin Kovach", "link": "https://stackoverflow.com/users/933616/benjamin-kovach"}, "is_accepted": true, "score": 2, "last_activity_date": 1487691233, "creation_date": 1487691233, "answer_id": 42371579, "question_id": 42371248, "link": "https://stackoverflow.com/questions/42371248/how-to-mention-different-modules/42371579#42371579", "title": "How to mention different modules", "body": "<p>You are importing <code>Data.Map</code> qualified as <code>Map</code>, but trying to refer to the <code>Map</code> data type without qualification.</p>\n\n<p>You need to change <code>Map k [a]</code> in the type signature of <code>phoneBookFromWithList</code> to <code>Map.Map k [a]</code> in order to properly refer to the <code>Map</code> data type.</p>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "closed_date": 1487698775, "accepted_answer_id": 42371579, "answer_count": 1, "score": 1, "last_activity_date": 1487691233, "creation_date": 1487690383, "last_edit_date": 1487690498, "question_id": 42371248, "link": "https://stackoverflow.com/questions/42371248/how-to-mention-different-modules", "closed_reason": "Not suitable for this site", "title": "How to mention different modules", "body": "<p>I do not know how to import two different modules at the same time. THe following code</p>\n\n<pre><code>import qualified Data.Map as Map \nimport Data.List\n\nphoneBookToList :: (Ord k) =&gt; [(k,String)] -&gt; Map.Map k String\nphoneBookToList xs = Map.fromListWith (\\n1 n2 -&gt; n1 ++ \", \" ++ n2) xs\n\nphoneBookFromWithList :: (Ord k) =&gt; [(k,a)] -&gt; Map k [a]\nphoneBookFromWithList = Map.fromListWith (++)  $ map (\\(k,a) -&gt; (k,[a]))\n</code></pre>\n\n<p>throws this error</p>\n\n<pre><code>Not in scope: type constructor or class `Map'\nPerhaps you meant `Map.Map' (imported from Data.Map)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>The <code>map (\\(k,a) -&gt; (k,[a]))</code> I am trying to use it from the default Prelude module. I tried <code>Data.List.map (\\(k,a) -&gt; (k,[a]))</code>, but still get an error. It wordks as a GHCi command though. Thanks in advance</p>\n"}, {"tags": ["haskell", "polymorphism", "higher-kinded-types"], "answers": [{"comments": [{"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "edited": false, "score": 0, "creation_date": 1487692487, "post_id": 42370593, "comment_id": 71893622, "body": "Great explanation and a nicely &quot;real-world&quot; scenario to grasp the potential of this capacity --- much obliged @chi!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 16, "last_activity_date": 1541699716, "last_edit_date": 1541699716, "creation_date": 1487688661, "answer_id": 42370593, "question_id": 42370444, "link": "https://stackoverflow.com/questions/42370444/what-types-of-problems-helps-higher-kinded-polymorphism-solve-better/42370593#42370593", "title": "What types of problems helps &quot;higher-kinded polymorphism&quot; solve better?", "body": "<p>Yes, <code>f</code> can be any unary type constructor. </p>\n\n<p>For instance <code>ListFunctor [] Int</code> or <code>ListFunctor Maybe Char</code> are well-kinded.</p>\n\n<p><code>f</code> can also be any n-ary type constructor with (n-1) arguments partially applied.</p>\n\n<p>For instance <code>ListFunctor ((-&gt;) Bool) Int</code> or <code>ListFunctor (Either ()) Char</code> are well-kinded.</p>\n\n<p>The basic kinding system is quite simple. If <code>F :: * -&gt; * -&gt; ... -&gt; *</code>, then <code>F</code> expects type arguments. If <code>G :: (* -&gt; *) -&gt; *</code>, then <code>G</code> expects any thing of kind <code>* -&gt; *</code> including unary type constructor and partial applications as the ones shown above. And so on.</p>\n\n<hr>\n\n<p>A problem which is nicely solved by higher kinds is configuration options. Assume we have a record</p>\n\n<pre><code>data Opt = Opt \n   { opt1 :: Bool\n   , opt2 :: String\n   -- many other fields here\n   }\n</code></pre>\n\n<p>Now, configuration settings can be found in a file and/or passed through the command line and/or in environment variables. During the parsing of all these settings sources, we need to cope with the fact that not all sources define all options. Hence, we need a more lax type to represent subsets of configuration settings:</p>\n\n<pre><code>data TempOpt = TempOpt \n   { tempOpt1 :: Maybe Bool\n   , tempOpt2 :: Maybe String\n   -- many other fields here\n   }\n\n-- merge all options in one single configuration, or fail\nfinalize :: [TempOpt] -&gt; Maybe Opt\n...\n</code></pre>\n\n<p>This is horrible, since it duplicates all the options! We would be tempted to remove the <code>Opt</code> type, and only use the weaker <code>TempOpt</code>, to reduce clutter. However, by doing this we will need to use some partial accessor like <code>fromJust</code> every time we need to access the value of an option in our program, even after the initial configuration handling part.</p>\n\n<p>We can instead resort to higher kinds:</p>\n\n<pre><code>data FOpt f = FOpt \n   { opt1 :: f Bool\n   , opt2 :: f String\n   -- many other fields here\n   }\ntype Opt = FOpt Identity\ntype TempOpt = FOpt Maybe\n\n-- as before: merge all options in one single configuration, or fail\nfinalize :: [TempOpt] -&gt; Maybe Opt\n...\n</code></pre>\n\n<p>No more duplication. After we <code>finalize</code> the configuration settings, we get the static guarantee that settings are always present. We can now use the <em>total</em> accessor <code>runIdentity</code> to get them, instead of the dangerous <code>fromJust</code>.</p>\n"}], "owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 2, "accepted_answer_id": 42370593, "answer_count": 1, "score": 7, "last_activity_date": 1541699716, "creation_date": 1487688260, "question_id": 42370444, "link": "https://stackoverflow.com/questions/42370444/what-types-of-problems-helps-higher-kinded-polymorphism-solve-better", "title": "What types of problems helps &quot;higher-kinded polymorphism&quot; solve better?", "body": "<p>As I read through some sections in <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/history.pdf\" rel=\"noreferrer\">History of Haskell</a>, I came across:</p>\n\n<blockquote>\n  <p>However, higher-kinded polymorphism has independent utility: it is entirely possible, and occasionally very useful, to declare data types parameterised over higher kinds, such as:</p>\n</blockquote>\n\n<pre><code>data ListFunctor f a = Nil | Cons a (f a)\n</code></pre>\n\n<p>Knowing \"basic\" ADTs I was a bit puzzled here, my \"guess\" was that the part in parens suggests a \"parametric\"/\"dynamic\" <em>unary data constructor</em> <code>f</code>? So any data constructor of kind <code>* -&gt; *</code> that \"can accept\" type <code>a</code>? Is my thinking correct or am I misinterpreting the syntax? I know I'm \"just guessing\" but I'm hopeful to gain a \"lay-programmer\" intuition on this capability here, some sample scenario needing (or benefiting immensively from) this ;)  mostly I can imagine (just not in what exact manner) this allowing more flexibility in those \"small embedded versatile recursable config language\"-ADTs that Haskell makes such a pleasure to formulate and write <code>evals</code> for.. close?</p>\n\n<p>In GHCi, <code>:i ListFunctor</code> on the above gives:</p>\n\n<pre><code>type role ListFunctor representational nominal\ndata ListFunctor (f :: * -&gt; *) a = Nil | Cons a (f a)\n</code></pre>\n\n<p>So this seems to be what's \"inferred\" from the crisper <code>data</code> declaration.</p>\n"}, {"tags": ["haskell", "haskell-vector"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487689115, "post_id": 42368907, "comment_id": 71890961, "body": "Possibly related: <a href=\"http://stackoverflow.com/q/42178164/1139697\">stackoverflow.com/q/42178164/1139697</a>"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1487689378, "post_id": 42368907, "comment_id": 71891143, "body": "Probably <code>VU.reverse</code>, since vector fusion is based on stream fusion and you can&#39;t reverse a stream. You could build a stream that traverses the original <code>vec</code> in reverse order though."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487689496, "post_id": 42368907, "comment_id": 71891233, "body": "@ReidBarton If everything is in a single module, <code>topDown</code> beats <code>testTd</code> in all benchmarks. I blame missing cross-module inlining, but I haven&#39;t looked at the core yet."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487689618, "post_id": 42368907, "comment_id": 71891312, "body": "But in real life you probably read <code>vec</code> from a file or something. So the lack of inlining gives you a more realistic benchmark."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1487689937, "post_id": 42368907, "comment_id": 71891547, "body": "Even if I disable inlining, <code>topDown</code> beats <code>testTd</code> on 150 (1&#181;s vs 750 ns), but loses on all others). I am only able to reproduce this behaviour if I don&#39;t specificy any optimizations at all. With <code>-O2</code>, <code>topDown</code> always stays below 1&#181;s. @Artem, you did enable optimization, right?"}, {"owner": {"reputation": 277, "user_id": 2464093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5066381bc937a320b03de5926f4f8024?s=128&d=identicon&r=PG", "display_name": "Artem Solod", "link": "https://stackoverflow.com/users/2464093/artem-solod"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1487692295, "post_id": 42368907, "comment_id": 71893498, "body": "@Zeta, It looks like I did not. Compiling with <code>-O2</code> brings benchmarks to &lt;100ns for <code>topDown&#47;150</code> and ~400ns for <code>testTD&#47;150</code>.These functions are used in a bigger project where I see performance difference similar to that in initial benchmarks irrespective of optimization flags used. I will try to dig a bit more and come up with a better minimal example."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487699873, "post_id": 42368907, "comment_id": 71898483, "body": "But even with optimization <code>testTd&#47;90</code> is over an order of magnitude faster than <code>topDown&#47;90</code>, right?"}, {"owner": {"reputation": 277, "user_id": 2464093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5066381bc937a320b03de5926f4f8024?s=128&d=identicon&r=PG", "display_name": "Artem Solod", "link": "https://stackoverflow.com/users/2464093/artem-solod"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487703500, "post_id": 42368907, "comment_id": 71900560, "body": "@ReidBarton, <code>-O3</code> yields flat 30ns for <code>topDown&#47;1&#47;90&#47;100</code>, 100ns for <code>topDown&#47;150</code> and 19ns for <code>testTd&#47;1&#47;90</code>, 29ns for <code>testTd&#47;100</code>, 420ns for <code>testTd&#47;150</code>. In fact I&#39;m quite impressed with what optimizer does to <code>topDown&#47;150</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1487704571, "post_id": 42368907, "comment_id": 71901125, "body": "There is no <code>-O3</code>. That option will do exactly the same thing as <code>-O2</code>."}], "owner": {"reputation": 277, "user_id": 2464093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5066381bc937a320b03de5926f4f8024?s=128&d=identicon&r=PG", "display_name": "Artem Solod", "link": "https://stackoverflow.com/users/2464093/artem-solod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1487703653, "creation_date": 1487684387, "last_edit_date": 1487703653, "question_id": 42368907, "link": "https://stackoverflow.com/questions/42368907/should-i-expect-data-vector-to-fuse-the-following-function", "title": "Should I expect Data.Vector to fuse the following function?", "body": "<p>I have recently started using Data.Vector. My understanding is that it should be able to take chains of vector operations and efficiently combine them via fusion.</p>\n\n<p>In particular, I would expect these two functions to have similar performance characteristics (i.e. searchTopDown to fuse into something like searchTd).</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as VU\nimport Data.Vector.Unboxed (fromList, (!))\n\n--| Going down from i searches the vector for the element satisfying predicate \nsearchTopDown :: VU.Vector Int -&gt; Int -&gt; (Int -&gt; Bool) -&gt; (Int, Int)\nsearchTopDown vec i pred =\n    VU.head $ VU.dropWhile (not . pred . snd)\n    $ VU.reverse $ VU.take (1 + i)\n    $ VU.indexed vec\n\nsearchTd :: VU.Vector Int -&gt; Int -&gt; (Int -&gt; Bool) -&gt; (Int, Int)\nsearchTd vec i pred = let val = vec ! i\n                    in\n                      if pred val then (i,  val) else searchTd vec (i-1) pred\n</code></pre>\n\n<p>However, benchmarking this code shows performance difference in orders of magnitude.</p>\n\n<pre><code>testTd/150\n                 lower bound    estimate    upper bound\nOLS regression      4.51 \u03bcs     4.53 \u03bcs     4.56 \u03bcs\nR\u00b2 goodness-of-fit  1.000       1.000       1.000\nMean execution time 4.52 \u03bcs     4.53 \u03bcs     4.55 \u03bcs\nStandard deviation  35.2 ns     50.0 ns     69.8 ns\n\ntopDown/150\n                 lower  bound    estimate    upper bound\nOLS regression     75.4 \u03bcs       76.6 \u03bcs     77.9 \u03bcs\nR\u00b2 goodness-of-fit  0.997        0.998       0.999\nMean execution time 74.6 \u03bcs      75.2 \u03bcs     76.1 \u03bcs\nStandard deviation  1.58 \u03bcs      2.42 \u03bcs     3.75 \u03bcs\n</code></pre>\n\n<p>Questions: What prevents searchTopDown from being fused? What can I do to help it fuse? When should I expect fusion in general?</p>\n\n<p>Code used for benchmarks:</p>\n\n<pre><code>import qualified Data.List as L\nimport Criterion.Main\n\nvec :: VU.Vector Int\nvec = fromList $ L.replicate 100 (-1) L.++ L.replicate 100 1\n\ntestTd :: Int -&gt; Int\ntestTd i = fst $ searchTd vec i (&lt;0)\n\ntestTopDown :: Int -&gt; Int\ntestTopDown i = fst $ searchTopDown vec i (&lt;0)\n\n\nbenchMain = defaultMain [\n     bgroup \"testTd\"    [ bench \"1\"  $ whnf testTd 1\n                        , bench \"90\"  $ whnf testTd 90\n                        , bench \"100\"  $ whnf testTd 100\n                        , bench \"150\" $ whnf testTd 150\n      ],\n      bgroup \"topDown\"  [ bench \"1\"  $ whnf testTopDown 1\n                        , bench \"90\"  $ whnf testTopDown 90\n                        , bench \"100\"  $ whnf testTopDown 100\n                        , bench \"150\" $ whnf testTopDown 150\n      ]\n  ]\n</code></pre>\n\n<p><strong>EDIT</strong>\nFollowing @Zeta suggestions (adding <code>-O2</code>) I get excellent performance from both functions. However, I experience this problem in a larger project so I changed benchmarking code to resemble it. <code>searchTopDown</code> seems to be linear in <code>i</code> for this case. New benchmarking code and results (in microsecs):</p>\n\n<pre><code>import Data.Vector.Unboxed (fromList, (!))\nimport qualified Data.Vector.Unboxed as VU\nimport qualified Data.Vector.Unboxed.Mutable as VM\nimport Control.Monad.ST\nimport qualified Data.List as L\n\ndatStream :: [(Int, Int)]\ndatStream = L.zip [0..] $ L.replicate 100 (-1) L.++ L.replicate 100 1\n\nvecUpdate v (iChg, vChg) = runST $ do\n    mv &lt;- VU.unsafeThaw v\n    VM.modify mv (+ vChg) iChg\n    VU.unsafeFreeze mv\n\nvecs :: [VU.Vector Int]\nvecs = let vecInit = VU.replicate 200 0 in L.drop 1 $ L.scanl' vecUpdate vecInit datStream\n\ntest f i = L.sum $ L.map (\\x -&gt; fst $ f x i (&lt;0)) vecs\ntestTd = test searchTd\ntestTopDown = test searchTopDown\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/3SQu6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3SQu6.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487676023, "post_id": 42365769, "comment_id": 71881631, "body": "It will be <code>Integer</code> if you assure the compiler that the first argument is an <code>Integer</code>, not an <code>Int</code> <code>Double</code> etc. So <code>:t kessel (1::Integer) 2</code> is <code>Integer</code>"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487676322, "post_id": 42365769, "comment_id": 71881829, "body": "Why do I not get just <code>Num</code> instead of <code>(Num a, Ord a) =&gt; a</code>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1487676450, "post_id": 42365769, "comment_id": 71881906, "body": "Only the first argument matters. It must be <code>Ord</code> because you required that. It must be <code>Num</code> because you used a numeric literal."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487676613, "post_id": 42365769, "comment_id": 71882006, "body": "That in the signature for <code>kessel</code> you used <code>Num b</code> as a constraint on the second argument, is not affecting the type here."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487676688, "post_id": 42365769, "comment_id": 71882047, "body": "But how it can becomes <code>Num a</code>  instead of <code>Num b</code>?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487676776, "post_id": 42365769, "comment_id": 71882097, "body": "The type of the second argument of <code>kessel</code> doesn&#39;t affect the type of the result, which is the same as that of the first argument. Maybe it would be clearer if you actually implemented eg. <code>kessel a b = a</code> with your signature. What&#39;s making <code>kessel 1 2</code> just some Num+Ord or other is that <code>1</code> is some Num or other."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487677744, "post_id": 42365769, "comment_id": 71882716, "body": "Note, e.g. that <code>kessel &#39;a&#39; 2 :: Char</code>"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1487691232, "post_id": 42365769, "comment_id": 71892593, "body": "@zero_coding I think you misunderstand what <code>Num a =&gt; a</code> means. The <code>a</code> is just an arbitrary label, not related to the <code>a</code> or <code>b</code> in your original type signature. It could just as easily be <code>Num foo =&gt; foo</code>, but we usually use one letter by convention. <code>Num</code> on it&#39;s own is not a type, it&#39;s a <i>constraint</i> on a generic type, and we need to give that generic type a local name, in order to constrain it and refer to it in other parts of a type. The syntax just means: <i>Any type (let&#39;s call it <code>a</code>) that is constrained by the <code>Num</code> type class</i>."}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487678516, "post_id": 42366146, "comment_id": 71883241, "body": "How can I read <code>kessel 1 :: (Num a, Num b, Ord a) =&gt; b -&gt; a</code> ?  Why can I eliminate <code>b</code> here <code>kessel 1 2 :: (Num a, Ord a) =&gt; a</code>? I can not eliminate <code>a</code> here <code>kessel 1 2 :: (Num a, Ord a) =&gt; a</code>, because is still bound?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487678791, "post_id": 42366146, "comment_id": 71883440, "body": "The result of <code>id 1 :: Num a =&gt; a</code> would be an instance of <code>Num</code>? What is a Context inheritance from class(the operator <code>=&gt;</code> ) mean?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487680218, "post_id": 42366146, "comment_id": 71884478, "body": "You can eliminate <code>a</code> in <code>kessel 1 2 :: (Num a, Ord a) =&gt; a</code> by telling the compiler exactly what you mean by <code>1</code>, e.g. <code>kessel (1::Integer) 2 :: Integer</code> As it stands a numeric literal can be in any numeric type <code>a</code>, which is what <code>Num a =&gt; ...</code> means."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487692225, "post_id": 42366146, "comment_id": 71893443, "body": "@Zeta It looks like a lambda calculus beta reduction right?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1487681126, "last_edit_date": 1487681126, "creation_date": 1487676762, "answer_id": 42366146, "question_id": 42365769, "link": "https://stackoverflow.com/questions/42365769/why-num-a-ord-a-a/42366146#42366146", "title": "Why (Num a, Ord a) =&gt; a", "body": "<p>Because <code>1</code> has type <code>Num a =&gt; a</code>:</p>\n\n<pre><code>ghci&gt; :t 1\n1 :: Num a =&gt; a\nghci&gt; :t kessel\nkessel :: (Num b, Ord a) =&gt; a -&gt; b -&gt; a\nghci&gt; :t kessel 1\nkessel 1 :: (Num a, Num b, Ord a) =&gt; b -&gt; a\nghci&gt; :t kessel 1 2\nkessel 1 2 :: (Num a, Ord a) =&gt; a\n</code></pre>\n\n<p>The constraints from <code>1</code> (<code>Num</code>) get <em>added</em> to the already existing ones. It's the same when you use <code>id</code> for example:</p>\n\n<pre><code>id   :: a -&gt; a\nid 1 :: Num a =&gt; a\n</code></pre>\n\n<h1>Longer explanation</h1>\n\n<p>When you use <code>kessel :: (Ord a, Num b) =&gt; a -&gt; (b -&gt; a)</code>, you tell the compiler that <code>kessel</code> will take <em>any</em> <code>a</code>, that is an instance of <code>Ord</code>. <code>kessel</code> will then return a function from <em>any</em> other (not necessarily different) type <code>b</code>, that is also an instance of <code>Num</code> to the previously mentioned type <code>a</code>.</p>\n\n<p>This means that the first argument you use for <code>kessel</code> will set <code>a</code>:</p>\n\n<pre><code>ghci&gt; :t kessel (1 :: Int)\nkessel (1 :: Int) :: Num b =&gt; b -&gt; Int\nghci&gt; :t kessel 'A'\nkessel 'A' :: Num b =&gt; b -&gt; Char\nghci&gt; :t kessel \"Hello, World!\"\nkessel \"Hello, World!\" :: Num b =&gt; b -&gt; String\n</code></pre>\n\n<p>In all these cases, the type of the argument was clear. But what if we use a value that is polymorphic? For example this one:</p>\n\n<pre><code>magic :: Magic a =&gt; a\n</code></pre>\n\n<p>And also let's use a simpler function, namely <code>const</code>:</p>\n\n<pre><code>const :: a -&gt; b -&gt; a\nconst x y = x\n</code></pre>\n\n<p>What is <code>const magic</code>? Let's start simpler. What is <code>const \"Hello, World?\"</code>?</p>\n\n<pre><code>const                 :: a      -&gt; b -&gt; a\n\"Hello, World?\"       :: String\nconst \"Hello, World?\" ::           b -&gt; String\n</code></pre>\n\n<p>We replaced <em>every</em> occurence of <code>a</code> with <code>\"Hello, World?\"</code>'s type. Now back to our <code>magic</code> example:</p>\n\n<pre><code>const       ::            a -&gt; b -&gt; a\nmagic       :: Magic t =&gt; t\nconst magic :: Magic t =&gt;      b -&gt; t\n</code></pre>\n\n<p>Again, we replace every occurrence of <code>a</code> with our type, in this case <code>t</code>. However, we must not forget the additional constraint on <code>t</code>, namely <code>Magic</code>. We must bring it along. Therefore, we gain the additional constraint here. But if there were any constraint on <code>a</code>, we still have to place them to <code>t</code>.</p>\n\n<p>Let us now go back to your original <code>kessel</code>:</p>\n\n<pre><code>kessel   :: (Num b, Ord a         ) =&gt; a -&gt; b -&gt; a\n1        :: (Num n                ) =&gt; n\nkessel 1 :: (Num na, Ord na, Num b) =&gt;      b -&gt; na\n</code></pre>\n\n<p>We <em>still</em> keep <code>a</code>'s original constraint. Therefore, we now have two constraints, <code>Num</code> and <code>Ord</code>. If we now use any type that fulfilfs the <code>Num</code> constraint, all we have left is <code>na</code>. Since it is not on the right hand side anymore, its constraint can be discarded:</p>\n\n<pre><code>kessel 1 2 :: (Num na, Ord na) =&gt; na\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 616, "favorite_count": 0, "accepted_answer_id": 42366146, "answer_count": 1, "score": 2, "last_activity_date": 1487681126, "creation_date": 1487675686, "question_id": 42365769, "link": "https://stackoverflow.com/questions/42365769/why-num-a-ord-a-a", "title": "Why (Num a, Ord a) =&gt; a", "body": "<p>I have following type signature:</p>\n\n<pre><code>let kessel :: (Ord a, Num b) =&gt; a -&gt; b -&gt; a; kessel = undefined \n</code></pre>\n\n<p>When I asked for result type:</p>\n\n<pre><code>:t kessel 1 2\n</code></pre>\n\n<p>I've got: </p>\n\n<pre><code>kessel 1 2 :: (Num a, Ord a) =&gt; a\n</code></pre>\n\n<p>Why not <code>Integer</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487672648, "post_id": 42364529, "comment_id": 71879200, "body": "Because the type of function application is <code>(a -&gt; b) -&gt; a -&gt; b</code>, not <code>(a -&gt; b) -&gt; a -&gt; (a -&gt; b)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 9272, "user_id": 241544, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d27ca4e9a9a41ec8732046e6a272f091?s=128&d=identicon&r=PG", "display_name": "Matthew Walton", "link": "https://stackoverflow.com/users/241544/matthew-walton"}, "is_accepted": false, "score": 2, "last_activity_date": 1487672480, "creation_date": 1487672480, "answer_id": 42364617, "question_id": 42364529, "link": "https://stackoverflow.com/questions/42364529/why-the-type-is-char-char-char/42364617#42364617", "title": "Why the type is Char -&gt; Char -&gt; Char", "body": "<p>It's because <code>f x</code> is the function <code>f</code> with its first parameter already applied, so it only needs two more to get the result. This is called <em>currying</em>.</p>\n\n<p>In Haskell, there isn't really any such thing as a function with three parameters. <code>a -&gt; a -&gt; a -&gt; a</code> means \"A function which takes an <code>a</code> and returns a function which takes an <code>a</code> and returns a function which takes an <code>a</code> and returns an <code>a</code>\".</p>\n\n<p>That's a lot of a mouthful to write out, so just put some parens in and it gets clearer: <code>a -&gt; (a -&gt; (a -&gt; a))</code>.</p>\n\n<p>So <code>f x</code> gives you <code>a -&gt; (a -&gt; a)</code>. It just so happens that Haskell's syntax allows you to say <code>f x y z</code> and act like you're calling a function with three parameters and that the compiler's smart enough not to construct all those intermediate curried functions when it doesn't need to.</p>\n"}, {"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487673072, "post_id": 42364675, "comment_id": 71879497, "body": "Thanks a lot for your help."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1487672648, "creation_date": 1487672648, "answer_id": 42364675, "question_id": 42364529, "link": "https://stackoverflow.com/questions/42364529/why-the-type-is-char-char-char/42364675#42364675", "title": "Why the type is Char -&gt; Char -&gt; Char", "body": "<p>Yes, exactly. Consider a different function, <code>length :: [a] -&gt; Int</code>. If you ask for the type of <code>length \"abc\"</code>, you get <code>Int</code>:</p>\n\n<pre><code>Prelude&gt; :t length \"foo\"\nlength \"foo\" :: Int\n</code></pre>\n\n<p>In general, if you have a function <code>f :: A -&gt; B</code> and an argument <code>x :: A</code>, then <code>f x :: B</code>.</p>\n\n<p>In your case we have <code>f :: a -&gt; (a -&gt; a -&gt; a)</code> (specialized to <code>a = Char</code>), so <code>A = Char</code> and <code>B = Char -&gt; Char -&gt; Char</code>.</p>\n\n<p>(<code>a -&gt; a -&gt; a -&gt; a</code> is the same as <code>a -&gt; (a -&gt; a -&gt; a)</code> because <code>-&gt;</code> in types is right associative.)</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 42364675, "answer_count": 2, "score": 2, "last_activity_date": 1487672648, "creation_date": 1487672240, "question_id": 42364529, "link": "https://stackoverflow.com/questions/42364529/why-the-type-is-char-char-char", "title": "Why the type is Char -&gt; Char -&gt; Char", "body": "<p>I have following type signature:</p>\n\n<pre><code>*Main Lib&gt; let f :: a -&gt; a -&gt; a -&gt; a; f = undefined  \n*Main Lib&gt; let x :: Char; x = undefined \n</code></pre>\n\n<p>so to find out, which result type would I get, I did:</p>\n\n<pre><code>*Main Lib&gt; :t f x\nf x :: Char -&gt; Char -&gt; Char\n</code></pre>\n\n<p>Why not </p>\n\n<pre><code>Char -&gt; Char -&gt; Char -&gt; Char\n</code></pre>\n\n<p>Because of the first parameter is already with <code>x</code> substituted?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487672485, "post_id": 42363935, "comment_id": 71879065, "body": "You throw away the actual value generated by <code>randoms&#39;&#39;&#39;</code> (<code>(_, gen&#39;) &lt;- ...</code>) so the compiler has no idea at which type to instantiate the use of <code>randoms&#39;&#39;&#39;</code>; there is no reason for it to pick the same type <code>a</code> that is the output, nor any other particular type, so it is ambiguous. In the monomorphic case, there is no instantiation possible - naturally it may only pick <code>Int</code> for the recursive case."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7597556, "user_type": "registered", "profile_image": "https://graph.facebook.com/1839838722931569/picture?type=large", "display_name": "Oyu", "link": "https://stackoverflow.com/users/7597556/oyu"}, "edited": false, "score": 0, "creation_date": 1487687298, "post_id": 42365462, "comment_id": 71889483, "body": "Your first solution using <code>asTypeOf</code> solves the problem. However, the second solution <code>randomList</code> gives rise to almost exactly the same error message (and it works again if the type signature is set to be monomorphic). I still don&#39;t get why the type of <code>_</code> is arbitrary simply because it is not used; there is no such a problem in the monomorphic case anyway. Perhaps the mechanism of type inference is somewhat different between the monomorphic and polymorphic cases?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 21, "user_id": 7597556, "user_type": "registered", "profile_image": "https://graph.facebook.com/1839838722931569/picture?type=large", "display_name": "Oyu", "link": "https://stackoverflow.com/users/7597556/oyu"}, "edited": false, "score": 0, "creation_date": 1487688918, "post_id": 42365462, "comment_id": 71890793, "body": "@Oyu I removed the wrong function. I have no idea why it worked when I&#39;ve tried it. Either way, <code>_</code> is &quot;used&quot;. It is part of the result of a <code>random</code> call. If we use <code>let (val, gen) = random (mkStdGen 0) :: (a, StdGen)</code>, we end up with another generator <code>gen</code> depending on the type. For <code>a ~ Int</code>, we get <code>(9106162675347844341,1346387765 2103410263)</code>. For <code>a ~ Char</code>, we get <code>(&#39;\\589059&#39;,40014 40692)</code>. After all, you have to call <code>next</code> often enough to create a uniform distribution over your whole range of values."}, {"owner": {"reputation": 21, "user_id": 7597556, "user_type": "registered", "profile_image": "https://graph.facebook.com/1839838722931569/picture?type=large", "display_name": "Oyu", "link": "https://stackoverflow.com/users/7597556/oyu"}, "edited": false, "score": 0, "creation_date": 1487695438, "post_id": 42365462, "comment_id": 71895771, "body": "I have experimented with some foo codes as re-edited at the end of my original post. Can you give me some comments about what you think?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1487688644, "last_edit_date": 1487688644, "creation_date": 1487674749, "answer_id": 42365462, "question_id": 42363935, "link": "https://stackoverflow.com/questions/42363935/haskell-error-could-not-deduce-random-a0-arising-from/42365462#42365462", "title": "Haskell error: Could not deduce (Random a0) arising from", "body": "<pre><code>(_, gen') &lt;- randoms''' gen\n</code></pre>\n\n<p>Which type has <code>_</code> here? You probably think it should be the <code>a</code> given in <code>randoms'''</code>'s signature. However, it's arbitrary. It might be <code>()</code>, it might be <code>Char</code>. Everything could work here, since you don't use it anyway. We can force it to have the same type as <code>random gen'</code>:</p>\n\n<pre><code>randoms''' gen = random gen : [random gen' `asTypeOf` x | x@(_, gen') &lt;- randoms''' gen]\n</code></pre>\n\n<p><code>asTypeOf</code> is a standard function and basically a type constrained version of <code>const</code>:</p>\n\n<pre><code>asTypeOf :: a -&gt; a -&gt; a\nasTypeOf = const\n</code></pre>\n\n<p>With this function, we can determine the type of <code>x</code> and therefore the type of <code>_</code>, since the type of <code>random gen'</code> is known.</p>\n"}], "owner": {"reputation": 21, "user_id": 7597556, "user_type": "registered", "profile_image": "https://graph.facebook.com/1839838722931569/picture?type=large", "display_name": "Oyu", "link": "https://stackoverflow.com/users/7597556/oyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1487694570, "creation_date": 1487670655, "last_edit_date": 1487694570, "question_id": 42363935, "link": "https://stackoverflow.com/questions/42363935/haskell-error-could-not-deduce-random-a0-arising-from", "title": "Haskell error: Could not deduce (Random a0) arising from", "body": "<p>I was playing around with the random function that gives an infinite list of random values as shown in Chapter 9 of \"Learn You a Haskell for Great Good\". The code goes like this:</p>\n\n<pre><code>randoms' :: (RandomGen g, Random a) =&gt; g -&gt; [a]\nrandoms' gen = let (value, newGen) = random gen\n               in value : randoms' newGen\n</code></pre>\n\n<p>In order to record the random generators, I changed <code>randoms'</code> a bit to the following:</p>\n\n<pre><code>randoms'' :: (RandomGen g, Random a) =&gt; g -&gt; [(a, g)]\nrandoms'' gen = let (value, newGen) = random gen\n                in (value, newGen) : randoms'' newGen\n</code></pre>\n\n<p>It works as expected.</p>\n\n<p>Then I rewrote it in the style of list comprehension:</p>\n\n<pre><code>randoms''' :: (RandomGen g, Random a) =&gt; g -&gt; [(a, g)]\nrandoms''' gen = random gen : [random gen' | (_, gen') &lt;- randoms''' gen]\n</code></pre>\n\n<p>This time, the complier gives the error: <strong>Could not deduce (Random a0) arising from a use of \u2018randoms'''\u2019...... The type variable \u2018a0\u2019 is ambiguous...</strong></p>\n\n<p>However, if I specify the type of <code>randoms'''</code> with concrete types, e.g.,</p>\n\n<pre><code>randoms''' :: StdGen -&gt; [(Int, StdGen)]\nrandoms''' gen = random gen : [random gen' | (_, gen') &lt;- randoms''' gen]\n</code></pre>\n\n<p>it works fine again and gives exactly the same result as <code>randoms''</code>.</p>\n\n<p>I wonder why the type inference works for <code>randoms''</code> but fails for <code>randoms'''</code>. Can anyone tell me why these two are not equivalent and how to fix the code of <code>randoms'''</code>?</p>\n\n<p>Furthermore, I experimented with the test code having the similar structure:</p>\n\n<pre><code>generate :: (Integral a, RealFrac b) =&gt; a -&gt; (b,a)\ngenerate m = let x = 1.2^^m in (x, ceiling x)\n\nfoo :: (Integral g, RealFrac a) =&gt; g -&gt; [(a,g)]\nfoo gen = let (value, newGen) = generate gen\n          in (value, newGen) : foo newGen\n\nfoo' :: (Integral g, RealFrac a) =&gt; g -&gt; [(a, g)]\nfoo' gen = generate gen : [generate gen' | (_, gen') &lt;- foo' gen]\n\nfoo'' :: (Integral g, RealFrac a) =&gt; g -&gt; [(a, g)]\nfoo'' gen = [generate gen' | gen' &lt;- gen : map snd (foo'' gen)]\n</code></pre>\n\n<p>It turns out <code>foo</code>, <code>foo'</code> and <code>foo''</code> all work fine. Apparently, it is not a problem of monomorphism vs polymorphism. It seems to be a problem specific to <code>random</code>.</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 512, "user_id": 4109576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh6.googleusercontent.com/-FADxSQ3G3x8/AAAAAAAAAAI/AAAAAAAAPJc/U1Zv7eUrObQ/photo.jpg?sz=128", "display_name": "Ata Sanchez", "link": "https://stackoverflow.com/users/4109576/ata-sanchez"}, "edited": false, "score": 0, "creation_date": 1488153456, "post_id": 42362323, "comment_id": 72092106, "body": "I functioned correctly. Thank you!"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1487666217, "creation_date": 1487666217, "answer_id": 42362323, "question_id": 42362183, "link": "https://stackoverflow.com/questions/42362183/returning-list-values-from-two-values-recursively-in-haskell/42362323#42362323", "title": "Returning list values from two values recursively in haskell", "body": "<p>You check whether <code>a == b</code> instead of pattern matching:</p>\n\n<pre><code>function a b = if a == b then [b]\n                         else a : function (succ a) b\n</code></pre>\n\n<p>Note that this can lead to problems if <code>a</code> is greater than <code>b</code> to begin with. Better check that too. And while we're at it, give you function a better name:</p>\n\n<pre><code>range :: (Ord a, Enum a) =&gt; a -&gt; a -&gt; [a]\nrange a b \n  | a &gt; b     = []\n  | a == b    = [b]\n  | otherwise = a : range (succ a) b\n</code></pre>\n"}], "owner": {"reputation": 512, "user_id": 4109576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh6.googleusercontent.com/-FADxSQ3G3x8/AAAAAAAAAAI/AAAAAAAAPJc/U1Zv7eUrObQ/photo.jpg?sz=128", "display_name": "Ata Sanchez", "link": "https://stackoverflow.com/users/4109576/ata-sanchez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "closed_date": 1487690188, "accepted_answer_id": 42362323, "answer_count": 1, "score": -2, "last_activity_date": 1487666217, "creation_date": 1487665724, "question_id": 42362183, "link": "https://stackoverflow.com/questions/42362183/returning-list-values-from-two-values-recursively-in-haskell", "closed_reason": "Needs details or clarity", "title": "Returning list values from two values recursively in haskell", "body": "<p>I am trying to create a list recursively by entering two values as a parameter, and that this returns the list.</p>\n\n<p>I know that by doing the following:</p>\n\n<pre><code>function1 a b = [a..b]\n</code></pre>\n\n<p>Works correctly, but is not recursive.\nMake it work recursively by entering a single parameter as follows:</p>\n\n<pre><code>function 0 = []\nfunction a = function4 (a-1) ++ [a]\n</code></pre>\n\n<p>But I really have no idea how to do that it is created recursively with two parameters.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1487665799, "creation_date": 1487665799, "answer_id": 42362203, "question_id": 42362016, "link": "https://stackoverflow.com/questions/42362016/haskell-write-a-function-to-perform-input-function-on-list/42362203#42362203", "title": "Haskell write a function to perform input function on list", "body": "<p>Hint:</p>\n\n<ol>\n<li>Produce <code>[f x1,...,f xn]</code> first, applying <code>f</code> to every member.</li>\n<li>Then, write a function that takes <code>[y1,...,yn]</code> and <code>w</code> and produces an interleaving <code>[y1,w,y2,w,...,yn]</code>. This can be done by recursion. (There's also a library function for that, but it's not important.)</li>\n<li>Compose both, to obtain <code>[f x1, \",\", ...]</code> and then concatenate the result.</li>\n<li>Add brackets to the resulting string.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "is_accepted": false, "score": 5, "last_activity_date": 1487665896, "last_edit_date": 1495542719, "creation_date": 1487665896, "answer_id": 42362227, "question_id": 42362016, "link": "https://stackoverflow.com/questions/42362016/haskell-write-a-function-to-perform-input-function-on-list/42362227#42362227", "title": "Haskell write a function to perform input function on list", "body": "<p>How about this:</p>\n\n<pre><code>import Data.List\n\nflist f list = \"[\" ++ (intercalate \",\" $ map f list) ++ \"]\"\n</code></pre>\n\n<p><code>intercalate</code> puts Strings in between of other Strings, it is (in this case) <a href=\"https://stackoverflow.com/questions/5521560/haskell-words-unwords-delimiter\">a slightly configurable version of <code>unwords</code></a>.</p>\n"}], "owner": {"reputation": 65, "user_id": 7596659, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5dDpI6DxfqA/AAAAAAAAAAI/AAAAAAAAABQ/ZIdS7JGyREs/photo.jpg?sz=128", "display_name": "penguindrum", "link": "https://stackoverflow.com/users/7596659/penguindrum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 42362203, "answer_count": 2, "score": 2, "last_activity_date": 1487665896, "creation_date": 1487665228, "question_id": 42362016, "link": "https://stackoverflow.com/questions/42362016/haskell-write-a-function-to-perform-input-function-on-list", "title": "Haskell write a function to perform input function on list", "body": "<p>So I'm trying to write a function which performs a input function <code>f</code> on input list <code>ls</code> <code>[l1, l2, ..., ln]</code> and output a string    <code>\"[\" ++ (f l1) ++ \",\" ++ (f l2) ++ \",\" ++ ... ++ (f ln) ++ \"]\"</code></p>\n\n<pre><code>flist :: (a -&gt; String) -&gt; [a] -&gt; String\nflist f ls = \n</code></pre>\n\n<p>for example:</p>\n\n<pre><code>&gt;flist show [1, 2, 3]\n</code></pre>\n\n<p>would output <code>\"[1, 2, 3]\"</code> </p>\n\n<pre><code>&gt;flist (fun x -&gt; x) [\"dog\"]\n</code></pre>\n\n<p>would output <code>\"[dog]\"</code></p>\n\n<p>I tried to use foldl'</p>\n\n<pre><code>flist f ls = \"[\" ++ (foldl' (++) f \",\" ls) ++ \"]\" \n</code></pre>\n\n<p>which doesn't seems to be working</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1487662257, "post_id": 42360270, "comment_id": 71872488, "body": "<code>Data.List.intercalate &quot;|&quot;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 3, "last_activity_date": 1487660553, "creation_date": 1487660553, "answer_id": 42360707, "question_id": 42360270, "link": "https://stackoverflow.com/questions/42360270/haskell-convert-list-of-strings-to-string-with-divider/42360707#42360707", "title": "Haskell convert list of strings to string with divider &quot;|&quot;", "body": "<p>Here's a way:</p>\n\n<pre><code>foldl' (\\acc x -&gt; if (null acc) then acc ++ x else acc ++ \"|\" ++ x) [] [\"a\", \"b\", \"c\"]\n</code></pre>\n\n<p>The first time accumulator is empty, so just append the first string from the list. Thereafter, append the separator before the variable. If you run <code>scanl</code>, you can see the string being built as follows:</p>\n\n<pre><code>[\"\",\"a\",\"a|b\",\"a|b|c\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1487660955, "creation_date": 1487660955, "answer_id": 42360812, "question_id": 42360270, "link": "https://stackoverflow.com/questions/42360270/haskell-convert-list-of-strings-to-string-with-divider/42360812#42360812", "title": "Haskell convert list of strings to string with divider &quot;|&quot;", "body": "<p>This is a cute combination of pattern matching and HOF.</p>\n\n<pre><code>ltos :: [String] -&gt; String\nltos []    = \"\"\nltos (m:n) = foldl' (\\a b -&gt; a ++ \"|\" ++ b) m n\n</code></pre>\n\n<p>You use the first element of the list as the starting string, then fold over the remaining elements (adding <code>|</code> between each of them). </p>\n\n<p>(I'm assuming that you mistyped the signature to <code>ltos</code>).</p>\n"}], "owner": {"reputation": 65, "user_id": 7596659, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5dDpI6DxfqA/AAAAAAAAAAI/AAAAAAAAABQ/ZIdS7JGyREs/photo.jpg?sz=128", "display_name": "penguindrum", "link": "https://stackoverflow.com/users/7596659/penguindrum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 989, "favorite_count": 0, "accepted_answer_id": 42360812, "answer_count": 2, "score": 2, "last_activity_date": 1487660955, "creation_date": 1487658912, "last_edit_date": 1487659900, "question_id": 42360270, "link": "https://stackoverflow.com/questions/42360270/haskell-convert-list-of-strings-to-string-with-divider", "title": "Haskell convert list of strings to string with divider &quot;|&quot;", "body": "<p>How can I convert a list to string with divider \"|\", using foldl'? </p>\n\n<pre><code>ltos :: String -&gt; [String] -&gt; String\nltos  []    = \"\"\nltos  (m:n) = foldl' f acc xs\n   where\n     f a b          = \n     acc            = \n     xs             = \n</code></pre>\n\n<p>for example, </p>\n\n<pre><code>ltos [\"a\", \"b\", \"c\"]\n</code></pre>\n\n<p>would output </p>\n\n<pre><code>\"a|b|c\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 2, "creation_date": 1487645810, "post_id": 42357394, "comment_id": 71866476, "body": "maybe are you talking about <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">Point Free Style</a> ?. your function can be written as <code>((print . show) .) . take . snd</code> in point free style. however, abusing it will sometimes decrease readability."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487650232, "post_id": 42357394, "comment_id": 71867571, "body": "&quot;I understand that most haskellers typically use the (&amp;) and (.) operators over parenthesis&quot; --Did you mean <code>($)</code> rather than <code>(&amp;)</code>? While there is a <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Function.html#v:-38-\" rel=\"nofollow noreferrer\"><code>(&amp;)</code> in <code>Data.Function</code></a>, and it could conceivably be used for what you are trying to do (it is just <code>flip ($)</code>), it is significantly rarer than <code>($)</code> in Haskell code out there."}, {"owner": {"reputation": 23, "user_id": 7595981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbe29e87c6b00a0ca7d944e426d456d?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/7595981/tyler"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1487652025, "post_id": 42357394, "comment_id": 71868102, "body": "@duplode Yes sorry, I meant the dollar sign ($) operator, not (&amp;)."}], "answers": [{"tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": false, "score": 3, "last_activity_date": 1487646819, "creation_date": 1487646819, "answer_id": 42357964, "question_id": 42357394, "link": "https://stackoverflow.com/questions/42357394/how-would-i-re-write-this-expression-using-the-function-composition-applica/42357964#42357964", "title": "How would I re-write this expression using the function composition (.) /application ($) operators?", "body": "<p>Your final simplification is good and quite readable in the <code>f . g . h $ x</code> style. The main point of that style isn't so much to eliminate parentheses (though it can clean them up and sometimes eliminate them) but as an idiom to make it clear at a glance that a sequence of functions is being applied to something and what those functions are.</p>\n\n<p>With expressions in high school algebra, sometimes you can't eliminate parentheses when you simplify because you're stuck with a fixed set of operators and with a fixed order of operations. That's why parentheses have to be included in high school algebra. If you're stuck with just <code>(.)</code> and <code>($)</code>, I think that's the best you can get.</p>\n\n<h2>Eliminating parentheses by adding a new operator</h2>\n\n<p>This isn't recommended because your simplified version was just fine and people will have to take time to figure out what the new operator means for little benefit, but I'm adding it just for the sake of completeness.</p>\n\n<p>We're in Haskell instead of high school algebra, so we can add a new operator with whatever precedence. It needs to work like <code>($)</code> but have a precedence equal to <code>(.)</code> (since it can't be greater than <code>(.)</code>, which has the highest precedence).</p>\n\n<p>So, to eliminate all parentheses (except for the tuple) in <code>ghci</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; let infixr 9 $$$; a $$$ b = a b\nPrelude&gt; print . show . take $$$ snd (1, 5) $ [1..10]\n\"[1,2,3,4,5]\"\n</code></pre>\n\n<p>To eliminate all parentheses:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; let infixr 9 $$$; a $$$ b = a b\nPrelude&gt; let tuple :: a -&gt; b -&gt; (a, b); tuple = (,)\nPrelude&gt; print . show . take $$$ snd $$$ tuple 1 5 $ [1..10]\n\"[1,2,3,4,5]\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 7595981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbe29e87c6b00a0ca7d944e426d456d?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/7595981/tyler"}, "edited": false, "score": 1, "creation_date": 1487653074, "post_id": 42358488, "comment_id": 71868416, "body": "Wow thank you for the comprehensive response! Answers my question perfectly :)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1487650023, "creation_date": 1487650023, "answer_id": 42358488, "question_id": 42357394, "link": "https://stackoverflow.com/questions/42357394/how-would-i-re-write-this-expression-using-the-function-composition-applica/42358488#42358488", "title": "How would I re-write this expression using the function composition (.) /application ($) operators?", "body": "<p>Your rewrite...</p>\n\n<pre><code>print . show . take (snd (1,5)) $ [1..10]\n</code></pre>\n\n<p>... is as good as it gets in terms of readability. The following suggestions will in fact make it more convoluted than necessary; still, knowing such things are possible can, as you say, bring a better appreciation of how <code>($)</code> and <code>(.)</code> work. </p>\n\n<p>The first function which is applied to <code>[1..10]</code> is...</p>\n\n<pre><code>take (snd (1,5))\n</code></pre>\n\n<p>... so let's focus on it for a moment. If you were trying to eliminate parentheses there without the rest of the expression, you might end up with...</p>\n\n<pre><code>take . snd $ (1,5)\n</code></pre>\n\n<p>To reconstruct the original function, we need to apply that to <code>[1..10]</code>. A natural way of doing so would be...</p>\n\n<pre><code>(take . snd $ (1,5)) [1..10]\n</code></pre>\n\n<p>... but since we are avoiding parentheses, we need extra trickery. There are two immediate options. The first one is passing the list to the function with a <code>($)</code> section:</p>\n\n<pre><code>($ [1..10]) . take . snd $ (1,5)\n</code></pre>\n\n<p>Just like <code>(* 2)</code> is a function that takes a number and multiplies it by two, <code>($ [1..10])</code> is a function...</p>\n\n<pre><code>GHCi&gt; :t ($ [1..10])\n($ [1..10]) :: (Num t, Enum t) =&gt; ([t] -&gt; b) -&gt; b\n</code></pre>\n\n<p>... that takes a function and applies it to <code>[1..10]</code>. (And yes, I have just added a pair of parentheses; however, they are not really being used for grouping -- <code>($ [1..10])</code> is just alternative syntax for <code>flip ($) [1..10]</code> -- so I say they don't count :))</p>\n\n<p>At this point, we can complete the expression in the same manner of your original version:</p>\n\n<pre><code>print . show . ($ [1..10]) . take . snd $ (1,5)\n</code></pre>\n\n<p>The other option is writing the whole function pointfree (that is, without explictly writing the arguments). To do that, let's get back to...</p>\n\n<pre><code>take . snd $ (1,5)\n</code></pre>\n\n<p>... and leave out the pair for a moment:</p>\n\n<pre><code>take . snd\n</code></pre>\n\n<p><code>take . snd</code> is a function...</p>\n\n<pre><code>GHCi&gt; :t take . snd\ntake . snd :: (a1, Int) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>... that takes a pair and a list and gives back a list. We can, however, also read this type as:</p>\n\n<pre><code>take . snd :: (a1, Int) -&gt; ([a] -&gt; [a])\n</code></pre>\n\n<p>... that is, we have a function that takes a pair and returns a function. If we compose some function <code>foo</code> with <code>take . snd</code> so that we get <code>foo . take . snd</code>, <code>foo</code> will be applied to the function produced by <code>take . snd</code>. In fact, we have done just that when we used <code>($ [1..10])</code> just above. Besides supplying argments, another thing we can do with functions is composing them. And we do have an operator for composing functions...</p>\n\n<pre><code>((print . show) .) . take . snd\n</code></pre>\n\n<p>... namely, <code>(.)</code>. The weird expression within the parentheses is a section of <code>(.)</code>, just like the one we used for <code>($)</code> before, except that this is a left section, and that was a right section. Due to operator precedence shenanigans an extra pair of parentheses is necessary; equally unsatisfactory alternatives include...</p>\n\n<pre><code>(print .) . (show .) . take . snd\n</code></pre>\n\n<p>... and...</p>\n\n<pre><code>(.) print . (.) show . take . snd\n</code></pre>\n\n<p>With the pointfree function in our hands, we can supply the arguments in whichever way we feel like -- for instance, like this...</p>\n\n<pre><code>(((print . show) .) . take . snd) (1,5) [1..10]\n</code></pre>\n\n<p>... or this...</p>\n\n<pre><code>($ [1..10]) . ((print . show) .) . take . snd $ (1,5)\n</code></pre>\n\n<p>... or even this...</p>\n\n<pre><code>($ [1..10]) . ($ (1,5)) $ ((print . show) .) . take . snd\n</code></pre>\n\n<p>... or, for something less bizarre:</p>\n\n<pre><code>let f = ((print . show) .) . take . snd in f (1,5) [1..10]\n</code></pre>\n\n<p>There are indeed many alternatives -- and they all conspire to show how nice your original rewrite was in the first place!</p>\n"}], "owner": {"reputation": 23, "user_id": 7595981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbe29e87c6b00a0ca7d944e426d456d?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/7595981/tyler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 42358488, "answer_count": 2, "score": 1, "last_activity_date": 1487652601, "creation_date": 1487642506, "last_edit_date": 1487652601, "question_id": 42357394, "link": "https://stackoverflow.com/questions/42357394/how-would-i-re-write-this-expression-using-the-function-composition-applica", "title": "How would I re-write this expression using the function composition (.) /application ($) operators?", "body": "<p>I've been trying very hard to grasp the <code>(.)</code> and <code>($)</code> operators in Haskell. I believe I understand the differences between them well enough, but I am still having a hard time successfully replacing the parentheses in my expressions with these operators. </p>\n\n<p>For example, if I have the expression</p>\n\n<pre><code>print(show(take 5 [1..10]))\n</code></pre>\n\n<p>I understand how to rewrite it using the <code>(.)</code> and <code>($)</code> operators</p>\n\n<pre><code>print . show . take 5 $ [1..10]\n</code></pre>\n\n<p>However, if I had something like</p>\n\n<pre><code>print (show (take (snd (1,5)) [1..10]))\n</code></pre>\n\n<p>The furthest I can simplify this down to is</p>\n\n<pre><code>print . show . take (snd (1,5)) $ [1..10]\n</code></pre>\n\n<p>No matter what I try I can not seem to replace those inner parenthesis with the <code>($)</code> or <code>(.)</code> operator and have it successfully compile. I understand that most Haskellers typically use the <code>($)</code> and <code>(.)</code> operators over parentheses so I am trying really hard to follow that style as well. If someone could point out how I could rewrite that expression above without using parenthesis I think it would help me use those operators with much more success. Thanks.</p>\n"}, {"tags": ["haskell", "types", "compiler-errors", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 5790000, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5e505c482dd1b6e04e3e39c26ebc3f4c?s=128&d=identicon&r=PG&f=1", "display_name": "BlaCkOmN", "link": "https://stackoverflow.com/users/5790000/blackomn"}, "edited": false, "score": 0, "creation_date": 1487641893, "post_id": 42357209, "comment_id": 71865376, "body": "Thanks to you, I understand now, I admit that I didn&#39;t know the difference between data and type. So I didn&#39;t think about it."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1487641229, "creation_date": 1487641229, "answer_id": 42357209, "question_id": 42356413, "link": "https://stackoverflow.com/questions/42356413/error-expected-type-with-actual-type-in-haskell/42357209#42357209", "title": "Error expected type with actual type in Haskell", "body": "<p>It looks like you are expecting <code>TreeRN x</code> to be a synonym for <code>Tree (Color, x)</code>.  I think you have just used the wrong keyword -- <code>data</code> defines a new algebraic data type. Try</p>\n\n<pre><code>type TreeRN x = Tree (Color, x)\n</code></pre>\n\n<p>You will also need to remove the <code>deriving</code> clause which is not valid for type synonyms.</p>\n"}], "owner": {"reputation": 81, "user_id": 5790000, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5e505c482dd1b6e04e3e39c26ebc3f4c?s=128&d=identicon&r=PG&f=1", "display_name": "BlaCkOmN", "link": "https://stackoverflow.com/users/5790000/blackomn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 42357209, "answer_count": 1, "score": 1, "last_activity_date": 1487641229, "creation_date": 1487635742, "question_id": 42356413, "link": "https://stackoverflow.com/questions/42356413/error-expected-type-with-actual-type-in-haskell", "title": "Error expected type with actual type in Haskell", "body": "<p>I declared these types in Haskell : </p>\n\n<pre><code>data Tree x = Node x (Tree x) (Tree x)\n          |Leef\n          deriving Show\n\ndata Color = R | N\n    deriving (Show, Eq)\n\ndata TreeRN x = Tree (Color,x)\n    deriving Show\n</code></pre>\n\n<p>and this function : </p>\n\n<pre><code>equilibre :: TreeRN a -&gt; TreeRN a\nequilibre (Node (N,z) (Node (R,y) (Node (R,x) a b) c) d) = (Node (R,y) (Node (N,x) a b) (Node (N,z) c d))\nequilibre (Node (N,z) (Node (R,x) a (Node (R,y) b c)) d) = (Node (R,y) (Node (N,x) a b) (Node (N,z) c d))\nequilibre (Node (N,x) a (Node (R,z) (Node (R,y) b c) d)) = (Node (R,y) (Node (N,x) a b) (Node (N,z) c d))\nequilibre (Node (N,x) a (Node (R,y) b (Node (R,z) c d))) = (Node (R,y) (Node (N,x) a b) (Node (N,z) c d))\n</code></pre>\n\n<p>And here is my issue : </p>\n\n<pre><code>Couldn't match expected type \u2018TreeRN a\u2019\n            with actual type \u2018Tree (Color, t3)\u2019\nRelevant bindings include\n  d :: Tree (Color, t3) (bound at test.hs:15:53)\n  c :: Tree (Color, t3) (bound at test.hs:15:51)\n  z :: t3 (bound at test.hs:15:48)\n  b :: Tree (Color, t3) (bound at test.hs:15:37)\n  y :: t3 (bound at test.hs:15:34)\n  a :: Tree (Color, t3) (bound at test.hs:15:23)\n  equilibre :: TreeRN a -&gt; TreeRN a (bound at test.hs:12:1)\n  (Some bindings suppressed; use -fmax-relevant-binds=N or -fno-max-relevant-binds)\nIn the expression:\n  (Node (R, y) (Node (N, x) a b) (Node (N, z) c d))\nIn an equation for \u2018equilibre\u2019:\n    equilibre (Node (N, x) a (Node (R, y) b (Node (R, z) c d)))\n      = (Node (R, y) (Node (N, x) a b) (Node (N, z) c d))\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Usually when I get this kind of error I understand why and I can correct my function, but here I am disappoint by the </p>\n\n<pre><code>Couldn't match expected type \u2018TreeRN a\u2019\n            with actual type \u2018Tree (Color, t3)\u2019\n</code></pre>\n\n<p>while my declared type TreeRN is the same (for me), so I need answer for why the compiler say 't3', what does it mean ? It is really different to Tree (Color,a) ?</p>\n"}, {"tags": ["haskell", "typeclass", "halting-problem", "undecidable-instances"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1487718226, "post_id": 42356242, "comment_id": 71908547, "body": "You probably need to do something to force the compiler to decide whether <code>Int</code> is an instance of <code>C</code>."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 10, "last_activity_date": 1487635557, "creation_date": 1487635557, "answer_id": 42356385, "question_id": 42356242, "link": "https://stackoverflow.com/questions/42356242/how-can-undecidable-instances-actually-hang-the-compiler/42356385#42356385", "title": "How can undecidable instances actually hang the compiler?", "body": "<p>I don't think I've ever actually hung the compiler.  I can get it to stack overflow though by modifying your first example.   It seems that there is some caching going on, so we need to demand an infinite sequence of unique constraints, e.g.</p>\n\n<pre><code>data A x = A deriving (Show)\nclass C y where get :: y\ninstance (C (A (A a))) =&gt; C (A a) where\n    get = A\n\nmain = print (get :: A ())\n</code></pre>\n\n<p>which gives us</p>\n\n<pre><code>\u2022 Reduction stack overflow; size = 201\n  When simplifying the following type:\n    C (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A (A ())))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))\n  Use -freduction-depth=0 to disable this check\n  (any upper bound you could choose might fail unpredictably with\n   minor updates to GHC, so disabling the check is recommended if\n   you're sure that type checking should terminate)\n</code></pre>\n\n<p>which tells you how you could get it to hang if you really wanted to.  My guess is that if you can get it to hang without this you've found a bug.</p>\n\n<p>I'd love to hear from somebody who works on GHC.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 6, "last_activity_date": 1487636457, "creation_date": 1487636457, "answer_id": 42356525, "question_id": 42356242, "link": "https://stackoverflow.com/questions/42356242/how-can-undecidable-instances-actually-hang-the-compiler/42356525#42356525", "title": "How can undecidable instances actually hang the compiler?", "body": "<p>The simplest way to get a \"reduction stack overflow\" is using type families:</p>\n\n<pre><code>type family Loop where\n  Loop = Loop\n\nfoo :: Loop\nfoo = True\n</code></pre>\n\n<p>I don't know a direct way to get actually looping compilation on the current GHC. I recall getting loops a couple of times with GHC 7.11, but I only remember one in reproducible detail:</p>\n\n<pre><code>data T where\n    T :: forall (t :: T). T\n</code></pre>\n\n<p>But this has been fixed since.</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 2, "last_activity_date": 1509366448, "last_edit_date": 1509366448, "creation_date": 1509329998, "answer_id": 47007292, "question_id": 42356242, "link": "https://stackoverflow.com/questions/42356242/how-can-undecidable-instances-actually-hang-the-compiler/47007292#47007292", "title": "How can undecidable instances actually hang the compiler?", "body": "<p>To my surprise, <code>UndecidableInstances</code> can actually hang certain GHC versions. Here are the few lines of code that did it for me:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeFamilies          #-}\n{-# LANGUAGE UndecidableInstances  #-}\nmodule Nested where\n\nclass Nested r ix where\n\ntype family Lower ix :: *\n\ndata LN\n\ninstance Nested LN (Lower ix) =&gt; Nested LN ix where\n\ndata L\n\ninstance Nested LN ix =&gt; Nested L ix where\n</code></pre>\n\n<p>When compiled as part of a library (not directly <code>ghc main.hs</code>) this code hangs indefinitely on GHC 8.2.1</p>\n\n<p>As @luqui mentioned, this does seem like a bug, so it has been reported as such: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14402\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/14402</a></p>\n\n<p><strong>Edit</strong>: It turned out to be a bug indeed, which has already been fixed in current development version of GHC.</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 42356385, "answer_count": 3, "score": 6, "last_activity_date": 1509366448, "creation_date": 1487634653, "last_edit_date": 1492087139, "question_id": 42356242, "link": "https://stackoverflow.com/questions/42356242/how-can-undecidable-instances-actually-hang-the-compiler", "title": "How can undecidable instances actually hang the compiler?", "body": "<p>By the time I first read serious <a href=\"https://lukepalmer.wordpress.com/2008/04/08/stop-using-undecidable-instances/\" rel=\"nofollow noreferrer\">criticism on <code>-XUndecidableInstances</code></a>, I had already completely accustomed to it, seeing it as merely <em>removal of an annoying restriction Haskell98 has to make compilers easier to implement</em>.</p>\n\n<p>In fact I've encountered plenty of applications where undecidable instances were needed, but none where they actually caused any problems related to undecidability. Luke's example is problematic for quite a different reason</p>\n\n<pre><code>class Group g where\n  (%) :: g -&gt; g -&gt; g\n  ...\ninstance Num g =&gt; Group g where\n  ...\n</code></pre>\n\n<p>\u2013 well, this would clearly be <em>overlapped</em> by any proper <code>Group</code> instance, so undecidability is the least of our worries: this is actually un<i>deterministic</i>!</p>\n\n<p>But fair enough, I since kept \u201cundecidable instances can possibly hang the compiler\u201d in the back of my head.</p>\n\n<p>Whence it was procured when I read <a href=\"https://codegolf.stackexchange.com/questions/110195/shortest-code-to-legitimately-slack-off\">this challenge on CodeGolf.SE</a>, asking for code that would infinitely hang the compiler. Well, sounds like a job for undecidable instances, right?</p>\n\n<p>Turns out I can't get them to do it. The following compiles in no time, at least from GHC-7.10:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\nclass C y\ninstance C y =&gt; C y\nmain = return ()\n</code></pre>\n\n<p>I can even use class methods, and they'll only cause a loop at <em>runtime</em>:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\nclass C y where y::y\ninstance C y =&gt; C y where y=z\nz :: C y=&gt;y; z=y\nmain = print (y :: Int)\n</code></pre>\n\n<p>But runtime loops are nothing unusual, you can easily code these in Haskell98.</p>\n\n<p>I also tried different, less direct loops such as</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts, UndecidableInstances #-}\ndata A x=A\ndata B x=B\nclass C y\ninstance C (A x) =&gt; C (B x)\ninstance C (B x) =&gt; C (A x)\n</code></pre>\n\n<p>Again, no problem at compile time.</p>\n\n<p>So, what is actually needed to hang the compiler up in resolution of undecidable type class instances?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487631482, "post_id": 42355680, "comment_id": 71862111, "body": "Lambdas are anonymous. <code>x</code> is not the name of the function, but one of the arguments."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1487631614, "post_id": 42355721, "comment_id": 71862155, "body": "maybe it is a bit easier to see with explicit parenthization <code>\\x y -&gt; (a == x) || y</code>"}, {"owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "edited": false, "score": 1, "creation_date": 1487631891, "post_id": 42355721, "comment_id": 71862265, "body": "Okay, so is the <code>y</code> just the accumulated value of the fold and <code>x</code> the head of the structure being folded?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "edited": false, "score": 0, "creation_date": 1487634068, "post_id": 42355721, "comment_id": 71863049, "body": "@GarryCairns You got it."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "edited": false, "score": 2, "creation_date": 1487634162, "post_id": 42355721, "comment_id": 71863081, "body": "@GarryCairns You could look at it that way, but it&#39;s kind of a trap to think of <code>foldr</code> as using an accumulator, at least in Haskell.  The value <code>y</code> represents the result of the rest of the fold - but suspended.  It&#39;s never actually evaluated unless it&#39;s needed.  That&#39;s a huge part of why <code>foldr</code> is actually useful in Haskell."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1487631498, "creation_date": 1487631498, "answer_id": 42355721, "question_id": 42355680, "link": "https://stackoverflow.com/questions/42355680/what-is-the-lambda-in-this-foldr-doing/42355721#42355721", "title": "What is the lambda in this foldr doing?", "body": "<p><code>\\x y -&gt; a == x || y</code> is a function with two parameters, named <code>x</code> and <code>y</code>. It returns <code>True</code> whenever <code>a == x</code> is <code>True</code> or <code>y</code> is <code>True</code>.</p>\n"}], "owner": {"reputation": 2617, "user_id": 1281947, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e4ac0a8e75805f1bec48df742ee79ad1?s=128&d=identicon&r=PG", "display_name": "Garry Cairns", "link": "https://stackoverflow.com/users/1281947/garry-cairns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1633, "favorite_count": 0, "accepted_answer_id": 42355721, "answer_count": 1, "score": 1, "last_activity_date": 1487631498, "creation_date": 1487631305, "question_id": 42355680, "link": "https://stackoverflow.com/questions/42355680/what-is-the-lambda-in-this-foldr-doing", "title": "What is the lambda in this foldr doing?", "body": "<p>I'm working my way through the <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">Haskell book</a> and I'm a bit stumped understanding folds. One exercise asks the reader to write an <code>elem</code> function with <code>foldr</code>. I couldn't get my head round it and googled an example, which I'm now trying to understand. The type signature for <code>foldr</code> is:</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>The example function I found is:</p>\n\n<pre><code>myElem' :: Eq a =&gt; a -&gt; [a] -&gt; Bool \nmyElem' a = foldr (\\x y -&gt; a == x || y) False\n</code></pre>\n\n<p>My understanding is that <code>(\\x y -&gt; a == x || y)</code> is fulfilling the <code>(a -&gt; b -&gt; b)</code> part of the type, <code>False</code> is fulfilling the <code>b</code> and <code>t a</code> is being implied in point free style.</p>\n\n<p>But the lambda itself seems like magic just now. I'm reading it as a function x with one parameter y will check if <code>x(y) == a</code>, with a being the element supplied as an argument to <code>myElem'</code>, and return True or the original argument to <code>x</code>. That's clearly nonsense. Where am I going wrong?</p>\n"}, {"tags": ["multithreading", "haskell", "memory", "ghc"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1487624097, "post_id": 42353661, "comment_id": 71858790, "body": "What exactly are you trying to limit? Limiting arbitrary memory for arbitrary Haskell code probably wouln&#39;t be possible, but you could limit access to some specific resource by hiding it behind a type class."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 7, "creation_date": 1487624257, "post_id": 42353661, "comment_id": 71858865, "body": "Operating system processes can have limited memory. One possible solution is to fork a new process and <a href=\"https://hackage.haskell.org/package/unix-2.7.2.1/docs/System-Posix-Resource.html\" rel=\"nofollow noreferrer\"><code>setResourceLimit</code></a> on the new process, and communicate with it with something like <a href=\"https://hackage.haskell.org/package/remote-0.1.1/docs/Remote.html\" rel=\"nofollow noreferrer\">Remote</a>. You&#39;d need to restrict code run in the new process to something less powerful than <code>IO ()</code>."}, {"owner": {"reputation": 2115, "user_id": 1934349, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/LyNoA.jpg?s=128&g=1", "display_name": "paulotorrens", "link": "https://stackoverflow.com/users/1934349/paulotorrens"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1487624697, "post_id": 42353661, "comment_id": 71859103, "body": "Yeah, I&#39;m trying to limit overall memory usage for that compilation process. Those can be really expensive, I&#39;d be vulnerable to DoS if I don&#39;t somehow limit heap usage."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1487626327, "post_id": 42353661, "comment_id": 71859867, "body": "It sounds more appropriate to be doing this at a higher level. Linux has lots of facilities for controlling resource usage in all sorts of ways, with lots of pre-existing tooling. Maybe spin up a docker container with <code>--ulimit</code> set for each user or something"}, {"owner": {"reputation": 2115, "user_id": 1934349, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/LyNoA.jpg?s=128&g=1", "display_name": "paulotorrens", "link": "https://stackoverflow.com/users/1934349/paulotorrens"}, "edited": false, "score": 0, "creation_date": 1487626877, "post_id": 42353661, "comment_id": 71860099, "body": "I do understand that this would be a feasible solution, but processes and OS threads are heavyweight. In this scenario, it would be best to keep using C with my own green threads and assembly context switch."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1487648791, "post_id": 42353661, "comment_id": 71867217, "body": "I think Erlang has per-thread heaps (to send data to another thread, you have to copy it), so I assume you can limit their size. I don&#39;t see how &quot;the memory usage of a thread&quot; makes sense in a language with automatic memory management and a shared heap."}, {"owner": {"reputation": 2115, "user_id": 1934349, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/LyNoA.jpg?s=128&g=1", "display_name": "paulotorrens", "link": "https://stackoverflow.com/users/1934349/paulotorrens"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487778051, "post_id": 42353661, "comment_id": 71939004, "body": "@ReidBarton, Erlang? That&#39;s really nice! Too bad it&#39;s an un(i)typed language..."}], "answers": [{"comments": [{"owner": {"reputation": 2115, "user_id": 1934349, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/LyNoA.jpg?s=128&g=1", "display_name": "paulotorrens", "link": "https://stackoverflow.com/users/1934349/paulotorrens"}, "edited": false, "score": 0, "creation_date": 1487777977, "post_id": 42354671, "comment_id": 71938953, "body": "Close enough. Thanks."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 13, "last_activity_date": 1487627530, "last_edit_date": 1487627530, "creation_date": 1487626620, "answer_id": 42354671, "question_id": 42353661, "link": "https://stackoverflow.com/questions/42353661/may-i-limit-memory-usage-per-function-monad-thread-in-haskell/42354671#42354671", "title": "May I limit memory usage per function/monad/thread in Haskell?", "body": "<p>In the latest versions of GHC, it is possible to set per-thread allocation counters and limits, using <code>setAllocationCounter</code> and <code>enableAllocationLimit</code> from <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-Conc.html#g:3\" rel=\"noreferrer\"><code>GHC.Conc</code></a>. When a limit is set and the counter reaches 0, the thread receives an asynchronous exception.</p>\n\n<p>The counters measure <em>allocation</em>, and not the size of the live set. For example, this code hits the limit, despite its live set never becoming very big:</p>\n\n<pre><code>{-# LANGUAGE NumDecimals #-}\nmodule Main where\n\nimport Data.Foldable (for_)\nimport System.IO\nimport GHC.Conc (setAllocationCounter,enableAllocationLimit)\n\nmain :: IO ()\nmain = \n  do setAllocationCounter 2e9\n     enableAllocationLimit\n     let writeToHandle h =\n            for_ ([1..]::[Integer])\n                 (hPutStrLn h . show)\n     withFile \"/dev/null\" WriteMode writeToHandle\n     return ()\n</code></pre>\n\n<p>Allocation is a bit crude as a measure, but it can still be useful to detect some \"out of control\" computations.</p>\n\n<p><a href=\"https://simonmar.github.io/posts/2017-01-24-asynchronous-exceptions.html\" rel=\"noreferrer\">This blog post</a> by Simon Marlow goes into more detail.</p>\n"}], "owner": {"reputation": 2115, "user_id": 1934349, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/LyNoA.jpg?s=128&g=1", "display_name": "paulotorrens", "link": "https://stackoverflow.com/users/1934349/paulotorrens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 1, "accepted_answer_id": 42354671, "answer_count": 1, "score": 10, "last_activity_date": 1500653459, "creation_date": 1487622548, "question_id": 42353661, "link": "https://stackoverflow.com/questions/42353661/may-i-limit-memory-usage-per-function-monad-thread-in-haskell", "title": "May I limit memory usage per function/monad/thread in Haskell?", "body": "<p>I'm working on a research compiler project intended to work as a service. One of the requirements is that certain users might have a limited memory usage (e.g., \"calls from IP <em>a.b.c.d</em> may use up to 30mb of heap memory\") while handling its calls.</p>\n\n<p>My prototype implementation, written in C, simply uses a memory pool indead of <code>malloc</code>'ing directly (which is actually pretty hard to get right due to effective types). Manual memory management, though.</p>\n\n<p>Is there any way to achieve this in Haskell, by limiting heap usage on a function, monad, or lightweight thread? (I'd accept suggestions of other functional languages which might allow me to do this.)</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "heap-memory"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1487613922, "post_id": 42350884, "comment_id": 71853798, "body": "The default heap profile frequency is every 0.1 s, so maybe your empty profiles are just because the program didn&#39;t run for long enough. You can adjust the heap profile frequency with the <code>-i&lt;sec&gt;</code> RTS option."}, {"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487615738, "post_id": 42350884, "comment_id": 71854720, "body": "@ReidBarton Thank you, that&#39;s it!"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487618103, "post_id": 42350884, "comment_id": 71855886, "body": "@ReidBarton That should be an answer."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 3, "last_activity_date": 1487619056, "creation_date": 1487619056, "answer_id": 42352815, "question_id": 42350884, "link": "https://stackoverflow.com/questions/42350884/empty-memory-profile/42352815#42352815", "title": "Empty memory profile", "body": "<p>The default heap profile frequency is every 0.1 s, so if your program doesn't run for long enough then you'll get an empty heap profile. You can adjust the heap profile frequency with the <code>-i&lt;sec&gt;</code> RTS option.</p>\n"}], "owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 42352815, "answer_count": 1, "score": 2, "last_activity_date": 1487619056, "creation_date": 1487611810, "question_id": 42350884, "link": "https://stackoverflow.com/questions/42350884/empty-memory-profile", "title": "Empty memory profile", "body": "<p>I wanted to test the memory usage of a small test program. The program looks as follows:</p>\n\n<pre><code>import Data.List as L\nmain :: IO\nmain = print $ L.find (==100000) [1..1000000000]\n</code></pre>\n\n<p>It finds the 100000th value. I expected to see that this program would only use the memory for 100000 values. When I generated a memory profile via <code>+RTS -hy</code> I got an empty profile:\n<a href=\"https://i.stack.imgur.com/f18ZM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/f18ZM.png\" alt=\"enter image description here\"></a>\nI was surprised and thought that <code>GHC</code> may be more efficient than I thought. Maybe the values never had to be loaded into memory since the result can already be determined. </p>\n\n<p>So I experimented with a problem that requires all the values up until the 100000th:</p>\n\n<pre><code>main = print $ takeUntil (==100000) [1..]\n\ntakeUntil :: (Int -&gt; Bool) -&gt; [Int] -&gt; [Int]\ntakeUntil _ [] = []\ntakeUntil f (x:xs) = if f x\n                      then []\n                      else x : takeUntil f xs\n</code></pre>\n\n<p>Still, the memory profile is empty. I thought this was because GHC is performing some kind of fusion on this program in which values are calculated by <code>takeUntil</code> and printed at the same time so they can be instantly garbage collected.</p>\n\n<p>So I wrote another program that requires the result from <code>takeUntil</code> to stay in memory:</p>\n\n<pre><code>main = let taken = takeUntil (==100000) [1..]\n           mapped = L.map (+1) taken\n       in print taken &gt;&gt; print mapped\n</code></pre>\n\n<p>This gives the memory profile I was expecting:\n<a href=\"https://i.stack.imgur.com/vDwOD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vDwOD.png\" alt=\"enter image description here\"></a>\nI wanted to see what memory the program would use if I requested only half of the samples:</p>\n\n<pre><code>main = let taken = takeUntil (==50000) [1..]\n           mapped = L.map (+1) taken\n       in print taken &gt;&gt; print mapped\n</code></pre>\n\n<p>I generated the memory profile and yet again it's empty!</p>\n\n<p>When I request more samples:</p>\n\n<pre><code>main = let taken = takeUntil (==200000) [1..]\n           mapped = L.map (+1) taken\n       in print taken &gt;&gt; print mapped\n</code></pre>\n\n<p>The memory profile is as I would expect:\n<a href=\"https://i.stack.imgur.com/RwjW1.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RwjW1.png\" alt=\"enter image description here\"></a></p>\n\n<p>Can someone explain this behavior?</p>\n\n<p>The code is in a file called <code>Main.hs</code>. I compile via <code>ghc Main.hs -O2 -rtsopts -prof</code>. I build the memory profile by running with <code>+RTS -hy</code> and generate a pdf using <code>hp2ps -e8in -c</code> and <code>ps2pdf</code>.</p>\n"}, {"tags": ["haskell", "constraints", "typeclass", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487607424, "post_id": 42348279, "comment_id": 71849926, "body": "We would need <code>forall (p::Bool). Either (p:~:True) (p:~:False)</code> for that. I don&#39;t think one can achieve that without a singleton argument for <code>p::Bool</code>."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487608497, "post_id": 42348279, "comment_id": 71850512, "body": "Could you elaborate on that? 1) What other types inhabit the <code>Bool</code> kind, 2) If  <code>Either (p:~:True) (p:~:False)</code> were a terminal of the Bool kind, would that actually help us at the technical level of helping GHC to automatically infer what I asked about?"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487608594, "post_id": 42348279, "comment_id": 71850567, "body": "By the way maybe take into account <a href=\"http://stackoverflow.com/questions/42240533/infer-constraints-for-both-if-and-else-of-type-equality\">this question I asked the other day</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487609236, "post_id": 42348279, "comment_id": 71850953, "body": "1) I&#39;m not an expert of this, but IIRC type families can cause e.g. <code>F Char :: Bool&#39; to be stuck and fail to reduce to </code>True` or <code>False</code>. (Yes, that&#39;s quite annoying) 2) Assuming that anyway, one can pattern match <code>case proof of Left Refl -&gt; ... ; Right Refl -&gt; ...</code> and cause <code>p</code> to be instantiated with true/false, so that <code>If</code> simplifies and the constraint is found to be satisfied."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487612522, "post_id": 42348279, "comment_id": 71852960, "body": "1) If there is a bottom type inhabiting all kinds I don&#39;t think it manifests in the <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7788#comment:16\" rel=\"nofollow noreferrer\">same way</a> as in values. 2) What you say only partially solves the problem. I will edit the question to demonstrate an example."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1487617556, "post_id": 42348279, "comment_id": 71855602, "body": "Cf. <a href=\"http://stackoverflow.com/questions/41492754/could-not-deduce-knownnat-in-two-existentials-with-respect-to-the-singletons-lib/41496362\">this question</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487657732, "post_id": 42348279, "comment_id": 71870245, "body": "@fakedrake Regarding chi&#39;s first question: <code>Any :: Bool</code> (read as <code>Any</code> has kind <code>Bool</code>). Yep, it&#39;s ugly."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487673665, "post_id": 42348279, "comment_id": 71879926, "body": "@alec thanks, you have even told me about it before I think. To give some <a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.0.0/docs/GHC-Prim.html#t:Any\" rel=\"nofollow noreferrer\">background</a> for the future generations (and me when I desperately try to solve the same problem in a month or so): &quot;<code>Any</code> [is] used to instantiate un-constrained type variables after type checking.&quot; eg <code>forall a. m a</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487691927, "post_id": 42348279, "comment_id": 71893197, "body": "@fakedrake While that is true, anyone can make their own version of Any using a closed type family with no cases. The whole type level totality situation is a bit confusing."}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1487616331, "post_id": 42351517, "comment_id": 71855017, "body": "Thnx! Is there a way to get rid of <code>Proxy b</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 1, "creation_date": 1487617744, "post_id": 42351517, "comment_id": 71855684, "body": "@fakedrake Yes, you can just drop that argument out (and enable <code>AllowAmbiguousTypes</code>). To use <code>bisect</code>, may then need to have <code>TypeApplication</code> enabled."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1487698376, "last_edit_date": 1487698376, "creation_date": 1487613985, "answer_id": 42351517, "question_id": 42348279, "link": "https://stackoverflow.com/questions/42348279/infer-constraints-of-type-families-from-constraints-of-arguments/42351517#42351517", "title": "Infer constraints of type families from constraints of arguments", "body": "<p>This question is not hard, but is ill-posed. What value do you expect to get back of type <code>c (If p a b) :: Constraint</code>? What you likely want to ask, is how to fill in the body of this</p>\n\n<pre><code>bisect :: forall b c x y. SingI b =&gt; Proxy b -&gt; (c x, c y) :- c (If b x y)\n</code></pre>\n\n<p>Here, as noted in the comments, I am forcing <code>c</code> to be a singleton so that I can get <code>Either (c :~: True) (c :~: False)</code> (you may read my <code>SingI</code> constraint as enforcing that <code>c :: Bool</code> must be either <code>True</code> or <code>False</code>, which is unfortunately not a trivial request when at the type level since <code>Any</code> has kind <code>Bool</code> too). The <code>:-</code> comes from the <a href=\"https://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\"><code>constraints</code></a> package. It is a way of saying that the constraint <code>(a,b)</code> implies the constraint <code>If c a b</code>. That is <em>exactly</em> how to express your request - you want a proof that two says <strong>given <code>c x</code> and <code>c y</code> hold, <code>c (If b x y)</code> will also hold</strong>.</p>\n\n<p>Filling in the body of that function is actually very little code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies, ConstraintKinds, TypeOperators, RankNTypes,\n    ScopedTypeVariables, PolyKinds #-}\n\nimport Data.Constraint\nimport Data.Singletons.Prelude hiding ((:-))\n\nbisect :: forall b c x y. (SingI b) =&gt; Proxy b -&gt; (c x, c y) :- c (If b x y)\nbisect _ = unmapDict $ case sing :: Sing b of\n                         STrue -&gt; mapDict weaken1\n                         SFalse -&gt; mapDict weaken2\n</code></pre>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 42351517, "answer_count": 1, "score": 3, "last_activity_date": 1487698376, "creation_date": 1487604181, "last_edit_date": 1487612977, "question_id": 42348279, "link": "https://stackoverflow.com/questions/42348279/infer-constraints-of-type-families-from-constraints-of-arguments", "title": "Infer constraints of type families from constraints of arguments", "body": "<p>I have a bunch of complicated type level functions that evaluate to things like:</p>\n\n<pre><code>(If (EqNat n 2)\n  1\n  (If (EqNat n 1)\n    2\n    (If (EqNat n 0) 3 0)))\n</code></pre>\n\n<p>Now obviously in this case this expression is a <code>KnownNat</code>. More\ngenerally we may say:</p>\n\n<pre><code>forall (c :: * -&gt; Constraint) (p :: Bool) a b .\n(c a, c b) =&gt; c (If p a b)\n</code></pre>\n\n<p>Is there a way to teach GHC to infer this?</p>\n\n<p>Edit: @chi noted that in some cases this is solvable with GADTs but my\nparticular case is this one:</p>\n\n<pre><code>module M1 (C(..)) where\n\ntype familiy NestedIfs (n :: Nat) :: Nat\ntype NestedIfs n = &lt;&lt;complex nested ifs like the above that evals to literals&gt;&gt;\n\nclass C a (n :: Nat) where\n  f :: KnownNat n =&gt; a -&gt; NestedIfs n -&gt; Bool\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>module M2 () where\nimport M1\n\ninstance C Int n where\n    f = ...require that KnownNat (NestedIfs n)...\n</code></pre>\n\n<p><code>NestedIfs</code> is not accessible to <code>M2</code> but maybe GHC should be able to\ninfer that <code>forall n . KnownNat n =&gt; KnownNat (NestedIfs n)</code> from the\ngeneral inference I mention above.</p>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1487599603, "post_id": 42346520, "comment_id": 71844593, "body": "And for MonadIO <code>instance MonadIO UI where    liftIO a = return $ unsafePerformIO a</code>"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1487600074, "post_id": 42346520, "comment_id": 71844899, "body": "how do you expect memoization to cope with statefulness of <code>IO</code> actions?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487619137, "post_id": 42346520, "comment_id": 71856403, "body": "There are no guarantees about what happens if one abuses of <code>unsafePerformIO</code>: that&#39;s why it is unsafe! That can only be used safely when you don&#39;t care when or if the IO is fired. Why don&#39;t you use the <code>IO</code> monad directly, instead? You can even wrap it, if you want as <code>newtype UI a = UI { unUI :: IO a }</code> and define your instances around that."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 5, "last_activity_date": 1487616083, "last_edit_date": 1487616083, "creation_date": 1487600847, "answer_id": 42347127, "question_id": 42346520, "link": "https://stackoverflow.com/questions/42346520/solve-a-memoization-in-haskell/42347127#42347127", "title": "Solve a memoization in Haskell", "body": "<p>By using <code>unsafePerformIO</code> to hide the presence of effects in <code>IO</code> actions you are deliberately (and most probably illegally) entering the realm of pure functions. In that realm it is allowed to memoize / refactor. The compiler will usually try to use the purity to full extent to avoid redundant work in runtime. Is there a real reason why you would hide the impurity, especially in something called <code>UI</code>, where one can expect interaction with outside world (human)? This could indicate bad design. Your <code>UI</code> seems to be the same as <code>Identity</code> which is the simplest functor without any impure effects.</p>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 42347127, "answer_count": 1, "score": 0, "last_activity_date": 1487616083, "creation_date": 1487599073, "question_id": 42346520, "link": "https://stackoverflow.com/questions/42346520/solve-a-memoization-in-haskell", "title": "Solve a memoization in Haskell", "body": "<p>I wrote data type and instance Monad class. Below is my source code:</p>\n\n<pre><code>data UI a = UI { unUI :: a } \n             deriving Functor\n\n\ninstance Applicative UI where\n    pure   = UI\n    m *&gt;  k = m &gt;&gt;= \\ _ -&gt; k\n    m &lt;*  k = m &gt;&gt;= \\ _ -&gt; m\n    m &lt;*&gt; k = UI $ (unUI m) (unUI k)\n\n\ninstance Monad UI where\n    m &gt;&gt;  k = m &gt;&gt;= \\ _ -&gt; k\n    m &gt;&gt;= k = k $ unUI m\n    return  = UI\n</code></pre>\n\n<p>But, when i use function like below:</p>\n\n<pre><code>generateUUID :: UI String\ngenerateUUID = do \n    ruuid &lt;- liftIO $ UV4.nextRandom\n    return $ UV.toString ruuid\n</code></pre>\n\n<p>I encounter problems with memoization!\nIs it poosible to do something?</p>\n"}, {"tags": ["unit-testing", "haskell", "testing"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 1, "creation_date": 1487599131, "post_id": 42346429, "comment_id": 71844252, "body": "I don&#39;t think you are really &quot;repeating yourself&quot; when your test is by definition to &quot;repeat itself&quot; in order to compare two mechanisms."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1487599351, "post_id": 42346429, "comment_id": 71844415, "body": "Ideally all the tests take a parameter which determines which function to use so I could just have a <code>doTest</code> function which is like <code>doTest test = test True == toList (test False)</code> or something like that, but I haven&#39;t found a way to do this without the typechecker hating me."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487602899, "post_id": 42346429, "comment_id": 71846798, "body": "@Clinton: I think that without instantiating a common <code>class</code> or possibly using template haskell (which I have no experience with) you cannot achieve that"}], "answers": [{"tags": [], "owner": {"reputation": 1790, "user_id": 3350784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OTuvN.png?s=128&g=1", "display_name": "Yuuri", "link": "https://stackoverflow.com/users/3350784/yuuri"}, "is_accepted": false, "score": 1, "last_activity_date": 1487605287, "creation_date": 1487605287, "answer_id": 42348686, "question_id": 42346429, "link": "https://stackoverflow.com/questions/42346429/writing-test-cases-in-haskell-for-differing-types/42348686#42348686", "title": "Writing test cases in Haskell for differing types", "body": "<p>The first problem that <code>P.take</code> and <code>ML.take</code>, etc., only look similar \u2013 in fact they are totally unrelated functions and the compiler doesn't know anything about their common behaviour. So, as @jd823592 proposed, we need to group them with a typeclass (I used a simple <code>newtype</code> wrapper so the example would be compilable):</p>\n\n<pre><code>import Prelude hiding (take, enumFrom)\nimport qualified Prelude as P (take, enumFrom)\n\nnewtype MySeq a = MySeq [a]\n\nclass Sequence s where\n    take :: Int -&gt; s a -&gt; s a\n    enumFrom :: Enum a =&gt; a -&gt; s a\n    toList :: s a -&gt; [a]\n\ninstance Sequence MySeq where\n    take n (MySeq xs) = MySeq (P.take n xs)\n    enumFrom n = MySeq (P.enumFrom n)\n    toList (MySeq xs) = xs\n\ninstance Sequence [] where\n    take = P.take\n    enumFrom = P.enumFrom\n    toList = id\n</code></pre>\n\n<p>Then we'll try to define some tests using now-unified functions from the class definition. They may just generate a <code>Sequence</code> of any type, and we'll then force them to produce explicit types.</p>\n\n<pre><code>test1 = doTest (take 5 $ enumFrom 1) -- the part in brackets is polymorphic\n\ndoTest :: (Eq a, Sequence s) =&gt; s a -&gt; Bool\ndoTest test = ???\n</code></pre>\n\n<p>Now the second problem is that we pass a polymorphic function as a parameter and then need to instantiate it with different type parameters (<code>[a]</code> and <code>MySeq a</code> in this case). In standard Haskell 2010 it is impossible, but we can exploit the <a href=\"https://en.wikibooks.org/wiki/Haskell/Polymorphism#Higher_rank_types\" rel=\"nofollow noreferrer\">Rank2 (or RankN) extension</a>:</p>\n\n<pre><code>{-# LANGUAGE Rank2Types #-}\n\n&lt;...&gt;\n\ndoTest :: forall a . Eq a =&gt; (forall s . Sequence s =&gt; s a) -&gt; Bool\ndoTest test = (test `asTypeOf` dummy1) == toList (test `asTypeOf` dummy2) where\n    dummy1 :: Eq a =&gt; [a]\n    dummy1 = undefined\n    dummy2 :: Eq a =&gt; MySeq a\n    dummy2 = undefined\n</code></pre>\n\n<p>This solution is a bit clumsy, but still works. Please feel free to improve.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1487605287, "creation_date": 1487598825, "question_id": 42346429, "link": "https://stackoverflow.com/questions/42346429/writing-test-cases-in-haskell-for-differing-types", "title": "Writing test cases in Haskell for differing types", "body": "<p>I've made a library that creates \"list like\" sequences, and of which many Prelude style functions are implemented. I want to write some test cases for this, to ensure my library is producing correct output, and I thought the easiest way to do this is write some functions, convert the results to lists and compare them to the Prelude results. Lets say we've got this:</p>\n\n<pre><code>import qualified MyLibrary as ML\nimport qualified Prelude as P\n</code></pre>\n\n<p>For example I may want the following testcase:</p>\n\n<pre><code>P.take 5 (P.enumFrom 1) == toList (ML.take 5 (ML.enumFrom 1))\n</code></pre>\n\n<p>Note that <code>ML.enumFrom</code> does not output a list, it outputs it's own datatype. </p>\n\n<p>The above works fine, but notice how I'm \"repeating myself\" <em>(TM)</em>. I have to ensure the left and right side are the same otherwise my test case is erroneous. </p>\n\n<p>Is there a nice way to write test cases like this so I don't have to repeat myself?</p>\n"}, {"tags": ["haskell", "erlang", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 9642, "user_id": 240949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87eeff19e19b7663dea01f55d52bd2e3?s=128&d=identicon&r=PG", "display_name": "RichardC", "link": "https://stackoverflow.com/users/240949/richardc"}, "edited": false, "score": 2, "creation_date": 1487592767, "post_id": 42342940, "comment_id": 71839750, "body": "To clarify: Erlang doesn&#39;t do unification either. If a variable occurs multiple times in a pattern, the Erlang compiler simply generates fresh names for the other occurrences and inserts a guard test that requires them to be equal, just like you&#39;d do manually in Haskell."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 9642, "user_id": 240949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87eeff19e19b7663dea01f55d52bd2e3?s=128&d=identicon&r=PG", "display_name": "RichardC", "link": "https://stackoverflow.com/users/240949/richardc"}, "edited": false, "score": 0, "creation_date": 1487592964, "post_id": 42342940, "comment_id": 71839884, "body": "@RichardC: I&#39;ve rewrote the answer to <i>unification</i> and <i>equality checks</i>. Do you think this addresses this problem better?"}, {"owner": {"reputation": 9642, "user_id": 240949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87eeff19e19b7663dea01f55d52bd2e3?s=128&d=identicon&r=PG", "display_name": "RichardC", "link": "https://stackoverflow.com/users/240949/richardc"}, "edited": false, "score": 0, "creation_date": 1487774661, "post_id": 42342940, "comment_id": 71936504, "body": "Yes, that looks better."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 11, "last_activity_date": 1487597761, "last_edit_date": 1487597761, "creation_date": 1487588874, "answer_id": 42342940, "question_id": 42342796, "link": "https://stackoverflow.com/questions/42342796/pattern-matching-in-haskell-and-erlang/42342940#42342940", "title": "Pattern-matching in Haskell and Erlang", "body": "<p>No, in Haskell you cannot use the same variable <code>x</code> in the head of a clause. Haskell does <strong>not</strong> do <em>unification</em> or <em>equality checks</em> like for instance respectively <em>Prolog</em> and <em>Erlang</em> do. This is specified in the <a href=\"https://www.haskell.org/onlinereport/decls.html#sect4.4.3.1\" rel=\"noreferrer\"><em>Haskell '98</em></a> report:</p>\n\n<blockquote>\n  <p>The set of patterns corresponding to each match must be linear---<strong>no variable is allowed to appear more than once</strong> in the entire set.</p>\n</blockquote>\n\n<p>(copied, boldface added)</p>\n\n<p>The only way to do it is using a guard (or any other type of checking in the body of course). You can however write it more elegant like:</p>\n\n<pre><code>myEq [] [] = True\nmyEq (x:xs) (y:ys) | x == y = myEq xs ys\n--                 | otherwise = False\nmyEq _ _ = False\n</code></pre>\n\n<p>the <code>otherwise</code> case can be omitted since Haskell will fallback on the last clause and thus return <code>False</code>.</p>\n\n<p>Or perhaps even more elegant:</p>\n\n<pre><code>myEq [] [] = True\nmyEq (x:xs) (y:ys) = x == y &amp;&amp; myEq xs ys\nmyEq _ _ = False\n</code></pre>\n\n<p>Personally I think that is better since here you state <em>explicitly</em> that <code>x</code> is equal to <code>y</code> so making mistakes like by accident writing the same variable cannot happen. Although of course it is a matter of taste.</p>\n"}, {"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 1, "last_activity_date": 1487589024, "creation_date": 1487589024, "answer_id": 42342986, "question_id": 42342796, "link": "https://stackoverflow.com/questions/42342796/pattern-matching-in-haskell-and-erlang/42342986#42342986", "title": "Pattern-matching in Haskell and Erlang", "body": "<p>No. Every variable can be bound at most once on the pattern matching side. If you wanted to bind a variable twice you would have to evaluate to perform unification.</p>\n"}], "owner": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1487636397, "creation_date": 1487588496, "last_edit_date": 1487636397, "question_id": 42342796, "link": "https://stackoverflow.com/questions/42342796/pattern-matching-in-haskell-and-erlang", "title": "Pattern-matching in Haskell and Erlang", "body": "<p>I have a small Erlang function that compares if two lists are equal:</p>\n\n<pre><code>myEq([], [])         -&gt; true;\nmyEq([X|Xs], [X|Ys]) -&gt; myEq(Xs, Ys);\nmyEq(_, _)           -&gt; false.\n</code></pre>\n\n<p>The comparison takes place on line 2, the <code>X</code> of <code>[X|Xs]</code> always binds to the first element of the first list, the <code>[X|Ys]</code> matches only if the first elements of both lists are equal.</p>\n\n<p>If I try this in Haskell I get an error message: \"<em>Conflicting definitions for <code>x</code></em>\".\nA possible solution in Haskell would be:</p>\n\n<pre><code>myEq (x:xs) (y:ys) = if x == y then myEq xs ys else False\n</code></pre>\n\n<p>But I would like to know if it is possible to do this in Haskell using pattern matching?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487597527, "post_id": 42342162, "comment_id": 71843048, "body": "What kind of noise are you talking about?"}, {"owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487604297, "post_id": 42342162, "comment_id": 71847732, "body": "The output from <code>ghc -c file.hs -ddump-simpl</code> gives core representation of the program pertty printed with explicit types, dictionary arguments occurance checks etc. but in a program context the core representation is just a value of some data type."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487615348, "post_id": 42342162, "comment_id": 71854539, "body": "The primary purpose of core is not to be pretty printed; it is an internal, low level language whose design is largely for the benefit of the compiler, not the human programmer. However, &quot;I want to treat GHC core as any other algebraic data type and write functions with it&quot; - this is already precisely the case. Core is literally just a Haskell ADT - what leads you to believe otherwise? Note that there is a <a href=\"https://www.stackage.org/haddock/lts-8.2/ghc-8.0.2/PprCore.html\" rel=\"nofollow noreferrer\">pretty printer for core</a> in the GHC api already."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1487628610, "post_id": 42342162, "comment_id": 71860866, "body": "How would a <code>Show</code> instance help you to &quot;treat GHC core as any other algebraic data type and write functions with it&quot;?"}, {"owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487659660, "post_id": 42342162, "comment_id": 71871203, "body": "@user2407038 I know GHC core is ADT but while writing transformations for the same it is easier if i get the show representation. Pretty printer doesnt really tell me the the structure of the value in terms of constructors, variables and literals."}, {"owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487659833, "post_id": 42342162, "comment_id": 71871296, "body": "@DanielWagner show instance will tell me the structure of the value which will help me validate the changes I am doing and will also tell me the cases i need to handle via pattern matching etc."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487662138, "post_id": 42342162, "comment_id": 71872431, "body": "@ankitrokdeonsns If you just want a rough show instance for the purpose of debugging, then you could e.g. use the <code>Data (Expr b)</code> instance to call <a href=\"https://hackage.haskell.org/package/syb-0.6/docs/Data-Generics-Text.html\" rel=\"nofollow noreferrer\"><code>gshow</code></a>. Alternatively, just write your own <code>Show</code> instance which shows core how <i>you</i> want; <code>gshow</code> will actually be much nosier than <code>pprCoreExpr</code>. Although, I don&#39;t see how a <code>Show</code> instance allows one to do the things you want (&quot;validate the changes I am doing&quot; and &quot;tell me the cases i need to handle via pattern matching&quot;)."}, {"owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487674368, "post_id": 42342162, "comment_id": 71880451, "body": "@user2407038 My original intention for this <code>Show</code> instance is for debugging purposes only. The output from <code>gshow</code> is ALMOST what I want. The only problem it has is  for <code>Var</code> data constructor it just gives <code>{abstract: Var}</code> in the result which is not very useful for my debugging. Great suggestion though."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487697263, "post_id": 42342162, "comment_id": 71896963, "body": "Use <code>:i</code> in ghci to learn more about the type."}], "answers": [{"tags": [], "owner": {"reputation": 755, "user_id": 2704964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79d2160e8cd355915182506411e69489?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Xue", "link": "https://stackoverflow.com/users/2704964/anton-xue"}, "is_accepted": false, "score": 1, "last_activity_date": 1498471327, "creation_date": 1498471327, "answer_id": 44757230, "question_id": 42342162, "link": "https://stackoverflow.com/questions/42342162/show-instance-for-ghc-core/44757230#44757230", "title": "`Show` instance for GHC core", "body": "<p>Having gone dumpster diving in GHC and pondered the same question, I can confidently say that a naive implementation of <code>Show</code> in GHC is <strong>NOT</strong> what you want. The reason for this is because internally GHC has recursion among many of its data types. For instance, between <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-8.0.1/src/TyCon.html#TyCon\" rel=\"nofollow noreferrer\">TyCon</a>, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-8.0.1/src/TyCon.html#AlgTyConRhs\" rel=\"nofollow noreferrer\">AlgTyConRhs</a>, and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-8.0.1/src/DataCon.html#DataCon\" rel=\"nofollow noreferrer\">DataCon</a> we have:</p>\n\n<p><code>TyCon</code> has <code>AlgTyCon</code>, which contains <code>AlgTyConRhs</code>.</p>\n\n<p><code>AlgTyConRhs</code> contains <code>data_cons :: [DataCon]</code> as one of its record fields.</p>\n\n<p><code>DataCon</code> contains <code>dcRepTyCon :: TyCon</code> as one of its fields.</p>\n\n<p>And thus we come full circle. Because of how <code>Show</code> works, recursion like this will create infinite output if you ever attempt to print it.</p>\n\n<p>In order to get a \"nice\" custom representation with data constructors and everything showing, you would have to write it yourself. This is actually somewhat challenging, since you have to consider and debug cases of recursion like this that default pretty printers have solved.</p>\n\n<p>It's tedious, many tabs were opened, but it's a good learning experience :)</p>\n"}], "owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1498471327, "creation_date": 1487586678, "question_id": 42342162, "link": "https://stackoverflow.com/questions/42342162/show-instance-for-ghc-core", "title": "`Show` instance for GHC core", "body": "<p>I am trying to work with GHC core data types.\nI am able to compile my Haskell source to core representation with type <code>Bind CoreBndr</code>.\nAs we know there is no default <code>Show</code> instance for this data type.\nThere is a way to pretty print this representation but it has way too much noise associated with it.\nI want to treat GHC core as any other algebraic data type and write functions with it.\nIt would be much easier if we had a <code>Show</code> instance of GHC core.\nHas anybody already written a show instance which I can reuse?</p>\n\n<p>Aside, how does the community write and verify programs that deal with GHC core?</p>\n"}, {"tags": ["haskell", "f#", "functional-programming"], "comments": [{"owner": {"reputation": 59630, "user_id": 636019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ba39c7ba510ac2951c010c26afb6a6?s=128&d=identicon&r=PG", "display_name": "ildjarn", "link": "https://stackoverflow.com/users/636019/ildjarn"}, "edited": false, "score": 5, "creation_date": 1487585336, "post_id": 42341535, "comment_id": 71835065, "body": "Make an immutable type whose constructor throws if the data is invalid."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 3, "creation_date": 1487586312, "post_id": 42341535, "comment_id": 71835709, "body": "In Haskell, you can write down the type <code>RegExp</code> of regular expressions: switch on <code>DataKinds</code>, and now you can write down the type of data valid for a given regexp <code>RegData :: RegExp -&gt; *</code>, and the <i>singleton</i> types for regexps <code>REGEXP :: RegExp -&gt; *</code>. You&#39;ll probably also need a validating parser, <code>regParse :: REGEXP r -&gt; String -&gt; Maybe (RegData r)</code>, so you can go from strings to validated data, given the singleton value for the regexp you want. If you can write a regexp recognizer, then <code>regParse</code> is an evidence-producing refinement of the same idea."}, {"owner": {"reputation": 19090, "user_id": 138772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/32504cb73cc05b26335a43219fff3a79?s=128&d=identicon&r=PG", "display_name": "JAB", "link": "https://stackoverflow.com/users/138772/jab"}, "edited": false, "score": 6, "creation_date": 1487608544, "post_id": 42341535, "comment_id": 71850541, "body": "&quot;a valid email address (checked against some Regex)&quot; Not a very good example considering it&#39;s really hard to create a regex that can properly match the full set of valid email addresses."}, {"owner": {"reputation": 15429, "user_id": 308668, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/1760ce981f53c8ccc1ef62493d3805cc?s=128&d=identicon&r=PG&f=1", "display_name": "mike3996", "link": "https://stackoverflow.com/users/308668/mike3996"}, "edited": false, "score": 6, "creation_date": 1487615243, "post_id": 42341535, "comment_id": 71854480, "body": "Please don&#39;t validate email addresses with regex."}, {"owner": {"reputation": 760, "user_id": 1282944, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XPcaN.jpg?s=128&g=1", "display_name": "Kurren", "link": "https://stackoverflow.com/users/1282944/kurren"}, "reply_to_user": {"reputation": 19090, "user_id": 138772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/32504cb73cc05b26335a43219fff3a79?s=128&d=identicon&r=PG", "display_name": "JAB", "link": "https://stackoverflow.com/users/138772/jab"}, "edited": false, "score": 0, "creation_date": 1487615465, "post_id": 42341535, "comment_id": 71854580, "body": "@JAB it was just for illustration. You could replace it with a FirstName string that cannot contain any numeric digits or any variable where only certain values are allowed."}, {"owner": {"reputation": 18784, "user_id": 2057033, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/868c67cd2d96685d2ec0a8bd472a2f69?s=128&d=identicon&r=PG", "display_name": "Blackhole", "link": "https://stackoverflow.com/users/2057033/blackhole"}, "edited": false, "score": 6, "creation_date": 1487620654, "post_id": 42341535, "comment_id": 71857101, "body": "@Kurren Don&#39;t suppose that <a href=\"https://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/\" rel=\"nofollow noreferrer\">people&#39;s names don&#39;t contain numbers</a>, either :-)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487628858, "post_id": 42341535, "comment_id": 71860981, "body": "And see also <a href=\"http://stackoverflow.com/questions/19730031/is-it-possible-to-define-a-function-on-a-subset-of-an-existing-type\">Is it possible to define a function on a subset of an existing type?</a>."}], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1487588229, "post_id": 42341743, "comment_id": 71836919, "body": "If possible, I would love to see the GADT way of handling it. :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1487588797, "post_id": 42341743, "comment_id": 71837277, "body": "@Sibi I&#39;m not really doing that! :-P It would probably involve something like a singleton <code>data C (c::Char) where A :: C &#39;a&#39; ; ...</code> and then <code>data S (s::String) where Nil :: S &quot;&quot; ; Cons :: C c -&gt; S s -&gt; S (c:s)</code>. Then you have <code>data Email where Email :: S s -&gt; Proof s Start -&gt; Email</code> where <code>Proof s Start</code> painfully encodes a DFA at the type level for checking that the string is really an email. For final states you have <code>Pi :: Proof &quot;&quot; End</code> and for transitions &quot;q1-c-&gt;q2&quot; middle <code>Pj :: C c -&gt; Proof s q2 -&gt; Proof (c:s) q1</code> etc. Painful and not convenient at all, IMO :-P"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1487590443, "post_id": 42341743, "comment_id": 71838287, "body": "Ah, okay! I will see if I can come up with that implementation tonight, just for fun. :-)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 22, "last_activity_date": 1487600285, "last_edit_date": 1487600285, "creation_date": 1487585577, "answer_id": 42341743, "question_id": 42341535, "link": "https://stackoverflow.com/questions/42341535/how-to-make-illegal-values-unrepresentable/42341743#42341743", "title": "How to make illegal values unrepresentable?", "body": "<p>A common idiom is to use a <em>smart constructor</em>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Email (email, fromEmail, Email()) where\n\n-- export the type, but not the constructor\nnewtype Email = Email String\n\n-- export this\nemail :: String -&gt; Maybe Email\nemail s | validEmail s = Just (Email s)\n        | otherwise    = Nothing\n\n-- and this\nfromEmail :: Email -&gt; String\nfromEmail (Email s) = s\n</code></pre>\n\n<p>This will verify emails at runtime, not compile time.</p>\n\n<p>For compile time verification, one would need to exploit a GADT-heavy variant of <code>String</code>, or use Template Haskell (metaprogramming) to do the checks (provided the email value is a literal).</p>\n\n<p>Dependent types can also ensure values are of the right form, for those languages that support them (e.g. Agda, Idris, Coq). F-star is a variant of F# that can verify preconditions/postconditions, and achieve some advanced static checks.</p>\n"}, {"comments": [{"owner": {"reputation": 12493, "user_id": 106906, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d246a4b19295137980d6c6f831eba665?s=128&d=identicon&r=PG", "display_name": "Dogweather", "link": "https://stackoverflow.com/users/106906/dogweather"}, "edited": false, "score": 0, "creation_date": 1490812102, "post_id": 42342588, "comment_id": 73284373, "body": "And that can all be done in one file for experimentation? Very cool."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 12493, "user_id": 106906, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d246a4b19295137980d6c6f831eba665?s=128&d=identicon&r=PG", "display_name": "Dogweather", "link": "https://stackoverflow.com/users/106906/dogweather"}, "edited": false, "score": 0, "creation_date": 1490815239, "post_id": 42342588, "comment_id": 73286344, "body": "Yes. I use the <code>exec ghci</code> option specifically from stack in the script: <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#loading-scripts-in-ghci\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/GUIDE/#loading-scripts-in-gh&zwnj;&#8203;ci</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 11, "last_activity_date": 1524112853, "last_edit_date": 1524112853, "creation_date": 1487587881, "answer_id": 42342588, "question_id": 42341535, "link": "https://stackoverflow.com/questions/42341535/how-to-make-illegal-values-unrepresentable/42342588#42342588", "title": "How to make illegal values unrepresentable?", "body": "\n\n<p>I usually do the way @chi has done. As he stated, you can also you Template Haskell to do checks on the provided email at compile time. An example of doing that:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-8.2\n     exec ghci\n     --package email-validate\n     --package bytestring\n-}\n\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE DeriveLift #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE QuasiQuotes #-}\n\nimport Language.Haskell.TH\nimport Language.Haskell.TH.Quote\nimport Language.Haskell.TH.Syntax\nimport Data.ByteString.Char8\nimport Text.Email.Validate\n\ninstance Lift ByteString where\n  lift b = [|pack $(lift $ unpack b)|]\n\ninstance Lift EmailAddress where\n  lift email = lift (toByteString email)\n\nemail :: QuasiQuoter\nemail =\n  QuasiQuoter\n  { quoteExp =\n    \\str -&gt;\n       let (item :: EmailAddress) =\n             case (validate (pack str)) of\n               Left msg -&gt; error msg\n               Right email -&gt; email\n       in [|item|]\n  }\n</code></pre>\n\n<p>Now, if you load this up in <code>ghci</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt; :set -XQuasiQuotes\n&gt; [email|sibi@mydomain.in|]\n\"sibi@mydomain.in\"\n&gt; [email|invalidemail|]\n\n&lt;interactive&gt;:6:1: error:\n    \u2022 Exception when trying to run compile-time code:\n        @: not enough input\nCallStack (from HasCallStack):\n  error, called at EmailV.hs:36:28 in main:EmailV\n      Code: quoteExp email \"invalidemail\"\n    \u2022 In the quasi-quotation: [email|invalidemail|]\n</code></pre>\n\n<p>You can see how you get compile error on the invalid input.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1487597964, "post_id": 42343489, "comment_id": 71843367, "body": "This is more of an ad than an answer; could you at least provide an example of how your library works here?"}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "edited": false, "score": 0, "creation_date": 1487663545, "post_id": 42343489, "comment_id": 71873220, "body": "The answer&#39;s updated."}, {"owner": {"reputation": 12493, "user_id": 106906, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d246a4b19295137980d6c6f831eba665?s=128&d=identicon&r=PG", "display_name": "Dogweather", "link": "https://stackoverflow.com/users/106906/dogweather"}, "edited": false, "score": 1, "creation_date": 1490812398, "post_id": 42343489, "comment_id": 73284526, "body": "Thank you! It&#39;s been hard to find practical examples of refined or dependent types; used to solve common &amp; mundane app development tasks. Your library is essentially a layer of abstraction and simplification of LH?"}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 12493, "user_id": 106906, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d246a4b19295137980d6c6f831eba665?s=128&d=identicon&r=PG", "display_name": "Dogweather", "link": "https://stackoverflow.com/users/106906/dogweather"}, "edited": false, "score": 0, "creation_date": 1490873608, "post_id": 42343489, "comment_id": 73312485, "body": "@Dogweather Yes, you can say so."}], "tags": [], "owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "is_accepted": false, "score": 5, "last_activity_date": 1487663512, "last_edit_date": 1487663512, "creation_date": 1487590516, "answer_id": 42343489, "question_id": 42341535, "link": "https://stackoverflow.com/questions/42341535/how-to-make-illegal-values-unrepresentable/42343489#42343489", "title": "How to make illegal values unrepresentable?", "body": "<p>As it appears, both answers of @chi and @Sibi are what Refinement Types are about. I.e., the types which enclose other types, while restricting the range of supported values with a validator. The validation can be done both at run-time and compile-time depending on the use-case.</p>\n\n<p>It just so happens that I've authored <a href=\"http://nikita-volkov.github.io/refined/\" rel=\"nofollow noreferrer\">\"refined\"</a>, a library, which provides abstractions for both cases. Follow the link for an extensive introduction.</p>\n\n<p>To apply this library in your scenario, in one module define the predicate:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Refined\nimport Data.ByteString (ByteString)\n\ndata IsEmail\n\ninstance Predicate IsEmail ByteString where\n  validate _ value = \n    if isEmail value\n      then Nothing\n      else Just \"ByteString form an invalid Email\"\n    where\n      isEmail =\n        error \"TODO: Define me\"\n\n-- | An alias for convenince, so that there's less to type.\ntype EmailBytes =\n  Refined IsEmail ByteString\n</code></pre>\n\n<p>Then use it in any other module (this is required due to Template Haskell).</p>\n\n<p>You can construct the values both at compile-time and run-time:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- * Constructing\n-------------------------\n\n{-|\nValidates your input at run-time.\n\nAbstracts over the Smart Constructor pattern.\n-}\ndynamicallyCheckedEmailLiteral :: Either String EmailBytes\ndynamicallyCheckedEmailLiteral =\n  refine \"email@example.info\"\n\n{-|\nValidates your input at compile-time with zero overhead.\n\nAbstracts over the solution involving Lift and QuasiQuotes.\n-}\nstaticallyCheckedEmailLiteral :: EmailBytes\nstaticallyCheckedEmailLiteral =\n  $$(refineTH \"email@example.info\")\n\n\n-- * Using\n-------------------------\n\naFunctionWhichImpliesThatTheInputRepresentsAValidEmail :: EmailBytes -&gt; IO ()\naFunctionWhichImpliesThatTheInputRepresentsAValidEmail emailBytes =\n  error \"TODO: Define me\"\n  where\n    {-\n    Shows how you can extract the \"refined\" value at zero cost.\n\n    It makes sense to do so in an enclosed setting.\n    E.g., here you can see `bytes` defined as a local value,\n    and we can be sure that the value is correct.\n    -}\n    bytes :: ByteString\n    bytes =\n      unrefine emailBytes\n</code></pre>\n\n<p>Also please beware that this is just a surface of what Refinement Types can cover. There's actually much more useful properties to them.</p>\n"}, {"comments": [{"owner": {"reputation": 59630, "user_id": 636019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ba39c7ba510ac2951c010c26afb6a6?s=128&d=identicon&r=PG", "display_name": "ildjarn", "link": "https://stackoverflow.com/users/636019/ildjarn"}, "edited": false, "score": 7, "creation_date": 1487596301, "post_id": 42344227, "comment_id": 71842138, "body": "In F#, <code>Maybe</code> and <code>Either</code> are <code>Option</code> and <code>Choice</code> (or <code>Result</code> in F# 4.1)."}], "tags": [], "owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "is_accepted": true, "score": 20, "last_activity_date": 1487598984, "last_edit_date": 1487598984, "creation_date": 1487592560, "answer_id": 42344227, "question_id": 42341535, "link": "https://stackoverflow.com/questions/42341535/how-to-make-illegal-values-unrepresentable/42344227#42344227", "title": "How to make illegal values unrepresentable?", "body": "<p>I'd posit, the same way you do all your <em>runtime</em> error handling?</p>\n\n<p>If you did it \"with classes and properties for encapsulation\", you'd throw an exception (ie in the setter) that some code, somewhere higher up in the call chain, would <em>have</em> to watch out for. It's not your \"classes and properties\" that magically solve this, it's your discipline to throw and catch exceptions. In most any FP language you have a wide arsenal of representations for signaling erroneous values/inputs, from simple <code>Maybe</code> or more detailed <code>Either</code> (or whatever these are called in F# ;), to full-blown exceptions, to forcing immediate-halt-with-stderr-message. As suits the current app/lib context.</p>\n\n<p>\"making illegal states unrepresentable\" in types is for pre-empting as many easy-to-make-in-the-heat-of-the-moment <em>developer mistakes</em> as the type system / compiler understands how-to: not <em>user error</em>.</p>\n\n<p>There's of course academic explorations and research into how we can shift handling ever-more classes of bugs to the static (compilation) side, in Haskell there's LiquidHaskell a prominent example. But until you have a time-machine, you can't retroactively prevent compilation of your program if the input it reads once compiled is erroneous  :D  in other words, the only way to prevent wrong email addresses is to impose a GUI that cannot possibly let one through.</p>\n"}, {"tags": [], "owner": {"reputation": 10532, "user_id": 492701, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/189471ba701cd80f6dfec2f8db53f7a8?s=128&d=identicon&r=PG", "display_name": "Scott Nimrod", "link": "https://stackoverflow.com/users/492701/scott-nimrod"}, "is_accepted": false, "score": 3, "last_activity_date": 1487612249, "last_edit_date": 1495539204, "creation_date": 1487603442, "answer_id": 42348033, "question_id": 42341535, "link": "https://stackoverflow.com/questions/42341535/how-to-make-illegal-values-unrepresentable/42348033#42348033", "title": "How to make illegal values unrepresentable?", "body": "<p>This was answered for me recently.</p>\n\n<p>Here's the <a href=\"https://stackoverflow.com/questions/42230388/how-can-i-enforce-the-creation-of-a-discriminated-union-value-through-a-dedicate\">post</a>.</p>\n\n<p>The context of your question is in regards to a valid email.\nThe overall structure of your code will leverage Active Patterns:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>module File1 =\n\n    type EmailAddress = \n        private\n        | Valid   of string \n        | Invalid of string\n\n    let createEmailAddress (address:System.String) =\n        if address.Length &gt; 0\n        then Valid    address \n        else Invalid  address\n\n    // Exposed patterns go here\n    let (|Valid|Invalid|) (input : EmailAddress) : Choice&lt;string, string&gt;  = \n        match input with\n        | Valid str -&gt; Valid str\n        | Invalid str -&gt; Invalid str\n\nmodule File2 =\n\n    open File1\n\n    let validEmail = Valid \"\" // Compiler error\n\n    let isValid = createEmailAddress \"\" // works\n\n    let result = // also works\n        match isValid with\n        | Valid x -&gt; true\n        | _       -&gt; false\n</code></pre>\n"}], "owner": {"reputation": 760, "user_id": 1282944, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XPcaN.jpg?s=128&g=1", "display_name": "Kurren", "link": "https://stackoverflow.com/users/1282944/kurren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2703, "favorite_count": 5, "closed_date": 1487628825, "accepted_answer_id": 42344227, "answer_count": 5, "score": 22, "last_activity_date": 1524112853, "creation_date": 1487584986, "last_edit_date": 1499088329, "question_id": 42341535, "link": "https://stackoverflow.com/questions/42341535/how-to-make-illegal-values-unrepresentable", "closed_reason": "Duplicate", "title": "How to make illegal values unrepresentable?", "body": "<p>A method of design in Functional Programming is <a href=\"http://fsharpforfunandprofit.com/posts/designing-with-types-making-illegal-states-unrepresentable/\" rel=\"nofollow noreferrer\">making illegal states unrepresentable</a>. I always see this being accomplished with the <em>structure</em> of types, but what about the <em>value</em> of types?</p>\n\n<p>What if I have a string called Email and I only want it to hold a valid email address (checked against some Regex)? How can I do this in a functional way (without using OOP)?</p>\n"}, {"tags": ["java", "haskell", "generics", "monads"], "comments": [{"owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "edited": false, "score": 0, "creation_date": 1487559909, "post_id": 42335417, "comment_id": 71824173, "body": "in Java the type would be the name of the class"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1487577335, "post_id": 42335417, "comment_id": 71830449, "body": "Well, it would be more akin to an <code>interface</code>, or at least an <i>abstract</i> class."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1487562036, "last_edit_date": 1487562036, "creation_date": 1487560029, "answer_id": 42335833, "question_id": 42335417, "link": "https://stackoverflow.com/questions/42335417/whats-the-different-between-type-constructor-in-haskell-and-java-generic-type/42335833#42335833", "title": "What&#39;s the different between type constructor in Haskell and java generic type?", "body": "<p>You don't sound confused to me. That looks like an unusually accurate translation into Java of Haskell's Monad class.</p>\n\n<p>In Haskell, a \"type\" is a concrete type with no un-specified parameters, like <code>Integer</code>, <code>M&lt;String&gt;</code>, or <code>M&lt;T&gt;</code> for any fixed <code>T</code>. Something with one or more remaining parameters, like just <code>M</code>, is a \"type constructor\", because it is like a constructor for types: it must be given one type argument (a value for <code>T</code>) in order to produce a concrete type.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6102088"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "accepted_answer_id": 42335833, "answer_count": 1, "score": 1, "last_activity_date": 1487562036, "creation_date": 1487556667, "last_edit_date": 1592644375, "question_id": 42335417, "link": "https://stackoverflow.com/questions/42335417/whats-the-different-between-type-constructor-in-haskell-and-java-generic-type", "title": "What&#39;s the different between type constructor in Haskell and java generic type?", "body": "<p>I am reading something about monad with no experience in Haskell and confused with the concept of type constructor.</p>\n<blockquote>\n<p>A monad is a triple (<code>M</code>, <code>unitM</code>, <code>bindM</code>) consisting of a type constructor <code>M</code> and a pair of polymorphic functions.</p>\n<pre><code>unitM :: a -&gt; M a\n\nbindM :: M a -&gt; (a -&gt; M b) -&gt; M b\n</code></pre>\n</blockquote>\n<p>In Java:</p>\n<pre><code>public class M&lt;T&gt; {\n    static &lt;T&gt; M&lt;T&gt; unit(T a)\n    static &lt;T,R&gt; M&lt;R&gt; bind(M&lt;T&gt; a, Function&lt;T,M&lt;R&gt;&gt; f)\n}\n</code></pre>\n<p>I considered they are the same, type constructor is just something like generic type in Java, am I right? If not, what's the difference?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1487539384, "post_id": 42332928, "comment_id": 71818469, "body": "<code>punc :: String -&gt; Int</code> implemented for example as <code>punc = length . filter (`elem` &quot;.,?!:;&quot;)</code>"}, {"owner": {"reputation": 649, "user_id": 1551965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3368bed08c1a9a93bb9612a374e7714c?s=128&d=identicon&r=PG", "display_name": "Stefan Dorunga", "link": "https://stackoverflow.com/users/1551965/stefan-dorunga"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487539814, "post_id": 42332928, "comment_id": 71818599, "body": "@jd823592 You should post your comment as an answer so that you can get accepted and upvoted and help others find the answer more easily."}], "answers": [{"tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 5, "last_activity_date": 1487554355, "last_edit_date": 1487554355, "creation_date": 1487539820, "answer_id": 42333120, "question_id": 42332928, "link": "https://stackoverflow.com/questions/42332928/how-can-i-check-if-character-belongs-to-a-group-of-symbols-in-haskell/42333120#42333120", "title": "How can I check if character belongs to a group of symbols in Haskell?", "body": "<p>You can extract the symbols you are interested in with <code>filter</code> and count the number of occurrences using <code>length</code>. Filter takes a list of values and returns a maximum sublist containing values that satisfy some property (e.g. being a punctuation mark).</p>\n\n<pre><code>punctuation :: String -&gt; Int\npunctuation s = length (filter (...) s)\n</code></pre>\n\n<p>what is the <code>...</code>? It needs to tell if a character is a punctuation or not, i.e. a predicate of type <code>Char -&gt; Bool</code>. How to tell if a character is in a given list?</p>\n\n<pre><code>isPunctuation :: Char -&gt; Bool\nisPunctuation c = c `elem` ['.', ',', '?', '!', ':', ';']\n</code></pre>\n\n<p>putting these together</p>\n\n<pre><code>punctuation :: String -&gt; Int\npunctuation = length . filter (`elem` \".,?!:;\")\n</code></pre>\n\n<p>notice that a list of characters <code>['.', ...]</code> is in fact a string and you can write it as <code>\".,?!:;\"</code> in short. Also notice the pointfree notation, instead of defining <code>punctuation</code> in terms of what it does to its only argument <code>s</code>, we say that the function <code>punctuation</code> is equal to a composition of functions <code>length</code> and <code>filter ...</code>. Also notice the <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\">section</a> notation for binding the second argument of <code>elem</code> rather than the first. There is also <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Char.html\" rel=\"nofollow noreferrer\"><code>isPunctuation</code></a>.</p>\n"}], "owner": {"reputation": 386, "user_id": 7589968, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L-UKj5VH-zU/AAAAAAAAAAI/AAAAAAAAAEk/gJItIb1RtZw/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0442\u0430 \u041c\u0438\u0445\u0430\u0439\u043b\u043e\u0432", "link": "https://stackoverflow.com/users/7589968/%d0%9d%d0%b8%d0%ba%d0%b8%d1%82%d0%b0-%d0%9c%d0%b8%d1%85%d0%b0%d0%b9%d0%bb%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1161, "favorite_count": 0, "accepted_answer_id": 42333120, "answer_count": 1, "score": 1, "last_activity_date": 1487554355, "creation_date": 1487538694, "last_edit_date": 1487539438, "question_id": 42332928, "link": "https://stackoverflow.com/questions/42332928/how-can-i-check-if-character-belongs-to-a-group-of-symbols-in-haskell", "title": "How can I check if character belongs to a group of symbols in Haskell?", "body": "<p>The task is to count all the punctuation signs in a string. How can I check if character belongs to this group \".,!?;:\". I'm doing it this way</p>\n\n<pre><code>signs' curSgn ('.':list) = (signs' (curSgn + 1) list)\nsigns' curSgn (',':list) = (signs' (curSgn + 1) list)\nsigns' curSgn ('?':list) = (signs' (curSgn + 1) list)\nsigns' curSgn ('!':list) = (signs' (curSgn + 1) list)\nsigns' curSgn (':':list) = (signs' (curSgn + 1) list)\nsigns' curSgn (';':list) = (signs' (curSgn + 1) list)\n</code></pre>\n\n<p>But is there a way to do it in one line of code?</p>\n"}, {"tags": ["haskell", "ghci"], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "closed_date": 1487548236, "answer_count": 0, "score": 3, "last_activity_date": 1487538587, "creation_date": 1487538587, "question_id": 42332909, "link": "https://stackoverflow.com/questions/42332909/import-non-exported-function-in-ghci", "closed_reason": "Duplicate", "title": "Import non-exported function in ghci", "body": "<p>Is there a way to access a non-exported function from ghci? I'm debugging some code, and I'd like access to the inner workings of another package while on a breakpoint.</p>\n"}, {"tags": ["haskell", "state"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1487531564, "post_id": 42331266, "comment_id": 71815708, "body": "I&#39;m finding this question too broad, I can&#39;t really give you an answer more specific than &quot;Use the state monad&quot;. If you could <a href=\"https://stackoverflow.com/posts/42331266/edit\">edit</a> your question to provide some actual code then we could probably be more helpful."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1487531630, "post_id": 42331266, "comment_id": 71815736, "body": "@aclow Somewhat related: <a href=\"http://stackoverflow.com/questions/40698396/how-can-i-handle-user-plugins-in-my-types/\" title=\"how can i handle user plugins in my types\">stackoverflow.com/questions/40698396/&hellip;</a>"}, {"owner": {"reputation": 195, "user_id": 3589776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f56049843011af085cd299d0f5d22eb6?s=128&d=identicon&r=PG&f=1", "display_name": "aclow", "link": "https://stackoverflow.com/users/3589776/aclow"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1487532097, "post_id": 42331266, "comment_id": 71815924, "body": "@danidiaz Thanks, that looks like what I am looking for. I will try it out."}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 2, "last_activity_date": 1487536468, "creation_date": 1487536468, "answer_id": 42332564, "question_id": 42331266, "link": "https://stackoverflow.com/questions/42331266/allowing-agents-to-have-their-internal-state/42332564#42332564", "title": "Allowing agents to have their internal state", "body": "<p>What you're looking for might be something like:</p>\n\n<pre><code>newtype AI = AI { runAI :: GameState -&gt; (AI, Action) }\n</code></pre>\n\n<p>i.e. you'll return your actor's new state along with the action. You might make use of the <code>State</code> monad here. You might also be interested in reading about automata. If you need to serialize your <code>AI</code> (to store it in a database, say) then you might need to do something different.</p>\n"}], "owner": {"reputation": 195, "user_id": 3589776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f56049843011af085cd299d0f5d22eb6?s=128&d=identicon&r=PG&f=1", "display_name": "aclow", "link": "https://stackoverflow.com/users/3589776/aclow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1487536468, "creation_date": 1487529643, "question_id": 42331266, "link": "https://stackoverflow.com/questions/42331266/allowing-agents-to-have-their-internal-state", "title": "Allowing agents to have their internal state", "body": "<p>I am writing a game in Haskell in which the player and the AI are taking some actions in turns. Until now, the AIs worked by generating actions using all the information about the game, i.e they were functions of the form <code>GameHistory -&gt; GameState -&gt; Action</code>.</p>\n\n<p>This way these functions generate some information they need from the history each time they are called. It would be a lot easier to write AIs if they could have some kind of \"internal state\" which persists between their turns (i.e. calls to the corresponding function). How could one implement something like that? (By the way, I should also take into account that internal states of different kinds of AIs could have different types.)</p>\n"}, {"tags": ["haskell", "recursion", "lambda"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487537100, "post_id": 42330723, "comment_id": 71817695, "body": "A good rule to live by is to factor out as much of your pure code as possible. In that spirit I would write <code>mapM_ print . foo where foo = map (subtract average) . filter (&gt; average)</code>. It really helps to write the types of things you&#39;ve already written, as well as the types of the things you want to write: so you say you want to use <code>map</code>, then what is the type of the function you intend to pass to <code>map</code>? It doesn&#39;t look like you&#39;ve thought that far ahead"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 7, "last_activity_date": 1487528958, "last_edit_date": 1487528958, "creation_date": 1487528534, "answer_id": 42331059, "question_id": 42330723, "link": "https://stackoverflow.com/questions/42330723/use-map-instead-of-recursion/42331059#42331059", "title": "Use map instead of recursion", "body": "<p>Note that each step of <code>loop</code> does two things at once: they (possibly) generate a printing action out of each element of the list and then combine that action with the remaining ones (using <code>(&gt;&gt;)</code>). If you want to write <code>loop</code> in terms of <code>map</code>, you need to disentangle these two sub-steps. For instance, you can define a function...</p>\n\n<pre><code>printDiffIfAboveAvg :: Double -&gt; IO ()\n</code></pre>\n\n<p>... and then apply it to all elements of the list with <code>map printDiffIfAboveAvg</code>. That will give you a list of actions, of type <code>[IO ()]</code>, which you will need to combine into a single overall action:</p>\n\n<pre><code>runAllActions :: [IO ()] -&gt; IO ()\n</code></pre>\n\n<p><code>runAllActions</code> already exists in the base library, in a more general version called <code>sequence_</code>:</p>\n\n<pre><code>sequence_ :: (Foldable t, Monad m) =&gt; t (m a) -&gt; m ()\n</code></pre>\n\n<p>So you would have <code>loop = sequence_ . map printDiffIfAboveAvg</code>. In fact, there is also another function in the base library...</p>\n\n<pre><code>mapM_ :: (Foldable t, Monad m) =&gt; (a -&gt; m b) -&gt; t a -&gt; m ()\n</code></pre>\n\n<p>... which performs exactly this combination of <code>sequence_</code> and <code>map</code>.</p>\n"}], "owner": {"reputation": 2445, "user_id": 4468969, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6b05d7f3493f7c284f67b1f2c1557f58?s=128&d=identicon&r=PG", "display_name": "Andi Pavllo", "link": "https://stackoverflow.com/users/4468969/andi-pavllo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487528958, "creation_date": 1487526840, "last_edit_date": 1487527399, "question_id": 42330723, "link": "https://stackoverflow.com/questions/42330723/use-map-instead-of-recursion", "title": "Use map instead of recursion", "body": "<p>I have the following code, which takes a list, checks if each element's value is higher than the <code>avg</code> and, it that's the case, prints <code>val - avg</code>. I have already implemented it with recursion, I would like to transform it in order to use <code>map</code> function.</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>loop [] = return ()\nloop (x:xs)\n      | x &gt; average = print (x - average) &gt;&gt; loop xs\n      | otherwise = loop xs\n</code></pre>\n\n\n\n<p>Any suggestion?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487525769, "post_id": 42330183, "comment_id": 71813557, "body": "<code>myToFloat</code> doesn&#39;t work. And <b>please</b> include your <code>import</code>s."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487526039, "post_id": 42330183, "comment_id": 71813663, "body": "@Zeta I&#39;m sorry. I fixed it and added imports."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487526150, "post_id": 42330183, "comment_id": 71813700, "body": "Ah. <i>Lazy</i> bytestrings. Allright. Still a typo, by the way ( <code>vgenerate</code> should be <code>V.generate</code>). That being said, <code>map id</code> forces the slice. And while it sounds strange, forcing in this case is actually more memory-friendly if the size of your original vector is a lot greater than the slice."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487526389, "post_id": 42330183, "comment_id": 71813770, "body": "@Zeta I&#39;m so sorry. It shouldn&#39;t be a lazy bytestring. I&#39;ve made so many versions of this as a test so I added the wrong version. What you&#39;re saying about forcing the slice seems right though."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1487526767, "post_id": 42330183, "comment_id": 71813931, "body": "I haven&#39;t checked all of <code>vector</code>&#39;s code yet, but a <code>slice</code> is basically a pair of &quot;offset&quot; and &quot;new length&quot;, which still use the original <code>Array a</code> pointer. So if you use the slice, the original Array must be populated, since it&#39;s strict and unboxed, probably in order to use <code>show</code>. However. if you use <code>force</code>, you copy the memory, which can be taken into account when you actually generate your &quot;new&quot; vector. You could compare the resulting core. In the non-force version, it evaluates all elements, whereas in the force-version, it evaluates just the first 5000."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487578028, "post_id": 42330183, "comment_id": 71830772, "body": "Now that I had some time to compile it: I cannot reproduce this behaviour. Please add your <code>getSamplesFromFile</code>, as well as the used compiler version."}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1487596382, "creation_date": 1487524109, "last_edit_date": 1487596382, "question_id": 42330183, "link": "https://stackoverflow.com/questions/42330183/evaluation-of-higher-order-functions", "title": "Evaluation of higher-order functions", "body": "<p>I've written a function <code>getSamplesFromFile</code> that takes a file and returns its contents as a <code>Vector</code> of <code>Floats</code>. The functions reads the contents of the file into a <code>Data.ByteString</code> using <code>Data.ByteString.hGet</code>, it then converts this <code>Data.ByteString</code> to a <code>Vector</code> of <code>Floats</code> using:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as V\nimport qualified Data.ByteString as BS\nimport Data.Word\nimport System.Environment\nimport GHC.Int\ntoVector :: BS.ByteString -&gt; V.Vector Float\ntoVector bs =  vgenerate (fromIntegral (BS.length bs `div` 3)) $ \\i -&gt;\n     myToFloat [BS.index bs (3*i), BS.index bs (3*i+1), BS.index bs (3*i+2)]\n  where\n    myToFloat :: [Word8] -&gt; Float\n    myToFloat = sum . map fromIntegral \n\nvgenerate n f = V.generate n (f . fromIntegral)\n</code></pre>\n\n<p>I was testing how lazy this program was via a small test program:</p>\n\n<pre><code>main = do\n    [file] &lt;- getArgs\n    samples &lt;- getSamplesFromFile file\n    let slice = V.slice 0 50000 samples\n    print slice\n</code></pre>\n\n<p>If I run this on a 13MB file, it seems as if every sample is loaded into memory, even though I only need 50000 samples to be printed. \n<a href=\"https://i.stack.imgur.com/9ZFEu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/9ZFEu.png\" alt=\"enter image description here\"></a>\nIf I make a small modification to this problem and first map or filter over it, the result is different:</p>\n\n<pre><code>main = do\n    [file] &lt;- getArgs\n    samples &lt;- getSamplesFromFile file\n    let slice = V.slice 0 50000 samples\n    let mapped = V.map id slice\n    print mapped\n</code></pre>\n\n<p>This way, it seems that not every sample was loaded into memory, only the slice:\n<a href=\"https://i.stack.imgur.com/0Gwsn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0Gwsn.png\" alt=\"enter image description here\"></a>\nTo make sure this was the case, I ran the program again with a slice of half the size (25000 samples):\n<a href=\"https://i.stack.imgur.com/4XcMN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4XcMN.png\" alt=\"enter image description here\"></a>\nNow, the memory usage seems to be proportional to the size of the slice. Just because I map over the slice with <code>id</code>. </p>\n\n<p>The result is the same when filtering over the samples. How can applying a higher-order function suddenly make the behavior lazy?</p>\n\n<p><strong>EDIT</strong>\nThe problem seems to have to do something with <code>cabal</code>. As you can see from the pictures, I was testing my code inside a <code>cabal</code> project called <em>laziness</em>. I can't reproduce this weird behavior if use a separate <code>Main.hs</code> file outside of a cabal project. This is the <code>Main.hs</code> I'm using:</p>\n\n<pre><code>module Main where\n\nimport qualified Data.ByteString     as BS\nimport qualified Data.Vector.Unboxed as V\nimport           Data.Word\nimport           GHC.Int\nimport           System.Environment\nmain = do\n    [file] &lt;- getArgs\n    samples &lt;- getSamplesFromFile file\n    let slice = V.slice 0 50000 samples\n    --let filtered = V.filter (&gt;0) slice\n    let mapped = V.map id slice\n    print slice\n\ngetSamplesFromFile = fmap toVector . BS.readFile\n\ntoVector :: BS.ByteString -&gt; V.Vector Float\ntoVector bs =  vgenerate (fromIntegral (BS.length bs `div` 3)) $ \\i -&gt;\n     myToFloat [BS.index bs (3*i), BS.index bs (3*i+1), BS.index bs (3*i+2)]\n  where\n    myToFloat :: [Word8] -&gt; Float\n    myToFloat = sum . map fromIntegral\n\nvgenerate n f = V.generate n (f . fromIntegral)\n</code></pre>\n\n<p>I don't experience the weird behavior if I do the following:</p>\n\n<ol>\n<li>Create a new directory somewhere via <code>mkdir</code></li>\n<li>Add the above <code>Main.hs</code> to the directory.</li>\n<li>Compile using <code>ghc Main.hs -O2 -rtsopts -prof</code>.</li>\n<li>Run via <code>./Main myfile.wav +RTS -hy</code>. </li>\n<li>Create the pdf using <code>hp2ps</code> and <code>ps2pdf</code>.</li>\n</ol>\n\n<p>I do experience the weird behavior if I do the following:</p>\n\n<ol>\n<li>Create a new directory, <em>laziness</em>, via <code>mkdir laziness</code>.</li>\n<li>Initiate a <code>cabal</code> project via <code>cabal init</code>.</li>\n<li>Add the above <code>Main.hs</code> to <code>/src</code>.</li>\n<li>Add <code>ghc-options: -O2 -rtsopts -prof</code> to <code>laziness.cabal</code>.</li>\n<li>Compile using <code>cabal install</code></li>\n<li>Run via <code>laziness myfile.wav +RTS -hy</code>.</li>\n<li>Create the pdf using <code>hp2ps</code> and <code>ps2pdf</code>.</li>\n</ol>\n\n<p>I even experience the weird behavior if I:</p>\n\n<ol>\n<li><code>cd laziness/src</code></li>\n<li>Compile using <code>ghc Main.hs -O2 -rtsopts -prof</code>.</li>\n<li>Run via <code>./Main myfile.wav +RTS -hy</code>. </li>\n<li>Create the pdf using <code>hp2ps</code> and <code>ps2pdf</code>.</li>\n</ol>\n\n<p>So it seems that this behavior only occurs when the code is inside a <code>cabal</code> project. This seems weird to me. Could this have something to do with the setup of my <code>cabal</code> project?.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487523988, "post_id": 42329605, "comment_id": 71812923, "body": "<code>groupBy ((==) `on` (&gt;0)) value</code> should also work, after you import <code>Data.Function</code> for the <code>on</code> helper."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1487536476, "post_id": 42329605, "comment_id": 71817466, "body": "If you don&#39;t want the property of <code>groupBy</code> that it groups <i>adjacent</i> objects, it sounds like you want <code>partition</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1201, "user_id": 7506861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfa43944dd74a96c82dfd990626da2d5?s=128&d=identicon&r=PG&f=1", "display_name": "Emily", "link": "https://stackoverflow.com/users/7506861/emily"}, "is_accepted": false, "score": 3, "last_activity_date": 1487521907, "last_edit_date": 1487521907, "creation_date": 1487521617, "answer_id": 42329748, "question_id": 42329605, "link": "https://stackoverflow.com/questions/42329605/why-do-groupby-in-haskell-need-two-variables-to-check/42329748#42329748", "title": "Why do groupBy in Haskell need two variables to check", "body": "<blockquote>\n  <p>[...] the way I understand it is that the groupBy function takes a List and a condition and groups the element based on the specified condition.</p>\n</blockquote>\n\n<p>Not entirely, it groups <em>adjacent</em> elements based on the specified condition. Notice how your code evaluates to this list:</p>\n\n<pre><code>[[-3,-5,-1],[1,1,1,2,3],[-1,-2]]\n</code></pre>\n\n<p>instead of this list:</p>\n\n<pre><code>[[-3,-5,-1,-1,-2],[1,1,1,2,3]]\n</code></pre>\n\n<p>Therefore, the lambda expression that you pass to <code>groupBy</code> determines whether two <em>adjacent</em> elements should be in a group together.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487522708, "post_id": 42329816, "comment_id": 71812445, "body": "I wouldn&#39;t necessarily say &quot;is best described by [...]&quot; -- the OP&#39;s implementation is fine; it&#39;s just that it is slightly unusual to see <code>(==)</code> on <code>Bool</code> being used as a biconditional."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487525352, "post_id": 42329816, "comment_id": 71813407, "body": "Actually, there is one thing immediately related to the OP&#39;s question that counts in favour of your approach: <code>groupBy</code> expects an equivalence predicate, so we aren&#39;t at all supposed to pass things like <code>(\\x y -&gt; (x &gt; 0) == (y &lt; 0))</code> to it."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 2, "last_activity_date": 1487522412, "last_edit_date": 1487522412, "creation_date": 1487522010, "answer_id": 42329816, "question_id": 42329605, "link": "https://stackoverflow.com/questions/42329605/why-do-groupby-in-haskell-need-two-variables-to-check/42329816#42329816", "title": "Why do groupBy in Haskell need two variables to check", "body": "<p><code>groupBy</code> operates by checking whether the current element belongs to the group based on the previous one.</p>\n\n<p>The behaviour you want is best descibed by a separate function, repeatedly applying <code>span</code> and <code>break</code>:</p>\n\n<pre><code>myFunc :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nmyFunc _ [] = []\nmyFunc p xs = satp : notsatp : myFunc p rest\n  where\n    (satp, rest') = span p xs\n    (notsatp, rest) = break p rest'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 5, "last_activity_date": 1487527351, "last_edit_date": 1495542718, "creation_date": 1487525011, "answer_id": 42330376, "question_id": 42329605, "link": "https://stackoverflow.com/questions/42329605/why-do-groupby-in-haskell-need-two-variables-to-check/42330376#42330376", "title": "Why do groupBy in Haskell need two variables to check", "body": "<p><a href=\"https://stackoverflow.com/a/42329748/2751851\">Lignum's answer</a> explains why the <code>groupBy</code> predicate takes two arguments. To put it in another way, <code>groupBy</code> sets up boundaries, and you need two sides to be able to define a boundary.</p>\n\n<blockquote>\n  <p>Also should both the conditions be the same? What will happen if they are different.</p>\n</blockquote>\n\n<p>Yes, they should. As the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#g:24\" rel=\"nofollow noreferrer\"><code>Data.List</code> documentation</a> notes...</p>\n\n<blockquote>\n  <p>The predicate is assumed to define an equivalence.</p>\n</blockquote>\n\n<p>In other words, if <code>p :: a -&gt; a -&gt; Bool</code> is the predicate you pass to <code>groupBy</code>, then all of...</p>\n\n<ul>\n<li><code>p x x = True</code></li>\n<li><code>p x y = p y x</code></li>\n<li>if <code>p x y &amp;&amp; p y z</code> then <code>p x z</code></li>\n</ul>\n\n<p>... should hold. Weird things happen if that isn't the case. For instance, we might at first think that...</p>\n\n<pre><code>groupBy (\\x y -&gt; (x &gt; 0) == (y &lt; 0)) [-1,2,-3,-4,2,1,2,-3,1,1,2]\n</code></pre>\n\n<p>... would produce groups composed of alternating above zero and below zero elements. Instead, we get bogus results:</p>\n\n<pre><code>GHCi&gt; groupBy (\\x y -&gt; (x &gt; 0) == (y &lt; 0)) [-1,2,-3,-4,2,1,2,-3,1,1,2]\n[[-1,2],[-3],[-4,2,1,2],[-3,1,1,2]]\n</code></pre>\n\n<p>(The reason it goes wrong is that the guarantee of the predicate being an equivalence is exploited by implementing <code>groupBy</code> in terms of <code>span</code>.)</p>\n\n<hr>\n\n<p>Finally, there is a nicer way of writing your <code>groupBy</code> predicate: using <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Function.html#v:on\" rel=\"nofollow noreferrer\"><code>on</code></a> from <code>Data.Function</code>:</p>\n\n<pre><code>GHCi&gt; groupBy ((==) `on` (&gt; 0)) value\n[[-3,-5,-1],[1,1,1,2,3],[-1,-2]]\n</code></pre>\n\n<p><code>(g `on` f) x y = g (f x) (f y)</code>. You might even define:</p>\n\n<pre><code>-- A more general type: Eq b =&gt; (a -&gt; b) -&gt; [a] -&gt; [[a]]\ngroupBySingle :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]]\ngroupBySingle p = groupBy ((==) `on` p)\n</code></pre>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1487527351, "creation_date": 1487520855, "question_id": 42329605, "link": "https://stackoverflow.com/questions/42329605/why-do-groupby-in-haskell-need-two-variables-to-check", "title": "Why do groupBy in Haskell need two variables to check", "body": "<p>I was going through groupBy in Haskell and the way I understand it is that the groupBy function takes a List and a condition and groups the element based on the specified condition.</p>\n\n<pre><code>let value = [-3,-5,-1,1,1,1,2,3,-1,-2]\ngroupBy (\\x y -&gt; (x &gt; 0) == (y &gt; 0)) value\n</code></pre>\n\n<p>It works fine, but why should we give two variables in the lambda function? Why does \"groupBy (>0) value\" not work? Also should both the conditions be the same? What will happen if they are different. Please explain with examples.</p>\n"}, {"tags": ["function", "haskell", "types", "functional-programming"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1487514372, "post_id": 42328248, "comment_id": 71809299, "body": "How far did you get? Where are you stuck?"}], "answers": [{"tags": [], "owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "is_accepted": true, "score": 2, "last_activity_date": 1487515495, "creation_date": 1487515495, "answer_id": 42328609, "question_id": 42328248, "link": "https://stackoverflow.com/questions/42328248/haskell-give-type-declaration-of-function/42328609#42328609", "title": "Haskell - Give Type Declaration of Function", "body": "<p>First you have to identify the \"shape\" of data. You can do it by looking for constructors.\nHere you have <code>(:)</code>, constructor for list and <code>(,)</code>, constructor for tuple.\nYou can deduce that the type has the shape</p>\n\n<pre><code>unzOp :: [(a, b)] -&gt; ([a], [b])\n</code></pre>\n\n<p>Then you can look for more constrains on <code>a</code> and <code>b</code>.\nBecause of <code>x+1</code>, you have to assume <code>x</code> is a number.\nBecause of <code>y+2.5</code>, you have to assume <code>y</code> is a number too, but fractional.</p>\n\n<p>So,</p>\n\n<pre><code>unzOp :: (Num a, Fractional b) =&gt; [(a, b)] -&gt; ([a], [b])\n</code></pre>\n\n<p>To be honest the numeric types are not the easiest thing in Haskell.\nYou can ask for the type of an expression using <code>:t</code> in ghci.</p>\n\n<pre><code>:t (\\x -&gt; x + 1)\n(\\x -&gt; x + 1) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>By the way, what happens if you pass an empty list to <code>unzOp</code> ?</p>\n\n<p>Or in other words, <code>unzOp</code> is defined recursively, but what is the base case ?</p>\n"}], "owner": {"reputation": 11, "user_id": 7150132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cf2882c6960a484426ff976ba0765dc?s=128&d=identicon&r=PG&f=1", "display_name": "kishvith", "link": "https://stackoverflow.com/users/7150132/kishvith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 42328609, "answer_count": 1, "score": -2, "last_activity_date": 1487515495, "creation_date": 1487513567, "last_edit_date": 1592644375, "question_id": 42328248, "link": "https://stackoverflow.com/questions/42328248/haskell-give-type-declaration-of-function", "title": "Haskell - Give Type Declaration of Function", "body": "<p>I am revising for a test that I have coming up on Haskell and one of the questions is:</p>\n<blockquote>\n<p>(b) Give type declarations to complete the following (possibly incomplete) function definitions:</p>\n<p>ii. <code>unzOp ((x,y):zs) = ((x+1):(fst(unzOp zs)),(y+2.5):(snd(unzOp zs)))</code></p>\n</blockquote>\n<p>Can somebody help me answer this question please? If you could breakdown on why the answer is what it is, then that would be much appreciated.</p>\n<p>Thank You</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1487514789, "creation_date": 1487514789, "answer_id": 42328482, "question_id": 42328102, "link": "https://stackoverflow.com/questions/42328102/parse-error-in-a-function-for-maxheap/42328482#42328482", "title": "Parse error in a function for maxheap", "body": "<pre><code>|otherwise error \"something went wrong or program is bad\"\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>|otherwise = error \"something went wrong or program is bad\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1487523467, "post_id": 42329482, "comment_id": 71812724, "body": "Your solution is much better!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1487520254, "creation_date": 1487520254, "answer_id": 42329482, "question_id": 42328102, "link": "https://stackoverflow.com/questions/42328102/parse-error-in-a-function-for-maxheap/42329482#42329482", "title": "Parse error in a function for maxheap", "body": "<p>The error was already spotted by Li-yao Xia, and a fix was suggested.</p>\n\n<p>Note that you can also remove the offending line using this style:</p>\n\n<pre><code>swaptree (Tree E w (Tree lr x rr)) | x &lt;= w    = Tree E w (Tree lr x rr)\n                                   | otherwise = Tree E x (swaptree (Tree lr w rr))\n-- etc.\n</code></pre>\n\n<p>Indeed, it is weird to check <em>three</em> cases <code>max x w == x</code>, <code>max x w == w</code>, and <code>otherwise</code>. If we do reach the \"otherwise\" something is really wrong with the definition of <code>max</code>. We can safely ignore that case.</p>\n"}], "owner": {"reputation": 3, "user_id": 7588501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7fe7c7e5bd2861fecc261c647b13fe2?s=128&d=identicon&r=PG&f=1", "display_name": "Benedikt Lenz", "link": "https://stackoverflow.com/users/7588501/benedikt-lenz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 42329482, "answer_count": 2, "score": 0, "last_activity_date": 1487520254, "creation_date": 1487512774, "question_id": 42328102, "link": "https://stackoverflow.com/questions/42328102/parse-error-in-a-function-for-maxheap", "title": "Parse error in a function for maxheap", "body": "<p>I'm new to Haskell and am currently working on trees. In this, I wanted to create a function, that swaps the elements in a Tree until it becomes a maxheap. This, I would then use for a Heapsort algorithm.</p>\n\n<pre><code>data Bintree a = E | Tree (Bintree a) a (Bintree a) deriving( Eq, Ord, Show )\n\nswaptree:: Bintree Int -&gt; Bintree Int\nswaptree (Tree E w E) = (Tree E w E)\nswaptree (Tree E w (Tree lr x rr))|((max w x)==w)=(Tree E w (Tree lr x rr))\n                              |((max w x)==x)=(Tree E x(swaptree(Tree lr w rr)))\n                              |otherwise error \"something went wrong or program is bad\"\nswaptree (Tree (Tree ll v rl) w E)|((max v w)==w)=(Tree (Tree ll v rl) w E)\n                              |((max v w)==v)=(Tree (swaptree(Tree ll w rl)) v E)\n                              |otherwise error \"something went wrong or program is bad\"\nswaptree (Tree (Tree ll v rl) w (Tree lr x rr) )|((max3 v w x)==w) = (Tree (Tree ll v rl) w (Tree lr x rr)) \n                                            |((max v x)==x)=(Tree (Tree ll v rl) x (swaptree(Tree lr w rr)))\n                                            |((max v x)==v)=(Tree(swaptree(Tree ll w rl)) v (Tree lr x rr) )\n                                            |otherwise error \"something went wrong or program is bad\"\nswaptree':: Bintree Int -&gt; Bintree Int\nswaptree' (Tree E w E) = (Tree E w E)\nswaptree' (Tree lub w rub)  = (swaptree(Tree(swaptree lub) w (swaptree rub)))\n</code></pre>\n\n<p>This yields me this error: </p>\n\n<pre><code>   8:1: error:parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>Now, I looked it up and read, that this usually happens, <code>leSt</code> is used without <code>in</code>, but since I didn't use it I have no Idea how to fix this. \nI would greatly appreciate any help or tips on how to improve my code!</p>\n\n<p>PS: Please have mercy on me. As I said, I'm currently very bad at Haskell.</p>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1487517406, "post_id": 42327637, "comment_id": 71810470, "body": "<code>myLol x y z = take (z`quot`2) [take (y`quot`2) [\u03be, \u03be-2..] | \u03be&lt;-[x, x-2..]]</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487519704, "post_id": 42327637, "comment_id": 71811395, "body": "Nested list comprehensions should work fine. Try something similar to <code>[ [ x+y | x &lt;- [1..10] ] | y &lt;- [1..10] ]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 181, "user_id": 7518738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e7b03512c741b0d19d0717486edb15f?s=128&d=identicon&r=PG&f=1", "display_name": "fjarino", "link": "https://stackoverflow.com/users/7518738/fjarino"}, "is_accepted": true, "score": 1, "last_activity_date": 1487528167, "creation_date": 1487528167, "answer_id": 42330987, "question_id": 42327637, "link": "https://stackoverflow.com/questions/42327637/texas-ranges-in-list-of-lists/42330987#42330987", "title": "Texas ranges in list of lists", "body": "<p>It looks like your are trying to do something like this:</p>\n\n<pre><code>myLol x y z = [ [ x-i-j | i &lt;- [0,2 .. y-2] ] | j &lt;- [0,2 .. z-2]]\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 7120326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b7846310959b60c8a246f6111a52e32b?s=128&d=identicon&r=PG&f=1", "display_name": "DaoDib", "link": "https://stackoverflow.com/users/7120326/daodib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 42330987, "answer_count": 1, "score": 0, "last_activity_date": 1487528167, "creation_date": 1487510081, "last_edit_date": 1487516863, "question_id": 42327637, "link": "https://stackoverflow.com/questions/42327637/texas-ranges-in-list-of-lists", "title": "Texas ranges in list of lists", "body": "<p>This is for a school project.</p>\n\n<p>I have to generate a list of lists with ranges.</p>\n\n<p>Example:</p>\n\n<pre><code>myLol x y z = \n[[   x  , x-2 , ... ,  x-y+2 ],\n [  x-2 , x-4 , ... ,  x - y ],\n [  ... , ... , ... ,   ...  ],\n [x-z+2 , x-z , ... , x-y-z+4]]\n</code></pre>\n\n<p>My first thought was to make four lists, and put them together at the end, but that does not give me the 3rd row.\nI have played around trying to make list comprehensions inside list comprehension, but that did not turn out any good.</p>\n\n<p>I am quite sure generating the 1st, 2nd, and 4th column, and then the rows from these values would work. I am not skilled enough to figure out the code for it though.</p>\n\n<p>Any ideas?</p>\n\n<p>Edit:\nI made it making it only work with a 4x4 matrix. Not working dynamically though.</p>\n\n<pre><code>myLol x y z = [(row1 x y),(row2 x y),(row3 x y z),(row4 x y z)]\n\nrow1 x y =  take x [x,(x-1) .. (x-y+1)] \nrow2 x y =  take x [(x-1),(x-2) .. (x-y)]\nrow4 x y z = take x [(x-z+1),(x-z) .. (x-y-z+2)] \n\nrow3 x y z = [((row1 x y) !! 2),((row2 x y) !! 2) .. ((row4 x y z) !! 2)]\n</code></pre>\n"}, {"tags": ["haskell", "sdl-2", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1487514017, "creation_date": 1487514017, "answer_id": 42328324, "question_id": 42327396, "link": "https://stackoverflow.com/questions/42327396/how-can-i-use-my-own-build-of-a-package-with-stack/42328324#42328324", "title": "How can I use my own build of a package with stack?", "body": "<p>There are a few ways of doing that with Stack. The one I like the most, and which sounds like a good fit for your scenario, is uploading the repository with your fork to GitHub (or wherever else you find appropriate) and then adding a reference to the online repository as an <code>extra-dep</code> to the <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#packages\" rel=\"nofollow noreferrer\"><code>packages</code> section</a> of <code>stack.yaml</code>. For the sake of illustration, here is the <code>packages</code> section for a project of mine in which I had to do that:</p>\n\n<pre class=\"lang-yaml prettyprint-override\"><code>packages:\n- '.'\n- location:\n    git: https://github.com/duplode/threepenny-gui\n    commit: 7e4e3a41cbb5e55312d4375612790d633ccf1e7a\n  extra-dep: true\n</code></pre>\n"}], "owner": {"reputation": 1201, "user_id": 7506861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfa43944dd74a96c82dfd990626da2d5?s=128&d=identicon&r=PG&f=1", "display_name": "Emily", "link": "https://stackoverflow.com/users/7506861/emily"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 42328324, "answer_count": 1, "score": 2, "last_activity_date": 1487514017, "creation_date": 1487508610, "question_id": 42327396, "link": "https://stackoverflow.com/questions/42327396/how-can-i-use-my-own-build-of-a-package-with-stack", "title": "How can I use my own build of a package with stack?", "body": "<p>The bigger picture is that I'm trying to use the <code>sdl2</code> package from Stackage (lts 8.1). Though, I'm having a bit of an issue; The package is missing a compiler flag, as detailed in <a href=\"https://github.com/haskell-game/sdl2/issues/139\" rel=\"nofollow noreferrer\">this issue on GitHub</a>. As such, it doesn't build properly.</p>\n\n<p>However, if I clone the repository, I can add the missing compiler flag to the .cabal file and build it myself, which solves the issue. I now have a working build of the package.</p>\n\n<p>So my question is: How can I, in a separate project, use my own working build of the <code>sdl2</code> package, instead of the one from Stackage?</p>\n"}, {"tags": ["haskell", "reactive-programming", "frp", "reactive-banana"], "answers": [{"comments": [{"owner": {"reputation": 7287, "user_id": 258848, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/2Ckug.jpg?s=128&g=1", "display_name": "dimsuz", "link": "https://stackoverflow.com/users/258848/dimsuz"}, "edited": false, "score": 1, "creation_date": 1487516088, "post_id": 42328545, "comment_id": 71809975, "body": "Thank you very much, it&#39;s yet again that moment when I think &quot;why didn&#39;t I see this?&quot; Happens to me often when learning Haskell. I like this :)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1487515149, "creation_date": 1487515149, "answer_id": 42328545, "question_id": 42327241, "link": "https://stackoverflow.com/questions/42327241/implementation-of-ifb-in-reactive-banana/42328545#42328545", "title": "Implementation of ifB in reactive-banana", "body": "<p><code>Behavior</code> has an <code>Applicative</code> instance, which is enough to implement <code>ifB</code> without dynamic switching:</p>\n\n<pre><code>ifB :: Behavior Bool -&gt; Behavior a -&gt; Behavior a -&gt; Behavior a\nifB bB bT bF = (\\b t f -&gt; if b then t else f) &lt;$&gt; bB &lt;*&gt; bT &lt;*&gt; bF\n</code></pre>\n\n<p>Or, using <code>bool</code> from <code>Data.Bool</code>:</p>\n\n<pre><code>ifB :: Behavior Bool -&gt; Behavior a -&gt; Behavior a -&gt; Behavior a\nifB bB bT bF = bool &lt;$&gt; bF &lt;*&gt; bT &lt;*&gt; bB\n</code></pre>\n"}], "owner": {"reputation": 7287, "user_id": 258848, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/2Ckug.jpg?s=128&g=1", "display_name": "dimsuz", "link": "https://stackoverflow.com/users/258848/dimsuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "accepted_answer_id": 42328545, "answer_count": 1, "score": 4, "last_activity_date": 1487631710, "creation_date": 1487507620, "last_edit_date": 1487631710, "question_id": 42327241, "link": "https://stackoverflow.com/questions/42327241/implementation-of-ifb-in-reactive-banana", "title": "Implementation of ifB in reactive-banana", "body": "<p>I am reading Conal Elliot's paper <a href=\"http://conal.net/papers/ppdp00/\" rel=\"nofollow noreferrer\">\"Declarative Event-Oriented Programming\"</a> which has its examples written using a Fran library which is now obsolete.</p>\n\n<p>As I am learning FRP I try to implement those examples using reactive-banana. I seem to have no problem with this (but have to think <strong>a lot</strong> :)). The only thing I do not understand is how to correctly translate Fran's <code>ifB</code>.</p>\n\n<p>It seems to have this type signature:</p>\n\n<pre><code>ifB :: Behavior Bool -&gt; Behavior a -&gt; Behavior a -&gt; Behavior a\n</code></pre>\n\n<p>But reactive-banana only has <code>switchB</code> for this sort of thing.</p>\n\n<p>Currently I managed to do it by adding an additional \"trigger\" event which will be used to switch behaviors, like this:</p>\n\n<pre><code>ifB :: MonadMoment m =&gt; Event b -&gt; BoolB -&gt; Behavior a -&gt; Behavior a -&gt; m (Behavior a)\nifB trigger condB b1 b2 = switchB b2 (switcherB &lt;@ trigger)\n  where switcherB = (\\x -&gt; if x then b1 else b2) &lt;$&gt; condB\n</code></pre>\n\n<p>I am not sure if this is a correct and good solution. Is it performant?\nBelow is a snippet from the paper which uses <code>ifB</code>:</p>\n\n<pre><code>editCPoint :: User -&gt; S.Point2 -&gt; CPoint\neditCPoint u p0 = (pos, closeEnough)\n  where\n    pos, lastRelease :: Point2B\n    --    vvv this is the ifB in question!\n    pos = ifB grabbing (mouse u) lastRelease\n    lastRelease = stepper p0 (release \u2018snapshot_\u2018 pos)\n\n    closeEnough, grabbing :: BoolB\n    closeEnough = distance2 pos (mouse u) &lt;* grabDistance\n    grabbing = stepper False (grab -=&gt; True .|. release -=&gt; False)\n\n    grab, release :: Event ()\n    grab = lbp u \u2018whenE\u2018 closeEnough\n    release = lbr u \u2018whenE\u2018 grabbing\n\ngrabDistance :: RealB\ngrabDistance = 2 * pointSize\n</code></pre>\n\n<p>I managed to get this snippet working with reactive-banana, by using my implementation of <code>ifB</code> and feeding it a <code>cursor move</code> event so it gets updated regularly. I tried to feed it only mouse press/release events as triggers for switching and it didn't work correctly...</p>\n\n<p>Did I do it wrong? Any advice on how to do better?</p>\n"}, {"tags": ["haskell", "dependent-type", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1487526523, "post_id": 42325043, "comment_id": 71813821, "body": "Is there a way to do this with existential types? I have not used them, but <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">section 3.3 on the Haskell wiki page</a> makes me think that there is."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 1, "creation_date": 1487533975, "post_id": 42325043, "comment_id": 71816589, "body": "@jcolemang, yeah, <code>findSubtree :: forall c n a r. (Ord a) =&gt; Tree c n a -&gt; a -&gt; (forall cc nn. Tree c n a -&gt; r) -&gt; r</code>.  Then take an extra final parameter, say <code>c</code> (&quot;continuation&quot;), and instead of returning <code>SomeTree ...</code>, return <code>c ...</code>.  Not the most readable thing, I&#39;d probably go with <code>SomeTree</code>. Note that <code>c</code> has the same type signature as the <code>SomeTree</code> data constructor itself if <code>r ~ SomeTree</code>.  Not a coincidence :-)"}, {"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1487543033, "post_id": 42325043, "comment_id": 71819630, "body": "Ok, I will dissect that once I get some more time. Thanks!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 9, "last_activity_date": 1487492104, "creation_date": 1487492104, "answer_id": 42325043, "question_id": 42324889, "link": "https://stackoverflow.com/questions/42324889/return-gadt-from-function/42325043#42325043", "title": "Return GADT from function", "body": "<p>The problem lies in your quantifiers in the type signature for <code>findSubtree</code>.</p>\n\n<pre><code>findSubtree :: (Ord a) =&gt; Tree c n a -&gt; a -&gt; Tree cc nn a\n</code></pre>\n\n<p>Although you obviously want <code>c</code>, <code>n</code>, and <code>a</code> to be universally quantified, not that <code>cc</code> and <code>nn</code> should be existentially quantified (the subtree found will have <em>some</em> color).</p>\n\n<p>The way to deal with existentials in Haskell is to wrap them in a datatype. It isn't immediately obvious, but having a <code>forall</code> inside a data type is equivalent to an <code>exists</code> (if it existed in Haskell).</p>\n\n<pre><code>-- An existential type to represent a tree with _some_ color and depth\ndata SomeTree a where\n  SomeTree :: Tree c n a -&gt; SomeTree a\n\nfindSubtree :: (Ord a) =&gt; Tree c n a -&gt; a -&gt; SomeTree a\nfindSubtree Empty _ = SomeTree Empty\nfindSubtree (RTree left curr right) item\n  | curr == item = SomeTree (RTree left curr right)\n  | curr &lt; item  = findSubtree left item\n  | otherwise    = findSubtree right item\nfindSubtree (BTree left curr right) item\n  | curr == item = SomeTree (BTree left curr right)\n  | curr &lt; item  = findSubtree left item\n  | otherwise    = findSubtree right item\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1487492300, "creation_date": 1487492300, "answer_id": 42325064, "question_id": 42324889, "link": "https://stackoverflow.com/questions/42324889/return-gadt-from-function/42325064#42325064", "title": "Return GADT from function", "body": "<p>The problem is here:</p>\n\n<pre><code>findSubtree :: (Ord a) =&gt; Tree c n a -&gt; a -&gt; Tree cc nn a\n</code></pre>\n\n<p>Type variables <code>a,c,n,cc,nn</code> are universally quantified, meaning that the <em>caller</em> can choose whatever type/color they want for those variables. Clearly, the caller must be able to choose <code>a,c,n</code>, but in the code it is the function itself which chooses <code>cc,nn</code>. </p>\n\n<p>The compiler complains that the result does not match with the caller's choice, much as in</p>\n\n<pre><code>foo :: Int -&gt; a\nfoo x = x -- error: what if the caller chooses e.g. a ~ Bool ?\n</code></pre>\n\n<p>A possible solution is to wrap the result in an existential wrapper, as @Alec showed.</p>\n"}], "owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 42325043, "answer_count": 2, "score": 4, "last_activity_date": 1487492300, "creation_date": 1487490777, "question_id": 42324889, "link": "https://stackoverflow.com/questions/42324889/return-gadt-from-function", "title": "Return GADT from function", "body": "<h2>Background</h2>\n\n<p>I am working on writing a red black tree implementation in Haskell using\ndependent types and am having some trouble understanding why the code below does not work. What I wanted to do as a sort of warm up exercise was to find a subtree given an arbitrary value. Unfortunately, I had some trouble getting the code to compile and eventually moved on. However, I am still confused about exactly why this does not compile and what I could do to get it to work. I haven't been able to find any examples like this, nor anything showing why this doesn't work.</p>\n\n<h2>The Code</h2>\n\n<pre><code>data NaturalNum = Z\n                | S NaturalNum\n                deriving Show\n\n\ndata Color :: * where\n  Red :: Color\n  Black :: Color\n  deriving Show\n\n\ndata Tree :: Color -&gt; NaturalNum -&gt; * -&gt; * where\n  Empty :: Tree Black Z a\n  RTree :: Tree Black natNum a     -&gt; a -&gt; Tree Black natNum a      -&gt; Tree Red natNum a\n  BTree :: Tree leftColor natNum a -&gt; a -&gt; Tree rightColor natNum a -&gt; Tree Black (S natNum) a\nderiving instance (Show a) =&gt; Show (Tree c n a)\n\n\nfindSubtree :: (Ord a) =&gt; Tree c n a -&gt; a -&gt; Tree cc nn a\nfindSubtree Empty _ = Empty\nfindSubtree (RTree left curr right) item\n  | curr == item = RTree left curr right\n  | curr &lt; item  = findSubtree left item\n  | otherwise    = findSubtree right item\nfindSubtree (BTree left curr right) item\n  | curr == item = BTree left curr right\n  | curr &lt; item  = findSubtree left item\n  | otherwise    = findSubtree right item\n</code></pre>\n\n<h2>The Error Message</h2>\n\n<p>There are two more almost identical error messages complaining about the other constructors.</p>\n\n<pre><code>\u2022 Could not deduce: cc ~ 'Black\n  from the context: (c ~ 'Black, n ~ 'Z)\n    bound by a pattern with constructor:\n               Empty :: forall a. Tree 'Black 'Z a,\n             in an equation for \u2018findSubtree\u2019\n    at lib/RedBlackTree.hs:246:13-17\n  \u2018cc\u2019 is a rigid type variable bound by\n    the type signature for:\n      findSubtree :: forall (c :: Color) (n :: NaturalNum) a (cc :: Color) (nn :: NaturalNum).\n                     Tree c n a -&gt; a -&gt; Tree cc nn a\n    at lib/RedBlackTree.hs:245:16\n  Expected type: Tree cc nn a\n    Actual type: Tree 'Black 'Z a\n\u2022 In the expression: Empty\n  In an equation for \u2018findSubtree\u2019: findSubtree Empty _ = Empty\n\u2022 Relevant bindings include\n    findSubtree :: Tree c n a -&gt; a -&gt; Tree cc nn a\n      (bound at lib/RedBlackTree.hs:246:1)\n</code></pre>\n\n<h2>My Confusion</h2>\n\n<p>Based on the error message it looks to me that I cannot return a GADT parameterized by an unconstrained color and black height. However, I find this fairly unsatisfactory. I see that it would be hard to check the types of other parts of the program if you had this little information about the return types of the <code>findSubtree</code> function, but finding a subtree seems like a fairly reasonable thing to want to do. Is this a restriction that comes along with using GADTs?</p>\n\n<p>Most importantly,\n<strong>What changes would I have to make to the above code to be able to return an arbitrary subtree from this data structure, and what is an explanation for exactly why the given code will not compile?</strong></p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487461625, "post_id": 42321665, "comment_id": 71797265, "body": "That error sure could use some work! That said: I&#39;m guessing you aren&#39;t in a cabal project directory. <code>cabal new-build</code> and friends work a bit differently from <code>cabal install</code>; you can&#39;t just <code>new-build</code> a given package. You can list it as a package to be included in a given project, though."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487465337, "post_id": 42321665, "comment_id": 71798100, "body": "(Digression: @DanielWagner &quot;you can&#39;t just <code>new-build</code> a given package. You can list it as a package to be included in a given project, though&quot; -- That is, it is roughly like <code>stack build</code> is typically used to install dependencies?)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487467848, "post_id": 42321665, "comment_id": 71798626, "body": "@duplode I&#39;m not familiar enough with stack to say for sure, but that sounds roughly right: <code>new-build</code> will install all of the dependencies of the specified build targets automatically."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487471087, "post_id": 42321665, "comment_id": 71799235, "body": "@DanielWagner I have no idea what a cabal project directory is.  I am trying to install reflex and someone suggested I use <code>new-build</code>, but I have no idea to use it correctly"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1487472520, "post_id": 42321665, "comment_id": 71799441, "body": "@johnmangual Just start writing the package you want to make with reflex, and have it depend on reflex. When you <code>cabal new-build</code> your package the first time, it will make install reflex. For more concrete instructions: run <code>cabal init</code> in a new directory, add <code>reflex</code> to the dependencies in the <code>*.cabal</code> file that generates, then run <code>cabal new-build</code>."}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487460059, "creation_date": 1487458849, "last_edit_date": 1495542299, "question_id": 42321665, "link": "https://stackoverflow.com/questions/42321665/cabal-1-24-says-badpackagelocations", "title": "cabal 1.24 says BadPackageLocations", "body": "<p>After upgrading to Cabal 1.24 I can't install new programs</p>\n\n<pre><code>$ cabal new-build reflex\nBadPackageLocations [BadLocGlobEmptyMatch \"./*.cabal\"]\n</code></pre>\n\n<p>See my other question: <a href=\"https://stackoverflow.com/questions/42321540/cabal-install-does-not-upgrade-cabal\">cabal install does not upgrade cabal</a></p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1487458226, "post_id": 42321540, "comment_id": 71796336, "body": "<a href=\"https://wiki.haskell.org/Cabal-Install\" rel=\"nofollow noreferrer\">TFM</a>: <i>By default the cabal tool will install programs in ~/.cabal/bin/</i>"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1487458382, "post_id": 42321540, "comment_id": 71796377, "body": "@n.m. now it says <code>$ ~&#47;.cabal&#47;bin&#47;cabal new-build reflex</code>  then it says <code>BadPackageLocations [BadLocGlobEmptyMatch &quot;.&#47;*.cabal&quot;]</code>"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 309, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487457950, "creation_date": 1487457950, "question_id": 42321540, "link": "https://stackoverflow.com/questions/42321540/cabal-install-does-not-upgrade-cabal", "title": "cabal install does not upgrade cabal", "body": "<p>I have upgraded cabal install (using a capital C for <code>Cabal</code>)</p>\n\n<pre><code>$cabal install Cabal cabal-install\n\n[...]\n\nConfiguring cabal-install-1.24.0.2...\nBuilding cabal-install-1.24.0.2...\nInstalled cabal-install-1.24.0.2\n</code></pre>\n\n<p>after a lengthy output in terminal, then I check that cabal has been updated, it hasn't changed</p>\n\n<pre><code>$ cabal --version\ncabal-install version 1.22.6.0\nusing version 1.22.5.0 of the Cabal library\n</code></pre>\n\n<p>I am looking for where the new installation of cabal might be</p>\n\n<pre><code>$ which cabal\n/usr/local/bin/cabal\n\n$ /usr/local/bin/cabal --version\ncabal-install version 1.24.0.2\ncompiled using version 1.24.2.0 of the Cabal library \n</code></pre>\n\n<p>Not entirely sure what I have found.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1487458042, "post_id": 42321521, "comment_id": 71796276, "body": "It is not clear what you are asking. Is your question &quot;why <code>f f</code> is wrong?&quot; Is it &quot;why <code>f f x</code> means <code>(f f) x</code> and not <code>f (f x)</code>&quot;? Something else?"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1487458181, "post_id": 42321521, "comment_id": 71796320, "body": "The type of <code>f</code> would have to be <code>((((\u2026) -&gt; a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1487458535, "post_id": 42321521, "comment_id": 71796427, "body": "@n.m I mean why <code>f f x</code> is wrong."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487460497, "post_id": 42321521, "comment_id": 71796976, "body": "If <code>f f x</code> was meaningful, i.e. <code>(f f) x</code> made sense, what would <code>f f</code> mean, on its own? If e.g. <code>f :: Int -&gt; Int</code>, then <code>f 42</code> is an integer. But, <code>f</code> is not an integer (it&#39;s a function), so I can not pass it as the argument of <code>f</code> itself."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487665675, "post_id": 42321521, "comment_id": 71874394, "body": "@chi So it is not like a higher order function?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487666063, "post_id": 42321521, "comment_id": 71874618, "body": "Maybe <code>f</code> is higher order, but the types likely wouldn&#39;t match anyway. Application is not associative."}], "answers": [{"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": false, "score": 4, "last_activity_date": 1487469500, "last_edit_date": 1487469500, "creation_date": 1487461761, "answer_id": 42322009, "question_id": 42321521, "link": "https://stackoverflow.com/questions/42321521/compiler-error-by-function-application/42322009#42322009", "title": "compiler error by function application", "body": "<p><code>f f x</code> means you want to pass <code>f</code> and <code>x</code> to <code>f</code>. </p>\n\n<p>You need to ensure <code>f x</code> is evaluated first so only 1 argument is passed to the left-most <code>f</code>. </p>\n\n<p>You can do that by wrapping it in  parentheses as you found out, or by using the application operator (both are effectively equivalent in this scenario):</p>\n\n<pre><code>f (f x) \nf $ f x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487503005, "post_id": 42322124, "comment_id": 71805866, "body": "Can you please explain it with lambda calculus?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487509509, "post_id": 42322124, "comment_id": 71807695, "body": "@zero_coding Plain lambda calculus doesn&#39;t have a type system, so how would that work?"}, {"owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487549679, "post_id": 42322124, "comment_id": 71821561, "body": "@zero_coding: Just look at the part with the title &quot;Looking at the types&quot; of my (long) post, there is a step-by-step explanation, let me quote myself:  If we really use f f x, then the type of f must satisfy these requirements:      f must match the function type a -&gt; a as specified in the type signature of applyTwice      In f f f is applied to itself and that means that the a in a -&gt; a must be equal to a -&gt; a, which is impossible!"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487665493, "post_id": 42322124, "comment_id": 71874281, "body": "@melpomene why after first substitution is not finished <code>(a -&gt; b) -&gt; b</code>?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487665567, "post_id": 42322124, "comment_id": 71874326, "body": "@zero_coding Because there&#39;s still an <code>a</code> in there. The equation is now <code>a = (a -&gt; b) -&gt; b</code> and it&#39;s trying to solve for <code>a</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487665875, "post_id": 42322124, "comment_id": 71874507, "body": "@melpomene where the <code>a</code> comes from? Help me please to understand it."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487667467, "post_id": 42322124, "comment_id": 71875413, "body": "Why is <code>a</code> still there after substitution."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487669894, "post_id": 42322124, "comment_id": 71877047, "body": "@zero_coding Why wouldn&#39;t it be there? What would you expect to happen instead?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487670698, "post_id": 42322124, "comment_id": 71877679, "body": "@melpomene For me, it is not clear at all, why it is infinite. After <code>(a -&gt; b) -&gt; b</code> there is no more something to substitute. Why can I still apply it?"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 5, "last_activity_date": 1487462867, "creation_date": 1487462867, "answer_id": 42322124, "question_id": 42321521, "link": "https://stackoverflow.com/questions/42321521/compiler-error-by-function-application/42322124#42322124", "title": "compiler error by function application", "body": "<p>If <code>f f</code> were valid, what would the type of <code>f</code> be?</p>\n\n<p>We're applying <code>f</code> to an argument, so <code>f</code> has to be a function: <code>f :: a -&gt; b</code> for some types <code>a</code>, <code>b</code>.</p>\n\n<p>The argument we're applying the function to is <code>f</code>, so its type has to be <code>a</code>: <code>f :: a</code> (i.e. we have <code>(f :: a -&gt; b) (f :: a)</code>).</p>\n\n<p>Because both of these are the same <code>f</code>, we get <code>a -&gt; b = a</code>. If <code>a</code> is the same as <code>a -&gt; b</code>, then we can substitute <code>a</code> in and <code>a -&gt; b</code> is the same as <code>(a -&gt; b) -&gt; b</code>, which is the same as <code>((a -&gt; b) -&gt; b) -&gt; b</code>, etc.</p>\n\n<p>This expansion never finishes and that's why ghc complains about <code>f</code> having an \"infinite type\".</p>\n"}, {"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487605552, "post_id": 42322716, "comment_id": 71848654, "body": "Why after <code>(a -&gt; a) -&gt; (a -&gt; a)</code> apply <code>f </code> still continue <code>((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a))</code>?"}, {"owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487631595, "post_id": 42322716, "comment_id": 71862147, "body": "@zero_coding Good point, I missed an important aspect. The Answer is because in the function <code>applyTwice</code> the <code>f</code> is fixed to the type <code>a -&gt; a</code> BUT with <code>a</code> being whatever <code>x</code> is, therefore the type inference ends up building an infinite type. I will improve my answer, please give feedback."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1487665505, "post_id": 42322716, "comment_id": 71874292, "body": "What I really do not understand is, <code>f f</code> is going to apply them self in <code>applyTwice</code> function only twice, after applying this is for me <code>(a -&gt; a) -&gt; (a -&gt; a)</code> clear. How it comes to <code>((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a))</code> because <code>x = a</code>?"}, {"owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1487716491, "post_id": 42322716, "comment_id": 71907834, "body": "@zero_coding almost, It is like this: if <code>f :: a -&gt; a</code> then the expression <code>f f</code> forces the type inference to match <code>a</code>  with <code>a -&gt; a</code>, since the <i>second</i> <code>f</code> in <code>f f</code> of course also has type <code>a -&gt; a</code>, now replace every <code>a</code> with <code>a-&gt;a</code> until infinity and you get, that <code>a -&gt; a</code> would have to also match <code>(a -&gt; a) -&gt; (a -&gt; a)</code>   and <code>((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a))</code> and <code>(((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a)))</code> ... etc"}], "tags": [], "owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "is_accepted": false, "score": 2, "last_activity_date": 1487637666, "last_edit_date": 1487637666, "creation_date": 1487468311, "answer_id": 42322716, "question_id": 42321521, "link": "https://stackoverflow.com/questions/42321521/compiler-error-by-function-application/42322716#42322716", "title": "compiler error by function application", "body": "<blockquote>\n  <p>why (f f) x it is wrong?</p>\n</blockquote>\n\n<p>Good question, I don't think it is <em>completely</em> wrong, I will try to rescue it, later!</p>\n\n<p>But, I like to explain some basic concepts first.</p>\n\n<p>I understand that the task is, to create a function <code>applyTwice</code> that applies any function given to it to the second parameter and then again to the result, right?</p>\n\n<p>If you actually think about the concrete examples of functions given to <code>applyTwice</code> you might notice, that <strong>not all functions can be applied twice</strong>, for example, a function that converts a <code>Bool</code> to a <code>String</code>:</p>\n\n<pre><code>boolToString :: Bool -&gt; String\nboolToString True = \"yes!!1eleven\"\nboolToString False = \"ohnoes\"\n</code></pre>\n\n<p>Can only be applied <strong>exactly once</strong>: After <code>boolToString</code> was applied to a <code>Bool</code>, we get a <code>String</code>, and we cannot apply <code>boolToString</code> again to its' result, since it does not accept a <code>String</code> as input.</p>\n\n<p>What have the types of all those functions in common, that we can <code>applyTwice</code>?</p>\n\n<p>Easy: The <strong>input</strong> has the <strong>same type</strong> as the <strong>output</strong>.</p>\n\n<p>Examples for such functions:</p>\n\n<pre><code>increment :: Int -&gt; Int\nincrement x = x + 1\n\nappendDot :: String -&gt; String\nappendDot str = str ++ \".\"\n</code></pre>\n\n<p>BTW: functions type signatures are written with an arrow <code>-&gt;</code> like <code>input -&gt; output</code> in Haskell.</p>\n\n<p>Also, we can not only use <strong>concrete types</strong> like <code>String</code> or <code>Int</code> in type signatures, but also <strong>type variables</strong>.</p>\n\n<p>Type variables always <strong>start</strong> with a <strong>small letter</strong> and concrete types with a capital letter.</p>\n\n<p>A single type variable stands for an arbitrary type, and in the scope where it is used it can only stand for that one, selected type, no matter which one.</p>\n\n<p>Now the concrete function types <code>String -&gt; String</code> or <code>Int -&gt; Int</code> match the general type:</p>\n\n<pre><code> a -&gt; a\n</code></pre>\n\n<p>This matches <strong>all functions with the same input as ouput</strong>.</p>\n\n<p>And now we can get closer to the type of the <code>applyTwice</code> function:</p>\n\n<pre><code> applyTwice :: (a -&gt; a) -&gt; a -&gt; a \n applyTwice    f           x  = f (f a)\n</code></pre>\n\n<p>The first part in brackets <code>(a -&gt; a)</code> is actually the type of the function <code>f</code>, that is applied twice. </p>\n\n<p>I hope you realize how <em>abstract</em> this <code>applyTwice</code> function really is:</p>\n\n<p>It can work with <strong>all</strong> functions that have a <strong>type matching <code>a -&gt; a</code></strong>, i.e. <em>functions, where the input and output types are the same</em></p>\n\n<p>So we can give <code>increment</code> as well as <code>addDot</code> to <code>applyTwice</code>.</p>\n\n<p>For example, let's create a new function <code>incTwice</code> that increments some number twice.</p>\n\n<p>And of course we want to use our new tool <code>applyTwice</code> to built upon <code>increment</code> for this - in general one nice thing about Haskell is how elegantly we can re-combine and re-use small functions, like they were Lego-pieces:</p>\n\n<pre><code> incTwice :: Int -&gt; Int\n incTwice = applyTwice increment\n</code></pre>\n\n<p>Some interesting side points:</p>\n\n<ol>\n<li>Notice, the type signature of <code>incTwice</code>: <code>Int -&gt; Int</code>.</li>\n</ol>\n\n<p>When <code>applyTwice</code> is applied to <code>increment</code> Haskell matchs the type <code>a</code> with <code>Int</code>.</p>\n\n<p>So in that situation, in <code>incTwice</code> Haskell treats <code>applyTwice</code> like it has the concrete type <code>(Int -&gt; Int) -&gt; Int -&gt; Int</code> .</p>\n\n<ol start=\"2\">\n<li>Also notice that the type of <code>incTwice</code> is <code>Int -&gt; Int</code>, which this means, that we can also apply <code>applyTwice</code> to it, to get back a function that adds four to a number, and that this function would also have the type <code>Int -&gt; Int</code>, which we could infinitely often <code>applyTwice</code> with.</li>\n</ol>\n\n<p>This is not only true for this example, notice how in general every function in Haskell that can be <code>applyTwice</code>-ed can be applied infinitely often!</p>\n\n<h2>Let's look at some Haskell syntax!</h2>\n\n<p>I will try to shortly describe some more Haskell syntax.</p>\n\n<p>Parentheses in Haskell define the composition of sub-expression to expressions or - another way to look at it - the decomposition of  expressions into sub-expressions.</p>\n\n<p>Examples:</p>\n\n<pre><code>    ((1 - 1) * 10)      \n    &gt;&gt;&gt; 0\n</code></pre>\n\n<p>is an expression composed of the sub expression <code>*</code> applied to the sub-expression <code>(1 - 1)</code> and the sub-expression <code>10</code>, and <code>(1 - 1)</code> is also composed of the sub-expression <code>-</code> appplied to the sub-expressions <code>1</code> and <code>1</code>.</p>\n\n<p>This could be written as a tree:</p>\n\n<p>((1 - 1) * 10):</p>\n\n<pre><code>         (*)\n        /   \\\n       /     \\\n     (-)     10\n    /   \\\n   /     \\\n  1      1\n</code></pre>\n\n<p>which be the way is totally different to</p>\n\n<pre><code>    (1 - (1 * 10))\n    &gt;&gt;&gt; -9\n</code></pre>\n\n<p>which has the tree:</p>\n\n<pre><code>         (-)\n        /   \\\n       /     \\\n      1      (*)\n            /   \\\n           /     \\\n          1      10\n</code></pre>\n\n<p>Parentheses are also used in type definitions, to describe <em>function</em> types.\nIf no parentheses are given, the type <code>a -&gt; b -&gt; c -&gt; d</code> would implicitly correspond to <code>a -&gt; (b -&gt; (c -&gt; d))</code>, i.e. <code>-&gt;</code> is <strong>right associative</strong>,\nwhich is the reason, that we have to use extra parentheses to indicate a function parameter! </p>\n\n<p>Example function types:</p>\n\n<ul>\n<li><p><code>(a -&gt; b) -&gt; c -&gt; d</code> is the type of a function that takes a function of \ntype <code>a -&gt; b</code> as parameter and returns a new function of type <code>c -&gt; d</code></p></li>\n<li><p><code>(a -&gt; b) -&gt; (c -&gt; d)</code> is the same as <code>(a -&gt; b) -&gt; c -&gt; d</code> ;)</p></li>\n<li><p><code>(a -&gt; b -&gt; c) -&gt; d</code> is the type of a function that takes a function of type <code>a -&gt; b -&gt; c</code> as parameter and returns a value of type <code>d</code></p></li>\n<li><p><code>a -&gt; (b -&gt; c) -&gt; d</code> is the type of a function that takes a value of type <code>a</code> and then a function of type <code>b -&gt; c</code> as parameter and returns a value of type <code>d</code></p></li>\n<li><p><code>a -&gt; (b -&gt; (c -&gt; d))</code> is the type of a function that takes a value of type <code>a</code> and then returns a new function, that takes a value of type <code>b</code> and returns a new function that takes a value of type <code>c</code> and returns a value of type <code>d</code>. This is the same as <code>a -&gt; b -&gt; c -&gt; d</code>!</p></li>\n</ul>\n\n<p>As you can see, explicit/extra parentheses can always be added and as long as they do not deviate from the implicit grouping, they always preserve the meaning of the expression/type,\nso for example you could add extra parentheses around <code>1 + 1</code> like e.g. <code>((((1 + 1))))</code> or\n<code>((((1)) + ((((1))))))</code>, without altering the meaning.</p>\n\n<p>In general the Haskell2010 report <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-380003.9\" rel=\"nofollow noreferrer\">states</a>: </p>\n\n<blockquote>\n  <p>Translation: <code>(e)</code> is equivalent to <code>e</code>.</p>\n</blockquote>\n\n<p>One aspect that governs the implicit grouping of expressions into sub-expressions is called <strong>associativity</strong>.</p>\n\n<p>The expression:</p>\n\n<pre><code>    1 - 1 - 1 - 1\n</code></pre>\n\n<p>could <em>in theory</em> mean <strong>two</strong> different things, depending on how the implied grouping of the sub expressions is.</p>\n\n<p>If the implicit grouping would be as if parentheses were set like this:</p>\n\n<ol>\n<li><code>((1 - 1) - 1) - 1</code>, the expression had value <code>-2</code>,</li>\n</ol>\n\n<p>on the other hand, if the implied grouping would be is if parentheses were set like this:</p>\n\n<ol start=\"2\">\n<li><code>1 - (1 - (1 - 1))</code>, the expression had value <code>0</code>!</li>\n</ol>\n\n<p>The Haskell standard (called the <em>Haskell2010 Report</em>) mandates that the operator <code>-</code> <strong>prefers to group with the numbers left of it</strong>, so <code>1 - 1 - 1 - 1</code> is interpreted as <code>((1 - 1) - 1) - 1</code>.</p>\n\n<p>Saying exactly this, but using the terminology of the Haskell report: </p>\n\n<p>Operator <code>-</code> is <em>left associative</em>.</p>\n\n<p>For entertaining, have a look at the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-820061\" rel=\"nofollow noreferrer\">corresponding table</a> in the Haskell2010 report.</p>\n\n<p>The Haskell2010 report also contains the definition for the rules of <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-260003.3\" rel=\"nofollow noreferrer\">function application</a>:</p>\n\n<blockquote>\n  <p>Function application is written <code>e1 e2</code>. Application <strong>associates to the left</strong>, \n  so the parentheses may be omitted in <code>(f x) y</code>.</p>\n</blockquote>\n\n<p>Which we will need to understand <code>(f f) x</code> vs. <code>f (f x)</code>.</p>\n\n<p>Now that we have looked up in the Haskell2010 Report, that <strong>function application</strong> is <strong>left associative</strong>, we know that <code>f f x</code> is interpreted as <code>(f f) x</code>.</p>\n\n<p>Also we read that <strong><code>(e)</code> is translated to <code>e</code></strong>.</p>\n\n<p>After thinking a lot, one might see, that from this follows that <code>(f f) x</code> simply means:</p>\n\n<pre><code>**first** apply `f` to `f` and then apply _that_ to `x`. \n</code></pre>\n\n<p>Now, we are ready to ...</p>\n\n<h3>Comparing <code>(f f) x</code> and <code>f (f x)</code> by looking at the sub-expressions</h3>\n\n<p>Let's try to fully understand what <code>(f f) x</code> means, and what the difference to <code>f (f x)</code> is, and that they are <strong>not the same expressions</strong>.</p>\n\n<p>On way to describe the difference between the expression <code>(f f) x</code> and<code>f (f x)</code> is too look at the sub-expressions of these expressions:</p>\n\n<p><code>f (f x)</code> can be written more explicit as this:</p>\n\n<pre><code> let \n     intermediateResult = f x\n     finalResult        = f intermediateResult\n\n in finalResult\n</code></pre>\n\n<p>with an expression tree that looks like:</p>\n\n<pre><code>            finalResult\n                  =\n                apply\n              /       \\\n             /         \\\n            /           \\\n           f       intermediateResult      \n                          =\n                        apply\n                      /       \\\n                     /         \\\n                    f           x\n</code></pre>\n\n<p>Whereas <code>(f f) x</code> means:</p>\n\n<pre><code> let \n     intermediateFunction = f f\n     finalResult          = intermediateFunction x\n\n in finalResult\n</code></pre>\n\n<p>The expression tree would be:</p>\n\n<pre><code>            finalResult\n                  =\n                apply\n              /       \\\n             /         \\\n            /           \\\n intermediateFunction    x\n          =\n        apply\n      /       \\\n     /         \\\n    f           f\n</code></pre>\n\n<p>Clearly, as you can see from the expression trees, these are different expressions.\nOr, one could argue that we cannot find any syntactic transformation (e.g. in the Haskell Report), converts back and forth between these expressions, without changing their meaning.</p>\n\n<h3>Looking at the types</h3>\n\n<p>I also want to demonstrate another approach at reasoning about the differences between <code>f f x</code> and <code>f (f x)</code>.</p>\n\n<p>This approach consists of showing how <code>f f x</code> is an <strong>incorrect</strong> implementation of <code>applyTwice</code> while <code>f (f x)</code> is a <strong>correct</strong> implementation, by showing how <code>f f x</code> contradicts the type signature of <code>applyTwice</code>. </p>\n\n<p>It might be hard to realize at first, but an important observation is that the type signature of <code>applyTwice</code>, i.e. <code>(a -&gt; a) -&gt; a -&gt; a</code> is the <strong>only reasonable type signature</strong> that <code>applyTwice</code> could possibly have. If it were any different, it cound not possibly be a valid signature of our beloved <code>applyTwice</code> function, at least not as we know it, and with the order and number of parameters it takes - obviously (I hope).</p>\n\n<p>So, if we simply show, that <code>f f x</code> has <em>just a different type</em> than <code>f (f x)</code>, we know, that <code>f f x</code> must be an <em>incorrect</em> implementation of <code>applyTwice</code>.</p>\n\n<p>In General: The type checker in Haskell is a powerful tool to check if a program is broken, and\n<strong>sometimes it is even enough to look at the type of a function to learn what it does.</strong></p>\n\n<p>Ok, on with the journey:</p>\n\n<p>Let's try out what happens to the type signature of <code>applyTwice</code> if we would use <code>f f x</code> as function body, inplace of <code>f (f x)</code>.</p>\n\n<p>Not only will the beast have a different type - which would already be enough to show that it is <em>wrong</em> since there is only one correct type signature for <code>applyTwice</code> (I challenge you, to come up with another type signature that is not wrong!) - it will also have an impossible to construct, infinite type!</p>\n\n<p>Ok, remember the type signature for <code>f</code> in <code>applyTwice</code>: <code>(a -&gt; a)</code>,\nagain, this means <code>f</code> has the same input type as output type.</p>\n\n<p>Also the input value <code>x</code> (the second parameter of <code>applyTwice</code>) also has that (input/output-) type.</p>\n\n<p><strong>Now</strong> here comes the problem: If we really use <code>f f x</code>, then the type of <code>f</code> must satisfy these requirements:</p>\n\n<ol>\n<li><p><code>f</code> must match the function type <code>a -&gt; a</code> as specified in the type signature of <code>applyTwice</code></p></li>\n<li><p>In <code>f f</code> <code>f</code> is applied to itself and that means that the <code>a</code> in <code>a -&gt; a</code> must be equal to <code>a -&gt; a</code>, which is impossible!</p></li>\n</ol>\n\n<p>Ok, maybe this is not soo clear, let's look at it from a different angle.</p>\n\n<ol>\n<li><p>Remember that <code>x</code> is bound to the type <code>a</code> by the type signature of <code>applyTwice</code>, which is the input (and ouput-) type of <code>f</code>, </p></li>\n<li><p>The type signatures states that <code>f</code> has type <code>a -&gt; a</code>,</p></li>\n<li><p>Since <code>f f</code> is applied to <code>x</code>, and because the output of <code>applyTwice</code> is just <code>a</code>, the output type of <code>f f</code> must be <code>a -&gt; a</code> and <code>x</code> would need to have to have type <code>a</code></p></li>\n<li><p>but since in <code>f f</code> <code>f</code> is applied to a function <code>a -&gt; a</code>, <code>f</code> would need to have the type <code>(a -&gt; a) -&gt; (a -&gt; a)</code>, and </p></li>\n<li><p>since to is applied to itself, it would then need to have type <code>((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a))</code></p></li>\n<li><p>since to is applied to itself, it would then need to have type <code>(((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a))) -&gt; (((a -&gt; a) -&gt; (a -&gt; a)) -&gt; ((a -&gt; a) -&gt; (a -&gt; a)))</code></p></li>\n<li><p>...and so on till the end of times.</p></li>\n</ol>\n\n<p>This is why the compiler complains about not being able to construct an infinite type.</p>\n\n<pre><code>   badApplyTwice :: ???? \n   badApplyTwice f x = (f f) x -- error cannot construct infinite type!\n</code></pre>\n\n<h2>Outside <code>applyTwice</code>, <code>(f f) x</code> is not wrong, only boring...</h2>\n\n<p>The problem that the compiler creates an infinite type roots in how the compiler tries to <strong>bind</strong> <code>a</code> to a single type, that will used throughout the whole expression, and makes every sub-expression happy.</p>\n\n<p>But is <code>(f f)</code> wrong also outside of <code>applyTwice</code>?</p>\n\n<p>No!</p>\n\n<p>Let's use GHCi and define an <code>f</code> with the type <code>a -&gt; b</code>:</p>\n\n<pre><code> \u03bb&gt; :{\n \u03bb| let f :: a -&gt; b\n \u03bb|     f = undefined\n \u03bb| :}         \n</code></pre>\n\n<p>Please note that multi-line expressions in GHCi are written with enclosed in <code>:{</code> ... <code>:}</code>.</p>\n\n<p>... ok now with <code>:t</code> ghci show the type of any expression:</p>\n\n<pre><code> \u03bb&gt; :t f\n f :: a -&gt; b\n</code></pre>\n\n<p>... the type of <code>f f</code> is <code>b</code>:</p>\n\n<pre><code> \u03bb&gt; :t (f f)\n (f f) :: b\n</code></pre>\n\n<p>So, if we define <code>f</code> like in <code>applyTwice</code> as <code>a -&gt; a</code> then we see that <code>f f</code> has type <code>a -&gt; a</code>:</p>\n\n<pre><code> \u03bb&gt; :{\n \u03bb| let f :: a -&gt; a\n \u03bb|     f = undefined\n \u03bb| :}         \n \u03bb&gt; :t (f f)\n (f f) :: a -&gt; a\n</code></pre>\n\n<p>Why? The type of <code>f x</code> with <code>f :: a -&gt; a</code> is always <code>a</code>, since we always get back the type we put into <code>f</code> (input- and output type are identical), and since <code>f f</code> is actually like <code>f x</code> with <code>x</code> being <code>f</code>, we get the type of <code>f</code> which is <code>a -&gt; a</code>.</p>\n\n<p>So, what is the type of <code>(f f) x</code> then?</p>\n\n<p>Well it is whatever concrete type <code>x</code> is. Let's use ghci again, and look at some examples:</p>\n\n<pre><code>\u03bb&gt; :t (f f) 3\n(f f) 3 :: Num a =&gt; a\n\n\u03bb&gt; :t (f f) True\n(f f) True :: Bool\n\n\u03bb&gt; :t (f f) \"test\"\n(f f) \"test\" :: Data.String.IsString a =&gt; a\n\n\u03bb&gt; :t (f f) Nothing\n(f f) Nothing :: Maybe a\n\n\u03bb&gt; :t (f f) 12.3\n(f f) 12.3 :: Fractional a =&gt; a\n\n\u03bb&gt; :t (f f) 10000\n(f f) 10000 :: Num a =&gt; a\n\n\u03bb&gt; :t (f f) f\n(f f) f :: a -&gt; a\n\n\u03bb&gt; :t f f f f f f f f f f f f\nf f f f f f f f f f f f :: a -&gt; a\n</code></pre>\n\n<p>Ok, now you see that <code>(f f) x</code> does not in general have in infinite type,\nlet's even make this one more example:</p>\n\n<pre><code>\u03bb&gt; let g x = f f x\n\u03bb&gt; :t g\ng :: a -&gt; a\n</code></pre>\n\n<p>Now, <code>f</code> is boring, because it has just two implementations:</p>\n\n<pre><code>f x = undefined\n</code></pre>\n\n<p>-or-</p>\n\n<pre><code>f x = x\n</code></pre>\n\n<p>The <strong>only</strong> terminating implementation of a function with type <code>(a -&gt; a)</code> is the later:</p>\n\n<pre><code>f x = x\n</code></pre>\n\n<p>That is, a function that just returns the parameter as it is, without even looking at it, let alone doing anything to it...</p>\n\n<p>Why? Hard to understand, but try to think about what <code>a -&gt; a</code> promises.</p>\n\n<p>It promises that you can really put <strong>anything</strong> into it now matter what type, and that you are guaranteed to get out a value of the same type.</p>\n\n<p>So all <code>f</code> could do to it's parameter in order to <em>calculate</em> the result, is something that it must be able to do to <strong>every</strong> type!</p>\n\n<p>E.g. if we would say, that <code>f</code> should increment the input, then we could not apply <code>f</code> to a e.g. a <code>Bool</code>, if we wanted <code>f</code> to make <em>upper case</em> the input, we could not apply it to something that is not a <code>String</code>, etc.. </p>\n\n<p>But that we can apply a function with the signature <code>a -&gt; a</code> to <strong>any</strong> type is exactly what is promised by that type signature.</p>\n\n<p>So, <code>f</code> is basically pretty boring, but <strong>the compiler did not complain about infinite types</strong>, when we were playing around with ghci!</p>\n\n<p>Q: Now, why is it a problem in a function like e.g. <code>applyTwiceWrong</code>(see below)? </p>\n\n<p>A: Because the compiler wants to <strong>bind</strong> <code>a</code> to <strong>one</strong> type, that satisfies all occurrences in the type signature, and in the inferred types of the (sub-)epxressions in the function body.</p>\n\n<p>Let's look at the error closely:</p>\n\n<pre><code>\u03bb&gt; :{\n\u03bb| let applyTwiceWrong :: (a -&gt; a) -&gt; a -&gt; a\n\u03bb|     applyTwiceWrong f x = f f x\n\u03bb| :}\n\n&lt;interactive&gt;:229:24: error:\n    \u2022 Couldn't match expected type \u2018a\u2019 with actual type \u2018a -&gt; a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          applyTwice :: forall a. (a -&gt; a) -&gt; a -&gt; a\n        at &lt;interactive&gt;:228:19\n    \u2022 In the first argument of \u2018f\u2019, namely \u2018f\u2019\n      In the expression: f f x\n      In an equation for \u2018applyTwiceWrong\u2019: applyTwiceWrong f x = f f x\n    \u2022 Relevant bindings include\n        x :: a (bound at &lt;interactive&gt;:229:18)\n        f :: a -&gt; a (bound at &lt;interactive&gt;:229:16)\n        applyTwiceWrong :: (a -&gt; a) -&gt; a -&gt; a (bound at &lt;interactive&gt;:229:5)\n</code></pre>\n\n<p>The first bullet point states exactly that: </p>\n\n<blockquote>\n  <p>(...) <code>a</code> is a rigid type variable <strong>bound by the type signature</strong> for: applyTwiceWrong (...)</p>\n</blockquote>\n\n<p>The <strong>only possible way</strong> to write a type signature for <code>applyTwiceWrong</code> involves spooky stuff, i.e. <strong>higher-ranked-types</strong></p>\n\n<p>Higher ranked types can only be used after activating a compiler extension:</p>\n\n<pre><code>\u03bb&gt; :set -XRankNTypes \n</code></pre>\n\n<p>With that we can define a variation of <code>applyTwiceWrong</code>, let's call it <code>applyTwiceBoring</code>, that has the same <em>body</em> but a different type:</p>\n\n<pre><code>\u03bb&gt; :{\n\u03bb| applyTwiceBoring :: (forall b . b -&gt; b) -&gt; a -&gt; a\n\u03bb| applyTwiceBoring f x = (f f) x\n\u03bb| :}\n\u03bb&gt; \n</code></pre>\n\n<p>We now have the <code>a</code> that is used for <code>x</code> and the return type of <code>applyTwiceBoring</code> we introduced a new variable <code>b</code> with <code>forall b . b -&gt; b</code>.</p>\n\n<p><code>b</code> may now <em>vary</em> between sub-expressions of <code>applyTwiceBoring</code>, because in <code>applyTwiceBoring</code> <strong><code>b</code> is free</strong>!</p>\n\n<p>Remeber that the sub expressions for <code>(f f) x</code> are:</p>\n\n<pre><code>            finalResult\n                  =\n                apply\n              /       \\\n             /         \\\n            /           \\\n intermediateFunction    x\n          =\n        apply\n      /       \\\n     /         \\\n    f           f\n</code></pre>\n\n<p>in <code>intermediateFunction</code> the <code>b</code> will be <code>b -&gt; b</code> and in <code>intermediateFunction x</code> the <code>b</code> will have type <code>a -&gt; a</code>.</p>\n\n<p>Now the fact that <strong>the only</strong> terminating function we can pass to <code>applyTwiceBoring</code> is <code>f x = x</code> is - to say it politely - <em>limiting</em>.</p>\n\n<h2>Composition to the rescue!</h2>\n\n<p>Now, is all lost?</p>\n\n<p>No! Your intuition behind <code>(f f) x</code> is quite good! </p>\n\n<p>The idea behind this is: Let's <strong>compose</strong> <code>f</code> with <em>itself</em> and then apply <em>that</em> to <code>x</code>.</p>\n\n<p>Well, in Math and in Haskell <strong>composition</strong> of two functions is done like this: \n         f . g</p>\n\n<p>Which means: apply <code>f</code> to the result of <code>g</code></p>\n\n<p>In Haskell there is operator <code>.</code>, defined simply as:</p>\n\n<pre><code> (f . g) x = f (g x)\n</code></pre>\n\n<p>and <strong>that</strong> we can use to rescue <code>(f f) x</code>, which then becomes:</p>\n\n<pre><code>     (f . f) x\n</code></pre>\n\n<p>So the complete functions is:</p>\n\n<pre><code>    applyTwice f x = (f . f) x\n</code></pre>\n\n<p>And we prove using <em>equational reasoning</em> that this is the same as <code>f (f x)</code>:</p>\n\n<pre><code>    applyTwice f x = (f . f) x       [insert the definition of . ]\n    applyTwice f x = f (f x)         QED\n</code></pre>\n\n<p>Now since Haskell is really awesome, we can write</p>\n\n<pre><code>    applyTwice f x = (f . f) x\n</code></pre>\n\n<p>as </p>\n\n<pre><code>    applyTwice f = f . f \n</code></pre>\n\n<p>I hope this helps, good luck with your journey ;)</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1487637666, "creation_date": 1487457749, "last_edit_date": 1487459760, "question_id": 42321521, "link": "https://stackoverflow.com/questions/42321521/compiler-error-by-function-application", "title": "compiler error by function application", "body": "<p>I am trying to learn haskell and could not configure it out, why following code snippet can not get compiled:</p>\n\n<pre><code>*Uncurry&gt; applyTwice f x = f f x\n\n&lt;interactive&gt;:14:20: error:\n    \u2022 Occurs check: cannot construct the infinite type:\n        t ~ t -&gt; t2 -&gt; t1\n    \u2022 In the first argument of \u2018f\u2019, namely \u2018f\u2019\n      In the expression: f f x\n      In an equation for \u2018applyTwice\u2019: applyTwice f x = f f x\n    \u2022 Relevant bindings include\n        x :: t2 (bound at &lt;interactive&gt;:14:14)\n        f :: t -&gt; t2 -&gt; t1 (bound at &lt;interactive&gt;:14:12)\n        applyTwice :: (t -&gt; t2 -&gt; t1) -&gt; t2 -&gt; t1\n          (bound at &lt;interactive&gt;:14:1)\n</code></pre>\n\n<p>This would be fine:</p>\n\n<pre><code>applyTwice f x = f (f x)\n</code></pre>\n\n<p>In haskell function application is left associative, the first code snippet would be apply like:</p>\n\n<pre><code>(f f) x\n</code></pre>\n\n<p>why <code>(f f) x</code> it is wrong?</p>\n"}, {"tags": ["haskell", "cabal", "ghcjs", "reflex", "ghcjs-dom"], "comments": [{"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 1, "creation_date": 1487464654, "post_id": 42320908, "comment_id": 71797955, "body": "Most people use stack to avoid this kind of error. I haven&#39;t had major version issues since I started using stack. Maybe an option for you?"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1487467137, "post_id": 42320908, "comment_id": 71798482, "body": "what operating system are you using?"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1487470328, "post_id": 42320908, "comment_id": 71799123, "body": "@DaveCompton this is Ubuntu 16.04"}], "answers": [{"comments": [{"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1487539958, "post_id": 42323953, "comment_id": 71818649, "body": "The &#39;reflex-platform/try-reflex&#39; script has become my default haskell work environment, not only for ghcjs but also for ghc.  It&#39;s both simple and reliable."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 5, "last_activity_date": 1487482000, "creation_date": 1487482000, "answer_id": 42323953, "question_id": 42320908, "link": "https://stackoverflow.com/questions/42320908/installing-reflex-dom-likely-to-break-ghcjs/42323953#42323953", "title": "Installing reflex-dom likely to break ghcjs", "body": "<p>The best way that I know of to install reflex and reflex-dom (and ghcjs too) in a consistent way on a linux environment is to follow the <a href=\"https://github.com/reflex-frp/reflex-platform\" rel=\"noreferrer\">setup instructions on the reflex-platform readme</a> .  </p>\n\n<p>The process amounts to cloning the reflex-platform repository and running a script, \"try-reflex\" from inside that repository.  The try-reflex script starts a shell from which you can run ghcjs will full access to reflex/reflex-dom .  This shell environment is independent of what you previously installed on your computer so you don't have to worry about messing up lenses or any other cabal package you already have in place.</p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 42323953, "answer_count": 1, "score": 3, "last_activity_date": 1487493218, "creation_date": 1487453446, "last_edit_date": 1487493218, "question_id": 42320908, "link": "https://stackoverflow.com/questions/42320908/installing-reflex-dom-likely-to-break-ghcjs", "title": "Installing reflex-dom likely to break ghcjs", "body": "<p>I am trying to install <code>reflex</code> and <code>reflex-dom</code> using <code>cabal install</code> I got the following error messages:</p>\n\n<pre><code>$ cabal install reflex-dom\n\n...\n\ncabal: The following packages are likely to be broken by the reinstalls:\nlens-4.15.1\nghcjs-0.2.0\nfree-4.12.4\nkan-extensions-5.0.1\nadjunctions-4.3\nUse --force-reinstalls if you want to install anyway.\n</code></pre>\n\n<p><code>ghcjs</code> on GitHub is at <a href=\"https://github.com/ghcjs/ghcjs/tree/master\" rel=\"nofollow noreferrer\">0.2.0</a> on the \"master\" branch and <a href=\"https://github.com/ghcjs/ghcjs/tree/dedupe\" rel=\"nofollow noreferrer\">0.2.1</a> on a branch called \"dedupe\".  And I am also scared of breaking <code>lens</code>.  <strong>Is there any way to install</strong> <code>reflex</code> <strong>and</strong> <code>reflex-dom</code> <strong>in a consistant way?</strong>  Maybe I need to change the <code>.cabal</code> file</p>\n\n<hr>\n\n<h3>Here is the full response from terminal</h3>\n\n<pre><code>$ cabal install reflex-dom\n\nResolving dependencies...\nIn order, the following would be installed:\nbifunctors-5.3 (latest: 5.4.1) (via: reflex-dom-0.3 these-0.6.2.1 lens-4.13.2.1 free-4.12.4 semigroupoids-5.0.1 profunctors-5.2) (new version)\ndata-default-instances-base-0.1.0.1 (via: data-default-0.5.3) (new package)\ndata-default-0.5.3 (latest: 0.7.1.1) (via: reflex-dom-0.3) (new version)\ndependent-sum-0.3.2.2 (latest: 0.4) (via: reflex-dom-0.3 reflex-0.4.0 dependent-sum-template-0.0.0.5 dependent-map-0.2.4.0) (new package)\ndependent-map-0.2.4.0 (via: reflex-dom-0.3 reflex-0.4.0) (new package)\nexception-transformers-0.4.0.5 (via: reflex-dom-0.3 reflex-0.4.0) (new package)\nhaskell-src-exts-1.17.1 (latest: 1.19.1) (via: reflex-0.4.0 haskell-src-meta-0.6.0.14) (new version)\nhaskell-src-meta-0.6.0.14 (latest: 0.7.0.1) (via: reflex-0.4.0) (new version)\nprofunctors-5.2 (via: these-0.6.2.1 lens-4.13.2.1 adjunctions-4.3 free-4.12.4) (reinstall) (changes: bifunctors-5.4.1 -&gt; 5.3)\nraw-strings-qq-1.1 (via: reflex-dom-0.3) (new package)\nref-tf-0.4.0.1 (via: reflex-dom-0.3 reflex-0.4.0) (new package)\nsemigroupoids-5.0.1 (latest: 5.1) (via: these-0.6.2.1 lens-4.13.2.1 kan-extensions-5.0.1 adjunctions-4.3 free-4.12.4) (new version)\nfree-4.12.4 (via: lens-4.13.2.1 kan-extensions-5.0.1 adjunctions-4.3) (reinstall) (changes: bifunctors-5.4.1 -&gt; 5.3, semigroupoids-5.1 -&gt; 5.0.1)\nadjunctions-4.3 (via: kan-extensions-5.0.1) (reinstall) (changes: semigroupoids-5.1 -&gt; 5.0.1)\nkan-extensions-5.0.1 (via: lens-4.13.2.1) (reinstall) (changes: semigroupoids-5.1 -&gt; 5.0.1)\nlens-4.13.2.1 (latest: 4.15.1) (via: reflex-dom-0.3) (new version)\nth-extras-0.0.0.4 (via: dependent-sum-template-0.0.0.5) (new package)\ndependent-sum-template-0.0.0.5 (via: reflex-dom-0.3) (new package)\nthese-0.6.2.1 (latest: 0.7.3) (via: reflex-dom-0.3 reflex-0.4.0) (new package)\nreflex-0.4.0 (via: reflex-dom-0.3) (new package)\nutf8-string-1.0.1.1 (via: glib-0.13.4.1 cairo-0.13.3.1) (new package)\ncairo-0.13.3.1 (via: webkitgtk3-0.14.2.1 gtk3-0.14.6 pango-0.13.3.1) (new package)\nglib-0.13.4.1 (via: reflex-dom-0.3 webkitgtk3-javascriptcore-0.13.2.0 ghcjs-dom-0.2.4.0 webkitgtk3-0.14.2.1 gtk3-0.14.6 pango-0.13.3.1 gio-0.13.3.1) (new package)\ngio-0.13.3.1 (via: gtk3-0.14.6) (new package)\npango-0.13.3.1 (via: webkitgtk3-0.14.2.1 gtk3-0.14.6) (new package)\ngtk3-0.14.6 (via: reflex-dom-0.3 webkitgtk3-javascriptcore-0.13.2.0 ghcjs-dom-0.2.4.0 webkitgtk3-0.14.2.1) (new package)\nwebkitgtk3-0.14.2.1 (via: reflex-dom-0.3 webkitgtk3-javascriptcore-0.13.2.0 ghcjs-dom-0.2.4.0) (new package)\nghcjs-dom-0.2.4.0 (latest: 0.7.0.4) (via: reflex-dom-0.3) (new package)\nwebkitgtk3-javascriptcore-0.13.2.0 (latest: 0.14.2.1) (via: reflex-dom-0.3) (new package)\nreflex-dom-0.3 (new package)\ncabal: The following packages are likely to be broken by the reinstalls:\nlens-4.15.1\nghcjs-0.2.0\nUse --force-reinstalls if you want to install anyway.\n</code></pre>\n\n<p>and similar for installing reflex </p>\n\n<pre><code>$ cabal install reflex\n\nResolving dependencies...\nIn order, the following would be installed:\nbifunctors-5.3 (latest: 5.4.1) (via: these-0.6.2.1 semigroupoids-5.0.1 profunctors-5.2) (new version)\ndependent-sum-0.3.2.2 (latest: 0.4) (via: reflex-0.4.0 dependent-map-0.2.4.0) (new package)\ndependent-map-0.2.4.0 (via: reflex-0.4.0) (new package)\nexception-transformers-0.4.0.5 (via: reflex-0.4.0) (new package)\nhaskell-src-exts-1.17.1 (latest: 1.19.1) (via: reflex-0.4.0 haskell-src-meta-0.6.0.14) (new version)\nhaskell-src-meta-0.6.0.14 (latest: 0.7.0.1) (via: reflex-0.4.0) (new version)\nprofunctors-5.2 (via: these-0.6.2.1) (reinstall) (changes: bifunctors-5.4.1 -&gt; 5.3)\nref-tf-0.4.0.1 (via: reflex-0.4.0) (new package)\nsemigroupoids-5.0.1 (latest: 5.1) (via: these-0.6.2.1) (new version)\nthese-0.6.2.1 (latest: 0.7.3) (via: reflex-0.4.0) (new package)\nreflex-0.4.0 (new package)\ncabal: The following packages are likely to be broken by the reinstalls:\nlens-4.15.1\nghcjs-0.2.0\nfree-4.12.4\nkan-extensions-5.0.1\nadjunctions-4.3\nUse --force-reinstalls if you want to install anyway.\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "owner": {"reputation": 81, "user_id": 7586444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d33f9e15fcfce22ec47935ddeee0e90?s=128&d=identicon&r=PG&f=1", "display_name": "Anabra", "link": "https://stackoverflow.com/users/7586444/anabra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1487798883, "creation_date": 1487452432, "last_edit_date": 1487798883, "question_id": 42320757, "link": "https://stackoverflow.com/questions/42320757/cant-install-cabal-doctest-1-getting-compilation-error", "title": "Can&#39;t install cabal-doctest-1, getting compilation error", "body": "<p>I tried to install cabal-doctest-1, but I got a compilation error like this:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring cabal-doctest-1.0.1...\nBuilding cabal-doctest-1.0.1...\nFailed to install cabal-doctest-1.0.1\nBuild log ( C:\\Users\\Podlovics P\u00e9ter\\AppData\\Roaming\\cabal\\logs\\cabal-doctest-1.0.1.log ):\nBuilding cabal-doctest-1.0.1...\nPreprocessing library cabal-doctest-1.0.1...\n[1 of 1] Compiling Distribution.Extra.Doctest ( src\\Distribution\\Extra\\Doctest.hs, dist\\build\\Distribution\\Extra\\Doctest.o )\n\nsrc\\Distribution\\Extra\\Doctest.hs:174:70: error:\n    * Could not deduce (Data.String.IsString\n                          Distribution.Types.UnqualComponentName.UnqualComponentName)\n        arising from a use of `fromString'\n      from the context: GHC.Stack.Types.HasCallStack\n        bound by a type expected by the context:\n                   GHC.Stack.Types.HasCallStack =&gt;\n                   Library -&gt; ComponentLocalBuildInfo -&gt; IO ()\n        at src\\Distribution\\Extra\\Doctest.hs:(147,3)-(197,9)\n      or from: GHC.Stack.Types.HasCallStack\n        bound by a type expected by the context:\n                   GHC.Stack.Types.HasCallStack =&gt;\n                   TestSuite -&gt; ComponentLocalBuildInfo -&gt; IO ()\n        at src\\Distribution\\Extra\\Doctest.hs:(174,5)-(197,9)\n    * In the second argument of `(==)', namely\n        `fromString testSuiteName'\n      In the first argument of `when', namely\n        `(testName suite == fromString testSuiteName)'\n      In the expression:\n        when (testName suite == fromString testSuiteName)\ncabal: Leaving directory '.'\ncabal: Error: some packages failed to install:\ncabal-doctest-1.0.1 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I tried hard-coding FlexibleContexts into the .hs file, but it didn't help. I have Cabal 1.24.</p>\n\n<p>EDIT:</p>\n\n<p>I updated to GHC 8.0.2, installed cabal-doctest-1, but the lnker doesn't seem to find it. Also I can't import DocTest into any module (you can find the searched locations below). Here's the linker error:</p>\n\n<pre><code>C:\\cabal\\cabal-master&gt;cabal install distributive-0.5.2\nResolving dependencies...\nConfiguring distributive-0.5.2...\nFailed to install distributive-0.5.2\nBuild log ( C:\\Users\\Podlovics P\u00e9ter\\AppData\\Roaming\\cabal\\logs\\distributive-0.5.2.log ):\ncabal: Entering directory 'C:\\Users\\PODLOV~1\\AppData\\Local\\Temp\\cabal-tmp-13372\\distributive-0.5.2'\ncabal: Leaving directory 'C:\\Users\\PODLOV~1\\AppData\\Local\\Temp\\cabal-tmp-13372\\distributive-0.5.2'\ncabal: Error: some packages failed to install:\ndistributive-0.5.2 failed during the configure step. The exception was:\nuser error ('C:\\Program Files\\Haskell Platform\\8.0.2\\bin\\ghc.exe' exited with\nan error:\nC:/Program Files/Haskell Platform/8.0.2/mingw/bin/ld.exe: cannot find\n-lHScabal-doctest-1-3OH6xMXYfakDTTZ99VQuTb\ncollect2.exe: error: ld returned 1 exit status\n`gcc.exe' failed in phase `Linker'. (Exit code: 1)\n)\n</code></pre>\n\n<p>and here's the location list:</p>\n\n<pre><code>Failed to load interface for `DocTest'\nLocations searched:\n  DocTest.hs\n  DocTest.lhs\n  DocTest.hsig\n  DocTest.lhsig\n</code></pre>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "memory", "vector", "lazy-evaluation"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487443772, "post_id": 42319163, "comment_id": 71791711, "body": "Are you linking the source here?"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487444633, "post_id": 42319163, "comment_id": 71792030, "body": "@Michael I&#39;m sorry, I want to, but I&#39;m not allowed to share the source. Is there any extra information I could provide you without sharing the source?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1487445460, "post_id": 42319163, "comment_id": 71792333, "body": "@ThomasVanhelden You could prepare a minimal demonstration of the issue that only involves the <code>ByteString</code>/<code>Vector</code> generation and consumption patterns, rather than your domain-specific code."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487445585, "post_id": 42319163, "comment_id": 71792372, "body": "I&#39;d be looking for lingering references to the lazy bytestring which could prevent it from being garbage collected while data is still being read. E.g. if you scan the string twice, then laziness won&#39;t help much. It&#39;s hard to tell without looking at the actual code."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487446689, "post_id": 42319163, "comment_id": 71792777, "body": "@duplode I&#39;ve added the <code>ByteString</code> to <code>Vector</code> conversion."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1487448809, "post_id": 42319163, "comment_id": 71793508, "body": "Since you are storing floats, there is no reason at all to use <code>Data.Vector</code> which is a pretty delicate type, since it just holds pointers to Haskell values, which may be thunks, rather than just holding the values themselves. There is almost no reason to use <code>Data.Vector</code> when you have a type like <code>Float</code> that can be unboxed."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487499593, "post_id": 42319163, "comment_id": 71804957, "body": "@Michael That&#39;s why I tried using <code>Data.Vector.Unboxed</code> but the result is still weird and I can&#39;t explain it."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487515725, "post_id": 42319163, "comment_id": 71809836, "body": "If you are building an intermediate vector of any sort, along the lines of <code>toVector</code>, then the fact that you are using lazy bytestring will be basically irrelevant, since the vector is a comparably sized structure and you are simply not streaming and lazy bytestring was not really helping."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487515809, "post_id": 42319163, "comment_id": 71809866, "body": "I can&#39;t tell you how radically true it is that this cannot be solved without an exact minimal source, and all ghc hp2hs flags etc. that can reproduce the problem.   Apart from that we are speculating on which of about 17 variables is mattering."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487515884, "post_id": 42319163, "comment_id": 71809903, "body": "@Michael That doesn&#39;t answer why the lazy bytestring requires that much more memory than the strict version. It also doesn&#39;t answer why the strict version seems to be acting lazy. Because it only seems to be loading values into memory as it needs them."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487516118, "post_id": 42319163, "comment_id": 71809986, "body": "@Michael I&#39;ve added a small example that reproduces the behavior in my second edit. I&#39;m generating the report using <code>+RTS -hy</code>, I&#39;m converting to ps using <code>hp2ps -e8in -c</code>, I&#39;m converting to pdf using <code>ps2pdf</code>. My only ghc-options are <code>rtsopts</code> and <code>prof</code>."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487516165, "post_id": 42319163, "comment_id": 71810008, "body": "Yes, it seems so but that is not what is going on, clearly. We need two programs where altering <code>import qualified Data.ByteString as B</code> to <code>import qualified Data.ByteString.Lazy as B</code> makes the change - and the ghc flags"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487516294, "post_id": 42319163, "comment_id": 71810062, "body": "The business is in <code>getSamplesFromFile</code> and perhaps <code>myToFloat</code>. Note that <code>print</code> = <code>putStrLn . show</code>, so apart from nice laziness you are producing a gigantic linked list at the end. It&#39;s probably irrelevant, but what happens if you <code>print . sum</code> instead. Does it work with <code>myToFloat = toIntegral . sum</code>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487517223, "post_id": 42319163, "comment_id": 71810406, "body": "Oh you are not using optimization? -O or -O2"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487517696, "post_id": 42319163, "comment_id": 71810583, "body": "If I run this the four ways, the only noticable difference is boxed/unboxed, this is because instead of storing floats the vector stores pointers, and the pointers point to floats or float-thunks. <a href=\"http://sprunge.us/PeIJ\" rel=\"nofollow noreferrer\">sprunge.us/PeIJ</a>"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487519642, "post_id": 42319163, "comment_id": 71811374, "body": "@Michael Using <code>print . sum</code> makes a huge difference. The memory usage seems to be constant (in <code>+RTS -s</code>) and the <code>+RTS -hy</code> graph is empty (0 bytes x seconds)."}], "answers": [{"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1487448689, "post_id": 42320094, "comment_id": 71793468, "body": "The lazy bytestring will all be in memory, but can it take up so much more space than the corresponding strict bytestring?  I was guessing that there may be an additional problem if the <code>Data.Vector</code> vector is just pointing to a zillion thunks of the form  <code>myToFloat [BS.index bs (3*i), BS.index bs (3*i+1), BS.index bs (3*i+2)]</code>. The size of such things would add up, I think."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487449134, "post_id": 42320094, "comment_id": 71793619, "body": "@Michael AFAICS, it should not take much more memory more than the strict variant. Thunks should be evaluated when you insert them in the <i>unboxed</i> vector (unlike the boxed). Do you really need the bytestring after you built your vector? If you are not using it anymore, it should be possible to make it work in a streaming fashion, consuming only O(1) memory. (The vector will still use O(n), of course)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487455043, "post_id": 42320094, "comment_id": 71795454, "body": "my (totally halfbaked) idea was that the decline in memory use in the second picture was from the successive reduction of the thunks to floats of the things the (boxed) vector was pointing to."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487455782, "post_id": 42320094, "comment_id": 71795637, "body": "@Michael Ah, I missed the part where you said you moved to boxed vectors as well. That will keep those thunks around, yes."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487500010, "post_id": 42320094, "comment_id": 71805058, "body": "If <code>length</code> forces the whole bytestring to be in memory, why is this not the case when I use the strict variant? When I use <code>data.ByteString</code>, the program seems to require memory incrementally. It looks like the behavior I would expect from a lazy implementation. Even though I also use <code>length</code>. But then, when I switch to <code>Data.ByteString.Lazy</code>, I suddenly demands the whole string? So how can you explain this &#39;reversed&#39; behavior?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487500713, "post_id": 42320094, "comment_id": 71805242, "body": "@ThomasVanhelden I was wondering about that as well, but I have no clear idea. I wonder if there&#39;s some optimization which kicks in for strict BS but does not for lazy ones, but that seems weird. Using lazy BS should not increase memory wrt strict too much."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487504239, "post_id": 42320094, "comment_id": 71806210, "body": "@chi For <code>Data.ByteString.Lazy.length</code> seems to force the whole bytestring to be in memory. This is not the case for <code>Data.ByteString.Length</code>. I&#39;ve solved this by the metadata of the file instead of <code>length</code>."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487504352, "post_id": 42320094, "comment_id": 71806236, "body": "@chi The real problem seems to be with my processing of the data. The lazy bytestring gets rid of data it doesn&#39;t need anymore. E.g.: mapping over the vector will only load into memory the chunk of the current value. When the mapping moves to a value in the next chunk, it is loaded into memory and the previous one is dropped. When I then apply another higher-order function to the vector, the dropped data has to be loaded into memory again. I think this is what causes the memory problems."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487504758, "post_id": 42320094, "comment_id": 71806337, "body": "@ThomasVanhelden Strict length does not force the bytestring because a strict bytestring is already completely in memory. A lazy one should not discard data and re-fetch it later. What if it was user input? There&#39;s no way to re-fetch that. A lazy bytestring either keeps data in memory or lets it be garbage collected when no longer needed (provided optimization/fusion did its job)."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487504893, "post_id": 42320094, "comment_id": 71806368, "body": "@chi I don&#39;t think the strict bytestring is already in memory. I request the samples from my file, then use <code>Data.Vector.Unboxed.Slice</code> to request 1000 samples and print them to a file. I see that only approximately the size of 1000 samples ever was in memory during the execution of the program. I may be wrong about the re-fetching, but why does the lazy bytestring require that much more memory then?"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487512782, "post_id": 42320094, "comment_id": 71808739, "body": "@chi Every test I do gets me more confused. I&#39;ve added more information in my question."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1487530360, "post_id": 42320094, "comment_id": 71815277, "body": "Note that the indexing going on inside <code>generate</code> would mean that in the end the whole lazy bytestring would need to be in memory even if you didn&#39;t apply length. <code>bs</code> is referred to repeatedly and it is lazily developed as it is indexed further along, and nothing can be released until <code>generate</code> is done."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1487448900, "last_edit_date": 1487448900, "creation_date": 1487448300, "answer_id": 42320094, "question_id": 42319163, "link": "https://stackoverflow.com/questions/42319163/memory-usage-for-lazy-datatypes/42320094#42320094", "title": "Memory usage for lazy datatypes", "body": "<p>You are using <code>length</code> on a lazy bytestring. That will demand the whole string. If that was the only use of the input lazy bytestring, garbage collection could make it work in constant space. However, you access the string after that for further computation, forcing the whole data to persist in memory.</p>\n\n<p>The solution to this would be avoid <code>length</code> altogether, and trying to fold over the lazy bytestring (just once!) so that streaming can do its job.</p>\n\n<p>You can for instance do something like</p>\n\n<pre><code>myread :: ByteString -&gt; [Float]\nmyread bs = case splitAt 3 bs of\n   ([x1,x2,x3], end) -&gt; myToFloat x1 x2 x3 : myread end\n   -- TODO handle shorter data as well\n\ntoVector bs = U.fromList $ myread bs\n</code></pre>\n\n<p>Probably there's a better way leveraging <code>Vector</code> stuff. <code>U.unfoldr</code> looks promising.</p>\n"}, {"comments": [{"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487519519, "post_id": 42329202, "comment_id": 71811328, "body": "This is totally different from what happens on my system. I&#39;ve ran your code with your compile flags and my results are still the same as those I&#39;ve provided in my question. Just switching from <code>Data.ByteString</code> to <code>Data.ByteString.Lazy</code> in your code, makes it take up a lot more memory (exactly is as in my 2nd edit)."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487519744, "post_id": 42329202, "comment_id": 71811408, "body": "Are you using -O2 which is standard for <code>vector</code> programs? (The whole library is compiled with -O2)"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487519799, "post_id": 42329202, "comment_id": 71811425, "body": "Yes I&#39;m using -O2. In fact, I&#39;m using the same ghc-options as you are."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487520771, "post_id": 42329202, "comment_id": 71811747, "body": "I can get results sort of like yours if I omit optimization, see above"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487521058, "post_id": 42329202, "comment_id": 71811856, "body": "Again, the salient difference is unboxed v. boxed."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487521580, "post_id": 42329202, "comment_id": 71812030, "body": "Adding/removing the optimization doesn&#39;t seem to have any effect on my result. Maybe this has something to do with my machine?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487521596, "post_id": 42329202, "comment_id": 71812036, "body": "I think you can see in the boxed strict case that the red is the unanalyzed thunks the vector is pointing to since they decline as the blue, for Float, increases. Its obscure, for sure."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487521687, "post_id": 42329202, "comment_id": 71812064, "body": "Are you using -fforce-recomp or equivalent between compilations? The compiler might just be saying &#39;I already did that one&#39; when you switch to -O2"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487521892, "post_id": 42329202, "comment_id": 71812131, "body": "No, I don&#39;t. I always make a minor change to the comments in the source to ensure recompilation. Compiling with -fforce-recomp didn&#39;t make a difference."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487522036, "post_id": 42329202, "comment_id": 71812191, "body": "I am using <code>The Glorious Glasgow Haskell Compilation System, version 8.0.1</code> and <code>vector-0.11.0.0</code>"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487522209, "post_id": 42329202, "comment_id": 71812255, "body": "I&#39;m using the same exact versions. This is really weird."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 2, "creation_date": 1487525607, "post_id": 42329202, "comment_id": 71813503, "body": "here&#39;s a hacked together repo <a href=\"https://github.com/michaelt/troubles\" rel=\"nofollow noreferrer\">github.com/michaelt/troubles</a> i made a sandbox with vector then <code>sh all.sh</code> I just left ps files since on os x I can do <code>open noopt&#47;*</code> and view them as pdfs together."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487595583, "post_id": 42329202, "comment_id": 71841663, "body": "I&#39;ve messed around a lot and I cannot reproduce the behavior using your code. It turns out that I can only reproduce the behavior when I&#39;m using a cabal project. I create a new folder and initiate the project using <code>cabal init</code>. If I then paste your code into <code>Main.hs</code> and compile using <code>cabal install</code>, the strange behavior occurs. This even happens when I compile manually inside the <code>cabal</code> project using <code>ghc -O2 -rtsopts -prof</code>. If I manually compile outside of the <code>cabal</code>project, I don&#39;t get the behavior. So it seems to have something to do with <code>cabal</code>."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1487596407, "post_id": 42329202, "comment_id": 71842227, "body": "I&#39;ve added this information to this post: <a href=\"http://stackoverflow.com/questions/42330183/evaluation-of-higher-order-functions\" title=\"evaluation of higher order functions\">stackoverflow.com/questions/42330183/&hellip;</a>"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 3, "last_activity_date": 1487521395, "last_edit_date": 1487521395, "creation_date": 1487518912, "answer_id": 42329202, "question_id": 42319163, "link": "https://stackoverflow.com/questions/42319163/memory-usage-for-lazy-datatypes/42329202#42329202", "title": "Memory usage for lazy datatypes", "body": "<p>The data we have so far are not adequate to reproduce the problem. Here I run four versions of <a href=\"http://sprunge.us/PeIJ\" rel=\"nofollow noreferrer\">http://sprunge.us/PeIJ</a> changing strict to lazy and boxed to unboxed. I am compiling with <code>ghc -O2 -rtsopts -prof</code> The only difference worth remarking on it that each real (pointer) element in the vector or stream in the <code>Data.Vector</code> version is pointing outside itself to a nice boxed Haskell float which takes up a pile of space. Everything is basically the same throughout, except the <code>Data.Vector</code> programs, as expected, have a big heap of blue at the top for these carefully packaged floats.</p>\n\n<p><a href=\"https://i.stack.imgur.com/WMjcY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WMjcY.png\" alt=\"enter image description here\"></a></p>\n\n<p>Edit \nHere is what I get if I just use <code>ghc -prof -rtsopts</code> </p>\n\n<p><a href=\"https://i.stack.imgur.com/KSqRx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KSqRx.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 42329202, "answer_count": 2, "score": 3, "last_activity_date": 1487521395, "creation_date": 1487443124, "last_edit_date": 1487512747, "question_id": 42319163, "link": "https://stackoverflow.com/questions/42319163/memory-usage-for-lazy-datatypes", "title": "Memory usage for lazy datatypes", "body": "<p>I've written a program that analyzes and performs operations on data from a file. My first implementation uses <code>Data.ByteString</code> to read the contents of the file. This contents is then converted to a Vector of samples, using <code>Data.Vector.Unboxed</code>. I then perform the processing and analyzation on this (unboxed) vector of sample values. </p>\n\n<p>Just as an experiment, I wanted to know what would happen if I make use Haskell's laziness. I decided to do this simple test by using <code>Data.ByteString.Lazy</code> instead of <code>Data.ByteString</code> and <code>Data.Vector</code> instead of <code>Data.Vector.Unboxed</code>. I expected to see an improvement in memory usage. Even if my program eventually requires to know the value of every sample, I would still expect memory usage to rise incrementally. When I profiled my program, the results surprised me.</p>\n\n<p>My original version finishes in about 20ms and its memory usage looks like this:\n<a href=\"https://i.stack.imgur.com/DfSz9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DfSz9.png\" alt=\"enter image description here\"></a>\nThis looks like lazy behavior to me. Samples seem to be loaded into memory as they are needed by my program. </p>\n\n<p>Using <code>Data.Vector</code> and <code>Data.ByteString</code> gave the following result:\n<a href=\"https://i.stack.imgur.com/Dgut4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Dgut4.png\" alt=\"enter image description here\"></a>\nThis looks like the opposite of lazy behavior. All the samples seem to be loaded into memory at once and then removed one  by one. </p>\n\n<p>I suspected this had something to do with my misunderstanding of <code>Boxed</code> and <code>Unboxed</code> types, so I tried using <code>Data.ByteString.Lazy</code> with `Data.Vector.Unboxed'. This was the result:\n<a href=\"https://i.stack.imgur.com/psYnZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/psYnZ.png\" alt=\"enter image description here\"></a>\nI have no idea how to explain what I'm seeing here. </p>\n\n<p>Could anyone explain the results I'm getting?</p>\n\n<p><strong>EDIT</strong>\nI'm reading from the file using <code>hGet</code>, this give me a <code>Data.ByteString.Lazy</code>. I convert this ByteString to a <code>Data.Vector</code> of Floats via the following function:</p>\n\n<pre><code>toVector :: ByteString -&gt; Vector Float\ntoVector bs =  U.generate (BS.length bs `div` 3) $ \\i -&gt;\n     myToFloat [BS.index bs (3*i), BS.index bs (3*i+1), BS.index bs (3*i+2)]\n  where\n    myToFloat :: [Word8] -&gt; Float\n    myToFloat words = ...\n</code></pre>\n\n<p>The floats are represented in 3 bytes. </p>\n\n<p>The rest of the processing mostly consists applying higher-order functions (e.g. <code>filter</code>, <code>map</code>, etc.) to the data. </p>\n\n<p><strong>EDIT2</strong>\nMy parser contains a function that reads all the data from a file and returns this data in a vector of samples (using the previous <code>toVector</code> function). I've written two versions of this program, one with <code>Data.ByteString</code> and one with <code>Data.ByteString.Lazy</code>. I've used these two versions to perform a simple test:</p>\n\n<pre><code>main = do\n  [file] &lt;- getArgs\n  samples &lt;- getSamplesFromFile file\n  let slice = V.slice 0 100000 samples\n  let filtered = V.filter (&gt;0) slice\n  print filtered\n</code></pre>\n\n<p>The strict version gives me the following memory usage: \n<a href=\"https://i.stack.imgur.com/ybv4Z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ybv4Z.png\" alt=\"enter image description here\"></a>\nThe lazy version gives me the following memory usage:\n<a href=\"https://i.stack.imgur.com/RNvH8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RNvH8.png\" alt=\"enter image description here\"></a>\nThis result seems to be the complete opposite of what I would be expecting. Could someone explain this? What is wrong with <code>Data.ByteString.Lazy</code>?</p>\n"}, {"tags": ["haskell", "monads", "continuations"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1487441720, "creation_date": 1487441720, "answer_id": 42318896, "question_id": 42317607, "link": "https://stackoverflow.com/questions/42317607/poor-mans-concurrency-understanding-the-monad-instance/42318896#42318896", "title": "Poor mans concurrency, understanding the monad instance?", "body": "<p>It might help to see that a <code>C m a</code> is really just a computation -- over an abstract <code>Action m</code> type -- of an <code>a</code> expressed in continuation passing style <code>(a -&gt; Action m) -&gt; Action m</code>, so the data constructor <code>C</code> and the corresponding record selector <code>apply</code> are just syntactic fluff.  Rewriting without them and without an explicit monad instance, you get the following equivalent code.  (Note that the type <code>Cnt</code> here is <em>just</em> a continuation, not a continuation monad. The continuation monad in <code>Control.Monad.Trans.Cont</code> is more like my <code>CPS</code> type.)</p>\n\n<pre><code>type Cnt m a = (a -&gt; Action m)   -- a continuation, not a Cont monad\ntype CPS m a = Cnt m a -&gt; Action m\nbind :: CPS m a -&gt; (a -&gt; CPS m b) -&gt; CPS m b\ncps_a `bind` a_to_cps_b = \\cont_b -&gt; cps_a (\\a -&gt; a_to_cps_b a cont_b)\n</code></pre>\n\n<p>or the slightly more verbose:</p>\n\n<pre><code>cps_a `bind` a_to_cps_b =\n  \\cont_b -&gt; cps_a (\\a -&gt; let cps_b = a_to_cps_b a in cps_b cont_b)\n</code></pre>\n\n<p>How does this work?  Well, the part in parentheses has a free variable <code>cont_b</code> that's a <code>b</code>-continuation; but, <em>given this continuation</em>, it's just an <code>a</code>-continuation that uses <code>a_to_cps_b</code> to construct a <code>b</code>-computation (in CPS style) which is applied to the free <code>cont_b</code> continuation.  In a nutshell, the part in parentheses is the supplied <code>a_to_cps_b</code> wrapped up in an <code>a</code>-continuation.  To combine it with <code>cps_a</code>, we just apply <code>cps_a</code> to this <code>a</code>-continuation, and that represents the combination of the <code>a</code>-computation represented by <code>cps_a</code> with the map <code>a_to_cps_b</code> that yields a <code>b</code>-computation, all expressed in CPS with a free variable <code>b_cont</code>.  Abstracting over this free variable gives us the <code>CPS m b</code> that we need.</p>\n\n<p>I <em>think</em> that might help make the whole thing easier to understand, and you can now go back to the original definition, recognizing that <code>\\a -&gt; apply (f a) k</code> is really an <code>a</code>-continuation version of <code>f :: a -&gt; C m b</code> expressed in terms of a free variable <code>k</code> representing a <code>b</code>-continuation.  <code>apply m</code> can be used to apply the <code>a</code>-computation <code>m</code> to this <code>a</code>-continuation, and we're left with something that combines the <code>a</code>-computation <code>m</code> with the map <code>f</code> from an <code>a</code> to a <code>b</code>-computation, all expressed in terms of a free <code>b</code>-continuation named <code>k</code>, which we can lambda-abstract to construct the needed <code>b</code>-computation which the bind operator should return. </p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 2, "accepted_answer_id": 42318896, "answer_count": 1, "score": 1, "last_activity_date": 1487441720, "creation_date": 1487434828, "last_edit_date": 1487438527, "question_id": 42317607, "link": "https://stackoverflow.com/questions/42317607/poor-mans-concurrency-understanding-the-monad-instance", "title": "Poor mans concurrency, understanding the monad instance?", "body": "<p>I'm running through <a href=\"http://www.seas.upenn.edu/~cis552/11fa/lectures/concurrency.html\" rel=\"nofollow noreferrer\">this</a> guide to implementing concurrency and I'm having trouble understanding this monad instance:</p>\n\n<pre><code>data Action m = Atom (m (Action m)) | Fork (Action m) (Action m) | Stop\n\nnewtype C m a = C {apply :: (a -&gt; Action m) -&gt; Action m}\n\ninstance Monad (C m ) where\n m &gt;&gt;= f         = C $ \\k -&gt; apply m(\\a -&gt; apply (f a) k) --?\n return x        = C $ \\k -&gt; k x\n</code></pre>\n\n<p>I understand the fundamental uses of continuation monads, but I'm struggling to decipher what's going on in this declaration? </p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1487457419, "last_edit_date": 1487457419, "creation_date": 1487456013, "answer_id": 42321282, "question_id": 42316500, "link": "https://stackoverflow.com/questions/42316500/servant-a-functional-dependency-error-with-enter/42321282#42321282", "title": "servant a functional dependency error with `enter`", "body": "<p>The problem is the presence of the <code>Raw</code> endpoint, which doesn't interact well with <code>enter</code>. This is a <a href=\"https://github.com/haskell-servant/servant/issues/157\" rel=\"nofollow noreferrer\">known annoyance</a> in Servant.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/servant-0.9.1.1/docs/Servant-Utils-Enter.html#t:Enter\" rel=\"nofollow noreferrer\"><code>Enter</code></a> typeclass determines what sets of handlers can be transformed, and with what transformations. It has three instances:</p>\n\n<ul>\n<li><p><code>Enter (m a) ((:~&gt;) m n) (n a)</code> The simplest case. If you have a monadic action and a natural transformation that takes it to a different monad, you can apply the transformation.</p></li>\n<li><p><code>Enter b arg ret =&gt; Enter (a -&gt; b) arg (a -&gt; ret)</code>. If you have a handler that takes a parameter and you know how to transform the final monadic action of the handler, you can transform the handler using the same <code>arg</code> transformation.</p></li>\n<li><p><code>(Enter typ1 arg1 ret1, Enter typ2 arg2 ret2, (~) * arg1 arg2) =&gt; Enter ((:&lt;|&gt;) typ1 typ2) arg1 ((:&lt;|&gt;) ret1 ret2)</code> If you have a composition <code>:&lt;|&gt;</code> of handlers and each handler can be transformed individually using the <em>same</em> natural transformation <code>arg1</code>, then you can transform the composition with <code>arg1</code> as well.</p></li>\n</ul>\n\n<p>This last condition fails in your example, because the handler for <code>Raw</code> has type <code>Application</code>, which is <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code>, while the other handler is a <code>ReaderT Foo (ExceptT ServantErr IO)</code> action. The types don't match, so the composition doesn't have an <code>Enter</code> instance.</p>\n\n<hr>\n\n<p>There is a <a href=\"https://groups.google.com/forum/#!msg/haskell-servant/jhDWkAZixuI/Hkm8CBAuEQAJ\" rel=\"nofollow noreferrer\">workaround</a>: call <code>enter</code> on your custom handlers, and only afterwards compose them with the <code>Application</code> handler.</p>\n\n<pre><code>type WebApi\n  =    \"static\" :&gt; Raw\n  :&lt;|&gt; FooEndpoint\n\ntype FooEndpoint = \"foo\" :&gt; Get '[PlainText] T.Text\n\nreaderServer :: ServerT WebApi (ExceptT ServantErr IO)\nreaderServer = static :&lt;|&gt; enter (readerToHandler \"foobarbaz\") foo\n  where\n    static :: Application\n    static = undefined\n    foo :: ReaderT Foo (ExceptT ServantErr IO) T.Text\n    foo = undefined\n</code></pre>\n"}], "owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 1, "accepted_answer_id": 42321282, "answer_count": 1, "score": 3, "last_activity_date": 1487457419, "creation_date": 1487428532, "question_id": 42316500, "link": "https://stackoverflow.com/questions/42316500/servant-a-functional-dependency-error-with-enter", "title": "servant a functional dependency error with `enter`", "body": "<p>I slightly changed the app shown in the servant tutorial to make <code>Reader</code> monad a <code>ReaderT</code>, like so</p>\n\n<pre><code>{-# LANGUAGE DataKinds                  #-}\n{-# LANGUAGE DeriveGeneric              #-}\n{-# LANGUAGE FlexibleInstances          #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE PolyKinds                  #-}\n{-# LANGUAGE ScopedTypeVariables        #-}\n{-# LANGUAGE TupleSections              #-}\n{-# LANGUAGE TypeOperators              #-}\n\nmodule Lib\n    ( runServer\n    ) where\n\nimport           Control.Monad.Except\nimport           Control.Monad.Reader\nimport qualified Data.Text                as T\nimport           Network.Wai\nimport           Servant\n\ntype WebApi\n  =    \"static\" :&gt; Raw\n  :&lt;|&gt; \"foo\" :&gt; Get '[PlainText] T.Text\n\ntype Foo = String\n\nserver :: ServerT WebApi (ReaderT Foo (ExceptT ServantErr IO))\nserver = static :&lt;|&gt; foo\n  where\n    static :: Application\n    static = undefined\n\n    -- Handler T.Text\n    foo :: ReaderT Foo (ExceptT ServantErr IO) T.Text\n    foo = undefined\n\nwebAPI :: Proxy WebApi\nwebAPI = Proxy\n\nreaderToHandler :: Foo -&gt; ReaderT Foo (ExceptT ServantErr IO) :~&gt; ExceptT ServantErr IO\nreaderToHandler t = Nat (\\x -&gt; runReaderT x t)\n\n-- readerServer :: ServerT WebApi (ExceptT ServantErr IO)\n-- readerServer = enter (readerToHandler \"foobarbaz\") server\n\n-- serve' :: Application\n-- serve' = serve webAPI server\n\nrunServer :: IO ()\nrunServer = return ()\n</code></pre>\n\n<p>The trouble is I can't enable <code>readerServer</code> function, type checking fails with this inscrutable error</p>\n\n<pre><code>src/Lib.hs:45:16: error:\n    \u2022 Couldn't match type \u2018IO\u2019 with \u2018ExceptT ServantErr IO\u2019\n        arising from a functional dependency between:\n          constraint \u2018Servant.Utils.Enter.Enter\n                        (IO ResponseReceived)\n                        (ReaderT Foo (ExceptT ServantErr IO) :~&gt; ExceptT ServantErr IO)\n                        (IO ResponseReceived)\u2019\n            arising from a use of \u2018enter\u2019\n          instance \u2018Servant.Utils.Enter.Enter (m a) (m :~&gt; n) (n a)\u2019\n            at &lt;no location info&gt;\n    \u2022 In the expression: enter (readerToHandler \"foobarbaz\") server\n      In an equation for \u2018readerServer\u2019:\n          readerServer = enter (readerToHandler \"foobarbaz\") server\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Any ideas what's going wrong?</p>\n"}, {"tags": ["haskell", "draw", "gloss"], "answers": [{"comments": [{"owner": {"reputation": 3138, "user_id": 293420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9c3b60c19a6b0d7804413960bd251bd6?s=128&d=identicon&r=PG", "display_name": "lesolorzanov", "link": "https://stackoverflow.com/users/293420/lesolorzanov"}, "edited": false, "score": 0, "creation_date": 1487424628, "post_id": 42315758, "comment_id": 71785098, "body": "Oh, I didnt know you could use the same style, I shall try."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3138, "user_id": 293420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9c3b60c19a6b0d7804413960bd251bd6?s=128&d=identicon&r=PG", "display_name": "lesolorzanov", "link": "https://stackoverflow.com/users/293420/lesolorzanov"}, "edited": false, "score": 1, "creation_date": 1487424744, "post_id": 42315758, "comment_id": 71785141, "body": "@ZloySmiertniy Actually, I&#39;m unsure about the Gloss interface. Maybe this answer is completely off the track. Maybe in Gloss you have to represent your image as a list/tree of shapes."}, {"owner": {"reputation": 3138, "user_id": 293420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9c3b60c19a6b0d7804413960bd251bd6?s=128&d=identicon&r=PG", "display_name": "lesolorzanov", "link": "https://stackoverflow.com/users/293420/lesolorzanov"}, "edited": false, "score": 0, "creation_date": 1487425513, "post_id": 42315758, "comment_id": 71785401, "body": "yes it seems that I have to create a Picture, like in this post <a href=\"http://andrew.gibiansky.com/blog/haskell/haskell-gloss/\" rel=\"nofollow noreferrer\">andrew.gibiansky.com/blog/haskell/haskell-gloss</a> what I couldnt figure out was how to do a board of varaible length sizes and colors.  the style &quot;[ square x y | x&lt;-[0..9], y&lt;-[0..9] ]&quot; is perfect. I am trying it right now"}, {"owner": {"reputation": 3138, "user_id": 293420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9c3b60c19a6b0d7804413960bd251bd6?s=128&d=identicon&r=PG", "display_name": "lesolorzanov", "link": "https://stackoverflow.com/users/293420/lesolorzanov"}, "edited": false, "score": 1, "creation_date": 1487426227, "post_id": 42315758, "comment_id": 71785586, "body": "Got it! I did a Picture like this  squares :: Picture squares = Pictures [ (translate x y $ rectangleSolid 1 1) | x&lt;-[0,2..9], y&lt;-[0,2..9] ]"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1487425382, "last_edit_date": 1487425382, "creation_date": 1487424435, "answer_id": 42315758, "question_id": 42315653, "link": "https://stackoverflow.com/questions/42315653/draw-squares-for-a-game-board-in-haskell/42315758#42315758", "title": "Draw squares for a game board in haskell", "body": "<p>If you work inside the IO monad, you can use the same style. For instance</p>\n\n<pre><code>printSquares :: IO ()\nprintSquares =\n   forM_ [0..9] $ \\x -&gt;\n      forM_ [0..9] $ \\y -&gt; do\n         putStrLn \"Here's a square!\"\n         putStrLn (\"Square(\" ++ show x ++ \", \" ++ show y ++ \")\")\n         -- add here the actual drawing Gloss commands\n</code></pre>\n\n<p>I'm not familiar with Gloss to suggest the actual drawing commands.</p>\n\n<hr>\n\n<p>Update: it seems Gloss has a different interface than using IO as above. You probably need something like</p>\n\n<pre><code>squares :: Picture\nsquares = Pictures [ square x y | x&lt;-[0..9], y&lt;-[0..9] ]\n\nsquare :: Float -&gt; Float -&gt; Picture\nsquare x y = Polygon [(x,y), (x+1,y), (x+1,y+1), (x,y+1) ]\n   -- even better: use rectangleWire and then translate\n   -- rectangleUpperWire also seems useful\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3138, "user_id": 293420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9c3b60c19a6b0d7804413960bd251bd6?s=128&d=identicon&r=PG", "display_name": "lesolorzanov", "link": "https://stackoverflow.com/users/293420/lesolorzanov"}, "edited": false, "score": 0, "creation_date": 1487426298, "post_id": 42315794, "comment_id": 71785602, "body": "I like this style for defining the range and asigning it to the variable.  In gloss it seens that you have to draw a &quot;Picture&quot; to send to the render so it looks like this in the end:  squares :: Picture squares = Pictures [ (translate x y $ rectangleSolid 1 1) | x&lt;-[0,2..9], y&lt;-[0,2..9] ]  Thank you very much."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1487431529, "post_id": 42315794, "comment_id": 71787323, "body": "Nitpick: this needs a <code>sequence_</code> to be applied to the list of <code>IO</code> actions."}], "tags": [], "owner": {"reputation": 69, "user_id": 4654760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42dd657e367f39156936737eb099b02?s=128&d=identicon&r=PG&f=1", "display_name": "SDR", "link": "https://stackoverflow.com/users/4654760/sdr"}, "is_accepted": false, "score": 3, "last_activity_date": 1487435815, "last_edit_date": 1487435815, "creation_date": 1487424613, "answer_id": 42315794, "question_id": 42315653, "link": "https://stackoverflow.com/questions/42315653/draw-squares-for-a-game-board-in-haskell/42315794#42315794", "title": "Draw squares for a game board in haskell", "body": "<p>While I am not familiar with the gloss library, you are probably looking for something like a list comprehension:</p>\n\n<pre><code>drawBoard :: Int -&gt; Int -&gt; IO ()\ndrawBoard w h = sequence_ [drawSquare radius i j | i &lt;- [0 .. w], j &lt;- [0 .. h]]\n</code></pre>\n"}], "owner": {"reputation": 3138, "user_id": 293420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9c3b60c19a6b0d7804413960bd251bd6?s=128&d=identicon&r=PG", "display_name": "lesolorzanov", "link": "https://stackoverflow.com/users/293420/lesolorzanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1230, "favorite_count": 0, "accepted_answer_id": 42315758, "answer_count": 2, "score": 1, "last_activity_date": 1487442773, "creation_date": 1487423843, "last_edit_date": 1487442773, "question_id": 42315653, "link": "https://stackoverflow.com/questions/42315653/draw-squares-for-a-game-board-in-haskell", "title": "Draw squares for a game board in haskell", "body": "<p>I would like to be able to draw something like a chess board using haskell and gloss.</p>\n\n<p>In any other language I could do something like</p>\n\n<pre><code>for( i=0; i &lt; 10; i++){\n   for( j=0; j &lt; 10; j++){\n      drawSquare(radius, i, j)\n    }\n}\n</code></pre>\n\n<p>and that would be it, but I am new to haskell and I have no idea how this can be done. I am using Gloss and I am able to draw things manually, but I want to be able to create them procedurally not 1 by 1 until I draw 100 squares.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1487423105, "creation_date": 1487423105, "answer_id": 42315524, "question_id": 42315070, "link": "https://stackoverflow.com/questions/42315070/no-instance-for-eq-trafficlight-arising-from-a-use-of-elem-possible-fix-add/42315524#42315524", "title": "No instance for (Eq TrafficLight) arising from a use of `elem&#39; Possible fix: add an instance declaration for (Eq TrafficLight)", "body": "<p>You have to provide your own <code>elem</code>. What is <code>elem</code>'s type?</p>\n\n<pre><code>elem :: Eq a =&gt; a -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>However, your traffic light doesn't have an <code>Eq</code> instance. It has a <code>Eq1</code> instance.</p>\n\n<p>You have to write your own <code>elem1</code>:</p>\n\n<pre><code>elem1 :: Eq1 a =&gt; a -&gt; [a] -&gt; Bool\nelem1 y xs = -- exercise\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 2372684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AW7Sa.jpg?s=128&g=1", "display_name": "bling5630", "link": "https://stackoverflow.com/users/2372684/bling5630"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 42315524, "answer_count": 1, "score": 2, "last_activity_date": 1487423105, "creation_date": 1487420596, "question_id": 42315070, "link": "https://stackoverflow.com/questions/42315070/no-instance-for-eq-trafficlight-arising-from-a-use-of-elem-possible-fix-add", "title": "No instance for (Eq TrafficLight) arising from a use of `elem&#39; Possible fix: add an instance declaration for (Eq TrafficLight)", "body": "<p>I have an example from Learn You a Haskell for Great Good named</p>\n\n<pre><code>class Eq1 a where\n   (===), (=/=) :: a -&gt; a -&gt; Bool\n   x === y = not $ x =/= y\n   x =/= y = not $ x === y  \n\ndata TrafficLight = Red | Yellow | Green  \n\ninstance Eq1 TrafficLight where  \n    Red === Red = True  \n    Green === Green = True  \n    Yellow === Yellow = True  \n    _ === _ = False  \n\n\ninstance Show TrafficLight where  \n    show Red = \"Red light\"  \n    show Yellow = \"Yellow light\"  \n    show Green = \"Green light\"  \n\n\nmain = do\n    print $ Red === Red\n    print $ Red === Yellow \n    print $ [Red, Yellow, Green] \n    print $ Red `elem` [Red, Yellow, Green]\n</code></pre>\n\n<p>and the first three rows are work, but the last line contains <code>elem</code> doesn't, got an error:</p>\n\n<pre><code> No instance for (Eq TrafficLight) arising from a use of `elem'\n    Possible fix: add an instance declaration for (Eq TrafficLight)\n    In the second argument of `($)', namely\n      `Red `elem` [Red, Yellow, Green]'\n</code></pre>\n\n<p>I look for the solution how can I add an instance for the marked part, but didn't find hints about the topic, I am new in Haskell so thanks in advance</p>\n\n<p>Tamas</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487414344, "post_id": 42313800, "comment_id": 71781986, "body": "What would that use for the &quot;empty&quot; case? You have to pass it somehow, either by an explicit parameter or a typeclass dictionary."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487417152, "post_id": 42313800, "comment_id": 71782816, "body": "the empty cases are only there to &quot;fill&quot; the either."}], "answers": [{"tags": [], "owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "is_accepted": true, "score": 3, "last_activity_date": 1487414437, "creation_date": 1487414437, "answer_id": 42314047, "question_id": 42313800, "link": "https://stackoverflow.com/questions/42313800/extract-from-except/42314047#42314047", "title": "Extract from Except", "body": "<p>You could declare a class that provides the defaults</p>\n\n<pre><code>-- Note: consider using Data.Default instead of creating your own class.\nclass Default a where\n    def :: a\n\ninstance Default Foo where\n    def = Foo 0\n\ninstance Default Bar where\n    def = Bar 0 'N'\n\nextract :: Default a =&gt; Except String a -&gt; a\nextract ex = either (const def) id (runExcept ex)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1487417403, "post_id": 42314484, "comment_id": 71782880, "body": "Thank you, it is very interesting. At the moment the types are not meant to be &quot;summed&quot; (maybe in the future) but I really like the idea."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1487419602, "last_edit_date": 1487419602, "creation_date": 1487416978, "answer_id": 42314484, "question_id": 42313800, "link": "https://stackoverflow.com/questions/42313800/extract-from-except/42314484#42314484", "title": "Extract from Except", "body": "<p>Since <code>Except e</code> is an instance of <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Foldable.html#t:Foldable\" rel=\"nofollow noreferrer\"><code>Foldable</code></a>, you can define <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#t:Monoid\" rel=\"nofollow noreferrer\"><code>Monoid</code></a> instances for your types and use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Foldable.html#v:fold\" rel=\"nofollow noreferrer\"><code>fold :: (Foldable f, Monoid m) =&gt; f m -&gt; m</code></a>.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Data.Monoid\n\nnewtype Foo = Foo { getFoo :: Sum Int } deriving Monoid\n\nextractFoo :: Except e Foo -&gt; Foo\nextractFoo = fold\n</code></pre>\n\n<p>I don't know what your types mean, exactly, so I just gave an example using <code>Sum</code>. The correct semantics for the <code>Monoid</code> instance would be domain-specific (and your types may not even be valid <code>Monoid</code>s). But the idea is that <code>mempty</code> would be your default value; since <code>Except e m</code> contains either zero or one <code>m</code>s, <code>fold</code> will plug in the default value if it's empty.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 42314047, "answer_count": 2, "score": 0, "last_activity_date": 1487419602, "creation_date": 1487412781, "last_edit_date": 1487415091, "question_id": 42313800, "link": "https://stackoverflow.com/questions/42313800/extract-from-except", "title": "Extract from Except", "body": "<p>I have this situation:</p>\n\n<pre><code>import Control.Monad.Except\n\ndata Foo = Foo { i :: Int }\ndata Bar = Bar { i :: Int , v: Char }\n\nemptyFoo = Foo 0\nemptyBar = Bar 0 'N'\n\nextractF :: (Except String Foo) -&gt; Foo\nextractF ex = either (const emptyFoo) id (runExcept ex)\n\nextractB :: (Except String Bar) -&gt; Bar\nextractB ex = either (const emptyBar) id (runExcept ex)\n</code></pre>\n\n<p>Is there a way to generalise the <code>extract</code> functions above in one only like:</p>\n\n<pre><code>myfoo = extract someFooInstanceWrappedInException\nmybar = extract someBarInstanceWrappedInException\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487416696, "post_id": 42313744, "comment_id": 71782684, "body": "<code>autoconf</code> is fully available and has worked on Windows, for a very long time (the fact that the script tells you that it ran and produced an error is proof that your machine can indeed run the script). This is just a bug in the script (if you can call it that - detecting the OS in such a way is and always has been a horrible hack). What provides <code>autoconf</code> on your system (cygwin, msys, native build, possibly even the *nix subsystem (is that available on W8? I don&#39;t actually know))?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1487423391, "post_id": 42313744, "comment_id": 71784708, "body": "The portability table at <a href=\"https://github.com/stepcut/plugins#readme\" rel=\"nofollow noreferrer\">github.com/stepcut/plugins#readme</a> (last update 11 years ago) doesn&#39;t even list Windows. I wouldn&#39;t set my hopes too high to get this working on Windows then\u2026"}], "owner": {"reputation": 711, "user_id": 1023733, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2495649dc156081879843944795860d5?s=128&d=identicon&r=PG", "display_name": "user1023733", "link": "https://stackoverflow.com/users/1023733/user1023733"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487423921, "creation_date": 1487412291, "last_edit_date": 1487423921, "question_id": 42313744, "link": "https://stackoverflow.com/questions/42313744/unable-to-install-don-stewarts-haskell-plugins-library-on-windows-8-using-stack", "title": "Unable to install Don stewart&#39;s Haskell plugins library on Windows 8 using stack 1.1.2 with ghc-7.10.3", "body": "<p>When I attempt to install plugins I get the following error:</p>\n\n<pre><code>&gt;stack haddock plugins    \n    [1 of 1] Compiling Main             ( C:\\Users\\Eric\\AppData\\Local\\Temp\\stack\n3768\\plugins-1.5.5.0\\Setup.lhs, C:\\Users\\Eric\\AppData\\Local\\Temp\\stack3768\\plugi\nns-1.5.5.0\\.stack-work\\dist\\2672c1f3\\setup\\Main.o )\n    Linking C:\\Users\\Eric\\AppData\\Local\\Temp\\stack3768\\plugins-1.5.5.0\\.stack-wo\nrk\\dist\\2672c1f3\\setup\\setup.exe ...\n    Configuring plugins-1.5.5.0...\n    configure: WARNING: unrecognized options: --with-compiler, --with-gcc\n    checking build system type... ./config.guess: unable to guess system type\n\n    This script, last modified 2002-07-23, has failed to recognize\n    the operating system you are using. It is advised that you\n    download the most up to date version of the config scripts from\n\n        ftp://ftp.gnu.org/pub/gnu/config/\n\n    If the version you run (./config.guess) is already up to date, please\n    send the following data and any information you think might be\n    pertinent to &lt;config-patches@gnu.org&gt; in order to provide the needed\n    information to handle your system.\n</code></pre>\n\n<p>Now this error seems to be linux/unix specific but I am running on Windows so I am not sure what to do. Can anyone advise on what to do?</p>\n"}, {"tags": ["list", "haskell", "fold", "currying"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487417025, "post_id": 42313531, "comment_id": 71782783, "body": "try <code>((+1) .) . curry snd</code>"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1487424173, "creation_date": 1487424173, "answer_id": 42315711, "question_id": 42313531, "link": "https://stackoverflow.com/questions/42313531/haskell-calculate-the-length-of-a-list-using-curry-snd/42315711#42315711", "title": "Haskell: Calculate the length of a list using (curry snd)", "body": "<p>Let us lay all our tools in front of us, like a good artisan does:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nsnd   :: (a, b) -&gt; b\n</code></pre>\n\n<p>First, we note that <code>snd</code> and <code>foldr</code> do not really fit well. So let's use <code>curry</code>, just like you did, and add <code>curry snd</code> to our small tool library:</p>\n\n<pre><code>foldr     :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\ncurry snd ::  a -&gt; b -&gt; b\n</code></pre>\n\n<p>This looks <em>very</em> promising. Now we need to add <code>1</code> to the result of <code>curry snd</code>, otherwise we're just writing <code>flip const</code>. Let's start with a lambda:</p>\n\n<pre><code>\\a b -&gt; 1 + curry snd a b\n= \\a b -&gt; ((+1) . curry snd a) b\n</code></pre>\n\n<p>We can now shove of <code>b</code> and end up with</p>\n\n<pre><code>\\a -&gt; (+1) . curry snd a\n= \\a -&gt; (.) (+1) (curry snd a)\n= \\a -&gt; ((.) (+1)) (curry snd a)\n= \\a -&gt; (((.) (+1)) . curry snd) a\n</code></pre>\n\n<p>Now we can eta-reduce <code>a</code> from both sides too and end up with</p>\n\n<pre><code>(((.) (+1)) . curry snd) = ((+1) . ) . curry snd\n</code></pre>\n\n<p>Therefore, your third variant would be </p>\n\n<pre><code>flength'' = foldr (((+1) . ) . curry snd) 0\n</code></pre>\n\n<p>Now, why did you get your error message? You were close with <code>(+1) . curry snd</code>, but the types don't work out:</p>\n\n<pre><code>(+1)      :: Int -&gt; Int\n--            v                    v\n(.)       :: (b -&gt;  c)    -&gt; (a -&gt; b       ) -&gt; a -&gt; c\ncurry snd ::                  t -&gt; (x -&gt; x)\n              ^                     ^\n</code></pre>\n\n<p>But in your case, the <code>b</code>s in <code>(.)</code>'s signature didn't match. One of them was an <code>Int</code>, the other was a function.</p>\n\n<p><strong>TL;DR</strong>: If you want to write <code>f (g x y)</code> point-free, write <code>((f.) . g)</code></p>\n"}], "owner": {"reputation": 188, "user_id": 5406663, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d2fc65d332ca7ec74016b7003e564aa?s=128&d=identicon&r=PG&f=1", "display_name": "C. Rib", "link": "https://stackoverflow.com/users/5406663/c-rib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 42315711, "answer_count": 1, "score": 2, "last_activity_date": 1602287981, "creation_date": 1487410898, "last_edit_date": 1602287981, "question_id": 42313531, "link": "https://stackoverflow.com/questions/42313531/haskell-calculate-the-length-of-a-list-using-curry-snd", "title": "Haskell: Calculate the length of a list using (curry snd)", "body": "<p>I was given an assignment to calculate the length of a list using the <code>foldr</code> Haskell function, so I did these two examples</p>\n\n<pre><code>flength :: [a] -&gt; Int\nflength = foldr (\\ _ n -&gt; n+1) 0\n\nflength' :: [a] -&gt; Int\nflength' l = foldr aux 0 l\n    where\n        aux _ n = n+1\n</code></pre>\n\n<p>Then, as a personal challenge, the professor asked us to use the <code>snd</code> function and yesterday I came up with this:</p>\n\n<pre><code>flength'' :: [a] -&gt; Int\nflength'' = foldr ((+1).(curry snd)) 0\n</code></pre>\n\n<p>What I want to happen is that this function will turn the head of the list <code>h</code> and the accumulator <code>0</code> into the pair <code>(h,0)</code> then return <code>0</code> and after that apply it to the function <code>(+1)</code></p>\n\n<p>I expected this to be done recursively, effectively giving me the length of the list at the end.</p>\n\n<p>Instead, I get this error message:</p>\n\n<pre><code>    [1 of 1] Compiling Main             ( f1.hs, interpreted )\n\nf1.hs:54:24: error:\n    * No instance for (Num (Int -&gt; Int))\n        arising from an operator section\n        (maybe you haven't applied a function to enough arguments?)\n    * In the first argument of `(.)', namely `(+ 1)'\n      In the first argument of `foldr', namely `((+ 1) . (curry snd))'\n      In the expression: foldr ((+ 1) . (curry snd)) 0 xs\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Why is this happening and how can I get this code to work?</p>\n"}, {"tags": ["html", "parsing", "haskell", "hxt"], "comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 1, "creation_date": 1487408400, "post_id": 42313089, "comment_id": 71780332, "body": "Your question is more likely to get answer quickly if you could make <a href=\"http://stackoverflow.com/help/mcve\">MCVE</a>."}, {"owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "reply_to_user": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1487409119, "post_id": 42313089, "comment_id": 71780512, "body": "@wizzup Yeah, you are right. Fixed it :)."}], "owner": {"reputation": 3335, "user_id": 1017211, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/7vlEI.png?s=128&g=1", "display_name": "monnef", "link": "https://stackoverflow.com/users/1017211/monnef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1487486273, "creation_date": 1487407883, "last_edit_date": 1487486273, "question_id": 42313089, "link": "https://stackoverflow.com/questions/42313089/get-combined-text-of-all-elements", "title": "Get combined text of all elements", "body": "<p>Snippet of my attempt (using HXT and HandsomeSoup):</p>\n\n<pre><code>#!/usr/bin/env runhaskell\n\nimport           Text.HandsomeSoup\nimport           Text.XML.HXT.Core\n\nmain = do\n  let html = \"&lt;html&gt;&lt;body&gt;&lt;a href='a'&gt;b&lt;/a&gt;&lt;a href='x'&gt;y&lt;p&gt;z&lt;/p&gt;&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;\"\n  let doc = parseHtml html\n  val &lt;- runX $ doc &gt;&gt;&gt; css \"a\" &gt;&gt;&gt; deepest getText\n  print val\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[\"b\",\"y\",\"z\"]\n</code></pre>\n\n<p>Desired output:</p>\n\n<pre><code>[\"b\",\"yz\"]\n</code></pre>\n\n<p>Essentially I am looking for a similar function like <a href=\"https://api.jquery.com/text/\" rel=\"nofollow noreferrer\"><code>text()</code></a> from jQuery.</p>\n\n<p>Edit2: In jQuery it's literally a one-liner:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const texts = $('a').map((id, e) =&gt; $(e).text()).get();\n</code></pre>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487410462, "post_id": 42312825, "comment_id": 71780860, "body": "It seems like you already have the correct tool at hand - the class constraint on <code>a</code>. You don&#39;t control the <code>Read Int</code> instance, of course, but it seems in your actual use case you do control the definition and instances of the class. Or perhaps I&#39;ve misunderstood what you mean by &#39;optimize&#39;? (aside: I think the solution in the other answer doesn&#39;t work because <code>x :: H a =&gt; T a</code> doesn&#39;t mean &quot;x of type T a in the context H a&quot; but &quot;x of type &#39;H a =&gt; T a&quot;, i.e. the rule would be applied for <code>(Read a =&gt; F a) -&gt; X</code> not <code>Read a =&gt; F a -&gt; X</code> )"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487411629, "post_id": 42312825, "comment_id": 71781212, "body": "I don&#39;t control the <code>Read</code> class, and I can&#39;t make my own <code>Read</code> instance for <code>Int</code> when one already exists. Maybe I&#39;m misunderstanding you."}], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1487413974, "post_id": 42313846, "comment_id": 71781880, "body": "In this case, <code>MyRead</code> has the signature <code>myread :: MyRead a =&gt; String -&gt; a</code>. As mentioned in the question, in need the signature to be <code>myread :: Read a =&gt; String -&gt; a</code> (otherwise it won&#39;t solve the issue in the related question)."}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": false, "score": 0, "last_activity_date": 1487413060, "creation_date": 1487413060, "answer_id": 42313846, "question_id": 42312825, "link": "https://stackoverflow.com/questions/42312825/optimisation-based-on-function-result-type/42313846#42313846", "title": "Optimisation based on function result type", "body": "<p>How about defining a new class with undecidable instances?</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nclass MyRead a where\n  myread :: String -&gt; a\n\ninstance {-# OVERLAPPABLE #-} Read a =&gt; MyRead a where\n  myread = read\n\ninstance MyRead Int where\n  myread = const 0\n\nmain = do\n  print $ (myread \"True\" :: Bool) -- True\n  print $ (myread \"\\\"string\\\"\" :: String) -- \"string\"\n  print $ (myread \"12\" :: Int) -- 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1487415886, "creation_date": 1487415886, "answer_id": 42314314, "question_id": 42312825, "link": "https://stackoverflow.com/questions/42312825/optimisation-based-on-function-result-type/42314314#42314314", "title": "Optimisation based on function result type", "body": "<p>You can do this directly with rewrite rules, in (perhaps) the obvious way, if you recall that the left hand side of a rule is in an <em>expression</em> context, <em>not</em> in a pattern context. In particular, type applications in the left hand side are perfectly valid. </p>\n\n<pre><code>{-# LANGUAGE TypeApplications #-} \n\nmodule A where \n\n{-# INLINE [1] myread  #-}\n{-# RULES \"myread\" forall s . myread @Int s = 0 #-}\n\nmyread :: Read a =&gt; String -&gt; a \nmyread = read \n</code></pre>\n\n<p>Even without type applications, the following is also perfectly valid (but may not be in general, e.g. if the output type was <code>f a</code> and you wanted to 'optimize' only <code>f</code>, you could not have <code>.. = (result :: [ _ ])</code>): </p>\n\n<pre><code>{-# RULES \"myread\" forall s . myread s = (0 :: Int) #-}\n</code></pre>\n\n<p>And as an example use </p>\n\n<pre><code>module B where \n\nimport A \n\nfun :: String -&gt; String -&gt; (Int, Bool) \nfun x y = (myread x, myread y) \n</code></pre>\n\n<p>The proof that the rule fires is always to look at core, of course (irrelevant bits omitted): </p>\n\n<pre><code>fun4 :: Int\nfun4 = I# 0#\n\nfun :: String -&gt; String -&gt; (Int, Bool)\nfun =\n  \\ _ (w1 :: String) -&gt;\n    (fun4,\n     case readEither6 (run fun3 w1) of _ {\n       [] -&gt; fun2;\n       : x ds -&gt;\n         case ds of _ {\n           [] -&gt; x;\n           : ipv ipv1 -&gt; fun1\n         }\n     })\n</code></pre>\n\n<p>Note, this is really a comment and not an answer simply because I'm not sure what exactly the goal is, but the code wouldn't fit a comment. </p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1487415886, "creation_date": 1487405850, "last_edit_date": 1495535387, "question_id": 42312825, "link": "https://stackoverflow.com/questions/42312825/optimisation-based-on-function-result-type", "title": "Optimisation based on function result type", "body": "<p>Below is a perhaps silly example, but I think solving this will solve another problem I have, detailed <a href=\"https://stackoverflow.com/questions/42294423/adding-context-to-rewrite-rules\">in this question</a>.</p>\n\n<p>I want to write a function with this signature:</p>\n\n<pre><code>myread :: (Read a) =&gt; String -&gt; a\n</code></pre>\n\n<p>such that, <code>myread = read</code>, except when <code>a ~ Int</code>, in which case <code>myread _ = 0</code>. </p>\n\n<p>Obviously this function is silly itself, but the point is I want to optimise based on return type. </p>\n\n<p>Rewrite rules, or anything is fine here. For my actual problem, if the solution is a rewrite rule, it doesn't matter if there's cases where it doesn't fire, but I'd like the answer to at least give an example where it does.</p>\n"}, {"tags": ["haskell", "ghci", "intero"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487400389, "post_id": 42311688, "comment_id": 71778461, "body": "Very strange error indeed... can you run <code>ghci --ignore-dot-ghci</code> from a regular terminal and see if it works then, to eliminate the possibility that your configuration (either .ghci and emacs configuration) are causing it? I can&#39;t imagine how it could be the <code>.ghci</code> file, but emacs/intero could certainly be doing very very weird things. (was going to try intero myself, but it doesn&#39;t even install....)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487401703, "post_id": 42311688, "comment_id": 71778788, "body": "If this doesn&#39;t reveal the cause of the error, then you should also try <code>ghci -v4</code> (verbosity) and include the output from that as well."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1487408764, "post_id": 42311688, "comment_id": 71780427, "body": "Smell like <code>corrupted file</code> or file/directory <code>permission</code> problem to me."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1487416062, "post_id": 42311688, "comment_id": 71782495, "body": "Can you show the contents of main?"}, {"owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "edited": false, "score": 0, "creation_date": 1487603220, "post_id": 42311688, "comment_id": 71847001, "body": "I had the same error a few times while running ghc provided by stack outside a stack sandbox."}], "answers": [{"tags": [], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "is_accepted": true, "score": 0, "last_activity_date": 1487543437, "creation_date": 1487543437, "answer_id": 42333706, "question_id": 42311688, "link": "https://stackoverflow.com/questions/42311688/haskell-cant-load-a-file-in-ghci-changeworkingdirectory-does-not-exist/42333706#42333706", "title": "Haskell can&#39;t :load a File in ghci: changeWorkingDirectory: does not exist", "body": "<p>Hmm, I can't provide additional information as to what was happening.  Went to answer comments above after rebooting the next day and everything worked fine.  Strange.  </p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1044, "favorite_count": 0, "accepted_answer_id": 42333706, "answer_count": 1, "score": 2, "last_activity_date": 1487543437, "creation_date": 1487397750, "last_edit_date": 1487398138, "question_id": 42311688, "link": "https://stackoverflow.com/questions/42311688/haskell-cant-load-a-file-in-ghci-changeworkingdirectory-does-not-exist", "title": "Haskell can&#39;t :load a File in ghci: changeWorkingDirectory: does not exist", "body": "<p>I'm in a ghci session trying to load a <code>Main.hs</code> file I've been working on.  It looks like I'm in the right directory in that I can see the file:</p>\n\n<pre><code>ghci    \u03bb&gt; :cd /home/username/codeplace\nghci    \u03bb&gt; :! ls\nlib.hs        Main.hs          \n</code></pre>\n\n<p>But I can't seem to load it:</p>\n\n<pre><code>ghci    \u03bb&gt; :load Main\n*** Exception: code: changeWorkingDirectory: does not exist (No such file or directory)\n</code></pre>\n\n<p>Well that's a weird error.  Same for any <code>:l</code> variation I can think of:</p>\n\n<pre><code>ghci    \u03bb&gt; :l Main\n*** Exception: code: changeWorkingDirectory: does not exist (No such file or directory)\nghci    \u03bb&gt; :l Main.hs\n*** Exception: code: changeWorkingDirectory: does not exist (No such file or directory)\nghci    \u03bb&gt; :l 'Main.hs'\ntarget \u2018'Main.hs'\u2019 is not a module name or a source file\nghci    \u03bb&gt; :l \"Main.hs\"\n*** Exception: code: changeWorkingDirectory: does not exist (No such file or directory)\nghci    \u03bb&gt; :l ./Main.hs\n*** Exception: code: changeWorkingDirectory: does not exist (No such file or directory)\n</code></pre>\n\n<p>According to <a href=\"https://downloads.haskell.org/~ghc/7.8.2/docs/html/users_guide/loading-source-files.html\" rel=\"nofollow noreferrer\">reference docs here</a>, it should just be </p>\n\n<pre><code>:load Main\n</code></pre>\n\n<p>Right?</p>\n\n<p>Some potential sources of weirdness that may help a haskell wizard see the error of my ways:</p>\n\n<ul>\n<li>I'm running my ghci in an emacs session using intero.</li>\n<li>I have a custom prompt in <code>~/.ghc/ghci.conf</code></li>\n</ul>\n\n<p>eg:</p>\n\n<pre><code>  :set prompt \"ghci    \u03bb&gt; \"\n  :set +m\n  :set prompt2 \"ghci     | \"\n</code></pre>\n\n<p>Why can't I load, why am I getting this strange error about changing directories, and how can I fix?</p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487397307, "post_id": 42311450, "comment_id": 71777730, "body": "The proper definition is <code>Alg :: (n -&gt; a) -&gt; ... -&gt; Alg n a</code> - the type <code>exists n . n -&gt; a</code> is isomorphic to <code>a</code> since the only thing you can do with a function is apply it, but you know nothing about the type <code>n</code>, so you can only apply this function to <code>undefined</code>. But it seems like you are aware of this - &quot;so the answer might be lifting inner variable to the signature of data type&quot;.  &quot;However, not like in this example, it cannot be used on the original code&quot; - then it is the original code you should post."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1487411546, "creation_date": 1487411546, "answer_id": 42313628, "question_id": 42311450, "link": "https://stackoverflow.com/questions/42311450/using-fold-interpreter-on-gadt/42313628#42313628", "title": "Using fold-interpreter on GADT", "body": "<p>To ensure the <code>n</code> inside <code>Alg</code> is the right one, you can expose it as a parameter to the <code>Alg</code> type constructor.</p>\n\n<pre><code>data Alg :: * -&gt; * -&gt; * where\n    Alg :: (n -&gt;      a) \n        -&gt; (a -&gt; a -&gt; a) \n        -&gt; Alg n a\n\nfold :: Alg n a -&gt; Expr n -&gt; a\nfold alg@(Alg val _) (Val n) = val n\nfold alg@(Alg _ plus) (Plus n1 n2) = plus (fold alg n1) (fold alg n2)\n</code></pre>\n\n<p>In the <code>Form</code> code, this looks harder. There are a lot of existentially-quantified type variables there. One needs to find a way to expose all of them in the type, so that they can be required to be the same in <code>Form</code> and <code>FormA</code>.</p>\n"}], "owner": {"reputation": 183, "user_id": 4359207, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/076f53042189861ffbc8d7efa00c3825?s=128&d=identicon&r=PG&f=1", "display_name": "Mossid", "link": "https://stackoverflow.com/users/4359207/mossid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487411546, "creation_date": 1487396012, "last_edit_date": 1487398599, "question_id": 42311450, "link": "https://stackoverflow.com/questions/42311450/using-fold-interpreter-on-gadt", "title": "Using fold-interpreter on GADT", "body": "<p>Several weeks ago, I read <a href=\"http://kseo.github.io/posts/2017-01-03-writing-an-interpreter-using-fold.html\" rel=\"nofollow noreferrer\">Writing an interpreter using fold</a>. I tried to apply this method on the project I am working on, but there was a errors because of GADTs. Here is the toy code that generates same problem.</p>\n\n<pre><code>{-# LANGUAGE GADTs, KindSignatures #-} \n\n\ndata Expr :: * -&gt; * where\n    Val  :: n -&gt;                Expr n\n    Plus :: Expr n -&gt; Expr n -&gt; Expr n\n\ndata Alg :: * -&gt; * where\n    Alg :: (n -&gt;      a) \n        -&gt; (a -&gt; a -&gt; a) \n        -&gt; Alg a\n\nfold :: Alg a -&gt; Expr n -&gt; a\nfold alg@(Alg val _) (Val n) = val n\nfold alg@(Alg _ plus) (Plus n1 n2) = plus (fold alg n1) (fold alg n2)\n</code></pre>\n\n<p>Here is the error message.</p>\n\n<pre><code>/home/mossid/Code/Temforai/src/Temforai/Example.hs:16:36: error:\n    \u2022 Couldn't match expected type \u2018n1\u2019 with actual type \u2018n\u2019\n      \u2018n\u2019 is a rigid type variable bound by\n        the type signature for:\n          fold :: forall a n. Alg a -&gt; Expr n -&gt; a\n        at /home/mossid/Code/Temforai/src/Temforai/Example.hs:15:9\n      \u2018n1\u2019 is a rigid type variable bound by\n        a pattern with constructor:\n          Alg :: forall a n. (n -&gt; a) -&gt; (a -&gt; a -&gt; a) -&gt; Alg a,\n        in an equation for \u2018fold\u2019\n        at /home/mossid/Code/Temforai/src/Temforai/Example.hs:16:11\n    \u2022 In the first argument of \u2018val\u2019, namely \u2018n\u2019\n      In the expression: val n\n      In an equation for \u2018fold\u2019: fold alg@(Alg val _) (Val n) = val n\n    \u2022 Relevant bindings include\n        n :: n\n          (bound at /home/mossid/Code/Temforai/src/Temforai/Example.hs:16:27)\n        val :: n1 -&gt; a\n          (bound at /home/mossid/Code/Temforai/src/Temforai/Example.hs:16:15)\n        fold :: Alg a -&gt; Expr n -&gt; a\n          (bound at /home/mossid/Code/Temforai/src/Temforai/Example.hs:16:1)\n</code></pre>\n\n<p>I think the compiler cannot deduce that the <code>n</code> and <code>n1</code> are same types, so the answer might be lifting inner variable to the signature of data type. However, not like in this example, it cannot be used on the original code. The original code is having forall-quantified type variable in <code>Expr</code>, and the type signature must handle specific information.</p>\n\n<p>+ Here is the original code</p>\n\n<pre><code>data Form :: * -&gt; * where\n    Var     :: Form s\n    Prim    :: (Sat s r) =&gt; Pred s -&gt; Marker r          -&gt; Form s\n    Simple  :: (Sat s r) =&gt; Pred s -&gt; Marker r          -&gt; Form s\n    Derived ::              Form r -&gt; Suffix r s        -&gt; Form s\n    Complex :: (Sat s r, Sat t P) =&gt; \n                            Form s -&gt; Infix r -&gt; Form t -&gt; Form s\n\ndata FormA a where\n    FormA :: (Pred s -&gt; Marker t -&gt; a) \n          -&gt; (Pred u -&gt; Marker v -&gt; a)\n          -&gt; (a -&gt; Suffix w x    -&gt; a)\n          -&gt; (a -&gt; y -&gt; a        -&gt; a)\n          -&gt; FormA a\n\nfoldForm :: FormA a -&gt; Form s -&gt; a\nfoldForm alg@(FormA prim _ _ _) (Prim p m) = prim p m\nfoldForm alg@(FormA _ simple _ _) (Simple p m) = simple p m\nfoldForm alg@(FormA _ _ derived _) (Derived f s) = \n    derived (foldForm alg f) s\nfoldForm alg@(FormA _ _ _ complex) (Complex f1 i f2) = \n    complex (foldForm alg f1) i (foldForm alg f2)\n</code></pre>\n"}, {"tags": ["haskell", "reader-monad"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487391845, "post_id": 42310931, "comment_id": 71776728, "body": "Just to make your doubt clearer: why did you think specifically of a tuple?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1487393497, "post_id": 42310931, "comment_id": 71777047, "body": "It sounds like you answer your own question ...?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1487393885, "post_id": 42310931, "comment_id": 71777124, "body": "@JustinL. I suspect there is a more interesting underlying question that the OP didn&#39;t explicitly state -- whether it makes sense to use a pair for the same purposes that we use <code>Reader</code>."}, {"owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1487395402, "post_id": 42310931, "comment_id": 71777376, "body": "@duplode Because according to the Reader definition, we need a &quot;environment&quot; which we can use to generate a &quot;value&quot;. I think a Reader type should contain the information of &quot;environment&quot; and &quot;value&quot;, so the tuple seems perfect.."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487395462, "post_id": 42310931, "comment_id": 71777396, "body": "@hliu That&#39;s what I suspected :) I&#39;m writing an answer addressing that."}, {"owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487395596, "post_id": 42310931, "comment_id": 71777421, "body": "@duplode Yes, I tried and want to constrain the r with class &quot;Monoid&quot; (so I can give a mempty to it when defining the &quot;return&quot;), but it seems really like the &quot;Writer&quot; monad.. Maybe the meaning of Reader is using the &quot;environment&quot; as input to generate a value, but Writer can just generate the &quot;environment&quot; itself using &quot;tell&quot; function. Sorry for my poor english.."}], "answers": [{"tags": [], "owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "is_accepted": false, "score": 3, "last_activity_date": 1487463349, "last_edit_date": 1487463349, "creation_date": 1487395650, "answer_id": 42311412, "question_id": 42310931, "link": "https://stackoverflow.com/questions/42310931/why-to-define-the-constructor-parameter-of-reader-as-a-function/42311412#42311412", "title": "Why to define the constructor parameter of Reader as a function?", "body": "<p>First of all note that your bind function is wrong and would not compile.</p>\n\n<p>If the <code>Reader</code> were defined as you describe with a tuple, there would be problems:</p>\n\n<ol>\n<li><p>The monad laws would be violated, e.g. left identity, which states that:</p>\n\n<pre><code>return a &gt;&gt;= f == f a\n</code></pre></li>\n</ol>\n\n<p>or the right identity:</p>\n\n<pre><code>    m &gt;&gt;= return == m\n</code></pre>\n\n<p>would be broken, depending on the implmentation of <code>&gt;&gt;=</code> because <code>&gt;&gt;=</code> would <em>forget</em> either the first tuple element of the first argument or the second, i.e. if the implmentation would be:</p>\n\n<pre><code>(Reader (mr, mv)) &gt;&gt;= f =\n    let (Reader (fr, fv)) = f mv \n    in Reader (mr, fv) \n</code></pre>\n\n<p>then we would always lose the reader value that comes out of <code>f</code> (aka <code>fr</code>) and otherwise if <code>&gt;&gt;=</code> would be </p>\n\n<pre><code>(Reader (mr, mv)) &gt;&gt;= f =\n    let (Reader (fr, fv)) = f mv \n    in Reader (fr, fv) \n           -- ^^^ tiny difference here ;)\n</code></pre>\n\n<p>we would always lose <code>mr</code>.</p>\n\n<ol start=\"2\">\n<li>A <code>Reader</code> is some action, that may <code>ask</code> for a constant value, which cannot be changed by another monadic action, which is <strong>read-only</strong>.</li>\n</ol>\n\n<p>But when defined with a tuple, we could super-easy overwrite the reader value, e.g. whith this function:</p>\n\n<pre><code>    tell :: x -&gt; BadReader x ()\n    tell x = BadReader (x, ())\n</code></pre>\n\n<p>If a reader is instead defined with a function, this is impossible (try it)</p>\n\n<ol start=\"3\">\n<li>Also, that <em>enviroment</em> is actually not required <strong>before</strong> converting a <code>Reader</code> to a pure value (aka running the Reader), so from this alone it makes sense to use a function instead of a tuple. </li>\n</ol>\n\n<p>When using a tuple, we would have to provide the <code>Reader</code> value even before we actually run an action. </p>\n\n<p>You can see that in your <code>return</code> definition, you even point out the problem, where the <code>r_unknown</code> comes from ...</p>\n\n<p>To get a btter intuition, let's assume a <code>Reader</code> action that returns the <code>Person</code>s with a certain <code>age</code> from the <code>Addressbook</code>:</p>\n\n<pre><code>  data Person = MkPerson {name :: String, age :: Int}\n  type Addressbook = [Person]\n\n  personsWithThisAge :: Int -&gt; Reader Addressbook [Person]\n  personsWithThisAge a = do\n    addressbook &lt;- ask\n    return (filter (\\p -&gt; age p == a) addressbook)\n</code></pre>\n\n<p>This <code>personsWithAge</code> function returns a <code>Reader</code> action and since it only <code>ask</code>s for the <code>Addressbook</code>, it is like a function that accepts an addressbook and gives back a <code>[Person]</code> list,\nso it is natural to define a reader as just that, a function from some input to a result.</p>\n\n<p>We could rewrite this <code>Reader</code> action to be a function of the <code>Addressbook</code> like this:</p>\n\n<pre><code>  personsWithThisAgeFun :: Int -&gt; Addressbook -&gt; [Person]\n  personsWithThisAgeFun a addressbook =\n    filter (\\p -&gt; age p == a) addressbook\n</code></pre>\n\n<p>But why invent <code>Reader</code>??</p>\n\n<p>The real value of <code>Reader</code> shows when combining several functions like e.g. <code>personsWithThisAge</code>, that all depend on (the same) one constant <code>Addressbook</code>.</p>\n\n<p>Using a <code>Reader</code> we don't have to explicitly pass some <code>Addressbook</code> around, individual <code>Reader</code> actions don't even have any way at all to modify the <code>Addressbook</code> - <code>Reader</code> guarantees us, that every action uses <strong>the same, unmodified</strong> <code>Addressbook</code>, and all a <code>Reader</code> action can ever to with the <em>environment</em> is <code>ask</code> for it.</p>\n\n<p>The only way to implement this, with these guarantees is with a function.</p>\n\n<p>Also if you look at the monad instances that are included in the standard library, you will see that <code>(r -&gt;)</code> is a monad; actually it is identical to the <code>Reader</code> monad apart from some technical differences.</p>\n\n<p>Now the structure you describe with the tuple is actually pretty close to a <code>Writer</code> monad, what is <strong>write-only</strong> , but that's out of scope.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1491808787, "last_edit_date": 1491808787, "creation_date": 1487398171, "answer_id": 42311754, "question_id": 42310931, "link": "https://stackoverflow.com/questions/42310931/why-to-define-the-constructor-parameter-of-reader-as-a-function/42311754#42311754", "title": "Why to define the constructor parameter of Reader as a function?", "body": "<p>You didn't mention it in the question, but I guess you thought specifically of using a pair for defining <code>Reader</code> because it also makes sense to think of that as a way of providing a fixed environment. Let's say we have an earlier result in the <code>Reader</code> monad:</p>\n\n<pre><code>return 2 :: Reader Integer Integer\n</code></pre>\n\n<p>We can use this result to do further calculations with the fixed environment (and the <code>Monad</code> methods guarantee it remains fixed throughout the chain of <code>(&gt;&gt;=)</code>):</p>\n\n<pre><code>GHCi&gt; runReader (return 2 &gt;&gt;= \\x -&gt; Reader (\\r -&gt; x + r)) 3\n5\n</code></pre>\n\n<p>(If you substitute the definitions of <code>return</code>, <code>(&gt;&gt;=)</code> and <code>runReader</code> in the expression above and simplify it, you will see exactly how it reduces to <code>2 + 3</code>.)</p>\n\n<p>Now, let's follow your suggestion and define:</p>\n\n<pre><code>newtype Env r a = Env { runEnv :: (r, a) }\n</code></pre>\n\n<p>If we have an environment of type <code>r</code> and a previous result of type <code>a</code>, we can make an <code>Env r a</code> out of them...</p>\n\n<pre><code>Env (3, 2) :: Env Integer Integer\n</code></pre>\n\n<p>... and we can also get a new result from that:</p>\n\n<pre><code>GHCi&gt; (\\(r, x) -&gt; x + r) . runEnv $ Env (3, 2)\n5\n</code></pre>\n\n<p>The question, then, is whether we can capture this pattern through the <code>Monad</code> interface. The answer is no. While there <em>is</em> a <code>Monad</code> instance for pairs, it does something quite different:</p>\n\n<pre><code>newtype Writer r a = Writer { Writer :: (r, a) }\n\ninstance Monoid r =&gt; Monad (Writer r) where\n    return x = (mempty, x)\n    m &gt;&gt;= f = Writer \n        . (\\(r, x) -&gt; (\\(s, y) -&gt; (mappend r s, y)) $ f x)\n        $ runWriter m\n</code></pre>\n\n<p>The <code>Monoid</code> constraint is needed so that we can use <code>mempty</code> (which solves the problem that you noticed of having to create a <code>r_unknown</code> out of nowhere) and <code>mappend</code> (which makes it possible to combine the first elements of the pair in a way that doesn't violate the monad laws). This <code>Monad</code> instance, however, does something very different than what the <code>Reader</code> one does. The first element of the pair isn't fixed (it is subject to change, as we <code>mappend</code> other generated values to it) and we don't use it to compute the second element of the pair (in the definition above, <code>y</code> does not depend neither on <code>r</code> nor on <code>s</code>). <code>Writer</code> is a logger; the <code>r</code> values here are output, not input.</p>\n\n<hr>\n\n<p>There is one way, however, in which your intuition is justified: we can't make a reader-like monad using a pair, but we can make a reader-like <em>co</em>monad. To put it very loosely, <a href=\"https://hackage.haskell.org/package/comonad-5/docs/Control-Comonad.html#t:Comonad\" rel=\"nofollow noreferrer\"><code>Comonad</code></a> is what you get when you turn the <code>Monad</code> interface upside down:</p>\n\n<pre><code>-- This is slightly different than what you'll find in Control.Comonad,\n-- but it boils down to the same thing.\nclass Comonad w where\n    extract :: w a -&gt; a                 -- compare with return\n    (=&gt;&gt;) :: w a -&gt; (w a -&gt; b) -&gt; w b   -- compare with (&gt;&gt;=)\n</code></pre>\n\n<p>We can give the <code>Env</code> we had abandoned a <code>Comonad</code> instance:</p>\n\n<pre><code>newtype Env r a = Env { runEnv :: (r, a) }\n\ninstance Comonad (Env r) where\n    extract (Env (_, x)) = x\n    w@(Env (r, _)) =&gt;&gt; f = Env (r, f w)\n</code></pre>\n\n<p>That allows us to write the <code>2 + 3</code> example from the beginning in terms of <code>(=&gt;&gt;)</code>:</p>\n\n<pre><code>GHCi&gt; runEnv $ Env (3, 2) =&gt;&gt; ((\\(r, x) -&gt; x + r) . runEnv) \n(3,5)\n</code></pre>\n\n<p>One way to see why this works is noting that an <code>a -&gt; Reader r b</code> function (i.e. what you give to <code>Reader</code>'s <code>(&gt;&gt;=)</code>) is essentially the same thing that an <code>Env r a -&gt; b</code> one (i.e. what you give to <code>Env</code>'s <code>(=&gt;&gt;)</code>): </p>\n\n<pre><code>a -&gt; Reader r b\na -&gt; (r -&gt; b)     -- Unwrap the Reader result\nr -&gt; (a -&gt; b)     -- Flip the function\n(r, a) -&gt; b       -- Uncurry the function\nEnv r a -&gt; b      -- Wrap the argument pair\n</code></pre>\n\n<p>As further evidence of that, here is a function that changes one into the other:</p>\n\n<pre><code>GHCi&gt; :t \\f -&gt; \\w -&gt; (\\(r, x) -&gt; runReader (f x) r) $ runEnv w\n\\f -&gt; \\w -&gt; (\\(r, x) -&gt; runReader (f x) r) $ runEnv w\n  :: (t -&gt; Reader r a) -&gt; Env r t -&gt; a\nGHCi&gt; -- Or, equivalently:\nGHCi&gt; :t \\f -&gt; uncurry (flip (runReader . f)) . runEnv\n\\f -&gt; uncurry (flip (runReader . f)) . runEnv\n  :: (a -&gt; Reader r c) -&gt; Env r a -&gt; c\n</code></pre>\n\n<p>To wrap things up, here is a slightly longer example, with <code>Reader</code> and <code>Env</code> versions side-by-side:</p>\n\n<pre><code>GHCi&gt; :{\nGHCi| flip runReader 3 $\nGHCi|     return 2 &gt;&gt;= \\x -&gt;\nGHCi|     Reader (\\r -&gt; x ^ r) &gt;&gt;= \\y -&gt;\nGHCi|     Reader (\\r -&gt; y - r)\nGHCi| :}\n5\nGHCi&gt; :{\nGHCi| extract $\nGHCi|     Env (3, 2) =&gt;&gt; (\\w -&gt;\nGHCi|     (\\(r, x) -&gt; x ^ r) $ runEnv w) =&gt;&gt; (\\z -&gt;\nGHCi|     (\\(r, x) -&gt; x - r) $ runEnv z)\nGHCi| :}\n5\n</code></pre>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 42311754, "answer_count": 2, "score": 4, "last_activity_date": 1491808787, "creation_date": 1487390871, "last_edit_date": 1487464268, "question_id": 42310931, "link": "https://stackoverflow.com/questions/42310931/why-to-define-the-constructor-parameter-of-reader-as-a-function", "title": "Why to define the constructor parameter of Reader as a function?", "body": "<p>When learning the Reader Monad, I find that it is defined as:</p>\n\n<pre><code>newtype Reader r a = Reader { runReader :: r -&gt; a }\n\ninstance Monad (Reader r) where\n  return a = Reader $ \\_ -&gt; a\n  m &gt;&gt;= k  = Reader $ \\r -&gt; runReader (k (runReader m r)) r\n</code></pre>\n\n<p>I want to known why using function as constructor parameter instead of something else such as a tuple:</p>\n\n<pre><code>newtype Reader r a = Reader { runReader :: (r, a) }\n\ninstance Monad (Reader r) where\n  -- Here I cannot get r when defining return function, \n  -- so does that's the reason that must using a function whose input is an \"r\"?\n  return a = Reader (r_unknown, a) \n  m &gt;&gt;= k = Reader (fst $ runReader m) (f (snd $ runReader m))\n</code></pre>\n\n<p>According to the Reader definition, we need a \"environment\" which we can use to generate a \"value\". I think a Reader type should contain the information of \"environment\" and \"value\", so the tuple seems perfect.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1487388624, "post_id": 42310399, "comment_id": 71776187, "body": "I&#39;ve submitted <a href=\"https://phabricator.haskell.org/D3150\" rel=\"nofollow noreferrer\">a PR</a> to include the answer to this question in the GHCI users manual."}], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1487387260, "post_id": 42310625, "comment_id": 71775993, "body": "Ah, so simple. Thank you. Apparently this feature is mentioned by the documentation of <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#ghci-cmd-:cd\" rel=\"nofollow noreferrer\">:cd</a>."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1487387110, "creation_date": 1487387110, "answer_id": 42310625, "question_id": 42310399, "link": "https://stackoverflow.com/questions/42310399/can-ghcis-add-command-accept-a-path-that-is-relative-to-ones-home-directory/42310625#42310625", "title": "Can GHCI&#39;s :add command accept a path that is relative to one&#39;s home directory?", "body": "<p>Use <code>~</code> instead of <code>$HOME</code>.</p>\n\n<pre><code>\u03bb :add ~/Documents/Code/Haskell/Ackermann\n[1 of 1] Compiling Ackermann        ( /Users/rampion/Documents/Code/Haskell/Ackermann.hs, interpreted )\nOk, modules loaded: Ackermann.\n</code></pre>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 42310625, "answer_count": 1, "score": 0, "last_activity_date": 1487387110, "creation_date": 1487384782, "last_edit_date": 1592644375, "question_id": 42310399, "link": "https://stackoverflow.com/questions/42310399/can-ghcis-add-command-accept-a-path-that-is-relative-to-ones-home-directory", "title": "Can GHCI&#39;s :add command accept a path that is relative to one&#39;s home directory?", "body": "<p>This is the GHC manual documentation for <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/ghci.html#ghci-cmd-:add\" rel=\"nofollow noreferrer\"><code>:add</code></a>:</p>\n<blockquote>\n<h3><code>:add[*] \u27e8module\u27e9</code></h3>\n<p>Add \u27e8module\u27e9(s) to the current target set, and perform a reload. Normally pre-compiled code for the module will be loaded if available, or otherwise the module will be compiled to byte-code. Using the * prefix forces the module to be loaded as byte-code.</p>\n</blockquote>\n<p>I can tell from experimentation that <code>\u27e8module\u27e9</code> doesn't actually have to be the name of a module; it can also be a file path. And if it is not an absolute path, it seems to be resolved relative to the current directory from which the REPL was launched.</p>\n<p>Is it possible to refer <code>:add</code> a path that is relative to one's home directory?</p>\n<p>For example, I'd like to include <code>$HOME/.ghci/imports.hs</code> from my global GHCI config. (For the motivation behind this, see <a href=\"https://stackoverflow.com/a/42310341/402884\"><em>Can a GHCI config file use CPP macros?</em></a>)</p>\n<p>I've tried the obvious</p>\n<pre><code>:add $HOME/.ghc/imports.hs\n</code></pre>\n<p>but it doesn't work:</p>\n<pre><code>&lt;no location info&gt;: error: can't find file: $HOME/.ghc/imports.hs\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["arrays", "multithreading", "haskell", "asynchronous", "parallel-processing"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487379120, "post_id": 42309713, "comment_id": 71774415, "body": "Have you read the documentation for <code>unsafePerformIO</code>? Can you show us <code>foo</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487399309, "post_id": 42309713, "comment_id": 71778185, "body": "This question seems to be based on a misunderstanding of the role of <code>IO</code> in the type system. If you have a function <code>A -&gt; IO B</code> which you &#39;know&#39; has no side effects, then you should be able to rewrite it to have type <code>IO (A -&gt; B)</code>. If you cannot do this, then your function really does have side effects. If randomness is your only side effect, then maybe <a href=\"https://hackage.haskell.org/package/MonadRandom-0.5.1/docs/Control-Monad-Random-Class.html#t:MonadInterleave\" rel=\"nofollow noreferrer\">this</a> would be helpful (in particular, docs say &quot;This can be used, for example, to allow random computations to run in parallel&quot;)"}], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 1303381, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/213f2c3732bc0ab80790bc8e4430cd10?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1303381/will"}, "edited": false, "score": 0, "creation_date": 1487410957, "post_id": 42310083, "comment_id": 71781007, "body": "Thanks, I didn&#39;t realise that Data.Array arrays were traversable, as both Data.Vector vectors and Repa arrays are unfortunately not."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 321, "user_id": 1303381, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/213f2c3732bc0ab80790bc8e4430cd10?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1303381/will"}, "edited": false, "score": 0, "creation_date": 1487448221, "post_id": 42310083, "comment_id": 71793312, "body": "@will Data.vector is traversable too - just not the unboxed version"}, {"owner": {"reputation": 321, "user_id": 1303381, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/213f2c3732bc0ab80790bc8e4430cd10?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1303381/will"}, "edited": false, "score": 0, "creation_date": 1487451979, "post_id": 42310083, "comment_id": 71794546, "body": "Oh ok, I didn&#39;t realise.      Do you have any advice to alleviate the issue of (what I presume is) thunk buildup? All the versions using Async seem to use at least 20x the amount of memory, as I explained in the (updated) question."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1559680686, "post_id": 42310083, "comment_id": 99495332, "body": "Using <code>Traversable</code> instance of boxed <code>Array</code>/<code>Vector</code> and <code>mapConcurrently</code> from <code>async</code> package is terribly inefficient approach. First of all array values are boxed (that approach is impossible with unboxed arrays) so for each array cell you have to follow an extra pointer. Another problem is <code>mapConcurrently</code> will create something like 3 threads per array element and that has some significant overhead as well, especially if you consider arrays with millions of elements in them (1000x1000 is not such a big array)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1487381548, "creation_date": 1487381548, "answer_id": 42310083, "question_id": 42309713, "link": "https://stackoverflow.com/questions/42309713/asynchronous-map-of-non-deterministic-function-over-array/42310083#42310083", "title": "Asynchronous map of non-deterministic function over array", "body": "<p>Your first approach is probably what you want, but not with a linked list. Note the type <a href=\"https://hackage.haskell.org/package/async-2.1.1/docs/Control-Concurrent-Async.html#v:mapConcurrently\" rel=\"nofollow noreferrer\"><code>mapConcurrently :: Traversable t =&gt; (a -&gt; IO b) -&gt; t a -&gt; IO (t b)</code></a> allows you to do what amounts to a parallel <code>traverse</code> over <em>anything</em> that is <code>Traversable</code>, including <a href=\"https://hackage.haskell.org/package/array-0.5.1.1/docs/Data-Array.html\" rel=\"nofollow noreferrer\"><code>Array</code></a> (I propose <code>Array</code> over <code>Vector</code> here just because it lends itself better to multiple dimensions).</p>\n\n<pre><code>import Control.Concurrent.Async (mapConcurrently)\nimport Data.Array\n\nindexedArray :: Array (Int,Int) (Int,Int,a)\nindexedArray = ...\n\nmappedArray = mapConcurrently (\\(x,y,a) -&gt; foo x y a) indexedArray\n</code></pre>\n\n<p>Also, note that your previous approach with nested lists only parallelized the <code>traverse</code> of each sublist - it didn't paralellize the whole thing.</p>\n"}, {"comments": [{"owner": {"reputation": 321, "user_id": 1303381, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/213f2c3732bc0ab80790bc8e4430cd10?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1303381/will"}, "edited": false, "score": 0, "creation_date": 1487411956, "post_id": 42310129, "comment_id": 71781333, "body": "Thanks, I&#39;ll give this a go.      I was only doing parallelism row-by-row for convenience, but I don&#39;t mind either way."}, {"owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "reply_to_user": {"reputation": 321, "user_id": 1303381, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/213f2c3732bc0ab80790bc8e4430cd10?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1303381/will"}, "edited": false, "score": 0, "creation_date": 1487462907, "post_id": 42310129, "comment_id": 71797553, "body": "I use a similar approach in an application where I need to use a native C-library; the special feature of <code>Storable</code> is that any vector of <code>Storable</code>s can be used as a C-Array directly, see <a href=\"https://www.stackage.org/haddock/lts-8.0/base-4.9.1.0/Foreign-Storable.html\" rel=\"nofollow noreferrer\">Foreign.Storable</a>."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1559681337, "post_id": 42310129, "comment_id": 99495621, "body": "This approach is sensible, but not optimal. First of all this describes ragged array, where it is a boxed vector of storable vectors (i.e <code>Stoable a =&gt; V.Vector (S.Vector a))</code>, which means the memory layout is not optimal. Secondly using <code>async</code> will not give optimal parallelization either, because a work stealing scheduler with just a handful of threads will perform much better. See my answer for more info."}], "tags": [], "owner": {"reputation": 126, "user_id": 2966438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmTSO.jpg?s=128&g=1", "display_name": "sheyll", "link": "https://stackoverflow.com/users/2966438/sheyll"}, "is_accepted": false, "score": 1, "last_activity_date": 1487463278, "last_edit_date": 1487463278, "creation_date": 1487382052, "answer_id": 42310129, "question_id": 42309713, "link": "https://stackoverflow.com/questions/42309713/asynchronous-map-of-non-deterministic-function-over-array/42310129#42310129", "title": "Asynchronous map of non-deterministic function over array", "body": "<p>To get max performance and a tight memory layout, without any unnessary copying of arrays, I would suggest to use <a href=\"https://www.stackage.org/haddock/lts-8.0/vector-0.11.0.0/Data-Vector-Storable-Mutable.html\" rel=\"nofollow noreferrer\">Data.Vector.Storable.Mutable</a>.</p>\n\n<p>One can <code>thaw</code>/<code>unsafeThaw</code> any immutable vector (e.g. <code>Data.Vector.Storable</code>) to get back a <strong>mutable vector</strong>, which supports the operations defined in <code>Data.Vector.Storable.Mutable</code>, like \n<code>read</code> and <code>write</code>, and which are <em>monadic actions</em> with the <code>PrimMonad</code> constraint, a <code>PrimMonad</code> is a basic monad like <code>IO</code> or <code>ST</code>.</p>\n\n<p>For example, the signature of <code>write</code> is:</p>\n\n<pre><code>(PrimMonad m, Storable a) =&gt; MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m () \n</code></pre>\n\n<p>Just take a look at the <a href=\"https://www.stackage.org/haddock/lts-8.0/vector-0.11.0.0/Data-Vector-Storable.html#g:35\" rel=\"nofollow noreferrer\">documentation for convertion to/from a mutable vector</a>.</p>\n\n<p>Which seems daunting, but it is actually pretty simple: <code>MVector (PrimState m) a</code> is what you get from <code>thaw</code>, <code>m</code> could be <code>ST</code> or <code>IO</code> and <code>PrimState m</code> is the <code>s</code> if <code>m</code> is <code>ST s</code> or <code>ReadWorld</code> if <code>m</code> is <code>IO</code>, the <code>Int</code> parameter is just the element-index and <code>a</code> is the new value.\nThis function returns an action with the sideeffect of inplace/destructively updating the vector at the given position.</p>\n\n<p>When finished mutating a vector, you can <code>freeze</code>/<code>unsafeFreeze</code> it, to get an immutable vector back, \n<code>freeze</code> and <code>unsafeFreeze</code> are the opposite of <code>thaw</code> and <code>unsafeThaw</code>,\ne.g. <code>unsafeFreeze</code> has the type signature:</p>\n\n<pre><code>unsafeFreeze :: (Storable a, PrimMonad m) =&gt; MVector (PrimState m) a -&gt; m (Vector a) \n</code></pre>\n\n<p>As you can see, the function also returns a monadic action with the <code>PrimMonad</code> constraint, see <a href=\"https://www.stackage.org/haddock/lts-8.0/primitive-0.6.1.0/Control-Monad-Primitive.html\" rel=\"nofollow noreferrer\">the documentation of the <code>primitive</code> package</a> for more details.</p>\n\n<p>Now, to achieve your goal, as I understand it, you would <code>unsafeThaw</code> the <em>outter</em> vector and then <code>concurrently</code> (from <code>async</code>) <code>unsafeThaw</code>, <code>read</code>, apply <code>foo</code>, <code>write</code> each element and finally <code>unsafeFreeze</code> each <em>inner</em> vector, and then <code>unsafeFreeze</code> the <em>outter</em> mutable vector.</p>\n\n<p>Please note, that this can also be done with unboxed mutable IO arrays, in a similar manner.</p>\n\n<p>Also note, that I assumed from your question, that the parallelism should be restricted to the outter vector, i.e. all rows should be done in parallel not all elements in all rows.</p>\n"}, {"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 2, "last_activity_date": 1559680742, "creation_date": 1559680742, "answer_id": 56451034, "question_id": 42309713, "link": "https://stackoverflow.com/questions/42309713/asynchronous-map-of-non-deterministic-function-over-array/56451034#56451034", "title": "Asynchronous map of non-deterministic function over array", "body": "<p>A couple years late to the party, but there is a library that can do exactly what you need right out of the box: <a href=\"https://github.com/lehins/massiv\" rel=\"nofollow noreferrer\"><code>massiv</code></a>. There is a function <a href=\"https://github.com/lehins/massiv\" rel=\"nofollow noreferrer\"><code>imapIO</code></a>, which has a type signature (when restricting <code>m</code> to <code>IO</code>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>imapIO :: (Source r' ix a, Mutable r ix b)\n  =&gt; (ix -&gt; a -&gt; IO b) -- ^ Index aware mapping action\n  -&gt; Array r' ix a -- ^ Source array\n  -&gt; IO (Array r ix b)\n</code></pre>\n\n<p>Depending on how the source array was constructed, this <code>imapIO</code> can be automatically parallelized or run sequentially. In the example below, because of usage of <code>Par</code>, <code>randomR</code> will be parallelized:</p>\n\n<pre><code>\u03bb&gt; arr = makeArrayR D Par (Sz (5 :. 11)) $ \\ (i :. j) -&gt; (i, j)\n\u03bb&gt; mapIO randomR arr :: IO (Array P Ix2 Int)\nArray P Par (Sz (5 :. 11))\n  [ [ 0, 1, 2, 0, 4, 4, 1, 7, 2, 8, 9 ]\n  , [ 0, 1, 1, 1, 1, 4, 6, 2, 1, 8, 4 ]\n  , [ 2, 1, 2, 3, 4, 5, 5, 3, 4, 9, 4 ]\n  , [ 2, 2, 2, 3, 4, 5, 6, 7, 3, 8, 8 ]\n  , [ 2, 4, 2, 3, 4, 4, 4, 4, 8, 8, 9 ]\n  ]\n</code></pre>\n\n<p>That being said, this is pretty bad and very slow way of generating array of random numbers. For a few reasons:</p>\n\n<ul>\n<li>using <code>randomR</code> (same thing applies to <code>evalRandIO</code>) essentially uses one global random number generator that is stored in an <code>IORef</code>. This approach is thread safe, but because it is in critical section and multiple threads will be trying to use it at the same time, parallelization is not gonna be as effective.</li>\n<li>It uses <a href=\"https://www.stackage.org/package/random\" rel=\"nofollow noreferrer\"><code>random</code></a> package underneath, which is ridiculously slow, I mean a factor of ~x250 times slower than say <a href=\"https://www.stackage.org/package/splitmix\" rel=\"nofollow noreferrer\"><code>splitmix</code></a>, or any other random library.</li>\n</ul>\n\n<p>There are two better ways of generating random numbers:</p>\n\n<ul>\n<li>In case when generator is pure and splittable, we can deterministically split the initial generator as many times as the number of threads we want to use for generation of a random array and than use those generators independently to generate portions of the array. There is a special function <code>massiv</code> that does just that <a href=\"http://hackage.haskell.org/package/massiv-0.3.3.0/docs/Data-Massiv-Array.html#v:randomArray\" rel=\"nofollow noreferrer\"><code>randomArray</code></a>.\nHere is an example that uses <code>random</code> package:</li>\n</ul>\n\n<pre><code>\u03bb&gt; import Data.Massiv.Array\n\u03bb&gt; import System.Random as System\n\u03bb&gt; gen &lt;- System.newStdGen\n\u03bb&gt; compute $ randomArray gen System.split System.random Par (Sz2 2 3) :: Array P Ix2 Double\nArray P Par (Sz (2 :. 3))\n  [ [ 0.8867416334370383, 0.6217394261977418, 0.4536893479057291 ]\n  , [ 0.6566602646092554, 0.6988432454700997, 0.14116451452794965 ]\n  ]\n</code></pre>\n\n<ul>\n<li>On the other side of spectrum there are stateful, non-splittable generators, such as <code>mwc-random</code>. For those there are separate functions called <a href=\"https://hackage.haskell.org/package/massiv-0.3.4.0/docs/Data-Massiv-Array.html#v:randomArray\" rel=\"nofollow noreferrer\"><code>randomArrayWC</code></a>, and <a href=\"https://hackage.haskell.org/package/massiv-0.3.4.0/docs/Data-Massiv-Array.html#v:imapWS\" rel=\"nofollow noreferrer\"><code>imapWS</code></a> which can also very efficiently generate arrays with random values while using a separate random number generator per thread. See my answer to the SO question: <a href=\"https://stackoverflow.com/questions/11230895/parallel-mapm-on-repa-arrays/56449011#56449011\">Parallel mapM on Repa arrays</a> which was also linked in this question.</li>\n</ul>\n"}], "owner": {"reputation": 321, "user_id": 1303381, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/213f2c3732bc0ab80790bc8e4430cd10?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1303381/will"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1559680742, "creation_date": 1487378246, "last_edit_date": 1495542301, "question_id": 42309713, "link": "https://stackoverflow.com/questions/42309713/asynchronous-map-of-non-deterministic-function-over-array", "title": "Asynchronous map of non-deterministic function over array", "body": "<p>I'm looking for a way to map a function <code>f :: a -&gt; IO(b)</code> over a 2-dimensional array, in parallel, while retaining sensible memory consumption.<br>\nI would also appreciate being able to also supply the array index as an argument of the function, i.e. mapping <code>g :: Int -&gt; Int -&gt; a -&gt; IO(b)</code>, like <code>imap</code> from Data.Vector, or <code>mapWithKey</code> from Data.Map.<br>\nCurrent attempts (see below) either have terrible memory consumption, or throw an error at runtime.</p>\n\n<p>Note that, in actual fact, the type of the function I am interested in is <code>h :: Int -&gt; Int -&gt; a -&gt; Random b</code>, where <code>Random</code> denotes some Random monad from Control.Monad.Random; I move it over to the IO monad using <code>evalRandIO</code>.    </p>\n\n<hr>\n\n<p><strong>Attempted solutions:</strong></p>\n\n<p>Say I want to map the function <code>foo :: Int -&gt; Int -&gt; a -&gt; IO(b)</code> over a 2D array of elements of type <code>a</code>. (Here <code>a</code> and <code>b</code> are specific types; no implicit universal quantification.)<br>\nSo far, I have tried the following approaches:</p>\n\n<ol>\n<li><p><strong>Plain lists with Control.Concurrent.Async</strong>    </p>\n\n<pre><code>import Control.Concurrent.Async(mapConcurrently)\n\nindexedArray :: [[(Int,Int,a)]]\nindexedArray = -- ...\nmappedArray = mapConcurrently (traverse (\\(x,y,a) -&gt; foo x y a)) indexedArray\n</code></pre></li>\n</ol>\n\n<p>The problem with this approach is that the memory consumption is off the charts (say 4GB for reference).<br>\nAs noted in the answers, with this approach I'm only evaluating the rows in parallel instead of all elements, but that doesn't make much difference to me in practice.</p>\n\n<ol start=\"2\">\n<li><p><strong>Repa</strong>    </p>\n\n<pre><code>import qualified Data.Array.Repa as R\nimport Data.Array.Repa(Z(..), (:.)(..), U, DIM2)\n\narray :: R.Array U DIM2 a\narray = -- ...\nmappedArray = R.traverse array id (\\i (Z :. x :. y) -&gt; unsafePerformIO $ foo x y (i (Z :. x :. y)))\nresult = R.computeP mappedArray\n</code></pre></li>\n</ol>\n\n<p>Note that <code>R.traverse</code> is not <code>Data.Traversable(traverse)</code>. As Repa arrays do not support <code>Data.Traversable(traverse)</code>, I cannot sequence the IO actions in any way, so I have to use <code>unsafePerformIO</code> to be able to use the inbuilt <code>\"traverse\"</code> functionality.<br>\nThis approach has good performance and excellent memory consumption (around 50MB for reference).<br>\nThere is a problem however, as I consistently get the following runtime error: <code>thread blocked indefinitely in an MVar operation</code>.</p>\n\n<p>3a. <strong>Data.Vector and Control.Parallel</strong></p>\n\n<p>Essentially the same approach as with Repa leads to the same error, <code>thread blocked indefinitely in an MVar operation</code>.<br>\nI again resort to using <code>unsafePerformIO</code> as Data.Vector vectors do not have a traversable instance.</p>\n\n<pre><code>    import qualified Data.Vector as V\n    import Control.Parallel.Strategies(using)\n    import Data.Vector.Strategies(parVector)\n\n    array :: V.Vector (V.Vector a)\n    array = -- ...\n    mappedArray = V.imap (\\ y row -&gt; V.imap (\\x a -&gt; unsafePerformIO $ foo x y a ) row ) `using` (parVector 1)\n</code></pre>\n\n<p>The memory consumption and performance are slightly worse compared to Repa (around 100MB for reference), but remain comparable.</p>\n\n<p>3b. <strong>Data.Vector and Control.Concurrent.Async</strong></p>\n\n<p>As suggested by sheyll, but using a flat vector instead of nested vectors.</p>\n\n<pre><code>    import qualified Data.Vector.Unboxed as V\n    import qualified Data.Vector.Unboxed.Mutable as M\n    import Control.Concurrent.Async(forConcurrently_)\n\n    mappedFlattenedArray = do\n      flattenedMArray &lt;- V.unsafeThaw $ -- ...\n      forConcurrently_ [0..w*h] (\\i -&gt; do v &lt;- M.unsafeRead flattenedMArray i\n                                          let (y,x) = quotRem i w\n                                          v' &lt;- foo x y v\n                                          M.unsafeWrite flattenedMArray i v' )\n      V.unsafeFreeze flattenedMArray\n</code></pre>\n\n<p>Unfortunately the memory consumption is very high with this approach (~3GB). I think it's because <code>forConcurrently_</code> creates many thunks? I'm not sure how to avoid this problem.</p>\n\n<ol start=\"4\">\n<li><strong>Data.Array and Control.Concurrent.Async</strong></li>\n</ol>\n\n<p>Using the traversable instance of Data.Array arrays, as suggested by Alec:</p>\n\n<pre><code>    import qualified Data.Array.Unboxed as A\n    import Control.Concurrent.Async(mapConcurrently)\n\n    indexedArray :: A.Array (Int,Int) ((Int,Int),a)\n    indexedArray = -- ...\n    mappedArray = mapConcurrently (\\((x,y),a) -&gt; foo x y a) indexedArray\n</code></pre>\n\n<p>Once again, the memory consumption is very high (~3GB), even using unboxed arrays; the problem is probably the same as in approaches 1 and 3b, with a buildup of thunks consuming a lot of memory. I'm not sure how to tackle it.</p>\n\n<hr>\n\n<p>The overall performance and memory consumption seems to be better with Repa than any of the other approaches, and I also appreciate the inbuilt functionality for dealing with 2-dimensional arrays and being able to map a function that uses indices. Unfortunately, most of the time I get the aforementioned runtime error (but not always!).</p>\n\n<p>I remarked earlier that the only reason the return type of <code>foo</code> is <code>IO(b)</code> is because of non-determinism. So I would have thought I could change the output type to some <code>Random</code> monad, and instead of doing <code>unsafePerformIO</code> I could simply perform a <code>runRandom</code> with a given seed. Unfortunately this did not solve the problem, as I kept getting the error <code>thread blocked indefinitely in an MVar operation</code> anyway.</p>\n\n<p>Is there any way I can salvage method 2 (Repa) to circumvent this error? Or are there other applicable methods?\nI understand that in general, IO necessarily breaks parallelism as there are no guarantees that the IO actions don't conflict, but at least for this use-case I believe a solution should be possible. (See: <a href=\"https://stackoverflow.com/questions/25890459/why-is-there-no-mapm-for-repa-arrays\">Why is there no mapM for repa arrays?</a>)   </p>\n\n<p>See also the following question: <a href=\"https://stackoverflow.com/questions/11230895/parallel-mapm-on-repa-arrays\">Parallel mapM on Repa arrays</a>. Note however that I do not know in advance how many random numbers my function <code>foo</code> is going to need.</p>\n"}, {"tags": ["haskell", "c-preprocessor", "ghci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487383034, "post_id": 42309705, "comment_id": 71775221, "body": "I guess that that .ghci works as if you wrote <code>#ifdef ...</code> at the GHCi prompt, failing to do anything."}], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1487384106, "post_id": 42310341, "comment_id": 71775396, "body": "Thanks to <a href=\"https://twitter.com/thumphriees/status/832752388888883201\" rel=\"nofollow noreferrer\">Tim Humphries</a> for this solution."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 4, "last_activity_date": 1487384093, "creation_date": 1487384093, "answer_id": 42310341, "question_id": 42309705, "link": "https://stackoverflow.com/questions/42309705/can-a-ghci-config-file-use-cpp-macros/42310341#42310341", "title": "Can a GHCI config file use CPP macros?", "body": "<p>Those macros cannot be used directly by GHCI, but they <em>can</em> be used in a file you include using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#ghci-cmd-:add\" rel=\"nofollow noreferrer\">GHCI's <code>:add</code> command</a>.</p>\n\n<p>For example, this is what my setup now looks like:</p>\n\n<ul>\n<li><p><code>~/.ghc/ghci.conf</code> contains the <code>:add</code> command:</p>\n\n<pre><code>&gt; grep imports ~/.ghc/ghci.conf\n:add /home/chris/.ghc/imports.hs\n</code></pre></li>\n<li><p><code>~/.ghc/imports/imports.hs</code> contains my CPP'ed imports:</p>\n\n<pre><code>&gt; cat ~/.ghc/imports/imports.hs\n{-# LANGUAGE CPP #-}\n\n#ifdef MIN_VERSION_containers\nimport           Data.Set (Set)\nimport qualified Data.Set as Set\nimport           Data.Map (Map)\nimport qualified Data.Map as Map\n#endif\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1487386523, "creation_date": 1487378188, "last_edit_date": 1487386523, "question_id": 42309705, "link": "https://stackoverflow.com/questions/42309705/can-a-ghci-config-file-use-cpp-macros", "title": "Can a GHCI config file use CPP macros?", "body": "<p>I was thinking it would be nice to set up my global GHCI config such that my commonly-used imports occur automatically when the packages that provide them are present.</p>\n\n<p>I tried adding this to <code>~/.ghc/ghci.conf</code>:</p>\n\n<pre><code>:set -XCPP\n\n#ifdef MIN_VERSION_containers\nimport           Data.Set (Set)\nimport qualified Data.Set as Set\nimport           Data.Map (Map)\nimport qualified Data.Map as Map\n#endif\n</code></pre>\n\n<p>But apparently that does not work.</p>\n\n<pre><code>&gt; stack repl\nConfiguring GHCi with the following packages: \nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\n\n&lt;interactive&gt;:24:1: error: parse error on input \u2018#\u2019\n\n&lt;interactive&gt;:29:1: error: parse error on input \u2018#\u2019\n</code></pre>\n\n<p>Is there a way to get CPP macros to work, or some other way to accomplish what I'm trying to do?</p>\n"}, {"tags": ["css", "haskell", "ghcjs", "ghcjs-dom"], "comments": [{"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 1, "creation_date": 1487373404, "post_id": 42309039, "comment_id": 71772906, "body": "I am also offering to contribute to the Documentation of <code>ghcjs</code> starting with this simple question!  and maybe eventually some pull-requests"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487379491, "post_id": 42309039, "comment_id": 71774512, "body": "I feel your pain and surely you&#39;re right about the documentation situation, etc. but I&#39;m not sure precisely what your question is. I googled &quot;ghcjs hello world&quot; and found this: <a href=\"https://github.com/ghcjs/ghcjs-dom-hello\" rel=\"nofollow noreferrer\">github.com/ghcjs/ghcjs-dom-hello</a> and this: <a href=\"https://github.com/ghcjs/ghcjs-examples\" rel=\"nofollow noreferrer\">github.com/ghcjs/ghcjs-examples</a> perhaps you can clarify your question and then answer it yourself by consulting those examples, and that will help future newcomers"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1487380124, "post_id": 42309039, "comment_id": 71774649, "body": "If you want to use ghcjs to create a client side web page that has the alternating red/blue behavior you describe, then reflex/reflex-dom is probably a better library choice than ghcjs-dom directly (reflex-dom depends on ghcjs-dom) ."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487380675, "post_id": 42309039, "comment_id": 71774780, "body": "@jberryman I am looking for <a href=\"http://sscce.org/\" rel=\"nofollow noreferrer\">short, self-contained examples</a> Can you adapt that hello world example to answer my question?  If I am asking on StackOverflow it is because I am not familiar with this library yet.  I found <a href=\"https://github.com/ghcjs/ghcjs-examples/blob/master/ghcjs-hello/src/Main.hs\" rel=\"nofollow noreferrer\">this</a> highly ambiguous example which basically just types the html page and uses Haskell to add various JavaScript features to it."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1487380723, "post_id": 42309039, "comment_id": 71774795, "body": "@DaveCompton is <code>ghcjs-dom</code> ever useful ?"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1487382860, "post_id": 42309039, "comment_id": 71775199, "body": "As I mentioned earlier, reflex-dom depends on ghcjs-dom so yes, ghcjs-dom is useful.  I&#39;m sure there are other use cases.  I answered your earlier question: <a href=\"http://stackoverflow.com/questions/42254610/how-to-code-h1-tags-with-ghcjs\" title=\"how to code h1 tags with ghcjs\">stackoverflow.com/questions/42254610/&hellip;</a> using ghcjs-dom rather than some higher level library ( eg reflex ) because it seemed like overkill to use a higher level library than necessary for that question."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 0, "creation_date": 1487383901, "post_id": 42309039, "comment_id": 71775353, "body": "@DaveCompton it is definitely not overkill.  These functions are not at all obvious.  I don&#39;t see the point to making new <code>ghcjs</code> learners suffer on the way to building a good web-site."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487444895, "post_id": 42309039, "comment_id": 71792102, "body": "@johnmangual there&#39;s no conspiracy to make you suffer going on. In fact I see a lot of folks putting a lot of work into helping you out here and in your other question, in spite of your hostile and condescending tone. Working with very new projects where few examples exist can be challenging (we&#39;ve all been there), but I think you&#39;ll find people more willing to help you if you can display some patience and show that you&#39;ve put a little work in yourself."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487449162, "post_id": 42309039, "comment_id": 71793629, "body": "@jberryman good documentation takes <b>a lot</b> of effort. Nobody <i>needs</i> to learn this or that library since there are so many other competing libraries, with a much larger and friendlier user base.  If you&#39;re too busy to make explain what you are working so hard on, then you should just say nothing at all"}], "answers": [{"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 3, "last_activity_date": 1487426141, "last_edit_date": 1495542296, "creation_date": 1487393479, "answer_id": 42311189, "question_id": 42309039, "link": "https://stackoverflow.com/questions/42309039/how-to-change-h1-tags-with-ghcjs-dom/42311189#42311189", "title": "how to change &lt;h1&gt; tags with ghcjs-dom", "body": "<p>Here's a short self-contained example that uses <a href=\"https://github.com/reflex-frp/reflex-dom\" rel=\"nofollow noreferrer\">reflex-dom</a> to do the red/blue color switching that you described. This is a modified version of the code that <a href=\"https://stackoverflow.com/users/630160/epsilonhalbe\">epsilonhalbe</a> included in <a href=\"https://stackoverflow.com/a/42262597/509928\">this answer</a> to <a href=\"https://stackoverflow.com/questions/42254610/how-to-code-h1-tags-with-ghcjs\">your earlier question</a>.  </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-} \n{-# LANGUAGE ScopedTypeVariables #-} -- allows for local type declarations.\nimport Reflex\nimport Reflex.Dom\nimport Data.Text (Text, pack)\nimport Data.Map (Map)\nimport Data.Time.Clock (getCurrentTime)\nimport Control.Monad.Trans (liftIO)\n\nwebPage :: MonadWidget t m =&gt; m ()\nwebPage = do\n\n  -- ticker Event fires once per second.\n  ticker :: Event t TickInfo &lt;- tickLossy 1.0 =&lt;&lt; liftIO getCurrentTime  \n\n  -- counter Dynamic increases by one every second.\n  counter :: Dynamic t Int &lt;- foldDyn  (\\_ n -&gt; n+1) 0 ticker\n\n  -- function to map from integer to red or blue style.\n  let chooseColor :: Int -&gt; (Map Text Text) \n      chooseColor n = \"style\" =: pack (\"color: \" ++ if (n `mod` 2) == 0 then \"red\" else \"blue\")\n\n  -- redBlueStyle Dynamic changes each second.\n  let redBlueStyle :: Dynamic t (Map Text Text) \n      redBlueStyle = fmap chooseColor counter\n\n  -- insert an h1 elemnt.\n  el \"h1\" $ text \"Hello World!\"\n\n  -- insert a paragraph with Dynamic red blue style.\n  elDynAttr \"p\" redBlueStyle $ text \"This is my test document\"\n\n  return ()\n\n\ncss = \"h1 {font-family: Helvetica;} p {font-family: Helvetica;}\" \n\nmain :: IO ()\nmain = mainWidgetWithCss css webPage\n</code></pre>\n\n<p>Of course, reflex-dom (along with reflex) is a higher level library than ghcjs-dom and it comes with its own set of concepts (Event, Dynamic, Behavior, etc) that you need to get comfortable with.</p>\n\n<p>The example works by creating a Dynamic Map that specifies a style that alternates from red to blue each second and using that Dynamic Map to style an element.</p>\n\n<p>For clarity's sake, this example contains some type declarations that are not strictly required.</p>\n\n<p>This project: <a href=\"https://github.com/dc25/stackOverflow__how-to-change-h1-tags-with-ghcjs-dom\" rel=\"nofollow noreferrer\">https://github.com/dc25/stackOverflow__how-to-change-h1-tags-with-ghcjs-dom</a> contains the above code. Here is a link to a browser based demo: <a href=\"https://dc25.github.io/stackOverflow__how-to-change-h1-tags-with-ghcjs-dom/\" rel=\"nofollow noreferrer\">https://dc25.github.io/stackOverflow__how-to-change-h1-tags-with-ghcjs-dom/</a></p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 1, "accepted_answer_id": 42311189, "answer_count": 1, "score": 1, "last_activity_date": 1487426141, "creation_date": 1487373397, "last_edit_date": 1487373830, "question_id": 42309039, "link": "https://stackoverflow.com/questions/42309039/how-to-change-h1-tags-with-ghcjs-dom", "title": "how to change &lt;h1&gt; tags with ghcjs-dom", "body": "<p>I have found the <code>ghcjs</code> and <code>ghcjs-dom</code> documentation very limited.  Here is this basic HTML document.  </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-css lang-css prettyprint-override\"><code>h1 { font-family: Helvetica; }\r\n\r\np {font-family: Helvetica; color: blue; }</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;h1&gt;\r\nHello World\r\n&lt;/h1&gt;\r\n&lt;p&gt;\r\nThis is my test document.\r\n&lt;/p&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I have read that <code>ghcjs</code> merely compiles Haskell to JavaScript.  If I want to populate the DOM tree even with this simple document, I need to the Foreign Function Interface (FFI) and possibly <code>ghcjs-dom</code>.</p>\n\n<p>The irony of calling it the \"<em>Foreign</em> Function Interface\" is that JavaScript is usually considered \"<em>native</em>\" to the Browser.  So there is a tiny bit of terminology confusion there. </p>\n\n<p>In this very simple example, maybe </p>\n\n<p>Let's try a simple example of manipulating the DOM. I have a simple HTML document and I would like to \n* change the blue paragraph into a red one or \n* to switch back and forth once each second (between red and blue)</p>\n\n<p>I don't see how the ghcjs set of tools will achieve harder tasks if it cannot even do these very basic test case and explain it.  Here is an issue I have raised on Github, with the conclusion that ghcjs lacks a good <a href=\"https://www.uxpin.com/studio/blog/user-onboarding-best-practices-from-3-popular-mobile-apps/\" rel=\"nofollow noreferrer\">on-boarding</a> process.</p>\n\n<ul>\n<li><a href=\"https://github.com/ghcjs/ghcjs/issues/568\" rel=\"nofollow noreferrer\">https://github.com/ghcjs/ghcjs/issues/568</a></li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487354748, "post_id": 42304653, "comment_id": 71764061, "body": "You want <code>take&#39; :: (Num a, Eq a) =&gt; a -&gt; [a] -&gt; [a]</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487354827, "post_id": 42304653, "comment_id": 71764112, "body": "@Alec: I think he wants <code>take&#39; :: (Num a, Eq a) =&gt; a -&gt; [b] -&gt; [b]</code> :)"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1487354837, "post_id": 42304653, "comment_id": 71764119, "body": "You need to add an <code>Eq</code> constraint for <code>i</code>: <code>(Num i, Eq i, Ord a) =&gt; i -&gt; [a] -&gt; [a]</code> although it&#39;s not clear what the <code>Ord</code> constraint on <code>a</code> is for."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487354877, "post_id": 42304653, "comment_id": 71764145, "body": "@WillemVanOnsem Yes! Thank you."}, {"owner": {"reputation": 727, "user_id": 1230453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0e60ed45232805aeff3c9466ae9a8f48?s=128&d=identicon&r=PG", "display_name": "Long Thai", "link": "https://stackoverflow.com/users/1230453/long-thai"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487354987, "post_id": 42304653, "comment_id": 71764208, "body": "@WillemVanOnsem It works!!! Thanks."}, {"owner": {"reputation": 727, "user_id": 1230453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0e60ed45232805aeff3c9466ae9a8f48?s=128&d=identicon&r=PG", "display_name": "Long Thai", "link": "https://stackoverflow.com/users/1230453/long-thai"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1487355008, "post_id": 42304653, "comment_id": 71764218, "body": "@Lee You&#39;re right, I don&#39;t need the Ord constraint. Thanks."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487355519, "post_id": 42304653, "comment_id": 71764500, "body": "@LongThai: actually you do not need to specify the type signature. Haskell can derive that automatically. Furthermore in <code>ghci</code>, you can use <code>:t take&#39;</code> to obtain the type signature of that function."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1487355795, "creation_date": 1487355795, "answer_id": 42304947, "question_id": 42304653, "link": "https://stackoverflow.com/questions/42304653/could-not-deduce-eq-i-arising-from-the-literal-0/42304947#42304947", "title": "Could not deduce (Eq i) arising from the literal \u20180\u2019", "body": "<p>Pattern matches against literal numbers desugar to equality checks. So</p>\n\n<pre><code>take' 0 _ = []\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>take' x _ | x == 0 = []\n</code></pre>\n\n<p>(where <code>x</code> is chosen to be a variable not mentioned anywhere else in the clause). So to support this pattern, you need the number of things to take not just to be a <code>Num</code> but also to support <code>(==)</code>! That's what this part of the error says:</p>\n\n<pre><code>Could not deduce (Eq i) arising from the literal \u20180\u2019\nIn the pattern: 0\nIn an equation for \u2018take'\u2019: take' 0 _ = []\n</code></pre>\n\n<p>You can just take the fix that GHC suggests in the error:</p>\n\n<pre><code>Possible fix:\n  add (Eq i) to the context of\n    the type signature for take' :: (Num i, Ord a) =&gt; i -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Thus:</p>\n\n<pre><code>take' :: (Eq i, Num i, Ord a) =&gt; i -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Afterwards you can think about whether the <code>Ord a</code> constraint is needed at all. =)</p>\n"}], "owner": {"reputation": 727, "user_id": 1230453, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0e60ed45232805aeff3c9466ae9a8f48?s=128&d=identicon&r=PG", "display_name": "Long Thai", "link": "https://stackoverflow.com/users/1230453/long-thai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1760, "favorite_count": 0, "accepted_answer_id": 42304947, "answer_count": 1, "score": 1, "last_activity_date": 1487355795, "creation_date": 1487354686, "last_edit_date": 1487354991, "question_id": 42304653, "link": "https://stackoverflow.com/questions/42304653/could-not-deduce-eq-i-arising-from-the-literal-0", "title": "Could not deduce (Eq i) arising from the literal \u20180\u2019", "body": "<p>I'm very new to Haskell and trying to write a function that similar to <code>take</code>, i.e. return a specified number of items from the specified list. My code is as following:</p>\n\n<pre><code>take' :: (Num i, Ord a) =&gt; i -&gt; [a] -&gt; [a]\ntake' 0 _ = []\ntake' _ [] = []\ntake' n (x:xs) = x : take' (n - 1) xs\n</code></pre>\n\n<p>However, when I try to compile it, I receive the following error:</p>\n\n<pre><code>Could not deduce (Eq i) arising from the literal \u20180\u2019\nfrom the context (Num i, Ord a)\n  bound by the type signature for\n             take' :: (Num i, Ord a) =&gt; i -&gt; [a] -&gt; [a]\n  at recursion.hs:1:10-42\nPossible fix:\n  add (Eq i) to the context of\n    the type signature for take' :: (Num i, Ord a) =&gt; i -&gt; [a] -&gt; [a]\nIn the pattern: 0\nIn an equation for \u2018take'\u2019: take' 0 _ = []\n</code></pre>\n\n<p>I think that the error is caused as Haskell is not able to recognise 0 as a member of class type Num, but I'm not sure. Can anyone explain the error to me and show me how to fix it.</p>\n"}, {"tags": ["haskell", "google-custom-search"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487358112, "post_id": 42304038, "comment_id": 71765822, "body": "The type variable that it complains about represents the &#39;credentials&#39; (whatever that is.. I know nothing about the google API). You need to specify the type somewhere, perhaps with <code>env :: Env Something &lt;- ...</code>. I don&#39;t know what <code>Something</code> should be but I would assume you are aware of which &#39;credentials&#39; you intend to use. Alternatively, use <code>newEnvWith</code> which allows you to specify the <a href=\"https://hackage.haskell.org/package/gogol-0.1.1/docs/Network-Google-Auth.html#t:Credentials\" rel=\"nofollow noreferrer\">credentials</a> on the value level."}, {"owner": {"reputation": 123, "user_id": 3801711, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/YwxQm.jpg?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/3801711/arthur"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487518199, "post_id": 42304038, "comment_id": 71810784, "body": "Thanks for your explanation. If I understand Google Custom Search correctly, then you authenticate with a key=... keyvalue-pair appended to the URL.  I don&#39;t see a Key type in the linked credentials docs, so maybe it&#39;s not possible to do it this way?"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 3801711, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/YwxQm.jpg?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/3801711/arthur"}, "edited": false, "score": 0, "creation_date": 1487518508, "post_id": 42305814, "comment_id": 71810913, "body": "Hi, thanks for explaining the error message and suggesting a fix.  I think it&#39;s correct that there&#39;s no OAuth2 scope then, because google&#39;s custom search works with an appended key=... keyvalue-pair to authenticate a request.  Could you maybe explain the type of <code>forbid?</code> It&#39;s <code>k &#39;[] -&gt; k &#39;[]</code>, but I don&#39;t understand it. It&#39;s like <code>id</code>, but with lenses and lists? How can there be no type in the list (like <code>[a] -&gt; [a]</code>)?  Thanks for taking the time to answer."}, {"owner": {"reputation": 123, "user_id": 3801711, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/YwxQm.jpg?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/3801711/arthur"}, "edited": false, "score": 0, "creation_date": 1487519021, "post_id": 42305814, "comment_id": 71811126, "body": "I ask because I don&#39;t know what I should pass along to forbid"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 123, "user_id": 3801711, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/YwxQm.jpg?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/3801711/arthur"}, "edited": false, "score": 0, "creation_date": 1487520896, "post_id": 42305814, "comment_id": 71811798, "body": "@Arthur [1/2] <code>&#39;[]</code> -- note the <code>&#39;</code> -- is a <i>type-level</i> list; more specifically, it is an empty list being used as a type annotation. <code>forbid</code> is indeed a specialised <code>id</code>; its only purpose is ensuring the scope type annotation is <code>&#39;[]</code>. Similarly, all <code>envScopes .~ booksScope</code> does is setting the scope type parameter to the type-level list <code>&#39;[&quot;https:&#47;&#47;www.googleapis.com&#47;auth&#47;books&quot;]</code>, just like <code>allow booksScope</code> would do. (The extra thing <code>envScopes</code> makes possible is that, being a lens, it can be used to conveniently retrieve the scope from the environment, through the means of a <code>Proxy</code>.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 123, "user_id": 3801711, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/YwxQm.jpg?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/3801711/arthur"}, "edited": false, "score": 0, "creation_date": 1487520948, "post_id": 42305814, "comment_id": 71811818, "body": "@Arthur [2/2] That&#39;s to say, you do not need to pass anything else to <code>forbid</code>. <code>newEnv &lt;&amp;&gt; forbid</code> should just work, at least as far as the typechecker is concerned."}, {"owner": {"reputation": 123, "user_id": 3801711, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/YwxQm.jpg?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/3801711/arthur"}, "edited": false, "score": 0, "creation_date": 1487523749, "post_id": 42305814, "comment_id": 71812849, "body": "Aha, aha. That clears up the types, thanks. Strangely enough, the compiler does ask for an extra argument. I&#39;ll include the error in the original post. I guess I need to make k10 (see top post) explicit. No idea what it could be though."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1487360256, "last_edit_date": 1495535376, "creation_date": 1487359178, "answer_id": 42305814, "question_id": 42304038, "link": "https://stackoverflow.com/questions/42304038/how-to-perform-a-google-custom-search-in-haskell-with-gogol/42305814#42305814", "title": "How to perform a Google custom search in Haskell (with gogol)?", "body": "<p>The error is saying that the type checker can't figure out which instance of <code>AllowScopes</code> to use because you didn't specify the scope. I will have to speculate on what to do about that, given that I know very little about the specifics of the custom search API.</p>\n\n<p>Assuming that there is no OAuth2 scope for custom search -- which seems to be the case, given the absence of predefined scopes in <em>gogol-customsearch</em> (as you noted), as well as the discussion in <a href=\"https://stackoverflow.com/questions/14599957/oauth2-scope-for-google-custom-search-api\">this question</a> -- you can use <a href=\"https://hackage.haskell.org/package/gogol-0.1.1/docs/Network-Google-Auth-Scope.html#v:forbid\" rel=\"nofollow noreferrer\"><code>forbid</code></a> from <code>Network.Google.Auth.Scopes</code> to \"annotate credentials with no scope authorization\".</p>\n\n<pre><code>searchCoversCustomly phrase = do\n    env &lt;- G.newEnv &lt;&amp;&gt; G.forbid\n    -- etc.\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 3801711, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/YwxQm.jpg?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/3801711/arthur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487523869, "creation_date": 1487352557, "last_edit_date": 1487523869, "question_id": 42304038, "link": "https://stackoverflow.com/questions/42304038/how-to-perform-a-google-custom-search-in-haskell-with-gogol", "title": "How to perform a Google custom search in Haskell (with gogol)?", "body": "<p>I'm trying to perform a Google custom search with Gogol. I have the following code, but it doesn't compile and I don't understand the error message that tells me why. How do I get the program to compile so that the google search works?</p>\n\n<pre><code>searchCoversCustomly :: Text -&gt; IO Search\nsearchCoversCustomly phrase = do\n    env   &lt;- G.newEnv  -- create google environment\n    rVols &lt;- G.runResourceT . G.runGoogle env $ do  -- run request\n        let request =   (cSEList phrase)            -- request construction\n                      &amp; (cselCx .~ Just cx)\n                      . (cselNum .~ 3)\n                      . (cselSearchType .~ Just Image)\n        G.send request\n    return rVols\n  where cx  = \"...\"\n</code></pre>\n\n<p>This results in the following error message:</p>\n\n<pre><code>src/GoogleInteraction.hs:56:12: error:\n    \u2022 Ambiguous type variable \u2018s0\u2019 arising from a use of \u2018G.newEnv\u2019\n      prevents the constraint \u2018(G.AllowScopes s0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018s0\u2019 should be.\n      These potential instances exist:\n        instance G.AllowScopes '[]\n          -- Defined in \u2018Network.Google.Auth.Scope\u2019\n        ...plus one instance involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In a stmt of a 'do' block: env &lt;- G.newEnv\n      In the expression:\n        do { env &lt;- G.newEnv;\n             rVols &lt;- G.runResourceT . G.runGoogle env\n                      $ do { let ...;\n                             G.send request };\n             return rVols }\n</code></pre>\n\n<p>I have a working snippet of code for Google Books also working with Gogol. The difference is that I provide a relevant scope there, as the Gogol docs <a href=\"https://hackage.haskell.org/package/gogol-0.1.1/docs/Network-Google.html\" rel=\"nofollow noreferrer\">instruct</a>. </p>\n\n<p>For Books that BooksScope as documented in <a href=\"https://hackage.haskell.org/package/gogol-books-0.2.0/docs/Network-Google-Books-Types.html\" rel=\"nofollow noreferrer\">gogol-books' docs</a>, but there is no such scope mentioned in gogol-customsearch's docs.</p>\n\n<p>How do I get the program to compile so that the google search works? Thanks!</p>\n\n<p>=== Edit: including the error message after changing to <code>G.newEnv &lt;$&gt; forbid</code> ===</p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018IO a0\u2019\n                  with actual type \u2018k10 '[] -&gt; k10 '[]\u2019\n    \u2022 Probable cause: \u2018G.forbid\u2019 is applied to too few arguments\n      In the second argument of \u2018(&lt;$&gt;)\u2019, namely \u2018G.forbid\u2019\n</code></pre>\n"}, {"tags": ["list", "haskell", "infinite"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1487341766, "post_id": 42300273, "comment_id": 71755290, "body": "What result tells you you can take the intersection of two infinite lists? Pretty sure this is not true as such."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1487341972, "post_id": 42300273, "comment_id": 71755434, "body": "@leftaroundabout: you could use an incrementing bound."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1487343369, "post_id": 42300273, "comment_id": 71756426, "body": "@leftaroundabout for a somewhat similar, and perhaps simpler example, google the <a href=\"https://www.google.com/search?q=countability+of+the+rational+numbers\" rel=\"nofollow noreferrer\">countability of the rational numbers</a> or <a href=\"http://www.homeschoolmath.net/teaching/rational-numbers-countable.php\" rel=\"nofollow noreferrer\">this link</a>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1487370536, "post_id": 42300273, "comment_id": 71771965, "body": "@ZoeyHewll It&#39;s possible, but not with this algorithm."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1487380983, "post_id": 42300273, "comment_id": 71774852, "body": "@AJFarmar what do you mean &#39;this algorithm&#39;? I didn&#39;t supply one"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1487533758, "post_id": 42300273, "comment_id": 71816521, "body": "Questions should contain <i>the problem</i>, not the solution. If you feel you have came up with a different and/or better answer please <i>answer your own question</i> (it&#39;s fine to do!). If the question contains an answer users are unable to vote separately for the two (e.g. one might want to upvote a good answer to a &quot;not-so-good question&quot; without upvoting the question itself or viceversa)."}], "answers": [{"comments": [{"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 2, "creation_date": 1487342815, "post_id": 42300545, "comment_id": 71755994, "body": "Correction: the list would either be infinite or empty. If there is any intersection, it&#39;ll be infinite, but if there are no shared elements it&#39;ll be empty (of course, if it&#39;s empty it will just hang, but that&#39;s guaranteed for any method)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 1, "creation_date": 1487343317, "post_id": 42300545, "comment_id": 71756383, "body": "@ZoeyHewll: yes thank you. I think I resolved the problem a bit more, but the solution can still be improved."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 1, "creation_date": 1487357467, "post_id": 42300545, "comment_id": 71765482, "body": "@ZoeyHewll Calling such a list &#39;empty&#39; is not really correct. <code>[]</code> is the empty list. A program which runs forever, and after running forever produces a value (any value - which happens to be here the empty list) does not represent that value, it represents bottom."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487377941, "post_id": 42300545, "comment_id": 71774103, "body": "@user2407038 I don&#39;t really know what bottom is, but I was going from a math point of view that even if the computer could fully compute the intersection in finite time, it would still only return the empty list. Kinda like how the lists are never actually infinite, just unbounded and finite, but it&#39;s convenient to call them infinite."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487399941, "post_id": 42300545, "comment_id": 71778332, "body": "@ZoeyHewll But Haskell lists <i>can</i> actually be infinite... it isn&#39;t merely a &#39;convenience&#39; to reason about them as such. Any lazy recursive data structure can contain infinite values, which is almost the entire point of laziness. Precisely from a math point a view, a computation which takes forever to &#39;return&#39; a value is bottom (<code>undefined</code>) because there is absolutely no way to <i>distinguish</i> such a computation (in the theory in which you have formalized &#39;computation&#39;) from one which loops forever doing nothing. (This is commonly known as the &#39;halting problem&#39;)"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487559891, "post_id": 42300545, "comment_id": 71824167, "body": "@user2407038 I know of the halting problem. When I say &quot;a math point of view&quot; I mean like set theory, not like computation theory. Though it is impossible to compute the intersection of two infinite lists in finite time, mathematically speaking you can state whether their set intersection is empty if you know they are necessarily mutually exclusive."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487560226, "post_id": 42300545, "comment_id": 71824257, "body": "@user2407038 However I understand your definition of bottom, and it makes sense what you&#39;re saying about this computation. I&#39;m not sure how you can state that a computed data structure can be <i>actually</i> infinite, as opposed to simply unbounded, but I don&#39;t know much about how laziness works and how you would reason about it theoretically"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1487351397, "last_edit_date": 1487351397, "creation_date": 1487342245, "answer_id": 42300545, "question_id": 42300273, "link": "https://stackoverflow.com/questions/42300273/intersection-of-infinite-lists/42300545#42300545", "title": "Intersection of infinite lists", "body": "<p>An idea might be to use <em>incrementing bounds</em>. Let is first relax the problem a bit: yielding duplicated values is allowed. In that case you could use:</p>\n\n<pre><code>import Data.List (intersect)\n\nintersectInfinite :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nintersectInfinite = intersectInfinite' 1\n    where intersectInfinite' n = intersect (take n xs) (take n ys) ++ intersectInfinite' (n+1)\n</code></pre>\n\n<p>In other words we claim that:</p>\n\n<p>A&cap;B = A<sub>1</sub>&cap;B<sub>1</sub> &cup; A<sub>2</sub>&cap;B<sub>2</sub> &cup; ... &cup; ...</p>\n\n<p>with A<sub>1</sub> is a set containing the <em>first i</em> elements of <em>A</em> (yes there is no order in a set, but let's say there is somehow an order). If the set contains <em>less</em> elements then the full set is returned.</p>\n\n<p>If <em>c</em> is in <em>A</em> (at index <em>i</em>) and in <em>B</em> (at index <em>j</em>), <em>c</em> will be emitted in <em>segment</em> (not index) <em>max(i,j)</em>.</p>\n\n<p>This will thus always generate an infinite list (with an infinite amount of duplicates) regardless whether the given lists are finite or not. The only exception is when you give it an empty list, in which case it will take forever. Nevertheless we here ensured that every element in the intersection will be emitted at least once.</p>\n\n<p><strong>Making the result finite (if the given lists are finite)</strong></p>\n\n<p>Now we can make our definition better. First we make a more advanced version of <code>take</code>, <code>takeFinite</code> (let's first give a straight-forward, but not very efficient defintion):</p>\n\n<pre><code>takeFinite :: Int -&gt; [a] -&gt; (Bool,[a])\ntakeFinite _ [] = (True,[])\ntakeFinite 0 _  = (False,[])\ntakeFinite n (x:xs) = let (b,t) = takeFinite (n-1) xs in (b,x:t)\n</code></pre>\n\n<p>Now we can iteratively deepen until <strong>both</strong> lists have reached the end:</p>\n\n<pre><code>intersectInfinite :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nintersectInfinite = intersectInfinite' 1\n\nintersectInfinite' :: Eq a =&gt; Int -&gt; [a] -&gt; [a] -&gt; [a]\nintersectInfinite' n xs ys | fa &amp;&amp; fb = intersect xs ys\n                           | fa = intersect ys xs\n                           | fb = intersect xs ys\n                           | otherwise = intersect xfa xfb ++ intersectInfinite' (n+1) xs ys\n    where (fa,xfa) = takeFinite n xs\n          (fb,xfb) = takeFinite n ys\n</code></pre>\n\n<p>This will now terminate given both lists are finite, but still produces a lot of duplicates. There are definitely ways to resolve this issue more (will update if I have more time).</p>\n"}, {"comments": [{"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487344380, "post_id": 42300983, "comment_id": 71757222, "body": "Ah, so you still iterate through one list and check the other for matches, but you&#39;ve interleaved the results..."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487344427, "post_id": 42300983, "comment_id": 71757261, "body": "I can&#39;t quite figure how to improve the interleaving, mainly because I can&#39;t figure out how it&#39;s done currently. I can trace the code, but I cant figure out what the result of that <code>foldr</code> will be on the order of the elements"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 1, "creation_date": 1487346055, "post_id": 42300983, "comment_id": 71758447, "body": "It favours earlier lists, moving through each one twice as fast as the next - like how in <code>interleave [&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;, &quot;a4&quot;, &quot;a5&quot;, a6&quot;] (interleave [&quot;b1&quot;, &quot;b2&quot;, &quot;b3&quot;] [&quot;c1&quot;, &quot;c2&quot;, &quot;c3&quot;])</code> every second element is an <code>a</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1487348767, "post_id": 42300983, "comment_id": 71760406, "body": "You might like to use <a href=\"http://hackage.haskell.org/package/universe-base-1.0.2.1/docs/Data-Universe-Helpers.html#v:diagonal\" rel=\"nofollow noreferrer\"><code>diagonal</code></a> for a more fair interleaving."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487381342, "post_id": 42300983, "comment_id": 71774917, "body": "@DanielWagner Ah, <code>diagonal</code> is exactly the interleaving method I was thinking would be ideal!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487384348, "post_id": 42300983, "comment_id": 71775452, "body": "@ZoeyHewll Then why did you accept this answer? It doesn&#39;t even use <code>diagonal</code>, whereas mine does..."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487385170, "post_id": 42300983, "comment_id": 71775618, "body": "@DanielWagner where does yours? Also, in this one, I simply replace the <code>foldr interleave []</code> with <code>diagonal</code> to produce an easily (for me) readable, expressive function. While yours is more concise, I find it takes more work for me to interpret."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487385410, "post_id": 42300983, "comment_id": 71775659, "body": "@ZoeyHewll Right <a href=\"http://hackage.haskell.org/package/universe-base-1.0.2.1/docs/src/Data-Universe-Helpers.html#%2B%2A%2B\" rel=\"nofollow noreferrer\">here</a>: <code>xs +*+ ys = diagonal [[(x, y) | x &lt;- xs] | y &lt;- ys]</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487385746, "post_id": 42300983, "comment_id": 71775722, "body": "@ZoeyHewll And by the way, the comment on the other defining line for <code>+*+</code> points out that this implementation is buggy: compare <code>isect [0..] []</code> between my implementation and his. This is why library reuse is so important: you get exposure to all the bugfixes anybody has ever done without all the work of thinking of them yourself."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487385890, "post_id": 42300983, "comment_id": 71775749, "body": "@DanielWagner Fair. I hadn&#39;t seen the implementation of <code>+*+</code>. However, I stick by my accepted answer as <a href=\"http://stackoverflow.com/help/accepted-answer\">the one I found most helpful</a>"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487388095, "post_id": 42300983, "comment_id": 71776122, "body": "@DavidFletcher you&#39;re right about your answer being exponential. In <code>foldr interleave [] $ repeat &lt;$&gt; [1..]</code>, every second element is <code>1</code>, every 4th element is <code>2</code>, every <code>2^n</code>th element is <code>n</code>. This means that in the calculation of the intersection, each element of the first list is tested half as often (against elements of the other list) as the element before it."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 5, "last_activity_date": 1487343475, "creation_date": 1487343475, "answer_id": 42300983, "question_id": 42300273, "link": "https://stackoverflow.com/questions/42300273/intersection-of-infinite-lists/42300983#42300983", "title": "Intersection of infinite lists", "body": "<p>Here's one way.  For each <code>x</code> we make a list of maybes which has\n<code>Just x</code> only where <code>x</code> appeared in <code>ys</code>.  Then we interleave all\nthese lists.</p>\n\n<pre><code>isect :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nisect xs ys = (catMaybes . foldr interleave [] . map matches) xs\n  where\n    matches x = [if x == y then Just x else Nothing | y &lt;- ys]\n\ninterleave :: [a] -&gt; [a] -&gt; [a]\ninterleave [] ys = ys\ninterleave (x:xs) ys = x : interleave ys xs\n</code></pre>\n\n<p>Maybe it can be improved using some sort of fairer interleaving -\nit's already pretty slow on the example below because (I think)\nit's doing an exponential amount of work.</p>\n\n<pre><code>&gt; take 10 (isect [0..] [0,2..])\n[0,2,4,6,8,10,12,14,16,18]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487347180, "post_id": 42302184, "comment_id": 71759208, "body": "See also <a href=\"http://hackage.haskell.org/package/data-ordlist-0.4.7.0/docs/Data-List-Ordered.html\" rel=\"nofollow noreferrer\">isect</a> from the data-ordlist package; that package provides many other handy operations for working on ordered (and potentially infinite) lists, too."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 4, "last_activity_date": 1487347023, "creation_date": 1487347023, "answer_id": 42302184, "question_id": 42300273, "link": "https://stackoverflow.com/questions/42300273/intersection-of-infinite-lists/42302184#42302184", "title": "Intersection of infinite lists", "body": "<p>If elements in the lists are ordered then you can easy to do that.</p>\n\n<pre><code>intersectOrd :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\nintersectOrd [] _ = []\nintersectOrd _ [] = []\nintersectOrd (x:xs) (y:ys) = case x `compare` y of\n    EQ -&gt; x : intersectOrd xs ys\n    LT -&gt; intersectOrd xs (y:ys)\n    GT -&gt; intersectOrd (x:xs) ys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 9, "last_activity_date": 1487350204, "last_edit_date": 1487350204, "creation_date": 1487347462, "answer_id": 42302326, "question_id": 42300273, "link": "https://stackoverflow.com/questions/42300273/intersection-of-infinite-lists/42302326#42302326", "title": "Intersection of infinite lists", "body": "<p>Using the <a href=\"http://hackage.haskell.org/package/universe-base-1.0.2.1/docs/Data-Universe-Helpers.html#v:-43--42--43-\" rel=\"noreferrer\">universe package's Cartesian product operator</a> we can write this one-liner:</p>\n\n<pre><code>import Data.Universe.Helpers\n\nisect :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nxs `isect` ys = [x | (x, y) &lt;- xs +*+ ys, x == y]\n</code></pre>\n\n<p>Try it in ghci:</p>\n\n<pre><code>&gt; take 10 $ [0,2..] `isect` [0,3..]\n[0,6,12,18,24,30,36,42,48,54]\n</code></pre>\n\n<p>This implementation will not produce any duplicates if the input lists don't have any; but if they do, you can tack on your favorite dup-remover either before or after calling <code>isect</code>. For example, with <code>nub</code>, you might write</p>\n\n<pre><code>&gt; nub ([0,1] `isect` repeat 1)\n[1\n</code></pre>\n\n<p>and then heat up your computer pretty good, since it can never be sure there might not be a <code>0</code> in that second list somewhere if it looks deep enough.</p>\n\n<p>This approach is significantly faster than David Fletcher's, produces many fewer duplicates and produces new values much more quickly than Willem Van Onsem's, and doesn't assume the lists are sorted like freestyle's (but is consequently much slower on such lists than freestyle's).</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1487372196, "last_edit_date": 1487372196, "creation_date": 1487365531, "answer_id": 42307369, "question_id": 42300273, "link": "https://stackoverflow.com/questions/42300273/intersection-of-infinite-lists/42307369#42307369", "title": "Intersection of infinite lists", "body": "<p>Here's yet another alternative, leveraging <code>Control.Monad.WeightedSearch</code></p>\n\n<pre><code>import Control.Monad (guard)\nimport Control.Applicative\nimport qualified Control.Monad.WeightedSearch as W\n</code></pre>\n\n<p>We first define a cost for digging inside the list. Accessing the tail costs 1 unit more. This will ensure a fair scheduling among the two infinite lists.</p>\n\n<pre><code>eachW :: [a] -&gt; W.T Int a\neachW = foldr (\\x w -&gt; pure x &lt;|&gt; W.weight 1 w) empty\n</code></pre>\n\n<p>Then, we simply disregard infinite lists.</p>\n\n<pre><code>intersection :: [Int] -&gt; [Int] -&gt; [Int]\nintersection xs ys = W.toList $ do\n   x &lt;- eachW xs\n   y &lt;- eachW ys\n   guard (x==y)\n   return y\n</code></pre>\n\n<p>Even better with <code>MonadComprehensions</code> on:</p>\n\n<pre><code>intersection2 :: [Int] -&gt; [Int] -&gt; [Int]\nintersection2 xs ys = W.toList [ y | x &lt;- eachW xs, y &lt;- eachW ys, x==y ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "is_accepted": true, "score": 0, "last_activity_date": 1487567401, "creation_date": 1487567401, "answer_id": 42336907, "question_id": 42300273, "link": "https://stackoverflow.com/questions/42300273/intersection-of-infinite-lists/42336907#42336907", "title": "Intersection of infinite lists", "body": "<h2>Solution</h2>\n\n<p>I ended up using the following implementation; a slight modification of the answer by David Fletcher:</p>\n\n<pre><code>isect :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nisect [] = const [] -- don't bother testing against an empty list\nisect xs = catMaybes . diagonal . map matches\n    where matches y = [if x == y then Just x else Nothing | x &lt;- xs]\n</code></pre>\n\n<p>This can be augmented with nub to filter out duplicates:</p>\n\n<pre><code>isectUniq :: Eq a =&gt; [a] -&gt; [a] -&gt; [a]\nisectUniq xs = nub . isect xs\n</code></pre>\n\n<h2>Explanation</h2>\n\n<p>Of the line <code>isect xs = catMaybes . diagonal . map matches</code></p>\n\n<p><code>(map matches) ys</code> computes a list of lists of comparisons between elements of <code>xs</code> and <code>ys</code>, where the list indices specify the indices in <code>ys</code> and <code>xs</code> respectively: i.e <code>(map matches) ys !! 3 !! 0</code> would represent the comparison of <code>ys !! 3</code> with <code>xs !! 0</code>, which would be <code>Nothing</code> if those values differ. If those values are the same, it would be <code>Just</code> that value.</p>\n\n<p><code>diagonals</code> takes a list of lists and returns a list of lists where the nth output list contains an element each from the first n lists. Another way to conceptualise it is that <code>(diagonals . map matches) ys !! n</code> contains comparisons between elements whose indices in <code>xs</code> and <code>ys</code> sum to <code>n</code>.<br>\n<code>diagonal</code> is simply a flat version of <code>diagonals</code> (<code>diagonal = concat diagonals</code>)</p>\n\n<p>Therefore <code>(diagonal . map matches) ys</code> is a list of comparisons between elements of <code>xs</code> and <code>ys</code>, where the elements are approximately sorted by the sum of the indices of the elements of <code>ys</code> and <code>xs</code> being compared; this means that early elements are compared to later elements with the same priority as middle elements being compared to each other.</p>\n\n<p><code>(catMaybes . diagonal . map matches) ys</code> is a list of only the elements which are in both lists, where the elements are approximately sorted by the sum of the indices of the two elements being compared.  </p>\n\n<p><strong>Note</strong><br>\n<code>(diagonal . map (catMaybes . matches)) ys</code> does <em>not</em> work: <code>catMaybes . matches</code> only yields when it finds a match, instead of also yielding <code>Nothing</code> on no match, so the interleaving does nothing to distribute the work.  </p>\n\n<p>To contrast, in the chosen solution, the interleaving of <code>Nothing</code> and <code>Just</code> values by <code>diagonal</code> means that the program divides its attention between 'searching' for multiple different elements, not waiting for one to succeed; whereas if the <code>Nothing</code> values are removed before interleaving, the program may spend too much time waiting for a fruitless 'search' for a given element to succeed.  </p>\n\n<p>Therefore, we would encounter the same problem as in the original question: while one element does not match any elements in the other list, the program will hang; whereas the chosen solution will only hang while no matches are found for any elements in either list.</p>\n"}], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 719, "favorite_count": 1, "accepted_answer_id": 42336907, "answer_count": 6, "score": 8, "last_activity_date": 1487840803, "creation_date": 1487341411, "last_edit_date": 1487840803, "question_id": 42300273, "link": "https://stackoverflow.com/questions/42300273/intersection-of-infinite-lists", "title": "Intersection of infinite lists", "body": "<p>I know from computability theory that it is possible to take the intersection of two infinite lists, but I can't find a way to express it in Haskell.</p>\n\n<p>The traditional method fails as soon as the second list is infinite, because you spend all your time checking it for a non-matching element in the first list.</p>\n\n<p>Example:</p>\n\n<pre><code>let ones = 1 : ones -- an unending list of 1s\nintersect [0,1] ones\n</code></pre>\n\n<p>This never yields <code>1</code>, as it never stops checking <code>ones</code> for the element <code>0</code>.</p>\n\n<p>A successful method needs to ensure that each element of each list will be visited in finite time.</p>\n\n<p>Probably, this will be by  iterating through both lists, and spending approximately equal time checking all previously-visited elements in each list against each other.</p>\n\n<p>If possible, I'd like to also have a way to ignore duplicates in the lists, as it is occasionally necessary, but this is not a requirement.</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1487341340, "post_id": 42299128, "comment_id": 71754960, "body": "Shorter: <code>unity n = cis . (2*pi&#47;fromIntegral n *) . fromIntegral &lt;$&gt; [0 .. n-1]</code>."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1487341896, "post_id": 42299128, "comment_id": 71755380, "body": "Ah.. I&#39;d tried (* 2 * pi / fromIntegral n), which failed, didn&#39;t realise the converse was possible"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1487342120, "post_id": 42299128, "comment_id": 71755527, "body": "Yeah, it&#39;s because <code>infixl 7 *, &#47;</code>, so <code>(*2*pi&#47;n)</code> would be parsed as, like, <code>((*2*pi)&#47;n)</code>, which doesn&#39;t work. The other way around, it&#39;s just parsed <code>((2*pi&#47;n)*)</code>."}], "tags": [], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "is_accepted": true, "score": 4, "last_activity_date": 1487337906, "creation_date": 1487337906, "answer_id": 42299128, "question_id": 42299126, "link": "https://stackoverflow.com/questions/42299126/cant-make-function-more-polymorphic/42299128#42299128", "title": "Can&#39;t make function more polymorphic", "body": "<p>All you need to do is coerce your <code>Integral</code> parameter to a <code>Num</code> with <code>fromIntegral</code> when your code expects a value of the same type as the return type, i.e. as arguments to <code>cis</code>, <code>(*)</code> or <code>(/)</code>. Though <code>n</code> is only directly passed into <code>(/)</code>, so that's all you need to worry about:</p>\n\n<pre><code>unity :: (Integral a, Floating b) =&gt; a -&gt; [Complex b]\nunity n = map (cis . (* 2) . (* pi) . (/ (fromIntegral n)) . fromIntegral) [0..(n-1)]\n</code></pre>\n"}], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 42299128, "answer_count": 1, "score": 2, "last_activity_date": 1487337906, "creation_date": 1487337906, "question_id": 42299126, "link": "https://stackoverflow.com/questions/42299126/cant-make-function-more-polymorphic", "title": "Can&#39;t make function more polymorphic", "body": "<p>I'm trying to define a function to return each of the nth <a href=\"https://en.wikipedia.org/wiki/Root_of_unity\" rel=\"nofollow noreferrer\">roots of unity</a>.<br>\nThis compiles,</p>\n\n<pre><code>unity n = map (cis.(*2).(*pi).(/n)) [0..(n-1)]\n</code></pre>\n\n<p>but its type defaults to <code>unity :: (Enum a, Floating a) =&gt; a -&gt; [Complex a]</code>.<br>\nOf course, <code>n</code> needs to be an integer, as roots of unity aren't defined otherwise; but the returned Complex numbers will necessarily have floating-point coordinates; i.e, they cannot be <code>Complex Int</code>s. However, the following code won't compile</p>\n\n<pre><code>unity :: (Integral a, Floating b) =&gt; a -&gt; [Complex b]\nunity n = map (cis . (* 2) . (* pi) . (/ n)) [0..(n - 1)]\n</code></pre>\n\n<p>because <code>(/)</code> <code>(*)</code> and <code>cis</code> each constrain the return type (or Complex coordinate type in the case of <code>cis</code>) to be the same as the parameter type; so I get the error </p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018b\u2019 with actual type \u2018a\u2019</p>\n</blockquote>\n\n<p>Is there a way I can force the parameter to be an integer without forcing the complex numbers to have integral components?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1487336151, "post_id": 42298348, "comment_id": 71751510, "body": "In the former, <code>zipWith</code> is applied to 3 arguments; the function <code>max</code> and 2 lists.  In the latter, it is applied to only one argument; the result of applying <code>max</code> to the 2 lists."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1487336385, "post_id": 42298348, "comment_id": 71751673, "body": "You can, in this case, eliminate most of the parens with judicious use of function composition: <code>replicate 100 . product . map (*3) $ zipWith max [1,2,3,4,5] [4,5,6,7,8]</code>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1487336559, "post_id": 42298348, "comment_id": 71751789, "body": "@pat True, but not very helpful for someone figuring out the function of parentheses"}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 6, "creation_date": 1487336505, "post_id": 42298567, "comment_id": 71751752, "body": "Probably worth pointing out that while you can&#39;t use <code>max [1,2,3,4,5] [4,5,6,7,8]</code> as the first parameter to zipWith, it is a correct expression on its own (giving the lexicographically larger of the two lists)."}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "reply_to_user": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487366445, "post_id": 42298567, "comment_id": 71770108, "body": "@Srinivas: You&#39;re welcome. If my answer is ok, please mark it as an answer to your question."}], "tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": true, "score": 13, "last_activity_date": 1487357649, "last_edit_date": 1487357649, "creation_date": 1487336209, "answer_id": 42298567, "question_id": 42298348, "link": "https://stackoverflow.com/questions/42298348/parenthesis-in-haskell-functions/42298567#42298567", "title": "parenthesis in Haskell functions", "body": "<p>Function application is left associative. So, when you write an expression like:</p>\n\n<pre><code>f g h x\n</code></pre>\n\n<p>it means:</p>\n\n<pre><code>((f g) h) x\n</code></pre>\n\n<p>And also the type of <code>zipWith</code> provides a clue:</p>\n\n<pre><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n</code></pre>\n\n<p>it says that <code>zipWith</code> has 3 parameters: a function and two lists. </p>\n\n<p>When you write: </p>\n\n<pre><code>zipWith (max [1,2,3,4,5] [4,5,6,7,8])\n</code></pre>\n\n<p>The interpreter will understand that </p>\n\n<pre><code>max [1,2,3,4,5] [4,5,6,7,8]\n</code></pre>\n\n<p>will be the first parameter to zipWith, which is type incorrect. Note that <code>zipWith</code> expects a function of two arguments as its first argument and, as pointed out by @Cubic, <code>max [1,2,3,4,5] [4,5,6,7,8]</code> will return the maximum\nbetween these two lists according the usual lexicographic order, which will be of type <code>[a]</code>, for some type <code>a</code> which is instance of <code>Ord</code> and <code>Num</code>. Said that, the error become evident since you are trying to pass a value of type</p>\n\n<pre><code>(Num a, Ord a) =&gt; [a]\n</code></pre>\n\n<p>where a value of type</p>\n\n<pre><code>(a -&gt; b -&gt; c)\n</code></pre>\n\n<p>is expected. </p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 4, "last_activity_date": 1487350909, "last_edit_date": 1487350909, "creation_date": 1487350510, "answer_id": 42303384, "question_id": 42298348, "link": "https://stackoverflow.com/questions/42298348/parenthesis-in-haskell-functions/42303384#42303384", "title": "parenthesis in Haskell functions", "body": "<p>Rodrigo gave the right answer. I'll just add that it is a misconception to think that some functions need parentheses, while others don't.</p>\n\n<p>This is just like in school math:</p>\n\n<pre><code>3 * (4+5)\n</code></pre>\n\n<p>It is simply not the case that <code>+</code> expressions need parentheses and <code>*</code> expressions don't need them <strong>in general</strong>.</p>\n\n<p>In Haskell, you can always get away without parentheses at all. Whenever you need to enclose an expression in parentheses, the alternative is to introduce a local name and bind it to that expression, then use the name instead of the expression.</p>\n\n<p>In your example:</p>\n\n<pre><code>replicate 100 (product (map (*3) (zipWith max [1,2,3,4,5] [4,5,6,7,8])))\n\nlet list1 = product list2\n    list2 = map thrice list3\n    thrice x = x*3\n    list3 = zipWith max [1,2,3,4,5] [4,5,6,7,8]\nin replicate 100 list1\n</code></pre>\n\n<p>In fact, I often write functions top down thus:</p>\n\n<pre><code>foo x y z = result\n  where\n   result = ...\n   ...\n</code></pre>\n\n<p>However, as it was said before, expressions that consist of function applications can also often be written without parentheses by making use of <code>(.)</code> and <code>($)</code> and in such cases, the top down approach from above may be overly verbose and the following would be <strong>much</strong> clearer (because there is no noise through newly introduced names):</p>\n\n<pre><code>replicate 100\n  . product\n  . map (*3)\n  $ zipWith max [1..5] [4..8]\n</code></pre>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4053, "favorite_count": 0, "accepted_answer_id": 42298567, "answer_count": 2, "score": 3, "last_activity_date": 1487517860, "creation_date": 1487335570, "last_edit_date": 1487517860, "question_id": 42298348, "link": "https://stackoverflow.com/questions/42298348/parenthesis-in-haskell-functions", "title": "parenthesis in Haskell functions", "body": "<p>I just want to know how do we know which functions need brackets () and which ones do not? For example</p>\n\n<pre><code>replicate 100 (product (map (*3) (zipWith max [1,2,3,4,5] [4,5,6,7,8])))\n</code></pre>\n\n<p>works fine. But</p>\n\n<pre><code>replicate 100 (product (map (*3) (zipWith (max [1,2,3,4,5] [4,5,6,7,8]))))\n</code></pre>\n\n<p>does not work. It is because I put a set of brackets for zipWith. In this small example, zipWith and max do not have brackets, but replicate, product and map do. In general is there a way to know/figure out which functions need brackets and which ones dont. </p>\n"}, {"tags": ["python", "performance", "haskell", "weighted-average"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1487349390, "post_id": 42295547, "comment_id": 71760845, "body": "Here&#39;s what the corresponding criterion file looks like <a href=\"http://sprunge.us/VONE\" rel=\"nofollow noreferrer\">sprunge.us/VONE</a>"}], "answers": [{"comments": [{"owner": {"reputation": 528, "user_id": 4636182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5403c86cb21ace416b4cb758fabb72b7?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya Prokin", "link": "https://stackoverflow.com/users/4636182/ilya-prokin"}, "edited": false, "score": 0, "creation_date": 1487344650, "post_id": 42296139, "comment_id": 71757455, "body": "Thanks for the great answer and pointers to Monad.State and VectorSpace. I have eventually achieved reasonable speed implementing ewma with V.scanl and unboxed vectors."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 12, "last_activity_date": 1487346670, "last_edit_date": 1487346670, "creation_date": 1487329006, "answer_id": 42296139, "question_id": 42295547, "link": "https://stackoverflow.com/questions/42295547/similar-code-for-exponentially-weighted-deviation-is-slower-in-haskell-than-in/42296139#42296139", "title": "Similar code (for exponentially weighted deviation) is slower in Haskell than in Python", "body": "<p>Your Python and Haskell algorithms may look equivalent, but they actually have different asymptotic complexity:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>ewmaV x tau = V.map f $ V.enumFromN 0 (V.length x)\n    where\n        f (-1) = 0\n        f n    = (x V.! n)*a + (1-a)\n                     *(f (n-1)) -- Recursion!\n        a = 1/tau\n</code></pre>\n\n<p>This makes the Haskell implementation <em>O</em> (<em>n</em>\u00b2), which is inacceptable. The reason you don't notice this when only evaluating <code>V.last . ewmaV</code> is lazyness: to evaluate the last element only, you don't really need to process the entire vector, instead you only get one recursion-loop across <code>x</code>. OTOH, <code>ewmdV</code> actually forces all of the elements, hence the extra cost.</p>\n\n<p>One simple (but not optimal, I daresay) way to get around this is to memoise the result:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ewmaV :: V.Vector Double -&gt; Double -&gt; V.Vector Double\newmaV x tau = result\n  where result = V.map f $ V.enumFromN 0 (V.length x)\n        f 0 = V.head x * a\n        f n    = (x V.! n)*a + (1-a)*(result V.! (n-1))\n        a = 1/tau\n</code></pre>\n\n<p>Now <code>ewmdV</code> takes \u2248twice as long as <code>ewmaV</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sagemuej@sagemuej-X302LA:/tmp$ ghc wtmpf-file6122.hs -O2 &amp;&amp; ./wtmpf-file6122\n[1 of 1] Compiling Main             ( wtmpf-file6122.hs, wtmpf-file6122.o )\nLinking wtmpf-file6122 ...\nVectors\nEWMA (vector) took 4.932e-3\nEWMD (vector) took 7.758e-3\n</code></pre>\n\n<p>(Those timings aren't very reliable; for accurate performance tests use <a href=\"http://hackage.haskell.org/package/criterion\" rel=\"noreferrer\">criterion</a>.)</p>\n\n<hr>\n\n<p>A better solution IMO would be to avoid this indexing business entirely \u2013 we're not writing Fortran, are we? IIRs like EWMA are better implemented in a purely \u201clocal\u201d manner; this can be expressed nicely in Haskell with a state monad, so you're independent of what container the data ships in.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Traversable\nimport Control.Monad (forM)\nimport Control.Monad.State\n\newma :: Traversable t =&gt; t Double -&gt; Double -&gt; t Double\newma x tau = (`evalState`0) . forM x $\n         \\xi -&gt; state $ \\carry\n            -&gt; let yi = a*xi + (1-a)*carry\n               in (yi, yi)\n where a = 1/tau\n</code></pre>\n\n<p>While we're at generalising: there's no reason to restrict this only to work with <code>Double</code> data; you can filter any <a href=\"http://hackage.haskell.org/package/vector-space-0.10.4/docs/Data-VectorSpace.html\" rel=\"noreferrer\">kind of variable that can be scaled and interpolated</a>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleContexts #-}\nimport Data.VectorSpace\n\newma :: (Traversable t, VectorSpace v, Fractional (Scalar v))\n             =&gt; t v -&gt; Scalar v -&gt; t v\newma x tau = (`evalState`zeroV) . forM x $\n         \\xi -&gt; state $ \\carry\n            -&gt; let yi = a*^xi ^+^ (1-a)*^carry\n               in (yi, yi)\n where a = 1/tau\n</code></pre>\n\n<p>This way, you can in principle use the same filter for motion-blurring video data stored in a lazily streamed infinite list of picture frames, as for lowpass-filtering a radio signal pulse stored in an unboxed <code>Vector</code>. (<code>VU.Vector</code> actually has no <code>Traversable</code> instance; you need to substitute  <a href=\"http://hackage.haskell.org/package/mono-traversable-1.0.1.2/docs/Data-MonoTraversable.html#v:oforM\" rel=\"noreferrer\"><code>oforM</code></a> then.)</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1487372349, "last_edit_date": 1487372349, "creation_date": 1487335277, "answer_id": 42298250, "question_id": 42295547, "link": "https://stackoverflow.com/questions/42295547/similar-code-for-exponentially-weighted-deviation-is-slower-in-haskell-than-in/42298250#42298250", "title": "Similar code (for exponentially weighted deviation) is slower in Haskell than in Python", "body": "<p>The following makes two recursive calls:</p>\n\n<pre><code>ewmaL ys tau = reverse $ e (reverse ys) (1.0/tau)\n    where e [x] a    = [a*x]\n          e (x:xs) a = (a*x + (1-a)*(head $ e xs a) : e xs a)\n</code></pre>\n\n<p>We can make one recursive call, and use the result for both cases:</p>\n\n<pre><code>ewmaLcse :: [Double] -&gt; Double -&gt; [Double]\newmaLcse ys tau = reverse $ e (reverse ys) (1.0/tau)\n    where e [x] a    = [a*x]\n          e (x:xs) a = (a*x + (1-a)*(head zs) : zs)\n                       where zs = e xs a\n</code></pre>\n\n<p>I also chose to benchmark the sum of the list, so to force all of it to be computed:</p>\n\n<pre><code>lV &lt;- timeIt $ sum $ ewmaL l tau\nputStrLn $ \"EWMA (list) took \"++lV\nlVcse &lt;- timeIt $ sum $ ewmaLcse l tau\nputStrLn $ \"EWMAcse (list) took \"++lVcse\n</code></pre>\n\n<p>Results, with <code>n=10000</code></p>\n\n<pre><code>Lists\nEWMA (list) took 2.384\nEWMAcse (list) took 0.0\n</code></pre>\n\n<p>with <code>n=20000</code></p>\n\n<pre><code>Lists\nEWMA (list) took 16.472\nEWMAcse (list) took 4.0e-3\n</code></pre>\n\n<p>By the way, one can also use standard library loops for this specific recursion. Here I resorted to <code>mapAccumL</code>: no need to double-reverse lists.</p>\n\n<pre><code>ewmaL2 :: [Double] -&gt; Double -&gt; [Double]\newmaL2 ys tau = snd $ mapAccumL e 0 ys\n    where a = 1/tau\n          e !prevAvg !y = (nextAvg,nextAvg)\n             where !nextAvg = a*y+(1-a)*prevAvg\n</code></pre>\n\n<p>(Actually, the fact that I am using <code>(nextAvg,nextAvg)</code> means that a simpler <code>scanl</code> would also do the job. Oh, well...)</p>\n"}, {"tags": [], "owner": {"reputation": 528, "user_id": 4636182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5403c86cb21ace416b4cb758fabb72b7?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya Prokin", "link": "https://stackoverflow.com/users/4636182/ilya-prokin"}, "is_accepted": false, "score": 3, "last_activity_date": 1487346052, "last_edit_date": 1495541830, "creation_date": 1487346052, "answer_id": 42301903, "question_id": 42295547, "link": "https://stackoverflow.com/questions/42295547/similar-code-for-exponentially-weighted-deviation-is-slower-in-haskell-than-in/42301903#42301903", "title": "Similar code (for exponentially weighted deviation) is slower in Haskell than in Python", "body": "<p>To add up to <a href=\"https://stackoverflow.com/a/42296139/4636182\">leftaroundabout's great answer</a>, I have eventually solved my problem using V.scanl:</p>\n\n<pre><code>ewma :: V.Vector Double -&gt; Double -&gt; V.Vector Double\newma x tau = V.tail $ V.scanl ma 0 x\n    where\n        ma avg x = x*a + (1-a)*avg\n        a = 1/tau\n</code></pre>\n\n<p>My guess is that scanl has <em>O(n)</em> complexity, not <em>O(n<sup>2</sup>)</em> as my initial code.\nWith unboxed vectors, it gives pretty decent performance.</p>\n"}], "owner": {"reputation": 528, "user_id": 4636182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5403c86cb21ace416b4cb758fabb72b7?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya Prokin", "link": "https://stackoverflow.com/users/4636182/ilya-prokin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 1, "accepted_answer_id": 42296139, "answer_count": 3, "score": 9, "last_activity_date": 1487372349, "creation_date": 1487327399, "question_id": 42295547, "link": "https://stackoverflow.com/questions/42295547/similar-code-for-exponentially-weighted-deviation-is-slower-in-haskell-than-in", "title": "Similar code (for exponentially weighted deviation) is slower in Haskell than in Python", "body": "<p>I implemented <a href=\"https://en.wikipedia.org/wiki/Exponential_smoothing\" rel=\"noreferrer\">exponentially weighted moving average</a> (ewma) in python3 and in Haskell (compiled). It takes about the same time. However when this function is applied twice, haskell version slows down unpredictably (more than 1000 times, whereas python version is only about 2 times slower). </p>\n\n<p>Python3 version:</p>\n\n<pre><code>import numpy as np\ndef ewma_f(y, tau):\n    a = 1/tau\n    avg = np.zeros_like(y)\n    for i in range(1, len(y)):\n        avg[i] = a*y[i-1]+(1-a)*avg[i-1]\n    return avg\n</code></pre>\n\n<p>Haskell with lists:</p>\n\n<pre><code>ewmaL :: [Double] -&gt; Double -&gt; [Double]\newmaL ys tau = reverse $ e (reverse ys) (1.0/tau)\n    where e [x] a    = [a*x]\n          e (x:xs) a = (a*x + (1-a)*(head $ e xs a) : e xs a)\n</code></pre>\n\n<p>Haskell with arrays:</p>\n\n<pre><code>import qualified Data.Vector as V\newmaV :: V.Vector Double -&gt; Double -&gt; V.Vector Double\newmaV x tau = V.map f $ V.enumFromN 0 (V.length x)\n    where\n        f (-1) = 0\n        f n    = (x V.! n)*a + (1-a)*(f (n-1))\n        a = 1/tau\n</code></pre>\n\n<p>In all cases, computation takes about the same time (tested for an array with 10000 elements).\nHaskell code was compiled without any flags, though \"ghc -O2\" didn't make any difference.</p>\n\n<p>I used computed ewma to compute absolute deviation from this ewma; I then applied ewma function to this deviation.</p>\n\n<p>Python3:</p>\n\n<pre><code>def ewmd_f(y, tau):\n    ewma = ewma_f(y, tau)\n    return ewma_f(np.abs(y-ewma), tau)\n</code></pre>\n\n<p>It runs twice longer compared to ewma.</p>\n\n<p>Haskell with lists:</p>\n\n<pre><code>ewmdL :: [Double] -&gt; Double -&gt; [Double]\newmdL xs tau = ewmaL devs tau\n    where devs = zipWith (\\ x y -&gt; abs $ x-y) xs avg\n          avg  = (ewmaL xs tau)\n</code></pre>\n\n<p>Haskell with vectors:</p>\n\n<pre><code>ewmdV :: V.Vector Double -&gt; Double -&gt; V.Vector Double\newmdV xs tau = ewmaV devs tau\n    where devs = V.zipWith (\\ x y -&gt; abs $ x-y) xs avg\n          avg  = ewmaV xs tau\n</code></pre>\n\n<p>Both ewmd run > 1000 slower than their ewma counterparts.</p>\n\n<p>I evaluated python3 code with:</p>\n\n<pre><code>from time import time\nx = np.sin(np.arange(10000))\ntau = 100.0\n\nt1 = time()\newma = ewma_f(x, tau)\nt2 = time()\newmd = ewmd_f(x, tau)\nt3 = time()\n\nprint(\"EWMA took {} s\".format(t2-t1))\nprint(\"EWMD took {} s\".format(t3-t2))\n</code></pre>\n\n<p>I evaluated Haskell code with:</p>\n\n<pre><code>import System.CPUTime\n\ntimeIt f = do\n    start &lt;- getCPUTime\n    end   &lt;- seq f getCPUTime\n    let d = (fromIntegral (end - start)) / (10^12) in\n        return (show d)\n\nmain = do\n    let n = 10000 :: Int\n    let tau = 100.0\n    let l = map sin [0.0..(fromIntegral $ n-1)]\n    let x = V.map sin $ V.enumFromN 0 n\n\n    putStrLn \"Vectors\"\n    aV &lt;- timeIt $ V.last $ ewmaV x tau\n    putStrLn $ \"EWMA (vector) took \"++aV\n    dV &lt;- timeIt $ V.last $ ewmdV x tau\n    putStrLn $ \"EWMD (vector) took \"++dV\n    putStrLn \"\"\n    putStrLn \"Lists\"\n    lV &lt;- timeIt $ last $ ewmaL l tau\n    putStrLn $ \"EWMA (list) took \"++lV\n    lD &lt;- timeIt $ last $ ewmdL l tau\n    putStrLn $ \"EWMD (list) took \"++lD\n</code></pre>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487373598, "post_id": 42294423, "comment_id": 71772954, "body": "FWIW Im not sure you&#39;ve disproved my solution yet - usually, if AllowAmbiguousTypes doesn&#39;t work, it results in a compile time error downstream. For that behaviour to manifest itself, the rule needs to be triggered in the first place. Triggering the rule sounds like a separate issue. Again, take my comment with a grain of salt - I could very well be completely wrong."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487326251, "post_id": 42295004, "comment_id": 71745217, "body": "@Clinton Please do! I am not completely certain that <code>AllowAmbiguousTypes</code> isn&#39;t just deferring a type error (that won&#39;t manifest itself until it tries to inline)."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1487326563, "post_id": 42295004, "comment_id": 71745455, "body": "I&#39;ll give this a go, thanks for the answer! (sorry deleted comment before instead of editing)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 4, "last_activity_date": 1487325936, "creation_date": 1487325936, "answer_id": 42295004, "question_id": 42294423, "link": "https://stackoverflow.com/questions/42294423/adding-context-to-rewrite-rules/42295004#42295004", "title": "Adding context to rewrite rules", "body": "<p>Normally, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#id80\" rel=\"nofollow noreferrer\">one can add type signatures to the variables in the <code>forall</code></a>. Something like</p>\n\n<pre><code>{-# RULES \"myrule\" forall (x :: H a =&gt; T a). g (f x) = h x #-}\n</code></pre>\n\n<p>Now, that doesn't <em>quite</em> work in this case because <code>T</code> may not be injective. Fortunately, I think <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#visible-type-application\" rel=\"nofollow noreferrer\"><code>TypeApplications</code></a> gives us a way out of this problem by allowing us to inform GHC that the type variable <code>a</code> in the type <code>T a</code> of <code>x</code> is the same as the one in <code>h</code>:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, TypeApplications, AllowAmbiguousTypes #-}\n\n ...\n\n{-# RULES \"myrule\" forall (x :: H a =&gt; T a). g (f x) = h @a x #-}\n</code></pre>\n\n<p>We don't need to enable <code>ScopedTypeVariables</code> (even if we are relying on it to make sure the <code>a</code>s are the same) because it is on by default in rewrite rules. </p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1487367364, "creation_date": 1487324415, "last_edit_date": 1487367364, "question_id": 42294423, "link": "https://stackoverflow.com/questions/42294423/adding-context-to-rewrite-rules", "title": "Adding context to rewrite rules", "body": "<p>In the following code, I want to rewrite <code>g . f</code> as <code>h</code> when possible. There may be cases <code>h</code> hasn't got the instance of class, but I'd like to do the rewrite when it's possible. I'm getting an error message suggesting this is achievable but I'm not sure exactly what I need to change.</p>\n\n<p>Here is some sample code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nmain = return ()\n\ndata D a\n\nf :: a -&gt; D a\nf = undefined\n\ntype family T a\n\nclass G a where\n  g :: D (T a) -&gt; a\n\nclass H a where\n  h :: T a -&gt; a\n\n{-# RULES\n  \"myrule\" forall x. g (f x) = h x\n#-}\n</code></pre>\n\n<p>An this is the error:</p>\n\n<pre><code>\u2022 Could not deduce (H a) arising from a use of \u2018h\u2019\n  from the context: G a\n    bound by the RULE \"myrule\" at trickyrewrite.hs:19:3-34\n  Possible fix: add (H a) to the context of the RULE \"myrule\"\n\u2022 In the expression: h x\n  When checking the transformation rule \"myrule\"\n</code></pre>\n\n<p>Note the possible fix: <strong><code>add (H a) to the context of the RULE \"myrule\"</code></strong>. This seems like it will do the job, but I'm not sure how to actually do this. <code>a</code> isn't even mentioned in the rule, so I'm not sure how adding <code>H a</code> will help when <code>a</code> doesn't refer to anything. </p>\n\n<p>If it makes any difference, the only code I control is the class <code>H</code>. I can't change <code>G</code>. My code is of course more complex than this, but if I can see a worked example of how to get this simplified example working I should be able to work out my code I think.</p>\n\n<p><strong>Failed attempt:</strong></p>\n\n<p>I've tried @Alec's suggestion below but it doesn't seem to work, the rewrite rule isn't being triggered. Here's the code I tried:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeApplications #-}\n\nmodule Main where\n\nmain = ((g (f (2 :: Int))) :: Char) `seq` return () \n\ndata D a\n\n{-# INLINE [1] f #-}\nf :: a -&gt; D a\nf = undefined\n\ntype family T a\ntype instance T Char = Int\n\n{-# INLINE [1] g' #-}\ng' :: (G a) =&gt; D (T a) -&gt; a\ng' = undefined\n\nclass G a where\n  g :: D (T a) -&gt; a\n  g = g'\n\ninstance G Char\n\nclass H a where\n  h :: T a -&gt; a\n\n{-# RULES\n  \"myrule\" forall (x :: H a =&gt; T a). g' (f x) = h @a x\n#-}\n</code></pre>\n"}, {"tags": ["haskell", "types", "continuations", "newtype", "type-synonyms"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1487326742, "post_id": 42293140, "comment_id": 71745575, "body": "The differences are the usual differences between <code>type</code> and <code>newtype</code>. <code>type</code> synonyms are just a new name for an existing type; they can&#39;t be partially applied and you can&#39;t make them an <code>instance</code> of a class. <code>newtype</code>s are separate from the types that they wrap and you can use them to write custom <code>instance</code>s. For example you&#39;ll have trouble writing an instance of <code>Monad</code> for the <code>type C</code>."}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1487338359, "post_id": 42293140, "comment_id": 71752913, "body": "Thanks @BenjaminHodgson - Do you want to make into an answer and I&#39;ll accept?"}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1487346232, "creation_date": 1487346232, "answer_id": 42301956, "question_id": 42293140, "link": "https://stackoverflow.com/questions/42293140/structuring-continuation-types/42301956#42301956", "title": "Structuring continuation types?", "body": "<p>The differences are the usual differences between <code>type</code> and <code>newtype</code>.</p>\n\n<p>A <code>type</code> synonym is just a new name for an existing type. <code>type</code> synonyms can't be partially applied, because the compiler expands the definition during type checking. For example, this is no good, even with <code>TypeSynonymInstances</code>:</p>\n\n<pre><code>type TypeCont r a = (a -&gt; r) -&gt; r\n\ninstance Monad (TypeCont r) where  -- \"The type synonym \u2018TypeCont\u2019 should have 2 arguments, but has been given 1\"\n    return x = ($ x)\n    k &gt;&gt;= f = \\q -&gt; k (\\x -&gt; (f x) q)\n</code></pre>\n\n<p><code>newtype</code>s, while operationally equivalent to the types they wrap, are separate entities in the type system. This means that <code>newtype</code>s <em>can</em> be partially applied.</p>\n\n<pre><code>newtype NewtypeCont r a = Cont { runCont :: (a -&gt; r) -&gt; r }\n\ninstance Monad (NewtypeCont r) where\n    return x = Cont ($ x)\n    Cont k &gt;&gt;= f = Cont $ \\q -&gt; k (\\x -&gt; runCont (f x) q)\n</code></pre>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "accepted_answer_id": 42301956, "answer_count": 1, "score": 6, "last_activity_date": 1513089696, "creation_date": 1487320791, "last_edit_date": 1513089696, "question_id": 42293140, "link": "https://stackoverflow.com/questions/42293140/structuring-continuation-types", "title": "Structuring continuation types?", "body": "<p>I'm going over continuations and I've come across two different approaches to structuring continuation types:</p>\n\n<pre><code>newtype C r a = C {runC :: (a -&gt; r) -&gt; r}\n\nexampleFunction :: String -&gt; C Bool String\nexampleFunction s = C $ \\t -&gt; if length s &gt; 10 then t s else False\n\ncontinuationFunction :: String -&gt; Bool\ncontinuationFunction s = True\n\nmain = do\n let suspendedFunc = exampleFunction \"testing\"\n let completedFunc = runC suspendedFunc $ continuationFunction\n</code></pre>\n\n<p>versus the approach taken in <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=7F9022E04C0AE213B74964BA29E2E69D?doi=10.1.1.39.8039&amp;rep=rep1&amp;type=pdf\" rel=\"noreferrer\">Poor Mans Concurrency</a>: </p>\n\n<pre><code>type C r a = (a -&gt; r) -&gt; r\n\nexampleFunction :: String -&gt; C Bool String\nexampleFunction s = \\t -&gt; if length s &gt; 10 then t s else False\n\n...\n</code></pre>\n\n<p>I understand that the latter approach doesn't use an explicit data constructor. </p>\n\n<ol>\n<li>What are the practical differences of these approaches? </li>\n<li><p>Will this impact when I try to use this over a general type with a monad? Such as: </p>\n\n<pre><code>data Hole = Hole1 Int | Hole2 String\n\ntype C r m a = (a -&gt; m r) -&gt; m r\n\nexampleFunction :: String -&gt; C Bool Maybe Hole\nexampleFunction s = \\t -&gt; do\n      x &lt;- t (Hole1 11)\n      y &lt;- t (Hole2 \"test\")\n      ...\n\ncontinuationFunction :: Hole -&gt; Bool\ncontinuationFunction (Hole1 x) = False\ncontinuationFunction (Hole2 y) = True  \n</code></pre></li>\n</ol>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 8, "last_activity_date": 1487316271, "creation_date": 1487316271, "answer_id": 42291803, "question_id": 42291558, "link": "https://stackoverflow.com/questions/42291558/why-are-float-and-double-different-in-the-case-of-adding-0-1-and-0-2/42291803#42291803", "title": "Why are Float and Double different in the case of adding 0.1 and 0.2?", "body": "<p><code>Double</code> is indeed more precise. And yes, there is something you should know about floating point representations in general: you have to be very careful about how you use them! <code>==</code> is generally unlikely to actually be useful. You're generally going to want to compare floating point representations using more specialized functions, or at least check if the representation lies within some range rather than whether it has a certain value according to the built-in approximation.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1487344959, "post_id": 42293440, "comment_id": 71757679, "body": "I personally try to avoid using the term &quot;floating point number&quot;. Floating point representations don&#39;t really look a whole lot like numbers when you start looking at the math. Types like <code>Int</code> and <code>Word</code> are certainly used as approximations to <code>Integer</code> and <code>Natural</code>, but they are themselves perfectly law-abiding commutative rings. Floating point representations, on the other hand, have virtually no nice properties: neither addition nor multiplication is associative, and multiplication doesn&#39;t distribute over addition."}], "tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 15, "last_activity_date": 1499018244, "last_edit_date": 1499018244, "creation_date": 1487321719, "answer_id": 42293440, "question_id": 42291558, "link": "https://stackoverflow.com/questions/42291558/why-are-float-and-double-different-in-the-case-of-adding-0-1-and-0-2/42293440#42293440", "title": "Why are Float and Double different in the case of adding 0.1 and 0.2?", "body": "<p>The first thing to realize is that when you enter <code>0.1::Double</code> and ghci prints <code>0.1</code> back, it's only an \"illusion:\"</p>\n\n<pre><code>Prelude Data.Ratio&gt; 0.1::Double\n0.1\n</code></pre>\n\n<p>Why is that an illusion? Because the number <code>0.1</code> is actually not precisely representable as a floating point number! This is true for both <code>Float</code> and <code>Double</code>. Observe:</p>\n\n<pre><code>Prelude Data.Ratio&gt; toRational (0.1::Float)\n13421773 % 134217728\nPrelude Data.Ratio&gt; toRational (0.1::Double)\n3602879701896397 % 36028797018963968\n</code></pre>\n\n<p>So, in reality, these numbers are indeed \"close\" to the actual real number <code>0.1</code>, but neither is precisely <code>0.1</code>. How close are they? Let's find out:</p>\n\n<pre><code>Prelude Data.Ratio&gt; toRational (0.1::Float) - (1%10)\n1 % 671088640\nPrelude Data.Ratio&gt; toRational (0.1::Double) - (1%10)\n1 % 180143985094819840\n</code></pre>\n\n<p>As you see, <code>Double</code> is indeed a lot more precise than <code>Float</code>; the difference between the representation of <code>0.1</code> as a <code>Double</code> and the actual real-number <code>0.1</code> is a lot smaller. But neither is precise.</p>\n\n<p>So, indeed the <code>Double</code> addition is a lot more precise, and should be preferred over the <code>Float</code> version. The confusing equality you see is nothing but the weird effect of rounding. The results of <code>==</code> should <em>not</em> be trusted in the floating-point land. In fact, there are many floating point numbers <code>x</code> such that <code>x == x + 1</code> holds. Here's one example:</p>\n\n<pre><code>Prelude&gt; let x = -2.1474836e9::Float\nPrelude&gt; x == x + 1\nTrue\n</code></pre>\n\n<p>A good read on floating-point representation is the classic <a href=\"https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\" rel=\"nofollow noreferrer\">What Every Computer Scientist Should Know about Floating-Point Arithmetic</a>, which explains many of these quirky aspects of floating-point arithmetic.</p>\n\n<p>Also note that this behavior is not unique to  Haskell. Any language that uses <a href=\"http://en.wikipedia.org/wiki/IEEE_floating_point\" rel=\"nofollow noreferrer\">IEEE754 Floating-point arithmetic</a> will behave this way, which is the standard implemented by modern microprocessors.</p>\n"}], "owner": {"reputation": 356, "user_id": 536342, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f354d52ac79638d5bc6b967981ef9945?s=128&d=identicon&r=PG", "display_name": "pikapika", "link": "https://stackoverflow.com/users/536342/pikapika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1499018244, "creation_date": 1487315446, "question_id": 42291558, "link": "https://stackoverflow.com/questions/42291558/why-are-float-and-double-different-in-the-case-of-adding-0-1-and-0-2", "title": "Why are Float and Double different in the case of adding 0.1 and 0.2?", "body": "<p>Can someone explain why</p>\n\n<pre><code>(0.1::Float) + (0.2::Float) == (0.3::Float)                                                                                                      \n</code></pre>\n\n<p>while </p>\n\n<pre><code>(0.1::Double) + (0.2::Double) /= (0.3::Double)\n</code></pre>\n\n<p>To my knowledge Double is supposed to be more precise. Is there something about Float I should know about?    </p>\n"}, {"tags": ["haskell", "recursion-schemes"], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1487363557, "creation_date": 1487309362, "last_edit_date": 1487363557, "question_id": 42290100, "link": "https://stackoverflow.com/questions/42290100/applying-a-local-match-rewrite-globally-using-recursion-schemes", "title": "Applying a local match/rewrite globally using recursion schemes", "body": "<pre><code>{-# LANGUAGE FlexibleContexts, DeriveFoldable, TemplateHaskell,\n    TypeFamilies, DeriveFunctor, DeriveTraversable #-}\nimport Control.Applicative\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\nimport Data.Maybe\n</code></pre>\n\n<p>I want to rewrite a tree using a \"local\" rewriter:</p>\n\n<pre><code>data SKI = S | K | I | App SKI SKI deriving (Show)\n\nmakeBaseFunctor ''SKI\n\ntype Rewrite a = a -&gt; Maybe a\n\nmatch :: Rewrite SKI\nmatch x = case x of\n    App I x -&gt; Just x\n    _ -&gt; Nothing\n</code></pre>\n\n<p>So I wrote <code>rewriteGlobal</code> function that applies the same <code>match</code> at different points in the tree. It takes a \"local\" <code>Rewrite t</code> and returns a global one. I only walk the tree once, there are no attempts to apply rewrites more than once per tree node until no more rewrites are possible.</p>\n\n<p>However there are 2 ways to rewrite the tree. Each rewrite operates either on already rewritten subtree (<code>WithChildren</code> mode) or \"original\" subtree (<code>WithoutChildren</code> mode). In the latter case, the higher rewrite \"wins\".</p>\n\n<p>Ignoring constraints on <code>t</code>, the type of <code>rewriteGlobal</code> is:</p>\n\n<pre><code>data ChildRewrites = WithChildren | WithoutChildren\n\nrewriteGlobal :: ChildRewrites -&gt; Rewrite t -&gt; Rewrite t\n</code></pre>\n\n<p>Here is an implementation:</p>\n\n<pre><code>rewriteGlobal flag rewriteFn = para $ liftA2 (&lt;|&gt;)\n    (rewriteFn . handleChildren flag)\n    liftChildRewrites\n\nhandleChildren WithChildren = embed . fmap (uncurry fromMaybe)\nhandleChildren WithoutChildren = embed . fmap fst\n\nliftChildRewrites cons | any (isJust . snd) cons = Just $ handleChildren WithChildren cons\nliftChildRewrites _ = Nothing\n</code></pre>\n\n<p><code>liftChildRewrites</code> and <code>liftA2 (&lt;|&gt;)</code> look particularly ugly.</p>\n\n<p>The question is: cannot I do any better? The code is already short, so it's not about making it shorter. But am I heading in the right direction, or there are better approaches to distribution of local matches than a paramorphism, e.g. a better data structure, a monadic approach or a recursion scheme? </p>\n\n<p>I don't have binders/names/capture avoiding substitutions, so (P)HOAS and similar approaches probably won't be any better. And I'm not implementing the SKI calculus, it's only a motivating example.</p>\n\n<p>The following code can be used to test:</p>\n\n<pre><code>test = App I $ App S $ App I $ K\n\nbar = [rewrite WithChildren match test, rewrite WithoutChildren match test]\n</code></pre>\n\n<p>The question is: are there any specific structures/methods designed for local rewrites? It's only opinion-based if such specialized approaches don't exist and general methods is the best I can do.</p>\n"}, {"tags": ["haskell", "cabal", "ghc-mod"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1487336710, "post_id": 42289494, "comment_id": 71751888, "body": "Well, have you checked what the config.log says for more details?"}, {"owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1487352925, "post_id": 42289494, "comment_id": 71762999, "body": "@Cubic- No additional information in the old-time.log, and I don&#39;t find any config.log file anywhere."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487357288, "post_id": 42289494, "comment_id": 71765378, "body": "Random guess: the autoconf script doesn&#39;t give a damn about windows, and paths with spaces aren&#39;t allowed. This is really the fault of ghc-mod for depending on a long deprecated package, but you can&#39;t really expect to avoid dependency hell with such a monstrosity of a package if you want &#39;backward-compatibility&#39;."}, {"owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1487369027, "post_id": 42289494, "comment_id": 71771346, "body": "Wow - good job - fixed it. many thanks."}, {"owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1487372130, "post_id": 42289494, "comment_id": 71772564, "body": "Surprising because the Windows install package, puts a space in the install path! (../Haskell Package). I had to take it out, change all the environment references, and then it worked."}], "owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 512, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487352994, "creation_date": 1487306234, "last_edit_date": 1487352994, "question_id": 42289494, "link": "https://stackoverflow.com/questions/42289494/cabal-install-ghc-mod-fails", "title": "cabal install ghc-mod fails", "body": "<p>Running Haskell platform 8.0.1 on Windows 10-64;\neverything seems fine, but \"cabal install ghc-mod\" fails;\n(cabal-install version 1.24.0.0)</p>\n\n<pre><code>&gt;cabal install ghc-mod\nResolving dependencies...\nConfiguring old-time-1.1.0.3...\nFailed to install old-time-1.1.0.3\nBuild log ( C:\\Users\\guthrie\\AppData\\Roaming\\cabal\\logs\\old-time-1.1.0.3.log ):\nConfiguring old-time-1.1.0.3...\nconfigure: WARNING: unrecognized options: --with-compiler\nchecking for gcc... e:\\PLang\\Haskell Platform\\8.0.1\\mingw\\bin\\gcc.exe\nchecking whether the C compiler works... no\nconfigure: error: in `/tmp/cabal-tmp-7812/old-time-1.1.0.3':\nconfigure: error: C compiler cannot create executables\nSee `config.log' for more details\ncabal: Leaving directory 'C:\\Users\\guthrie\\AppData\\Local\\Temp\\cabal-tmp-7812\\old-time-1.1.0.3'\ncabal: Error: some packages failed to install:\ncpphs-1.20.3 depends on old-time-1.1.0.3 which failed to install.\nghc-mod-5.7.0.0 depends on old-time-1.1.0.3 which failed to install.\nhaskell-src-exts-1.18.2 depends on old-time-1.1.0.3 which failed to install.\nhlint-1.9.41 depends on old-time-1.1.0.3 which failed to install.\nold-time-1.1.0.3 failed during the configure step. The exception was:\nExitFailure 77\n</code></pre>\n\n<p>However the gcc compiler does seem to run fine, and the directory path to it is correct.</p>\n\n<p>There are a lot of similar problem reports like this on cabal install ghc.mod, but they all had different errors than this (that I found).</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487322116, "post_id": 42288942, "comment_id": 71742273, "body": "This reduction is semantically correct, but fails to show that this is computed in linear time -- we still have a quadratic complexity in this reduction. This might confuse the OP."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487322425, "post_id": 42288942, "comment_id": 71742462, "body": "Right, but I don&#39;t know how I&#39;d show that while still answering the original question of how <code>x</code> is &quot;updated&quot;."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1487302652, "creation_date": 1487302652, "answer_id": 42288942, "question_id": 42288912, "link": "https://stackoverflow.com/questions/42288912/evaluation-of-where-clause-in-cyclic-lists/42288942#42288942", "title": "Evaluation of where clause in cyclic lists", "body": "<p>Let's unroll the recursion in <code>iterate2</code>:</p>\n\n<pre><code>xs = x : map f xs\n   = x : map f (x : map f xs)                          -- Inline xs\n   = x : (f x) : map f (map f xs)                      -- Definition of map\n   = x : (f x) : map f (map f (x : map f xs))          -- Inline xs\n   = x : (f x) : map f ((f x) : map f (map f xs))      -- Definition of map\n   = x : (f x) : (f (f x)) : map f (map f (map f xs))) -- Definition of map\n   ...\n</code></pre>\n\n<p>So you can see that the list returned by <code>iterate2 f x</code> has <code>x</code> as the first element, <code>f x</code> as the second, and so on.</p>\n"}, {"comments": [{"owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "edited": false, "score": 0, "creation_date": 1487440435, "post_id": 42293803, "comment_id": 71790595, "body": "Thank you! For me, finding the right visualization is often the biggest obstacle to understanding a recursion."}, {"owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "edited": false, "score": 0, "creation_date": 1487441341, "post_id": 42293803, "comment_id": 71790952, "body": "One follow-up question: Does iterate3 produce a cyclic list? The text is slightly ambiguous on this point."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "reply_to_user": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "edited": false, "score": 1, "creation_date": 1487443875, "post_id": 42293803, "comment_id": 71791750, "body": "@planarian I would say that the list itself doesn&#39;t have any cycles \u2013 no matter how much of it you evaluate, you will not &quot;come back&quot; to a previous element \u2013 but you could claim that its definition has one. (That is, it&#39;s a &quot;cyclic definition of a list&quot; but not &quot;a definition of a cyclical list&quot;.)"}], "tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": true, "score": 4, "last_activity_date": 1487334683, "last_edit_date": 1487334683, "creation_date": 1487322770, "answer_id": 42293803, "question_id": 42288912, "link": "https://stackoverflow.com/questions/42288912/evaluation-of-where-clause-in-cyclic-lists/42293803#42293803", "title": "Evaluation of where clause in cyclic lists", "body": "<p>The important detail is that <code>xs</code> in <code>iterate2</code> is defined in terms of itself, creating a circular structure.<br>\n(This is sometimes called \"tying the knot\".)</p>\n\n<p>Visualizing it as a graph, the evaluation goes something like this (warning: ASCII art).</p>\n\n<p><code>xs where xs = 1 : map (2*) xs</code>:</p>\n\n<pre><code>     :  &lt;----------+\n   /   \\           | applies to\n  1    map (2*)  --+\n</code></pre>\n\n<p><code>--&gt;</code></p>\n\n<pre><code>     :\n   /   \\\n  1     :  &lt;--------+   \n      /   \\         | applies to\n     2   map (2*) --+\n</code></pre>\n\n<p><code>--&gt;</code></p>\n\n<pre><code>     :\n   /   \\\n  1     : \n      /   \\\n     2     : &lt;---------+\n         /   \\         | applies to\n        4   map (2*) --+\n</code></pre>\n\n<p>And so on.</p>\n"}], "owner": {"reputation": 1877, "user_id": 965613, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/UiRBe.png?s=128&g=1", "display_name": "planarian", "link": "https://stackoverflow.com/users/965613/planarian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 42293803, "answer_count": 2, "score": 3, "last_activity_date": 1487334683, "creation_date": 1487302402, "last_edit_date": 1487305033, "question_id": 42288912, "link": "https://stackoverflow.com/questions/42288912/evaluation-of-where-clause-in-cyclic-lists", "title": "Evaluation of where clause in cyclic lists", "body": "<p>In <em>Thinking Functionally in Haskell</em> (p 213), we're shown two versions of a cyclic list. One evaluates in quadratic time:</p>\n\n<pre><code>iterate3 f x = x:map f (iterate3 f x)\n\niterate3 (2*) 1\n= 1:map (2*) (iterate3 (2*) 1)\n= 1:2:map (2*) (map (2*) (iterate3 (2*) 1))\n= 1:2:4:map (2*) (map (2*) (map (2*) (iterate3 (2*) 1)))\n</code></pre>\n\n<p>The other, which uses <code>where</code>, evaluates in linear time:</p>\n\n<pre><code>iterate2 f x = xs where xs = x:map f xs\n\niterate2 (2*) 1    \nxs          where xs = 1:map (2*) xs\n= 1:ys      where ys = map (2*) (1:ys)\n= 1:2:zs    where zs = map (2*) (2:zs)\n= 1:2:4:ts  where ts = map (2*) (4:ts)\n</code></pre>\n\n<p>I don't quite understand this evaluation. How is x getting reassigned to each successive list element, instead of 1 (as in the first version)?</p>\n"}, {"tags": ["haskell", "ghc", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1487287990, "post_id": 42285286, "comment_id": 71729914, "body": "Oh wow, I am surprised to see that <code>ApplicativeDo</code> did not handle this rather obvious case!"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1487296462, "post_id": 42285286, "comment_id": 71732423, "body": "<code>ApplicativeDo</code> is quite dumb.  E.g. it can&#39;t handle a <code>let</code> statement of any sort whatsoever"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1487308812, "post_id": 42285286, "comment_id": 71736008, "body": "I had a similar problem: <a href=\"http://stackoverflow.com/questions/41210599/applicativedo-not-working-with-sequencing\" title=\"applicativedo not working with sequencing\">stackoverflow.com/questions/41210599/&hellip;</a>"}, {"owner": {"reputation": 1416, "user_id": 1769679, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NIcLL.png?s=128&g=1", "display_name": "Asa", "link": "https://stackoverflow.com/users/1769679/asa"}, "edited": false, "score": 0, "creation_date": 1487310237, "post_id": 42285286, "comment_id": 71736523, "body": "Oh look at that. I&#39;m surprised that this question didn&#39;t show up in my search. It is very similar"}], "tags": [], "owner": {"reputation": 1416, "user_id": 1769679, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NIcLL.png?s=128&g=1", "display_name": "Asa", "link": "https://stackoverflow.com/users/1769679/asa"}, "is_accepted": true, "score": 14, "last_activity_date": 1487281637, "creation_date": 1487281637, "answer_id": 42285286, "question_id": 42285105, "link": "https://stackoverflow.com/questions/42285105/applicativedo-language-extension-with-parsing-applicative-still-looking-for-mo/42285286#42285286", "title": "ApplicativeDo language extension with `Parsing` applicative still looking for Monad instance", "body": "<p>Figured it out. To get this example to work on ghc 8.0.2 you would need to add underscore generators, like this:</p>\n\n<pre><code>{-# LANGUAGE ApplicativeDo #-}\nimport Text.Parser.Char (string, spaces)\nimport Text.Parser.Token (TokenParsing, natural)\n\nissueParser :: TokenParsing p =&gt; p Integer\nissueParser = do\n  _ &lt;- spaces\n  _ &lt;- string \"**Issue:**\"\n  _ &lt;- spaces\n  _ &lt;- string \"https://github.com\" &lt;|&gt; string \"github.com\"\n  _ &lt;- string \"/commercialhaskell/stack/issues/\"\n  n &lt;- natural\n  pure n\n</code></pre>\n\n<p>There is already a ghc bug to address this here: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12666\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/12666</a></p>\n"}], "owner": {"reputation": 1416, "user_id": 1769679, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NIcLL.png?s=128&g=1", "display_name": "Asa", "link": "https://stackoverflow.com/users/1769679/asa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 42285286, "answer_count": 1, "score": 11, "last_activity_date": 1487281637, "creation_date": 1487280944, "question_id": 42285105, "link": "https://stackoverflow.com/questions/42285105/applicativedo-language-extension-with-parsing-applicative-still-looking-for-mo", "title": "ApplicativeDo language extension with `Parsing` applicative still looking for Monad instance", "body": "<p>I'm trying to write a parser using the <code>parsers</code> <a href=\"https://www.stackage.org/haddock/lts-8.0/parsers-0.12.4/Text-Parser-Token.html#t:TokenParsing\" rel=\"noreferrer\">package</a> using <code>do</code> syntax. Here is an example:</p>\n\n<pre><code>{-# LANGUAGE ApplicativeDo #-}\nimport Text.Parser.Char (string, spaces)\nimport Text.Parser.Token (TokenParsing, natural)\n\nissueParser :: TokenParsing p =&gt; p Integer\nissueParser = do\n  spaces\n  string \"**Issue:**\"\n  spaces\n  string \"https://github.com\" &lt;|&gt; string \"github.com\"\n  string \"/commercialhaskell/stack/issues/\"\n  natural\n</code></pre>\n\n<p>The error GHC gives me is <code>Could not deduce (Monad p) arising from a do statement from the context: TokenParsing p</code>. This error message is correct that <code>TokenParsing</code> does not provide <code>Monad</code> as a super class, however it does provide <code>Applicative</code> which means because I have this language extension turned on, I should be able to use the <code>do</code> syntax with just <code>Applicative</code>. What am I doing wrong/missing here? </p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1487281884, "post_id": 42284879, "comment_id": 71727376, "body": "<a href=\"http://www.math.mcgill.ca/barr/papers/ttt.pdf\" rel=\"nofollow noreferrer\">Here</a> is a great book which covers this topic from the perspective of category theory (in particular, p257 &quot;Distributive laws&quot;) and gives a <i>relatively</i> (from the point of view of someone who already knows category theory...) simple proof of the necessary condition for <code>M . N</code> to be a monad if <code>M</code> and <code>N</code> are monads. <a href=\"http://stackoverflow.com/questions/29453915/composing-monads-v-applicative-functors\">Here</a> is another question which presents a slight variation on the code you have given - perhaps it would be a more useful starting point."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1487281994, "post_id": 42284879, "comment_id": 71727437, "body": "Spoiler: it is."}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487282050, "post_id": 42284879, "comment_id": 71727464, "body": "Lol, thank you! I had read that thread not all that long ago, but missed <a href=\"http://stackoverflow.com/questions/29453915/composing-monads-v-applicative-functors#comment47075703_29454112\">this comment</a>, which contains a positive answer."}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487282250, "post_id": 42284879, "comment_id": 71727569, "body": "It is somewhat sad, if obvious in retrospect, that layering State over List in this way doesn&#39;t give you <i>nondeterministic state</i>, in contrast to what happens when you layer StateT over List."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487282876, "post_id": 42284879, "comment_id": 71727892, "body": "I&#39;m not sure if I would ever ascribe the word <i>sad</i> to a mathematical result (unless you are saying the result makes <i>you</i> sad) .. However, there probably is a different property for which, if it holds, then <code>M . N</code> and <code>N . M</code> are isomorphic monads. What that property is, I don&#39;t know - but if it interests you and you investigate it a bit, it would probably make another good question."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 4, "creation_date": 1487283256, "post_id": 42284879, "comment_id": 71728055, "body": "If <code>Traversable n</code> is the perfect constraint to make this work, it would be nice if <code>Data.Functor.Compose</code> had the instance. Maybe you should suggest it? I can definitely think of a context where I might use it."}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1487290515, "post_id": 42284879, "comment_id": 71730788, "body": "Aside from the obvious point that the laws would need to be proved for arbitrary traversables (beyond my pay grade), it was pointed out to me that <code>instance ... =&gt; Monad (Compose m n) where ...</code> would prevent any other monad instances for <code>Compose</code> from being defined (on pain of overlapping instances). So the instance here would need to be totally general. Is it?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1487291242, "post_id": 42284879, "comment_id": 71730987, "body": "Yes, that&#39;s why I began &#39;if Traversable n is the perfect constraint ...&#39; Maybe that was a little obscure. We don&#39;t want more than one instance surely, just the most general (correct) one."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1487340106, "post_id": 42284879, "comment_id": 71754106, "body": "It seems like <code>Representable n</code> or <code>Distributive n</code> (or something like that with few types that are also monads) is more the correct constraint, which is a drag. One should have guessed this from the reputation of <code>ListT</code>"}], "answers": [{"comments": [{"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1487337848, "post_id": 42298943, "comment_id": 71752564, "body": "I think I&#39;m missing something obvious. Since <code>[]</code> is traversable, but <code>(-&gt;) r</code> isn&#39;t, the recipes above would provide a way to derive a Reader-over-List  (or Set) monad, but not a List-over-Reader monad, which is what my previous question was asking about."}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1487338385, "post_id": 42298943, "comment_id": 71752928, "body": "Sorry, I see now why <code>(-&gt;) Bool</code> is indeed traversable. Is <code>(-&gt;) r</code> traversable, for any finite <code>r</code> (along the lines hinted at in the question you linked to)?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 1, "creation_date": 1487338402, "post_id": 42298943, "comment_id": 71752945, "body": "<code>(-&gt;) Bool</code>, or <code>(-&gt;) r</code> for any finite type <code>r</code>, is traversable since it&#39;s equivalent to an <code>|r|</code>-tuple."}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1487430389, "post_id": 42298943, "comment_id": 71786945, "body": "A quick followup. Is the <i>if</i> in the wiki article you linked a literal <i>if</i> (the existence of a distributive law is a sufficient condition on the composite functor being monadic) or a mathematician&#39;s <i>if</i> (sufficient, and necessary)?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 1, "creation_date": 1487436109, "post_id": 42298943, "comment_id": 71788972, "body": "I checked that the bottom-right diagram is necessary for ST to be a monad in the specified way (it follows from unit laws for S, T, and ST). I&#39;m guessing that the other diagrams can be proved to be necessary in a similar fashion, since they are also equations between morphisms to ST, but I don&#39;t see any particular reason to think a priori that they <i>must</i> be necessary."}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1487601491, "post_id": 42298943, "comment_id": 71845883, "body": "<a href=\"https://gist.github.com/schar/3b640ec63cedb84b1221d7363f3099bf\" rel=\"nofollow noreferrer\">This code</a> is just  an unpacking of Reid&#39;s excellent answer, but I found it helpful to work through a concrete case. (It is still rather surprising to me that things go awry in this way, since the relevant <code>sequence</code> operation in the non-monadic case seems to preserve information.) Incidentally, Reid&#39;s point here seems under-appreciated. SO is full of comments to the effect that traversability is precisely the required constraint on the inner monad."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1487608175, "post_id": 42298943, "comment_id": 71850329, "body": "To be honest, I was vaguely under the same impression until I spent a while thinking about your other question."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 7, "last_activity_date": 1487337347, "last_edit_date": 1495540516, "creation_date": 1487337347, "answer_id": 42298943, "question_id": 42284879, "link": "https://stackoverflow.com/questions/42284879/is-the-composition-of-an-arbitrary-monad-with-a-traversable-always-a-monad/42298943#42298943", "title": "Is the composition of an arbitrary monad with a traversable always a monad?", "body": "<p>No, it's not always a monad. You need extra compatibility conditions relating the monad operations of the two monads and the distributive law <code>sequence :: n (m a) -&gt; m (n a)</code>, as described for example on <a href=\"https://en.wikipedia.org/wiki/Distributive_law_between_monads\" rel=\"nofollow noreferrer\">Wikipedia</a>.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/42262575/does-a-powerset-over-reader-monad-exist\">Your previous question</a> gives an example in which the compatibility conditions are not met, namely</p>\n\n<p>S = <code>m = []</code>, with unit X -> SX sending x to [x];</p>\n\n<p>T = <code>n = (-&gt;) Bool</code>, or equivalently TX = X \u00d7 X, with unit X -> TX sending x to (x,x).</p>\n\n<p>The bottom right diagram on the Wikipedia page does not commute, since the composition S -> TS -> ST sends <code>xs :: [a]</code> to <code>(xs,xs)</code> and then to the Cartesian product of all pairs drawn from <code>xs</code>; while the right-hand map S -> ST sends <code>xs</code> to the \"diagonal\" consisting of only the pairs <code>(x,x)</code> for <code>x</code> in <code>xs</code>. It is the same problem that caused your proposed monad to not satisfy one of the unit laws.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1523323627, "last_edit_date": 1523323627, "creation_date": 1487431375, "answer_id": 42317011, "question_id": 42284879, "link": "https://stackoverflow.com/questions/42284879/is-the-composition-of-an-arbitrary-monad-with-a-traversable-always-a-monad/42317011#42317011", "title": "Is the composition of an arbitrary monad with a traversable always a monad?", "body": "<p>A few additional remarks, to make the connection between <a href=\"https://stackoverflow.com/a/42298943/2751851\">Reid Barton's general answer</a> and your concrete question more explicit.</p>\n\n<p>In this case, it really pays off to work out your <code>Monad</code> instance in terms of <code>join</code>:</p>\n\n<pre><code>join' ::  m (n (m (n b))) -&gt; m (n b)\njoin' = fmap join . join . fmap sequence\n</code></pre>\n\n<p>By reintroducing <code>compose</code>/<code>getCompose</code> in the appropriate places and using <code>m &gt;&gt;= f = join (fmap f m)</code>, you can verify that this is indeed equivalent to your definition (note that your <code>prebind</code> amounts to the <code>fmap f</code> in that equation).</p>\n\n<p>This definition makes it comfortable to verify the laws with diagrams<sup>1</sup>. Here is one for <code>join . return = id</code> i.e. <code>(fmap join . join . fmap sequence) . (return . return) = id</code>:</p>\n\n<pre>\n3210\n  MT  id     MT  id    MT  id   MT\n     ---->      ---->     ---->\n rT2 |   |  rT1 |   | rT1 |   | id\n rM3 V   V  rM3 V   V     V   V\n     ---->      ---->     ---->\nMTMT  sM2  MMTT  jM2  MTT  jT0  MT\n</pre>\n\n<p>The overall rectangle is the monad law:</p>\n\n<pre>\n M   id   M\n    ---->     \nrM1 |   | id \n    V   V  \n    ---->     \n MM  jM0  M\n</pre>\n\n<p>Ignoring the parts that are necessarily the same both ways across the squares, we see that the two rightmost squares amount to the same law. (It is of course a little silly to call these \"squares\" and \"rectangles\", given all the <code>id</code> sides they have, but it fits better my limited ASCII art skills.) The first square, though, amounts to <code>sequence . return = fmap return</code>, which is the lower right diagram in the Wikipedia page Reid Barton mentions...</p>\n\n<pre>\n M   id   M\n    ---->     \nrT1 |   | rT0 \n    V   V  \n    ---->     \n TM  sM1  MT  \n</pre>\n\n<p>... and it is not a given that that holds, as Reid Barton's answer shows.</p>\n\n<p>If we apply the same strategy to the <code>join . fmap return = id</code> law, the upper right diagram, <code>sequence . fmap return = return</code>, shows up -- that, however, is not a problem in and of itself, as that is just (an immediate consequence of) the identity law of <code>Traversable</code>. Finally, doing the same thing with the <code>join . fmap join = join . join</code> law makes the other two diagrams -- <code>sequence . fmap join = join . fmap sequence . sequence</code> and <code>sequence . join = fmap join . sequence . fmap sequence</code> -- spring forth.</p>\n\n<hr>\n\n<p>Footnotes:</p>\n\n<ol>\n<li>Legend for the shorthand: <code>r</code> is <code>return</code>, <code>s</code> is <code>sequence</code> and <code>j</code> is <code>join</code>. The upper case letters and numbers after the function abbreviations disambiguate the involved monad and the position its introduced or changed layer <em>ends up at</em> -- in the case of <code>s</code>, that refers to what is <em>initially</em> the inner layer, as in this case we know that the outer layer is always a <code>T</code>. The layers are numbered from bottom to top, starting from zero. Composition is indicated by writing the shorthand for the second function below the first one.</li>\n</ol>\n"}], "owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 868, "favorite_count": 5, "accepted_answer_id": 42298943, "answer_count": 2, "score": 17, "last_activity_date": 1523323627, "creation_date": 1487280101, "last_edit_date": 1487281881, "question_id": 42284879, "link": "https://stackoverflow.com/questions/42284879/is-the-composition-of-an-arbitrary-monad-with-a-traversable-always-a-monad", "title": "Is the composition of an arbitrary monad with a traversable always a monad?", "body": "<p>If I have two monads <code>m</code> and <code>n</code>, and <code>n</code> is traversable, do I necessarily have a composite <code>m</code>-over-<code>n</code> monad?</p>\n\n<p>More formally, here's what I have in mind:</p>\n\n<pre><code>import Control.Monad\nimport Data.Functor.Compose\n\nprebind :: (Monad m, Monad n) =&gt;\n         m (n a) -&gt; (a -&gt; m (n b)) -&gt; m (n (m (n b)))\nmnx `prebind` f = do nx &lt;- mnx\n                     return $ do x &lt;- nx\n                                 return $ f x\n\ninstance (Monad m, Monad n, Traversable n) =&gt; Monad (Compose m n) where\n  return = Compose . return . return\n  Compose mnmnx &gt;&gt;= f = Compose $ do nmnx &lt;- mnmnx `prebind` (getCompose . f)\n                                     nnx  &lt;- sequence nmnx\n                                     return $ join nnx\n</code></pre>\n\n<p>Naturally, this type-checks, and I believe works for a few cases that I checked (Reader over List, State over List) -- as in, the composed 'monad' satisfies the monad laws -- but I'm unsure if this is a <em>general</em> recipe for layering any monad over a traversable one.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487275018, "post_id": 42283200, "comment_id": 71723481, "body": "Really? Not a single person that has used the gloss examples that can tell me how?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1487276210, "post_id": 42283200, "comment_id": 71724147, "body": "Seriously, you say that after a half hour?  Don&#39;t expect real-time interaction on stack overflow.  If you&#39;d like timely interaction then I suggest you join the IRC channel."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487277674, "post_id": 42283200, "comment_id": 71725023, "body": "@OfeliavanAnalhard The people who answer on SO are doing so for free. You&#39;ve asked lots of questions but never answered any - why should you expect others to answer when you don&#39;t?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487278822, "post_id": 42283200, "comment_id": 71725746, "body": "@OfeliavanAnalhard Also, I&#39;ve noticed you&#39;ve ever only accepted one answer to questions you&#39;ve asked. That would be a good way to start giving back to the community"}], "answers": [{"comments": [{"owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487276757, "post_id": 42283742, "comment_id": 71724469, "body": "I navigated to my .cabal folder (which is hidden) through the terminal using sudo. But there is no folder there called bin, and there are no executables. The only trace of the examples are two unpacked archive files gloss-examples-1.10.2.4.tar.gz\t and\tgloss-examples-1.10.2.4.tar.gz.etag inside an folder named gloss-examples. Where are the executables?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487280027, "post_id": 42283742, "comment_id": 71726399, "body": "1. You shouldn&#39;t need <code>sudo</code> - that you seemed to need to suggests another problem. Perhaps you installed something with sudo (bad) and the permissions are now incorrect which prevents <code>cabal install</code> from functioning properly? 2. The examples are where-ever you have cabal installing them.  Did you use <code>cabal install gloss-examples</code>?  What was the output?  Is there a sandbox in the directory where you executed <code>cabal install</code>?"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1487276159, "creation_date": 1487276159, "answer_id": 42283742, "question_id": 42283200, "link": "https://stackoverflow.com/questions/42283200/how-do-i-use-the-gloss-examples-package/42283742#42283742", "title": "How do I use the gloss-examples package?", "body": "<p>The gloss-examples package does not install any modules and you do not work with it as a library.  Instead, it builds executables (see <a href=\"http://hackage.haskell.org/package/gloss-examples-1.10.2.4/gloss-examples.cabal\" rel=\"nofollow noreferrer\">here</a>) under the names <code>gloss-*</code>.  Just run those executables which are wherever you have cabal installing the binaries (typically <code>$HOME/.cabal/bin</code>). </p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1487278832, "last_edit_date": 1495540406, "creation_date": 1487277116, "answer_id": 42284023, "question_id": 42283200, "link": "https://stackoverflow.com/questions/42283200/how-do-i-use-the-gloss-examples-package/42284023#42284023", "title": "How do I use the gloss-examples package?", "body": "<p>Building <em>gloss-examples</em> produces a handful of executables, as specified by the <a href=\"http://hackage.haskell.org/package/gloss-examples-1.10.2.4/src/gloss-examples.cabal\" rel=\"nofollow noreferrer\"><code>Executable</code> entries  in the .cabal file</a>. (Another telltale sign of executable-only packages is the lack of entries for modules at the <a href=\"http://hackage.haskell.org/package/gloss-examples\" rel=\"nofollow noreferrer\">front page of the Hackage docs</a>.) In Linux, the default destination of such executables is <code>~/.cabal/bin</code>. According to <a href=\"https://stackoverflow.com/q/14918251/2751851\">the answers to this question</a>, in OS X the default is <code>~/Library/Haskell/bin/cabal</code>, unless you are using the Homebrew package manager, which changes it to <code>~/.cabal/bin</code>. In Windows, it is <code>%APPDATA%\\cabal\\bin</code>. See also: <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#installation-paths\" rel=\"nofollow noreferrer\">the <em>Installation paths</em> section in Cabal's user guide</a>. </p>\n"}], "owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1487279531, "creation_date": 1487274186, "last_edit_date": 1487279531, "question_id": 42283200, "link": "https://stackoverflow.com/questions/42283200/how-do-i-use-the-gloss-examples-package", "title": "How do I use the gloss-examples package?", "body": "<p>I've installed the Gloss graphics library with cabal. I also installed the <a href=\"http://hackage.haskell.org/package/gloss-examples\" rel=\"nofollow noreferrer\">gloss examples package.</a></p>\n\n<p>Now I want to test the examples. This may seem like a silly question, but how do I actually use the package gloss-examples? I understand I can now import the gloss library to a haskell module but how do I test the gloss-examples I installed i.e. how do I use the gloss-example package?</p>\n"}, {"tags": ["haskell", "compiler-errors", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487354269, "post_id": 42274335, "comment_id": 71763768, "body": "I recommend compiling with <code>-Wall</code> which would have notified you at compile time of nonexhaustive patterns as well as a function with no type signature"}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 6, "last_activity_date": 1487249781, "creation_date": 1487249781, "answer_id": 42274633, "question_id": 42274335, "link": "https://stackoverflow.com/questions/42274335/pattern-matches-are-non-exhaustive-even-though-i-have-specified-the-pattern/42274633#42274633", "title": "Pattern match(es) are non-exhaustive even though I have specified the pattern", "body": "<p>You misspelled the function name in the last pattern as <code>elememtOf</code> instead of <code>elementOf</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 7150132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cf2882c6960a484426ff976ba0765dc?s=128&d=identicon&r=PG&f=1", "display_name": "kishvith", "link": "https://stackoverflow.com/users/7150132/kishvith"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 0, "closed_date": 1487253112, "accepted_answer_id": 42274633, "answer_count": 1, "score": 0, "last_activity_date": 1487249781, "creation_date": 1487249029, "question_id": 42274335, "link": "https://stackoverflow.com/questions/42274335/pattern-matches-are-non-exhaustive-even-though-i-have-specified-the-pattern", "closed_reason": "Not suitable for this site", "title": "Pattern match(es) are non-exhaustive even though I have specified the pattern", "body": "<p>I am writing a function in haskell that checks if something is an element of a list or not.</p>\n\n<p>I have the following code:</p>\n\n<pre><code>elementOf :: Eq a =&gt; a -&gt;[a] -&gt; Bool\nelementOf _ [] = False\nelememtOf x (y:ys) = (x==y) || elementOf x ys\n</code></pre>\n\n<p>but I am getting the following error: </p>\n\n<pre><code>Pattern match(es) are non-exhaustive\nIn an equation for \u2018elememtOf\u2019: Patterns not matched: _ []\n</code></pre>\n\n<p>I do not understand why I am getting such error because I have a case for _ [].</p>\n\n<p>Can anyone explain where I am going wrong please? </p>\n\n<p>Thank You!</p>\n"}, {"tags": ["haskell", "gtk"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487246382, "post_id": 42272262, "comment_id": 71702669, "body": "You downloaded the Haskell gtk package, but the docs are telling you you need the c gtk, upon which the Haskell package called <code>gtk</code> depends. <code>alex</code> and <code>happy</code> are the standard lexer/parser tools for Haskell (cabal install alex happy). %PATH% is an environment variable, nothing to do really with &#39;installed packages&#39;. These guides don&#39;t assume you know anything (hence &#39;guide&#39;) but they do assume if you know nothing about <code>pkg-config</code> then you will read the <code>pkg-config</code> documentation to learn about it. ..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487246542, "post_id": 42272262, "comment_id": 71702792, "body": "The section of the guide you are following is for Windows (clearly, since %PATH% is actually called $PATH on *nix). Finally, <code>cabal install gtk</code> fails for a reason entirely unrelated to any of the other things which didn&#39;t work - it doesn&#39;t even get to the step where it checks for that the C gtk library is installed and available. Because there are so many misunderstandings here, very few to do with Haskell, and all caused mainly by not reading the docs, I&#39;m voting to close."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487247789, "post_id": 42272262, "comment_id": 71703697, "body": "[1/2] (Since I don&#39;t use OS X, I will post this as a long comment, and leave the answers for folks in a better position to offer advice.) (1) There is <a href=\"https://wiki.haskell.org/Gtk2Hs/Mac\" rel=\"nofollow noreferrer\">a separate Mac page</a>. There are more up-to-date instructions in the <a href=\"https://github.com/gtk2hs/gtk2hs\" rel=\"nofollow noreferrer\">readme at GitHub</a>, but I don&#39;t know if they apply to your OS X version. (2) I don&#39;t know what in your Haskell environment is making <i>cabal</i> pick precisely the 0.14.5 version of <i>gtk</i>, but..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487247802, "post_id": 42272262, "comment_id": 71703707, "body": "[2/2] ... the error mentioning pkgconfig is probably related to the fact that, as user2407038 notes, you didn&#39;t install the GTK C library yet. (3) &quot;Excuse me but how is it this <i>hard</i> to simply install a library for Haskell?&quot; -- In most cases it isn&#39;t. <i>gtk</i> is far more annoying to install than the norm, specially if you aren&#39;t on Linux, as it depends on a complicated non-Haskell library (the C GTK) and the bindings have a lot of moving parts."}, {"owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487249596, "post_id": 42272262, "comment_id": 71705035, "body": "The thing is, I am even able to install alex, happy, glib, even the build tools all using cabal. But when I type &quot;cabal install gtk&quot; I get Resolving dependencies... cabal: Could not resolve dependencies: next goal: gtk (user goal) rejecting: gtk-0.14.6, gtk-0.14.5, gtk-0.14.4, gtk-0.14.3, gtk-0.14.2, gtk-0.13.9, gtk-0.13.8.1, gtk-0.13.8, gtk-0.13.7, gtk-0.13.6, gtk-0.13.4..etc (conflict: requires pkg-config package gtk+-2.0-any, not found in the pkg-config database) Dependency tree exhaustively searched."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487250236, "post_id": 42272262, "comment_id": 71705544, "body": "The error tells you <i>exaclty</i> what is wrong - &quot;conflict: requires pkg-config package gtk+-2.0-any, not found in the pkg-config database&quot;. Why would you expect latter steps of the installation to every succeed when the former steps haven&#39;t been completed?"}, {"owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "edited": false, "score": 0, "creation_date": 1487252650, "post_id": 42272262, "comment_id": 71707358, "body": "This is where I am getting at, how do I solve &quot;conflict: requires pkg-config package gtk+-2.0-any, not found in the pkg-config database&quot;? I have no idea where I could find a pk-config package for gtk+ much less how to put it in an &quot;pkg-config database&quot;?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487276938, "post_id": 42272262, "comment_id": 71724588, "body": "I started writing an answer, but I just couldn&#39;t do it. There&#39;s so much indignation in your post that I couldn&#39;t keep my own response professional. In short, you are following the instructions for installing on a completely different OS than the one you have. Try again with the right instructions; and if you ask another question based on those, I encourage you to stick to the technical details and skip the whining."}], "answers": [{"tags": [], "owner": {"reputation": 39, "user_id": 5930692, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fe29ed666f069ae2744b84c04a6a9c23?s=128&d=identicon&r=PG&f=1", "display_name": "the_inquiry", "link": "https://stackoverflow.com/users/5930692/the-inquiry"}, "is_accepted": false, "score": 0, "last_activity_date": 1490368175, "creation_date": 1490368175, "answer_id": 43002990, "question_id": 42272262, "link": "https://stackoverflow.com/questions/42272262/how-to-install-the-gtk-library-for-haskell-in-os-x/43002990#43002990", "title": "How to install the gtk library for Haskell in OS X?", "body": "<p>I solved this problem on Ubuntu with:</p>\n\n<pre><code>sudo apt install libgtk2.0-dev\n</code></pre>\n\n<p>Maybe if you install libgtk2.0-dev on OS X (with brew maybe) you will be able to install gtk with cabal.</p>\n"}], "owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 274, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1490368175, "creation_date": 1487243464, "last_edit_date": 1487247873, "question_id": 42272262, "link": "https://stackoverflow.com/questions/42272262/how-to-install-the-gtk-library-for-haskell-in-os-x", "title": "How to install the gtk library for Haskell in OS X?", "body": "<p>I'm having trouble installing gtk2 for Haskell on OS X with cabal. I am using <a href=\"https://wiki.haskell.org/Gtk2Hs/Installation\" rel=\"nofollow noreferrer\">this guide</a>.</p>\n\n<p>Forgive my noobness, but my problems to understand starts with the following line:</p>\n\n<blockquote>\n  <p>Unpack the bundle to a path that does not have spaces in it, and add the /bin directory created by unpacking to your %PATH%.</p>\n</blockquote>\n\n<p>So &amp;PATH% is where my installed packages lie right? I know that folder, but what does it mean to \"add the /bin directory created by unpacking\" to this folder? When I download gtk <a href=\"https://hackage.haskell.org/package/gtk\" rel=\"nofollow noreferrer\">from here</a> and unzip there isnt any folder anywhere called \"/bin\" or \"bin\". There is one directory bin in my %PATH% that contains some executables though? But there is not bin directory created form unzipping for example gtk-0.14.5.tar.gz?! </p>\n\n<p>Obviously I am doing something wrong, because when I continue the guide I check and get:</p>\n\n<pre><code>gtk-0.14.5 Admin$ pkg-config --cflags gtk+-2.0\nPackage gtk+-2.0 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `gtk+-2.0.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'gtk+-2.0' found\n\nIf you see some compiler flags that contain the path into which you have installed the binary bundle, you are okay.\n</code></pre>\n\n<p>Umm what? Can someone explain this like I'm five? What is a compile flag, what is a binary bundle? It's like these guides assume that you already know what you are doing.</p>\n\n<p>Very well, I continue and try to install the build tools for gtk by typing: </p>\n\n<pre><code>cabal install gtk2hs-buildtools\n</code></pre>\n\n<p>First it complains I don't have something called \"alex\" and then that I don't have something called \"happy\". Wtf what are those? Whatever, I install those as well, even though I do not understand what I am doing. FINALLY I am able to install the build tools.</p>\n\n<p>So now only remains the actual gtk right, should be simple enough. I type:</p>\n\n<pre><code>cabal install gtk\n</code></pre>\n\n<p>But no.  It gives me the following error message:</p>\n\n<pre><code>cabal install gtk.cabal\nResolving dependencies...\ncabal: Could not resolve dependencies:\nnext goal: gtk (user goal)\nrejecting: gtk-0.14.6 (constraint from user target requires ==0.14.5)\nrejecting: gtk-0.14.5 (conflict: requires pkg-config package gtk+-2.0-any, not\nfound in the pkg-config database)\nrejecting: gtk-0.14.4, gtk-0.14.3, gtk-0.14.2, gtk-0.13.9, gtk-0.13.8.1,\ngtk-0.13.8, gtk-0.13.7, gtk-0.13.6, gtk-0.13.4, gtk-0.13.3, gtk-0.13.2,\ngtk-0.13.1, gtk-0.13.0.3, gtk-0.13.0.2, gtk-0.13.0.1, gtk-0.13.0.0,\ngtk-0.12.5.7, gtk-0.12.5.6, gtk-0.12.5.5, gtk-0.12.5.4, gtk-0.12.5.3,\ngtk-0.12.5.2, gtk-0.12.5.1, gtk-0.12.5.0, gtk-0.12.4, gtk-0.12.3.1,\ngtk-0.12.3, gtk-0.12.2, gtk-0.12.1, gtk-0.12.0, gtk-0.11.2, gtk-0.11.1,\ngtk-0.11.0 (constraint from user target requires ==0.14.5)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>WHAT? What am I even looking at? Excuse me but how is it <em>this hard</em> to simply install a library for Haskell? Can anyone help? I spend several days now trying to install Haskell libraries to be able to actually program something, but I reiterate, how is it that it is this hard to simply install a simple library? Am I missing something? Any help would be highly appreciated.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1487249501, "post_id": 42270329, "comment_id": 71704959, "body": "What would use this kind of type-level mapping? It&#39;s reflecting real-world data that isn&#39;t static, as the UK shows."}, {"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1487251320, "post_id": 42270329, "comment_id": 71706308, "body": "I would claim that almost no data is static. If we were to settle Mars in the non too distant future our date system and our time system won&#39;t work anymore. For the time being I feel confident implementing 24/365. And so I do with the above static table. At the end its always a judgement call if one wants to implemt a configurable module, isn&#39;t it?"}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1487280250, "post_id": 42270610, "comment_id": 71726515, "body": "Your second implementation doesn&#39;t compile because there are duplicate names for <code>DE</code>, <code>AT</code>, etc."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1487280657, "post_id": 42270610, "comment_id": 71726718, "body": "@DavidYoung Thanks! Fixed."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1487280650, "last_edit_date": 1487280650, "creation_date": 1487239305, "answer_id": 42270610, "question_id": 42270329, "link": "https://stackoverflow.com/questions/42270329/is-there-a-way-to-restrict-the-instances-of-a-possible-product-type/42270610#42270610", "title": "Is there a way to restrict the instances of a possible product type?", "body": "<p>This may be overkill, but depending on the context you are in, you could use a GADT. This is hinging a lot on the fact your at least your currencies don't have any constructor information. </p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds #-}\n\ndata Currency = GBP | EUR | DKK\n\ndata Country c where\n  DE :: Country EUR\n  AT :: Country EUR\n  UK :: Country GBP\n  DK :: Country DKK\n</code></pre>\n\n<p>Or, a variant I think is probably less useful but closer to the question</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds #-}\n\ndata Currency = GBP | EUR | DKK\ndata Country = DE | AT | DK | UK\n\ndata CountryCurrency country currency where\n  DECC :: CountryCurrency DE EUR\n  ATCC :: CountryCurrency AT EUR\n  UKCC :: CountryCurrency UK GBP\n  DKCC :: CountryCurrency DK DKK\n</code></pre>\n\n<p>Without a use case, it is tough to say what the best approach is. :)</p>\n"}, {"comments": [{"owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1487257930, "post_id": 42277137, "comment_id": 71711725, "body": "my aim was to have a compile time check."}, {"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "reply_to_user": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "edited": false, "score": 0, "creation_date": 1487259631, "post_id": 42277137, "comment_id": 71712982, "body": "@robkuz The smart constructor link has something to say about that, too. Perhaps it&#39;ll help."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1487267458, "post_id": 42277137, "comment_id": 71719029, "body": "I think <code>Country -&gt; Currency -&gt; Maybe CountryCurrency</code> would be better. partial functions are evil."}], "tags": [], "owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1487259810, "last_edit_date": 1487259810, "creation_date": 1487256269, "answer_id": 42277137, "question_id": 42270329, "link": "https://stackoverflow.com/questions/42270329/is-there-a-way-to-restrict-the-instances-of-a-possible-product-type/42277137#42277137", "title": "Is there a way to restrict the instances of a possible product type?", "body": "<p>[Edit: I had overlooked the fact that the OP was asking for a solution on the type level, for compile-time checking; my answer doesn't answer that, but could in general be a good alternative in similar situations]</p>\n\n<p>I believe the idiomatic way to do this is to use <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">smart constructors</a>. In a nutshell: You define your data types in a module and don't export the \"dangerous\" data constructor (the one that would allow \"illegal\" combinations); instead you export a function that only makes legal values. In your case:</p>\n\n<pre><code>module Money ( CountryCurrency\n             , Country (..)\n             , Currency (..)\n             , cc\n             ) where\n\ndata Currency = GBP | EUR | DKK deriving Show\n\ndata Country = DE | AT | DK | UK deriving Show\n\ndata CountryCurrency = CC Country Currency deriving Show\n\ncc :: Country -&gt; Currency -&gt; CountryCurrency\ncc DE EUR = CC DE EUR\ncc AT EUR = CC AT EUR\ncc UK GBP = CC UK GBP\ncc DK DKK = CC DK DKK\ncc _ _ = error \"invalid country/currency combination\"\n</code></pre>\n\n<p><code>cc</code> is the smart constructor. You can then make valid combinations like this:</p>\n\n<pre><code>*Main&gt; cc DE EUR\nCC DE EUR\n\n*Main&gt; cc UK GBP\nCC UK GBP\n</code></pre>\n\n<p>But you cannot make illegal ones:</p>\n\n<pre><code>*Main&gt; cc UK EUR\n*** Exception: invalid country/currency combination\nCallStack (from HasCallStack):\n  error, called at ./Money.hs:18:10 in main:Money\n</code></pre>\n\n<p>Most importantly, you cannot use the data constructor <code>CC</code> directly:</p>\n\n<pre><code>*Main&gt; CC UK EUR\n\n&lt;interactive&gt;:26:1: error:\n    Data constructor not in scope: CC :: Country -&gt; Currency -&gt; t\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 4, "last_activity_date": 1487267597, "creation_date": 1487267597, "answer_id": 42281317, "question_id": 42270329, "link": "https://stackoverflow.com/questions/42270329/is-there-a-way-to-restrict-the-instances-of-a-possible-product-type/42281317#42281317", "title": "Is there a way to restrict the instances of a possible product type?", "body": "<p>My contention is that a product type is the wrong way to represent this mapping, and that types are not a good tool for checking its consistency. (How do you make sure you've got the mapping in the type right? If the mapping changes then you need to change the type too.)</p>\n\n<p>Each country has exactly one currency, and the currency is uniquely determined by the country. Sounds more like a function than a pair.</p>\n\n<pre><code>currency :: Country -&gt; Currency\ncurrency DE = EUR\ncurrency AT = EUR\ncurrency UK = GBP\ncurrency DK = DKK\n</code></pre>\n"}], "owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 42270610, "answer_count": 3, "score": 2, "last_activity_date": 1487280650, "creation_date": 1487238554, "last_edit_date": 1487271509, "question_id": 42270329, "link": "https://stackoverflow.com/questions/42270329/is-there-a-way-to-restrict-the-instances-of-a-possible-product-type", "title": "Is there a way to restrict the instances of a possible product type?", "body": "<p>Lets assume these 2 sum types</p>\n\n<pre><code>data Currency =\n    | GBP\n    | EUR\n    | DKK\n\ndata Country =\n    | DE\n    | AT\n    | DK\n    | UK\n</code></pre>\n\n<p>and the following product type</p>\n\n<pre><code> type CC = (Country, Currency)\n</code></pre>\n\n<p>Now even though all these countries are part of the European Union (yeah, dear software archeologist from the year 3000 - the UK was part of the EU once ;-) ) they have different currencies (or not). So I'd like to restrict the possible values of <code>CC</code> to</p>\n\n<pre><code> (DE, EUR)\n (AT, EUR)\n (UK, GBP)\n (DK, DKK)\n</code></pre>\n\n<p>and make every other combination not expressable.<br>\nIs it possible to express such a thing on the type level?<br>\nIf not how would a well versed Haskeller approach this otherwise?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1487237287, "post_id": 42269549, "comment_id": 71695822, "body": "I don&#39;t know whether it is relevant - but my stack version is <code>Version 1.3.2, Git revision 3f6751...da2a5 (4395 commits) x86_64 hpack-0.15.0</code>. can you give us the exact command what you want to install and the contents of <code>~&#47;.stack&#47;global-project&#47;stack.yaml</code> and tell us if you have <code>system-ghc: true</code> in <code>~&#47;.stack&#47;config.yaml</code>?"}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1487237551, "post_id": 42269549, "comment_id": 71696020, "body": "Thank you for your answer. :) No, I don&#39;t have it as you can see now. I&#39;ll try. BTW, no matters what I try to install or do, I get that message in the terminal. E.g.: <code>stack install stylish-haskell</code>"}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1487237663, "post_id": 42269549, "comment_id": 71696104, "body": "Nope. It didn&#39;t work :( I&#39;m getting the same error"}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1487238108, "post_id": 42269549, "comment_id": 71696429, "body": "oh! I&#39;ve installed it today, cause I got a problem with the system yesterday and I forgot to make &quot;stack upgrade&quot; after installing stack, and maybe that&#39;s why my version is too old (as you saw) and maybe that&#39;s why I got that error. I&#39;m trying to upgrade."}, {"owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1487241092, "post_id": 42269549, "comment_id": 71698771, "body": "No, it didn&#39;t work..."}], "answers": [{"comments": [{"owner": {"reputation": 3227, "user_id": 1445898, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f668122db3fbbe178051b918ca67de3?s=128&d=identicon&r=PG", "display_name": "Sergey Alaev", "link": "https://stackoverflow.com/users/1445898/sergey-alaev"}, "edited": false, "score": 0, "creation_date": 1500478529, "post_id": 42271931, "comment_id": 77357678, "body": "Indeed, never install build tools via <code>apt</code>."}, {"owner": {"reputation": 341, "user_id": 1522304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d37a51c0c7f2b811b50644edc7c9911?s=128&d=identicon&r=PG", "display_name": "jose.marcos.rf", "link": "https://stackoverflow.com/users/1522304/jose-marcos-rf"}, "edited": false, "score": 0, "creation_date": 1532432012, "post_id": 42271931, "comment_id": 89962847, "body": "Installing stack via <code>apt</code> was indeed my problem too. The above solution works like a charm"}], "tags": [], "owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "is_accepted": true, "score": 13, "last_activity_date": 1536677781, "last_edit_date": 1536677781, "creation_date": 1487242635, "answer_id": 42271931, "question_id": 42269549, "link": "https://stackoverflow.com/questions/42269549/weird-error-with-haskell-stack-it-doesnt-install-anything-anymore/42271931#42271931", "title": "weird error with haskell-stack. it doesn&#39;t install anything anymore", "body": "<p>After trying a many things I \"found the answer\".</p>\n\n<p>The problem was, as epsilonhalbe saw, that I had an old version. So I tried to do this <code>wget -qO- https://get.haskellstack.org/ | sh</code> and it didn't work, because I had stack on <code>/usr/bin/</code> so, I removed stack and then tried again <code>wget -qO- https://get.haskellstack.org/ | sh</code>. I added <code>$HOME/.local/bin/</code> to the path, and it's working properly. </p>\n\n<p>I hope it can help someone</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>There's a new version of stack, but <code>ghc-mod</code> just works until the <code>lts-9.0</code> of stack. So, if you're having troubles with <code>ghc-mod</code>and your stack version is over <code>8.0.2</code> then: </p>\n\n<p><code>nano /Users/USERNAME/.stack/global-project/stack.yaml</code></p>\n\n<p>and replace <code>resolver: ---</code> for <code>resolver: lts-9.0</code></p>\n\n<p>Then, on the terminal <code>stack solver</code> and it's gonna work :) </p>\n"}, {"tags": [], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "is_accepted": false, "score": 4, "last_activity_date": 1487785335, "creation_date": 1487785335, "answer_id": 42398651, "question_id": 42269549, "link": "https://stackoverflow.com/questions/42269549/weird-error-with-haskell-stack-it-doesnt-install-anything-anymore/42398651#42398651", "title": "weird error with haskell-stack. it doesn&#39;t install anything anymore", "body": "<p>I was blocked by the same problem, unless I check <code>which stack</code>  (or use <code>where stack</code> as alternative) and I found that I'm using an old version of stack which I installed somehow, and the new version was never accessed when I typed the <code>stack</code> command ...</p>\n\n<p>Here is the situation when I realized the problem..\n<a href=\"https://i.stack.imgur.com/NN90j.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/NN90j.png\" alt=\"the-stack-version-problem\"></a></p>\n\n<p>If you check <code>stack --version</code> and get something like <code>Version 0.1.10.0 x86_64</code>, then it is far away from the current version, the current version I'm using (when answering this question) is <code>Version 1.3.3, Git revision 078cfadeb37a39501eae24732e5c757cc8aca31b x86_64 hpack-0.17.0</code></p>\n\n<p>If you had confirmed that you are not using the wrong one stack, but the stack version is still too low, you can use <code>stack upgrade --git</code> to upgrade your stack to the latest version from git (notice that this will take a while).</p>\n\n<p>Hope this helpful.</p>\n"}], "owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2704, "favorite_count": 2, "accepted_answer_id": 42271931, "answer_count": 2, "score": 11, "last_activity_date": 1536677781, "creation_date": 1487236646, "last_edit_date": 1487237489, "question_id": 42269549, "link": "https://stackoverflow.com/questions/42269549/weird-error-with-haskell-stack-it-doesnt-install-anything-anymore", "title": "weird error with haskell-stack. it doesn&#39;t install anything anymore", "body": "<p>I get an error with stack, while trying to install a package. </p>\n\n<pre><code>Run from outside a project, using implicit global project config\nUsing resolver: lts-8.0 from implicit global project's config file: /home/chuck/.stack/global-project/stack.yaml\nInvalid package ID: \"array-0.5.1.1 base-4.9.1.0 binary-0.8.3.0 bytestring-0.10.8.1\"\n</code></pre>\n\n<p>stack --version works:</p>\n\n<pre><code>Version 0.1.10.0 x86_64\n</code></pre>\n\n<p>and stack setup returns this:</p>\n\n<pre><code>Run from outside a project, using implicit global project config\nUsing resolver: lts-8.0 from implicit global project's config file: /home/chuck/.stack/global-project/stack.yaml\nstack will use a locally installed GHC\nFor more information on paths, see 'stack path' and 'stack exec env'\nTo use this GHC and packages outside of a project, consider using:\nstack ghc, stack ghci, stack runghc, or stack exec\n</code></pre>\n\n<p>I reinstalled stack and I get the same error after the new installation. So, I don't know what I'm doing wrong. I need it for using atom. </p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Stack.yaml:</p>\n\n<pre><code># This is the implicit global project's config file, which is only used when\n# 'stack' is run outside of a real project.  Settings here do _not_ act as\n# defaults for all projects.  To change stack's default settings, edit\n# '/home/chuck/.stack/config.yaml' instead.\n#\n# For more information about stack's configuration, see\n# https://github.com/commercialhaskell/stack/blob/release/doc/yaml_configuration.md\n#\nflags: {}\nextra-package-dbs: []\npackages: []\nextra-deps: []\nresolver: lts-8.0\n</code></pre>\n"}, {"tags": ["arrays", "haskell", "parallel-processing", "repa"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487233983, "post_id": 42268459, "comment_id": 71693578, "body": "Would you mind also posting the code for <code>traverse2backwards</code>? It may not be relevant, but it would turn the above into a MVCE."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487246874, "post_id": 42268459, "comment_id": 71703047, "body": "Your function <code>f</code> takes as input two unboxed arrays, but <code>foldMatrixByRow</code> (as its type states) expects a function which takes as input two delayed arrays. Just use <code>delay</code>, which turns any array into a delayed array, i.e. <code>f (delay -&gt; matRow) (delay -&gt; sols) i = ...</code>"}], "owner": {"reputation": 1, "user_id": 4199672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31099469f348e536250e4a033951106f?s=128&d=identicon&r=PG&f=1", "display_name": "fahad aijaz", "link": "https://stackoverflow.com/users/4199672/fahad-aijaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487233396, "creation_date": 1487233396, "question_id": 42268459, "link": "https://stackoverflow.com/questions/42268459/couldnt-match-type-d-with-u-in-haskell-repa-arrays", "title": "Couldn&#39;t match type `D&#39; with `U&#39; in Haskell repa arrays", "body": "<p>I am trying to write some simple back substitution matrix code.\nFor this I wrote a <code>fold</code> operator which folds with rows. </p>\n\n<p>Here is a non generic type signature of the function and its implemtation:</p>\n\n<pre><code>foldMatrixByRow :: (Array D DIM1 Double -&gt; Array D DIM1 Double -&gt; Int -&gt; Array D DIM1 Double)\n                    -&gt; Array D DIM1 Double\n                    -&gt; Array U DIM2 Double\n                    -&gt; Array D DIM1 Double\n\nfoldMatrixByRow f intial mat = foldMatrixByRowUtil f intial (mat, 0)\n                              where foldMatrixByRowUtil f initial (mat, i)\n                                      | i == n = initial\n                                      | otherwise = foldMatrixByRowUtil f result (mat, i + 1)\n                                      where result = f matRow initial i\n                                            matRow = delayNRow mat i\n                                            (Z :. n :. _) = extent mat\n</code></pre>\n\n<ul>\n<li>The difference in repa's <code>foldS</code>, <code>foldP</code> etc and the above fold is, that the folding function takes 2 <code>DIM1</code> <strong><em>delayed</em></strong> arrays as parameters.</li>\n<li>More importantly, for aiding loop fusion it returns a delayed array (<code>Array D DIM1 Double</code>).</li>\n</ul>\n\n<p>The following is the code for back substitution</p>\n\n<pre><code>backsubstitution :: Array U DIM2 Double -&gt; Array U DIM1 Double -&gt; Array D DIM1 Double                                                           \nbacksubstitution mat bs = foldMatrixByRow f initial mat\n                              where  \n                                    f matRow sols i = fromFunction (extent bs) intArr \n                                        where \n                                            intArr (Z :. j) | i == j = rowComp | j &lt; i = 0.0 | otherwise = sols R.! (Z :. j) \n                                            intc = ((bs ! (Z :. i)) - (rowComp)) / (matRow ! (Z :.i))\n                                            rowComp = sumAllS $ traverse2Backwards matRow sols g     \n                                            g m s (i', _) = if i &lt; i' then m * s else 0.0\n\n                                    initial = fromFunction (extent bs) (\\ _ -&gt; 0)\n</code></pre>\n\n<ul>\n<li>To aid loop fusion I, on purpose make <code>initial</code> <strong><em>delayed</em></strong>. <code>matRow</code> is computed by <code>delayNRow</code> which also computes a <strong><em>delayed</em></strong> array (<code>delayNRow</code> code is supplied after the next bullet).</li>\n<li><p><code>fromFunction</code> type signature certainly returns a <strong><em>delayed</em></strong> array.</p>\n\n<p><code>delayNRow :: Array U DIM2 Double -&gt; Int -&gt; Array D DIM1 Double</code></p>\n\n<p><code>delayNRow arr n =  R.slice arr (Any :. n :. All)</code></p></li>\n</ul>\n\n<p><strong><em>BUT HERE IS THE PROBLEM :</em></strong></p>\n\n<p>Why do I get the following error:</p>\n\n<pre><code> Couldn't match type `D' with `U'\n Expected type: Array D DIM1 Double -&gt; Array D DIM1 Double -&gt; Int -&gt; Array D DIM1 Double\n Actual type: Array U DIM1 Double  -&gt; Array U DIM1 Double -&gt; Int -&gt; Array D DIM1 Double\nIn the first argument of `foldMatrixByRow', namely `f'\nIn the expression: foldMatrixByRow f initial mat\nIn an equation for `backsubstitution':\n In an equation for `backsubstitution':\n backsubstitution mat bs\n   = foldMatrixByRow f initial mat\n   where\n       f matRow sols i\n         = fromFunction (extent bs) intArr\n         where ...\n</code></pre>\n\n<p><strong><em>tldr;</em></strong>\nWhy am I getting the error that the input to <code>f</code> in <code>backsubstitution</code> are <code>U</code> arrays, whereas I am providing them with arrays that are <strong><em>delayed</em></strong> (<code>D</code>).</p>\n"}, {"tags": ["haskell", "xml-conduit"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487221264, "post_id": 42265047, "comment_id": 71687431, "body": "<code>fmap (maybe Nothing (const Nothing)) (ignoreTag ..) :: Maybe b</code> for any type <code>b</code>."}, {"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487224747, "post_id": 42265047, "comment_id": 71688728, "body": "Yes, I tried something like that too, still isn&#39;t what I need because if I return <code>Nothing</code> the whole parser fails. I need something like a filter I guess."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487228069, "post_id": 42265047, "comment_id": 71690323, "body": "There is nothing special about <code>Maybe</code> - it doesn&#39;t indicate failure of the &#39;parser&#39; , in particular, failure is indicate with the <code>MonadThrow m</code> constraint on <code>ConduitM i o m r</code>. So if your parser is failing, it is the logic you wrote yourself which causes the failure. You&#39;ve used something like <code>many</code> to repeat the parser, in which case you need to use something other than <code>Maybe</code> to indicate logical failure in your code, as <code>xml-conduit</code> has already &#39;taken&#39; <code>Maybe</code> for its own uses (<code>Maybe (Maybe X)</code> will work, then change <code>Nothing</code> -&gt; <code>Just Nothing</code> and <code>catMaybes</code> on the result)."}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1487583776, "post_id": 42265047, "comment_id": 71834020, "body": "Could you post (relevant parts of) your code and some example input?"}], "answers": [{"tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": false, "score": 1, "last_activity_date": 1533211350, "creation_date": 1533211350, "answer_id": 51653151, "question_id": 42265047, "link": "https://stackoverflow.com/questions/42265047/how-to-skip-elements-in-xml-conduit/51653151#51653151", "title": "How to skip elements in xml-conduit", "body": "<p>As proposed <a href=\"https://github.com/snoyberg/xml/issues/134\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>\u03bb&gt; runConduit $ Text.XML.Stream.Parse.parseLBS def  \"&lt;foo&gt;bar&lt;/foo&gt;&lt;person age=\\\"25\\\"&gt;Michael&lt;/person&gt;&lt;person age=\\\"2\\\"&gt;Eliezer&lt;/person&gt;\" .| many_ (choose [takeTree \"person\" ignoreAttrs, ignoreAnyTreeContent]) .| manyYield parsePerson .| Data.Conduit.List.consume \n[Person 25 \"Michael\",Person 2 \"Eliezer\"]\n</code></pre>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1533211350, "creation_date": 1487219718, "question_id": 42265047, "link": "https://stackoverflow.com/questions/42265047/how-to-skip-elements-in-xml-conduit", "title": "How to skip elements in xml-conduit", "body": "<p>I have to handle rather big XML files and I want to use the streaming API of <code>xml-conduit</code> to go through them and extract the info I need.\nIn my case using streaming <code>xml-conduit</code> is especially appealing because I don't need much data from these files, and I need to perform simple aggregations on it so conduits are perfect.</p>\n\n<p>Now, I don't always know the exact structure of the file. Files are generated by different versions of (sometimes buggy) software around the world so I can't impose the schema.</p>\n\n<p>I know, however, elements that I am interested in, and their shapes. But, as I said, these elements can be located in different order with other elements, etc.</p>\n\n<p>What I need, I guess, is just to skip all the elements I am not interested in and only to consider ones that want.</p>\n\n<p>I initially wanted to write something like that:</p>\n\n<pre><code>tagName \"person\" (requireAttr \"age\" &lt;* ignoreAttrs) &lt;|&gt; ignoreTag (const True)\n</code></pre>\n\n<p>but it wouldn't compile because <code>ignoreType</code> returns <code>Maybe ()</code></p>\n\n<p>What would be the way to skip all the \"unknown\" tags when using <code>xml-conduit</code> streaming API?</p>\n"}]