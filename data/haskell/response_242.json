[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1567022296, "post_id": 57699192, "comment_id": 101842431, "body": "What is your question? Please describe a specific problem you&#39;re facing."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1567022510, "post_id": 57699192, "comment_id": 101842531, "body": "You can use a nested <code>do</code> block like any other expression, but you need to make sure you use it in a context where the resulting type is expected. What do you want to <i>do</i> with the result of <code>initState</code>? (Note that you can ditch the <code>case</code> expression; just write <code>config &lt;- fromMaybe defaultConfig  &lt;$&gt; decodeFile &quot;config.yaml&quot;</code>, where <code>defaultConfig</code> is the <code>Map</code> you pass in the <code>Nothing</code> case."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1567022521, "post_id": 57699192, "comment_id": 101842538, "body": "What module do you use for <code>initState</code>?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1567293878, "post_id": 57699192, "comment_id": 101923333, "body": "It\u2019s unclear what you\u2019re asking but since <code>case</code> is just an expression, which here seems to return an <code>IO</code> action, you can use it as the right side of a bind statement, e.g. <code>state &lt;- case \u2026 of \u2026</code>. If <code>initState</code> is pure, use a <code>let</code> block instead."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1567023386, "creation_date": 1567023386, "answer_id": 57699500, "question_id": 57699192, "link": "https://stackoverflow.com/questions/57699192/handle-maybe-in-do-block-and-extract-a-value/57699500#57699500", "title": "Handle maybe in do block and extract a value", "body": "<p>You can use a nested <code>do</code> block which uses a different monad, but you need to ensure it is used where the resulting monadic type is expected. For example, suppose you have a function <code>foo :: StateMonad Foo -&gt; IO ()</code>. Then you can write the following, assuming <code>initState :: Config -&gt; StateMonad State</code>.</p>\n\n<pre><code>main = do -- IO monad\n   let defaultConfig = Map.fromList [(\"hi\", \"bye\")]\n   config &lt;- fromMaybe defaultConfig &lt;$&gt; decodeFile \"config.yaml\"\n   foo $ do -- StateMonad monad\n     state &lt;- initState config  -- initState config :: StateMonad State\n                                -- state :: State\n     ...\n     return x  -- x :: Foo\n</code></pre>\n"}], "owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "accepted_answer_id": 57699500, "answer_count": 1, "score": 1, "last_activity_date": 1567023386, "creation_date": 1567021786, "last_edit_date": 1567022373, "question_id": 57699192, "link": "https://stackoverflow.com/questions/57699192/handle-maybe-in-do-block-and-extract-a-value", "title": "Handle maybe in do block and extract a value", "body": "<p>I'm reading a yaml which results in a maybe:</p>\n\n<pre><code>main :: IO ()\nmain = \n  do \n     justConfig &lt;- decodeFile \"config.yaml\" :: IO (Maybe Config)\n     case justConfig of\n       Just config -&gt; initState $ config\n       Nothing -&gt; initState $ (Map.fromList [(\"hi\", \"bye\")]) \n</code></pre>\n\n<p>How would you extract the result of initState from:</p>\n\n<pre><code>do      \n  Just config ... \n  state &lt;- initState $ config \n</code></pre>\n"}, {"tags": ["haskell", "lambda", "io", "tuples"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1567000287, "post_id": 57693986, "comment_id": 101832119, "body": "What makes you think that <code>(\\[x, y] -&gt; (x, y))</code> would only work with 2-tuples? In fact it works just fine with higher arity. \u2014 Anyways though: if you find yourself doing anything with &gt;3 -tuples, it usually means you shouldn&#39;t be using a tuple at all but a suitable record type."}, {"owner": {"reputation": 77, "user_id": 8804793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ry4f3.png?s=128&g=1", "display_name": "Eneelk", "link": "https://stackoverflow.com/users/8804793/eneelk"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1567000720, "post_id": 57693986, "comment_id": 101832382, "body": "Sorry, I just double-checked in my IDE. The parsing error I had with this syntax is gone. I had probably forgotten a parenthesis and it misled me. I will edit my post."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1567006169, "post_id": 57693986, "comment_id": 101835699, "body": "Ultimately the most idiomatic approach is to use a real parser. With a bit of practice, Haskell parsers are very quick and easy to write. The only challenge is whether the online judge provides the necessary libraries."}, {"owner": {"reputation": 77, "user_id": 8804793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ry4f3.png?s=128&g=1", "display_name": "Eneelk", "link": "https://stackoverflow.com/users/8804793/eneelk"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1567009698, "post_id": 57693986, "comment_id": 101837507, "body": "@Carl What do you mean by &quot;to use a real parser&quot;? Something similar to the answer from <i>luqui</i> below?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1567011109, "post_id": 57693986, "comment_id": 101838064, "body": "No, I mean something like the parsec family (probably megaparsec these days). I&#39;ve also used Earley at times, but programming competitions often have input formats that are easiest to parse with a context-sensitive parser, which means that Earley won&#39;t work."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1567001190, "post_id": 57694219, "comment_id": 101832689, "body": "Please don&#39;t present such an unsafe solution without some warning or better alternative."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1567002704, "post_id": 57694219, "comment_id": 101833664, "body": "@leftaroundabout I\u2019m not sure I agree with you \u2014 as you note, this solution certainly is very unsafe, but in the specific case of the OP\u2019s question (competitive programming with known input format) I think this solution would be fine."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1567002825, "post_id": 57694219, "comment_id": 101833740, "body": "@bradrn yes, that&#39;s why I don&#39;t say it&#39;s a bad answer. But it&#39;s still a <i>potentially harmful</i> one \u2013 people might read it without thinking about the competitive-programming context."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1567024142, "post_id": 57694219, "comment_id": 101843142, "body": "I knew someone would object because there&#39;s something about it&#39;s aesthetics which is very... unhaskell-like. But it&#39;s just as (un)safe as the OP&#39;s examples, and the question wasn&#39;t about safety."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1567000807, "creation_date": 1567000807, "answer_id": 57694219, "question_id": 57693986, "link": "https://stackoverflow.com/questions/57693986/tuple-initialization-from-io-data-in-haskell/57694219#57694219", "title": "Tuple initialization from IO data in Haskell", "body": "<p>How about this:</p>\n\n<pre><code>readInts :: IO (&lt;any tuple you like&gt;)\nreadInts = read . (\"(\" ++) . (++ \")\") . intercalate \",\" . words &lt;$&gt; getLine\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1567017938, "post_id": 57697915, "comment_id": 101840744, "body": "Your <code>parseNumber</code> is unnecessary unsafe. You should use <code>readPrec</code> to parse a number. You can either lift everything into <code>ReadPrec</code> or lower the number parsing to <code>ReadP</code>. Of course, something like attoparsec or megaparsec is probably a better choice than anything in base."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1567018822, "post_id": 57697915, "comment_id": 101841088, "body": "@dfeuer Thank you; I didn&#39;t know that, but I&#39;ll try that next time it comes up for me."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1567019392, "last_edit_date": 1567019392, "creation_date": 1567015616, "answer_id": 57697915, "question_id": 57693986, "link": "https://stackoverflow.com/questions/57693986/tuple-initialization-from-io-data-in-haskell/57697915#57697915", "title": "Tuple initialization from IO data in Haskell", "body": "<p>Given that the context is 'competitive programming' (something I'm only dimly aware of as a concept), I'm not sure that the following offers a particularly competitive alternative, but IMHO I'd consider it idiomatic to use one of several available parser combinators.</p>\n\n<p>The <code>base</code> package comes with a module called <code>Text.ParserCombinators.ReadP</code>. Here's how you could use it to parse the input file from the linked article:</p>\n\n<pre><code>module Q57693986 where\n\nimport Text.ParserCombinators.ReadP\n\nparseNumber :: ReadP Integer\nparseNumber = read &lt;$&gt; munch1 (`elem` ['0'..'9'])\n\nparseTriple :: ReadP (Integer, Integer, Integer)\nparseTriple =\n  (,,) &lt;$&gt; parseNumber &lt;*&gt; (char ' ' *&gt; parseNumber) &lt;*&gt; (char ' ' *&gt; parseNumber)\n\nparseLine :: ReadS (Integer, Integer, Integer)\nparseLine = readP_to_S (parseTriple &lt;* eof)\n\nparseInput :: String -&gt; [(Integer, Integer, Integer)]\nparseInput = concatMap (fmap fst . filter (null . snd)) . fmap parseLine . lines\n</code></pre>\n\n<p>You can use the <code>parseInput</code> against this input file:</p>\n\n<pre><code>1 3 10\n2 5 8\n10 11 0\n0 0 0\n</code></pre>\n\n<p>Here's a GHCi session that parses that file:</p>\n\n<pre><code>*Q57693986&gt; parseInput &lt;$&gt; readFile \"57693986.txt\"\n[(1,3,10),(2,5,8),(10,11,0),(0,0,0)]\n</code></pre>\n\n<p>Each <code>parseLine</code> function produces a list of tuples that match the parser; e.g.:</p>\n\n<pre><code>*Q57693986&gt; parseLine \"11 32 923\"\n[((11,32,923),\"\")]\n</code></pre>\n\n<p>The second element of the tuple is any remaining <code>String</code> still waiting to be parsed. In the above example, <code>parseLine</code> has completely consumed the line, which is what I'd expect for well-formed input, so the remaining <code>String</code> is empty.</p>\n\n<p>The parser returns a list of alternatives if there's more than one way the input could be consumed by the parser, but again, in the above example, there's only one suggested alternative, as the line has been fully consumed.</p>\n\n<p>The <code>parseInput</code> function throws away any tuple that hasn't been fully consumed, and then picks only the first element of any remaining tuples.</p>\n\n<p>This approach has often served me with puzzles such as <a href=\"https://adventofcode.com\" rel=\"nofollow noreferrer\">Advent of Code</a>, where the input files tend to be well-formed.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1567023487, "last_edit_date": 1567023487, "creation_date": 1567023144, "answer_id": 57699456, "question_id": 57693986, "link": "https://stackoverflow.com/questions/57693986/tuple-initialization-from-io-data-in-haskell/57699456#57699456", "title": "Tuple initialization from IO data in Haskell", "body": "<p>This is a way to generate a parser that works generically for any tuple (of reasonable size). It requires the library <a href=\"http://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a>.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, DeriveAnyClass, \n             FlexibleContexts, TypeFamilies, TypeApplications #-}\n\nimport GHC.Generics\nimport Generics.SOP\nimport Generics.SOP (hsequence, hcpure,Proxy,to,SOP(SOP),NS(Z),IsProductType,All)\nimport Data.Char\nimport Text.ParserCombinators.ReadP\nimport Text.ParserCombinators.ReadPrec\nimport Text.Read\n\ncomponentP :: Read a =&gt; ReadP a\ncomponentP = munch isSpace *&gt; readPrec_to_P readPrec 1\n\nproductP :: (IsProductType a xs, All Read xs) =&gt; ReadP a\nproductP = \n    let parserOutside = hsequence (hcpure (Proxy @Read) componentP)\n     in Generics.SOP.to . SOP . Z &lt;$&gt; parserOutside\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>*Main&gt; productP @(Int,Int,Int) `readP_to_S` \" 1 2 3 \"\n[((1,2,3),\" \")]\n</code></pre>\n\n<p>It allows components of different types, as long as they all have a <code>Read</code> instance.</p>\n\n<p>It also parses records that have a <code>Generics.SOP.Generic</code> instance:</p>\n\n<pre><code>data Stuff = Stuff { x :: Int, y :: Bool } \n             deriving (Show,GHC.Generics.Generic,Generics.SOP.Generic)\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>*Main&gt; productP @Stuff `readP_to_S` \" 1 True\"\n[(Stuff {x = 1, y = True},\"\")]\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 8804793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ry4f3.png?s=128&g=1", "display_name": "Eneelk", "link": "https://stackoverflow.com/users/8804793/eneelk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 57694219, "answer_count": 3, "score": 3, "last_activity_date": 1567023487, "creation_date": 1567000080, "last_edit_date": 1567015728, "question_id": 57693986, "link": "https://stackoverflow.com/questions/57693986/tuple-initialization-from-io-data-in-haskell", "title": "Tuple initialization from IO data in Haskell", "body": "<p>I would like to know what is the best way to get a tuple from data read from the input in Haskell. I often encounter this problem in competitive programming when the input is made up of several lines that contain space-separated integers. <a href=\"https://open.kattis.com/problems/ornaments\" rel=\"nofollow noreferrer\">Here is an example</a>:</p>\n\n<pre><code>1 3 10\n2 5 8\n10 11 0\n0 0 0\n</code></pre>\n\n<p>To read lines of integers, I use the following function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readInts :: IO [Int]\nreadInts = fmap (map read . words) getLine\n</code></pre>\n\n<p>Then, I transform these lists into tuples with of the appropriate size:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readInts :: IO (Int, Int, Int, Int)\nreadInts = fmap ((\\l -&gt; (l !! 0, l !! 1, l !! 2, l !! 3)) . map read . words) getLine\n</code></pre>\n\n<p>This approach does not seem very idiomatic to me.</p>\n\n<p>The following syntax is more readable <s>but it only works for 2-tuples</s>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readInts :: IO (Int, Int)\nreadInts = fmap ((\\[x, y] -&gt; (x, y)) . map read . words) getLine\n</code></pre>\n\n<p>(EDIT: as noted in the comments, the solution above works for n-tuples in general). </p>\n\n<p>Is there an idiomatic way to initialize tuples from lists of integers without having to use <code>!!</code> in Haskell? Alternatively, is there a different approach to processing this type of input?</p>\n"}, {"tags": ["list", "function", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "edited": false, "score": 0, "creation_date": 1566991834, "post_id": 57691317, "comment_id": 101827027, "body": "What if I want my type of function to be Int -&gt; String"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "edited": false, "score": 0, "creation_date": 1566991944, "post_id": 57691317, "comment_id": 101827094, "body": "@Eddie: you intercalate :)"}, {"owner": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "edited": false, "score": 0, "creation_date": 1566992320, "post_id": 57691317, "comment_id": 101827295, "body": "I thought there would be a way, at the beginning of the function to do something like let nums = [1..x] then somehow do recursion on it.  this language confuses me"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "edited": false, "score": 0, "creation_date": 1566992356, "post_id": 57691317, "comment_id": 101827316, "body": "@Eddie: we do recursion: the recursion is performed in the <code>filter</code>, <code>map</code> and <code>intercalate</code> function. But <code>let nums</code> is a bit strange, why not use <code>[1..x]</code> directly?"}, {"owner": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "edited": false, "score": 0, "creation_date": 1566992596, "post_id": 57691317, "comment_id": 101827465, "body": "I&#39;m using a very simplified example of a problem i have.  The idea is, I have the function with guards working for individual numbers, but I need to do this funciton to a list [1..x] where the input param is x"}, {"owner": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "edited": false, "score": 0, "creation_date": 1566992791, "post_id": 57691317, "comment_id": 101827575, "body": "My real issue has nothing to do with odd or even, I&#39;m just trying to grasp the idea of getting an input as an int, and doing some sort of iterative function on a list with that many numbers"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "edited": false, "score": 1, "creation_date": 1566992928, "post_id": 57691317, "comment_id": 101827651, "body": "@Eddie: well usually you try to define as much as possible in terms of <code>map</code>, <code>filter</code>, <code>foldr</code>, <code>zip</code>, etc. So <code>filter</code> can be used to filter your elements, <code>map</code> to convert items to something else, etc. You can use explicit recursion, but that is usually only a good idea if the above functions can not do that (conveniently)."}, {"owner": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566993483, "post_id": 57691317, "comment_id": 101827966, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/198583/discussion-between-eddie-and-willem-van-onsem\">continue this discussion in chat</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1566997985, "post_id": 57691317, "comment_id": 101830643, "body": "You <i>could</i> use <code>let</code>, but it&#39;s not necessary: <code>oddOnly n = let nums = [1..x] in intercalate &quot; &quot; (map show (filter odd nums))</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1566991933, "last_edit_date": 1566991933, "creation_date": 1566991562, "answer_id": 57691317, "question_id": 57691267, "link": "https://stackoverflow.com/questions/57691267/writing-basic-haskell-function-taking-int-x-and-doing-function-on-1-x/57691317#57691317", "title": "Writing basic haskell function, taking Int x and doing function on [1..x]", "body": "<p>I think you make things too complicated here. You can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><strong><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code></strong></a> here to filter a list, and use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:odd\" rel=\"nofollow noreferrer\"><strong><code>odd :: Integral i =&gt; i</code></strong></a> as filter condition:</p>\n\n<pre><code>oddOnly :: Integral i =&gt; i -&gt; [i]\noddOnly n = <b>filter odd</b> [1..n]</code></pre>\n\n<p>or as a string:</p>\n\n<pre><code>import Data.List(intercalate)\n\noddOnly :: (Show i, Integral i) =&gt; i -&gt; String\noddOnly n = <b>intercalate \" \"</b> (map show (filter odd [1..n]))</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Data.List&gt; putStrLn (oddOnly 15)\n1 3 5 7 9 11 13 15\n</code></pre>\n\n<blockquote>\n  <p>I'm not iterating over a list of these numbers. How do I do that?</p>\n</blockquote>\n\n<p>Haskell's \"workhorse\" is recursion: you do not use <code>for</code> loops, etc. but you recurse on a list. You make recursive calls where you make a call with an different value, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1566998618, "last_edit_date": 1566998618, "creation_date": 1566997831, "answer_id": 57693244, "question_id": 57691267, "link": "https://stackoverflow.com/questions/57691267/writing-basic-haskell-function-taking-int-x-and-doing-function-on-1-x/57693244#57693244", "title": "Writing basic haskell function, taking Int x and doing function on [1..x]", "body": "<p>The most basic way to implement iteration in Haskell is by recursion.  There are fancier ways which Willem is trying to show you, but for some people (myself included) it's nice to see it done the basic way first.</p>\n\n<p>A string of odd numbers, say <code>\"1 3 5 7 ...\"</code>, is an odd number <code>\"1\"</code> followed by a string of odd numbers <code>\"3 5 7 ...\"</code> (which is itself an odd number <code>\"3\"</code> followed by a string of odd numbers, etc.).  So if we already know how to make a string of odd numbers, we can put an odd number on the front of it to make a slightly longer string of odd numbers. This is the recursive structure of the problem.  Here's a try:</p>\n\n<pre><code>oddOnly :: Int -&gt; String\noddOnly x\n  | x &lt; 0 = error \"neg\"\n  | x == 0 = \"0\"\n  | mod x 2 /= 0 = show x ++ \" \" ++ oddOnly (x + 2)\n</code></pre>\n\n<p>If we try this, we get something surprising:</p>\n\n<pre><code>ghci&gt; oddOnly 1\n\"1 3 5 7 9 11 13 15 17 19 21 23 25 27 29 31 ...\n</code></pre>\n\n<p>(your screen will fill up very fast with odd numbers)</p>\n\n<p>We have constructed an infinitely long string of odd numbers (something Haskell happily lets us do :-).  We just need to terminate it -- that is, <code>oddOnly</code> now needs to <em>not</em> call itself if the argument is too big. </p>\n\n<pre><code>oddOnly :: Int -&gt; String\noddOnly x\n  | x &lt; 0 = error \"neg\"\n  | x == 0 = \"0\"\n  | x &gt;= 20 = \"\"\n  | mod x 2 /= 0 = show x ++ \" \" ++ oddOnly (x + 2)\n</code></pre>\n\n<p>And we have what we are looking for.  Understand how that works?</p>\n\n<p>See if you can modify this code to take the right endpoint as a parameter.  Maybe also take the step (here 2) as a parameter so you can get e.g. <code>\"1 4 7 10\"</code>.  Can you return a list instead and then write a separate function to turn them into a string <code>joinList :: [Int] -&gt; String</code>  (this is good separation of concerns)?</p>\n"}], "owner": {"reputation": 179, "user_id": 571817, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/36c5e60b9037a9319ca4037a3dbbd1a3?s=128&d=identicon&r=PG", "display_name": "Eddie", "link": "https://stackoverflow.com/users/571817/eddie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1566998618, "creation_date": 1566991383, "question_id": 57691267, "link": "https://stackoverflow.com/questions/57691267/writing-basic-haskell-function-taking-int-x-and-doing-function-on-1-x", "title": "Writing basic haskell function, taking Int x and doing function on [1..x]", "body": "<p>I'm practicing some haskell, and having issues with something very basic in other languages.</p>\n\n<p>I want my function to take an int and return a string</p>\n\n<pre><code>oddOnly :: Int -&gt; String\n</code></pre>\n\n<p>and i want to print the output of that function</p>\n\n<pre><code>print (oddOnly 20)\n</code></pre>\n\n<p>I want this function to print all odd numbers from 1-20 for example</p>\n\n<pre><code>\"1 3 5 7 9 11 13 15 17 19\"\n</code></pre>\n\n<p>My function is only printing the final number obviously because i'm not iterating over a list of these numbers.  How do I do that?</p>\n\n<pre><code>oddOnly x\n    | x &lt; 0 = error \"neg\"\n    | x == 0 = \"0\"\n    | mod x 2 /= 0 = show x\n</code></pre>\n"}, {"tags": ["haskell", "profiling", "ghc", "heap-profiling"], "owner": {"reputation": 345, "user_id": 2610474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c1c33bc50efcb00a277fd29737d8f73?s=128&d=identicon&r=PG", "display_name": "dremodaris", "link": "https://stackoverflow.com/users/2610474/dremodaris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 0, "score": 7, "last_activity_date": 1566984842, "creation_date": 1566984842, "question_id": 57689263, "link": "https://stackoverflow.com/questions/57689263/ghc-heap-profiling-with-hy-what-is", "title": "GHC heap profiling with -hy - What is -&gt;, -&gt;&gt;, -&gt;&gt;&gt;?", "body": "<p>When I profile my program's heap usage with -hy flag (for type descriptions) like</p>\n\n<pre><code>./prog +RTS -hy\n</code></pre>\n\n<p>I often see <code>-&gt;a</code>, <code>-&gt;&gt;a</code>, <code>-&gt;&gt;&gt;a</code> in the results (where <code>a</code> is either another type or <a href=\"https://stackoverflow.com/questions/24966628/ghc-heap-profiling-with-hy-what-is-star\"><code>*</code></a>). What does this mean?</p>\n"}, {"tags": ["algorithm", "haskell", "integer", "multiplication"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1566982923, "post_id": 57688078, "comment_id": 101822190, "body": "I don&#39;t know the algorithm, but I did find <a href=\"https://hackage.haskell.org/package/integer-gmp-1.0.2.0/docs/src/GHC.Integer.Type.html#timesInteger\" rel=\"nofollow noreferrer\">the source</a>, which might be relevant."}, {"owner": {"reputation": 1055, "user_id": 593298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51e634a7316f1a4101f65519d2110cce?s=128&d=identicon&r=PG", "display_name": "keep_learning", "link": "https://stackoverflow.com/users/593298/keep-learning"}, "edited": false, "score": 4, "creation_date": 1566985220, "post_id": 57688078, "comment_id": 101823422, "body": "In Haskell, for arbitrary precision arithmetic  GMP library is used. <a href=\"https://gitlab.haskell.org/ghc/ghc/wikis/commentary/libraries/integer\" rel=\"nofollow noreferrer\">gitlab.haskell.org/ghc/ghc/wikis/commentary/libraries/intege&zwnj;&#8203;r</a>. In GMP library, there are few algorithms used for multiplication <a href=\"https://gmplib.org/manual/Multiplication-Algorithms.html\" rel=\"nofollow noreferrer\">gmplib.org/manual/Multiplication-Algorithms.html</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1566991714, "post_id": 57688078, "comment_id": 101826952, "body": "I doubt the Haskell standard defines this at all \u2013 for all it cares about, <code>Integer</code> could be implemented with Peano naturals and iterated addition. As for GHC \u2013 like keep_learning says, it doesn&#39;t try to be clever with this either but just invokes the GMP library."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1566998310, "post_id": 57688078, "comment_id": 101830850, "body": "GMP appears to use Sch&#246;nhage-Strassen, but not until you start dealing with numbers with 10s of thousands of decimal digits."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 1, "creation_date": 1567021952, "post_id": 57688078, "comment_id": 101842286, "body": "There&#39;s some licensing issues with libgmp, you can google it but occasionally integer-simple is used instead or you can also look at integer-openssl"}], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 2, "answer_count": 0, "score": 0, "last_activity_date": 1567059007, "creation_date": 1566980963, "question_id": 57688078, "link": "https://stackoverflow.com/questions/57688078/what-is-the-algorithm-used-in-integer-multiplication", "title": "What is the algorithm used in Integer multiplication?", "body": "<p>What is the algorithm used in <code>Integer</code> multiplication?</p>\n\n<p>Is it a fast algorithm like Sch\u00f6nhage-Strassen algorithm?</p>\n"}, {"tags": ["haskell", "space-leak", "writer-monad"], "comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1566956037, "post_id": 57683953, "comment_id": 101813975, "body": "<code>Writer</code> is just <code>WriterT</code> with <code>m ~ Identity</code>, and the space leak issue with <code>Writer</code> is frequently discussed using the list monoid so <code>++</code> <b>is</b> the <code>mappened</code> operation, which as you note is lazy in the second parameter."}, {"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1566956496, "post_id": 57683953, "comment_id": 101814030, "body": "@Ben, I understand that <code>Writer w ~ WriterT w m</code>, as well as <code>mappend = (++)</code> in the list monoid. Given that the general <code>WriterT</code> has space leak problems, what I wonder was whether this also apply to the simple <code>Writer</code> monad with lazy <code>mappend</code>. I am asking <b>whether space leaks also happen</b> in such situations."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566958642, "post_id": 57683953, "comment_id": 101814398, "body": "It would leak.  See <a href=\"https://blog.infinitenegativeutility.com/2016/7/writer-monads-and-space-leaks\" rel=\"nofollow noreferrer\">blog.infinitenegativeutility.com/2016/7/&hellip;</a>"}, {"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566958943, "post_id": 57683953, "comment_id": 101814456, "body": "@ThomasM.DuBuisson I have read that before. Actually, I learned about space leaks on <code>Writer</code> monads just from that blog. But it did not clarify the space leak issue when <code>mappend</code> does not force the evaluation of its second parameter."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566960931, "post_id": 57683953, "comment_id": 101814745, "body": "I found Getty&#39;s write up really fitting &quot;notice that in order to start evaluating the call to mappend in step C, we need to have the output from both steps A and B. \u2026except step B represents evaluating the entire rest of the computation, including an arbitrarily large number of other calls to &gt;&gt;=&quot;.  I.E. the leak happens before mappend is ever called."}, {"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566961123, "post_id": 57683953, "comment_id": 101814779, "body": "@ThomasM.DuBuisson Oh, I got it. I finally noticed the <code>b</code> in the bind operator. That result is from the second action, so the second action should still performed before <code>mappend</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1566961673, "post_id": 57683953, "comment_id": 101814855, "body": "@Krantz Apologies for being unclear. I was trying to say that your 2 suggestions are usually present in examples given when discussing the problem, which wouldn&#39;t be the case if your 2 suggestions avoided the problem."}, {"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1566961877, "post_id": 57683953, "comment_id": 101814878, "body": "@Ben Thanks. I think I know the actual issue now. The leak happens because of the non-tail-recursive nature of the bind operator, not because of strictness."}], "owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1566955527, "creation_date": 1566955527, "question_id": 57683953, "link": "https://stackoverflow.com/questions/57683953/can-we-avoid-space-leaks-in-the-writer-monad-by-making-mappend-non-strict-on-the", "title": "Can we avoid space leaks in the Writer monad by making mappend non-strict on the second parameter", "body": "<p>I recently read about the space leak issue of the <code>Writer</code>/<code>WriterT</code> monad. If I correctly understood this problem, it is because the bind operator, i.e. <code>(&gt;&gt;=)</code> is not tail-recursive:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>m &gt;&gt;= f = WriterT $ do\n    (a, w1) &lt;- runWriterT m\n    (b, w2) &lt;- runWriterT (f a)\n    return (b, w1 `mappend` w2)\n</code></pre>\n\n<p>With the definition of <code>WriterT</code> and <code>Writer</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype WriterT w m a = WriterT { runWriterT :: m (a, w) }\ntype Writer w = WriterT w Identity\n</code></pre>\n\n<p>I am curious about whether introducing laziness on the second parameter of <code>mappend</code> would solve this space-leak problem.</p>\n\n<p>By introducing laziness, I mean something like the <code>(++)</code> operator:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(++) :: [a] -&gt; [a] -&gt; [a]\n(++) []     ys = ys\n(++) (x:xs) ys = x : (xs ++ ys)\n</code></pre>\n\n<p>The result is produced without actually touching the second parameter.</p>\n\n<p>Now, if we use a monad <code>m</code> with lazy monadic bind (e.g. <code>m ~ Identity</code>, which gives us the plain old <code>Writer</code> monad), and use <code>mappend</code> mentioned above, then the <code>f a</code> part (<code>w2</code>) can remain a thunk while evaluating <code>mappend w1 w2</code>, thus the result can be partially consumed (<code>w1</code>) without actually forcing the rest expression (<code>w2</code>).</p>\n\n<p>Am I correct on this? Are space leaks avoided in such <code>Writer</code> monads?</p>\n"}, {"tags": ["unit-testing", "haskell", "exception"], "comments": [{"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "edited": false, "score": 0, "creation_date": 1566960942, "post_id": 57683593, "comment_id": 101814747, "body": "FYI, FP Complete suggest not to use the <code>ExceptT IO</code> pattern, for <code>IO</code> implies you can throw any exception you want, and the <code>ExceptT e</code> suggests that the action can only throw exceptions of type <code>e</code> (through <code>throwE</code>), which is a false implication."}, {"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "reply_to_user": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "edited": false, "score": 0, "creation_date": 1567244891, "post_id": 57683593, "comment_id": 101912907, "body": "@Krantz So should I not write generic monads (<code>ExceptT e m</code>) and simply always write specific monads (<code>ExceptT IOException IO</code>) ?"}, {"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "edited": false, "score": 0, "creation_date": 1567259706, "post_id": 57683593, "comment_id": 101916305, "body": "According to that article, actually, when you have IO in your monad stack, that implies all kinds of exceptions can happen through <code>throwIO</code>, so there is no point adding another layer of <code>ExceptT</code>. If you are interested, google \u201cReaderT design pattern\u201d, and you will find this article."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1566971980, "creation_date": 1566971980, "answer_id": 57685929, "question_id": 57683593, "link": "https://stackoverflow.com/questions/57683593/should-i-mock-io-or-not/57685929#57685929", "title": "Should I mock IO or not?", "body": "<blockquote>\n  <p>Then what's the point of replacing <code>IO</code> with a generic <code>Monad</code> in the first place?</p>\n</blockquote>\n\n<p>As a general piece of advice, that might enable you to replace <code>IO</code> with something pure when testing.</p>\n\n<p><a href=\"https://martinfowler.com/articles/nonDeterminism.html\" rel=\"nofollow noreferrer\">Unit tests ought to be deterministic</a>, which is one of the two characteristics of <a href=\"https://en.wikipedia.org/wiki/Pure_function\" rel=\"nofollow noreferrer\">pure functions</a>. Thus, being able to frame any problem in terms of pure functions makes it <a href=\"https://blog.ploeh.dk/2015/05/07/functional-design-is-intrinsically-testable\" rel=\"nofollow noreferrer\">intrinsically testable</a>.</p>\n\n<p>In order to make a set of interactions pure and testable, you can, for example, replace <code>m</code> with <code>State</code>, and run your unit tests in the <code>State</code> monad. <a href=\"https://blog.ploeh.dk/2019/03/11/an-example-of-state-based-testing-in-haskell\" rel=\"nofollow noreferrer\">Here's an example</a>. Here's <a href=\"https://blog.ploeh.dk/2019/04/08/a-pure-test-spy\" rel=\"nofollow noreferrer\">an example with <code>Writer</code></a>.</p>\n\n<p>In general, I'd recommend avoiding 'mocking' if possible. In object-oriented programming, this may be a necessary evil to enable testing, but it typically leads to hard-to-maintain code. In functional programming, unit testing is much easier, but it typically requires you to design the modules of your application in a functional style.</p>\n\n<p>Introducing a type class as something equivalent to an object-oriented interface or base class is unlikely to lead to a a functional design. This will pull you towards a programming model where the (impure) interactions are at the centre of your application architecture. That's exactly what makes object-oriented programming so difficult.</p>\n\n<p>In functional programming, you're much better off <a href=\"https://blog.ploeh.dk/2016/03/18/functional-architecture-is-ports-and-adapters\" rel=\"nofollow noreferrer\">pushing the impure interactions to the edge of the system</a>. This'll enable you to unit test your (pure) domain logic, while the IO remains concrete.</p>\n"}], "owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1566972071, "creation_date": 1566951636, "last_edit_date": 1566972071, "question_id": 57683593, "link": "https://stackoverflow.com/questions/57683593/should-i-mock-io-or-not", "title": "Should I mock IO or not?", "body": "<p>Say I have a simple file based database <code>Monad</code>. I would define it as shown below.</p>\n\n<pre><code>newtype MyDbFileBased a = MyDbFileBased {\n        unMyDbDbFileBased :: ExceptT MyDbFileBasedError (ReaderT MyDbFileBasedEnv IO) a\n    } deriving (\n        Functor\n    ,   Applicative\n    ,   Monad\n    ,   MonadError MyDbFileBasedError\n    ,   MonadReader MyDbFileBasedEnv\n    ,   MonadIO\n    )\n</code></pre>\n\n<p>I have read that the above pattern (will post a link to the blog when I find it) is not recommended and that I should replace <code>IO</code> with a generic <code>Monad</code> like so.</p>\n\n<pre><code>import qualified Data.ByteString as B\n\nnewtype MyDbFileBased m a = MyDbFileBased {\n        unMyDbFileBased :: ExceptT MyDbFileBasedError (ReaderT MyDbFileBasedEnv m) a\n    } deriving (\n        Functor\n    ,   Applicative\n    ,   Monad\n    ,   MonadError MyDbFileBasedError\n    ,   MonadReader MyDbFileBasedEnv\n    )\n\nclass Monad m =&gt; MonadFileBasedIO m where \n    readBytes :: FilePath -&gt; m B.ByteString \n    writeBytes :: FilePath -&gt; B.ByteString -&gt; m () \n    ...\n\ninstance MonadFileBasedIO IO where \n    readBytes = B.readFile\n    writeBytes = B.writeFile\n</code></pre>\n\n<p>This will supposedly make unit testing easier. The advise is to mock IO in testing with something like as follows.</p>\n\n<pre><code>data MockFS = EmptyDir\n            | SingleFile FilePath String \n            deriving (Show)\n\nnewtype MockFileBasedIO a = MockFileBasedIO {\n        unMockFileBasedIO :: State MockFS a\n    } deriving (\n        Functor\n    ,   Applicative\n    ,   Monad \n    ,   MonadState MockFS\n    )\n\ninstance MonadFileBasedIO MockFileBasedIO where \n    readBytes pathReq = do\n        dir &lt;- get\n        case dir of \n            EmptyDir                 -&gt; fail \"file not found\"\n            SingleFile path contents -&gt; if pathReq == path \n                                            then pure (BU.fromString contents) \n                                            else fail \"file not found\"\n\n    writeBytes path = put . SingleFile path . BU.toString \n</code></pre>\n\n<p>All this looks good to me until now. But then I want to add things like <code>catch</code> and <code>liftIO</code> to functions within <code>MyDbFileBased</code> type. I thought of adding <code>catchMonadFileBasedIO</code> and <code>liftMonadFileBasedIO</code> functions to <code>MonadFileBasedIO</code> typeclass and set <code>catchMonadFileBasedIO = catch</code> and <code>liftMonadFileBasedIO = liftIO</code> for <code>IO</code> monad. But then it brings in dependency on <code>MonadIO</code> and <code>Exception</code> typeclasses and the compiler tells me to add these typeclasses to function signatures of <code>catchMonadFileBasedIO</code> and <code>liftMonadFileBasedIO</code>. Also I would need to derive <code>MonadIO</code> from <code>MyDbFileBased m</code>. Then what's the point of replacing <code>IO</code> with a generic <code>Monad</code> in the first place?</p>\n\n<p>I don't understand if I should be mocking <code>IO</code> in cases such as these or not. How do I use <code>liftIO</code> and <code>catch</code> if we mock it? Should I not catch exceptions in this module and cascade them to application level? </p>\n"}, {"tags": ["haskell", "dsl", "tagless-final"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1566965328, "post_id": 57680170, "comment_id": 101815485, "body": "Completely tangential, but you should modernize this to <code>data Dexterity = L | R</code> and <code>data Expr (d :: Dexterity) where Var :: ... -&gt; Expr L; Num ... -&gt; Expr R</code>."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1566969329, "post_id": 57680170, "comment_id": 101816362, "body": "@HTNW That would certainly be tidier. Thanks."}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 3, "answer_count": 0, "score": 12, "last_activity_date": 1567223425, "creation_date": 1566929503, "last_edit_date": 1567223425, "question_id": 57680170, "link": "https://stackoverflow.com/questions/57680170/tagless-final-dsl-with-rvalue-lvalue-problems", "title": "Tagless final DSL with RValue LValue problems", "body": "<p><a href=\"http://okmij.org/ftp/tagless-final/course/lecture.pdf\" rel=\"nofollow noreferrer\">Typed Tagless Final Interpreters</a> are an interesting alternative to the <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">free monad</a> approach.</p>\n\n<p>But even with a quite simple <code>ToyLang</code> example in tagless final style ambiguous type variables pop up.</p>\n\n<p><code>ToyLang</code> is an EDSL that should read something like this:</p>\n\n<pre><code>toy :: ToyLang m =&gt; m (Maybe Int)\ntoy = do\n    a &lt;- int \"a\"       -- declare a variable and return a reference\n    a .= num 1         -- set a to 1\n    a .= a .+ num 1    -- add 1 to a\n    ret a              -- returns a\n</code></pre>\n\n<p>The general goal is, of course, to use the Haskell type system as much as possible in this EDSL, and use polymorphism to instantiate various interpreters.</p>\n\n<p>All would be well if it weren't for the <code>(.+)</code> operation which leads to the notion of lvalue and rvalue: The assignment operator <code>(.=)</code> has a lvalue to its left and either an lvalue or rvalue to its right. The basic idea is taken from two comments in <a href=\"https://augustss.blogspot.com/2011/07/impredicative-polymorphism-use-case-in.html\" rel=\"nofollow noreferrer\">Impredicative Polymorphisms, a Use Case</a>:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata L -- dummies for Expr (see the comments for a better way)\ndata R\n\n-- An Expr is either a lvalue or a rvalue\ndata Expr lr where\n    Var :: String -&gt; Maybe Int -&gt; Expr L\n    Num :: Maybe Int -&gt; Expr R\n\n-- tagless final style\nclass Monad m =&gt; ToyLang m where\n    int :: String -&gt; m (Expr L)             -- declare a variable with name\n    (.=) :: Expr L -&gt; Expr lr -&gt; m (Expr L) -- assignment\n    (.+) :: Expr lr -&gt; Expr lr' -&gt; Expr R   -- addition operation - TROUBLE!\n    ret :: Expr lr -&gt; m (Maybe Int)         -- return anything\n    end :: m ()                             -- can also just end\n</code></pre>\n\n<p>A pretty-print 'interpreter' would start like this:</p>\n\n<pre><code>import Control.Monad.Writer.Lazy\n\n-- A ToyLang instance that just dumps the program into a String\ninstance ToyLang (Writer String) where\n    int n = do\n        tell $ \"var \" &lt;&gt; n &lt;&gt; \"\\n\"\n        return (Var n Nothing)\n    (.=) (Var n _) e = do\n        tell $ n &lt;&gt; \" = \" &lt;&gt; toString e &lt;&gt; \"\\n\"\n        return $ Var n (toVal e)\n    ...\n</code></pre>\n\n<p>where the little helper <code>toString</code> has to dig out the values from the summands of the GADT:</p>\n\n<pre><code>toString :: Expr lr -&gt; String\ntoString (Var n mi) = n\ntoString (Num i)    = show i\n</code></pre>\n\n<p>The smart constructor <code>num</code> is simply</p>\n\n<pre><code>num :: Int -&gt; Expr R\nnum = Num . Just\n</code></pre>\n\n<p>The <code>(.+)</code> is troublesome for two reasons: </p>\n\n<ol>\n<li><p><code>(.+)</code> is not in the monad <code>m</code> because otherwise we can't write <code>a .= a + num 1</code>, but for the <code>Writer String</code> instance, for example, the monad is needed in order to <code>tell</code>.</p></li>\n<li><p>The typechecker barks at the ambiguous types created by <code>(.+) :: Expr lr -&gt; Expr lr' -&gt; Expr R</code>. It is clear that it would, without further annotation it can't decide which instance is meant. But annotating a clause like <code>a .= a .+ num 1</code>, if at all possible, would make the DSL very clunky.</p></li>\n</ol>\n\n<p>One way to make the types work is by moving <code>(.+)</code> into the monad to some extent, and <code>(.=)</code>, too:</p>\n\n<pre><code> class Monad m =&gt; ToyLang m where\n    ...\n    (.=) :: Expr L -&gt; m (Expr lr) -&gt; m (Expr L)\n    (.+) :: Expr lr -&gt; m (Expr lr') -&gt; m (Expr R)\n    ...\n</code></pre>\n\n<p>All this is strange, though:</p>\n\n<ul>\n<li><p><code>(.=)</code> and <code>(.+)</code> are asymmetric in where they need the monad <code>m</code> and where they don't.</p></li>\n<li><p>Even in the <code>Writer String</code> monad I'm forced to do integer arithmetic in order to create the <code>m (Expr R)</code> return type, although there isn't really any need for the result</p></li>\n<li><p>Instantiating <code>ToyLang</code> as a <code>Writer String</code> looks neat, but doesn't really do the job. <code>a .= a .+ num 1</code> cannot be pretty-printed as such because <code>a .+ num 1</code> gets evaluated (hence printed) before the <code>.=</code>.</p></li>\n</ul>\n\n<p>This is somehow all wrong, I feel. Is there a better way to do this?</p>\n\n<p>The source code for this <code>ToyLang</code> example is on <a href=\"https://github.com/mcmayer/tagless-final-toylang.git\" rel=\"nofollow noreferrer\">github</a>.</p>\n\n<p>References: </p>\n\n<ul>\n<li><a href=\"http://okmij.org/ftp/tagless-final/course/lecture.pdf\" rel=\"nofollow noreferrer\">Typed Tagless Final Interpreters</a> by Oleg Kiselyov</li>\n<li><a href=\"https://augustss.blogspot.com/2011/07/impredicative-polymorphism-use-case-in.html\" rel=\"nofollow noreferrer\">Impredicative polymorphism, a use case</a> by augustss</li>\n<li><a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">Why Free Monads Matter</a> by Gabriel Gonzalez </li>\n<li><a href=\"https://jproyo.github.io/posts/2019-03-17-tagless-final-haskell.html\" rel=\"nofollow noreferrer\">Tagless Final Encoding in Haskell</a> by J. P. Royo Sales</li>\n</ul>\n"}, {"tags": ["haskell", "stm"], "answers": [{"comments": [{"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 0, "creation_date": 1566911396, "post_id": 57675199, "comment_id": 101797907, "body": "Sorry just one more thing, I think that there may be a problem with how I defined my state. I&#39;m getting the error: &quot;Couldn&#39;t match expected type \u2018[State]\u2019 with actual type \u2018State\u2019&quot;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 0, "creation_date": 1566911487, "post_id": 57675199, "comment_id": 101797966, "body": "@timothyylim: did you use <code>fmap</code>? By defining your <code>TVar</code> to store a <i>list</i> of <code>State</code>s, you need some way to handle such list."}, {"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 0, "creation_date": 1566911556, "post_id": 57675199, "comment_id": 101798011, "body": "Yep, am using fmap as suggested!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 1, "creation_date": 1566911691, "post_id": 57675199, "comment_id": 101798098, "body": "@timothyylim: the error is in your <code>updateStateFunction</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1566911742, "last_edit_date": 1566911742, "creation_date": 1566910547, "answer_id": 57675199, "question_id": 57675081, "link": "https://stackoverflow.com/questions/57675081/modify-and-print-state-using-stm/57675199#57675199", "title": "Modify and print state using STM", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Conc.html#v:writeTVar\" rel=\"nofollow noreferrer\"><strong><code>writeTVar :: TVar a -&gt; a -&gt; STM ()</code></strong></a>:</p>\n\n<pre><code>main :: IO ()\nmain = do \n    state &lt;- atomically initState\n    stateToPrint &lt;- readTVarIO state\n    putStrLn (show stateToPrint)\n    atomically (readTVar state &gt;&gt;= <b>writeTVar state . fmap (updateState \"foo\")</b>)</code></pre>\n\n<p>We here thus read the content of the <code>state</code>, then we pass it through an <code>fmap updateState</code> to update the elements in the list, and then we write that to the <code>state</code> var.</p>\n\n<p>That being said, it might be useful to look for a state monad transformer, like in the <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-State.html\" rel=\"nofollow noreferrer\"><strong><code>Control.Monad.Trans.State</code></strong> module</a> of the <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/\" rel=\"nofollow noreferrer\"><strong><code>transformers</code></strong> package</a>.</p>\n\n<p>Note that your <code>updateState</code> function is not properly defined, you perhaps want to define this like:</p>\n\n<pre><code>updateState :: String -&gt; State -&gt; State \nupdateState newName (State <b>s) = State (newName ++ s)</b></code></pre>\n"}], "owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 57675199, "answer_count": 1, "score": 2, "last_activity_date": 1566911742, "creation_date": 1566910126, "last_edit_date": 1566910679, "question_id": 57675081, "link": "https://stackoverflow.com/questions/57675081/modify-and-print-state-using-stm", "title": "Modify and print state using STM", "body": "<p>I'm able to initialise a state using STM and print it out:</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent.STM\n\ndata State = State {name :: String} deriving (Show)\n\ntype MyAppState = TVar [State]\n\ninitState :: STM MyAppState\ninitState = newTVar [State \"hi\"]\n\nmain :: IO ()\nmain =  \n  do \n    state &lt;- atomically initState\n    stateToPrint &lt;- readTVarIO state\n    putStrLn (show stateToPrint)\n</code></pre>\n\n<p>I have tried to create function to update the state:</p>\n\n<pre><code>updateState :: String -&gt; State -&gt; State \nupdateState newName s = State newName : s\n</code></pre>\n\n<p>But I'm not sure how to place it in the main 'do' block without the compiler throwing an error since it expects a type of <code>State</code> but it is passed a <code>MyAppState</code>.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1566894066, "post_id": 57667534, "comment_id": 101788319, "body": "String search algorithms don&#39;t require a parser - is there a reason you&#39;re looking to solve this using parsec? Look up Boyer-Moore, for example, or Knuth Morris Pratt.  If performance doesn&#39;t matter then you can just do the naive thing and check isPrefixOf, then drop a character and repeat."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566897089, "post_id": 57667534, "comment_id": 101789943, "body": "@ThomasM.DuBuisson The OP does say: \u2018I\u2019ve been trying to do it with a parser just as an exercise\u2019."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1566922304, "post_id": 57667534, "comment_id": 101804063, "body": "Parsers are most suitable when you can make sense of all the input data. They&#39;re not as great at extracting a little signal from a lot of noise. Certainly it&#39;s still possible, but it&#39;s not really their strong suit."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566925537, "post_id": 57667534, "comment_id": 101805418, "body": "For turning a list of strings into a parser, you might like <a href=\"https://stackoverflow.com/q/34356668/791604\">this question</a>. It isn&#39;t hard to turn it case-insensitive and spaces-or-hyphens-insensitive; then just use <code>sepBy</code> or similar to iterate it."}, {"owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1567395669, "post_id": 57667534, "comment_id": 101939337, "body": "This is a good question and should not be downvoted. It is totally natural to want to do pattern-matching search with parsers, and good answers exist."}], "answers": [{"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": true, "score": 1, "last_activity_date": 1567089967, "creation_date": 1567089967, "answer_id": 57712672, "question_id": 57667534, "link": "https://stackoverflow.com/questions/57667534/how-can-i-use-a-parser-in-haskell-to-find-the-locations-of-some-substrings-in-a/57712672#57712672", "title": "How can I use a parser in Haskell to find the locations of some substrings in a string?", "body": "<p>We can find substring locations with a parser by using the <a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:sepCap\" rel=\"nofollow noreferrer\"><code>sepCap</code></a> combinator from <a href=\"https://hackage.haskell.org/package/replace-megaparsec/\" rel=\"nofollow noreferrer\">replace-megaparsec</a>.</p>\n\n<p>Here's a solution to your example problem. Requires packages <code>megaparsec, replace-megaparsec, containers</code>.\nReferences:\n<a href=\"http://hackage.haskell.org/package/megaparsec/docs/Text-Megaparsec-Char.html#v:string-39-\" rel=\"nofollow noreferrer\"><code>string'</code></a>\n<a href=\"http://hackage.haskell.org/package/parser-combinators/docs/Control-Monad-Combinators.html#v:choice\" rel=\"nofollow noreferrer\"><code>choice</code></a>\n<a href=\"http://hackage.haskell.org/package/megaparsec/docs/Text-Megaparsec.html#v:getOffset\" rel=\"nofollow noreferrer\"><code>getOffset</code></a>\n<a href=\"http://hackage.haskell.org/package/megaparsec/docs/Text-Megaparsec.html#v:try\" rel=\"nofollow noreferrer\"><code>try</code></a>\nfrom Megaparsec.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Replace.Megaparsec\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport Data.Maybe\nimport Data.Either\nimport Data.Map.Strict as Map\n\nlet colorWords :: Parsec Void String (String, [Int])\n    colorWords = do\n            i &lt;- getOffset\n            c &lt;- choice\n                [ try $ string' \"blue\" &gt;&gt;\n                        anySingle &gt;&gt;\n                        string' \"green\" &gt;&gt;\n                        pure \"blue green\"\n                , try $ string' \"blue\" &gt;&gt; pure \"blue\"\n                , try $ string' \"green\" &gt;&gt; pure \"green\"\n                ]\n            return (c,[i])\n\ninput = \"First there was blue\\nand then there was Green,\\nand then blue\\ngreen all of a sudden, and not to mention blue-green\"\n\nMap.toList $ Map.fromListWith mappend $ rights $ fromJust\n    $ parseMaybe (sepCap colorWords) input\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[(\"blue\",[16]),(\"blue green\",[103,56]),(\"green\",[40])]\n</code></pre>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 57712672, "answer_count": 1, "score": 0, "last_activity_date": 1567089967, "creation_date": 1566878588, "question_id": 57667534, "link": "https://stackoverflow.com/questions/57667534/how-can-i-use-a-parser-in-haskell-to-find-the-locations-of-some-substrings-in-a", "title": "How can I use a parser in Haskell to find the locations of some substrings in a string?", "body": "<p>I'm very new to Haskell. I'd like to be able to find some color expressions in a string. So let's say I have this list of expressions: </p>\n\n<pre><code>colorWords = [\"blue\", \"green\", \"blue green\"]\n</code></pre>\n\n<p>And I want to be able to get the locations of all of those, anywhere in a string, even if it's broken up by a linebreak, or if a hyphen separates it instead. So given a string like: </p>\n\n<pre><code>First there was blue     \nand then there was Green,     \nand then blue    \ngreen all of a sudden, and not to mention blue-green\n</code></pre>\n\n<p>It should give the character offsets for \"blue\" (line one), \"green\" (line two), and \"blue green\" (lines 3-4) and \"blue-green\" (line 4), something like: </p>\n\n<pre><code>[(\"blue\", [20]), (\"green\", [40]), (\"blue green\", [50, 65])]\n</code></pre>\n\n<p>I can do this with regexes, but I've been trying to do it with a parser just as an exercise. I'm guessing it's something like: </p>\n\n<pre><code>import Text.ParserCombinators.Parsec\n\nseparator = spaces &lt;|&gt; \"-\" &lt;|&gt; \"\\n\"\n\ncolorExp colorString = if (length (words colorString))&gt;1 then \n  multiWordColorExp colorString\n  else colorString\n\nmultiWordColorExp :: Parser -&gt; String\nmultiWordColorExp colorString = do\n  intercalate separator (words colorString)\n</code></pre>\n\n<p>But I have no idea what I'm doing, and I'm not really getting anywhere with this. </p>\n"}, {"tags": ["haskell", "haskell-vector"], "comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 1, "creation_date": 1566855434, "post_id": 57664835, "comment_id": 101779148, "body": "If you want to modify a matrix, why don&#39;t you use a matrix instead of a vector? Here is a similar way to manipulate an array of arbitrary dimension as you would do with <code>modify</code> on vector: <a href=\"https://hackage.haskell.org/package/massiv-0.4.0.0/docs/Data-Massiv-Array-Mutable.html#v:withMArrayST\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/massiv-0.4.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1566861826, "post_id": 57664835, "comment_id": 101780645, "body": "Yep. First to it say which row to modify, then you say how to modify that row (i.e. modify the element)."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 2, "creation_date": 1566869208, "post_id": 57664835, "comment_id": 101781774, "body": "Unless you expect a ragged array, vector of vectors approach should be avoided, since it has serious drawbacks. First of all performance penalty: the outer vector has to be boxed (which means an extra pointer indirection), secondly safety: you can&#39;t guarantee the length of your rows, and last but not least, operating on it becomes very cumbersome ;)"}, {"owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1566872135, "post_id": 57664835, "comment_id": 101782243, "body": "I wish the hackage page for Vector would have given this advice! It would have saved me days of headache."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566872228, "post_id": 57664835, "comment_id": 101782257, "body": "You could submit a pull request to the vector package to work it into the summary so it appears on hackage."}], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1566944590, "post_id": 57680178, "comment_id": 101812204, "body": "In <code>reverseMatrix</code>, what does the constraint <code>Mutable r Ix2 e</code> achieve? Does it refer to <code>Data.Massiv.Array.Mutable</code> ?"}, {"owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1566945057, "post_id": 57680178, "comment_id": 101812300, "body": "And how could I modify the matrix by modifying the element, say from <code>Int</code> to <code>(Int, String)</code>? For starters, I would think <code>r</code> in the type signature would need to be constrained to <code>U</code>."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1566946371, "post_id": 57680178, "comment_id": 101812528, "body": "&gt; Does it refer to Data.Massiv.Array.Mutable ? It refers to class <a href=\"https://www.stackage.org/haddock/nightly-2019-08-27/massiv-0.4.0.0/Data-Massiv-Array-Mutable.html#t:Mutable\" rel=\"nofollow noreferrer\">stackage.org/haddock/nightly-2019-08-27/massiv-0.4.0.0/&hellip;</a>  But all functions in the above mentioned module will work on arrays that have an instance of that class"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1566946765, "post_id": 57680178, "comment_id": 101812609, "body": "Yes using <code>U</code> for <code>r</code> is good, except that <code>String</code> (<code>[Char]</code>) doesn&#39;t have an <code>Unbox</code> instance, so converting elements to <code>(Int, String)</code> is not a good idea. Secondly, once you have a mutable array, you cannot change the type of its element. Which is obvious if you think about it, elements of different type are likely to occupy more memory, so you&#39;d have to allocate new mutable array and fill it in. All that being said, very often it is possible to avoid mutable interface and rewrite an algorithm in a pure fashion, give it a try."}, {"owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1566950023, "post_id": 57680178, "comment_id": 101813116, "body": "To modify the element, I could convert the array to list, map, then convert back to array (of new element type) -- but is this overly expensive?"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1566953473, "post_id": 57680178, "comment_id": 101813592, "body": "It will be ridiculously expensive, avoid using lists at all cost, unless you don&#39;t care about performance. There are many functions in <code>massiv</code>, including <code>map</code>, so checkout the examples and look through the readme and I am sure you&#39;ll find what you are looking for. There was also a workshop I did couple months ago, if you want to learn more about massiv: <a href=\"https://www.youtube.com/watch?v=euEacUD6jQQ\" rel=\"nofollow noreferrer\">youtube.com/watch?v=euEacUD6jQQ</a>"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 2, "last_activity_date": 1566939359, "last_edit_date": 1566939359, "creation_date": 1566929525, "answer_id": 57680178, "question_id": 57664835, "link": "https://stackoverflow.com/questions/57664835/data-vector-modify-with-nested-vectors/57680178#57680178", "title": "Data.Vector.modify with nested vectors", "body": "<p>My suggestion from the comments still stands, if you do not need to operate on a ragged array then the usual rectangular array implementation is better. Here is a short list of drawbacks of vector of vectors:</p>\n\n<ul>\n<li>performance penalty: the outer vector has to be boxed (which means an extra pointer indirection)</li>\n<li>safety: you can't guarantee the same length of all rows</li>\n<li>operating on ragged arrays is cumbersome</li>\n</ul>\n\n<p>Nevertheless question still stands: how would you modify a vector of vectors in place. Below I'll provide an example function, which uses mutation to reverse rows of a ragged array and another function that reverses both rows and columns. Difference is that in the former we only mutate elements of each row, while in the latter we also mutate the outer boxed vector that corresponds to rows themselves:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE RankNTypes #-}\nimport Control.Monad as M\nimport Control.Monad.ST\nimport Prelude as P\nimport Data.Vector as V\nimport Data.Vector.Generic.Mutable as VGM\nimport Data.Vector.Mutable as VM\nimport Data.Vector.Primitive as VP\nimport Data.Vector.Primitive.Mutable as VPM\n\nraggedModifyRows ::\n     VP.Prim a\n  =&gt; (forall s. V.Vector (VPM.MVector s a) -&gt; ST s ())\n  -&gt; V.Vector (VP.Vector a)\n  -&gt; V.Vector (VP.Vector a)\nraggedModifyRows action arr = runST $ do\n  -- thaw will create a copy of each row, so they can be safely modified\n  mvs &lt;- V.mapM VP.thaw arr\n  action mvs\n  -- We are freezing mutated copies, so it is safe to use unsafeFreeze here too\n  V.mapM VP.unsafeFreeze mvs\n\nraggedModify ::\n     VP.Prim a\n  =&gt; (forall s. VM.MVector s (VPM.MVector s a) -&gt; ST s ())\n  -&gt; V.Vector (VP.Vector a)\n  -&gt; V.Vector (VP.Vector a)\nraggedModify action arr = runST $ do\n  arr' &lt;- V.mapM VP.thaw arr\n  -- mapM already created a copy of a boxed vector, so we can use unsafeThaw\n  mv &lt;- V.unsafeThaw arr'\n  action mv\n  v &lt;- V.unsafeFreeze mv\n  V.mapM VP.unsafeFreeze v\n\ngenerateMatrix ::\n     Prim a =&gt; (Int, Int) -&gt; ((Int, Int) -&gt; a) -&gt; V.Vector (VP.Vector a)\ngenerateMatrix (m, n) f = V.generate m $ \\ i -&gt; VP.generate n $ \\j -&gt; f (i, j)\n\ngenerateRagged ::\n     Prim a =&gt; V.Vector Int -&gt; ((Int, Int) -&gt; a) -&gt; V.Vector (VP.Vector a)\ngenerateRagged v f = V.imap (\\ i n -&gt; VP.generate n $ \\j -&gt; f (i, j)) v\n\nreverseST :: (VGM.MVector v a) =&gt; v s a -&gt; ST s ()\nreverseST mv =\n  let n = VGM.length mv\n   in M.forM_ [0 .. (n `div` 2) - 1] $ \\j -&gt; VGM.swap mv j (n - j - 1)\n\nreverseRaggedRows :: Prim a =&gt; V.Vector (VP.Vector a) -&gt; V.Vector (VP.Vector a)\nreverseRaggedRows = raggedModifyRows $ \\rows -&gt; V.forM_ rows reverseST\n\nreverseRagged :: Prim a =&gt; V.Vector (VP.Vector a) -&gt; V.Vector (VP.Vector a)\nreverseRagged =\n  raggedModify $ \\mrows -&gt; do\n    let reverse' i = VM.read mrows i &gt;&gt;= reverseST\n    let m = VM.length mrows\n    M.forM_ [0 .. (m `div` 2) - 1] $ \\i -&gt; do\n      reverse' i\n      VM.swap mrows i (m - i - 1)\n      reverse' i\n    M.when (odd m) $ reverse' (m `div` 2)\n</code></pre>\n\n<p>Which can be used as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; m = generateMatrix (3, 4) $ \\(i, j) -&gt; i+j\n\u03bb&gt; m\n[[0,1,2,3],[1,2,3,4],[2,3,4,5]]\n\u03bb&gt; reverseRaggedRows m\n[[3,2,1,0],[4,3,2,1],[5,4,3,2]]\n\u03bb&gt; reverseRagged m\n[[5,4,3,2],[4,3,2,1],[3,2,1,0]]\n\u03bb&gt; m = generateRagged (V.fromList [1,2,3]) $ \\(i, j) -&gt; i+j\n\u03bb&gt; m\n[[0],[1,2],[2,3,4]]\n\u03bb&gt; reverseRaggedRows m\n[[0],[2,1],[4,3,2]]\n\u03bb&gt; reverseRagged m\n[[4,3,2],[2,1],[0]]\n</code></pre>\n\n<p>Alternatively we could have used <code>Data.Vector.modify</code> to operate on the outer vector or map a destructive action that uses <code>modify</code> across all rows. There are all sorts of ways to go about it, depends on what you are trying to achieve, for example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; m = generateRagged (V.fromList [1,2,3]) $ \\(i, j) -&gt; i+j\n\u03bb&gt; V.map (VP.modify reverseST) m\n[[0],[2,1],[4,3,2]]\n\u03bb&gt; V.modify reverseST (V.map (VP.modify reverseST) m)\n[[4,3,2],[2,1],[0]]\n</code></pre>\n\n<p>I did recommend using <a href=\"https://github.com/lehins/massiv\" rel=\"nofollow noreferrer\"><code>massiv</code></a> for regular multidimensional arrays. Therefore here is also an example of how to achieve the same with <a href=\"https://hackage.haskell.org/package/massiv-0.4.0.0/docs/Data-Massiv-Array-Mutable.html#v:withMArrayST\" rel=\"nofollow noreferrer\"><code>withMArrayST</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleContexts #-}\nimport Control.Monad as M\nimport Data.Massiv.Array as A\n\nreverseMatrix :: Mutable r Ix2 e =&gt; Array r Ix2 e -&gt; Array r Ix2 e\nreverseMatrix arr =\n  withMArrayST arr $ \\marr -&gt; do\n    let Sz2 m n = msize marr\n        ix2@(m2 :. n2) = m `div` 2 :. n `div` 2\n    A.forM_ (0 ..: ix2) $ \\ix@(i :. j) -&gt; do\n      A.swapM_ marr ix (m - i - 1 :. n - j - 1)\n      A.swapM_ marr (i :. n - j - 1) (m - i - 1 :. j)\n    when (odd m) $ A.forM_ (0 ..: n2) $ \\ j -&gt;\n      A.swapM_ marr (m2 :. j) (m2 :. n - j - 1)\n    when (odd n) $ A.forM_ (0 ..: m2) $ \\ i -&gt;\n      A.swapM_ marr (i :. n2) (m - i - 1 :. n2)\n</code></pre>\n\n<p>Which can be used as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; a = makeArrayR P Seq (Sz2 3 4) $ \\ (i :. j) -&gt; i + j\n\u03bb&gt; a\nArray P Seq (Sz (3 :. 4))\n  [ [ 0, 1, 2, 3 ]\n  , [ 1, 2, 3, 4 ]\n  , [ 2, 3, 4, 5 ]\n  ]\n\u03bb&gt; reverseMatrix a\nArray P Seq (Sz (3 :. 4))\n  [ [ 5, 4, 3, 2 ]\n  , [ 4, 3, 2, 1 ]\n  , [ 3, 2, 1, 0 ]\n  ]\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 57680178, "answer_count": 1, "score": 2, "last_activity_date": 1566946850, "creation_date": 1566852977, "last_edit_date": 1566946850, "question_id": 57664835, "link": "https://stackoverflow.com/questions/57664835/data-vector-modify-with-nested-vectors", "title": "Data.Vector.modify with nested vectors", "body": "<p>I have a vector nested inside another. <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:modify\" rel=\"nofollow noreferrer\">I want to use <code>modify</code></a> to update this matrix in place. So I use it for the inner vector, but do I also need to use it for the outer?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1566837787, "post_id": 57661635, "comment_id": 101772624, "body": "It&#39;s not at all clear to me from the description what the desired algorithm is to produce the output."}, {"owner": {"reputation": 41, "user_id": 11979580, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBD6Sbct7-uBduiZObtwAlFzRmExJHma2owThSVug=k-s128", "display_name": "VALENTINA YUSTY MOSQUERA", "link": "https://stackoverflow.com/users/11979580/valentina-yusty-mosquera"}, "edited": false, "score": 0, "creation_date": 1566838397, "post_id": 57661635, "comment_id": 101772841, "body": "I have a chessBoard, which is represented as a list of lists. I want to divide that chessboard into four the upper and lower right corner, the upper and lower left corner, which would be four lists that store each corner. I want a function that returns the 4 lists."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1566938549, "post_id": 57664986, "comment_id": 101810507, "body": "It can be done much more concisely if you imagine choosing the first or second half nondeterministically. So: <code>topBottom xs = let (l, r) = splitAt (length xs `div` 2) xs in [l,r]; leftRight = transpose . map topBottom; corners = leftRight &gt;=&gt; topBottom</code>. You can toss a <code>map concat</code> on at the end if it seems really necessary to throw away that extra structure, but I suspect it&#39;s more useful to keep it anyway."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566939658, "post_id": 57664986, "comment_id": 101810840, "body": "thanks, that&#39;s a nice approach. (I didn&#39;t even realise there was a <code>transpose</code> function in the standard libraries!)"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 3, "last_activity_date": 1566853872, "creation_date": 1566853872, "answer_id": 57664986, "question_id": 57661635, "link": "https://stackoverflow.com/questions/57661635/how-to-iterate-over-a-list-of-lists/57664986#57664986", "title": "How to iterate over a list of lists", "body": "<p>The following is working for me, assuming I have now understood your requirements. There may be more sophisticated ways to do this, but this is a simple one which isn't too painful - the key is to write general functions which can take the first/second half of a list of even length. Then the functions you want are built simply from them:</p>\n\n<pre><code>firstHalf :: [a] -&gt; [a]\nfirstHalf xs\n    | odd n = error \"list needs to have even length\"\n    | otherwise = take h xs\n    where n = length xs\n          h = n `div` 2\n\nsecondHalf :: [a] -&gt; [a]\nsecondHalf xs\n    | odd n = error \"list needs to have even length\"\n    | otherwise = drop h xs\n    where n = length xs\n          h = n `div` 2\n\ntopLeftCorner :: [[a]] -&gt; [a]\ntopLeftCorner = concatMap firstHalf . firstHalf\n\ntopRightCorner :: [[a]] -&gt; [a]\ntopRightCorner = concatMap secondHalf . firstHalf\n\nbottomLeftCorner :: [[a]] -&gt; [a]\nbottomLeftCorner = concat . reverse . map firstHalf . secondHalf\n\nbottomRightCorner :: [[a]] -&gt; [a]\nbottomRightCorner = concat . reverse . map secondHalf . secondHalf\n\nallCorners :: [[a]] -&gt; [[a]]\nallCorners board = [bottomRightCorner, topRightCorner, bottomLeftCorner, topLeftCorner] &lt;*&gt; [board]\n</code></pre>\n\n<p>examples of using it, first for your input and then a 6x6 example:</p>\n\n<pre><code>*Main&gt;let board = [[1,1,1,1], [0,0,0,0], [1 ,1, 0,0] , [0, 0, 1,1]]                                              \n*Main&gt; allCorners board\n[[1,1,0,0],[1,1,0,0],[0,0,1,1],[1,1,0,0]]\n*Main&gt; let board = [[1,1,1,1,1,1], [0,0,0,0,0,0], [1 ,1, 0,0,1,1] , [0, 0, 1,1,0,0], [1,1,1,1,1,1], [0,0,0,0,0,0]]\n*Main&gt;allCorners board                                                                                           \n[[0,0,0,1,1,1,1,0,0],[1,1,1,0,0,0,0,1,1],[0,0,0,1,1,1,0,0,1],[1,1,1,0,0,0,1,1,0]]\n</code></pre>\n\n<p>As often in functional programming (and indeed in programming in general), the best way to approach a more complex problem is to break it down into smaller ones.</p>\n"}], "owner": {"reputation": 41, "user_id": 11979580, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBD6Sbct7-uBduiZObtwAlFzRmExJHma2owThSVug=k-s128", "display_name": "VALENTINA YUSTY MOSQUERA", "link": "https://stackoverflow.com/users/11979580/valentina-yusty-mosquera"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "closed_date": 1566886246, "answer_count": 1, "score": -8, "last_activity_date": 1566905455, "creation_date": 1566836776, "last_edit_date": 1566905455, "question_id": 57661635, "link": "https://stackoverflow.com/questions/57661635/how-to-iterate-over-a-list-of-lists", "closed_reason": "Not suitable for this site", "title": "How to iterate over a list of lists", "body": "<p>I have a list of lists, for example, </p>\n\n<pre><code>[[1, 1, 1, 1], \n [0, 0, 0, 0], \n [1, 1, 0, 0], \n [0, 0, 1, 1]] \n</code></pre>\n\n<p>with an even length. Like a square of pixels where black is 1 and white is 0, like a chessboard.</p>\n\n<p>And  I want a function that will return 4 lists: </p>\n\n<ul>\n<li>The first list is 2x2 lower right corner would be  a list with <code>[1,1,0,0]</code></li>\n<li>The second list is 2x2 upper right corner would be a list with <code>[1,1,0,0]</code></li>\n<li>The third list is 2x2 lower left corner would be a list with  <code>[0,0,1,1]</code></li>\n<li>The forth list is 2x2 upper left corner would be a list with  <code>[1,1,0,0]</code></li>\n</ul>\n\n<p>I don't quite yet know how to do this. I expect to receive the 4 lists described above.</p>\n"}, {"tags": ["haskell", "yaml"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566815574, "post_id": 57655853, "comment_id": 101762083, "body": "Is the <code>yaml</code> embedded here, or a file you plan to read in each time you use the application. In case of the latter, you will need some <code>IO</code> here to parse the file. In case of the former, you can use <i>quasiquoters</i> or template haskell to parse it."}, {"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566815932, "post_id": 57655853, "comment_id": 101762241, "body": "It&#39;s a file I plan to read in each time"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566816343, "post_id": 57655853, "comment_id": 101762432, "body": "@timothyylim Will <code>request</code> always have <code>a</code>, <code>b</code>, <code>c</code> with string values every time you read the file? Or can <code>request</code> change arbitrarily?"}, {"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 0, "creation_date": 1566816954, "post_id": 57655853, "comment_id": 101762695, "body": "a,b,c can be arbitrarily changed"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566819373, "post_id": 57655853, "comment_id": 101763849, "body": "In that case @timothyylim would <code>data Config = Config { a :: Value, b :: Value, c :: Value }</code> be suitable? (where <code>Value</code> comes from the <code>yaml</code> library)"}, {"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 0, "creation_date": 1566819564, "post_id": 57655853, "comment_id": 101763945, "body": "My apologies, what I meant was that \u201ca\u201d may be an arbitrary string and so may it\u2019s value"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566819652, "post_id": 57655853, "comment_id": 101763988, "body": "So then is there any reason why <code>data Config = Config { a :: String, b :: String, c :: String }</code> wouldn\u2019t work?"}, {"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 0, "creation_date": 1566819809, "post_id": 57655853, "comment_id": 101764060, "body": "Because the yaml may be: d: \u201cxxx\u201d e: \u201cwww\u201d etc"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566820022, "post_id": 57655853, "comment_id": 101764167, "body": "So more like <code>newtype Config = Config { Map Char String }</code> then? (Using <a href=\"http://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Map.html\" rel=\"nofollow noreferrer\"><code>Map</code></a> from the <a href=\"http://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>containers</code></a> library if you haven\u2019t encountered it before. A simpler alternative would be <code>[(Char,String)]</code>, but <code>containers</code> has more functionality.)"}, {"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "edited": false, "score": 0, "creation_date": 1566820079, "post_id": 57655853, "comment_id": 101764195, "body": "Perfect. Thank you."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566821257, "post_id": 57655853, "comment_id": 101764738, "body": "You\u2019re welcome @timothyylim! Should I add that as an answer?"}, {"owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566821359, "post_id": 57655853, "comment_id": 101764797, "body": "yes please, @bradrn!"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566823121, "post_id": 57655853, "comment_id": 101765628, "body": "One more comment: in his answer, @fredefox has used the <code>URI</code> type instead of plain <code>String</code>. That might be a good idea if you are specifically storing URLs, as opposed to my answer which is a bit less specific."}], "answers": [{"tags": [], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "is_accepted": false, "score": 3, "last_activity_date": 1566820500, "creation_date": 1566820500, "answer_id": 57657469, "question_id": 57655853, "link": "https://stackoverflow.com/questions/57655853/parse-nested-yaml-with-haskell/57657469#57657469", "title": "Parse nested yaml with Haskell", "body": "<p>Maybe something like:</p>\n\n<pre><code>data Config where\n  request :: Request -&gt; Config\n\nnewtype Request = Request (HashMap Text URI)\n</code></pre>\n\n<p><code>HashMap</code> has the following instance: <code>FromJSON v =&gt; FromJSON (HashMap Text v)</code> So you can easily define <code>FromJSON</code> for this type using <code>-XGeneralizedNewtypeDeriving</code> and similarly for <code>ToJSON</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 1, "last_activity_date": 1566822283, "creation_date": 1566822283, "answer_id": 57657883, "question_id": 57655853, "link": "https://stackoverflow.com/questions/57655853/parse-nested-yaml-with-haskell/57657883#57657883", "title": "Parse nested yaml with Haskell", "body": "<p>From the comments it seems that one <code>request</code> in your configuration can contain any number of key-value pairs, where the keys and values are both strings. Accordingly, a good choice for your configuration would be a <a href=\"http://hackage.haskell.org/package/containers-0.6.2.1/docs/Data-Map-Strict.html\" rel=\"nofollow noreferrer\"><code>Map</code></a> or <a href=\"http://hackage.haskell.org/package/unordered-containers-0.2.10.0/docs/Data-HashMap-Strict.html\" rel=\"nofollow noreferrer\"><code>HashMap</code></a>. <code>Map</code> is generally more popular (although I could be wrong), but the <code>yaml</code> library <a href=\"http://hackage.haskell.org/package/yaml-0.11.1.1/docs/Data-Yaml.html#t:Object\" rel=\"nofollow noreferrer\">uses <code>HashMap</code> to represent objects</a>, and based on <a href=\"https://www.fpcomplete.com/blog/2016/05/weigh-package#containers-vs-unordered-containers\" rel=\"nofollow noreferrer\">this</a> <code>HashMap</code> appears to be more memory-efficient. If you want, you can additionally wrap your map in an additional data type for extra type safety, so something like <code>newtype Config = Config { getConfig :: Map String String }</code>.</p>\n\n<p>(Or you could just use a list of key-value pairs <code>[(String, String)]</code>, but <code>yaml</code> depends on both <code>containers</code> and <code>unordered-containers</code> anyway so you might as well use their functionality!)</p>\n"}], "owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 57657883, "answer_count": 2, "score": 1, "last_activity_date": 1566822283, "creation_date": 1566814234, "question_id": 57655853, "link": "https://stackoverflow.com/questions/57655853/parse-nested-yaml-with-haskell", "title": "Parse nested yaml with Haskell", "body": "<p>How would one define a type for the following yaml configuration:</p>\n\n<pre><code>request: \n  a: \"https://google/1\"\n  b: \"https://google/2\" \n  c: \"https://google/3\"\n</code></pre>\n\n<p>Would it be like this?</p>\n\n<pre><code>data Config = Config { request :: id' } deriving (Show, Generic)\n</code></pre>\n\n<p>and then define <code>id'</code> later?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 419, "user_id": 9681577, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-4SxwpK4A_5M/AAAAAAAAAAI/AAAAAAAAAlc/azXjayboIJ0/photo.jpg?sz=128", "display_name": "olyk", "link": "https://stackoverflow.com/users/9681577/olyk"}, "is_accepted": true, "score": 4, "last_activity_date": 1566787891, "last_edit_date": 1566787891, "creation_date": 1566786325, "answer_id": 57651130, "question_id": 57650939, "link": "https://stackoverflow.com/questions/57650939/how-can-i-access-python3-6-from-haskell/57651130#57651130", "title": "How can I access python3.6+ from Haskell?", "body": "<p>It is possible to download a more recent version at this <a href=\"https://github.com/ekalosak/haskell-cpython/commit/829da05dc5117b2f1d15fdcbd9796b1a65f53c3d\" rel=\"nofollow noreferrer\">fork</a> changing <em>package.yaml</em></p>\n\n<pre><code>dependencies:\n- cpython\n</code></pre>\n\n<p>and also <em>stack.yaml</em></p>\n\n<pre><code>extra-deps:\n- github: ekalosak/haskell-cpython\n  commit: 829da05dc5117b2f1d15fdcbd9796b1a65f53c3d\n</code></pre>\n"}], "owner": {"reputation": 419, "user_id": 9681577, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-4SxwpK4A_5M/AAAAAAAAAAI/AAAAAAAAAlc/azXjayboIJ0/photo.jpg?sz=128", "display_name": "olyk", "link": "https://stackoverflow.com/users/9681577/olyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "accepted_answer_id": 57651130, "answer_count": 1, "score": 1, "last_activity_date": 1566787891, "creation_date": 1566783291, "question_id": 57650939, "link": "https://stackoverflow.com/questions/57650939/how-can-i-access-python3-6-from-haskell", "title": "How can I access python3.6+ from Haskell?", "body": "<p><a href=\"https://john-millikin.com/software/haskell-cpython\" rel=\"nofollow noreferrer\">haskell-cpython</a> works up to python3.4, but it is a too old version of python. The library also seems not to be maintained anymore. </p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 0, "creation_date": 1566775839, "post_id": 57650397, "comment_id": 101751327, "body": "Yep, you are right. I just defined <code>lift</code> the way you suggested."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 9, "last_activity_date": 1566775493, "creation_date": 1566775493, "answer_id": 57650397, "question_id": 57650284, "link": "https://stackoverflow.com/questions/57650284/cant-make-a-derived-instance-of-monadtrans-for-newtype/57650397#57650397", "title": "Can&#39;t make a derived instance of MonadTrans for newtype", "body": "<p>The problem is that, if this derivation worked, your instance of <code>MonadTrans</code> would be transforming the functor <code>f</code>, while the instance for <code>ExceptT</code>, which you're expecting to be used as base of derivation, is transforming monad <code>ReaderT TrxDbFileBasedEnv f</code>. </p>\n\n<p>These are not representationally equivalent, so <code>GeneralizedNewtypeDeriving</code> can't help you here.</p>\n\n<p>Here's another way to think about it: try implementing the class manually. If you try that, you'll see that your <code>lift</code> will have to be defined like this:</p>\n\n<pre><code>lift = TrxDbFileBased . lift . lift\n</code></pre>\n\n<p>that is, first lifting <code>f</code> into <code>ReaderT</code>, then lifting <code>ReaderT</code> into <code>ExceptT</code>, and then wrapping all of that in <code>TrxDbFileBased</code>. But GND expects to do nothing more than the no-op wrapping, which means just straight up reusing the method dictionary, since the types are representationally equivalent. This is not the case in your case.</p>\n"}], "owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 57650397, "answer_count": 1, "score": 3, "last_activity_date": 1566777284, "creation_date": 1566773843, "last_edit_date": 1566777284, "question_id": 57650284, "link": "https://stackoverflow.com/questions/57650284/cant-make-a-derived-instance-of-monadtrans-for-newtype", "title": "Can&#39;t make a derived instance of MonadTrans for newtype", "body": "<p>I have the following newtype declaration. It is wrapping a Monad stack transformer stacking some standard mtl monads like Reader and Except.</p>\n\n<pre><code>newtype TrxDbFileBased f a = TrxDbFileBased {\n        unTrxDbFileBased :: ExceptT TrxDbError (ReaderT TrxDbFileBasedEnv f) a\n    } deriving (\n        Functor\n    ,   Applicative\n    ,   Monad\n    ,   MonadError TrxDbError\n    ,   MonadReader TrxDbFileBasedEnv\n    ,   MonadIO\n    ,   MonadTrans\n    )\n\ndata TrxDbFileBasedEnv = TrxDbFileBasedEnv {\n        workingDirectory :: FilePath    \n    } deriving (Show)\n\ndata TrxDbError = TrxDbErrorIO TrxDbFileBasedEnv IOException\n                | TrxDbErrorStr TrxDbFileBasedEnv String \n                deriving (Show)\n</code></pre>\n\n<p>I want this newtype to be an instance of <code>MonadTrans</code> but I am getting the following error.</p>\n\n<pre><code>    \u2022 Can't make a derived instance of \u2018MonadTrans TrxDbFileBased\u2019\n        (even with cunning GeneralizedNewtypeDeriving):\n        cannot eta-reduce the representation type enough\n    \u2022 In the newtype declaration for \u2018TrxDbFileBased\u2019\n   |        \n31 |     ,   MonadTrans\n   |         ^^^^^^^^^^\n</code></pre>\n\n<p>I don't understand why <code>MonadTrans</code> cannot be derived given that the underlying type is <code>ExceptT</code> which is an instance of <code>MonadTrans</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566752501, "post_id": 57647992, "comment_id": 101746728, "body": "what do you mean with a <code>min</code>/<code>max</code> argument?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1566752745, "post_id": 57647992, "comment_id": 101746773, "body": "The minimum and maximum values of a <code>Double</code> would be <code>-Infinity</code> and <code>Infinity</code>, but these are not really actual (numerical) values, I think that is the reationale. It would mean that <code>[minBound .. maxBound]</code> would yield <code>[-Infinity, -Infinity, ...]</code> which is probably not the expected result."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566770912, "post_id": 57648149, "comment_id": 101750652, "body": "I think you meant <code>&gt;=</code> and <code>10.0**10000</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1566771145, "post_id": 57648149, "comment_id": 101750684, "body": "<code>&gt;</code> was intentional; I&#39;m assuming the bounds should be unique (though I&#39;m flexible on that point)."}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 2, "creation_date": 1566799819, "post_id": 57648149, "comment_id": 101755255, "body": "The Haskell 98 report explicitly says Bounded types need not be totally ordered (Double won&#39;t be, since there&#39;s a NaN value). RealFloat allows finding the highest and lowest numbers available, but the infinities aren&#39;t numbers, so what the bounds should be might be arguable."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 9, "last_activity_date": 1566770943, "last_edit_date": 1566770943, "creation_date": 1566753501, "answer_id": 57648149, "question_id": 57647992, "link": "https://stackoverflow.com/questions/57647992/instance-of-bounded-for-double-in-haskell/57648149#57648149", "title": "Instance of Bounded for Double in Haskell", "body": "<p>Assuming that <code>maxBound &gt; x</code> should hold true for any other <code>x :: Bounded a =&gt; a</code>, what should the value of <code>maxBound :: Double</code> be?</p>\n\n<pre><code>&gt; let nan = 0/0; infinity = 10.0**10000; in (nan &gt; infinity, infinity &gt; nan)\n(False,False)\n</code></pre>\n\n<p>The <em>numbers</em> represented by <code>Double</code> are bounded, but the values in the type <code>Double</code> are not.</p>\n"}], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 57648149, "answer_count": 1, "score": 6, "last_activity_date": 1566770943, "creation_date": 1566752229, "last_edit_date": 1566753492, "question_id": 57647992, "link": "https://stackoverflow.com/questions/57647992/instance-of-bounded-for-double-in-haskell", "title": "Instance of Bounded for Double in Haskell", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/Prelude.html#t:Bounded\" rel=\"noreferrer\">Prelude</a> does not provide a Bounded Double instance. Is this because Double does not have a min/max argument in Haskell (that Bounded requires) or is the reason different?</p>\n"}, {"tags": ["haskell", "scope", "let", "shadowing", "letrec"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1566745875, "creation_date": 1566745875, "answer_id": 57647233, "question_id": 57647194, "link": "https://stackoverflow.com/questions/57647194/how-is-it-possible-that-a-binding-shadows-the-existing-binding-in-case-of-bloc/57647233#57647233", "title": "How is it possible that a binding shadows the existing binding in `case of` block?", "body": "<blockquote>\n  <p>How is possible to have this warning from the case block if uname and uemail still not defined?</p>\n</blockquote>\n\n<p>These are defined, in the scope outside the <code>case</code>, two variables named <code>uname</code> and <code>uemail</code> are defined. The Haskell compiler can \"<em>tie a knot</em>\". Take for example the following expression where we define an endless list of ones:</p>\n\n<pre><code>ones :: [Int]\nones = x\n    where x = 1 : x</code></pre>\n\n<p>Here we thus define a list that looks like:</p>\n\n<pre><code>+-------+\n|  (:)  |&lt;,\n+---+---+ |\n| o | o---'\n+-|-+---+\n  v\n  1\n</code></pre>\n\n<p>So you can define a variable in terms of itself, like you do here. You do not <em>assign</em> a value to variable, you <em>declare</em> a variable. Furthermore note that the order in which you define variables is <em>not</em> per se the order in which you will perform operations. So it is possible that the <code>(uname, uemail)</code> is never evaluated, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1566749008, "creation_date": 1566749008, "answer_id": 57647595, "question_id": 57647194, "link": "https://stackoverflow.com/questions/57647194/how-is-it-possible-that-a-binding-shadows-the-existing-binding-in-case-of-bloc/57647595#57647595", "title": "How is it possible that a binding shadows the existing binding in `case of` block?", "body": "<p>Ignoring the reasons, you are reimplenting <code>Data.Either.fromRight</code>.</p>\n\n<pre><code>import Data.Either (fromRight)\n\n...\n\n    let defaultResponse = GoogleUserResponse \"\" \"\"\n        toTuple (GoogleUserResponse x y) = (x,y)  -- parameter names aren't important\n        gResponse = fromRight defaultResponse $ getUserResponseJSON creds\n        (uname, email) = toTuple gResponse\n\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 7, "last_activity_date": 1566750346, "creation_date": 1566750346, "answer_id": 57647765, "question_id": 57647194, "link": "https://stackoverflow.com/questions/57647194/how-is-it-possible-that-a-binding-shadows-the-existing-binding-in-case-of-bloc/57647765#57647765", "title": "How is it possible that a binding shadows the existing binding in `case of` block?", "body": "<p>Haskell's <code>let</code> is actually <code>letrec</code>. </p>\n\n<p>In <code>let x = x in ...</code>, the <code>x</code> on the right  refers to the <code>x</code> on the left. </p>\n\n<p>The scope of <code>x</code>, <code>y</code> and <code>z</code> in </p>\n\n<pre><code>    let \n       x = ...\n       y = ...\n       z = ...\n    in ...\n</code></pre>\n\n<p>are all the code areas indicated with <code>...</code>.</p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 57647233, "answer_count": 3, "score": 5, "last_activity_date": 1568674638, "creation_date": 1566745596, "last_edit_date": 1568674638, "question_id": 57647194, "link": "https://stackoverflow.com/questions/57647194/how-is-it-possible-that-a-binding-shadows-the-existing-binding-in-case-of-bloc", "title": "How is it possible that a binding shadows the existing binding in `case of` block?", "body": "<p>I have to extract user name and email from <code>Either</code> of <code>AuthResponse</code>.</p>\n\n<p>I use <code>case of</code> construct for it:</p>\n\n<pre><code>  let (uname, uemail) =\n        case getUserResponseJSON creds of\n          Right (GoogleUserResponse uname uemail) -&gt; (uname, uemail)\n          _ -&gt; (\"\", \"\")    \n</code></pre>\n\n<p>But I have this warning for both <code>uname</code> and <code>uemail</code>:</p>\n\n<pre><code>    This binding for \u2018uname\u2019 shadows the existing binding\n      bound at src/Foundation.hs:240:12\n    |\n242 |               Right (GoogleUserResponse uname uemail) -&gt; (uname, uemail)\n    |  \n</code></pre>\n\n<p>I expect that <code>let (uname, uemail)</code> is out of the scope of <code>case of</code> block.</p>\n\n<p>How is it possible to have this warning from the <code>case</code> block if <code>uname</code> and <code>uemail</code> are not yet defined?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1566741373, "post_id": 57646638, "comment_id": 101744210, "body": "What are the imports?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 5, "creation_date": 1566754808, "post_id": 57646638, "comment_id": 101747231, "body": "&quot;Ignore most of the imports. They don&#39;t relate to the question.&quot; Uh, yes they do. <code>&lt;&#47;&#47;&gt;</code> only exists because of the imports."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1566836020, "post_id": 57646638, "comment_id": 101771943, "body": "in ghci do <code>:l Main.hs</code>, then <code>:info (&lt;&#47;&#47;&gt;)</code>"}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1566906770, "post_id": 57646638, "comment_id": 101795174, "body": "Or use <a href=\"https://hoogle.haskell.org/?hoogle=%3C%2F%2F%3E&amp;scope=set%3Astackage\" rel=\"nofollow noreferrer\">hoogle</a>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1566742474, "creation_date": 1566742474, "answer_id": 57646805, "question_id": 57646638, "link": "https://stackoverflow.com/questions/57646638/what-does-mean-in-haskell/57646805#57646805", "title": "What does &lt;//&gt; mean in Haskell?", "body": "<p>This is the <a href=\"http://hackage.haskell.org/package/Spock-0.13.0.0/docs/Web-Spock.html#v:-60--47--47--62-\" rel=\"nofollow noreferrer\"><strong><code>(&lt;//&gt;) :: Path as Open -&gt; Path bs ps -&gt; Path (Append as bs) ps</code></strong> function</a>. As the documentation says:</p>\n\n<blockquote>\n  <p>Combine two path components</p>\n</blockquote>\n\n<p>In the <a href=\"https://github.com/agrafix/Spock/blob/master/Spock-api/src/Web/Spock/Api.hs#L22\" rel=\"nofollow noreferrer\">source code [GitHub]</a>, we see that it is implemented as:</p>\n\n<blockquote><pre><code>(&lt;//&gt;) :: Path as 'Open -&gt; Path bs ps -&gt; Path (Append as bs) ps\n(&lt;//&gt;) = (&lt;/&gt;)</code></pre></blockquote>\n\n<p>This <code>(&lt;/&gt;)</code> function originates from the <a href=\"http://hackage.haskell.org/package/reroute-0.5.0.0/docs/Web-Routing-Combinators.html#v:-60--47--62-\" rel=\"nofollow noreferrer\"><strong><code>(&lt;/&gt;) ::  Path as Open -&gt; Path bs ps -&gt; Path (Append as bs) ps</code></strong></a> in the <a href=\"http://hackage.haskell.org/package/reroute\" rel=\"nofollow noreferrer\"><strong><code>reroute</code></strong></a> package. It is <a href=\"https://github.com/agrafix/Spock/blob/master/reroute/src/Web/Routing/Combinators.hs#L55\" rel=\"nofollow noreferrer\">implemented as [GitHub]</a>:</p>\n\n<blockquote><pre><code>(&lt;/&gt;) :: Path as 'Open -&gt; Path bs ps2 -&gt; Path (Append as bs) ps2\n(&lt;/&gt;) Empty xs = xs\n(&lt;/&gt;) (StaticCons pathPiece xs) ys = StaticCons pathPiece (xs &lt;/&gt; ys)\n(&lt;/&gt;) (VarCons xs) ys = VarCons (xs &lt;/&gt; ys)</code></pre></blockquote>\n\n<p>It thus basically appends some path pieces together. You can here see this as some sort of linked list. A string literal (like <code>\"oauth2\"</code>) can, with the <code>OverloadedStrings</code> be converted into a <code>Path</code> since it is an <a href=\"https://github.com/agrafix/Spock/blob/master/reroute/src/Web/Routing/Combinators.hs#L44\" rel=\"nofollow noreferrer\">instance of the <code>IsString</code> class [GitHub]</a>:</p>\n\n<blockquote><pre><code>instance (a ~ '[], pathState ~ 'Open) =&gt; IsString (Path a pathState) where\n    fromString = static</code></pre></blockquote>\n\n<p>It will generate a <code>StaticCons</code> with each time a piece of the path (well since <code>\"oauth2\"</code> does not contain any slashes, it will just have one block):</p>\n\n<blockquote><pre><code>static :: String -&gt; Path '[] 'Open\nstatic s =\n  let pieces = filter (not . T.null) $ T.splitOn &quot;/&quot; $ T.pack s\n  in foldr StaticCons Empty pieces</code></pre></blockquote>\n"}], "owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 57646805, "answer_count": 1, "score": 0, "last_activity_date": 1566810856, "creation_date": 1566741180, "last_edit_date": 1566810856, "question_id": 57646638, "link": "https://stackoverflow.com/questions/57646638/what-does-mean-in-haskell", "title": "What does &lt;//&gt; mean in Haskell?", "body": "<p>From the following code from a simple server using Spock:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Web.Spock\nimport Web.Spock.Config\n\nimport Data.Time.Clock\nimport Control.Concurrent\nimport Network.HTTP.Types.Status\nimport Network.HTTP.Types.URI\nimport Control.Monad.Trans\nimport Control.Concurrent.STM \nimport qualified Data.Text as T   \n\napp :: MyApp ()\n    app =\n        do get root $ redirect' \"https://google.no\"\n           -- Store params\n           get (\"oauth2\" &lt;//&gt; var) $ \\path' -&gt;\n             do ... \n</code></pre>\n\n<p>The majority of the imports don't relate to the question. </p>\n"}, {"tags": ["haskell", "authentication", "google-oauth", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1566855781, "post_id": 57658743, "comment_id": 101779256, "body": "Thanks for your help, that is not what I am looking for because I am using Google auth via Yesod.Auth.OAuth2.Google, but it helps understand what should I check for."}], "tags": [], "owner": {"reputation": 1163, "user_id": 1582607, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c5ed8ab69f97e22877cc1cc7db0cb06c?s=128&d=identicon&r=PG", "display_name": "Dario Oddenino", "link": "https://stackoverflow.com/users/1582607/dario-oddenino"}, "is_accepted": false, "score": 2, "last_activity_date": 1566825588, "creation_date": 1566825588, "answer_id": 57658743, "question_id": 57646599, "link": "https://stackoverflow.com/questions/57646599/how-can-i-customize-yesod-login-page/57658743#57658743", "title": "How can I customize Yesod Login page?", "body": "<p>You can override the classes methods listed here <a href=\"https://www.stackage.org/package/yesod-auth\" rel=\"nofollow noreferrer\">https://www.stackage.org/package/yesod-auth</a></p>\n\n<p>For example if you want to change the default email login page, you can do in Foundation.hs</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance YesodAuthEmail App where\n  ...\n  emailLoginHandler = myEmailLoginHandler\n</code></pre>\n\n<p>and then look here to see how to implement it <a href=\"https://www.stackage.org/haddock/nightly-2019-08-26/yesod-auth-1.6.7/src/Yesod.Auth.Email.html#defaultEmailLoginHandler\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/nightly-2019-08-26/yesod-auth-1.6.7/src/Yesod.Auth.Email.html#defaultEmailLoginHandler</a></p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566825588, "creation_date": 1566740941, "question_id": 57646599, "link": "https://stackoverflow.com/questions/57646599/how-can-i-customize-yesod-login-page", "title": "How can I customize Yesod Login page?", "body": "<p>I implemented Google authentication in my Yesod application.</p>\n\n<p>When I open <a href=\"http://localhost:3000/auth/login\" rel=\"nofollow noreferrer\">http://localhost:3000/auth/login</a> I see a page generated by Yesod.</p>\n\n<p>I tried to add login.hamlet to templates folder but it didn't override default login page.</p>\n\n<p>Which is the right way to customize login page in Yesod?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566719426, "post_id": 57644066, "comment_id": 101739475, "body": "Can you please show the full error?"}, {"owner": {"reputation": 125, "user_id": 1270776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb6ca1df7bc96e5c5662ccb6a698938?s=128&d=identicon&r=PG", "display_name": "Tuukka Turto", "link": "https://stackoverflow.com/users/1270776/tuukka-turto"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566720380, "post_id": 57644066, "comment_id": 101739674, "body": "I added full error message and HSpec tests that I have written. Two first ones are working fine, while the third one refuses to compile."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1566721291, "post_id": 57644066, "comment_id": 101739873, "body": "<code>itemFreqL</code> works on an <code>Item</code>, not on an <code>[Item]</code>, that is why it can never match."}, {"owner": {"reputation": 125, "user_id": 1270776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb6ca1df7bc96e5c5662ccb6a698938?s=128&d=identicon&r=PG", "display_name": "Tuukka Turto", "link": "https://stackoverflow.com/users/1270776/tuukka-turto"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566724095, "post_id": 57644066, "comment_id": 101740492, "body": "That solves the problem, thanks. Writing <code>config ^? (configContinuationsL . at &quot;AA&quot; . _Just . ix 0 . itemFreqL) `shouldBe` Just 1</code> does what I&#39;m after."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1566739341, "post_id": 57644066, "comment_id": 101743707, "body": "Havent typechecked it but <code>ix &quot;AA&quot; . _head . itemFreqL</code>?"}, {"owner": {"reputation": 125, "user_id": 1270776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb6ca1df7bc96e5c5662ccb6a698938?s=128&d=identicon&r=PG", "display_name": "Tuukka Turto", "link": "https://stackoverflow.com/users/1270776/tuukka-turto"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1566788741, "post_id": 57644066, "comment_id": 101752948, "body": "True that @moonGoose, that simplifies the code."}], "owner": {"reputation": 125, "user_id": 1270776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb6ca1df7bc96e5c5662ccb6a698938?s=128&d=identicon&r=PG", "display_name": "Tuukka Turto", "link": "https://stackoverflow.com/users/1270776/tuukka-turto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566720012, "creation_date": 1566717851, "last_edit_date": 1566720012, "question_id": 57644066, "link": "https://stackoverflow.com/questions/57644066/how-to-fix-couldnt-match-type-item-a0-with-item-char-when-reading-usi", "title": "How to fix &quot;Couldn&#39;t match type \u2018Item a0\u2019 with \u2018[Item [Char]]\u2019&quot; when reading using lens", "body": "<p>I'm writing markov chain generator with Haskell, using weighted list for randomly selecting elements. When I'm testing the configuration, I get an error \"Couldn't match type \u2018Item a0\u2019 with \u2018[Item [Char]]\u2019\". I suspect this is somehow related to the fact that <code>Item</code> is parametrized and type checked doesn't realize that elements in <code>configContinuations</code> have correct type (hence <code>a0</code> vs. <code>[Char]</code>.</p>\n\n<p>I have function with signature <code>addElement :: forall a. Ord a =&gt; Maybe a -&gt; a -&gt; Config a -&gt; Config a</code> that had similar problem, before I added <code>forall a</code> quantifier.</p>\n\n<p>However, if I'm checking value as: <code>config ^? (configContinuationsL . at \"AA\" . _Just . itemFreqL) `shouldBe` Just 1</code>, I don't know how to do similar thing.</p>\n\n<p>Below are definitions for <code>Config</code>, <code>Item</code>, <code>Frequency</code> and lenses used to operate with them.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Frequency a = Frequency Int a\n    deriving (Show, Read, Eq)\n\ndata Config a = Config\n    { configStarts :: ![Item a]\n    , configContinuations :: !(M.Map a [Item a])\n    } deriving (Show, Read, Eq)\n\ndata Item a =\n    Item (Frequency (Maybe a))\n    deriving (Show, Read, Eq)\n\nmakeLensesFor [ (\"configStarts\", \"configStartsL\")\n              , (\"configContinuations\", \"configContinuationsL\")] ''Config\n\nitemFreqL :: Lens' (Item a) Int\nitemFreqL = lens (\\(Item (Frequency n _)) -&gt; n)\n                 (\\(Item (Frequency _ a)) n -&gt; (Item (Frequency n a)))\n</code></pre>\n\n<p>What should I change, so I could force types to match?</p>\n\n<p>Edit: Full error message</p>\n\n<pre><code>\u2022 Couldn't match type \u2018Item a0\u2019 with \u2018[Item [Char]]\u2019\n      Expected type: (Int\n                      -&gt; Data.Functor.Const.Const (Data.Monoid.First Int) Int)\n                     -&gt; [Item [Char]]\n                     -&gt; Data.Functor.Const.Const (Data.Monoid.First Int) [Item [Char]]\n        Actual type: (Int\n                      -&gt; Data.Functor.Const.Const (Data.Monoid.First Int) Int)\n                     -&gt; Item a0\n                     -&gt; Data.Functor.Const.Const (Data.Monoid.First Int) (Item a0)\n\u2022 In the second argument of \u2018(.)\u2019, namely \u2018itemFreqL\u2019\n  In the second argument of \u2018(.)\u2019, namely \u2018_Just . itemFreqL\u2019\n  In the second argument of \u2018(.)\u2019, namely\n    \u2018at \"AA\" . _Just . itemFreqL\u2019\n\n    config ^? (configContinuationsL . at \"AA\" . _Just . itemFreqL) `shouldBe` Just 1\n</code></pre>\n\n<p>and spec of how I'm testing:</p>\n\n<pre><code>spec :: Spec\nspec = do\n    describe \"Markov chain configuration\" $ do\n        it \"Adding new starting element to empty configuration creates item with frequency of 1\" $ do\n            let config = addElement Nothing \"AA\" emptyConfig\n            config ^? (configStartsL . ix 0 . itemFreqL) `shouldBe` Just 1\n            config ^? (configStartsL . ix 0 . itemItemL . _Just) `shouldBe` Just \"AA\"\n\n        it \"Adding same element twice to empty configuration creates item with frequency of 2\" $ do\n            let config = addElement Nothing \"AA\" $\n                         addElement Nothing \"AA\" emptyConfig\n            config ^? (configStartsL . ix 0 . itemFreqL) `shouldBe` Just 2\n            config ^? (configStartsL . ix 0 . itemItemL . _Just) `shouldBe` Just \"AA\"\n\n        it \"Adding new continuation creates item with frequency of 1\" $ do\n            let config = addElement (Just \"AA\") \"BB\" $\n                         addElement Nothing \"AA\" emptyConfig\n            config ^? (configContinuationsL . at \"AA\" . _Just . itemFreqL) `shouldBe` Just 1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1566726141, "post_id": 57643389, "comment_id": 101740935, "body": "Anybody tell me why this question is vote againsted?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1566739573, "post_id": 57643389, "comment_id": 101743763, "body": "Prior to your first edit, I would have downvoted as well; a downvote indicates a lack of research effort. I think now the question is better, though perhaps no longer on topic, as you are asking for improvements on working code, not a solution to non-working code."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1566787490, "post_id": 57643389, "comment_id": 101752794, "body": "@chepner I searched a lot to find something like <code>showFFloat</code>, I just haven&#39;t point this out since it is not related to the problem itself. That doesn&#39;t means I&#39;m &quot;lack of research effort&quot;,  I think people always can get a working code if pay &quot;enough effort&quot;,   But that doesn&#39;t means it is the correct way to do things, I can&#39;t agree that talking about a &quot;correct way&quot; instead of &quot;make it work&quot; is out of topic..."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1566787675, "post_id": 57643389, "comment_id": 101752816, "body": "@chepner And also, I can remove my own ugly solution to make this question looks like not out of topic, and add some description about my effort, so that&#39;s what SO want?"}], "answers": [{"tags": [], "owner": {"reputation": 1341, "user_id": 1036044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PzcQL.jpg?s=128&g=1", "display_name": "Probie", "link": "https://stackoverflow.com/users/1036044/probie"}, "is_accepted": false, "score": 4, "last_activity_date": 1566720280, "creation_date": 1566720280, "answer_id": 57644298, "question_id": 57643389, "link": "https://stackoverflow.com/questions/57643389/how-to-show-a-float-double-just-like-javascript-literal-in-haskell/57644298#57644298", "title": "How to show a Float/Double just like JavaScript literal in Haskell?", "body": "<p>If all you want to do is drop <code>.0</code> why not just write a function to do that?</p>\n\n<pre><code>dropPointZero :: String -&gt; String\ndropPointZero num = if mantissa == \".0\" then intPart else num\n  where (intPart, mantissa) = break (== '.') num\n</code></pre>\n\n<p>And then combine that with <code>show</code> to get what you want.</p>\n\n<pre><code>showNum :: (Num a, Show a) =&gt; a -&gt; String\nshowNum = dropPointZero . show\n</code></pre>\n\n<p>This won't work properly if you also wanted to print large values. If you need that, I guess you could just try coercing it to an <code>Integer</code> first, and printing the <code>Integer</code> if it was one.</p>\n\n<pre><code>showFloat :: (Show a, RealFrac a) =&gt; a -&gt; String\nshowFloat x = if fromInteger n == x then show n else show x\n  where n = round x\n</code></pre>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1566727509, "creation_date": 1566709612, "last_edit_date": 1566727509, "question_id": 57643389, "link": "https://stackoverflow.com/questions/57643389/how-to-show-a-float-double-just-like-javascript-literal-in-haskell", "title": "How to show a Float/Double just like JavaScript literal in Haskell?", "body": "<p>Giving <code>1.0</code>, Haskell <code>show</code> will get <code>\"1.0\"</code> instead of <code>\"1\"</code>, and use things like <code>showFFloat</code> instead of <code>show</code> doesn't change that.</p>\n\n<p>This is reasonable since <code>\"1.0\"</code> is more clear to be a Float/Double literal in Haskell, but sometimes I just want a tool function help to show floating point numbers in JavaScript style (which is more natural for human reading).</p>\n\n<p>I mean, round to show the number to specific presision, but without the trailing zeros:</p>\n\n<pre><code>showF 1.0 == \"1\"\nshowF 1.2 == \"1.2\"\nshowF 1.23 == \"1.23\"\nshowF 1.00000000001 == \"1\"\n</code></pre>\n\n<hr>\n\n<p>Now I'm writting this:</p>\n\n<pre><code>import Numeric\nshowF x = let s = showFloat x \"\" in if \".0\" `isSuffixOf` s then take (length s - 2) s else s\n</code></pre>\n\n<p>But it is not very natural, I think there must be a better way.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1566668774, "post_id": 57640189, "comment_id": 101732237, "body": "I think you should not do this at all in the first place. Instead, when you &quot;copy&quot; the path from your file into your source, just escape the backslashes by adding an extra backslash in front of them. For example, instead of putting <code>fileName = &quot;aDir\\file.txt&quot;</code> in your Haskell file, put <code>fileName = &quot;aDir\\\\file.txt&quot;</code>."}, {"owner": {"reputation": 81, "user_id": 11867102, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qWtDnzqlbxo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc89Bfo8PaVxbWJM5Ew6i9JhEiRXA/photo.jpg?sz=128", "display_name": "CimimUxMaio", "link": "https://stackoverflow.com/users/11867102/cimimuxmaio"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566669358, "post_id": 57640189, "comment_id": 101732355, "body": "The thing is that what Im realy trying to avoid is exactly that. So that when I do a more complicated program that takes a path it could do it automaticaly."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1566669485, "post_id": 57640189, "comment_id": 101732384, "body": "When you write a more complicated program, you will have the program read directly from the file, and it will not be subject to this escaping restriction. In other words, if you had a configuration file with the text <code>aDir\\file.txt</code> in it, and used <code>readFile</code> to read that file into a <code>String</code>, the <code>String</code> it would produce would <i>already</i> be the same as the <code>String</code> produced by the literal <code>&quot;aDir\\\\file.txt&quot;</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1566673474, "post_id": 57640189, "comment_id": 101733348, "body": "You don&#39;t have define <code>normalizePath</code>; use <code>System.FilePath.normalise</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 11867102, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qWtDnzqlbxo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc89Bfo8PaVxbWJM5Ew6i9JhEiRXA/photo.jpg?sz=128", "display_name": "CimimUxMaio", "link": "https://stackoverflow.com/users/11867102/cimimuxmaio"}, "edited": false, "score": 0, "creation_date": 1566669076, "post_id": 57640210, "comment_id": 101732302, "body": "Oh, you&#180;re right. But still when I do: normalizePath &quot;C:\\Users\\admin\\Desktop\\file.txt&quot; it throws:  lexical error in string/character literal at character &#39;U&#39;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 81, "user_id": 11867102, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qWtDnzqlbxo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc89Bfo8PaVxbWJM5Ew6i9JhEiRXA/photo.jpg?sz=128", "display_name": "CimimUxMaio", "link": "https://stackoverflow.com/users/11867102/cimimuxmaio"}, "edited": false, "score": 2, "creation_date": 1566669148, "post_id": 57640210, "comment_id": 101732312, "body": "@CimimUxMaio: the reason is that <code>&quot;C:\\Users\\admin\\Desktop\\file.txt&quot;</code> is <i>not</i> a valid string <i>literal</i>, the <code>\\U</code> is incorrect. If you want to use a backslash in your string, you need to escape it, like <code>&quot;C:\\\\Users\\\\admin\\\\Desktop\\\\file.txt&quot;</code>"}, {"owner": {"reputation": 81, "user_id": 11867102, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qWtDnzqlbxo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc89Bfo8PaVxbWJM5Ew6i9JhEiRXA/photo.jpg?sz=128", "display_name": "CimimUxMaio", "link": "https://stackoverflow.com/users/11867102/cimimuxmaio"}, "edited": false, "score": 0, "creation_date": 1566669422, "post_id": 57640210, "comment_id": 101732368, "body": "So there isn&#180;t any way of programming it so that I get automaticaly &quot;C:\\\\Users\\\\admin\\\\Desktop\\\\file.txt&quot; ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 81, "user_id": 11867102, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qWtDnzqlbxo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc89Bfo8PaVxbWJM5Ew6i9JhEiRXA/photo.jpg?sz=128", "display_name": "CimimUxMaio", "link": "https://stackoverflow.com/users/11867102/cimimuxmaio"}, "edited": false, "score": 0, "creation_date": 1566669638, "post_id": 57640210, "comment_id": 101732416, "body": "@CimimUxMaio: you can enter &quot;<i>raw</i>&quot; strings through template haskell yes, but that will behind the curtains just escape the backslash, see edit."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1566669624, "last_edit_date": 1566669624, "creation_date": 1566668216, "answer_id": 57640210, "question_id": 57640189, "link": "https://stackoverflow.com/questions/57640189/changing-to-on-path-string/57640210#57640210", "title": "Changing &#39;\\\\&#39; to &#39;/&#39; on path string", "body": "<p>I think you make it more complicated than it is. You can just use a <code>map</code> here:</p>\n\n<pre><code>normalizePath :: String -&gt; String\nnormalizePath = map f\n    where f '\\\\' = '/'\n          f x = x</code></pre>\n\n<p>We here thus convert all <code>'\\\\'</code> characters to <code>'/'</code> characters.</p>\n\n<p>Note that the string <code>\"aDir\\file.txt\"</code> does <em>not</em> contain a backslash, since it is parsed with a <code>'\\f'</code>, which is a form feed character. If the string contains a backslash, as a string literal it is formatted as <code>\"aDir\\\\file.txt\"</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; normalizePath \"aDir\\\\file.txt\"\n\"aDir/file.txt\"\n</code></pre>\n\n<p>You can enter <em>raw</em> strings through the <a href=\"http://hackage.haskell.org/package/raw-strings-qq-1.1/\" rel=\"nofollow noreferrer\"><strong><code>raw-strings-qq</code></strong> package [Hackage]</a>. For example:</p>\n\n<pre><code>$ ghci -XQuasiQuotes \nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :{\nPrelude| normalizePath :: String -&gt; String\nPrelude| normalizePath = map f\nPrelude|     where f '\\\\' = '/'\nPrelude|           f x = x\nPrelude| :}\nPrelude&gt; import Text.RawString.QQ\nPrelude Text.RawString.QQ&gt; normalizePath [r|C:\\Users\\admin\\Desktop\\file.txt|]\n\"C:/Users/admin/Desktop/file.txt\"\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 11867102, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qWtDnzqlbxo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc89Bfo8PaVxbWJM5Ew6i9JhEiRXA/photo.jpg?sz=128", "display_name": "CimimUxMaio", "link": "https://stackoverflow.com/users/11867102/cimimuxmaio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "accepted_answer_id": 57640210, "answer_count": 1, "score": 1, "last_activity_date": 1566669624, "creation_date": 1566668059, "last_edit_date": 1566669208, "question_id": 57640189, "link": "https://stackoverflow.com/questions/57640189/changing-to-on-path-string", "title": "Changing &#39;\\\\&#39; to &#39;/&#39; on path string", "body": "<p>Im trying to read and write files from a given path. The problem is that when I copy the path from a file (Im on Windows) it uses '\\' as a path separator but haskell doesn\u00b4t seem to understand it because for example: \"aDir\\file.txt\" mistakenly reads '\\f' which is an invalid character.</p>\n\n<p>That\u00b4s why I tryed to create a function which \"normalizes\" (transforms) this paths into one with '/' as path separator (which works fine), but it doesn\u00b4t work, I asume, because of the same reason.\nIs it there any built in function that already does this for me?</p>\n\n<pre><code>main :: String -&gt; (String -&gt; String) -&gt; IO ()\nmain path transformation = do\n    let normalizedPath = normalizePath path\n    contenido &lt;- readFile normalizedPath\n    let resultado = transformation contenido\n    writeFile normalizedPath resultado\n\nnormalizePath :: String -&gt; String\nnormalizePath = map f \n    where\n        f '\\\\' = '/'\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "cabal-new"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566652426, "post_id": 57638242, "comment_id": 101728627, "body": "There is a command literally called <a href=\"https://cabal.readthedocs.io/en/latest/nix-local-build.html#cabal-v2-freeze\" rel=\"nofollow noreferrer\"><code>v2-freeze</code></a>, which creates a file with exactly the name and behavior you propose..."}, {"owner": {"reputation": 12250, "user_id": 2425163, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/05f4000597865eeaf51c32ed5694479c?s=128&d=identicon&r=PG", "display_name": "tarleb", "link": "https://stackoverflow.com/users/2425163/tarleb"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566652975, "post_id": 57638242, "comment_id": 101728747, "body": "@DanielWagner That&#39;s exactly my problem: I don&#39;t see how I could use that here."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566654755, "post_id": 57638242, "comment_id": 101729199, "body": "Ah, I understand the issue now: you want a freeze file, but without creating a project."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1566658112, "post_id": 57638242, "comment_id": 101729984, "body": "You forgot about cabal revisions, even if you pin the exact version at any point in the future cabal file can change and your pinned version might no longer work"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1566658355, "post_id": 57638242, "comment_id": 101730047, "body": "My suggestion is use <code>stack</code>, this is the only way to truly pin all of the dependencies (including transitive ones) that are guaranteed to work now and any point in the future. Even if you use dependencies from outside hackage you can pin them by content addressable hash value, which will guarantee that the dependency does not change from under you."}, {"owner": {"reputation": 12530, "user_id": 381619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8f67f35200cf319e30329dddd412b6d?s=128&d=identicon&r=PG", "display_name": "Neil Mayhew", "link": "https://stackoverflow.com/users/381619/neil-mayhew"}, "edited": false, "score": 2, "creation_date": 1566665441, "post_id": 57638242, "comment_id": 101731506, "body": "Docker images are never 100% reproducible, if you use the regular <code>Dockerfile</code> way of building them. However, <code>nix</code> can build images directly and those are 100% reproducible. They&#39;re also more compact. If you pin the version of <code>nixpkgs</code> to a particular git commit, you have a 100% reproducible build forever."}], "answers": [{"comments": [{"owner": {"reputation": 12250, "user_id": 2425163, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/05f4000597865eeaf51c32ed5694479c?s=128&d=identicon&r=PG", "display_name": "tarleb", "link": "https://stackoverflow.com/users/2425163/tarleb"}, "edited": false, "score": 0, "creation_date": 1566719960, "post_id": 57638784, "comment_id": 101739569, "body": "It&#39;s really hacky, but makes perfect sense. Thanks for this! :D"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1566656793, "last_edit_date": 1566656793, "creation_date": 1566656369, "answer_id": 57638784, "question_id": 57638242, "link": "https://stackoverflow.com/questions/57638242/freezing-all-dependencies-when-building-executables-with-cabal-v2-install/57638784#57638784", "title": "Freezing all dependencies when building executables with `cabal v2-install`", "body": "<p>Okay, there might be a better built-in way to do this kind of thing, but here's a hacky workaround that might be suitable for you until a real cabal expert comes along.</p>\n\n<p>The basic plan will be this: temporarily create a project with the three packages you care about -- just long enough to get a freeze file -- then use some simple text-editor macros to turn the freeze file into a <code>v2-install</code> command. So:</p>\n\n<pre><code>% cabal unpack pandoc-2.7.3 pandoc-citeproc-0.16.2 pandoc-crossref-0.3.4.1\n% echo &gt;cabal.project packages: pandoc-2.7.3 pandoc-citeproc-0.16.2 pandoc-crossref-0.3.4.1\n% cabal v2-freeze\n% sed \"s/^constraints: /cabal v2-install pandoc-2.7.3 pandoc-citeproc-0.16.2 pandoc-crossref-0.3.4.1 --constraint '/;s/^ \\+/--constraint '/;s/,\\$/' \\\\\\\\/;\\$s/\\$/'/\" cabal.project.freeze &gt;cabal-v2-install.sh\n</code></pre>\n\n<p>Woof, that last one is a mouthful. It says:</p>\n\n<pre><code># Replace the starting \"constraints\" stanza with the v2-install command we want to\n# run. The first line of the stanza includes a constraint, so prefix it with\n# --constraint and start a quote.\ns/^constraints: /cabal v2-install pandoc-2.7.3 pandoc-citeproc-0.16.2 pandoc-crossref-0.3.4.1 --constraint '/\n# The line we just produced doesn't start with spaces, so this only fires on the\n# remaining lines. On those lines, it prefixes --constraint and starts a quote.\ns/^ \\+/--constraint '/\n# Close the quote begun on each line, and replace cabal's line-continuation\n# character (,) with a shell's line-continuation character (\\). The $ and \\ are\n# escaped because we are inside the current shell's \"\"-quoted string.\ns/,\\$/' \\\\\\\\/\n# The last line doesn't have a line-continuation character, but still needs its\n# quote closed. The two occurrences of $ are escaped because we are inside the\n# current shell's \"\"-quoted string.\n\\$s/\\$/'/\n</code></pre>\n\n<p>You could also do these manually in an editor if you wanted. At the end of this process, which you can run in a temporary directory to ease cleanup afterwards, you should have a file named <code>cabal-v2-install.sh</code> with a command that will select the exact same versions and flags for all packages involved, including dependencies.</p>\n"}], "owner": {"reputation": 12250, "user_id": 2425163, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/05f4000597865eeaf51c32ed5694479c?s=128&d=identicon&r=PG", "display_name": "tarleb", "link": "https://stackoverflow.com/users/2425163/tarleb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 57638784, "answer_count": 1, "score": 0, "last_activity_date": 1566656793, "creation_date": 1566652059, "last_edit_date": 1566652924, "question_id": 57638242, "link": "https://stackoverflow.com/questions/57638242/freezing-all-dependencies-when-building-executables-with-cabal-v2-install", "title": "Freezing all dependencies when building executables with `cabal v2-install`", "body": "<p>I am building a Docker image in which I want to bundle multiple executables. Each executable is defined in a different package, in my case <code>pandoc</code>, <code>pandoc-citeproc</code>, and <code>pandoc-crossref</code>. The build should be as reproducible as reasonably possible on a Debian/Ubuntu based system.</p>\n\n<p>What I'd like to do is use (something like) a <em>cabal.project.freeze</em> file to ensure that all subsequent builds will use the same packages.</p>\n\n<p>I'm aware that I can fix the version of the executables:</p>\n\n<pre><code>cabal v2-install pandoc-2.7.3 pandoc-citeproc-0.16.2 pandoc-crossref-0.3.4.1\n</code></pre>\n\n<p>But this will not fix the versions of transitive dependencies, so rebuilding at different times may lead to subtly different build results. Can I somehow create and use a <em>freeze</em> file in this setup?  Using v2-freeze seems to be of no use here:</p>\n\n<pre><code>$ cabal new-freeze pandoc-2.7.3 pandoc-citeproc-0.16.2 pandoc-crossref-0.3.4.1\ncabal: 'freeze' doesn't take any extra arguments: pandoc-2.7.3\npandoc-citeproc-0.16.2 pandoc-crossref-0.3.4.1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1566639841, "post_id": 57636442, "comment_id": 101726183, "body": "What do you mean exactly by a \u2018data dependency\u2019? Do you just mean the libraries which <code>ghc-vis</code> depends on?"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566642532, "post_id": 57636442, "comment_id": 101726672, "body": "As I understand it, a data dependency in haskell is where one has to compute something to decide what branch to take in a case expression. They can be the cause of unexpected <code>_|_</code> when you make a mistake in your thinking and by a series of dependencies you must compute an expression in order to decide how to compute the expression itself."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566642615, "post_id": 57636442, "comment_id": 101726685, "body": "<code>seq</code> also adds a data dependency: &quot;seq doesn&#39;t evaluate anything just by virtue of existing in the source file, all it does is introduce an artificial data dependency of one value on another&quot; [<a href=\"https://wiki.haskell.org/Seq]\" rel=\"nofollow noreferrer\">wiki.haskell.org/Seq]</a>"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1566646277, "post_id": 57636442, "comment_id": 101727372, "body": "Thanks @codeshot \u2014 I was thinking entirely along the wrong lines! I thought that since <code>ghc-vis</code> no longer compiles, you were asking how to fix problems with its dependencies so it does compile. I understand now that you are rather asking how to find data dependencies since the tool you used (<code>ghc-vis</code>) now no longer works. That makes a lot more sense now!"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566663399, "post_id": 57636442, "comment_id": 101731105, "body": "I&#39;ve edited the wording to improve the clarity. Although a whole-story answer to the question you thought I was asking is also valuable :D"}], "answers": [{"comments": [{"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1566672309, "post_id": 57639664, "comment_id": 101733115, "body": "thanks, unfortunately nearly everything around Haskell is broken once per year and actually I can&#39;t fix it all myself, especially I can&#39;t forcibly take over all the relevant servers. Meanwhile, since hardly anyone can be using ghc-vis to find data dependencies the real question still needs an answer."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 3, "creation_date": 1566678436, "post_id": 57639664, "comment_id": 101734277, "body": "Why can&#39;t you fix it? And what do servers have to do with this?"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1566728107, "post_id": 57639664, "comment_id": 101741393, "body": "I can&#39;t fix it all because there&#39;s so much stuff and it gets broken at a rate faster than I could learn it all. Servers are relevant because packages come from the hackage servers, with compatible versions listed in stackage servers. To fix it all I have to change the data on those servers and limit the changes to those servers to prevent new breakage. It sounded like you knew about what it takes to have working open source software - didn&#39;t you know?"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": -1, "last_activity_date": 1566666562, "last_edit_date": 1566666562, "creation_date": 1566663910, "answer_id": 57639664, "question_id": 57636442, "link": "https://stackoverflow.com/questions/57636442/how-does-one-find-and-understand-excess-data-dependencies-in-a-haskell-program/57639664#57639664", "title": "How does one find and understand excess data dependencies in a Haskell program", "body": "<p>Try to fix ghc-vis (or actually, its dependencies).</p>\n\n<p>From the logs you reported on the ghc-vis issue tracker <a href=\"https://github.com/def-/ghc-vis/issues/24\" rel=\"nofollow noreferrer\">https://github.com/def-/ghc-vis/issues/24</a>, the errors all belong to these two categories, neither of which requires expertise specific to the broken packages, so you should be able to fix them yourself, that's the beauty of open source:</p>\n\n<ol>\n<li><p><code>Failed to load interface... There are files missing</code>: this might be related to your Haskell distribution. How did you install Haskell? For example Haskell packages on Arch are dynamically linked: <a href=\"https://wiki.archlinux.org/index.php/Haskell\" rel=\"nofollow noreferrer\">https://wiki.archlinux.org/index.php/Haskell</a></p></li>\n<li><p><code>Ambiguous occurence</code>: at least one package you depend on exports a name which clashes with the actually intended name. Look at the broken package and fix its version bounds or fix its imports.</p></li>\n</ol>\n\n<p>At this point, the problems you are encountering have little to do with ghc-vis, but with wl-pprint-text, polyparse, and cairo.</p>\n"}], "owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1566666562, "creation_date": 1566636722, "last_edit_date": 1566664537, "question_id": 57636442, "link": "https://stackoverflow.com/questions/57636442/how-does-one-find-and-understand-excess-data-dependencies-in-a-haskell-program", "title": "How does one find and understand excess data dependencies in a Haskell program", "body": "<p>How does one find and understand excess data dependencies in a Haskell program so that one is able to eliminate them?</p>\n\n<p>I once used <code>ghc-vis</code> to investigate data dependencies in a Haskell program but since Stack has moved on such that <code>ghc-vis</code> no longer installs in unison with most current development it's no longer an option and I wonder what do people use these days instead.</p>\n"}, {"tags": ["haskell", "aeson", "template-haskell"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1566665060, "creation_date": 1566665060, "answer_id": 57639821, "question_id": 57635686, "link": "https://stackoverflow.com/questions/57635686/template-haskell-on-aeson/57639821#57639821", "title": "Template Haskell on Aeson", "body": "<p>Try to use <a href=\"https://hackage.haskell.org/package/template-haskell-2.14.0.0/docs/Language-Haskell-TH.html#v:nameBase\" rel=\"nofollow noreferrer\"><code>nameBase</code></a> instead of <code>show</code> (which is meant for debugging and not core logic).</p>\n\n<p>To see what <code>show</code> is doing you can look at the <a href=\"https://hackage.haskell.org/package/template-haskell-2.14.0.0/docs/src/Language.Haskell.TH.Syntax.html#line-1226\" rel=\"nofollow noreferrer\">implementation of <code>show</code></a> which is defined as <code>showName</code> which is itself defined as <code>showName' Alone</code>, to see roughly that it constructs the fully qualified name of your type.</p>\n"}], "owner": {"reputation": 405, "user_id": 9348482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67dc5143c1ba85c2f417bf83ede6177f?s=128&d=identicon&r=PG&f=1", "display_name": "autumn322", "link": "https://stackoverflow.com/users/9348482/autumn322"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566665060, "creation_date": 1566628615, "question_id": 57635686, "link": "https://stackoverflow.com/questions/57635686/template-haskell-on-aeson", "title": "Template Haskell on Aeson", "body": "<p>I have a data type like this:</p>\n\n<pre><code>module My.Module\n\ndata A = A { aFoo :: Integer } deriving (Generic, Show)\n</code></pre>\n\n<p>And I have generic option for Aeson</p>\n\n<pre><code>import Data.Char ( toUpper, toLower )\n\ngenericOptions :: String -&gt; Options\ngenericOptions prefix = defaultOptions\n  { fieldLabelModifier = dropPrefix $ length prefix\n  , constructorTagModifier = addPrefix prefix\n  , omitNothingFields = True\n  }\n  where\n    dropPrefix l s = let remainder = drop l s\n                     in  (toLower . head) remainder : tail remainder\n    addPrefix p s  = p ++ toUpper (head s) : tail s\n</code></pre>\n\n<p>So I can use it like this</p>\n\n<pre><code>instance A.FromJSON A where \n  parseJSON = A.genericParseJSON $ genericOptions \"A\"\n\ninstance A.ToJSON A where \n  toJSON = A.genericToJSON $ genericOptions \"A\"\n</code></pre>\n\n<p>But I realize I could use some template haskell</p>\n\n<pre><code>import Data.Aeson.TH ( deriveJSON )\nimport Language.Haskell.TH.Syntax ( Dec, Name, Q )\n\ngenericDeriveJSON :: Name -&gt; Q [Dec]\ngenericDeriveJSON name =\n  deriveJSON (genericOptions (show name)) name \n\n$(genericDeriveJSON ''A)\n</code></pre>\n\n<p>It throws an error: </p>\n\n<pre><code>Exception when trying to run \ncompile-time code:\n      Prelude.tail: empty list\n    Code: A.genericDeriveJSON ''A\n</code></pre>\n\n<p>It seems <code>drop l s</code> on <code>dropPrefix</code> returned an empty string meaning the value of <code>show name</code> is not string \"A\". Since I don't think I could inspect the value, anybody knows what is the value? </p>\n"}, {"tags": ["haskell", "exception", "classy-prelude"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1566595734, "post_id": 57633136, "comment_id": 101719650, "body": "Have you tried crashing on the same thread? Does that work?"}], "answers": [{"comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 1, "creation_date": 1566596521, "post_id": 57633215, "comment_id": 101719860, "body": "FWIW, I was able to use the same <code>catchAny</code> - all I had to change was adding in the recursive call to <code>retryForever</code>, which I stupidly forgot, somehow thinking that <code>catchAll</code> was handling the recursion for me."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 1, "creation_date": 1566596950, "post_id": 57633215, "comment_id": 101719973, "body": "@bbarker: the difference seems to be that <code>catchAny</code> catches all <i>synchronous</i> errors, whereas <code>catchAll</code> catches all exceptions. Although they both probably will do the job :)"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 1, "creation_date": 1566599238, "post_id": 57633215, "comment_id": 101720447, "body": "At least, I guess <code>retryForever</code> should work if I remember to call it on the &quot;main loop&quot; of each thread."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1566646571, "post_id": 57633215, "comment_id": 101727432, "body": "@bbarker: yes, probably there will be no difference in that case. So I guess you can use both :)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1566596863, "last_edit_date": 1566596863, "creation_date": 1566595758, "answer_id": 57633215, "question_id": 57633136, "link": "https://stackoverflow.com/questions/57633136/how-to-write-a-retryforever-function-in-haskell-using-exception-handling/57633215#57633215", "title": "How to write a &quot;retryForever&quot; function in Haskell using exception handling?", "body": "<p>When the program failed, you should run the program <code>prog</code> again, but wrapped in <code>retryForever</code> such that if it fails again, you thus keep trying:</p>\n\n<pre><code>import Control.Monad.Catch(catchAll)\n\nretryForever :: IO a -&gt; IO a\nretryForever prog = catchAll prog retry\n  where retry ex = do\n      putStrLn $ pack $ show ex\n      threadDelay 4000\n      retryForever prog\n</code></pre>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 57633215, "answer_count": 1, "score": 3, "last_activity_date": 1566596863, "creation_date": 1566595172, "last_edit_date": 1566595478, "question_id": 57633136, "link": "https://stackoverflow.com/questions/57633136/how-to-write-a-retryforever-function-in-haskell-using-exception-handling", "title": "How to write a &quot;retryForever&quot; function in Haskell using exception handling?", "body": "<p>I'd like to create a function that can recover from as many errors as is reasonable, and try again. Of course, meaningful handling of errors is covered in other parts of the program - this is a last ditch effort to keep things running. So I wrote this:</p>\n\n<pre><code>retryForever prog = catchAny prog progRetry\n  where\n    progRetry :: SomeException -&gt; m a\n    progRetry ex = do\n      putStrLn $ pack $ show ex\n      threadDelay 4000\n      prog\n</code></pre>\n\n<p>Then I wrap my main IO action in <code>retryForever</code>:</p>\n\n<pre><code>main :: IO ()\nmain = retryForever $ do\n  logger &lt;- newLogger\n  -- ...\n</code></pre>\n\n<p>In another part of my program (likely a different green thread), I test this with:</p>\n\n<pre><code>error \"this is a TEST ERROR\"\n</code></pre>\n\n<p>Resulting in:</p>\n\n<pre><code>: this is a TEST ERROR\nCallStack (from HasCallStack):\n  error, called at XXXX\n</code></pre>\n\n<p>(and the program dies instead of continuing on)</p>\n\n<p>Note that I'm using classy-prelude, for the cases where that may matter, e.g. <code>catchAny</code> doesn't handle asynchronous exceptions in there, which may well be the issue here.</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 9348482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67dc5143c1ba85c2f417bf83ede6177f?s=128&d=identicon&r=PG&f=1", "display_name": "autumn322", "link": "https://stackoverflow.com/users/9348482/autumn322"}, "edited": false, "score": 0, "creation_date": 1566605525, "post_id": 57629348, "comment_id": 101721440, "body": "I was making an http api and sending back error response constructed from sum types encoded as json with <code>tag</code>. It was nice that I could see what was returned because of the <code>tag</code>. So to be consistent I decided to make  a non-sum types to be tagged too. But thinking about it maybe I&#39;m exposing too much of its internal by doing that."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 3, "last_activity_date": 1566579845, "last_edit_date": 1566579845, "creation_date": 1566574668, "answer_id": 57629348, "question_id": 57628831, "link": "https://stackoverflow.com/questions/57628831/single-tag-constructors-in-aeson/57629348#57629348", "title": "Single tag constructors in Aeson", "body": "<p>To answer the question directly, you can always implement the <code>Wrapper</code> instance with <code>tagSingleConstructors = False</code>, like this:</p>\n\n<pre><code>instance Generic a =&gt; A.ToJSON (Wrapper a) where \n  toJSON w = A.object [ \"wrapped\" A..= encA (unWrap w) ]\n    where\n      encA = A.genericToEncoding $ A.defaultOptions { A.tagSingleConstructors = False }\n</code></pre>\n\n<hr>\n\n<p>But I don't see why you'd want to do that.</p>\n\n<p>If you control the API, then you don't need the <code>tag</code> field: the expected type of the wrapped value is already statically known, so <code>tag</code> would not be helpful.</p>\n\n<p>And if you don't control the API, I would recommend representing it very explicitly, for example as a record that exactly matches the API shape. Otherwise you run a risk of accidentally breaking the API by making unrelated changes in remote parts of the codebase.</p>\n"}], "owner": {"reputation": 405, "user_id": 9348482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67dc5143c1ba85c2f417bf83ede6177f?s=128&d=identicon&r=PG&f=1", "display_name": "autumn322", "link": "https://stackoverflow.com/users/9348482/autumn322"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 57629348, "answer_count": 1, "score": 2, "last_activity_date": 1566579845, "creation_date": 1566572657, "question_id": 57628831, "link": "https://stackoverflow.com/questions/57628831/single-tag-constructors-in-aeson", "title": "Single tag constructors in Aeson", "body": "<p>I have a data type like this:</p>\n\n<pre><code>data A = A T.Text deriving (Generic, Show)\n\ninstance A.ToJSON A \n</code></pre>\n\n<p>If I use <code>A.encode</code> to it:</p>\n\n<pre><code>A.encode $ A \"foobar\" -- \"foobar\"\n</code></pre>\n\n<p>Then I use <code>singleTagConstructors</code> on it:</p>\n\n<pre><code>instance A.ToJSON A where\n  toEncoding a = A.genericToEncoding $ A.defaultOptions { A.tagSingleConstructors = True }\n\nA.encode $ A \"foobarquux\" -- \"{tag: A, contents: foobarquux}\"\n</code></pre>\n\n<p>At some point I made another data type:</p>\n\n<pre><code>newtype Wrapper a = Wrapper \n  { unWrap :: a\n  } deriving (Show)\n\ninstance A.ToJSON a =&gt; A.ToJSON (Wrapper a) where \n  toJSON w = A.object [ \"wrapped\" A..= unWrap w ]\n</code></pre>\n\n<p>Here's the part where I get confused:</p>\n\n<pre><code>A.encode $ Wrapper $ A \"foobar\" -- \"{wrapped: foobar}\"\n</code></pre>\n\n<p>How do I get the result to be like this?</p>\n\n<pre><code>\"{wrapped: {tag: A, contents: foobarquux}}\"\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "functional-programming", "function-composition"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1566569070, "post_id": 57627926, "comment_id": 101709340, "body": "The problem is that you create an infinite type here, since the list can be arbitrary long."}, {"owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566569196, "post_id": 57627926, "comment_id": 101709412, "body": "@WillemVanOnsem Is there a way to create this function with an arbitrarily long list?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566569217, "post_id": 57627926, "comment_id": 101709425, "body": "@ByceTheGrand: what would the type of that function be?"}, {"owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566569391, "post_id": 57627926, "comment_id": 101709522, "body": "@WillemVanOnsem Good point. Maybe a way to return a list of ($ x) functions and map them all to one function with a separate function?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1566569818, "post_id": 57627926, "comment_id": 101709738, "body": "<code>applyAll (x, y, z) = ($ z) . ($ y) . ($ x)</code> Look at the type of <code>applyAll</code>. (It&#39;s <code>(a1, a2, a3) -&gt; (a1 -&gt; a2 -&gt; a3 -&gt; c) -&gt; c</code>). What type do you want the arbitrary list version to have?"}, {"owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "edited": false, "score": 0, "creation_date": 1566570212, "post_id": 57627926, "comment_id": 101709939, "body": "For the original idea, I can&#39;t thing of one. For the one I mentioned in the comments I am thinking maybe like: [a] -&gt; [b -&gt; a] where each (b -&gt; a) is essentially a ($ x) function. Then fold those with a function?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1566574663, "post_id": 57627926, "comment_id": 101712170, "body": "Handling functions of &quot;unknown arity&quot; can not be easily done in Haskell, like &quot;variadic functions&quot;. There might be some type-tricks which can make this work, like it was done for <code>printf</code>, possibly exploiting (overlapping) typeclasses and/or type families. If the input is an HList it could also be done. There are quite advanced techniques, though."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1566585817, "post_id": 57627926, "comment_id": 101716662, "body": "Is there more context to this problem? This seems like it could be an XY problem to me."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1566588524, "post_id": 57627926, "comment_id": 101717513, "body": "You could make an <code>apply</code>-like function with template haskell (i.e. metaprogramming) or dependent types, but this is fairly complex especially if you&#39;re a beginner."}], "owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "closed_date": 1566574061, "answer_count": 0, "score": 1, "last_activity_date": 1566569009, "creation_date": 1566569009, "question_id": 57627926, "link": "https://stackoverflow.com/questions/57627926/how-to-create-a-function-that-takes-a-list-of-arguments-and-returns-a-function-t", "closed_reason": "Duplicate", "title": "How to create a function that takes a list of arguments and returns a function that applies arguments to another function", "body": "<p>This sounds like a weird question but bear with me.\nI want to create a function that takes a list of arguments, and returns a function that applies those arguments to another function. I can get this to work with a set length of arguments using tuples or pattern matching like so:</p>\n\n<pre><code>applyAll (x, y, z) = ($ z) . ($ y) . ($ x)\n\napplyAll [x, y, z] = ($ z) . ($ y) . ($ x)\n</code></pre>\n\n<p>Those both compile and function as expected.</p>\n\n<p>I noticed that those look very recursive and wanted to make a version that takes any length of arguments. These are my attempts at that:</p>\n\n<pre><code>applyAll []     = id\napplyAll (x:xs) = applyAll xs . ($ x)\n\napplyAll []     = id\napplyAll (x:xs) = ($ x) . applyAll xs\n</code></pre>\n\n<p>This does not work however. I get this error:</p>\n\n<pre><code>num.hs:121:5: error:\n    * Occurs check: cannot construct the infinite type: b1 ~ a2 -&gt; b1\n      Expected type: [a2] -&gt; b1 -&gt; c\n        Actual type: [a2] -&gt; (a2 -&gt; b1) -&gt; c\n</code></pre>\n\n<p>I don't quite understand this error, but seeing as the original function worked, and was not recursive I think it has something to do with the recursion.</p>\n\n<p>Maybe something to do with the order of operations with the function?\nThis is how I imagine the function looks when executed with three variables:</p>\n\n<pre><code>applyAll [x, y, z] = ($ x) . (($ y) . (($ z) . (id)))\n</code></pre>\n\n<p>Does anyone have any ideas to solve this problem?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "owner": {"reputation": 247, "user_id": 1499033, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pc2IU.jpg?s=128&g=1", "display_name": "Sergey Kolbasov", "link": "https://stackoverflow.com/users/1499033/sergey-kolbasov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1566564992, "creation_date": 1566564992, "question_id": 57626800, "link": "https://stackoverflow.com/questions/57626800/re-use-tests-between-packages-in-stack", "title": "Re-use tests between packages in Stack", "body": "<p>I'm curious if it's possible to expose test folder of one package, so another package in multi-package Stack setup could re-use test functions &amp; instances:</p>\n\n<p><code>second-package-test -&gt; dependsOn -&gt; first-package-test</code></p>\n\n<p><strong>The first package</strong> has the following lines in <code>package.yaml</code>:</p>\n\n<pre><code>tests:\n  first-package-test:\n    main:                Spec.hs\n    source-dirs:         test\n    ghc-options:\n      - -threaded\n      - -rtsopts\n      - -with-rtsopts=-N\n    dependencies:\n      - first-package\n      - hspec\n      - QuickCheck\n      - quickcheck-instances\n      - quickcheck-classes\n</code></pre>\n\n<p>And the <strong>second package</strong> that should rely on the first one has the following setup:</p>\n\n<p>stack.yaml contains:</p>\n\n<pre><code>extra-deps:\n  - ../first-package &lt;-- it seems that it imports only library, not the tests\n</code></pre>\n\n<p>package.yaml contains:</p>\n\n<pre><code>tests:\n  second-package-test:\n    main:                Spec.hs\n    source-dirs:         test\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - second-package\n    - hspec\n    - QuickCheck\n    - quickcheck-instances\n    - quickcheck-classes\n</code></pre>\n\n<p>The root aggregation of them looks simple. stack.yaml:</p>\n\n<pre><code>packages:\n - first-package\n - second-package\n</code></pre>\n\n<p>I think, in theory, it's possible to create a <em>third</em> package with tests only that are exposed as a library, but wonder if there is a bit more elegant way to achieve the same thing.</p>\n"}, {"tags": ["multithreading", "haskell", "ghc", "haskell-warp"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1566565726, "post_id": 57626158, "comment_id": 101707427, "body": "What happens if you connect to the server after it hangs?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1566565931, "post_id": 57626158, "comment_id": 101707555, "body": "<code>bracket (return ()) (const $ putMVar finishVar ()) (const runApp) &lt;=&gt; runApp `finally` (putMVar finishVar ())</code>"}, {"owner": {"reputation": 445, "user_id": 8919942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df193de377da686960f0109f46a80bf2?s=128&d=identicon&r=PG", "display_name": "MorJ", "link": "https://stackoverflow.com/users/8919942/morj"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1566581995, "post_id": 57626158, "comment_id": 101715354, "body": "@freestyle It&#39;s the throwing thread that hangs, the serving thread still serves web pages as if nothing was thrown. And thanks for noting about <code>finally</code>, that&#39;s a bad adaptation of code into question on my part."}], "answers": [{"tags": [], "owner": {"reputation": 445, "user_id": 8919942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df193de377da686960f0109f46a80bf2?s=128&d=identicon&r=PG", "display_name": "MorJ", "link": "https://stackoverflow.com/users/8919942/morj"}, "is_accepted": true, "score": 3, "last_activity_date": 1566803311, "creation_date": 1566803311, "answer_id": 57653232, "question_id": 57626158, "link": "https://stackoverflow.com/questions/57626158/throwto-warp-tls-thread-hangs-idefinetly/57653232#57653232", "title": "throwTo warp tls thread hangs idefinetly", "body": "<p>It turned out to be a Windows-only bug in the version I used which is <code>warp-tls == 3.2.4</code> that got fixed in a later version. I've looked at the fix and it's a function with the name <code>windowsThreadBlockHack</code>, so if anyone is stuck with a bit outdated warp, you can backport this fix for you too.</p>\n"}], "owner": {"reputation": 445, "user_id": 8919942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df193de377da686960f0109f46a80bf2?s=128&d=identicon&r=PG", "display_name": "MorJ", "link": "https://stackoverflow.com/users/8919942/morj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 57653232, "answer_count": 1, "score": 3, "last_activity_date": 1566803311, "creation_date": 1566562481, "question_id": 57626158, "link": "https://stackoverflow.com/questions/57626158/throwto-warp-tls-thread-hangs-idefinetly", "title": "throwTo warp tls thread hangs idefinetly", "body": "<p>I have a Yesod app with a warp server, and some of its functionality depends on async exceptions. Recently there arose a need to migrate it to https, which I did with the package <code>warp-tls</code>. However now I can't kill the warp thread by throwing <code>ThreadKilled</code> exceptions at it, the <code>throwTo</code> function just hangs and does nothing.</p>\n\n<p>Consider the following example. Here we monitor the state of warp thread with <code>MVar ()</code>, which is empty while the thread is running, and has a () value when the thread is killed.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import MyApplication (waiPage)\n-- waiPage :: Application\n\nrunWai :: MVar () -&gt; IO ()\nrunWai finishVar = bracket\n  (return ())\n  (const $ putMVar finishVar ())\n  (const runApp)\n  where\n    -- change this to normal or tls to check\n    runApp = runAppTls\n    runAppNormal = runSettings warpSettings waiPage\n    runAppTls = runTLS siteTlsSettings warpSettings waiPage\n    --\n    warpSettings = setPort 8080 defaultSettings\n    siteTlsSettings = tlsSettings \"cert.pem\" \"key.pem\"\n\n\n\nmain :: IO ()\nmain = do\n  finishVar &lt;- newEmptyMVar\n  thread_id &lt;- forkIO $ runWai finishVar\n  -- Try to kill warp thread. Fork because throw might hang\n  forkIO $ throwTo thread_id ThreadKilled\n  threadDelay (2 * 10^6) -- microseconds to seconds\n  isAlive &lt;- isEmptyMVar finishVar\n  if isAlive then putStrLn \"Couldn't kill warp thread\"\n             else putStrLn \"Succesfully killed warp thread\"\n  -- Wait for forked warp thread to finish\n  readMVar finishVar\n</code></pre>\n\n<p>When you have <code>runApp = runAppNormal</code>, you will get <code>Succesfully killed warp thread</code> message, and the application will exit.</p>\n\n<p>When you have <code>runApp = runAppTls</code>, you will get the <code>Couldn't kill warp thread</code> message, and the app will hang and keep serving.</p>\n\n<p>So how do I get rid of this exception-intercepting behavior? Or at Least is there a way to kill the warpTls thread in any other way?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566564317, "post_id": 57624349, "comment_id": 101706710, "body": "I don\u2019t know much about algorithm design, but here\u2019s what I\u2019m thinking: First, find the coordinates of all land items. Then, using a fold (or similar), maintain a list of regions; for each land element, add it to the appropriate region if it shares a border with some cell in that region. As I said above, I know very little about algorithms, so this is almost certainly not an optimal algorithm, but it\u2019s a start at least."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566564937, "post_id": 57624349, "comment_id": 101707020, "body": "Just tried implementing the above algorithm using GHCi and can confirm that it does indeed work. So if you can\u2019t think of anything else you can certainly use the algorithm above, although I suspect that for large data sets it may be worth trying to optimise it."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1566565017, "post_id": 57624349, "comment_id": 101707062, "body": "(BTW, in your expected output, shouldn\u2019t that be a list of lists? Currently it\u2019s a list of tuples which aren\u2019t even the same length; this would lead to a type error in normal Haskell code.)"}, {"owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1566570232, "post_id": 57624349, "comment_id": 101709947, "body": "@bradrn I think I see what you are saying, I&#39;ve been trying too hard to rearrange my data structure. But yes you&#39;re right <code>[[(Int,Int)]]</code> think I was trying to keep things in the <code>Map</code> world."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1566582178, "post_id": 57624349, "comment_id": 101715437, "body": "I&#39;d be interested to hear more about why you believe BFS or flood fill won&#39;t work. They should work just fine; though less efficiently than my proposed answer."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1566582093, "last_edit_date": 1566582093, "creation_date": 1566581367, "answer_id": 57630724, "question_id": 57624349, "link": "https://stackoverflow.com/questions/57624349/haskell-grouping-specific-nearest-neighbours-in-a-cartesian-grid/57630724#57630724", "title": "Haskell - Grouping specific nearest neighbours in a cartesian grid", "body": "<p>I recommend using a union-find data structure. Loop over all positions; if it is land, mark it equivalent to any positions immediately NE, N, NW, or W of it that are also land. (It will automatically get marked equivalent to any land that exists E, SW, S, or SE of it when you visit that other land. The critical property of the set D={NE, N, NW, W} is that if you mirror all the directions in D to get M, then M\u222aD contains every direction; any other set D with this property will do fine, too.) The equivalence classes returned by the data structure at the end of this process will be your connected land chunks.</p>\n\n<p>If n is the total number of positions, this process is O(n*log n); the log n component comes from the <code>Map</code> lookups needed to determine if a neighbor is land or water.</p>\n\n<p>You should consider making the <code>Map</code> sparse if you can -- storing only the key-value pairs corresponding to land and skipping the water keys -- to graduate to O(m*log m) where m is the total number of lands, rather than the total number of positions. If you cannot (because you must remember the difference between water and not-existing positions, say), you could consider switching to an array as your backing store to graduate to O(n*a n), where a is the inverse Ackermann function, and so the whole shebang would basically be as close to O(n) as it is possible to get without actually being O(n).</p>\n\n<p>Whether O(m*log m) or O(n*a n) is preferable when both are an option is a matter for empirical exploration on some data sets that you believe represent your typical use case.</p>\n"}, {"tags": [], "owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "is_accepted": true, "score": 1, "last_activity_date": 1567022250, "creation_date": 1567022250, "answer_id": 57699283, "question_id": 57624349, "link": "https://stackoverflow.com/questions/57624349/haskell-grouping-specific-nearest-neighbours-in-a-cartesian-grid/57699283#57699283", "title": "Haskell - Grouping specific nearest neighbours in a cartesian grid", "body": "<p>I ended up going with this solution by Chris Penner via FP slack channel, it uses Union Find Algorithm (I've added comments to code to help a little): </p>\n\n<pre><code>-- | Take Map of land coordinates and return list of grouped land items forming islands\n-- | Using Union find algorythm\nfindIslands ::  M.Map Coordinate Coordinate -&gt; IO [[Coordinate]]\nfindIslands land = do\n  -- create fresh point map\n  pointMap &lt;- traverse U.fresh land\n  -- traverse each point checking for neighbours\n  void . flip M.traverseWithKey pointMap $ \\(x, y) point -&gt;\n      for_ (catMaybes (flip M.lookup pointMap &lt;$&gt; [(x + 1, y), (x, y + 1),(x +1, y +1), (x - 1, y + 1)]))\n          $ \\neighbourPoint -&gt;\n              U.union point neighbourPoint\n  -- traverse ppintMap and representative and their descriptors\n  withUnionKey :: (M.Map Coordinate Coordinate) &lt;- for pointMap (U.repr &gt;=&gt; U.descriptor)\n  -- swap cordinates arround\n  let unionKeyToCoord :: [(Coordinate, Coordinate)] = (swap &lt;$&gt; M.toList withUnionKey)\n      -- combine coordinates to create islands\n      results :: M.Map Coordinate [Coordinate] = M.fromListWith (&lt;&gt;) (fmap (:[]) &lt;$&gt; unionKeyToCoord)\n  -- return just the elements from the Map\n  return (M.elems results)\n\nconvertTolandGrid :: [Coordinate] -&gt; M.Map Coordinate Coordinate\nconvertTolandGrid = M.fromList . fmap (id &amp;&amp;&amp; id)\n\n\n</code></pre>\n"}], "owner": {"reputation": 1598, "user_id": 1905334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/oy40i.png?s=128&g=1", "display_name": "cmdv", "link": "https://stackoverflow.com/users/1905334/cmdv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 57699283, "answer_count": 2, "score": 4, "last_activity_date": 1567022250, "creation_date": 1566555876, "last_edit_date": 1566611508, "question_id": 57624349, "link": "https://stackoverflow.com/questions/57624349/haskell-grouping-specific-nearest-neighbours-in-a-cartesian-grid", "title": "Haskell - Grouping specific nearest neighbours in a cartesian grid", "body": "<p>I'm after some direction in this puzzle where I need to group specific nearest neighbours together.</p>\n\n<p>my input data is:</p>\n\n<pre><code>myList :: Map (Int, Int) Int\nmyList =\n  fromList\n    [((-2,-2),0),((-2,-1),0),((-2,0),2),((-2,1),0),((-2,2),0)\n    ,((-1,-2),1),((-1,-1),3),((-1,0),0),((-1,1),0),((-1,2),1)\n    ,((0,-2),0),((0,-1),0),((0,0),0),((0,1),0),((0,2),0)\n    ,((1,-2),0),((1,-1),0),((1,0),0),((1,1),2),((1,2),1)\n    ,((2,-2),0),((2,-1),2),((2,0),0),((2,1),0),((2,2),0)]\n</code></pre>\n\n<p>Which is a data representation of this 5 x 5 grid (brown land, blue water):<a href=\"https://i.stack.imgur.com/20OKR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/20OKR.png\" alt=\"5 x 5 grid\"></a>\nI'm using <code>(Int,Int)</code> as <code>XY</code> coordinates, because the way the list had to be generated (thus its ordering) was in a spiral on a cartesian coordinate grid <code>(0,0)</code> being the origin. The remaining <code>Int</code> is size of population <code>0</code> being water, <code>1..9</code> being land.</p>\n\n<p>Because of the ordering of my <code>Map</code> I've been struggling with finding a way I can traverse my data and return <code>4</code> grouped land items that are grouped due to each others connected proximity (including diagonal), so I'm looking for a result like bellow:</p>\n\n<pre><code>[ [(-1 , 2)]\n, [(1, 2),(1,1)]\n, [(-2, -0),(-1,-1),(-1,-2)]\n, [(2, -1)]]\n</code></pre>\n\n<p>I've researched and tried various algorithm like BFS, Flood Fill but my input data never fit the structural requirements or my understanding of the subjects doesn't allow me to convert it to using coordinates.</p>\n\n<p>Is there a way I can run an algorithm directly on the data, or should I be looking at another direction?</p>\n\n<p><em>I'm sorry there is no code examples of what I have so far but I've not even been able to create anything remotely useful to use.</em></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 99, "user_id": 11901818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wCBuk.jpg?s=128&g=1", "display_name": "Hume", "link": "https://stackoverflow.com/users/11901818/hume"}, "edited": false, "score": 0, "creation_date": 1566546267, "post_id": 57621665, "comment_id": 101697689, "body": "@Hume thank you, though it&#39;s far from the <a href=\"https://stackoverflow.com/a/11227902/770830\">truly best one</a>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1566562257, "post_id": 57621665, "comment_id": 101705610, "body": "I don&#39;t understand why this is downvoted? This is a good solution that works properly."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566563048, "post_id": 57621665, "comment_id": 101706026, "body": "@WillemVanOnsem perhaps people prefer genericity of your solution, which I tend to agree with. There is a case for both, though."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566563767, "post_id": 57621665, "comment_id": 101706431, "body": "@bereal: well I think both demonstrate something different: your solution demonstrates what is how to do this. The <code>deriving Foldable</code> just automates it. But it is always a good idea to still understand what is going on, and for what cases the implementation will render inefficient, etc."}], "tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": true, "score": 4, "last_activity_date": 1566545467, "creation_date": 1566545467, "answer_id": 57621665, "question_id": 57621532, "link": "https://stackoverflow.com/questions/57621532/how-to-store-the-tree-data-in-the-list/57621665#57621665", "title": "How to store the tree data in the list?", "body": "<p>It's done recursively:</p>\n\n<pre><code>data Tree a = Node a (Tree a) (Tree a) | Empty\n    deriving Show\n\ntree :: Tree a -&gt; [a]\n\n-- Bottom of the tree, nothing to see here\ntree Empty = []\n\n-- Append left subtree, self and right subtree\ntree (Node x l r) = (tree l) ++ [x] ++ (tree r) \n\n-- prints [4, 2, 5, 1, 3]\nmain =\n    let t1 = Node 2 (Node 4 Empty Empty) (Node 5 Empty Empty)\n        t2 = (Node 3 Empty Empty)\n        t = Node 1 t1 t2\n    in print $ tree t \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1566577243, "post_id": 57621948, "comment_id": 101713402, "body": "@bereal: to be honest, I think it is better than both answers received a dv :P"}, {"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 1, "creation_date": 1566591424, "post_id": 57621948, "comment_id": 101718460, "body": "I didn&#39;t know there was a <code>DeriveFoldable</code>! It looks to be a relatively recent feature (GHC 7.12)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1566557168, "last_edit_date": 1566557168, "creation_date": 1566546775, "answer_id": 57621948, "question_id": 57621532, "link": "https://stackoverflow.com/questions/57621532/how-to-store-the-tree-data-in-the-list/57621948#57621948", "title": "How to store the tree data in the list?", "body": "<p>You can turn on the <code>DeriveFoldable</code> feature, and let Haskell do the work for you:</p>\n\n<pre><code>{-# LANGUAGE DeriveFoldable #-}\n\ndata Tree a = Node (Tree a) a (Tree a) | Empty deriving <b>Foldable</b></code></pre>\n\n<p>Since you want to use infix notation, we thus swap <code>a</code> and <code>Tree a</code> as parameter here.</p>\n\n<p>We can then use the <code>toList</code> function from <code>Data.Foldable</code>:</p>\n\n<pre><code>Prelude&gt; import Data.Foldable\nPrelude Data.Foldable&gt; toList (Node (Node Empty 1 Empty) 4 (Node (Node Empty 2 Empty) 5 Empty))\n[1,4,2,5]\n</code></pre>\n\n<p>You do not only can convert the tree to a list, but you can use the functions that work on a foldable <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Foldable\" rel=\"nofollow noreferrer\"><strong><code>Foldable</code></strong></a>, for example:</p>\n\n<pre><code>Prelude Data.Foldable&gt; sum (Node (Node Empty 4 Empty) 2 (Node Empty 5 Empty))\n11\nPrelude Data.Foldable&gt; product (Node (Node Empty 4 Empty) 2 (Node Empty 5 Empty))\n40\nPrelude Data.Foldable&gt; length (Node (Node Empty 4 Empty) 2 (Node Empty 5 Empty))\n3\nPrelude Data.Foldable&gt; minimum (Node (Node Empty 4 Empty) 2 (Node Empty 5 Empty))\n2\nPrelude Data.Foldable&gt; maximum (Node (Node Empty 4 Empty) 2 (Node Empty 5 Empty))\n5\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 11901818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wCBuk.jpg?s=128&g=1", "display_name": "Hume", "link": "https://stackoverflow.com/users/11901818/hume"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 57621665, "answer_count": 2, "score": 1, "last_activity_date": 1566592008, "creation_date": 1566544834, "last_edit_date": 1566592008, "question_id": 57621532, "link": "https://stackoverflow.com/questions/57621532/how-to-store-the-tree-data-in-the-list", "title": "How to store the tree data in the list?", "body": "<p>I have an certain binary tree like below.</p>\n\n<pre><code>     (1)\n    /   \\\n  (2)   (3)\n /  \\\n(4) (5)\n</code></pre>\n\n<p>And want to produce new list to store this tree data using recursive function in left-right order.</p>\n\n<p>I created the binary tree first and trying to store the data in a list.\nBut have no idea how to store them in a list</p>\n\n<pre><code>data Tree a = Node a (Tree a) (Tree a) | Empty\ntree :: Tree a -&gt; [a]\ntree Empty = 0\ntree (Node x l r) = ?????????\n</code></pre>\n\n<p>So, expected output is <code>[4, 2, 5, 1, 3]</code>.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1566509688, "post_id": 57617292, "comment_id": 101689493, "body": "The <code>parseRoute</code> here takes approximately the size of the URL. Although a URL has no max size, it is strongly adviced to keep URLs shorter than 2048 characters. Together with the method (GET, POST, PATCH, etc.) that will be less than 2100 characters, so I think performance/memory is not very significant here. Note that although in general using Text is indeed better than using strings, due to <i>list fusion</i> some string processing algorithms could sometimes be comparable with text processing."}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566510152, "post_id": 57617292, "comment_id": 101689625, "body": "Thanks! I&#39;ve got your point. It&#39;s a bit strange that I have to unpack my Texts."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 3, "creation_date": 1566511812, "post_id": 57617292, "comment_id": 101690006, "body": "I think it\u2019s also worth noting that String is in general much easier to use than Text, so in a badly designed library, or in one where string processing is not important, String may be preferred over Text."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1566518431, "creation_date": 1566518431, "answer_id": 57618321, "question_id": 57617292, "link": "https://stackoverflow.com/questions/57617292/reason-to-use-string-instead-of-text-in-haskell/57618321#57618321", "title": "Reason to use String instead of Text in Haskell", "body": "<p>I suspect the most likely answer is, sadly, that <code>String</code> is still the path of least resistance: the ability to reuse all the familiar list functions (and the very good support for lists in parsing libraries) is so convenient that a largish collection of libraries continue to use <code>String</code> despite possible technical advantages of choosing a different type.</p>\n\n<p>Until the cost of the \"worse\" (but more convenient) choice is carefully quantified and a fix written by somebody who cares, you can expect that to pretty much stay unchanged in any given library.</p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 57618321, "answer_count": 1, "score": 4, "last_activity_date": 1566518431, "creation_date": 1566509423, "question_id": 57617292, "link": "https://stackoverflow.com/questions/57617292/reason-to-use-string-instead-of-text-in-haskell", "title": "Reason to use String instead of Text in Haskell", "body": "<p>I hear that good practice in Haskell to use Text instead of String.</p>\n\n<p>I am trying to follow this rule, and coming up with the following question:</p>\n\n<p>Why <code>parseRoute</code> of Network-HTTP-Client is designed to work with String and not Text?</p>\n\n<p>What is the general recommendation to use String instead of Text?</p>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-14.2/http-client-0.6.4/Network-HTTP-Client.html#v:parseRequest\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-14.2/http-client-0.6.4/Network-HTTP-Client.html#v:parseRequest</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1566509420, "post_id": 57617248, "comment_id": 101689420, "body": "Well your basic parser constructs could have some sort of name, and you can use <code>&gt;&gt;=</code> to construct a tree of parsing constructs. You can then of course serialize that tree and save it to the disk. But then you will need some sort of parser to parse it back to that tree."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1566511769, "post_id": 57617248, "comment_id": 101689999, "body": "I don&#39;t think this can be done with full generality. Consider the <code>Functor</code> instance of <code>Parser</code>. We can construct a parser from another by mapping the result with an arbitrarily complex function. How can we expect to serialize that? My impression is that, if you want something serializable, you will have to renounce the <code>Functor</code> / <code>Applicative</code> / <code>Monad</code> instances and have more controlled alternatives that work in a &quot;closed world&quot; of pre-defined types."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1566541782, "post_id": 57617248, "comment_id": 101695855, "body": "Looks like great use for Free monad. You build an AST using it, serialize it, save to disk, load back, and then &quot;run&quot; by interpreting it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1566543185, "post_id": 57617248, "comment_id": 101696373, "body": "What if you just let your users write just, you know, actual Haskell? In the simplest case, they can literally just name some parsers, as in <code>twoSpaces = space &gt;&gt; space</code>. Import their module and you&#39;re on your way. See also <a href=\"http://hackage.haskell.org/package/dyre\" rel=\"nofollow noreferrer\">dyre</a>."}, {"owner": {"reputation": 11, "user_id": 11152257, "user_type": "registered", "profile_image": "https://graph.facebook.com/2530705653610571/picture?type=large", "display_name": "Santi Weight", "link": "https://stackoverflow.com/users/11152257/santi-weight"}, "edited": false, "score": 0, "creation_date": 1566628490, "post_id": 57617248, "comment_id": 101724054, "body": "I\u2019d like to thank you all for your answers. Turns out I didn\u2019t have my email notifications enabled so sorry for the late reply. The free monad idea seems to be the best bet.   To be clear to everyone in terms of the context of the problem, I do not want my users to touch code: they shouldn\u2019t even know what the language is. I\u2019m trying to allow users to construct a parser tree with a visual element, with no understanding of the backend."}, {"owner": {"reputation": 11, "user_id": 11152257, "user_type": "registered", "profile_image": "https://graph.facebook.com/2530705653610571/picture?type=large", "display_name": "Santi Weight", "link": "https://stackoverflow.com/users/11152257/santi-weight"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1566628558, "post_id": 57617248, "comment_id": 101724064, "body": "@arrowd thank you for your answer. I will put a post up on reddit after I implement this. This solution sounds pretty exciting!"}], "owner": {"reputation": 11, "user_id": 11152257, "user_type": "registered", "profile_image": "https://graph.facebook.com/2530705653610571/picture?type=large", "display_name": "Santi Weight", "link": "https://stackoverflow.com/users/11152257/santi-weight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566510606, "creation_date": 1566509143, "last_edit_date": 1566510606, "question_id": 57617248, "link": "https://stackoverflow.com/questions/57617248/how-would-implement-a-feature-to-save-monads-with-associated-names-on-disk", "title": "How would implement a feature to save Monads with associated names on disk?", "body": "<p>So I have a simple parser library (it doesn't parse strings but whatever) and I need the parsers to have potential names etc.\nSo, for example, the user might take the parsers</p>\n\n<pre><code>   space &gt;&gt; space\n</code></pre>\n\n<p>and then apply the name twoSpaces to this parser. This would then be saved to disk (not sure how exactly) to be later reloaded when the application is rerun.</p>\n\n<p>So my question is:\nShould this functionality be wrapped say in this:</p>\n\n<pre><code>    type Name = String\n    newtype NamedParser a = NamedParser (Parser a)  Name\n</code></pre>\n\n<p>Or should my definition of Parser be changed from:</p>\n\n<pre><code>    newtype Parser a = Parser { parse :: a -&gt; FilterResult a }\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>    newtype Parser a = Parser { parse :: a -&gt; FilterResult a \n                                   , name :: Name }\n</code></pre>\n\n<p>My intuition worries here about both speed of the program and implementation (sometimes I won't want to name parsers etc).\nAn extension of this question is whether I can then allow the user to save these new parsers in data files for between runtimes. This way the user can build a library of tools that can load in.</p>\n\n<p>I can imagine a good way of doing this being an appropriate Writer/Parser duo that saves this stuff to files, with the resulting Haskell code then added to my libraries. Is there a convention for such things or is that what I should go for. Is TemplateHaskell a better alternative for this??</p>\n\n<p>Finally, how would I add and delete these new metaprogrammed functions\u200b efficiently - is there a convention for that?</p>\n"}, {"tags": ["haskell", "shared-libraries", "dynamic-linking", "ffi", "haskell-ffi"], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1566529492, "creation_date": 1566529492, "answer_id": 57619377, "question_id": 57617200, "link": "https://stackoverflow.com/questions/57617200/how-do-i-use-a-funptr-from-haskell/57619377#57619377", "title": "How do I use a FunPtr from Haskell?", "body": "<p><code>ccall</code> can only import functions, but <code>lol2</code> is no function. Use a <code>capi</code> import with a <code>value</code> qualification:</p>\n\n<pre><code>{-# LANGUAGE CApiFFI #-}\nmodule Main where\n-- ... etc ...\nforeign import capi \"test2.h value lol2\" fun_ptr :: FunPtr Fun\n-- ... etc ...\n</code></pre>\n\n<p>It's not immediately obvious, but <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ffi-chap.html?highlight=foreign%20import#the-capi-calling-convention\" rel=\"nofollow noreferrer\">the manual says to do this</a>, and it works. The warning message you've seen still comes up; I think you may want to report that as a bug.</p>\n"}], "owner": {"reputation": 17430, "user_id": 309483, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d797538504a367f277d19bd8369e9a19?s=128&d=identicon&r=PG", "display_name": "Janus Troelsen", "link": "https://stackoverflow.com/users/309483/janus-troelsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 57619377, "answer_count": 1, "score": 2, "last_activity_date": 1566529492, "creation_date": 1566508813, "last_edit_date": 1566528892, "question_id": 57617200, "link": "https://stackoverflow.com/questions/57617200/how-do-i-use-a-funptr-from-haskell", "title": "How do I use a FunPtr from Haskell?", "body": "<p>Assuming the following files:</p>\n\n<p>test2.h:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef int (*signature) ();\n\nextern const signature lol2;\n</code></pre>\n\n<p>test2.c:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include \"test2.h\"\n\nint lol() {\n  return 42;\n}\n\nconst signature lol2 = lol;\n</code></pre>\n\n<p>Test2.hs:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\nimport Foreign.C\nimport Foreign.Ptr\n\ntype Fun =\n  IO CInt\n\nforeign import ccall\n  \"test2.h lol2\"\n  fun_ptr\n  :: FunPtr Fun\n\nforeign import ccall \"dynamic\" mkFun :: FunPtr Fun -&gt; Fun\n\nlol = mkFun fun_ptr\n\nmain = do\n  fortytwo &lt;- lol\n  putStrLn $ show $ fortytwo\n</code></pre>\n\n<p>With the following compilation:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>gcc -shared test2.c -Wall -Wextra -o libtest2.so -g3 -ggdb3\nghc -o test2 Test2.hs -ltest2 -optl-Wl,-rpath,. -L. -g\n</code></pre>\n\n<p>(GHC emits a warning about a missing \"&amp;\" before the lol2 declaration, but I think the warning is wrong, so I ignore it. Also, note that I am not using <code>-dynamic</code>. If I do, the results are the same)</p>\n\n<p>But, I get a SIGSEGV while running:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>(gdb) break scheduleWaitThread\nBreakpoint 1 at 0x468150: file rts/Schedule.c, line 2509.\n(gdb) r\nStarting program: [...]/test2 \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n\nBreakpoint 1, scheduleWaitThread (tso=0x4200105388, ret=ret@entry=0x0, pcap=pcap@entry=0x7fffffffd7f8) at rts/Schedule.c:2509\n2509    rts/Schedule.c: No such file or directory.\n(gdb) bt\n#0  scheduleWaitThread (tso=0x4200105388, ret=ret@entry=0x0, pcap=pcap@entry=0x7fffffffd7f8) at rts/Schedule.c:2509\n#1  0x0000000000483864 in rts_evalLazyIO (cap=cap@entry=0x7fffffffd7f8, p=p@entry=0x4a5420, ret=ret@entry=0x0) at rts/RtsAPI.c:530\n#2  0x00000000004707ae in hs_main (argc=1, argv=0x7fffffffd9e8, main_closure=0x4a5420, rts_config=...) at rts/RtsMain.c:72\n#3  0x0000000000406b46 in main ()\n(gdb) finish\nRun till exit from #0  scheduleWaitThread (tso=0x4200105388, ret=ret@entry=0x0, pcap=pcap@entry=0x7fffffffd7f8) at rts/Schedule.c:2509\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00000000004a4d90 in lol2 ()\n(gdb) \n</code></pre>\n\n<p>After the crash the stack seems unusable:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>(gdb) bt\n#0  0x00000000004a4d90 in lol2 ()\n#1  0x000000000040669d in r2ad_info ()\n#2  0x0000000000000000 in ?? ()\n</code></pre>\n\n<p>What am I doing wrong? How can I debug this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1566503436, "post_id": 57616104, "comment_id": 101687343, "body": "I think the problem here is that the <code>h</code> is &quot;erased&quot; from the type signature, and therefore now you have a function where it is no longer clear what hastable you are actually using."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1566548794, "post_id": 57616104, "comment_id": 101698778, "body": "The type error should also have included a statement that the type <code>h0</code> is ambiguous, which is an important clue."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1566503938, "creation_date": 1566503938, "answer_id": 57616308, "question_id": 57616104, "link": "https://stackoverflow.com/questions/57616104/why-this-doesnt-type-checks/57616308#57616308", "title": "Why this doesn&#39;t type checks?", "body": "<p>The problem here is that the <code>h</code> dissapears from the signature of your <code>asList</code> function, so you can no longer specify the <code>h</code> through the signature (or through the use of <code>asList</code>). As a result, Haskell no longer knows hat <code>HashTable</code> instance to pick here, hence the error.</p>\n\n<p>You can for example specify one, with an explicit signature, or with the <code>TypeApplications</code> extension. For example:</p>\n\n<pre><code>{-# LANGUAGE <b>TypeApplications</b> #-}\n\nimport           Control.Monad.ST               ( ST, runST)\nimport qualified Data.HashTable.ST.Basic       as <b>HT</b>\nimport qualified Data.HashTable.Class          as HC\nimport           Data.HashTable.Class           ( HashTable )\nimport           Data.ByteString.Lazy.Char8     ( ByteString )\n\nfourSizedTable :: HashTable h =&gt; ST s (h s ByteString Integer)\nfourSizedTable = HC.newSized 4\n\nasList :: ST s [(ByteString, Integer)]\nasList = fourSizedTable <b>@HT.HashTable</b> &gt;&gt;= HC.toList</code></pre>\n\n<p>We here thus pick a specific <code>HashTable</code> instance, and therefore there is no confusion anymore.</p>\n"}], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 57616308, "answer_count": 1, "score": 2, "last_activity_date": 1566503938, "creation_date": 1566502870, "question_id": 57616104, "link": "https://stackoverflow.com/questions/57616104/why-this-doesnt-type-checks", "title": "Why this doesn&#39;t type checks?", "body": "<p>A mutable hashmap from ByteString to Integer. Should be easy but can understand why it does not type checks. Should I notate some type manualy?</p>\n\n<pre><code>import           Control.Monad.ST               ( ST, runST)\nimport qualified Data.HashTable.Class          as HC\nimport           Data.HashTable.Class           ( HashTable )\nimport           Data.ByteString.Lazy.Char8     ( ByteString )\n\nfourSizedTable :: HashTable h =&gt; ST s (h s ByteString Integer)\nfourSizedTable = HC.newSized 4\n\nasList :: ST s [(ByteString, Integer)]\nasList = fourSizedTable &gt;&gt;= HC.toList \n</code></pre>\n\n<p>fails with the following message:</p>\n\n<blockquote>\n  <p>\u2022 No instance for (HashTable h0) <br>\n    arising from a use of \u2018fourSizedTable\u2019<br>\n  \u2022 In the first argument of \u2018(>>=)\u2019, namely \u2018fourSizedTable\u2019<br>\n    In the expression: fourSizedTable >>= HC.toList<br>\n    In an equation for \u2018asList\u2019: asList = fourSizedTable >>= HC.toList<br></p>\n</blockquote>\n"}, {"tags": ["haskell", "haddock"], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 3692742, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/5e9830f50e87776a652fa809dfeba549?s=128&d=identicon&r=PG&f=1", "display_name": "manmon42", "link": "https://stackoverflow.com/users/3692742/manmon42"}, "edited": false, "score": 1, "creation_date": 1569568102, "post_id": 57612736, "comment_id": 102646170, "body": "Thanks so much! This fixed the same issue for me on Ubuntu on WSL."}], "tags": [], "owner": {"reputation": 64, "user_id": 9110575, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hMlw8.jpg?s=128&g=1", "display_name": "Hello World", "link": "https://stackoverflow.com/users/9110575/hello-world"}, "is_accepted": true, "score": 4, "last_activity_date": 1566487737, "creation_date": 1566487737, "answer_id": 57612736, "question_id": 57609824, "link": "https://stackoverflow.com/questions/57609824/stack-exitfailure-1/57612736#57612736", "title": "Stack ExitFailure 1", "body": "<p>Turns out I was missing something.\n<code>sudo apt-get install libtinfo-dev</code> fixed the issue.</p>\n"}, {"comments": [{"owner": {"reputation": 1040, "user_id": 11767140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Tbfr3YlhoOs/AAAAAAAAAAI/AAAAAAAAAWo/4_25j9xubwc/photo.jpg?sz=128", "display_name": "David Garc&#237;a Bodego", "link": "https://stackoverflow.com/users/11767140/david-garc%c3%ada-bodego"}, "edited": false, "score": 0, "creation_date": 1572758261, "post_id": 58677308, "comment_id": 103655842, "body": "Welcome to SO! That is not an answer to any question, please delete."}], "tags": [], "owner": {"reputation": 1, "user_id": 12314534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fDNQ40D4ib8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcYJIBy2I9pQoRF806pWXJtuzPwMw/photo.jpg?sz=128", "display_name": "Gargoyle Cannibal", "link": "https://stackoverflow.com/users/12314534/gargoyle-cannibal"}, "is_accepted": false, "score": 0, "last_activity_date": 1572753210, "creation_date": 1572753210, "answer_id": 58677308, "question_id": 57609824, "link": "https://stackoverflow.com/questions/57609824/stack-exitfailure-1/58677308#58677308", "title": "Stack ExitFailure 1", "body": "<p>On a fresh install of Ubuntu Bionic.</p>\n\n<p>Had a similar error while trying to install Haskell:</p>\n\n<pre><code>git clone https://github.com/haskell/haskell-ide-engine --recursive\n\ncd haskell-ide-engine\n\nstack install\n</code></pre>\n\n<p>Your fix solved the problem - thanks!</p>\n"}], "owner": {"reputation": 64, "user_id": 9110575, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hMlw8.jpg?s=128&g=1", "display_name": "Hello World", "link": "https://stackoverflow.com/users/9110575/hello-world"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 0, "accepted_answer_id": 57612736, "answer_count": 2, "score": -1, "last_activity_date": 1572753210, "creation_date": 1566478402, "question_id": 57609824, "link": "https://stackoverflow.com/questions/57609824/stack-exitfailure-1", "title": "Stack ExitFailure 1", "body": "<p>I've been trying to run <code>stack install hsdev --stack-yaml ./Documents/hsdev.yaml</code>, where <code>hsdev.yaml</code> contains</p>\n\n<pre><code>packages: []\nresolver: lts-13.29\nextra-deps:\n- hsdev-0.3.3.4\n- hdocs-0.5.3.2\n- haddock-api-2.22.0\n- network-3.0.1.1\n</code></pre>\n\n<p>This returns the error</p>\n\n<pre><code>--  While building package haddock-api-2.22.0 using:\n      /home/hello/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build --ghc-options \" -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>I have already tried <code>haddock-api-2.21.0</code>, which results in the same error. I have also tried running <code>stack install haddock-api</code>.\nI am on Linux Mint 19.1 Cinnamon, if that helps.</p>\n"}, {"tags": ["haskell", "timer"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566497370, "post_id": 57607797, "comment_id": 101684856, "body": "How are you going to consume the &quot;fresh&quot; data?  Immediately after fetch? If so you can just <code>forever $ threadDelay time &gt;&gt; forkIO (fetchUrl &gt;&gt;= doSomethingWithUrl)</code>.  On the other hand, if doSomething is async then you&#39;ll want some mutable memory that fetch updates and doSomething reads."}, {"owner": {"reputation": 83, "user_id": 4606672, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/448748565273403/picture?type=large", "display_name": "shegeley", "link": "https://stackoverflow.com/users/4606672/shegeley"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1566498543, "post_id": 57607797, "comment_id": 101685358, "body": "@ThomasM.DuBuisson Thanks for your interest. In my case doSomething is Scotty web server loop (<code>scotty $ do ...</code>) so i guess it&#39;s async. The data consumed after fetch. <code>fetchUrl</code> which is API call of some service in my case has restriction on calls per IP per time."}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 4606672, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/448748565273403/picture?type=large", "display_name": "shegeley", "link": "https://stackoverflow.com/users/4606672/shegeley"}, "edited": false, "score": 0, "creation_date": 1566522366, "post_id": 57616247, "comment_id": 101691922, "body": "Thanks for your help again but I&#39;d appreciate if I could see example with given (<code>Control.Concurrent.Timer</code>) lib. The part I can&#39;t figure out in it is the <code>IO TimerIO</code> in <code>repeatedTimer :: IO () -&gt; Delay -&gt; IO TimerIO</code>. In your example <code>updatePeriodically</code> has <code>IO ()</code> in the end and it&#39;s wrapped in <code>forever</code> loop. I don&#39;t understand much of more-or-less &#171;low-level&#187; stuff: IORed, forkIO etc."}, {"owner": {"reputation": 83, "user_id": 4606672, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/448748565273403/picture?type=large", "display_name": "shegeley", "link": "https://stackoverflow.com/users/4606672/shegeley"}, "edited": false, "score": 0, "creation_date": 1566547909, "post_id": 57616247, "comment_id": 101698392, "body": "Ok. I figured out that code to print &quot;Hello&quot; periodically might look like this using this libriary:  ```  import Control.Monad import Control.Concurrent.Suspend.Lifted import Control.Concurrent.Timer  printHelloPeriodically :: IO () printHelloPeriodically = do   void $ repeatedTimer (putStrLn &quot;Hello&quot;) (sDelay 5)  main :: IO () main = do   printHelloPeriodically  ```  But how to deal with, say <code>getLine</code> (<code>fetchUrl</code>) and then print it periodically I can&#39;t understand"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1566503588, "creation_date": 1566503588, "answer_id": 57616247, "question_id": 57607797, "link": "https://stackoverflow.com/questions/57607797/timers-control-concurrent-timer-in-haskell-repeated-execution/57616247#57616247", "title": "Timers (Control.Concurrent.Timer) in Haskell: repeated execution", "body": "<p>Your needs sound like they fit with an IORef or MVar.  Typed and not tested code is:</p>\n\n<pre><code>import Data.IORef (readIORef, writeIORef, newIORef)\nimport Control.Concurrent (threadDelay,forkIO)\nimport Control.Monad (void)\n\nmain :: IO ()\nmain = do\n  ref &lt;- newIORef mempty {- or default value -}\n  _ &lt;- forkIO (updatePeriodically fetchUrl ref)\n  scotty $ do\n        liftIO (readIORef ref) &gt;&gt;= etcEtc\n\nupdatePeriodically :: (IO SomeType) -&gt; IORef SomeType -&gt; IO ()\nupdatePeriodically op ref =\n    let update = op &gt;&gt;= writeIORef ref\n    forever $ threadDelay periodInMicroSeconds &gt;&gt; void (forkIO update)\n</code></pre>\n\n<p>This isn't perfect, if one of the <code>fetchUrl</code> calls is badly delayed then its write could clobber a newer call that returned quickly.  That's probably a minor concern but you could handle it with a counter and compare and swap operation.</p>\n"}], "owner": {"reputation": 83, "user_id": 4606672, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/448748565273403/picture?type=large", "display_name": "shegeley", "link": "https://stackoverflow.com/users/4606672/shegeley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566503588, "creation_date": 1566471457, "question_id": 57607797, "link": "https://stackoverflow.com/questions/57607797/timers-control-concurrent-timer-in-haskell-repeated-execution", "title": "Timers (Control.Concurrent.Timer) in Haskell: repeated execution", "body": "<p>Trying to figure out best practices to handle repeated actions in Haskell using <code>Control.Concurrent.Timer</code>. Can't find good examples.  </p>\n\n<p>Suppose I have repeated action that must be done in application. Say it's fetching data from some webpage.</p>\n\n<pre><code>import Control.Concurrent.Suspend.Lifted \nimport Control.Concurrent.Timer\n\nmain :: IO ()\nmain = do\n  url &lt;- fetchUrl :: IO Url\n  doSomethingWithUrl url\n</code></pre>\n\n<p>and I would like url to be fetched repeatly inside main so the data is always fresh. How could it be done?  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1566448153, "post_id": 57601887, "comment_id": 101660707, "body": "Why does &quot;several thousand things to replace&quot; imply &quot;one big regex pattern wouldn&#39;t work&quot;?"}, {"owner": {"reputation": 765, "user_id": 3316409, "user_type": "registered", "profile_image": "https://graph.facebook.com/719585406/picture?type=large", "display_name": "dvaergiller", "link": "https://stackoverflow.com/users/3316409/dvaergiller"}, "edited": false, "score": 0, "creation_date": 1566478440, "post_id": 57601887, "comment_id": 101674894, "body": "Really really looks like a foldl(/foldr) type of problem. With your order of the arguments in subCOlot (pat before str) I guess foldr just fits? <code>foldr subColor str colors</code>"}], "answers": [{"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1566504405, "post_id": 57603189, "comment_id": 101687718, "body": "Why complicate it? Why not just <code>foldr subColor pats str</code>?"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1566706673, "post_id": 57603189, "comment_id": 101737680, "body": "@JosephSible  You mean <code>foldr subColor str pats</code> ? That is a good idea !"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1566706705, "post_id": 57603189, "comment_id": 101737683, "body": "Yep, I got them backwards. That&#39;s what I meant."}], "tags": [], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "is_accepted": false, "score": 3, "last_activity_date": 1566455334, "creation_date": 1566455334, "answer_id": 57603189, "question_id": 57601887, "link": "https://stackoverflow.com/questions/57601887/how-can-i-replace-many-words-in-a-string-using-haskell/57603189#57603189", "title": "How can I replace many words in a string, using Haskell?", "body": "<p>What you want isn't <code>map</code> over several <code>pat</code>s and get a list of new <code>str</code>s, but apply <code>subColor pat</code> for each <code>pat</code> and combine these functions and apply it to <code>str</code>:</p>\n\n<pre><code>subColors :: [String] -&gt; String -&gt; String\nsubColors pats str = foldMap (Endo . subColor) pats str\n</code></pre>\n\n<p>In above code, the <code>foldMap</code> use the <code>instance Monoid (Endo a)</code>, which is same as <code>foldr (.) id</code>.</p>\n\n<p>And, I still suggest you try the \"one big regex pattern\" solution, since a regex engine should do more optmization than you do, but that depends on the implementation of the regex engine, so if performance matters, you need to have a test first.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1566455334, "creation_date": 1566446494, "last_edit_date": 1566447199, "question_id": 57601887, "link": "https://stackoverflow.com/questions/57601887/how-can-i-replace-many-words-in-a-string-using-haskell", "title": "How can I replace many words in a string, using Haskell?", "body": "<p>Let's say I have a string I want to modify: </p>\n\n<pre><code>str = \"I have several paints. For example, red, green, and blue.\" \n</code></pre>\n\n<p>I want to turn it into: <code>I have several paints. For example, XXX, XXX, and blue.</code></p>\n\n<p>So I have a list of words to replace with <code>XXX</code>: </p>\n\n<pre><code>colors = [\"red\", \"green\"]\n</code></pre>\n\n<p>I want to replace the colors from <code>colors</code> in <code>str</code>. Here's what I have so far: </p>\n\n<ul>\n<li>First, a function to replace something with \"xxx\": <code>subColor pat str = subRegex (mkRegex pat) str \"xxx\"</code></li>\n<li>Next, I'm trying to map that or fold it over the list of colors. But I'm stuck: <code>map</code> just returns copies of the string, each with a single word replaced, and I've been getting errors with <code>foldl</code>. What am I doing wrong? </li>\n</ul>\n\n<p>Edit: I should also say that I will sometimes have multi-line words, so using <code>words</code> (as suggested in another similar question's answers) isn't really practical for me. </p>\n\n<p>Edit2: I should add that one big regex pattern, like <code>blue|red</code> probably wouldn't work for me either, since I actually have several thousand of these things to replace. </p>\n"}]