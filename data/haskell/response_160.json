[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1517438862, "post_id": 48552715, "comment_id": 84101845, "body": "Because you partially applied it with <code>1</code>, so Haskell sees that <code>1 :: a</code>, and a number literal has <code>Num a</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1517466383, "last_edit_date": 1517466383, "creation_date": 1517439022, "answer_id": 48552756, "question_id": 48552715, "link": "https://stackoverflow.com/questions/48552715/typeclass-constrained-type-variable-when-beta-reducing-use-case/48552756#48552756", "title": "&quot;typeclass-constrained type variable when beta reducing&quot; use case", "body": "<p>You <em>partially apply</em> <code>f</code> with <code>f 1 2</code>. So that means that <code>1 :: a</code>, and <code>2 :: b</code>.</p>\n\n<p>Now a number literal (like <code>1</code>, <code>42</code>, <code>14.25</code>) always is a type of the <code>Num</code> typeclass. Indeed:</p>\n\n<pre><code>Prelude&gt; :t 1\n1 :: Num t =&gt; t\n</code></pre>\n\n<p>It is not certain at this point what type (since it can be an <code>Int</code>, <code>Integral</code>, <code>Float</code>, etc.). But it thus means that we now have constraint the type of <code>a</code> further, so the result should also have that type constraint.</p>\n\n<p>If we had used a <code>Char</code>, then <code>a</code> would have been a <code>Char</code>:</p>\n\n<pre><code>Prelude&gt; :t f 'a' 2\nf 'a' 2 :: Char\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 48552756, "answer_count": 1, "score": 3, "last_activity_date": 1517466383, "creation_date": 1517438797, "question_id": 48552715, "link": "https://stackoverflow.com/questions/48552715/typeclass-constrained-type-variable-when-beta-reducing-use-case", "title": "&quot;typeclass-constrained type variable when beta reducing&quot; use case", "body": "<p>I'm learning Haskell and there is a logic I don't understand when we reduce this expression :</p>\n\n<pre><code>Prelude&gt; let f :: (Ord a, Num b) =&gt; a -&gt; b -&gt; a; f = undefined\nPrelude&gt; :t f 1 2\nf 1 2 :: (Num a, Ord a) =&gt; a\n</code></pre>\n\n<p>I don't understand why we get constrained with Num, I would have expected more something like :</p>\n\n<pre><code>`f 1 2 :: Ord a =&gt; a` \n</code></pre>\n"}, {"tags": ["haskell", "cloud-haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1517448663, "post_id": 48553685, "comment_id": 84104461, "body": "It&#39;s not at all obvious to me why <code>unsafeLookupStaticPtr</code> lives in <code>IO</code>. It seems that this sort of thing would probably play well with <code>TypeRep</code> serialization or similar."}, {"owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "edited": false, "score": 2, "creation_date": 1517488473, "post_id": 48553685, "comment_id": 84121371, "body": "I am not sure but I believe the reason was some backward compatibility issues in GHC 7.10. The Typeable API was changed in the later versions. As mentioned in this blog post: <a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-23-static-pointers.html\" rel=\"nofollow noreferrer\">ocharles.org.uk/blog/guest-posts/&hellip;</a> &quot;&quot; The reason only the unsafe variant will ship in GHC 7.10 is because the safe variant will require a change to the Data.Typeable API to be truly safe, and because we do not yet store Typeable constraints in the internal compiler-generated table mentioned above. &quot;&quot;  The proposed function <code>lookupStaticPtr</code> never made it."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1517445518, "creation_date": 1517445518, "answer_id": 48553685, "question_id": 48552543, "link": "https://stackoverflow.com/questions/48552543/binary-instance-for-static-pointers/48553685#48553685", "title": "Binary instance for Static Pointers", "body": "<p>You can serialize a <code>StaticPtr</code> as a <code>Fingerprint</code> via <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/GHC-StaticPtr.html#v:staticKey\" rel=\"nofollow noreferrer\"><code>staticKey</code></a> and deserialize it via <code>unsafeLookupStaticPtr</code> below it.</p>\n\n<p>You can't define a <code>Binary</code> instance for <code>StaticPtr</code> (even if you wrap it in a newtype to avoid orphans) because the lookup cannot be done purely. But you can still define and use the serializer and deserializer as regular, nonoverloaded functions.</p>\n"}, {"tags": [], "owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "is_accepted": true, "score": 1, "last_activity_date": 1520177956, "last_edit_date": 1520177956, "creation_date": 1517488191, "answer_id": 48562833, "question_id": 48552543, "link": "https://stackoverflow.com/questions/48552543/binary-instance-for-static-pointers/48562833#48562833", "title": "Binary instance for Static Pointers", "body": "<p>Li-yao Xia's answer is correct. But I had to change my data types, in general, to pass them remotely. I am writing my changes here so it might be useful if someone wants to send a function remotely, there isn't many resources on this online. </p>\n\n<p>So instead of having</p>\n\n<pre><code>data Foo a b = A (StaticPtr (a -&gt; b))\n</code></pre>\n\n<p>I have changed my data types to look like this:</p>\n\n<pre><code>data Foo a b = A (a -&gt; b)\n</code></pre>\n\n<p>or to simplify</p>\n\n<pre><code>data Foo f = A f\n</code></pre>\n\n<p>Here <code>f</code> is the function I want to send remotely.</p>\n\n<p>So taking a simple example of a function like <code>(+ 1)</code> and imagine I want to map this over a list <code>[1,2,3]</code> which is present remotely. My code becomes like this:</p>\n\n<pre><code>main :: IO [Int]\nmain = do\nlet list = [1,2,3]\n    a = static (A (+ 1)) :: StaticPtr (Foo (Int -&gt; Int))\n    t = staticKey a\n    -- assuming you sent t to the remote node\n    -- code on the remote node\n    x &lt;- unsafeLookupStaticPtr t\n    case x of\n      Just sptr -&gt; case deRefStaticPtr sptr of\n                         A f -&gt; return $ map f list\n                         _   -&gt; error \"Task undefined\"\n      Nothing -&gt; error \"Wrong function serialized\"\n</code></pre>\n"}], "owner": {"reputation": 2047, "user_id": 1942289, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/ckjmp.jpg?s=128&g=1", "display_name": "Abhiroop Sarkar", "link": "https://stackoverflow.com/users/1942289/abhiroop-sarkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 48562833, "answer_count": 2, "score": 1, "last_activity_date": 1520177956, "creation_date": 1517437956, "question_id": 48552543, "link": "https://stackoverflow.com/questions/48552543/binary-instance-for-static-pointers", "title": "Binary instance for Static Pointers", "body": "<p>I have the following data type</p>\n\n<pre><code>data Foo a b = A (StaticPtr (a -&gt; b)) deriving (Generic, Typeable)\n</code></pre>\n\n<p>I want to generate the Binary instance for this type so I can use this function on a remote node.</p>\n\n<p>However, using automatic Binary instantiation doesn't work here:</p>\n\n<pre><code>instance (Binary a, Binary b) =&gt; Binary (Foo a b)\n</code></pre>\n\n<p>This results in</p>\n\n<pre><code>\u2022 Could not deduce (Binary (StaticPtr (a -&gt; b)))\n    arising from a use of \u2018binary-0.8.5.1:Data.Binary.Class.$dmput\u2019\n  from the context: (Binary a, Binary b)\n    bound by the instance declaration\n    at /Users/abhiroop/Haskell/snape/app/Spec.hs:23:10-49\n\u2022 In the expression:\n    binary-0.8.5.1:Data.Binary.Class.$dmput @Foo a b\n  In an equation for \u2018binary-0.8.5.1:Data.Binary.Class.put\u2019:\n      binary-0.8.5.1:Data.Binary.Class.put\n        = binary-0.8.5.1:Data.Binary.Class.$dmput @Foo a b\n  In the instance declaration for \u2018Binary (Foo a b)\u2019\n\n\n\u2022 Could not deduce (Binary (StaticPtr (a -&gt; b)))\n    arising from a use of \u2018binary-0.8.5.1:Data.Binary.Class.$dmget\u2019\n  from the context: (Binary a, Binary b)\n    bound by the instance declaration\n    at /Users/abhiroop/Haskell/snape/app/Spec.hs:23:10-49\n\u2022 In the expression:\n    binary-0.8.5.1:Data.Binary.Class.$dmget @Foo a b\n  In an equation for \u2018binary-0.8.5.1:Data.Binary.Class.get\u2019:\n      binary-0.8.5.1:Data.Binary.Class.get\n        = binary-0.8.5.1:Data.Binary.Class.$dmget @Foo a b\n  In the instance declaration for \u2018Binary (Foo a b)\u2019\n</code></pre>\n\n<p>How do I auto generate the <code>Binary</code> instance here?</p>\n"}, {"tags": ["haskell", "gtk3"], "answers": [{"comments": [{"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1517475248, "post_id": 48558105, "comment_id": 84113067, "body": "Thank you very much for your thorough answer. &quot;What is the type of Nothing in Haskell?&quot; was particularly enlightening for me."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 3, "last_activity_date": 1517472936, "creation_date": 1517472936, "answer_id": 48558105, "question_id": 48552427, "link": "https://stackoverflow.com/questions/48552427/how-do-i-properly-invoke-gi-gtk-scrolledwindownew-in-haskell/48558105#48558105", "title": "How do I properly invoke GI.Gtk scrolledWindowNew in Haskell?", "body": "<p>If you take a look at the signature of Data <a href=\"https://hackage.haskell.org/package/gi-gtk-3.0.19/docs/GI-Gtk-Objects-ScrolledWindow.html#v:scrolledWindowNew\" rel=\"nofollow noreferrer\">GI.Gtk.Objects.ScrolledWindow.scrolledWindowNew</a>:</p>\n\n<pre><code>scrolledWindowNew :: (HasCallStack, MonadIO m, IsAdjustment a, IsAdjustment b)  =&gt;\n                     Maybe a -&gt;\n                     Maybe b -&gt;\n                     m ScrolledWindow\n</code></pre>\n\n<p>And if you call it like you did</p>\n\n<pre><code>scrolled &lt;- scrolledWindowNew Nothing Nothing\n</code></pre>\n\n<p>The compiler knows two things about the (for example) first parameter. It has the type <code>Maybe a</code> and about <code>a</code> it know, that it is some type with an instance for <code>IsAdjustment</code>.</p>\n\n<p>But the compiler needs to know exactly, what the type <code>a</code> is and the error message is due to the fact, that it can't deduce it. (Sadly it is pretty weird and not very helpful, as those overlapping instances thingy is intervenes.)</p>\n\n<p>Let's look at, why <code>noAdjustment</code> works. If we look up it's documentation <a href=\"https://hackage.haskell.org/package/gi-gtk-3.0.19/docs/GI-Gtk-Objects-Adjustment.html#v:noAdjustment\" rel=\"nofollow noreferrer\">GI.Gtk.Objects.Adjustment.noAdjustment</a> it type signature reads:</p>\n\n<pre><code>noAdjustment :: Maybe Adjustment\n</code></pre>\n\n<p>and the docs state:</p>\n\n<blockquote>\n  <p>A convenience alias for <code>Nothing :: Maybe Adjustment</code>.</p>\n</blockquote>\n\n<p>And <code>Adjustment</code> is a concrete type, which happens to have an instance for <code>IsAdjustment</code>.</p>\n\n<p>So the compiler is happy, as it now knows the exact type of the parameters.</p>\n\n<p>Also see</p>\n\n<p><a href=\"https://stackoverflow.com/questions/22065358/what-is-the-type-of-nothing-in-haskell\">What is the type of Nothing in Haskell?</a></p>\n\n<p>or</p>\n\n<p><a href=\"https://stackoverflow.com/questions/6716330/using-haskells-maybe-type-declarations-beginners-question\">Using Haskell&#39;s &quot;Maybe&quot;, type declarations [beginner&#39;s question]</a></p>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 48558105, "answer_count": 1, "score": 2, "last_activity_date": 1517472936, "creation_date": 1517437362, "last_edit_date": 1517449370, "question_id": 48552427, "link": "https://stackoverflow.com/questions/48552427/how-do-i-properly-invoke-gi-gtk-scrolledwindownew-in-haskell", "title": "How do I properly invoke GI.Gtk scrolledWindowNew in Haskell?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/gi-gtk-3.0.18/docs/GI-Gtk-Objects-ScrolledWindow.html#g:20\" rel=\"nofollow noreferrer\">documentation</a> says:</p>\n\n<blockquote>\n  <p>Usually you want to pass Nothing for the adjustments</p>\n</blockquote>\n\n<p>but</p>\n\n<pre><code>scrolled &lt;- scrolledWindowNew Nothing Nothing\n</code></pre>\n\n<p>gives me the following error, probably caused by incorrect imports.</p>\n\n<pre><code>\u2022 Overlapping instances for GI.Gtk.Objects.Adjustment.IsAdjustment\n                              a0\n    arising from a use of \u2018scrolledWindowNew\u2019   Matching instances:\n    instance [overlappable] (Data.GI.Base.BasicTypes.GObject a,\n                             Data.GI.Base.Overloading.UnknownAncestorError\n                               GI.Gtk.Objects.Adjustment.Adjustment a) =&gt;\n                            GI.Gtk.Objects.Adjustment.IsAdjustment a\n      -- Defined in \u2018GI.Gtk.Objects.Adjustment\u2019\n    ...plus one instance involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n</code></pre>\n\n<p>my imports look like this</p>\n\n<pre><code>import qualified GI.Gtk as GI (init,\n                               main)\nimport GI.Gtk (mainQuit,\n               onWidgetDestroy,\n               windowNew,\n               widgetShowAll,\n               containerSetBorderWidth,\n               headerBarNew, headerBarSetTitle, headerBarSetSubtitle,headerBarSetShowCloseButton,\n               scrolledWindowNew\n               )\n\nimport GI.Gtk.Objects.Window\nimport GI.Gtk.Enums\n</code></pre>\n\n<h2>a possible solution</h2>\n\n<p>Is it an error in the documentation? Using noAdjustment instead of Nothing seems to work.</p>\n\n<pre><code>import qualified GI.Gtk as GI (init,\n                               main)\nimport GI.Gtk (mainQuit,\n               onWidgetDestroy,\n               windowNew,\n               widgetShowAll,\n               containerSetBorderWidth,\n               headerBarNew, headerBarSetTitle, headerBarSetSubtitle,headerBarSetShowCloseButton,\n               scrolledWindowNew, scrolledWindowSetPolicy\n               )\n\nimport GI.Gtk.Objects.Window\nimport GI.Gtk.Objects.Adjustment (noAdjustment)\n\nimport GI.Gtk.Enums (WindowType(..), PolicyType(..))\n\n\n\n  scrolled &lt;- scrolledWindowNew noAdjustment noAdjustment\n  scrolledWindowSetPolicy scrolled PolicyTypeNever PolicyTypeAutomatic\n</code></pre>\n\n<p>Inspiration found in Leksah source code.</p>\n\n<h2>please comment</h2>\n\n<p>I was trying to translate into Haskell a Python example found here:\n<a href=\"http://python-gtk-3-tutorial.readthedocs.io/en/latest/layout.html#flowbox\" rel=\"nofollow noreferrer\">http://python-gtk-3-tutorial.readthedocs.io/en/latest/layout.html#flowbox</a></p>\n\n<p>Working version, with the problem solved, can be found here:\n<a href=\"https://github.com/bigos/my-haskell-gtk-3-tutorial/blob/master/5-layout-containers/6-flow-box.org\" rel=\"nofollow noreferrer\">https://github.com/bigos/my-haskell-gtk-3-tutorial/blob/master/5-layout-containers/6-flow-box.org</a></p>\n"}, {"tags": ["string", "algorithm", "haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1517417756, "post_id": 48547367, "comment_id": 84090706, "body": "When there is a non-exhaustive pattern it will tell you the pattern.  Please post the error.  Also, from a glance you can see <code>hprefix _ [ ]</code> does not have a definition."}, {"owner": {"reputation": 49, "user_id": 9010647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8059510497e4ae0d44cd50e8ee966550?s=128&d=identicon&r=PG&f=1", "display_name": "essence", "link": "https://stackoverflow.com/users/9010647/essence"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1517417955, "post_id": 48547367, "comment_id": 84090870, "body": "*** Exception: KMP.lhs:(17,3)-(25,276): Non-exhaustive patterns in function kmp"}, {"owner": {"reputation": 49, "user_id": 9010647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8059510497e4ae0d44cd50e8ee966550?s=128&d=identicon&r=PG&f=1", "display_name": "essence", "link": "https://stackoverflow.com/users/9010647/essence"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1517417984, "post_id": 48547367, "comment_id": 84090888, "body": "hprefix is working. Its only kmp with problems"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1517418060, "post_id": 48547367, "comment_id": 84090946, "body": "hprefix is partial as I said.  KMP is partial too - the 2nd, 3rd, and 4th arguments all need to be non-empty for it to be defined."}, {"owner": {"reputation": 770, "user_id": 211158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/66756a9bcda9735c612103952c59fb3c?s=128&d=identicon&r=PG", "display_name": "Long", "link": "https://stackoverflow.com/users/211158/long"}, "edited": false, "score": 2, "creation_date": 1517418870, "post_id": 48547367, "comment_id": 84091467, "body": "You cannot match an empty list with (t:ts) ... in particular (t:ts) == [] is always false"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1517421837, "post_id": 48547367, "comment_id": 84093216, "body": "Enable warnings when you compile programs. At least <code>-W</code>, which includes <code>-Wincomplete-patterns</code>, that tells you what patterns you are missing."}, {"owner": {"reputation": 49, "user_id": 9010647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8059510497e4ae0d44cd50e8ee966550?s=128&d=identicon&r=PG&f=1", "display_name": "essence", "link": "https://stackoverflow.com/users/9010647/essence"}, "edited": false, "score": 0, "creation_date": 1517423788, "post_id": 48547367, "comment_id": 84094288, "body": "Ah very important info. -W saved me and everything is working now! Thanks all!"}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 9010647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8059510497e4ae0d44cd50e8ee966550?s=128&d=identicon&r=PG&f=1", "display_name": "essence", "link": "https://stackoverflow.com/users/9010647/essence"}, "edited": false, "score": 0, "creation_date": 1517421314, "post_id": 48548339, "comment_id": 84092900, "body": "Thanks, I added: &gt; hprefix [] (i:is) int = [] and &gt; kmp p [] (b:bs) (t:ts) o = ((length(o)) - (length (t:ts))):(kmp p p (take (length p) (drop (length p) (t:ts))) (drop (length p) (t:ts)) o)  &gt; kmp p (a:as) [] (t:ts) o = []  &gt; kmp p (a:as) (b:bs) [] o = [] but still get the same error"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1517420580, "creation_date": 1517420580, "answer_id": 48548339, "question_id": 48547367, "link": "https://stackoverflow.com/questions/48547367/kmp-string-searching-in-haskell-non-exhaustive-pattern/48548339#48548339", "title": "KMP string searching in Haskell - non exhaustive pattern", "body": "<p>With <code>-fwarn-incomplete-patterns</code> or <code>-Wincomplete-patterns</code>, GHC will tell you what patterns you need to add to avoid this error:</p>\n\n<pre><code>test.hs:5:1: warning: [-Wincomplete-patterns]\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018hprefix\u2019:\n        Patterns not matched:\n            [] [] _\n            (_:_) [] _\n  |\n5 | hprefix [] (i:is) int = []\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^...\n\ntest.hs:17:1: warning: [-Wincomplete-patterns]\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018kmp\u2019:\n        Patterns not matched:\n            _ [] _ _ _\n            _ (_:_) [] _ _\n            _ (_:_) (_:_) [] _\n   |\n17 | kmp p (a:as) (b:bs) (t:ts) o | o == [] = error \"leerer Text\"\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "is_accepted": true, "score": 0, "last_activity_date": 1517423709, "creation_date": 1517423709, "answer_id": 48549205, "question_id": 48547367, "link": "https://stackoverflow.com/questions/48547367/kmp-string-searching-in-haskell-non-exhaustive-pattern/48549205#48549205", "title": "KMP string searching in Haskell - non exhaustive pattern", "body": "<p>Your missing patterns are <em>before</em> the guards.  <code>(a:as)</code> and the like can't match <code>[]</code>, even if you put a guard to that effect.  You should write it more like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>kmp _ _ _ _ []                          = error \"leerer Text\"\nkmp [] _ _ _ _                          = error \"leeres Pattern\"\nkmp p _ _ _ o | (length p) &gt; (length o) = error \"Pattern gr\u00f6\u00dfer als Text\"\nkmp _ _ _ [] _                          = []\nkmp _ _ _ [] _                          = []\nkmp p [] _ t o                          = ((length o) - (length t))):(kmp p p (take (length p) (drop (length p) t)) (drop (length p) t) o)\nkmp _ _ [] _ _                          = []\nkmp p (a:as) (b:bs) t o | a == b        = (kmp p as bs t o)\nkmp p (a:as) (b:bs) (t:ts) o | (head(drop ((length p) - (length (a:as))) (prefix p))) == 0 = (kmp p p (take (length p) ts) ts o)\nkmp p a _ t o                           = (kmp p (drop (head(drop ((length p) - (length a)) (prefix p))) p) (take (length p) (drop (head(drop ((length p) - (length a)) (prefix p))) t)) (drop (head(drop ((length p) - (length a)) (prefix p))) t)  o)\n</code></pre>\n\n<p>Although you should really consider breaking this down further.  This is really hard to follow.</p>\n"}, {"tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 0, "last_activity_date": 1517424058, "creation_date": 1517424058, "answer_id": 48549300, "question_id": 48547367, "link": "https://stackoverflow.com/questions/48547367/kmp-string-searching-in-haskell-non-exhaustive-pattern/48549300#48549300", "title": "KMP string searching in Haskell - non exhaustive pattern", "body": "<p>It's clear that your <code>hprefix</code> and <code>kmp</code> functions are not total, thus not exhaustive.</p>\n\n<p>To see why, recall the first (and only) equation for <code>kmp</code>:</p>\n\n<pre><code>kmp p (a:as) (b:bs) (t:ts) o = ...\n</code></pre>\n\n<p>Here you are defining <code>kmp</code> enforcing the second, third and fourth argument to be non-empty strings. Hence, in order to make <code>kmp</code> total you have to cover these missing cases adding, for example, another equation to <code>kmp</code>'s pattern matching definition which will capture the cases where those strings are empty:</p>\n\n<pre><code>kmp p s1 s2 s3 o = ...\n</code></pre>\n\n<p>The compiler is simply stating that the program might crash at runtime if you call <code>kmp</code> with empty strings in the places above mentioned, as it is not defined.</p>\n"}], "owner": {"reputation": 49, "user_id": 9010647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8059510497e4ae0d44cd50e8ee966550?s=128&d=identicon&r=PG&f=1", "display_name": "essence", "link": "https://stackoverflow.com/users/9010647/essence"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 48549205, "answer_count": 3, "score": -2, "last_activity_date": 1517507103, "creation_date": 1517417501, "last_edit_date": 1517507103, "question_id": 48547367, "link": "https://stackoverflow.com/questions/48547367/kmp-string-searching-in-haskell-non-exhaustive-pattern", "title": "KMP string searching in Haskell - non exhaustive pattern", "body": "<p>Hi I tried to implement the KMP string searching algorithm in Haskell. But when I try to run the function kmp it only says \"non exhaustive pattern\" for this function. No matter how much I try to correct it. I thought I had every possible outcome covert. Maybe I'm just blind but i hope someone could help me here.:</p>\n\n<pre><code>prefix :: String -&gt; [Int]\nprefix p = hprefix p p 0\n\nhprefix :: String -&gt; String -&gt; Int -&gt; [Int]\nhprefix [] (i:is) int = []\nhprefix (p:ps) (i:is) int | (length(i:is)) - (length(p:ps)) == 0 = 0:(hprefix ps (i:is) 0)\n                          | p == (head(drop (int) (i:is))) = (int+1):(hprefix ps (i:is) (int+1))\n                          | p == i = 1:(hprefix ps (i:is) 1)\n                          | otherwise = 0:(hprefix ps (i:is) 0)\n\nhkmp :: String -&gt; String -&gt; [Int]\nhkmp p [] = error \"leerer Text\"\nhkmp [] t = error \"leeres Pattern\"\nhkmp p t = kmp p p (take (length p) t) t t\n\nkmp :: String -&gt; String -&gt; String -&gt; String -&gt; String -&gt; [Int]\nkmp p (a:as) (b:bs) (t:ts) o | o == [] = error \"leerer Text\"\n                               | p == [] = error \"leeres Pattern\"\n                               | (length p) &gt; (length o) = error \"Pattern gr\u00f6\u00dfer als Text\"\n                               | (t:ts) == [] = []\n                               | (a:as) == [] = ((length(o)) - (length (t:ts))):(kmp p p (take (length p) (drop (length p) (t:ts))) (drop (length p) (t:ts)) o)\n                               | (b:bs) == [] = []\n                               | a == b = (kmp p as bs (t:ts) o)\n                               | (head(drop ((length p) - (length (a:as))) (prefix p))) == 0 = (kmp p p (take (length p) ts) ts o)\n                               | otherwise = (kmp p (drop (head(drop ((length p) - (length (a:as))) (prefix p))) p) (take (length p) (drop (head(drop ((length p) - (length (a:as))) (prefix p))) (t:ts))) (drop (head(drop ((length p) - (length (a:as))) (prefix p))) (t:ts))  o)\n</code></pre>\n\n<p>Thanks alot!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1517410642, "post_id": 48545085, "comment_id": 84085653, "body": "Would it be possible to post the problem description (or at least a summary of the problem)?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1517428563, "post_id": 48545085, "comment_id": 84096835, "body": "Can you give a specific example of (simple) input and some expected output, and what you get instead?  A small example with maybe two or three instructions only."}, {"owner": {"reputation": 7285, "user_id": 51007, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5db5360695c59775397379d5e015e9f2?s=128&d=identicon&r=PG", "display_name": "Quinn Wilson", "link": "https://stackoverflow.com/users/51007/quinn-wilson"}, "edited": false, "score": 0, "creation_date": 1517438566, "post_id": 48545085, "comment_id": 84101729, "body": "if your (c1,c2)  are such that c1 &gt; c2 you&#39;ll get an empty list in <code>parse</code> (<code>range</code> will give you an empty list if  c1&lt;c2)"}, {"owner": {"reputation": 3, "user_id": 9294971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4bb2139571a8e5514cd56ea75e0c91e?s=128&d=identicon&r=PG&f=1", "display_name": "haskeller", "link": "https://stackoverflow.com/users/9294971/haskeller"}, "reply_to_user": {"reputation": 7285, "user_id": 51007, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5db5360695c59775397379d5e015e9f2?s=128&d=identicon&r=PG", "display_name": "Quinn Wilson", "link": "https://stackoverflow.com/users/51007/quinn-wilson"}, "edited": false, "score": 0, "creation_date": 1517492175, "post_id": 48545085, "comment_id": 84123803, "body": "@QuinnWilson Yes you&#39;re right, normally it should be checked, but it&#39;s in the nature of the problem that c1 will always been &lt; c2. I&#39;ll double check that anyway."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9294971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4bb2139571a8e5514cd56ea75e0c91e?s=128&d=identicon&r=PG&f=1", "display_name": "haskeller", "link": "https://stackoverflow.com/users/9294971/haskeller"}, "edited": false, "score": 0, "creation_date": 1517479529, "post_id": 48557083, "comment_id": 84115555, "body": "thank you for your answer. I am using the <code>bit</code> function (in the form of <code>complementBit</code>, <code>setBit</code> and <code>clearBit</code>) which is the same as <code>shiftL</code>: <code>shiftL 1 x</code> is the same as <code>bit x</code>, and <code>complementBit x y</code> == <code>x .|. (bit y)</code> == <code>x .|. (shiftL 1 y)</code>, so I&#39;m not sure that&#39;s the problem. I will however try to replace <code>Int</code> with <code>Integer</code>."}, {"owner": {"reputation": 770, "user_id": 211158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/66756a9bcda9735c612103952c59fb3c?s=128&d=identicon&r=PG", "display_name": "Long", "link": "https://stackoverflow.com/users/211158/long"}, "reply_to_user": {"reputation": 3, "user_id": 9294971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4bb2139571a8e5514cd56ea75e0c91e?s=128&d=identicon&r=PG&f=1", "display_name": "haskeller", "link": "https://stackoverflow.com/users/9294971/haskeller"}, "edited": false, "score": 0, "creation_date": 1517484273, "post_id": 48557083, "comment_id": 84118733, "body": "@haskeller: True, my bad. As I understand it, the problem asks you to turn on/turn off a rectangular area between opposite corners (a,b), (A,B). I think you interpret the two tuples as rectangle [a..b]x[A..B] but it should be [a..A]x[b..B] (assuming a&lt;=A, b&lt;=B)"}, {"owner": {"reputation": 3, "user_id": 9294971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4bb2139571a8e5514cd56ea75e0c91e?s=128&d=identicon&r=PG&f=1", "display_name": "haskeller", "link": "https://stackoverflow.com/users/9294971/haskeller"}, "edited": false, "score": 0, "creation_date": 1517493823, "post_id": 48557083, "comment_id": 84124957, "body": "Yes that&#39;s it!! Thank you! What an oversight from my side."}], "tags": [], "owner": {"reputation": 770, "user_id": 211158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/66756a9bcda9735c612103952c59fb3c?s=128&d=identicon&r=PG", "display_name": "Long", "link": "https://stackoverflow.com/users/211158/long"}, "is_accepted": true, "score": 0, "last_activity_date": 1517493945, "last_edit_date": 1517493945, "creation_date": 1517468694, "answer_id": 48557083, "question_id": 48545085, "link": "https://stackoverflow.com/questions/48545085/trying-to-solve-advent-of-code-2015-day-06-with-a-bitlist/48557083#48557083", "title": "Trying to solve Advent of Code 2015 Day 06 with a bitlist", "body": "<ol>\n<li><p>Make sure that you don't use <code>Int</code> due to overflow. Use <code>Integer</code> instead, which can grow arbitrarily large.</p></li>\n<li><p>As I understand it, the problem asks you to turn on/turn off a rectangular area between opposite corners (a,b), (A,B). I think you interpret the two tuples as rectangle [a..b]x[A..B] but it should be [a..A]x[b..B] (assuming a&lt;=A, b&lt;=B)</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 9294971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4bb2139571a8e5514cd56ea75e0c91e?s=128&d=identicon&r=PG&f=1", "display_name": "haskeller", "link": "https://stackoverflow.com/users/9294971/haskeller"}, "is_accepted": false, "score": 0, "last_activity_date": 1517494051, "creation_date": 1517494051, "answer_id": 48564673, "question_id": 48545085, "link": "https://stackoverflow.com/questions/48545085/trying-to-solve-advent-of-code-2015-day-06-with-a-bitlist/48564673#48564673", "title": "Trying to solve Advent of Code 2015 Day 06 with a bitlist", "body": "<p>Long got it right, big oversight from my side. Here's the working code:</p>\n\n<pre><code>module Day06 where\n\nimport Data.Bits\nimport Data.List\n\nparse :: String -&gt; (Int,Int)\nparse a =\n  let (c1,c2) = break (==',') a\n  in (read c1, read (tail c2))\n\nmFlatten :: String -&gt; String -&gt; [Int]     \nmFlatten a b =\n    let (x1,y1) = parse a\n        (x2,y2) = parse b\n    in [ x + y * 1000 | x &lt;- [x1..x2], y &lt;- [y1..y2]]\n\naction :: (Bits b, Num b) =&gt; b -&gt; [[Char]] -&gt; b          \naction state instruction = case instruction of\n      [\"toggle\", a, _, b] -&gt; foldl' complementBit state $ mFlatten a b\n      [\"turn\",\"on\", a, _, b] -&gt; foldl' setBit state $ mFlatten a b\n      [\"turn\",\"off\", a, _, b] -&gt; foldl' clearBit state $ mFlatten a b\n\nmain :: IO ()\nmain = do\n  input &lt;- readFile \"input\"\n  print $ popCount $ (foldl (\\ acc x -&gt; action acc $ words x) 0 (lines input) :: Integer)\n</code></pre>\n\n<p>Thanks very much!</p>\n"}], "owner": {"reputation": 3, "user_id": 9294971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4bb2139571a8e5514cd56ea75e0c91e?s=128&d=identicon&r=PG&f=1", "display_name": "haskeller", "link": "https://stackoverflow.com/users/9294971/haskeller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 48557083, "answer_count": 2, "score": 0, "last_activity_date": 1517494051, "creation_date": 1517410510, "question_id": 48545085, "link": "https://stackoverflow.com/questions/48545085/trying-to-solve-advent-of-code-2015-day-06-with-a-bitlist", "title": "Trying to solve Advent of Code 2015 Day 06 with a bitlist", "body": "<p>I'm learning Haskell and I'm using Advent of Code 2015 to practice. I tried to solve <a href=\"http://adventofcode.com/2015/day/6\" rel=\"nofollow noreferrer\">Day06</a> with a bitlist rather than a list of coordinates and status, but it does not compute the right value and I can't understand if there's a fault in the logic or in the implementation.</p>\n\n<p>Here's the code: </p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>module Day06 where\n\nimport Data.Bits\nimport Data.Ix\nimport Data.List\n\nparse :: String -&gt; [Int]\nparse a =\n  let (c1,c2) = break (==',') a\n  in range (read c1, read (tail c2))\n\nmFlatten :: String -&gt; String -&gt; [Int]     \nmFlatten x y =\n    [ a + b * 1000 | a &lt;- parse x, b &lt;- parse y]\n\naction :: (Bits b, Num b) =&gt; b -&gt; [[Char]] -&gt; b          \naction state instruction = case instruction of\n      [\"toggle\", a, _, b] -&gt; foldl' complementBit state $ mFlatten a b\n      [\"turn\",\"on\", a, _, b] -&gt; foldl' setBit state $ mFlatten a b\n      [\"turn\",\"off\", a, _, b] -&gt; foldl' clearBit state $ mFlatten a b\n\nmain :: IO ()\nmain = do\n  input &lt;- readFile \"input\"\n  print $ popCount $ (foldl (\\ acc x -&gt; action acc $ words x) 0 (lines input) :: Integer)\n</code></pre>\n\n<p>I have a few questions:</p>\n\n<ol>\n<li>Is there a more idiomatic way to write this code?</li>\n<li>How can I improve performances?</li>\n</ol>\n\n<p>and most important </p>\n\n<ol start=\"3\">\n<li>Did I make any mistake that would cause the program to compute the wrong result? I'm thinking something such as Type conversion maybe, but it's possible I'm missing something very obvious.</li>\n</ol>\n\n<p>(To avoid having to login to have a look at the input, you can find it <a href=\"https://raw.githubusercontent.com/stevejb71/haskell-advent-of-code/master/Day6/input.txt\" rel=\"nofollow noreferrer\">here</a>)</p>\n"}, {"tags": ["haskell", "stream", "conduit"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 1, "last_activity_date": 1517596985, "creation_date": 1517596985, "answer_id": 48589019, "question_id": 48544168, "link": "https://stackoverflow.com/questions/48544168/how-to-create-json-pretty-printer-with-conduit/48589019#48589019", "title": "How to create json pretty printer with conduit", "body": "<p><code>bytestring</code> defines both a strict type (in <code>Data.ByteString</code>) &amp; a lazy type (in the module <code>Data.ByteString.Lazy</code>).  Fixing your code might by as easy as importing <code>Data.ByteString.Char8</code> instead of the lazy one.  If the libraries use a mixture, you can convert with <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Lazy.html#v:toStrict\" rel=\"nofollow noreferrer\">toStrict</a> and <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Lazy.html#v:fromStrict\" rel=\"nofollow noreferrer\">fromStrict</a></p>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 48589019, "answer_count": 1, "score": -1, "last_activity_date": 1517596985, "creation_date": 1517407821, "last_edit_date": 1517412290, "question_id": 48544168, "link": "https://stackoverflow.com/questions/48544168/how-to-create-json-pretty-printer-with-conduit", "title": "How to create json pretty printer with conduit", "body": "<p>I'm learning <code>conduit</code> and want to create a processor that would take json input from stdin, process it in some way and then output to stdout. Pretty printing have been chosen just as example.</p>\n\n<p>For now I want just decode json and print it. But seems like I have some problems with mismatched <code>Bytestring</code> types.</p>\n\n<pre><code>import Control.Monad.Trans.Resource\n   import Data.Aeson\n   import Data.Conduit\n   import qualified Data.Conduit.Combinators as CC\n   import Data.Conduit (await, yield, (.|))\n   import Data.ByteString.Lazy.Char8 as BC\n   import qualified Data.Conduit.Binary as CB\n   import Data.JsonStream.Parser hiding ((.|))\n   import qualified Data.Text as T\n   import System.IO (stdin, stdout)\n\n\n   jsonParse :: Conduit BC.ByteString IO (T.Text, Value)\n   jsonParse = doParse parseOutput\n     where\n       parseOutput :: ParseOutput (T.Text, Value)\n       parseOutput = runParser (objectItems value)\n\n       doParse :: ParseOutput (T.Text, Value) -&gt; Conduit BC.ByteString IO (T.Text, Value)\n       doParse out = case out of\n           ParseYield value newOutput -&gt; do\n               yield value\n               doParse newOutput\n           ParseNeedData cont -&gt;\n               awaitForever $ \\i -&gt; doParse (cont i)\n           ParseDone remaining -&gt; return ()\n           ParseFailed err -&gt; error err\n\n   main = runConduit $ CB.sourceHandle stdin .| jsonParse .| CC.map (encode . snd) .| CB.sinkHandle stdout\n\n\n   /tmp/some1/app/Main.hs:25:13: error:\n       \u2022 Couldn't match type \u2018Data.ByteString.Internal.ByteString\u2019\n                        with \u2018ByteString\u2019\n         NB: \u2018ByteString\u2019 is defined in \u2018Data.ByteString.Lazy.Internal\u2019\n             \u2018Data.ByteString.Internal.ByteString\u2019\n               is defined in \u2018Data.ByteString.Internal\u2019\n         Expected type: Conduit ByteString IO (T.Text, Value)\n           Actual type: ConduitM\n                          Data.ByteString.Internal.ByteString (T.Text, Value) IO ()\n       \u2022 In the expression: awaitForever $ \\ i -&gt; doParse (cont i)\n         In a case alternative:\n             ParseNeedData cont -&gt; awaitForever $ \\ i -&gt; doParse (cont i)\n         In the expression:\n           case out of\n             ParseYield value newOutput\n               -&gt; do yield value\n                     doParse newOutput\n             ParseNeedData cont -&gt; awaitForever $ \\ i -&gt; doParse (cont i)\n             ParseDone remaining -&gt; return ()\n             ParseFailed err -&gt; error err\n      |\n   25 | awaitForever $ \\i -&gt; doParse (cont i)\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n   /tmp/some1/app/Main.hs:25:34: error:\n       \u2022 Couldn't match type \u2018ByteString\u2019\n                        with \u2018Data.ByteString.Internal.ByteString\u2019\n         NB: \u2018Data.ByteString.Internal.ByteString\u2019\n               is defined in \u2018Data.ByteString.Internal\u2019\n             \u2018ByteString\u2019 is defined in \u2018Data.ByteString.Lazy.Internal\u2019\n         Expected type: ConduitM\n                          Data.ByteString.Internal.ByteString (T.Text, Value) IO ()\n           Actual type: Conduit ByteString IO (T.Text, Value)\n       \u2022 In the expression: doParse (cont i)\n         In the second argument of \u2018($)\u2019, namely \u2018\\ i -&gt; doParse (cont i)\u2019\n         In the expression: awaitForever $ \\ i -&gt; doParse (cont i)\n      |\n   25 | awaitForever $ \\i -&gt; doParse (cont i)\n      | ^^^^^^^^^^^^^^^^\n\n   /tmp/some1/app/Main.hs:29:46: error:\n       \u2022 Couldn't match type \u2018ByteString\u2019\n                        with \u2018Data.ByteString.Internal.ByteString\u2019\n         NB: \u2018Data.ByteString.Internal.ByteString\u2019\n               is defined in \u2018Data.ByteString.Internal\u2019\n             \u2018ByteString\u2019 is defined in \u2018Data.ByteString.Lazy.Internal\u2019\n         Expected type: ConduitM\n                          Data.ByteString.Internal.ByteString Data.Void.Void IO ()\n           Actual type: ConduitM ByteString Data.Void.Void IO ()\n       \u2022 In the second argument of \u2018(.|)\u2019, namely\n           \u2018jsonParse .| CC.map (encode . snd) .| CB.sinkHandle stdout\u2019\n         In the second argument of \u2018($)\u2019, namely\n           \u2018CB.sourceHandle stdin\n              .| jsonParse .| CC.map (encode . snd) .| CB.sinkHandle stdout\u2019\n         In the expression:\n           runConduit\n             $ CB.sourceHandle stdin\n                 .| jsonParse .| CC.map (encode . snd) .| CB.sinkHandle stdout\n      |\n   29 | main = runConduit $ CB.sourceHandle stdin .| jsonParse .| CC.map (encode . snd) .| CB.sinkHandle stdout\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n   /tmp/some1/app/Main.hs:29:84: error:\n       \u2022 Couldn't match type \u2018Data.ByteString.Internal.ByteString\u2019\n                        with \u2018ByteString\u2019\n         NB: \u2018ByteString\u2019 is defined in \u2018Data.ByteString.Lazy.Internal\u2019\n             \u2018Data.ByteString.Internal.ByteString\u2019\n               is defined in \u2018Data.ByteString.Internal\u2019\n         Expected type: ConduitM ByteString Data.Void.Void IO ()\n           Actual type: ConduitM\n                          Data.ByteString.Internal.ByteString Data.Void.Void IO ()\n       \u2022 In the second argument of \u2018(.|)\u2019, namely \u2018CB.sinkHandle stdout\u2019\n         In the second argument of \u2018(.|)\u2019, namely\n           \u2018CC.map (encode . snd) .| CB.sinkHandle stdout\u2019\n         In the second argument of \u2018(.|)\u2019, namely\n           \u2018jsonParse .| CC.map (encode . snd) .| CB.sinkHandle stdout\u2019\n      |\n   29 | main = runConduit $ CB.sourceHandle stdin .| jsonParse .| CC.map (encode . snd) .| CB.sinkHandle stdout\n      | ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "variadic-functions", "function-composition"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1517407813, "post_id": 48544123, "comment_id": 84083463, "body": "Yeah, that was me. Sorry for deleting it!"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1517407894, "post_id": 48544123, "comment_id": 84083516, "body": "That&#39;s alright. If you want to, you could undelete your question and I&#39;ll post my answer there. After that, I can delete this question."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 2, "creation_date": 1517425376, "post_id": 48544123, "comment_id": 84095169, "body": "@ftor I wanted to share <code>const comp = run =&gt; Object.assign(g =&gt; comp(x =&gt; g(run(x))), {run})</code>"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 1, "creation_date": 1517425401, "post_id": 48544123, "comment_id": 84095179, "body": "For others that are interested, this function is a derivative of a fun forward composition toy I made in <a href=\"https://stackoverflow.com/a/46918344/633183\">this answer</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1517428262, "post_id": 48544123, "comment_id": 84096671, "body": "@naomik I tried to get rid of the array and replace it with a purely functional computation. I really did. But I didn&#39;t recognize the pattern. And it was right in front of me! I just have the urgent feeling of learning."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1517431864, "post_id": 48544123, "comment_id": 84098510, "body": "@ftor you still did a really good job \u2013 it&#39;s really clever how the input array is built. I took a swing at <a href=\"https://repl.it/@nakyoto/variadic-comp\" rel=\"nofollow noreferrer\">variadic comp</a> and <a href=\"https://repl.it/@nakyoto/variadic-comp-2\" rel=\"nofollow noreferrer\">variadic comp 2</a> which is self-aware. I still think <a href=\"https://repl.it/@nakyoto/forward-composition\" rel=\"nofollow noreferrer\">fwd</a> makes more sense because <code>comp (f) (g) (h) .run (x)</code> isn&#39;t much better than <code>vcomp (f,g,h) (x)</code> \u2013 <code>comp (f) (g) (h)</code> and <code>vcomp (f, g, h)</code> are already independent of <code>x</code>"}], "answers": [{"comments": [{"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1517432219, "post_id": 48544124, "comment_id": 84098681, "body": "thoughtful and detailed answer, Aadit. Very nice!"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1517433240, "post_id": 48544124, "comment_id": 84099223, "body": "your approach is way more elegant than <a href=\"https://hackage.haskell.org/package/control-dotdotdot-0.1.0.1/docs/Control-DotDotDot.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/control-dotdotdot-0.1.0.1/docs/&hellip;</a> (even you need <code>run</code> at the end) good job!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1517435464, "post_id": 48544124, "comment_id": 84100323, "body": "The whole development can also be done without GADTs with <code>newtype Comp a b = Comp { run :: a -&gt; b }</code>. The <code>Comp</code> type is needed only to give a base case for the <code>Chain</code> instance resolution."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1517457949, "post_id": 48544124, "comment_id": 84106490, "body": "@phadej The <code>Control.DotDotDot</code> package doesn&#39;t do the same thing that I&#39;m doing. It defines an operator that allows you to write functions like <code>\\x y z -&gt; g (f x y z)</code> as <code>g ... f</code> whereas you&#39;d normally write it as <code>((g .) .) . f</code>. See: <a href=\"https://stackoverflow.com/q/20279306/783743\">What does (f .) . g mean in Haskell?</a>"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1517458292, "post_id": 48544124, "comment_id": 84106574, "body": "@DanielWagner Indeed, the internal representation can simply be a function. I only created a GADT in order to stay faithful to the OP&#39;s original JavaScript code."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 11, "last_activity_date": 1517456485, "last_edit_date": 1517456485, "creation_date": 1517407651, "answer_id": 48544124, "question_id": 48544123, "link": "https://stackoverflow.com/questions/48544123/how-to-write-this-polyvariadic-composition-function-in-haskell/48544124#48544124", "title": "How to write this polyvariadic composition function in Haskell?", "body": "<p>You're right. You can't build a heterogeneous list of composable functions in Haskell<sup>(1)</sup>. However, you can create your own list data type for composable functions as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n\ndata Comp a b where\n    Id   :: Comp a a\n    Comp :: Comp b c -&gt; (a -&gt; b) -&gt; Comp a c\n\nrun :: Comp a b -&gt; a -&gt; b\nrun Id         = id\nrun (Comp g f) = run g . f\n</code></pre>\n\n<p>The <code>Id</code> constructor is similar to <code>[]</code> and the <code>Comp</code> constructor is similar to <code>:</code> but with the arguments flipped.</p>\n\n<p>Next, we use the <a href=\"https://stackoverflow.com/questions/3467279/how-to-create-a-polyvariadic-haskell-function\">varargs pattern</a> to create a polyvariadic function. To do so, we define a type class:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies #-}\n\nclass Chain a b c | c -&gt; a where\n    chain :: Comp a b -&gt; c\n</code></pre>\n\n<p>Note that our state is <code>Comp b c</code> and our result is either <code>Comp b c</code> or a function that takes another function <code>(a -&gt; b)</code> as an input and composes it with our state to produce a new <code>Chain</code> called <code>r</code> with state <code>Comp a c</code>. Let's define instances for these now:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleInstances #-}\n\ninstance c ~ c' =&gt; Chain b c (Comp b c') where\n    chain = id\n\ninstance Chain a c r =&gt; Chain b c ((a -&gt; b) -&gt; r) where\n    chain g f = chain (Comp g f)\n\ncomp :: Chain b b c =&gt; c\ncomp = chain Id\n</code></pre>\n\n<p>The <code>comp</code> function can now be defined as <code>chain Id</code> (i.e. the chain with the empty list <code>Id</code> as its state). We can finally use this <code>comp</code> function as we'd do in JavaScript:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inc :: Int -&gt; Int\ninc = (+1)\n\nsqr :: Int -&gt; Int\nsqr x = x * x\n\nrepeatStr :: String -&gt; Int -&gt; String\nrepeatStr s x = concat (replicate x s)\n\nexample1 :: String\nexample1 = comp (repeatStr \"*\") inc sqr `run` 2\n\nexample2 :: String\nexample2 = comp (repeatStr \"*\") inc inc inc inc inc `run` 0\n</code></pre>\n\n<p>Putting it all together:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, MultiParamTypeClasses, FunctionalDependencies,\n             FlexibleInstances #-}\n\ndata Comp a b where\n    Id   :: Comp a a\n    Comp :: Comp b c -&gt; (a -&gt; b) -&gt; Comp a c\n\nrun :: Comp a b -&gt; a -&gt; b\nrun Id         = id\nrun (Comp g f) = run g . f\n\nclass Chain a b c | c -&gt; a where\n    chain :: Comp a b -&gt; c\n\ninstance c ~ c' =&gt; Chain b c (Comp b c') where\n    chain = id\n\ninstance Chain a c r =&gt; Chain b c ((a -&gt; b) -&gt; r) where\n    chain g f = chain (Comp g f)\n\ncomp :: Chain b b c =&gt; c\ncomp = chain Id\n\ninc :: Int -&gt; Int\ninc = (+1)\n\nsqr :: Int -&gt; Int\nsqr x = x * x\n\nrepeatStr :: String -&gt; Int -&gt; String\nrepeatStr s x = concat (replicate x s)\n\nexample1 :: String\nexample1 = comp (repeatStr \"*\") inc sqr `run` 2\n\nexample2 :: String\nexample2 = comp (repeatStr \"*\") inc inc inc inc inc `run` 0\n</code></pre>\n\n<p>As you can see, the type of <code>comp</code> is <code>Chain b b c =&gt; c</code>. To define the <code>Chain</code> type class we require <code>MultiParamTypeClasses</code> and <code>FunctionalDependencies</code>. To use it we require <code>FlexibleInstances</code>. Hence, you'll need a sophisticated JavaScript runtime type checker in order to correctly type check <code>comp</code>.</p>\n\n<hr>\n\n<p><strong>Edit:</strong> As <a href=\"https://stackoverflow.com/questions/48544123/how-to-write-this-polyvariadic-composition-function-in-haskell#comment84095169_48544123\">naomik</a> and <a href=\"https://stackoverflow.com/questions/48544123/how-to-write-this-polyvariadic-composition-function-in-haskell#comment84100323_48544124\">Daniel Wagner</a> pointed out in the comments, you can use an actual function instead of a list of composable functions as your internal representation for the state of <code>comp</code>. For example, in JavaScript:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const comp = run =&gt; Object.assign(g =&gt; comp(x =&gt; g(run(x))), {run});\n</code></pre>\n\n<p>Similarly, in Haskell:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, MultiParamTypeClasses, FunctionalDependencies,\n             FlexibleInstances #-}\n\nnewtype Comp a b = Comp { run :: a -&gt; b }\n\nclass Chain a b c | c -&gt; a where\n    chain :: Comp a b -&gt; c\n\ninstance c ~ c' =&gt; Chain b c (Comp b c') where\n    chain = id\n\ninstance Chain a c r =&gt; Chain b c ((a -&gt; b) -&gt; r) where\n    chain g f = chain (Comp (run g . f))\n\ncomp :: Chain b b c =&gt; c\ncomp = chain (Comp id)\n</code></pre>\n\n<p>Note that even though we don't use GADTs anymore we still require the <code>GADTs</code> language extension in order to use the equality constraint <code>c ~ c'</code> in the first instance of <code>Chain</code>. Also, as you can see <code>run g . f</code> has been moved from the definition of <code>run</code> into the second instance of <code>Chain</code>. Similarly, <code>id</code> has been moved from the definition of <code>run</code> into the definition of <code>comp</code>.</p>\n\n<hr>\n\n<p><sup>(1)</sup> You can use existential types to create a list of heterogeneous functions in Haskell but they won't have the additional constraint of being composable.</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 48544124, "answer_count": 1, "score": 7, "last_activity_date": 1517456485, "creation_date": 1517407651, "last_edit_date": 1517408650, "question_id": 48544123, "link": "https://stackoverflow.com/questions/48544123/how-to-write-this-polyvariadic-composition-function-in-haskell", "title": "How to write this polyvariadic composition function in Haskell?", "body": "<p><strong>Note:</strong> This is a repost of <a href=\"https://stackoverflow.com/q/48539082/783743\">another question</a>, which the author deleted. Here's the original question:</p>\n\n<hr>\n\n<p>I have this polyvariadic <code>comp</code> function in Javascript and was wondering if a similar implementation in Haskell were possible. I am mostly interested in <code>comp</code>'s type:</p>\n\n<pre><code>const comp = f =&gt; Object.assign(\n  g =&gt; comp([g].concat(f)),\n  {run: x =&gt; f.reduce((acc, h) =&gt; h(acc), x)}\n);\n\nconst inc = n =&gt; n + 1;\nconst sqr = n =&gt; n * n;\nconst repeatStr = s =&gt; n =&gt; Array(n + 1).join(s);\n\ncomp(repeatStr(\"*\")) (inc) (sqr).run(2); // \"*****\"\n\ncomp(repeatStr(\"*\"))\n  (inc)\n  (inc)\n  (inc)\n  (inc)\n  (inc).run(0); // \"*****\"\n</code></pre>\n\n<p><code>comp</code> builds up a heterogeneous array that usually doesn't have a type in Haskell. I guess such a variadic function must be polymorphic in its return type. However, this task exceeds my Haskell knowledge by far. Any clue would be helpful.</p>\n\n<p><strong>Context</strong></p>\n\n<p>I use a Javascript runtime type checker so that I can build up the array inside <code>comp</code> in a type-safe manner. It requires explicit type annotations and supports only parametric and rank-2 polymorphism.</p>\n"}, {"tags": ["haskell", "gadt", "existential-type"], "answers": [{"comments": [{"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1517408772, "post_id": 48542132, "comment_id": 84084180, "body": "I don&#39;t see how I could implement <code>instance (Alphabet l) =&gt; Show (Symbol l a) where</code> with this approach. <code>a</code> is the specific letter in that case, but it&#39;s in the type information and can&#39;t be passed as argument into showVal, can it?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1517425422, "post_id": 48542132, "comment_id": 84095192, "body": "Barring some advance in GHC that I don&#39;t know about, the type <code>Symbol ExampleLanguage Comment</code> doesn&#39;t make sense because <code>Comment</code> is a constructor of a GADT and can&#39;t be promoted."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1517435570, "post_id": 48542132, "comment_id": 84100368, "body": "GHC 8 surprised me. I added how to define <code>Symbol</code>."}, {"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1517479438, "post_id": 48542132, "comment_id": 84115500, "body": "One remaining problem: this is now legal: <code>(Terminal Comment &quot;some comment&quot;) :: Symbol ExampleLanguage Variable</code> ie if two letters have the same type, the compiler won&#39;t catch that I enter different letters in the constructor and the type"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1517435526, "last_edit_date": 1517435526, "creation_date": 1517401459, "answer_id": 48542132, "question_id": 48539233, "link": "https://stackoverflow.com/questions/48539233/type-juggling-with-gadts-at-runtime/48542132#48542132", "title": "Type juggling with GADTs at runtime", "body": "<p>Pattern match on the constructors of the GADT, not on their types</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE GADTs                 #-}\n{-# LANGUAGE TypeFamilies          #-}\n\nclass Character c where\n  showVal :: c a -&gt; a -&gt; ShowS\n\nclass Character (Letter l) =&gt; Alphabet l where\n  data family Letter l :: * -&gt; *\n\n-- Example language\ndata ExampleLanguage = ExampleLanguage\n\ninstance Alphabet ExampleLanguage where\n  data Letter ExampleLanguage a where\n    Variable :: Letter ExampleLanguage String\n    Comment :: Letter ExampleLanguage String\n    EqualSign :: Letter ExampleLanguage ()\n    Deref :: Letter ExampleLanguage ()\n\ninstance Character (Letter ExampleLanguage) where\n    showVal Variable = showString\n    showVal Comment = showString\n    showVal EqualSign = const $ showString \"=\"\n    showVal Deref = const $ showString \"*\"\n</code></pre>\n\n<p>Include this tag in the <code>Symbol</code> so you can pattern match on it later.</p>\n\n<pre><code>{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE TypeInType            #-}\n\ndata Symbol l (a :: Letter l s) where\n  Terminal :: Letter l s -&gt; s -&gt; Symbol l (a :: Letter l s)\n\ninstance (Alphabet l) =&gt; Show (Symbol l a) where\n  showsPrec d (Terminal tag val) = showVal tag val\n\ntest :: Symbol ExampleLanguage Comment\ntest = Terminal Comment \"some comment\"\n</code></pre>\n"}], "owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517435526, "creation_date": 1517392561, "last_edit_date": 1517393683, "question_id": 48539233, "link": "https://stackoverflow.com/questions/48539233/type-juggling-with-gadts-at-runtime", "title": "Type juggling with GADTs at runtime", "body": "<p>I'm designing a typed formal language, that is, a formal language where each letter has a representation of a specific type. So far, I have the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE GADTs                 #-}\n{-# LANGUAGE InstanceSigs          #-}\n{-# LANGUAGE RankNTypes            #-}\n{-# LANGUAGE ScopedTypeVariables   #-}\n{-# LANGUAGE TypeInType            #-}\n{-# LANGUAGE TypeFamilies          #-}\n\nimport Data.Kind\n\ndata Typey (s :: c) = Marker\n\nclass Character c where\n  showVal :: Typey (s :: c a) -&gt; a -&gt; ShowS\n\nclass Character (Letter l) =&gt; Alphabet l where\n  data family Letter l :: * -&gt; *\n\ndata Symbol l (a :: Letter l s) where\n  Terminal :: (Alphabet l) =&gt; s -&gt; Symbol l (a :: Letter l s)\n\ninstance (Alphabet l) =&gt; Show (Symbol l a) where\n  showsPrec d (Terminal val) = showVal (Marker :: Typey a) val\n\n-- Example language\ndata ExampleLanguage = ExampleLanguage\n\ninstance Alphabet ExampleLanguage where\n  data Letter ExampleLanguage a where\n    Variable :: Letter ExampleLanguage String\n    Comment :: Letter ExampleLanguage String\n    EqualSign :: Letter ExampleLanguage ()\n    Deref :: Letter ExampleLanguage ()\n\ninstance Character (Letter ExampleLanguage) where\n--    showVal (_ :: Typey Variable) = showString\n--    showVal (_ :: Typey Comment) = showString\n--    showVal (_ :: Typey EqualSign) = const $ showString \"=\"\n--    showVal (_ :: Typey Deref) = const $ showString \"*\"\n    showVal _ = const $ showString \"error\"\ntest :: Symbol ExampleLanguage Comment\ntest = Terminal \"some comment\"\n</code></pre>\n\n<p>You might have seen that I started to implement <code>showVal</code> but here, I have problems finishing the implementation. When I try uncommenting the lines in <code>instance Letter (Character ExampleLanguage)</code> the compiler is quick to complain:</p>\n\n<pre><code>main.hs:40:14: error:\n    \u2022 Couldn't match type \u2018a1\u2019 with \u2018()\u2019\n      \u2018a1\u2019 is a rigid type variable bound by\n        the type signature for:\n          showVal :: forall k (a :: k) a1 (s :: Character\n                                                  ExampleLanguage a1).\n                     Typey s -&gt; a1 -&gt; ShowS\n        at main.hs:38:5\n      Expected type: Typey 'EqualSign\n        Actual type: Typey s\n    \u2022 When checking that the pattern signature: Typey 'EqualSign\n        fits the type of its context: Typey s\n      In the pattern: _ :: Typey EqualSign\n      In an equation for \u2018showVal\u2019:\n          showVal (_ :: Typey EqualSign) = const $ showString \"=\"\n    \u2022 Relevant bindings include\n        showVal :: Typey s -&gt; a1 -&gt; ShowS (bound at main.hs:38:5)\n</code></pre>\n\n<p>I'm not sure I understand what the compiler is complaining about. From the GADT definition of <code>Character ExampleLanguage</code> is could be clear that I'm trying to pattern match the different constructors, outputting a different String depending on the Letter.</p>\n\n<p>How can I make this work? The data format is not fixed, feel free to modify it a little bit as long as a <code>Symbol</code> contains type information about the alphabet, letter and the letter's representational type.</p>\n"}, {"tags": ["mysql", "haskell", "hdbc"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 7739917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HVOKO.jpg?s=128&g=1", "display_name": "Lee Lee Lee", "link": "https://stackoverflow.com/users/7739917/lee-lee-lee"}, "edited": false, "score": 0, "creation_date": 1517413664, "post_id": 48539460, "comment_id": 84087796, "body": "thank you very much,and do you know how to install hdbc with stack ?"}, {"owner": {"reputation": 770, "user_id": 211158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/66756a9bcda9735c612103952c59fb3c?s=128&d=identicon&r=PG", "display_name": "Long", "link": "https://stackoverflow.com/users/211158/long"}, "reply_to_user": {"reputation": 35, "user_id": 7739917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HVOKO.jpg?s=128&g=1", "display_name": "Lee Lee Lee", "link": "https://stackoverflow.com/users/7739917/lee-lee-lee"}, "edited": false, "score": 0, "creation_date": 1517413926, "post_id": 48539460, "comment_id": 84087983, "body": "IIRC it is <code>stack install HDBC</code> (note the capitalisation)"}], "tags": [], "owner": {"reputation": 770, "user_id": 211158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/66756a9bcda9735c612103952c59fb3c?s=128&d=identicon&r=PG", "display_name": "Long", "link": "https://stackoverflow.com/users/211158/long"}, "is_accepted": true, "score": 0, "last_activity_date": 1517414450, "last_edit_date": 1517414450, "creation_date": 1517393232, "answer_id": 48539460, "question_id": 48538339, "link": "https://stackoverflow.com/questions/48538339/how-to-convert-sqlbytestring-to-string-hdbc/48539460#48539460", "title": "how to convert SqlByteString to String [HDBC]", "body": "<p><code>fromSql</code> has the type signature</p>\n\n<pre><code>fromSql :: Convertible SqlValue a =&gt; SqlValue -&gt; a\n</code></pre>\n\n<p>If you just write <code>fromSql bytestrobj</code>, Haskell cannot tell which type <code>a</code> this expression has. In order to force <code>a = ByteString</code> you can supply the type manually:</p>\n\n<pre><code>fromSql bytestrobj :: ByteString\n</code></pre>\n\n<p>Example ghci-session:</p>\n\n<pre><code>Prelude&gt; :m +Database.HDBC Data.ByteString\nPrelude Database.HDBC Data.ByteString&gt; fromSql (toSql \"Hello\") :: ByteString \n\"Hello\"\n</code></pre>\n\n<p>If the type can be inferred, then you can drop the type annotation:</p>\n\n<pre><code>Prelude Data.ByteString Database.HDBC&gt; Data.ByteString.take 4 (fromSql (toSql \"Hello\"))\n\"Hell\"\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 7739917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HVOKO.jpg?s=128&g=1", "display_name": "Lee Lee Lee", "link": "https://stackoverflow.com/users/7739917/lee-lee-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 48539460, "answer_count": 1, "score": 1, "last_activity_date": 1517414450, "creation_date": 1517389761, "last_edit_date": 1517389808, "question_id": 48538339, "link": "https://stackoverflow.com/questions/48538339/how-to-convert-sqlbytestring-to-string-hdbc", "title": "how to convert SqlByteString to String [HDBC]", "body": "<p>I want do something on mysql with hdbc , I want know how can I convert SqlByteString to String? when I try to  use <code>fromSql bytestrobj</code>, I got an error </p>\n\n<pre><code>&lt;interactive&gt;:20:1: error:\n    \u2022 Non type-variable argument\n        in the constraint: Data.Convertible.Base.Convertible SqlValue a\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall a. Data.Convertible.Base.Convertible SqlValue a =&gt; a\n*InitPriceTable Database.HDBC Database.HDBC.Types&gt; conn&lt;-connectMySQL defaultMySQLConnectInfo {mysqlUser =\"root\",mysqlPassword =\"root\",mysqlDatabase =\"linclon\"}\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1517383409, "post_id": 48536606, "comment_id": 84068247, "body": "Please <a href=\"https://stackoverflow.com/help/formatting\">format your post properly</a>. Also include the error message if you get one, or the expected and actual result if they differ."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1517389082, "post_id": 48536606, "comment_id": 84071219, "body": "Are you sure that <i>parse error on input nlist</i> is the error that you get? That&#39;s not the compiler error I get when I attempt to define those expressions in GHCi."}], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1517384473, "creation_date": 1517384473, "answer_id": 48536936, "question_id": 48536606, "link": "https://stackoverflow.com/questions/48536606/haskell-list-with-tuples/48536936#48536936", "title": "Haskell list with tuples", "body": "<p>One problem is that you're passing a list of tuples to a function that expects a single tuple.  What it appears you want to do is:</p>\n\n<ul>\n<li>Look for an entry matching the subject in the accumulating association list</li>\n<li>Get the list of students already in that subject (Or the empty list if no such association exists)</li>\n<li>Create a new list of students with the current student's name added</li>\n<li>Generate a new association consisting of the subject and the new list of students</li>\n<li>Create a new association list with the new association replacing the old</li>\n<li>Pass the new association list to the next iteration of the fold</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 770, "user_id": 211158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/66756a9bcda9735c612103952c59fb3c?s=128&d=identicon&r=PG", "display_name": "Long", "link": "https://stackoverflow.com/users/211158/long"}, "is_accepted": true, "score": 4, "last_activity_date": 1517395958, "last_edit_date": 1517395958, "creation_date": 1517395248, "answer_id": 48540126, "question_id": 48536606, "link": "https://stackoverflow.com/questions/48536606/haskell-list-with-tuples/48540126#48540126", "title": "Haskell list with tuples", "body": "<p>Write out the types! Here's an example of how I'd use types to construct the program. After that I'll show you how you can use types to fix your own program.</p>\n\n<pre><code>type Subject = String\ntype Person = String\n\ninsertOne :: (Subject, Person) -&gt; [(Subject, [Person])] -&gt; [(Subject, [Person])]\n\ninsertMany :: [(Subject, [Person])] -&gt; [(Subject, Person)] -&gt; [(Subject, [Person])]\n\nsubject :: [(Subject, [Person])]\n\nmarks :: [(Subject, Person)]\n\nnlist = insertMany subject marks\n</code></pre>\n\n<p>Clearly you have already figured out</p>\n\n<pre><code>insertMany = foldr insertOne\n</code></pre>\n\n<p>It remains to implement <code>insertOne</code>:</p>\n\n<pre><code>insertOne (subject, person) =\n  map (\\(subject',list) -&gt; if subject' == subject\n                           then (subject', person:list)\n                           else (subject', list))\n</code></pre>\n\n<p>Notice that writing out the types helps you to write a correct program.\nTo see why your program is not valid, let's try to write out the types:</p>\n\n<pre><code>f :: (Subject, [Person]) -&gt; (Subject, Person) -&gt; (Subject, [Person])\nf = (\\ (subjectname,studentname) (x,y) -&gt;\n                if(x `elem` subjectname)\n                    then (subjectname,studentname++[y])\n                else (subjectname,studentname)   )\n</code></pre>\n\n<ol>\n<li><code>x elem subjectname</code> does not make sense, because <code>subjectname</code> is not a list of <code>String</code>. It should be <code>x == subjectname</code>, otherwise this is a fine function!</li>\n<li><code>foldl f</code> would have type <code>(Subject, [Person]) -&gt; [(Subject, Person)] -&gt; [(Subject, Person)]</code></li>\n</ol>\n\n<p>This program is only capable of updating one subject, e.g.</p>\n\n<pre><code>foldl f (\"maths\",[]) marks == (\"maths\",[\"john\",\"ron\",\"sam\"])\n</code></pre>\n\n<p>What you need now is to apply this to every subject, via <code>map</code>:</p>\n\n<pre><code>map (\\x -&gt; foldl f x marks) subject == [(\"maths\",[\"john\",\"ron\",\"sam\"]),(\"science\",[\"john\"]),(\"chemistry\",[\"ron\"]),(\"french\",[])]\n</code></pre>\n"}], "owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 48540126, "answer_count": 2, "score": 2, "last_activity_date": 1517395958, "creation_date": 1517383188, "last_edit_date": 1517384081, "question_id": 48536606, "link": "https://stackoverflow.com/questions/48536606/haskell-list-with-tuples", "title": "Haskell list with tuples", "body": "<pre><code>subject = [(\"maths\",[]),(\"science\",[]),(\"chemistry\",[]),(\"french\",[])]\n\nmarks = [(\"science\",\"john\"),(\"maths\",\"john\"),(\"chemistry\",\"ron\"),(\"maths\",\"ron\"),(\"maths\",\"sam\")]\n</code></pre>\n\n<blockquote>\n  <p>output as </p>\n</blockquote>\n\n<pre><code>[(\"maths\",[\"john\",\"ron\",\"sam\"]),(\"science\",[\"john\"]),(\"chemistry\",[\"ron\"]),(\"french\",[])]\n</code></pre>\n\n<p>my attempt:</p>\n\n<pre><code>nlist =  foldl'(\\ (subjectname,studentname) (x,y) -&gt;\n                    if(x `elem` subjectname)\n                        then (subjectname,studentname++[y])\n                    else (subjectname,studentname)   ) subject marks\n</code></pre>\n\n<p>can anyone tell me what im doing wrong here. I'm getting error: parse error on input nlist</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1517425862, "post_id": 48536275, "comment_id": 84095413, "body": "Does it work when you compile instead of interpreting it?"}, {"owner": {"reputation": 83, "user_id": 2619481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9246a39da9613dd7484ceffa4e07885?s=128&d=identicon&r=PG", "display_name": "Lyt_Seeker", "link": "https://stackoverflow.com/users/2619481/lyt-seeker"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1517493239, "post_id": 48536275, "comment_id": 84124555, "body": "@epsilonhalbe, yes it does!"}, {"owner": {"reputation": 83, "user_id": 2619481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9246a39da9613dd7484ceffa4e07885?s=128&d=identicon&r=PG", "display_name": "Lyt_Seeker", "link": "https://stackoverflow.com/users/2619481/lyt-seeker"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1517493677, "post_id": 48536275, "comment_id": 84124859, "body": "@epsilonhalbe, yes it does!     e:\\dir\\reset\\as&gt;stack ghc a.hs     stack ghc a.hs     [1 of 1] Compiling Main             ( a.hs, a.o )     Linking a.exe ...               e:\\HiHenry\\reset\\as&gt;     e:\\HiHenry\\reset\\as&gt;a.exe     a.exe     01/Feb/2018:15:59:07 +0530 [Info#yesod-core] Application launched @(yesod-core-1.4.37.3-JVciWQSLH8J1mylGVdkmic:Yesod.Core.Disp&zwnj;&#8203;atch .\\Yesod\\Core\\Dispatch.hs:166:11)     127.0.0.1 - - [01/Feb/2018:15:59:50 +0530] &quot;GET / HTTP/1.1&quot; 200 82 &quot;&quot;"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1517494032, "post_id": 48536275, "comment_id": 84125114, "body": "Does GHCi work <i>at all</i> (without a module like <code>a.hs</code>)?"}, {"owner": {"reputation": 83, "user_id": 2619481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9246a39da9613dd7484ceffa4e07885?s=128&d=identicon&r=PG", "display_name": "Lyt_Seeker", "link": "https://stackoverflow.com/users/2619481/lyt-seeker"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1517496664, "post_id": 48536275, "comment_id": 84126968, "body": "@leftaroundabout, yes it does, a simple hello world program works fine."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517609872, "post_id": 48536275, "comment_id": 84180537, "body": "Often antivirus software can cause problems with GHC-generated code. In particular <code>HitmanPro</code> is a known offender. You may want to try after disabling such AV."}, {"owner": {"reputation": 83, "user_id": 2619481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9246a39da9613dd7484ceffa4e07885?s=128&d=identicon&r=PG", "display_name": "Lyt_Seeker", "link": "https://stackoverflow.com/users/2619481/lyt-seeker"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517638421, "post_id": 48536275, "comment_id": 84186100, "body": "hey @sclv, tried to disable Symantec end point protection on my machine and retry, still the same error. I don&#39;t have hitmanpro installed."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517719451, "post_id": 48536275, "comment_id": 84206141, "body": "one other workaround is the <code>-fexternal-interpreter</code> flag. Not sure what else could be at issue..."}], "owner": {"reputation": 83, "user_id": 2619481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9246a39da9613dd7484ceffa4e07885?s=128&d=identicon&r=PG", "display_name": "Lyt_Seeker", "link": "https://stackoverflow.com/users/2619481/lyt-seeker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 245, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1517513954, "creation_date": 1517381945, "last_edit_date": 1517513954, "question_id": 48536275, "link": "https://stackoverflow.com/questions/48536275/access-violation-error-while-trying-to-run-a-simple-yesod-program-on-windows-10", "title": "Access violation error While trying to run a simple Yesod program on Windows 10", "body": "<p>I am trying to run a few basic Haskell snippets on a windows 10 machine with GHC Version 8.2.2 via Stack tool. I get the following access violation error:</p>\n\n<pre><code>e:\\reset\\as&gt;stack runghc a.hs\nstack runghc a.hs\nAccess violation in generated code when executing data at ffffffffac0039e0\n</code></pre>\n\n<p>the contents of \"a.hs\" are: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE QuasiQuotes     #-}\n{-# LANGUAGE TemplateHaskell     #-}\n{-# LANGUAGE TypeFamilies     #-}\n\nimport Yesod\n\ndata HelloWorld = HelloWorld\n\nmkYesod \"HelloWorld\" [parseRoutes|\n/ HomeR GET\n|]\n\ninstance Yesod HelloWorld\n\ngetHomeR :: Handler Html\ngetHomeR = defaultLayout [whamlet|Hello World!|]\n\nmain :: IO()\nmain = warp 3000 HelloWorld\n</code></pre>\n\n<p>I was able to get a few results in return to my google-fu, but I don't think there is a proper solution for this version of ghci:</p>\n\n<p>temporary solution: <a href=\"https://stackoverflow.com/questions/48232637/haskell-stack-access-violation-error-during-build\">Haskell-Stack: Access violation error during build</a></p>\n\n<p>violation on GHC 8.0.2: <a href=\"https://github.com/hedgehogqa/haskell-hedgehog/issues/111\" rel=\"nofollow noreferrer\">https://github.com/hedgehogqa/haskell-hedgehog/issues/111</a></p>\n\n<p>works while compiling to dll: <a href=\"https://stackoverflow.com/questions/47849032/access-violation-in-ghci\">Access violation in GHCI</a></p>\n\n<p>Is there an explanation for why this error occurs, and how I can avoid it?</p>\n\n<p>Edit: @epsilonhable asked if compiling works; I tried it, it compiles and runs with no issues.</p>\n\n<pre><code>e:\\dir\\reset\\as&gt;stack ghc a.hs\nstack ghc a.hs\n[1 of 1] Compiling Main             ( a.hs, a.o )\nLinking a.exe ...\n\n\ne:\\HiHenry\\reset\\as&gt;\ne:\\HiHenry\\reset\\as&gt;a.exe\na.exe\n01/Feb/2018:15:59:07 +0530 [Info#yesod-core] Application launched @(yesod-core-1.4.37.3-JVciWQSLH8J1mylGVdkmic:Yesod.Core.Dispatch .\\Yesod\\Core\\Dispatch.hs:166:11)\n127.0.0.1 - - [01/Feb/2018:15:59:50 +0530] \"GET / HTTP/1.1\" 200 82 \"\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36\"\n127.0.0.1 - - [01/Feb/2018:15:59:50 +0530] \"GET /favicon.ico HTTP/1.1\" 404 118 \"http://127.0.0.1:3001/\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36\"\n</code></pre>\n\n<p>Running it via interpreter(stack runghc a.hs) still results in an access violation.</p>\n"}, {"tags": ["haskell", "list-comprehension"], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 2, "last_activity_date": 1517373407, "creation_date": 1517373407, "answer_id": 48534561, "question_id": 48534309, "link": "https://stackoverflow.com/questions/48534309/efficiency-of-list-comprehensions-in-haskell/48534561#48534561", "title": "efficiency of list comprehensions in Haskell", "body": "<p>The desugaring does produce different code. There are three implementations you're considering here. I'll show what each of them would look like without the list comprehension.</p>\n\n<pre><code>-- With no let / where\nsumOfSquares xs = [(mean xs - realToFrac x) ^^ 2 | x &lt;- xs]\nsumOfSquares xs = map (\\x -&gt; (mean xs - realToFrac x) ^^ 2) xs\n\n-- With let inside the comprehension\nsumOfSquares xs = [(m - realToFrac x) ^^ 2 | x &lt;- xs, let m = mean xs]\nsumOfSquares xs = map (\\x -&gt; let m = mean xs in (m - realToFrac x) ^^ 2) xs\n\n-- With where outside the comprehension\nsumOfSquares xs = [(m - realToFrac x) ^^ 2 | x &lt;- xs] where m = mean xs\nsumOfSquares xs = map (\\x -&gt; (m - realToFrac x) ^^ 2) xs where m = mean xs\n</code></pre>\n\n<p>So the first two are basically equivalent. If you have the world's simplest compiler (or you turn off optimizations), you'll get fairly inefficient code that recomputes the mean every iteration. The third avoids this completely, by actually putting the computation outside the <code>where</code> block. It doesn't <em>guarantee</em> that the value won't be recomputed every step (Haskell is free to compute things however it so chooses so long as the result behaves equivalently to lazy evaluation), but it does improve the odds if your compiler is not very smart.</p>\n\n<p>However, <em>realistically</em>, GHC (and most other compilers) will perform what's called <em>float-out optimization</em>. Basically, if it sees a <code>let</code> block that it can move outside of a repeated computation, it is free to do so since there are no possible side effects that would change in doing so. In general, GHC will take expressions of the form</p>\n\n<pre><code>\\x -&gt; let y = something in f x y\n</code></pre>\n\n<p>and convert them to</p>\n\n<pre><code>let y = something in \\x -&gt; f x y\n</code></pre>\n\n<p>This optimization is allowed so long as <code>x</code> does not appear as a free variable inside <code>something</code>, and most compilers are fairly smart about doing this, so you shouldn't have much to worry about.</p>\n\n<p>There's an <a href=\"https://stackoverflow.com/a/12657991/2288659\">excellent StackOverflow answer</a> about a lot of common optimizations performed by GHC, from which this answer is partially inspired. I suggest checking it out if you want to learn more about efficiency in Haskell.</p>\n"}], "owner": {"reputation": 61, "user_id": 6088504, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nc4h0.jpg?s=128&g=1", "display_name": "King Kira", "link": "https://stackoverflow.com/users/6088504/king-kira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1517373407, "creation_date": 1517371594, "last_edit_date": 1517372438, "question_id": 48534309, "link": "https://stackoverflow.com/questions/48534309/efficiency-of-list-comprehensions-in-haskell", "title": "efficiency of list comprehensions in Haskell", "body": "<p>I've been learning Haskell and I made a few statistical functions that would work on lists of either <code>Int</code> or <code>Float</code> types.<br>\nHere are two examples:  </p>\n\n<pre><code>mean :: (Real a, Floating b) =&gt; [a] -&gt; b\nmean xs = realToFrac (sum xs) / genericLength xs\n\nsumOfSquares :: (Real a, Floating b) =&gt; [a] -&gt; b\nsumOfSquares xs = [(mean xs - realToFrac x) ^^ 2 | x &lt;- xs]\n</code></pre>\n\n<p>However, I am now wondering if I could improve the runtime by writing <code>sumOfSquares</code> differently. Like this:  </p>\n\n<pre><code>sumOfSquares xs = [(m - realToFrac x) ^^ 2 | x &lt;- xs] where m = mean xs\n</code></pre>\n\n<p>or like this:  </p>\n\n<pre><code>sumOfSquares xs = [(m - realToFrac x) ^^ 2 | x &lt;- xs, let m = mean xs]\n</code></pre>\n\n<p>I don't know how Haskell handles behind the screen. In the original version, does the computer calculate <code>mean xs</code> for each entry in <code>xs</code>? I'm assuing Haskell doesn't optimize comprehensions in the background. Am I wrong?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 7, "creation_date": 1517358237, "post_id": 48532397, "comment_id": 84060824, "body": "<code>default-extensions:</code> field in Cabal"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1517424187, "post_id": 48532397, "comment_id": 84094526, "body": "@user2407038, I think any mention of that feature should probably also explain why many people (such as myself) are generally opposed. It makes it impossible to see from the text of each module which extensions are in play. That can be quite confusing!"}], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 3, "last_activity_date": 1517418927, "creation_date": 1517418927, "answer_id": 48547827, "question_id": 48532397, "link": "https://stackoverflow.com/questions/48532397/how-to-enable-language-extensions-pragmas-project-wide-by-default/48547827#48547827", "title": "How to enable language extensions / pragmas project wide by default?", "body": "<p>As @user2407038 said in the comments, you can use the <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#pkg-field-default-extensions\" rel=\"nofollow noreferrer\"><code>default-extensions</code></a> field in your <code>&lt;project&gt;.cabal</code> file. </p>\n\n<p>If you wanted to have <code>OverloadStrings</code> and <code>GADTs</code> in all of your modules in the project, you would list it in relevant section of your cabal file (i.e. if you want it for all of your library files, put it in library). </p>\n\n<p>For example:</p>\n\n<pre><code>-- &lt;project&gt;.cabal\n...\nlibrary\n  hs-source-dirs:       src\n  default-extensions:   GADTs\n                      , OverloadedStrings \n  ...\n</code></pre>\n\n<p>If you are using a <code>package.yaml</code> configuration file to generate your <code>&lt;project&gt;.cabal</code> file, you can also specify this field there. </p>\n\n<pre><code>-- package.yaml\nlibrary:\n  source-dirs: src\n  default-extensions:\n    - OverloadedStrings\n    - GADTs\n  exposed-modules:\n    - MyModule\n  ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 73, "user_id": 13203601, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MQjHaBaC-HA/AAAAAAAAAAI/AAAAAAAAAAA/AAKWJJOZrpl5kmxrBvxWBPrun79v_itZEg/photo.jpg?sz=128", "display_name": "Adam Wall", "link": "https://stackoverflow.com/users/13203601/adam-wall"}, "is_accepted": false, "score": 0, "last_activity_date": 1614465288, "creation_date": 1614465288, "answer_id": 66404079, "question_id": 48532397, "link": "https://stackoverflow.com/questions/48532397/how-to-enable-language-extensions-pragmas-project-wide-by-default/66404079#66404079", "title": "How to enable language extensions / pragmas project wide by default?", "body": "<p>Wow this is annoying. The error message from cabal literally says to use 'extensions:', but you have to use 'default-extensions:'...</p>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 868, "favorite_count": 0, "accepted_answer_id": 48547827, "answer_count": 2, "score": 4, "last_activity_date": 1614465288, "creation_date": 1517356807, "last_edit_date": 1588791578, "question_id": 48532397, "link": "https://stackoverflow.com/questions/48532397/how-to-enable-language-extensions-pragmas-project-wide-by-default", "title": "How to enable language extensions / pragmas project wide by default?", "body": "<p>Is there a way to put <code>{-# LANGUAGE &lt;feature&gt; #-}</code> pragmas in either the:</p>\n\n<ul>\n<li><code>&lt;project&gt;.cabal</code>, or</li>\n<li><code>stack.yaml</code></li>\n</ul>\n\n<p>file, to avoid repeating the same header code in every <em>*.hs</em> file of a project?</p>\n"}, {"tags": ["json", "haskell", "numbers", "maybe"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1517348162, "post_id": 48530900, "comment_id": 84057223, "body": "What should happen in case it is <code>Nothing</code> (for instance because the JSON is invalid, etc.)?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1517349588, "post_id": 48530900, "comment_id": 84057915, "body": "Yes, you need to pattern match and handle the <code>Nothing</code> case (or e.g. use a helper function like <code>maybe</code>)"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1517349752, "post_id": 48530900, "comment_id": 84057994, "body": "If the value will never be <code>Nothing</code>, you can use <code>^?!</code> instead of <code>^?</code>."}], "owner": {"reputation": 353, "user_id": 1485168, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8JMSb.jpg?s=128&g=1", "display_name": "David B.", "link": "https://stackoverflow.com/users/1485168/david-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 383, "favorite_count": 0, "closed_date": 1517350454, "answer_count": 0, "score": 0, "last_activity_date": 1517348089, "creation_date": 1517348089, "question_id": 48530900, "link": "https://stackoverflow.com/questions/48530900/just-number-in-haskell-get-the-value", "closed_reason": "Duplicate", "title": "Just Number in Haskell - get the value", "body": "<p>I looked into a way to get the raw value of a value that's in a JSON response body that I'm getting from an API.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Lens\nimport Data.Aeson.Lens (_String, key)\nimport Data.Aeson.Lens (_Number, key)\nimport Network.Wreq\n\nconditionsQuery2 :: String -&gt; String\nconditionsQuery2 company =\n\"https://api.iextrading.com/1.0/stock/\" ++ company ++ \"/quote\"\n\nmain :: IO()\nmain = do\n    print \"What's the company name?\"\n    company &lt;- getLine\n    r &lt;- get (conditionsQuery2 company)\n    putStrLn \"The full company's name is: \"\n    print $ r ^. responseBody . key \"companyName\" . _String \n    putStrLn \"And the stock price is: \"\n    print $ r ^? responseBody . key \"latestPrice\" . _Number\n</code></pre>\n\n<p>The issue I'm getting is with the last line <code>print $ r ^? responseBody . key \"latestPrice\" . _Number</code> because the value I'm getting is: <code>Just 166.9</code> for a given stock price (just an example). I understand that there is a <code>Maybe</code> type in Haskell, but in the context of getting a number value from a JSON response, is there a way to easily access that value? Or do I need to write something along the lines of what's described <a href=\"https://stackoverflow.com/questions/28706843/getting-a-value-from-maybe-a-return-type-in-haskell\">here</a> with <code>Just a -&gt; putStrLn $ \"the value: \" ++ show a</code>?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "error-handling", "maybe", "either"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1517347543, "creation_date": 1517347543, "answer_id": 48530774, "question_id": 48530625, "link": "https://stackoverflow.com/questions/48530625/either-and-inner-maybe-error-handling/48530774#48530774", "title": "Either and inner Maybe error handling", "body": "<p>Perhaps not the most simpel function, but an attempt using monads and the <code>Maybe</code> <em>catamorphism</em> like:</p>\n\n<pre><code>import Data.Maybe(maybe)\n\neitherMaybeHandle :: a -&gt; Either a (Maybe b) -&gt; Either a b\neitherMaybeHandle err = (&gt;&gt;= maybe (Left err) Right)\n</code></pre>\n\n<p>We can even drop the <code>err</code> parameter, and write it like:</p>\n\n<pre><code>eitherMaybeHandle :: a -&gt; Either a (Maybe b) -&gt; Either a b\neitherMaybeHandle = (=&lt;&lt;) . flip maybe Right . Left\n</code></pre>\n\n<p>Since <code>Either a</code> is a monad instance, we can thus use <code>&gt;&gt;=</code>. In that case, we leave the <code>Left x</code> untouched, and the <code>Right x</code> is passed through the function.</p>\n\n<p>As function we use <code>maybe :: a -&gt; (b -&gt; a) -&gt; Maybe b -&gt; a</code>. So we map <code>Nothing</code> on <code>Left err</code>, and we use <code>Right</code> as a function to transform <code>Just x</code>, in <code>Right x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1517348616, "creation_date": 1517348616, "answer_id": 48531022, "question_id": 48530625, "link": "https://stackoverflow.com/questions/48530625/either-and-inner-maybe-error-handling/48531022#48531022", "title": "Either and inner Maybe error handling", "body": "<p>The original code is already fine. You might want to consider making it occupy fewer lines by keeping each branch on the same line.</p>\n\n<p>Otherwise, just for the sake of alternatives, you could use:</p>\n\n<pre><code>eitherMaybeHandle :: String -&gt; Either String (Maybe a) -&gt; Either String a\neitherMaybeHandle _   (Left e)         = Left e\neitherMaybeHandle err (Right Nothing)  = Left err\neitherMaybeHandle _   (Right (Just a)) = Right a\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>eitherMaybeHandle :: String -&gt; Either String (Maybe a) -&gt; Either String a\neitherMaybeHandle _   (Left e)  = Left e\neitherMaybeHandle err (Right x) = maybe (Left err) Right x\n</code></pre>\n\n<p>I'd consider the original code to be more readable than the latter alternative.</p>\n"}, {"comments": [{"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 1, "creation_date": 1517428313, "post_id": 48531791, "comment_id": 84096706, "body": "Why does it make sense to convert <code>Either a (Maybe b)</code> (which tells a story: you will definitely get an <code>a</code>, but if there would be <code>b</code>, it gonna be preferred) to the quite confusing <code>Maybe (Either a b)</code>, telling <b>totally different</b> story: you might get something or not. Am new to Haskell, but not to FP. So just curious why you consider that one as a good solution? (Anyway, +1)."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1517436990, "post_id": 48531791, "comment_id": 84101030, "body": "@SerejaBobolubov I consider it a good solution because it&#39;s short and relatively readable if you&#39;re familiar with these functions. The other answers here are also pretty readable. In terms of their story, <code>Either a (Maybe b)</code> and <code>Maybe (Either a b)</code> are isomorphic (meaning they contain the same amount of data), but <code>Maybe</code> has more built-in functions."}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1517514492, "post_id": 48531791, "comment_id": 84137666, "body": "No they are not. Having <code>Maybe</code> might actually mean that you got nothing. In such a way you can NOT go back to <code>a</code> which was guaranteed by the <code>Either a (Maybe b)</code>."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1517514569, "post_id": 48531791, "comment_id": 84137718, "body": "@SerejaBobolubov Using <code>Either a (Maybe b)</code>, you can also have nothing by using <code>Right Nothing</code>. Since there&#39;s a one to one mapping between every possible value, they&#39;re isomorphic."}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1517514650, "post_id": 48531791, "comment_id": 84137761, "body": "one-to-one is an injective mapping. you need surjection as well to get a bijection (which is &#39;isomorphism&#39;)."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1517514773, "post_id": 48531791, "comment_id": 84137817, "body": "@SerejaBobolubov The one to one relationship goes both ways, so it&#39;s bijective as well. Could you give a counter-example?"}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1517514862, "post_id": 48531791, "comment_id": 84137871, "body": "bool -&gt; int might be one-to-one, but in such a case there are 2^32 - 2 integers, having which you can&#39;t go back. checkout carefully what is surjection (else known as &#39;onto&#39; mapping)."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1517515005, "post_id": 48531791, "comment_id": 84137963, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/164367/discussion-between-4castle-and-sereja-bobolubov\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 5, "last_activity_date": 1517352708, "creation_date": 1517352708, "answer_id": 48531791, "question_id": 48530625, "link": "https://stackoverflow.com/questions/48530625/either-and-inner-maybe-error-handling/48531791#48531791", "title": "Either and inner Maybe error handling", "body": "<p>First, you can use <code>sequence</code> to turn an <code>Either a (Maybe b)</code> into a <code>Maybe (Either a b)</code>. Then you can apply <code>fromMaybe</code> to the result along with your value of type <code>a</code> in order to get an <code>Either a b</code>.</p>\n\n<pre><code>import Data.Maybe (fromMaybe)\n\neitherMaybeHandle :: a -&gt; Either a (Maybe b) -&gt; Either a b\neitherMaybeHandle err = fromMaybe (Left err) . sequence\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1517433492, "post_id": 48549611, "comment_id": 84099360, "body": "Note that as simple as <code>note x = maybe (Left x) Right</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1517434768, "post_id": 48549611, "comment_id": 84099985, "body": "@phadej Definitely. But often when I find myself needing to promote <code>Maybe</code> to <code>Either</code>, I find myself needing to do many other kinds of translations between error-reporting mechanisms nearby, so dragging in the whole package is frequently worth it."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1517434851, "last_edit_date": 1517434851, "creation_date": 1517425430, "answer_id": 48549611, "question_id": 48530625, "link": "https://stackoverflow.com/questions/48530625/either-and-inner-maybe-error-handling/48549611#48549611", "title": "Either and inner Maybe error handling", "body": "<p>I would use the <a href=\"http://hackage.haskell.org/package/errors\" rel=\"nofollow noreferrer\"><code>errors</code></a> package, which offers</p>\n\n<pre><code>note :: a -&gt; Maybe b -&gt; Either a b\n</code></pre>\n\n<p>which can be combined with another <code>Either</code> with the <code>Monad</code> instance:</p>\n\n<pre><code>eitherMaybeHandle :: e -&gt; Either e (Maybe a) -&gt; Either e a\neitherMaybeHandle err act = act &gt;&gt;= note err\n</code></pre>\n"}], "owner": {"reputation": 68390, "user_id": 55246, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c25ae0f8b2c34d0766717abab05b2efb?s=128&d=identicon&r=PG", "display_name": "Sridhar Ratnakumar", "link": "https://stackoverflow.com/users/55246/sridhar-ratnakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 650, "favorite_count": 0, "accepted_answer_id": 48531791, "answer_count": 4, "score": 1, "last_activity_date": 1517434851, "creation_date": 1517346879, "question_id": 48530625, "link": "https://stackoverflow.com/questions/48530625/either-and-inner-maybe-error-handling", "title": "Either and inner Maybe error handling", "body": "<p>Is there a Haskell pattern that obviates the writing of this custom function? The idea being to handle the Nothing from Maybe as an error (as part of the wrapping Either):</p>\n\n<pre><code>eitherMaybeHandle :: String -&gt; Either String (Maybe a) -&gt; Either String a\neitherMaybeHandle err = \\case\n  Left e -&gt;\n    Left e\n  Right Nothing -&gt;\n    Left err\n  Right (Just a) -&gt;\n    Right a\n</code></pre>\n"}, {"tags": ["haskell", "cuda", "gpu", "ffi", "accelerate-haskell"], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 6716325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e4f4da0d0954eba69cf06d7df00480e?s=128&d=identicon&r=PG", "display_name": "tmcdonell", "link": "https://stackoverflow.com/users/6716325/tmcdonell"}, "is_accepted": true, "score": 1, "last_activity_date": 1518067174, "creation_date": 1518067174, "answer_id": 48678107, "question_id": 48526958, "link": "https://stackoverflow.com/questions/48526958/how-to-use-a-cuda-deviceptr-as-an-accelerate-array/48678107#48678107", "title": "how to use a cuda DevicePtr as an accelerate Array", "body": "<p>Actually, I am surprised that the above worked as well as it did already; I couldn't replicate that.</p>\n\n<p>One of the problems here is that device memory is implicitly associated with an execution context; pointers in one context are not valid in a different context, even on the same GPU (unless you explicitly enable peer memory access between those contexts).</p>\n\n<p>So, there are actually two components to this problem:</p>\n\n<ol>\n<li>Import the foreign data into Accelerate in a way it understands; and</li>\n<li>Make sure that subsequent Accelerate computations are executed in a context which has access to this memory.</li>\n</ol>\n\n<h2>solution</h2>\n\n<p>Here is the C code we'll use to generate data on the GPU:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;cuda.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nCUdeviceptr generate_gpu_data()\n{\n  CUresult    status = CUDA_SUCCESS;\n  CUdeviceptr d_arr;\n\n  const int N = 32;\n  float h_arr[N];\n\n  for (int i = 0; i &lt; N; ++i) {\n    h_arr[i] = (float)i;\n  }\n\n  status = cuMemAlloc(&amp;d_arr, N*sizeof(float));\n  if (CUDA_SUCCESS != status) {\n    fprintf(stderr, \"cuMemAlloc failed (%d)\\n\", status);\n    exit(1);\n  }\n\n  status = cuMemcpyHtoD(d_arr, (void*) h_arr, N*sizeof(float));\n  if (CUDA_SUCCESS != status) {\n    fprintf(stderr, \"cuMemcpyHtoD failed (%d)\\n\", status);\n    exit(1);\n  }\n\n  return d_arr;\n}\n</code></pre>\n\n<p>And the Haskell/Accelerate code which uses it:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nimport Data.Array.Accelerate                                        as A\nimport Data.Array.Accelerate.Array.Sugar                            as Sugar\nimport Data.Array.Accelerate.Array.Data                             as AD\nimport Data.Array.Accelerate.Array.Remote.LRU                       as LRU\n\nimport Data.Array.Accelerate.LLVM.PTX                               as PTX\nimport Data.Array.Accelerate.LLVM.PTX.Foreign                       as PTX\n\nimport Foreign.CUDA.Driver                                          as CUDA\n\nimport Text.Printf\n\nmain :: IO ()\nmain = do\n  -- Initialise CUDA and create an execution context. From this we also create\n  -- the context that our Accelerate programs will run in.\n  --\n  CUDA.initialise []\n  dev &lt;- CUDA.device 0\n  ctx &lt;- CUDA.create dev []\n  ptx &lt;- PTX.createTargetFromContext ctx\n\n  -- When created, a context becomes the active context, so when we call the\n  -- foreign function this is the context that it will be executed within.\n  --\n  fp  &lt;- c_generate_gpu_data\n\n  -- To import this data into Accelerate, we need both the host-side array\n  -- (typically the only thing we see) and then associate this with the existing\n  -- device memory (rather than allocating new device memory automatically).\n  --\n  -- Note that you are still responsible for freeing the device-side data when\n  -- you no longer need it.\n  --\n  arr@(Array _ ad) &lt;- Sugar.allocateArray (Z :. 32) :: IO (Vector Float)\n  LRU.insertUnmanaged (ptxMemoryTable ptx) ad fp\n\n  -- NOTE: there seems to be a bug where we haven't recorded that the host-side\n  -- data is dirty, and thus needs to be filled in with values from the GPU _if_\n  -- those are required on the host. At this point we have the information\n  -- necessary to do the transfer ourselves, but I guess this should really be\n  -- fixed...\n  --\n  -- CUDA.peekArray 32 fp (AD.ptrsOfArrayData ad)\n\n  -- An alternative workaround to the above is this no-op computation (this\n  -- consumes no additional host or device memory, and executes no kernels).\n  -- If you never need the values on the host, you could ignore this step.\n  --\n  let arr' = PTX.runWith ptx (use arr)\n\n  -- We can now use the array as in a regular Accelerate computation. The only\n  -- restriction is that we need to `run*With`, so that we are running in the\n  -- context of the foreign memory.\n  --\n  let r = PTX.runWith ptx $ A.fold (+) 0 (use arr')\n\n  printf \"array is: %s\\n\" (show arr')\n  printf \"sum is:   %s\\n\" (show r)\n\n  -- Free the foreign memory (again, it is not managed by Accelerate)\n  --\n  CUDA.free fp\n\n\nforeign import ccall unsafe \"generate_gpu_data\"\n  c_generate_gpu_data :: IO (DevicePtr Float)\n</code></pre>\n"}], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 48678107, "answer_count": 1, "score": 1, "last_activity_date": 1518067174, "creation_date": 1517332213, "question_id": 48526958, "link": "https://stackoverflow.com/questions/48526958/how-to-use-a-cuda-deviceptr-as-an-accelerate-array", "title": "how to use a cuda DevicePtr as an accelerate Array", "body": "<p>I'm trying to use a <a href=\"https://hackage.haskell.org/package/cuda\" rel=\"nofollow noreferrer\">cuda</a> <a href=\"https://hackage.haskell.org/package/cuda-0.9.0.0/docs/Foreign-CUDA-Ptr.html#t:DevicePtr\" rel=\"nofollow noreferrer\"><code>DevicePtr</code></a> (which is called a <a href=\"http://docs.nvidia.com/cuda/cuda-driver-api/group__CUDA__TYPES.html#group__CUDA__TYPES_1g5e264ce2ad6a38761e7e04921ef771de\" rel=\"nofollow noreferrer\"><code>CUdeviceptr</code></a> in CUDA-land) returned from foreign code as an <a href=\"https://hackage.haskell.org/package/accelerate\" rel=\"nofollow noreferrer\">accelerate</a> <a href=\"https://hackage.haskell.org/package/accelerate-1.1.1.0/docs/Data-Array-Accelerate.html#t:Array\" rel=\"nofollow noreferrer\"><code>Array</code></a> with <a href=\"https://hackage.haskell.org/package/accelerate-llvm-ptx\" rel=\"nofollow noreferrer\">accelerate-llvm-ptx</a>.</p>\n\n<p>The code I've written below somewhat works:</p>\n\n<pre><code>import Data.Array.Accelerate\n       (Acc, Array, DIM1, Z(Z), (:.)((:.)), use)\nimport qualified Data.Array.Accelerate as Acc\nimport Data.Array.Accelerate.Array.Data\n       (GArrayData(AD_Float), unsafeIndexArrayData)\nimport Data.Array.Accelerate.Array.Sugar\n       (Array(Array), fromElt, toElt)\nimport Data.Array.Accelerate.Array.Unique\n       (UniqueArray, newUniqueArray)\nimport Data.Array.Accelerate.LLVM.PTX (run)\nimport Foreign.C.Types (CULLong(CULLong))\nimport Foreign.CUDA.Driver (DevicePtr(DevicePtr))\nimport Foreign.ForeignPtr (newForeignPtr_)\nimport Foreign.Ptr (intPtrToPtr)\n\n-- A foreign function that uses cuMemAlloc() and cuMemCpyHtoD() to\n-- create data on the GPU.  The CUdeviceptr (initialized by cuMemAlloc)\n-- is returned from this function.  It is a CULLong in Haskell.\n--\n-- The data on the GPU is just a list of the 10 floats\n-- [0.0, 1.0, 2.0, ..., 8.0, 9.0]\nforeign import ccall \"mytest.h mytestcuda\"\n  cmyTestCuda :: IO CULLong\n\n-- | Convert a 'CULLong' to a 'DevicePtr'.\n--\n-- A 'CULLong' is the type of a CUDA @CUdeviceptr@.  This function\n-- converts a raw 'CULLong' into a proper 'DevicePtr' that can be\n-- used with the cuda Haskell package.\ncullongToDevicePtr :: CULLong -&gt; DevicePtr a\ncullongToDevicePtr = DevicePtr . intPtrToPtr . fromIntegral\n\n-- | This function calls 'cmyTestCuda' to get the 'DevicePtr', and\n-- wraps that up in an accelerate 'Array'.  It then uses this 'Array'\n-- in an accelerate computation.\naccelerateWithDataFromC :: IO ()\naccelerateWithDataFromC = do\n  res &lt;- cmyTestCuda\n  let DevicePtr ptrToXs = cullongToDevicePtr res\n  foreignPtrToXs &lt;- newForeignPtr_ ptrToXs\n  uniqueArrayXs &lt;- newUniqueArray foreignPtrToXs :: IO (UniqueArray Float)\n  let arrayDataXs = AD_Float uniqueArrayXs :: GArrayData UniqueArray Float\n  let shape = Z :. 10 :: DIM1\n      xs = Array (fromElt shape) arrayDataXs :: Array DIM1 Float\n      ys = Acc.fromList shape [0,2..18] :: Array DIM1 Float\n      usedXs = use xs :: Acc (Array DIM1 Float)\n      usedYs = use ys :: Acc (Array DIM1 Float)\n      computation = Acc.zipWith (+) usedXs usedYs\n      zs = run computation\n  putStrLn $ \"zs: \" &lt;&gt; show z\n</code></pre>\n\n<p>When compiling and running this program, it correctly prints out the result:</p>\n\n<pre><code>zs: Vector (Z :. 10) [0.0,3.0,6.0,9.0,12.0,15.0,18.0,21.0,24.0,27.0]\n</code></pre>\n\n<p>However, from reading through the accelerate and accelerate-llvm-ptx source code, it doesn't <em>seem</em> like this should work.</p>\n\n<p>In most cases, it seems like an accelerate <code>Array</code> carries around a pointer to array data in HOST memory, and a <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Unique.html#t:Unique\" rel=\"nofollow noreferrer\"><code>Unique</code></a> value to uniquely identify the <code>Array</code>.  When performing <a href=\"https://hackage.haskell.org/package/accelerate-1.1.1.0/docs/Data-Array-Accelerate.html#t:Acc\" rel=\"nofollow noreferrer\"><code>Acc</code></a> computations, accelerate will load the array data from HOST memory into GPU memory as needed, and keep track of it with a <code>HashMap</code> indexed by the <code>Unique</code>.</p>\n\n<p>In the code above, I am creating an <code>Array</code> directly with a pointer to GPU data.  This doesn't seem like it should work, but it appears to work in the above code.</p>\n\n<p>However, some things don't work.  For instance, trying to print out <code>xs</code> (my <code>Array</code> with a pointer to GPU data) fails with a segfault.  This makes sense, since the <code>Show</code> instance for <code>Array</code> just tries to <code>peek</code> the data from the HOST pointer.  This fails because it is not a HOST pointer, but a GPU pointer:</p>\n\n<pre><code>-- Trying to print xs causes a segfault.\nputStrLn $ \"xs: \" &lt;&gt; show xs\n</code></pre>\n\n<hr>\n\n<p>Is there a proper way to take a CUDA <code>DevicePtr</code> and use it directly as an accelerate <code>Array</code>?</p>\n"}, {"tags": ["haskell", "rust", "higher-kinded-types", "type-theory", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 8, "creation_date": 1517322605, "post_id": 48523571, "comment_id": 84042240, "body": "I reckon what&#39;s meant by \u201cRust doesn&#39;t support higher-kinded types\u201d is, it can&#39;t <i>abstract</i> over them, i.e. you can&#39;t quantify over type variables of kind <code>* -&gt; *</code> or higher."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1517323202, "post_id": 48523571, "comment_id": 84042706, "body": "Yeah, what rust doesn&#39;t have is higher-kinded polymorphism. As usual, people are very sloppy with language in confusing ways."}, {"owner": {"reputation": 1127, "user_id": 6171872, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2wfQM.jpg?s=128&g=1", "display_name": "StarSheriff", "link": "https://stackoverflow.com/users/6171872/starsheriff"}, "edited": false, "score": 0, "creation_date": 1517323694, "post_id": 48523571, "comment_id": 84043057, "body": "I&#39;m not sure I fully understand what both of you are saying. Do you mean that for example a generic type <code>T</code> has to be a concrete type and cannot be higher kinded itself? Aka. something like <code>struct Baz&lt;T&lt;V&gt;&gt; {}</code> will not work?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1517324398, "post_id": 48523571, "comment_id": 84043599, "body": "I take &quot;higher-kinded type&quot; to mean a type constructor which takes parameters with kinds containing <code>-&gt;</code>s (much as a higher-order function is a function which takes parameters with types containing <code>-&gt;</code>s). By that definition <code>Maybe</code> is <i>not</i> a higher-kinded type, since its one argument is a regular type of kind <code>*</code>."}, {"owner": {"reputation": 1127, "user_id": 6171872, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2wfQM.jpg?s=128&g=1", "display_name": "StarSheriff", "link": "https://stackoverflow.com/users/6171872/starsheriff"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1517324772, "post_id": 48523571, "comment_id": 84043830, "body": "@Benjamin Something like a list of Maybes, for example?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1517324918, "post_id": 48523571, "comment_id": 84043939, "body": "@StarSheriff No, because <code>[]</code> is another regular type constructor (its parameter is also kind <code>*</code>). <code>Monad</code> is an example of a higher kinded type class, because its <code>m</code> parameter has a kind of <code>* -&gt; *</code> (<code>Monad :: (* -&gt; *) -&gt; Constraint</code>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1517326638, "post_id": 48523571, "comment_id": 84045126, "body": "HKT would allow something like <code>struct Baz&lt;C&lt;_&gt;&gt; { C&lt;A&gt; a; C&lt;B&gt; b; }</code> -- note that the parameter C is not a type, but something that maps types to types. Scala has HKT (if you enable them), and Haskell has them as well."}, {"owner": {"reputation": 549, "user_id": 1524453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ed2un.png?s=128&g=1", "display_name": "Federico Sawady", "link": "https://stackoverflow.com/users/1524453/federico-sawady"}, "edited": false, "score": 0, "creation_date": 1517327409, "post_id": 48523571, "comment_id": 84045719, "body": "See <a href=\"https://www.reddit.com/r/rust/comments/2av5tv/why_does_rust_not_have_a_functor_trait/\" rel=\"nofollow noreferrer\">reddit.com/r/rust/comments/2av5tv/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 549, "user_id": 1524453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ed2un.png?s=128&g=1", "display_name": "Federico Sawady", "link": "https://stackoverflow.com/users/1524453/federico-sawady"}, "is_accepted": false, "score": 9, "last_activity_date": 1517341636, "last_edit_date": 1517341636, "creation_date": 1517324996, "answer_id": 48524623, "question_id": 48523571, "link": "https://stackoverflow.com/questions/48523571/whats-the-difference-between-parametric-polymorphism-and-higher-kinded-types/48524623#48524623", "title": "What&#39;s the difference between parametric polymorphism and higher-kinded types?", "body": "<p>I'm going to resume it: a higher-kinded type is just a type-level higher-order function.</p>\n\n<p>But take a minute:</p>\n\n<p>Consider <code>monad</code> transformers:</p>\n\n<pre><code>newtype StateT s m a :: * -&gt; (* -&gt; *) -&gt; * -&gt; *\n</code></pre>\n\n<p>Here,</p>\n\n<pre><code>- s is the desired type of the state\n- m is a functor, another monad that StateT will wrap\n- a is the return type of an expression of type StateT s m\n</code></pre>\n\n<p>What is the higher-kinded type?</p>\n\n<pre><code>m :: (* -&gt; *)\n</code></pre>\n\n<p>Because takes a type of kind <code>*</code> and returns a kind of type <code>*</code>.</p>\n\n<p>It's like a function on types, that is, a type constructor of kind</p>\n\n<pre><code>* -&gt; *\n</code></pre>\n\n<p>In languages like Java, you can't do</p>\n\n<pre><code>class ClassExample&lt;T, a&gt; {\n    T&lt;a&gt; function()\n}\n</code></pre>\n\n<p>In Haskell T would have kind <code>*-&gt;*</code>, but a Java type (i.e. class) cannot have a type parameter of that kind, a higher-kinded type.</p>\n\n<p>Also, if you don't know, in basic Haskell an expression must have a type that has kind <code>*</code>, that is, a \"concrete type\". Any other type like <code>* -&gt; *</code>.</p>\n\n<p>For instance, you can't create an expression of type <code>Maybe</code>. It has to be types applied to an argument like <code>Maybe Int</code>, <code>Maybe String</code>, etc. In other words, fully applied type constructors.</p>\n"}, {"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 16, "last_activity_date": 1529675927, "last_edit_date": 1529675927, "creation_date": 1517325212, "answer_id": 48524680, "question_id": 48523571, "link": "https://stackoverflow.com/questions/48523571/whats-the-difference-between-parametric-polymorphism-and-higher-kinded-types/48524680#48524680", "title": "What&#39;s the difference between parametric polymorphism and higher-kinded types?", "body": "<p>A simple example of what Rust can't do is something like Haskell's <code>Functor</code> class.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n\n-- a couple examples:\ninstance Functor Maybe where\n    -- fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n    fmap _ Nothing  = Nothing\n    fmap f (Just x) = Just (f x)\n\ninstance Functor [] where\n    -- fmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n    fmap _ []     = []\n    fmap f (x:xs) = f x : fmap f xs\n</code></pre>\n\n<p>Note that the instances are defined on the type constructor, <code>Maybe</code> or <code>[]</code>, instead of the fully-applied type <code>Maybe a</code> or <code>[a]</code>.</p>\n\n<p>This isn't just a parlor trick.  It has a strong interaction with parametric polymorphism. Since the type variables <code>a</code> and <code>b</code> in the type <code>fmap</code> are not constrained by the class definition, instances of <code>Functor</code> cannot change their behavior based on them. This is an incredibly strong property in reasoning about code from types, and where a lot of where the strength of Haskell's type system comes from.</p>\n\n<p>It has one other property - you can write code that's abstract in higher-kinded type variables.  Here's a couple examples:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>focusFirst :: Functor f =&gt; (a -&gt; f b) -&gt; (a, c) -&gt; f (b, c)\nfocusFirst f (a, c) = fmap (\\x -&gt; (x, c)) (f a)\n\nfocusSecond :: Functor f =&gt; (a -&gt; f b) -&gt; (c, a) -&gt; f (c, b)\nfocusSecond f (c, a) = fmap (\\x -&gt; (c, x)) (f a)\n</code></pre>\n\n<p>I admit, those types are beginning to look like abstract nonsense. But they turn out to be really practical when you have a couple helpers that take advantage of the higher-kinded abstraction.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Identity a = Identity { runIdentity :: a }\n\ninstance Functor Identity where\n    -- fmap :: (a -&gt; b) -&gt; Identity a -&gt; Identity b\n    fmap f (Identity x) = Identity (f x)\n\nnewtype Const c b = Const { getConst :: c }\n\ninstance Functor (Const c) where\n    -- fmap :: (a -&gt; b) -&gt; Const c a -&gt; Const c b\n    fmap _ (Const c) = Const c\n\nset :: ((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; b -&gt; s -&gt; t\nset f b s = runIdentity (f (\\_ -&gt; Identity b) s)\n\nget :: ((a -&gt; Const a b) -&gt; s -&gt; Const a t) -&gt; s -&gt; a\nget f s = getConst (f (\\x -&gt; Const x) s)\n</code></pre>\n\n<p>(If I made any mistakes in there, can someone just fix them?  I'm reimplementing the most basic starting point of <code>lens</code> from memory without a compiler.)</p>\n\n<p>The functions <code>focusFirst</code> and <code>focusSecond</code> can be passed as the first argument to either <code>get</code> or <code>set</code>, because the type variable <code>f</code> in their types can be unified with the more concrete types in <code>get</code> and <code>set</code>. Being able to abstract over the higher-kinded type variable <code>f</code> allows functions of a particular shape can be used both as setters and getters in arbitrary data types.  This is one of the two core insights that led to the <code>lens</code> library.  It couldn't exist without this kind of abstraction.</p>\n\n<p>(For what it's worth, the other key insight is that defining lenses as a function like that allows composition of lenses to be simple function composition.)</p>\n\n<p>So no, there's more to it than just being able to accept a type variable. The important part is being able to use type variables that correspond to type constructors, rather than some concrete (if unknown) type.</p>\n"}, {"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1517384890, "post_id": 48524700, "comment_id": 84068925, "body": "Note: Rust <i>plans</i> to support a form of higher kinded polymorphism via Generic Associated Types. That is a trait (type-class) can have associated types (to be filled in by the implementer), and the plan is to make them polymorphic. This blog serie by Niko Matsakis describes the feature, which used to be called <a href=\"http://smallcultfollowing.com/babysteps/blog/2016/11/02/associated-type-constructors-part-1-basic-concepts-and-introduction/\" rel=\"nofollow noreferrer\">Associated Type Constructors</a>."}], "tags": [], "owner": {"reputation": 31189, "user_id": 1097780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8f01ad795c29c3d05ad26ee47ea6069?s=128&d=identicon&r=PG", "display_name": "Andreas Rossberg", "link": "https://stackoverflow.com/users/1097780/andreas-rossberg"}, "is_accepted": true, "score": 37, "last_activity_date": 1517326391, "last_edit_date": 1517326391, "creation_date": 1517325264, "answer_id": 48524700, "question_id": 48523571, "link": "https://stackoverflow.com/questions/48523571/whats-the-difference-between-parametric-polymorphism-and-higher-kinded-types/48524700#48524700", "title": "What&#39;s the difference between parametric polymorphism and higher-kinded types?", "body": "<p>Some terminology:</p>\n\n<ul>\n<li>The kind <code>*</code> is sometimes called <em>ground</em>. You can think of it as 0th order.</li>\n<li>Any kind of the form <code>* -&gt; * -&gt; ... -&gt; *</code> with at least one arrow is <em>first-order</em>.</li>\n<li>A <em>higher-order</em> kind is one that has a \"nested arrow on the left\", e.g., <code>(* -&gt; *) -&gt; *</code>.</li>\n</ul>\n\n<p>The <em>order</em> essentially is the depth of left-side nesting of arrows, e.g., <code>(* -&gt; *) -&gt; *</code> is second-order, <code>((* -&gt; *) -&gt; *) -&gt; *</code> is third-order, etc. (FWIW, the same notion applies to types themselves: a second-order function is one whose type has e.g. the form <code>(A -&gt; B) -&gt; C</code>.)</p>\n\n<p>Types of non-ground kind (order > 0) are also called type <em>constructors</em> (and some literature only refers to types of ground kind as \"types\"). A higher-kinded type (constructor) is one whose kind is higher-order (order > 1).</p>\n\n<p>Consequently, a higher-kinded type is one that takes an argument of non-ground kind. That would require type variables of non-ground kind, which are not supported in many languages. Examples in Haskell:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Ground = Int\ntype FirstOrder a = Maybe a  -- a is ground\ntype SecondOrder c = c Int   -- c is a first-order constructor\ntype ThirdOrder c = c Maybe  -- c is second-order\n</code></pre>\n\n<p>The latter two are higher-kinded.</p>\n\n<p>Likewise, <em>higher-kinded polymorphism</em> describes the presence of (parametrically) polymorphic values that abstract over types that are not ground. Again, few languages support that. Example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f : forall c. c Int -&gt; c Int  -- c is a constructor\n</code></pre>\n\n<p>The statement that Rust supports parametric polymorphism \"instead\" of higher-kinded types does not make sense. Both are different dimensions of parameterisation that complement each other. And when you combine both you have higher-kinded polymorphism.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 9, "last_activity_date": 1517326099, "last_edit_date": 1517326099, "creation_date": 1517325476, "answer_id": 48524784, "question_id": 48523571, "link": "https://stackoverflow.com/questions/48523571/whats-the-difference-between-parametric-polymorphism-and-higher-kinded-types/48524784#48524784", "title": "What&#39;s the difference between parametric polymorphism and higher-kinded types?", "body": "<p>Parametric polymorphism just refers to the property that the function cannot make use of any particular feature of a type (or kind) in its definition; it is a complete blackbox. The standard example is <code>length :: [a] -&gt; Int</code>, which only works with the <em>structure</em> of the list, not the particular values stored in the list.</p>\n\n<p>The standard example of HKT is the <code>Functor</code> class, where <code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code>. Unlike <code>length</code>, where <code>a</code> has kind <code>*</code>, <code>f</code> has kind <code>* -&gt; *</code>. <code>fmap</code> <em>also</em> exhibits parametric polymorphism, because <code>fmap</code> cannot make use of any property of either <code>a</code> or <code>b</code> in its definition.</p>\n\n<p><code>fmap</code> exhibits ad hoc polymorphism as well, because the definition <em>can</em> be tailored to the specific type constructor <code>f</code> for which it is defined. That is, there are separate definitions of <code>fmap</code> for <code>f ~ []</code>, <code>f ~ Maybe</code>, etc. The difference is that <code>f</code> is \"declared\" as part of the typeclass definition, rather than just being part of the definition of <code>fmap</code>. (Indeed, typeclasses were added to support some degree of ad hoc polymorphism. Without type classes, <em>only</em> parametric polymorphism exists. You can write a function that supports <em>one</em> concrete type or <em>any</em> concrete type, but not some smaller collection in between.)</p>\n"}], "owner": {"reputation": 1127, "user_id": 6171872, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2wfQM.jpg?s=128&g=1", "display_name": "StarSheriff", "link": "https://stackoverflow.com/users/6171872/starsheriff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3310, "favorite_count": 13, "accepted_answer_id": 48524700, "answer_count": 4, "score": 39, "last_activity_date": 1529675927, "creation_date": 1517321797, "last_edit_date": 1517345560, "question_id": 48523571, "link": "https://stackoverflow.com/questions/48523571/whats-the-difference-between-parametric-polymorphism-and-higher-kinded-types", "title": "What&#39;s the difference between parametric polymorphism and higher-kinded types?", "body": "<p>I am pretty sure they are not the same. However, I am bogged down by the\ncommon notion that \"Rust does not support\" higher-kinded types (HKT), but\ninstead offers <em>parametric polymorphism</em>. I tried to get my head around that and understand the difference between these, but got just more and more entangled.</p>\n\n<p>To my understanding, there <em>are</em> higher-kinded types in Rust, at least the basics. Using the \"*\"-notation, a HKT does have a kind of e.g. <code>* -&gt; *</code>.\nFor example, <code>Maybe</code> is of kind <code>* -&gt; *</code> and could be implemented like this in Haskell.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Maybe a = Just a | Nothing\n</code></pre>\n\n<p>Here,</p>\n\n<ul>\n<li><code>Maybe</code> is a type constructor and needs to be applied to a concrete type\nto become a concrete type of kind \"*\".</li>\n<li><code>Just a</code> and <code>Nothing</code> are  data constructors.</li>\n</ul>\n\n<p>In textbooks about Haskell, this is often used as an example for a higher-kinded type. However, in Rust it can simply be implemented as an enum, which after all is a <em>sum type</em>:</p>\n\n<pre><code>enum Maybe&lt;T&gt; {\n    Just(T),\n    Nothing,\n}\n</code></pre>\n\n<p>Where is the difference? To my understanding this is a\nperfectly fine example of a higher-kinded type.</p>\n\n<ol>\n<li>If in Haskell this is used as a textbook example of HKTs, why is it\nsaid that Rust doesn't have HKT? Doesn't the <code>Maybe</code> enum qualify as a\nHKT?</li>\n<li>Should it rather be said that Rust doesn't <em>fully</em> support HKT?</li>\n<li>What's the fundamental difference between HKT and parametric polymorphism?</li>\n</ol>\n\n<p>This confusion continues when looking at functions, I can write a parametric\nfunction that takes a <code>Maybe</code>, and to my understanding a HKT as a function\nargument.</p>\n\n<pre><code>fn do_something&lt;T&gt;(input: Maybe&lt;T&gt;) {\n    // implementation\n}\n</code></pre>\n\n<p>again, in Haskell that would be something like</p>\n\n<pre><code>do_something :: Maybe a -&gt; ()\ndo_something :: Maybe a -&gt; ()\ndo_something _ = ()\n</code></pre>\n\n<p>which leads to the fourth question.</p>\n\n<ol start=\"4\">\n<li>Where exactly does the support for higher-kinded types end? Whats the\nminimal example to make Rust's type system fail to express HKT?</li>\n</ol>\n\n<h1>Related Questions:</h1>\n\n<p>I went through a lot of questions related to the topic (including links they have to blogposts, etc.) but I could not find an answer to my main questions (1 and 2).</p>\n\n<ol>\n<li><em><a href=\"https://stackoverflow.com/questions/37369251/in-haskell-are-higher-kinded-types-really-types-or-do-they-merely-denote-c\">In Haskell, are &quot;higher-kinded types&quot; *really* types? Or do they merely denote collections of *concrete* types and nothing more?</a></em></li>\n<li><em><a href=\"https://stackoverflow.com/questions/41508680/generic-struct-over-a-generic-type-without-type-parameter\">Generic struct over a generic type without type parameter</a></em></li>\n<li><em><a href=\"https://stackoverflow.com/questions/43448055/higher-kinded-types-in-scala\">Higher Kinded Types in Scala</a></em></li>\n<li><em><a href=\"https://stackoverflow.com/questions/42370444/what-types-of-problems-helps-higher-kinded-polymorphism-solve-better\">What types of problems helps &quot;higher-kinded polymorphism&quot; solve better?</a></em></li>\n<li><em><a href=\"https://stackoverflow.com/questions/36948114/abstract-data-types-vs-parametric-polymorphism-in-haskell\">Abstract Data Types vs. Parametric Polymorphism in Haskell</a></em></li>\n</ol>\n\n<h1>Update</h1>\n\n<p>Thank you for the many good answers which are all very detailed and helped a lot. I decided to accept Andreas Rossberg's answer since his explanation helped me the most to get on the right track. Especially the part about terminology.</p>\n\n<p>I was really locked in the cycle of thinking that everything of kind <code>* -&gt; * ... -&gt; *</code> is <em>higher-kinded</em>. The explanation that stressed the difference between <code>* -&gt; * -&gt; *</code> and <code>(* -&gt; *) -&gt; *</code> was crucial for me.</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1517314024, "post_id": 48520907, "comment_id": 84036665, "body": "Whatever you want them to be, as long as they follow the laws.  There are many choices. Try to come up with one."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 2, "creation_date": 1517315615, "post_id": 48520907, "comment_id": 84037628, "body": "The question seems to lack context. Depending on the context, the notion of &quot;type&quot; could vary quite considerably. Such a proposition could mean anything dependeng on what you mean by &quot;type&quot;. There are a lot of different formal systems (type theories), each with their own slightly different notion of <code>type</code>. Are you talking about the messy reality of Haskell types? Or some neat, cleaned up academic type theory that approximates Haskell&#39;s types? Or maybe about types from HoTT?"}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 1, "creation_date": 1517315947, "post_id": 48520907, "comment_id": 84037846, "body": "And... do you want to code something? Of course, as soon as you attach &quot;haskell&quot; tag to it, questions about categories, Kan extensions, Grothendieck fibrations and sheaf cohomology immediately become practical programming questions, but still..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5158149"}, "edited": false, "score": 0, "creation_date": 1517318334, "post_id": 48520907, "comment_id": 84039389, "body": "I edited my question"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1517560768, "post_id": 48520907, "comment_id": 84153680, "body": "Oh your &quot;singleton category&quot; is called a <code>Monoid</code>.  There are a few moniods for <code>Integer</code>, namely <code>Sum</code>, <code>Product</code>, <code>Min</code>, and <code>Max</code> (and you can define more)."}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1517315818, "post_id": 48521272, "comment_id": 84037764, "body": "Don&#39;t forget the discrete category, <code>|Int|</code>, where each integer is an object and there are only identity morphisms. We use this category when we work with the type <code>Int -&gt; *</code>."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1517316316, "post_id": 48521272, "comment_id": 84038089, "body": "@pigworker: Isn&#39;t it covered by the first &quot;disclaimer&quot; sentence that nearly anything can be considered a discrete category, as long as it is not too large or otherwise too inchoate, and as long as you are willing to forget all the structure and pulverize everything into discrete dust?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1517319967, "post_id": 48521272, "comment_id": 84040453, "body": "Probably. I was in a hurry and clocked the bullet points. My apologies."}], "tags": [], "owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "is_accepted": true, "score": 10, "last_activity_date": 1517405886, "last_edit_date": 1517405886, "creation_date": 1517314601, "answer_id": 48521272, "question_id": 48520907, "link": "https://stackoverflow.com/questions/48520907/is-int-a-category-of-all-integers/48521272#48521272", "title": "Is Int a category of all integers?", "body": "<p>Depends on what you mean by \"type\" and \"is a category\". If you take any concrete type in a programming language, there are only countably many possible values of that type, so you can just take the set of all values, and say that it is a discrete category <code>C</code>, which has nothing but the identity morphisms.</p>\n\n<p>Integers can be considered a category in many different ways:</p>\n\n<ul>\n<li>(Z, +, 0) is a group, therefore a special kind of groupoid with a single object (<code>Obj(C) = {*}</code> is the only object, each integer is a morphism, <code>0</code> is the identity morphism, <code>+</code> is the composition).</li>\n<li>(Z, &lt;=) is a partially ordered set, posets are special very simple categories. Morphisms are just structureless arrows between elements, with one arrow for each pair of integers <code>(a, b)</code> such that <code>a &lt;= b</code>. Reflexivity <code>a &lt;= a</code> are the identity morphisms. Transitivity is the composition.</li>\n<li>(Z, |) (divisibility relation) is again a poset, arrows again simply indicate that some integer divides some other integer: <code>a|b</code>. Again, <code>refl_a = a|a</code> are the identity morphisms, the fact that if <code>a|b</code> and <code>b|c</code> then <code>a|c</code> gives the composition.</li>\n</ul>\n\n<p>If you are interested only in the <em>type</em> <code>Int</code>, you can also build \nmany different categories out of it:</p>\n\n<ul>\n<li><p>The simplest example: take <code>Int</code> as the only object, take the identity function on <code>Int</code> as the only morphism, done. That's a category, usually called <code>1</code>. </p></li>\n<li><p>Somewhat less degenerate construction: the monoid of endomorphisms on <code>Int</code>. Again take <code>Int</code> as the only object of your category. Take as <code>Hom[Int, Int]</code> the set of all terminating total functions which are implementable in Haskell <strong>(1)</strong> , define the composition on this hom-set as the ordinary composition of functions.</p></li>\n<li><p>You can play with this construction a little: for example, you can consider partial functions, or only invertible functions (that would give a group of automorphisms, and therefore a very simple groupoid).</p></li>\n</ul>\n\n<p>There are many other ways to define a category which \"bears some relationship to <code>Int</code>\". It depends on what you want to do with it.</p>\n\n<p><strong>On your 'edit':</strong> That's just a special case of every monoid being a category with a single object. For integers, you can immediately build a handful of monoids:</p>\n\n<ul>\n<li><code>(Int, +, 0)</code> (<code>a+b</code> is the composition, <code>0</code> is the identity)</li>\n<li><code>(Int, *, 1)</code> (<code>a*b</code> is the composition, <code>1</code> is the identity)</li>\n<li><code>(Int, bitwise Xor, 0)</code> (<code>a xor b</code> is the composition, <code>0</code> the identity)</li>\n<li><code>(Int, bitwise And, 0xF...F)</code>, analogous</li>\n<li>... (almost any other bitwise binary operation)</li>\n</ul>\n\n<p>You obtain a category from a monoid always by the same construction: given a monoid <code>(M, op, zero)</code>, take a structureless point <code>{*}</code> as the single object, take <code>M</code> as the set of morphisms, take <code>zero</code> as the identity, <code>op</code> as composition, and you obtain a category. This is simply because monoids are <em>by definition</em> the same as categories with a single object.</p>\n\n<p><strong>EDIT</strong>:</p>\n\n<p><strong>(1)</strong> Oh, wait, you'd need rather something like the equivalence classes modulo extensionality, otherwise even <code>f . id</code> isn't the same as <code>f</code>, and associativity wouldn't work either, even without the \"help\" of integer-overflows and other nasty things that happen on a real computer. Notice that the undecidability of properties like <em>\"does it terminate for all input values?\"</em> and <em>\"do these two functions return the same result for all inputs?\"</em> does not break the well-definedness.</p>\n"}, {"tags": [], "owner": {"reputation": 33569, "user_id": 3434, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5a484dc0812eb4542ee718d969513f66?s=128&d=identicon&r=PG", "display_name": "Apocalisp", "link": "https://stackoverflow.com/users/3434/apocalisp"}, "is_accepted": false, "score": 1, "last_activity_date": 1517342879, "creation_date": 1517342879, "answer_id": 48529691, "question_id": 48520907, "link": "https://stackoverflow.com/questions/48520907/is-int-a-category-of-all-integers/48529691#48529691", "title": "Is Int a category of all integers?", "body": "<p>In your edit you've identified monoids, which are categories with one object, where the hom-set is the elements of the monoid.</p>\n\n<p>There are also categories with at most one arrow between any two objects, and these are the <em>partial orders</em>. For example, on <code>Int</code>:</p>\n\n<ul>\n<li>The objects are the integers.</li>\n<li>There's an arrow from <code>x</code> to <code>y</code> exactly when <code>x</code> is less than or equal to <code>y</code>.</li>\n<li>Composition is just the transitivity property.</li>\n<li>Identity is reflexivity.</li>\n</ul>\n\n<p>The degenerate case is the partial orders with zero arrows between any two objects (except identity arrows), the so-called <em>discrete categories</em>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5158149"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "accepted_answer_id": 48521272, "answer_count": 2, "score": 0, "last_activity_date": 1517405886, "creation_date": 1517313410, "last_edit_date": 1517342356, "question_id": 48520907, "link": "https://stackoverflow.com/questions/48520907/is-int-a-category-of-all-integers", "title": "Is Int a category of all integers?", "body": "<p><strong>Proposition</strong>: each type is a category itself. </p>\n\n<p>Ex: <code>Int</code> is a category of all <code>integers</code> under Hask.</p>\n\n<p>Is that the case?</p>\n\n<p>If so, what are homomorphisms in the category of <code>Int</code>, or all possible morphism from <code>Int-&gt;Int</code>?\nHow can define it?</p>\n\n<hr>\n\n<p><strong>edited</strong>:</p>\n\n<pre><code>--In the category of Hask\n\n--Imagine, I have Str category just of strings under Hask, then:\n\nObj(Str) is Singelton\nHom (Str) is each string\nComposition operation is (++) operator --in Haskell\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1517302561, "post_id": 48517029, "comment_id": 84029263, "body": "How often does the <code>testlib</code> change? I&#39;ve struggled with this in the past and one easy way that doesn&#39;t pollute the <code>test</code>&#39;s codebase is installing the <code>testlib</code>. Back when I used cabal, you could create a sandbox for such a project set and install everything there. Since stack has no package conflicts by definition, though, you might get away with just installing your package globally.  If you want to write code in both projects often, though, and see changes in respective builds, prepare to endure at least some of the annoyances of such setup."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1517302683, "post_id": 48517029, "comment_id": 84029320, "body": "Please post your answer as an answer below. (So that I can&#39;t comment on why I don&#39;t like it ;) )"}, {"owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1517302914, "post_id": 48517029, "comment_id": 84029432, "body": "@BartekBanachewicz Thanks for reply;) The library I use not change much. Any better way to do? I have look throuth the stack configuration doc and only found this config item may be helpful."}], "answers": [{"tags": [], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "is_accepted": false, "score": 5, "last_activity_date": 1517302999, "creation_date": 1517302999, "answer_id": 48517506, "question_id": 48517029, "link": "https://stackoverflow.com/questions/48517029/how-to-link-to-a-local-haskell-library/48517506#48517506", "title": "How to link to a local Haskell library?", "body": "<p>I find the answer.</p>\n\n<p><a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#packages-and-extra-deps\" rel=\"noreferrer\">extra-deps</a> solve the problem.</p>\n\n<p>And the test.yaml seems like:</p>\n\n<pre><code>...\nextra_deps:\n- ../testlib-1.0.0\n...\n</code></pre>\n\n<p>Two points should be noticed:</p>\n\n<ol>\n<li>the path should be relative to the directory containing test.yaml</li>\n<li>the name of target lib should be like LIBNAME-VERINFO1.VERINFO2</li>\n</ol>\n\n<hr>\n\n<p>Any better solution will be welcome. And thanks a lot for the help!</p>\n"}, {"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 1, "last_activity_date": 1517303714, "creation_date": 1517303714, "answer_id": 48517712, "question_id": 48517029, "link": "https://stackoverflow.com/questions/48517029/how-to-link-to-a-local-haskell-library/48517712#48517712", "title": "How to link to a local Haskell library?", "body": "<p>You can use <code>extra-deps</code> or <code>packages</code> according to taste. <code>packages</code> should be used when the extra library (<code>testlib</code> in your example) is part of your development work, and <code>extra-deps</code> when you have a stable release.</p>\n\n<p>The <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/\" rel=\"nofollow noreferrer\">manual</a> has more details.</p>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1517303714, "creation_date": 1517301090, "last_edit_date": 1517303597, "question_id": 48517029, "link": "https://stackoverflow.com/questions/48517029/how-to-link-to-a-local-haskell-library", "title": "How to link to a local Haskell library?", "body": "<p>There are current two projects with stack and cabal files each (I use stack to build), one is an exe called test and the other is a library called testlib. I want to use testlib in the test project, what can I do to let stack know testlib is a custom library and how to find it?</p>\n\n<pre><code>-- projects/test/test.yaml\n-- projects/testlib/testlib.yaml\n</code></pre>\n"}, {"tags": ["haskell", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 4, "creation_date": 1517284808, "post_id": 48513634, "comment_id": 84022026, "body": "This looks like a homework question. What have you tried? Why didn&#39;t it work?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1517284989, "post_id": 48513634, "comment_id": 84022068, "body": "To format your code correctly copy and paste it into the editor, select it, and press the button that looks like <code>{}</code>."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1517311935, "post_id": 48513634, "comment_id": 84035300, "body": "You have the right idea but your Haskell syntax on the <code>n &gt; 1</code> line is hopeless. <code>n - 1 (blevel tl)</code> means <code>n - (1 (blevel tl))</code>. I suspect you do not want to call <code>1</code> as a function and you mean to write <code>blevel (n-1) tl ++ ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1517328097, "creation_date": 1517328097, "answer_id": 48525688, "question_id": 48513634, "link": "https://stackoverflow.com/questions/48513634/collect-the-nodes-of-a-binary-tree-on-a-given-level/48525688#48525688", "title": "Collect the nodes of a binary tree, on a given level", "body": "<p>Judging from the code, your data type is</p>\n\n<pre><code>data BTree = Empty | Branch Char BTree BTree\n</code></pre>\n\n<p>Just fix your syntax, as </p>\n\n<pre><code>    | n &gt; 1 = ((n-1) `blevel` tl)  ++ ((n-1) `blevel` tr)\n</code></pre>\n\n<p>, that's all. </p>\n\n<p>BTW <code>blevel/3</code> is indicative of Prolog, not Haskell.</p>\n"}], "owner": {"reputation": 1, "user_id": 7493121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d198b10526d5e395bdd6380518c8ab3?s=128&d=identicon&r=PG&f=1", "display_name": "Gang Wu", "link": "https://stackoverflow.com/users/7493121/gang-wu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "closed_date": 1517538742, "answer_count": 1, "score": -2, "last_activity_date": 1517328097, "creation_date": 1517284490, "last_edit_date": 1517328043, "question_id": 48513634, "link": "https://stackoverflow.com/questions/48513634/collect-the-nodes-of-a-binary-tree-on-a-given-level", "closed_reason": "Needs more focus", "title": "Collect the nodes of a binary tree, on a given level", "body": "<p>Collect the nodes at a given level in a list.  A node of a binary tree is at level <em>N</em> if the path from the root to the node has length <em>N-1</em>. The root node is at level <em>1</em>. Write a predicate <code>blevel/3</code> to collect all nodes at a given level, in a list.</p>\n\n<p>This is my code in Haskell. I don't know where it is wrong:</p>\n\n<pre><code>-- Problem 5: BTree levels \nblevel :: Int -&gt; BTree -&gt; String\nblevel _ Empty = \"\"\nblevel n (Branch v tl tr)\n  | n == 1 = [v]\n  | n &gt; 1 = n-1 (blevel tl)  ++ n-1 (blevel tr)\n  | otherwise = \"\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "edited": false, "score": 0, "creation_date": 1517264214, "post_id": 48510885, "comment_id": 84016682, "body": "When I am using <code>DatatypeContexts</code>, I get following error : <code>-XDatatypeContexts is deprecated:</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1517267460, "post_id": 48510885, "comment_id": 84017833, "body": "It&#39;s an obsolete feature, no longer recommended. Just use <code>data Fix f = In (f (Fix f))</code> instead."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1517274977, "post_id": 48510885, "comment_id": 84019848, "body": "@chi  Thank you.."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1517267490, "creation_date": 1517267490, "answer_id": 48511514, "question_id": 48510885, "link": "https://stackoverflow.com/questions/48510885/illegal-datatype-context-use-datatypecontexts-typefunctor-f/48511514#48511514", "title": "Illegal datatype context (use DatatypeContexts): TypeFunctor f", "body": "<p>First, you commented the extension out. This does nothing:</p>\n\n<pre><code>-- {-# LANGUAGE DatatypeContexts #-}\n</code></pre>\n\n<p>This enables the <code>DatatypeContexts</code> extension:</p>\n\n<pre><code>{-# LANGUAGE DatatypeContexts #-}\n</code></pre>\n\n<p>Second, as the warning suggests, <code>DatatypeContexts</code> should not be used anymore. Instead, functions should require the constraints that are relevant to them. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "closed_date": 1517267524, "answer_count": 1, "score": 0, "last_activity_date": 1517274921, "creation_date": 1517264119, "last_edit_date": 1517274921, "question_id": 48510885, "link": "https://stackoverflow.com/questions/48510885/illegal-datatype-context-use-datatypecontexts-typefunctor-f", "closed_reason": "Duplicate", "title": "Illegal datatype context (use DatatypeContexts): TypeFunctor f", "body": "<pre><code>--{-# LANGUAGE DatatypeContexts #-}\n\nclass TypeFunctor f where\n mapf :: (a-&gt; b)-&gt;(f a-&gt; fb)\n\ndata TypeFunctor f =&gt; Fix f = In (f (Fix f))\nout :: TypeFunctor f =&gt; Fix f -&gt; f (Fix f)\nout (In x) = x\n\nfold :: TypeFunctor f =&gt; (f a -&gt; a) -&gt; (Fix f -&gt; a)\nfold f = f . mapf (fold f) . out\n</code></pre>\n\n<p>I am getting the following error message:</p>\n\n<blockquote>\n  <p>error:\n      Illegal datatype context (use DatatypeContexts): TypeFunctor f =>   | 4 | data TypeFunctor f => Fix f = In (f (Fix f))   |<br>\n  ^^^^^^^^^^^^^</p>\n</blockquote>\n\n<p>What is a Problem?</p>\n\n<hr>\n\n<p><strong>edited</strong>:</p>\n\n<pre><code>newtype Fix f = In (f (Fix f))\n\nout :: Functor f =&gt; Fix f -&gt; f (Fix f)\nout (In x) = x\n\nfold :: Functor f =&gt; (f a -&gt; a) -&gt; (Fix f -&gt; a)\nfold f = f . fmap (fold f) . out\n</code></pre>\n"}, {"tags": ["scala", "haskell", "f#", "elm", "pointfree"], "comments": [{"owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "edited": false, "score": 4, "creation_date": 1517264174, "post_id": 48510844, "comment_id": 84016660, "body": "In Scala it would take one more symbol: <code>_.foo</code> where <code>_</code> is a placeholder for default argument. See also <a href=\"https://stackoverflow.com/questions/8000903/what-are-all-the-uses-of-an-underscore-in-scala\" title=\"what are all the uses of an underscore in scala\">stackoverflow.com/questions/8000903/&hellip;</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1517264184, "post_id": 48510844, "comment_id": 84016667, "body": "You do not pass an attribute to the <code>map</code>, you pass it a getter."}, {"owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "edited": false, "score": 2, "creation_date": 1517264285, "post_id": 48510844, "comment_id": 84016718, "body": "In F#, this is not available, but there is an active discussion about it: <a href=\"https://github.com/fsharp/fslang-suggestions/issues/506\" rel=\"nofollow noreferrer\">github.com/fsharp/fslang-suggestions/issues/506</a>. I don&#39;t think the pattern has any name in F#."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1517266923, "post_id": 48510844, "comment_id": 84017673, "body": "This just seems like a standard usage of <code>map</code>. Getters are special functions generated by the definition of a record and with a special naming convention but are otherwise functions like any other."}], "answers": [{"tags": [], "owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "is_accepted": false, "score": 8, "last_activity_date": 1517266621, "last_edit_date": 1517266621, "creation_date": 1517265083, "answer_id": 48511108, "question_id": 48510844, "link": "https://stackoverflow.com/questions/48510844/pondering-name-of-pattern-seen-in-elm-and-if-other-similar-cases/48511108#48511108", "title": "Pondering name of pattern seen in Elm and if other similar cases", "body": "<p>If you think of your list as a \"dataset\" or \"table\", and consider each element in the list to be a \"row\", and the definition of the datatype of the elements as an enumeration of \"attributes\", then what you get is a kind of <em>\"projection\"</em> in the sense of relational algebra: <a href=\"https://en.wikipedia.org/wiki/Projection_(relational_algebra)\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/Projection_(relational_algebra)</a> .</p>\n\n<p>Here is a Scala-example, which feels somewhat SQL-ish:</p>\n\n<pre><code>case class Row(id: Int, name: String, surname: String, age: Int)\n\nval data = List(\n  Row(0, \"Bob\", \"Smith\", 25),\n  Row(1, \"Charles\", \"Miller\", 35),\n  Row(2, \"Drew\", \"Shephard\", 45),\n  Row(3, \"Evan\", \"Bishop\", 55)\n)\n\nval surnames = data map (_.surname)\nval ages = data map (_.age)\nval selectIdName = data map { row =&gt; (row.id, row.name) }\n\nprintln(surnames)\n// List(Smith, Miller, Shephard, Bishop)\n\nprintln(selectIdName)\n// List((0,Bob), (1,Charles), (2,Drew), (3,Evan))\n</code></pre>\n\n<p>Here, <code>_.fieldName</code> is a short syntax for an inline function literal of type <code>Row =&gt; TypeOfTheField</code>.</p>\n\n<p>In Haskell, it's kind of trivial, because the declaration of a record datatype automatically brings all the getter functions into scope:</p>\n\n<pre><code>data Row = Row { id :: Int\n               , name :: String\n               , surname :: String\n               , age :: Int\n               } deriving Show\n\nmain = let dataset = [ Row 0 \"Bob\" \"Smith\" 25\n                     , Row 1 \"Charles\" \"Miller\" 35\n                     , Row 2 \"Drew\" \"Shephard\" 45\n                     , Row 3 \"Evan\" \"Bishop\" 55\n                     ]\n       in print $ map name dataset\n-- prints [\"Bob\",\"Charles\",\"Drew\",\"Evan\"]\n</code></pre>\n\n<p>Even Java has something similar since version 8:</p>\n\n<pre><code>import java.util.*;\nimport java.util.stream.*;\nimport static java.util.stream.Collectors.*;\n\nclass JavaProjectionExample {\n  private static class Row {\n    private final int id;\n    private final String name;\n    private final String surname;\n    private final int age;\n    public Row(int id, String name, String surname, int age) {\n      super();\n      this.id = id;\n      this.name = name;\n      this.surname = surname;\n      this.age = age;\n    }\n    public int getId() {\n      return this.id;\n    }\n    public String getName() {\n      return this.name;\n    }\n    public String getSurname() {\n      return this.surname;\n    }\n    public int getAge() {\n      return this.age;\n    }\n  }\n\n  public static void main(String[] args) {\n    List&lt;Row&gt; data = Arrays.asList(\n      new Row(0, \"Bob\", \"Smith\", 25),\n      new Row(1, \"Charles\", \"Miller\", 35),\n      new Row(2, \"Drew\", \"Shephard\", 45),\n      new Row(3, \"Evan\", \"Bishop\", 55)\n    );\n\n    List&lt;Integer&gt; ids = data.stream().map(Row::getId).collect(toList());\n    List&lt;String&gt; names = data.stream().map(Row::getName).collect(toList());\n\n    System.out.println(ids);\n    System.out.println(names);\n  }\n}\n</code></pre>\n\n<p>Here, <code>Row::getterName</code> is a special syntax for getter methods, it is a value of type <code>Function&lt;Row, FieldType&gt;</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 6124, "user_id": 5627983, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/696f780ea286896dd41a92459152fbb3?s=128&d=identicon&r=PG&f=1", "display_name": "s952163", "link": "https://stackoverflow.com/users/5627983/s952163"}, "is_accepted": true, "score": 7, "last_activity_date": 1550782705, "last_edit_date": 1550782705, "creation_date": 1517279959, "answer_id": 48513056, "question_id": 48510844, "link": "https://stackoverflow.com/questions/48510844/pondering-name-of-pattern-seen-in-elm-and-if-other-similar-cases/48513056#48513056", "title": "Pondering name of pattern seen in Elm and if other similar cases", "body": "<p>This is actually not point free, but rather syntactic sugar and the pipe forward operator. For point free see <a href=\"https://eiriktsarpalis.wordpress.com/2017/04/02/programming-in-the-point-free-style/\" rel=\"nofollow noreferrer\">this article</a>.</p>\n\n<p>This can be written in fsharp as follows:</p>\n\n<p><code>let foos = myList |&gt; List.map (fun x -&gt; x.foo)</code></p>\n\n<p>And you can see immediately that this is equivalent to </p>\n\n<p><code>List.map (fun x -&gt; x.foo) myList</code></p>\n\n<p>So the pipe operator just flips the arguments and makes it easy to chain operations together. So you pass your function and a list to the map. And the syntactic sugar in Elm allows you to skip the function parameter, by just writing out .foo. I think that feature is quite handy, btw. </p>\n\n<p>Point-free would be when you avoid specifying the parameters of the function. It's typical FP but can be difficult to read once it gets complicated. </p>\n\n<p>An example:</p>\n\n<pre><code>let mySum x y = x + y\n//val mySum : x:int -&gt; y:int -&gt; int\nmySum 4 7 //11\n</code></pre>\n\n<p>This is point free:</p>\n\n<pre><code>let mySum2 = (+)\n//val mySum2 : (int -&gt; int -&gt; int)\nmySum2 4 7 //11  \n</code></pre>\n"}], "owner": {"reputation": 2144, "user_id": 1560484, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d9e864cede01c5b7fa48f6de854b5ea6?s=128&d=identicon&r=PG", "display_name": "Babakness", "link": "https://stackoverflow.com/users/1560484/babakness"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 48513056, "answer_count": 2, "score": 5, "last_activity_date": 1550782705, "creation_date": 1517263903, "question_id": 48510844, "link": "https://stackoverflow.com/questions/48510844/pondering-name-of-pattern-seen-in-elm-and-if-other-similar-cases", "title": "Pondering name of pattern seen in Elm and if other similar cases", "body": "<p>I'm currently a student of FP. As I look around different syntax offer by different functional languages, I've come across a pattern in Elm sample code. I am curious about it.</p>\n\n<p>Here is the sample code</p>\n\n<pre><code>myList = [{foo = \"bar1\"},{foo = \"bar2\"}]    \nfoos = myList |&gt; List.map .foo\n</code></pre>\n\n<p>In the last line here, <code>List.map</code> is being passed <code>.foo</code>. I believe this style is called point-free but what about the specific pattern of passing in an attribute to the <code>List.map</code> function?</p>\n\n<p>Is this a more common thing? Is it possible to do this in Haskell? F#? Scala? Thanks for any help.</p>\n\n<p>What is the (or is there a) formal (or informal ?) name for the pattern here? The property of an object is used as a short hand for a function that takes an object and calls said property on it?</p>\n"}, {"tags": ["haskell", "memory", "optimization", "garbage-collection"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1517262091, "post_id": 48510270, "comment_id": 84015794, "body": "The wiki is probably simplifying a bit. My guess is that your assumption &quot;one of them must actually be elder&quot; does not apply here, and <code>x,y</code> have to be considered to be born at the same time. I&#39;m not terribly familiar with the GHC GC to answer this more precisely."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1517262702, "post_id": 48510270, "comment_id": 84016044, "body": "Also, due to laziness, there is no infinite list until you try to force the entire list. <code>head x</code>, for example, never needs to evaluate <code>y</code>. Further, each use of <code>x</code> is a distinct value. It&#39;s not a circular list that reuses the same 1 and 2 over and over."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 3, "creation_date": 1517263447, "post_id": 48510270, "comment_id": 84016371, "body": "Immutable strict data never refers to younger values. The same is not true of lazy data, since laziness is implemented by mutating each thunk at most once."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1517281669, "post_id": 48510270, "comment_id": 84021304, "body": "That quote sounds like an over-simplification.  Thunks are frequently updated and might very well point to a younger generation.  It\u2019s important to keep track of these references since they need to be scanned on a minor gc."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1517312297, "post_id": 48510270, "comment_id": 84035537, "body": "GHC\u2019s RTS uses \u201cremembered sets\u201d to track these references from older generations to younger objects. For <i>strictly</i> evaluated immutable data, such references are impossible, as are reference cycles."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517609968, "post_id": 48510270, "comment_id": 84180576, "body": "The referenced article is a poor article. It could use an edit job!"}], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1517261217, "creation_date": 1517261217, "question_id": 48510270, "link": "https://stackoverflow.com/questions/48510270/immutability-invariants-in-haskells-gc-considering-mutual-recursion", "title": "Immutability invariants in Haskell&#39;s GC, considering mutual recursion", "body": "<p>I was reading this article: <a href=\"https://wiki.haskell.org/GHC/Memory_Management\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/GHC/Memory_Management</a>\nand found it a bit confusing. I do not understand the part:</p>\n\n<blockquote>\n  <p>The trick is that immutable data NEVER points to younger values. Indeed, younger values don't yet exist at the time when an old value is created, so it cannot be pointed to from scratch. And since values are never modified, neither can it be pointed to later. This is the key property of immutable data. </p>\n</blockquote>\n\n<p>I think it would be true if we forget about recursion and mutual recursion, but what about</p>\n\n<pre><code>let x = 1:y\n    y = 2:x\n</code></pre>\n\n<p>which is proper Haskell code, and makes <code>x == [1,2,1...]</code>. Here <code>x</code> points to <code>y</code> and <code>y</code> points to <code>x</code>. In this situation we cannot say that no value points to younger one (one of them must actually be elder).</p>\n\n<p>Who is mistaken - me, or article author? Why? How does immutability help GC's analysis in this case?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517262315, "post_id": 48510432, "comment_id": 84015872, "body": "Thanks. I bet I tried putting <code>lift</code> in random places before asking."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1517262323, "last_edit_date": 1517262323, "creation_date": 1517261978, "answer_id": 48510432, "question_id": 48510201, "link": "https://stackoverflow.com/questions/48510201/given-a-nothing-how-do-i-construct-values-of-type-rwst-env-log-state-maybe-valu/48510432#48510432", "title": "Given a Nothing, how do I construct values of type RWST env log state Maybe value?", "body": "<p>You need to <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Class.html#v:lift\" rel=\"nofollow noreferrer\"><code>lift</code></a>, which is the fundamental operation monad transformers support.</p>\n\n<pre><code>ghci&gt; runRWST (lift Nothing) () ()\nNothing\n</code></pre>\n\n<p>But also be careful doing this kind of swapping.  <code>Maybe</code> does not commute with <code>RWS</code>.  In fact, it doesn't commute with any of them!  For example:</p>\n\n<pre><code>WriterT w Maybe a\n  \u2243 Maybe (a, w)\n</code></pre>\n\n<p>but</p>\n\n<pre><code>MaybeT (Writer w a)\n  \u2243 Writer w (Maybe a)\n  \u2243 (Maybe a, w)\n</code></pre>\n\n<p>In the former, with <code>Maybe</code> as the base monad, a <code>Nothing</code> value erases the writer's log -- all you get is failure.  In the latter, with <code>Writer</code> as the base, the computation can fail yet still produce a value in the log.</p>\n\n<p>A very good exercise is to do this with each of <a href=\"https://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Reader.html\" rel=\"nofollow noreferrer\"><code>Reader</code></a>, <a href=\"https://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-Writer-Lazy.html\" rel=\"nofollow noreferrer\"><code>Writer</code></a>, and <a href=\"https://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-State-Lazy.html\" rel=\"nofollow noreferrer\"><code>State</code></a>, and find a computation that is representable in one of <code>MaybeT m</code>, <code>mT Maybe</code> but not the other.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 48510432, "answer_count": 1, "score": 1, "last_activity_date": 1517262323, "creation_date": 1517260923, "question_id": 48510201, "link": "https://stackoverflow.com/questions/48510201/given-a-nothing-how-do-i-construct-values-of-type-rwst-env-log-state-maybe-valu", "title": "Given a Nothing, how do I construct values of type RWST env log state Maybe value?", "body": "<p>Suppose I want a computation that evaluates expressions with variables. I would like it to look variables up in the env passed to its runner, and also have some kind of state and a log. I take an <a href=\"https://stackoverflow.com/questions/48488021\">algebra</a>, pepper it with <code>RWS</code> and I'm done.</p>\n\n<p>Except that <code>lookup</code> returns <code>Maybe</code>.</p>\n\n<p>So I need a monad stack.</p>\n\n<pre><code>\u03bb type EvalA = MaybeT (RWS () () ()) ()\n\u03bb runRWS (runMaybeT (MaybeT (return (Just ())) :: EvalA )) () ()\n(Just (),(),())\n\u03bb runRWS (runMaybeT (MaybeT (return Nothing) :: EvalA )) () ()\n(Nothing,(),())\n</code></pre>\n\n<p>So far so good. But the type is somewhat messy: a transformer on top of a transformer on top of <code>Identity</code>. Why not flip this.</p>\n\n<pre><code>\u03bb type EvalB = RWST () () () Maybe ()\n\u03bb runRWST (return () :: EvalB) () ()\nJust ((),(),())\n\u03bb runRWST (Nothing :: EvalB) () ()\n\n&lt;interactive&gt;:12:10: error:\n    \u2022 Couldn't match type \u2018Maybe a0\u2019 with \u2018RWST () () () Maybe ()\u2019\n      Expected type: EvalB\n        Actual type: Maybe a0\n    ..........\n\u03bb -- ...?\n</code></pre>\n\n<p>Putting aside that having a <code>Nothing</code> plus a log is better than having a <code>Nothing</code> alone, how can I obtain a <code>Nothing</code> from <code>EvalB</code>?</p>\n"}, {"tags": ["json", "haskell", "traversal", "wreq"], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 1485168, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8JMSb.jpg?s=128&g=1", "display_name": "David B.", "link": "https://stackoverflow.com/users/1485168/david-b"}, "edited": false, "score": 0, "creation_date": 1517311994, "post_id": 48517200, "comment_id": 84035330, "body": "Well spotted thanks! However, if we look at this: <a href=\"https://openweathermap.org/current\" rel=\"nofollow noreferrer\">openweathermap.org/current</a>, both &quot;name&quot; and &quot;id&quot; appear at the outermost level..."}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "reply_to_user": {"reputation": 353, "user_id": 1485168, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8JMSb.jpg?s=128&g=1", "display_name": "David B.", "link": "https://stackoverflow.com/users/1485168/david-b"}, "edited": false, "score": 0, "creation_date": 1517319119, "post_id": 48517200, "comment_id": 84039886, "body": "@DavidB. When querying by city ID, &quot;name&quot; and &quot;id&quot; appear at the outermost; when querying by city name, they are not there... I won&#39;t design APIs like that :("}], "tags": [], "owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "is_accepted": true, "score": 3, "last_activity_date": 1517301757, "creation_date": 1517301757, "answer_id": 48517200, "question_id": 48510193, "link": "https://stackoverflow.com/questions/48510193/traversing-json-in-haskell-with-wreq-key-issues/48517200#48517200", "title": "Traversing JSON in Haskell with wreq - key issues", "body": "<p>The response body does not look like that.</p>\n\n<p>According to <a href=\"https://openweathermap.org/forecast5\" rel=\"nofollow noreferrer\">https://openweathermap.org/forecast5</a>, the key <code>\"cod\"</code> appears at the outermost level of the JSON object, but <code>\"id\"</code> and <code>\"name\"</code> do not.</p>\n\n<pre><code>{\n    \"city\":{\n        \"id\":1851632,\n        \"name\":\"Shuzenji\",\n        ...\n        }\n    \"cod\":\"200\",\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 1485168, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8JMSb.jpg?s=128&g=1", "display_name": "David B.", "link": "https://stackoverflow.com/users/1485168/david-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 48517200, "answer_count": 1, "score": 0, "last_activity_date": 1517301757, "creation_date": 1517260898, "question_id": 48510193, "link": "https://stackoverflow.com/questions/48510193/traversing-json-in-haskell-with-wreq-key-issues", "title": "Traversing JSON in Haskell with wreq - key issues", "body": "<p>I'm trying to traverse some JSON response I'm getting from the OpenWeatherMap API but I'm getting some issues to retrieve some values. Here is my code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Lens\nimport Data.Aeson.Lens (_String, key)\nimport Network.Wreq\n\nmyAPIKey :: String\nmyAPIKey = \"my_api_key_here\"\n\nconditionsQuery :: String -&gt; String -&gt; String -&gt; String\nconditionsQuery city country key = \n   \"https://api.openweathermap.org/data/2.5/forecast?q=\" ++ city ++ \",\" ++ country ++ \"&amp;appid=\" ++ key\n\nmain = do\n    print \"What's the city?\"\n    city &lt;- getLine\n    print \"And the country?\"\n    country &lt;- getLine\n\n    r &lt;- get (conditionsQuery city country myAPIKey)\n\n    print $ r ^. responseBody . key \"name\" . _String\n    print $ r ^. responseBody . key \"cod\" . _String\n    print $ r ^. responseBody . key \"id\" . _String\n</code></pre>\n\n<p>The issue is that only the value of \"cod\" is returned (\"200\" in that case).  The values for \"name\" and \"id\" appear as <code>\"\"</code>, if we try with London,GB, Chicago, US (for instance). Yet the response body looks like:</p>\n\n<pre><code>{\n   ...\n   \"id\": 2643743,\n   \"name\": \"London\",\n   \"cod\": 200\n}\n</code></pre>\n\n<p>I first thought it was a type mismatch, but 200 is an <code>Int</code> there (unless I'm mistaken?) so I am not sure where the issue lies? <code>\"\"</code> seems to indicate that those 2 keys (<code>id</code> and <code>name</code>) do not exist, but they do. </p>\n\n<p>Any ideas? Thanks in advance.</p>\n"}, {"tags": ["arrays", "haskell", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1517250811, "post_id": 48507631, "comment_id": 84010130, "body": "A <code>StorableArray</code> has to encode/decode its data every time it is written to/from the raw bytes. On the other hand, an <code>IOUArray</code> has a layout that is optimized to fit the shape of the data written to it."}, {"owner": {"reputation": 507, "user_id": 1699488, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a8324cbee30924bddc32c054d19b182e?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/1699488/lemming"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1517253956, "post_id": 48507631, "comment_id": 84011828, "body": "Is there much to encode if I use <code>Word32</code> and <code>Word64</code> elements?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1517255183, "post_id": 48507631, "comment_id": 84012437, "body": "Not really, I agree. That said, the <code>StorableArray</code> path ends up in <code>readWord32OffAddr#</code> while <code>IOUArray</code> has its own dedicated primop: <code>readArray#</code>."}], "owner": {"reputation": 507, "user_id": 1699488, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a8324cbee30924bddc32c054d19b182e?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/1699488/lemming"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1517252894, "creation_date": 1517249999, "last_edit_date": 1517252894, "question_id": 48507631, "link": "https://stackoverflow.com/questions/48507631/why-is-iouarray-faster-than-storablearray-in-haskell-ghc", "title": "Why is IOUArray faster than StorableArray in Haskell/GHC?", "body": "<p>Documentation of <code>StorableArray</code> says:</p>\n\n<blockquote>\n  <p>It is similar to <code>IOUArray</code> but slower. Its advantage is that it's compatible with C.</p>\n</blockquote>\n\n<p>I have checked it in my code, that statement is really true. But I do not understand, why. I assume that <code>StorableArray</code> is plain data without boxing and access via <code>poke</code> and <code>peek</code> is the fastest possible. Why is <code>IOUArray</code> still faster?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1517251956, "post_id": 48507411, "comment_id": 84010770, "body": "Here&#39;s <a href=\"https://stackoverflow.com/a/10028866/\">an existing good solution to the &quot;convert a number&#39;s base&quot; problem</a>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1517252635, "post_id": 48507990, "comment_id": 84011155, "body": "How I could convert <code>&quot;245433110435&quot;</code> to Integer?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1517252871, "post_id": 48507990, "comment_id": 84011280, "body": "Use <code>read</code> or <code>Data.Text.readMaybe</code> if you don&#39;t trust the input is valid."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1517251527, "creation_date": 1517251527, "answer_id": 48507990, "question_id": 48507411, "link": "https://stackoverflow.com/questions/48507411/how-to-use-numeric-showintatbase/48507990#48507990", "title": "How to use &#39;Numeric.showIntAtBase&#39;?", "body": "<p>It is not clear what you are asking:</p>\n\n<blockquote>\n  <p>Does this function work like this?</p>\n</blockquote>\n\n<pre><code>showIntAtBase 6 1025554775 =  245433110435\n</code></pre>\n\n<ol>\n<li>No.  The function defined in Numeric does not work by pattern matching all possible numbers and providing a literal result.</li>\n<li>No. The code you typed is not type correct. You haven't even provided the correct number of arguments.</li>\n</ol>\n\n<p>Notice the type for showIntAtBase:</p>\n\n<pre><code>&gt; :t showIntAtBase\nshowIntAtBase\n  :: (Show a, Integral a) =&gt; a -&gt; (Int -&gt; Char) -&gt; a -&gt; ShowS\n</code></pre>\n\n<p>Expanding for the <code>ShowS</code> type alias we get:</p>\n\n<pre><code>&gt; :t showIntAtBase\nshowIntAtBase\n  :: (Show a, Integral a) =&gt; a -&gt; (Int -&gt; Char) -&gt; a -&gt; String -&gt; String\n</code></pre>\n\n<p>So you need to provide four arguments, not two numbers.  For example, you can use <code>Data.Char.intToDigit</code> to convert integers to characters and you can use the empty string for the suffix string:</p>\n\n<pre><code>&gt; showIntAtBase 6 intToDigit 1025554775 \"\"\n\"245433110435\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 0, "accepted_answer_id": 48507990, "answer_count": 1, "score": 0, "last_activity_date": 1517252789, "creation_date": 1517249156, "last_edit_date": 1517252789, "question_id": 48507411, "link": "https://stackoverflow.com/questions/48507411/how-to-use-numeric-showintatbase", "title": "How to use &#39;Numeric.showIntAtBase&#39;?", "body": "<p>In <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Numeric.html\" rel=\"nofollow noreferrer\">the <code>Numeric</code> module</a>, I find the following function <code>showIntAtBase</code>.\nCould I use for convert a decimal number into a binary or octal number?</p>\n\n<p>Does this function work like this?</p>\n\n<pre><code>showIntAtBase 6 1025554775 =  245433110435\nshowIntAtBase 2 5264564526752765267240006 = 10001011010110100001001110101100111000111110101011111100100100001010110010001000110\n</code></pre>\n\n<p>If it doesn't work this way, can you tell me any predefined ones to do this?</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "is_accepted": true, "score": 5, "last_activity_date": 1517244666, "creation_date": 1517244666, "answer_id": 48506209, "question_id": 48506062, "link": "https://stackoverflow.com/questions/48506062/haskell-newtype-definition/48506209#48506209", "title": "Haskell newtype definition", "body": "<blockquote>\n  <p>How am I getting this result?</p>\n</blockquote>\n\n<p>Lets look at how this is evaluated:</p>\n\n<pre><code>Prod 2 `mappend` Prod 5\n</code></pre>\n\n<p>Yields </p>\n\n<pre><code>Prod 10\n</code></pre>\n\n<p>The back ticks are just sugar for <code>mappend (Prod 2) (Prod 5)</code></p>\n\n<p>This makes sense because of the definition for <code>mappend</code>:</p>\n\n<pre><code>Prod x `mappend` Prod y = Prod (x * y)  \n</code></pre>\n\n<p>It pattern matches against <code>Prod</code> for each argument, and binds their numbers to <code>x</code>, and <code>y</code> respectively. Those two are then multiplied and used to construct a new <code>Prod</code> with their product as the value.</p>\n\n<p>Finally, in order to get the result out of the product you have to use <code>getProd</code>, which just unwraps the value inside of a <code>Prod</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1517244673, "creation_date": 1517244673, "answer_id": 48506213, "question_id": 48506062, "link": "https://stackoverflow.com/questions/48506062/haskell-newtype-definition/48506213#48506213", "title": "Haskell newtype definition", "body": "<p><code>Prod</code> itself doesn't do much; it's just a wrapper around an arbitrary type. Its purpose, though, is to serve as a basis for the given <code>Monoid</code> instance, which is for multiplication. </p>\n\n<p><code>Prod x `mappend` Prod y</code> resolves to <code>x * y</code>, for whatever definition of <code>*</code> is provided by the <code>Num</code> instance for <code>x</code> and <code>y</code>. The call to <code>getProd</code> simply extracts the wrapped value from the result.</p>\n"}], "owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 48506209, "answer_count": 2, "score": 1, "last_activity_date": 1561785835, "creation_date": 1517244145, "last_edit_date": 1561785835, "question_id": 48506062, "link": "https://stackoverflow.com/questions/48506062/haskell-newtype-definition", "title": "Haskell newtype definition", "body": "<p>I don't understand this newtype definition ad the following code ;</p>\n\n<pre><code>newtype Prod a =  Prod { getProd :: a }  \n\ninstance Num a =&gt; Monoid (Prod a) where  \n    mempty = Prod 1  \n    Prod x `mappend` Prod y = Prod (x * y)  \n</code></pre>\n\n<p>Then I run the following query:</p>\n\n<pre><code>Ghci &gt; getProd $ Prod 2 `mappend` Prod 5  \n    -&gt; 10\n</code></pre>\n\n<p>How im getting this result and how is getProd involved with this result? </p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 7, "creation_date": 1517240590, "post_id": 48504923, "comment_id": 84003754, "body": "You could also have <i>algebraic</i> <code>Fractionals</code>. Like for instance <code>(Variable &#39;x&#39; + Constant 1)</code>, etc. to represent <code>x + 1</code>. So in that case you can perform additions, multiplications, etc., but no comparison."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1517241572, "post_id": 48504923, "comment_id": 84004486, "body": "Note that one, with extensions, can define <code>type FractOrd a = (Fractional a, Ord a)</code> to define a more convenient name, if wished."}, {"owner": {"reputation": 846, "user_id": 3450877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/VV0PK.png?s=128&g=1", "display_name": "kylemart", "link": "https://stackoverflow.com/users/3450877/kylemart"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1517241856, "post_id": 48504923, "comment_id": 84004688, "body": "@chi Wasn&#39;t aware of that language feature. Cool!"}, {"owner": {"reputation": 846, "user_id": 3450877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/VV0PK.png?s=128&g=1", "display_name": "kylemart", "link": "https://stackoverflow.com/users/3450877/kylemart"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1517241941, "post_id": 48504923, "comment_id": 84004745, "body": "@WillemVanOnsem Would it be possible to see an executable example that illustrates this, or some documentation?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1517316894, "post_id": 48504923, "comment_id": 84038463, "body": "@kylemart <a href=\"https://github.com/leftaroundabout/Symbolic-math-HaTeX/blob/master/EXAMPLES.md\" rel=\"nofollow noreferrer\">github.com/leftaroundabout/Symbolic-math-HaTeX/blob/master/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 846, "user_id": 3450877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/VV0PK.png?s=128&g=1", "display_name": "kylemart", "link": "https://stackoverflow.com/users/3450877/kylemart"}, "edited": false, "score": 1, "creation_date": 1517241708, "post_id": 48505178, "comment_id": 84004574, "body": "Coming from Java, I see the similarities Haskell&#39;s typeclasses and types share with Java&#39;s interfaces and concrete types. No issues there, just chose the wrong wording. That said, I appreciate the Complex number counterexample \u2014 didn&#39;t think about that before."}, {"owner": {"reputation": 846, "user_id": 3450877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/VV0PK.png?s=128&g=1", "display_name": "kylemart", "link": "https://stackoverflow.com/users/3450877/kylemart"}, "edited": false, "score": 0, "creation_date": 1517287770, "post_id": 48505178, "comment_id": 84022707, "body": "Would it be possible to see an executable example, or documentation, of what @WillemVanOnsem had suggested? I can&#39;t find anything on the topic of algebraic <code>Fractional</code> types."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 8, "last_activity_date": 1517241250, "creation_date": 1517241250, "answer_id": 48505178, "question_id": 48504923, "link": "https://stackoverflow.com/questions/48504923/why-isnt-the-fractional-typeclass-inherently-orderable-in-haskell/48505178#48505178", "title": "Why isn&#39;t the Fractional typeclass inherently orderable in Haskell?", "body": "<p><code>Fractional</code> is not a type, but rather a type class for types supporting real division. Your question then becomes why <code>Fractional</code> doesn't have <code>Ord</code> as a superclass. As for that, <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Complex.html\" rel=\"noreferrer\"><code>Complex</code></a> is a good counterexample of a type supporting division but no sensible total ordering, as would be an algebraic <code>Fractional</code> type <a href=\"https://stackoverflow.com/questions/48504923/why-isnt-the-fractional-type-orderable-in-haskell#comment84003754_48504923\">as suggested by Willem Van Onsem</a>.</p>\n"}], "owner": {"reputation": 846, "user_id": 3450877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/VV0PK.png?s=128&g=1", "display_name": "kylemart", "link": "https://stackoverflow.com/users/3450877/kylemart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 48505178, "answer_count": 1, "score": 2, "last_activity_date": 1517287615, "creation_date": 1517240505, "last_edit_date": 1517287615, "question_id": 48504923, "link": "https://stackoverflow.com/questions/48504923/why-isnt-the-fractional-typeclass-inherently-orderable-in-haskell", "title": "Why isn&#39;t the Fractional typeclass inherently orderable in Haskell?", "body": "<p>Let's say I have the following code:</p>\n\n<pre><code>import Data.List\nf :: (Fractional a) =&gt; [a] -&gt; Int -&gt; a\nf xs n = sort xs !! n\n</code></pre>\n\n<p>This won't compile because <code>sort</code> is of type <code>Ord a =&gt; [a] -&gt; [a]</code>. This seems odd to me, as I figured all <code>Num</code>-type values would be inherently orderable. To fix this issue I would need to add an additional type constraint (i.e. <code>(Fractional a, Ord a) =&gt; [a] -&gt; Int -&gt; a</code>). Looking at Haskell's documentation, this makes sense from a <a href=\"https://www.haskell.org/onlinereport/classes.gif\" rel=\"nofollow noreferrer\">syntactic / hierarchal perspective</a>. </p>\n\n<p>Still, what gives? Why are real values orderable, but not fractional values? I don't understand the rationale.</p>\n"}, {"tags": ["haskell", "testing"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1517223553, "post_id": 48498033, "comment_id": 83992619, "body": "I&#39;m not aware of SmallCheck, but assuming that by \u2124 you mean the set of all integers, I don&#39;t see how, if it were to generate <i>all</i> vectors of length 1, it would ever be able to progress to generating vectors of length 2, and so on."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1517225743, "post_id": 48498033, "comment_id": 83993917, "body": "@MarkSeemann it wouldn&#39;t, but it would e.g. generate all the vectors of length 2 which contain only entries abs-smaller than 3."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517231355, "post_id": 48498033, "comment_id": 83997308, "body": "I wonder why someone down-voted this question. Is it because it looks like a solicitation of opinions?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1517237282, "post_id": 48498033, "comment_id": 84001466, "body": "This question seems like it&#39;s looking for a discussion, rather than concrete answers. Not a good fit for SO IMHO, though it&#39;d be an interesting topic for a blog post."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1517240566, "post_id": 48498033, "comment_id": 84003738, "body": "@Cubic I read through the help center section on good and bad questions again and it still appears to me that my question matches the points for the good better. In particular, <a href=\"https://stackoverflow.com/help/dont-ask\">there is a subsection concerning good subjective questions</a> that I would like to direct your attention to. I will edit my question further in a minute; please tell me what you think after the update."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1517353953, "post_id": 48498033, "comment_id": 84059584, "body": "The way you test your software depends entirely on the particulars of the software. As it stands this question is much too broad; no text short of 500 pages could hope to discuss the &#39;best practices&#39; for testing. Besides this, I think the topic of deterministic vs. randomized testing is fairly well explored; you should identify some specific questions regarding their distinction that would guide you to a solution to your problem."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1517372547, "post_id": 48498033, "comment_id": 84064248, "body": "@user2407038 You say it&#39;s fairly well explored; can you share some links?"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1517241617, "creation_date": 1517218156, "last_edit_date": 1517241617, "question_id": 48498033, "link": "https://stackoverflow.com/questions/48498033/randomized-as-in-quickcheck-versus-deterministic-as-in-smallcheck-property-c", "title": "Randomized (as in QuickCheck) versus deterministic (as in SmallCheck) property checking", "body": "<p>I know of two approaches to property checking:</p>\n\n<ul>\n<li><p>Randomized approach (as in QuickCheck) makes you define a generator of random values for your types, then verifies your invariants for each of a large number of randomly generated cases. For example, in case of a vector space \u2124\u207f (defined, say, as <code>[Word]</code>), it would generate vectors of any length and direction.</p></li>\n<li><p>Deterministic approach (as in SmallCheck) works the same, except that it generates valus from simple and small to more complex and extensive deterministically, covering <em>(as I understand)</em> a small part of domain tightly. For example, in the same case as above, it would generate zero vector, then all vectors of length &lt;= 1, then all vectors of length &lt;= 2, and so on, eventually covering all <em>interesting</em> values (such as unit vectors), for which there may conceivably be unforeseen corner cases that break an invariant.</p></li>\n</ul>\n\n<p>Did I get it correct? What are the benefits and downsides of either approach? What are the preferred use cases for either? Maybe, for best results, both approaches should be combined, say, covering some moderately sized \"base\" with a deterministic checker and then a random sample with a randomized one?</p>\n\n<p>I'm looking for some solid, motivated best practice to use daily and advance from now on.</p>\n\n<hr>\n\n<p>P.S. This question is not intended to provoke discussion. I am asking specifically what benefits either approach to property checking has matter-of-factly, not which is nicer, easier to use or better by any other measure that can be considered a matter of taste. An answer would provide either a critique of the problem posed, a mindful, mathematical observation of the nature of either method of property checking, or a case / experience report that justifies one of the approaches as preferable for a certain class of situations. In the end, I intend this question to generate a set of criteria that help determine which approach to testing will catch more programming mistakes. Put this way, I don't see how this question could be considered subjective in any way other than good, as outlined in <a href=\"https://stackoverflow.com/help/dont-ask\">the rules</a>. There is a <a href=\"https://www.reddit.com/r/haskell/comments/7tq1hl/what_to_favour_for_property_checking_quickcheck/?ref=share&amp;ref_source=link\" rel=\"nofollow noreferrer\">companion reddit thread</a> that offers a channel for more liberal communication.</p>\n"}, {"tags": ["haskell", "math", "functional-programming"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1517230333, "post_id": 48497678, "comment_id": 83996649, "body": "BTW, please don&#39;t call this \u201cinverted\u201d. The inverse of a number is, depending on context, either its additive or multiplicative inverse (i.e. the negative or reciprocal), which are a much more useful quantities. Reversing the decimal digits of a number is something completely unnatural and base-dependent, which has no real practical uses."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1517248033, "post_id": 48497678, "comment_id": 84008657, "body": "Side note: things equivalent to <code>if x == y then True else False</code> are also equivalent to <code>x == y</code>. <code>(==)</code> returns a <code>Bool</code> already. It&#39;s not some special syntax that only works in conditionals."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1517218240, "post_id": 48497935, "comment_id": 83989182, "body": "So, could I do  <code>dropWhile (isCapicua) (iterate (invertedSum) n)</code> for solving?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1517218408, "post_id": 48497935, "comment_id": 83989274, "body": "@aprendiendo-a-programar What would happen if <code>isCapicua</code> never returns <code>False</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1517220045, "post_id": 48497935, "comment_id": 83990263, "body": "The list is infinite"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1517224768, "post_id": 48497935, "comment_id": 83993344, "body": "Why <code>isCapicua</code> never returns <code>False</code>?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1517226398, "post_id": 48497935, "comment_id": 83994268, "body": "@aprendiendo-a-programar I don&#39;t know, I haven&#39;t analysed the problem formally. Have you tried <code>dropWhile (isCapicua) (iterate (invertedSum) n)</code> with various input? Can you guarantee that, for any <code>n</code>, it eventually returns a value?"}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1517231722, "post_id": 48497935, "comment_id": 83997549, "body": "@MarkSeemann the algorithm &quot;usually&quot; converges, but there are notable exceptions (196 is the well known one)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1517233250, "post_id": 48497935, "comment_id": 83998604, "body": "Yes, I know it but I do <code>dropWhile (isCapicua) (iterate (invertedSum) n) == []</code>  I don&#39;t why."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "edited": false, "score": 0, "creation_date": 1517233274, "post_id": 48497935, "comment_id": 83998627, "body": "And if put <code>takeWhile</code> is an infinit list."}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1517237533, "post_id": 48497935, "comment_id": 84001647, "body": "@aprendiendo-a-programar - You probably want to be doing a dropWhile looking for not isCapicua, and then the head of the remaining list will be your isCapua.  Likewise, if you want to know how this transforms, you could do a takeWhile not isCapicua, and that would get you all of the steps to get to the palindrome."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1517217773, "creation_date": 1517217773, "answer_id": 48497935, "question_id": 48497678, "link": "https://stackoverflow.com/questions/48497678/inverted-sum-of-a-number-haskell/48497935#48497935", "title": "Inverted Sum of a Number -- Haskell", "body": "<p>You already have a function <code>invertedSum</code> with the type <code>Integer -&gt; Integer</code>. If I understand the question correctly, you'd like to apply it multiple times, starting with a particular <code>Integer</code> (e.g. <code>1999</code>).</p>\n\n<p>You could use <code>iterate</code> for that purpose. It has the type:</p>\n\n<pre><code>Prelude&gt; :t iterate\niterate :: (a -&gt; a) -&gt; a -&gt; [a]\n</code></pre>\n\n<p>In other words, it'll take any function <code>a -&gt; a</code>, as well as an initial value <code>a</code>, and produce an <em>infinite</em> list of <code>a</code> values.</p>\n\n<p>In your case, <code>invertedSum</code> has the type <code>Integer -&gt; Integer</code>, and the initial value you'd like to use (e.g. <code>1999</code>) would also be of the type <code>Integer</code>, so it all fits: <code>a</code> would be <code>Integer</code>.</p>\n\n<p>Try using <code>invertedSum</code> and e.g. <code>1999</code> with <code>iterate</code>. Be aware that this produces an <em>infinite</em> list, so if you experiment with this in GHCi, you probably want to use e.g. <code>take 10</code> to cap the number of values generated.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 48497935, "answer_count": 1, "score": -1, "last_activity_date": 1517217883, "creation_date": 1517216924, "last_edit_date": 1517217883, "question_id": 48497678, "link": "https://stackoverflow.com/questions/48497678/inverted-sum-of-a-number-haskell", "title": "Inverted Sum of a Number -- Haskell", "body": "<p>I have the following function in Haskell:</p>\n\n<pre><code>invertedSum :: Integer -&gt; Integer\ninvertedSum n = n + (read . reverse . show) n\n</code></pre>\n\n<p>I need to know the number of sums that must be made in order for the number to be capicua. That is to say, </p>\n\n<pre><code>invertedSum 1999 = 11990   (1999+9991)\ninvertedSum 11990 = 21901 \ninvertedSum 21901 = 32813\ninvertedSum 32813 = 64636\ninvertedSum 64636 = 128282\ninvertedSum 128282 = 411103\ninvertedSum 411103 = 712217\n\nisCapicua :: Integer -&gt; Bool\nisCapicua n | show n == (reverse . show) n   = True\n            | otherwise                      = False\n\nisCapicua 712217 == True\n</code></pre>\n\n<p>So, I want to generate the following list, but I don't know how.</p>\n\n<pre><code>sumUpToCapicua 1999 = [11990, 21901, 32813, 64636, 128282, 411103, 712217]\n</code></pre>\n\n<p><code>genericLength (sumUpToCapicua 1000000079994144385) == 259</code></p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 52741, "user_id": 555045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/182d0ce855c8324a596648c04643e8f9?s=128&d=identicon&r=PG", "display_name": "nicomp", "link": "https://stackoverflow.com/users/555045/nicomp"}, "edited": false, "score": 0, "creation_date": 1517197174, "post_id": 48493955, "comment_id": 83981223, "body": "You can even determine this directly by using <code>countTrailingZeros</code>, is that within the scope of this question?"}, {"owner": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1517270909, "post_id": 48493955, "comment_id": 84018861, "body": "@chepner 8=2^3, and 8 is divisible by 4, but it is not a green number"}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 4, "creation_date": 1517196938, "post_id": 48493989, "comment_id": 83981173, "body": "<code>xor</code> is just <code>&#47;=</code>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1517204475, "post_id": 48493989, "comment_id": 83982999, "body": "You only use <code>xor</code> for <code>xor True</code> which is just <code>not</code>."}], "tags": [], "owner": {"reputation": 432, "user_id": 8402427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/6377f77c32066029c46eed228e1e71e4?s=128&d=identicon&r=PG&f=1", "display_name": "DrJessop", "link": "https://stackoverflow.com/users/8402427/drjessop"}, "is_accepted": true, "score": 2, "last_activity_date": 1517197236, "last_edit_date": 1517197236, "creation_date": 1517196765, "answer_id": 48493989, "question_id": 48493955, "link": "https://stackoverflow.com/questions/48493955/even-number-of-2s-in-prime-factorization-of-number/48493989#48493989", "title": "Even number of 2s in prime factorization of number", "body": "<p>You could do this using an exclusive or function. I don't believe this is incorporated into Haskell, so you could make one yourself</p>\n\n<pre><code>xor :: Bool -&gt; Bool -&gt; Bool\nxor True True = False\nxor True False = True\nxor False True = True\nxor False False = False\n\nisGreen :: Int -&gt; Bool\nisGreen num\n    | (num &lt; 0) = isGreen (-num)\n    | (mod num 2 /= 0) = True\n    | num &gt; 1 = xor True (isGreen (div num 2))\n    | num == 1 = True\n</code></pre>\n\n<p>The reason this works is cause we keep flipping between True and False every single time we climb back up the call stack. </p>\n\n<pre><code>Example: isGreen 8 =\nxor True (isGreen 4) = \nxor True (xor True (isGreen 2) =\nxor True (xor True (xor True isGreen 1)) = \nxor True (xor True (xor True True)) = \nxor True (xor True False) = xor True (True) = \nFalse\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1517323983, "creation_date": 1517323983, "answer_id": 48524285, "question_id": 48493955, "link": "https://stackoverflow.com/questions/48493955/even-number-of-2s-in-prime-factorization-of-number/48524285#48524285", "title": "Even number of 2s in prime factorization of number", "body": "<p>Note that your version doesn't give the right answer for odd numbers:</p>\n\n<pre><code>&gt; isGreen 0 3\nFalse\n&gt;\n</code></pre>\n\n<p>because it checks for termination using <code>n == 1</code> when it should use <code>odd n</code> instead.</p>\n\n<p>Anyway, as an alternative, you can construct a direct recursive definition by observing that if <code>x</code> is divisible by 4, then <code>isGreen x</code> is the same as <code>isGreen (x `quot` 4)</code>.  Otherwise, divisibility by 2 will give the answer:</p>\n\n<pre><code>isGreen x | x == 0         = error \"zero is neither green nor not green\"\n          | x `rem` 4 == 0 = isGreen (x `quot` 4)\n          | even x         = False  -- one two left over\n          | otherwise      = True   -- no twos left over\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; map isGreen [1..10]\n[True,False,True,True,True,False,True,False,True,False]\n&gt;\n</code></pre>\n\n<p>As a side note,  I've used <code>quot</code> and <code>rem</code> here out of habit.  At least on Intel architectures and using primitive integer types, they are faster than <code>div</code> and <code>mod</code> when you don't care about the sign of the result, so I've kind of gotten used to using them when testing for divisibility.  Along the same lines, some people might write the second case as:</p>\n\n<pre><code>| let (q,r) = x `quotRem` 4, r == 0 = isGreen q\n</code></pre>\n\n<p>on the grounds that the single <code>quotRem</code> call will save a division over separate <code>rem</code> and <code>quot</code> calls.  Admittedly, both of these optimizations are rather silly here.</p>\n"}], "owner": {"reputation": 45, "user_id": 8448837, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QSALF.jpg?s=128&g=1", "display_name": "Zbit56", "link": "https://stackoverflow.com/users/8448837/zbit56"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 48493989, "answer_count": 2, "score": 1, "last_activity_date": 1517323983, "creation_date": 1517196485, "last_edit_date": 1517323010, "question_id": 48493955, "link": "https://stackoverflow.com/questions/48493955/even-number-of-2s-in-prime-factorization-of-number", "title": "Even number of 2s in prime factorization of number", "body": "<p>I am doing a Haskell practice problem that involves writing a function that returns true if 2 divides an even number of times into a parameter num. If num is odd for example, this returns True since 2 divides in 0 times, and 0 is even. 8 as a parameter returns False, since 2 divides in 3 times, and 3 is odd.\nI know how to do this problem using two parameters, in which the second parameter is a counter, and you keep dividing your first parameter by 2 until it equals 1, and if the counter mod 2 == 0, then return True. But we are supposed to do it with only a number as a parameter,... so how can I do that?\nMy function,</p>\n\n<pre><code>isGreen :: Int -&gt; Int -&gt; Bool\nisGreen num count\n    | (num==1)&amp;&amp;(count `mod` 2 == 0) = True\n    | (num==1)&amp;&amp;(count `mod` 2 /= 0) = False\n    | otherwise = isGreen (div num 2) (count + 1)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1517188925, "post_id": 48493070, "comment_id": 83979557, "body": "The code that you&#39;ve given does compile (although it doesn&#39;t have the type that the prose implies), so it would be helpful if you could post the full code and the error."}], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 7, "last_activity_date": 1517188601, "creation_date": 1517188601, "answer_id": 48493141, "question_id": 48493070, "link": "https://stackoverflow.com/questions/48493070/haskell-how-to-add-a-float-to-all-members-of-an-integer-list/48493141#48493141", "title": "Haskell how to add a float to all members of an integer list", "body": "<p>You'll need to convert each <code>Integer</code> to a <code>Float</code> before you can add a <code>Float</code> to it.</p>\n\n<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:fromInteger\" rel=\"noreferrer\"><code>fromInteger</code></a> for this. Its type is</p>\n\n<pre><code>Num a =&gt; Integer -&gt; a\n</code></pre>\n\n<p>which, for our purpose here, specializes to</p>\n\n<pre><code>Integer -&gt; Float\n</code></pre>\n\n<p>So here's what the <code>addAll</code> function looks like:</p>\n\n<pre><code>addAll :: [Integer] -&gt; [Float]\naddAll xs = map (\\x -&gt; fromInteger x + 3.5) xs\n</code></pre>\n\n<p>Example usage in GHCi:</p>\n\n<pre><code>\u03bb&gt; addAll [1, 2, 3]\n[4.5,5.5,6.5]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 5, "last_activity_date": 1517216303, "last_edit_date": 1517216303, "creation_date": 1517188803, "answer_id": 48493170, "question_id": 48493070, "link": "https://stackoverflow.com/questions/48493070/haskell-how-to-add-a-float-to-all-members-of-an-integer-list/48493170#48493170", "title": "Haskell how to add a float to all members of an integer list", "body": "<h2>What would you expect the result list to be?</h2>\n\n<p>It can be <code>[Float]</code> or <code>[Integer]</code> - in Haskell you should be explicit about that.</p>\n\n<h2>1. <code>[Integer]</code></h2>\n\n<p>You need either to <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:round\" rel=\"nofollow noreferrer\"><code>round</code></a> the floating point number before you multiply:</p>\n\n<pre><code>map (+ (round (3.5 :: Float))) [1..(10 :: Integer)]\n</code></pre>\n\n<h2>2. <code>[Float]</code></h2>\n\n<p>Or convert the integers with <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:fromInteger\" rel=\"nofollow noreferrer\"><code>fromInteger</code></a></p>\n\n<pre><code>[3.5 + fromInteger x | x &lt;- xs]\nmap ((+3.5) . fromInteger) xs\n</code></pre>\n\n<p>as adding numbers only works if both summands are of the same type, you can see this in the type signature</p>\n\n<pre><code>(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>all <code>a</code>s have to be the same and be an instance of the <code>Num</code>-typeclass (much alike an interface in Java, if you have experience with that).</p>\n\n<p>Note: There is no automatic conversion in Haskell<sup>1</sup>.</p>\n\n<p><sub><sup>1</sup>: Except for numeric literals like <code>0,1,2\u2026</code> they are converted using <code>fromInteger</code>, numeric literals like <code>1.1</code>,<code>2.2</code> etc. are converted by <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:fromRational\" rel=\"nofollow noreferrer\"><code>fromRational</code></a> and <code>String</code> literals when you enable <code>OverloadedStrings</code> with <code>fromString</code>.</sub></p>\n"}], "owner": {"reputation": 191, "user_id": 2200597, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/TApUP.jpg?s=128&g=1", "display_name": "Yitzak Hernandez", "link": "https://stackoverflow.com/users/2200597/yitzak-hernandez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1517216303, "creation_date": 1517187944, "question_id": 48493070, "link": "https://stackoverflow.com/questions/48493070/haskell-how-to-add-a-float-to-all-members-of-an-integer-list", "title": "Haskell how to add a float to all members of an integer list", "body": "<p>I'm new to Haskell, but I'm trying to add a float to all members of an integer list in Haskell and I'm having trouble getting past the errors and such.</p>\n\n<p>Basically</p>\n\n<pre><code>addAll xs = map (+3.5) xs\n</code></pre>\n\n<p>Where xs is an integer list.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1517189073, "post_id": 48493027, "comment_id": 83979582, "body": "Why wouldn&#39;t you use a random library - if you want to implement your own random algorithm, a) take care that you make sure it is random enough especially when you want to use it for security/cryptography, b) take a look at the existing libraries like mwc-random."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1517190213, "post_id": 48493027, "comment_id": 83979801, "body": "Where would you want to get your entropy from? In haskell most methods of interacting with the system are provided by libraries, so getting time or reading urandom into a bytestring are both a bit laborious if you don&#39;t use the basic libraries."}, {"owner": {"reputation": 457, "user_id": 7802354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fcf67739c7428f50d20a9d627fa268d?s=128&d=identicon&r=PG&f=1", "display_name": "MasoodS", "link": "https://stackoverflow.com/users/7802354/masoods"}, "edited": false, "score": 0, "creation_date": 1517191051, "post_id": 48493027, "comment_id": 83979965, "body": "That&#39;s true. I was curious about the way Haskell handles this problem since I&#39;m quite new to this."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1517192152, "post_id": 48493027, "comment_id": 83980199, "body": "Which problem is &quot;this problem&quot;? Getting the time? Reading a file as bytes? Extracting a seed from entropic sources? Using a seed to serve numerous requests for random numbers? As it stands your question is too broad for me to want to answer."}, {"owner": {"reputation": 457, "user_id": 7802354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fcf67739c7428f50d20a9d627fa268d?s=128&d=identicon&r=PG&f=1", "display_name": "MasoodS", "link": "https://stackoverflow.com/users/7802354/masoods"}, "edited": false, "score": 0, "creation_date": 1517193444, "post_id": 48493027, "comment_id": 83980447, "body": "I was referring to my question. I was curious to know what does Haskell do behind the scenes. What if I don&#39;t use System.random, what if I want to generate random numbers in a different way. That&#39;s all I asked for."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1517196202, "post_id": 48493027, "comment_id": 83981038, "body": "You can check how <code>System.Random</code> works behind the scenes by clicking the <code>Source</code> links on <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html\" rel=\"nofollow noreferrer\">its documentation page</a>."}, {"owner": {"reputation": 457, "user_id": 7802354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fcf67739c7428f50d20a9d627fa268d?s=128&d=identicon&r=PG&f=1", "display_name": "MasoodS", "link": "https://stackoverflow.com/users/7802354/masoods"}, "edited": false, "score": 0, "creation_date": 1517196523, "post_id": 48493027, "comment_id": 83981096, "body": "very nice, thank you! never thought about that doc page!"}], "answers": [{"comments": [{"owner": {"reputation": 457, "user_id": 7802354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fcf67739c7428f50d20a9d627fa268d?s=128&d=identicon&r=PG&f=1", "display_name": "MasoodS", "link": "https://stackoverflow.com/users/7802354/masoods"}, "edited": false, "score": 0, "creation_date": 1517196542, "post_id": 48493735, "comment_id": 83981098, "body": "Very interesting, Thank you."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 1, "last_activity_date": 1517194303, "creation_date": 1517194303, "answer_id": 48493735, "question_id": 48493027, "link": "https://stackoverflow.com/questions/48493027/how-to-create-a-list-of-random-integers-in-haskell-without-any-library-importing/48493735#48493735", "title": "How to create a list of random integers in Haskell without any library importing (such as System.random)?", "body": "<p>There's no source of entropy exposed in the prelude, so the only way you can make random numbers using only the prelude is if randomness comes from somewhere else. You could read your own external source of entropy, or use an existing one like <code>/dev/urandom</code>. Opening <code>/dev/urandom</code> in binary mode to read it correctly would stray outside of the prelude into <code>System.IO</code> (or better <code>Data.Bytestring</code>).</p>\n\n<p>Without <code>System.IO</code> you can constrain yourself to the portion of the unicode character set that you understand the representation of well. For me that's the lower case letters <code>'a'</code> through <code>'p'</code> which are <code>0x61</code> through <code>0x70</code>.</p>\n\n<pre><code>randomNibbles :: IO [Int]\nrandomNibbles = map (`mod` 16) . filter (&gt; 6 * 16) . filter (&lt;= 7*16) . map fromEnum &lt;$&gt; readFile \"/dev/urandom\"\n</code></pre>\n\n<p>Fundamentally the only way to get entropy from the outside world is with I/O to observe the outside world.</p>\n"}], "owner": {"reputation": 457, "user_id": 7802354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fcf67739c7428f50d20a9d627fa268d?s=128&d=identicon&r=PG&f=1", "display_name": "MasoodS", "link": "https://stackoverflow.com/users/7802354/masoods"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "closed_date": 1517208279, "accepted_answer_id": 48493735, "answer_count": 1, "score": -1, "last_activity_date": 1517268931, "creation_date": 1517187549, "last_edit_date": 1517268931, "question_id": 48493027, "link": "https://stackoverflow.com/questions/48493027/how-to-create-a-list-of-random-integers-in-haskell-without-any-library-importing", "closed_reason": "Needs details or clarity", "title": "How to create a list of random integers in Haskell without any library importing (such as System.random)?", "body": "<p>There are a couple of good answers to questions similar to mine, but all of them (I tried to go over them as much as I could) use System.random library. What is a good idea to write a code in Haskell to create a list with random integers without such library? I think it is interesting to know what is happening behind the scenes when using System.random.</p>\n"}, {"tags": ["string", "haskell", "replace", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 12, "last_activity_date": 1517181055, "last_edit_date": 1517181055, "creation_date": 1517179745, "answer_id": 48492208, "question_id": 48492142, "link": "https://stackoverflow.com/questions/48492142/replace-a-substring-from-a-string-in-haskell/48492208#48492208", "title": "Replace a substring from a string in Haskell", "body": "<p>We can use the <a href=\"http://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text.html#v:replace\" rel=\"noreferrer\"><strong><code>replace :: Text -&gt; Text -&gt; Text -&gt; Text</code></strong></a> function of the <code>Data.Text</code> function. For example:</p>\n\n<pre><code>Prelude Data.Text&gt; replace \"//\" \"..\" \"not really//\"\n\"not really..\"\n</code></pre>\n\n<p>Here we work however on <code>Text</code>s. If that is a problem, we can also use <a href=\"http://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text.html#v:pack\" rel=\"noreferrer\"><strong><code>pack :: String -&gt; Text</code></strong></a> and <a href=\"http://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text.html#v:unpack\" rel=\"noreferrer\"><strong><code>unpack :: Text -&gt; String</code></strong></a> to convert between <code>String</code> and <code>Text</code>. So we can define a function with:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Text(pack, unpack, replace)\n\nreplacedoubleslash :: String -&gt; String\nreplacedoubleslash = unpack . replace \"//\" \"..\" . pack\n</code></pre>\n\n<p>But usually for efficient string processing - both in terms of speed and memory - using <code>Text</code> is better than working with <code>String</code>s.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1517216937, "last_edit_date": 1517216937, "creation_date": 1517183102, "answer_id": 48492594, "question_id": 48492142, "link": "https://stackoverflow.com/questions/48492142/replace-a-substring-from-a-string-in-haskell/48492594#48492594", "title": "Replace a substring from a string in Haskell", "body": "<p>Explicit recursion looks fine here:</p>\n\n<pre><code>replace :: String -&gt; String\nreplace ('/':'/':xs) = '.' : '.' : replace xs\nreplace (x:xs)       = x : replace xs\nreplace \"\"           = \"\"\n</code></pre>\n\n<p>This does not scale to long patterns, but for replacing \"//\" it should work fine.</p>\n"}], "owner": {"reputation": 63, "user_id": 9248357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d808bda6fe5abee6d2a74805ac96ee0?s=128&d=identicon&r=PG&f=1", "display_name": "J. Doe", "link": "https://stackoverflow.com/users/9248357/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3224, "favorite_count": 0, "accepted_answer_id": 48492594, "answer_count": 2, "score": 4, "last_activity_date": 1517216937, "creation_date": 1517179277, "last_edit_date": 1517182794, "question_id": 48492142, "link": "https://stackoverflow.com/questions/48492142/replace-a-substring-from-a-string-in-haskell", "title": "Replace a substring from a string in Haskell", "body": "<p>I have the following string <code>\"not really//\"</code> and I want to write a function that replaces every two slashes <code>\"//\"</code> with two dots <code>\"..\"</code></p>\n\n<p>I thought about using map, but then I would iterate through characters and can't know if a slash is going to be followed by another or not. Any clue how this can be done? (without regex)</p>\n"}, {"tags": ["sockets", "haskell", "systemd", "unix-socket"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1517181360, "post_id": 48492025, "comment_id": 83977902, "body": "That is quite strange. Could it have something to do with flushing? Try exiting the program after the first iteration: <code>main = withSocketsDo $ forever $ getActivatedSockets &gt;&gt;= processSocks &gt;&gt;= \\_ -&gt; exitSuccess</code> (this should be equivalent to the other program without <code>forever</code>)"}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1517193797, "post_id": 48492025, "comment_id": 83980515, "body": "@Li-yaoXia I replaced <code>main</code> with this: <code>main = withSocketsDo $ forever $ getActivatedSockets &gt;&gt;= processSocks &gt;&gt;= \\_ -&gt; exitWith ExitSuccess </code> and the program behaves in the same way as with <code>forever</code> removed. That is it prints the info messages (as in the OP) to the journal and then exits.  Does this information give you any idea of what may be happening? It&#39;s almost like the compiler decides <code>processSockets</code> doesn&#39;t actually <i>do</i> anything and optimises it out."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1517198991, "post_id": 48492025, "comment_id": 83981586, "body": "Try adding <code>hFlush stdout</code> instead of <code>exitWith ExitSuccess</code> there. Also, I&#39;m not sure this is going to be relevant, but this <code>foldl&#39;</code> only ends up processing the last socket in the list. You probably meant to use <code>traverse_</code> instead."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1517207164, "post_id": 48492025, "comment_id": 83983955, "body": "Haven&#39;t worked with systemd, just a wild guess: <code>withSocketsDo $ getActivatedSockets &gt;&gt;= \\ss -&gt; forever $ processSocks ss</code>."}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1517249722, "post_id": 48492025, "comment_id": 84009559, "body": "@Li-yaoXia that works! Thank you! Still uses 100% CPU and the process never ends, but the journal has the lines (from the OP) I expected. I can understand why the process would run the CPU, presumably <code>threadDelay</code> would fix that, but do you know a way to make the code process all the waiting messages on the socket and then exit?"}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1517257218, "post_id": 48492025, "comment_id": 84013539, "body": "@arrowd thanks very much for looking at this; sadly that didn&#39;t change the code&#39;s behaviour. Seems flushing stdout is what&#39;s needed (see Li-yao&#39;s comment above)."}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1517257680, "post_id": 48492025, "comment_id": 84013763, "body": "@Li-yaoXia thank you very much for the recommendation to change <code>foldl&#39;</code> for <code>traverse_</code>. I think you&#39;re right and have updated the code in the question."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1517263346, "post_id": 48492025, "comment_id": 84016337, "body": "Unfortunately I&#39;m not familiar enough with the API to answer your last question."}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1517415925, "post_id": 48492025, "comment_id": 84089403, "body": "@Li-yaoXia I think what you&#39;ve provided is helpful, and adequately answers the question from the title. The bit specific to sockets could be split out into a second question. Would you like to write it up your comments as an answer? I will mark it as the accepted answer if you do."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1517417579, "creation_date": 1517417579, "answer_id": 48547402, "question_id": 48492025, "link": "https://stackoverflow.com/questions/48492025/why-does-forever-mean-this-code-doesnt-read-from-a-socket-or-print-to-stdout/48547402#48547402", "title": "Why does `forever` mean this code doesn&#39;t read from a socket or print to stdout?", "body": "<p>It seems that because <code>stdout</code> is not connected to a terminal, the small output of <code>putStrLn</code> remains buffered and thus does not appear in the logs. This is fixed by calling <code>hFlush</code> regularly, for example:</p>\n\n<pre><code>main = withSocketsDo $ forever $\n  getActivatedSockets &gt;&gt;= processSocks &gt;&gt;= \\_ -&gt; hFlush stdout\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "is_accepted": true, "score": 2, "last_activity_date": 1517492973, "creation_date": 1517492973, "answer_id": 48564350, "question_id": 48492025, "link": "https://stackoverflow.com/questions/48492025/why-does-forever-mean-this-code-doesnt-read-from-a-socket-or-print-to-stdout/48564350#48564350", "title": "Why does `forever` mean this code doesn&#39;t read from a socket or print to stdout?", "body": "<p>OK, first regarding the missing output, it is exactly as <code>Li-yao Xia</code> says, on Linux outputs are block-buffered if written to a pipe.</p>\n\n<p>Change your <code>main</code> to</p>\n\n<pre><code>main = do\n    hSetBuffering stdout LineBuffering\n    withSocketsDo $ forever $ getActivatedSockets &gt;&gt;= processSocks\n</code></pre>\n\n<p>and you will see in <code>journalctl -f</code>:</p>\n\n<pre><code>systemd[1]: Started deploy-trigger.service.\ndeploy-trigger-exe[14197]: Got socket(s).\ndeploy-trigger-exe[14197]: Printing message from socket:\ndeploy-trigger-exe[14197]: Hello world\ndeploy-trigger-exe[14197]: Finished processing socket(s).\ndeploy-trigger-exe[14197]: Got socket(s).\n</code></pre>\n\n<p>After this (expected) output, your program will hang.</p>\n\n<p>How to find out where it hangs? Of course with <code>strace</code> (rumor has it that 95% of all computer problems can be solved with <code>strace</code>).</p>\n\n<pre><code>% sudo strace -fp $(pidof deploy-trigger-exe)\nstrace: Process 14197 attached\n</code></pre>\n\n<p>As we can see, the program is now blocked in <code>accept sock</code>. This makes sense (because the other side has disconnected).</p>\n\n<hr>\n\n<p>Another thing you might be confused about is why it prints <code>Got socket(s)</code> a second time.</p>\n\n<p>I think you have a misunderstanding on how <code>getActivatedSockets</code> works. I conclude so from you writing <code>forever $ getActivatedSockets &gt;&gt;= ...</code>. This suggests to me that you expect that the second time you call <code>getActivatedSockets</code>, it would return something else than the first time (in particular, I suspect that you think it will return <code>Nothing</code> after having \"processed\" the sockets in some way).</p>\n\n<p>But looking at the <a href=\"https://hackage.haskell.org/package/socket-activation-0.1.0.2/docs/src/Network-Socket-Activation.html#getActivatedSockets\" rel=\"nofollow noreferrer\">code of <code>getActivatedSockets</code></a>, it will always return the same result (because it just reads the contents of some environment variables). It thus doesn't seem to make sense to wrap it in <code>forever</code>.</p>\n\n<p>You wrote</p>\n\n<blockquote>\n  <p>the service should process all messages waiting on the socket and then exit</p>\n</blockquote>\n\n<p>To achieve that, I think you should just remove the <code>forever</code>:</p>\n\n<pre><code>main = do\n    hSetBuffering stdout LineBuffering\n    withSocketsDo $ getActivatedSockets &gt;&gt;= processSocks\n    putStrLn \"End of main, exiting\"\n</code></pre>\n\n<p>(When trying this changed code, don't forget to kill the still-running <code>deploy-trigger-exe</code> first.)</p>\n\n<p>You will get:</p>\n\n<pre><code>systemd[1]: Started deploy-trigger.service.\ndeploy-trigger-exe[15881]: Got socket(s).\ndeploy-trigger-exe[15881]: Printing message from socket:\ndeploy-trigger-exe[15881]: Hello world\ndeploy-trigger-exe[15881]: Finished processing socket(s).\ndeploy-trigger-exe[15881]: End of main, exiting\n</code></pre>\n\n<p>which I think is what you are looking for.</p>\n\n<hr>\n\n<p>Another tip: Consider that if you send a large message to the socket, you will have to loop around <code>recv sock ...</code> to receive all the data.</p>\n\n<p><sup>(Quick plug: I'm in the business of helping with problems like this one.)</sup></p>\n"}], "owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 2, "accepted_answer_id": 48564350, "answer_count": 2, "score": 8, "last_activity_date": 1517492973, "creation_date": 1517178422, "last_edit_date": 1517257505, "question_id": 48492025, "link": "https://stackoverflow.com/questions/48492025/why-does-forever-mean-this-code-doesnt-read-from-a-socket-or-print-to-stdout", "title": "Why does `forever` mean this code doesn&#39;t read from a socket or print to stdout?", "body": "<p>I have written a systemd socket activated service in Haskell. The idea is the service should be started automatically when a message is sent to its socket, the service should process all messages waiting on the socket and then exit.</p>\n\n<p>Note: the reason the service should close after processing all waiting messages (as opposed to running forever) is there shall be several hours or days between socket activations.</p>\n\n<p><em>deploy-trigger.socket:</em></p>\n\n<pre><code>[Socket]\nListenStream=/var/run/deploy-trigger.socket\n\n[Install]\nWantedBy=sockets.target\n</code></pre>\n\n<p><em>deploy-trigger.service:</em></p>\n\n<pre><code>[Service]\nExecStart=/home/user4301448/.local/bin/deploy-trigger-exe\nStartLimitInterval=0\n</code></pre>\n\n<p><em>Main.hs</em></p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Control.Monad (forever)\nimport qualified Data.ByteString.Char8 as BS (putStrLn)\nimport Data.Foldable (foldl')\nimport Network.Socket (withSocketsDo, accept, close, SockAddr(SockAddrUnix), Socket)\nimport Network.Socket.ByteString (recv)\nimport Network.Socket.Activation (getActivatedSockets)\nimport System.Exit (exitWith, ExitCode(..))\n\nmain :: IO ()\nmain = withSocketsDo $ forever $ getActivatedSockets &gt;&gt;= processSocks\n\nprocessSocks :: Maybe [Socket] -&gt; IO ()\nprocessSocks (Just socks) = do\n    putStrLn \"Got socket(s).\"\n    traverse_ (\\sock -&gt; accept sock &gt;&gt;= printMsgFromSock) socks\n    putStrLn \"Finished processing socket(s).\"\nprocessSocks Nothing = do\n    putStrLn \"Received no socket(s).\"\n    exitWith ExitSuccess\n\nprintMsgFromSock :: (Socket, SockAddr) -&gt; IO ()\nprintMsgFromSock (sock, sockaddr) = do\n    msg &lt;- recv sock 2048\n    case sockaddr of\n        SockAddrUnix s -&gt; putStrLn (\"Printing message from socket: \" ++ s)\n        _ -&gt; putStrLn \"Printing message from something that is not a UNIX socket.\"\n    BS.putStrLn msg\n    close sock\n</code></pre>\n\n<p>When compiled (and installed with <code>stack install</code>), then activated by sending some text to the socket using the following command:</p>\n\n<pre><code>printf 'Hello world\\r\\n' | nc -U /var/run/deploy-trigger.socket\n</code></pre>\n\n<p>the following is printed to the systemd journal (I'm using <code>journalctl -f</code> to watch the logs):</p>\n\n<pre><code>systemd[1]: Starting deploy-trigger.service...\n</code></pre>\n\n<p>nothing else is printed; the process runs forever and maxes out all the computer's CPU cores. Why does this happen and is there a way to change the behaviour to that described in the first paragraph?</p>\n\n<p>Changing <code>main</code> to the following:</p>\n\n<pre><code>main = withSocketsDo $ getActivatedSockets &gt;&gt;= processSocks\n</code></pre>\n\n<p>thus removing <code>forever</code>, <code>stack install</code>ing again and sending some text to the socket prints the following to the journal:</p>\n\n<pre><code>systemd[1]: Starting deploy-trigger.service...\ndeploy-trigger-exe[14800]: Got socket(s).\ndeploy-trigger-exe[14800]: Printing message from socket:\ndeploy-trigger-exe[14800]: Hello world\ndeploy-trigger-exe[14800]: Finished processing socket(s).\nsystemd[1]: Started deploy-trigger.service.\n</code></pre>\n\n<p><code>deploy-trigger-exe</code> then exits cleanly. The downside to this is the binary appears to be run by systemd for every message sent to the socket, which is not desirable.</p>\n\n<p>Note: I suspect the issue is rooted in my incompetence regarding UNIX sockets. Any answers with supporting information on what I'm misunderstanding, correcting my duff terminology would be a bonus.</p>\n"}, {"tags": ["haskell", "higher-order-functions"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1517176987, "post_id": 48491790, "comment_id": 83976759, "body": "What is this function supposed to do? From what I can see it takes a function as an argument and returns another function. I&#39;m having a difficult time understanding how this is like <code>map</code> which has the type <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code>. Note that <code>map</code> takes <b>two</b> parameters."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1517177071, "post_id": 48491790, "comment_id": 83976786, "body": "You can use <code>mapM</code> with a state monad for instance."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1517177263, "post_id": 48491790, "comment_id": 83976838, "body": "Perhaps you mean <code>statefulMap :: ((a, state) -&gt; (b, state)) -&gt; ([a], state) -&gt; ([b], state)</code>? Note that the extra set of parentheses in your question makes a lot of difference in the type of the function."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1517177280, "post_id": 48491790, "comment_id": 83976842, "body": "Maybe you should look at <code>mapAccumL</code> and variants."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 4, "creation_date": 1517177299, "post_id": 48491790, "comment_id": 83976848, "body": "@Code-Apprentice: no, here the parenthesis are redundant, the two are equal, since the <code>-&gt;</code> operator works <i>right-to-left</i>."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1517177347, "post_id": 48491790, "comment_id": 83976865, "body": "@WillemVanOnsem oh...that&#39;s right.../facepalm"}, {"owner": {"reputation": 23, "user_id": 9280984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4803933a193bca86c1e43804418bb4f?s=128&d=identicon&r=PG&f=1", "display_name": "Masqueey", "link": "https://stackoverflow.com/users/9280984/masqueey"}, "reply_to_user": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1517177735, "post_id": 48491790, "comment_id": 83976978, "body": "@Code-Apprentice in the case of <code>map</code>, you can also apply <code>map</code> on a function to change the function from type <code>(a -&gt; b)</code> to <code>([a] -&gt; [b])</code> which you can then later apply to the second argument. That is what I&#39;m trying to accomplish here, but now while having a state (the <i>carry</i>) being passed between the items in the list <code>[a]</code> (as with full-adders).  You could also view the function I am looking for as type: <code>((a,state) -&gt; (b,state)) -&gt; ([a],state) -&gt; ([b],state)</code> Which already looks a lot more like <code>map</code>."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 9280984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4803933a193bca86c1e43804418bb4f?s=128&d=identicon&r=PG&f=1", "display_name": "Masqueey", "link": "https://stackoverflow.com/users/9280984/masqueey"}, "edited": false, "score": 2, "creation_date": 1517179281, "post_id": 48491996, "comment_id": 83977397, "body": "Wow, thank you, this was exactly what I was looking for! My own answer (that just answered the first part of my question was this: <code>mapr f (x,state) = (map fst (map f (zip x (replicate (length x) state))), state)</code> Which looks a lot more messy that yours."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1517185590, "last_edit_date": 1517185590, "creation_date": 1517178251, "answer_id": 48491996, "question_id": 48491790, "link": "https://stackoverflow.com/questions/48491790/stateful-version-of-map-haskell/48491996#48491996", "title": "Stateful version of map (Haskell)", "body": "<p>This actually already exists: we can use a <a href=\"https://wiki.haskell.org/State_Monad\" rel=\"nofollow noreferrer\"><em>state monad</em></a> and use the <em>monadic</em> version of <code>map</code>: <code>mapM</code>.</p>\n\n<p>For instance we can write a function for a full adder. Here I think with <em>state</em> you mean the carry that the previous full adder has generated.</p>\n\n<p>So we can make a <em>full adder</em> as:</p>\n\n<pre><code>import Control.Monad.State.Lazy\n\nfa :: (Bool, Bool) -&gt; State Bool Bool\nfa (a, b) = do\n   ci &lt;- get\n   let d = a /= b\n   put ((ci &amp;&amp; d) || (a &amp;&amp; b))\n   return (ci /= d)\n</code></pre>\n\n<p>The type means that we make a function that alters state. The first <code>Bool</code> specifies the type of the state itself (here a boolean, the carry that is <code>True</code> or <code>False</code>), the second <code>Bool</code> specifies what we \"return\" (here a <code>True</code> or <code>False</code> as output for the specific full adder).</p>\n\n<p>Now we can make a <em>stateful</em> map, with <code>mapM</code>:</p>\n\n<pre><code>fullAdders :: [(Bool, Bool)] -&gt; State Bool [Bool]\nfullAdders = mapM fa\n</code></pre>\n\n<p>This thus takes a list of 2-tuples (the inputs for every full adder), and produces a <code>State Bool [Bool]</code>, so the state is still a <code>Bool</code>, but the result now is a list of booleans <code>[Bool]</code>: a list that contains the output for every full adder.</p>\n\n<p>We can now call it with <code>fullAdders [(True, True), (True, False), (False, False), (True, True)]</code> but this will <em>not</em> give us a list of booleans, but a <code>State Bool [Bool]</code>. We can the \"<em>run</em>\" the state monad by specifying the initial state. We can do this by using <code>runState :: State a b -&gt; a -&gt; (a, b)</code>, so we can call it with:</p>\n\n<pre><code>runState (fullAdders [(True, True), (True, False), (False, False), (True, True)]) False\n</code></pre>\n\n<p>this produces:</p>\n\n<pre><code>Prelude Control.Monad.State.Lazy&gt; runState (fullAdders [(True, True), (True, False), (False, False), (True, True)]) False\n([False,False,True,False],True)\n</code></pre>\n\n<p>so a 2-tuple with as first item the result, and as second item the new state (here <code>True</code>, since the carry output of the last full adder will be <code>True</code>).</p>\n"}], "owner": {"reputation": 23, "user_id": 9280984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4803933a193bca86c1e43804418bb4f?s=128&d=identicon&r=PG&f=1", "display_name": "Masqueey", "link": "https://stackoverflow.com/users/9280984/masqueey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 400, "favorite_count": 0, "accepted_answer_id": 48491996, "answer_count": 1, "score": 2, "last_activity_date": 1517185590, "creation_date": 1517176807, "question_id": 48491790, "link": "https://stackoverflow.com/questions/48491790/stateful-version-of-map-haskell", "title": "Stateful version of map (Haskell)", "body": "<p>I have just learned about creating higher-order functions and I want to make a map function that is able to change a function that applies to tuples to have that function apply to a list of that type. (Just like the map function.)\nI am trying to create it in such a way that it has this signature:</p>\n\n<pre><code>statefulMap :: ((a,state) -&gt; (b,state)) -&gt; (([a],state) -&gt; ([b],state))\n</code></pre>\n\n<p>I want to be able to use this function to create a series of full adders, but how do I create this function in the first place?</p>\n"}, {"tags": ["haskell", "profiling", "haskell-platform"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1517172537, "post_id": 48490602, "comment_id": 83975315, "body": "I would recommend you to use stack: <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started</a>"}, {"owner": {"reputation": 487, "user_id": 1350864, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/297721694e3e0d742c9789a01ebbbe37?s=128&d=identicon&r=PG", "display_name": "andrepd", "link": "https://stackoverflow.com/users/1350864/andrepd"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1517175489, "post_id": 48490602, "comment_id": 83976337, "body": "But I am using Haskell Platform, as suggested here: <a href=\"https://www.haskell.org/downloads\" rel=\"nofollow noreferrer\">haskell.org/downloads</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1517176065, "post_id": 48490602, "comment_id": 83976491, "body": "The download page also mentions Stack. IMO, it&#39;s much easier and better to just rely on Stack for managing your GHCs."}, {"owner": {"reputation": 487, "user_id": 1350864, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/297721694e3e0d742c9789a01ebbbe37?s=128&d=identicon&r=PG", "display_name": "andrepd", "link": "https://stackoverflow.com/users/1350864/andrepd"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1517238294, "post_id": 48490602, "comment_id": 84002178, "body": "Okay, but the Haskell Platform feature specifically list mentions &quot;Support for profiling and code coverage analysis&quot;. I don&#39;t see how to enable this, though."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1517609671, "post_id": 48490602, "comment_id": 84180460, "body": "@Sibi you really need to stop commenting on every question by telling people to use a different tool. It is not appropriate."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1517609599, "creation_date": 1517609599, "answer_id": 48591613, "question_id": 48490602, "link": "https://stackoverflow.com/questions/48490602/how-to-install-ghc-and-base-with-profiling-support-in-haskell-platform/48591613#48591613", "title": "How to install ghc and base with profiling support, in Haskell Platform", "body": "<p>The Haskell Platform comes with profiling libraries for base. If you've installed the platform, and are using the platform-installed libraries, then you should \"just\" have it already. The only possibility is if you've still got your distro-installed GHC in your path, and are using that instead...</p>\n"}], "owner": {"reputation": 487, "user_id": 1350864, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/297721694e3e0d742c9789a01ebbbe37?s=128&d=identicon&r=PG", "display_name": "andrepd", "link": "https://stackoverflow.com/users/1350864/andrepd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517609599, "creation_date": 1517168723, "question_id": 48490602, "link": "https://stackoverflow.com/questions/48490602/how-to-install-ghc-and-base-with-profiling-support-in-haskell-platform", "title": "How to install ghc and base with profiling support, in Haskell Platform", "body": "<p><a href=\"https://stackoverflow.com/a/31727944/1350864\">This answer</a> to the problem I'm having suggests running e.g. <code>sudo apt-get install ghc-prof</code> on Debian systems to install base libraries with profiling support. However I've installed Haskell Platform (through the 'Generic' option). How do I (re)install ghc/base with profiling support? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1517165594, "post_id": 48489778, "comment_id": 83973111, "body": "I&#39;m really rather sure it has nothing directly to do with applicative functors, but what it <i>has</i> to do with I do not know."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1517165703, "post_id": 48489778, "comment_id": 83973139, "body": "I think &quot;applicative&quot; here relates to function application, not applicative functors. Beyond that, I&#39;m not sure why CAF has &quot;applicative&quot; in the name (especially since not all CAFs are function values)."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1517165811, "post_id": 48489778, "comment_id": 83973171, "body": "I also assumed the first two words had the sense of &quot;constant application&quot;, as in all the application in the syntactic(?) form occurs on constant values (CAFs themselves?), in contrast to a closure. Am I right to call it a &quot;syntactic&quot; notion? It seems you can decide a thing is a CAF by understanding scoping"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1517166626, "post_id": 48490219, "comment_id": 83973417, "body": "Hm. Supercombinators have no free variables, right? But I would certainly consider, say, <code>foo = M.fromList [(3,4),(5,6)]</code> a CAF, even though it mentions many free variables (notably and unarguably <code>M.fromList</code>; with more argument <code>(,)</code>, <code>(:)</code>, and <code>[]</code>; to a lesser extent also <code>fromInteger</code>; unclear to me the status of the number literals themselves)."}, {"owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1517167602, "post_id": 48490219, "comment_id": 83973764, "body": "That requires a better formalization what a free variable is. Your <code>foo</code> (or, better say, everything to the right of <code>=</code>) is a CAF, since <code>M.fromList</code> and all other entities you mentioned are not really free variables, but rather references to other CAFs. A free variable would be <code>x</code> in <code>foo x = ... where theMap = M.fromList [(3, 4), (5, 6), (x, x)]</code>. Things get a bit more subtle with type classes, but that&#39;s probably out of scope of the comment space."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1517167602, "post_id": 48490219, "comment_id": 83973765, "body": "@DanielWagner It looks like it can have function applications where the function names are a free variables (I&#39;m guessing there&#39;s a restriction that they are top-level). The <a href=\"https://wiki.haskell.org/Constant_applicative_form\" rel=\"nofollow noreferrer\">Haskell wiki mentions that partially applied functions count as CAFs</a>. Otherwise, I think the only CAFs you <i>could</i> have would be lambdas applied to other lambdas (since the CAF cannot itself be a lambda expression), which doesn&#39;t seem to fit the examples I&#39;ve seen."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1517167776, "post_id": 48490219, "comment_id": 83973824, "body": "@0xd34df00d I would guess that most functions that <code>M.fromList</code> could refer to are not CAFs (since a lot of them probably have the form <code>fromList xs = ...</code>, rather than directly being a partial application of a function or just a direct combination of other CAFs with no outer lambda)."}, {"owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1517168237, "post_id": 48490219, "comment_id": 83973984, "body": "@DavidYoung now that I think of it, a CAF is a supecombinator that has no free variables. So if a CAF refers to a supercombinator that is not a CAF, it doesn&#39;t cancel out its CAFness."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1517175272, "post_id": 48490219, "comment_id": 83976255, "body": "@0xd34df00d That makes sense. It seems like you might need a slightly less common (I think) definition of &quot;free variable&quot; where top-level definition names wouldn&#39;t count as free variables though, right?"}], "tags": [], "owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "is_accepted": false, "score": 1, "last_activity_date": 1517166184, "creation_date": 1517166184, "answer_id": 48490219, "question_id": 48489778, "link": "https://stackoverflow.com/questions/48489778/in-what-sense-is-constant-applicative-form-applicative/48490219#48490219", "title": "In what sense is Constant Applicative Form applicative?", "body": "<p>Every CAF is a supercombinator, and supercombinators are, long story short, functions that take other (possibly nullary) functions and <em>apply</em> them to one another.</p>\n\n<p>So, my understanding of \"applicative\" in the CAF name is as referring to their supercombinatorish nature.</p>\n"}, {"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517193035, "post_id": 48490422, "comment_id": 83980352, "body": "I think I kind of understand what you mean, but I think the answer is not very clear. Maybe you could elaborate on the notion of terms, constants and what applies to what?  As I understand from your post, a thing may be applicative in a sense that it can at any time be applied. Then it has to not be nullary, thus, say, <code>(+)</code> is a binary caf, <code>(+1)</code> is an unary caf, but then <code>(1+1)</code> is a CF, but not caf, because it cannot anymore be applied. In other words: is an expression that evaluates to <code>2</code> still an applicative thing?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517201037, "post_id": 48490422, "comment_id": 83982066, "body": "@Kindaro No, as I explicitly call out in my answer, a thing does not have to &quot;not be nullary&quot; to be considered a CAF; and also your example is not nullary, so wouldn&#39;t even be a counterexample if that were a rule! <code>1+1</code> is the constant <code>(+)</code> applied to the (zero or more) other constants <code>1</code> and <code>1</code>. Even the fully-evaluated form of this, namely <code>2</code>, which <i>is</i> nullary, is a CAF, because it is the constant <code>2</code> applied to zero other constants. ALSO: my answer was not intended to be a definition, so I did not try to be precise; it was intended instead to be a motivation for the choice of terms."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517201449, "post_id": 48490422, "comment_id": 83982137, "body": "@Kindaro And in particular I haven&#39;t given a precise definition of constant because I don&#39;t know what it is, as I detailed in my first comment on 0xd34df00d&#39;s answer. The standard definition appears not to match with the examples typically given of what a CAF is. I even went and looked in SPJ&#39;s Implementation of Functional Programming Languages, supposedly the canonical source, where they also give a definition mentioning the lack of free variables but give examples that include free variables. So I have to admit I&#39;m a bit confused about that point myself!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1517167586, "creation_date": 1517167586, "answer_id": 48490422, "question_id": 48489778, "link": "https://stackoverflow.com/questions/48489778/in-what-sense-is-constant-applicative-form-applicative/48490422#48490422", "title": "In what sense is Constant Applicative Form applicative?", "body": "<p>A term in constant applicative form is a constant applied to (zero or more) other constants. (Of course each of those constants may require quite some computation before they're fully evaluated!)</p>\n"}, {"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 0, "last_activity_date": 1517322352, "creation_date": 1517322352, "answer_id": 48523730, "question_id": 48489778, "link": "https://stackoverflow.com/questions/48489778/in-what-sense-is-constant-applicative-form-applicative/48523730#48523730", "title": "In what sense is Constant Applicative Form applicative?", "body": "<p>I reached out to Haskell Cafe and Stephen Tetley <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2018-January/128508.html\" rel=\"nofollow noreferrer\">kindly clarified</a> this for me. Briefly:</p>\n\n<blockquote>\n  <p>Circa the 1970s and 80s \"applicative\" was often used in the UK as a\n  synonym for functional ...</p>\n</blockquote>\n\n<p>-- So we may kind of paraphrase the \"caf\" as \"cff\".</p>\n\n<p>I will still have to be looking into what this actually means. Stephen suggested a <a href=\"http://thecorememory.com/Next_700.pdf\" rel=\"nofollow noreferrer\">paper</a> that talks, among other things, of <em>applicative expressions</em> which may happen to be the same thing as our applicative forms, but it will take indefinite time for me to get through to making a reasonably well founded statement of whether it is the case, so I will post an answer for now, while  reserving for the possibility of my expanding it after a while.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "answer_count": 3, "score": 8, "last_activity_date": 1521716997, "creation_date": 1517163431, "last_edit_date": 1521716997, "question_id": 48489778, "link": "https://stackoverflow.com/questions/48489778/in-what-sense-is-constant-applicative-form-applicative", "title": "In what sense is Constant Applicative Form applicative?", "body": "<p>I understand a CAF is a <em>form</em> in a sense of it being of specific shape in memory, or one of infinitely many possible <em>graphic</em> representations of some value it can be <em>evaluated</em> to. (<a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/HeapObjects#Thunks\" rel=\"nofollow noreferrer\">It is noted</a> that \"constant applicative form\" is synonymous to \"static thunk\".)</p>\n\n<p>I understand it being <em>constant</em> in that there are <em>no free variables</em> and all the information necessary to evaluate a Constant Form is already contained therein. It's a shape that has no arrows pointing outwards.</p>\n\n<p>But why \"<em>applicative</em>\"? I can't sleep at night due to this. Everyone says caf, caf, but who actually knows what that literally means? Does it have something to do with applicative functors (I guess not)? What other kinds of applicative forms does one get out there?</p>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1517165518, "post_id": 48489622, "comment_id": 83973078, "body": "I doubt there&#39;s a more profound reason than &quot;TH isn&#39;t implemented as a multi-pass thingy&quot;, interesting question anyway though."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1517167754, "post_id": 48489622, "comment_id": 83973818, "body": "@Cubic Is that true though? I would&#39;ve thought that stages would&#39;ve solved that problem... Isn&#39;t GHC already doing a form of this for declarations? <a href=\"https://gist.github.com/harpocrates/cfaf8c45092e17239d7cdcc172e90975\" rel=\"nofollow noreferrer\">Gist example.</a>"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1517170205, "post_id": 48489622, "comment_id": 83974624, "body": "@Alec, your example is not treated by GHC using multiple passes. Rather, GHC cuts up every source file in minimal groups of declarations (but mutually recursive groups cannot be split up) and processes each of these separately.  This is also why TH code can only reference declarations higher in the file, outside the current mutually recursive group."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1517171310, "post_id": 48489622, "comment_id": 83974925, "body": "@DominiqueDevriese wrong choice of words regarding \u201cmultiple pass\u201d. Words aside, is this different from what I\u2019m asking about though?"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1517225023, "post_id": 48489622, "comment_id": 83993485, "body": "Err.. yes, AIUI.  I think Cubic was talking about a scenario where TH would first be executed at stage -2 to generate new stage -1 TH code, which would subsequently be executed to generate actual stage 0 code.  So the TH engine would need to be run twice, the second time on the output of the first stage.  This kind of multi-passness probably has all sorts of practical design consequences that I don&#39;t think TH has currently incorporated..."}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1517162413, "creation_date": 1517162413, "question_id": 48489622, "link": "https://stackoverflow.com/questions/48489622/why-is-there-no-representation-for-th-in-th", "title": "Why is there no representation for TH in TH?", "body": "<p>Note that:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:Exp\" rel=\"nofollow noreferrer\"><code>Exp</code></a> in <code>template-haskell</code> corresponds to <a href=\"https://hackage.haskell.org/package/ghc-8.2.1/docs/HsExpr.html#t:HsExpr\" rel=\"nofollow noreferrer\"><code>HsExpr</code></a> in the GHC AST</li>\n<li><a href=\"https://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:Type\" rel=\"nofollow noreferrer\"><code>Type</code></a> in <code>template-haskell</code> corresponds to <a href=\"https://hackage.haskell.org/package/ghc-8.2.1/docs/HsTypes.html#t:HsType\" rel=\"nofollow noreferrer\"><code>HsType</code></a> in the GHC AST</li>\n<li><a href=\"https://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:Dec\" rel=\"nofollow noreferrer\"><code>Dec</code></a> in <code>template-haskell</code> corresponds to <a href=\"https://hackage.haskell.org/package/ghc-8.2.1/docs/HsDecls.html#t:HsDecl\" rel=\"nofollow noreferrer\"><code>HsDecl</code></a> in the GHC AST</li>\n</ul>\n\n<p>However, there is one set of constructors missing in the <code>template-haskell</code> types: those pertaining to TH splices and quasiquotes. For example, why doesn't <code>Exp</code> have a constructor of the following form?</p>\n\n<pre><code>SpliceE :: Exp -&gt; Exp\n</code></pre>\n\n<p>I've stumbled across this <a href=\"https://github.com/bmillwood/haskell-src-meta/issues/9\" rel=\"nofollow noreferrer\">here</a> too. I'd like to know if there is something fundamental about this, or there is just extra work to be done fleshing out the TH types? I suspect the issue is that with this, one could send TH into an infinite loop - have a splice generating another splice, and so on. That said, there are already many ways of making the GHC diverge... :)</p>\n\n<hr>\n\n<p>My use case is wanting to have an extra TH stage (so that I can lift a value to the type level - in the parent stage it is a value, but I can generate code with that value lifted to the type level for the child stage using <a href=\"https://stackoverflow.com/a/46718353/3072788\"><code>promote</code></a>)</p>\n"}, {"tags": ["haskell", "category-theory", "catamorphism"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517195194, "post_id": 48493241, "comment_id": 83980842, "body": "This is some spectacular <i>type tennis</i> proficiency. Can you advise a reading with a more extensive and rigorous treatment of such matters?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1517271022, "post_id": 48493241, "comment_id": 84018888, "body": "@Kindaro hmm, I don&#39;t think I do know of anywhere to find a full proof, sorry. I&#39;m speaking merely from a broad understanding of how monads differ from applicatives, not from a rigorous formal basis. You might have fun writing such a proof yourself - I expect it&#39;d be proved by contradiction (&quot;assume <code>cataA</code> can be implemented ... thus a contradiction&quot;)."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1517189934, "last_edit_date": 1517189934, "creation_date": 1517189504, "answer_id": 48493241, "question_id": 48489398, "link": "https://stackoverflow.com/questions/48489398/granted-a-traversable-f-algebra-is-it-possible-to-have-a-catamorphism-over-an-a/48493241#48493241", "title": "Granted a traversable F-Algebra, is it possible to have a catamorphism over an applicative algebra?", "body": "<blockquote>\n  <p>Can I safely conclude that only flat structures can be folded with applicative effects alone?</p>\n</blockquote>\n\n<p>You can say that again! After all, \"flattening nested structures\" is exactly what makes a monad a monad, rather than <code>Applicative</code> which can only combine adjacent structures. Compare (a version of) the signatures of the two abstractions:</p>\n\n<pre><code>class Functor f =&gt; Applicative f where\n    pure :: a -&gt; f a\n    (&lt;.&gt;) :: f a -&gt; f b -&gt; f (a, b)\n\nclass Applicative m =&gt; Monad m where\n    join :: m (m a) -&gt; m a\n</code></pre>\n\n<p>What <code>Monad</code> adds to <code>Applicative</code> is the ability to flatten <em>nested</em> <code>m</code>s into one <code>m</code>. That's why <code>[]</code>'s <code>join</code> is <code>concat</code>. <code>Applicative</code> only lets you smash together heretofore-unrelated <code>f</code>s.</p>\n\n<p>It's no coincidence that the free monad's <code>Free</code> constructor contains a whole <code>f</code> full of <code>Free f</code>s, whereas the free applicative's <code>Ap</code> constructor only contains one <code>Ap f</code>.</p>\n\n<pre><code>data Free f a = Return a | Free (f (Free f a))\ndata Ap f a where\n    Pure :: a -&gt; Ap f a\n    Cons :: f a -&gt; Ap f b -&gt; Ap f (a, b)\n</code></pre>\n\n<p>Hopefully that gives you some intuition as to why you should expect that it's not possible to fold a tree using an <code>Applicative</code>.</p>\n\n<p>Let's play a little <em>type tennis</em> to see how it shakes out. We want to write</p>\n\n<pre><code>cataA :: (Traversable f, Applicative m) =&gt; (f a -&gt; m a) -&gt; Fix f -&gt; m a\ncataA f (Fix xs) = _\n</code></pre>\n\n<p>We have <code>xs :: f (Fix f)</code> and a <code>Traversable</code> for <code>f</code>. My first instinct here is to <code>traverse</code> the <code>f</code> to fold the contained subtrees:</p>\n\n<pre><code>cataA f (Fix xs) = _ $ traverse (cataA f) xs\n</code></pre>\n\n<p>The hole now has a goal type of <code>m (f a) -&gt; m a</code>. Since there's an <code>f :: f a -&gt; m a</code> knocking about, let's try going under the <code>m</code> to convert the contained <code>f</code>s:</p>\n\n<pre><code>cataA f (Fix xs) = _ $ fmap f $ traverse (cataA f) xs\n</code></pre>\n\n<p>Now we have a goal type of <code>m (m a) -&gt; m a</code>, which is <code>join</code>. So you do need a <code>Monad</code> after all.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 48493241, "answer_count": 1, "score": 5, "last_activity_date": 1517193636, "creation_date": 1517161126, "last_edit_date": 1517193636, "question_id": 48489398, "link": "https://stackoverflow.com/questions/48489398/granted-a-traversable-f-algebra-is-it-possible-to-have-a-catamorphism-over-an-a", "title": "Granted a traversable F-Algebra, is it possible to have a catamorphism over an applicative algebra?", "body": "<p>I have this F-Algebra (<a href=\"https://stackoverflow.com/questions/48488021\">introduced in a previous question</a>), and I want to cast an effectful algebra upon it. Through desperate trial, I managed to put together a monadic catamorphism that works. I wonder if it may be generalized to an applicative, and if not, why.</p>\n\n<p>This is how I defined <code>Traversable</code>:</p>\n\n<pre><code>instance Traversable Expr where\n    traverse f (Branch xs) = fmap Branch $ traverse f xs\n    traverse f (Leaf   i ) = pure $ Leaf i\n</code></pre>\n\n<p>This is the monadic catamorphism:</p>\n\n<pre><code>type AlgebraM a f b = a b -&gt; f b\n\ncataM :: (Monad f, Traversable a) =&gt; AlgebraM a f b -&gt; Fix a -&gt; f b\ncataM f x = f =&lt;&lt; (traverse (cataM f) . unFix $ x)\n</code></pre>\n\n<p>And this is how it works:</p>\n\n<pre><code>\u03bb let printAndReturn x = print x &gt;&gt; pure x\n\u03bb cataM (printAndReturn . evalSum) $ branch [branch [leaf 1, leaf 2], leaf 3]\n1\n2\n3\n3\n6\n6\n</code></pre>\n\n<p>My idea now is that I could rewrite like this:</p>\n\n<pre><code>cataA :: (Applicative f, Traversable a) =&gt; AlgebraM a f b -&gt; Fix a -&gt; f b\ncataA f x = do\n    subtree &lt;- traverse (cataA f) . unFix $ x\n    value &lt;- f subtree\n    return value\n</code></pre>\n\n<p>Unfortunately, <code>value</code> here depends on <code>subtree</code> and, <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/08/desugaring-haskell-haskell16.pdf\" rel=\"nofollow noreferrer\">according to a paper on applicative do-notation</a>, in such case we cannot desugar to Applicative. It seems like there's no way around this; we need a monad to float up from the depths of nesting.</p>\n\n<p>Is it true? Can I safely conclude that only flat structures can be folded with applicative effects alone?</p>\n"}, {"tags": ["mongodb", "haskell", "filter"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1517158366, "post_id": 48488689, "comment_id": 83970444, "body": "What have you tried? Do you know the type of the function you want?"}, {"owner": {"reputation": 3, "user_id": 9280145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d379633d0f56e9fd50e5b216921e559a?s=128&d=identicon&r=PG&f=1", "display_name": "user9280145", "link": "https://stackoverflow.com/users/9280145/user9280145"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1517162127, "post_id": 48488689, "comment_id": 83971911, "body": "For the type of the function, I&#39;m thinking <code>String -&gt; String -&gt; Document</code> (property -&gt; value -&gt; returns the document matching). I haven&#39;t tried much, but I imaging doing some kind of <code>filter</code> over the docs, then <code>filter</code> over the [Field] till I find the one that match, but not sure if it is the right way... @ThomasM.DuBuisson"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1517172992, "creation_date": 1517172992, "answer_id": 48491211, "question_id": 48488689, "link": "https://stackoverflow.com/questions/48488689/searching-a-list-of-document-from-mongodb/48491211#48491211", "title": "searching a list of [Document] from mongodb", "body": "<p>A function of type <code>String -&gt; String -&gt; Document</code> will construct a new document from two strings.  It doesn't strike me as helpful in building a function <code>[Document] -&gt; t Document</code> or what I thought you might want of <code>MonadIO m =&gt; Document -&gt; m (Maybe Document)</code>.</p>\n\n<p>First off, remember a document is just a list of Fields:</p>\n\n<pre><code>type Document = [Field]\ndata Field = Label := Value\ntype Label = Text\ndata Value = ... a big sum type like Aeson's value.\n</code></pre>\n\n<p>You haven't told us what properties you want to search for so let's assume you can write a function <code>goodDocument :: [Field] -&gt; Bool</code>.  Then you can simply apply this function:</p>\n\n<pre><code>docs &lt;- filter goodDocument &lt;$&gt; rest =&lt;&lt; access pipe ReadStaleOk \"mydb\" (find (select [] \"my_collection\")\n</code></pre>\n\n<p>To get any more specific you'd have to be more explicit about how you identify good documents.</p>\n"}], "owner": {"reputation": 3, "user_id": 9280145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d379633d0f56e9fd50e5b216921e559a?s=128&d=identicon&r=PG&f=1", "display_name": "user9280145", "link": "https://stackoverflow.com/users/9280145/user9280145"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 48491211, "answer_count": 1, "score": 0, "last_activity_date": 1517172992, "creation_date": 1517157570, "question_id": 48488689, "link": "https://stackoverflow.com/questions/48488689/searching-a-list-of-document-from-mongodb", "title": "searching a list of [Document] from mongodb", "body": "<p>I'm loading a list of document from a mongodb collection using:</p>\n\n<pre><code>let docs = access pipe ReadStaleOk \"mydb\" (find (select [] \"my_collection\") &gt;&gt;= rest)\n</code></pre>\n\n<p>Now, I'd like to search the docs list for certain properties after the query has been executed. I need to do it that way because I can't filter in the query, I want to load all documents in one shot, and then filter for what I need when I need it.</p>\n\n<p>Any pointer appreciated.</p>\n"}, {"tags": ["email", "haskell", "amazon-ses", "mime-mail"], "comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1517175576, "post_id": 48488558, "comment_id": 83976362, "body": "Email messages have two &quot;from&quot; values -- the one in the message headers, which is the one that gets formatted with the display name -- and the envelope sender, which is in the form <code>&lt;nospam@example.com&gt;</code>.  <code>sesFrom</code> looks like it is specifying the latter.  I&#39;m not familiar enough with your language to figure out where your message actually gets rendered into MIME format, with the headers, but perhaps this comment will give you a hint that you can work with -- there should be two places where the &quot;sender&quot; is set."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1517219477, "post_id": 48488558, "comment_id": 83989915, "body": "@Michael-sqlbot, <code>sesFrom</code> specifies the <code>Source</code> field which according to <a href=\"https://docs.aws.amazon.com/ses/latest/APIReference/API_SendRawEmail.html\" rel=\"nofollow noreferrer\">documentation</a> does contain some notion of &quot;friendly name&quot;. But I do not see the rules there."}], "answers": [{"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 1, "last_activity_date": 1517220742, "creation_date": 1517220742, "answer_id": 48498785, "question_id": 48488558, "link": "https://stackoverflow.com/questions/48488558/how-do-i-send-an-email-via-mime-mail-ses-which-has-a-proper-from-name/48498785#48498785", "title": "How do I send an email via mime-mail-ses which has a proper &quot;from&quot; name?", "body": "<p>OK, got it. Instead of writing <code>\"\\\"My Name\\\" &lt;mymail@gmail.com&gt;\" :: Address</code> and relying on <code>OverloadedStrings</code> one should write</p>\n\n<pre><code>Address (Just \"Ny Name\") \"mymail@gmail.com\"\n</code></pre>\n\n<p>I'd say the library should parse <code>\"\\\"My Name\\\" &lt;mymail@gmail.com&gt;\"</code> into that address, but whatever.</p>\n"}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 48498785, "answer_count": 1, "score": 1, "last_activity_date": 1517220742, "creation_date": 1517156877, "last_edit_date": 1517218555, "question_id": 48488558, "link": "https://stackoverflow.com/questions/48488558/how-do-i-send-an-email-via-mime-mail-ses-which-has-a-proper-from-name", "title": "How do I send an email via mime-mail-ses which has a proper &quot;from&quot; name?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/mime-mail-ses-0.4.0.0/docs/src/Network-Mail-Mime-SES.html#SES\" rel=\"nofollow noreferrer\"><code>SES</code></a> data type has the <code>sesFrom</code> field. Everywhere on the Internet I see that I should write something like <code>\"\\\"My Name\\\" &lt;mymail@gmail.com&gt;\"</code> in order to display <code>My Name</code> in the \"from\" field. But when I put this into the <code>sesFrom</code> field I get</p>\n\n<pre><code>Not sent due to SESException {seStatus = Status {statusCode = 400, statusMessage = \"Bad Request\"}, seCode = \"InvalidParameterValue\", seMessage = \"Missing '&lt;'\", seRequestId = \"acf8bb7d-0440-11e8-94c8-45570c829243\"}\n</code></pre>\n\n<p>I checked sources and all seems to be fine there. How do I set the <code>sesFrom</code> field, so a name is displayed?</p>\n"}, {"tags": ["c#", "haskell", "functional-programming", "nullable", "functor"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1517154630, "post_id": 48488178, "comment_id": 83969247, "body": "The easiest way is <code>if (x.hasValue) x = (int?) f(x.value)</code>..."}, {"owner": {"reputation": 235601, "user_id": 60761, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5bf43bae0431d8f4a062234b5e3a0cb9?s=128&d=identicon&r=PG&f=1", "display_name": "Henk Holterman", "link": "https://stackoverflow.com/users/60761/henk-holterman"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 1, "creation_date": 1517155084, "post_id": 48488178, "comment_id": 83969394, "body": "@user202729 - There is no reason for the <code>(int?)</code> return cast."}, {"owner": {"reputation": 304245, "user_id": 216074, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/609c93bafd659500f83fde04802a9be5?s=128&d=identicon&r=PG", "display_name": "poke", "link": "https://stackoverflow.com/users/216074/poke"}, "edited": false, "score": 0, "creation_date": 1517155642, "post_id": 48488178, "comment_id": 83969600, "body": "I guess Haskell uses type inference there to make <code>Foo</code> have the type <code>a -&gt; a</code>. But if this was an explicit <code>int -&gt; int</code> (or <code>Just int -&gt; Just int</code>?), I\u2019m sure that Haskell also wouldn\u2019t allow you to pass a <code>Maybe int</code> in that case. And that\u2019s exactly what C# does here: The function cannot take a nullable int, so you have to pass it an actual int."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 304245, "user_id": 216074, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/609c93bafd659500f83fde04802a9be5?s=128&d=identicon&r=PG", "display_name": "poke", "link": "https://stackoverflow.com/users/216074/poke"}, "edited": false, "score": 0, "creation_date": 1517155751, "post_id": 48488178, "comment_id": 83969632, "body": "<code>Nullable&lt;T&gt;</code> does not have a method like <code>fmap</code>(or in the csharp world: <code>Select</code>). You can quite easily add an extension method for it, or even roll out your own option-type (and you can even make it so it can take any T, not just value-types).   @poke haskell has a generic function <code>fmap</code> with the signature <code>Functor f =&gt; (a -&gt; b) -&gt; (f a -&gt; f b)</code>, so you can use it to turn a function <code>Int -&gt; Int</code> to a function <code>Maybe Int -&gt; Maybe Int</code>. It&#39;s basically the same as <code>Select()</code> you know in LINQ, just with generalized types(works for any <code>Functor</code>)"}, {"owner": {"reputation": 304245, "user_id": 216074, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/609c93bafd659500f83fde04802a9be5?s=128&d=identicon&r=PG", "display_name": "poke", "link": "https://stackoverflow.com/users/216074/poke"}, "edited": false, "score": 0, "creation_date": 1517156277, "post_id": 48488178, "comment_id": 83969792, "body": "So basically <code>Func&lt;TIn?, TOut?&gt; fmap&lt;TIn, TOut&gt;(Func&lt;TIn, TOut&gt; func) where TIn : struct where TOut : struct =&gt; (x) =&gt; x.HasValue ? func(x.Value) : (TOut?)null;</code>"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 1, "creation_date": 1517156447, "post_id": 48488178, "comment_id": 83969834, "body": "Yes, that&#39;s the signature for <code>fmap</code> for the <code>Nullable&lt;T&gt;</code> type(if it was an instance method), basically the same as Willem&#39;s answer. The signature is just like <code>Select</code>, except instead of <code>IEnumerable</code> we have <code>Nullable</code>. If you do use the name <code>Select</code> you can even use it as a LINQ query(and maybe add <code>Where</code> and <code>SelectMany</code>). <a href=\"https://github.com/jb55/Data.Maybe.cs\" rel=\"nofollow noreferrer\">Here&#39;s a github repo I found where someone rolled out his own <code>Maybe</code> type</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6341, "user_id": 209568, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6127bcd1a5b5823106da0a9e1fb07a57?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/209568/adam"}, "edited": false, "score": 0, "creation_date": 1517171540, "post_id": 48488388, "comment_id": 83975007, "body": "Really? Can you call <code>x.Fmap(foo)</code> if <code>x</code> is null. Surely x dot anything will throw a null pointer exception if <code>x</code> is null?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 6341, "user_id": 209568, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6127bcd1a5b5823106da0a9e1fb07a57?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/209568/adam"}, "edited": false, "score": 2, "creation_date": 1517171635, "post_id": 48488388, "comment_id": 83975040, "body": "@Adam: the above is with <code>Nullable&lt;T&gt;</code> types (so if the type is <code>int?</code>, etc.). And furthermore no! Not every <code>null.foo(..)</code> will throw a null pointer exception, since you can introduce extension methods."}, {"owner": {"reputation": 966, "user_id": 1755715, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/J3dKX.png?s=128&g=1", "display_name": "Nat", "link": "https://stackoverflow.com/users/1755715/nat"}, "reply_to_user": {"reputation": 6341, "user_id": 209568, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6127bcd1a5b5823106da0a9e1fb07a57?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/209568/adam"}, "edited": false, "score": 2, "creation_date": 1517189221, "post_id": 48488388, "comment_id": 83979609, "body": "@Adam That&#39;s actually one of the really cool features of extension methods - externally, they look like instance methods, but they can be called on <code>null</code> objects without error!  &#39;course it means that the extension method itself needs to check if the <code>this</code> parameter (which has a name instead of &quot;<code>this</code>&quot;) is <code>null</code> or not."}, {"owner": {"reputation": 22993, "user_id": 1394393, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mSjIL.jpg?s=128&g=1", "display_name": "jpmc26", "link": "https://stackoverflow.com/users/1394393/jpmc26"}, "edited": false, "score": 0, "creation_date": 1517192072, "post_id": 48488388, "comment_id": 83980182, "body": "Why use the <code>delegate</code> syntax instead of a lambda? Is there a functional difference?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "reply_to_user": {"reputation": 966, "user_id": 1755715, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/J3dKX.png?s=128&g=1", "display_name": "Nat", "link": "https://stackoverflow.com/users/1755715/nat"}, "edited": false, "score": 2, "creation_date": 1517194795, "post_id": 48488388, "comment_id": 83980744, "body": "@Nat I don&#39;t consider that a &quot;really cool feature&quot; but an &quot;unfortunate side effect&quot;. The introduction of extension methods changes some pretty fundamental properties of the language. Before extension methods, you could rely on the fact that after <code>x.Foo()</code>, <code>x</code> could be assumed non-null."}, {"owner": {"reputation": 966, "user_id": 1755715, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/J3dKX.png?s=128&g=1", "display_name": "Nat", "link": "https://stackoverflow.com/users/1755715/nat"}, "reply_to_user": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1517195866, "post_id": 48488388, "comment_id": 83980968, "body": "@DerekElkins I tend to enjoy it because the type can assert its own <code>null</code>-handling behavior.  For example, I enjoy being able to write <code>.ToString()</code>-like methods that return meaningful results on null values, e.g. <code>null.ToString()</code> might return <code>&quot;null&quot;</code>.  Then numeric nullables can basically behave like <code>NaN</code>&#39;s (or <code>0</code>&#39;s, etc., if appropriate).  Then for action-performing methods, e.g. <code>.Update()</code>, <code>null.Update()</code> can simply not perform an action.  It&#39;s relieving for callers to not have to worry about handling the call-target&#39;s <code>null</code> behavior for the call target."}, {"owner": {"reputation": 22380, "user_id": 284111, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7540f1aac4d78cc963f6551e8307b757?s=128&d=identicon&r=PG", "display_name": "Andrew Savinykh", "link": "https://stackoverflow.com/users/284111/andrew-savinykh"}, "reply_to_user": {"reputation": 22993, "user_id": 1394393, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mSjIL.jpg?s=128&g=1", "display_name": "jpmc26", "link": "https://stackoverflow.com/users/1394393/jpmc26"}, "edited": false, "score": 0, "creation_date": 1517208190, "post_id": 48488388, "comment_id": 83984372, "body": "@jpmc26 probably for making the type explicit? One can argue that it reads better. Could be rewritten as <code>public static Func&lt;T?, R?&gt; Fmap&lt;T, R&gt;(Func&lt;T, R&gt; f) where T : struct where R : struct =&gt; x =&gt; x != null ? (R?) f(x.Value) : null;</code> otherwise."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 15, "last_activity_date": 1517157487, "last_edit_date": 1517157487, "creation_date": 1517155756, "answer_id": 48488388, "question_id": 48488178, "link": "https://stackoverflow.com/questions/48488178/can-nullable-be-used-as-a-functor-in-c/48488388#48488388", "title": "Can Nullable be used as a functor in C#?", "body": "<p>We can implement such functionality ourselves:</p>\n\n<pre><code>public static class FuncUtils {\n\n    public static Nullable&lt;R&gt; Fmap&lt;T, R&gt;(this Nullable&lt;T&gt; x, Func&lt;T, R&gt; f)\n        where T : struct\n        where R : struct {\n        if(x != null) {\n            return f(x.Value);\n        } else {\n            return null;\n        }\n    }\n\n}\n</code></pre>\n\n<p>Then we can use it with:</p>\n\n<pre><code>int? x = 0;\nx = x.Fmap(Foo);\n</code></pre>\n\n<p>It will thus call the function <code>Foo</code> if <code>x</code> is not <code>null</code>. It will wrap the result back in a <code>Nullable&lt;R&gt;</code>. In case <code>x</code> is <code>null</code>, it will return a <code>Nullable&lt;R&gt;</code> with <code>null</code>.</p>\n\n<p>Or we can write a more equivalent function (like <code>fmap</code> in Haskell) where we have a function <code>Fmap</code> that takes as input a <code>Func&lt;T, R&gt;</code> and returns a <code>Func&lt;Nullable&lt;T&gt;, Nullable&lt;R&gt;&gt;</code> so that we can then use it for a certain <code>x</code>:</p>\n\n<pre><code>public static class FuncUtils {\n\n    public static Func&lt;Nullable&lt;T&gt;, Nullable&lt;R&gt;&gt; Fmap&lt;T, R&gt;(Func&lt;T, R&gt; f)\n        where T : struct\n        where R : struct {\n        return delegate (Nullable&lt;T&gt; x) {\n            if(x != null) {\n                return f(x.Value);\n            } else {\n                return null;\n            }\n        };\n    }\n\n}\n</code></pre>\n\n<p>We can then use it like:</p>\n\n<pre><code>var fmapf = FuncUtils.Fmap&lt;int, int&gt;(Foo);\nfmapf(null);  // -&gt; null\nfmapf(12);    // -&gt; Foo(12) as int?\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 54636, "user_id": 1336654, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b1fcddf43425d951bb5dafef53563d45?s=128&d=identicon&r=PG", "display_name": "Jeppe Stig Nielsen", "link": "https://stackoverflow.com/users/1336654/jeppe-stig-nielsen"}, "is_accepted": false, "score": 4, "last_activity_date": 1517155928, "creation_date": 1517155928, "answer_id": 48488416, "question_id": 48488178, "link": "https://stackoverflow.com/questions/48488178/can-nullable-be-used-as-a-functor-in-c/48488416#48488416", "title": "Can Nullable be used as a functor in C#?", "body": "<p>If you have an extension method:</p>\n\n<pre><code>public int Foo(this int a)\n{\n    // ...\n}\n</code></pre>\n\n<p>you can do:</p>\n\n<pre><code>// in some other method\n\nint? x = 0;\n\nx = x?.Foo();\n</code></pre>\n\n<p>The <code>?.</code> operator will ensure <code>Foo</code> is called only if <code>x</code> is not null. If <code>x</code> is null, it is not called (a null of the return type is used instead).</p>\n\n<hr>\n\n<p>Otherwise, the canonical way to write it is naturally:</p>\n\n<pre><code>x = x.HasValue ? Foo(x.Value) : (int?)null;\n</code></pre>\n\n<p>Of course you can create your own <code>Maybe</code> infrastructure if you will (Willem Van Onsem's answer).</p>\n"}, {"comments": [{"owner": {"reputation": 2202, "user_id": 1399272, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/FoRYg.png?s=128&g=1", "display_name": "Bondolin", "link": "https://stackoverflow.com/users/1399272/bondolin"}, "edited": false, "score": 0, "creation_date": 1594733857, "post_id": 48490711, "comment_id": 111225062, "body": "I have a somewhat related question here - <a href=\"https://stackoverflow.com/questions/62895696/string-isnullorempty-monad\" title=\"string isnullorempty monad\">stackoverflow.com/questions/62895696/string-isnullorempty-mo&zwnj;&#8203;nad</a>.  I&#39;d appreciate any insights you might have."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 11, "last_activity_date": 1517170238, "last_edit_date": 1517170238, "creation_date": 1517169579, "answer_id": 48490711, "question_id": 48488178, "link": "https://stackoverflow.com/questions/48488178/can-nullable-be-used-as-a-functor-in-c/48490711#48490711", "title": "Can Nullable be used as a functor in C#?", "body": "<h1>Functor</h1>\n\n<p>Not only can you turn <code>Nullable&lt;T&gt;</code> into a functor, but <em>C# actually understands functors</em>, enabling you to write something like this:</p>\n\n<pre><code>x = from x1 in x\n    select Foo(x1);\n</code></pre>\n\n<p>If you prefer method call syntax, that's also possible:</p>\n\n<pre><code>x = x.Select(Foo);\n</code></pre>\n\n<p>In both cases, you need an extension method like this:</p>\n\n<pre><code>public static TResult? Select&lt;T, TResult&gt;(\n    this T? source,\n    Func&lt;T, TResult&gt; selector) where T : struct where TResult : struct\n{\n    if (!source.HasValue)\n        return null;\n\n    return new TResult?(selector(source.Value));\n}\n</code></pre>\n\n<h1>Monad</h1>\n\n<p>Not only does C# understand functors, but it understands monads as well. Add these <code>SelectMany</code> overloads as well:</p>\n\n<pre><code>public static TResult? SelectMany&lt;T, TResult&gt;(\n    this T? source,\n    Func&lt;T, TResult?&gt; selector)\n    where T : struct\n    where TResult : struct\n{\n    if (!source.HasValue)\n        return null;\n\n    return selector(source.Value);\n}\n\npublic static TResult? SelectMany&lt;T, U, TResult&gt;(\n    this T? source,\n    Func&lt;T, U?&gt; k,\n    Func&lt;T, U, TResult&gt; s)\n    where T : struct\n    where TResult : struct\n    where U : struct\n{\n    return source\n        .SelectMany(x =&gt; k(x)\n            .SelectMany(y =&gt; new TResult?(s(x, y))));\n}\n</code></pre>\n\n<p>This enables you to write queries like this:</p>\n\n<pre><code>var result = from x in (int?)6\n             from y in (int?)7\n             select x * y;\n</code></pre>\n\n<p>Here, <code>result</code> is an <code>int?</code> containing the number <code>42</code>.</p>\n"}], "owner": {"reputation": 645, "user_id": 6278979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcf38f4f754c286d03c79c1c48ab473c?s=128&d=identicon&r=PG&f=1", "display_name": "Bobby", "link": "https://stackoverflow.com/users/6278979/bobby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1135, "favorite_count": 2, "accepted_answer_id": 48488388, "answer_count": 3, "score": 15, "last_activity_date": 1517170584, "creation_date": 1517154536, "last_edit_date": 1517170584, "question_id": 48488178, "link": "https://stackoverflow.com/questions/48488178/can-nullable-be-used-as-a-functor-in-c", "title": "Can Nullable be used as a functor in C#?", "body": "<p>Consider the following code in C#.</p>\n\n<pre><code>public int Foo(int a)\n{\n    // ...\n}\n\n// in some other method\n\nint? x = 0;\n\nx = Foo(x);\n</code></pre>\n\n<p>The last line will return a compilation error <code>cannot convert from 'int?' to 'int'</code> which is fair enough. However, for example in Haskell there is <code>Maybe</code> which is a counterpart to <code>Nullable</code> in C#. Since <code>Maybe</code> is a <code>Functor</code> I would be able to apply <code>Foo</code> to <code>x</code> using <code>fmap</code>. Does C# have a similar mechanism?</p>\n"}, {"tags": ["haskell", "category-theory", "recursion-schemes"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517240458, "post_id": 48503929, "comment_id": 84003648, "body": "Yes, but can I make it adhere to the type signature for <code>foldMap</code>? I believe my <code>evalSum</code> is the algebra you&#39;re talking about, but it kind of doesn&#39;t help."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517320398, "post_id": 48503929, "comment_id": 84040758, "body": "Oh. I didn&#39;t think of making an algebra parametric."}, {"owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1517321405, "post_id": 48503929, "comment_id": 84041462, "body": "I also added the implementation of <code>Traversable</code>."}], "tags": [], "owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "is_accepted": true, "score": 17, "last_activity_date": 1517321370, "last_edit_date": 1517321370, "creation_date": 1517237174, "answer_id": 48503929, "question_id": 48488021, "link": "https://stackoverflow.com/questions/48488021/once-i-have-an-f-algebra-can-i-define-foldable-and-traversable-in-terms-of-it/48503929#48503929", "title": "Once I have an F-Algebra, can I define Foldable and Traversable in terms of it?", "body": "<p>An F-algebra defines a recipe for evaluating a single level of a recursive data structure, after you have evaluated all the children. <code>Foldable</code> defines a way of evaluating a (not necessarily recursive) data structure, provided you know how to convert values stored in it to elements of a monoid. </p>\n\n<p>To implement <code>foldMap</code> for a recursive data structure, you may start by defining an algebra, whose carrier is a monoid. You would define how to convert a leaf to a monoidal value. Then, assuming that all children of a node were evaluated to monoidal values, you'd define a way to combine them within a node. Once you've defined such an algebra, you can run a catamorphism to evaluate <code>foldMap</code> for the whole tree. </p>\n\n<p>So the answer to your question is that to make a <code>Foldable</code> instance for a fixed-point data structure, you have to define an appropriate algebra whose carrier is a monoid.</p>\n\n<p>Edit: Here's an implementation of Foldable:</p>\n\n<pre><code>data Expr e a = Branch [a] | Leaf e\n\nnewtype Ex e = Ex { unEx :: Fix (Expr e) }\n\nevalM :: Monoid m =&gt; (e -&gt; m) -&gt; Algebra (Expr e) m\nevalM _ (Branch xs) = mconcat xs\nevalM f (Leaf   i ) = f i\n\ninstance Foldable (Ex) where\n  foldMap f = cata (evalM f) . unEx\n\ntree :: Ex Int\ntree = Ex $ branch [branch [leaf 1, leaf 2], leaf 3]\n\nx = foldMap Sum tree\n</code></pre>\n\n<p>Implementing <code>Traversable</code> as a catamorphism is a little more involved because you want the result to be not just a summary--it must contain the complete reconstructed data structure. The carrier of the algebra must therefore be the type of the final result of <code>traverse</code>, which is <code>(f (Fix (Expr b)))</code>, where <code>f</code> is <code>Applicative</code>. </p>\n\n<pre><code>tAlg :: Applicative f =&gt; (e -&gt; f b) -&gt; Algebra (Expr e) (f (Fix (Expr b)))\n</code></pre>\n\n<p>Here's this algebra:</p>\n\n<pre><code>tAlg g (Leaf e)    = leaf   &lt;$&gt; g e\ntAlg _ (Branch xs) = branch &lt;$&gt; sequenceA xs\n</code></pre>\n\n<p>And this is how you implement <code>traverse</code>:</p>\n\n<pre><code>instance Traversable Ex where\n  traverse g = fmap Ex . cata (tAlg g) . unEx\n</code></pre>\n\n<p>The superclass of <code>Traversable</code> is a <code>Functor</code>, so you need to show that the fixed-point data structure is a functor. You can do it by implementing a simple algebra and running a catamorphism over it:</p>\n\n<pre><code>fAlg :: (a -&gt; b) -&gt; Algebra (Expr a) (Fix (Expr b))\nfAlg g (Leaf e) = leaf (g e)\nfAlg _ (Branch es) = branch es\n\ninstance Functor Ex where\n  fmap g = Ex . cata (fAlg g) . unEx\n</code></pre>\n\n<p>(Michael Sloan helped me write this code.)</p>\n"}, {"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517394863, "post_id": 48537475, "comment_id": 84075037, "body": "Oh, I never thought of giving separate names to what, as I now discover, would be called &quot;base functor&quot; and &quot;fixpoint&quot;. It was like one murky entanglement in my imagination. Feels much more comfortable now."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 4, "last_activity_date": 1517398145, "last_edit_date": 1517398145, "creation_date": 1517386545, "answer_id": 48537475, "question_id": 48488021, "link": "https://stackoverflow.com/questions/48488021/once-i-have-an-f-algebra-can-i-define-foldable-and-traversable-in-terms-of-it/48537475#48537475", "title": "Once I have an F-Algebra, can I define Foldable and Traversable in terms of it?", "body": "<p>It's very nice, that you used <code>Bifunctor</code>. Using <code>Bifunctor</code> of a base functor (<code>Expr</code>) to define <code>Functor</code> on a fixpoint (<code>Fix Expr</code>).\nThat approach generalises to <code>Bifoldable</code> and <code>Bitraversable</code> (they are in <code>base</code> now) too.</p>\n\n<p>Let's see how this would like using <a href=\"http://hackage.haskell.org/package/recursion-schemes\" rel=\"nofollow noreferrer\"><code>recursion-schemes</code></a>.\nIt looks a bit different, as there we define normal recursive type,\nsay <code>Tree e</code>, and also its base functor: <code>Base (Tree e) = TreeF e a</code> with two functions:\n<code>project :: Tree e -&gt; TreeF e (Tree e)</code> and <code>embed :: TreeF e (Tree e) -&gt; Tree e</code>.\nThe recursion machinery is derivable using <em>TemplateHaskell</em>:</p>\n\n<p>Note that we have <code>Base (Fix f) = f</code> (<code>project = unFix</code>, <code>embed = Fix</code>),\ntherefore we can use <code>refix</code> convert <code>Tree e</code> to <code>Fix (TreeF e)</code> and back. But\nwe don't need to use <code>Fix</code>, as we able to <code>cata</code> <code>Tree</code> directly!</p>\n\n<p>First includes:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, KindSignatures, TypeFamilies, DeriveFunctor, DeriveFoldable, DeriveTraversable #-}\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\n\nimport Data.Bifunctor\nimport Data.Bifoldable\nimport Data.Bitraversable\n</code></pre>\n\n<p>Then the data:</p>\n\n<pre><code>data Tree e = Branch [Tree e] | Leaf e deriving Show\n\n-- data TreeF e r = BranchF [r] | LeafF e\n-- instance Traversable (TreeF e)\n-- instance Foldable (TreeF e)\n-- instance Functor (TreeF e)\nmakeBaseFunctor ''Tree\n</code></pre>\n\n<p>Now as we have machinery in place, we can have catamorphisms</p>\n\n<pre><code>cata :: Recursive t =&gt; (Base t a -&gt; a) -&gt; t -&gt; a\ncata f = c where c = f . fmap c . project\n</code></pre>\n\n<p>or (which we will need later)</p>\n\n<pre><code>cataBi :: (Recursive t, Bifunctor p, Base t ~ p x) =&gt; (p x a -&gt; a) -&gt; t -&gt; a\ncataBi f = c where c = f . second c . project\n</code></pre>\n\n<p>First a <code>Functor</code> instance. The <code>Bifunctor</code> instance for <code>TreeF</code> is as OP has written,\nnote how <code>Functor</code> falls out by itself.</p>\n\n<pre><code>instance Bifunctor TreeF where\n    bimap f _ (LeafF e)    = LeafF (f e)\n    bimap _ g (BranchF xs) = BranchF (fmap g xs)\n\ninstance Functor Tree where\n    fmap f = cata (embed . bimap f id)\n</code></pre>\n\n<p>Not surprisingly, <code>Foldable</code> for fixpoint can be defined in terms of <code>Bifoldable</code> of base\nfunctor:</p>\n\n<pre><code>instance Bifoldable TreeF where\n    bifoldMap f _ (LeafF e)    = f e\n    bifoldMap _ g (BranchF xs) = foldMap g xs\n\ninstance Foldable Tree where\n    foldMap f = cata (bifoldMap f id)\n</code></pre>\n\n<p>And finally <code>Traversable</code>:</p>\n\n<pre><code>instance Bitraversable TreeF where\n    bitraverse f _ (LeafF e)    = LeafF &lt;$&gt; f e\n    bitraverse _ g (BranchF xs) = BranchF &lt;$&gt; traverse g xs\n\ninstance Traversable Tree where\n    traverse f = cata (fmap embed . bitraverse f id)\n</code></pre>\n\n<p>As you can see the definitions are very straight forward and follow similarish\npattern.</p>\n\n<p>Indeed we can define <code>traverse</code>-like function for every fix-point which base\nfunctor is <code>Bitraversable</code>.</p>\n\n<pre><code>traverseRec\n    :: ( Recursive t, Corecursive s, Applicative f\n       , Base t ~ base a, Base s ~ base b, Bitraversable base)\n    =&gt; (a -&gt; f b) -&gt; t -&gt; f s\ntraverseRec f = cataBi (fmap embed . bitraverse f id)\n</code></pre>\n\n<p>Here we use <code>cataBi</code> to make type-signature prettier: no <code>Functor (base b)</code> as\nit's \"implied\" by <code>Bitraversable base</code>. Btw, that's a one nice function as its\ntype signature is three times longer than the implementation).</p>\n\n<p>To conclude, I must mention that <code>Fix</code> in Haskell is not perfect:\nWe use the last argument to fix base-functor:</p>\n\n<pre><code>Fix :: (* -&gt; *) -&gt; * -- example: Tree e ~ Fix (TreeF e)\n</code></pre>\n\n<p>Thus Bartosz needs to define <code>Ex</code> in his answer to make kinds align,\nhowever it would be nicer to fix on the first argument:</p>\n\n<pre><code>Fix :: (* -&gt; k) -&gt; k -- example: Tree e = Fix TreeF' e\n</code></pre>\n\n<p>where <code>data TreeF' a e = LeafF' e | BranchF' [a]</code>, i.e. <code>TreeF</code> with indexes\nflipped. That way we could have <code>Functor (Fix b)</code> in terms of <code>Bifunctor f</code>,\n<code>Bifunctor (Fix b)</code> in terms of (non-existing in common libraries) <code>Trifunctor</code> etc.</p>\n\n<p>You can read about my failed attempts about that and Edward Kmett's comments\non the issue in <a href=\"https://github.com/ekmett/recursion-schemes/pull/23\" rel=\"nofollow noreferrer\">https://github.com/ekmett/recursion-schemes/pull/23</a></p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1804, "favorite_count": 4, "accepted_answer_id": 48503929, "answer_count": 2, "score": 12, "last_activity_date": 1517398145, "creation_date": 1517153616, "last_edit_date": 1517391107, "question_id": 48488021, "link": "https://stackoverflow.com/questions/48488021/once-i-have-an-f-algebra-can-i-define-foldable-and-traversable-in-terms-of-it", "title": "Once I have an F-Algebra, can I define Foldable and Traversable in terms of it?", "body": "<p>I have defined an <em>F-Algebra</em>, as per Bartosz Milewski's articles (<a href=\"https://bartoszmilewski.com/2013/06/10/understanding-f-algebras/\" rel=\"noreferrer\">one</a>, <a href=\"https://bartoszmilewski.com/2017/02/28/f-algebras/\" rel=\"noreferrer\">two</a>):</p>\n\n<p><em>(This is not to say my code is an exact embodiment of Bartosz's ideas, it's merely my limited understanding of them, and any faults are mine alone.)</em></p>\n\n<pre><code>module Algebra where\n\ndata Expr a = Branch [a] | Leaf Int\n\ninstance Functor Expr where\n    fmap f (Branch xs) = Branch (fmap f xs)\n    fmap _ (Leaf   i ) = Leaf    i\n\nnewtype Fix a = Fix { unFix :: a (Fix a) }\n\nbranch = Fix . Branch\nleaf   = Fix . Leaf\n\n-- | This is an example algebra.\nevalSum (Branch xs) = sum xs\nevalSum (Leaf   i ) =     i\n\ncata f = f . fmap (cata f) . unFix\n</code></pre>\n\n<p>I can now do pretty much anything I want about it, for example, sum the leaves:</p>\n\n<pre><code>\u03bb cata evalSum $ branch [branch [leaf 1, leaf 2], leaf 3]\n6\n</code></pre>\n\n<p>This is a contrived example that I made up specifically for this question, but I actually tried some less trivial things (such as evaluating and simplifying polynomials with any number of variables) and it works like a charm. One may indeed fold and replace any parts of a structure as one runs a <em>catamorphism</em> through, with a suitably chosen <em>algebra</em>. So, I am pretty sure an F-Algebra subsumes a Foldable, and it even appears to subsume Traversable as well.</p>\n\n<p><strong>Now, can I define Foldable / Traversable instances in terms of an F-Algebra?</strong></p>\n\n<p>It seems to me that I cannot.</p>\n\n<ul>\n<li>I can only run a catamorphism on an <em>initial algebra</em>, which is a nullary type constructor. And the algebra I give it has a type <code>a b -&gt; b</code> rather than <code>a -&gt; b</code>, that is to say, there is a <em>functional dependency</em> between the \"in\" and \"out\" type.</li>\n<li>I don't see an <code>Algebra a =&gt; Foldable a</code> anywhere in type signatures. If this is not done, it must be impossible.</li>\n</ul>\n\n<p>It seems to me that I cannot define <code>Foldable</code> in terms of an F-Algebra for the reason that an <code>Expr</code> must for that be a <code>Functor</code> in two variables: one for <em>carrier</em>, another for <em>values</em>, and then a <code>Foldable</code> in the second. So, it may be that a <em>bifunctor</em> is more suitable. And we can construct an F-Algebra with a bifunctor as well:</p>\n\n<pre><code>module Algebra2 where\n\nimport Data.Bifunctor\n\ndata Expr a i = Branch [a] | Leaf i\n\ninstance Bifunctor Expr where\n    bimap f _ (Branch xs) = Branch (fmap f xs)\n    bimap _ g (Leaf   i ) = Leaf   (g i)\n\nnewtype Fix2 a i = Fix2 { unFix2 :: a (Fix2 a i) i }\n\nbranch = Fix2 . Branch\nleaf   = Fix2 . Leaf\n\nevalSum (Branch xs) = sum xs\nevalSum (Leaf   i ) =     i\n\ncata2 f g = f . bimap (cata2 f g) g . unFix2\n</code></pre>\n\n<p>It runs like this:</p>\n\n<pre><code>\u03bb cata2 evalSum (+1) $ branch [branch [leaf 1, leaf 2], leaf 3]\n9\n</code></pre>\n\n<p>But I still can't define a Foldable. It would have type like this:</p>\n\n<pre><code>instance Foldable \\i -&gt; Expr (Fix2 Expr i) i where ...\n</code></pre>\n\n<p>Unfortunately, one doesn't get lambda abstractions on types, and there's no way to put an implied type variable in two places at once.</p>\n\n<p>I don't know what to do.</p>\n"}, {"tags": ["haskell", "typeclass", "algebraic-data-types"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1517151416, "post_id": 48487586, "comment_id": 83968130, "body": "Just give <code>a -&gt; Bool</code> a manual <code>Ord</code> instance (but better wrap it in a <code>newtype</code> first)."}, {"owner": {"reputation": 780, "user_id": 1315126, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/35561833646b79f4f817c343bacb7c78?s=128&d=identicon&r=PG", "display_name": "Mathias Vorreiter Pedersen", "link": "https://stackoverflow.com/users/1315126/mathias-vorreiter-pedersen"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1517151476, "post_id": 48487586, "comment_id": 83968152, "body": "That&#39;s a good point!"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1517151884, "post_id": 48487586, "comment_id": 83968264, "body": "I&#39;m sorry, based on your instance I think you need something a bit more complex: make a <code>data X a = X a  (a-&gt;Bool)</code>, make it an <code>Ord</code> and use <code>... | C X</code>."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 5, "last_activity_date": 1517151626, "creation_date": 1517151626, "answer_id": 48487691, "question_id": 48487586, "link": "https://stackoverflow.com/questions/48487586/avoid-tedious-implementation-of-ord/48487691#48487691", "title": "Avoid tedious implementation of Ord", "body": "<p>You could parameterize <code>Foo</code> with the types of special cases, then implement special instances separately for newtypes:</p>\n\n<pre><code>data Foo' c a\n  = A a\n  | B Int\n  | C (c a)\n  deriving (Eq, Ord)\n\ndata C a = MkC a (a -&gt; Bool)\n\ninstance Eq a =&gt; Eq (C a) where\n  MkC x f == MkC y g = x == y &amp;&amp; f x == g y\n\ninstance Ord a =&gt; Ord (C a) where\n  MkC x f `compare` MkC y g\n    | x == y = f x `compare` g y\n    | otherwise = x `compare` y\n\ntype Foo = Foo' C\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": false, "score": 3, "last_activity_date": 1517152260, "creation_date": 1517152260, "answer_id": 48487804, "question_id": 48487586, "link": "https://stackoverflow.com/questions/48487586/avoid-tedious-implementation-of-ord/48487804#48487804", "title": "Avoid tedious implementation of Ord", "body": "<p>This \"package\" of a function an its argument (known as the <a href=\"https://hackage.haskell.org/package/comonad-4.0/docs/Control-Comonad-Store.html#t:Store\" rel=\"nofollow noreferrer\"><code>Store</code></a> comonad (.. which has no <code>Eq</code> instance)) can be the instances of <code>Eq</code> and <code>Ord</code> that you seek</p>\n\n<pre><code>data Store s a = Store (s -&gt; a) s\n\ninstance (Eq s, Eq a) =&gt; Eq (Store s a) where\n  (==) :: Store s a -&gt; Store s a -&gt; Bool\n  Store f s == Store f' s' =\n    (s == s')\n    &amp;&amp;\n    (f s == f' s')\n\ninstance (Ord s, Ord a) =&gt; Ord (Store s a) where\n  compare :: Store s a -&gt; Store s a -&gt; Ordering\n  Store f s `compare` Store f' s' = \n    (compare s s')\n    &lt;&gt;\n    (f s `compare` f' s')\n</code></pre>\n\n<p>Now you can derive both <code>Eq</code> and <code>Ord</code></p>\n\n<pre><code>data Foo a\n  = A a\n  | B Int\n  | C (Store a Bool)\n  deriving (Eq, Ord)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1518293941, "post_id": 48487987, "comment_id": 84449245, "body": "This is the way to go imo if this answer applies"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1517153406, "creation_date": 1517153406, "answer_id": 48487987, "question_id": 48487586, "link": "https://stackoverflow.com/questions/48487586/avoid-tedious-implementation-of-ord/48487987#48487987", "title": "Avoid tedious implementation of Ord", "body": "<p>Since you know something special about these functions, consider storing information about that something special and re-interpreting to function-land only as necessary. For example, perhaps what you know is that they are partially-applied <code>(&lt;)</code>; then something like this:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n{-# LANGUAGE ViewPatterns #-}\n\ndata Foo a\n    = A a\n    | B Int\n    | C_ a a\n    deriving (Eq, Ord, Read, Show)\n\npattern C a f &lt;- C_ a ((&lt;) -&gt; f)\n</code></pre>\n\n<p>Of course if you have a more complicated expression language than just addition you may want to define a separate type for your AST and a separate function for evaluating the AST; but the AST itself should in most simple cases where your proposed comparison rule is right be derivably-equal/orderable.</p>\n"}], "owner": {"reputation": 780, "user_id": 1315126, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/35561833646b79f4f817c343bacb7c78?s=128&d=identicon&r=PG", "display_name": "Mathias Vorreiter Pedersen", "link": "https://stackoverflow.com/users/1315126/mathias-vorreiter-pedersen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 48487987, "answer_count": 3, "score": 5, "last_activity_date": 1517153406, "creation_date": 1517150851, "question_id": 48487586, "link": "https://stackoverflow.com/questions/48487586/avoid-tedious-implementation-of-ord", "title": "Avoid tedious implementation of Ord", "body": "<p>I have a datatype with quite a few constructors, all of them simple enough that Haskell can derive the Ord instance automatically. As in:</p>\n\n<pre><code>data Foo a\n  = A a\n  | B Int\n  deriving (Eq, Ord)\n</code></pre>\n\n<p>Now I want to add a third constructor like so:</p>\n\n<pre><code>data Foo a\n  = A a\n  | B Int\n  | C a (a -&gt; Bool)\n</code></pre>\n\n<p>But now Haskell can't manually derive <code>Eq</code> and <code>Ord</code> on <code>Foo</code> for me. Now, it happens that I have some domain-specific knowledge about how two values constructed with <code>C</code> should be ordered:</p>\n\n<pre><code>instance Eq a =&gt; Eq (Foo a) where\n  -- Boilerplate I don't want to write\n  A x == A y = x == y\n  B x == B y = x == y\n  -- This is the case I really care about\n  C x f == C y g = x == y &amp;&amp; f x == g y\n  _ == _ = False\n\ninstance Ord a =&gt; Ord (Foo a) where\n  -- Boilerplate I don't want to write\n  A x `compare` A y = x `compare` y\n  A x `compare` _ = LT\n\n  B x `compare` B y = x `compare` y\n  B x `compare` A _ = GT\n  B _ `compare` _ = LT\n\n  -- This is the case I really care about\n  C x f `compare` C y g\n    | x == y = f x `compare` g y\n    | otherwise = x `compare` y\n  C{} `compare` _ = GT\n</code></pre>\n\n<p>But in order to do this, I also have to manually implement the ordering on A and B values, which is really tedious (especially for the Ord instance).</p>\n\n<p>Is there any trick that would allow me to implement (==) and compare only on the C case, but somehow get the \"default\" behaviour on the other constructors?</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1517139330, "post_id": 48485660, "comment_id": 83964381, "body": "The &quot;different values&quot; bit can be witnessed, as above, by any experiment that distinguishes output (or the lack of it). The &quot;same morphism&quot; idea is an attempt to ride roughshod over the disagreement in observable behaviour by saying which observations (just applications, not seqs) matter. But be suspicious: they do not say what x ranges over (values? or for higher-order functions, morphisms?) or in what sense the outputs should be equal."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 8, "creation_date": 1517139430, "post_id": 48485660, "comment_id": 83964414, "body": "<a href=\"http://math.andrej.com/2016/08/06/hask-is-not-a-category/comment-page-1/\" rel=\"nofollow noreferrer\">Nope</a>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1517140681, "post_id": 48485660, "comment_id": 83964780, "body": "Jokes aside, mechanically checking that two functions <code>f</code> and <code>g</code> are the same morphism (let&#39;s pretend the word means something in this context) is equivalent to deciding the halting problem. So no, you cannot in general check it. In each individual case you may (or may not) be able to prove it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1517141055, "post_id": 48485660, "comment_id": 83964894, "body": "@n.m. mechanically proving that two functions of arbitrary type are the same morphism is impossible, but for many particular types (including highly polymorphic types, that are actually quite small thanks to parametricity) it can be done using <a href=\"https://hackage.haskell.org/package/universe-1.0/docs/Data-Universe.html\" rel=\"nofollow noreferrer\">universe</a>. And even where that isn&#39;t applicable, practically speaking it&#39;s often quite easy to find out that two functions are nonequal, using something like QuickCheck."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 3, "creation_date": 1517142126, "post_id": 48485660, "comment_id": 83965244, "body": "Mechanical checkability is irrelevant. A definition of the criteria that must be proven would be progress."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "edited": false, "score": 0, "creation_date": 1517142270, "post_id": 48485660, "comment_id": 83965290, "body": "Unfortunately I do not understand it.."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "edited": false, "score": 0, "creation_date": 1517142308, "post_id": 48485660, "comment_id": 83965308, "body": "even why can&#39;t we have: <code>undefined . id = undefined</code> ?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1517142624, "post_id": 48485660, "comment_id": 83965393, "body": "@garychaudhry we could easily have that, it would just require the <code>.</code> operator to be defined a bit differently, like\u2020 <code>f . g = f `seq` g `seq` \\x-&gt;f(g x)</code>. Just, there would be no real use to this, because in practice, the only use of a function is to actually evaluate it. (\u2020Actually, the compiler seems to optimise the above <code>seq</code>s away for that reason; the <code>undefined</code> only triggers an error when you use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/GHC-Conc-Sync.html#v:pseq\" rel=\"nofollow noreferrer\"><code>pseq</code></a> instead which is never optimised out.)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1517149192, "post_id": 48485660, "comment_id": 83967457, "body": "<code>undefined</code> breaks all kinds of stuff. Is <code>()</code> an initial object? Is <code>(,)</code> a product? Is <code>Either</code> a coproduct? Not if <code>undefined</code> is around. Etc etc"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "edited": false, "score": 0, "creation_date": 1517154913, "post_id": 48485660, "comment_id": 83969335, "body": "Thank you for your attention to this matter.."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1517180278, "post_id": 48485660, "comment_id": 83977642, "body": "@n.m. <code>()</code> is terminal and <code>(,)</code> is a product in lazy PCF with bottoms, with respect to observational equality. As Andrej Bauer noted in the link, the main issue, rather than bottoms, is not having a notion of equality and semantics."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1517164979, "creation_date": 1517164979, "answer_id": 48490015, "question_id": 48485660, "link": "https://stackoverflow.com/questions/48485660/is-hask-even-a-category/48490015#48490015", "title": "Is Hask even a category?", "body": "<p>In Haskell, we have this idea that every expression can be evaluated to a particular \"value\", and we might be interested in determining if two expressions have the \"same\" value.</p>\n\n<p>Informally, we know that some values (e.g., value <code>2</code> and <code>3</code> of type <code>Integer</code>) can be compared directly.  Other values, like <code>sqrt</code> and <code>id</code> of type <code>Double -&gt; Double</code> can be compared, as @pigworker notes, by constructing an expression that \"witnesses\" a difference in directly comparable values:</p>\n\n<pre><code>sqrt 4 = 2\nid 4 = 4\n</code></pre>\n\n<p>Here, we can conclude that <code>sqrt</code> and <code>id</code> are different values.  If there is no such witness, then the values are the same.</p>\n\n<p>If we look at the monomorphic specializations of <code>undef1</code> and <code>undef2</code> to the type <code>() -&gt; ()</code> given by:</p>\n\n<pre><code>undef1, undef2 :: () -&gt; ()\nundef1 = undefined\nundef2 = \\_ -&gt; undefined\n</code></pre>\n\n<p>how can we tell if these are different values?</p>\n\n<p>Well, we need to find an expression that witnesses a difference, and one is given above.  The two expressions:</p>\n\n<pre><code>&gt; seq undef1 ()\n*** Exception: Prelude.undefined\n&gt; seq undef2 ()\n()\n&gt;\n</code></pre>\n\n<p>have different values, according to GHCi.  We could also show this directly, using our understanding of Haskell semantics:</p>\n\n<pre><code>seq undef1 ()\n-- use defn of undef1\n= seq undefined ()\n-- seq semantics:  WHNF of undefined is _|_, so value is _|_\n= _|_\n\nseq undef2 ()\n-- use defn of undef2\n= seq (\\_ -&gt; undefined) ()\n-- seq semantics: (\\_ -&gt; undefined) is already in WHNF and is not _|_,\n--   so value is second arg ()\n= ()\n</code></pre>\n\n<p>So, what's the problem?  Well, when considering <strong>Hask</strong> as a <em>category</em> where the objects are types and the morphisms are (monomorphic) functions, we implicitly need a concept of identity/equality for objects and morphisms.</p>\n\n<p>Object identity/equality is easy:  two objects (monomorphic Haskell types) are equal if and only if they are the same type.  Morphism identity/equality is harder.  Because morphisms in <strong>Hask</strong> are Haskell values (of monomorphic function types), it would be tempting to define equality of morphisms to be the same as equality of values, as above.</p>\n\n<p><strong>If we used this definition</strong>, then <code>undef1</code> and <code>undef2</code> would be different morphisms, because we have proved they are different Haskell values above.</p>\n\n<p>However, if we compared <code>undef1 . id</code> and <code>undef2</code>, we would discover that they have the <em>same</em> value.  That is, there is no expression that witnesses a difference between them.  Proving this is a little tough, but see below.</p>\n\n<p>Anyway, we now have a contradiction in our <strong>Hask</strong> category theory.  Because <code>id</code> is the (polymorphic family of) identity morphisms in <strong>Hask</strong>, we must have:</p>\n\n<pre><code>undef1 \n= undef1 . id                            -- because `id` is identity\n= undef2                                 -- same value\n</code></pre>\n\n<p>so we simultaneously have <code>undef1 /= undef2</code> because of the witness above, but <code>undef1 = undef2</code> by the previous argument.</p>\n\n<p>The only way to avoid this contradiction is to give up the idea of defining equality of morphisms in <strong>Hask</strong> as equality of the underlying Haskell values.</p>\n\n<p>One alternative definition of equality of morphisms in <strong>Hask</strong> that has been offered is the weaker definition that two morphisms <code>f</code> and <code>g</code> are equal if and only if they satisfy <code>f x = g x</code> for all values <code>x</code> (including <code>_|_</code>).  Note that there's still an ambiguity here.  If <code>f x</code> and <code>g x</code> are <em>themselves</em> Haskell functions and so morphisms, does <code>f x = g x</code> mean equality of the <em>morphisms</em> <code>f x</code> and <code>g x</code> or equality of the Haskell <em>values</em> <code>f x</code> and <code>g x</code>?  Let's ignore this problem for now.</p>\n\n<p>Under this alternative definition, <code>undef1</code> and <code>undef2</code> <strong>are</strong> equal as morphisms, because we can show <code>undef1 x = undef2 x</code> for all possible values <code>x</code> of type <code>()</code> (namely <code>()</code> and <code>_|_</code>).  That is, applied to <code>()</code>, they give:</p>\n\n<pre><code>undef1 ()\n-- defn of undef1\n= undefined ()\n-- application of an undefined function\n= _|_\n\nundef2 ()\n-- defn of undef2\n= (\\_ -&gt; undefined) ()\n-- application of a lambda\n= undefined\n-- semantics of undefined\n= _|_\n</code></pre>\n\n<p>and applied to <code>_|_</code> they give:</p>\n\n<pre><code>undef1 _|_\n-- defn of undef1\n= undefined _|_\n-- application of an undefined function\n= _|_\n\nundef2 _|_\n-- defn of undef2\n= (\\_ -&gt; undefined) _|_\n-- application of a lambda\n= undefined\n-- semantics of undefined\n= _|_\n</code></pre>\n\n<p>Similarly, <code>undef1 . id</code> and <code>undef2</code> can be shown to be equal as morphisms in <strong>Hask</strong> by this definition (in fact, they were equal as Haskell values which implies they're equal according to the weaker definition of equality of <strong>Hask</strong> morphisms), so there's no contradiction.</p>\n\n<p>However, if you follow the link provided by @n.m., you can see that there's more work to do in terms of formalizing the meaning of equality of Haskell values and precisely giving an appropriate definition of equality of <strong>Hask</strong> morphisms before we'd really feel comfortable believing that there <em>is</em> a contradiction-free <strong>Hask</strong> category.</p>\n\n<h3>Proof that <code>undef1 . id = undef2</code> as Haskell Values</h3>\n\n<p>For the reasons above, this proof is necessarily a little informal, but here's the idea.</p>\n\n<p>If we are trying to witness a difference between functions <code>f</code> and <code>g</code>, the only way a witnessing expression can <em>use</em> these values is by applying them to a value <code>x</code> or by evaluating them to WHNF using <code>seq</code>.  If <code>f</code> and <code>g</code> are known to be equal as <strong>Hask</strong> morphisms, then we already have <code>f x = g x</code> for all <code>x</code>, so no expression can witness a difference based on application.  The only remaining thing to check is that when they are evaluated to WHNF they are either both defined (in which case, by the previous assumption, they will yield the same values when applied) or they are both undefined.</p>\n\n<p>So, for <code>undef1 . id</code> and <code>undef2</code>, we just need to ensure that they are either both defined or both undefined when evaluated to WHNF.  It's easy to see that they both, in fact, have defined WHNFs:</p>\n\n<pre><code>undef1 . id \n-- defn of composition\n= \\x -&gt; undef1 (id x)\n-- this is a lambda, so it is in WHNF and is defined\n\nundef2\n-- defn of undef2\n= \\_ -&gt; undefined\n-- this is a lambda, so it is in WHNF and is defined\n</code></pre>\n\n<p>We already established above that <code>undef1 x = undef2 x</code> for all <code>x</code>.  Technically, we ought to show that:</p>\n\n<pre><code>(undef1 . id) x\n-- defn of composition\n= (\\x -&gt; undef1 (id x)) x\n-- lambda application\n= undef1 (id x)\n-- defn of id\n= undef1 x\n</code></pre>\n\n<p>with equality as Haskell values for all <code>x</code>, which establishes that <code>(undef1 . id) x = undef2 x</code> for all <code>x</code>.  Together with the fact that both have defined WHNFs above, this is enough to show that <code>undef1 . id = undef2</code> with equality as Haskell values.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8585703"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1266, "favorite_count": 2, "accepted_answer_id": 48490015, "answer_count": 1, "score": 7, "last_activity_date": 1517164979, "creation_date": 1517137691, "last_edit_date": 1517138244, "question_id": 48485660, "link": "https://stackoverflow.com/questions/48485660/is-hask-even-a-category", "title": "Is Hask even a category?", "body": "<p><a href=\"https://wiki.haskell.org/Hask\" rel=\"noreferrer\">https://wiki.haskell.org/Hask</a>:</p>\n\n<blockquote>\n  <p>Consider:</p>\n\n<pre><code>undef1 = undefined :: a -&gt; b\nundef2 = \\_ -&gt; undefined\n</code></pre>\n  \n  <p>Note that these are not the same value:</p>\n\n<pre><code>seq undef1 () = undefined\nseq undef2 () = ()\n</code></pre>\n  \n  <p>This might be a problem, because <code>undef1 . id = undef2</code>. In order to make <strong>Hask</strong> a category, we define two functions <code>f</code> and <code>g</code> as the same morphism if <code>f x = g x</code> for all <code>x</code>. Thus <code>undef1</code> and <code>undef2</code> are different <em>values</em>, but the same <em>morphism</em> in <strong>Hask</strong>.</p>\n</blockquote>\n\n<p>What does it mean or how can I check, that:\n<code>undef1</code> and <code>undef2</code> are different values, but the same morphism? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1517130598, "post_id": 48484414, "comment_id": 83962144, "body": "Thank you that executes. But the file is 0 when i stop the command.  How can i see the output (verbose) on the cli? Is it combineable with putStr?"}, {"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1517152555, "post_id": 48484414, "comment_id": 83968494, "body": "@foxxx Just edited the post with a more complete solution, although I&#39;d recommend you to take a look at a Haskell tutorial to learn the basics."}, {"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1517168591, "post_id": 48484414, "comment_id": 83974108, "body": "Thank you @nicodp and chi.  That explained a lot. Now i am able to run that. The command &quot;permutations&quot; permuatets the whole array or? or could it also give me string1string2 in a row?"}, {"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1517332048, "post_id": 48484414, "comment_id": 84048669, "body": "After 36MB resultfile my system breaks. How can i flush the ram @nicodp ?"}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": true, "score": 3, "last_activity_date": 1517152487, "last_edit_date": 1517152487, "creation_date": 1517127162, "answer_id": 48484414, "question_id": 48484310, "link": "https://stackoverflow.com/questions/48484310/save-string-output-to-a-file/48484414#48484414", "title": "Save string output to a file", "body": "<p>One solution could be changing your last line to:</p>\n\n<pre><code>mapM_ (writeFile \"filename\") $ concat listsWithNewLines\n</code></pre>\n\n<p><code>writeFile</code> takes a file path and writes to it the string passed as a second argument.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Instead of using <code>writeFile</code>, you can use <code>appendFile</code> (if not, the file would be overwritten every time a new word is put):</p>\n\n<pre><code>let writeAndPrint word = appendFile \"filename\" word &gt;&gt; putStr word\nmapM_ writeAndPrint $ concat listsWithNewLines\n</code></pre>\n\n<p><code>&gt;&gt;</code> is the operator of sequencing monadic computations. As @chi pointed out, you can rewrite this in a Haskell file, let's say, <code>printAndWrite.hs</code> as follows:</p>\n\n<pre><code>main = do\n  let listofstrings= [\"string1\", \"string2\", \"string3\", \"string4\"]\n  let listsWithNewLines = map (++ [\"\\n\"]) $ permutations listofstrings\n  let writeAndPrint word = do\n    appendFile \"filename\" word\n    putStr word\n  mapM_ writeAndPrint $ concat listsWithNewLines\n</code></pre>\n\n<p>After this, you can either load it into <code>GHCi</code>, or compile the program using <code>GHC</code> and executing it on the console. If you load it in <code>GHCi</code>, you should use <code>:load printAndWrite.hs</code> and then run <code>main</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 0, "creation_date": 1517142298, "post_id": 48484811, "comment_id": 83965301, "body": "Thank you chi.  Could you please tell me how i can put this complex code in a file? Until now i&#39;ve putted every line in the ghci bash. One after another. How has the haskell file to be in order to test your code?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "edited": false, "score": 1, "creation_date": 1517148039, "post_id": 48484811, "comment_id": 83967078, "body": "@foxxx Create a text file and give it the <code>.hs</code> file extension. Put <code>module Foo where</code> at the beginning of the file, then paste whatever definitions you want underneath. You can load it with <code>ghci filenamehere.hs</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1517130979, "creation_date": 1517130979, "answer_id": 48484811, "question_id": 48484310, "link": "https://stackoverflow.com/questions/48484310/save-string-output-to-a-file/48484811#48484811", "title": "Save string output to a file", "body": "<p>To \"loop\" over a list and perform monadic actions, you can use</p>\n\n<pre><code>foo = do\n   ...\n   let action string = do\n          writeFile \"filename\" string\n          putStrLn (\"written: \" ++ string)\n          ...\n   mapM_ action $ concat listsWithNewLines\n</code></pre>\n\n<p>or, with <code>Data.Foldable</code>, you can follow this idiom:</p>\n\n<pre><code>foo = do\n   ...\n   for_ (concat listsWithNewLines) $ \\string -&gt; do\n          writeFile \"filename\" string\n          putStrLn (\"written: \" ++ string)\n          ...\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 3985390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/675eb4de79698f3ffc59a6de4b3feedf?s=128&d=identicon&r=PG&f=1", "display_name": "foxxx", "link": "https://stackoverflow.com/users/3985390/foxxx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "accepted_answer_id": 48484414, "answer_count": 2, "score": -3, "last_activity_date": 1517152487, "creation_date": 1517126097, "question_id": 48484310, "link": "https://stackoverflow.com/questions/48484310/save-string-output-to-a-file", "title": "Save string output to a file", "body": "<p>After performing a string permutation with</p>\n\n<pre><code>listofstrings= [\"string1\", \"string2\", \"string3\", \"string4\"]\nlistsWithNewLines = map (++ [\"\\n\"]) $ permutations listofstrings\nmapM_ putStr (concat listsWithNewLines)\n</code></pre>\n\n<p>The output is very fine. \nI would like to save the output to a textfile. \nHow could that work?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 6, "last_activity_date": 1517091722, "creation_date": 1517091722, "answer_id": 48481153, "question_id": 48481129, "link": "https://stackoverflow.com/questions/48481129/cabal-update-failed-to-download/48481153#48481153", "title": "Cabal update: Failed to download", "body": "<p>Based on <a href=\"https://github.com/haskell/cabal/issues/4747\" rel=\"noreferrer\">this git issue</a> there's a workaround by using</p>\n\n<pre><code> cabal --http-transport=plain-http update\n</code></pre>\n\n<p>instead. (forcing cabal not to use powershell's webclient)</p>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 2, "accepted_answer_id": 48481153, "answer_count": 1, "score": 2, "last_activity_date": 1517091722, "creation_date": 1517091571, "question_id": 48481129, "link": "https://stackoverflow.com/questions/48481129/cabal-update-failed-to-download", "title": "Cabal update: Failed to download", "body": "<p>Despite repeated attempts, Cabal does not update.\nWhy is Cabal not working properly?\nWhat should I do?\nThe last update dates back to 89 days.</p>\n\n<pre><code>Windows PowerShell\nCopyright (C) Microsoft Corporation. Tutti i diritti sono riservati.\n\nPS C:\\WINDOWS\\system32&gt; ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 8.2.2\n\nPS C:\\WINDOWS\\system32&gt; cabal --version\ncabal-install version 2.0.0.1\ncompiled using version 2.0.1.1 of the Cabal library\nPS C:\\WINDOWS\\system32&gt;\n\nPS C:\\WINDOWS\\system32&gt; cabal update\nDownloading the latest package list from hackage.haskell.org\ndieVerbatim: user error (cabal.exe: Failed to download\nhttp://objects-us-west-1.dream.io/hackage-mirror/01-index.tar.gz : No Status\nCode could be parsed from response: Eccezione durante una richiesta WebClient.\n)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 7, "last_activity_date": 1517081481, "creation_date": 1517081481, "answer_id": 48479736, "question_id": 48478928, "link": "https://stackoverflow.com/questions/48478928/simulating-c-function-static-variable-in-haskell/48479736#48479736", "title": "Simulating C function static variable in haskell", "body": "<p>You can use the following trick, adapted from <a href=\"https://wiki.haskell.org/Top_level_mutable_state\" rel=\"noreferrer\">this method for defining global mutable variables</a>.  For your application, you don't need a <em>mutable</em> variable, but by using <code>unsafePerformIO</code> in a top-level definition, you can force the IO action <code>generateUID</code> to be called only once and its return value memoized for future calls:</p>\n\n<pre><code>getUID :: Int\n{-# NOINLINE getUID #-}\ngetUID = unsafePerformIO generateUID\n</code></pre>\n\n<p>For example, the following complete example will re-use the same random number generated by the first <code>getUID</code> call for any future calls:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Uid where\n\nimport System.IO.Unsafe\n\nforeign import ccall \"stdlib.h random\" generateUID :: IO Int\n\ngetUID :: Int\n{-# NOINLINE getUID #-}\ngetUID = unsafePerformIO generateUID\n\nfoo = getUID + 1\nbar = getUID + 2\n\nmain = print $ (foo, bar)\n</code></pre>\n\n<p>This has the advantage that <code>getUID</code> is just a pure value, so you can use it outside of <code>IO</code> monad, if needed.</p>\n\n<p>Admittedly, many people consider this a horrible hack.  Typically, a cleaner alternative is to run the program in a monad with a <code>Reader</code> component that includes the global ID value.  Usually you'll be running big chunks of any non-trivial program in some kind of monad anyway (e.g., above, you seemed willing to run <code>foo</code> and <code>bar</code> in the <code>IO</code> monad), so this is rarely much of an issue.  Something like:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Uid where\n\nimport Control.Monad.Reader\n\ndata R = R { globalUid :: Int }\ntype M = ReaderT R IO\n\nforeign import ccall \"stdlib.h random\" generateUID :: IO Int\n\ngetUID :: M Int\ngetUID = asks globalUid\n\nfoo = (+1) &lt;$&gt; getUID\nbar = (+2) &lt;$&gt; getUID\n\nwithUid :: M a -&gt; IO a\nwithUid act = do\n  uid &lt;- generateUID\n  runReaderT act (R uid) \n\nmain = withUid $ do\n  liftIO . print =&lt;&lt; (,) &lt;$&gt; foo &lt;*&gt; bar\n</code></pre>\n"}], "owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 589, "favorite_count": 0, "accepted_answer_id": 48479736, "answer_count": 1, "score": 4, "last_activity_date": 1517081481, "creation_date": 1517076660, "question_id": 48478928, "link": "https://stackoverflow.com/questions/48478928/simulating-c-function-static-variable-in-haskell", "title": "Simulating C function static variable in haskell", "body": "<p>I have a function called <code>generateUID</code>, which is external C function connected via FFI.\nThis function generates new unique id for each call, but I need one uid for entire program. If I were using C/C++, I would've made a function like this one.</p>\n\n<pre><code>int getUID() {\n    static int uid = generateUID();\n    return uid;\n}\n</code></pre>\n\n<p>So that I can use this like this</p>\n\n<pre><code>int foo() { return getUID() + 1; }\nint bar() { return getUID() + 2; }\nint main() {\n    printf(\"%d\\n\", foo() + bar();\n}\n</code></pre>\n\n<p>In haskell, I used function like this</p>\n\n<pre><code>getUID :: IO Int\ngetUID = generateUID -- this is attached to C lib with FFI\nfoo = (+1) &lt;$&gt; getUID\nbar = (+2) &lt;$&gt; getUID\nmain = (+) &lt;$&gt; foo &lt;*&gt; bar &gt;&gt;= print\n</code></pre>\n\n<p>However, <code>getUID</code> is called twice if I use this code. The only solution that I know of is to merge them into one <code>do</code> notation, but in my real code, <code>foo</code> and <code>bar</code> are reused too frequently to be merged to other function.</p>\n\n<p>How can I make my haskell version <code>getUID</code> call <code>generateUID</code> only once?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1517074990, "post_id": 48478292, "comment_id": 83950316, "body": "Does the <a href=\"https://hackage.haskell.org/package/cryptonite-0.24/docs/Crypto-Cipher-Types.html#t:StreamCipher\" rel=\"nofollow noreferrer\">StreamCipher</a> class help you?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1517075044, "post_id": 48478292, "comment_id": 83950333, "body": "Also, is <a href=\"https://github.com/haskell-crypto/cryptonite/issues/86\" rel=\"nofollow noreferrer\">github.com/haskell-crypto/cryptonite/issues/86</a> insightful?"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1517167350, "last_edit_date": 1517167350, "creation_date": 1517118527, "answer_id": 48483577, "question_id": 48478292, "link": "https://stackoverflow.com/questions/48478292/lazy-operations-with-haskell-cryptonite/48483577#48483577", "title": "Lazy operations with haskell/cryptonite", "body": "<p><strong>Specific Answers to Specific Questions</strong></p>\n\n<blockquote>\n  <p>Is it possible to perform lazy encryption with cryptonite? [...] I could easily write my own version of ctrCombine based on ecbEncrypt that operates on lazy ByteStrings, especially as AES is well suited for streaming, but I'd like not to reinvent the wheel.</p>\n</blockquote>\n\n<p>All the primitives are there but as you noted they aren't really made to be composed as easily as you would like.</p>\n\n<blockquote>\n  <p>Or is there some package out there that implements ByteArray for lazy ByteStrings?</p>\n</blockquote>\n\n<p>I hope not.  Any type that is an instance of <code>ByteArray</code> must also be an instance of <code>ByteArrayAccess</code> and thus have a function that gets the entire byte array in contiguous memory via <code>withByteArray :: ba -&gt; (Ptr p -&gt; IO a) -&gt; IO a</code>.  This is counter to the point of lazy bytestrings. It is more honest to have people use <code>Data.ByteString.Lazy.toStrict</code> first.</p>\n\n<blockquote>\n  <p>Or am I missing something obvious?</p>\n</blockquote>\n\n<p>Well there is <code>toStrict</code> as mentioned above.</p>\n\n<blockquote>\n  <p>(And also, that would violate the \"don't write your own crypto\" principle.)</p>\n</blockquote>\n\n<p>If you are using counter mode directly then you are already at a level many people would consider \"writing your own crypto\" even if it isn't what the adage was traditionally about.</p>\n\n<p><strong>An Alternative</strong></p>\n\n<p>The cryptonite API seeks to make the common thing easy more than be a foundational underpinning that I'd once hoped for the Haskell community. An alaternative is the crypto-api, which is more flexible at the cost of not being as simple for the end user.</p>\n\n<p>Specific to your question: in crypto-api there is a <code>Crypto.Classes.ctrLazy</code> function.  Second, even if there was only the strict ByteString version you could take advantage of the returned <code>IV</code> to build a lazy counter mode without resorting to ECB.</p>\n\n<p>It is the lack of return IVs, and in some cases the use of exceptions instead of sum types, that I feel was the original point of distinction between the \"keep simple things simple\" APIs Vincent publishes and the maximally flexible low level APIs I promoted in crypto-api and other packages from that era.</p>\n"}], "owner": {"reputation": 43, "user_id": 7115487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a47eb808ec2591a4480300b70587a3f1?s=128&d=identicon&r=PG&f=1", "display_name": "Pascal91", "link": "https://stackoverflow.com/users/7115487/pascal91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517167350, "creation_date": 1517072962, "question_id": 48478292, "link": "https://stackoverflow.com/questions/48478292/lazy-operations-with-haskell-cryptonite", "title": "Lazy operations with haskell/cryptonite", "body": "<p>I'm using cryptonite to perform AES256 encryption in CTR mode. So far, everything works fine with ByteStrings, but for better space efficiency (some files may be big) I'd like to switch to lazy IO and lazy ByteStrings.</p>\n\n<p>The type signature for ctrCombine in the cryptonite package is:</p>\n\n<p><code>ctrCombine :: ByteArray ba =&gt; cipher -&gt; IV cipher -&gt; ba -&gt; ba\n</code></p>\n\n<p>The problem is: ByteString.Lazy is not an instance of ByteArray. If I try to pass a lazy ByteString to ctrCombine, GHC complains with the following error:</p>\n\n<p><code>No instance for (memory-0.14.6:Data.ByteArray.Types.ByteArray LBS.ByteString) arising from a use of \u2018ctrCombine\u2019\n</code></p>\n\n<p>Is it possible to perform lazy encryption with cryptonite? Or is there some package out there that implements ByteArray for lazy ByteStrings? Or am I missing something obvious? I could easily write my own version of ctrCombine based on ecbEncrypt that operates on lazy ByteStrings, especially as AES is well suited for streaming, but I'd like not to reinvent the wheel. (And also, that would violate the \"don't write your own crypto\" principle.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1517070729, "post_id": 48477855, "comment_id": 83948977, "body": "What&#39;s wrong with the <code>Int -&gt; [[Int]]</code> version? It&#39;s perfectly reasonable for a given input to return an empty list of 0 solutions without needing to bother with additional layers of <code>Maybe</code> and <code>ListT</code> to signal no solution."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1517071012, "post_id": 48477855, "comment_id": 83949050, "body": "It would be perfectly possible, but I agree with @chepner that the transformer is overkill here. A list without the <code>Maybe</code> would be perfectly idiomatic, I should think."}, {"owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 0, "creation_date": 1517071258, "post_id": 48477855, "comment_id": 83949131, "body": "Nothing wrong per se. However, what is wrong with trying to understand how monad transformers could be used to combine these two abstractions (list and <code>Maybe</code>) to provide desired behaviour? Don&#39;t we want to understand how these creatures behave?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1517071311, "post_id": 48477855, "comment_id": 83949146, "body": "IIRC, <code>ListT</code> is broken anyway."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1517075797, "post_id": 48477855, "comment_id": 83950561, "body": "@jhu Everything you can do with <code>MaybeT</code> you can do it as well with a proper <code>ListT</code> implementation (the one from &quot;transformers&quot; is bugged, use   an alternative like <a href=\"http://hackage.haskell.org/package/list-t\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/list-t</a>). Experiments that put <code>ExceptT</code>, <code>StateT</code> and <code>WriterT</code> above/below <code>ListT</code> can be more instructive."}], "answers": [{"comments": [{"owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 0, "creation_date": 1517071376, "post_id": 48478003, "comment_id": 83949164, "body": "This would be the &quot;hack&quot; solution I referred to above."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 0, "creation_date": 1517072621, "post_id": 48478003, "comment_id": 83949607, "body": "@jhu Alright, I think I understand now. I don&#39;t think the thing you&#39;re looking for is, in general, possible. But see my edit; it may be a step in the right direction, if I&#39;m understanding correctly."}, {"owner": {"reputation": 24791, "user_id": 499214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PObJM.png?s=128&g=1", "display_name": "John Dvorak", "link": "https://stackoverflow.com/users/499214/john-dvorak"}, "edited": false, "score": 1, "creation_date": 1517076965, "post_id": 48478003, "comment_id": 83950953, "body": "I believe <code>testList&#39;</code> should be possible to generalize to <code>MonadPlus m =&gt; NonEmptyT m a</code>. Am I right?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1517084364, "post_id": 48478003, "comment_id": 83953218, "body": "I want to add that you should never use list transformer from <code>transformers</code> library because this data type is broken. Better use something like <a href=\"https://hackage.haskell.org/package/list-transformer\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/list-transformer</a>"}, {"owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 0, "creation_date": 1517502446, "post_id": 48478003, "comment_id": 84130973, "body": "Ok, I will give a proper implementation of list transformer a try at some point. (Somewhat weird if the version from <code>transformers</code> is buggy. Maybe a licence issue.) I will do that before I select the answer above to be correct. Thanks!"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 1, "last_activity_date": 1517072590, "last_edit_date": 1517072590, "creation_date": 1517071258, "answer_id": 48478003, "question_id": 48477855, "link": "https://stackoverflow.com/questions/48477855/monad-transformer-for-signaling-no-solution-list-with-nothing/48478003#48478003", "title": "Monad transformer for signaling no solution list with `Nothing`", "body": "<p>While I think simply cutting out the <code>Maybe</code> is the idiomatic solution, here is the answer to the question you're asking. Since we know the exact nature of your monad transformer stack, we can just introspect on its values using pattern matching.</p>\n\n<pre><code>testList :: ListT Maybe a -&gt; ListT Maybe a\ntestList (ListT (Just [])) = ListT Nothing\ntestList x = x\n</code></pre>\n\n<p>If you want something that talks to the type system a bit more, you could construct a monad instance out of <a href=\"https://hackage.haskell.org/package/semigroups-0.18.1/docs/Data-List-NonEmpty.html\" rel=\"nofollow noreferrer\"><code>NonEmpty</code></a> (bear in mind, this will be no more of a well-behaved monad transformer than <code>ListT</code> is, but it will do what you want it to). We could call it <code>NonEmptyT</code>.</p>\n\n<pre><code>newtype NonEmptyT m a = NonEmptyT { unNonEmptyT :: m (NonEmpty a) }\n\n-- Instance implementations omitted for brevity\n\ninstance Functor m =&gt; Functor (NonEmptyT m) where\n    ...\n\ninstance Applicative m =&gt; Applicative (NonEmptyT m) where\n    ...\n\ninstance Monad m =&gt; Monad (NonEmptyT m) where\n    ...\n\ninstance MonadTrans NonEmptyT where\n    ...\n</code></pre>\n\n<p>Now we can write</p>\n\n<pre><code>testList' :: [a] -&gt; NonEmptyT Maybe a\ntestList' [] = NonEmptyT Nothing\ntestList' (x:xs) = NonEmptyT $ Just (x :| xs)\n</code></pre>\n\n<p>This takes an ordinary list and turns it into a <code>NonEmptyT Maybe</code>. What makes this different from your previous approach is that the value you don't like (<code>ListT (Just [])</code>) is <em>not even meaningful</em> in our new type. You can have <code>NonEmptyT Nothing</code> and you can have <code>NonEmptyT (Just someNonemptyList)</code>, but the expression <code>NonEmptyT (Just [])</code> will not even typecheck.</p>\n\n<p>This isn't quite the behavior you're looking for, with the transformer actually interacting with and understanding the layer below it, but I think it's a step in the right direction, since it outright forbids programmers from constructing the value you don't want to exist.</p>\n\n<p><a href=\"https://gist.github.com/Mercerenies/7aad5e60e81dd97e3c0a0cfc1fc03702\" rel=\"nofollow noreferrer\">Full working example</a>.</p>\n\n<hr>\n\n<p>(Footnote: Unfortunately, GHC didn't want to let me use either <code>GeneralizedNewtypeDeriving</code> or <code>DeriveFunctor</code> on this new type, so you do actually have to write the instances by hand. If anyone knows why these extensions fail in this case, I'd love to know the reason.)</p>\n"}], "owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1517072590, "creation_date": 1517070352, "question_id": 48477855, "link": "https://stackoverflow.com/questions/48477855/monad-transformer-for-signaling-no-solution-list-with-nothing", "title": "Monad transformer for signaling no solution list with `Nothing`", "body": "<p>Greetings fellow Haskellers.</p>\n\n<p>This is a toy version of a larger constraint satisfaction problem I am\nworking on at the moment.</p>\n\n<p>The code below employs the list monad transformer to represent a given\npositive integer <code>n</code> as a sum of small even integers in different\nways.</p>\n\n<pre><code>import Control.Monad.Trans.List\nimport Control.Monad\n\nsumToN' :: Int -&gt; ListT Maybe [Int]\nsumToN' n\n  | n == 0 = pure []\n  | otherwise = \n      do\n        x &lt;- ListT $ Just [1..4]\n        guard $ x &lt;= n\n        guard $ even x\n        fmap (x:) $ sumToN' $ n - x\n</code></pre>\n\n<p>After loaded into GHCi the function works sort of as expected.</p>\n\n<pre><code>\u03bb&gt; sumToN' 8\nListT (Just [[2,2,2,2],[2,2,4],[2,4,2],[4,2,2],[4,4]])\n\u03bb&gt; sumToN' 7\nListT (Just [])\n</code></pre>\n\n<p>However, I was hoping to add some style to my code by defining a\nfunction that would return <code>ListT Nothing</code> in case no solution is\nfound. This is not what I got. The result I got is likely to be a\nresult of how <code>mzero</code> is defined for <code>ListT</code>.</p>\n\n<pre><code>\u03bb&gt; mzero :: ListT Maybe [Int]\nListT (Just [])\n</code></pre>\n\n<p>My question is: <strong>Is it possible to use monad transformers to combine\nlists and <code>Maybe</code> so that <code>Nothing</code> would signal no solution in the\ncode.</strong> (I am not looking for a hack. I want to know if monad\ntransformers would somehow support this directly.)</p>\n\n<p>As background information, the following code does not use monad\ntransformers at all and achieves the same result as above in terms of\nindicating no solution by <code>[]</code>.</p>\n\n<pre><code>sumToN :: Int -&gt; [[Int]]\nsumToN 0 = [[]]\nsumToN n = do\n  x &lt;- [1..4]\n  guard $ x &lt;= n\n  guard $ even x\n  map (x:) $ sumToN $ n - x\n</code></pre>\n\n<p>This gives us basically the same result as list transformer.</p>\n\n<pre><code>\u03bb&gt; sumToN 8\n[[2,2,2,2],[2,2,4],[2,4,2],[4,2,2],[4,4]]\n\u03bb&gt; sumToN 7\n[]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1517077909, "creation_date": 1517077909, "answer_id": 48479144, "question_id": 48477416, "link": "https://stackoverflow.com/questions/48477416/what-type-to-give-to-a-function-that-measures-a-data-structure-int-integer-in/48479144#48479144", "title": "What type to give to a function that measures a data structure? Int, Integer, Integral?", "body": "<p>Short answer:  As a general rule use <code>Int</code>, and if you need to convert it to something else, use <code>fromIntegral</code>.  (If you find yourself doing the conversion a lot, define <code>fi = fromIntegral</code> to save typing or else create your own wrapper.)</p>\n\n<p>The main consideration is performance.  You want to write the algorithm so it uses an efficient integer type internally.  Provided <code>Int</code> is big enough for whatever calculation you're doing (the standard guarantees a signed 30-bit integer, but even on 32-bit platforms using GHC, it's a signed 32-bit integer), you can assume it will be a high-speed integer type on the platform, particularly in comparison to <code>Integer</code> (which has boxing and bignum calculation overhead that can't be optimized away).  Note that the performance differences can be substantial.  Simple counting algorithms will often be 5-10x faster using <code>Int</code>s compared to <code>Integer</code>s.</p>\n\n<p>While you <em>could</em> give your function a different signature:</p>\n\n<pre><code>depth :: Expr -&gt; Integer\ndepth :: (Num a) =&gt; Expr -&gt; a\n</code></pre>\n\n<p>but actually implement it under the hood using the efficient <code>Int</code> type and do the conversion at the end, making the conversion implicit strikes me as poor practice.  Particularly if this is a library function, making it clear that <code>Int</code> is being used internally by making it part of the signature strikes me as more sensible.</p>\n\n<p>With respect to your listed considerations:</p>\n\n<p>First, the <code>generic*</code> functions in <code>Data.List</code> aren't modern.  In particular, <code>genericLength</code> was available in <a href=\"https://www.haskell.org/ghc/download_ghc_029.html\" rel=\"noreferrer\">GHC 0.29</a>, released July, 1996.  At some prior point,  <code>length</code> had been defined <em>in terms of</em> <code>genericLength</code>, as simply:</p>\n\n<pre><code>length :: [a] -&gt; Int\nlength = genericLength\n</code></pre>\n\n<p>but in GHC 0.29, this definition was commented out with an <code>#ifdef USE_REPORT_PRELUDE</code>, and several hand-optimized variants of <code>length</code> were defined independently.  The other <code>generic*</code> functions weren't in 0.29, but they were already around by GHC 4.02 (1998).</p>\n\n<p>Most importantly, when the <code>Prelude</code> version of <code>length</code> was generalized from lists to <code>Foldable</code>s, which <strong>is</strong> a fairly recent development (since GHC 7.10?), nobody cared enough to do anything with <code>genericLength</code>.  I also don't think I've ever seen these functions used \"in the wild\" in any serious Haskell code.  For the most part, you can think of them as deprecated.</p>\n\n<p>Second, the use of lazy/strict and <code>ByteString</code>/<code>Text</code> variants in libraries represents a somewhat different situation.  In particular, a <code>conduit-xml</code> user will normally be making the decision between lazy and strict variants and between <code>ByteString</code> and <code>Text</code> types based on considerations about the data being processed and the construction of the algorithms that are far-reaching and pervade the entire type system of a given program.  If the only way to use <code>conduit-xml</code> with a lazy <code>Text</code> type was to convert it piecemeal to strict <code>ByteString</code>s, pass it to the library, and then pull it back out and convert it back to a lazy <code>Text</code> type, no one would accept that complexity.  In contrast, a monomorphic <code>Int</code>-based definition of <code>depth</code> works fine, because all you need is <code>fromInteger . depth</code> to adapt it to any numeric context.</p>\n\n<p>Third, as noted above, <code>Integer</code> is only a \"nicer\" type from the standpoint of having arbitrary precision in situations where you don't care about performance.  For things like <code>depth</code> and <code>count</code> in any practical setting, performance is likely to be more important than unlimited precision.</p>\n\n<p>Fourth, I don't think either the runtime cost or failure-to-memoize should be serious considerations in choosing between polymorphic or non-polymorphic versions here.  In most situations, GHC will generate a specialized version of the polymorphic function in a context where memoization is no problem.</p>\n\n<p>On this basis, I suspect if <code>Data.List</code> was designed today, it would still use <code>Int</code>s.</p>\n"}, {"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1517115825, "post_id": 48479360, "comment_id": 83959546, "body": "It&#39;s a shame I cannot accept this answer as well. Thank you very much!"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1517079216, "creation_date": 1517079216, "answer_id": 48479360, "question_id": 48477416, "link": "https://stackoverflow.com/questions/48477416/what-type-to-give-to-a-function-that-measures-a-data-structure-int-integer-in/48479360#48479360", "title": "What type to give to a function that measures a data structure? Int, Integer, Integral?", "body": "<p><em>I agree with all the points in K. A. Buhr's great answer, but here are a couple more:</em></p>\n\n<p>You should use a return type of <code>Integer</code> if you expect to support an expression tree that somehow doesn't fit in memory (which seems interesting, but unlikely). If I saw <code>Expr -&gt; Integer</code> I would go looking in the code or docs to try to understand how or why the codomain might be so large.</p>\n\n<p>Re. performance of <code>Integer</code>: normal machine-word arithmetic will be used if the number is not larger than the max width of a machine word. Simplifying, the type is basically:</p>\n\n<pre><code>data Integer = SmallInteger Int | LargeInteger ByteArray\n</code></pre>\n\n<p>K. A. Buhr mentions that there is an unavoidable performance penalty which is that this value cannot be unboxed (that is it will always have a heap representation, and will be read from and written to memory), and that does sound right to me.</p>\n\n<p>In contrast, functions on <code>Int</code> (or <code>Word</code>) are often unboxed, so that in core you will see types that look like <code>Int# -&gt; Int# -&gt;</code>. You can think of an <code>Int#</code> as only existing in a machine register. This is what you want your numeric code to look like if you care about performance.</p>\n\n<p>Re. polymorphic versions: designing libraries around concrete numeric inputs and polymorphic numeric outputs probably works okay, in terms of convenient type inference. We already have this to a certain degree, in that numeric literals are overloaded. There are certainly times when literals (e.g. also string literals when <code>-XOverloadedStrings</code>) need to be given type signatures, and so I'd expect that if <code>base</code> were designed to be more polymorphic that you would run into more occasions where this would be required (but fewer uses of <code>fromIntegral</code>). </p>\n\n<p>Another option you haven't mentioned is using <code>Word</code> to express that the <code>depth</code> is non-negative. This is more useful for inputs, but even then is often not worth it: <code>Word</code> will still overflow, and negative literals are valid (although GHC will issue a warning); to a certain extent it's just moving where the bug occurs.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 48479144, "answer_count": 2, "score": 4, "last_activity_date": 1517079216, "creation_date": 1517067653, "question_id": 48477416, "link": "https://stackoverflow.com/questions/48477416/what-type-to-give-to-a-function-that-measures-a-data-structure-int-integer-in", "title": "What type to give to a function that measures a data structure? Int, Integer, Integral?", "body": "<p>I have a data structure, such as an expression tree or graph. I want to add some \"measure\" functions, such as <code>depth</code> and <code>size</code>.</p>\n\n<p>How best to type these functions?</p>\n\n<p>I see the following three variants as of roughly equal usefulness:</p>\n\n<ul>\n<li><code>depth :: Expr -&gt; Int</code></li>\n<li><code>depth :: Expr -&gt; Integer</code></li>\n<li><code>depth :: Num a =&gt; Expr -&gt; a</code></li>\n</ul>\n\n<p>I have the following considerations in mind:</p>\n\n<ul>\n<li><p>I'm looking at <code>base</code> and <code>fgl</code> as examples, and they consistently use <code>Int</code>, but <code>Data.List</code> also has functions such as <code>genericLength</code> that are polymorphic in return type, and I am thinking that maybe the addition of these <code>generic</code> functions is a reflection of a modernizing trend that I probably should respect and reinforce.</p></li>\n<li><p>A similar movement of thought is noticeable in some widely used libraries providing a comprehensive set of functions with the same functionality when there are several probable choices of a return type to be desired by the user (e.g. <code>xml-conduit</code> offers parsers that accept both lazy and strict kinds of either <code>ByteString</code> or <code>Text</code>).</p></li>\n<li><p><code>Integer</code> is a nicer type overall than <code>Int</code> and I sometimes find that I need to cast a length of a list to an <code>Integer</code>, say because an algorighm that operates in <code>Integer</code> needs to take this length into account.</p></li>\n<li><p>Making functions return <code>Integral</code> means these functions are made polymorphic, and it may have performance penalty. I don't know all the particulars well, but, as I understand, there may be some run-time cost, and polymorphic things are harder to memoize.</p></li>\n</ul>\n\n<p>What is the accepted best practice? Which part of it is due to legacy and compatibility considerations? (I.e. if <code>Data.List</code> was designed today, what type would functions such as <code>length</code> have?) Did I miss any pros and cons?</p>\n"}, {"tags": ["linux", "haskell", "nix", "nixos", "lambdabot"], "answers": [{"tags": [], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "is_accepted": false, "score": 1, "last_activity_date": 1517091480, "creation_date": 1517091480, "answer_id": 48481113, "question_id": 48477392, "link": "https://stackoverflow.com/questions/48477392/configuring-twitch-lambdabot-as-a-service-on-nixos/48481113#48481113", "title": "Configuring twitch lambdabot as a service on NixOS", "body": "<pre><code>[root@nixos:/home/neo]# systemctl status lambdabot\n\u25cf lambdabot.service - Lambdabot daemon\nLoaded: loaded (/nix/store/ifwgvglg3vzndk5wssb66vdz9j9rdflf-unit-lambdabot.service/lambdabot.service; enabled; vendor preset: enabled)\nActive: active (running) since Sat 2018-01-27 23:53:33 EET; 1min 32s ago\nMain PID: 4749 (lambdabot-start)\n    Tasks: 8 (limit: 4915)\nCGroup: /system.slice/lambdabot.service\n        \u251c\u25004749 /nix/store/jgw8hxx7wzkyhb2dr9hwsd9h2caaasdc-bash-4.4-p12/bin/bash -e /nix/store/0c6ya3n4bz6id840f4gprv3ly24808rn-unit-script/bin/lambdabot-start\n        \u251c\u25004753 /nix/store/jgw8hxx7wzkyhb2dr9hwsd9h2caaasdc-bash-4.4-p12/bin/bash -e /nix/store/0c6ya3n4bz6id840f4gprv3ly24808rn-unit-script/bin/lambdabot-start\n        \u251c\u25004754 /nix/store/h0z0pf4ix0ilx5j1x6sk1rfkpjcyjhvc-lambdabot-5.1.0.1/bin/lambdabot\n        \u2514\u25004755 cat /run/lambdabot/offline\n\nJan 27 23:53:33 nixos systemd[1]: Started Lambdabot daemon.\nJan 27 23:53:37 nixos lambdabot-start[4749]: [WARNING] Plugin.seen: WARNING: failed to read Seen module state: Data.Binary.Get.runGet at position 0: not enough bytes\nJan 27 23:53:37 nixos lambdabot-start[4749]: CallStack (from HasCallStack):\nJan 27 23:53:37 nixos lambdabot-start[4749]:   error, called at libraries/binary/src/Data/Binary/Get.hs:342:5 in binary-0.8.3.0:Data.Binary.Get\nJan 27 23:53:37 nixos lambdabot-start[4749]: Plugin `offlineRC' failed with: /var/lib/lambdabot/.lambdabot/State: createDirectory: permission denied (Permission denied)\n</code></pre>\n\n<p>The issue is that I set permission on the creds.rc file instead of on the entire folder, fix:</p>\n\n<pre><code>chown -R lambdabot:users /var/lib/lambdabot/.lambdabot\n</code></pre>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517091480, "creation_date": 1517067531, "question_id": 48477392, "link": "https://stackoverflow.com/questions/48477392/configuring-twitch-lambdabot-as-a-service-on-nixos", "title": "Configuring twitch lambdabot as a service on NixOS", "body": "<p>What I tried:</p>\n\n<p>in /etc/nixos/configuration.nix:</p>\n\n<pre><code>  services.lambdabot.enable = true;\n  services.lambdabot.script =\"\nrc /var/lib/lambdabot/.lambdabot/creds.rc\nirc-connect twitch irc.chat.twitch.tv 6667 IsoMorpheus Lambda_Robots:_100%_Loyal\nadmin + twitch:IsoMorpheus\njoin twitch:#freeman42x\";\n</code></pre>\n\n<p>in /var/lib/lambdabot/.lambdabot/creds.rc:</p>\n\n<pre><code>irc-password oauth:6q9hoi2notaellmugrr3alh9yjx8ua\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>nixos-rebuild switch\n\nchown lambdabot /var/lib/lambdabot/.lambdabot/creds.rc\n\nsystemctl restart lambdabot\n</code></pre>\n\n<p>Checking HTOP it can be seen that the service is running but the bot does not connect to the IRC channel.</p>\n\n<p>Settings from the <a href=\"http://schmitthenner.eu/nixos/manual/options.html\" rel=\"nofollow noreferrer\">manual</a>:</p>\n\n<pre><code>services.lambdabot.enable\n\n    Enable the Lambdabot IRC bot\n\n    Type: boolean\n\n    Default: false\n\n    Declared by:\n    &lt;nixpkgs/nixos/modules/services/networking/lambdabot.nix&gt; \nservices.lambdabot.script\n\n    Lambdabot script\n\n    Type: string\n\n    Default: \"\"\n\n    Declared by:\n    &lt;nixpkgs/nixos/modules/services/networking/lambdabot.nix&gt; \n</code></pre>\n\n<p>Launching lambdabot manually it connects fine and it replies to commands:</p>\n\n<p><a href=\"https://github.com/lambdabot/lambdabot/blob/1d1ed3e7980081c9f356f8d2fd8ca2771c0ed4f4/lambdabot-core/README.md#connecting\" rel=\"nofollow noreferrer\">https://github.com/lambdabot/lambdabot/blob/1d1ed3e7980081c9f356f8d2fd8ca2771c0ed4f4/lambdabot-core/README.md#connecting</a></p>\n\n<p>Any suggestions of how to launch it as a service?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1517048313, "post_id": 48474587, "comment_id": 83942871, "body": "You can implement your own <code>ToJSON</code> and <code>FromJSON</code> and then thus perform the &quot;<i>key translation</i>&quot; so to speak."}, {"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1517051092, "post_id": 48474587, "comment_id": 83943574, "body": "I&#39;ll try this approach also. BTW thank you for your TemplateHaskell-answer."}], "answers": [{"comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1517051812, "post_id": 48475024, "comment_id": 83943777, "body": "please add <code>import Data.Text (Text)  type URL = T</code> to complete <code>MainFile.hs</code>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 10, "last_activity_date": 1517051865, "last_edit_date": 1517051865, "creation_date": 1517050467, "answer_id": 48475024, "question_id": 48474587, "link": "https://stackoverflow.com/questions/48474587/how-to-deal-with-haskells-reserved-keywords-in-record-fields/48475024#48475024", "title": "How to deal with Haskell&#39;s reserved keywords in record fields?", "body": "<p>We can solve this by using <code>TemplateHaskell</code>. Instead of writing <code>ToJSON</code> and <code>FromJON</code>, we can use a specific mapping of the keys.</p>\n\n<p>First of all, we have to construct a name for the field that is <em>not</em> type, for instance:</p>\n\n<pre><code>data Owner = Owner {\n      id :: Int,\n      gravatar_id :: Text,\n      login :: Text,\n      avatar_url :: Text,\n      events_url :: URL,\n      followers_url :: URL,\n      following_url :: URL,\n      gists_url :: URL,\n      html_url :: URL,\n      organizations_url :: URL,\n      received_events_url :: URL,\n      repos_url :: URL,\n      starred_url :: URL,\n      subscriptions_url :: URL,\n      url :: URL,\n      <b>owner_type</b> :: Text,\n      site_admin :: Bool\n  } deriving (Generic, Show)</code></pre>\n\n<p>Now we can use the <a href=\"http://hackage.haskell.org/package/aeson-0.6.2.1/docs/Data-Aeson-TH.html#v:deriveJSON\" rel=\"noreferrer\"><strong><code>deriveJSON :: Options -&gt; Name -&gt; Q [Dec]</code></strong></a> function that will construct a <code>fromJSON</code> and <code>toJSON</code> instance.</p>\n\n<p>The key here is the <a href=\"http://hackage.haskell.org/package/aeson-0.6.2.1/docs/Data-Aeson-TH.html#t:Options\" rel=\"noreferrer\"><strong><code>Options</code></strong></a> parameter: it contains a <strong><code>fieldLabelModifier :: String -&gt; String</code></strong> field that can rewrite the names of the fields to the keys in JSON. We can thus here generate a function that will rewrite it.</p>\n\n<p>So we first construct a function <code>ownerFieldRename :: String -&gt; String</code>:</p>\n\n<pre><code>ownerFieldRename :: String -&gt; String\nownerFieldRename \"owner_type\" = \"type\"\nownerFieldRename name = name\n</code></pre>\n\n<p>So this function acts as an identity function, except for <code>\"owner_type\"</code>, which is mapped on <code>\"type\"</code>.</p>\n\n<p>So now we can call the <code>deriveJSON</code> function with custom options like:</p>\n\n<pre><code>$(deriveJSON defaultOptions {fieldLabelModifier = ownerFieldRename} ''Owner)\n</code></pre>\n\n<p>Or in full:</p>\n\n<p><strong><code>RenameUtils.hs</code></strong>:</p>\n\n<pre><code><b>module RenameUtils where\n\nownerFieldRename :: String -&gt; String\nownerFieldRename \"owner_type\" = \"type\"\nownerFieldRename name = name</b></code></pre>\n\n<p><strong><code>MainFile.hs</code></strong>:</p>\n\n<pre><code><b>{-# LANGUAGE TemplateHaskell #-}</b>\n{-# LANGUAGE DeriveGeneric #-}\n\n<b>import Data.Aeson.TH(deriveJSON, defaultOptions, Options(fieldLabelModifier))</b>\n<b>import RenameUtils(ownerFieldRename)</b>\n\nimport Data.Text (Text)\n\ntype URL = Text\n\ndata Owner = Owner {\n      id :: Int,\n      gravatar_id :: Text,\n      login :: Text,\n      avatar_url :: Text,\n      events_url :: URL,\n      followers_url :: URL,\n      following_url :: URL,\n      gists_url :: URL,\n      html_url :: URL,\n      organizations_url :: URL,\n      received_events_url :: URL,\n      repos_url :: URL,\n      starred_url :: URL,\n      subscriptions_url :: URL,\n      url :: URL,\n      <b>owner_type</b> :: Text,\n      site_admin :: Bool\n  } deriving (Show)\n\n<b>$(deriveJSON defaultOptions {fieldLabelModifier = ownerFieldRename} ''Owner)</b></code></pre>\n\n<p>Now we obtain a JSON object with <code>type</code> as key:</p>\n\n<pre><code>Prelude Main Data.Aeson&gt; encode (Owner 1 \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" True)\n\"{\\\"id\\\":1,\\\"gravatar_id\\\":\\\"\\\",\\\"login\\\":\\\"\\\",\\\"avatar_url\\\":\\\"\\\",\\\"events_url\\\":\\\"\\\",\\\"followers_url\\\":\\\"\\\",\\\"following_url\\\":\\\"\\\",\\\"gists_url\\\":\\\"\\\",\\\"html_url\\\":\\\"\\\",\\\"organizations_url\\\":\\\"\\\",\\\"received_events_url\\\":\\\"\\\",\\\"repos_url\\\":\\\"\\\",\\\"starred_url\\\":\\\"\\\",\\\"subscriptions_url\\\":\\\"\\\",\\\"url\\\":\\\"\\\",\\\"type\\\":\\\"\\\",\\\"site_admin\\\":true}\"\n</code></pre>\n\n<p>For a simple <code>fieldLabelModifier</code> function we do not need to write a specific function (that we have to define in a specific module), we can also use an <em>lambda expression</em> here:</p>\n\n<p><strong><code>MainFile.hs</code></strong>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nimport Data.Aeson.TH(deriveJSON, defaultOptions, Options(fieldLabelModifier))\nimport Data.Text (Text)\n\ntype URL = Text\n\ndata Owner = Owner {\n      id :: Int,\n      gravatar_id :: Text,\n      login :: Text,\n      avatar_url :: Text,\n      events_url :: URL,\n      followers_url :: URL,\n      following_url :: URL,\n      gists_url :: URL,\n      html_url :: URL,\n      organizations_url :: URL,\n      received_events_url :: URL,\n      repos_url :: URL,\n      starred_url :: URL,\n      subscriptions_url :: URL,\n      url :: URL,\n      <b>owner_type</b> :: Text,\n      site_admin :: Bool\n  } deriving (Show)\n\n$(deriveJSON defaultOptions {fieldLabelModifier = <b>\\x -&gt; if x == \"owner_type\" then \"type\" else x</b>} ''Owner)</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": false, "score": 2, "last_activity_date": 1517053877, "last_edit_date": 1517053877, "creation_date": 1517053537, "answer_id": 48475459, "question_id": 48474587, "link": "https://stackoverflow.com/questions/48474587/how-to-deal-with-haskells-reserved-keywords-in-record-fields/48475459#48475459", "title": "How to deal with Haskell&#39;s reserved keywords in record fields?", "body": "<p>Willem's answer may be the more appropriate one, and may fit what you want better, but here's another way, allowing you to define your non-conflicting data without having to write the ToJSON and FromJSON instances for it, defining the types</p>\n\n<pre><code>data OwnerData = OwnerData {\n    oid :: Int\n    -- ... other data with non-conflicting names\n  } deriving (Show, Generic)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>data Owner = Owner {\n  owner_data :: OwnerData,\n  user_type :: Text\n} deriving (Show)\n</code></pre>\n\n<p>We can now define the following instances:</p>\n\n<pre><code>-- nothing special for OwnerData: \ninstance ToJSON OwnerData\ninstance FromJSON OwnerData\n\n-- a little helper function to extract the hashmap(Object) from a value\ntoObject :: ToJSON a =&gt; a -&gt; Object\ntoObject a = case toJSON a of\n  Object o -&gt; o\n  _        -&gt; error \"toObject: value isn't an Object\"\n\n-- the instances for Owner\ninstance ToJSON Owner where\n  toJSON (Owner {owner_data = ownerData, user_type = userType}) = \n    Object $ \n    toObject ownerData &lt;&gt; HML.fromList [\"type\" .= userType]\n\n  toEncoding (Owner {owner_data = ownerData, user_type = userType}) = \n    pairs . foldMap (uncurry (.=)) . HML.toList $ \n    toObject ownerData &lt;&gt; HML.fromList [\"type\" .= userType]\n\ninstance FromJSON Owner where\n  parseJSON = withObject \"Owner\" $ \\v -&gt; do\n    ownerData &lt;- parseJSON (Object v)\n    userType &lt;- v .: \"type\"\n    return Owner { owner_data = ownerData, user_type = userType }\n</code></pre>\n\n<p>The imports and language pragmas I used:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nimport Data.Aeson\nimport Data.Text (Text)\nimport Data.Monoid ((&lt;&gt;))\nimport GHC.Generics (Generic)\nimport qualified Data.HashMap.Lazy as HML (fromList, toList)\n</code></pre>\n"}], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 2, "accepted_answer_id": 48475024, "answer_count": 2, "score": 9, "last_activity_date": 1595590710, "creation_date": 1517046930, "last_edit_date": 1595590710, "question_id": 48474587, "link": "https://stackoverflow.com/questions/48474587/how-to-deal-with-haskells-reserved-keywords-in-record-fields", "title": "How to deal with Haskell&#39;s reserved keywords in record fields?", "body": "<p>JSON in response of <a href=\"https://developer.github.com/v3/gists/#list-a-users-gists\" rel=\"noreferrer\">Github Gists Rest API</a> contains <a href=\"https://wiki.haskell.org/Keywords#type\" rel=\"noreferrer\">Haskell's keyword</a> <code>type</code>. But <code>type</code> couldn't be used as a record field.</p>\n\n<p>Thus it couldn't be used in implementation of <a href=\"https://hackage.haskell.org/package/aeson-1.2.3.0/docs/Data-Aeson.html#g:1\" rel=\"noreferrer\">Aeson's Generic</a> FromJSON/ToJSON instances.</p>\n\n<pre><code>import Data.Text (Text)\n\nimport GHC.Generics (Generic)\n\ntype URL = Text\n\ndata OwnerType = User deriving (Show)\n\ndata Owner = Owner {\n      id :: Int,\n      gravatar_id :: Text,\n      login :: Text,\n      avatar_url :: Text,\n      events_url :: URL,\n      followers_url :: URL,\n      following_url :: URL,\n      gists_url :: URL,\n      html_url :: URL,\n      organizations_url :: URL,\n      received_events_url :: URL,\n      repos_url :: URL,\n      starred_url :: URL,\n      subscriptions_url :: URL,\n      url :: URL,\n      -- type :: Text,\n      site_admin :: Bool\n  } deriving (Generic, Show)\n\ninstance ToJSON Owner\ninstance FromJSON Owner\n</code></pre>\n\n<p><strong>Question</strong>:\nIs there a proper approach to deal with such kind of conflicts?</p>\n"}, {"tags": ["haskell", "runhaskell"], "owner": {"reputation": 11, "user_id": 9092782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13caf1200f6fef78cfd831dd38138567?s=128&d=identicon&r=PG&f=1", "display_name": "E2718", "link": "https://stackoverflow.com/users/9092782/e2718"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "closed_date": 1517040717, "answer_count": 0, "score": 1, "last_activity_date": 1517040354, "creation_date": 1517040354, "question_id": 48473863, "link": "https://stackoverflow.com/questions/48473863/how-to-specify-execution-order-of-do-block-when-using-runhaskell", "closed_reason": "Duplicate", "title": "How to specify execution order of do block when using runhaskell?", "body": "<p>Currently I'm trying to learn Haskell IO, and am using System.IO writeFile to edit a text file with this code:</p>\n\n<pre><code>main = do\n putStr \"Enter Some Text: \"\n text &lt;- getLine\n writeFile \"text.txt\" text\n putStrLn \"Updated!\"\n</code></pre>\n\n<p>In ghci this works fine, but when I try to repeat it using runhaskell, it appears to run the 'text &lt;- getLine' function first, and has the following output (first two lines were inputted):</p>\n\n<pre><code>runhaskell EditFile.hs\nhello\nEnter Some Text: Updated!\n</code></pre>\n\n<p>Why does runhaskell not run the function in order, and is there a way around this? (i.e. can I make it print \"Enter Some Text: \" before getting the user input?)</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1517039226, "post_id": 48473669, "comment_id": 83941102, "body": "Looks as a strictness issue. Try <code>spin increment (!index, !element1) spinNumber = ...</code> with <code>BangPatterns</code> on."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1517051372, "creation_date": 1517051372, "answer_id": 48475144, "question_id": 48473669, "link": "https://stackoverflow.com/questions/48473669/why-does-this-code-grow-so-large-in-memory/48475144#48475144", "title": "Why does this code grow so large in memory?", "body": "<p>Basically, at each step <code>foldl'</code> will evaluate the result of the function <code>spin'</code> at every step, bringing it to WHNF (weak head normal form). Concretely, this means that the result will be evaluated until the first constructor.</p>\n\n<p>However, the result of <code>spin'</code> is <code>(next,nextElementOne)</code>, which is already in WHNF, since it starts with a pair constructor. What we want is to force the evaluation of the pair components here. One basic solution is to return</p>\n\n<pre><code>spin ... = next `seq` (nextElementOne `seq` (next, nextElementOne))\n</code></pre>\n\n<p>so that the components will be evaluated before returning the pair.</p>\n\n<p>A more modern approach could be exploiting <code>BangPatterns</code>, instead.</p>\n"}], "owner": {"reputation": 7285, "user_id": 51007, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5db5360695c59775397379d5e015e9f2?s=128&d=identicon&r=PG", "display_name": "Quinn Wilson", "link": "https://stackoverflow.com/users/51007/quinn-wilson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 48475144, "answer_count": 1, "score": 0, "last_activity_date": 1517051372, "creation_date": 1517038518, "question_id": 48473669, "link": "https://stackoverflow.com/questions/48473669/why-does-this-code-grow-so-large-in-memory", "title": "Why does this code grow so large in memory?", "body": "<p>if I call <code>crash</code> with any value for <code>increment</code> and 50000000 (fifty million) for spins, it ramps up and keeps growing in memory size until has choked every last bit of memory and then crashes. </p>\n\n<pre><code>crash :: Int -&gt; Int -&gt; Int \ncrash increment spins = snd $ foldl' spin' (0,0) [1..spins]\n  where spin' = spin increment\n\nspin increment (index,element1) spinNumber = (next,nextElementOne)\n  where\n    next \n      | indexNIncrement &gt;= spinNumber = 1 + (indexNIncrement `rem` spinNumber)\n      | otherwise = 1 + indexNIncrement\n    indexNIncrement = index + increment\n    nextElementOne\n      | next==1 = spinNumber\n      | otherwise = element1\n</code></pre>\n\n<p>I don't see how memory is leaked. Doesn't each call to <code>spin</code> replace the accumulator value? Doesn't it get released? </p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517028733, "post_id": 48472642, "comment_id": 83939163, "body": "Please include the code as text, not an image. That said, you are expected to <a href=\"https://meta.stackoverflow.com/questions/334822/how-do-i-ask-and-answer-homework-questions\">show your own effort on homework</a> so we know what specific issue you are having. We won\u2019t do your homework for you but we can help you understand how to do it yourself."}, {"owner": {"reputation": 103, "user_id": 7239626, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ec78f68dfff25c98bd491f1aeb86dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Programmer", "link": "https://stackoverflow.com/users/7239626/programmer"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517029012, "post_id": 48472642, "comment_id": 83939201, "body": "Yeah sorry about that I wasn&#39;t able to format the code correctly for some reason. But yeah I just want some explanations if possible. I completely understand that my homework would be done for me."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1517030522, "post_id": 48472642, "comment_id": 83939424, "body": "You can format a b;ock of code by selecting it and hitting the <code>{}</code> button."}, {"owner": {"reputation": 103, "user_id": 7239626, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ec78f68dfff25c98bd491f1aeb86dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Programmer", "link": "https://stackoverflow.com/users/7239626/programmer"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1517031008, "post_id": 48472642, "comment_id": 83939498, "body": "My goodness... Got it. Thanks a lot for that! @Davislor"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1517103814, "post_id": 48472642, "comment_id": 83957772, "body": "Oh, and a good way to test the function on a given input is <code>ghci -e</code>, for example: <code>ghci -e &quot;check (Sing &#39;a&#39;) &quot;abb&quot; check.hs</code>.  You can also add your test cases to the file itself, such as <code>testcase1 = check (Sing &#39;a&#39;) &quot;abb&quot;</code>, and you can write a simple test driver for it, as in <code>main = foldMap print [check (Sing &#39;a&#39;) &quot;abb&quot;, check (Sing &#39;a&#39; :|: Sing &#39;b&#39;) &quot;abb&quot;]</code> and so on for your other test cases.  This takes a list of test cases, maps it to a list of <code>IO</code> actions that print out each test case, then combines that list to a single <code>IO</code> action that prints them all, which runs as <code>main</code>."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 7239626, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ec78f68dfff25c98bd491f1aeb86dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Programmer", "link": "https://stackoverflow.com/users/7239626/programmer"}, "edited": false, "score": 0, "creation_date": 1517036803, "post_id": 48472927, "comment_id": 83940584, "body": "Okay that helped a lot! I will go through and try your solutions. I feel like I almost have it. and yes you are correct, the regex is defined. I will edit the code to show what the regex was defined as"}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": true, "score": 3, "last_activity_date": 1517032878, "last_edit_date": 1517032878, "creation_date": 1517031198, "answer_id": 48472927, "question_id": 48472642, "link": "https://stackoverflow.com/questions/48472642/haskell-basic-check-function/48472927#48472927", "title": "Haskell basic &quot;check&quot; function", "body": "<p>Not a complete answer, since this is homework (and also not a MCVE), but the general approach I would suggest for this kind of problem is to replace the parts you haven't written yet with what's called a <em>typed hole</em>.  That is, change the lines with <code>error</code> statements to the following:</p>\n\n<pre><code>check (Sing c) (c':cs) = _\ncheck (r1 --- r2) cs = _\n</code></pre>\n\n<p>GHC will then give you a compile error that tells you what the type of the hole is and which variables are in scope with the right types to fill it.  You can suppress this error to compile and test the rest of the code, and only crash the program if the hole is actually executed, like <code>error</code> does, with the <code>-fdefer-typed-holes</code> command-line option.</p>\n\n<p>If you're partly sure of the solution, you can partly fill in the hole. Let's say your hole is a function from a list of one type to a list of another type.  You might then try <code>map _</code>.  If you're taking in a list <code>(c':cs)</code> and returning a list, it might possibly have the form <code>(_ c'):(check _ cs)</code>.  If you need to return a <code>Maybe</code> something, you could try <code>Just _</code>.  Keep filling in the holes with functions of the right types until you have a working program.</p>\n\n<p><code>Regex</code> is some kind of type (presumably representing a <em>regular expression</em>), which should have been defined in a libraary you were given, along with the functions you have available to work with them.  The <code>check</code> function is supposed to take two arguments, a <code>Regex</code> and a <code>String</code>.  (Presumably, it's checking whether the <code>String</code> matches the <code>Regex</code>?)  A <code>Maybe String</code> is a type that contains either <code>Just</code> a <code>String</code> or <code>Nothing</code>, so in this context, I'm guessing you're supposed to return either a portion of the string that matches, or <code>Nothing</code> if there is no match.  But the assignment should give you a specification.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1517040283, "creation_date": 1517040283, "answer_id": 48473859, "question_id": 48472642, "link": "https://stackoverflow.com/questions/48472642/haskell-basic-check-function/48473859#48473859", "title": "Haskell basic &quot;check&quot; function", "body": "<blockquote>\n  <p>Instructions on how to test the function would be great.</p>\n</blockquote>\n\n<p>You did not state the purpose of the function, so I'll make an educated guess.</p>\n\n<p>The function <code>check re str</code> takes a regexp <code>re</code> and a string <code>str</code>, and checks whether a <em>prefix</em> of <code>str</code> matches with <code>re</code>. On success <code>Just str2</code> is returned, where <code>str2</code> is the <em>rest</em> of <code>str</code> after the matching prefix. Of failure, <code>Nothing</code> is returned.</p>\n\n<p>(BTW, I don't think this interface allows for implementing the correct backtracking on the alternative case, but I'll neglect that.)</p>\n\n<p>Some test cases:</p>\n\n<p><code>check (Sing 'a' :.: Sing 'b') \"abc\"</code> matches string \"abc\" with the regexp \"ab\": the result should be <code>Just \"c\"</code>.</p>\n\n<p><code>check (Sing 'a' :.: Sing 'b') \"axbc\"</code> should be <code>Nothing</code>.</p>\n\n<p><code>check (Plus (Sing 'a') :.: Sing 'b') \"aaaaaabc\"</code> should be <code>Just \"c\"</code>.</p>\n\n<p><code>check ((Sing 'a' :|: Sing 'A') :.: Sing 'b') \"abc\"</code> should be <code>Just \"c\"</code>.</p>\n\n<p><code>check ((Sing 'a' :|: Sing 'A') :.: Sing 'b') \"Abc\"</code> should also be <code>Just \"c\"</code>.</p>\n"}], "owner": {"reputation": 103, "user_id": 7239626, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2ec78f68dfff25c98bd491f1aeb86dc4?s=128&d=identicon&r=PG&f=1", "display_name": "Programmer", "link": "https://stackoverflow.com/users/7239626/programmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 1, "closed_date": 1517519274, "accepted_answer_id": 48472927, "answer_count": 2, "score": -4, "last_activity_date": 1517046686, "creation_date": 1517027750, "last_edit_date": 1517046686, "question_id": 48472642, "link": "https://stackoverflow.com/questions/48472642/haskell-basic-check-function", "closed_reason": "Needs more focus", "title": "Haskell basic &quot;check&quot; function", "body": "<p>I have this homework problem and I am absolutely lost... So the problem says \"Fill in the definitions of the Sing and (:.:) cases for the \"check\" function.\" I am confused what the Regex and Maybe String mean. Also not quite sure what a lot of the syntax is and every time I look up videos I never understand it. I have been programming with c++ and c for a while and understand it well so examples in those would be good if that is possible. Instructions on how to test the function would be great. I know how to compile it and run it in GHCI but I don't know what to type in to trigger the test for that function.</p>\n\n<p>The code looks like this</p>\n\n<pre><code>check :: Regex -&gt; String -&gt; Maybe String\ncheck Epsilon cs = Just cs\ncheck (Sing c) (c':cs) = c' + cs\ncheck (r1 :.: r2) cs = r1 + r2\ncheck (r1 :|: r2) cs =\n    case check r1 cs of\n        Just cs' -&gt; Just cs'\n        Nothing  -&gt; check r2 cs\ncheck (Plus r) cs =\n    case check r cs of\n        Just cs' -&gt; case check (Plus r) cs' of\n            Just cs'' -&gt; Just cs''\n            Nothing   -&gt; Just cs'\n        Nothing -&gt; Nothing\ncheck _ _ = Nothing\n</code></pre>\n\n<p>So the <code>c' +cs</code> on line 3 is my attemped and the isntructions say that the next line will be very similar but I tried <code>r1 + r2</code> this out and it doesn't even compile.</p>\n\n<pre><code>data Regex\n  = Epsilon           -- empty string\n  | Sing Char         -- single character\n  | (:.:) Regex Regex -- concatenation\n  | (:|:) Regex Regex -- alternation\n  | Plus Regex        -- repetition (one or more)\n</code></pre>\n"}, {"tags": ["haskell", "parse-error"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517024868, "post_id": 48472348, "comment_id": 83938582, "body": "Remove the indentation from the lines that begin with <code>area</code>."}, {"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517024988, "post_id": 48472348, "comment_id": 83938598, "body": "Same error, no dice."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517028092, "post_id": 48472348, "comment_id": 83939067, "body": "Are you sure the line generating the error is one of the ones you\u2019ve included?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517028194, "post_id": 48472348, "comment_id": 83939080, "body": "Please include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. It\u2019s not clear that you\u2019ve included the right code."}, {"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517028342, "post_id": 48472348, "comment_id": 83939100, "body": "I edited my question to include the complete and verbatim  text screen + error code. Will this work?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517028408, "post_id": 48472348, "comment_id": 83939114, "body": "GHCi doesn\u2019t allow multi line input by default. Put your code in a file and load the file."}, {"owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517028848, "post_id": 48472348, "comment_id": 83939180, "body": "This produces a &quot;permission denied error&quot; but that is another question. If you put this as an answer I will accept it."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1517048355, "creation_date": 1517048355, "answer_id": 48474771, "question_id": 48472348, "link": "https://stackoverflow.com/questions/48472348/parsing-error-on-premade-code-with-winghci/48474771#48474771", "title": "Parsing error on premade code with WinGHCi", "body": "<p>GHCi is a <em>Read Eval Print Loop</em> (REPL), so it evaluates each line as it's input. <code>area</code>, on the other hand, is a multi-line expression, so if you try to input it line by line, it's going to fail as being incomplete.</p>\n\n<p>You <em>can</em> enter multiline expressions in GHCi, though. What you need to do is enter into 'multiline mode', enter your lines, and exist the multiline mode again. You start this editing mode with <code>:{</code> and close it again with <code>:}</code>. Here's a full example:</p>\n\n<pre><code>Prelude&gt; data Shape = Circle Double | Rect Double Double\nPrelude&gt; :{\nPrelude| area :: Shape -&gt; Double\nPrelude| area (Circle radius) = 3.1415 * radius * radius\nPrelude| area (Rect width height) = width * height\nPrelude| :}\nPrelude&gt; area $ Circle 1.1\n3.8012150000000005\nPrelude&gt; area $ Rect 1.2 3.4\n4.08\n</code></pre>\n\n<p>As you can see, the definition of <code>Shape</code> is already a single line, so I didn't feel the need to enter into multi-line mode at that stage. When entering the definition of <code>area</code>, though, it's necessary to use <code>:{</code> and <code>:}</code>.</p>\n\n<p>In general, however, GHCi is for experimentation and rapid feedback. You're supposed to write Haskell source code in <code>.hs</code> files, often using either <a href=\"https://docs.haskellstack.org\" rel=\"nofollow noreferrer\">Stack</a> or <a href=\"https://www.haskell.org/cabal\" rel=\"nofollow noreferrer\">Cabal</a> as a project system.</p>\n"}], "owner": {"reputation": 329, "user_id": 6042318, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1265844773432521/picture?type=large", "display_name": "Legion Daeth", "link": "https://stackoverflow.com/users/6042318/legion-daeth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 48474771, "answer_count": 1, "score": 2, "last_activity_date": 1517048355, "creation_date": 1517024322, "last_edit_date": 1517047969, "question_id": 48472348, "link": "https://stackoverflow.com/questions/48472348/parsing-error-on-premade-code-with-winghci", "title": "Parsing error on premade code with WinGHCi", "body": "<p>I just downloaded the full Haskell platform and put in some code from my teacher to try and break, but it turns out it (or something) was already broken because when I evaluate the <code>main</code> expression I get a parsing error.</p>\n\n<pre><code>data Shape = Circle Double | Rect Double Double\narea :: Shape -&gt; Double\narea (Circle radius) = 3.1415 * radius * radius\narea (Rect width height) = width * height\n</code></pre>\n\n<p>Error</p>\n\n<pre><code>&lt;interactive&gt;:17:56: error: parse error on input \u2018::\u2019\n</code></pre>\n\n<p>Is there something wrong with my installation? I'm running version 8.2.2</p>\n\n<p>EDIT: Here is a verbatim copypaste of the error directly from the WinGHCi window</p>\n\n<pre><code>GHCi, version 8.2.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; data Shape = Circle Double | Rect Double Double\narea :: Shape -&gt; Double\narea (Circle radius) = 3.1415 * radius * radius\narea (Rect width height) = width * height\n\n&lt;interactive&gt;:7:54: error: parse error on input \u2018::\u2019\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "is_accepted": false, "score": 1, "last_activity_date": 1517035048, "creation_date": 1517035048, "answer_id": 48473298, "question_id": 48472089, "link": "https://stackoverflow.com/questions/48472089/ghci-prettty-printer-is-not-rendered-with-a-color-that-would-make-it-noticeabl/48473298#48473298", "title": "GHCI Prettty Printer - is not rendered with a color that would make it noticeable", "body": "<p>Because there wasn't an easy way to submit a patch to the actual issue I set the comment color to be same as the digits so that it is readable:</p>\n\n<pre><code>HsColour.comment  = [HsColour.Foreground HsColour.Red, HsColour.Bold]\n</code></pre>\n\n<p>.ghci</p>\n\n<pre><code>:load ~/.ghci.hs\n:set -interactive-print=myPrint\n\n:set prompt \"\\ESC[33m\\STX\u03bb&gt; \\ESC[m\\STX\"\n:set prompt-cont \"   | \"\n:set +m\n</code></pre>\n\n<p>.ghci.hs</p>\n\n<pre><code>import qualified IPPrint\nimport qualified Language.Haskell.HsColour as HsColour\nimport qualified Language.Haskell.HsColour.Colourise as HsColour\nimport qualified Language.Haskell.HsColour.Output as HsColour\n\nmyColourPrefs = HsColour.defaultColourPrefs\n    { HsColour.conid    = [HsColour.Foreground HsColour.Yellow, HsColour.Bold]\n    , HsColour.conop    = [HsColour.Foreground HsColour.Yellow]\n    , HsColour.string   = [HsColour.Foreground HsColour.Green]\n    , HsColour.char     = [HsColour.Foreground HsColour.Cyan]\n    , HsColour.number   = [HsColour.Foreground HsColour.Red, HsColour.Bold]\n    , HsColour.layout   = [HsColour.Foreground HsColour.White]\n    , HsColour.keyglyph = [HsColour.Foreground HsColour.White]\n    , HsColour.comment  = [HsColour.Foreground HsColour.Red, HsColour.Bold] }\n\nmyPrint :: (Show a) =&gt; a -&gt; IO ()\nmyPrint = putStrLn . HsColour.hscolour (HsColour.TTYg HsColour.XTerm256Compatible) myColourPrefs False False \"\" False . IPPrint.pshow\n</code></pre>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517035048, "creation_date": 1517021176, "last_edit_date": 1517033194, "question_id": 48472089, "link": "https://stackoverflow.com/questions/48472089/ghci-prettty-printer-is-not-rendered-with-a-color-that-would-make-it-noticeabl", "title": "GHCI Prettty Printer - is not rendered with a color that would make it noticeable", "body": "<p>For example typing -1 in console renders as 1:</p>\n\n<p><img src=\"https://i.imgur.com/kpgLYq7.png\" alt=\"\"></p>\n\n<p>When the text is selected then it is seen that it is actually -1:</p>\n\n<p><img src=\"https://i.imgur.com/bWSRHeF.png\" alt=\"\"></p>\n\n<p>.ghci file:</p>\n\n<pre><code>import qualified IPPrint\nimport qualified Language.Haskell.HsColour as HsColour\nimport qualified Language.Haskell.HsColour.Colourise as HsColour\nimport qualified Language.Haskell.HsColour.Output as HsColour\n\nlet myColourPrefs = HsColour.defaultColourPrefs { HsColour.conid = [HsColour.Foreground HsColour.Yellow, HsColour.Bold], HsColour.conop = [HsColour.Foreground HsColour.Yellow], HsColour.string = [HsColour.Foreground HsColour.Green], HsColour.char = [HsColour.Foreground HsColour.Cyan], HsColour.number = [HsColour.Foreground HsColour.Red, HsColour.Bold], HsColour.layout = [HsColour.Foreground HsColour.White], HsColour.keyglyph = [HsColour.Foreground HsColour.White] }\n\nlet myPrint :: (Show a) =&gt; a -&gt; IO (); myPrint = putStrLn . HsColour.hscolour (HsColour.TTYg HsColour.XTerm256Compatible) myColourPrefs False False \"\" False . IPPrint.pshow\n:set -interactive-print=myPrint\n\n:set prompt \"\\ESC[33m\\STX\u03bb&gt; \\ESC[m\\STX\"\n:set prompt-cont \"   | \"\n:set +m\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>Following <a href=\"http://teh.id.au/posts/2017/02/13/interactive-print/index.html\" rel=\"nofollow noreferrer\">http://teh.id.au/posts/2017/02/13/interactive-print/index.html</a> the results are a bit better but still could be improved:</p>\n\n<pre><code>import Text.Show.Pretty (ppShow)\nimport Language.Haskell.HsColour\nimport Language.Haskell.HsColour.Colourise\nlet colorPrint = putStrLn . hscolour TTY defaultColourPrefs False False \"\" False . ppShow\n:set -interactive-print=colorPrint\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>The issue is that the dash prefixing negative numbers is misclassified as a comment.</p>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 3, "creation_date": 1517018052, "post_id": 48471810, "comment_id": 83937687, "body": "Smells like a bug to me."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1517018441, "post_id": 48471810, "comment_id": 83937745, "body": "My GHCi version 8.0.2 returns <code>fmap :: Functor f -&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> for <code>:t fmap</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1517078889, "last_edit_date": 1517078889, "creation_date": 1517067641, "answer_id": 48477415, "question_id": 48471810, "link": "https://stackoverflow.com/questions/48471810/surprising-type-inference-for-named-field-in-haskell/48477415#48477415", "title": "Surprising type inference for named field in Haskell", "body": "<p>I can confirm that this issue affects GHC 8.2.2 but not 8.0.2.\n<strong>Update:</strong>  It looks like it's been fixed on the 8.4 branch.</p>\n\n<p>It appears to be a GHCi type signature display bug, rather than a real type checker issue, since if you take the program:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Inference where\ndata Functor f = Functor { fmap :: forall a b. (a -&gt; b) -&gt; f a -&gt; f b }\n</code></pre>\n\n<p>and compile it with <code>ghc -ddump-tc</code>, you can see that GHC infers the correct type:</p>\n\n<pre><code>TYPE SIGNATURES\n  ...\n  Inference.fmap ::\n    forall (f :: * -&gt; *).\n    Inference.Functor f -&gt; forall a b. (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>It also doesn't seem to affect GHC error messages.  If you add the line:</p>\n\n<pre><code>main = print Inference.fmap\n</code></pre>\n\n<p>to produce an error message that includes the type (\"No instance for (Show xxx)\"), you <em>also</em> see the correct type.</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "accepted_answer_id": 48477415, "answer_count": 1, "score": 6, "last_activity_date": 1517078889, "creation_date": 1517017400, "question_id": 48471810, "link": "https://stackoverflow.com/questions/48471810/surprising-type-inference-for-named-field-in-haskell", "title": "Surprising type inference for named field in Haskell", "body": "<p>Consider the following transcript of GHCi, version 8.2.2:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>GHCi, version 8.2.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set -XRankNTypes\nPrelude&gt; data Functor f = Functor { fmap :: forall a b. (a -&gt; b) -&gt; f a -&gt; f b }\nPrelude&gt; :t fmap\nfmap :: Functor f1 -&gt; (a -&gt; b) -&gt; f2 a -&gt; f2 b\nPrelude&gt; :t Functor map\nFunctor map :: Functor []\nPrelude&gt; :t fmap (Functor map)\nfmap (Functor map) :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>As you can see, the type of <code>fmap</code> is inferred as <code>Functor f1 -&gt; (a -&gt; b) -&gt; f2 a -&gt; f2 b</code>. This is surprising because <code>f1</code> and <code>f2</code> are supposed to be the same type variable but there's no <code>f1 ~ f2</code> constraint. Nevertheless, if you apply <code>fmap</code> to <code>Functor map</code> which has the type <code>Functor []</code>, the result still has the type <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code> as expected. What's going on here? I would have expected <code>fmap</code> to have the type <code>Functor f -&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>.</p>\n"}, {"tags": ["haskell", "functional-programming", "purely-functional"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1517013358, "post_id": 48471149, "comment_id": 83936855, "body": "Hmm your question is very vague and broad, it is hard to give you concrete advice. Have you tried any poc? If not just implement the first idea you have an test it."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1517015603, "post_id": 48471149, "comment_id": 83937284, "body": "<a href=\"https://wiki.haskell.org/Arrows-based_Functional_Reactive_Programming\" rel=\"nofollow noreferrer\">AFRP</a> might be a good fit, though it can be a pretty steep learning curve if you are somewhat new to Haskell.  In any case, you probably do need all the objects to be &quot;globally indexed&quot; in some way (RAM is globally indexed, too), and it&#39;s worth thinking carefully about what kind of data structure you need.  More details -&gt; more advice."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1517017724, "post_id": 48471149, "comment_id": 83937629, "body": "An OOP system <b>is</b> a huge structure where each object update requires locating it first, it&#39;s just that the indirection takes a different form."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1517047820, "post_id": 48471149, "comment_id": 83942764, "body": "@ReinHenrichs I think the question is mainly about how much overhead this different form of indirection has"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1517046305, "creation_date": 1517046305, "answer_id": 48474515, "question_id": 48471149, "link": "https://stackoverflow.com/questions/48471149/managing-complex-state-in-fp/48474515#48474515", "title": "Managing complex state in FP", "body": "<p>While I agree with the people commenting that this is a vague question, I'll still try to address some of the issues put forth.</p>\n\n<p>It's true that there's <em>some</em> performance overhead from immutability, because when you use mutable state, you can update some values in-place, whereas with immutable state, some copying has to take place.</p>\n\n<p>It is, however, a common misconception that this is causes problems with big 'object' graphs. It doesn't have to.</p>\n\n<p>Consider a Haskell data structure:</p>\n\n<pre><code>data BigDataStructure = BigDataStructure {\n    bigChild1 :: AnotherBigDataStructure\n  , bigChild2 :: YetAnotherBigDataStructure\n  -- more elements go here...\n  , bigChildN :: Whatever }\n  deriving (Show, Eq)\n</code></pre>\n\n<p>Imagine that each of these child elements are big and complex themselves. If you want to change, say, <code>bigChild2</code>, you could write something like:</p>\n\n<pre><code>updatedValue = myValue { bigChild2 = updatedChild }\n</code></pre>\n\n<p>When you do that, some data copying takes place, but it's often less that most people think. This expression does create a new <code>BigDataStructure</code> record, but it doesn't 'deep copy' any of its values. It just reuses <code>bigChild1</code>, <code>updatedChild</code>, <code>bigChildN</code>, and all the other values, because they're immutable.</p>\n\n<p>In theory (but we'll get back to that in a minute), the flatter your data structures are, the more data sharing should be enabled. If, on the other hand, you have some deeply nested data structures, and you need to update the leafs, you'll need to create a copy of the immediate parents of those leafs, plus the parents of those parents, and their parents as well, all the way to the root. That might be expensive.</p>\n\n<p>That's the theory, though, but we've known for decades that it's impractical to try predict how software will perform. Instead, try to measure it.</p>\n\n<p>While the OP suggest that significant data is involved, it doesn't state how much, and neither does it state the hardware specs of the system that's going to run the simulation. So, as <a href=\"https://ericlippert.com/2012/12/17/performance-rant/\" rel=\"nofollow noreferrer\">Eric Lippert explains so well</a>, the person who can best answer questions about performance is you.</p>\n\n<hr>\n\n<p>P.S. It's my experience that when I start to encounter performance problems, I need to get creative with how I design my system. Efficient data structures can address many performance issues. This is just as much the case in OOP as it is in FP.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1517059650, "creation_date": 1517010467, "last_edit_date": 1517059650, "question_id": 48471149, "link": "https://stackoverflow.com/questions/48471149/managing-complex-state-in-fp", "title": "Managing complex state in FP", "body": "<p>I want to write a simulation of a multi-entity system. I believe such systems motivated creation of Simula and OOP where each object would maintain its own state and the runtime would manage the the entire system (e.g. stop threads, serialize data).</p>\n\n<p>On the other hand, I would like to have ability to rewind, change the simulation parameters and compare the results. Thus, immutability sounds great (at least up to almost certain garbage collection issues caused by keeping track of possibly redundant data).</p>\n\n<p>However I don't know how to model this. <strong>Does this mean that I must put every interacting entity into a single, huge structure</strong> where each object update would require locating it first?</p>\n\n<p>I'm worried that such approach would affect performance badly because of GC overhead and constant structure traversals as opposed to keeping one fixed address of entity in memory.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>To clarify, this question asks if there is <strong>any other design option available other than creating a single structure</strong> that contains all possibly interacting entities as a root. Intuitively, such a structure would imply logarithmic single update penalty unless updates are \"clustered\" somehow to amortize.</p>\n\n<p>Is there a known system where interactions could be modelled differently? For example, like in cold/hot data storage optimization?</p>\n\n<p>After some research, there seems to be a connection with N-body simulation where systems can be clustered but I'm not familiar with it yet. Even so, would that also mean I need to have a single structure of clusters?</p>\n"}, {"tags": ["haskell", "composition", "haskell-lens", "arrows"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1516989436, "post_id": 48466752, "comment_id": 83927288, "body": "<a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#v:alongside\" rel=\"nofollow noreferrer\"><code>alongside</code></a> does something similar, and actually corresponds to <code>***</code>. The signature you&#39;re discussing, and which also that other question is about, actually corresponds rather to <code>&amp;&amp;&amp;</code>, which can&#39;t work in a law-abiding manner."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1516992970, "post_id": 48466752, "comment_id": 83929100, "body": "ah cool. I see the law issue. The utility I was thinking of was for doing stateful operations on part of <code>s</code>, since it&#39;s fairly easy to lift <code>b -&gt; (a, b)</code> to <code>(a,b) -&gt; (a,b)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 3, "last_activity_date": 1517023357, "last_edit_date": 1517023357, "creation_date": 1516990317, "answer_id": 48467198, "question_id": 48466752, "link": "https://stackoverflow.com/questions/48466752/horizontal-composition-of-lenses/48467198#48467198", "title": "Horizontal composition of Lenses", "body": "<p>Lenses cannot have proper horizontal composition. All the lens laws are trivial to violate when combining lawful lenses horizontally.</p>\n\n<p>Your <code>zip</code> breaks down whenever the lenses overlap. What's the result of <code>10 &amp; zip id id .~ (1, 2)</code>? What you have will work when the lens targets are completely disjoint from each other, so it's not wrong. It's just not general horizontal composition. There are additional constraints on the input values.</p>\n\n<p>The situation gets worse when you want to combine non-simple lenses. Now you have a type problem as well, even if the lenses are disjoint. Given disjoint lenses <code>lens1 :: Lens s1 t1 a1 b1</code> and <code>lens2 :: Lens s2 t2 a2 b2</code>, what would the type of their horizontal composition be? <code>Lens s t (a1, a2) (b1, b2)</code> is the ultimate goal, of course, for some <code>s</code> and <code>t</code>. From the way a lens operates, we know <code>(s ~ s1, s ~ s2)</code>, so that's not a problem. But what is <code>t</code>? There's no way to calculate it. You'd want some sort of operation along the lines of \"apply the changes made to the type by each\", but that's not well-defined. Best case, you might be able to create a type family to cover it for specific combinations of <code>s</code>, <code>t1</code>, and <code>t2</code>. </p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "closed_date": 1516989301, "accepted_answer_id": 48467198, "answer_count": 1, "score": 1, "last_activity_date": 1517023357, "creation_date": 1516988585, "question_id": 48466752, "link": "https://stackoverflow.com/questions/48466752/horizontal-composition-of-lenses", "closed_reason": "Duplicate", "title": "Horizontal composition of Lenses", "body": "<p>Arrows have two kinds of composition, <em>vertical</em>:</p>\n\n<pre><code>(.) :: Arrow cat =&gt; cat b c -&gt; cat a b -&gt; cat a c\n</code></pre>\n\n<p>and <em>horizontal</em>:</p>\n\n<pre><code>(***) :: Arrow cat =&gt; cat a b -&gt; cat a' b' -&gt; cat (a,a') (b,b')\n</code></pre>\n\n<p>(I apologize to any category theoryists for any abuse of terminology)</p>\n\n<p>Lenses can also compose vertically:</p>\n\n<pre><code>(.) :: Lens s t q r -&gt; Lens q r a b -&gt; Lens s t a b\n</code></pre>\n\n<p><strong>Can they compose horizontally?</strong></p>\n\n<hr>\n\n<p>Using the normal definition of van Laarhoven lenses and concrete lenses:</p>\n\n<pre><code>type Lens s t a b = forall f. Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\ntype Lens' s a = Lens s s a a\n\ndata ALens s t a b = ALens\n  { get :: s -&gt; a\n  , set :: b -&gt; s -&gt; t\n  }\ntype ALens' s a = ALens s s a a\n\nfromALens :: ALens s t a b -&gt; Lens s t a b\ntoALens :: Lens s t a b -&gt; ALens s t a b\n</code></pre>\n\n<p>I figured out how to horizontally compose simple concrete lenses:</p>\n\n<pre><code>along :: ALens' s a -&gt; ALens' s b -&gt; ALens' s (a,b)\nalong l0 l1 = ALens\n  { get = \\s -&gt; (get l0 s, get l1 s)\n  , set = \\(a,c) -&gt; set l1 c . set l0 a\n  }\n</code></pre>\n\n<p>And how to use that definition to horizontally compose simple van Laarhoven lenses:</p>\n\n<pre><code>zip :: Lens' s a -&gt; Lens' s b -&gt; Lens' s (a,b)\nzip l0 l1 = fromALens (toALens l0 `along` toALens l1)\n</code></pre>\n\n<p>Without changing the implementation, I can even relax the type signatures of\n<code>along</code> and <code>zip</code> to allow one of the lenses to be polymorphic:</p>\n\n<pre><code>along :: ALens' s a -&gt; ALens s t b c -&gt; ALens s t (a,b) (a,c)\nzip :: Lens' s a -&gt; Lens s t b c -&gt; Lens s t (a,b) (a,c)\n</code></pre>\n\n<p>And after some manual equational reasoning, I managed to implement <code>zip</code> without\nconversion to concrete lenses and back:</p>\n\n<pre><code>zip l0 l1 h s = h (s ^. l0, s ^. l1) &lt;&amp;&gt; \\(a,c) -&gt; s &amp; (l0 .~ a) &amp; (l1 .~ c)\n</code></pre>\n\n<p>(though I'm certainly not confident that it's the most elegant or law-abiding implementation)</p>\n\n<p><em>What I'm still wondering is whether there's an equivalent horizontal\ncomposition for non-simple lenses:</em></p>\n\n<pre><code>(***) :: Lens r s a b -&gt; Lens s t c d -&gt; Lens r t (a,a') (b,b')\n</code></pre>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516983967, "post_id": 48465353, "comment_id": 83924206, "body": "What monad? Why not keep your existing function but with a more general type?"}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1516984182, "post_id": 48465509, "comment_id": 83924354, "body": "Isn&#39;t <code>foldr (+) 0</code> just a weird way to write <code>sum</code>?"}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1516984243, "post_id": 48465509, "comment_id": 83924387, "body": "@melpomene Well, I just copy-pasted the original function, changing only the type declaration. Of course it is, but refactoring is another question. Thank you for a suggestion, though, I&#39;ll add some thoughts on refactoring."}, {"owner": {"reputation": 103, "user_id": 4381472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef115054124db4e066a7ef3e4d0fc9a4?s=128&d=identicon&r=PG", "display_name": "Whelp", "link": "https://stackoverflow.com/users/4381472/whelp"}, "edited": false, "score": 0, "creation_date": 1516986529, "post_id": 48465509, "comment_id": 83925783, "body": "@malpomene in fact, I simply wasn&#39;t aware of sum. Thanks for pointing it out."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1516986737, "post_id": 48465509, "comment_id": 83925896, "body": "Even better: <code>sum [1&#47;(z-x) | x&lt;-zList, x&#47;=z]</code>. Or, if it&#39;s ok to swap the arguments and make it a bit point-free, <code>sumInvZ z = sum . map (recip . (z-)) . filter (&#47;=z)</code>."}, {"owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1516989562, "post_id": 48465509, "comment_id": 83927358, "body": "@leftaroundabout Thank you, added your suggestions to the answer."}], "tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 6, "last_activity_date": 1516989538, "last_edit_date": 1516989538, "creation_date": 1516984127, "answer_id": 48465509, "question_id": 48465353, "link": "https://stackoverflow.com/questions/48465353/lifting-a-function-from-real-numbers-to-complex-numbers-in-haskell/48465509#48465509", "title": "Lifting a function from real numbers to complex numbers in Haskell", "body": "<p>You can't use the Complex Monad or Functor for this, since those just operate on the complex number componentwise (note that componentwise multiplication and complex multiplication are totally different things).</p>\n\n<p>Consider using the Fractional typeclass:</p>\n\n<pre><code>sumInvZ :: (Fractional f, Eq f) =&gt; [f] -&gt; f -&gt; f\nsumInvZ zList z = let invList = [if z==x then 0 else 1/(z-x)|x&lt;-zList] in\n    foldr (+) 0 invList\n</code></pre>\n\n<p>By the way, you can rewrite the function in a bit more readable manner:</p>\n\n<pre><code>sumInvZ :: (Fractional f, Eq f) =&gt; [f] -&gt; f -&gt; f\nsumInvZ zList z = sum [if z==x then 0 else 1/(z-x) | x &lt;- zList]\n</code></pre>\n\n<p>Also consider two variants suggested by @leftaroundabout:</p>\n\n<pre><code>sumInvZ zList z = sum [1/(z-x) | x&lt;-zList, x/=z]\n</code></pre>\n\n<p>or, swapping the arguments,</p>\n\n<pre><code>sumInvZ z = sum . map (recip . (z-)) . filter (/=z)\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 4381472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef115054124db4e066a7ef3e4d0fc9a4?s=128&d=identicon&r=PG", "display_name": "Whelp", "link": "https://stackoverflow.com/users/4381472/whelp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 48465509, "answer_count": 1, "score": 0, "last_activity_date": 1516989538, "creation_date": 1516983617, "question_id": 48465353, "link": "https://stackoverflow.com/questions/48465353/lifting-a-function-from-real-numbers-to-complex-numbers-in-haskell", "title": "Lifting a function from real numbers to complex numbers in Haskell", "body": "<p>I wrote a function that takes a list and a number and returns a sum of shifted inverses:</p>\n\n<pre><code>sumInvZ::[Float]-&gt;Float-&gt;Float\nsumInvZ zList z = let invList = [if z==x then 0 else 1/(z-x)|x&lt;-zList] in foldr (+) 0 invList\n</code></pre>\n\n<p>I want to generalize this function to act on complex numbers as well. A simple solution is just to re-write it:</p>\n\n<pre><code>import Data.Complex\n\nsumInvZC::[Complex Float]-&gt;Complex Float-&gt;Complex Float\nsumInvZC zList z = let invList = [if z==x then 0 else 1/(z-x)|x&lt;-zList] in foldr (+) 0 invList\n</code></pre>\n\n<p>But I'm also interested in making uses of the Complex monad to directly lift my SumInvZ. I've played around variations of liftM, but I've been unable to find a way to make it work. Is there a possibility?</p>\n"}, {"tags": ["c++", "haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1516967116, "post_id": 48460306, "comment_id": 83914193, "body": "Check out this <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms682586(v=vs.85).aspx\" rel=\"nofollow noreferrer\">article</a> about how DLLs are loaded. Make sure that your lmdb dll is one of the places windows looks for it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516972022, "post_id": 48460306, "comment_id": 83916738, "body": "What have you tried to fix it? Have you tried adding the directory containing <code>lmdb.dll</code> to the path?"}, {"owner": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "edited": false, "score": 0, "creation_date": 1516972313, "post_id": 48460306, "comment_id": 83916882, "body": "I think cabal built success and module compiled with no error mean the C++ lib has no problem, and path to lib is Ok too. But got still got error in runtime."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1516979282, "post_id": 48460306, "comment_id": 83921200, "body": "That doesn&#39;t have to be the case, actually. Strictly speaking, the DLL doesn&#39;t have to available at compile time for the compilation to succeed."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1516990283, "post_id": 48460306, "comment_id": 83927744, "body": "@T.Do The purpose of a DLL (&quot;Dynamic Link Library&quot;) is that it isn&#39;t necessary at compile time or at link time. It is only necessary at runtime."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "is_accepted": false, "score": 1, "last_activity_date": 1517211030, "creation_date": 1517211030, "answer_id": 48496392, "question_id": 48460306, "link": "https://stackoverflow.com/questions/48460306/ghci-could-not-load-dll-lib-c-lib-on-windows/48496392#48496392", "title": "GHCi could not load .dll lib (C++ lib) on Windows", "body": "<p>As per discussion in comment section, I was trying to tell GHCi the location of lmdb's dll. It works after I modify %path% env.\nIn my case, the path was: vcpkg\\installed\\x64-windows\\bin</p>\n"}], "owner": {"reputation": 51, "user_id": 5241565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/858cbb5169167e2feb899ac699510a9a?s=128&d=identicon&r=PG&f=1", "display_name": "T. Do", "link": "https://stackoverflow.com/users/5241565/t-do"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1517211030, "creation_date": 1516965501, "question_id": 48460306, "link": "https://stackoverflow.com/questions/48460306/ghci-could-not-load-dll-lib-c-lib-on-windows", "title": "GHCi could not load .dll lib (C++ lib) on Windows", "body": "<p>I've installed a C++ lib successfully via vcpgk, named: <code>lmdb:x64-windows</code></p>\n\n<p>I also installed <a href=\"https://hackage.haskell.org/package/lmdb\" rel=\"nofollow noreferrer\">lmdb</a> binding package for Haskell by Cabal install</p>\n\n<p>And when trying to test the lmdb package:</p>\n\n<pre><code>module Persistence where\n\nimport Database.LMDB.Raw\n</code></pre>\n\n<p>GHCi compiled and loaded it:</p>\n\n<pre><code>[1 of 1] Compiling Persistence      ( Persistence.hs, interpreted )\nOk, modules loaded: Persistence.\n</code></pre>\n\n<p>But it throws error when I try to call any functions in lmdb Raw lib:</p>\n\n<pre><code>*Persistence&gt; lmdb_version\nghc.exe: addDLL: lmdb.dll (Win32 error 126): The specified module could not \nbe found.\nghc.exe: Could not load `lmdb.dll'. Reason: addDLL: could not load DLL\nghc.exe: C:\\Users\\thanhdo\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-\n8.0.2\\lmdb-0.2.5-1uQhV16mebP51rtMgitOcY\\HSlmdb-0.2.5-\n1uQhV16mebP51rtMgitOcY.o: unknown symbol `mdb_dbi_close'\nghc.exe: unable to load package `lmdb-0.2.5'\n</code></pre>\n\n<p>I was searching around and was trying several approaches but still can't resolve this error. I'm using Windows 7 64bit, Haskell platform 8.0.2. Thanks in advance.</p>\n"}, {"tags": ["haskell", "tree", "functional-programming"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 4, "creation_date": 1516951380, "post_id": 48456832, "comment_id": 83906906, "body": "What have you tried so far? Where are you having trouble?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1516953085, "post_id": 48456832, "comment_id": 83907554, "body": "relationshipBinaryTree :: Tree a -&gt; [(a,a)] ; relationshipBinaryTree (L _) = [] ;  relationshipBinaryTree (N _ (Tree i) (Tree d)) = relationshipBinaryTree (N _) ++ relationshipBinaryTree (Tree i) ++ relationshipBinaryTree (Tree d)"}], "answers": [{"tags": [], "owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "is_accepted": false, "score": 3, "last_activity_date": 1516952319, "creation_date": 1516952319, "answer_id": 48457336, "question_id": 48456832, "link": "https://stackoverflow.com/questions/48456832/relationships-in-a-tree-haskell/48457336#48457336", "title": "Relationships in a Tree (Haskell)", "body": "<p>You want to use <code>Data.Tree</code>, but <code>Data.Tree</code> isn't even about binary trees, but about multi way trees (a.k.a. rose trees). However, if you had a function <code>value :: Tree a -&gt; a</code>, then of course you could map it to the children of a rose tree and combine the result with the value.</p>\n\n<p>Now, there exists a function that does that in <code>Data.Tree</code>, it's called <code>rootLabel</code>. And there is another function to geht the children of a node, it's called <code>subForest</code>.</p>\n\n<p>That comes from the definition of <code>Tree</code> in <code>Data.Tree</code>:</p>\n\n<pre><code>Node\n   rootLabel :: a           -- label value\n   subForest :: Forest a    -- zero or more child trees\n</code></pre>\n\n<p>So we could define for rose trees:</p>\n\n<pre><code>fatherChild :: Tree a -&gt; [(a, a)]\nfatherChild t = map mkPair children ++ concatMap fatherChild children\n   where mkPair child = (rootLabel t, child)\n         children     = subForest t\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>fatherChild (Node 3 [Node 8 [], Node 4 []])\n&gt; [(3,8),(3,4)]\n</code></pre>\n\n<p>Your example:</p>\n\n<pre><code>fatherChild (Node 10 [Node 8 [Node 3 [], Node 5 []], Node 2 [Node 2 [], Node 0 []]])\n&gt; [(10,8),(10,2),(8,3),(8,5),(2,2),(2,0)]\n</code></pre>\n\n<p>Now, this doesn't answer your question about <em>binary</em> trees, but I would like to leave that to you as an exercise, because it will be very similar (except if you get stuck). (And please don't use rose trees as binary trees, because there is no type safety to ensure that there are always two children.)</p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": true, "score": 1, "last_activity_date": 1516981215, "creation_date": 1516981215, "answer_id": 48464626, "question_id": 48456832, "link": "https://stackoverflow.com/questions/48456832/relationships-in-a-tree-haskell/48464626#48464626", "title": "Relationships in a Tree (Haskell)", "body": "<p>A simple way to do it is by getting the value with an auxiliary function and then do the recursion:</p>\n\n<pre><code>data Tree a = Leaf a\n              | Node a (Tree a) (Tree a) deriving (Eq, Show)\n\n\nexTree :: Tree Int\nexTree = Node 10 t1 t2\nt1 = Node 8 (Leaf 3) (Leaf 5)\nt2 = Node 2 (Leaf 2) (Leaf 0)\n\n\nrelationshipBinaryTree :: Tree a -&gt; [(a,a)] \nrelationshipBinaryTree (Leaf _) = [] \nrelationshipBinaryTree (Node v i d) = [(v, getVal i), (v, getVal d)] ++ relationshipBinaryTree i ++ relationshipBinaryTree d\n\ngetVal (Node v _ _) = v\ngetVal (Leaf v) = v\n\n   relationshipBinaryTree exTree\n=&gt; [(10,8),(10,2),(8,3),(8,5),(2,2),(2,0)]\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 48464626, "answer_count": 2, "score": 0, "last_activity_date": 1516981215, "creation_date": 1516949354, "last_edit_date": 1516958924, "question_id": 48456832, "link": "https://stackoverflow.com/questions/48456832/relationships-in-a-tree-haskell", "title": "Relationships in a Tree (Haskell)", "body": "<p>Binary trees with values in the leaves and nodes are defined by:</p>\n\n<pre><code>   data Tree a = Leaf a\n                | Node a (Tree a) (Tree a) \n     deriving (Eq, Show)\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>         10\n        /  \\\n       /    \\\n      8      2\n     / \\    / \\\n    3   5  2   0\n\nexTree :: Tree Int\nexTree = N 10 (N 8 (H 3) (H 5))\n               (N 2 (H 2) (H 0))\n</code></pre>\n\n<p>Well, I need a function called RelationshipBinaryTree, which generates a list of tuples, whose first component is an x and its second the father. In this tree,</p>\n\n<pre><code>relationshipBinaryTree :: Tree a -&gt; [(a,a)]\nrelationshipBinaryTree exTree =  [(10,8),(8,3),(8,5),(10,2),(2,2),(2,0)]\n</code></pre>\n\n<p>Also, I need to define it in the Data.Tree hackage (<a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Tree.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Tree.html</a>)</p>\n\n<p>I hope you can help me because I don't understand trees and graphs very well.</p>\n\n<p>I have tried this</p>\n\n<pre><code>relationshipBinaryTree :: Tree a -&gt; [(a,a)] \n relationshipBinaryTree (L _) = [] \n relationshipBinaryTree (N _ (Tree i) (Tree d)) = relationshipBinaryTree (N _) ++ relationshipBinaryTree (Tree i) ++ relationshipBinaryTree (Tree d)\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1516930792, "post_id": 48454609, "comment_id": 83902362, "body": "<code>x &lt;- error &quot;:(&quot;</code> and <code>x &lt;- return $ error &quot;:(&quot;</code> are different expressions"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1516950999, "post_id": 48454609, "comment_id": 83906775, "body": "I was going to suggest trying <code>let e = return $ error &quot;:(&quot;; p &lt;- e; :sprint e</code>, but it turns out that even evaluated <code>IO</code> actions get <code>sprint</code>ed as <code>_</code>. Bummer! But try <code>p &lt;- Debug.Trace.trace &quot;yep, got evaluated&quot; $ return $ error &quot;:(&quot;</code> for evidence that the action (if not its return value) is indeed getting evaluated as promised."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 7, "last_activity_date": 1516936099, "creation_date": 1516936099, "answer_id": 48455255, "question_id": 48454609, "link": "https://stackoverflow.com/questions/48454609/is-ghci-monadic-bind-strict/48455255#48455255", "title": "Is GHCI monadic bind strict?", "body": "<p>In Haskell, we separate evaluation of <em>values</em> from execution of <em>computations</em>. <code>return (error \"\")</code> is a computation that succeeds returning an undefined value, the value is not evaluated when bound. <code>error \"\" :: IO a</code> is an undefined computation, that fails immediately.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 9, "last_activity_date": 1516936815, "creation_date": 1516936815, "answer_id": 48455343, "question_id": 48454609, "link": "https://stackoverflow.com/questions/48454609/is-ghci-monadic-bind-strict/48455343#48455343", "title": "Is GHCI monadic bind strict?", "body": "<p>Remember that a function being strict means <code>f &perp; = &perp;</code>.  Consider:</p>\n\n<pre><code>ghci&gt; x &lt;- return undefined\n-- no error\n</code></pre>\n\n<p>This means that <code>return undefined &gt;&gt;= \\x -&gt; ...</code> is not &perp;, but that doesn't really say anything about the strictness of <code>&gt;&gt;=</code>, because of the <code>return</code>.  This, however:</p>\n\n<pre><code>ghci&gt; y &lt;- undefined\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>is the case that the manual is referring to, and it shows that bind is strict in the left argument, because <code>undefined &gt;&gt;= (\\y -&gt; ...)</code> is &perp;.  Finally, </p>\n\n<pre><code>ghci&gt; :set -XBangPatterns\nghci&gt; !z &lt;- return undefined\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>This line shows what happens if we give it a strict function as an argument, so we know that <code>return undefined &gt;&gt;= f</code> is &perp; <em>if <code>f</code> is strict</em>.  This actually follows from the monad law <code>return x &gt;&gt;= f = f x</code>, so <code>return &perp; >>= f = f &perp; = &perp;</code></p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1516962718, "creation_date": 1516962718, "answer_id": 48459611, "question_id": 48454609, "link": "https://stackoverflow.com/questions/48454609/is-ghci-monadic-bind-strict/48459611#48459611", "title": "Is GHCI monadic bind strict?", "body": "<p>I believe this is talking about the binding, i.e. the pattern matching process.</p>\n\n<pre><code>let p = e in e'\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>case e of ~p -&gt; e'\n</code></pre>\n\n<p>where the pattern <code>p</code> has been changed into a lazy binding <code>~p</code>. Essentially, <code>let</code> adds an implicit <code>~</code> in front of the pattern.\nFor instance,</p>\n\n<pre><code>let [x] = [] in \"hello\"\n</code></pre>\n\n<p>evaluates to <code>\"hello\"</code>, with no runtime errors.</p>\n\n<p>In <code>do</code> notation, a binding</p>\n\n<pre><code>do p &lt;- e ; e'\n</code></pre>\n\n<p>gets transformed to something like</p>\n\n<pre><code>e &gt;&gt;= (\\w -&gt; case w of\n   p -&gt; e'\n   _ -&gt; fail \"some message\")\n</code></pre>\n\n<p>where <code>w</code> is a fresh variable. Note that <code>p</code> does not get a <code>~</code> here, otherwise it would always match and the <code>_ -&gt; fail ...</code> case would be unreachable.</p>\n\n<p>This is needed to write e.g.</p>\n\n<pre><code>filterRight :: [Either a b] -&gt; [a]\nfilterRight xs = do\n   Right x &lt;- xs\n   return x\n</code></pre>\n\n<p>(which is a disguised list comprehension).</p>\n"}], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 48455343, "answer_count": 3, "score": 4, "last_activity_date": 1516962718, "creation_date": 1516930295, "question_id": 48454609, "link": "https://stackoverflow.com/questions/48454609/is-ghci-monadic-bind-strict", "title": "Is GHCI monadic bind strict?", "body": "<p>The GHC manual states this about monadic binding in GHCI:</p>\n\n<blockquote>\n  <p>Another important difference between the two types of binding is that\n  the monadic bind (p &lt;- e) is strict (it evaluates e), whereas with the\n  let form, the expression isn\u2019t evaluated immediately:</p>\n</blockquote>\n\n<p>(from <a href=\"https://downloads.haskell.org/~ghc/8.2.1/docs/html/users_guide/ghci.html#using-do-notation-at-the-prompt\" rel=\"nofollow noreferrer\">here</a>)</p>\n\n<p>But I can do this in GHCI:</p>\n\n<pre><code>\u03bb: x &lt;- return $ error \":(\"\n\u03bb: :sprint x\nx = _\n</code></pre>\n\n<p>This seems to show that the monadic bind is not strict. What am I missing?</p>\n"}, {"tags": ["haskell", "functional-programming", "memoization"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 4, "creation_date": 1516921559, "post_id": 48453302, "comment_id": 83899740, "body": "Let&#39;s start by getting a solution that compiles and provides correct answers. You need to declare <code>n</code> and <code>k</code>."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1516921684, "post_id": 48453302, "comment_id": 83899775, "body": "After you fix that, I think a more efficient solution comes directly from the definition: <code>nCk = n!&#47;((k!)(n-k!))</code>. You can use <code>product</code> to calculate the factorials and then there is less need for memoization."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1516924026, "post_id": 48453302, "comment_id": 83900475, "body": "You would store the values in a boxed data structure such as a map or array. Either update and insert each new value into the map, passing the updated map as program state, or use laziness to create a structure full of thunks, which will calculate the value once, only if needed."}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 1, "last_activity_date": 1516927631, "creation_date": 1516927631, "answer_id": 48454265, "question_id": 48453302, "link": "https://stackoverflow.com/questions/48453302/how-do-i-calculate-binomial-coefficient-with-memoization/48454265#48454265", "title": "How do I calculate binomial coefficient with memoization?", "body": "<p>Here\u2019s how to implement binomial coefficients if you are feeling sane and want someone to understand your program:</p>\n\n<pre><code>--| computes the binomial coefficient n choose k = n!/k!(n-k)!\nbinom n k = product [max (k+1) (n-k+1) .. n] `div` product [1 .. min k (n-k)]\n</code></pre>\n\n<p>Here is a simple way to memoize a function of two arguments like this:</p>\n\n<pre><code>binom n k = (vals !! n) !! k where\n  vals = 1 : [ 1 : [if k == n\n                    then 1\n                    else binom (n-1) (k-1) + binom (n-1) k\n                   | k &lt;- [1..n]]\n             | n &lt;- [1..]]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8951381, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-PszXe-KggKE/AAAAAAAAAAI/AAAAAAAAABo/pdb4Hf1GyAM/photo.jpg?sz=128", "display_name": "Anonnnn", "link": "https://stackoverflow.com/users/8951381/anonnnn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1516927941, "creation_date": 1516921296, "last_edit_date": 1516927941, "question_id": 48453302, "link": "https://stackoverflow.com/questions/48453302/how-do-i-calculate-binomial-coefficient-with-memoization", "title": "How do I calculate binomial coefficient with memoization?", "body": "<p>The recursive form is like that:</p>\n\n<pre><code>co:: (Int,Int) -&gt; Int\nco| k == 0 || k == n = 1\n  | 0 &lt; k, k &lt; n = co(n-1,k-1) + co(n-1,k)\n  | otherwise = 0\n</code></pre>\n\n<p>How do I memorize so I don't have to make the same calculations that often?</p>\n"}, {"tags": ["list", "haskell", "recursion", "split"], "comments": [{"owner": {"reputation": 29068, "user_id": 149436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc4c5aa5126e36603eabdfdc57c46583?s=128&d=identicon&r=PG", "display_name": "Evan Trimboli", "link": "https://stackoverflow.com/users/149436/evan-trimboli"}, "edited": false, "score": 2, "creation_date": 1516921147, "post_id": 48453266, "comment_id": 83899602, "body": "When does the function stop?"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1516921460, "post_id": 48453266, "comment_id": 83899703, "body": "What is the original problem that you are trying to solve? I think that your proposed solution here is probably not the best way to do it in Haskell."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 2, "creation_date": 1516927795, "post_id": 48453266, "comment_id": 83901561, "body": "You can use <code>drop 2</code> instead of <code>snd $ splitAt 2</code>. The problem is that when you call your function with an empty list, <code>splitAt 2 []</code> returns <code>([],[])</code> and you then call your function again with <code>[]</code>. You need a case to deal with that"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1516927809, "post_id": 48453266, "comment_id": 83901566, "body": "You can, of course, do this using primitive recursion. I suggest using existing work, e.g. <a href=\"http://hackage.haskell.org/package/split-0.2.3.3/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\"><code>chunksOf</code></a>."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 2, "creation_date": 1516927999, "post_id": 48453266, "comment_id": 83901617, "body": "I\u2019m trying to understand why you\u2019re in a monad here (the list monad). It doesn\u2019t really make any sense"}, {"owner": {"reputation": 78, "user_id": 9024524, "user_type": "registered", "profile_image": "https://graph.facebook.com/1779917565382977/picture?type=large", "display_name": "Konrad Rzo\u0144ca", "link": "https://stackoverflow.com/users/9024524/konrad-rzo%c5%84ca"}, "edited": false, "score": 0, "creation_date": 1516955433, "post_id": 48453266, "comment_id": 83908477, "body": "Every element of a list represents a single picture of digit. It&#39;s for lab project, I wanted to do neural networks but ended up reading and printing packed data of drawn digits"}], "owner": {"reputation": 78, "user_id": 9024524, "user_type": "registered", "profile_image": "https://graph.facebook.com/1779917565382977/picture?type=large", "display_name": "Konrad Rzo\u0144ca", "link": "https://stackoverflow.com/users/9024524/konrad-rzo%c5%84ca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1516927883, "creation_date": 1516921042, "last_edit_date": 1516927883, "question_id": 48453266, "link": "https://stackoverflow.com/questions/48453266/haskell-getting-elements-out-of-the-list", "title": "Haskell getting elements out of the list", "body": "<p>How can I split a list over and over again while working on it's second part? For example:  </p>\n\n<pre><code>recursiveFun list = do  \n    ...\n    newlist = snd $ splitAt 2 list\n    recursiveFun newlist\n</code></pre>\n\n<p>Will never go through the list,</p>\n\n<p>edit: source code</p>\n\n<pre><code>translatePixelsToMatrix :: B.ByteString -&gt; Int -&gt; Int -&gt; [Matrix Word8] -&gt; [Matrix Word8]\ntranslatePixelsToMatrix bytes columns rows mat = do\n  let mat = matrix rows columns (\\(i, j) -&gt; (B.index bytes $ toEnum $ (i - 1) + (j - 1) * columns)) : mat\n  let contents = snd $ B.splitAt (toEnum (rows * columns)) bytes\n  if not $ B.null contents\n    then translatePixelsToMatrix contents rows columns mat\n    else mat\n</code></pre>\n\n<p>First argument of  </p>\n\n<pre><code>translatePixelsToMatrix bytes columns rows mat\n</code></pre>\n\n<p>is the same in every call of the function, but I want to drop n first elements with  </p>\n\n<pre><code>      let contents = snd $ B.splitAt (toEnum (rows * columns)) bytes\n      then translatePixelsToMatrix contents rows columns mat\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 11, "creation_date": 1516910338, "post_id": 48450826, "comment_id": 83894730, "body": "The main purpose is to make sure no one can agree on any laws whatsoever for <code>Alternative</code>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1516911100, "post_id": 48450826, "comment_id": 83895114, "body": "What else would you expect to happen? If you are have alternatives around IO actions that might fail, if they all fail you get an IO error. I&#39;m not sure I fully understand your question."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 9, "last_activity_date": 1516916272, "last_edit_date": 1516916272, "creation_date": 1516914996, "answer_id": 48452048, "question_id": 48450826, "link": "https://stackoverflow.com/questions/48450826/what-is-the-purpose-of-instance-alternative-io/48452048#48452048", "title": "What is the purpose of instance Alternative IO?", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Foldable.html#v:asum\" rel=\"noreferrer\"><code>asum</code></a> from <code>Data.Foldable</code> can be useful to repeat a <code>IOException</code>-throwing action a number of times, until it succeeds or fails altogether:</p>\n\n<pre><code>import Data.Foldable (asum)\nimport Control.Monad\nimport Control.Exception\nimport System.Random -- from the \"random\" package\n\ndiceRoll :: IO Int\ndiceRoll = do\n    putStrLn \"hi\"\n    r &lt;- randomRIO (0,20)\n    if r &lt; 18\n        then throwIO (userError (show r))\n        else return r\n\nmain :: IO ()\nmain = do\n    r &lt;- asum $ take 7 $ repeat diceRoll\n    print r\n</code></pre>\n\n<p>Given the \"return the result of the first action that doesn't throw\" semantics, <code>empty</code> must be an action that throws an exception. Otherwise it wouldn't work as a neutral element, for example in <code>empty &lt;|&gt; return 4</code>.</p>\n\n<p>This is not <em>that</em> different from how the <code>Alternative</code> instance for <code>Maybe</code> behaves. There, <code>asum</code> returns the first non-<code>Nothing</code> value in a sequence of <code>Maybe</code>s.</p>\n\n<p>(Another \"strange\" <code>empty</code> is the one for the <code>Alternative</code> instace of <a href=\"https://hackage.haskell.org/package/async-2.1.1.1/docs/Control-Concurrent-Async.html#t:Concurrently\" rel=\"noreferrer\"><code>Concurrently</code></a>, which just waits forever. The <code>&lt;|&gt;</code> races two actions against each other.)</p>\n"}, {"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1516991322, "post_id": 48452504, "comment_id": 83928254, "body": "All answers are great but this one helped me to realize that running the IO action was the problem, not evaluation."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 10, "last_activity_date": 1516917202, "creation_date": 1516917202, "answer_id": 48452504, "question_id": 48450826, "link": "https://stackoverflow.com/questions/48450826/what-is-the-purpose-of-instance-alternative-io/48452504#48452504", "title": "What is the purpose of instance Alternative IO?", "body": "<p>The purpose of the <code>Alternative</code> instance for <code>IO</code> is to combine <code>IO</code> actions that might fail (by causing an IO error or otherwise throwing an exception) into a single <code>IO</code> action that \"tries\" multiple actions in turn, accepting the first successful one, or -- if all actions fail -- fails itself.</p>\n\n<p>So, something like this would work to read one or more lines (using <code>some</code>) from standard input or else (using <code>&lt;|&gt;</code>) complain if no lines are available:</p>\n\n<pre><code>main = (print =&lt;&lt; some getLine) &lt;|&gt; putStrLn \"No input!\"\n</code></pre>\n\n<p>or you could write something like:</p>\n\n<pre><code>readConfig :: IO Config\nreadConfig = readConfigFile \"~/.local/myapp/config\"\n         &lt;|&gt; readConfigFile \"/etc/myapp/config\"\n         &lt;|&gt; return defaultConfig\n</code></pre>\n\n<p>Given this, it makes perfect sense that:</p>\n\n<pre><code>guard False &lt;|&gt; guard False\n</code></pre>\n\n<p>represents an action that, when executed, must fail by generating an exception.  If it didn't, as @danidaz has pointed out, then executing the action:</p>\n\n<pre><code>guard False &lt;|&gt; guard False &lt;|&gt; putStrLn \"success!\"\n</code></pre>\n\n<p>wouldn't work to execute the third action.  Since <code>&lt;|&gt;</code> is left associative and tries its left action before its right, executing the value of this expression would just execute whatever successful action <code>guard False &lt;|&gt; guard False</code> represented (e.g., <code>return ()</code> or whatever) and never try <code>putStrLn \"success!\"</code>.</p>\n\n<p>There's a subtlety here that may be throwing you off.  Contrary to first appearances, the value of:</p>\n\n<pre><code>guard False &lt;|&gt; guard False\n</code></pre>\n\n<p>isn't <code>_|_</code> in the usual sense.  Rather it's a perfectly well defined IO action that, <em>if executed</em> will fail to terminate in the sense of throwing an exception.  That type of non-termination is still useful, though, because we can catch it (by adding another <code>&lt;|&gt;</code> alternative, for example!).</p>\n\n<p>Also note, because you haven't supplied a better exception, a default exception of <code>userError \"mzero\"</code> is thrown.  If you had instead caused failure via:</p>\n\n<pre><code>ioError (userError \"one\") &lt;|&gt; ioError (userError \"two\")\n</code></pre>\n\n<p>you'd see that if all actions fail, the last exception thrown is the one that gets thrown by the composite action.</p>\n"}, {"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 4, "last_activity_date": 1516927581, "last_edit_date": 1516927581, "creation_date": 1516917836, "answer_id": 48452640, "question_id": 48450826, "link": "https://stackoverflow.com/questions/48450826/what-is-the-purpose-of-instance-alternative-io/48452640#48452640", "title": "What is the purpose of instance Alternative IO?", "body": "<p>While not explicitly documented with <code>Alternative</code>, instances should essentially obey the following laws:</p>\n\n<pre><code>pure x &lt;|&gt; y = pure x\nempty &lt;|&gt; x = x\n</code></pre>\n\n<p>You can intuit this as implementing some notion of \u201ctruthiness\u201d and \u201cfalsiness\u201d, where <code>pure x</code> is always truthy and <code>empty</code> is always falsy.</p>\n\n<p>For this to make any sense for <code>IO</code>, we need some notion of truthiness. There aren\u2019t many good ones, but <code>IO</code> has the ability to handle exceptions, so we can define truthy <code>IO</code> actions as actions that produce a value and falsy <code>IO</code> actions as actions that throw exceptions. Therefore, <code>(&lt;|&gt;)</code> for <code>IO</code> runs its first argument, and if it produces a value without throwing an exception, it returns the value; otherwise, it returns its second argument.</p>\n\n<p>We now have a definition of <code>(&lt;|&gt;)</code> for <code>IO</code>, but what should <code>empty</code> be? Well, <code>empty</code> must be falsy, and we have defined falsiness on <code>IO</code> as \u201cthrowing an exception\u201d. Therefore, <code>empty</code> must be an action that throws an exception.</p>\n\n<p>The <code>guard</code> function is very simple, since it is just <code>pure ()</code> when given <code>True</code> and <code>empty</code> when given <code>False</code>. This means your examples are really equivalent to the following:</p>\n\n<pre><code>empty &lt;|&gt; pure ()\nempty &lt;|&gt; empty\n</code></pre>\n\n<p>In the first example, <code>empty</code> throws, so <code>(&lt;|&gt;)</code> catches it and returns <code>pure ()</code>, which obviously produces <code>()</code>. In the second example, the same thing happens, except that the second argument is also <code>empty</code>, so the expression\u2019s result also throws an exception.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 0, "accepted_answer_id": 48452504, "answer_count": 3, "score": 4, "last_activity_date": 1516927581, "creation_date": 1516909899, "question_id": 48450826, "link": "https://stackoverflow.com/questions/48450826/what-is-the-purpose-of-instance-alternative-io", "title": "What is the purpose of instance Alternative IO?", "body": "<p>This instance doesn't seem to behave properly:</p>\n\n<pre><code>&gt; guard True &lt;|&gt; guard False\n\n&gt; guard False &lt;|&gt; guard False\n*** Exception: user error (mzero)\n</code></pre>\n\n<p>One might argue that this cannot result in anything else. But why define such instance in the first place? Is there any good reason to result in <code>_|_</code> whenever evaluation does not make sense?</p>\n"}, {"tags": ["haskell", "let"], "comments": [{"owner": {"reputation": 789, "user_id": 8120642, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OX8-_3nAbeE/AAAAAAAAAAI/AAAAAAAAAAA/of7PUZBmbk4/photo.jpg?sz=128", "display_name": "hegel5000", "link": "https://stackoverflow.com/users/8120642/hegel5000"}, "edited": false, "score": 2, "creation_date": 1516908962, "post_id": 48450475, "comment_id": 83894067, "body": "<a href=\"https://stackoverflow.com/questions/40694437/under-what-circumstances-could-common-subexpression-elimination-affect-the-lazin\" title=\"under what circumstances could common subexpression elimination affect the lazin\">stackoverflow.com/questions/40694437/&hellip;</a>"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516909059, "post_id": 48450475, "comment_id": 83894125, "body": "This is implementation dependant. Any reasonable compiler is likely to call <code>comp</code> and <code>otherComp</code> only once, unless it inlines the whole thing to <code>4 * (n*n*n+10)</code> to take advantage of unboxing and remove the calls. Implementations are not required to do common subexpression elimination"}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516911405, "post_id": 48451012, "comment_id": 83895255, "body": "I honestly had no idea about this. Does this mean that if I put something marginally expensive (like <code>length</code> on a list I know might be quite long) in a <code>let</code>, that Haskell may end up calling <code>length</code> a whole bunch of times? Argh!"}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1516912709, "post_id": 48451012, "comment_id": 83895926, "body": "Yeah, that&#39;s what this question is also about. So what can one do to avoid multiple expensive reevaluations?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1516914650, "post_id": 48451012, "comment_id": 83896937, "body": "But <code>let x = &lt;expensive&gt; in x + x</code> will only evaluate <code>x</code> once, it just doesn&#39;t share function calls.  If you need more than local sharing of single calls like this, you can <a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow noreferrer\">memoize</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1516917008, "post_id": 48451012, "comment_id": 83898089, "body": "@luqui I added some comment about that. Note that even that <code>x</code> might be computed twice, if it gets a polymorphic type with constraints (with the DMR off). Actually, when polymorphic values are around, it is a bit tricky to guess what is recomputed and what is not. Experimenting with GHCi, I found my guesses on a few corner cases to be pretty wrong... ;-)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1516919768, "post_id": 48451012, "comment_id": 83899122, "body": "@chi, care to share some of your wrong guesses?  I&#39;m curious."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1516921597, "post_id": 48451012, "comment_id": 83899750, "body": "@luqui GHCi, DMR on: <code>let x = let y = trace &quot;y&quot; [] in (trace &quot;a&quot; (show y), trace &quot;b&quot; y)</code>, evaluating <code>x :: (String, [Int])</code> and <code>x :: (String, [Char])</code>. I got the latter wrong, both in the recomputation, and even in the value (!). Here, I think the extended default rules of GHCi got me."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1516921941, "post_id": 48451012, "comment_id": 83899860, "body": "@luqui With scoped variables, no ext-defaulting rules, ambiguous types: <code>let z :: forall a. Show a =&gt; (String, [a]) ; z = trace &quot;z&quot; (show ([] :: [a]), [])</code> does more or less what I expected in the first place."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 10, "last_activity_date": 1516916768, "last_edit_date": 1516916768, "creation_date": 1516910585, "answer_id": 48451012, "question_id": 48450475, "link": "https://stackoverflow.com/questions/48450475/haskell-are-let-expressions-recalculated/48451012#48451012", "title": "Haskell | Are let expressions recalculated?", "body": "<p>In GHCi, without optimization, four times.</p>\n\n<pre><code>&gt; import Debug.Trace\n&gt; :{\n| f x = let comp n      = trace \"A\" n\n|           otherComp n = comp n + comp n\n|       in  otherComp x + otherComp x\n| :}\n&gt; f 10\nA\nA\nA\nA\n40\n</code></pre>\n\n<p>With optimization, GHC might be able to inline the functions and optimize everything. However, in the general case, I would not count on GHC to optimize multiple calls into one. That would require memoizing and/or CSE (common subexpression elimination), which is not always an optimization, hence GHC is quite conservative about it.</p>\n\n<p>As a thumb rule, when evaluating performance, expect that each (evaluated) call in the code corresponds to an actual call at runtime.</p>\n\n<hr>\n\n<p>The above discussion applies to <em>function</em> bindings, only. For simple pattern bindings made of just a variable like</p>\n\n<pre><code>let x = g 20\nin x + x\n</code></pre>\n\n<p>then <code>g 20</code> will be computed once, bound to <code>x</code>, and then <code>x + x</code> will reuse the same value twice. With one proviso: that <code>x</code> gets assigned a <em>monomorphic</em> type.</p>\n\n<p>If <code>x</code> gets assigned a polymorphic type with a typeclass constraint, then it acts as a function in disguise.</p>\n\n<pre><code>&gt; let x = trace \"A\" (200 * 350)\n&gt; :t x\nx :: Num a =&gt; a\n&gt; x + x\nA\nA\n140000\n</code></pre>\n\n<p>Above, <code>200 * 350</code> has been recomputed twice, since it got a polymorphic type.</p>\n\n<p>This mostly only happens in GHCi. In regular Haskell source files, GHC uses the <a href=\"https://stackoverflow.com/questions/32496864/what-is-the-monomorphism-restriction\">Dreaded Monomorphism Restriction</a> to provide <code>x</code> a monomorphic type, precisely to avoid recomputation of variables. If that can not be done, and duplicate computation is needed, GHC prefers to raise an error than silently cause recomputation. (In GHCi, the DMR is disabled to make more code work as it is, and recomputation happens, as seen above.)</p>\n\n<p>Summing up: variable bindings <code>let x = ...</code> should be fine in source code, and work as expected without duplicating computation. If you want to be completely sure, annotate <code>x</code> with an explicit monomorphic type annotation.</p>\n"}], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 48451012, "answer_count": 1, "score": 2, "last_activity_date": 1516916768, "creation_date": 1516908462, "question_id": 48450475, "link": "https://stackoverflow.com/questions/48450475/haskell-are-let-expressions-recalculated", "title": "Haskell | Are let expressions recalculated?", "body": "<p>Lets say we have this function:</p>\n\n<pre><code>foo n = let comp      n = n * n * n + 10\n            otherComp n = (comp n) + (comp n)\n        in  (otherComp n) + (otherComp n)\n</code></pre>\n\n<p>How many times will comp n get actually executed? 1 or 4? Does Haskell \"store\" function results in the scope of let?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "state-monad"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1516896834, "post_id": 48447268, "comment_id": 83886958, "body": "Yeah, you can do that. Have you <i>tried</i> anything yet?"}, {"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1516896921, "post_id": 48447268, "comment_id": 83887030, "body": "yes but im just failing. i ve tried this : newtype State s a = State { runState :: s -&gt; (a,s) }   getX:: State Coordin Float getX = State $ &#40;x, y) -&gt; (x, (x, y))"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1516897170, "post_id": 48447268, "comment_id": 83887250, "body": "Ok that&#39;s something, now add it to the question and explain what goes wrong."}, {"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1516897343, "post_id": 48447268, "comment_id": 83887363, "body": "yes i did. i copy the error message"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "edited": false, "score": 0, "creation_date": 1516898361, "post_id": 48447766, "comment_id": 83888032, "body": "Thank you very much sir!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1516898005, "creation_date": 1516898005, "answer_id": 48447766, "question_id": 48447268, "link": "https://stackoverflow.com/questions/48447268/haskell-state-monad-coordinate/48447766#48447766", "title": "Haskell State Monad Coordinate", "body": "<p><code>State $ \\(x, y) -&gt; (x, (x, y))</code> has the type <code>State (Float,Float) Float</code>, which is indeed equivalent (<em>isomorphic</em>) to <code>State Coordin Float</code>, but it's not literally the same type. The <code>Coordin</code> type must be unwrapped with the <code>Coordin</code> constructor, not with the tuple constructor!</p>\n\n<pre><code>getX :: State Coordin Float\ngetX = State $ \\(Coordin x y) -&gt; (x, Coordin x y)\n</code></pre>\n\n<p>Alternatively, and preferrably, you can use the record field accessor:</p>\n\n<pre><code>getX = x &lt;$&gt; get\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 48447766, "answer_count": 1, "score": -2, "last_activity_date": 1516898005, "creation_date": 1516896534, "last_edit_date": 1516897795, "question_id": 48447268, "link": "https://stackoverflow.com/questions/48447268/haskell-state-monad-coordinate", "title": "Haskell State Monad Coordinate", "body": "<p>I am trying to figure out how the state Monad works. I am trying to implement a function that gets two coordinates <code>(x, y)</code> and returns the <code>x</code> or <code>y</code> coordinate back. This should happen within the State Monad.</p>\n\n<pre><code>data Coordin = Coordin {x,y :: Float}\n</code></pre>\n\n<p>the functions that should be implemented they are looking like this: </p>\n\n<pre><code>getX :: State Coordin Float\ngetY :: State Coordin Float\n</code></pre>\n\n<p>How can this work out?</p>\n\n<p>I have tried this:</p>\n\n<pre><code>newtype State s a = State { runState :: s -&gt; (a,s) }  \n\ngetX:: State Coordin Float\ngetX = State $ \\(x, y) -&gt; (x, (x, y))\n</code></pre>\n\n<p>but getting this error message : </p>\n\n<pre><code>Couldn't match type \u2018(Float, t0)\u2019 with \u2018Coordin\u2019\n    Expected type: State Coordin Float\n      Actual type: State (Float, t0) Float\n    In the expression: State $ \\ (x, y) -&gt; (x, (x, y))\n    In an equation for \u2018getX\u2019: getX = State $ \\ (x, y) -&gt; (x, (x, y))\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "typechecking", "unification", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1516897009, "post_id": 48447181, "comment_id": 83887112, "body": "I don&#39;t see how typing has anything to do with strictness. This sounds like a bug in your type checker."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1516899353, "post_id": 48447181, "comment_id": 83888682, "body": "@Li-yaoXia Yes, you&#39;re right. <code>(a -&gt; a) -&gt; a</code> applied to <code>Num t =&gt; (t -&gt; t) -&gt; t -&gt; t</code> yields the constraint <code>a ~ t -&gt; t</code> and hence <code>Num t =&gt; t -&gt; t</code>. It&#39;s a bug."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1516902618, "post_id": 48447181, "comment_id": 83890664, "body": "@Li-yaoXia I have to eta expand <code>fix</code> in Javascript and consequently have to type it <code>fix :: ((a -&gt; a) -&gt; a -&gt; a) -&gt; a -&gt; a</code>. So strictness affects types but in a different way than I thought. This is exciting!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1516912533, "post_id": 48447181, "comment_id": 83895829, "body": "Another keyword relevant to recursion in strict languages is &quot;value restriction&quot;, e.g., <a href=\"http://mlton.org/ValueRestriction\" rel=\"nofollow noreferrer\">mlton.org/ValueRestriction</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1516899090, "post_id": 48447525, "comment_id": 83888502, "body": "Thanks. Is <code>fix = (f) =&gt; f(fix(f))</code> the translation of <code>fix f = let x = f x in x</code>? I actually declared <code>fix = f =&gt; f(f)</code>, which makes <code>f(f) (n - 1)</code> necessary as recursive call."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1516899707, "post_id": 48447525, "comment_id": 83888901, "body": "I guess I got it: <code>fix = f =&gt; f(f)</code> would be an infinite type. So <code>fix</code> must be declared the way you did in order to match <code>(a -&gt; a) -&gt; a</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1516902310, "post_id": 48447525, "comment_id": 83890471, "body": "I indeed used the wrong version of <code>fix</code>. When I implement it as your proposed <code>fix = f =&gt; x =&gt; f(fix(f)) (x))</code> and type it explicitly with <code>((a -&gt; a) -&gt; a -&gt; a) -&gt; a -&gt; a</code>, it actually works. My type checker is just fine. And as a side effect I finally understood <code>fix</code> in Haskell. You got me on the right track. Thanks again!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1516910851, "post_id": 48447525, "comment_id": 83895004, "body": "@ftor <i>&quot;I actually declared <code>fix = f =&gt; f(f)</code>&quot;</i> I understand the downvotes to your Q now. this <b><i>really</i></b> should have been included in the question! :) (FYI that definition is  <b>U combinator</b>, not <b>Y</b>)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1516911702, "post_id": 48447525, "comment_id": 83895404, "body": "@WillNess I didn&#39;t realize this connection when I posted the question. Anyway, I don&#39;t criticize the downvoters. The difference between <code>U</code> and <code>Y</code> is now clear to me. It was really helpful to understand their types."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1516976308, "post_id": 48447525, "comment_id": 83919155, "body": "For an eta-expanded <code>fix</code> the type sig <code>((a -&gt; a) -&gt; a -&gt; a) -&gt; a -&gt; a</code> is actually not quite accurate. I tried to implement a tail recursive <code>fact</code> with an accumulator and it didn&#39;t type check. The proper type is <code>((a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1517480961, "post_id": 48447525, "comment_id": 84116505, "body": "@ftor that&#39;s strange, as <code>fix</code> creates chains of compositions, <code>fix g = g . g . g . g . ...</code> and <code>(a-&gt;b) . (a-&gt;b)</code> wouldn&#39;t typecheck. maybe you ended up doing some  equivalent of a monadic, <i>extended</i> composition: <code>(g &lt;=&lt; g &lt;=&lt; g &lt;=&lt; ...)</code> so the types aligned as <code>(a-&gt;m a) &lt;=&lt; (a-&gt;m a) &lt;=&lt; ...</code>..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1517497381, "post_id": 48447525, "comment_id": 84127468, "body": "@WillNess When I check <code>fix f a = f (fix f) a</code>&#39;s type in GHCi it is <code>((t1 -&gt; t) -&gt; t1 -&gt; t) -&gt; t1 -&gt; t</code> too. Is this the wrong implementation or just a weird GHCi behavior?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1517498404, "post_id": 48447525, "comment_id": 84128204, "body": "right, I as wrong. <code>((a -&gt; b) -&gt; (a -&gt; b)) -&gt; (a -&gt; b)</code> is totally fine, matches the <code>(t -&gt; t) -&gt; t</code> type for the chained compositions. thanks!"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1522076621, "last_edit_date": 1522076621, "creation_date": 1516897251, "answer_id": 48447525, "question_id": 48447181, "link": "https://stackoverflow.com/questions/48447181/can-fix-only-be-typed-in-non-strict-evaluated-languages/48447525#48447525", "title": "Can fix only be typed in non-strict evaluated languages?", "body": "<p>It's a bug in the type checker. </p>\n\n<p>It is true though that the naive Haskell definition of <code>fix</code> does not terminate in Javascript:</p>\n\n<pre><code>&gt; fix = (f) =&gt; f(fix(f))\n&gt; factf = (f) =&gt; (n) =&gt; (n === 0) ? 1 : n * f(n - 1)\n&gt; fact = fix(factf) // stack overflow\n</code></pre>\n\n<p>You'd have to use an eta-expanded definition in order to the prevent looping evaluation of <code>fix(f)</code>:</p>\n\n<pre><code>&gt; fix = (f) =&gt; (a) =&gt; f(fix(f), a)\n&gt; factf = (f, a) =&gt; (a == 0) ? 1 : a * f(a - 1)\n&gt; fact = fix(factf)\n&gt; fact(10) // prints 3628800\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1516972878, "post_id": 48461226, "comment_id": 83917160, "body": "I am curious if this newtype along with <code>U</code>&#39;s implementation in Javascript satisfies my type checker. I use Scott to encode ADTs, hence my type will be less concise. Thank you Will!"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1576857134, "last_edit_date": 1576857134, "creation_date": 1516969090, "answer_id": 48461226, "question_id": 48447181, "link": "https://stackoverflow.com/questions/48447181/can-fix-only-be-typed-in-non-strict-evaluated-languages/48461226#48461226", "title": "Can fix only be typed in non-strict evaluated languages?", "body": "<p>So as it turns out, you tried to implement <strong>U</strong> combinator, which is <em>not</em> a fixed-point combinator. </p>\n\n<p>Whereas the fixed-point <strong>Y</strong> combinator <code><b>_Y</b> g = g (_Y g)</code> enables us to write </p>\n\n<pre><code> _Y (\\r x -&gt; if x==0 then 1 else x * r (x-1)) 5     -- _Y g =&gt; r = _Y g\n -- 120\n</code></pre>\n\n<p>with <code><b>_U</b> g = g (g)</code> we'd have to write</p>\n\n<pre><code> _U (\\f x -&gt; if x==0 then 1 else x * f f (x-1)) 5   \n                                            -- _U g =&gt; f = g, f f == _U g\n</code></pre>\n\n<p>As you've discovered, this <strong><code>_U</code></strong> has no type in Haskell. On the one hand <code>g</code> is a function, <code>g :: a -&gt; b</code>; on the other it receives itself as its first argument, so it demands <code>a ~ a -&gt; b</code> for <em>any</em> types <code>a</code> and <code>b</code>. </p>\n\n<p>Substituting <code>a -&gt; b</code> for <code>a</code> in <code>a -&gt; b</code> <em>right away</em> leads to infinite recursion (cf. \"occurs check\"), because <code>(a -&gt; b) -&gt; b</code> still has that <code>a</code> which needs to be replaced with <code>a -&gt; b</code>; ad infinitum. </p>\n\n<p>A solution could be to introduce a recursive type, turning <code>a ~ a -&gt; b</code> into <code>R = R -&gt; b</code> i.e.</p>\n\n<pre><code> newtype U b = U {app :: U b -&gt; b}      -- app :: U b -&gt; U b -&gt; b\n</code></pre>\n\n<p>so we can define </p>\n\n<pre><code> _U :: (U b -&gt; b) -&gt; b\n _U g = g (U g)                         -- g :: U b -&gt; b \n   -- = app (U g) (U g)\n   -- = join app (U g)\n   -- = (join app . U) g                -- (**)\n</code></pre>\n\n<p>which now has a type; and use it as </p>\n\n<pre><code> _U (\\f x -&gt; if x==0 then 1 else x * app f f (x-1)) 5\n                                        -- _U g  =&gt;  f = U g, \n -- 120                                 -- app f f = g (U g) == _U g\n</code></pre>\n\n<hr>\n\n<p><em>edit:</em> And if you want to implement the <strong>Y</strong> combinator as a non-recursive definition, then </p>\n\n<pre><code> _U (\\f x -&gt; if x==0 then 1 else x * (app f f) (x-1))\n=                                    -------.-               -- abstraction\n _U (\\f -&gt; (\\r x -&gt; if x==0 then 1 else x * r (x-1)) (app f f))\n=          -------.---------------------------------         -- abstraction\n (\\g -&gt; _U (\\f -&gt; g (app f f))) (\\r x -&gt; if x==0 then 1 else x * r (x-1))\n=                                                            --  r = app f f \n _Yn                            (\\r x -&gt; if x==0 then 1 else x * r (x-1))\n</code></pre>\n\n<p>so</p>\n\n<pre><code> _Yn :: (b -&gt; b) -&gt; b\n _Yn g = _U (\\f -&gt; g (app f f))         -- Y, non-recursively\n</code></pre>\n\n<p>does the job:</p>\n\n<pre><code> _Yn (\\r x -&gt; if x==0 then 1 else x * r (x-1)) 5\n -- 120\n</code></pre>\n\n<hr>\n\n<p>(<em>later update:</em>) Or, point-freer, </p>\n\n<pre><code> _Yn g = _U (\\f -&gt; g (app f f))\n       = _U (\\f -&gt; g (join app f))\n       = _U (\\f -&gt; (g . join app) f)\n       = _U (g . join app)\n       = _U ( (. join app) g )\n</code></pre>\n\n<p>Thus</p>\n\n<pre><code> _Yn :: (b -&gt; b) -&gt; b\n _Yn = _U . (. join app)                -- and, using (**)\n     = join app . U . (. join app)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 48447525, "answer_count": 2, "score": 3, "last_activity_date": 1576857134, "creation_date": 1516896252, "last_edit_date": 1562457140, "question_id": 48447181, "link": "https://stackoverflow.com/questions/48447181/can-fix-only-be-typed-in-non-strict-evaluated-languages", "title": "Can fix only be typed in non-strict evaluated languages?", "body": "<p>I write a runtime type checker in and for Javascript and have trouble to type <code>fix</code>:</p>\n\n<pre><code>fix :: (a -&gt; a) -&gt; a\nfix f = ...\n\nfix (\\rec n -&gt; if n == 0 then 1 else n * rec (n-1)) 5 -- 120\n</code></pre>\n\n<p>The factorial function passed to <code>fix</code> has the simplified type <code>(Int -&gt; Int) -&gt; Int -&gt; Int</code>.</p>\n\n<p>When I try to reproduce the expression in Javascript, my type checker fails due to the invalid constraint <code>Int ~ Int -&gt; Int</code>.</p>\n\n<p><code>fix (const \"hallo\")</code> also fails and the type checker complaints that it cannot construct an infinite type (negative occurs check).</p>\n\n<p>With other combinators my unification results are consistent with Haskell's.</p>\n\n<p>Is my unifiction algorithm probably  wrong or can <code>fix</code> only be typed in non-strict environments?</p>\n\n<p>[EDIT]</p>\n\n<p>My implementation of <code>fix</code> in Javascript is <code>const fix = f =&gt; f(f)</code>.</p>\n"}, {"tags": ["haskell", "generics", "typeclass"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1516882186, "post_id": 48442058, "comment_id": 83876290, "body": "Why is it wrong? You forgot the basecase."}, {"owner": {"reputation": 81, "user_id": 4391844, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6c8cbbec3a0c781da8c81ea0a65ac2f5?s=128&d=identicon&r=PG&f=1", "display_name": "tem887", "link": "https://stackoverflow.com/users/4391844/tem887"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1516883456, "post_id": 48442058, "comment_id": 83877093, "body": "Indeed I did. Overlooked it while I was trying to solve the main issue."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1516885697, "post_id": 48442058, "comment_id": 83878593, "body": "The next step is a <code>data AnyFoo = forall a. Foo a =&gt; AnyFoo a</code> and an instance for it :)"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 4391844, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6c8cbbec3a0c781da8c81ea0a65ac2f5?s=128&d=identicon&r=PG&f=1", "display_name": "tem887", "link": "https://stackoverflow.com/users/4391844/tem887"}, "edited": false, "score": 0, "creation_date": 1516883362, "post_id": 48442572, "comment_id": 83877029, "body": "So in a way, adding the class constraint tells it to match with the types in the Foo class, just like changing the class constraint to Eq would tell it to look for a match in the Eq type class?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 81, "user_id": 4391844, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6c8cbbec3a0c781da8c81ea0a65ac2f5?s=128&d=identicon&r=PG&f=1", "display_name": "tem887", "link": "https://stackoverflow.com/users/4391844/tem887"}, "edited": false, "score": 0, "creation_date": 1516884490, "post_id": 48442572, "comment_id": 83877790, "body": "@tem887 I&#39;m not sure what you mean by <i>look for a match</i>, but if that phrase works for you... :) The way I think of it is that instead of the type <code>a</code> being entirely unconstrained, the class constraint <code>Foo a</code> states that only those <code>a</code> types that are also <code>Foo</code> instances are allowed."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1516919246, "post_id": 48442572, "comment_id": 83898923, "body": "A simpler definition would be <code>foo = sum . map foo</code>"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 6, "last_activity_date": 1516882281, "creation_date": 1516882281, "answer_id": 48442572, "question_id": 48442058, "link": "https://stackoverflow.com/questions/48442058/haskell-generic-typeclass-with-list/48442572#48442572", "title": "Haskell generic typeclass with list", "body": "<p>You need to say that the list must contain <code>Foo</code> values:</p>\n\n<pre><code>instance Foo a =&gt; Foo [a] where\n  foo (h:t) = foo h + foo t\n  foo [] = 0\n</code></pre>\n\n<p>You can only call <code>foo h</code> when <code>h</code> is a <code>Foo</code> instance, so you need to qualify the type class for <code>[a]</code> so that it only works for lists of <code>Foo</code> instances.</p>\n\n<p>Otherwise, if, for instance, you had a <code>[Int]</code>, <code>foo h</code> would imply that you'd try to call <code>foo</code> on an <code>Int</code> value, but <code>foo</code> isn't defined for that type.</p>\n\n<p>With the above implementation for <code>[a]</code> you get expected results:</p>\n\n<pre><code>Prelude&gt; foo [True,False,True]\n30\nPrelude&gt; foo [True,False,True,True]\n40\nPrelude&gt; foo \"foo\"\n60\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 81, "user_id": 4391844, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6c8cbbec3a0c781da8c81ea0a65ac2f5?s=128&d=identicon&r=PG&f=1", "display_name": "tem887", "link": "https://stackoverflow.com/users/4391844/tem887"}, "edited": false, "score": 0, "creation_date": 1516883626, "post_id": 48442632, "comment_id": 83877191, "body": "Yes, I know. ts in this case is the tail of the list, i.e. the remaining elements. I just wanted to give a simple example with few steps :-)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1516885222, "last_edit_date": 1516885222, "creation_date": 1516882474, "answer_id": 48442632, "question_id": 48442058, "link": "https://stackoverflow.com/questions/48442058/haskell-generic-typeclass-with-list/48442632#48442632", "title": "Haskell generic typeclass with list", "body": "<p>You forgot the base case:</p>\n\n<pre><code>instance Foo a =&gt; Foo [a] where\n  <b>foo</b> (t:ts) = foo t + <b>foo</b> ts\n  <b>foo [] = 0</b></code></pre>\n\n<p>Mind that the call <code>foo ts</code> does <em>not</em> mean that we call <code>foo</code> on the second element. We actually call recursively the function we define (the <code>foo</code> in boldface), and this will thus keep calling <code>foo</code> on the <em>elements</em> of the list, until the list is exhausted, in which case the base case <code>foo [] = 0</code> will be used.</p>\n\n<p>So it will evaluate:</p>\n\n<pre><code>   foo (False : True : [])\n-&gt; foo False + foo (True : [])\n-&gt; 20 + foo (True : [])\n-&gt; 20 + foo True + foo []\n-&gt; 20 + 20 + foo []\n-&gt; 20 + 20 + 0\n-&gt; 20 + 20\n-&gt; 40\n-&gt;\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 4391844, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6c8cbbec3a0c781da8c81ea0a65ac2f5?s=128&d=identicon&r=PG&f=1", "display_name": "tem887", "link": "https://stackoverflow.com/users/4391844/tem887"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 515, "favorite_count": 0, "accepted_answer_id": 48442572, "answer_count": 2, "score": 3, "last_activity_date": 1516885222, "creation_date": 1516880635, "last_edit_date": 1516882565, "question_id": 48442058, "link": "https://stackoverflow.com/questions/48442058/haskell-generic-typeclass-with-list", "title": "Haskell generic typeclass with list", "body": "<p>I have a class defined like this, so that <code>foo</code> takes a generic type and returns an Integer:</p>\n\n<pre><code>class Foo a where\n  foo :: a -&gt; Integer\n</code></pre>\n\n<p>and a couple of instances defined so it will work with <code>Bool</code> and <code>Char</code> types:</p>\n\n<pre><code>instance Foo Bool where\n  foo _ = 10\n\ninstance Foo Char where\n  foo _ = 20\n</code></pre>\n\n<p>If I now want to add an instance for a list with a generic type, I would want to do something like this:</p>\n\n<pre><code>instance Foo [a] where\n  foo (t:ts) = (foo t) + (foo ts)\n</code></pre>\n\n<p>However, this is wrong. From my current understanding, I would want to assume that Haskell infers the types and does something like this:</p>\n\n<blockquote>\n  <p>foo [False,True] -> foo False + foo True -> 10 + 10 = 20</p>\n</blockquote>\n\n<p>I've looked at several books and read about polymorphism and typeclasses, including Learn You a Haskell For Great Good! but still can't wrap my head around how to solve this?</p>\n"}, {"tags": ["haskell", "functional-programming", "binary"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 4, "creation_date": 1516868758, "post_id": 48438257, "comment_id": 83867963, "body": "You should not use an <code>Integer</code> for this &quot;binary number&quot;. A string input would be more fitting, or a list of booleans."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1516869198, "post_id": 48438257, "comment_id": 83868180, "body": "<i>Need the examples above to be compiled in less than 5 seconds</i>? That sounds extremely suspicious, like you&#39;re abusing the compiler for conversion purposes. Don&#39;t do that. \u2014 If you really need to write out binary in Haskell source code, just use the <a href=\"https://downloads.haskell.org/~ghc/master/users-guide/glasgow_exts.html#binary-integer-literals\" rel=\"nofollow noreferrer\"><code>-XBinaryLiterals</code></a> extension."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1516868781, "post_id": 48438340, "comment_id": 83867977, "body": "It could be without <code>Maybe i</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 1, "creation_date": 1516868894, "post_id": 48438340, "comment_id": 83868036, "body": "@mathandtic: that is the first version of the program. You can pick any of the two. But the second is more safe."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1516871478, "last_edit_date": 1516871478, "creation_date": 1516868122, "answer_id": 48438340, "question_id": 48438257, "link": "https://stackoverflow.com/questions/48438257/convert-binary-to-decimal-haskell/48438340#48438340", "title": "Convert Binary to Decimal Haskell", "body": "<p>Given the \"decimal\" number only contains zeros and ones, we can use <em>recursion</em> for this:</p>\n\n<pre><code>bintodec :: Integral i =&gt; i -&gt; i\nbintodec 0 = 0\nbintodec i = 2 * bintodec (div i 10) + (mod i 10)\n</code></pre>\n\n<p>So what we do here is using <code>div i 10</code> to \"shift the number one to the right\". We use recursion and multiply with <em>two</em> to use binary representation. We also use <code>mod i 10</code> to obtain the last digit that we then add to the number.</p>\n\n<p>As said before this is not very safe, since for instance it will also produce a number for <code>bintodec 10010202010</code>, we can in that case return a <code>Maybe i</code> with:</p>\n\n<pre><code>bintodec :: Integral i =&gt; i -&gt; Maybe i\nbintodec 0 = Just 0\nbintodec i | last &lt; 2 = fmap (\\x -&gt; 2*x + last) (bintodec (div i 10))\n           | otherwise = Nothing\n    where last = mod i 10\n</code></pre>\n\n<p>This then produces:</p>\n\n<pre><code>Prelude&gt; bintodec 1110101011111111000000111100001010101011110010000001\nJust 4134096010394753\nPrelude&gt; bintodec 11101010111111110000001111000010101014011110010000001\nNothing\n</code></pre>\n\n<p>It is however better to use a <code>[Bool]</code> for instance, since this will enforce that we can not provide a value that is not a valid bitstring. In that case we can use:</p>\n\n<pre><code>bintodec :: [Bool] -&gt; Int\nbintodec = foldr (\\x y -&gt; fromEnum x + 2*y) 0\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3418, "favorite_count": 2, "accepted_answer_id": 48438340, "answer_count": 1, "score": 2, "last_activity_date": 1516882590, "creation_date": 1516867783, "last_edit_date": 1516882590, "question_id": 48438257, "link": "https://stackoverflow.com/questions/48438257/convert-binary-to-decimal-haskell", "title": "Convert Binary to Decimal Haskell", "body": "<p>I need a program in which I enter a binary system number, and return that same number to me in decimal base.</p>\n\n<pre><code>binToDec :: Integer -&gt; Integer\n\nbinToDec 1110101011111111000000111100001010101011110010000001 = 4134096010394753\n\nbinToDec 111111111111111111111111111111111111111111111111111111111111111 =  9223372036854775807 \n</code></pre>\n\n<p>I also need the examples above to be compiled in less than 5 seconds.</p>\n\n<p>I have managed to do this, but the problem is that it starts from a list of integers:</p>\n\n<pre><code>binToDec l = sum $ map (2^) $ findIndices (==1) $ reverse l\n</code></pre>\n"}, {"tags": ["haskell", "induction"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1516859984, "post_id": 48436052, "comment_id": 83864325, "body": "Why not <code>toLast [] = []</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1516860579, "post_id": 48436052, "comment_id": 83864517, "body": "I don\u2019t understand what is being asked. Are you asking for an example of proof via structural induction or are you asking what the definition of <code>toLast []</code> should be? If you are being given a question, can you tell us the question itself?"}, {"owner": {"reputation": 15, "user_id": 8859289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/142d7faff567c7aa229890553cae1600?s=128&d=identicon&r=PG&f=1", "display_name": "AlonErebos", "link": "https://stackoverflow.com/users/8859289/alonerebos"}, "edited": false, "score": 0, "creation_date": 1516861379, "post_id": 48436052, "comment_id": 83864790, "body": "Nope, I have the definition of toLast, I was looking for an example of proof via structural induction, in particular the base case"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 5, "creation_date": 1516861579, "post_id": 48436052, "comment_id": 83864881, "body": "A proof of what? What are you trying to prove?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1516876752, "post_id": 48436052, "comment_id": 83872801, "body": "Am I clear that the definition of <code>toLast</code> is something else besides the code you posted <code>toLast (x:xs) = xs |++| [x]</code>, and that code is actually the property you&#39;re trying to prove?  It&#39;s confusing because it&#39;s a valid definition as is."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1516916594, "post_id": 48436052, "comment_id": 83897891, "body": "Also for using structural induction you need to know some recursive properties of the functions you&#39;re using. Can you please include the definition of <code>toLast</code> and the definition of <code>(|++|)</code>, which then could be used in such a proof?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1516918669, "post_id": 48436052, "comment_id": 83898703, "body": "&quot;For all <b><i>lists</i></b> <code>xs</code>&quot; there&#39;s your induction. What is its base case? Is <code>[1,2]</code> a list? Is <code>[1]</code>?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1516926818, "post_id": 48436052, "comment_id": 83901276, "body": "<code>toLast</code> is not recursive. You can\u2019t do any induction because you aren\u2019t going to need any induction hypothesis. Your function is little different from <code>data Consoid a b = Nil | Cons a b; toLast Nil = Nil; toLast (Cons a b) = Cons b a</code>. There is no induction because there is no recursion."}], "answers": [{"tags": [], "owner": {"reputation": 345, "user_id": 5509894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-IeIcWLzjPnc/AAAAAAAAAAI/AAAAAAAABsY/_IaDPQowLJk/photo.jpg?sz=128", "display_name": "Geraint Ballinger", "link": "https://stackoverflow.com/users/5509894/geraint-ballinger"}, "is_accepted": true, "score": 1, "last_activity_date": 1516927076, "creation_date": 1516927076, "answer_id": 48454194, "question_id": 48436052, "link": "https://stackoverflow.com/questions/48436052/structual-induction-in-haskell/48454194#48454194", "title": "Structual induction in Haskell", "body": "<blockquote>\n  <p>Can anyone give me an example of Structural induction in Haskell?</p>\n</blockquote>\n\n<p>Structural induction always requires two steps:</p>\n\n<ol>\n<li>Consider the base cases</li>\n<li>Consider the generic case by assuming that a function body exists for a list <em>xs</em>, and use that assumption to construct a definition for the next step (<em>x</em>:<em>xs</em>). This is the so called <em>inductive step</em>.</li>\n</ol>\n\n<p>Let's use the idea of structural induction to define your <code>|++|</code> function, which is a better example in my opinion.</p>\n\n<p><code>|++|</code> takes in two lists and outputs a list that is the concatenation of the first with the second, the type signature is therefore:</p>\n\n<pre><code>(|++|) :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>The second list input never changes, so we say that the first list is the <em>parameter of recursion</em>. The base case is therefore when the first list is empty:</p>\n\n<pre><code>(|++|) [] ys = ys\n</code></pre>\n\n<p>Now, lets consider the case when the first argument to <code>|++|</code> is not the empty list but is <code>xs</code>. The inductive step is to assume that our function <code>(|++|) xs ys</code> works (because it is shown to be valid in the base case)  and use that assumption to define the general case when the first input to <code>|++|</code> is <code>(x:xs)</code>. Putting these together, so far, we have:</p>\n\n<pre><code>(|++|) []     ys = ys -- base case\n(|++|) (x:xs) ys = let assumedAlreadyConcatenatedList = ((|++|) xs ys) in *something...* assumedAlreadyConcatenatedList -- half-done general case\n</code></pre>\n\n<p>Having assumed that <code>((|++|) xs ys)</code> works correctly, we just need to define what to do with <code>x</code> and then we are done. How do we concatenate x to a list of already concatenated items? We use cons:</p>\n\n<pre><code>(|++|) []     ys = ys -- base case\n(|++|) (x:xs) ys = let assumedAlreadyConcatenatedList = ((|++|) xs ys) in x : assumedAlreadyConcatenatedList -- completed general case.\n</code></pre>\n\n<p>Hopefully it's clear that we would always need a base case to back our assumption in the inductive step.</p>\n"}], "owner": {"reputation": 15, "user_id": 8859289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/142d7faff567c7aa229890553cae1600?s=128&d=identicon&r=PG&f=1", "display_name": "AlonErebos", "link": "https://stackoverflow.com/users/8859289/alonerebos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 881, "favorite_count": 0, "accepted_answer_id": 48454194, "answer_count": 1, "score": 0, "last_activity_date": 1516927076, "creation_date": 1516857124, "last_edit_date": 1516916364, "question_id": 48436052, "link": "https://stackoverflow.com/questions/48436052/structual-induction-in-haskell", "title": "Structual induction in Haskell", "body": "<p>Can anyone give me an example of Structural induction in Haskell? I can't find nothing online about it, I have been given a hypothesis but having trouble formulating the base case.</p>\n\n<p>The hypothesis is:\nFor all lists <code>xs</code> of type <code>[a]</code> and all <code>x</code> of type <code>a</code> it is:</p>\n\n<pre><code>toLast (x:xs) = xs |++| [x]\n</code></pre>\n\n<p>With <code>|++|</code> being my own version of concatenating two lists and <code>toLast</code> being a function where the header of a list goes to the end of the list. I have tried to figure this out myself and got <code>toLast [] = [] |++| []</code> but I am unsure if this is correct.</p>\n"}, {"tags": ["haskell", "routing", "yesod", "persistent", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1516864532, "creation_date": 1516864532, "answer_id": 48437486, "question_id": 48433695, "link": "https://stackoverflow.com/questions/48433695/how-can-i-use-a-field-from-my-persistent-model-as-a-path-piece-in-my-routes-file/48437486#48437486", "title": "How can I use a field from my Persistent model as a path piece in my routes file?", "body": "<p>The <code>OrganizationName</code> type is a constructor, because this is what is used in Persistent machinery like <code>selectList</code>. In reality, <code>name</code> is a parameter of the <code>Organization</code> constructor of type <code>Text</code>, so you just need <code>#Text</code> in your route.</p>\n"}], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 48437486, "answer_count": 1, "score": 2, "last_activity_date": 1516864532, "creation_date": 1516838977, "question_id": 48433695, "link": "https://stackoverflow.com/questions/48433695/how-can-i-use-a-field-from-my-persistent-model-as-a-path-piece-in-my-routes-file", "title": "How can I use a field from my Persistent model as a path piece in my routes file?", "body": "<p>I have a Persistent model like so:</p>\n\n<pre><code>Organization sql=organizations\n    Id UUID default=uuid_generate_v1mc\n    name Text\n    UniqueOrganizationName name\n    deriving Show Eq Typeable\n</code></pre>\n\n<p>I'd like to use the organization name in my Yesod <code>routes</code> file like so:</p>\n\n<pre><code>/#OrganizationName/onboarding/business/about OnboardingBusinessAboutR POST\n</code></pre>\n\n<p>Using <code>OrganizationName</code> or <code>UniqueOrganizationName</code> there gives me this error:</p>\n\n<pre><code>/Users/maximiliantagher/Documents/Mercury/hs/mercury-web-backend/src/Foundation.hs:41:1: error:\n    \u2022 Data constructor \u2018OrganizationName\u2019 cannot be used here\n        (Perhaps you intended to use TypeInType)\n    \u2022 In the type \u2018OrganizationName\u2019\n      In the definition of data constructor \u2018OnboardingBusinessAboutR\u2019\n      In the data instance declaration for \u2018Route\u2019\n</code></pre>\n\n<p>I could use a newtype as a workaround, just wondered if that was necessary.</p>\n\n<p>I imagine the lack of a <code>PathPiece</code> instance is a problem, but if it was just that then the error would be <code>No instance for (PathPiece ...)</code>.</p>\n\n<p>Using either <code>OrganizationName</code> or <code>UniqueOrganizationName</code> would be fine.</p>\n"}]