[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1561580661, "post_id": 56780324, "comment_id": 100115738, "body": "It&#39;s completely normal to use helper functions to define something"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561580776, "post_id": 56780324, "comment_id": 100115797, "body": "You are trying to write too much logic in a single function. It usually is better, software-design-wise to make small reusable components."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 6, "creation_date": 1561581079, "post_id": 56780324, "comment_id": 100115940, "body": "As a note totally unrelated to your question: that fits the modern usage of &quot;encoding&quot; more than &quot;encrypting&quot;. Encryption suggests that it&#39;s intended to obscure the original. Encoding merely means changing the representation. It also fits with the fact that the process you&#39;re implementing usually is called &quot;run-length encoding&quot;."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1561586366, "post_id": 56780324, "comment_id": 100117774, "body": "@Carl This is <i>almost</i> RLE, but with an &quot;optimization&quot; that makes it impossible to round-trip if the input string contains any numbers. You really need to convert <code>&quot;34&quot;</code> to <code>&quot;3141&quot;</code>, rather than <code>&quot;34&quot;</code>, if you want to handle all possible inputs."}], "answers": [{"comments": [{"owner": {"reputation": 301, "user_id": 2773933, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-wD8zUbBMBVI/AAAAAAAAAAI/AAAAAAAAIGs/njtrAvsaRVk/photo.jpg?sz=128", "display_name": "presci", "link": "https://stackoverflow.com/users/2773933/presci"}, "edited": false, "score": 0, "creation_date": 1561583831, "post_id": 56780555, "comment_id": 100117010, "body": "Thank you very much"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1561581582, "creation_date": 1561581582, "answer_id": 56780555, "question_id": 56780324, "link": "https://stackoverflow.com/questions/56780324/how-to-add-number-as-string-to-string-in-haskell/56780555#56780555", "title": "How to add number as string to string in haskell", "body": "<p>Sounds like you are trying to compress your first definition into a single function -- i.e. you just need to shuffle some working code around. Haskell is great at this.</p>\n\n<p>I would personally keep <code>gab1</code> separate, since it has a couple special cases.  Typically it would be written in curried form</p>\n\n<pre><code>gab1 :: Char -&gt; Int -&gt; String\ngab1 d 1 = [d]\ngab1 d 2 = [d,d]\ngad1 d x = [d] ++ show x\n</code></pre>\n\n<p>When <code>gab0</code> builds a <code>(Char,Int)</code> pair, the only thing it is ever used for is to be passed to <code>gab1</code> later.  So we can fuse that layer:</p>\n\n<pre><code>gab0 :: String -&gt; [String]\ngab0 = map (\\l@(x:_) -&gt; gab1 x (length l)) . group\n</code></pre>\n\n<p>Now, since we've moved the application of <code>gab1</code> to <code>gab0</code> (gosh these need some better names, huh?), <code>gab</code> has been reduced to:</p>\n\n<pre><code>gab :: [String] -&gt; String\ngab = foldr (\\x acc -&gt; x ++ acc) [] \n    = foldr (++) []\n    = concat\n</code></pre>\n\n<p>(I'm using chained <code>=</code> to indicate multiple reductions in a row -- in the real code you need to pick one, but they are all equivalent).</p>\n\n<p>Since <code>gab</code> is so simple, why don't we just do it as part of <code>gab0</code>?</p>\n\n<pre><code>gab0 :: String -&gt; String\ngab0 = concat . map (\\l@(x:_) -&gt; gab1 x (length l)) . group\n</code></pre>\n\n<p>We can move our <code>gab1</code> into a <code>where</code> clause since it is only used for a limited scope.  I'm going to rename it to <code>renderRun</code>, since it converts a \"run\" into a string.</p>\n\n<pre><code>gab0 :: String -&gt; String\ngab0 = concat . map (\\l@(x:_) -&gt; renderRun x (length l)) . group\n    where\n    renderRun d 1 = [d]\n    renderRun d 2 = [d,d]\n    renderRun d x = [d] ++ show x\n</code></pre>\n\n<p>Is that more to your liking?</p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 2, "last_activity_date": 1561581801, "creation_date": 1561581801, "answer_id": 56780604, "question_id": 56780324, "link": "https://stackoverflow.com/questions/56780324/how-to-add-number-as-string-to-string-in-haskell/56780604#56780604", "title": "How to add number as string to string in haskell", "body": "<p>You are almost there, the solution is fine, sub Tasks / sub Functions are healthy to programmers eyes, so, don't worry, you can create another extra function by compose them:</p>\n\n<pre><code>gab2 :: [(Char, Int)] -&gt; String\ngab2 = foldr(\\x acc -&gt;  gab1 x ++ acc) []\n\nfinalGab :: [Char] -&gt; String\nfinalGab = gab2 . gab0 \n</code></pre>\n"}], "owner": {"reputation": 301, "user_id": 2773933, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-wD8zUbBMBVI/AAAAAAAAAAI/AAAAAAAAIGs/njtrAvsaRVk/photo.jpg?sz=128", "display_name": "presci", "link": "https://stackoverflow.com/users/2773933/presci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 56780555, "answer_count": 2, "score": 3, "last_activity_date": 1561581801, "creation_date": 1561580502, "question_id": 56780324, "link": "https://stackoverflow.com/questions/56780324/how-to-add-number-as-string-to-string-in-haskell", "title": "How to add number as string to string in haskell", "body": "<p>I am trying to encrypt the string \"aaaabbccdeee\" gets converted into \"a4bbccde3\"</p>\n\n<p>I wasn't able to get it working in one function</p>\n\n<p>Working Solution 1:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List (group)\ngab0 :: [Char] -&gt; [(Char, Int)]\ngab0 = map(\\l@(x:xs) -&gt; (x, length l)) . group\n\ngab1 :: (Char, Int) -&gt; String\ngab1 (d, 1) = [d]\ngab1 (d, 2) = [d] ++ [d]\ngab1 (d, x) = [d] ++ show x\n\n\ngab :: [(Char, Int)] -&gt; String\ngab = foldr(\\x acc -&gt;  gab1 x ++ acc) [] \n\n{-\n - gab $ gab0 ['a', 'a', 'a', 'b', 'c', 'c','c','c','d','e','e']\n\"a3bc4de2\"\n-}\n\n</code></pre>\n\n<p>Solution 2 not working:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>gab2 :: [Char] -&gt; Int -&gt; [Char]\ngab2 [x] n \n    | n &gt; 1 = [x] ++ show n\n    | otherwise = [x]\ngab2 (x:y:xs) n\n    | x == y = gab2 (x:xs) (n + 1)\n    | otherwise = getnum x :  gab2 (y:xs) 0 \n    where getnum a = [a] ++ show n ++ []\n</code></pre>\n\n<p>\"aaaabbccdeee\" transformed to \"a4bbccde3\"</p>\n"}, {"tags": ["xml", "haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1561617516, "post_id": 56780542, "comment_id": 100124598, "body": "I don&#39;t really want to extract an <code>Element</code> from a <code>NodeComment</code>. I just want to leave it as is."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1561581501, "creation_date": 1561581501, "answer_id": 56780542, "question_id": 56779523, "link": "https://stackoverflow.com/questions/56779523/how-do-i-fold-nodes-of-an-xml-element-using-lens/56780542#56780542", "title": "How do I fold nodes of an XML element using lens?", "body": "<p>If <code>myFun</code> explains what you want to do with a <code>NodeElement</code> constructor, and you want an empty list for other <code>Node</code> constructors, you can use <code>concatMapOf _Element</code>.</p>\n\n<p>To provide a singleton list for other constructors, you should modify <code>myFun</code> to handle all constructors of <code>Node</code>.  Then you can use <code>concatMap myFun</code>, rather than <code>concatMapOf</code>.  (You could use <code>concatMapOf traverse myFun</code> in this case, but it's harder to understand.)</p>\n\n<p>There is no way to write <code>someLensMagic</code> that will generate the singleton list, because there is no way to extract an <code>Element</code> from a <code>NodeComment</code> (for example).</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1561581821, "creation_date": 1561581821, "answer_id": 56780607, "question_id": 56779523, "link": "https://stackoverflow.com/questions/56779523/how-do-i-fold-nodes-of-an-xml-element-using-lens/56780607#56780607", "title": "How do I fold nodes of an XML element using lens?", "body": "<p>One way of treating certain child nodes differently in a <code>Fold</code> it to use <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Getter.html#v:to\" rel=\"nofollow noreferrer\"><code>to</code></a> to put them in different branches of an <code>Either</code> according to the condition, and then use <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Traversal.html#v:beside\" rel=\"nofollow noreferrer\"><code>beside</code></a>, a function that lets you apply a different <code>Traversal</code> to each branch of the <code>Either</code>.</p>\n\n<p>For example, this function should return the child <code>Node</code>s of an <code>Element</code>, with the particularity that for nodes which satisfy the condition, their child nodes are returned instead:</p>\n\n<pre><code>foldDifferently :: (Node -&gt; Bool) -&gt; Fold Element Node\nfoldDifferently p =\n      nodes \n    . folded \n    . to (\\n -&gt; if p n then Right n else Left n) \n    . beside id (_Element . nodes . folded)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1561649415, "creation_date": 1561649415, "answer_id": 56794400, "question_id": 56779523, "link": "https://stackoverflow.com/questions/56779523/how-do-i-fold-nodes-of-an-xml-element-using-lens/56794400#56794400", "title": "How do I fold nodes of an XML element using lens?", "body": "<p>I've ended up with two consecutive <code>concatMap</code>s:</p>\n\n<pre><code>over nodes (concatMap $ concatMapOf _Element myFun) element\n</code></pre>\n\n<p>It is suboptimal solution, so I ain't marking it as answer and welcome any other suggestions.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1561899267, "last_edit_date": 1561899267, "creation_date": 1561881747, "answer_id": 56823319, "question_id": 56779523, "link": "https://stackoverflow.com/questions/56779523/how-do-i-fold-nodes-of-an-xml-element-using-lens/56823319#56823319", "title": "How do I fold nodes of an XML element using lens?", "body": "\n\n<p>The most straighforward solution is, <a href=\"https://stackoverflow.com/a/56780542/2751851\">much like bergey suggests</a>, writing a wrapper around <code>myFun</code> so that it can handle <code>Node</code>s rather than <code>Element</code>s:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>myFun' :: Node -&gt; [Node]\nmyFun' n = case n of\n    NodeElement el -&gt; myFun el\n    _ -&gt; [n]\n</code></pre>\n\n<p><code>myFun'</code> can then be used with plain <code>concatMap</code> (as opposed to <code>concatMapOf</code>) to modify the <code>nodes</code> field:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>over nodes (concatMap myFun')\n</code></pre>\n\n<p>As it happens, there is a piece of <em>lens</em> magic that can be used as an alternative way of writing the wrapper. The <a href=\"http://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Prism.html#v:outside\" rel=\"nofollow noreferrer\"><code>outside</code></a> combinator turns a prism into a lens that targets a function, allowing us to, in effect, edit what a function does in a specific case. In practice, it looks like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>over nodes (concatMap $ set (outside _Element) myFun (:[]))\n</code></pre>\n\n<p>The argument to <code>concatMap</code> is a function that behaves like <code>(:[])</code> except if the argument matches <code>_Element</code>, in which case it becomes <code>myFun</code> on the underlying element. That is, in essence, abstracted pattern matching. To drive the point home, we can try imitating the style of definition of <code>myFun'</code> above using <code>outside</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>myFun' :: Node -&gt; [Node]\nmyFun'\n    = outside _Element .~ myFun\n    $ \\n -&gt; [n]\n</code></pre>\n"}], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 56823319, "answer_count": 4, "score": 1, "last_activity_date": 1572924828, "creation_date": 1561575872, "last_edit_date": 1572924828, "question_id": 56779523, "link": "https://stackoverflow.com/questions/56779523/how-do-i-fold-nodes-of-an-xml-element-using-lens", "title": "How do I fold nodes of an XML element using lens?", "body": "<p>I'm using <a href=\"https://hackage.haskell.org/package/xml-lens\" rel=\"nofollow noreferrer\">xml-lens</a> package to process XML.</p>\n\n<p>Given an <a href=\"https://hackage.haskell.org/package/xml-lens-0.1.6.3/docs/Text-XML-Lens.html#t:Element\" rel=\"nofollow noreferrer\"><code>Element</code></a>, I want to perform <code>concatMap</code>-like computation on its <code>elementNode :: [Node]</code> field. Specifically, a <code>NodeElement</code> satisfying some condition should produce some more <code>NodeElement</code>s, and all other cases (the rest of <code>NodeElement</code>s and other <code>Node</code> constructors) should produce a singleton list. It then should get concatenated into <code>[Node]</code> and used as a value to overwrite current <code>elementNode</code> of a given <code>Element</code>.</p>\n\n<p>I'm struggling to write proper lens incantation to do that. Here's what I managed to come up with so far:</p>\n\n<pre><code>over nodes $ concatMapOf someLensMagic (myFun :: Element -&gt; [Node])\n</code></pre>\n\n<p>It typechecks, but I'm failing to implement <code>someLensMagic</code>. Help with that would be really appreciated.</p>\n"}, {"tags": ["haskell", "type-systems", "gadt", "data-kinds", "phantom-types"], "comments": [{"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 1, "creation_date": 1561569351, "post_id": 56777941, "comment_id": 100111205, "body": "See <a href=\"https://stackoverflow.com/questions/20558648/what-is-the-datakinds-extension-of-haskell\">What is the DataKinds extension of Haskell?</a> for precisely this example."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561632974, "post_id": 56778310, "comment_id": 100133154, "body": "thanks; just noticed another one: <code>Proxy</code> in <code>class Nat (n :: N) where   toInt :: proxy n -&gt; Int</code>..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1561633686, "post_id": 56778310, "comment_id": 100133564, "body": "@WillNess No, that&#39;s actually a standard idiom (which I don&#39;t like, but I conform to). Using the type variable <code>proxy</code> instead of the type <code>Proxy</code> allows for other proxy types as well. It is often used in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Proxy.html#v:asProxyTypeOf\" rel=\"nofollow noreferrer\">libraries</a>"}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1561697765, "post_id": 56778310, "comment_id": 100156570, "body": "@chi, I am confused, but your first example is not compilable. The second one is wrong: firstly you slightly changed condition. <code>Succ</code> is not value constructor as you written, but must be a type constructor. And real error of 2st example is <code>&gt;:3:12: error:     Not in scope: type constructor or class &#39;Succ&#39;</code>     <code>A data constructor of that name is in scope; did you mean DataKinds?</code>"}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1561698237, "post_id": 56778310, "comment_id": 100156669, "body": "I mean for 2nd sample: <code>Main&gt; type Foo = Succ Int</code>  <code>&lt;interactive&gt;:3:12: error:</code> <code>Not in scope: type constructor or class &#39;Succ&#39;</code> <code>A data constructor of that name is in scope; did you mean DataKinds?</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 1, "creation_date": 1561706671, "post_id": 56778310, "comment_id": 100159569, "body": "@Vladimir You did not copy all my code in a Haskell, including the line which enables <code>DataKinds</code>"}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1561714831, "post_id": 56778310, "comment_id": 100163199, "body": "I&#39;ve copypasted 1st your sample and have got:  C:_TMP\\Haskell\\tmp&gt;ghci ans1.hs GHCi, version 8.6.5: [1 of 1] Compiling Main             ( ans1.hs, interpreted )  ans1.hs:18:37: error:     * Expected a type, but <code>n&#39; has kind </code>N&#39;     * In an expression type signature: n       In the first argument of <code>toInt&#39;, namely </code>(undefined :: n)&#39;       In the second argument of <code>(+)&#39;, namely </code>toInt (undefined :: n)&#39;    | 18 |   toInt _ = 1 + toInt (undefined :: n)    |                                     ^ Failed, no modules loaded."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1561715721, "post_id": 56778310, "comment_id": 100163641, "body": "Second example works as you described if I&#39;ve put <code>type Foo = Succ Int</code> in code file (not in ghci as I did before). But role of <code>Succ</code> in your code is not clear for me yet :("}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1561717617, "post_id": 56778310, "comment_id": 100164546, "body": "@Vladimir I indeed forgot <code>(undefined :: Proxy n)</code> in my first snippet, sorry. It should be fixed now. About <code>Succ</code>: it plays the same role as in your question. <code>Succ Int</code> is an error, since <code>Succ</code> wants a number in <code>N</code>, and not a type -- this is what you wanted, right? So you can only use <code>Succ Zero, Succ (Succ Zero), ...</code>."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 1, "creation_date": 1561719163, "post_id": 56778310, "comment_id": 100165192, "body": "In my code (conditions, if you want) <code>Succ</code> is type constructor, but in your code <code>Succ</code> looks like data (value) constructor. It confuses me... Perhaps, it is  a form of <code>DataKinds</code> magic?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 1, "creation_date": 1561722992, "post_id": 56778310, "comment_id": 100166888, "body": "@Vladimir Yes, that&#39;s <code>DataKinds</code> in action. With that extension, term-level constructors like <code>Zero, Succ</code> in my code get &quot;lifted&quot; at the type level. So you can use them as usual in values, but you can also use them in types. The notation <code>class Nat (n : N)</code> indicates that <code>Nat</code> is not a class of types (we can&#39;t use <code>Nat Bool</code>) but a class of <code>N</code> (we can use <code>Nat Zero</code>), so it refers to the lifted values. So we have <code>Int, Maybe Int, [Int] :: *</code> as plain types, and <code>Zero, Succ Zero, ... :: N</code> as &quot;numbers at the type level&quot;. Here <code>*</code> and <code>N</code> are called &quot;kinds&quot; (a sort of &quot;type of a type&quot;)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1561717422, "last_edit_date": 1561717422, "creation_date": 1561570483, "answer_id": 56778310, "question_id": 56777941, "link": "https://stackoverflow.com/questions/56777941/type-restriction-in-type-declaration/56778310#56778310", "title": "Type restriction in type declaration", "body": "<p>Nowadays, we use the <code>DataKinds</code> extension:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, ScopedTypeVariables #-}\n\n-- N is a type, but is also a kind now\n-- Zero, Succ Zero, ... are values, but are also type-level values of\n-- kind N\ndata N = Zero | Succ N\n\n-- (We could import Proxy the library, instead)\ndata Proxy (n :: N) = Proxy\n\n-- Now n is restricted to kind N\nclass Nat (n :: N) where\n  toInt :: proxy n -&gt; Int\n\ninstance Nat Zero where\n  toInt _ = 0\ninstance (Nat n) =&gt; Nat (Succ n) where\n  toInt _ = 1 + toInt (undefined :: Proxy n)\n</code></pre>\n\n<p>We can then use <code>toInt (Proxy :: Proxy (Succ Zero))</code>. Instead, <code>toInt (Proxy :: Proxy (Succ Int))</code> will raise a kind error, as wanted.</p>\n\n<p>Personally, I would also replace proxies with more modern stuff like <code>AllowAmbiguousTypes</code> and <code>TypeApplications</code> so to remove the unused argument.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, ScopedTypeVariables,\n             AllowAmbiguousTypes, TypeApplications #-}\n\ndata N = Zero | Succ N\n\n-- Now n is restricted to kind N\nclass Nat (n :: N) where\n  toInt :: Int\n\ninstance Nat Zero where\n  toInt = 0\ninstance (Nat n) =&gt; Nat (Succ n) where\n  toInt = 1 + toInt @n\n</code></pre>\n\n<p>Use this as <code>toInt @(Succ Zero)</code>. The <code>toInt @n</code> syntax chooses the <code>n</code> in the typeclass. It does not correspond to any value exchanged at runtime, only a type-level argument which exists at compile time.</p>\n\n<hr>\n\n<p>Using</p>\n\n<pre><code>type Foo = Succ Int\n</code></pre>\n\n<p>also errors out as wanted:</p>\n\n<pre><code>    \u2022 Expected kind \u2018N\u2019, but \u2018Int\u2019 has kind \u2018*\u2019\n    \u2022 In the first argument of \u2018Succ\u2019, namely \u2018Int\u2019\n      In the type \u2018Succ Int\u2019\n      In the type declaration for \u2018Foo\u2019\n</code></pre>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 56778310, "answer_count": 1, "score": 3, "last_activity_date": 1561719839, "creation_date": 1561568934, "last_edit_date": 1561719839, "question_id": 56777941, "link": "https://stackoverflow.com/questions/56777941/type-restriction-in-type-declaration", "title": "Type restriction in type declaration", "body": "<p>There is famous example of the type level natural numbers:</p>\n\n<pre><code>data Zero\ndata Succ n\n</code></pre>\n\n<p>I have a question about desirable restriction when we applying type constructor <code>Succ</code>. For example, if we want to make such restriction in function definition, we can use the class and context, like in this code:</p>\n\n<pre><code>class Nat n where\n  toInt :: n -&gt; Int\ninstance Nat Zero where\n  toInt _ = 0\ninstance (Nat n) =&gt; Nat (Succ n) where\n  toInt _ = 1 + toInt (undefined :: n)\n</code></pre>\n\n<p>It's impossible to use <code>toInt (undefined :: Succ Int)</code>, it's ok.</p>\n\n<p>But how to realize similar restrictions on type level constructions (perhaps with some advanced type extensions)?</p>\n\n<p>For instance, I'd like to permit using of type constructor <code>Succ</code> only with type <code>Zero</code> and with something, like this: <code>Succ (Succ Zero)</code>, <code>Succ (Succ (Succ Zero))</code> and so on.\nHow to avoid such bad example on compile time:</p>\n\n<pre><code>type Test = Succ Int\n</code></pre>\n\n<p>(for now, there is no compilation error)</p>\n\n<p>P.S.: It is more interesting for me how to create a restriction on the type declaration of the last sample</p>\n"}, {"tags": ["multithreading", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1561558543, "post_id": 56774929, "comment_id": 100105299, "body": "Exactly why do you want to use an <code>MVar</code> here? It looks like a <code>State</code> is more appropriate?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1561558699, "post_id": 56774929, "comment_id": 100105406, "body": "<code>let rest = io action</code> does not run the action, use <code>rest &lt;- io action</code> instead. Also reading and then swapping an <code>MVar</code> is not a thread-safe approach. Here you only have one, so it might be ok, but..."}, {"owner": {"reputation": 55, "user_id": 7722311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cd990772a41631e0b2287dbf8c1363f?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigo ferreira", "link": "https://stackoverflow.com/users/7722311/rodrigo-ferreira"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561559270, "post_id": 56774929, "comment_id": 100105784, "body": "@WillemVanOnsem i was thinking that damage function would change the value of lifepoints and then signal to healing function to start working. MVar would make so that one function waits for antother"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1561559364, "post_id": 56774929, "comment_id": 100105845, "body": "Definitely don&#39;t read and swap the <code>MVar</code>; that doesn&#39;t make any sense. I would strongly suggest that you not fiddle with the <code>MVar</code> in <code>damageCalculation</code>; either make that pure or use <code>IO</code> in it to get the RNG."}, {"owner": {"reputation": 55, "user_id": 7722311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cd990772a41631e0b2287dbf8c1363f?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigo ferreira", "link": "https://stackoverflow.com/users/7722311/rodrigo-ferreira"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1561559420, "post_id": 56774929, "comment_id": 100105879, "body": "@chi ok, but what about the other questions?"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1561566677, "post_id": 56774929, "comment_id": 100110058, "body": "One question at a time. Thanks. :)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1561668633, "post_id": 56794596, "comment_id": 100151186, "body": "You&#39;d better force the value before installing it in the <code>MVar</code>. There&#39;s a function for modifying <code>MVar</code>s (strictly or not) that I believe takes care of exceptions too."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1561650198, "creation_date": 1561650198, "answer_id": 56794596, "question_id": 56774929, "link": "https://stackoverflow.com/questions/56774929/is-there-a-way-to-make-this-text-game-in-haskell-using-mvar/56794596#56794596", "title": "Is there a way to make this text game in haskell using MVar?", "body": "<p>There are a number of problems with your code before it'll even compile:</p>\n\n<ul>\n<li><code>damageCalculation</code> tries to use <code>life</code> as both an <code>MVar Integer</code> (i.e., a \"token\" for a storage location containing an Integer) and the <code>Integer</code> value itself</li>\n<li>you've provided only one argument to <code>swapMVar</code> where it expects two</li>\n<li>you've mixed <code>Int</code> and <code>Integer</code> types</li>\n<li>in <code>main</code>, you've treated <code>damageCalculation</code> as a pure function instead of an I/O action</li>\n</ul>\n\n<p>Fixing all of these bugs will allow the program to type-check (see Listing #1 below).</p>\n\n<p>However, there are still a number bugs.  <strong>First,</strong> the code:</p>\n\n<pre><code>a &lt;- readMVar life\nlet newLife = a - randDano\na &lt;- swapMVar life newLife\n</code></pre>\n\n<p>is subject to a race condition if multiple threads are trying to update the damage.  The first line reads the value of the MVar but doesn't perform any kind of locking or synchronization, and the third line then unconditionally writes the new life (while grabbing a copy of the old value).</p>\n\n<p>For example, if two threads try to deduct 10 points of damage each in the following, interleaved fashion, you'll run into a problem:</p>\n\n<pre><code>Thread 1                   Thread 2\n--------                   --------\na &lt;- readMVar life                                     -- fetch 100 life\n                           a &lt;- readMVar life          -- fetch 100 life again\nlet newLife = ...                                      -- deduct 10 to get 90\na &lt;- swapMVar life newLife                             -- save 90 in the MVar\n                           let newLife = ...           -- deduct 10 to get 90\n                           a &lt;- swapMVar life newLife  -- save 90 in the MVar\n</code></pre>\n\n<p>Instead, you want to use the pair of functions <code>takeMVar</code> and <code>putMVar</code> which are designed to provide automatic synchronization:</p>\n\n<pre><code>Thread 1                   Thread 2\n--------                   --------\na &lt;- takeMVar life                                     -- fetch 100 life\n                           a &lt;- takeMVar life          -- nothing there, so block...\nlet newLife = ...          -- BLOCKING                 -- deduct 10 to get 90\na &lt;- putMVar life newLife  -- BLOCKING                 -- save 90 in the MVar\n                           -- WAKE UP                  -- fetch 90 from MVar\n                           let newLife = ...           -- deduct 10 to get 80\n                           a &lt;- putMVar life newLife   -- save 80 in the MVar\n</code></pre>\n\n<p>In <a href=\"https://stackoverflow.com/a/56744984/7203016\">my answer to your other question</a>, I had recommended using <code>readMVar</code> and <code>swapMVar</code>, but if you look at that code, you can see that the situation was very different -- one thread only needed to read the current value of the MVar (e.g., reading <code>wHeld</code> to see if \"W\" was being pressed), and <em>another</em> thread needed to unconditionally write a new value (e.g., writing <code>wHeld</code> to update the current state of the \"W\" key).  No locking was needed, because you just had two threads, one always writing, and one always reading whatever was most recently written.</p>\n\n<p>The <strong>second</strong> problem with <code>damageCalculation</code> is that I think you want to return the final life value, but you're returning the result of the <code>swapMVar</code> call which will be the <em>old</em> life value before deducting damage.  In other words, you probably want <code>return newLife</code> as the last line of your do-block.</p>\n\n<p>The <strong>third</strong> problem is the way you're using your <code>StdGen</code>.  When you write:</p>\n\n<pre><code>let (randDano, newGen) = randomR (15,30) gen :: (Int, StdGen)\n</code></pre>\n\n<p>the value of <code>gen</code> is used to create a random <code>randDano</code> value, and then an updated value for the generator <code>newGen</code> is returned.  If you toss this <code>newGen</code> away and try reusing <code>gen</code> again, you'll always generate the same <code>randDano</code> value.  You can either make <code>newGen</code> part of the return value of <code>damageCalculation</code> and use it for the next call, or you can make the generator itself an MVar that gets updated by the <code>damageCalculation</code> function.  Since you want practice using MVars, the latter seems like the way to go.  So, your <code>damageCalculation</code> function should look like:</p>\n\n<pre><code>damageCalculation :: MVar StdGen -&gt; MVar Int -&gt; IO Int\ndamageCalculation v_gen v_life = do\n    gen &lt;- takeMVar v_gen\n    let (randDano, gen') = randomR (15,30) gen\n    putMVar v_gen gen'\n    life &lt;- takeMVar v_life\n    let life' = life - randDano\n    putMVar v_life life'\n    return life'\n</code></pre>\n\n<p>Note the use of the <code>takeMVar</code> / modify value / <code>putMVar</code> pattern.</p>\n\n<p>In the <code>main</code> function, you probably want to create all the relevant MVars up front before forking, so something like:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    putStrLn \"Welcome to Hunter of Monsters\"\n    putStrLn \"Whats your name?\"\n    l &lt;- getLine\n    putStrLn \"Character\"\n    putStrLn (\"Name: \" ++ l)\n\n    gen &lt;- getStdGen\n    v_gen &lt;- newMVar gen\n\n    putStrLn $ \"Life Points: \" ++ show lifePoints\n    v_life &lt;- newMVar lifePoints\n\n    done &lt;- newEmptyMVar\n\n    putStrLn \"The hunt begins\"\n\n    -- damage stuff here --\n\n    takeMVar done\n    putStrLn \"Game over!\"\n</code></pre>\n\n<p>For the damage calculation, if you want to keep doing damage until the life points run out, define a looping function like so and then <code>forkIO</code> it:</p>\n\n<pre><code>let doDamage = do\n    putStrLn \"Damage calculation\"\n    rest &lt;- damageCalculation v_gen v_life\n    putStrLn $ \" \" ++ show rest\n    if rest &gt; 0\n        then doDamage\n        else putMVar done ()\nforkIO doDamage\n</code></pre>\n\n<p>The full program is in Listing #2 below.</p>\n\n<h3>Listing #1: Getting the program to type-check</h3>\n\n<pre><code>import Control.Concurrent\nimport System.Random\n\nlifePoints :: Int    -- use Int throughout\nlifePoints = 100\n\ndamageCalculation :: StdGen -&gt; MVar Int -&gt; IO Int   -- use Int throughout\ndamageCalculation gen life = do\n    let (randDano, newGen) = randomR (15,30) gen :: (Int, StdGen)\n    a &lt;- readMVar life\n    let newLife = a - randDano   -- Use \"a\" (the value), not \"life\" (the MVar)\n    a &lt;- swapMVar life newLife   -- \"swapMVar\" needs an MVar (\"life\"), not just a value\n    return a\n\nmain :: IO ()\nmain = do\n    putStr \"Welcome to Hunter of Monsters\\n\"\n    putStr \"Whats your name? \\n\"\n    l &lt;- getLine\n    putStr \"Character\\n\"\n    putStrLn (\"Name: \" ++ l)\n    let life = lifePoints\n    putStrLn $ \"Life Points: \" ++ show life\n\n    putStr \"The hunt begins\\n\"\n    a &lt;- newEmptyMVar\n    forkIO $ do\n        putStr \"Damage calculation\\n\"\n        lifeMVar &lt;- newMVar life\n        gen &lt;- getStdGen\n        rest &lt;- damageCalculation gen lifeMVar   -- IO action, so use '&lt;-' not 'let'\n        putStrLn $ \" \" ++ show rest\n        putMVar a ()\n    takeMVar a\n    putStrLn \"Game over!\"\n</code></pre>\n\n<h3>Listing #2: Final program with a damage loop</h3>\n\n<pre><code>import Control.Concurrent\nimport System.Random\n\nlifePoints :: Int\nlifePoints = 100\n\ndamageCalculation :: MVar StdGen -&gt; MVar Int -&gt; IO Int\ndamageCalculation v_gen v_life = do\n    gen &lt;- takeMVar v_gen\n    let (randDano, gen') = randomR (15,30) gen\n    putMVar v_gen gen'\n    life &lt;- takeMVar v_life\n    let life' = life - randDano\n    putMVar v_life life'\n    return life'\n\nmain :: IO ()\nmain = do\n    putStrLn \"Welcome to Hunter of Monsters\"\n    putStrLn \"Whats your name?\"\n    l &lt;- getLine\n    putStrLn \"Character\"\n    putStrLn (\"Name: \" ++ l)\n\n    gen &lt;- getStdGen\n    v_gen &lt;- newMVar gen\n\n    putStrLn $ \"Life Points: \" ++ show lifePoints\n    v_life &lt;- newMVar lifePoints\n\n    done &lt;- newEmptyMVar\n\n    putStrLn \"The hunt begins\"\n\n    let doDamage = do\n        putStrLn \"Damage calculation\"\n        rest &lt;- damageCalculation v_gen v_life\n        putStrLn $ \" \" ++ show rest\n        if rest &gt; 0\n            then doDamage\n            else putMVar done ()\n    forkIO doDamage\n\n    takeMVar done\n    putStrLn \"Game over!\"\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 7722311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cd990772a41631e0b2287dbf8c1363f?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigo ferreira", "link": "https://stackoverflow.com/users/7722311/rodrigo-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561650198, "creation_date": 1561558497, "question_id": 56774929, "link": "https://stackoverflow.com/questions/56774929/is-there-a-way-to-make-this-text-game-in-haskell-using-mvar", "title": "Is there a way to make this text game in haskell using MVar?", "body": "<p>Im trying to learn MVar and i'm trying to make this text game that is:</p>\n\n<p>The hunt begins at 100 life points and level 1 then</p>\n\n<p>1.One function would do damage to life points in a range of (15,30)\n2.Another function would heal life points in a range of (5,10)\n3.Adds one level because the player survived\n4.Repeats until life point reachs 0</p>\n\n<p>Life points would be a MVar Integer so one function has to wait for the other to finish to change its value (synchronized mutable variable)</p>\n\n<p>I want to repeat theses 2 functions until life points reaches 0 and then shows the level the player reached</p>\n\n<p>This is what i got so far:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad\nimport Data.Char\nimport Control.Concurrent\nimport System.Random\n\nlifePoints :: Integer\nlifePoints = 100\n\ndamageCalculation :: StdGen -&gt; MVar Integer -&gt; IO Int\ndamageCalculation gen life = do\n    let (randDano, newGen) = randomR (15,30) gen :: (Int, StdGen)\n    a &lt;- readMVar life\n    let newLife = life - randDano\n    a &lt;- swapMVar newLife\n    return a\n\n\nmain :: IO ()\nmain = do\n    putStr \"Welcome to Hunter of Monsters\\n\"\n    putStr \"Whats your name? \\n\"\n    l &lt;- getLine\n    putStr \"Character\\n\"\n    putStrLn (\"Name: \" ++ l) \n    let life = lifePoints \n    putStrLn $ \"Life Points: \" ++ show life\n\n\n    putStr \"The hunt begins\\n\"\n    a &lt;- newEmptyMVar \n    forkIO $ do \n        putStr \"Damage calculation\\n\"\n        lifeMVar &lt;- newMVar life\n        gen &lt;- getStdGen\n        let rest = damageCalculation gen lifeMVar\n        putStrLn $ \" \" ++ show rest\n        putMVar a ()\n    takeMVar a\n    putStrLn \"Game over!\"\n</code></pre>\n\n<p>Im having trouble getting a new random number, just repeats one value.\nThe damage function is simple but i get error trying to change the value of life.\nAlso how can i repeat these functions until life points reachs 0?\nDoes the player level needs to be a MVar as well?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1561552235, "post_id": 56771695, "comment_id": 100101177, "body": "Type families are not injective, e.g. it might happen that <code>F Int = F Bool = String</code>. So instance selection can become ambiguous: if you need <code>GWeave (Rep e1)...</code> and you know <code>forall ...(...=&gt; GWeave (Rep e2) ...)</code>, you can deduce you want <code>Rep e2 = Rep e1</code>, but this is not enough to imply <code>e2=e1</code>. Newtypes are instead injective."}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1561555881, "post_id": 56771695, "comment_id": 100103537, "body": "Thanks, that makes sense. It&#39;s something I&#39;m aware of, but not the in the heat of the moment. I&#39;ll see if I can submit a bug report to get a better error. It would be very helpful if GHC said &quot;BTW RepK isn&#39;t injective so I&#39;m stuck&quot;"}], "tags": [], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "is_accepted": false, "score": 2, "last_activity_date": 1561548257, "creation_date": 1561548257, "answer_id": 56771695, "question_id": 56771446, "link": "https://stackoverflow.com/questions/56771446/ghc-cannot-deduce-an-instance-exists-despite-being-mentioned-in-a-quantified-con/56771695#56771695", "title": "GHC cannot deduce an instance exists despite being mentioned in a quantified constraint", "body": "<p>Ok, I found the solution - I have to package up <code>RepK</code> into a newtype:</p>\n\n<pre><code>weaveFromTo\n  :: forall m n e a code.\n     ( GenericK e ( n :&amp;&amp;: a :&amp;&amp;: LoT0 )\n     , GenericK e ( m :&amp;&amp;: a :&amp;&amp;: LoT0 )\n     , GWeave ( WrappedRepK e ) m n ( LoT2 m a ) ( LoT2 n a )\n     )\n  =&gt; ( forall x. m x -&gt; n x ) -&gt; HigherOrder e m a -&gt; HigherOrder e n a\nweaveFromTo eta ( HigherOrder a ) =\n    HigherOrder ( toK ( unWrapRepK ( gweave @_ @m @n @( LoT2 m a ) @( LoT2 n a ) eta ( WrapRepK @e ( fromK a ) ) ) ) )\n\nclass GWeave f ( m :: * -&gt; * ) ( n :: * -&gt; * ) as bs where\n  gweave :: ( forall x. m x -&gt; n x ) -&gt; f as -&gt; f bs\n\ninstance GWeave ( RepK e ) m n ( LoT2 m a ) ( LoT2 n a ) =&gt; GWeave ( WrappedRepK e ) m n ( LoT2 m a ) ( LoT2 n a ) where\n  gweave eta ( WrapRepK a ) =\n    WrapRepK ( gweave eta a )\n\n\ninstance\n  ( forall n a. GenericK e ( LoT2 n a )\n  , forall m n a. GWeave ( WrappedRepK e ) m n ( m :&amp;&amp;: a :&amp;&amp;: LoT0 ) ( n :&amp;&amp;: a :&amp;&amp;: LoT0 )\n  ) =&gt; Effect ( HigherOrder e ) where\n  weave eta =\n    weaveFromTo eta\n\nnewtype WrappedRepK r a =\n  WrapRepK { unWrapRepK :: RepK r a }\n</code></pre>\n\n<p>I think it's because <code>RepK</code> is a type family, so... something goes screwy? I'd love to know more about why this fix works.</p>\n"}, {"tags": [], "owner": {"reputation": 1950, "user_id": 1236540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36629077f587c35a2e46680e74259012?s=128&d=identicon&r=PG", "display_name": "serras", "link": "https://stackoverflow.com/users/1236540/serras"}, "is_accepted": true, "score": 5, "last_activity_date": 1561574082, "creation_date": 1561574082, "answer_id": 56779129, "question_id": 56771446, "link": "https://stackoverflow.com/questions/56771446/ghc-cannot-deduce-an-instance-exists-despite-being-mentioned-in-a-quantified-con/56779129#56779129", "title": "GHC cannot deduce an instance exists despite being mentioned in a quantified constraint", "body": "<p>You don't need to use a <code>newtype</code>, just moving the type family application <code>RepK e</code> outside of the quantification makes it work (the change is in the line marked as <code>(!)</code>):</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>instance\n  ( forall n a. GenericK e ( LoT2 n a )\n  , r ~ ( RepK e )  -- (!)\n  , forall m n a. GWeave r m n ( LoT2 m a ) ( LoT2 n a )\n  ) =&gt; Effect ( HigherOrder e ) where\n  weave eta =\n    weaveFromTo eta\n</code></pre>\n\n<p>This is because, by design, instances in Haskell cannot use type families. That is, you cannot write an instance that looks like:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>instance Eq (RepK e) where ...\n</code></pre>\n\n<p>Quantified constraints inherit that restriction, since they introduce sort of \"local instances\". You can find more information in the <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/14860\" rel=\"noreferrer\">GHC tracker</a> and in this <a href=\"https://www.reddit.com/r/haskell/comments/8vsnnb/quantified_constraints_type_families/\" rel=\"noreferrer\">Reddit thread</a>.</p>\n\n<p>As an extra piece of advice, everytime you use <code>RepK e</code> in <code>kind-generics</code>, always give it an explicit name outside of any quantification. Otherwise you end up with weird errors like the one you got.</p>\n"}], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 56779129, "answer_count": 2, "score": 2, "last_activity_date": 1561574082, "creation_date": 1561547334, "question_id": 56771446, "link": "https://stackoverflow.com/questions/56771446/ghc-cannot-deduce-an-instance-exists-despite-being-mentioned-in-a-quantified-con", "title": "GHC cannot deduce an instance exists despite being mentioned in a quantified constraint", "body": "<p>I have the following program:</p>\n\n<pre><code>{-# language MultiParamTypeClasses #-}\n{-# language PolyKinds #-}\n{-# language QuantifiedConstraints #-}\n{-# language RankNTypes #-}\n{-# language ScopedTypeVariables #-}\n{-# language TypeApplications #-}\n{-# language UndecidableInstances #-}\n\nmodule Control.IO.GWeave where\n\nimport Generics.Kind\n\n\nnewtype HigherOrder e m a =\n  HigherOrder ( e m a )\n\n\nweaveFromTo\n  :: forall m n e a code.\n     ( GenericK e ( LoT2 n a )\n     , GenericK e ( LoT2 m a )\n     , GWeave ( RepK e ) m n ( LoT2 m a ) ( LoT2 n a )\n     )\n  =&gt; ( forall x. m x -&gt; n x ) -&gt; HigherOrder e m a -&gt; HigherOrder e n a\nweaveFromTo eta ( HigherOrder a ) =\n    HigherOrder ( toK ( gweave @_ @m @n @( LoT2 m a ) @( LoT2 n a ) eta ( fromK a ) ) )\n\nclass GWeave f ( m :: * -&gt; * ) ( n :: * -&gt; * ) as bs where\n  gweave :: ( forall x. m x -&gt; n x ) -&gt; f as -&gt; f bs\n\nclass Effect e where\n  weave :: ( forall x. m x -&gt; n x ) -&gt; e m a -&gt; e n a\n\ninstance\n  ( forall n a. GenericK e ( LoT2 n a )\n  , forall m n a. GWeave ( RepK e ) m n ( LoT2 m a ) ( LoT2 n a )\n  ) =&gt; Effect ( HigherOrder e ) where\n  weave eta =\n    weaveFromTo eta\n</code></pre>\n\n<p>In this, I have <code>class Effect e where weave = ...</code>. I want to use <code>DerivingVia</code> to provide instances of <code>Effect</code> for any data type that is an instance of <code>GenericK</code> (from the <code>kind-generics</code> library on Hackage). This is perfectly doable, and <code>weaveFromTo</code> is the bulk of the work. The last step is to simply say <code>instance Effect (HigherOrder e) where weave f = weaveFromTo f</code>. However, GHC seems to refuse to accept this, even if I add the necessary constraints onto the instance declaration for <code>Effect (HigherOrder e)</code>:</p>\n\n<pre><code>\u2022 Could not deduce (GWeave (RepK e) m n (LoT2 m a) (LoT2 n a))\n  from the context: (forall (n :: * -&gt; *) (a :: k).\n                     GenericK e (LoT2 n a),\n                     forall (m :: * -&gt; *) (n :: * -&gt; *) (a :: k).\n                     GWeave (RepK e) m n (LoT2 m a) (LoT2 n a))\n    bound by an instance declaration:\n               forall k (e :: (* -&gt; *) -&gt; k -&gt; *).\n               (forall (n :: * -&gt; *) (a :: k). GenericK e (LoT2 n a),\n                forall (m :: * -&gt; *) (n :: * -&gt; *) (a :: k).\n                GWeave (RepK e) m n (LoT2 m a) (LoT2 n a)) =&gt;\n               Effect (HigherOrder e)\n</code></pre>\n\n<p>I'm unable to work out why GHC is unhappy. Can anyone see the problem? The code above should work provided you have <code>kind-generics</code> installed.</p>\n"}, {"tags": ["haskell", "package", "stackage"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561500160, "post_id": 56762584, "comment_id": 100082326, "body": "A package defines a set of modules, you can look up the modules, for example in <a href=\"https://hackage.haskell.org/package/prettyprinter-1.3.0/docs/Data-Text-Prettyprint-Doc.html\" rel=\"nofollow noreferrer\">hackage</a>. Here the module you probably want to import is <code>import Data.Text.Prettyprint.Doc</code>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1561507919, "post_id": 56762584, "comment_id": 100083906, "body": "Also, <a href=\"https://lexi-lambda.github.io/blog/2018/02/10/an-opinionated-guide-to-haskell-in-2018/#understanding-stacks-model-and-avoiding-its-biggest-gotcha\" rel=\"nofollow noreferrer\">you shouldn&#39;t normally use <code>stack install</code> for libraries</a>. Use <code>stack build</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 2227966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1471a2a4abd39213b3cd2b6296b120d1?s=128&d=identicon&r=PG", "display_name": "Kevin Bradner", "link": "https://stackoverflow.com/users/2227966/kevin-bradner"}, "is_accepted": false, "score": 3, "last_activity_date": 1562630091, "last_edit_date": 1562630091, "creation_date": 1561502489, "answer_id": 56762909, "question_id": 56762584, "link": "https://stackoverflow.com/questions/56762584/how-do-i-import-a-package-i-have-installed-from-stackage/56762909#56762909", "title": "How do I import a package I have installed from stackage?", "body": "<p>Thanks to Willem Van Onsem for pointing out that I need to be importing modules, not packages. In this case, <code>import Data.Text.Prettyprint.Doc</code> was the appropriate choice.</p>\n"}], "owner": {"reputation": 436, "user_id": 2227966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1471a2a4abd39213b3cd2b6296b120d1?s=128&d=identicon&r=PG", "display_name": "Kevin Bradner", "link": "https://stackoverflow.com/users/2227966/kevin-bradner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1562630091, "creation_date": 1561499937, "question_id": 56762584, "link": "https://stackoverflow.com/questions/56762584/how-do-i-import-a-package-i-have-installed-from-stackage", "title": "How do I import a package I have installed from stackage?", "body": "<p>I am trying to import and use the <a href=\"https://www.stackage.org/package/prettyprinter\" rel=\"nofollow noreferrer\">prettyprinter</a> package. I have installed the package via stack with the following command:</p>\n\n<p><code>stack install prettyprinter</code></p>\n\n<p>However, I have trouble trying to import this package once I load ghci to try it. I have been taking shots in the dark, such as:</p>\n\n<p><code>import prettyprinter</code></p>\n\n<p><code>import Prettyprint</code></p>\n\n<p><code>import Data.Text.Prettyprint</code></p>\n\n<p>... and so on. Can anyone tell me the right command? Since this is just the latest of many similar experiences, I'd also like to know how I can figure out this command for myself using the information on the stackage page.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1561494295, "post_id": 56761514, "comment_id": 100080426, "body": "<code>=&gt;</code> is for a <i>type constraint</i>, an arrow <code>(-&gt;)</code> is a type constructor for a function."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3088035"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561494439, "post_id": 56761514, "comment_id": 100080480, "body": "@WillemVanOnsem so if I wanted my addMe to take a type constraint how would I go about it?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1561495890, "post_id": 56761514, "comment_id": 100081006, "body": "See also <a href=\"https://stackoverflow.com/q/47803288/791604\">how to read haskell type signature?</a> and <a href=\"https://stackoverflow.com/q/37505024/791604\">The meaning of &lt;= vs. =&gt; in Haskell</a>."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1561502148, "post_id": 56761514, "comment_id": 100082780, "body": "Also see <a href=\"https://stackoverflow.com/questions/3136133/trying-to-understand-haskells-vs-defining-the-types\">Trying to understand Haskell&#39;s =&gt; vs defining the types</a>"}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1561494731, "post_id": 56761566, "comment_id": 100080588, "body": "Perhaps a simpler example: <code>show :: Show a =&gt; a -&gt; String</code> can convert a value of any type <code>a</code> to a <code>String</code>, but only if the type <code>a</code> implements <code>Show</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3088035"}, "edited": false, "score": 0, "creation_date": 1561494843, "post_id": 56761566, "comment_id": 100080633, "body": "Let&#39;s say I want to change my addMe function, so it would only take floats, how would I go about it?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1561494939, "post_id": 56761566, "comment_id": 100080670, "body": "@John Only <code>Float</code>s specifically or any type that implements <code>Floating</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3088035"}, "edited": false, "score": 0, "creation_date": 1561495295, "post_id": 56761566, "comment_id": 100080795, "body": "Just, two floating numbers, then added and returned. like my addMe is already doing. Just want to try to specify types to my function. :)"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1561495762, "post_id": 56761566, "comment_id": 100080957, "body": "@John I didn&#39;t understand that response, so I&#39;m just going to answer both possibilities. To add two <code>Float</code>s, the type would be <code>addMe :: Float -&gt; Float -&gt; Float</code>. To work with any type that implements <code>Floating</code>, it would be <code>addMe :: Floating a =&gt; a -&gt; a -&gt; a</code>."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 11, "last_activity_date": 1561494479, "creation_date": 1561494479, "answer_id": 56761566, "question_id": 56761514, "link": "https://stackoverflow.com/questions/56761514/difference-between-and-symbols-what-do-they-mean/56761566#56761566", "title": "Difference between -&gt; and =&gt; symbols. What do they mean?", "body": "<p>The \"thin arrow\" is used for function types (<code>t1 -&gt; t2</code> being the type of a function that takes a value of type <code>t1</code> and produces a value of type <code>t2</code>).</p>\n\n<p>The \"fat arrow\" is used for type constraints. It separates the list of type constraints on a polymorphic function from the rest of the type. So given <code>Floating a =&gt; a -&gt; a</code>, we have the function type <code>a -&gt; a</code>, the type of a function that can take arguments of any type <code>a</code> and produces a result of that same type, with the added constraint <code>Floating a</code>, meaning that the function can in fact only be used with types that implement the <code>Floating</code> type class.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1561657958, "post_id": 56761666, "comment_id": 100147205, "body": "Some months ago, I ran into the surprising (to me) fact that with <code>RankNTypes</code>, it&#39;s possible that matching on and then immediately reapplying a <code>newtype</code> constructor may not be a no-op. I don&#39;t remember the details, but it had to do with the change in a type argument leading to a change in the type of a class constraint under the newtype and therefore an actual change in the way the wrapped value had to use the passed dictionary. I can dig it up if you&#39;re interested; I believe it was in a rejected PR to <code>primitive</code> and had something to do with traversing arrays."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 18, "last_activity_date": 1561496121, "last_edit_date": 1561496121, "creation_date": 1561494957, "answer_id": 56761666, "question_id": 56761514, "link": "https://stackoverflow.com/questions/56761514/difference-between-and-symbols-what-do-they-mean/56761666#56761666", "title": "Difference between -&gt; and =&gt; symbols. What do they mean?", "body": "<p><code>-&gt;</code> is for explicit functions. I.e. when <code>f</code> is something that can be written in an expression of the form <code>f x</code>, the signature must have one of these arrows in it<sup>\u2020</sup>. Specifically, the type of <code>x</code> (the <strong>argument</strong>) must appear to the left of a <code>-&gt;</code> arrow.</p>\n\n<p>It's best to not think of <code>=&gt;</code> as a function arrow at all, at least at first<sup>\u2021</sup>. It's an <em>implication arrow</em> in the logical sense: <strong>if</strong> <code>a</code> is a type with the <strong>property</strong> <code>Floating a</code>, then it follows that the signature of <code>sqrt</code> is <code>a -&gt; a</code>.</p>\n\n<p>For your <code>addMe</code> example, which is a function with two arguments, the signature must always have the form <code>x -&gt; y -&gt; z</code>. <em>Possibly</em> there can also be a <code>q =&gt;</code> in front of that; that doesn't influence the function-ishness, but may have some saying in what particular types are allowed. Generally, such constraints are not needed if the types are already fixed and concrete. Like, you could in principle impose a constraint on <code>Int</code>:</p>\n\n<pre><code>addMe :: Num Int =&gt; Int -&gt; Int -&gt; Int\naddMe x y = x + y\n</code></pre>\n\n<p>...but that doesn't really accomplish anything, because everybody <em>knows</em> that the particular type <code>Int</code> is an instance of the <code>Num</code> class. Where you <em>need</em> such constraints is when the type is <em>not</em> fixed but a type variable (i.e. lowercase), i.e. if the function is polymorphic. You can't just write</p>\n\n<pre><code>addMe' :: a -&gt; a -&gt; a\naddMe' x y = x + y\n</code></pre>\n\n<p>because that signature would suggest the function works for <em>any</em> type <code>a</code> whatsoever, but it can't work for all types (how would you add, for example, two strings? ok perhaps not the best example, but how would you <em>multiply</em> two strings?)</p>\n\n<p>Hence you need the constraint</p>\n\n<pre><code>addMe' :: Num a =&gt; a -&gt; a -&gt; a\naddMe' x y = x + y\n</code></pre>\n\n<p>This means, you don't care what <em>exact</em> type <code>a</code> is, but you do require it to be a numerical type. Anybody can use the function with their own type <code>MyNumType</code>, but they need to ensure that <code>Num MyNumType</code> is fulfilled: then it <em>follows</em> that <code>addMe'</code> can have signature <code>MyNumType -&gt; MyNumType -&gt; MyNumType</code>.</p>\n\n<p>The way to ensure this is to either use a standard type which you know to be numerical, for instance <code>addMe' 5.9 3.7 :: Double</code> would work, or give an <em>instance declaration</em> for your custom type and the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Num\" rel=\"noreferrer\"><code>Num</code> class</a>. Only do the latter if you're sure it's a good idea; usually the standard num types are all you'll need.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Note that the arrow may not be <em>visible</em> in the signature: it's possible to have a type synonym for a function type, for example when <code>type IntEndofunc = Int -&gt; Int</code>, then <code>f :: IntEndofunc; f x = x+x</code> is ok. But you can think of the typedef as essentially just a syntactic wrapper; it's still the same type and does have the arrow in it.</sub></p>\n\n<p><sup>\u2021</sup><sub>It so happens that logical implication and function application can be seen as two aspects of the same mathematical concept. Furthermore, GHC actually implements class constraints as function arguments, so-called <em>dictionaries</em>. But all this happens behind the scenes, so if anything they're <em>implicit</em> functions. In standard Haskell, you will never see the LHS of a <code>=&gt;</code> type as the type of some actual argument the function is applied to.</sub></p>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1561690355, "last_edit_date": 1561690355, "creation_date": 1561656806, "answer_id": 56796100, "question_id": 56761514, "link": "https://stackoverflow.com/questions/56761514/difference-between-and-symbols-what-do-they-mean/56796100#56796100", "title": "Difference between -&gt; and =&gt; symbols. What do they mean?", "body": "<p>the <code>-&gt;</code> is the constructor of functions and the <code>=&gt;</code> is used to constraints, a sort of \"interface\" in Haskell called typeclass.</p>\n\n<p>A little example:</p>\n\n<pre><code>sum :: Int -&gt; Int -&gt; Int\nsum x y = x + y\n</code></pre>\n\n<p>that function only allows Int types, but if you want a huge int or a small int, you probably want Integer, and how to tell it to use both?</p>\n\n<pre><code>sum2 :: Integral a =&gt; a -&gt; a -&gt; a\nsum2 x y = x + y\n</code></pre>\n\n<p>now if you try to do:</p>\n\n<pre><code>sum2 3 1.5\n</code></pre>\n\n<p>it will give you an error</p>\n\n<p>also, you may want to know if two data are equals, you want:</p>\n\n<pre><code>equals :: Eq a =&gt; a -&gt; a -&gt; Bool\nequals x y = x == y\n</code></pre>\n\n<p>now if you do:</p>\n\n<pre><code>3 == 4\n</code></pre>\n\n<p>that's ok</p>\n\n<p>but if you create:</p>\n\n<pre><code>data T = A | B\n\nequals A B\n</code></pre>\n\n<p>it will give to you:</p>\n\n<pre><code>error:\n    \u2022 No instance for (Eq T) arising from a use of \u2018equals\u2019\n    \u2022 In the expression: equals A B\n      In an equation for \u2018it\u2019: it = equals A B\n</code></pre>\n\n<p>if you want for that to work, you must just do:</p>\n\n<pre><code>data T = A | B deriving Eq\n\nequals A B\n\nFalse\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3088035"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1004, "favorite_count": 1, "answer_count": 3, "score": 7, "last_activity_date": 1561690355, "creation_date": 1561494243, "last_edit_date": 1561496243, "question_id": 56761514, "link": "https://stackoverflow.com/questions/56761514/difference-between-and-symbols-what-do-they-mean", "title": "Difference between -&gt; and =&gt; symbols. What do they mean?", "body": "<p>In Haskell, when we talk type declaration.</p>\n\n<p>I've seen both <code>-&gt;</code> and <code>=&gt;</code>.</p>\n\n<p>As an example: I can make my own type declaration.</p>\n\n<pre><code>addMe :: Int -&gt; Int -&gt; Int\naddMe x y = x + y\n</code></pre>\n\n<p>And it works just fine.</p>\n\n<p>But if we take a look at <code>:t sqrt</code> we get:</p>\n\n<pre><code>sqrt :: Floating a =&gt; a -&gt; a\n</code></pre>\n\n<p>At what point do we use <code>=&gt;</code> and when do we use <code>-&gt;</code>? \nWhen do we use \"fat arrow\" and when do we use \"thin arrow\"?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1561451123, "post_id": 56749747, "comment_id": 100057413, "body": "Actually the <code>head</code> is related to <code>tail</code>, just like <code>last</code> is related to <code>init</code>. Because a list is a <i>linked list</i>, so the names are symmetrical, but the &quot;couples&quot; are different."}, {"owner": {"reputation": 6981, "user_id": 420892, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/4oUCF.png?s=128&g=1", "display_name": "Cedric H.", "link": "https://stackoverflow.com/users/420892/cedric-h"}, "edited": false, "score": 4, "creation_date": 1561452307, "post_id": 56749747, "comment_id": 100058030, "body": "Why on earth do we want to close so many questions ?! Yes, the answer might not be clear cut but the answer shows that this is an interesting topic."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 6981, "user_id": 420892, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/4oUCF.png?s=128&g=1", "display_name": "Cedric H.", "link": "https://stackoverflow.com/users/420892/cedric-h"}, "edited": false, "score": 2, "creation_date": 1561480761, "post_id": 56749747, "comment_id": 100074605, "body": "@CedricH. In this case, I agree. While some questions of the form &quot;Why is X named like that?&quot; are too speculative to be properly answerable in this format, this specific question is fine. It asks about well established names and concepts, with plenty of sources to back up claims like those in Willem&#39;s answer. I once wrote <a href=\"https://meta.stackoverflow.com/a/337663/2751851\">a Meta answer</a> explaining a bit further my views on the general issue."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1561499683, "post_id": 56749747, "comment_id": 100082200, "body": "I always correlated it for head/tail as in coins, but I&#39;m most likely wrong."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1561567044, "post_id": 56749747, "comment_id": 100110226, "body": "Lists in Haskell are single-link lists. In a singly linked list, using the last element requires a full traversal of the length. length is also very expensive because of single links to the end of the list. Haskell lists are made for reading from the beginning, like a novel."}], "answers": [{"comments": [{"owner": {"reputation": 3148, "user_id": 2693928, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4c1419246c9c4d03a08f7c5db65303e?s=128&d=identicon&r=PG&f=1", "display_name": "user2693928", "link": "https://stackoverflow.com/users/2693928/user2693928"}, "edited": false, "score": 0, "creation_date": 1561451915, "post_id": 56749898, "comment_id": 100057833, "body": "Yes, but my point is why they called it &quot;head&quot;, isnt more correct to call it &quot;first&quot; ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 3148, "user_id": 2693928, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4c1419246c9c4d03a08f7c5db65303e?s=128&d=identicon&r=PG&f=1", "display_name": "user2693928", "link": "https://stackoverflow.com/users/2693928/user2693928"}, "edited": false, "score": 4, "creation_date": 1561452047, "post_id": 56749898, "comment_id": 100057897, "body": "@user2693928: well this is common terminology about linked lists: <a href=\"https://www.cpp.edu/~ftang/courses/CS240/lectures/slist.htm\" rel=\"nofollow noreferrer\">cpp.edu/~ftang/courses/CS240/lectures/slist.htm</a>"}, {"owner": {"reputation": 3148, "user_id": 2693928, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4c1419246c9c4d03a08f7c5db65303e?s=128&d=identicon&r=PG&f=1", "display_name": "user2693928", "link": "https://stackoverflow.com/users/2693928/user2693928"}, "edited": false, "score": 1, "creation_date": 1561452101, "post_id": 56749898, "comment_id": 100057929, "body": "Thanks, now I understand why :)"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "reply_to_user": {"reputation": 3148, "user_id": 2693928, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4c1419246c9c4d03a08f7c5db65303e?s=128&d=identicon&r=PG&f=1", "display_name": "user2693928", "link": "https://stackoverflow.com/users/2693928/user2693928"}, "edited": false, "score": 5, "creation_date": 1561452136, "post_id": 56749898, "comment_id": 100057945, "body": "@user2693928 &quot;Head&quot; is a pretty well established English word for the front end of things  - &quot;the head of the queue&quot; for instance."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3148, "user_id": 2693928, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4c1419246c9c4d03a08f7c5db65303e?s=128&d=identicon&r=PG&f=1", "display_name": "user2693928", "link": "https://stackoverflow.com/users/2693928/user2693928"}, "edited": false, "score": 0, "creation_date": 1561482706, "post_id": 56749898, "comment_id": 100075511, "body": "@user2693928 Haskell defines a function <code>fst (x,y) = x</code> which however works on pairs, not lists. The designers could have named <code>head</code> as <code>first</code>, but it would read aloud in the same way."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 9, "last_activity_date": 1561452164, "last_edit_date": 1561452164, "creation_date": 1561451625, "answer_id": 56749898, "question_id": 56749747, "link": "https://stackoverflow.com/questions/56749747/haskell-list-functions/56749898#56749898", "title": "Haskell List functions", "body": "<p>Haskell's function has two couples of list functions:</p>\n\n<ol>\n<li><code>head :: [a] -&gt; a</code>, and <code>tail :: [a] -&gt; [a]</code>; and</li>\n<li><code>init :: [a] -&gt; [a]</code> and <code>last :: [a] -&gt; a</code>.</li>\n</ol>\n\n<p><a href=\"http://learnyouahaskell.com/starting-out\" rel=\"noreferrer\"><em>Learn You a Haskell for the Greater Good</em></a> made a nice illustration about this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/2FbXf.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/2FbXf.png\" alt=\"enter image description here\"></a></p>\n\n<p>The <code>head</code> thus is the first element of the list, whereas the <code>tail</code> is the list that contains the remaining elements.</p>\n\n<p>The <code>init</code> takes all the elements except the last one, and <code>last</code> thus takes the last element.</p>\n\n<p>A list in Haskell is a conceptually a <em>linked</em> list. Usually random access is not very common in list processing. Usually most list processing functions take a list and processes this like a stream of items.</p>\n\n<p>It is common <a href=\"https://en.wikipedia.org/wiki/Linked_list#Basic_concepts_and_nomenclature\" rel=\"noreferrer\">nomenclature of linked lists [wiki]</a> to specify:</p>\n\n<blockquote>\n  <p>The <strong><code>head</code> of a list is its first node</strong>. The <strong><code>tail</code></strong> of a list may refer either to the <strong>rest of the list after the head</strong>, or to the last node in the list. In Lisp and some derived languages, the next node may be called the <code>cdr</code> (pronounced could-er) of the list, while the payload of the head node may be called the <code>car</code>.</p>\n</blockquote>\n"}], "owner": {"reputation": 3148, "user_id": 2693928, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4c1419246c9c4d03a08f7c5db65303e?s=128&d=identicon&r=PG&f=1", "display_name": "user2693928", "link": "https://stackoverflow.com/users/2693928/user2693928"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561452360, "creation_date": 1561450990, "last_edit_date": 1561452360, "question_id": 56749747, "link": "https://stackoverflow.com/questions/56749747/haskell-list-functions", "title": "Haskell List functions", "body": "<p>I was wondering why in Haskell there are not symmetry in some function names:</p>\n\n<p>For example:</p>\n\n<ul>\n<li><p><code>head</code> : get the first element</p></li>\n<li><p><code>last</code> : get the last element</p></li>\n</ul>\n\n<p>Is there good reason why for example <code>head</code> function was not named <code>first</code>, or the other way around - <code>last</code> function could be named <code>end</code> or something similar.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "reader-monad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1561469212, "post_id": 56747974, "comment_id": 100067999, "body": "No, you cannot implicitly unlift. It is always explicit. There are libraries to help, but under the hood they do exactly what you did here."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561469168, "post_id": 56748760, "comment_id": 100067964, "body": "This doesn&#39;t appear to actually address the question to me. In particular, once I have my <code>ReaderT State IO</code> instance, how do I use this new infrastructure that you recommend to make the implementation of <code>doStuffInGameMonad</code> less cumbersome?"}, {"owner": {"reputation": 373, "user_id": 1127375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4880348465d8e79c28f37d41f58db1c7?s=128&d=identicon&r=PG", "display_name": "Markus Rother", "link": "https://stackoverflow.com/users/1127375/markus-rother"}, "edited": false, "score": 0, "creation_date": 1561472415, "post_id": 56748760, "comment_id": 100070050, "body": "As far as I understand (from an OOP background), what you (@typedfern) suggest is information hiding by using a type class. In my case that is not interesting, because the <code>ioAction</code> I referred to, should NOT belong to the same context as the Game Monad."}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "reply_to_user": {"reputation": 373, "user_id": 1127375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4880348465d8e79c28f37d41f58db1c7?s=128&d=identicon&r=PG", "display_name": "Markus Rother", "link": "https://stackoverflow.com/users/1127375/markus-rother"}, "edited": false, "score": 0, "creation_date": 1561474945, "post_id": 56748760, "comment_id": 100071581, "body": "@MarkusRother, you can create multiple monads for different purposes: say, MonadGameState, MonadNetwork, etc; then, if you have a function that both changes the game state and accesses the network, you set two constraints: <code>myFunction :: (MonadGameState m, MonadNetwork m) =&gt; m ()</code>. You can place the ioAction in question within whatever monad is appropriate, having your different effects grouped into different classes."}], "tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": false, "score": 3, "last_activity_date": 1561447194, "creation_date": 1561447194, "answer_id": 56748760, "question_id": 56747974, "link": "https://stackoverflow.com/questions/56747974/how-to-wrap-monadic-action-in-io/56748760#56748760", "title": "How to wrap monadic action in IO", "body": "<p>The trick is to define the game actions as a type class:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Monad m =&gt; GameMonad m where\n  spawnCreature :: Position -&gt; m Creature\n  moveCreature :: Creature -&gt; Direction -&gt; m ()\n</code></pre>\n\n<p>Then, declare an instance of <code>GameMonad</code> for <code>ReaderT State IO</code> - implementing <code>spawnCreature</code> and <code>moveCreature</code> using ReaderT / IO actions; yes, that will likely imply <code>liftIO</code>'s, but only within said instance - the rest of your code will be able to call <code>spawnCreature</code> and <code>moveCreature</code> without complications, plus your functions' type signatures will indicate which capabilities the function has:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>spawnTenCreatures :: GameMonad m =&gt; m ()\n</code></pre>\n\n<p>Here, the signature tells you that this function <em>only</em> carries out GameMonad operations - that it doesn't, say, connect to the internet, write to a database, or launch missiles :)</p>\n\n<p>(In fact, if you want to find out more about this style, the technical term to google is \"capabilities\")</p>\n"}, {"comments": [{"owner": {"reputation": 373, "user_id": 1127375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4880348465d8e79c28f37d41f58db1c7?s=128&d=identicon&r=PG", "display_name": "Markus Rother", "link": "https://stackoverflow.com/users/1127375/markus-rother"}, "edited": false, "score": 0, "creation_date": 1561532573, "post_id": 56763996, "comment_id": 100089946, "body": "Exactly what I was looking for! I will go with <code>mapReaderT</code>.  What I learned once more: In Haskell when you can come up with the signature of the function your are looking for, you almost solved your problem.  Thanks everybody!"}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 5, "last_activity_date": 1561565315, "last_edit_date": 1561565315, "creation_date": 1561512848, "answer_id": 56763996, "question_id": 56747974, "link": "https://stackoverflow.com/questions/56747974/how-to-wrap-monadic-action-in-io/56763996#56763996", "title": "How to wrap monadic action in IO", "body": "<p>One abstraction you can use is the <a href=\"https://hackage.haskell.org/package/unliftio-core-0.1.2.0/docs/Control-Monad-IO-Unlift.html#t:MonadUnliftIO\" rel=\"nofollow noreferrer\"><code>MonadUnliftIO</code></a> class from the <a href=\"https://hackage.haskell.org/package/unliftio-core-0.1.2.0\" rel=\"nofollow noreferrer\"><code>unliftio-core</code></a> package. You can do it using <a href=\"https://hackage.haskell.org/package/unliftio-core-0.1.2.0/docs/Control-Monad-IO-Unlift.html#v:withRunInIO\" rel=\"nofollow noreferrer\"><code>withRunInIO</code></a>.</p>\n\n<pre><code>import Control.Monad.IO.Unlift (MonadUnliftIO(..))\n\ndoStuffInGameMonad :: MonadUnliftIO m =&gt; m a -&gt; m ()\ndoStuffInGameMonad gameAction = withRunInIO (\\run -&gt; ioAction (run gameAction))\n</code></pre>\n\n<p>Another less polymorphic solution would be to use <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Reader.html#v:mapReaderT\" rel=\"nofollow noreferrer\"><code>mapReaderT</code></a>.</p>\n\n<pre><code>doStuffInGameMonad :: Game a -&gt; Game ()\ndoStuffInGameMonad gameAction = mapReaderT ioAction gameAction\n</code></pre>\n"}], "owner": {"reputation": 373, "user_id": 1127375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4880348465d8e79c28f37d41f58db1c7?s=128&d=identicon&r=PG", "display_name": "Markus Rother", "link": "https://stackoverflow.com/users/1127375/markus-rother"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 56763996, "answer_count": 2, "score": 4, "last_activity_date": 1561565315, "creation_date": 1561443896, "last_edit_date": 1561452183, "question_id": 56747974, "link": "https://stackoverflow.com/questions/56747974/how-to-wrap-monadic-action-in-io", "title": "How to wrap monadic action in IO", "body": "<p>I am trying to treat a <code>ReaderT X IO</code> monad as IO to achieve the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- this is the monad I defined:\ntype Game = ReaderT State IO                                                                                                            \n\nrunGame :: State -&gt; Game a -&gt; IO a                                                                                                      \nrunGame state a = runReaderT a state                                                                                                    \n\nreadState :: Game State                                                                                                                 \nreadState = ask                                                                                                                         \n\n-- some IO action, i.e. scheduling, looping, etc.                                                                                                                    \nioAction :: IO a -&gt; IO ()\nioAction = undefined\n\n-- this works as expected, but is rather ugly                                                                                                                                       \ndoStuffInGameMonad :: Game a -&gt; Game ()                                                                                                 \ndoStuffInGameMonad gameAction = do                                                                                                      \n  state &lt;- readState                                                                                                               \n  liftIO $ ioAction $ runGame state gameAction\n</code></pre>\n\n<p><code>ioAction</code> for example is scheduling another IO action in intervals. Unwrapping the <code>Game</code> monad every time seems a bit cumbersome -- and feels wrong.</p>\n\n<p>What I am trying to achieve instead is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>doStuffInGameMonad :: Game a -&gt; Game ()                                                                                                 \ndoStuffInGameMonad gameAction = ioAction $ gameAction                                                                                   \n</code></pre>\n\n<p>My intuition tells me, this should be possible somehow, because my <code>Game</code> monad is aware of IO. Is there a way to implicitly convert/unlift the <code>Game</code> monad?</p>\n\n<p>Please excuse if my terminology is not correct.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1561410847, "post_id": 56743916, "comment_id": 100046898, "body": "From the readme, &quot;Replacement regex-tdfa does not provide find-and-replace.&quot;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561410883, "post_id": 56743916, "comment_id": 100046910, "body": "The GitHub repository specifies &quot;<i>regex-tdfa does not provide find-and-replace.</i>&quot;"}, {"owner": {"reputation": 6896, "user_id": 6797267, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bba37c069bfb5b705b7a0c98bd9b4803?s=128&d=identicon&r=PG&f=1", "display_name": "Lev", "link": "https://stackoverflow.com/users/6797267/lev"}, "edited": false, "score": 0, "creation_date": 1561411003, "post_id": 56743916, "comment_id": 100046951, "body": "Thanks for your constructive feedback Michael. Of course I read that it does not do search and replace which is why I was posting this."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561412869, "post_id": 56743916, "comment_id": 100047497, "body": "Perhaps the <code>AllMatches [] (MatchOffset, MatchLength)</code> instance of <code>RegexContext</code> will get you where you need to go. Although I suppose you&#39;ll have to consider what to do about overlapping matches."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1561415844, "creation_date": 1561415844, "answer_id": 56744766, "question_id": 56743916, "link": "https://stackoverflow.com/questions/56743916/doing-trivial-search-and-replace-via-a-regex/56744766#56744766", "title": "doing trivial search and replace via a regex", "body": "<p>You can use the <code>(=~)</code> form that returns the \"before\", \"matched\", and \"after\" parts.  To replace only the first occurrence, use:</p>\n\n<pre><code>replace1 :: String -&gt; String -&gt; String -&gt; String\nreplace1 pat repl str\n  = let (a,b,c) = str =~ pat :: (String, String, String)\n    in  a ++ repl ++ c\n</code></pre>\n\n<p>To replace all non-overlapping occurrences, use a recursive solution.</p>\n\n<pre><code>replace :: String -&gt; String -&gt; String -&gt; String\nreplace pat repl str\n  = case str =~ pat :: (String, String, String) of\n      (rest, \"\", \"\") -&gt; rest\n      (a, b, c) -&gt; a ++ repl ++ replace pat repl c\n</code></pre>\n\n<p>If you want something fancier than fixed-text replacement, you can change the type of <code>repl</code> from <code>String</code> to <code>String -&gt; String</code> in the obvious way, or use the \"get first match and submatches\" form, if you also want <code>repl :: String -&gt; [String] -&gt; String</code> to act on the submatches.</p>\n\n<p>Of course, if you really want to \"filter out characters from a string\", then a better solution is:</p>\n\n<pre><code>filter (not . isDigit) \"N0 0ne 7ike5 num83r5\"\n</code></pre>\n"}], "owner": {"reputation": 6896, "user_id": 6797267, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bba37c069bfb5b705b7a0c98bd9b4803?s=128&d=identicon&r=PG&f=1", "display_name": "Lev", "link": "https://stackoverflow.com/users/6797267/lev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1561415844, "creation_date": 1561410217, "question_id": 56743916, "link": "https://stackoverflow.com/questions/56743916/doing-trivial-search-and-replace-via-a-regex", "title": "doing trivial search and replace via a regex", "body": "<p>I am using <a href=\"https://github.com/ChrisKuklewicz/regex-tdfa\" rel=\"nofollow noreferrer\">regex-tdfa</a> which installs easiely with stack</p>\n\n<p>As seen in the docs, using a regex predicate is simple:</p>\n\n<pre><code>\u03bb&gt; emailRegex = \"[a-zA-Z0-9+._-]+@[a-zA-Z-]+\\\\.[a-z]+\"\n\u03bb&gt; \"my email is email@email.com\" =~ emailRegex :: Bool\n</code></pre>\n\n<p>How can I search and replace with this lib ?\nI would like for example, to filter out characters from a string.</p>\n\n<p>I can't <code>fmap</code> on a string with the <code>=~</code>operator since it expects strings and not characters as input, which is why I am stuck.</p>\n\n<p>Many thanks.</p>\n"}, {"tags": ["haskell", "z3", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561403043, "post_id": 56742474, "comment_id": 100044010, "body": "You need to install the missing library, so like <code>apt-get install libz3-dev</code> (on Debian systems). I&#39;m not very familiar how to install C libraries on a Windows system."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561419170, "post_id": 56742474, "comment_id": 100048936, "body": "On Windows using <code>stack</code>, I think @WillemVanOnsem&#39;s command would be <code>stack exec -- pacman -S mingw64&#47;mingw-w64-x86_64-z3</code>. I&#39;m not sure though; <code>stack</code>&#39;s MSYS2 distribution doesn&#39;t seem to have a separate <code>libz3-dev</code> library."}, {"owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561440195, "post_id": 56742474, "comment_id": 100052768, "body": "@WillemVanOnsem Isn&#39;t that what the <code>extra-lib-dirs</code> is supposed to do? The file <code>libz3.dll</code> is under <code>.&#47;z3&#47;bin</code> and <code>z3.h</code> is under <code>.&#47;z3&#47;include</code>. Is it possible to capture the output of the c compiler with stack?"}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1561596431, "post_id": 56742474, "comment_id": 100119868, "body": "Have you tried absolute paths in <code>stack.yaml</code>.  Or maybe with backslashes?"}, {"owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "reply_to_user": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1562829432, "post_id": 56742474, "comment_id": 100502443, "body": "@bergey Unfortunately absolute paths don&#39;t work either ..."}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561402870, "creation_date": 1561402870, "question_id": 56742474, "link": "https://stackoverflow.com/questions/56742474/cannot-install-z3-package-for-haskell-on-windows-10", "title": "Cannot install z3 package for Haskell on Windows 10", "body": "<p>I'm trying to install a project that uses the z3 package under Windows 10 and haskell stack with the following setup:</p>\n\n<p>The <a href=\"https://github.com/Z3Prover/z3/releases\" rel=\"nofollow noreferrer\">z3 precompiled binaries</a> (with includes under ./z3/includes and dll files under ./z3/bin) are located under the project root</p>\n\n<pre><code>myProject/\n- app/\n- dist/\n- src/\n- z3/\n- package.yaml\n- Setup.hs\n- stack.yaml\n- myProject.cabal\n</code></pre>\n\n<p>The <code>package.yaml</code> file contains:</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- containers\n- parsec\n- z3 &lt;= 408.0\n</code></pre>\n\n<p>The <code>stack.yaml</code> file contains:</p>\n\n<pre><code>extra-deps:\n- z3-408.0@sha256:89bbc2d828dc1fe1f19666e8e501c69ce5d0ed8026e4a02f7eae1e69f4a352af\n\nextra-include-dirs:\n- ./z3/include\nextra-lib-dirs:\n- ./z3/lib\n</code></pre>\n\n<p>When I try to stack install I get the following error: </p>\n\n<pre><code>Process exited with code: ExitFailure 1\nLogs have been written to: C:\\Users\\jmueller\\repos\\synthImp\\.stack-work\\logs\\z3-408.0.log\n\nz3-408.0: configure\nProgress 1/2\n\n--  While building package z3-408.0 using:\n&lt;...&gt;\n--extra-include-dirs=C:\\Users\\jmueller\\repos\\synthImp\\./z3/include \n&lt;...&gt;\n--extra-lib-dirs=C:\\Users\\jmueller\\repos\\synthImp\\./z3/lib\n\nConfiguring z3-408.0...\nCabal-simple_Z6RU0evB_2.4.0.1_ghc-8.6.5.exe: Missing dependency on a foreign\nlibrary:\n* Missing (or bad) C library: z3\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n--extra-include-dirs= and --extra-lib-dirs= to specify where it is.If the\nlibrary file does exist, it may contain errors that are caught by the C\ncompiler at the preprocessing stage. In this case you can re-run configure\nwith the verbosity flag -v3 to see the error messages.\n</code></pre>\n\n<p>The extra include and extra lib dirs are there and obviously the include is found too ... there seems to be a problem on the level of the c compiler</p>\n\n<p>I tried both binaries for z3 (x64 and x86) and I don't know how to capture the output of the c preprocessor for further debugging. </p>\n\n<p>Any help is highly appreciated!</p>\n\n<p>Many thanks in advance</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency", "io-monad", "program-transformation"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1561411676, "post_id": 56742154, "comment_id": 100047179, "body": "Why do you want to change it so it uses MVars?"}, {"owner": {"reputation": 55, "user_id": 7722311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cd990772a41631e0b2287dbf8c1363f?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigo ferreira", "link": "https://stackoverflow.com/users/7722311/rodrigo-ferreira"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1561412919, "post_id": 56742154, "comment_id": 100047512, "body": "im trying to understand threads in haskell"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1561417808, "creation_date": 1561417808, "answer_id": 56744984, "question_id": 56742154, "link": "https://stackoverflow.com/questions/56742154/how-can-i-use-mvars-to-move-paddles-on-my-pingpong-haskell-game/56744984#56744984", "title": "How can i use MVars to move paddles on my pingpong haskell game?", "body": "<p>The way MVars work is that a value of type <code>MVar Bool</code> is an opaque \"token\" referencing a storage location for a <code>Bool</code>.  You create such a token and read and modify the contents of its associated storage location using IO actions.</p>\n\n<p>The token itself (the <code>MVar Bool</code> value) has no <code>Show</code> instance by default.  For debugging purposes, you could add one:</p>\n\n<pre><code>instance Show (MVar a) where show _ = \"&lt;MVar&gt;\"\n</code></pre>\n\n<p>This will allow you to derive a <code>Show</code> instance for <code>PongGame</code> without getting an error message.  However, the values stored in the <code>MVars</code> can't be displayed by the <code>Show</code> instance without some egregious IO abuse, so you might want to consider writing a function <code>dumpGame :: PongGame -&gt; IO ()</code> that pretty-prints the current game state with all the MVar values, letting you skip the <code>Show</code> instance entirely.</p>\n\n<p>Anyway, to rewrite your program to use MVars in key <code>PongGame</code> fields:</p>\n\n<pre><code>data PongGame = Game\n  {\n  ...\n  , wHeld :: MVar Bool -- segura o w\n  , sHeld :: MVar Bool -- segura os\n  , downHeld :: MVar Bool -- segura down\n  , upHeld :: MVar Bool -- segura para cima\n  ...\n  }\n</code></pre>\n\n<p>you'll want to rewrite your <code>movePaddle</code> and its subfunctions to run in the IO monad:</p>\n\n<pre><code>movePaddle :: PongGame -&gt; IO PongGame\nmoveLeftPaddle :: PongGame -&gt; IO PongGame\nmoveRightPaddle :: PongGame -&gt; IO PongGame\n</code></pre>\n\n<p>In <code>movePaddle</code>, you can replace the <code>.</code> operator with <code>&lt;=&lt;</code> from <code>Control.Monad</code>, which is the monadic equivalent of function composition:</p>\n\n<pre><code>movePaddle = moveLeftPaddle &lt;=&lt; moveRightPaddle\n</code></pre>\n\n<p>This is basically shorthand for:</p>\n\n<pre><code>movePaddle game = do\n    game1 &lt;- moveRightPaddle game\n    game2 &lt;- moveLeftPaddle game1\n    return game2\n</code></pre>\n\n<p>Then, you'll need to rewrite <code>moveLeftPaddle</code> and <code>moveRightPaddle</code> to access the contents of the MVars by executing IO actions:</p>\n\n<pre><code>moveLeftPaddle game\n  = do up &lt;- readMVar (wHeld game)\n       dn &lt;- readMVar (sHeld game)\n       case (up, dn) of\n         (True, False) -&gt; return $ game {playerLPos = paddleUp (playerLPos game)}\n         (False, True) -&gt; return $ game {playerLPos = paddleDn (playerLPos game)}\n         _ -&gt; return game\n</code></pre>\n\n<p>with <code>moveRightPaddle</code> defined similarly.</p>\n\n<p>To be clear, the function call <code>wHeld game</code> is a simple, pure function call that retrieves the <strong>token</strong> of type <code>MVar Bool</code> associated with the <code>wHeld</code> field.  We then execute the IO action <code>readMVar &lt;this_token&gt;</code> to actually retrieve the <code>Bool</code> value, which we can then act on in a <code>case</code> statement to update the game state.</p>\n\n<p>Elsewhere in your program, you'll need a <code>setup</code> routine that creates these MVars:</p>\n\n<pre><code>initGame :: IO PongGame\ninitGame = do\n  ...\n  wHeld &lt;- newMVar False\n  sHeld &lt;- newMVar False\n  ...\n  return $ Game ... wHeld sHeld ...\n</code></pre>\n\n<p>and you'll presumably have some thread that's running a function like:</p>\n\n<pre><code>processKeyEvent :: KeyEvent -&gt; PongGame -&gt; IO ()\nprocessKeyEvent event game = do\n  ...\n  case event of\n     ...\n     KeyDown 'W' -&gt; void $ swapMVar (wHeld game) True\n     KeyUp   'W' -&gt; void $ swapMVar (wHeld game) False\n     ...\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 7722311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cd990772a41631e0b2287dbf8c1363f?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigo ferreira", "link": "https://stackoverflow.com/users/7722311/rodrigo-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561442278, "creation_date": 1561401483, "last_edit_date": 1561442278, "question_id": 56742154, "link": "https://stackoverflow.com/questions/56742154/how-can-i-use-mvars-to-move-paddles-on-my-pingpong-haskell-game", "title": "How can i use MVars to move paddles on my pingpong haskell game?", "body": "<p>I already have a function that moves 2 paddles in a ping pong game in haskell. I want to change so it uses MVars now. </p>\n\n<p>I know that i need to change wHeld, sHeld, downHeld and upHeld to MVars but any ideas on how to change movePaddle to deal with MVars? </p>\n\n<p>Also when i declare wHeld an MVars it shows a error on deriving show (Non instance for (Show MVar Bool))</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data PongGame = Game\n  { ballLoc :: (Float, Float)  -- ^ Pong ball (x, y) location.\n  , ballVel :: (Float, Float)  -- ^ Pong ball (x, y) velocity. \n  , player1 :: Float           -- ^ Left player paddle height.\n                               -- Zero is the middle of the screen. \n  , player2 :: Float           -- ^ Right player paddle height.\n  , playerRPos :: Float -- posicao do player right\n  , playerLPos :: Float --- posicao do player left\n  , ghci :: Bool -- pausar\n  , showMenu :: Bool -- mostrar o menu\n  , wHeld :: MVar Bool -- segura o w\n  , sHeld :: Bool -- segura os\n  , downHeld :: Bool -- segura down\n  , upHeld :: Bool -- segura para cima\n  , playerLScore :: Int -- score do jogador left\n  , playerRScore :: Int -- score do jogador right\n  , paused :: Bool\n  } deriving Show \n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>movePaddle :: PongGame -&gt; PongGame\nmovePaddle = moveLeftPaddle . moveRightPaddle \nmoveLeftPaddle game\n          | (wHeld game) = game {playerLPos = paddleUp (playerLPos game)}\n          | (sHeld game) = game {playerLPos = paddleDn (playerLPos game)}\n          | otherwise = game\nmoveRightPaddle game\n          | (upHeld   game) = game {playerRPos = paddleUp (playerRPos game)}\n          | (downHeld game) = game {playerRPos = paddleDn (playerRPos game)}\n          | otherwise = game\n\npaddleUp pos = min (pos + 10) paddleMax\npaddleDn pos = max (pos - 10) paddleMin\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1561393906, "post_id": 56740444, "comment_id": 100040166, "body": "<code>| abs n &lt; abs d = (Result count, n)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1561395281, "post_id": 56740444, "comment_id": 100040786, "body": "When the error is confusing, add more type annotations. Here, annotating <code>go</code> would point out that <code>.... = (count, n)</code> has the wrong type, and needs <code>Result</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": true, "score": 4, "last_activity_date": 1561399268, "last_edit_date": 1561399268, "creation_date": 1561396444, "answer_id": 56741182, "question_id": 56740444, "link": "https://stackoverflow.com/questions/56740444/recursive-function-no-instance-num-arising-from-the-literal/56741182#56741182", "title": "recursive function: No instance (Num) arising from the literal", "body": "<p>The reason you get that error, is because you are trying to return an actual Integer here:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>| abs n &lt; abs d = (count, n)\n</code></pre>\n\n<p>By returning <code>count</code>, an <code>Integer</code> instead of a <code>DividedResult</code>, the compiler thinks you are trying to cast a number into a <code>DividedResult</code>, which is only possible if <code>DividedResult</code> is a <code>Num</code></p>\n\n<p>In this case, making <code>DividedResult</code> an instance of <code>Num</code> would be overkill; you just need to wrap <code>count</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>| abs n &lt; abs d = (Result count, n)\n</code></pre>\n"}], "owner": {"reputation": 409, "user_id": 7825727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8ebdf381633dc5bec96b1adff7ab691?s=128&d=identicon&r=PG&f=1", "display_name": "kirill fedorov", "link": "https://stackoverflow.com/users/7825727/kirill-fedorov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 56741182, "answer_count": 1, "score": -1, "last_activity_date": 1561399268, "creation_date": 1561392815, "question_id": 56740444, "link": "https://stackoverflow.com/questions/56740444/recursive-function-no-instance-num-arising-from-the-literal", "title": "recursive function: No instance (Num) arising from the literal", "body": "<p>I'm trying to make a recursive function which defines division in terms of subtraction. So I have created a new type \"DividedResult\" to take into account a \"divide by zero\" case. Do my datatype declaration and function type declaration make sense? I get such errors:</p>\n\n<pre><code>No instance for (Num DividedResult) arising from the literal `0' In the third argument of `go'\n</code></pre>\n\n<pre><code>Could not deduce (Num DividedResult) arising from a use of `+'\n</code></pre>\n\n<p>(Probably have to create a Num instance? I have tried, but it doesn't work for me).\nHere is my code:</p>\n\n<pre><code>data DividedResult = Result Integer | DividedByZero\n\ndividedBy :: Integer -&gt; Integer -&gt; (DividedResult, Integer)\ndividedBy num denom = go num denom 0\n  where go n d count\n         | d == 0 = (DividedByZero, n)\n         | abs n &lt; abs d = (count, n)\n         | abs n &gt;= abs d &amp;&amp; n &gt; 0 &amp;&amp; d &gt; 0 = go (n - d) d (count + 1)\n         | abs n &gt;= abs d &amp;&amp; n &gt; 0 &amp;&amp; d &lt; 0 = go (n + d) d (count - 1)\n         | abs n &gt;= abs d &amp;&amp; n &lt; 0 &amp;&amp; d &lt; 0 = go (n - d) d (count + 1)\n         | abs n &gt;= abs d &amp;&amp; n &lt; 0 &amp;&amp; d &gt; 0 = go (n + d) d (count - 1)\n</code></pre>\n"}, {"tags": ["multithreading", "haskell", "concurrency"], "comments": [{"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 4, "creation_date": 1561372664, "post_id": 56734536, "comment_id": 100028427, "body": "My guess it that you&#39;re getting bitten by the fact that there is <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Concurrent.html#g:4\" rel=\"nofollow noreferrer\">no context switching</a> happening. Can you try inserting calls to <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Concurrent.html#v:yield\" rel=\"nofollow noreferrer\"><code>yield</code></a> instead of <code>putStr &quot;&quot;</code> to see if that works?"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1561376413, "post_id": 56734536, "comment_id": 100030290, "body": "Are you using threaded or non-threaded runtime? In case of threaded one, are you using more then one capability? IIRC in case of threaded runtime with more then 1 capability enabled, <code>tryTakeMVar</code> will yield, otherwise it won&#39;t."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1561378627, "post_id": 56734536, "comment_id": 100031466, "body": "Could be this <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/bugs.html#bugs-in-ghc\" rel=\"nofollow noreferrer\">known bug</a> (first item). Try <code>-fno-omit-yields</code>, or manually insert a <code>yield</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1561380326, "post_id": 56734536, "comment_id": 100032495, "body": "Why don&#39;t you want <code>watcher</code> to block?"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 1, "creation_date": 1561399491, "post_id": 56734536, "comment_id": 100042561, "body": "in fact, <code>watcher</code> does block. calling <code>tryTakeMVar</code> in an endless loop is just a not so efficient way to block on an MVar."}, {"owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "reply_to_user": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1561435105, "post_id": 56734536, "comment_id": 100051480, "body": "@theindigamer You guessed right, inserting <code>yield</code> helps the program run as expected."}, {"owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1561435344, "post_id": 56734536, "comment_id": 100051542, "body": "@chi <code>-fno-omit-yields</code> in my project&#39;s cabal file didn&#39;t seem to help, but manually inserting a yield did."}, {"owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1561436486, "post_id": 56734536, "comment_id": 100051783, "body": "@chi Hm, <code>-fno-omit-yields</code> works when I put it in the file with OPTIONS_GHC. Not sure why it doesn&#39;t work in the cabal file."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1561480524, "post_id": 56734536, "comment_id": 100074485, "body": "is it really helping if you just give the OP the <i>feeling</i> that he got help? Because <code>-fno-omit-yields</code> isn&#39;t a proper solution. The function still blocks. I think there is a problem in IT, where when someone asks a nonsensical question, we feel the urge to respond in a limited way instead of explaining things properly. Like when someone asks &quot;how can I put a finger in a wallsocket without getting an electric shock&quot;, an IT person would answer &quot;use isolating gloves&quot;. But that doesn&#39;t help the person to see wether the wallsocket contains current."}], "answers": [{"comments": [{"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 3, "creation_date": 1561400377, "post_id": 56740101, "comment_id": 100042924, "body": "doesn&#39;t <code>watcher</code> block in any case? polling in an endless loop indefinitely is a way of blocking, according to my definition."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "edited": false, "score": 0, "creation_date": 1561482008, "post_id": 56740101, "comment_id": 100075200, "body": "@Michael The usual definition of &quot;blocking&quot;, in concurrent systems, is asking the OS/RTS/scheduler to remove the current thread  from the list of active threads until some event happens. Busy waiting is not &quot;blocking&quot;, and there&#39;s an extensive literature about avoiding wasting CPU time using a busy wait, which has influenced Haskell primitives. Daniel&#39;s code above runs <code>takeMVar</code> each loop, so it&#39;s blocking whenever there&#39;s nothing to do instead of polling/busy waiting."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1561401334, "last_edit_date": 1561401334, "creation_date": 1561391466, "answer_id": 56740101, "question_id": 56734536, "link": "https://stackoverflow.com/questions/56734536/concurrent-multithreaded-program-hangs-unless-i-print-something/56740101#56740101", "title": "Concurrent (multithreaded) program hangs unless I print something", "body": "<p>Despite the text in your question, I recommend that you let <code>watcher</code> block. It is quite rare indeed to need non-blocking operations on <code>MVar</code>s; usually wanting it is a <a href=\"https://stackoverflow.com/q/11744527/791604\">sign you haven't quite internalized the \"fork everything\" mentality</a>. So:</p>\n\n<pre><code>watcher :: ReaderT Config IO ()\nwatcher = do\n    cfg &lt;- ask\n    newThing &lt;- liftIO . takeMVar $ drawer cfg\n    printThing newThing\n    watcher\n</code></pre>\n\n<p>We can separately address a question of the form \"How do I achieve effect X, that seems to me to need non-blocking operations, while only using blocking operations?\" if you will write up a separate question with some details about effect X.</p>\n\n<p>Side note: I'd be tempted to write the above in the following way, which has the same meaning but appeals to me more aesthetically:</p>\n\n<pre><code>watcher = forever (asks drawer &gt;&gt;= liftIO . takeMVar &gt;&gt;= printThing)\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561401334, "creation_date": 1561371757, "last_edit_date": 1561383122, "question_id": 56734536, "link": "https://stackoverflow.com/questions/56734536/concurrent-multithreaded-program-hangs-unless-i-print-something", "title": "Concurrent (multithreaded) program hangs unless I print something", "body": "<p>I have a function that I fork off into a thread using <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Concurrent.html#v:forkIO\" rel=\"nofollow noreferrer\">forkIO</a>. The function runs in a <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Reader.html#t:ReaderT\" rel=\"nofollow noreferrer\">ReaderT monad transformer</a> so that I can pass in a read-only configuration record:</p>\n\n<pre><code>main :: IO ()\nmain = do \n    ...\n    forkIO $ runReaderT watcher config\n\n</code></pre>\n\n<p>The <code>watcher</code> function watches an MVar using <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Concurrent-MVar.html#v:tryTakeMVar\" rel=\"nofollow noreferrer\">tryTakeMVar</a> (I don't want it to block.) The MVar is stored in the config and is called \"drawer\" because it behaves like a transaction drawer between <code>main</code> and the thread that <code>watcher</code> is watching in, basically a skip channel.</p>\n\n<p><code>printThing</code> has a signature of <code>printThing :: Thing -&gt; ReaderT Config IO ()</code> and calls <code>putStrLn</code> to print a <code>Thing</code>.</p>\n\n<pre><code>watcher :: ReaderT Config IO ()                                                                                                                                                                       \n watcher = do\n     cfg &lt;- ask\n     mNewThing &lt;- liftIO $ tryTakeMVar $ drawer cfg\n     case mNewThing of\n         Nothing -&gt; do\n            --liftIO $ putStr \"\"  -- uncommenting this helps\n            watcher\n         Just newThing -&gt; do\n             printThing newThing\n             watcher\n</code></pre>\n\n<p>The problem is that the program hangs when it runs. It seems to be stuck in a loop. Calling <code>putStr \"\"</code> in <code>main</code> doesn't help, HOWEVER, calling <code>putStr \"\"</code>  inside <code>watcher</code> does trigger the thread -- it starts spinning and printing out <code>Thing</code>s as expected.</p>\n\n<p>All I can figure is that I'm getting bitten by laziness, but I'm not sure where. I've tried using <code>$!</code> where possible. </p>\n\n<p><strong>I do IO actions in certain conditions of <code>watcher</code>, but not all of them. Is that the problem? I need to do IO actions in ALL conditions branches?</strong> </p>\n\n<p>If it helps,  I didn't have this problem before I wrapped everything up in the <code>ReaderT</code> transformer. I was just passing <code>config</code> around as an argument.</p>\n"}, {"tags": ["haskell", "syntax"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1561377790, "last_edit_date": 1561377790, "creation_date": 1561370100, "answer_id": 56734073, "question_id": 56733918, "link": "https://stackoverflow.com/questions/56733918/how-do-you-include-a-multiline-number-in-a-haskell-source-file/56734073#56734073", "title": "How do you include a multiline number in a Haskell source file?", "body": "<p>This is a possible approach. I'm not completely sure about it, though. There might be an easier way.</p>\n\n<pre><code>largeConstant :: Integer\nlargeConstant = read $\n  \"12345\" ++\n  \"12345\" ++\n  \"12345\"\n</code></pre>\n\n<p>Alternatively, we could use multiline string literals, even though they are not very commonly used in Haskell.</p>\n\n<pre><code>largeConstant :: Integer\nlargeConstant = read\n  \"12345\\\n  \\12345\\\n  \\12345\"\n</code></pre>\n\n<p>Enabling CPP is also an option, but seems a bit overkill.</p>\n\n<pre><code>largeConstant = 12345\\\n12345\\\n12345\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1561384749, "creation_date": 1561384749, "answer_id": 56738217, "question_id": 56733918, "link": "https://stackoverflow.com/questions/56733918/how-do-you-include-a-multiline-number-in-a-haskell-source-file/56738217#56738217", "title": "How do you include a multiline number in a Haskell source file?", "body": "<p>You could make a quasiquoter.  Might even want to upload it to hackage:</p>\n\n<pre><code>module X where\n\nimport Language.Haskell.TH\nimport Language.Haskell.TH.Quote\nimport Data.Char\n\niQQ :: QuasiQuoter\niQQ = QuasiQuoter {\n  quoteExp  = return . LitE . IntegerL . read . filter isDigit,\n\n  quotePat  = \\_ -&gt; fail \"illegal integer QuasiQuote \\\n                         \\(allowed as expression only, used as a pattern)\",\n  quoteType = \\_ -&gt; fail \"illegal integer QuasiQuote \\\n                         \\(allowed as expression only, used as a type)\",\n  quoteDec  = \\_ -&gt; fail \"illegal integer QuasiQuote \\\n                         \\(allowed as expression only, used as a declaration)\"\n  }\n</code></pre>\n\n<p>And the use:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nimport X\n\nvalue = [iQQ|123\n456|]\n</code></pre>\n\n<p>Resulting in:</p>\n\n<pre><code>Ok, two modules loaded.\n*Main&gt; value\n123456\n</code></pre>\n\n<p>Or a larger number:</p>\n\n<pre><code>value = [iQQ|\n44444444444444444444444444444444444444444444444444444444444444444444444444444444\n45555555555555555555555555555555555555555555555555555555555555555555555555555555\n66666666666666666666666666666666666666666666666666666666666666666666666666666666\n|]\n</code></pre>\n\n<p>And in GHCi:</p>\n\n<pre><code>Ok, two modules loaded.\n*Main&gt; value\n444444444444444444444444444444444444444444444444444444444444444444444444444444444555555555555555555555555555555555555555555555555555555555555555555555555555555566666666666666666666666666666666666666666666666666666666666666666666666666666666\n</code></pre>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1561384749, "creation_date": 1561369523, "question_id": 56733918, "link": "https://stackoverflow.com/questions/56733918/how-do-you-include-a-multiline-number-in-a-haskell-source-file", "title": "How do you include a multiline number in a Haskell source file?", "body": "<p>I would like to paste in a large number constant into my Haskell code, and for readability I would like to have it formatted over several lines instead of one line.</p>\n\n<p>Is this possible?</p>\n"}, {"tags": ["haskell", "scotty"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1561367214, "post_id": 56733163, "comment_id": 100025503, "body": "You can add a cookie, and check the cookie to determine if this is the first visit."}], "answers": [{"tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": true, "score": 3, "last_activity_date": 1561382187, "creation_date": 1561382187, "answer_id": 56737423, "question_id": 56733163, "link": "https://stackoverflow.com/questions/56733163/save-state-in-memory-haskell-server/56737423#56737423", "title": "Save state in memory [Haskell Server]", "body": "<p>You can use <code>STM</code> to keep a mutable variable in memory:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Concurrent.STM.TVar\n\nmain = do\n    putStrLn \"Starting Server...\"\n    state &lt;- newTVarIO :: IO VisitorsData\n    scotty 3000 $ do\n        get \"/\" $ do\n            visitorsData &lt;- readTVarIO state\n            -- if the visitor's ID/cookie is in visitorsData\n            text \"hello!\"\n            -- if new visitor, add them to visitorsData\n            atomically $ modifyTVar state $ insertVisitor visitorId visitorsData\n            -- if second time\n            text \"hello, again!\"\n\n</code></pre>\n\n<p>(If you expect to scale this to a complex server, you'll want to pass the TVar around in the form of a <a href=\"https://www.fpcomplete.com/blog/2017/06/readert-design-pattern\" rel=\"nofollow noreferrer\">ReaderT pattern</a>)</p>\n"}], "owner": {"reputation": 1083, "user_id": 5272159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bee102cff2130800106cdd7d99db787e?s=128&d=identicon&r=PG&f=1", "display_name": "timothyylim", "link": "https://stackoverflow.com/users/5272159/timothyylim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 0, "accepted_answer_id": 56737423, "answer_count": 1, "score": 0, "last_activity_date": 1561382187, "creation_date": 1561366940, "question_id": 56733163, "link": "https://stackoverflow.com/questions/56733163/save-state-in-memory-haskell-server", "title": "Save state in memory [Haskell Server]", "body": "<p>I am attempting to create a server that returns two different values from a route depending if a user has visited it before. I have the following code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Web.Scotty\n\nmain = do\n    putStrLn \"Starting Server...\"\n    scotty 3000 $ do\n        get \"/\" $ do\n            -- if first time \n            text \"hello!\"\n            -- if second time\n            text \"hello, again!\"\n</code></pre>\n\n<p>I have two questions:\n1. How can I check if a user has requested the route before?\n2. Where and how can I persist application state?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "edited": false, "score": 0, "creation_date": 1561366303, "post_id": 56732989, "comment_id": 100025056, "body": "Additionally, how could I rewrite my &quot;echo&quot; program so that it only repeats what was given <b>after</b> pressing enter?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561366423, "post_id": 56732989, "comment_id": 100025128, "body": "Because at that point the <code>lines</code> is still &quot;blocking&quot; on the first line."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1561366510, "post_id": 56732989, "comment_id": 100025166, "body": "It&#39;s worth noting that <code>unlines . map id . lines = id</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561366739, "post_id": 56732989, "comment_id": 100025281, "body": "Lists in Haskell are linked lists, and due to Haskell&#39;s laziness, these are not (per) se fully evaluated. You can see the input channel as a linked list, where it is &quot;blocking&quot; on the characters you still need to enter. <code>lines</code> processes the stream and when a new line is reached, it starts a new element in the list. Since <code>length</code> can only calculate the length of an entire list, <code>length</code> thus will wait, but <code>id</code> does not, since for <code>id</code> since it just returns the list under construction, and that string is each time extended when you enter a character."}, {"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "edited": false, "score": 0, "creation_date": 1561366971, "post_id": 56732989, "comment_id": 100025395, "body": "Ah, trying <code>interact (show . lines)</code> is making it a bit clearer, I can see it keeps on adding stuff inside the <code>[...</code> and it never gets to `]&#39;."}, {"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "edited": false, "score": 0, "creation_date": 1561367027, "post_id": 56732989, "comment_id": 100025421, "body": "I&#39;m still curious how I can get the &quot;echo&quot; behaviour using the <code>interact</code> function. Or would this be considered misuse?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561367142, "post_id": 56732989, "comment_id": 100025476, "body": "@CameronBall: you can use <code>seq</code> (and derived functions like <code>seqList</code> to force evaluation) <a href=\"https://hackage.haskell.org/package/ghc-8.6.5/docs/Util.html#v:seqList\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/ghc-8.6.5/docs/Util.html#v:seqLi&zwnj;&#8203;st</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561367256, "post_id": 56732989, "comment_id": 100025524, "body": "But in general the idea is to be as lazy as possible, since this makes it sometimes possible to process infinite lists. As in you can define an infinite list of prime numbers, filter on the numbers that contain at least four digits, and then take the first 26 numbers."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561397470, "post_id": 56732989, "comment_id": 100041693, "body": "Why would it immediately give you &quot;1&quot; as output? After all, the length of the line might start with a 2!"}], "answers": [{"comments": [{"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "edited": false, "score": 0, "creation_date": 1561430593, "post_id": 56733207, "comment_id": 100050711, "body": "Thanks for the comment on <code>interact</code>&#39;s intended usage. I felt as though it was designed for user interaction, but it seems not to be the case."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 3, "last_activity_date": 1561372505, "last_edit_date": 1561372505, "creation_date": 1561367121, "answer_id": 56733207, "question_id": 56732989, "link": "https://stackoverflow.com/questions/56732989/understanding-haskells-laziness/56733207#56733207", "title": "Understanding Haskell&#39;s Laziness", "body": "<p>This is to do with lazy evaluation. I'll try to explain this in as intuitive a way as possible.</p>\n\n<p>When you write <code>interact (unlines . map (show . length) . lines)</code>, every time a character is input, we don't actually know what the next output character can be until you press enter. So, you get the behaviour you expected.</p>\n\n<p>However, at every point in <code>interact (unlines . map id . lines) = interact id</code>, every time you enter a character, it's guaranteed that that character is included in the output. So, if you input a character, that character is also output immediately.</p>\n\n<p>This is one of the reasons that the word \"lazy\" is a bit of a misnomer. It's true that Haskell will only evaluate something when it needs to, but the flipside of that is that when it needs to, it'll do so as soon as possible. Here Haskell needs to evaluate the output since you want to print it, so it evaluates it as much as it can\u2014one character at a time\u2014ironically making it seem eager!</p>\n\n<p>More specifically, <code>interact</code> isn't intended for real time user input\u2014it's intended for file input, in which you pipe a file into an executable with bash. It should be run something like this:</p>\n\n<pre><code>$ runhaskell Interactor.hs &lt; my_big_file.txt &gt; list_of_lengths.txt\n</code></pre>\n\n<p>If you want line-by-line buffering, you'll probably have to do it manually, unless you want to 'trick' the compiler as Willem does. Here's some very simple code that works as you expect\u2014but note that it has no exit state unlike <code>interact</code>, which will terminate at the EOF.</p>\n\n<pre><code>main = do\n  ln &lt;- getLine -- Buffers until you press enter\n  putStrLn ln   -- Print the line we just got\n  main          -- Loop forever\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "edited": false, "score": 0, "creation_date": 1561430550, "post_id": 56733479, "comment_id": 100050707, "body": "Great answer. I think I was fixating on it a bit because to me <code>interact</code> implied user interaction."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1561368068, "creation_date": 1561368068, "answer_id": 56733479, "question_id": 56732989, "link": "https://stackoverflow.com/questions/56732989/understanding-haskells-laziness/56733479#56733479", "title": "Understanding Haskell&#39;s Laziness", "body": "<p>The fact that <code>lines \"a\"</code> produces <code>[\"a\"]</code> does not mean that if you are currently entering <code>a</code>, that <code>lines</code> just processes the input to a list <code>[\"a\"]</code>. You should see the input as a (possibly) infinite list of characters. In case the prompt is waiting for user input, it is thus \"blocking\" on the next input.</p>\n\n<p>That however does <em>not</em> mean that functions like <code>lines</code> can <em>not</em> partially resolve the result already. <code>lines</code> has been implemented in a lazy manner such that it processes the stream of characters, and each time when it sees a new line character, it starts emitting the next element. This thus means that <code>lines</code> could process an infinite sequence of characters into an infinite list of lines.</p>\n\n<p>If you use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:length\" rel=\"nofollow noreferrer\"><strong><code>length :: Foldable f =&gt; f a -&gt; Int</code></strong></a> however, then this requires the list to be evaluated (not the <em>elements</em> of the list however). So that means <code>length</code> will only emit an answer from the moment <code>lines</code> starts emitting the next item.</p>\n\n<p>You can use <code>seq</code> (and variants) to force the evaluation of a term before a certain action is done. For example <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:seq\" rel=\"nofollow noreferrer\"><strong><code>seq :: a -&gt; b -&gt; b</code></strong></a> will evaluate the first parameter to <em>Weak Head Normal Form (WHNF)</em>, and then return the second parameter.</p>\n\n<p>Based on <code>seq</code>, other functions have been constructed, like <a href=\"https://hackage.haskell.org/package/lists-0.4.2/docs/Data-Lists.html\" rel=\"nofollow noreferrer\"><strong><code>seqList :: [a] -&gt; [a]</code></strong></a> in the <a href=\"https://hackage.haskell.org/package/lists-0.4.2/docs/Data-Lists.html#seqList\" rel=\"nofollow noreferrer\"><strong><code>Data.Lists</code></strong> module</a> of the <a href=\"https://hackage.haskell.org/package/lists\" rel=\"nofollow noreferrer\"><strong><code>lists</code></strong></a> package.</p>\n\n<p>We can use this to postpone evaluation until the first line is known, like:</p>\n\n<pre><code>-- will echo full lines\n\nimport Data.Lists(seqList)\n\ninteract (unlines . map (\\x -&gt; seqList x x) . lines)\n</code></pre>\n"}], "owner": {"reputation": 3960, "user_id": 1556475, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dbf54fca536242c214a1f99a6b9b8931?s=128&d=identicon&r=PG", "display_name": "Cameron Ball", "link": "https://stackoverflow.com/users/1556475/cameron-ball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 56733479, "answer_count": 2, "score": 2, "last_activity_date": 1561372505, "creation_date": 1561366280, "question_id": 56732989, "link": "https://stackoverflow.com/questions/56732989/understanding-haskells-laziness", "title": "Understanding Haskell&#39;s Laziness", "body": "<p>I was reading: <a href=\"https://stackoverflow.com/questions/16799755/haskell-interact-function\">Haskell interact function</a></p>\n\n<p>So I tried</p>\n\n<pre><code>interact (unlines . map (show . length) . lines)\n</code></pre>\n\n<p>And it worked as I expected. I type something, press enter, then I get the length printed at the prompt.</p>\n\n<p>So then I wanted to try make it simply repeat what I typed, so I tried</p>\n\n<pre><code>interact (unlines . map id . lines)\n</code></pre>\n\n<p>But now it repeats every character I type in. Why is that? I thought the trick was in the <code>lines</code> followed by <code>unlines</code> - but it's clearly not. <code>lines \"a\"</code> produces <code>[\"a\"]</code>, so how come in the first function when I start typing my input, it doesn't just immediately give \"1\" as the output? There's clearly something I misunderstand about \"Finding the length of a string is not like this -- the whole string must be known before any output can be produced.\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 4, "creation_date": 1561341571, "post_id": 56728970, "comment_id": 100017735, "body": "Try looking up the <i>Writer monad</i> and the <i>State monad</i>. The former is probably best for this particular scenario, but the latter is very widely used and is more generally applicable to other situations."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1561345547, "post_id": 56728970, "comment_id": 100018271, "body": "There are better approaches to this particular problem that others have pointed out, but a nice trick is to use <code>do</code> notation with intensional shadowing, as in <a href=\"http://brandon.si/code/translating-some-stateful-bit-twiddling-to-haskell/\" rel=\"nofollow noreferrer\">brandon.si/code/&hellip;</a> . You can even do this with the instance <code>Monad</code> for <code>((-&gt;) a)</code> rather than Identity if you don&#39;t want to import anything. The only downside is ghc doesn&#39;t yet offer a finer-than-file-level-grained way to disable warnings for shadowing"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1561363162, "post_id": 56728970, "comment_id": 100023489, "body": "^^^ <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2013-July/109116.html\" rel=\"nofollow noreferrer\">Oleg&#39;s post</a>; code: <code>(do { x &lt;- pure foo; x &lt;- pure $ bar x; return $ baz x }) ()</code> (with the function monad)."}], "answers": [{"tags": [], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "is_accepted": false, "score": 7, "last_activity_date": 1561350199, "last_edit_date": 1561350199, "creation_date": 1561342721, "answer_id": 56729156, "question_id": 56728970, "link": "https://stackoverflow.com/questions/56728970/how-to-accumulate-changes-without-renaming-variable/56729156#56729156", "title": "How to accumulate changes without renaming variable?", "body": "<p>You could group the conditions and messages together</p>\n\n<pre><code>checksTodo = [(check1 fails, \"check1 failed\"), (check2 fails, \"check2 failed\")]\n\nerrors = map snd (filter fst checksTodo)\n</code></pre>\n\n<p>If you are comfortable using the list comprehension syntax, you could instead write it in a more readable fashion:</p>\n\n<pre><code>errors = [ msg | (cond, msg) &lt;- checksTodo, cond ]\n</code></pre>\n\n<blockquote>\n  <p>If I simply remove the apostrophes, the compiler returns an error because it gets caught in an infinite loop.</p>\n</blockquote>\n\n<p>This is happening because <code>let</code> bindings in Haskell (unlike most languages) are recursive by default. Which means that if you say</p>\n\n<pre><code>let errors = errors ++ if (check1 fails) then [\"check1 failed\"] else []\n</code></pre>\n\n<p>the compiler will treat it as a recursive definition. When you try to evaluate <code>errors</code> at runtime, you go into an infinite loop as you need <code>errors</code> to compute <code>errors</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": false, "score": 3, "last_activity_date": 1561344944, "creation_date": 1561344944, "answer_id": 56729341, "question_id": 56728970, "link": "https://stackoverflow.com/questions/56728970/how-to-accumulate-changes-without-renaming-variable/56729341#56729341", "title": "How to accumulate changes without renaming variable?", "body": "<p>What <a href=\"https://stackoverflow.com/users/2682729/theindigamer\">theindigamer</a> said, plus, the idiomatic way to do error checking is usually having your checker return an <code>Either</code>: if something goes wrong, produce a <code>Left</code> with the error message, otherwise a <code>Right</code> with the result.</p>\n\n<p>Since, in this case, your checks aren't producing an actual result, you can make the result the unit type <code>()</code>; thus, you can convert your checks to generate <code>Either</code> like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>check1Either = if check1 fails then Left \"check1 failed\" else Right ()\n</code></pre>\n\n<p>And then, just run the checks and filter the elements with a <code>Left</code> using the <code>lefts</code> function in <code>Data.Either</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Either\n\nerrors = lefts [check1Either, check2Either]\n</code></pre>\n\n<p>(You might ask, if there isn't going to be a result to fill <code>Right</code> with, why not use <code>Maybe</code>? You can, and filter errors with <code>catMaybes</code> from <code>Data.Maybe</code>; it's just that <code>Nothing</code> is usually interpreted to mean that the computation failed, and <code>Just</code> usually means success - the opposite of what happens here - whereas, idiomatically speaking <code>Left</code> is usually interpreted as an error)</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1561361528, "creation_date": 1561361528, "answer_id": 56731769, "question_id": 56728970, "link": "https://stackoverflow.com/questions/56728970/how-to-accumulate-changes-without-renaming-variable/56731769#56731769", "title": "How to accumulate changes without renaming variable?", "body": "<p>Another alternative:</p>\n\n<pre><code>let errors = \n       [ \"check1 failed\" | check1 fails ] ++\n       [ \"check2 failed\" | check2 fails ] ++\n       ...\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1561361528, "creation_date": 1561340584, "question_id": 56728970, "link": "https://stackoverflow.com/questions/56728970/how-to-accumulate-changes-without-renaming-variable", "title": "How to accumulate changes without renaming variable?", "body": "<p>I have a list of Strings, <code>errors</code>. I do some checks and if any fail, I append a message to <code>errors</code>. Something like this:</p>\n\n<pre><code>let errors = []\nlet errors' = errors ++ if (check1 fails) then [\"check1 failed\"] else []\nlet errors'' = errors' ++  if (check2 fails) then [\"check2 failed\"] else []\n</code></pre>\n\n<p>Surely there is a more idiomatic way to accumulate changes to <code>errors</code> without making a new variable every time. Do I need to break out <code>Data.IORef</code> for mutable variables? Seems like overkill.</p>\n\n<p>If I simply remove the apostrophes, the compiler returns an error because it gets caught in an infinite loop.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "category-theory"], "answers": [{"comments": [{"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1561595992, "post_id": 56726855, "comment_id": 100119794, "body": "I am still not convinced that adjunction can construct transformers for any monad. If <code>m1</code> and <code>m2</code> are monads with transformers <code>t1</code> and <code>t2</code> then the functor product <code>type p a = (m1 a, m2 a)</code> is also a monad whose transformer <code>t</code> is the functor product of <code>t1</code> and <code>t2</code>.  Can <code>t</code> be obtained via an adjunction? An example is <code>m1 a = r -&gt; a</code> and <code>m2 a = Maybe a</code>, so <code>p a = (r -&gt; a, Maybe a)</code>. The transformer for <code>p</code> is <code>t m a = (r -&gt; m a, m (Maybe a))</code>. To me this does not look like a functor composition <code>u(m(f a))</code> for any functors <code>u</code> and <code>f</code>, whether in or out of <code>Hask</code> category."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1561598983, "post_id": 56726855, "comment_id": 100120241, "body": "@winitzki Off the cuff speculation: if we have a product of monads <code>G * T</code> and a transformer <code>(G . m) * (m . T)</code>, perhaps we might find a monad on Kleisli-<code>G * T</code> that would take, at Haskell level, <code>a -&gt; (G * T) b</code> functions to <code>m a -&gt; ((G . m) * (m . T)) b</code>. I feel there is a non-negligible chance of that working, at least in some cases."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1575682665, "post_id": 56726855, "comment_id": 104659777, "body": "I have not managed to find any examples of a monad that has no monad transformers. However, I found an example of a monad that has two inequivalent monad transformers. Define the type constructor as <code>type L z a = (a -&gt; z) -&gt; a</code>. Then <code>L z</code> is a monad (where <code>z</code> is a fixed type). This monad has two different monad transformers, <code>TL1</code> and <code>TL2</code>: for any foreign monad <code>m</code>, one is <code>TL1 a = (m a -&gt; z) -&gt; m a</code>, and another is <code>TL2 a = (a -&gt; m z) -&gt; m a</code>. I can prove this. But I doubt that one could show rigorously that any of <code>TL1</code> and <code>TL2</code> follows from any adjunction one could construct."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1577044577, "post_id": 56726855, "comment_id": 105077740, "body": "@winitzki <code>TL2</code> (aka <code>SelectT</code>) is, I believe, atypical much like <code>ContT</code> is atypical (on a very tangential note, there was <a href=\"https://blog.poisson.chat/posts/2019-10-27-continuation-submonads.html\" rel=\"nofollow noreferrer\">a nice post about <code>ContT</code></a> by Li-yao Xia a while ago). As for <code>TL1</code>, it looks like a feature-on-the-outside transformer, except of course that <code>L</code>/<code>Select</code> is not distributive but merely rigid, which sounds interesting."}, {"owner": {"reputation": 2845, "user_id": 593934, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/nPK3i.jpg?s=128&g=1", "display_name": "winitzki", "link": "https://stackoverflow.com/users/593934/winitzki"}, "edited": false, "score": 0, "creation_date": 1577199994, "post_id": 56726855, "comment_id": 105119806, "body": "Thank you for pointing to an interesting post about ContT. The composed-outside transformers work for all rigid monads, I have a proof of that. (Also, I am not able to find any examples of rigid functors that are not monads, so maybe they all are.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 15, "last_activity_date": 1561385284, "last_edit_date": 1561385284, "creation_date": 1561315437, "answer_id": 56726855, "question_id": 56726854, "link": "https://stackoverflow.com/questions/56726854/do-monad-transformers-generally-speaking-arise-out-of-adjunctions/56726855#56726855", "title": "Do monad transformers, generally speaking, arise out of adjunctions?", "body": "<p><em>The three constructions in this answer are also available, in a reproducible form, in <a href=\"https://gist.github.com/duplode/ede13d1412253a17ec67cf6eeeb8817e\" rel=\"nofollow noreferrer\">this Gist</a>.</em></p>\n\n<p><a href=\"https://stackoverflow.com/q/49322276/2751851\">Simon C's construction</a>...</p>\n\n<pre><code>newtype Three u f m a = Three { getThree :: u (m (f a)) }\n</code></pre>\n\n<p>... relies on <code>f</code> and <code>u</code> being adjoint Hask endofunctors. While that works out in the case of <code>StateT</code>, there are two connected issues we have to deal with if we are to make it more general:</p>\n\n<ul>\n<li><p>Firstly, we need to find suitable adjunctions for the \"feature monads\" the transformers will be built upon; and</p></li>\n<li><p>Secondly, if such an adjunction takes us away from Hask, we will have to somehow workaround the fact that it won't be possible to use the Hask monad <code>m</code> directly.</p></li>\n</ul>\n\n<p>There are quite a few interesting adjunctions we might experiment with. In particular, there are two adjunctions that are available for every monad: the Kleisli adjunction, and the Eilenberg-Moore adjunction (for a fine categorical presentation of them, see Emily Riehl, <a href=\"http://www.math.jhu.edu/~eriehl/context.pdf\" rel=\"nofollow noreferrer\"><em>Category Theory In Context</em></a>, section 5.2). In the categorical excurse that takes up the first half or so of this answer, I will focus on the Kleisli adjunction, simply because it is more comfortable to wiggle about in pseudo-Haskell.</p>\n\n<p>(By pseudo-Haskell, I mean there will be rampant abuse of notation in what follows. To make it easier on the eyes, I will use some ad hoc conventions: <code>|-&gt;</code> means a mapping between things that aren't necessarily types; similarly, <code>:</code> means something that resembles a type signature; <code>~&gt;</code> means a non-Hask morphism; curly and angled brackets highlight objects in selected non-Hask categories; <code>.</code> also means functor composition; and <code>F -| U</code> means <code>F</code> and <code>U</code> are adjoint functors.)</p>\n\n<h2>Kleisli adjunction</h2>\n\n<p>If <code>g</code> is a Hask <code>Monad</code>, there is a corresponding Kleisli adjunction <code>FK g -| UK g</code> between <code>FK g</code>, which takes us to the <code>g</code>'s Kleisli category...</p>\n\n<pre><code>-- Object and morphism mappings.\nFK g : a          |-&gt; {a}\n       f : a -&gt; b |-&gt; return . f : {a} ~&gt; {b} ~ a -&gt; g b\n-- Identity and composition in Kleisli t are return and (&lt;=&lt;)\n</code></pre>\n\n<p>... and <code>UK g</code>, which takes us back to Hask:</p>\n\n<pre><code>UK g : {a}            |-&gt; g a\n       f : {a} -&gt; {b} |-&gt; join . fmap f : g a -&gt; g b  -- that is, (&gt;&gt;= f)\n\n-- The adjunction isomorphism:\nkla : (FK g a ~&gt; {b}) -&gt; (a -&gt; UK g {b})\nkra : (a -&gt; UK g {b}) -&gt; (FK g a ~&gt; {b})\n-- kla and kra mirror leftAdjunct and rightAdjunct from Data.Functor.Adjunction.\n-- The underlying Haskell type is a -&gt; g b on both sides, so we can simply have:\nkla = id\nkra = id\n</code></pre>\n\n<p>Along the lines of Simon C's <code>Three</code>, let's have <code>g</code> as the feature monad, on which the transformer will be built upon. The transformer will somehow incorporate the effects of another Hask monad, <code>m</code>, which I will sometimes refer to as the \"base monad\", following customary Haskell terminology.</p>\n\n<p>If we attempt to squeeze <code>m</code> between <code>FK g</code> and <code>UK g</code>, we run into the second issue mentioned above: we would need a Kleisli-<code>g</code> endofunctor, rather than a Hask one. There is little else to do but make it up. By that, I mean we can define a functor for functors (more specifically, a functor between the two categories of endofunctors) which will hopefully turn <code>m</code> into something we can use. I will call this \"higher\" functor it <code>HK g</code>. Applying it to <code>m</code> should give something like this:</p>\n\n<pre><code>-- Keep in mind this is a Kleisli-g endofunctor.\nHK g m : {a}                |-&gt; {m a}\n         f : {a} ~&gt; {b}     |-&gt; kmap f : {m a} ~&gt; {m b} ~ m a -&gt; g (m b)\n-- This is the object mapping, taking functors to functors.\n-- The morphism mapping maps natural transformations, a la Control.Monad.Morph:\n         t : \u2200x. m x -&gt; n x |-&gt; kmorph t : \u2200x. {m x} ~&gt; {n x} ~ \u2200x. m x -&gt; g (n x)\n-- I won't use it explicitly, but it is there if you look for it.\n</code></pre>\n\n<h3>Kleisli upon Kleisli</h3>\n\n<p><em>(Note: long-winded categorical twiddling ahead. If you're in a hurry, feel free to skim up to the \"In summary\" subsection.)</em></p>\n\n<p><code>UK g . HK g m . FK g</code> will be a Hask endofunctor, the counterpart to <code>Three</code> construction. We further want it to be a monad on Hask. We can ensure that by setting up <code>HK g m</code> as a monad on the Kleisli-<code>g</code> category. That means we need to figure out counterparts to <code>fmap</code>, <code>return</code> and <code>join</code> on Kleisli-<code>g</code>:</p>\n\n<pre><code>kmap : {a} ~&gt; {b} |-&gt; {m a} ~&gt; {m b}\n       (a -&gt; g b)  -&gt;  m a -&gt; g (m b)\n\nkreturn : {a} ~&gt; {m a}\n          a -&gt; g (m a)\n\nkjoin : {m (m a)} ~&gt; {m a}\n        m (m a) -&gt; g (m a) \n</code></pre>\n\n<p>For <code>kreturn</code> and <code>kjoin</code>, let's try the simplest things that could possibly work:</p>\n\n<pre><code>kreturn :: (Monad g, Monad m) =&gt; a -&gt; g (m a)\nkreturn = return . return \n\nkjoin :: (Monad g, Monad m) =&gt; m (m a) -&gt; g (m a)\nkjoin = return . join\n</code></pre>\n\n<p><code>kmap</code> is somewhat trickier. <code>fmap @m</code> will give out <code>m (g a)</code> instead of <code>g (m a)</code>, so we'd need a way to pull the <code>g</code> layer outside. As it happens, there is a convenient way to do that, but it requires <code>g</code> to be <a href=\"http://hackage.haskell.org/package/distributive-0.6/docs/Data-Distributive.html\" rel=\"nofollow noreferrer\">a <code>Distributive</code> functor</a>:</p>\n\n<pre><code>kmap :: (Monad g, Distributive g, Monad m) =&gt; (a -&gt; g b)  -&gt;  m a -&gt; g (m b)\nkmap f = distribute . fmap f  -- kmap = collect\n</code></pre>\n\n<h3>Laws and distributivity conditions</h3>\n\n<p>Those guesses, of course, mean nothing unless we can show they are lawful:</p>\n\n<pre><code>-- Functor laws for kmap\nkmap return = return\nkmap g &lt;=&lt; kmap f = kmap (g &lt;=&lt; f)\n\n-- Naturality of kreturn\nkmap f &lt;=&lt; kreturn = kreturn &lt;=&lt; f\n\n-- Naturality of kjoin\nkjoin &lt;=&lt; kmap (kmap f) = kmap f &lt;=&lt; kjoin\n\n-- Monad laws\nkjoin &lt;=&lt; kreturn = return\nkjoin &lt;=&lt; kmap kreturn = return\nkjoin &lt;=&lt; kmap kjoin = kjoin &lt;=&lt; kjoin\n</code></pre>\n\n<p>Working it out shows the four conditions for <a href=\"https://stackoverflow.com/a/42298943/2751851\">composing monads with a distributive law</a> are sufficient to ensure the laws hold:</p>\n\n<pre><code>-- dist :: t (g a) -&gt; g (t a)\n-- I'm using `dist` instead of `distribute` and `t` instead of `m` here for the\n-- sake of notation neutrality. \ndist . fmap (return @g) = return @g                 -- #1\ndist . return @t = fmap (return @t)                 -- #2\ndist . fmap (join @g) = join @g . fmap dist . dist  -- #3\ndist . join @t = fmap (join @t) . dist . fmap dist  -- #4\n-- In a nutshell: dist must preserve join and return for both monads.\n</code></pre>\n\n<p>In our case, condition #1 gives <code>kmap</code> identity, <code>kjoin</code> right identity and <code>kjoin</code> associativity; #2 gives <code>kreturn</code> naturality; #3, functor composition; #4, <code>kjoin</code> naturality (<code>kjoin</code> left identity doesn't depend on any of the four conditions). The final sanity check is establishing what it takes for the conditions themselves to hold. In the specific case of <code>distribute</code>, its very strong naturality properties mean the four conditions necessarily hold for any lawful <code>Distributive</code>, so we're good to go.</p>\n\n<h3>Wrapping it up</h3>\n\n<p>The whole <code>UK g . HK g m . FK g</code> monad can be derived from the pieces we already have by splitting <code>HK g m</code> into a Kleisli adjunction, which is entirely analogous to the Kleisli adjunction we began with, except we start from <code>Klesili</code>-g rather than Hask:</p>\n\n<pre><code>HK g m = UHK g m . FHK g m\n\nFHK g m : {a}        |-&gt; &lt;{a}&gt;\n      f : {a} ~&gt; {b} |-&gt; fmap return . f : &lt;{a}&gt; ~&gt; &lt;{b}&gt; ~ a -&gt; g (m b)\n-- kreturn &lt;=&lt; f = fmap (return @m) . f\n-- Note that m goes on the inside, so that we end up with a morphism in Kleisli g.\n\nUHK g m : &lt;{a}&gt;          |-&gt; {m a}\n      f : &lt;{a}&gt; ~&gt; &lt;{b}&gt; |-&gt; fmap join . distribute . fmap f : {m a} ~&gt; {m b} ~ m a -&gt; g (m b)\n-- kjoin &lt;=&lt; kmap f = fmap (join @m) . distribute . fmap f\n\n-- The adjunction isomorphism:\nhkla : (FHK g m {a} ~&gt; &lt;{b}&gt;) -&gt; ({a} ~&gt; UHK g m &lt;{b}&gt;)\nhkra : ({a} ~&gt; UHK g m &lt;{b}&gt;) -&gt; (FHK g m {a} ~&gt; &lt;{b}&gt;)\n-- Just like before, we have:\nhkla = id\nhkra = id\n\n-- And, for the sake of completeness, a Kleisli composition operator:\n-- g &lt;~&lt; f = kjoin &lt;=&lt; kmap g &lt;=&lt; f\n(&lt;~&lt;) :: (Monad g, Distributive g, Monad m)\n    =&gt; (b -&gt; g (m c)) -&gt; (a -&gt; g (m b)) -&gt; (a -&gt; g (m c))\ng &lt;~&lt; f = fmap join . join . fmap (distribute . fmap g) . f\n</code></pre>\n\n<p>Now that we have two adjunctions at hand, we can compose them, leading to the transformer adjunction and, at long last, to <code>return</code> and <code>join</code> for the transformer:</p>\n\n<pre><code>-- The composition of the three morphism mappings in UK g . HK g m . FK g\n-- tkmap f = join . fmap (kjoin &lt;=&lt; kmap (kreturn &lt;=&lt; return . f))\ntkmap :: (Monad g, Distributive g, Monad m) =&gt; (a -&gt; b) -&gt; g (m a) -&gt; g (m b)\ntkmap = fmap . fmap\n\n-- Composition of two adjunction units, suitably lifted through the functors.\n-- tkreturn = join . fmap (hkla hkid) . kla kid = join . fmap kreturn . return\ntkreturn :: (Monad g, Monad m) =&gt; a -&gt; g (m a)\ntkreturn = return . return\n\n-- Composition of the adjunction counits, suitably lifted through the functors.\n-- tkjoin = join . fmap (kjoin &lt;=&lt; kmap (hkra kid &lt;~&lt; (kreturn &lt;=&lt; kra id)))\n--    = join . fmap (kjoin &lt;=&lt; kmap (return &lt;~&lt; (kreturn &lt;=&lt; id)))\ntkjoin :: (Monad g, Distributive g, Monad m) =&gt; g (m (g (m a))) -&gt; g (m a)\ntkjoin = fmap join . join . fmap distribute\n</code></pre>\n\n<p>(For a categorical explanation of the composition of units and counits, see Emily Riehl, <em>Category Theory In Context</em>, proposition 4.4.4.) </p>\n\n<p>As for <code>lift</code>, <code>kmap (return @g)</code> sounds like a sensible definition. That amounts to <code>distribute . fmap return</code> (compare with the <code>lift</code> from <a href=\"https://stackoverflow.com/a/49325487/2751851\">Benjamin Hodgson's answer to Simon C's question</a>), which by condition #1 becomes simply:</p>\n\n<pre><code>tklift :: m a -&gt; g (m a)\ntklift = return\n</code></pre>\n\n<p>The <code>MonadLift</code> laws, which mean <code>tklift</code> must be a monad morphism, do hold, with the <code>join</code> law hinging on distributivity condition #1:</p>\n\n<pre><code>tklift . return = tkreturn\ntklift . join = tkjoin . tkmap tklift . tklift\n</code></pre>\n\n<h3>In summary</h3>\n\n<p>The Kleisli adjunction allows us to construct a transfomer from any <code>Distributive</code> monad by composing it on the outside of any other monad. Putting it all together, we have:</p>\n\n<pre><code>-- This is still a Three, even though we only see two Hask endofunctors.\n-- Or should we call it FourK?\nnewtype ThreeK g m a = ThreeK { runThreeK :: g (m a) }\n\ninstance (Functor g, Functor m) =&gt; Functor (ThreeK g m) where\n    fmap f (ThreeK m) = ThreeK $ fmap (fmap f) m\n\ninstance (Monad g, Distributive g, Monad m) =&gt; Monad (ThreeK g m) where\n    return a = ThreeK $ return (return a)\n    m &gt;&gt;= f = ThreeK $ fmap join . join . fmap distribute \n        $ runThreeK $ fmap (runThreeK . f) m\n\ninstance (Monad g, Distributive g, Monad m) =&gt; Applicative (ThreeK g m) where\n    pure = return\n    (&lt;*&gt;) = ap\n\ninstance (Monad g, Distributive g) =&gt; MonadTrans (ThreeK g) where\n    lift = ThreeK . return\n</code></pre>\n\n<p>The quintessential example of <code>Distributive</code> is the function functor. Composing it on the outside of another monad gives out <code>ReaderT</code>:</p>\n\n<pre><code>newtype KReaderT r m a = KReaderT { runKReaderT :: r -&gt; m a }\n    deriving (Functor, Applicative, Monad) via ThreeK ((-&gt;) r) m\n    deriving MonadTrans via ThreeK ((-&gt;) r)\n</code></pre>\n\n<p>The <code>ThreeK</code> instances perfectly agree with the canonical <code>ReaderT</code> ones.</p>\n\n<h2>Flipped transformers and the Eilenberg-Moore adjunction</h2>\n\n<p>In the derivation above, we stacked the base monad Klesli adjunction atop the feature monad adjunction. We could conceivably do it the other way around, and start from the base monad adjunction. The crucial change that would happen would come about when defining <code>kmap</code>. As the base monad can, in principle, be any monad, we wouldn't want to slap a <code>Distributive</code> constraint on it so that it can be pulled outwards, like we did with <code>g</code> in the derivation above. A better fit for our game plan would be, dually, requiring <code>Traversable</code> from the feature monad, so that it can be pushed inside with <code>sequenceA</code>. This will lead to a transformer that composes the feture monad on the inside, rather than on the outside.</p>\n\n<p>Below is the overall feature-on-the-inside construction. I called it <code>ThreeEM</code> because it can also be obtained by using Eilenberg-Moore adjunctions (instead of Kleisli ones) and stacking them with the base monad on the top, as in Simon C's <code>Three</code>. This fact probably has to do with the duality between the Eilenberg-Moore and Klesili adjunctions. </p>\n\n<pre><code>newtype ThreeEM t m a = ThreeEM { runThreeEM :: m (t a) }\n\ninstance (Functor t, Functor m) =&gt; Functor (ThreeEM t m) where\n    fmap f (ThreeEM m) = ThreeEM $ fmap (fmap f) m\n\ninstance (Monad t, Traversable t, Monad m) =&gt; Monad (ThreeEM t m) where\n    return a = ThreeEM $ return (return a)\n    m &gt;&gt;= f = ThreeEM $ fmap join . join . fmap sequenceA \n      $ runThreeEM $ fmap (runThreeEM . f) m\n\ninstance (Monad t, Traversable t, Monad m) =&gt; Applicative (ThreeEM t m) where\n    pure = return\n    (&lt;*&gt;) = ap\n\n-- In terms of of the Kleisli construction: as the bottom adjunction is now the\n-- base monad one, we can use plain old fmap @m instead of kmap to promote return. \ninstance (Monad t, Traversable t) =&gt; MonadTrans (ThreeEM t) where\n    lift = ThreeEM . fmap return\n</code></pre>\n\n<p>Common transformers that arise in this fashion include <code>MaybeT</code> and <code>ExceptT</code>.</p>\n\n<p>There is one potential pitfall with this construction. <code>sequenceA</code> has to follow the distributivity conditions so that the instances are lawful. Its <code>Applicative</code> constraint, however, makes its naturality propertes a lot weaker than those of <code>distribute</code>, and so the conditions don't all hold for free:</p>\n\n<ul>\n<li><p>Condition #1 does hold: it is a consequence of the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Traversable.html#t:Traversable\" rel=\"nofollow noreferrer\">identity and naturality laws of <code>Traversable</code></a>.</p></li>\n<li><p>Condition #2 also holds: <code>sequenceA</code> preserves natural transformations on the traversable functor as long as those transformations preserve <code>toList</code>. If we regard <code>return</code> as a natural transformation from <code>Identity</code>, that immediately holds case.</p></li>\n<li><p>Condition #3, however, is not guaranteed. It would hold if <code>join @m</code>, taken as a natural transformation from <code>Compose m m</code>, preserved <code>(&lt;*&gt;)</code>, but that might not be the case. If <code>sequenceA</code> actually sequences effects (that is, if the traversable can hold more than one value), any differences arising from the order in which <code>join</code> and <code>(&lt;*&gt;)</code> are performed in the base monad will lead to the condition being violated. That, incidentally, is part of the notorious \"ListT done wrong\" problem: the <code>ListT</code> in transformers, built in accordance with this construction, is only lawful if used with commutative base monads.</p></li>\n<li><p>Finally, condition #4 only holds if <code>join @t</code>, taken as a natural transformation from <code>Compose t t</code>, preserves <code>toList</code> (that is, if it doesn't drop, duplicate, or rearrange elements). One consequence is that this construction won't work for feature monads whose <code>join</code> \"takes the diagonal\" of the nested structure (as is generally the case for monads that also are <code>Distributive</code> instances), even if we try to paper over condition #3 by restricting ourselves to commutative base monads. </p></li>\n</ul>\n\n<p>Those restrictions mean the construction isn't quite as widely applicable as one might like. Ultimately, the <code>Traversable</code> constraint is too broad. What we really need is probably to have the feature monad as an affine traversable (that is, a container that holds at most one element -- see <a href=\"http://oleg.fi/gists/posts/2017-03-20-affine-traversal.html\" rel=\"nofollow noreferrer\">this post by Oleg Grenrus</a> for some lens-flavoured discussion); as far as I'm aware of, there is no canonical Haskell class for that, though.</p>\n\n<h2>Other possibilities</h2>\n\n<p>The constructions described thus far require the feature monad to be <code>Distributive</code> or <code>Traversable</code>, respectively. The overarching strategy, though, is not at all specific to the Kleisli and Eilenberg-Moore adjunctions, so it is conceivable to attempt it while using other adjunctions. The fact that the currying adjunction leads to <code>StateT</code> via Simon C's <code>Three</code>/<code>AdjointT</code>, even though <code>State</code> is neither <code>Distributive</code> nor <code>Traversable</code>, might suggest such attempts could be fruitful. I'm not optimistic about that, however.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/24515876/is-there-a-monad-that-doesnt-have-a-corresponding-monad-transformer-except-io/54177543#comment87610396_24844388\">In a related discussion elsewhere</a>, Benjamin Hodgson conjectures that all adjunctions inducing a monad lead to the same transformer. That sounds very plausible, considering that all such adjunctions are related through unique functors to both the Kleisli and the Eilenberg-Moore adjunctions (on that, see <em>Category Theory in Context</em>, proposition 5.2.12). Case in point: if we attempt <code>List</code> with the <code>ThreeK</code> construction but using the free/forgetful adjunction to the category of monoids instead of Kleisli-<code>[]</code>, we end up with the <code>m []</code> transformer the <code>ThreeEM</code>/feature-on-the-inside construction would give us, down to the \"ListT done wrong problem\" of needing <code>join</code> to be an applicative homomorphism.</p>\n\n<p>What about <code>State</code> and its transformer-producing third adjunction, then? Though I haven't worked it out in detail, I suspect it is more appropriated to think of <code>distribute</code> and <code>sequenceA</code>, as used in the constructions here, as belonging to the right and left adjoints, respectively, rather than to the whole feature monad. In the case of <code>distribute</code>, that would amount to looking beyond the Haskell type signature...</p>\n\n<pre><code>distribute :: (Distribute g, Functor m) =&gt; m (g a) -&gt; g (m a)\n</code></pre>\n\n<p>... to see a natural transformation between Kleisli-<code>g</code>-to-Hask functors:</p>\n\n<pre><code>distribute  : m . UK g |-&gt; UK g . HK g m\n</code></pre>\n\n<p>If I am right about that, it will be possible to turn this answer around and reinterpret the <code>Three</code>/<code>AdjointT</code> construction in terms of the Kleisli adjunction of the feature monad. If that is the case, <code>State</code> doesn't tell us much at all about other feature monads that are neither <code>Distributive</code> nor <code>Traversable</code>.</p>\n\n<h3>ListT done right</h3>\n\n<p>It is also worth noting that not all transformers come about from blending monadic effects through the composition of adjunctions in the way have seen here. In <em>transformers</em>, <code>ContT</code> and [<code>SelectT</code> do not follow the pattern; however, I'd say they are too wacky to be discussed in this context (\"not a functor on the category of monads\", <a href=\"http://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-Cont.html#t:ContT\" rel=\"nofollow noreferrer\">as the docs point out</a>). A better example is provided by the various <a href=\"http://hackage.haskell.org/package/pipes-4.3.10/docs/Pipes-Tutorial.html#g:6\" rel=\"nofollow noreferrer\">\"ListT done right\"</a> implementations, which avoid the unlawfulness problems associated with <code>sequenceA</code> (as well as the loss of streaming problems) by enmeshing the base monad effects in a way that doesn't require sequencing them in the bind of the transformer. Here is a sketch of an implementation, for illustrative purposes:</p>\n\n<pre><code>-- A recursion-schemes style base functor for lists.\ndata ListF a b = Nil | Cons a b\n    deriving (Eq, Ord, Show, Functor)\n\n-- A list type might be recovered by recursively filling the functorial\n-- position in ListF.\nnewtype DemoList a = DemoList { getDemoList :: ListF a (DemoList a) }\n\n-- To get the transformer, we compose the base monad on the outside of ListF.\nnewtype ListT m a = ListT { runListT :: m (ListF a (ListT m a)) }\n    deriving (Functor, Applicative, Alternative) via WrappedMonad (ListT m)\n\n-- Appending through the monadic layers. Note that mplus only runs the effect\n-- of the first ListF layer; everything eslse can be consumed lazily.\ninstance Monad m =&gt; MonadPlus (ListT m) where\n    mzero = ListT $ return Nil\n    u `mplus` v = ListT $ runListT u &gt;&gt;= \\case\n        Nil -&gt; runListT v\n        Cons a u' -&gt; return (Cons a (u' `mplus` v))\n\n-- The effects are kept apart, and can be consumed as they are needed.\ninstance Monad m =&gt; Monad (ListT m) where\n    return a = ListT $ pure (Cons a mzero)\n    u &gt;&gt;= f = ListT $ runListT u &gt;&gt;= \\case\n        Nil -&gt; return Nil\n        Cons a v -&gt; runListT $ f a `mplus` (v &gt;&gt;= f)\n\ninstance MonadTrans ListT where\n    lift m = ListT $ (\\a -&gt; Cons a mzero) &lt;$&gt; m\n</code></pre>\n\n<p>In this <code>ListT</code>, the base monad effects are neither on the inside nor on the outside of the list. Rather, they are bolted on the spine of the list, made tangible by defining the type in terms of <code>ListF</code>.</p>\n\n<p>Related transformers that are built in a similar way include the free-monad transformer <a href=\"http://hackage.haskell.org/package/free-5.1.1/docs/Control-Monad-Trans-Free.html\" rel=\"nofollow noreferrer\"><code>FreeT</code></a>, as well as the core monad transformers from effectful streaming libraries (it is no coincidence that the \"ListT done right\" link I included above points to the <em>pipes</em> documentation).</p>\n\n<p>Can this kind of transformer be somehow related to the adjunction stacking strategy describe here? I haven't looked sufficiently hard at the matter to tell; it looks like an interesting question to ponder about.</p>\n"}], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 5, "answer_count": 1, "score": 16, "last_activity_date": 1561385284, "creation_date": 1561315437, "question_id": 56726854, "link": "https://stackoverflow.com/questions/56726854/do-monad-transformers-generally-speaking-arise-out-of-adjunctions", "title": "Do monad transformers, generally speaking, arise out of adjunctions?", "body": "<p>In <a href=\"https://stackoverflow.com/q/49322276/2751851\"><em>Adjoint functors determine monad transformers, but where's lift?</em></a>, Simon C has shown us the construction...</p>\n\n<pre><code>newtype Three u f m a = Three { getThree :: u (m (f a)) }\n</code></pre>\n\n<p>... which, as the answers there discuss, can be given an <code>instance Adjunction f u =&gt; MonadTrans (Three u f)</code> (<em>adjunctions</em> provides it as <a href=\"http://hackage.haskell.org/package/adjunctions-4.4/docs/Control-Monad-Trans-Adjoint.html\" rel=\"noreferrer\"><code>AdjointT</code></a>). Any Hask/Hask adjunction thus leads to a monad transformer; in particular, <code>StateT s</code> arises in this manner from the currying adjunction between <code>(,) s</code> and <code>(-&gt;) s</code>.</p>\n\n<p>My follow-up question is: does this construction generalise to other monad transformers? Is there a way to derive, say, the other transformers from the <em>transformers</em> package from suitable adjunctions?</p>\n\n<hr>\n\n<p>Meta remarks: my answer here was originally written for Simon C's question. I opted to spin it off into a self-answered question because, upon rereading that question, I noticed my purported answer had more to do with the discussion in the comments over there than with the question body itself. Two other closely related questions, to which this Q&amp;A arguably is also a follow-up, are <a href=\"https://stackoverflow.com/q/24515876/2751851\"><em>Is there a monad that doesn't have a corresponding monad transformer (except IO)?</em></a> and <a href=\"https://stackoverflow.com/q/42284879/2751851\"><em>Is the composition of an arbitrary monad with a traversable always a monad?</em></a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561301468, "post_id": 56724999, "comment_id": 100010037, "body": "Exactly what is <code>MixLog</code> doing here?"}, {"owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561301780, "post_id": 56724999, "comment_id": 100010132, "body": "In my opinion, MixLog can solve constructor problem"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561301905, "post_id": 56724999, "comment_id": 100010169, "body": "but a 2-tuple has a data constructor: <code>(,)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "edited": false, "score": 0, "creation_date": 1561302749, "post_id": 56725037, "comment_id": 100010386, "body": "Thank you, it&#39;s already solve this problem of mine, furthermore, can I make this question more generally,  if I have defined ten instances in Log, and only want four of them works for Log (a, b), how can I make type constraints?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "edited": false, "score": 0, "creation_date": 1561302806, "post_id": 56725037, "comment_id": 100010397, "body": "@MorgenYang: you can implement these by mentioning it separately, like <code>instance Log (LastMsgLog, ReverseLog)</code>."}, {"owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "edited": false, "score": 0, "creation_date": 1561314565, "post_id": 56725037, "comment_id": 100013299, "body": "Just for sure, do you mean, in the 4 in 10 situation, I have to give 16 combinations of type constraints for this instance?  Thx"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "edited": false, "score": 1, "creation_date": 1561314730, "post_id": 56725037, "comment_id": 100013346, "body": "@MorgenYang: you could also make an <code>class SpecificLog</code>, make your four loggers a member, and then make the construct <code>instance (SpecificLog a, SpecificLog b) =&gt; Log (a, b)</code>, so you can define a &quot;subset&quot; through a type class."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1561302899, "last_edit_date": 1561302899, "creation_date": 1561301666, "answer_id": 56725037, "question_id": 56724999, "link": "https://stackoverflow.com/questions/56724999/how-can-defined-a-log-instance-for-a-b-under-the-assumption-which-a-b-are-a/56725037#56725037", "title": "How can defined a Log-instance for (a, b) under the assumption, which a, b are already Log-instance?", "body": "<p>If you want to make <code>MixLog</code> an instance of <code>Log</code>, you thus can implement this as:</p>\n\n<pre><code>data MixLog <b>a</b> <b>b</b> = MixLog (a, b)\n\ninstance (Log a, Log b) =&gt; Log (MixLog <b>a</b> <b>b</b>) where\n  logMsg x = <b>MixLog</b> (logMsg x, logMsg x)</code></pre>\n\n<p>You thus need to specify type parameters <code>a</code> and <code>b</code> in your <code>MixLog</code> type constructor, furthermore we define the <code>logMsg :: Log c =&gt; String -&gt; c</code> function with <code>MixLog</code> objects, so we construct a <code>MixLog</code> with a 2-tuple where both elements are the result of a <code>logMsg x</code> call (or we can implement this differently).</p>\n\n<p>You can however omit the <code>MixLog</code> data constructor, and implement this as:</p>\n\n<pre><code>instance (Log a, Log b) =&gt; Log <b>(a,b)</b> where\n  logMsg x = (logMsg x, logMsg x)</code></pre>\n\n<p>There is nothing special about a 2-tuple, so we can use its type constructor, and data constructor.</p>\n"}], "owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 56725037, "answer_count": 1, "score": 4, "last_activity_date": 1561302899, "creation_date": 1561301369, "question_id": 56724999, "link": "https://stackoverflow.com/questions/56724999/how-can-defined-a-log-instance-for-a-b-under-the-assumption-which-a-b-are-a", "title": "How can defined a Log-instance for (a, b) under the assumption, which a, b are already Log-instance?", "body": "<p>It's a homework for us to understanding instance, but as the title, I don't know 'How to define a Log-instance (a, b), which a and b is also Log-instance'.</p>\n\n<pre><code>data FullLog = FullLog [String] deriving Show\n\ninstance Semigroup FullLog where\n  FullLog a &lt;&gt; FullLog b = FullLog (a ++ b)\n\ninstance Monoid FullLog where\n  mempty = FullLog []\n\ninstance Log FullLog where\n  logMsg x = FullLog [x]\n\n-- *Main&gt; fib 3 :: (Int, ReverseLog)\n-- (3,ReverseLog [\"fib 3\",\"fib 1\",\"fib 2\",\"fib 0\",\"fib 1\"])\n-- instance Log ReverseLog where\ndata ReverseLog = ReverseLog [String] deriving Show\n\ninstance Semigroup ReverseLog where\n  ReverseLog a &lt;&gt; ReverseLog b = ReverseLog (b ++ a)\n\ninstance Monoid ReverseLog where\n  mempty = ReverseLog []\n\ninstance Log ReverseLog where\n  logMsg x = ReverseLog [x]\n\n\n-- *Main&gt; fib 3 :: (Int, LastMsgLog)\n-- (3,LastMsgLog (Just \"fib 3\"))\n--instance Log LastMsgLog where\ndata LastMsgLog = LastMsgLog (Maybe String) deriving Show\n\ninstance Semigroup LastMsgLog where\n  LastMsgLog a &lt;&gt; LastMsgLog b = LastMsgLog (b)\n\ninstance Monoid LastMsgLog where\n  mempty = LastMsgLog (Nothing)\n\ninstance Log LastMsgLog where\n  logMsg x = LastMsgLog (Just x)\n\n-- *Main&gt; fib 3 :: (Int, CountLog)\n-- (3,CountLog 5)\n--instance Log CountLog where\ndata CountLog = CountLog Int deriving Show\n\ninstance Semigroup CountLog where\n  CountLog a &lt;&gt; CountLog b = CountLog (a+b)\n\ninstance Monoid CountLog where\n  mempty = CountLog 0\n\ninstance Log CountLog where\n  logMsg x = CountLog 1\n</code></pre>\n\n<p>I have already finished 4 instance of Log : FullLog, ReverseLog, LastMsgLog and CountLog, \nNow I need to define Log-instance(a,b), where a and b can be any of FullLog, ReverseLog, LastMsgLog and CountLog.</p>\n\n<p>I have tried directly define <code>Log (a,b)</code>, and error is like <code>Not in scope: data constructor \u2018Log\u2019</code>, that's obvious.</p>\n\n<p>So I tried to define a type <code>MixLog</code> like above </p>\n\n<pre><code>data MixLog = MixLog (a, b) deriving Show\n\ninstance MixLog :: (Log a, Log b) =&gt; Log (a, b) where\n  Log ( a,  b) &lt;&gt; Log ( c,  d ) = Log (a &lt;&gt; c, b &lt;&gt; d)\n\n</code></pre>\n\n<p>but also <code>error: parse error on input \u2018::\u2019</code></p>\n\n<p>So now I'm confused, how can I make type constraints?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "filter"], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1561295193, "post_id": 56724171, "comment_id": 100008411, "body": "The OP did specifically say he was required to use <code>filter</code>. But this is definitely how I would do it if I had to implement this in a program."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1561295256, "last_edit_date": 1561295256, "creation_date": 1561295147, "answer_id": 56724171, "question_id": 56724135, "link": "https://stackoverflow.com/questions/56724135/using-filter-with-custom-datatypes/56724171#56724171", "title": "Using filter with custom datatypes", "body": "<p>You can not use an equality check <code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code> with variables like <code>first</code> and <code>second</code>, if these do not have a value. What you need here is <em>pattern matching</em>.</p>\n\n<p>We can for example use list comprehension:</p>\n\n<pre><code>foo :: Program -&gt; Int\nfoo list = length [ v | <b>v@(Front _) &lt;-</b> list ]</code></pre>\n\n<p>There is no need to match the parameter with <code>Val {}</code>, or <code>Val _ _ _</code>, etc. since the only data constructor for the <code>Val</code> type is <code>Val</code>.</p>\n\n<p>In case you think you will later add more data constructors, you can however add an extra subpattern:</p>\n\n<pre><code>foo :: Program -&gt; Int\nfoo list = length [ v | v@(Front <b>(Val {})</b>) &lt;- list ]</code></pre>\n\n<p>Or we can do the pattern matching in a function and use <code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code>, like:</p>\n\n<pre><code>foo :: Program -&gt; Int\nfoo = length . filter f\n    where f <b>(Front _)</b> = True\n          f _ = False</code></pre>\n\n<p>or if we include the <code>Val</code> data constructor check:</p>\n\n<pre><code>foo :: Program -&gt; Int\nfoo = length . filter f\n    where f (Front <b>(Val {})</b>) = True\n          f _ = False</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 5, "last_activity_date": 1561295535, "creation_date": 1561295535, "answer_id": 56724217, "question_id": 56724135, "link": "https://stackoverflow.com/questions/56724135/using-filter-with-custom-datatypes/56724217#56724217", "title": "Using filter with custom datatypes", "body": "<p>As @WillemVanOnsem said in his answer, the approach you're using doesn't work. Try using <code>filter (\\x -&gt; case x of { Front _ -&gt; True; Back _ -&gt; False }) list</code>. You may be able to work out how this works from that alone, but if you need any more details:</p>\n\n<ul>\n<li><code>\\x -&gt; case x of { Front _ -&gt; True; Back _ -&gt; False }</code> is a <em>lambda expression</em>. It defines an unnamed (or <em>anonymous</em>) function which takes one parameter, named <code>x</code>, and returns the value given by <code>case x of { Front _ -&gt; True; Back _ -&gt; False }</code>.</li>\n<li><code>case x of { Front _ -&gt; True; Back _ -&gt; False }</code> does <em>pattern matching</em> on <code>x</code>. If <code>x</code> is of the form <code>Front _</code>, where <code>_</code> can be anything, then it returns <code>True</code>; otherwise it returns <code>False</code>. Normally this statement would be formatted like this:</li>\n</ul>\n\n<pre><code>case x of\n    Front _ -&gt; True\n    Back _ -&gt; False\n</code></pre>\n\n<p>But the compact syntax above is shorter and so works better in this case.</p>\n\n<ul>\n<li>The lambda expression above - which as discussed returns <code>True</code> when its argument is of the form <code>Front _</code> - is then passed to <code>filter</code> as its argument.</li>\n</ul>\n"}], "owner": {"reputation": 122, "user_id": 9500680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cb43298b64ce18abc6d4b6954918e2?s=128&d=identicon&r=PG&f=1", "display_name": "Bhushan Oza", "link": "https://stackoverflow.com/users/9500680/bhushan-oza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 56724217, "answer_count": 2, "score": 3, "last_activity_date": 1561305139, "creation_date": 1561294905, "last_edit_date": 1561305139, "question_id": 56724135, "link": "https://stackoverflow.com/questions/56724135/using-filter-with-custom-datatypes", "title": "Using filter with custom datatypes", "body": "<p>I have these datatypes:</p>\n\n<pre><code>data Command = Back Int | Front Val deriving (Show,Eq)\ndata Val = Val {first::Int, second::Int, third::Int} deriving (Show, Eq)\ntype Program = [Command]\n</code></pre>\n\n<p>I have this function:</p>\n\n<pre><code>foo :: Program -&gt; Int\nfoo list = length (filter (==Front Val {first, second, third}) list)\n</code></pre>\n\n<p>The purpose is to find how many times a Front occurs USING FILTER ONLY, and foo gives compilation error. I am not sure how to represent the integer/val part of Front. </p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561285371, "post_id": 56722924, "comment_id": 100006361, "body": "You can define the functions in your separate files, and import these in the <code>Main</code>. This is more or less how it is done in the <code>yesod-mysql</code> stack template. As long as <code>getHomeR</code> is in the <i>scope</i> of the <code>parseRoutes</code> you are fine, so with a simple <code>import</code> you put these in scope."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561286171, "post_id": 56722924, "comment_id": 100006529, "body": "@WillemVanOnsem: if I do this I have an import cycle. I updated my question."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561286214, "post_id": 56722924, "comment_id": 100006542, "body": "Usually in yesod the idea is that you make a <code>data App = App</code> and <code>instance Yesod App</code> in a <code>Foundation.hs</code> file, then you can import that in the <code>Handler.hs</code> file(s), and then you import these handler&#39;s in the <code>Main.hs</code> file where you thus import the <code>App</code> and the <code>Handler</code>s."}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561286519, "post_id": 56722924, "comment_id": 100006598, "body": "@WillemVanOnsem: hmmm, and where do I put the <code>mkYesod &quot;App&quot;</code> call? Actual working source code would be very appreciated :)"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561286748, "post_id": 56722924, "comment_id": 100006655, "body": "@WillemVanOnsem: I just looked at the templates. Actually, none of the templates use &quot;mkYesod&quot;. They use &quot;mkYesodData&quot; and &quot;mkYesodDispatch&quot;. Maybe that&#39;s why."}], "answers": [{"tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": true, "score": 3, "last_activity_date": 1561290397, "creation_date": 1561290397, "answer_id": 56723537, "question_id": 56722924, "link": "https://stackoverflow.com/questions/56722924/split-yesod-app-source-code-into-multiple-source-files/56723537#56723537", "title": "Split yesod app source code into multiple source files", "body": "<p>I finally figured it out on my own.</p>\n\n<p>The <a href=\"https://www.stackage.org/haddock/lts-13.26/yesod-core-1.6.14/Yesod-Core-Dispatch.html#v:mkYesodData\" rel=\"nofollow noreferrer\">mkYesodData documentation</a> says:</p>\n\n<blockquote>\n  <p>Sometimes, you will want to declare your routes in one file and define your handlers elsewhere. For example, this is the only way to break up a monolithic file into smaller parts. Use this function, paired with mkYesodDispatch, to do just that.</p>\n</blockquote>\n\n<p>You have to create a Foundation module where the <code>App</code> and the Yesod instance lives:</p>\n\n<p><strong>Foundation.hs</strong>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Foundation where\n\nimport Yesod\n\ndata App = App\n\nmkYesodData \"App\" [parseRoutes|\n/    HomeR    GET\n|]\n\ninstance Yesod App\n</code></pre>\n\n<p>In your <strong>Main.hs</strong>, you call the routes:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Main where\n\nimport Yesod\nimport Foundation\nimport GetHomeR (getHomeR)\n\nmkYesodDispatch \"App\" resourcesApp\n\nmain = warp 8080 App\n</code></pre>\n\n<p>which in turn calls getHomeR from the GetHomeR module. <strong>GetHomeR.hs</strong>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule GetHomeR (getHomeR) where\n\nimport Yesod\nimport Foundation\n\ngetHomeR :: Handler Html\ngetHomeR = defaultLayout $ toWidget [hamlet|Hello Stackoverflow|]\n</code></pre>\n\n<hr>\n\n<p>mkYesod is basically like mkYesodData + mkYesodDispatch, with the difference that mkYesodData + mkYesodDispatch cannot be in the same file because of the \"stage restriction\" (error message: \"GHC stage restriction: `resourcesApp' is used in a top-level splice, quasi-quote, or annotation, and must be imported, not defined locally\")</p>\n\n<p>All the route handlers (getHomeR, ...) must be visible at the point where <code>mkYesodDispatch</code> (or <code>mkYesod</code>) is called.</p>\n"}], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 56723537, "answer_count": 1, "score": 2, "last_activity_date": 1561290397, "creation_date": 1561285261, "last_edit_date": 1561286180, "question_id": 56722924, "link": "https://stackoverflow.com/questions/56722924/split-yesod-app-source-code-into-multiple-source-files", "title": "Split yesod app source code into multiple source files", "body": "<p>This is really a beginner question, but I cannot find anything about it on the web or on stackoverflow. Maybe I just searched wrong..</p>\n\n<p>I have a yesod application where everything is in one file, and I cannot figure out how to move the functions into separate files. Here is a minimal example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Main where\n\nimport Yesod\n\ndata App = App\nmkYesod \"App\" [parseRoutes|\n/    HomeR    GET\n|]\ninstance Yesod App\n\ngetHomeR = defaultLayout $ toWidget [hamlet|Hello Stackoverflow|]\n\nmain = warp 8080 App\n</code></pre>\n\n<p>How do I move the <code>getHomeR</code> function into a separate file? In <code>getHomeR</code>, I need access to <code>App</code>, but <code>mkYesod \"App\"</code> needs access to <code>getHomeR</code>. This looks like a cyclic dependency. But somehow it must be possible to create yesod applications consisting of more than one source file.</p>\n\n<p>What I <em>can</em> do is move functionality that is independent of <code>App</code> into separate files. But when <code>App</code> grows and contains more and more functionality, this becomes inconvenient, because all top level handler functions still need to be in the same file. And I don't want to use the yesod template, because I don't understand what it is doing.</p>\n\n<hr>\n\n<p>to address a proposed solution from the comments:</p>\n\n<blockquote>\n  <p>You can define the functions in your separate files, and import these in the Main. This is more or less how it is done in the yesod-mysql stack template.</p>\n</blockquote>\n\n<p>error message: \"No instance for (Yesod site0) arising from a use of `defaultLayout'\".<br>\nAnd when I <code>import Main</code> in GetHomeR.hs, the error message becomes \"Ambiguous type variable <code>site0' arising from a use of</code>defaultLayout'\".<br>\nAnd when I add a <code>getHomeR :: Handler Html</code>, it compiles for a moment, but: now I have to <code>import GetHomeR</code> from Main.hs . And GHC complains with a warning about a cyclic dependency:</p>\n\n<pre><code>Module imports form a cycle:\n         module `Main' (app\\Main.hs)\n        imports `GetHomeR' (app\\GetHomeR.hs)\n  which imports `Main' (app\\Main.hs)\n</code></pre>\n\n<p>this doesn't feel right. Is this the right way to do it?</p>\n"}, {"tags": ["list", "haskell", "filter", "filtering", "predicate"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1561275048, "post_id": 56721855, "comment_id": 100004378, "body": "Can you please explain why you expect that outcome? I can&#39;t grasp the logic which you expect <code>filter snd</code> to use."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1561275836, "post_id": 56721855, "comment_id": 100004544, "body": "@RobinZigmond: I think Jesse thinks that it means &quot;filtering out every second element&quot; as in one retaining, one removing, one retaining, ..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561276975, "post_id": 56721855, "comment_id": 100004766, "body": "@WillemVanOnsem no, just the second one <i>in a list</i>. they&#39;ve added an example."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1561277319, "post_id": 56721855, "comment_id": 100004810, "body": "here in <i>this</i> use case, <code>snd</code> is the same as <code>(\\ x -&gt; snd x == True)</code> is the same as <code>(\\ (_,b) -&gt; b == True)</code>, which might be clearer for you. but of course just <code>snd</code> (which is the same as <code>(\\ (_,b) -&gt; b)</code>) is the preferred spelling. the implied <code>(== True)</code> is part of the <code>filter</code> semantics, i.e. it is how the <code>filter</code> works."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 9684220, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jesse", "link": "https://stackoverflow.com/users/9684220/jesse"}, "edited": false, "score": 0, "creation_date": 1561275860, "post_id": 56721872, "comment_id": 100004549, "body": "so it filter second value, why return [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;]? I mean, it filter all second of each pair."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 149, "user_id": 9684220, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jesse", "link": "https://stackoverflow.com/users/9684220/jesse"}, "edited": false, "score": 0, "creation_date": 1561276077, "post_id": 56721872, "comment_id": 100004594, "body": "@Jesse: no <code>filter snd</code> on a list of elements that are no 2-tuples, or 2-tuples without the second item being a <code>Bool</code> makes no sense."}], "tags": [], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "is_accepted": false, "score": 4, "last_activity_date": 1561274893, "creation_date": 1561274893, "answer_id": 56721872, "question_id": 56721855, "link": "https://stackoverflow.com/questions/56721855/how-function-snd-in-haskell-works-in-filter/56721872#56721872", "title": "How function snd in Haskell works in filter", "body": "<p>Your <code>filter</code> function filters your list according to the second value of each pair. This is why <code>('c',False)</code> is filtered out ...</p>\n"}, {"tags": [], "owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "is_accepted": false, "score": 9, "last_activity_date": 1561279762, "last_edit_date": 1561279762, "creation_date": 1561275765, "answer_id": 56721965, "question_id": 56721855, "link": "https://stackoverflow.com/questions/56721855/how-function-snd-in-haskell-works-in-filter/56721965#56721965", "title": "How function snd in Haskell works in filter", "body": "<p>You expect <code>filter</code> to \"filter out\" elements from a list in the <a href=\"https://www.macmillandictionary.com/dictionary/british/filter-out\" rel=\"nofollow noreferrer\">colloquial sense</a> of that expression, and thus <code>filter snd</code>  to remove the second item.</p>\n\n<p>That is not how it works </p>\n\n<p>If you were right, <code>filter snd [1,2,3]</code> would evaluate to <code>[1,3]</code>. Instead, it doesn't typecheck, as <code>snd</code> works on tuples, not on numbers.</p>\n\n<p>So, how does it work?</p>\n\n<p><code>filter f [item1, item2, ...]</code> returns a list of all <code>item</code>s for which <code>f item</code> is <code>True</code></p>\n\n<p>For example, <code>filter even [1,2,3,4]</code> returns <code>[2,4]</code></p>\n\n<p>As <code>snd ('b', True)</code> evaluates to <code>True</code>, in your example <code>filter</code> will include <code>(b, True)</code> in the result. By the same token, <code>(c, False)</code> will be omitted</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1561278552, "last_edit_date": 1561278552, "creation_date": 1561275786, "answer_id": 56721967, "question_id": 56721855, "link": "https://stackoverflow.com/questions/56721855/how-function-snd-in-haskell-works-in-filter/56721967#56721967", "title": "How function snd in Haskell works in filter", "body": "<p><strong>In short</strong>: <code>filter snd</code> retains 2-tuples where the second item of the tuple is <code>True</code>.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><strong><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code></strong></a> takes as parameter a function that maps elements of type <code>a</code> to a <code>Bool</code>. In case the <code>Bool</code> is <code>True</code> it will retain the element of the original list in the result, otherwise that element will not be part of the result.</p>\n\n<p><code>filter</code> thus filters <em>elementwise</em>: it does <em>not</em> take into account the next or previous element(s) in the list. It simply checks if a predicate on an element is satisfied.</p>\n\n<p>Since you here have a list of 2-tuples where the second item of each tuple is a <code>Bool</code>, the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:snd\" rel=\"nofollow noreferrer\"><strong><code>snd :: (a, b) -&gt; b</code></strong></a> will thus map each element on the second element, and thus retain 2-tuples where the second item of the 2-tuple is <code>True</code>. The most generic type of <code>filter snd</code> is thus <code>filter snd :: [(a, Bool)] -&gt; [(a, Bool)]</code>, since the second item of the 2-tuples should be a <code>Bool</code>.</p>\n\n<p>This thus means that <code>filter snd</code> indeed will filter like:</p>\n\n<pre><code>Prelude&gt; filter snd [('a',True),('b',True),('c',False),('d',True)]\n[('a',True),('b',True),('d',True)]\n</code></pre>\n\n<p>We can filter out every second element with explicit recursion for example:</p>\n\n<pre><code>filterAtEven :: [a] -&gt; [a]\nfilterAtEven [] = []\nfilterAtEven (x:xs) = x : filterAtOdd xs\n\nfilterAtOdd :: [a] -&gt; [a]\nfilterAtOdd [] = []\nfilterAtOdd (_:xs) = filterAtEven xs\n</code></pre>\n\n<p>for example:</p>\n\n<pre><code>Prelude&gt; filterAtEven [('a',True),('b',True),('c',False),('d',True)]\n[('a',True),('c',False)]\nPrelude&gt; filterAtOdd [('a',True),('b',True),('c',False),('d',True)]\n[('b',True),('d',True)]\n</code></pre>\n\n<p>Or if you want to remove a specific index, we can make use of <a href=\"https://hackage.haskell.org/package/ilist-0.3.1.0/docs/Data-List-Index.html#v:deleteAt\" rel=\"nofollow noreferrer\"><strong><code>deleteAt :: Int -&gt; [a] -&gt; [a]</code></strong></a> of the <a href=\"https://hackage.haskell.org/package/ilist-0.3.1.0\" rel=\"nofollow noreferrer\"><strong><code>ilist</code></strong></a> package:</p>\n\n<pre><code>Prelude&gt; import Data.List.Index\nPrelude Data.List.Index&gt; deleteAt 2 [('a',True),('b',True),('c',False),('d',True)]\n[('a',True),('b',True),('d',True)]\n</code></pre>\n\n<p>or we can implement this ourselves:</p>\n\n<pre><code>deleteAt :: Int -&gt; [a] -&gt; [a]\ndeleteAt i | i &lt; 0 = id\n           | otherwise = go i\n  where go _ [] = []\n        go 0 (_:xs) = xs\n        go n (x:xs) = x : go (n-1) xs\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 9684220, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jesse", "link": "https://stackoverflow.com/users/9684220/jesse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 614, "favorite_count": 0, "accepted_answer_id": 56721967, "answer_count": 3, "score": 3, "last_activity_date": 1561303239, "creation_date": 1561274705, "last_edit_date": 1561303239, "question_id": 56721855, "link": "https://stackoverflow.com/questions/56721855/how-function-snd-in-haskell-works-in-filter", "title": "How function snd in Haskell works in filter", "body": "<p>I type this code to ghci</p>\n\n<pre><code>Prelude&gt; filter snd [('a',True),('b',True),('c',False),('d',True)]\n</code></pre>\n\n<p>why it returns</p>\n\n<pre><code>[('a',True),('b',True),('d',True)]\n</code></pre>\n\n<p>rather than</p>\n\n<pre><code>[('a',True),('c',False),('d',True)]\n</code></pre>\n\n<p><code>snd</code> function returns the second item, so why not <code>filter snd</code> filter the second item?</p>\n"}, {"tags": ["function", "haskell", "syntax", "definition", "guard-clause"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 7, "creation_date": 1561224581, "post_id": 56717648, "comment_id": 99996989, "body": "No you forgot a <code>=</code> after the <code>otherwise</code>, it is <code>otherwise = [x] ++ rems k xs</code>. You can improve it (slightly), by writing <code>otherwise = (x: rems k xs)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1561228793, "post_id": 56717762, "comment_id": 99997845, "body": "an additional extra space to the right of <code>=</code> as well is even clearer (and symmetry is beautiful). another terrible-looking type of code is with <code>let</code> on the RHS. <code>foo x | x == y = let z = bar y x in ...</code>. brr."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1561237703, "post_id": 56717762, "comment_id": 99999710, "body": "@WillNess well, it&#39;s <i>not</i> symmetric \u2013 the RHS is really part of an <code>a = b</code> like in other definitions, but the LHS is something completely different. That&#39;s also a reason why I like to have extra space on the left."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1561275637, "post_id": 56717762, "comment_id": 100004498, "body": "it&#39;s the <i>space</i> around the <code>=</code> sign that ought to be symmetric IMO, guard or no guard. in any case it&#39;s aesthetically pleasing <i>to me</i> that way; YMMV."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1561225970, "last_edit_date": 1561225970, "creation_date": 1561225658, "answer_id": 56717762, "question_id": 56717648, "link": "https://stackoverflow.com/questions/56717648/haskell-gets-confused-with-horizontal-lines/56717762#56717762", "title": "Haskell gets confused with horizontal lines", "body": "<p>It might be useful to know that <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:otherwise\" rel=\"noreferrer\"><code>otherwise</code></a> isn't a keyword or special symbol like <code>=</code>, it's actually simply a boolean value defined in the prelude as <code>True</code>. I.e., a guard with <code>otherwise</code> works syntactically the same as any other guard, just the condition is trivial. You might also write it</p>\n\n<pre><code>rems _ [] = []\nrems k (x:xs)\n  | k == x  = rems k xs\n  | True    = [x] ++ rems k xs\n</code></pre>\n\n<p>The alignment I chose above (all <code>=</code> aligned and at least two<sup>\u2020</sup> spaces away from the guard-condition) is completely a matter of taste, but I think it helps avoiding confusion like the one you've found yourself in.</p>\n\n<p>BTW, <code>[x] ++ ...</code> can be shortened to <code>x : ...</code>. The preferred form of writing the function is</p>\n\n<pre><code>rems _ [] = []\nrems k (x:xs)\n  | k==x       = rems k xs\n  | otherwise  = x : rems k xs\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>Most people align the <code>=</code>s but use only one space. That's ok, but IMO <code>k == x = res</code> looks deceptive with all those equals-characters, and <code>k</code> and <code>x</code> further away from each other than from the result. <code>k==x  = res</code> seems tidier.</sub></p>\n"}], "owner": {"reputation": 263, "user_id": 8886517, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QZETR4HxE6s/AAAAAAAAAAI/AAAAAAAB-NU/H3f0Xl3hpsg/photo.jpg?sz=128", "display_name": "Philipp Niederges&#228;&#223;", "link": "https://stackoverflow.com/users/8886517/philipp-niederges%c3%a4%c3%9f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 56717762, "answer_count": 1, "score": -2, "last_activity_date": 1561225970, "creation_date": 1561224546, "last_edit_date": 1561225258, "question_id": 56717648, "link": "https://stackoverflow.com/questions/56717648/haskell-gets-confused-with-horizontal-lines", "title": "Haskell gets confused with horizontal lines", "body": "<p>I tried to practice haskell a bit but I didn't get the following code to work:</p>\n\n<pre><code>rems :: Int -&gt; [Int] -&gt; [Int]\nrems _ [] = []\nrems k (x:xs)\n  | k == x = rems k xs\n  | otherwise [x] ++ rems k xs\n\n\n\nmain = print $\n  rems 3 [5, 3, 2]\n</code></pre>\n\n<p>This function removes every k from a list x if you call it <strong>rems k x</strong>. I know that it should be working because we wrote it down in university.</p>\n\n<p>I'm using this IDE: <a href=\"https://repl.it/languages/haskell\" rel=\"nofollow noreferrer\">https://repl.it/languages/haskell</a></p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561211372, "post_id": 56715993, "comment_id": 99993989, "body": "<code>last x</code> is a non-total function, it will error on non-empty lists."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1561211624, "post_id": 56715993, "comment_id": 99994032, "body": "The name of the last clause (<code>concatBackslash</code>) also differs fom the ones above (<code>concatOnBackslash</code>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1561217368, "post_id": 56715993, "comment_id": 99995267, "body": "Enabling warnings points out the mispelling in the last line, since that would be a function without a type signature."}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1561219862, "post_id": 56715993, "comment_id": 99995877, "body": "Thanks for that tip :)"}], "answers": [{"comments": [{"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1561212217, "post_id": 56716054, "comment_id": 99994143, "body": "But would&#39;n it be impossible to get an empty list, when I&#39;m splitting the String on the white-space?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 1, "creation_date": 1561212315, "post_id": 56716054, "comment_id": 99994161, "body": "@Biskit1943: no, if you for example <code>splitOn &quot; &quot; &quot; b&quot;</code>, you get <code>[&quot;&quot;, &quot;b&quot;]</code>, or <code>splitOn &quot; &quot; &quot;a  b&quot; == [&quot;a&quot;, &quot;&quot;, &quot;b&quot;]</code>. Perhaps it is <i>odd</i> to process such string, but nevertheless <i>*better be safe than sorry</i>&quot; :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1561219103, "last_edit_date": 1561219103, "creation_date": 1561211871, "answer_id": 56716054, "question_id": 56715993, "link": "https://stackoverflow.com/questions/56715993/pattern-matching-list-is-failing/56716054#56716054", "title": "Pattern matching list is failing", "body": "<p>This is indeed correct. The first problem is that your last clause defines a function <code>concatBackslash</code>, whereas the other clauses define a function <code>concat<b>On</b>Backslash</code> (with <code>On</code>). This thus means that Haskell considers this two <em>different</em> functions. You can rename these to:</p>\n\n<pre><code>concatOnBackslash :: [String] -&gt; [String]\nconcatOnBackslash [] = []\nconcatOnBackslash [x] = [x]\nconcatOnBackslash [x, xs] = case last x of\n    '\\\\' -&gt; [(init x) ++ &quot; &quot; ++ xs]\n    _ -&gt; [x, xs]\n<b>concatOnBackslash</b> (x : xx : xs) = case last x of\n    '\\\\' -&gt; concatOnBackslash (((init x) ++ &quot; &quot; ++ xx) : xs)\n    _ -&gt; x: concatOnBackslash (xx : xs)</code></pre>\n\n<p>Now the test case will work, but the function is still not very safe.</p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:last\" rel=\"nofollow noreferrer\"><strong><code>last :: [a] -&gt; a</code></strong></a> (and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:init\" rel=\"nofollow noreferrer\"><strong><code>init :: [a] -&gt; [a]</code></strong></a>) functions are <em>non-total</em>. For an empty list, these fail:</p>\n\n<pre><code>Prelude&gt; last []\n*** Exception: Prelude.last: empty list\nPrelude&gt; init []\n*** Exception: Prelude.init: empty list\n</code></pre>\n\n<p>This thus means that <code>concatOnBackslash</code> thus will error, given the first element is empty, like:</p>\n\n<pre><code>Prelude Data.List.Split&gt; concatOnBackslash [\"\", \"a\"]\n*** Exception: Prelude.last: empty list\n</code></pre>\n\n<p>You thus better use pattern matching here, like:</p>\n\n<pre><code>concatOnBackslash :: [String] -&gt; [String]\nconcatOnBackslash [] = []\nconcatOnBackslash [x] = [x]\nconcatOnBackslash [<b>[]</b>, xs] = ...\nconcatOnBackslash [x<b>@(_:_)</b>, xs] = case last x of\n    '\\\\' -&gt; [(init x) ++ &quot; &quot; ++ xs]\n    _ -&gt; [x, xs]\nconcatOnBackslash (<b>[]</b> : xx : xs) = ...\nconcatOnBackslash (x<b>@(_:_)</b> : xx : xs) = case last x of\n    '\\\\' -&gt; concatOnBackslash (((init x) ++ &quot; &quot; ++ xx) : xs)\n    _ -&gt; x: concatOnBackslash (xx : xs)</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 56716054, "answer_count": 1, "score": 0, "last_activity_date": 1561219103, "creation_date": 1561211292, "question_id": 56715993, "link": "https://stackoverflow.com/questions/56715993/pattern-matching-list-is-failing", "title": "Pattern matching list is failing", "body": "<p>I have the following Code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-\nReturns a list of Strings splitted by ' '. '\\\\ ' is kept as ' '\n-}\nsplitOnWhitespace :: String -&gt; [String]\nsplitOnWhitespace s = concatOnBackslash $ splitOn \" \" s\n\n{-\nconcats Strings on '\\\\' with a whitespace\n-}\n270 concatOnBackslash :: [String] -&gt; [String]\n271 concatOnBackslash [] = []\n273 concatOnBackslash [x] = [x]\n274 concatOnBackslash [x, xs] = case last x of\n275     '\\\\' -&gt; [(init x) ++ \" \" ++ xs]\n276     _ -&gt; [x, xs]\n277 concatBackslash (x : xx : xs) = case last x of\n278     '\\\\' -&gt; concatOnBackslash (((init x) ++ \" \" ++ xx) : xs)\n279     _ -&gt; x: concatOnBackslash (xx : xs)\n</code></pre>\n\n<p>Which compiles and should return me a list of Strings splitted at a non escaped white-space.</p>\n\n<p>However the following happens:</p>\n\n<pre><code>*Filesystem&gt; splitOnWhitespace \"a1\"\n[\"a1\"]\n*Filesystem&gt; splitOnWhitespace \"a1 a2\"\n[\"a1\",\"a2\"]\n*Filesystem&gt; splitOnWhitespace \"a1 a2 a3\"\n*** Exception: src/Filesystem.hs:(271,1)-(275,24): Non-exhaustive patterns in function concatOnBackslash\n\n*Filesystem&gt; splitOnWhitespace \"a1 a2 a3 a4\"\n*** Exception: src/Filesystem.hs:(271,1)-(275,24): Non-exhaustive patterns in function concatOnBackslash\n</code></pre>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["haskell", "syntax", "template-haskell", "quasiquotes"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561209287, "post_id": 56715789, "comment_id": 99993587, "body": "You should here pass the <code>[e|foo|]</code> part to the quasi quoter I think, so <code>runQ [| [e|foo (SNat @$n&#39;)|] |]</code>, unless I am missing something?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561209458, "post_id": 56715789, "comment_id": 99993630, "body": "@WillemVanOnsem I&#39;m not sure what you mean? The eventual result of my TH macro should be as if the user has written <code>foo (SNat @5)</code> in his code etc. The <code>runQ</code> invocation is just to test how the <code>[e| |]</code> quasi-quoter parses <code>@</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1561211674, "creation_date": 1561211674, "answer_id": 56716033, "question_id": 56715789, "link": "https://stackoverflow.com/questions/56715789/quasiquoter-concrete-syntax-for-visible-type-application/56716033#56716033", "title": "Quasiquoter concrete syntax for visible type application", "body": "<p>Parentheses.</p>\n\n<pre><code>let n  = 5\n    n' = litT $ numTyLit $ fromIntegral n\nin  runQ [e| foo (SNat @($n')) |]\n-- ==&gt;\nAppE (UnboundVarE foo) (AppTypeE (UnboundVarE SNat) (LitT (NumTyLit 5)))\n</code></pre>\n\n<p>A space also works, but I wouldn't use one:</p>\n\n<pre><code>[e| foo (SNat @ $n') |]\n</code></pre>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 56716033, "answer_count": 1, "score": 1, "last_activity_date": 1561211674, "creation_date": 1561209171, "last_edit_date": 1561209537, "question_id": 56715789, "link": "https://stackoverflow.com/questions/56715789/quasiquoter-concrete-syntax-for-visible-type-application", "title": "Quasiquoter concrete syntax for visible type application", "body": "<p>In the following snippet, the first argument to <code>foo</code>, <code>SNat @n</code>, is assembled manually:</p>\n\n<pre><code>[e|foo $(appTypeE (conE 'SNat) n')|]\n  where\n    n' = litT . numTyLit . fromIntegral $ n\n</code></pre>\n\n<p>Is there concrete TH quasiquoter syntax for this? I.e. I'd like to write something like</p>\n\n<pre><code>[e|foo (SNat @$n')|]\n</code></pre>\n\n<p>but that is seemingly parsed as if I was applying an infix operator <code>($@)</code>:</p>\n\n<pre><code>&gt; runQ [e|foo (SNat @$n')|]\nAppE (VarE foo) (InfixE (Just (ConE SNat)) (UnboundVarE @$) (Just (VarE n')))\n</code></pre>\n\n<p>Interestingly, the <code>[e| |]</code> quasi-quoter does seem to support the concrete syntax for non-quasi  visible type application:</p>\n\n<pre><code>&gt; runQ [e|foo (SNat @5)|]\nAppE (VarE foo) (AppTypeE (ConE SNat) (LitT (NumTyLit 5)))\n</code></pre>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1561204949, "post_id": 56715281, "comment_id": 99992680, "body": "That is not valid Haskell code. I suppose you mean <code>s = &quot;number\\\\ 1 num...&quot;</code>, or IOW, the <i>raw contents</i> of <code>s</code> are <code>number\\ 1</code> etc.?"}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1561204972, "post_id": 56715281, "comment_id": 99992686, "body": "Yes, sorry for that."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1561205055, "post_id": 56715281, "comment_id": 99992703, "body": "Ok. But you also should some own effort at solving the problem. See <a href=\"http://idownvotedbecau.se/noattempt/\" rel=\"nofollow noreferrer\">idownvotedbecau.se/noattempt</a>"}, {"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1561206331, "post_id": 56715281, "comment_id": 99992960, "body": "I posted my attempt"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561234056, "post_id": 56715281, "comment_id": 99998999, "body": "We have excellent parser combinator libraries in which this would be completely painless. Check out <a href=\"https://stackoverflow.com/q/52556531/791604\">this similar question</a> for an idea of what parser code can look like with one of these libraries."}], "answers": [{"comments": [{"owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1561207340, "post_id": 56715524, "comment_id": 99993177, "body": "I adapted your tips and got it half working, however I ended up without my white-spaces... Could you please have a look at my second attempt?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "edited": false, "score": 0, "creation_date": 1561208173, "post_id": 56715524, "comment_id": 99993359, "body": "Well, you&#39;ve split away the whitespaces unconditionally at the beginning. Either you need to change the splitting function, or put whitespaces back in where you&#39;re processing the <code>\\ </code> symbols."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1561206772, "creation_date": 1561206772, "answer_id": 56715524, "question_id": 56715281, "link": "https://stackoverflow.com/questions/56715281/how-to-split-a-string-at-white-spaces-which-are-not-escaped/56715524#56715524", "title": "How to split a String at white-spaces, which are not escaped?", "body": "<p>Two problems:</p>\n\n<ul>\n<li><code>init</code> gives you everything <em>except</em> the last character in a string. But when you're trying to match with <code>\"\\\\\"</code>, that would be <em>verily</em> the last character. So, you should actually use <code>last</code> in the case statement.</li>\n<li>Where you do need <code>init</code> however is when <code>++</code>ing that element together with the next one. It is in that case that you do not want to keep the trailing <code>\\</code> but all before it.</li>\n</ul>\n"}], "owner": {"reputation": 511, "user_id": 8339179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sAYyz.png?s=128&g=1", "display_name": "Biskit1943", "link": "https://stackoverflow.com/users/8339179/biskit1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 56715524, "answer_count": 1, "score": 0, "last_activity_date": 1561207070, "creation_date": 1561204769, "last_edit_date": 1561207070, "question_id": 56715281, "link": "https://stackoverflow.com/questions/56715281/how-to-split-a-string-at-white-spaces-which-are-not-escaped", "title": "How to split a String at white-spaces, which are not escaped?", "body": "<p>I'd like to split my String at the non escaped white-spaces like this:</p>\n\n<pre><code>let s = \"number\\\\ 1 number\\\\ 2 number\\\\ 3\"\n\n\n[\"number\\\\ 1\", \"number\\\\ 2\", \"number\\\\ 3\"]\n\nor even better\n\n[\"number 1\", \"number 2\", \"number 3\"]\n</code></pre>\n\n<p>How would I have to do this?</p>\n\n<p>Attempt 1:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let s = \"number\\\\ 1 number\\\\ 2 number\\\\ 3\"\n\nsplitWhitespace :: String -&gt; [String]\nsplitWhitespcae s = splitOn \" \" s\n-- returns [\"number\\\\\",\"1\",\"number\\\\\",\"2\",\"number\\\\\",\"3\"]\n\nconcatBackslash :: [String] -&gt; [String]\nconcatBackslash [] = []\nconcatBackslash (x : xx : xs) = case init x of\n    \"\\\\\" -&gt; (x ++ xx) : concatBackslash xs\n    _ -&gt; x : xx : concatBackslash x\n</code></pre>\n\n<p>But for some reason this returns the same List.</p>\n\n<p>Attempt 2:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>splitOnWhitespace :: String -&gt; [String]\nsplitOnWhitespace s = splitOn \" \" s\n\nconcatBackslash :: [String] -&gt; [String]\nconcatBackslash [] = []\nconcatBackslash [x, xs] = case last x of\n    '\\\\' -&gt; [(init x) ++ xs]\n    _ -&gt; [x, xs]\nconcatBackslash (x : xx : xs) = case last x of\n    '\\\\' -&gt; concatBackslash (((init x) ++ xx) : xs)\n    _ -&gt; x: concatBackslash (xx : xs)\n</code></pre>\n\n<p>This was done with the help of @leftaroundabout, however I did end without my whitespaces.</p>\n\n<pre><code>&gt; let s = \"number\\\\ 1 number\\\\ 2 number\\\\ 3\"\n&gt; concatBackslash $ splitOnWhitespace s\n[\"number1\",\"number2\",\"number3\"]\n</code></pre>\n"}, {"tags": ["haskell", "types", "type-inference", "io-monad", "do-notation"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1561195178, "post_id": 56714205, "comment_id": 99990733, "body": "what exactly is your question? It&#39;s really not clear to me what you&#39;re asking"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 7, "creation_date": 1561197663, "post_id": 56714205, "comment_id": 99991235, "body": "There is no &quot;return statement&quot;. <code>return</code> is a function (and a virtual constructor)."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1561223898, "last_edit_date": 1561223898, "creation_date": 1561196416, "answer_id": 56714361, "question_id": 56714205, "link": "https://stackoverflow.com/questions/56714205/how-does-return-statement-have-different-type-than-that-of-a-functions-defini/56714361#56714361", "title": "How does `return` statement have different type than that of a function&#39;s definition?", "body": "<p>Let's re-write your code with explicit separators making the code structure more self-apparent:</p>\n\n<pre><code>input :: IO [(Int,Int)]\ninput = do {\n    n &lt;- readLn ;\n    forM [1..n] (\\ _ -&gt; do {\n        [x,y] &lt;- fmap (map read . words) getLine ;\n        return (x,y)  })\n    }\n</code></pre>\n\n<p>so <code>return (x,y)</code> belongs to the internal <code>do</code>. </p>\n\n<p>Since there's a <code>getLine :: IO String</code> there, the internal <code>do</code>'s type is <code>IO (t1,t2)</code> where <code>x :: t1, y :: t2</code>. So this is also the return type of <em>that lambda function</em> participating in that <code>forM</code> call.</p>\n\n<p>Since <code>forM :: Monad m =&gt; [a] -&gt; (a -&gt; m b) -&gt; m [b]</code>, and we know <code>m ~ IO</code> here, we get the type of the overall <code>do</code>'s last expression as</p>\n\n<pre><code>forM :: [a] -&gt; (a -&gt; IO b) -&gt; IO [b]\n</code></pre>\n\n<p>and thus the overall type is <code>IO [b] ~ IO [(t1,t2)]</code> since <code>b ~ (t1,t2)</code> as per that <code>return</code> expression. </p>\n\n<p>The lambda function returns <code>IO b</code> so <code>forM</code> returns <code>IO [b]</code> as per its type above. And the type of <code>do</code> block is the same as the type of its last expression.</p>\n\n<p>The function's signature says it's <code>IO [(Int,Int)]</code>, so finally <code>t1 ~ Int</code> and <code>t2 ~ Int</code> and everything fits.</p>\n"}], "owner": {"reputation": 29, "user_id": 4497584, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tn7uc7f3WwI/AAAAAAAAAAI/AAAAAAAAAM4/ns19A4cjiao/photo.jpg?sz=128", "display_name": "Ndosho Mbwana", "link": "https://stackoverflow.com/users/4497584/ndosho-mbwana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 676, "favorite_count": 0, "accepted_answer_id": 56714361, "answer_count": 1, "score": -1, "last_activity_date": 1561223898, "creation_date": 1561194947, "last_edit_date": 1561198885, "question_id": 56714205, "link": "https://stackoverflow.com/questions/56714205/how-does-return-statement-have-different-type-than-that-of-a-functions-defini", "title": "How does `return` statement have different type than that of a function&#39;s definition?", "body": "<p>Within a loop, integers are collected inside a list, and a tuple of these integers is <code>return</code>ed. How does this change to a list of tuples? </p>\n\n<pre><code>input :: IO [(Int,Int)]\ninput = do\n  n &lt;- readLn :: IO Int\n  forM [1..n] $ \\_ -&gt; do\n    [x,y] &lt;- map read . words &lt;$&gt; getLine\n    return (x,y)\n</code></pre>\n\n<p>I expected type of value to be <code>(Int,Int)</code> but it is <code>[(Int,Int)]</code>. Why?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1561153658, "post_id": 56709365, "comment_id": 99984743, "body": "I&#39;m not sure, but I&#39;d think that <code>liftIO</code> lifts your <code>IO Account</code> result into the <code>Handler</code> monad. If so, perhaps <code>try</code> should go first and <code>liftIO</code> second: <code>result &lt;- liftIO (try (insertAccount payload))</code>."}, {"owner": {"reputation": 43, "user_id": 11682850, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oR7MdZAdd8g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdhgcpdtfHHFnMk2a4F3G_I2eVX2A/mo/photo.jpg?sz=128", "display_name": "fernandomrtnz", "link": "https://stackoverflow.com/users/11682850/fernandomrtnz"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1561155453, "post_id": 56709365, "comment_id": 99985083, "body": "@MarkSeemann That and updating the pattern match in the case to <code>Left (PGError e) -&gt;</code> did the trick. Thanks! I&#39;ll accept that answer if you post it."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1561155628, "creation_date": 1561155628, "answer_id": 56711036, "question_id": 56709365, "link": "https://stackoverflow.com/questions/56709365/how-to-handle-exception-within-a-servant-handler-monad/56711036#56711036", "title": "How to handle exception within a servant handler monad?", "body": "<p>I'd think that <code>liftIO</code> lifts your <code>IO Account</code> result into the <code>Handler</code> monad. If so, perhaps <code>try</code> should go first and <code>liftIO</code> second:</p>\n\n<pre><code>result &lt;- liftIO (try (insertAccount payload))\ncase result of\n    Right account -&gt; return account\n    Left (PGError e) -&gt; throwError err422\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 11682850, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oR7MdZAdd8g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdhgcpdtfHHFnMk2a4F3G_I2eVX2A/mo/photo.jpg?sz=128", "display_name": "fernandomrtnz", "link": "https://stackoverflow.com/users/11682850/fernandomrtnz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 56711036, "answer_count": 1, "score": 4, "last_activity_date": 1561155628, "creation_date": 1561145165, "question_id": 56709365, "link": "https://stackoverflow.com/questions/56709365/how-to-handle-exception-within-a-servant-handler-monad", "title": "How to handle exception within a servant handler monad?", "body": "<p>I want to handle a database exception inside a servant handler monad.</p>\n\n<p>I've tried to use the <code>try</code> function from the <code>Control.Exception</code> package to be able to case match with <code>Left exception -&gt; throwError err422 { errBody = ... }</code>. </p>\n\n<p>I'm using <a href=\"http://hackage.haskell.org/package/postgresql-typed\" rel=\"nofollow noreferrer\">postgresql-typed</a> to interface with a PostgreSQL database. I want to capture a <a href=\"http://hackage.haskell.org/package/postgresql-typed-0.5.3.0/docs/Database-PostgreSQL-Typed-Protocol.html#t:PGError\" rel=\"nofollow noreferrer\">PGError</a> exception.</p>\n\n<p>The <a href=\"https://github.com/fernandomrtnz/secretos/blob/server-haskell-refactor/server/src/Main.hs#L57-L65\" rel=\"nofollow noreferrer\">relevant code</a> with the following modification:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>accountHandler :: CreateAccountPayload -&gt; Handler Account\naccountHandler payload =\n  let errors = validateCreateAccountPayload payload in\n  if hasErrors errors then\n    throwError err422 { errBody = JSON.encode errors }\n  else\n    do\n      result &lt;- try (liftIO (insertAccount payload))\n      case result of\n        Right account -&gt; return account\n        Left exception -&gt; throwError err422 { errBody = JSON.encode [ValidationError (Text.pack \"email\") (Text.pack \"is already taken\")] }\n</code></pre>\n\n<p>I am expecting to be able to capture a result from the database call and be able to case match it. The cases should be for an exception or a value. I am currently getting the following compile error:</p>\n\n<pre><code>src/Main.hs:64:17: error:\n    \u2022 Couldn't match type \u2018IO\u2019 with \u2018Handler\u2019\n      Expected type: Handler (Either e0 Account)\n        Actual type: IO (Either e0 Account)\n    \u2022 In a stmt of a 'do' block:\n        result &lt;- try (liftIO (insertAccount payload))\n      In the expression:\n        do result &lt;- try (liftIO (insertAccount payload))\n           case result of\n             Right account -&gt; return account\n             Left exception -&gt; throwError err422 {errBody = encode ...}\n      In the expression:\n        if hasErrors errors then\n            throwError err422 {errBody = encode errors}\n        else\n            do result &lt;- try (liftIO (insertAccount payload))\n               case result of\n                 Right account -&gt; return account\n                 Left exception -&gt; throwError ...\n   |\n64 |       result &lt;- try (liftIO (insertAccount payload))\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1561116898, "post_id": 56696839, "comment_id": 99968628, "body": "If the list may not have a buffer, you really want a function of type <code>[Flag] -&gt; Maybe Int</code>, and let something else worry about how to handle a return value of <code>Nothing</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "edited": false, "score": 0, "creation_date": 1561095889, "post_id": 56697122, "comment_id": 99959282, "body": "Thank you, I came up with this: <code>getBufferSize fs = if length sizes &gt; 0 then sizes!!0 else 0   where sizes = [size | Buffer size &lt;- fs]</code>"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "edited": false, "score": 4, "creation_date": 1561108396, "post_id": 56697122, "comment_id": 99964529, "body": "@paperduck <code>case sizes of x:_ -&gt; x; [] -&gt; 0</code> would be more idiomatic, because the <code>(!!)</code> function is not total, so it&#39;s best to avoid it if possible."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1561132215, "post_id": 56697122, "comment_id": 99976742, "body": "Generally, prefer pattern matching to <code>length</code>, <code>(!!)</code>, <code>head</code>, or <code>tail</code>. All of those are implemented with pattern matching,and are generally less efficient or safe than pattern matching."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1561246148, "post_id": 56697122, "comment_id": 100000938, "body": "It&#39;s important to note that this relies on the <code>fail</code> function of <code>[]</code> and is therefore potentially error-prone in the future. (See the MonadFail proposal)"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1561246420, "post_id": 56697122, "comment_id": 100000979, "body": "@schuelermine no, <code>[]</code> has a MonadFail instance, so this will continue to work."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1561246454, "post_id": 56697122, "comment_id": 100000984, "body": "Oh, OK, thanks. I wasn&#39;t aware the transition plan was that solid."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 9, "last_activity_date": 1561093407, "creation_date": 1561093407, "answer_id": 56697122, "question_id": 56696839, "link": "https://stackoverflow.com/questions/56696839/best-way-to-filter-and-extract-from-a-list-of-custom-type/56697122#56697122", "title": "Best way to filter and extract from a list of custom type?", "body": "<p>As a starting point, consider this function:</p>\n\n<pre><code>buffers :: [Flag] -&gt; [Int]\nbuffers xs = [b | Buffer b &lt;- xs]\n</code></pre>\n\n<p>It returns a list of just the <code>Int</code>s from inside of the <code>Buffer</code>s. For <code>[Verbose, Help]</code>, it will return <code>[]</code>. For <code>[Buffer 10, Verbose]</code>, it will return <code>[10]</code>. For <code>[Buffer 123, Buffer 456]</code>, it will return <code>[123, 456]</code>.</p>\n\n<p>Now you have a <code>[Flag] -&gt; [Int]</code>. If you also come up with an <code>[Int] -&gt; Int</code>, you can compose them to get the <code>[Flag] -&gt; Int</code> that you originally asked for, so now it's up to you how you get a single integer out of that list.</p>\n\n<p><code>listToMaybe</code> is one approach. It will return <code>Nothing</code> if the list is empty, or <code>Just</code> the first element otherwise. Compose it with <code>fromMaybe</code> to set a default buffer size if none is provided.</p>\n\n<p>Alternatively, you can combine multiple buffer arguments somehow. <code>max (0:buffers xs)</code> will return the largest buffer size that was specified, or 0 if none were. (Without the <code>0:</code>, your program would crash if no buffer sizes were specified.) <code>sum (buffers xs)</code> will return the sum of all of the buffer sizes that were specified (and automatically returns 0 if none were, since the empty sum is 0).</p>\n"}, {"tags": [], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "is_accepted": false, "score": 0, "last_activity_date": 1561246428, "last_edit_date": 1561246428, "creation_date": 1561246009, "answer_id": 56719907, "question_id": 56696839, "link": "https://stackoverflow.com/questions/56696839/best-way-to-filter-and-extract-from-a-list-of-custom-type/56719907#56719907", "title": "Best way to filter and extract from a list of custom type?", "body": "<p>There's a very simple solution to this.</p>\n\n<p>First, implement a type to represent a <em>complete</em> description of your program's behavior:</p>\n\n<pre><code>data Mode = NormalMode { verbose :: Bool, buffer :: Int } | HelpMode\n</code></pre>\n\n<p>Then, implement an update function to update the arguments based on <em>one</em> flag and a default argument array:</p>\n\n<pre><code>defaults :: Mode\ndefaults = NormalMode { verbose = False, buffer = defaultBuffer }\n -- assuming defaultBuffer is defined somewhere\n\nupdate :: Flag -&gt; Mode -&gt; Mode\nupdate Help _ = HelpMode\nupdate _ HelpMode = HelpMode\nupdate Verbose NormalMode { buffer = b } = NormalMode { verbose = True, buffer = b }\nupdate (Buffer n) NormalMode { verbose = v } = NormalMode { verbose = v, buffer = n }\n</code></pre>\n\n<p>Then, to parse a list of <code>Flag</code>s, just use <code>foldr</code> or <code>foldl</code>:</p>\n\n<pre><code>parseFlagsR :: [Flag] -&gt; Mode\nparseFlagsR = foldr update defaults\n -- This prioritizes the leftmost Buffer flag\n\nparseFlagsL :: [Flag] -&gt; Mode\nparseFlagsL = foldl (flip update) defaults\n -- This prioritizes the rightmost Buffer flag\n</code></pre>\n\n<p>You could then get the buffer in any of the following ways, though I recommend the last one:</p>\n\n<pre><code>safeGetBuffer :: Mode -&gt; Maybe Int\nsafeGetBuffer NormalMode { buffer = b } = Just b\nsafeGetBuffer _ = Nothing\n\ngetBufferWith :: Int -&gt; Mode -&gt; Int\ngetBufferWith _ NormalMode { buffer = b } = b\ngetBufferWith n _ = n\n\ngetBuffer :: Mode -&gt; Int\ngetBuffer = getBufferWith defaultBuffer\n -- defaultBuffer from earlier, again, assuming it's defined.\n</code></pre>\n\n<p>This solution is more general than Joseph Sible's answer, and might be useful when it comes to extracting the verbosity value. This also explicitly formulates the precedence of flags and conveniently bundles all updating operations into one.</p>\n\n<p>Additionally, if you want to know more about general implementations of this, I suggest you familiarize yourself with Lenses and other Optics.</p>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 56697122, "answer_count": 2, "score": 3, "last_activity_date": 1561246428, "creation_date": 1561091252, "question_id": 56696839, "link": "https://stackoverflow.com/questions/56696839/best-way-to-filter-and-extract-from-a-list-of-custom-type", "title": "Best way to filter and extract from a list of custom type?", "body": "<p>I have a data type that represents command-line options:</p>\n\n<p><code>data Flag = Verbose | Help | Buffer Int deriving (Show, Eq)</code></p>\n\n<p>When the program runs, I get a list of <code>Flag</code>, corresponding to the options the user specified. For example, <code>[Buffer 10, Verbose]</code>.</p>\n\n<p>My question is, what's the best way to extract the <code>Int</code> value from a <code>Buffer</code> in <code>[Flag]</code>?<br>\nThe list may not even have a <code>Buffer</code>.<br>\nAll I'm coming up with is some sort of convoluted traversal/fold that uses a <code>case</code> statement to filter out <code>Buffer</code> from the other <code>Flag</code>s.</p>\n"}, {"tags": ["haskell", "functional-programming", "fixed-point-iteration"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1561064840, "post_id": 56693849, "comment_id": 99952972, "body": "You can unwrap this with pattern matching."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1561076030, "post_id": 56693849, "comment_id": 99955707, "body": "<code>fixed (&gt;&gt;= simCon)</code>?"}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1561076722, "post_id": 56693849, "comment_id": 99955846, "body": "where do you put the argument tho?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1561079591, "post_id": 56693849, "comment_id": 99956341, "body": "@Lana Right after, as with any function."}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 3, "creation_date": 1561066060, "post_id": 56694073, "comment_id": 99953390, "body": "Nice use of monads, but I don&#39;t see any pattern matching?"}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1561066442, "post_id": 56694073, "comment_id": 99953521, "body": "for some reason, the first function seems to loop infinitely"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1561066490, "post_id": 56694073, "comment_id": 99953542, "body": "@Lana: yes, I swapped <code>go</code> and <code>pure</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1561066680, "post_id": 56694073, "comment_id": 99953607, "body": "@Bergi: yes, I changed my mind while writing the answer :)."}, {"owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "edited": false, "score": 0, "creation_date": 1561066733, "post_id": 56694073, "comment_id": 99953621, "body": "Thanks very much!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1561067077, "last_edit_date": 1561067077, "creation_date": 1561065934, "answer_id": 56694073, "question_id": 56693849, "link": "https://stackoverflow.com/questions/56693849/how-to-write-a-fixed-point-function-in-haskell/56694073#56694073", "title": "How to write a fixed point function in haskell", "body": "<p>We can make use of the bind function here:</p>\n\n<pre><code>import Data.Bool(bool)\nimport Control.Monad(liftM2)\n\nfixedM :: (Eq a, Monad m) =&gt; (a -&gt; m a) -&gt; a -&gt; m a\nfixedM f = go\n    where go x = f x &gt;&gt;= (liftM2 bool go pure &lt;*&gt; (x ==))\n</code></pre>\n\n<p>A more verbose implementation is:</p>\n\n<pre><code>fixedM :: (Eq a, Monad m) =&gt; (a -&gt; m a) -&gt; a -&gt; m a\nfixedM f x = do\n    x' &lt;- f x\n    if x == x'\n        then pure x'\n        else fixedM f x'\n</code></pre>\n\n<p>We thus first calculate <code>x'</code> with <code>f x</code>. In case <code>f x</code> return <code>Just x'</code>, then we continue. In case <code>f x</code> return <code>Nothing</code>, the <code>fixedM</code> will return <code>Nothing</code> as well. We then compare <code>x</code> with <code>x'</code>. In case the two are equal, we return <code>pure x'</code>, otherwise we recurse on <code>fixedM f x'</code>.</p>\n\n<p>Alternatively, we can make use of <em>pattern matching</em>, although this is basically making the bind operator explicit (and only working for a <code>Maybe</code>):</p>\n\n<pre><code>import Control.Monad(ap)\n\nfixedM :: Eq a =&gt; (a -&gt; Maybe a) -&gt; a -&gt; Maybe a\nfixedM f = ap go f\n    where go x (Just x') | x == x' = go x' (f x')\n                         | otherwise = Just x'\n          go _ _ = Nothing\n</code></pre>\n\n<p>we can make it more compact by using <em>pattern guards</em>:</p>\n\n<pre><code>fixedM :: Eq a =&gt; (a -&gt; Maybe a) -&gt; a -&gt; Maybe a\nfixedM f = go\n    where go x | Just x' &lt;- f x = bool (go x) (Just x) (x == x')\n               | otherwise = Nothing\n</code></pre>\n"}], "owner": {"reputation": 779, "user_id": 5760615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Y7T9x.jpg?s=128&g=1", "display_name": "Zeina Migeed", "link": "https://stackoverflow.com/users/5760615/zeina-migeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 56694073, "answer_count": 1, "score": 7, "last_activity_date": 1562456918, "creation_date": 1561064638, "last_edit_date": 1562456918, "question_id": 56693849, "link": "https://stackoverflow.com/questions/56693849/how-to-write-a-fixed-point-function-in-haskell", "title": "How to write a fixed point function in haskell", "body": "<p>I have a function with the following signature: </p>\n\n<pre><code>simCon :: [Constraint] -&gt; Maybe [Constraint]\n</code></pre>\n\n<p>I would like to write a method which, incase simCon returns <code>Just [Constraint]</code>, I want to feed them back into simCon and rerun the method, and to keep doing this until the input is the same as the output.</p>\n\n<p>In case of Nothing, I would want to terminate the algorithm.</p>\n\n<p>I have something that would work if both the input and output are the same type</p>\n\n<pre><code>fixed :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nfixed f a \n  | a == a' = a\n  | otherwise = fixed f a'\n  where a' = f a\n</code></pre>\n\n<p>But this isn't going to work because I return a Maybe now. Can someone suggest a way to write a similar function but for a return type of Maybe?</p>\n"}, {"tags": ["haskell", "fold", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1561063962, "post_id": 56693712, "comment_id": 99952640, "body": "No, Foldable is different from a catamorphism. Try implementing Foldable for your <code>MyType</code>: it is impossible."}, {"owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "edited": false, "score": 0, "creation_date": 1561064047, "post_id": 56693712, "comment_id": 99952685, "body": "I am aware of the fact that i need one equation per constructor, my question is more how to find the right equation for the constructors"}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 0, "creation_date": 1561064075, "post_id": 56693712, "comment_id": 99952696, "body": "I know, I know (no type parameter) - it was meant as an example of how to break down a problem into simpler parts (one equation per constructor), not how to specifically write a fold..."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1561064124, "post_id": 56693712, "comment_id": 99952713, "body": "Not just that there&#39;s no type parameter: Foldable necessarily gives you access <i>only</i> to the list of values of type <code>a</code> in your type, regardless of where in the structure they are. For a catamorphism, you want the ability to understand the structure."}], "tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": false, "score": 0, "last_activity_date": 1561063897, "creation_date": 1561063897, "answer_id": 56693712, "question_id": 56693622, "link": "https://stackoverflow.com/questions/56693622/how-to-use-the-fold-function-in-haskell-with-other-datatypes/56693712#56693712", "title": "How to use the fold function in Haskell with other datatypes", "body": "<p>The general guideline (for all functions that operate over an ADT, not just fold) would be \"one equation per constructor\":</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data MyType = Constructor1 Int | Constructor2 Float | Constructor3\n\nmyFunc :: MyType -&gt; Int\nmyFunc (Constructor1 x) = ...\nmyFunc (Constructor2 y) = ...\nmyFunc Constructor3     = ...\n</code></pre>\n\n<p>Also, the most proper way of implementing a fold function would be to declare an instance of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Foldable\" rel=\"nofollow noreferrer\">Foldable</a> for your type.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 3, "last_activity_date": 1561067787, "last_edit_date": 1561067787, "creation_date": 1561064211, "answer_id": 56693774, "question_id": 56693622, "link": "https://stackoverflow.com/questions/56693622/how-to-use-the-fold-function-in-haskell-with-other-datatypes/56693774#56693774", "title": "How to use the fold function in Haskell with other datatypes", "body": "<p>As Willem Van Onsem pointed out in a (now-deleted) comment, what you are trying to implement is also called a <em>catamorphism</em>. I've written some about what I suppose you might call a beginner's view of catamorphisms, at <a href=\"https://stackoverflow.com/q/46561125/625403\">Does each type have a unique catamorphism?</a>. You can derive the catamorphism for a type (or show that none can exist) quite mechanically. If your type has N constructors, the fold function must take N+1 arguments: one value of your type, and one function for each constructor. Each such function takes one argument per field that its corresponding constructor has (or, if the constructor has no fields, it takes an ordinary value, which you can imagine as a 0-ary function), and returns a value of whatever type the catamorphism returns.</p>\n\n<p>It's complicated in words, so I'll copy the relevant code from the answer I linked above, as an exemplar:</p>\n\n<pre><code>data X a b f = A Int b\n             | B\n             | C (f a) (X a b f)\n             | D a\n\nxCata :: (Int -&gt; b -&gt; r)\n      -&gt; r\n      -&gt; (f a -&gt; r -&gt; r)\n      -&gt; (a -&gt; r)\n      -&gt; X a b f\n      -&gt; r\nxCata a b c d v = case v of\n  A i x -&gt; a i x\n  B -&gt; b\n  C f x -&gt; c f (xCata a b c d x)\n  D x -&gt; d x\n</code></pre>\n\n<p>Observe that each of the functions (a, b, c, d) has one argument per field in the associated constructor. In most of the cases, you simply call the function with each of the constructor's fields...but what's up with the C case? Why don't we write <code>c f x</code> instead of <code>c f (xCata a b c d x)</code>? This is where the recursion happens: <code>cata</code>'s job is to recursively traverse (fold) the entire tree represented by your ADT, turning each <code>X a b f</code> value into a result of type <code>r</code>. Happily, there's only one possible way to do that transformation: call <code>xCata</code> with the same set of functions you were passed to begin with.</p>\n"}], "owner": {"reputation": 415, "user_id": 10484793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ec95469fb82b965d3ee2f22d1cea5ce?s=128&d=identicon&r=PG&f=1", "display_name": "SavannahGemp", "link": "https://stackoverflow.com/users/10484793/savannahgemp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 56693774, "answer_count": 2, "score": 5, "last_activity_date": 1561067787, "creation_date": 1561063477, "question_id": 56693622, "link": "https://stackoverflow.com/questions/56693622/how-to-use-the-fold-function-in-haskell-with-other-datatypes", "title": "How to use the fold function in Haskell with other datatypes", "body": "<p>Is there an universal way of thinking on how to create a fold function for a new data type? </p>\n\n<p>For example, the fold function for the data Tree is:</p>\n\n<pre><code>data Tree t = Leaf | Node t (Tree t) (Tree t)\n              deriving (Eq,Ord,Show)\n\ntreeFold:: (a -&gt; b -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\ntreeFold f e Leaf = e\ntreeFold f e (Node x l r) = f x (treeFold f e l) (treeFold f e r)\n</code></pre>\n\n<p>For example, how would I have to create the fold function for the following data?</p>\n\n<pre><code>data Json a = Val a | Obj [(String, Json a)]\n</code></pre>\n\n<p>I know the type would have to contain 2 functions, one for each ot the cases Val and Obj. What do I have to consider while creating the fold? I hope my question makes sense. I've just came across many different datatypes where it was asked to write a fold function for a data type, and I don't seem to find the pattern.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1561047442, "post_id": 56690131, "comment_id": 99945674, "body": "You realize that <code>x</code> is only the first element of your list, and thus that you will never take the remaining elements into account?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1561047461, "post_id": 56690131, "comment_id": 99945685, "body": "Your fold function takes three arguments, not two. The two expected arguments are a <i>single</i> element from the list you are folding and the result of the last call to the fold function, not 2 (or more) elements from the list."}, {"owner": {"reputation": 9, "user_id": 4406515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5d29f6c434b409c15be500ec04fcb8?s=128&d=identicon&r=PG&f=1", "display_name": "Evul4t3r", "link": "https://stackoverflow.com/users/4406515/evul4t3r"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1561049855, "post_id": 56690131, "comment_id": 99946839, "body": "@chepner Oh thx, didn&#39;t see that!"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1561051527, "post_id": 56690131, "comment_id": 99947568, "body": "In addition to the <code>foldr</code> issue, the reason the error mentions <code>Int</code>s is that <code>length</code>, annoyingly, is monomorphic and returns an <code>Int</code>. If you need it to be an <code>Integer</code> then either use <code>fromIntegral</code> on it, or use <code>genericLength</code> from <code>Data.List</code>."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1561052949, "post_id": 56690131, "comment_id": 99948170, "body": "You could have taken the time to discover for yourself, the type of <code>length</code>, and the type of <code>foldr</code>. It&#39;s a basic skill, and such information is easily accessible within <code>ghci</code>."}], "answers": [{"tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": false, "score": 1, "last_activity_date": 1561307696, "creation_date": 1561307696, "answer_id": 56725868, "question_id": 56690131, "link": "https://stackoverflow.com/questions/56690131/got-type-int-int-instead-of-integer-and-dont-know-why/56725868#56725868", "title": "Got Type Int -&gt; Int instead of Integer and don&#39;t know why", "body": "<p>The algorithm goes like this:</p>\n\n<ul>\n<li>you start with a = 0 (\"a\" stands for \"accumulator\")</li>\n<li>for True: double a and add 1 to it</li>\n<li>for False: just double a</li>\n</ul>\n\n<p>Example: [True, False, True]</p>\n\n<ul>\n<li>a = 0</li>\n<li>True => a becomes 1 (because 0 * 2 + 1 = 1)</li>\n<li>False => a becomes 2 (because 1 * 2 = 2)</li>\n<li>True => a becomes 5 (because 2 * 2 + 1 = 5)</li>\n<li>a = 5 is the solution</li>\n</ul>\n\n<p>In Haskell code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List (foldl')\n\nbinaryToInteger :: [Bool] -&gt; Integer\nbinaryToInteger xs = foldl' f 0 xs where\n    f a True  = a * 2 + 1\n    f a False = a * 2\n</code></pre>\n\n<p>Don't use exponentiation (<code>^</code>), because it is bad for performance. I used a left-fold, because it is better suited for this problem. The function <code>foldl'</code> has the additional advantage that it is strict, and therefore doesn't introduce a space leak.</p>\n"}], "owner": {"reputation": 9, "user_id": 4406515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5d29f6c434b409c15be500ec04fcb8?s=128&d=identicon&r=PG&f=1", "display_name": "Evul4t3r", "link": "https://stackoverflow.com/users/4406515/evul4t3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1561307696, "creation_date": 1561047357, "question_id": 56690131, "link": "https://stackoverflow.com/questions/56690131/got-type-int-int-instead-of-integer-and-dont-know-why", "title": "Got Type Int -&gt; Int instead of Integer and don&#39;t know why", "body": "<p>I wrote this binarytodecimal-converter getting a compiler error I don't know where it's comming from.</p>\n\n<pre><code>binaryToInteger :: [Bool] -&gt; Integer\nbinaryToInteger (x:xs) = foldr (\\x y z -&gt; (fromEnum x) * 2^y + z) 0 [0..length (x:xs)] \n</code></pre>\n\n<p><em>Actually the program should give back the decimal result of a binary number.\nExample given:\nbinaryToInteger [True, True, False] == 1</em>(2^2) + 1*(2^1) + 0*(2^0) == 6*</p>\n\n<p><strong>My error message is the following:</strong> \nCouldn't match expected type <code>Integer' with actual type</code>Int -> Int'</p>\n\n<pre><code>  * Probable cause: `foldr' is applied to too few arguments\n  In the expression:\n    foldr (\\ x y z -&gt; (fromEnum x) * 2 ^ y + z) 0 [0 .. length (x : xs)]\n  In an equation for `binaryToInteger':\n      binaryToInteger (x : xs)\n        = foldr\n            (\\ x y z -&gt; (fromEnum x) * 2 ^ y + z) 0 [0 .. length (x : xs)]\n</code></pre>\n"}, {"tags": ["haskell", "recursive-datastructures", "cyclic-reference", "inference-engine"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1561095825, "post_id": 56689183, "comment_id": 99959261, "body": "Aren&#39;t you already constructing rules programmatically? That is, you&#39;re already specifying rules like <code>fact_e</code> using programming. For cyclic rules, you should be able to just put them all into one <code>let</code> block (e.g. <code>let x1 = val1 &lt;newline&gt; x2 = val2 &lt;newline&gt; x3 = val3 in _</code>), and have laziness sort out the cyclicity automatically. As for your P.S.: for passing around <code>[Label]</code>, try learning about the &#39;<code>Reader</code> monad&#39;. The repetition of <code>eval_rule proved</code> should get a bit better as well if you use <code>Reader</code>."}, {"owner": {"reputation": 387, "user_id": 7208947, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/43e59c36d69a180a9b501f93099c05ac?s=128&d=identicon&r=PG", "display_name": "VannTen", "link": "https://stackoverflow.com/users/7208947/vannten"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1561132597, "post_id": 56689183, "comment_id": 99976951, "body": "I mean I don&#39;t see how to do it dynamically, (by parsing from a file for example) and not statically writing them down in the code. About the <code>let</code>, that&#39;s what I was trying, thxs :)."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1561180240, "post_id": 56689183, "comment_id": 99988155, "body": "For dynamically generating a list of <code>Fact</code>s, you should be able to do it like any other data structure. For instance, if you have <code>C =&gt; E</code>, you could split it up into <code>[&quot;C&quot;, &quot;=&gt;&quot;, &quot;E&quot;]</code>, then write functions to convert the individual items of the list into <code>Operation</code>s and other <code>Fact</code>s, then combine them together using the appropriate constructors. It&#39;s hard to say much else beyond that without knowing exactly what you&#39;re stuck on; are you struggling with parsing a <code>String</code>, or converting the parsed <code>String</code> into a <code>Fact</code>?"}, {"owner": {"reputation": 387, "user_id": 7208947, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/43e59c36d69a180a9b501f93099c05ac?s=128&d=identicon&r=PG", "display_name": "VannTen", "link": "https://stackoverflow.com/users/7208947/vannten"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1561374232, "post_id": 56689183, "comment_id": 100029144, "body": "My trouble is more with the possible self reference of rules. Parsing my source into my representation is not hard, but translating to self referential expression is a bit harder. I thing the answer from @K. A. Buhr is exactly what I was trying to do."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1561220359, "creation_date": 1561220359, "answer_id": 56717122, "question_id": 56689183, "link": "https://stackoverflow.com/questions/56689183/rules-and-facts-cyclic-definition-in-an-inference-engine/56717122#56717122", "title": "Rules and Facts (cyclic ?) definition in an inference engine", "body": "<p>The idea would be to first parse the rules into an intermediate representation that is <em>not</em> self referential.  For example, given the representation:</p>\n\n<pre><code>type Program = [(Label, [Rule_P])]\ndata Rule_P = Operation_P Rule_P Op Rule_P | Fact_P Label\n</code></pre>\n\n<p>then the set of rules:</p>\n\n<pre><code>C =&gt; E\nA || B =&gt; C\nE =&gt; A\nF =&gt; E\n</code></pre>\n\n<p>would be parsed, gathered by implication target, and represented as:</p>\n\n<pre><code>prog1 :: Program\nprog1 = [ (\"E\", [ Fact_P \"C\"                                       -- C =&gt; E\n                , Fact_P \"F\" ])                                    -- F =&gt; E\n        , (\"C\", [ Operation_P (Fact_P \"A\") (||) (Fact_P \"B\") ])    -- A || B =&gt; C\n        , (\"A\", [ Fact_P \"E\" ]) ]                                  -- E =&gt; A\n</code></pre>\n\n<p>Then, to convert this to a cyclically self-referential knowledge base (using your original <code>Fact</code> type):</p>\n\n<pre><code>type Knowledge = [Fact]\n</code></pre>\n\n<p>you tie the knot like so:</p>\n\n<pre><code>learn :: Program -&gt; Knowledge\nlearn program = knowledge\n\n  where\n\n    knowledge :: [Fact]\n    knowledge = [ (target, map learn1 rules_p) | (target, rules_p) &lt;- program ]\n\n    remember lbl = fromJust (find ((==lbl) . fst) knowledge)\n\n    learn1 :: Rule_P -&gt; Rule\n    learn1 (Fact_P lbl) = Fact (remember lbl)\n    learn1 (Operation_P rule1 op rule2) = Operation (learn1 rule1) op (learn1 rule2)\n</code></pre>\n\n<p>This perhaps deserves some explanation.  We create <code>knowledge</code> by simply applying <code>learn1</code> to convert each occurrence of a non-self-referential <code>Rule_P</code> in the original program into a self-referential <code>Rule</code> in the knowledge base.  The function <code>learn1</code> does this in the obvious recursive manner, and it \"ties the knot\" at each <code>Fact_P</code> by looking up (<code>remember</code>ing) the label in the body of <code>knowledge</code> that we're in the middle of defining.</p>\n\n<p>Anyway, to prove to yourself that it's self-referential, you can play with it in GHCi:</p>\n\n<pre><code>&gt; know1 = learn prog1\n&gt; Just [Operation factA _ _] = lookup \"C\" know1\n&gt; Fact (\"A\", [factE]) = factA\n&gt; Fact (\"E\", [factC, _]) = factE\n&gt; Fact (\"C\", [Operation factA' _ _]) = factC\n&gt; Fact (\"A\", [factE']) = factA'\n</code></pre>\n\n<p>Of course, trying:</p>\n\n<pre><code>&gt; eval_fact [] $ fromJust $ find ((==\"E\").fst) (learn prog1)\n</code></pre>\n\n<p>will loop until it runs out of memory, as it tries to (unsuccessfully) prove E from C from A from E, etc., so you'll need to add some logic to abort cyclic proofs.</p>\n"}], "owner": {"reputation": 387, "user_id": 7208947, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/43e59c36d69a180a9b501f93099c05ac?s=128&d=identicon&r=PG", "display_name": "VannTen", "link": "https://stackoverflow.com/users/7208947/vannten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 56717122, "answer_count": 1, "score": 2, "last_activity_date": 1561220359, "creation_date": 1561044032, "question_id": 56689183, "link": "https://stackoverflow.com/questions/56689183/rules-and-facts-cyclic-definition-in-an-inference-engine", "title": "Rules and Facts (cyclic ?) definition in an inference engine", "body": "<p>I am working on an backwards chaining engine as a school project.\nUntil now, I have mostly done projects in C, and so I decided to try Haskell for that projet. I have read LYAH in order to get started and have begun to implement the representation of rules and facts in my inference engine.\nSo far, this is what I got</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Inference () where\n\ntype Op = Bool -&gt; Bool -&gt; Bool\ntype Label = String\ntype Fact = (Label, [Rule])\ndata Rule = Operation Rule Op Rule\n          | Fact Fact\n\neval_fact:: [Label] -&gt; Fact -&gt; Bool\neval_fact proved (label,rules) = label `elem` proved || any (eval_rule proved) rules\n\neval_rule:: [Label] -&gt; Rule -&gt; Bool\neval_rule proved (Fact x) = eval_fact proved x\neval_rule proved (Operation r op r') =  eval_rule proved r `op` eval_rule proved r'\n</code></pre>\n\n<p>The idea being to have some kind of graph where Fact nodes points to Rules nodes, unless the fact is already in a list of known facts.</p>\n\n<p>However, here I encounter the problem of defining my actual facts and rules.</p>\n\n<p>Doing somethings like </p>\n\n<pre><code>let fact_e = (\"E\", [Fact (\"C\", [(Operation (Fact (\"A\", [])) (||) (Fact (\"B\", [])))])])\n</code></pre>\n\n<p>in ghci in order to represent the rules</p>\n\n<pre><code>C =&gt; E\nA || B =&gt; C\n</code></pre>\n\n<p>That works. But I don't really see what direction to go to construct theses rules programmatically. Furthermore, I don't see how I can handle cyclic rules with that scheme (adding a rule <code>E =&gt; A</code> for example).</p>\n\n<p>I have seen that there is ways to define self referencing data structures in haskell with the trick called \"Tying the knot\" on the Haskell wiki, but I don't see how (or even if) I should apply that in the present case.</p>\n\n<p>My question is essentially, am I going in the right direction, or do I have it completely backward with that approach ?</p>\n\n<p>P.S : It also seems to me that my code is not as concise as it should be (passing around the [Label] list, repeating <code>eVal_rule proved</code> many times...), but I don't really know either how to do it in another way.</p>\n"}, {"tags": ["haskell", "graalvm"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1561030629, "post_id": 56681468, "comment_id": 99935734, "body": "&quot;GraalVM offers a comprehensive ecosystem supporting a large set of languages (Java and other JVM-based languages, JavaScript, Ruby, Python, R, and C/C++ and <b>other LLVM-based languages</b>) &quot; <a href=\"https://github.com/llvm-hs\" rel=\"nofollow noreferrer\">github.com/llvm-hs</a> might be a place to start."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1561042328, "post_id": 56681468, "comment_id": 99942722, "body": "@chepner That doesn&#39;t seem related. You use <code>llvm-hs</code> if you want to actually interface with LLVM. OP wants to compile Haskell <i>to</i> LLVM and run that with GraalVM&#39;s alternate <code>lli</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1561043667, "post_id": 56681468, "comment_id": 99943536, "body": "@HTNW Thanks. Pretty sure there is a project somewhere, though, that does compile Haskell to LLVM; just mistook the link above for that project. I&#39;ll try to find the one I meant."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1561043737, "post_id": 56681468, "comment_id": 99943583, "body": "Sigh. I may have been thinking of <a href=\"http://www.stephendiehl.com/llvm/\" rel=\"nofollow noreferrer\">stephendiehl.com/llvm</a>, which is <i>also</i> not a Haskell-to-LLVM compiler."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1561043742, "post_id": 56681468, "comment_id": 99943588, "body": "@chepner Erm... GHC is the Haskell-&gt;LLVM compiler?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1561043799, "post_id": 56681468, "comment_id": 99943624, "body": "@HTNW Ah. Then it might be easier than I thought :)"}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 5, "last_activity_date": 1561046044, "creation_date": 1561046044, "answer_id": 56689752, "question_id": 56681468, "link": "https://stackoverflow.com/questions/56681468/how-to-run-haskell-on-graalvm/56689752#56689752", "title": "How to run Haskell on GraalVM?", "body": "<p>This is not a complete answer, but it's most of the way there. It is not <em>too</em> complicated:</p>\n\n<p>The Haskell runtime is just a library that you can find in your GHC installation. On my Mac it's in <code>$PREFIX/lib/ghc-$VERSION/rts</code>, where <code>$PREFIX</code> is the installation prefix of GHC (e.g. <code>/</code>, <code>/usr</code>, <code>/usr/local</code>, etc.\u2014the compiler executable should be <code>$PREFIX/bin/ghc</code>). You need to use one of the shared libraries (for me, they're called <code>.dylib</code>s). However, neither the Haskell runtime nor the compiled Haskell code contains <code>main</code>. GHC generates a stub C file:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include \"Rts.h\"\nextern StgClosure ZCMain_main_closure;\nint main(int argc, char *argv[])\n{\n RtsConfig __conf = defaultRtsConfig;\n __conf.rts_opts_enabled = RtsOptsSafeOnly;\n __conf.rts_opts_suggestions = true;\n __conf.rts_hs_main = true;\n return hs_main(argc,argv,&amp;ZCMain_main_closure,__conf);\n}\n</code></pre>\n\n<p>where <code>ZCMain_main_closure</code> refers to the <code>main</code> action written in Haskell and <code>hs_main</code> refers to a symbol from the RTS. You will need to compile this to bitcode with <code>clang</code>, compile the Haskell code with <code>ghc</code>, <code>llvm-link</code> them into one big <code>.bc</code>, then give it to GraalVM's <code>lli</code>. With the above in <code>c_main.c</code>, place an example program into <code>Main.hs</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = putStrLn \"Hello, World!\"\n</code></pre>\n\n<p>Compile and link:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ clang -emit-llvm -I/usr/local/lib/ghc-8.6.5/include -c c_main.c\n# Change -I path as needed\n$ ghc -fllvm -keep-llvm-files -S Main.hs\n$ llvm-link Main.ll c_main.bc -o prog.bc\n</code></pre>\n\n<p>Now, in a perfect world, the following would work:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ lli --lib /usr/local/lib/ghc-8.6.5/rts/libHSrts-ghc8.6.5.dylib \\\n      --lib /usr/local/lib/ghc-8.6.5/base-4.12.0.0/libHSbase-4.12.0.0-ghc8.6.5.dylib \\\n      prog.bc\n# Maybe you need more of the base libraries\n# It's kind of hard to test because it doesn't work, anyway\n</code></pre>\n\n<p>However, this doesn't work because the libraries have mutual dependencies. <code>base</code>, written mostly in Haskell, needs the RTS. The RTS hooks into <code>base</code> to communicate with Haskell (e.g. with exceptions). GraalVM tries to <code>dlopen</code> them one at a time with <code>RTLD_NOW</code>, which tries and fails to strictly resolve the symbols. It would need to use <code>RTLD_LAZY</code>. This should be an easily fixable issue in GraalVM.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 11681681, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nXcyewi7r6g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf5Jm5Jccy8Spb6TUMzBffts3reXQ/mo/photo.jpg?sz=128", "display_name": "Roland Schatz", "link": "https://stackoverflow.com/users/11681681/roland-schatz"}, "is_accepted": false, "score": 2, "last_activity_date": 1564054962, "creation_date": 1564054962, "answer_id": 57201178, "question_id": 56681468, "link": "https://stackoverflow.com/questions/56681468/how-to-run-haskell-on-graalvm/57201178#57201178", "title": "How to run Haskell on GraalVM?", "body": "<p>Thanks HTNW for the pointers on how to produce the required bitcode. I can provide a bit more info on what would be needed on the GraalVM side.</p>\n\n<p>First of all, for the problem with cyclic dependencies, RTLD_LAZY alone doesn't work, because that works only for unresolved functions, not for unresolved variables (you can verify that with a simple C program trying to dlopen libHSrts and libHSbase). But there is a very simple workaround for that: Just produce an empty shared object linking to both (gcc -shared libHSrts-<em>.so libHSbase-</em>.so). This shared object can then be dlopen-ed by GraalVM.</p>\n\n<p>Unfortunately, it still doesn't work, GraalVM seems to run into a segfault somewhere inside the Haskell rts. One potential problem is the GC, we're probably messing up the stack quite a bit in GraalVM, preventing the GC from working correctly.</p>\n\n<p>An interesting thing to try would be to compile everything (including rts and libraries) to bitcode. That would make debugging this problem a lot easier, not having any native-managed boundaries. The GC is still going to be a problem, because on GraalVM the stack will probably look very different from native. But maybe we can even patch the GC out, and just use the normal Java GC.</p>\n"}], "owner": {"reputation": 10089, "user_id": 1850340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/bdef220f4272ab4796c6ae65621481cf?s=128&d=identicon&r=PG", "display_name": "adius", "link": "https://stackoverflow.com/users/1850340/adius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 597, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1564054962, "creation_date": 1561017255, "question_id": 56681468, "link": "https://stackoverflow.com/questions/56681468/how-to-run-haskell-on-graalvm", "title": "How to run Haskell on GraalVM?", "body": "<p>I tried to get Haskell running on <a href=\"https://www.graalvm.org\" rel=\"noreferrer\">GraalVM</a>, but I wasn\u2019t able to include the runtime environment. In Rust it\u2019s just a matter of specifying the correct path for the Rust standard library, as described <a href=\"https://www.graalvm.org/docs/reference-manual/languages/llvm/#running-rust\" rel=\"noreferrer\">here</a>.</p>\n\n<p>Is there an equally simple solution for Haskell? \nIs it even possible at all?</p>\n"}]