[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1493263127, "post_id": 43645939, "comment_id": 74344139, "body": "Related: <a href=\"http://stackoverflow.com/q/23319683/2751851\"><i>Foldr/Foldl for free when Tree is implementing Foldable foldmap?</i></a> (my answer there covers the same ground as kennytm&#39;s answer here, but tells the story in a somewhat different way.)"}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "edited": false, "score": 0, "creation_date": 1493311666, "post_id": 43646582, "comment_id": 74374175, "body": "so <code>Endo a</code> is the set consisting of endo-maps from a to a?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "edited": false, "score": 2, "creation_date": 1493315936, "post_id": 43646582, "comment_id": 74376698, "body": "@user28522 Yes, up to isomorphism. Note that in types, <code>Endo a</code> is the type of such maps, while in terms (programs/expressions) <code>Endo</code> is the name of the isomorphism <code>(a-&gt;a) -&gt; Endo a</code>, while <code>appEndo</code> is its inverse iso."}, {"owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "edited": false, "score": 0, "creation_date": 1493317889, "post_id": 43646582, "comment_id": 74377898, "body": "I still don&#39;t understand:  &quot;...... is the name of the isomorphism (a-&gt;a) -&gt; Endo a, while appEndo is its inverse iso.&quot;. Please point me to the places where I can look up for more information to understand what you said. Thx."}], "tags": [], "owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "is_accepted": false, "score": 8, "last_activity_date": 1493264160, "last_edit_date": 1493264160, "creation_date": 1493252071, "answer_id": 43646582, "question_id": 43645939, "link": "https://stackoverflow.com/questions/43645939/how-can-i-understand-the-laws-for-foldable-instances/43646582#43646582", "title": "How can I understand the laws for Foldable instances?", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#t:Endo\" rel=\"noreferrer\"><code>Endo</code></a> is \"the monoid of endomorphisms under composition\". <code>appEndo</code> is the field of this type.</p>\n\n<pre><code>newtype Endo a = Endo { appEndo :: a -&gt; a }\n\n-- i.e.\nEndo :: (a -&gt; a) -&gt; Endo a\nappEndo :: Endo a -&gt; (a -&gt; a)\n</code></pre>\n\n<p>You may treat \"<a href=\"https://en.wikipedia.org/wiki/Endomorphism\" rel=\"noreferrer\">endomorphism</a>\" as a technically-correct term of functions which input and output types are the same (<code>a -&gt; a</code>). </p>\n\n<p><code>Endo</code> is an instance of <code>Monoid</code> with composition:</p>\n\n<pre><code>instance Monoid (Endo a) where\n        mempty = Endo id\n        Endo f `mappend` Endo g = Endo (f . g)\n</code></pre>\n\n<hr>\n\n<p>To make the law easier to grasp, let's use the List type as a concrete example:</p>\n\n<pre><code>instance Foldable [a] where\n    foldMap f []     = mempty\n    foldMap f (x:xs) = f x `mappend` foldMap f xs\n\n-- i.e.\n-- foldMap f [a, b, \u2026, w] == f a `mappend` f b `mappend` \u2026 `mappend` f w\n</code></pre>\n\n<p>When we evaluate the RHS of the law:</p>\n\n<pre><code>   foldMap (Endo . f)         t\n== foldMap (\\x -&gt; Endo (f x)) [a, b, \u2026, w]\n== (\\x -&gt; Endo (f x)) a `mappend`   \u2026   `mappend` (\\x -&gt; Endo (f x)) w\n== Endo (f a) `mappend` Endo (f b) `mappend`   \u2026   `mappend` Endo (f w)\n</code></pre>\n\n<p>recall <code>mappend</code> for Endo is composition, so the above is </p>\n\n<pre><code>== Endo (f a . f b .   \u2026   . f w)\n</code></pre>\n\n<p>Finally we use <code>appEndo (\u2026) z</code> to take out the composed function and apply it to the initial value <code>z</code>:</p>\n\n<pre><code>   appEndo (Endo (f a . f b .   \u2026   . f w)) z \n== (f a . f b .   \u2026   . f w)                z\n== f a (f b (  \u2026  (f w z)  \u2026  ))\n</code></pre>\n\n<p>and this is exactly the definition of <code>foldr</code> for a list.</p>\n\n<hr>\n\n<p>The <code>foldl</code> one is similar, <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#t:Dual\" rel=\"noreferrer\"><code>Dual</code></a> is another monoid instance where <code>Dual a `mappend` Dual b == Dual (b `mappend` a)</code>, and <code>getDual</code> takes out the inner monoid. It should be easy to see how this produces <code>foldl</code>. </p>\n\n<hr>\n\n<p>The <code>fold</code> function collapses the foldable of monoids into a single monoid. Again using List as an example, <code>fold</code> can be implemented as </p>\n\n<pre><code>fold [a, b, \u2026, w] == a `mappend` b `mappend` \u2026 `mappend` w\n</code></pre>\n\n<p>which can be retrieved from <code>foldMap</code>:</p>\n\n<pre><code>foldMap id [a, b, \u2026, w] == id a `mappend` id b `mappend` \u2026 `mappend` id w\n                        == a `mappend` b `mappend` \u2026 `mappend` w\n</code></pre>\n\n<p>this shows how the identity <code>fold = foldMap id</code> is suggested.</p>\n"}], "owner": {"reputation": 319, "user_id": 7828400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70c46d81a1497ce29153f498b5362904?s=128&d=identicon&r=PG", "display_name": "user28522", "link": "https://stackoverflow.com/users/7828400/user28522"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 630, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1493264160, "creation_date": 1493247760, "question_id": 43645939, "link": "https://stackoverflow.com/questions/43645939/how-can-i-understand-the-laws-for-foldable-instances", "title": "How can I understand the laws for Foldable instances?", "body": "<p>On the page describing Data.Foldable, it says:\nFoldable instances are expected to satisfy the following laws:</p>\n\n<pre><code>foldr f z t = appEndo (foldMap (Endo . f) t ) z\nfoldl f z t = appEndo (getDual (foldMap (Dual . Endo . flip f) t)) z\nfold = foldMap id\n</code></pre>\n\n<p>Please help me understand how the above laws work. What is <code>Endo . f</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1493241478, "post_id": 43644599, "comment_id": 74337758, "body": "Yes, kinda, you can &quot;shadow&quot;.  But it will be as if the new binding is completely separate from the old one -- you can&#39;t do anything with shadowing that you couldn&#39;t do with just using a different name for the new definition."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1493243258, "post_id": 43644599, "comment_id": 74338558, "body": "What would be the difference between &quot;modify&quot; and &quot;redefine&quot;? Once a variable has been bound to a value, that can no longer be changed. But you can define a new variable to some new value -- the new variable might even have the same name as the old one, but it&#39;s still a new variable."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1493292509, "post_id": 43644599, "comment_id": 74360072, "body": "Well, you can shadow <code>left</code> with something like <code>let left = &quot;new&quot; + &quot;value&quot;</code>, but <code>let left = left ++ in</code> will create a recursive definition of <code>left</code>; it does not create a new <code>left</code> whose value is the old value of <code>left</code> combined with <code>in</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493289944, "post_id": 43647737, "comment_id": 74358225, "body": "I remark that one can shorten this to <code>addInput inp = modify (++inp)</code>."}], "tags": [], "owner": {"reputation": 23329, "user_id": 115432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eca023f50940b65931dfe75a03e6e00a?s=128&d=identicon&r=PG", "display_name": "Kathy Van Stone", "link": "https://stackoverflow.com/users/115432/kathy-van-stone"}, "is_accepted": false, "score": 2, "last_activity_date": 1493260755, "creation_date": 1493260755, "answer_id": 43647737, "question_id": 43644599, "link": "https://stackoverflow.com/questions/43644599/set-variable-to-the-same-variable-modified/43647737#43647737", "title": "set variable to the same variable modified?", "body": "<p>This is what the <a href=\"https://wiki.haskell.org/State_Monad\" rel=\"nofollow noreferrer\">State Monad</a> is for. The link should help (it points to a tutorial).  Your example would then become:</p>\n\n<pre><code>type Line = State String ()\naddInput :: String -&gt; Line\naddInput inp = do\n   left &lt;- get\n   put $ left ++ inp\nrunState (addInput &lt;user input&gt;) \"hello\"\n</code></pre>\n\n<p>This does, however, require getting to know monads a bit.  Follow the examples in the link.</p>\n"}], "owner": {"reputation": 1, "user_id": 7896609, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fC9HR823ZLU/AAAAAAAAAAI/AAAAAAAAAAs/8CH-WisnRlM/photo.jpg?sz=128", "display_name": "hallamsamuel", "link": "https://stackoverflow.com/users/7896609/hallamsamuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493260755, "creation_date": 1493241114, "question_id": 43644599, "link": "https://stackoverflow.com/questions/43644599/set-variable-to-the-same-variable-modified", "title": "set variable to the same variable modified?", "body": "<p>I have a program I'm trying to create of a one line text editor\nI've come to a bit of a wall at this point.\nI have a <code>list</code> of letters called <code>left</code> and one called <code>right</code>\nperhaps in a function or a do list how can I set left to <code>left ++ char</code> where char is a user inputted char. I understand it's not possible to modify lists but can I redefine them?\nIf this pseudo code helps</p>\n\n<pre><code>left = \"hello\"\nin = get user input\nleft = left ++ in\n</code></pre>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "haskell-lens", "state-monad"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1493240955, "post_id": 43643895, "comment_id": 74337518, "body": "<code>self</code> can actually be given a much more general type. It&#39;s not just an <code>ASetter</code>; it&#39;s an <code>Equality</code>. Its most general lensy type is <code>Equality a b a b</code>, but you may want to use the <code>Equality&#39; a a</code> version, which is <code>Control.Lens.Equality.simple</code>."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1493239459, "creation_date": 1493239459, "answer_id": 43644197, "question_id": 43643895, "link": "https://stackoverflow.com/questions/43643895/how-to-define-lens-into-the-state-value-itself/43644197#43644197", "title": "How to define Lens into the State value itself?", "body": "<p>Yes, <code>($)</code>, also called <code>id</code>, is also a lens in the representation of the lens package. Though here we have <code>get</code>, <code>put</code>, <code>modify</code> that work just as well, the identity lens can still be useful sometimes.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1493242462, "last_edit_date": 1493242462, "creation_date": 1493241270, "answer_id": 43644638, "question_id": 43643895, "link": "https://stackoverflow.com/questions/43643895/how-to-define-lens-into-the-state-value-itself/43644638#43644638", "title": "How to define Lens into the State value itself?", "body": "<p><em>lens</em> calls this do-nothing optic <a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Equality.html#v:simple\" rel=\"nofollow noreferrer\"><code>simple</code></a>. Note that <code>simple</code> is an <code>Equality</code>, and <code>Equality</code> is at the very bottom of the optics hierarchy, which means you can use it not only as a do-nothing setter, but also as a do-nothing lens, prism, etc.</p>\n\n<blockquote>\n  <p>I'm worried that I might be missing some laws or other assumptions.</p>\n</blockquote>\n\n<p>The setter laws say that, for a <code>foo</code> setter, <code>over foo</code> should follow the functor laws:</p>\n\n<pre><code>over foo id = id\nover foo (g . f) = over foo g . over foo f\n</code></pre>\n\n<p>If you try this with <code>simple</code>/<code>id</code>, you will find the laws hold trivially. The same goes for the other optic laws.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 43644638, "answer_count": 2, "score": 1, "last_activity_date": 1493242752, "creation_date": 1493238343, "last_edit_date": 1493242752, "question_id": 43643895, "link": "https://stackoverflow.com/questions/43643895/how-to-define-lens-into-the-state-value-itself", "title": "How to define Lens into the State value itself?", "body": "<p>While trying to understand State monad and use of Lens with it, I arrived at a surprisingly trivial definition of a lens for a simple counter:</p>\n\n<pre><code>self :: ASetter s s s s\nself = ($)\n\nincrementUsingLens :: State Int ()\nincrementUsingLens = self %= (+1)\n</code></pre>\n\n<p>Since </p>\n\n<pre><code>type ASetter s t a b = (a -&gt; Identity b) -&gt; s -&gt; Identity t\n</code></pre>\n\n<p>In my case is just</p>\n\n<pre><code>type ASetter s s s s = (s -&gt; Identity s) -&gt; s -&gt; Identity s\n</code></pre>\n\n<p>Is this is indeed a correct definition for a lens into a state variable? I'm worried that I might be missing some laws or other assumptions.</p>\n"}, {"tags": ["haskell", "montecarlo", "tree-search"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1493226226, "post_id": 43638329, "comment_id": 74329067, "body": "Are you sure about that <code>Tree</code>? Your definition of <code>TreeNode</code> will have only two descendants. <code>expand</code> indicates that it will have multiple."}, {"owner": {"reputation": 115, "user_id": 7253589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fd9a2b638a27d347e2232fdb495cabd0?s=128&d=identicon&r=PG&f=1", "display_name": "JoeDonald", "link": "https://stackoverflow.com/users/7253589/joedonald"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1493277273, "post_id": 43638329, "comment_id": 74349600, "body": "Then it should be a list of descendants?"}], "owner": {"reputation": 115, "user_id": 7253589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fd9a2b638a27d347e2232fdb495cabd0?s=128&d=identicon&r=PG&f=1", "display_name": "JoeDonald", "link": "https://stackoverflow.com/users/7253589/joedonald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 838, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1493278729, "creation_date": 1493220069, "last_edit_date": 1493278729, "question_id": 43638329, "link": "https://stackoverflow.com/questions/43638329/make-a-mcts-in-haskell", "title": "Make a MCTS in Haskell", "body": "<p>I have to implement a Monte Carlo Tree Search in Haskell. I defined a data type like this:</p>\n\n<pre><code>data Tree s a = TreeNode { \n                           rGame :: s, -- state\n                        rPlayed :: a, -- action\n                        visit :: Int, -- number of visits\n                        score :: Float, \n                        left :: Tree s a,\n                        right :: Tree s a} | TreeNil deriving Show\n</code></pre>\n\n<p>I also implemented a Zipper with a random number generator(I heard that I need one):</p>\n\n<pre><code>data Crumb s a = LeftCrumb s a (Tree s a) | RightCrumb s a (Tree s a) deriving Show\n\ntype Treecrumbs s a = [Crumb s a]\n\ndata Zipper s a = Zipper (Tree s a) (Treecrumbs s a) (StdGen)\n</code></pre>\n\n<p>My question is how can I implement the expand function for this MCTS. Because is lazy evaluation I also think I can generate the whole tree. In my opinion the function should look like this:</p>\n\n<pre><code>expand :: (s -&gt; [(a, s)])  -- The generator\n       -&gt; s                -- first state\n       -&gt; Tree s a         -- The result tree\nexpand gen t =\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "answers": [{"tags": [], "owner": {"reputation": 5295, "user_id": 1317117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c4vVs.jpg?s=128&g=1", "display_name": "andih", "link": "https://stackoverflow.com/users/1317117/andih"}, "is_accepted": true, "score": 5, "last_activity_date": 1493229033, "last_edit_date": 1493229033, "creation_date": 1493204297, "answer_id": 43632235, "question_id": 43631979, "link": "https://stackoverflow.com/questions/43631979/haskell-in-do-notation/43632235#43632235", "title": "Haskell &lt;- in do notation", "body": "<p>The Do Expression is part of the Language. </p>\n\n<p>From the Haskell Language Report 2010:</p>\n\n<blockquote>\n  <p>3.14 <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">Do Expression</a></p>\n\n<pre><code>lexp  \u2192   do { stmts }            (do expression)\nstmts \u2192   stmt1 \u2026 stmtn exp [;]   (n \u2265 0)  \nstmt  \u2192   exp ;\n      |   pat &lt;- exp ;\n      |   let decls ; \n      |   ;                       (empty statement)\n</code></pre>\n  \n  <p>A do expression provides a more conventional syntax for\n  monadic programming. It allows an expression such as</p>\n\n<pre><code> putStr \"x: \"    &gt;&gt;  \n getLine         &gt;&gt;= \\l -&gt;     \n return (words l)\n</code></pre>\n  \n  <p>to be written in a more traditional way as:</p>\n\n<pre><code> do putStr \"x: \"  \n    l &lt;- getLine  \n    return (words l)\n</code></pre>\n  \n  <p>As indicated by the translation of do, variables bound by let have fully polymorphic types while those defined by &lt;- are lambda bound and are thus monomorphic.</p>\n</blockquote>\n\n<p>see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">Do Expression</a> of the Haskell Language Report.</p>\n"}], "owner": {"reputation": 373, "user_id": 4440649, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/VITOP.jpg?s=128&g=1", "display_name": "Michocio", "link": "https://stackoverflow.com/users/4440649/michocio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "closed_date": 1493227774, "accepted_answer_id": 43632235, "answer_count": 1, "score": 1, "last_activity_date": 1493229033, "creation_date": 1493203579, "last_edit_date": 1493219786, "question_id": 43631979, "link": "https://stackoverflow.com/questions/43631979/haskell-in-do-notation", "closed_reason": "Duplicate", "title": "Haskell &lt;- in do notation", "body": "<p>It's well known that <code>&lt;-</code> in <code>do</code> blocks are just syntactic sugar for <code>&gt;&gt;=</code>, but is <code>&lt;-</code> defined anywhere in the Haskell source or is it just syntactic construction that is part of language grammar and thus the parser just replaces every <code>&lt;-</code> with appropriate form of <code>&gt;&gt;=</code>?</p>\n"}, {"tags": ["haskell", "digestive-functors"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1528662592, "post_id": 43617511, "comment_id": 88581840, "body": "What do you mean parse a form? It&#39;s not clear what is being asked."}], "owner": {"reputation": 166, "user_id": 3410372, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/38ddcefff0db3bd04a6fc06e31d1c01d?s=128&d=identicon&r=PG", "display_name": "cloudhead", "link": "https://stackoverflow.com/users/3410372/cloudhead"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1493142019, "creation_date": 1493142019, "question_id": 43617511, "link": "https://stackoverflow.com/questions/43617511/digestive-functors-to-parse-multiple-inputs-with-the-same-name", "title": "digestive-functors to parse multiple inputs with the same name", "body": "<p>I'm trying to use digestive-functors to parse a form with a variable number of dynamically generated inputs, something like this:</p>\n\n<pre><code>&lt;form&gt;\n  &lt;input type=\"hidden\" name=\"object-id\" value=\"123\"&gt;\n  &lt;input type=\"hidden\" name=\"object-id\" value=\"43\"&gt;\n  &lt;input type=\"hidden\" name=\"object-id\" value=\"467\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>But am unsure on how to do this. I see there's a <code>listOf</code> function, but it looks like it requires the input names to have an index in them and be created all at once, which I don't want, since these inputs are being populated dynamically.</p>\n\n<p>The haskell type is something like:</p>\n\n<pre><code>data Form = Form { objectIds :: [Int] }\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "functional-programming", "currying"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 4, "creation_date": 1493138769, "post_id": 43616372, "comment_id": 74282006, "body": "<code>(a,[a])</code> is an argument, not the return type."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1493138813, "post_id": 43616372, "comment_id": 74282037, "body": "You&#39;ve already figured out that you have to apply <code>g</code> to <code>c</code>, and that <code>g</code>&#39;s <code>a</code> argument should probably come from the <code>(a, [a])</code> tuple. Without a specification of what <code>f</code> should do with that tuple we can&#39;t really give you any more advice than that. I suspect writing down (in words) a precise specification of <code>f</code>&#39;s behaviour will empower you to implement it without our help anyway."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1493139138, "post_id": 43616372, "comment_id": 74282218, "body": "@BenjaminHodgson Sans any list reordering (including dropping and duplicating elements, possibly depending on the list length), the only viable implementation is <code>f c g = let h = g c in \\(x, xs) -&gt; (map h xs, h x)</code>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1493139280, "post_id": 43616372, "comment_id": 74282312, "body": "@Bergi Depends what you mean by &quot;list reordering&quot;. It wouldn&#39;t be unreasonable to claim that <code>\\(x, xs) -&gt; let ys = map h (x:xs) in (init ys, last ys)</code> doesn&#39;t reorder its input"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1493147866, "post_id": 43616372, "comment_id": 74287270, "body": "I don&#39;t know why this question was downvoted. OP is clearly making an attempt to understand."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1493151132, "post_id": 43617156, "comment_id": 74289267, "body": "@chepner It is, but he forgot a newline, which made SO think the code block was just a continuation of the text before, which made it swallow a backslash as starting an escape rather than as a literal chunk of code. I inserted a newline for him, and now you can see what he really meant."}], "tags": [], "owner": {"reputation": 141, "user_id": 3403974, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f396d1a92446f49f4603c7feb8e9767c?s=128&d=identicon&r=PG&f=1", "display_name": "GeleiaDeMocoto", "link": "https://stackoverflow.com/users/3403974/geleiademocoto"}, "is_accepted": true, "score": 0, "last_activity_date": 1493151080, "last_edit_date": 1493151080, "creation_date": 1493140789, "answer_id": 43617156, "question_id": 43616372, "link": "https://stackoverflow.com/questions/43616372/how-do-i-split-the-parameters-from-a-received-function/43617156#43617156", "title": "How do I split the parameters from a received function", "body": "<p>The implementation is</p>\n\n<pre><code>f c g = \\(x, xs) -&gt; (map (g c) xs, (g c) x)\n</code></pre>\n\n<p>Thank you, @Bergi.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493158023, "post_id": 43618810, "comment_id": 74292620, "body": "<code>a -&gt; b -&gt; b</code> is the same type as <code>a -&gt; (b -&gt; b)</code>. I don&#39;t understand why you&#39;re going to such trouble to differentiate them."}, {"owner": {"reputation": 19, "user_id": 6515250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db8d3320f9de0401804a1058b27289c?s=128&d=identicon&r=PG&f=1", "display_name": "TanasaIoan", "link": "https://stackoverflow.com/users/6515250/tanasaioan"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493189647, "post_id": 43618810, "comment_id": 74302577, "body": "@amalloy I forgot that haskell type signatures were right associative, a better example would have been <code>func2 :: (a -&gt; b) -&gt; b</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493231307, "post_id": 43618810, "comment_id": 74332109, "body": "Continuing from what @amalloy said, there isn&#39;t really a distinction in Haskell between &quot;a function that takes two arguments&quot; and &quot;a function that takes in one argument and returns a function that takes in one argument&quot; (technically, all functions in Haskell take exactly one argument, but the first statement is sometimes used as a shorthand)."}], "tags": [], "owner": {"reputation": 19, "user_id": 6515250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db8d3320f9de0401804a1058b27289c?s=128&d=identicon&r=PG&f=1", "display_name": "TanasaIoan", "link": "https://stackoverflow.com/users/6515250/tanasaioan"}, "is_accepted": false, "score": -1, "last_activity_date": 1493146912, "last_edit_date": 1493146912, "creation_date": 1493146602, "answer_id": 43618810, "question_id": 43616372, "link": "https://stackoverflow.com/questions/43616372/how-do-i-split-the-parameters-from-a-received-function/43618810#43618810", "title": "How do I split the parameters from a received function", "body": "<p>First of all, a,b and c are types not values, for example the function id (which receives an argument and returns it with no changes made Ex:<code>id 4</code> is 4) has the type signature:</p>\n\n<p><code>id :: c -&gt; c</code> </p>\n\n<p>That means that it receives a parameter of type c and returns a value of type c.\nSo, what does the following type signature mean ?</p>\n\n<p><code>func :: a -&gt; b -&gt; b</code></p>\n\n<p>It means that <code>func</code> receives two arguments, one of type a and one of type b, and returns a value of type b because <strong>only the last type is the return type</strong>.\nIf you want a function that returns a function it would look something like this:</p>\n\n<p><code>func2 :: a -&gt; (b-&gt; b)</code></p>\n\n<p><code>func2</code> takes a value of type a and returns a function that it turn takes a value of type b and returns a value of type b.\nSo the type signature of f (<code>f :: c -&gt; (c -&gt; (a -&gt; b)) -&gt; (a, [a]) -&gt; ([b], b)</code>) shows us that f takes 3 arguments : one of type c, one that is a function which takes a type c value and returns a function that in turn takes a value of type a and returns a value of type b,another one which is a tuple (a pair in this case) consisting of a value of type a and a list of values which have type a and finally returns a tuple consisting of a list of values which have type b and a value of type b. \nAlso, <code>[a]</code> means a list of type a values and <code>(a1,a2....an)</code> is a tuple (kinda like a list with fixed size), <code>(a,b)</code> specifically is a pair consisting of a value of type a and a value of type b.</p>\n"}], "owner": {"reputation": 141, "user_id": 3403974, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f396d1a92446f49f4603c7feb8e9767c?s=128&d=identicon&r=PG&f=1", "display_name": "GeleiaDeMocoto", "link": "https://stackoverflow.com/users/3403974/geleiademocoto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 43617156, "answer_count": 2, "score": 1, "last_activity_date": 1493151080, "creation_date": 1493138213, "question_id": 43616372, "link": "https://stackoverflow.com/questions/43616372/how-do-i-split-the-parameters-from-a-received-function", "title": "How do I split the parameters from a received function", "body": "<p>I need to write a definition for the following function:</p>\n\n<pre><code>f :: c -&gt; (c -&gt; a -&gt; b) -&gt; (a, [a]) -&gt; ([b], b)\n</code></pre>\n\n<p>which receives an element c and a function g (which is (c->a->b)).</p>\n\n<pre><code>f c g = ???\n</code></pre>\n\n<p>So it seems to me that this function g receives a c and returns a function that receives an a and returns a b. It could be a function that receives a c and an a and returns a b, but then where would the a come from?</p>\n\n<pre><code>f :: c -&gt; (c -&gt; (a -&gt; b)) -&gt; (a, [a]) -&gt; ([b], b)\n</code></pre>\n\n<p>So I have c which I can feed into g and get back the function (a->b). How do I split those in order to return the tuples (a, [a]) and ([b], b)?</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493137667, "post_id": 43614515, "comment_id": 74281363, "body": "I take it hiding the <code>newtype</code>&#39;s constructor inside the internal module isn&#39;t an option? If it is, you could rename the <code>newtype</code> constructor to (say) <code>Positive_</code>, move the <code>Positive</code> pattern synonym to the internal module and export that instead."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1493137926, "post_id": 43614515, "comment_id": 74281509, "body": "I think the question is already answered here: <a href=\"http://stackoverflow.com/questions/8172548/is-it-possible-to-export-constructors-for-pattern-matching-but-not-for-construc\" title=\"is it possible to export constructors for pattern matching but not for construc\">stackoverflow.com/questions/8172548/&hellip;</a> Nothing changed since then. This GHC trac ticket suggests to not create new pattern synonym but just use <code>pattern</code> on current constructor: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8753\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/8753</a> But unfortunately this will also export constructor, not only pattern :( Because constructor pattern by default is bidirectional."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1493189728, "post_id": 43614515, "comment_id": 74302621, "body": "Why do you want the pattern and dumb constructor to have the same name?  Why not just name the dumb constructor something else? Your uses don&#39;t get to see it anyway.  Or am I misunderstanding..."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1493339664, "post_id": 43614515, "comment_id": 74386943, "body": "When you&#39;re trying to define a name in a module which is the same as a name in an imported module, you&#39;re probably much better off using <code>import qualified</code> and qualified references, rather than trying to set up really finicky imports to get the implicit unqualified namespace to have exactly what you want in it."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1493339881, "post_id": 43614515, "comment_id": 74387009, "body": "@luqui b/c it makes refactoring from using the internal API to the external API really easy.  Change the import statement, and then, as long as I&#39;m not using the dumb constructor, I&#39;m all good."}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1493379830, "post_id": 43668622, "comment_id": 74404658, "body": "Perfect! I didn&#39;t know that you could specify constructors using the <code>pattern</code> keyword. Thanks so much."}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 3, "last_activity_date": 1493376117, "last_edit_date": 1493376117, "creation_date": 1493330442, "answer_id": 43668622, "question_id": 43614515, "link": "https://stackoverflow.com/questions/43614515/hide-a-constructor-but-not-the-type-on-import/43668622#43668622", "title": "Hide a constructor but not the type on import", "body": "<p>Correct me if I am wrong, but I am almost certain this is what you are looking for:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\nmodule Positive\n  ( module Positive.Internal, pattern Positive, foo\n  ) where\n\nimport Positive.Internal hiding (pattern Positive)\nimport qualified Positive.Internal as Internal (pattern Positive)\n\npattern Positive :: a -&gt; Positive a\npattern Positive a &lt;- Internal.Positive a\n\nfoo :: Positive Int\nfoo = Internal.Positive 5\n</code></pre>\n\n<p><code>Internal</code> module stays the same way as it is defined so far. And for the sake of example:</p>\n\n<pre><code>module Negative where\n\nimport Positive\n\nbar :: Maybe Int\nbar = getPositive &lt;$&gt; toPositive 6\n</code></pre>\n\n<p>Let's double check in GHCi:</p>\n\n<pre><code>Prelude&gt; :load Negative\n[1 of 3] Compiling Positive.Internal ( Positive/Internal.hs, interpreted )\n[2 of 3] Compiling Positive         ( Positive.hs, interpreted )\n[3 of 3] Compiling Negative         ( Negative.hs, interpreted )\nOk, modules loaded: Negative, Positive, Positive.Internal.\n*Negative&gt; bar\nJust 6\n*Negative&gt; getPositive foo\n5\n*Negative&gt; :i Positive\nnewtype Positive a = Positive.Internal.Positive {getPositive :: a}\n    -- Defined at Positive/Internal.hs:3:1\ninstance [safe] Ord a =&gt; Ord (Positive a)\n  -- Defined at Positive/Internal.hs:4:17\ninstance [safe] Eq a =&gt; Eq (Positive a)\n  -- Defined at Positive/Internal.hs:4:13\n*Negative&gt; :t Positive\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 non-bidirectional pattern synonym \u2018Positive\u2019 used in an expression\n    \u2022 In the expression: Positive\n</code></pre>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 43668622, "answer_count": 1, "score": 8, "last_activity_date": 1493376117, "creation_date": 1493132909, "last_edit_date": 1493133585, "question_id": 43614515, "link": "https://stackoverflow.com/questions/43614515/hide-a-constructor-but-not-the-type-on-import", "title": "Hide a constructor but not the type on import", "body": "<p>I've got an internal module I'd like to provide an external API for</p>\n\n<pre><code>module Positive.Internal where\n\nnewtype Positive a = Positive { getPositive :: a }\n  deriving (Eq, Ord)\n\n-- smart constructor\ntoPositive :: (Num a, Ord a) =&gt; a -&gt; Maybe (Positive a)\ntoPositive a | a &lt;= 0    = Nothing\n             | otherwise = Just $ Positive a\n-- ...\n</code></pre>\n\n<p>I want to hide the dumb constructor, and replace it with a unidirectional\npattern so users can still pattern match values, they just have to use the smart constructor to use new values.</p>\n\n<p>Since I want the pattern and the dumb constructor to use the same name, I need to hide the dumb constructor to prevent namespace clashes.</p>\n\n<p>However, since the dumb constructor and the type share names, it's a little tricky to import the everything BUT the dumb constructor.</p>\n\n<p>Currently I'm doing this, which works ok:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\nmodule Positive\n  ( module Positive.Internal, pattern Positive\n  ) where\n\nimport Positive.Internal (Positive())\nimport Positive.Internal hiding (Positive)\nimport qualified Positive.Internal as Internal\n\npattern Positive :: a -&gt; Positive a\npattern Positive a &lt;- Internal.Positive a\n</code></pre>\n\n<p>I could simplify my imports by just using the qualified import, but I'm curious.</p>\n\n<p>Is there a way to, in a single import statement, import all of <code>Positive.Internal</code> except the dumb constructor?</p>\n\n<p>I tried <code>hiding (Positive(Positive))</code>, but that hid both the type and the dumb constructor. I've poked about <a href=\"https://wiki.haskell.org/Import\" rel=\"noreferrer\">the wiki</a>, but I haven't noticed any way to differentiate between constructors and types in <code>hiding</code> lists.</p>\n"}, {"tags": ["haskell", "higher-order-functions"], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493128875, "post_id": 43612683, "comment_id": 74274492, "body": "but the declaration is f ch str and the input is  f &quot;END&quot; &quot;xYz1Ab&quot;,shouldn&#39;t ch be correspond to &quot;END&quot; and str be &quot;xYz1Ab&quot;?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1493129016, "post_id": 43612683, "comment_id": 74274606, "body": "But you didn&#39;t write <code>f &quot;END&quot; &quot;xYz1Ab&quot;</code>, you wrote <code>foldr f &quot;END&quot; &quot;xYz1Ab&quot;</code>. In the first case, the two strings are arguments to the <code>f</code> function (leaving aside the fact that <code>f</code>&#39;s first argument should be a <code>Char</code>, not a <code>String</code>). In the second case, <code>f</code>, <code>&quot;END&quot;</code> and <code>&quot;xYz1Ab&quot;</code> are all arguments to the <code>foldr</code> function. If you&#39;d written <code>foldr (f &quot;END&quot; &quot;xYz1Ab&quot;)</code>, then the strings would be <code>f</code>&#39;s arguments, but of course that&#39;s another type error."}], "tags": [], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "is_accepted": false, "score": 1, "last_activity_date": 1493128485, "creation_date": 1493128485, "answer_id": 43612683, "question_id": 43612495, "link": "https://stackoverflow.com/questions/43612495/understanding-higher-order-function-in-haskell/43612683#43612683", "title": "understanding higher order function in Haskell", "body": "<p>None of the characters in <code>\"END\"</code> match the guard <code>('a'&lt;=ch&amp;&amp;ch&lt;='z')</code>, so they're not appended.</p>\n\n<p>The second argument to <code>foldr</code> is the initial state, that's always passed in as <code>str</code>, never as <code>ch</code>.</p>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1493128485, "creation_date": 1493127974, "question_id": 43612495, "link": "https://stackoverflow.com/questions/43612495/understanding-higher-order-function-in-haskell", "title": "understanding higher order function in Haskell", "body": "<pre><code>f::Char-&gt;String-&gt;String\nf ch str\n    |('a'&lt;=ch&amp;&amp;ch&lt;='z')=ch:str\n    |otherwise=str\n</code></pre>\n\n<p>The output seems really counter-intuitive to me:</p>\n\n<pre><code>*Main&gt; foldr f \"END\" \"xYz1Ab\"\n\"xzbEND\"\n*Main&gt; foldr f \"xYz1Ab\" \"END\" \n\"xYz1Ab\"\n</code></pre>\n\n<p>My train of thoughts is that \"End\" is ch and \"xYz1Ab\" is str, so <code>foldr f \"END\" \"xYz1Ab\"</code> is  supposed to be \"ENDxzb\" and <code>foldr f \"xYz1Ab\" \"END\"</code> is suppsoed to be \"END\". Can someone explain this to me?</p>\n"}, {"tags": ["haskell", "typeclass", "functor", "category-theory"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1493111880, "post_id": 43605874, "comment_id": 74262054, "body": "Not a duplicate, but related: <a href=\"http://stackoverflow.com/q/7220436/477476\">stackoverflow.com/q/7220436/477476</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493112111, "post_id": 43605874, "comment_id": 74262236, "body": "Why not formulate it constructively: what are the situations when you <i>can</i> have a Functor instance? That&#39;s IMO always so much more useful to consider."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1493113401, "post_id": 43605874, "comment_id": 74263178, "body": "I suppose you could count types with the wrong kind, e.g. <code>newtype Fix f = Fix { unFix :: f (Fix f) }</code> has a kind <code>Fix :: (* -&gt; *) -&gt; *</code> whereas <code>Functor</code> requires a type constructor of kind <code>* -&gt; *</code>, i.e. <code>Functor :: (* -&gt; *) -&gt; Constraint</code>. (<code>Fix</code> is, however, a functor in the general categorical sense, from the category of Haskell endofunctors to the category of Haskell types.)"}, {"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493113652, "post_id": 43605874, "comment_id": 74263343, "body": "@leftaroundabout I&#39;m looking for some rules plus the intuition behind them. At some point I thought that you could have functors for any container, which is obviously wrong. So I have the feeling that you can have Functor instances for most of the containers except a few cases."}, {"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1493113921, "post_id": 43605874, "comment_id": 74263520, "body": "@cactus I&#39;ve seen the linked question but I&#39;m trying to identify other rules and build an intuition"}, {"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1493114179, "post_id": 43605874, "comment_id": 74263690, "body": "@BenjaminHodgson Wrong kind is definitely not suitable for Functor. I&#39;ll update the question to avoid discussions in this direction. As for your Fix type I don&#39;t understand it. Can you post a link with more info? Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 0, "creation_date": 1493134300, "post_id": 43610753, "comment_id": 74278980, "body": "Can you explain with more details what you mean by &quot;these rules apply to Functor only, not to functors in general.&quot;? Thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 1, "creation_date": 1493144796, "post_id": 43610753, "comment_id": 74285443, "body": "@vidi Expanding on that might be another whole answer, and the level to write it at depends a lot on how comfortable you are with functors to begin with. But in short: you could imagine <code>class Functor&#39; f where fmap&#39; :: Ord b =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code> with essentially the same class laws as <code>Functor</code> and which would admit an instance for <code>Set</code> even though <code>Functor</code> doesn&#39;t. And a suitably modified class with an essentially identical class law could be cooked up for most non-<code>Functor</code>s."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "edited": false, "score": 1, "creation_date": 1493144926, "post_id": 43610753, "comment_id": 74285515, "body": "@vidi Or, to put it another way: the strictures of Haskell as a language already make it quite easy to satisfy the much more relaxed rules imposed by merely being a functor. Parametric polymorphism already stops you from writing most of the stupid stuff that the functor laws are designed to rule out."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1493123498, "creation_date": 1493123498, "answer_id": 43610753, "question_id": 43605874, "link": "https://stackoverflow.com/questions/43605874/what-are-the-situations-when-you-can-cannot-have-a-functor-instances-for-a-datat/43610753#43610753", "title": "What are the situations when you can/cannot have a Functor instances for a datatype?", "body": "<p>In addition to your rules:</p>\n\n<ul>\n<li>Must be of kind <code>* -&gt; *</code></li>\n<li>No <code>Functor</code> instance for the container types that have restrictions on the contained values.</li>\n<li>No <code>Functor</code> instance for contravariant data types.</li>\n</ul>\n\n<p>I would add a few:</p>\n\n<ul>\n<li>A natural extension of \"not for contravariant types\": no <code>Functor</code> instance for invariant data types. e.g. <code>data Iso a b = Iso (a -&gt; b) (b -&gt; a)</code></li>\n<li><p>GADTs often cannot have a <code>Functor</code> instance. For example,</p>\n\n<pre><code>data Foo a where\n    Foo :: Foo Int\n</code></pre>\n\n<p>Perhaps you would somehow want to lump this into the \"only covariant\" rule somehow (it's not clear to me what variance this even has), or the \"unrestricted container types\" rule somehow (GADTs introduce type equalities that are very constraint-like).</p></li>\n</ul>\n\n<p>However, keep in mind that these rules apply to <code>Functor</code> <em>only</em>, not to functors in general. I expect any stupid type (of appropriate kind) you can cook up will be a functor on some suitable category closely related to Hask.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1493123646, "post_id": 43610758, "comment_id": 74270382, "body": "According to the documentation, <code>DerivingFunctor</code> won&#39;t derive a functor instance for <code>newtype Wrong a = Wrong (Either a Int)</code>; but that doesn&#39;t mean <code>Wrong</code> <i>can&#39;t</i> be a <code>Functor</code>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493123832, "post_id": 43610758, "comment_id": 74270527, "body": "@DanielWagner Yes, it&#39;s true. <code>DerivingFunctor</code> mechanism is more restrictive. I was just referring to official documentation where one can look for all cases. But this documentation should be read not blindly to not miss that case you mentioned in comment."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 0, "last_activity_date": 1493123514, "creation_date": 1493123514, "answer_id": 43610758, "question_id": 43605874, "link": "https://stackoverflow.com/questions/43605874/what-are-the-situations-when-you-can-cannot-have-a-functor-instances-for-a-datat/43610758#43610758", "title": "What are the situations when you can/cannot have a Functor instances for a datatype?", "body": "<p>There is <code>-XDerivingFunctor</code> extension in Haskell user guide. You can find full description <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#deriving-functor-instances\" rel=\"nofollow noreferrer\">here</a>. It has description of all cases when functor deriving can fail. This description has cases when algorithm checks for proper kind, etc. But I believe this list of constraints for algorithm is exhaustive.</p>\n\n<p>For example, another case, when type has <em>kind</em> <code>* -&gt; *</code> but cannot be instance of <code>Functor</code>: </p>\n\n<blockquote>\n  <p>A data type\u2019s last type variable is used in an -XExistentialQuantification constraint, or is refined in a GADT</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "is_accepted": false, "score": 5, "last_activity_date": 1493150213, "creation_date": 1493150213, "answer_id": 43619862, "question_id": 43605874, "link": "https://stackoverflow.com/questions/43605874/what-are-the-situations-when-you-can-cannot-have-a-functor-instances-for-a-datat/43619862#43619862", "title": "What are the situations when you can/cannot have a Functor instances for a datatype?", "body": "<p>From the point of view of category theory, Haskell's type constructors of the kind <code>*-&gt;*</code> define a <em>mapping of objects</em> in the category Hask (it's a category modulo termination issues, which I'm going to conveniently ignore). A functor is a mapping of objects and, more importantly, a <em>mapping of morphisms</em>. In fact, it's primarily a mapping of morphisms--the mapping of objects is, in a way, a side effect of that. Objects are just the endpoints of morphisms. This mapping of morphisms must preserve composition and identity.</p>\n\n<p>In Haskell, morphisms are functions, and the mapping of functions is implemented as <code>fmap</code>. </p>\n\n<p>The fact that in Haskell we start with the mapping of objects is a little backwards. This works because the syntax of the language drastically limits the possibilities for defining the mapping of objects. Such mapping are very regular and, quite often, come equipped with canonical mappings of functions. For instance, algebraic data types are constructed using products and coproducts, which are functorial in nature (hence the possibility of <code>deriving Functor</code> automatically). Also, function types (categorical exponentials) are functorial in the second argument (and contravariant in the first). So, as long as we use the tools of the bicartesian closed category (products, coproducts, and exponentials), it's easy to construct functorial mappings of objects.</p>\n\n<p>A functor must be defined for every object in a given category, so data types that are constrained by type classes (e.g., <code>Set</code> with the <code>Ord</code> constraint) are not <code>Functor</code>s in Hask, but they may be functors in a subcategory of Hask. (It's possible to define subcategories in Haskell together with their own functors.)</p>\n"}], "owner": {"reputation": 1722, "user_id": 1593986, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/8b55a5d33dee71102db716c72e166974?s=128&d=identicon&r=PG", "display_name": "vidi", "link": "https://stackoverflow.com/users/1593986/vidi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 43610753, "answer_count": 3, "score": 2, "last_activity_date": 1493150213, "creation_date": 1493110264, "last_edit_date": 1493114376, "question_id": 43605874, "link": "https://stackoverflow.com/questions/43605874/what-are-the-situations-when-you-can-cannot-have-a-functor-instances-for-a-datat", "title": "What are the situations when you can/cannot have a Functor instances for a datatype?", "body": "<p>Considering a type with kind * -> *, I'm trying to find rules and build intuition for when you can and when you cannot have Functor for this type.</p>\n\n<p>So far the rules that I see are the following:</p>\n\n<ol>\n<li>No <code>Functor</code> instance for the container types that have restrictions\non the contained values.</li>\n</ol>\n\n<p>Example: You cannot have a <code>Functor</code> instance for <code>Set</code> because <code>Ord</code> is needed for the contained value </p>\n\n<ol start=\"2\">\n<li>No <code>Functor</code> instance for contravariant data types. </li>\n</ol>\n\n<p>Example:</p>\n\n<pre><code>newtype Contra a = Contra (a -&gt; Int)\n</code></pre>\n\n<p>Besides this, are there other situations?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493110159, "post_id": 43605754, "comment_id": 74260800, "body": "i think it is the other way &#39;round <code>stack exec -- iterate-strict-exe 25 +RTS -s</code>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493110296, "post_id": 43605754, "comment_id": 74260899, "body": "@epsilonhalbe Nope, that didn&#39;t do it."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493110320, "post_id": 43605754, "comment_id": 74260925, "body": "I just saw there is a flag <code>--rts-options</code> you might need to try <code>--rts-options &quot;+RTS -s&quot;</code> and <code>--rts-options &quot;-s&quot;</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493110508, "post_id": 43605754, "comment_id": 74261067, "body": "also - though I am not a 100% sure you can pass the whole thing as a string to stack and it executes it <code>stack exec -- &quot;iterate-strict-exe 20 +RTS -s&quot;</code> is another thing I&#39;d try."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493110586, "post_id": 43605754, "comment_id": 74261113, "body": "@epsilonhalbe Neither of those work either."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1493111617, "post_id": 43605754, "comment_id": 74261858, "body": "I don&#39;t know whether it is relevant but your stack version is outdated"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1493128584, "post_id": 43605754, "comment_id": 74274259, "body": "Just tested on 1.1.2, <code>stack exec iterate-strict-exe -- 25 +RTS -s</code> and <code>stack exec -- iterate-strict-exe 25 +RTS -s</code> both work, so something else is wrong with your setup."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 4, "last_activity_date": 1493149260, "creation_date": 1493149260, "answer_id": 43619565, "question_id": 43605754, "link": "https://stackoverflow.com/questions/43605754/pass-rts-options-to-program-run-with-stack-exec/43619565#43619565", "title": "Pass +RTS options to program run with stack exec", "body": "<p>It looks like you are on Windows and encountering GHC bug <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13287\" rel=\"nofollow noreferrer\">#13287</a> (to be fixed in 8.2). See also stack issues <a href=\"https://github.com/commercialhaskell/stack/issues/2022\" rel=\"nofollow noreferrer\">2022</a> and <a href=\"https://github.com/commercialhaskell/stack/issues/2640\" rel=\"nofollow noreferrer\">2640</a>. Apparently a workaround is to add <code>--RTS</code> before <code>--</code>, like</p>\n\n<pre><code>stack exec iterate-strict-exe --RTS -- 25 +RTS -s\n</code></pre>\n"}], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1033, "favorite_count": 3, "accepted_answer_id": 43619565, "answer_count": 1, "score": 5, "last_activity_date": 1493149260, "creation_date": 1493109946, "last_edit_date": 1493132552, "question_id": 43605754, "link": "https://stackoverflow.com/questions/43605754/pass-rts-options-to-program-run-with-stack-exec", "title": "Pass +RTS options to program run with stack exec", "body": "<p>How do I pass <code>+RTS</code> options to a program run with <code>stack exec</code>?</p>\n\n<p>I've added <code>-rtsopts</code> to <code>ghc-options</code> in my cabal file, and built a program with <code>stack build</code>. If I run the program manually both normal and <code>+RTS</code> command line arguments work:</p>\n\n<pre><code>&gt;.stack-work\\dist\\ca59d0ab\\build\\iterate-strict-exe\\iterate-strict-exe.exe 25 +RTS -s\nOK\n   3,758,156,184 bytes allocated in the heap\n         297,976 bytes copied during GC\n         ...\n</code></pre>\n\n<p>But if I run it with <code>stack exec</code> only the normal options reach the program</p>\n\n<pre><code>&gt;stack exec iterate-strict-exe -- 25 +RTS -s\nOK\n</code></pre>\n\n<h3>Other things that don't work</h3>\n\n<p>If I juggle the order of the arguments around as suggested by @epsilonhalbe I get the same result.</p>\n\n<pre><code>&gt;stack exec -- iterate-strict-exe 25 +RTS -s\nOK\n</code></pre>\n\n<hr>\n\n<p>There doesn't seem to be the suggested <code>--rts-options</code> option to pass to <code>stack exec</code>.</p>\n\n<pre><code>&gt;stack exec --rts-options \"-s\" -- iterate-strict-exe 25\nInvalid option `--rts-options'\n\nUsage: stack exec CMD [-- ARGS (e.g. stack ghc -- X.hs -o x)] ([--plain] |\n                  [--[no-]ghc-package-path] [--[no-]stack-exe] [--package ARG])\n                  [--help]\n  Execute a command\n</code></pre>\n\n<p>I'm using <code>stack</code> version <code>1.1.2</code></p>\n\n<pre><code>&gt;stack --version\nVersion 1.1.2, Git revision c6dac65e3174dea79df54ce6d56f3e98bc060ecc (3647 commits) x86_64 hpack-0.14.0\n</code></pre>\n\n<hr>\n\n<p>The same after a <code>stack upgrade</code> to <code>1.4.0</code>.</p>\n\n<hr>\n\n<p>Passing the entire command as a string (another suggestion) results in a command with that name not being found</p>\n\n<pre><code>&gt;stack exec -- \"iterate-strict-exe 25 +RTS -s\"\nExecutable named iterate-strict-exe 25 +RTS -s not found on path: ...\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 0, "last_activity_date": 1493110066, "creation_date": 1493110066, "answer_id": 43605802, "question_id": 43605360, "link": "https://stackoverflow.com/questions/43605360/ddump-rule-firings-output-when-building-haskell-program-with-stack/43605802#43605802", "title": "ddump-rule-firings output when building Haskell program with Stack", "body": "<p>I found the rules firing dumps in directories like the following</p>\n\n<pre><code>.stack-work\\dist\\ca59d0ab\\build\\src\\Lib.dump-rule-firings\n.stack-work\\dist\\ca59d0ab\\build\\iterate-strict-exe\\iterate-strict-exe-tmp\\app\\Main.dump-rule-firings\n</code></pre>\n"}], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493110066, "creation_date": 1493108780, "question_id": 43605360, "link": "https://stackoverflow.com/questions/43605360/ddump-rule-firings-output-when-building-haskell-program-with-stack", "title": "ddump-rule-firings output when building Haskell program with Stack", "body": "<p>How do I see the output of <code>-ddump-rule-firings</code> when building a program with stack?</p>\n\n<p>I've added <code>-ddump-rule-firings</code> to <code>ghc-options</code> in my <code>.cabal</code> file and run <code>stack clean; stack build -v</code>. The rule firings (and any other output from ghc) are not included in the output of <code>stack</code>.</p>\n\n<p>The normal ghc output doesn't seem to be logged anywhere in the <code>.stack-work</code> directory.</p>\n\n<hr>\n\n<p>Other developers have <a href=\"https://github.com/commercialhaskell/stack/issues/426\" rel=\"nofollow noreferrer\">encountered similar issues</a>, but the proposed change (adding a <code>--dump-logs</code> option) doesn't seem to be implemented:</p>\n\n<pre><code>&gt;stack build --dump-logs\nInvalid option `--dump-logs'\n\nUsage: stack build [TARGET] [--dry-run] [--pedantic] [--fast]\n                   [--ghc-options OPTION] [--flag PACKAGE:[-]FLAG]\n                   ([--dependencies-only] | [--only-snapshot] |\n                   [--only-dependencies]) ([--file-watch] | [--file-watch-poll])\n                   [--exec CMD [ARGS]] [--only-configure] [--trace] [--profile]\n                   [--[no-]library-profiling] [--[no-]executable-profiling]\n                   [--[no-]haddock] [--haddock-arguments HADDOCK_ARGS]\n                   [--[no-]open] [--[no-]haddock-deps] [--[no-]copy-bins]\n                   [--[no-]prefetch] [--[no-]keep-going] [--[no-]force-dirty]\n                   [--[no-]test] [--[no-]rerun-tests]\n                   [--test-arguments TEST_ARGS] [--coverage] [--no-run-tests]\n                   [--[no-]bench] [--benchmark-arguments BENCH_ARGS]\n                   [--no-run-benchmarks] [--[no-]reconfigure]\n                   [--[no-]cabal-verbose] [--[no-]split-objs] [--help]\n  Build the package(s) in this directory/configuration\n</code></pre>\n"}, {"tags": ["haskell", "bit-manipulation", "bit-fields", "lfsr"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493097031, "post_id": 43601927, "comment_id": 74253621, "body": "How are you compiling? What compiler? What version?  How are you executing it? What arguments? Why are you using foldr here? Where is the C implementation for comparison?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493097639, "post_id": 43601927, "comment_id": 74253820, "body": "Try replacing <code>shift 1 len</code> with the more straight-forward <code>2^len</code> and re-benchmark."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493098138, "post_id": 43601927, "comment_id": 74254017, "body": "And what&#39;s with the branch in advance?  It seems more in the form of the other code if you use <code>advance ... = shifted .|. fromEnum d0</code>."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493099978, "post_id": 43601927, "comment_id": 74254840, "body": "1. replace the branch: Good point. But it just makes for a 5% improvement in speed."}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493100133, "post_id": 43601927, "comment_id": 74254919, "body": "2. Replace <code>shift 1 len</code> by <code>2 ^ len</code>: 2.259s -&gt; 0.178s - that is bizarre, 2^len is needed exactly once, why would this make a difference at all?"}, {"owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1493101223, "post_id": 43601927, "comment_id": 74255392, "body": "3. <code>foldr</code> vs. <code>foldl</code>: It makes almost no difference. Empirically <code>foldr</code> was slightly faster!"}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493112877, "post_id": 43604864, "comment_id": 74262842, "body": "If your compiler options aren&#39;t making the <code>iterate advance&#39;</code> call strict, your answer may be further improved by using the <a href=\"http://stackoverflow.com/a/43606802/414413\">strict <code>iterate&#39;</code> from my answer</a>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1493169974, "post_id": 43604864, "comment_id": 74295884, "body": "It is, and it actually beats the C++ code, which is nice but not entirely unexpected since the algorithm has seen a small improvement.  I couldn&#39;t get the unboxed vectors to perform as well but I also didn&#39;t bother disabling the bounds checks, which possibly accounts for a bit of the difference."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 8, "last_activity_date": 1493169641, "last_edit_date": 1493169641, "creation_date": 1493107189, "answer_id": 43604864, "question_id": 43601927, "link": "https://stackoverflow.com/questions/43601927/efficient-bit-fiddling-in-a-lfsr-implementation/43604864#43604864", "title": "Efficient bit-fiddling in a LFSR implementation", "body": "<p><strong>Up Front Matters</strong></p>\n\n<p>For starters, I'm using GHC 8.0.1 on an Intel I5 ~2.5GHz, linux x86-64.</p>\n\n<p><strong>First Draft: Oh No! The slows!</strong></p>\n\n<p>Your starting code with parameter 25 runs:</p>\n\n<pre><code>% ghc -O2 orig.hs &amp;&amp; time ./orig 25\n[1 of 1] Compiling Main             ( orig.hs, orig.o )\nLinking orig ...\nOK\n./orig 25  7.25s user 0.50s system 99% cpu 7.748 total\n</code></pre>\n\n<p>So the time to beat is 77ms - two orders of magnitude better than this Haskell code.  Lets dive in.</p>\n\n<p><strong>Issue 1: Shifty Code</strong></p>\n\n<p>I found a couple of oddities with the code.  First was the use of <code>shift</code> in high performance code.  Shift supports both left and right shift and to do so it requires a branch.  Lets kill that with more readable powers of two and such (<code>shift 1 x</code> ~> <code>2^x</code> and <code>shift x 1</code> ~> <code>2*x</code>):</p>\n\n<pre><code>% ghc -O2 noShift.hs &amp;&amp; time ./noShift 25\n[1 of 1] Compiling Main             ( noShift.hs, noShift.o )\nLinking noShift ...\nOK\n./noShift 25  0.64s user 0.00s system 99% cpu 0.637 total\n</code></pre>\n\n<p>(As you noted in the comments: Yes, this bears investigation.  It might be that some oddity of the prior code was preventing a rewrite rule from firing and, as a result, much worse code resulted)</p>\n\n<p><strong>Issue 2: Lists Of Bits? Int operations save the day!</strong></p>\n\n<p>One change, one order of magnitude.  Yay.  What else?  Well you have this awkward list of bit locations you're tapping that just seems like its begging for inefficiency and/or leans on fragile optimizations.  At this point I'll note that hard-coding any one selection from that list results in really good performance (such as <code>testBit lsfr 24 `xor` testBit lsfr 21</code>) but we want a more general fast solution.</p>\n\n<p>I propose we compute the mask of <em>all</em> the tap locations then do a one-instruction pop count.  To do this we only need a single <code>Int</code> passed in to <code>advance</code> instead of a whole list.  The popcount instruction requires good assembly generation which requires llvm and probably <code>-optlc-mcpu=native</code> or another instruction set selection that is non-pessimistic.</p>\n\n<p>This step gives us <code>pc</code> below.  I've folded in the guard-removal of <code>advance</code> that was mentioned in the comments:</p>\n\n<pre><code>let tp = sum $ map ((2^) . subtract 1) (tap !! len)\n    pc lfsr = fromEnum (even (popCount (lfsr .&amp;. tp)))\n    mask = 2^len - 1\n    advance' :: Int -&gt; Int\n    advance' lfsr = (2*lfsr .&amp;. mask) .|. pc lfsr \n    out :: Int\n    out = last $ take (2^len) $ iterate advance' 0\n</code></pre>\n\n<p>Our resulting performance is:</p>\n\n<pre><code>% ghc -O2 so.hs -fforce-recomp -fllvm -optlc-mcpu=native &amp;&amp; time ./so 25      \n[1 of 1] Compiling Main             ( so.hs, so.o )\nLinking so ...\nOK\n./so 25  0.06s user 0.00s system 96% cpu 0.067 total\n</code></pre>\n\n<p>That's over two orders of magnitude from start to finish, so hopefully it matches your C.  Finally, in deployed code it is actually really common to have Haskell packages with C bindings but this is often an educational exercise so I hope you had fun.</p>\n\n<p>Edit: The now-available C++ code takes my system 0.10 (<code>g++ -O3</code>) and 0.12 (<code>clang++ -O3 -march=native</code>) seconds, so it seems we've beat our mark by a fair bit.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1493107910, "last_edit_date": 1493107910, "creation_date": 1493107415, "answer_id": 43604927, "question_id": 43601927, "link": "https://stackoverflow.com/questions/43601927/efficient-bit-fiddling-in-a-lfsr-implementation/43604927#43604927", "title": "Efficient bit-fiddling in a LFSR implementation", "body": "<ol>\n<li><p>Does the compiler lift <code>tap !! len</code> out of the loop? I suspect it does, but moving it out to guarantee this can't hurt:</p>\n\n<pre><code>let tap1 = tap !! len\nlet out = last $ take (shift 1 len) $ iterate (advance len tap1) 0    \n</code></pre></li>\n<li><p>In the comments you say \"<code>2^len</code> is needed exactly once\", but this is wrong. You do it each time in <code>advance</code>. So you could try</p>\n\n<pre><code>advance len tap mask lfsr\n    | d0        = shifted\n    | otherwise = shifted .|. 1\n    where\n        shifted = shift lfsr 1 .&amp;. mask\n        d0 = xor' $ map (testBit lfsr) tap'\n        tap' = map (subtract 1) tap\n\n-- in main\nlet tap1 = tap !! len\nlet numIterations = 2^len\nlet mask = numIterations - 1\nlet out = iterate (advance len tap1 mask) 0 !! (numIterations - 1)\n</code></pre>\n\n<p>(the compiler can't optimize <code>last $ take ...</code> to <code>!!</code> in general, because they are different for finite lists, but <code>iterate</code> always returns an infinite one.)</p></li>\n<li><p>You compared <code>foldr</code> with <code>foldl</code>, but <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl%27\" rel=\"nofollow noreferrer\"><code>foldl</code> is almost never what you need</a>; since <code>xor</code> always needs both arguments and is associative, <code>foldl'</code> is very likely to be the right choice (the compiler can optimize it, but if there is any real difference between <code>foldl</code> and <code>foldr</code> and not just random variation, it might have failed in this case).</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493131653, "post_id": 43606802, "comment_id": 74276817, "body": "I&#39;m wrong about the list fusion; the rules don&#39;t work when the argument to <code>take</code> is <code>shift 1 len</code>, but they do work if it&#39;s changed to <code>2^len</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493132040, "post_id": 43606802, "comment_id": 74277176, "body": "The fusion rules working with <code>2^len</code> gets another 20% improvement."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 6, "last_activity_date": 1493112710, "last_edit_date": 1495540468, "creation_date": 1493112710, "answer_id": 43606802, "question_id": 43601927, "link": "https://stackoverflow.com/questions/43601927/efficient-bit-fiddling-in-a-lfsr-implementation/43606802#43606802", "title": "Efficient bit-fiddling in a LFSR implementation", "body": "<p>I suspect that the following line is building a large list-like thunk in memory before evaluating it.</p>\n\n<pre><code>let out = last $ take (shift 1 len) $ iterate (advance len (tap!!len)) 0` is \n</code></pre>\n\n<p>Let's find out if I'm right, and if I am, we'll fix it. The first debugging step is to get an idea of the memory used by the program. To do this we're going to compile with the options <code>-rtsopts</code> in addition to <code>-O2</code>. This enables running the program with <a href=\"https://downloads.haskell.org/~ghc/7.6.2/docs/html/users_guide/runtime-control.html\" rel=\"nofollow noreferrer\">RTS options</a>, inclusing <code>+RTS -s</code> which outputs a small memory summary.</p>\n\n<h3>Initial Performance</h3>\n\n<p>Running your program as <code>lfsr 25 +RTS -s</code> I get the following output</p>\n\n<pre><code>OK\n   5,420,148,768 bytes allocated in the heap\n   6,705,977,216 bytes copied during GC\n   1,567,511,384 bytes maximum residency (20 sample(s))\n     357,862,432 bytes maximum slop\n            3025 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     10343 colls,     0 par    2.453s   2.522s     0.0002s    0.0009s\n  Gen  1        20 colls,     0 par    2.281s   3.065s     0.1533s    0.7128s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    1.438s  (  1.162s elapsed)\n  GC      time    4.734s  (  5.587s elapsed)\n  EXIT    time    0.016s  (  0.218s elapsed)\n  Total   time    6.188s  (  6.967s elapsed)\n\n  %GC     time      76.5%  (80.2% elapsed)\n\n  Alloc rate    3,770,538,273 bytes per MUT second\n\n  Productivity  23.5% of total user, 19.8% of total elapsed\n</code></pre>\n\n<p>That's a lot of memory used at once. It's very likely there's a big thunk building up in there somewhere.</p>\n\n<h3>Trying to reduce the thunk size</h3>\n\n<p>I hypothesized that the thunk is being built in <code>iterate (advance ...)</code>. If this is the case, we can try to reduce the thunk size by making <code>advance</code> more strict in its <code>lsfr</code> argument. This won't remove the spine of the thunk (the successive iterations), but it might reduce the size of the state that's built up as the spine's evaluated.</p>\n\n<p><code>BangPatterns</code> is an easy way to make a function strict in an argument. <code>f !x = ..</code> is shorthand for <code>f x = seq x $ ...</code></p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nadvance :: Int -&gt; [Int] -&gt; Int -&gt; Int\nadvance len tap = go\n  where\n    go !lfsr\n      | d0        = shifted\n      | otherwise = shifted .|. 1\n      where\n        shifted = shift lfsr 1 .&amp;. mask len\n        d0 = xor' $ map (testBit lfsr) tap'\n    tap' = map (subtract 1) tap\n</code></pre>\n\n<p>Let's see what difference this makes ...</p>\n\n<pre><code>&gt;lfsr 25 +RTS -s\nOK\n   5,420,149,072 bytes allocated in the heap\n   6,705,979,368 bytes copied during GC\n   1,567,511,448 bytes maximum residency (20 sample(s))\n     357,862,448 bytes maximum slop\n            3025 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     10343 colls,     0 par    2.688s   2.711s     0.0003s    0.0059s\n  Gen  1        20 colls,     0 par    2.438s   3.252s     0.1626s    0.8013s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    1.328s  (  1.146s elapsed)\n  GC      time    5.125s  (  5.963s elapsed)\n  EXIT    time    0.000s  (  0.226s elapsed)\n  Total   time    6.484s  (  7.335s elapsed)\n\n  %GC     time      79.0%  (81.3% elapsed)\n\n  Alloc rate    4,081,053,418 bytes per MUT second\n\n  Productivity  21.0% of total user, 18.7% of total elapsed\n</code></pre>\n\n<p>None that's noticeable.</p>\n\n<h3>Eliminating the Spine</h3>\n\n<p>I guess it's the spine of that <code>iterate (advance ...)</code> that's being built. After all, for the command I'm running the list would be <code>2^25</code>, or a little over 33 million items long. The list itself is probably being removed by <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#list-fusion\" rel=\"nofollow noreferrer\">list fusion</a>, but the thunk for the last item of the list is over 33 million applications of <code>advance ...</code></p>\n\n<p>To solve this problem we need a strict version of <code>iterate</code> so that the value is forced to an <code>Int</code> before applying the <code>advance</code> function again. This should keep the memory down to only a single <code>lfsr</code> value at a time, along with the currently computed application of <code>advance</code>.</p>\n\n<p>Unfortunately, there isn't a strict <code>iterate</code> in <code>Data.List</code>. Here's one that doesn't give up on the list fusion that's providing other important (I think) performance optimizations to this problem.</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nimport GHC.Base (build)\n\n{-# NOINLINE [1] iterate' #-}\niterate' :: (a -&gt; a) -&gt; a -&gt; [a]\niterate' f = go\n  where go !x = x : go (f x)\n\n{-# NOINLINE [0] iterateFB' #-}\niterateFB' :: (a -&gt; b -&gt; b) -&gt; (a -&gt; a) -&gt; a -&gt; b\niterateFB' c f = go\n  where go !x = x `c` go (f x)\n\n{-# RULES\n\"iterate'\"    [~1] forall f x. iterate' f x = build (\\c _n -&gt; iterateFB' c f x)\n\"iterateFB'\"  [1]              iterateFB' (:) = iterate'\n #-}\n</code></pre>\n\n<p>This is just <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#iterate\" rel=\"nofollow noreferrer\"><code>iterate</code> from <code>GHC.List</code></a> (along with all its rewrite rules), but made strict in the accumulated argument.</p>\n\n<p>Equipped with a strict iterate, <code>iterate'</code>, we can change the troublesome line to</p>\n\n<pre><code>let out = last $ take (shift 1 len) $ iterate' (advance len (tap!!len)) 0\n</code></pre>\n\n<p>I expect that this will perform much better. Let's see ...</p>\n\n<pre><code>&gt;lfsr 25 +RTS -s\nOK\n   3,758,156,184 bytes allocated in the heap\n         297,976 bytes copied during GC\n          43,800 bytes maximum residency (1 sample(s))\n          21,736 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      7281 colls,     0 par    0.047s   0.008s     0.0000s    0.0000s\n  Gen  1         1 colls,     0 par    0.000s   0.000s     0.0002s    0.0002s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.750s  (  0.783s elapsed)\n  GC      time    0.047s  (  0.008s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    0.797s  (  0.792s elapsed)\n\n  %GC     time       5.9%  (1.0% elapsed)\n\n  Alloc rate    5,010,874,912 bytes per MUT second\n\n  Productivity  94.1% of total user, 99.0% of total elapsed\n</code></pre>\n\n<p>This used <code>0.00002</code> times as much memory and ran 10 times as fast.</p>\n\n<p>I don't know if this will improve on Thomas DeBuisson's <a href=\"https://stackoverflow.com/a/43604864/414413\">answer that improves <code>advance</code></a> but still leaves a lazy <code>iterate advance'</code> in place. It would be easy to check; add the <code>iterate'</code> code to that answer and use <code>iterate'</code> in place of <code>iterate</code> in that answer.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 2, "accepted_answer_id": 43604864, "answer_count": 3, "score": 6, "last_activity_date": 1534917417, "creation_date": 1493096237, "last_edit_date": 1534917417, "question_id": 43601927, "link": "https://stackoverflow.com/questions/43601927/efficient-bit-fiddling-in-a-lfsr-implementation", "title": "Efficient bit-fiddling in a LFSR implementation", "body": "<p>Although I have a good LSFR C implementation I thought I'd try the same in Haskell - just to see how it goes. What I came up with, so far, is two orders of magnitude slower than the C implementation, which begs the question: <strong>How can the performance be improved?</strong> Clearly, the bit-fiddling operations are the bottleneck, and the profiler confirms this.</p>\n\n<p>Here's the baseline Haskell code using lists and <code>Data.Bits</code>:</p>\n\n<pre><code>import           Control.Monad      (when)\nimport           Data.Bits          (Bits, shift, testBit, xor, (.&amp;.), (.|.))\nimport           System.Environment (getArgs)\nimport           System.Exit        (exitFailure, exitSuccess)\n\ntap :: [[Int]]\ntap = [\n    [],            [],            [],            [3, 2],\n    [4, 3],        [5, 3],        [6, 5],        [7, 6],\n    [8, 6, 5, 4],  [9, 5],        [10, 7],       [11, 9],\n    [12, 6, 4, 1], [13, 4, 3, 1], [14, 5, 3, 1], [15, 14],\n    [16,15,13,4],  [17, 14],      [18, 11],      [19, 6, 2, 1],\n    [20, 17],      [21, 19],      [22, 21],      [23, 18],\n    [24,23,22,17], [25, 22],      [26, 6, 2, 1], [27, 5, 2, 1],\n    [28, 25],      [29, 27],      [30, 6, 4, 1], [31, 28],\n    [32,22,2,1],   [33,20],       [34,27,2,1],   [35,33],\n    [36,25],       [37,5,4,3,2,1],[38,6,5,1],    [39,35],\n    [40,38,21,19], [41,38],       [42,41,20,19], [43,42,38,37],\n    [44,43,18,17], [45,44,42,41], [46,45,26,25], [47,42],\n    [48,47,21,20], [49,40],       [50,49,24,23], [51,50,36,35],\n    [52,49],       [53,52,38,37], [54,53,18,17], [55,31],\n    [56,55,35,34], [57,50],       [58,39],       [59,58,38,37],\n    [60,59],       [61,60,46,45], [62,61,6,5],   [63,62]        ]\n\nxor' :: [Bool] -&gt; Bool\nxor' = foldr xor False\n\nmask ::  (Num a, Bits a) =&gt; Int -&gt; a\nmask len = shift 1 len - 1\n\nadvance :: Int -&gt; [Int] -&gt; Int -&gt; Int\nadvance len tap lfsr\n    | d0        = shifted\n    | otherwise = shifted .|. 1\n    where\n        shifted = shift lfsr 1 .&amp;. mask len\n        d0 = xor' $ map (testBit lfsr) tap'\n        tap' = map (subtract 1) tap\n\nmain :: IO ()\nmain = do\n    args &lt;- getArgs\n    when (null args) $ fail \"Usage: lsfr &lt;number-of-bits&gt;\"\n    let len = read $ head args\n    when (len &lt; 8) $ fail \"No need for LFSR\"\n    let out = last $ take (shift 1 len) $ iterate (advance len (tap!!len)) 0\n    if out == 0 then do\n        putStr \"OK\\n\"\n        exitSuccess\n    else do\n        putStr \"FAIL\\n\"\n        exitFailure\n</code></pre>\n\n<p>Basically it tests whether the <a href=\"https://en.wikipedia.org/wiki/Linear-feedback_shift_register\" rel=\"nofollow noreferrer\">LSFR</a> defined in <code>tap :: [[Int]]</code> for any given bit-length is of maximum-length. (More precisely, it just checks whether the LSFR reaches the initial state (zero) after 2<sup>n</sup> iterations.)</p>\n\n<p>According to the profiler the most costly line is the feedback bit <code>d0 = xor' $ map (testBit lfsr) tap'</code>.</p>\n\n<p>What I've tried so far:</p>\n\n<ul>\n<li>use <code>Data.Array</code>: Attempt abandoned because there's no foldl/r</li>\n<li>use <code>Data.Vector</code>: Slightly faster than the baseline</li>\n</ul>\n\n<p>The compiler options I use are: <code>-O2</code>, <code>LTS Haskell 8.12 (GHC-8.0.2)</code>.</p>\n\n<p>The reference C++ program can be found on <a href=\"https://gist.github.com/mcmayer/c92353c24a7ffce99ed8e2f098623ca1\" rel=\"nofollow noreferrer\">gist.github.com</a>.</p>\n\n<p>The Haskell code can't be expected (?) to run as fast as the C code, but two orders of magnitude is too much, there must be a better way to do the bit-fiddling.</p>\n\n<p><strong>Update: Results of applying the optimisations suggested in the answers</strong></p>\n\n<ul>\n<li>The reference C++ program with input 28, compiled with LLVM 8.0.0, runs in 0.67s on my machine (the same with clang 3.7 is marginally slower, 0.68s)</li>\n<li>The baseline Haskell code runs about 100x slower (because of the space inefficiency don't try it with inputs larger than 25)</li>\n<li>With the rewrite of <a href=\"https://stackoverflow.com/a/43604864/1505120\">@Thomas M. DuBuisson</a>, still using the default GHC backend, the execution time goes down to 5.2s</li>\n<li>With the rewrite of <a href=\"https://stackoverflow.com/users/216164/thomas-m-dubuisson\">@Thomas M. DuBuisson</a>, now using the LLVM backend (GHC option <code>-O2 -fllvm</code>), the execution time goes down to 1.7s\n\n<ul>\n<li>Using GHC option <code>-O2 -fllvm -optlc -mcpu=native</code> brings this to 0.73s</li>\n</ul></li>\n<li>Replacing <code>iterate</code> with <code>iterate'</code> of @cirdec makes no difference when Thomas' code is used (both with the default 'native' backend and LLVM). However, it <em>does</em> make a difference when the baseline code is used.</li>\n</ul>\n\n<p>So, we've come from 100x to 8x to 1.09x, i.e. only 9% slower than C!</p>\n\n<p><strong>Note</strong> \nThe LLVM backend to GHC 8.0.2 requires LLVM 3.7. On Mac OS X this means installing this version with <code>brew</code> and then symlinking <code>opt</code> and <code>llc</code>. See <a href=\"http://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/codegens.html\" rel=\"nofollow noreferrer\">7.10. GHC Backends</a>.</p>\n"}, {"tags": ["pointers", "haskell", "ghc", "imperative-programming"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1493094255, "post_id": 43601230, "comment_id": 74252774, "body": "Completely orthogonal to the question, but: you are apparently already adding one unfamiliar technology (Haskell) to your project. Are you sure you want to kill the project before it even gets off the ground by adding another? I strongly recommend you start simple. Make sure that boring old &quot;slow&quot; references are actually a problem before you try to dive off the deep end. (I hope this warning will not discourage folks from trying to write a good answer, though.)"}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493098229, "post_id": 43601230, "comment_id": 74254059, "body": "@DanielWagner It&#39;s for a research project, didn&#39;t mention that. And Haskell is not unfamiliar, I&#39;m just more familiar with dependently typed programming in my PhD. Also, the code is optional, so there will be a &quot;very fast&quot; compilation method that might use this library but there are two other ways to compile code. This is interesting for benchmarks comparing to other programming languages such as Java or scripting languages."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1493099451, "post_id": 43601230, "comment_id": 74254607, "body": "This blog post makes the library sound like a workshop for ekmett to explore his sophisticated ideas, not really a well-polished set of tools for use by others. He has marked it as such, as far as I can tell, with &quot;Stability   :  experimental&quot;, and advises you additionally that the implementation of LinkCut is not intended for public use by marking it Internal. Now, I know you don&#39;t want to use it, but frankly even understanding it is probably pretty advanced. I&#39;d leave this library alone, personally."}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "edited": false, "score": 0, "creation_date": 1493103511, "post_id": 43601230, "comment_id": 74256598, "body": "Yes, I understand that it is internal. I am still interested in running benchmarks as a lower barrier what can be achieved with pointers in Haskell."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1493118084, "post_id": 43601230, "comment_id": 74266348, "body": "Out of curiosity, what is your use case exactly? Are you writing an interpreter in Haskell for your imperative language? Or are you trying to improve the compilation times of your language? (If so, are you absolutely certain that pointer hops are the bottleneck in your compiler?)"}], "answers": [{"comments": [{"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "edited": false, "score": 3, "creation_date": 1493865479, "post_id": 43624445, "comment_id": 74587025, "body": "I started a bounty to honor your answer (will give you as soon as that is possible)"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 7, "last_activity_date": 1493176947, "creation_date": 1493176947, "answer_id": 43624445, "question_id": 43601230, "link": "https://stackoverflow.com/questions/43601230/fast-impertive-pointers-static-unboxing-etc-with-struct-library/43624445#43624445", "title": "Fast impertive pointers (static, unboxing, etc.) with Struct library", "body": "<p>I managed to get your <code>DLL</code> type working with <code>Structs</code> as follows:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, RoleAnnotations #-}\nmodule DubLiList where\n\nimport Control.Monad.Primitive\nimport Data.Struct.TH\nimport Data.Struct\nimport Data.Struct.Internal\n\n\nmakeStruct [d|\n  data DLL a s = DLL\n    { prev :: !(DLL a s)\n    , value :: a\n    , next :: !(DLL a s)\n    }\n  |]\n\nnew :: (PrimMonad m) =&gt; a -&gt; m (DLL a (PrimState m))\nnew x = st $ newDLL Nil x Nil\n\ninsert :: (PrimMonad m) =&gt; a -&gt; DLL a (PrimState m) -&gt; m (DLL a (PrimState m))\ninsert x this = st $ do\n    prev' &lt;- get prev this\n    new &lt;- newDLL prev' x this\n    set prev this new\n    set next prev' new\n    return new\n\ndelete :: (PrimMonad m) =&gt; DLL a (PrimState m) -&gt; m ()\ndelete this = st $ do\n    prev' &lt;- get prev this\n    next' &lt;- get next this\n    set next prev' next'\n    set prev next' prev'\n\ntoList :: (PrimMonad m) =&gt; DLL a (PrimState m) -&gt; m [a]\ntoList this = st $ do\n    if isNil this then return [] else do\n        x &lt;- getField value this\n        that &lt;- get next this\n        (x:) &lt;$&gt; toList that\n</code></pre>\n\n<p>Here's an example of using it:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    dll &lt;- new \"foo\"           -- [foo]\n    dll' &lt;- insert \"bar\" dll   -- [bar, foo]\n    insert \"baz\" dll           -- [bar, baz, foo]\n\n    xs &lt;- toList dll'\n    print xs\n</code></pre>\n"}], "owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 2, "accepted_answer_id": 43624445, "answer_count": 1, "score": 12, "last_activity_date": 1493865433, "creation_date": 1493091944, "question_id": 43601230, "link": "https://stackoverflow.com/questions/43601230/fast-impertive-pointers-static-unboxing-etc-with-struct-library", "title": "Fast impertive pointers (static, unboxing, etc.) with Struct library", "body": "<p>I am interested in using more efficient pointers for a project implementing an imperative language in Haskell. There is already a <a href=\"https://github.com/ekmett/structs\" rel=\"noreferrer\">library for that: Struct</a>. There is a <a href=\"https://www.schoolofhaskell.com/user/edwardk/unlifted-structures\" rel=\"noreferrer\">blog post</a> on it and <a href=\"http://ekmett.github.io/structs/Data-Struct.html\" rel=\"noreferrer\">brief documentation</a>.</p>\n\n<p>The problem is there is only a quite sophisticated example of <a href=\"https://github.com/ekmett/structs/blob/master/src/Data/Struct/Internal/LinkCut.hs\" rel=\"noreferrer\">linkcut trees</a>. For someone like me who doesn't use Haskell on a daily basis, it is quite exhausting to battle little documented code, template haskell, etc.</p>\n\n<p>I would need a simpler example to get started, along the lines of expressing either of those two data types:</p>\n\n<pre><code>import Data.IORef\n\ndata DLL a = DLL a (Maybe (IORef (DLL a))) (Maybe (IORef (DLL a)))\n\ndata DLLINT = DLLINT Int (Maybe (IORef DLLINT)) (Maybe (IORef DLLINT))\n</code></pre>\n\n<p>This should be just a few simple lines for someone who is fluent in Haskell/GHC.</p>\n\n<p>How do I express one of the data types above with the Struct library?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1493088734, "post_id": 43600657, "comment_id": 74251467, "body": "In short: Because that isn&#39;t legal Haskell syntax.  Longer: binding variables is <code>let var = expr</code>.  Also: <code>map (+) n</code> won&#39;t give a single number but a list of functions, you probably want fold. Also: <code>f x :: ty : xs</code> won&#39;t parse right you need parens such as <code>(f x :: ty) : xs)</code>."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1493098634, "post_id": 43600657, "comment_id": 74254211, "body": "Also <code>sum</code> is already taken as a variable name, it&#39;s the name of a function.  Do a <code>:t sum</code> and a <code>:i sum</code> in ghci, or search it.    I&#39;d suggest that you comment out your <code>main</code> function for now and get your <code>giveNum</code> function working.  It&#39;s really close to working, especially with Thomas&#39; last suggestion.  Then, once <code>giveNum</code> works, start on <code>main</code>."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1493099101, "post_id": 43600657, "comment_id": 74254434, "body": "Like, really close. Like, one character away from working."}], "answers": [{"tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": true, "score": 1, "last_activity_date": 1493122365, "last_edit_date": 1493122365, "creation_date": 1493101188, "answer_id": 43603042, "question_id": 43600657, "link": "https://stackoverflow.com/questions/43600657/why-am-i-getting-a-parse-error-on-input-haskell/43603042#43603042", "title": "Why am I getting a parse error on input &#39;=&#39; Haskell", "body": "<p>To answer your question: <strong>because your code has syntax error.</strong></p>\n\n<p>Some additional comments:</p>\n\n<ol>\n<li><p>You don't need <code>module</code> when working with a single code file. <code>module</code> is for writing a library.</p></li>\n<li><p>Bindings in <code>main :: IO ()</code> need <code>let</code> because it is in the <code>IO Monad</code>. Read more about <code>do</code> <a href=\"https://en.wikibooks.org/wiki/Haskell/do_notation\" rel=\"nofollow noreferrer\">here</a></p></li>\n<li><p>Setting <code>stdin</code> buffering mode only once is enough.</p></li>\n<li><p>There is a <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:sum\" rel=\"nofollow noreferrer\">sum</a> function in Prelude.</p></li>\n</ol>\n\n<p>I tried to make the code as close to the original as possible. However, this is not good Haskell code.</p>\n\n<pre><code>import System.IO\n\nmain :: IO ()\nmain = do\n  hSetBuffering stdin LineBuffering\n  n &lt;- giveNum\n  let summation = sum n\n  putStrLn $ \"The sum is \" ++ show summation\n\ngiveNum :: IO [Int]\ngiveNum = do\n  putStrLn \"Enter num\"\n  num &lt;- read &lt;$&gt; getLine\n\n  if num == 0\n    then return []\n    else do\n         rest &lt;- giveNum\n         return $ num: rest\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ runhaskell givenum.hs \nEnter num\n1\nEnter num\n2\nEnter num\n3\nEnter num\n0\nThe sum is 6\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 6515250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db8d3320f9de0401804a1058b27289c?s=128&d=identicon&r=PG&f=1", "display_name": "TanasaIoan", "link": "https://stackoverflow.com/users/6515250/tanasaioan"}, "is_accepted": false, "score": 0, "last_activity_date": 1493190640, "last_edit_date": 1493190640, "creation_date": 1493190212, "answer_id": 43627191, "question_id": 43600657, "link": "https://stackoverflow.com/questions/43600657/why-am-i-getting-a-parse-error-on-input-haskell/43627191#43627191", "title": "Why am I getting a parse error on input &#39;=&#39; Haskell", "body": "<p>Because if you want to \"assign\" something in a do statement you need to put <code>let</code> before it, so <code>sum = map (+) n</code> turns into <code>let sum = map (+) n</code>, but as wizzup pointed out sum is already defined as a standard function and also <code>let sum = map (+) n</code> wont return the sum of integers in <code>n</code> , for that you would need <a href=\"http://zvon.org/other/haskell/Outputprelude/foldr_f.html\" rel=\"nofollow noreferrer\"><code>foldr</code></a></p>\n\n<p><code>let sumOfn = foldr (+) 0 n</code></p>\n\n<p>But it would be easier to do <code>let sumOfn = sum n</code>\nAlso, <code>let f =map (+) n</code> creates a list of functions of type <code>Int-&gt;Int</code>, if n is [1,2,3] then f is [(+1),(+2),(+3)].</p>\n"}], "owner": {"reputation": 3, "user_id": 7916841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/629f695c46dd31a16343acb484d40f6b?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac Spivack", "link": "https://stackoverflow.com/users/7916841/isaac-spivack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 0, "accepted_answer_id": 43603042, "answer_count": 2, "score": 0, "last_activity_date": 1493190640, "creation_date": 1493087882, "question_id": 43600657, "link": "https://stackoverflow.com/questions/43600657/why-am-i-getting-a-parse-error-on-input-haskell", "title": "Why am I getting a parse error on input &#39;=&#39; Haskell", "body": "<p>I am getting a parse error on input '=' when trying to run the following code</p>\n\n<pre><code>module GiveNums\n  where\nimport System.IO\n\nmain = do\n  hSetBuffering stdin LineBuffering\n  n &lt;- giveNum\n  sum = map (+) n\n  putStrLn \"The sum is \" ++ show sum\n\ngiveNum = do\n  hSetBuffering stdin LineBuffering\n  putStrLn \"Enter num\"\n  num &lt;- getLine\n  if read num == 0\n    then return []\n  else do\n   rest &lt;- giveNum\n   return ((read num :: Int: rest)\n</code></pre>\n"}, {"tags": ["haskell", "currying", "partial-application"], "answers": [{"tags": [], "owner": {"reputation": 433, "user_id": 5425899, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CG0is.png?s=128&g=1", "display_name": "Elliot E", "link": "https://stackoverflow.com/users/5425899/elliot-e"}, "is_accepted": false, "score": 1, "last_activity_date": 1493089411, "creation_date": 1493089411, "answer_id": 43600873, "question_id": 43600394, "link": "https://stackoverflow.com/questions/43600394/need-help-in-understanding-types-based-on-curry/43600873#43600873", "title": "Need help in understanding types (based on curry)", "body": "<p>Curry takes only one argument which is a function and returns a function. That argument is a function with the signature</p>\n\n<pre><code>((a, b) -&gt; c)\n</code></pre>\n\n<p>i.e. a function that takes one argument: a pair of things a and b and returns another thing c. Curry does something magical to that function and turns it into a new function:</p>\n\n<pre><code>(a -&gt; b -&gt; c)\n</code></pre>\n\n<p>i.e. a function that takes two arguments: a thing a and a thing b and returns a thing c. </p>\n\n<p>So the code:</p>\n\n<pre><code>curry f a b\n</code></pre>\n\n<p>is like:</p>\n\n<pre><code>let newFunction = curry(f)\nnewFunction a b\n</code></pre>\n\n<p>Basically curry transforms a function that takes a pair into a function that takes that pair as two arguments instead.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1493090315, "creation_date": 1493090315, "answer_id": 43600997, "question_id": 43600394, "link": "https://stackoverflow.com/questions/43600394/need-help-in-understanding-types-based-on-curry/43600997#43600997", "title": "Need help in understanding types (based on curry)", "body": "<p>I believe the source of your confusion is this passage:</p>\n\n<blockquote>\n  <p>the curry function takes function f a b</p>\n</blockquote>\n\n<p>Not really: <code>curry</code> takes a function, and that function is <code>f</code>. As for <code>a</code> and <code>b</code>, they are arguments that are passed to the curried function. It is easier to see that by either adding a pair of superfluous parentheses, to make the partial application more evident...</p>\n\n<pre><code>(curry f) a b = f (a,b)\n</code></pre>\n\n<p>... or by shifting <code>a</code> and <code>b</code> to the right-hand side with a lambda:</p>\n\n<pre><code>curry f = \\a b -&gt; f (a,b)\n</code></pre>\n\n<p><code>f</code> is a function that takes a pair -- note that we give it a pair, <code>(a,b)</code>. <code>curry f</code>, on the other hand, takes the two arguments separately. That being so, the type of <code>curry</code> is indeed:</p>\n\n<pre><code>curry :: ((a, b) -&gt; c) -&gt; (a -&gt; b -&gt; c)\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 7847202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca11c8402338a3542071bc1c00447cc4?s=128&d=identicon&r=PG&f=1", "display_name": "Mariusz", "link": "https://stackoverflow.com/users/7847202/mariusz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 43600997, "answer_count": 2, "score": 2, "last_activity_date": 1557609442, "creation_date": 1493085809, "last_edit_date": 1557609442, "question_id": 43600394, "link": "https://stackoverflow.com/questions/43600394/need-help-in-understanding-types-based-on-curry", "title": "Need help in understanding types (based on curry)", "body": "<pre><code> curry f a b = f(a,b)\n</code></pre>\n\n<p>I thought:\nthe curry function takes function f a b  and returns f(a, b), so i thought the type is: </p>\n\n<pre><code>(a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c\n</code></pre>\n\n<p>so why the type is reversed?:</p>\n\n<pre><code>((a, b) -&gt; c) -&gt; (a -&gt; b -&gt; c)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1493236676, "post_id": 43600731, "comment_id": 74335191, "body": "I would say that Haskell (function application) is <i>left</i> associative: <code>print factorial2 5</code> is the same as <code>(print factorial2) 5</code>."}, {"owner": {"reputation": 433, "user_id": 5425899, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CG0is.png?s=128&g=1", "display_name": "Elliot E", "link": "https://stackoverflow.com/users/5425899/elliot-e"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1493251416, "post_id": 43600731, "comment_id": 74341258, "body": "@DavidYoung thanks you are totally right, got my left and right mixed up lol. Edited my post."}], "tags": [], "owner": {"reputation": 433, "user_id": 5425899, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CG0is.png?s=128&g=1", "display_name": "Elliot E", "link": "https://stackoverflow.com/users/5425899/elliot-e"}, "is_accepted": false, "score": 3, "last_activity_date": 1493251432, "last_edit_date": 1493251432, "creation_date": 1493088423, "answer_id": 43600731, "question_id": 43600051, "link": "https://stackoverflow.com/questions/43600051/cant-show-print-int-in-if-else-statement/43600731#43600731", "title": "Can&#39;t show/print int in if-else statement", "body": "<p>Haskell function application is left associative. What that means is that when you call <code>print factorial2 5</code> haskell interprets it as you passing 2 arguments to print: <code>factorial2</code> and <code>5</code>, but print only takes one argument. If your code was another language it would be equivalent to: <code>print(factorial2, 5)</code>. </p>\n\n<p>The reason <code>show factorial2 5</code> doesn't work is because everything in your do block is required to return an IO() but <code>show factorial2 5</code> returns a string.</p>\n\n<p>Simply <code>print (factorial2 5)</code> would work so that haskell knows you want to pass the result of <code>factorial2 5</code> to <code>print</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": false, "score": 0, "last_activity_date": 1493300404, "creation_date": 1493300404, "answer_id": 43659599, "question_id": 43600051, "link": "https://stackoverflow.com/questions/43600051/cant-show-print-int-in-if-else-statement/43659599#43659599", "title": "Can&#39;t show/print int in if-else statement", "body": "<p>The functions <em>show</em> has the type : <code>a -&gt; String</code>.\nSo it takes one argument and converts it to a string.</p>\n\n<p>In your line </p>\n\n<pre><code> else show factorial2 5  -- why can't pass here\n</code></pre>\n\n<p>you give <strong>two</strong> arguments, namely <em>factorial2</em> and <em>5</em>. </p>\n\n<p>You have to give one argument to the function <em>show</em>, in your case the result of <code>factorial2 5</code> Therefore you have to put <em>factorial2 5</em> into parenthesis:</p>\n\n<pre><code> else show (factorial2 5)\n</code></pre>\n\n<p>Often you will see the <em>$</em> operator:</p>\n\n<pre><code> else show $ factorial2 5\n</code></pre>\n\n<p>It allows you to save parenthesis.</p>\n"}], "owner": {"reputation": 2230, "user_id": 2467424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ee08540f63fa3664e73e6eeb0ef44b3?s=128&d=identicon&r=PG", "display_name": "pambda", "link": "https://stackoverflow.com/users/2467424/pambda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 791, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1493300404, "creation_date": 1493083309, "last_edit_date": 1493131330, "question_id": 43600051, "link": "https://stackoverflow.com/questions/43600051/cant-show-print-int-in-if-else-statement", "title": "Can&#39;t show/print int in if-else statement", "body": "<p>In the following code I am trying to show the result of factorial, which is an integer. I got the following error message, I am wondering what happened and why.   Thanks!</p>\n\n<pre><code>factorial2 0 = 1\nfactorial2 n = n * factorial2 (n-1)\n\nmain = do putStrLn \"What is 5! ?\"\n        x &lt;- readLn\n        if x == factorial2 5\n            then putStrLn \"Right\" \n            -- else print factorial2 5  -- why can't pass here\n            -- else show factorial2 5  -- why can't pass here\n            else putStrLn \"Wrong\"  -- this can pass, no problem\n\n-- Factorial.hs:10:20:\n--     Couldn't match expected type \u2018Integer -&gt; IO ()\u2019\n--                 with actual type \u2018IO ()\u2019\n--     The function \u2018print\u2019 is applied to two arguments,\n--     but its type \u2018(a0 -&gt; a0) -&gt; IO ()\u2019 has only one\n--     In the expression: print factorial2 5\n--     In a stmt of a 'do' block:\n--       if x == factorial2 5 then putStrLn \"Right\" else print factorial2 5\n-- Failed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "pandoc"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1493083517, "post_id": 43599851, "comment_id": 74250177, "body": "Better to change the type signature of <code>convert</code> to <code>String -&gt; Either PandocError String</code>, so that the caller of this <code>convert</code> function can take reasonable steps to react to an error. The type system is trying to warn you that <code>String -&gt; String</code> is not a good type for this function. Further evidence: you had to write <code>show err</code> in your <code>Left</code> case, which is obviously not a good result from this function."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 2, "last_activity_date": 1493082153, "last_edit_date": 1493082153, "creation_date": 1493081729, "answer_id": 43599851, "question_id": 43599693, "link": "https://stackoverflow.com/questions/43599693/pandoc-returning-either-type/43599851#43599851", "title": "Pandoc returning Either type", "body": "<p>Take a look at the types of the two functions you're trying to compose:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/pandoc-1.19.2.1/docs/Text-Pandoc.html#v:readHtml\" rel=\"nofollow noreferrer\"><code>readHtml</code></a><code>:: ReaderOptions Reader options -&gt; String -&gt; Either PandocError Pandoc</code></p>\n\n<p><code>readHtml</code> is an operation that can fail. To represent this, it returns <em>either</em> a PandocError or a valid Pandoc.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/pandoc-1.19.2.1/docs/Text-Pandoc.html#v:writePlain\" rel=\"nofollow noreferrer\"><code>writePlain</code></a><code>:: WriterOptions -&gt; Pandoc -&gt; String</code></p>\n\n<p><code>writePlain</code> expects a valid Pandoc only. </p>\n\n<p>The program must handle both cases: </p>\n\n<ol>\n<li><code>readHtml</code> returns a Left/error value </li>\n<li><code>readHtml</code> returns a Right/valid value</li>\n</ol>\n\n<p>This can be done in various ways, but for example:</p>\n\n<pre><code>import Text.Pandoc (writePlain, readHtml, def, pandocVersion)\n\nconvert :: String -&gt; String\nconvert = case readHtml def of\n  Left err -&gt; show err\n  Right doc -&gt; writePlain def doc\n</code></pre>\n\n<p><code>Either a b</code> is similar to <code>Maybe a</code> if you're familiar with that, except it can have extra information in the case of a failure. By convention, the <code>Left</code> constructor is used to represent an error value, and <code>Right</code> constructor is used to represent a normal value.</p>\n"}], "owner": {"reputation": 4001, "user_id": 1668057, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/FxrbB.jpg?s=128&g=1", "display_name": "ljs.dev", "link": "https://stackoverflow.com/users/1668057/ljs-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 43599851, "answer_count": 1, "score": 0, "last_activity_date": 1493098484, "creation_date": 1493080434, "last_edit_date": 1493098484, "question_id": 43599693, "link": "https://stackoverflow.com/questions/43599693/pandoc-returning-either-type", "title": "Pandoc returning Either type", "body": "<p>I'm lost as to where to step next in debugging this issue after some searching of similar but not quite the same errors.</p>\n\n<p>Relevant lines from <a href=\"https://github.com/leonstafford/pandoctest/blob/master/Main.hs\" rel=\"nofollow noreferrer\">this Haskell script</a></p>\n\n<pre><code>import Text.Pandoc (writePlain, readHtml, def, pandocVersion)\n\nconvert :: String -&gt; String\nconvert = writePlain def . readHtml def\n</code></pre>\n\n<p>Are resulting in this error:</p>\n\n<pre><code>Main.hs:11:28: error:\n    \u2022 Couldn't match type \u2018Either\n                             Text.Pandoc.Error.PandocError Text.Pandoc.Definition.Pandoc\u2019\n                     with \u2018Text.Pandoc.Definition.Pandoc\u2019\n      Expected type: String -&gt; Text.Pandoc.Definition.Pandoc\n        Actual type: String\n                     -&gt; Either\n                          Text.Pandoc.Error.PandocError Text.Pandoc.Definition.Pandoc\n    \u2022 In the second argument of \u2018(.)\u2019, namely \u2018readHtml def\u2019\n      In the expression: writePlain def . readHtml def\n      In an equation for \u2018convert\u2019:\n          convert = writePlain def . readHtml def\n</code></pre>\n\n<p>Environment details:</p>\n\n<ul>\n<li>GHC 8.0.1</li>\n<li>Cabal 1.24</li>\n<li>Arch x64 4.10.9</li>\n</ul>\n\n<p>with <code>pandoc</code> having been <code>cabal install</code>'d</p>\n\n<p>Thanks to answer, comment and a few hours of bashing head against wall, working solution as below:</p>\n\n<pre><code>import Network.HTTP.Conduit (simpleHttp)\nimport Data.Text.Lazy as TL\nimport Data.Text.Lazy.Encoding as TLE\nimport Text.Pandoc\nimport Text.Pandoc.Error\nimport Data.Set\n\nhtmlToPlainText :: String -&gt; String\nhtmlToPlainText = writePlain (def {\n    writerExtensions = Data.Set.filter (/= Ext_raw_html) (writerExtensions def)\n  }) . handleError . readHtml def\n\nmain :: IO ()\nmain = do\n    response &lt;- simpleHttp \"https://leonstafford.github.io\"\n\n    let body = TLE.decodeUtf8 ( response )\n    let bodyAsString = TL.unpack ( body )\n\n    putStrLn $ htmlToPlainText bodyAsString\n</code></pre>\n"}, {"tags": ["haskell", "proof", "induction"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 3, "creation_date": 1493074073, "post_id": 43598838, "comment_id": 74247950, "body": "This is for specific <code>f</code> and <code>g</code>, right? (For arbitrary <code>f</code> and <code>g</code> it does not hold.)"}, {"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1493074210, "post_id": 43598838, "comment_id": 74247991, "body": "They are both  of type [Int]-&gt;[Int] and both take a finite integer list."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 5, "last_activity_date": 1493075139, "last_edit_date": 1493075139, "creation_date": 1493074547, "answer_id": 43598951, "question_id": 43598838, "link": "https://stackoverflow.com/questions/43598838/how-to-set-up-an-inductive-proof-in-haskell/43598951#43598951", "title": "How to set up an inductive proof in haskell?", "body": "<p>Disproof by counterexample:</p>\n\n<pre><code>f xs = []\ng xs = [1]\n</code></pre>\n\n<p>If you want this property to hold, you need more specific constraints on what <code>f</code> and <code>g</code> are.</p>\n\n<p>You may be thinking of the law that</p>\n\n<pre><code>(map f . map g) == map (f . g)\n</code></pre>\n\n<p>which can indeed be proven.</p>\n"}, {"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1493080744, "post_id": 43599563, "comment_id": 74249590, "body": "This is very different than saying <code>f (g xs) == g (f xs)</code> which, as others have pointed out, is false in general."}], "tags": [], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "is_accepted": false, "score": -1, "last_activity_date": 1493079378, "creation_date": 1493079378, "answer_id": 43599563, "question_id": 43598838, "link": "https://stackoverflow.com/questions/43598838/how-to-set-up-an-inductive-proof-in-haskell/43599563#43599563", "title": "How to set up an inductive proof in haskell?", "body": "<p>Found this from somewhere </p>\n\n<pre><code>Theorem: (map f . map g) xs = map (f . g) xs\n       - Proof is by induction on xs\n    *** Base Case, xs = []\n        - Left side: (map f . map g) [] = map f (map g []) = map f [] = []\n        - Right side: map (f . g) [] = []\n    *** Inductive Case, xs = k:ks\n        - Inductive Hypothesis: (map f . map g) ks = map (f . g) ks\n        - Left Side\n          + (map f . map g) xs\n          + map f (map g (k:ks))\n          + map f ((g k) : (map g ks))\n          + (f (g k)) : (map f (map g ks))\n          + ((f . g) k) : ((map f . map g) ks)  i.e. change from bracket form back to point form\n          + ((f . g) k) : (map (f . g) ks) by inductive hypothesis\n          + map (f . g) (k:ks) by definition of map\n          + map (f . g) xs \n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 1, "closed_date": 1493109743, "answer_count": 2, "score": -1, "last_activity_date": 1493079378, "creation_date": 1493073848, "last_edit_date": 1493074172, "question_id": 43598838, "link": "https://stackoverflow.com/questions/43598838/how-to-set-up-an-inductive-proof-in-haskell", "closed_reason": "Needs more focus", "title": "How to set up an inductive proof in haskell?", "body": "<p>I need to prove </p>\n\n<pre><code>f (g xs) == g (f xs)\n</code></pre>\n\n<p>whenver xs is a finite list of Ints.</p>\n\n<p>Assume both f and g are of type [Int]->[Int]</p>\n"}, {"tags": ["database", "haskell", "orm"], "comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1493196491, "post_id": 43598762, "comment_id": 74306874, "body": "Well, what are your requirements? How large and complex is your schema? Would this result in you having to hand-roll lots of SQL to read/write to the tables?"}, {"owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1493197296, "post_id": 43598762, "comment_id": 74307436, "body": "atc: Give me some clues to find out how complicated my software is"}], "owner": {"reputation": 1602, "user_id": 3105524, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/5b169766a0453f1ace846e5d425c940b?s=128&d=identicon&r=PG", "display_name": "Kamyar", "link": "https://stackoverflow.com/users/3105524/kamyar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 269, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1493138012, "creation_date": 1493073417, "last_edit_date": 1493138012, "question_id": 43598762, "link": "https://stackoverflow.com/questions/43598762/when-should-i-use-haskell-orm-like-libraries", "title": "When should I use Haskell ORM(-like) libraries?", "body": "<p>I am developing a project which saves some vehicle locations and use them for tracking the vehicles. I have a login service and some other simple location saving and tracking services. I am porting some very similar Python project (written by me) and the Python one is using SqlAlchemy. Using something like Persistent in Haskell version would be easy for me! But some articles discourage using ORM and encourage using something like Hasql. In what conditions using ORM would be better?</p>\n"}, {"tags": ["haskell", "cuda", "haskell-stack"], "comments": [{"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1493071543, "post_id": 43597927, "comment_id": 74247149, "body": "<a href=\"http://stackoverflow.com/questions/30442524/calling-a-cuda-hello-world-from-haskell-using-the-ffi-gives-wrong-results\">this</a> may be of interest"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1493075574, "post_id": 43597927, "comment_id": 74248349, "body": "Your question is about Haskell and CUDA. Why the C tag?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1493075624, "post_id": 43597927, "comment_id": 74248370, "body": "This answer might help: <a href=\"http://stackoverflow.com/a/37643200/925978\">stackoverflow.com/a/37643200/925978</a>"}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1493126883, "post_id": 43597927, "comment_id": 74272930, "body": "You might want to take a look at the <a href=\"https://hackage.haskell.org/package/cuda\" rel=\"nofollow noreferrer\">cuda</a> package. It lets you do some cool stuff like load pre-compiled ptx code at runtime."}, {"owner": {"reputation": 59, "user_id": 4661783, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bacb3e9406c0a0bf55575eb2ff6a12f9?s=128&d=identicon&r=PG&f=1", "display_name": "vivace", "link": "https://stackoverflow.com/users/4661783/vivace"}, "edited": false, "score": 0, "creation_date": 1493244544, "post_id": 43597927, "comment_id": 74339095, "body": "thanks, the cuda package looks great! Do I need to know a lot about make files to work with it?"}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1493092646, "post_id": 43600087, "comment_id": 74252381, "body": "Did you actually try the <code>--with-gcc=&#47;path&#47;to&#47;gcc</code>? I&#39;ve read that GHC is <i>very</i> picky about which compiler it uses, and I couldn&#39;t get g++ to work."}], "tags": [], "owner": {"reputation": 833, "user_id": 7847896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e72cb1d5eceb94842bec50894e6943?s=128&d=identicon&r=PG&f=1", "display_name": "zbw", "link": "https://stackoverflow.com/users/7847896/zbw"}, "is_accepted": false, "score": 1, "last_activity_date": 1493083546, "creation_date": 1493083546, "answer_id": 43600087, "question_id": 43597927, "link": "https://stackoverflow.com/questions/43597927/haskell-ffi-with-cuda-using-stack-build-tool-set-up/43600087#43600087", "title": "Haskell FFI with CUDA using stack build tool set up?", "body": "<p>You could manually compile the CUDA code before using cabal:</p>\n\n<pre><code>nvcc -c cudacode.c\n</code></pre>\n\n<p>Then build with cabal. Example <code>.cabal</code> file:</p>\n\n<pre><code>name:                package\nversion:             0.1\nbuild-type:          Simple\n\nexecutable main\n  main-is:             Main.hs\n  build-depends:       base\n  extra-libraries:     stdc++\n  ghc-options:         -pgmlg++ cudacode.o\n  C-sources:           just_c.c, some_cpp.cpp\n  Includes:            just_c.h, cudacode.h, some_cpp.h\n</code></pre>\n\n<p>Without C++, you can omit the <code>extra-libraries</code> field and the first <code>ghc-option</code>.</p>\n\n<p>Alternatively, you can specify <code>nvcc</code> as the compiler for everything, and not have to compile it separately:</p>\n\n<pre><code>cabal install --with-gcc=/path/to/nvcc\n</code></pre>\n\n<p>Example <code>.cabal</code> file:</p>\n\n<pre><code>name:                package\nversion:             0.1\nbuild-type:          Simple\n\nexecutable main\n  main-is:             Main.hs\n  build-depends:       base\n  extra-libraries:     stdc++\n  ghc-options:         -pgmlg++\n  C-sources:           just_c.c, cudacode.c, some_cpp.cpp\n  Includes:            just_c.h, cudacode.h, some_cpp.h\n</code></pre>\n\n<p>Again, the <code>extra-libraries</code> and <code>ghc-options</code> are only necessary with C++.</p>\n"}], "owner": {"reputation": 59, "user_id": 4661783, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/bacb3e9406c0a0bf55575eb2ff6a12f9?s=128&d=identicon&r=PG&f=1", "display_name": "vivace", "link": "https://stackoverflow.com/users/4661783/vivace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1493083546, "creation_date": 1493068879, "last_edit_date": 1493075543, "question_id": 43597927, "link": "https://stackoverflow.com/questions/43597927/haskell-ffi-with-cuda-using-stack-build-tool-set-up", "title": "Haskell FFI with CUDA using stack build tool set up?", "body": "<p>I have a project which is working quite nicely with haskell, stack, and some C code via FFI. I would like to add some CUDA code to offload some computations to the GPU. Kind of not sure how this needs to be configured?</p>\n\n<p>in my .cabal file I simply have:</p>\n\n<p><code>c-sources: src/ccode/blah.c, src/ccode/blah.h, src/ccode/blah2.c, etc..\n cc-options:  -std=c99</code></p>\n\n<p>when i run stack build it nicely builds both the C and the haskell. How can I add CUDA to the mix?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493062361, "post_id": 43596232, "comment_id": 74242660, "body": "Why are you using <code>&lt;-</code> and <code>do</code> blocks? How is <code>fieldA</code> a matrix? It looks like a function to me. On second thought, this is a valid way to define a matrix, just not a very intuitive one IMO. Changing a value in the last column of the &quot;matrix&quot; means making a new &quot;matrix&quot; that returns the new value if the input matches the inputs you are changing."}, {"owner": {"reputation": 69, "user_id": 5833099, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3Kd80.png?s=128&g=1", "display_name": "Landau", "link": "https://stackoverflow.com/users/5833099/landau"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1493063098, "post_id": 43596232, "comment_id": 74243050, "body": "@Lazersmoke yes, you&#39;re right. <code>fieldA</code> is a function but should represent a matrix. The idea behind is the game &quot;Battleship&quot;. I only tried to use <code>&lt;-</code> because <code>=</code> doesn&#39;t work as well. I got the error message: <i>Perhaps this statement should be within a &#39;do&#39; block?</i>.  Thats the reason why i tried to use a do block."}], "answers": [{"comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1493066392, "post_id": 43596919, "comment_id": 74244902, "body": "Here, <code>type Matrix = Int -&gt; Int -&gt; Int</code>. Also, the where clause is redundant, and can be inlined for the same effect."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1493064686, "creation_date": 1493064686, "answer_id": 43596919, "question_id": 43596232, "link": "https://stackoverflow.com/questions/43596232/how-do-i-change-a-matrix-entry-and-return-the-matrix/43596919#43596919", "title": "How do I change a matrix entry and return the matrix", "body": "<p>Perhaps you want something like this:</p>\n\n<pre><code>changeValue :: Int -&gt; Int -&gt; Matrix -&gt; Matrix\nchangeValue i j matrix = matrix2\n   where\n   matrix2 i2 j2 | i2==i &amp;&amp; j2==j = 0\n                 | otherwise      = matrix i2 j2\n</code></pre>\n\n<p>It is recommended to always add type signatures to your top level bindings. This can greatly help clarifying one's ideas, as well as helping the compiler to provide good error messages.</p>\n"}], "owner": {"reputation": 69, "user_id": 5833099, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3Kd80.png?s=128&g=1", "display_name": "Landau", "link": "https://stackoverflow.com/users/5833099/landau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 43596919, "answer_count": 1, "score": -1, "last_activity_date": 1493067846, "creation_date": 1493061991, "last_edit_date": 1493067846, "question_id": 43596232, "link": "https://stackoverflow.com/questions/43596232/how-do-i-change-a-matrix-entry-and-return-the-matrix", "title": "How do I change a matrix entry and return the matrix", "body": "<p>I want to define a function which takes three parameters, the coordinates i, j and the matrix itself.\nIt has to change the entry at the given position (i,j) and return the new matrix.</p>\n\n<p>My predefined Matrix:</p>\n\n<pre><code>fieldA 1 1 = 0\nfieldA 1 2 = 1\nfieldA 2 1 = 1\nfieldA 2 2 = 0\n</code></pre>\n\n<p>My first attempt was the following code &amp; error:</p>\n\n<pre><code>changeValue i j matrix =\n        do matrix i j &lt;- 0\n        return matrix\n\ntest.hs:113:12: error:\n    Parse error in pattern: matrix\n    Possibly caused by a missing 'do'?\n</code></pre>\n\n<p>My second attemt was the following code &amp; error:</p>\n\n<pre><code>changeValue i j matrix =\n        map (\\a b -&gt; if a == i &amp;&amp; b == j then matrix i j &lt;- 0 else matrix i j &lt;- matrix i j) matrix\n\ntest.hs:113:58: error:\n    parse error on input \u2018&lt;-\u2019\n    Perhaps this statement should be within a 'do' block?\n</code></pre>\n\n<p>I think the solution is simple but I'm an absolutely beginner in Haskell and\nI would appreciate any kind of help</p>\n"}, {"tags": ["algorithm", "haskell", "tuples"], "comments": [{"owner": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "edited": false, "score": 1, "creation_date": 1493059671, "post_id": 43595428, "comment_id": 74241092, "body": "Is this your code, or something provided in your course materials?"}, {"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "reply_to_user": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "edited": false, "score": 0, "creation_date": 1493061337, "post_id": 43595428, "comment_id": 74242086, "body": "It&#39;s solution provided in the class which I don&#39;t understand."}, {"owner": {"user_type": "does_not_exist", "display_name": "user933161"}, "edited": false, "score": 0, "creation_date": 1493061467, "post_id": 43595428, "comment_id": 74242161, "body": "The problem looks more for Prolog, than for Haskell :)"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1493062011, "post_id": 43595428, "comment_id": 74242449, "body": "This implementation looks fairly suspect in terms of Haskell design principles. I&#39;ll write up a better implementation of <code>CourseData</code> that makes illegal sets of projects unrepresentable soon."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493060694, "post_id": 43595822, "comment_id": 74241698, "body": "<code>hasPair</code> needs an <code>Eq a</code> constraint added to the type signature to use <code>x1 == y1</code> etc."}, {"owner": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493060898, "post_id": 43595822, "comment_id": 74241832, "body": "@Cirdec Yes it did. Fixed. I should check that the snippet works before posting."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1493062327, "post_id": 43595822, "comment_id": 74242636, "body": "how about <code>(x1,x2)==(y1,y2)</code> instead of <code>x1 == y1 &amp;&amp; x2 == y2 </code>"}, {"owner": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1493071925, "post_id": 43595822, "comment_id": 74247274, "body": "@karakfa Yes, that would be more succinct and elegant."}], "tags": [], "owner": {"reputation": 1209, "user_id": 2738025, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LSnV8.png?s=128&g=1", "display_name": "castle-bravo", "link": "https://stackoverflow.com/users/2738025/castle-bravo"}, "is_accepted": false, "score": 1, "last_activity_date": 1493060815, "last_edit_date": 1493060815, "creation_date": 1493060451, "answer_id": 43595822, "question_id": 43595428, "link": "https://stackoverflow.com/questions/43595428/avoid-duplicates-in-haskell/43595822#43595822", "title": "Avoid duplicates in Haskell", "body": "<p><code>hasPair xs name1 name2</code> checks whether there is a 3-tuple in the list <code>xs</code> where the first two elements are <code>name1</code> and <code>name2</code>, though not in that order. <code>legal2</code> applies this same check for every project group, but in such a way that each pair of projects only gets checked once. I think the 'hasPair' function would be more understandable with a type signature. Here's (I think), a clearer definition of the function:</p>\n\n<pre><code>hasPair :: Eq a =&gt; [(a, a, b)] -&gt; a -&gt; a -&gt; Bool\nhasPair []               _  _  = False\nhasPair ((x1, x2, _):xs) y1 y2\n  | x1 == y1 &amp;&amp; x2 == y2 = True\n  | x1 == y2 &amp;&amp; x2 == y1 = True\n  | otherwise            = hasPair xs y1 y2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1493060516, "creation_date": 1493060516, "answer_id": 43595847, "question_id": 43595428, "link": "https://stackoverflow.com/questions/43595428/avoid-duplicates-in-haskell/43595847#43595847", "title": "Avoid duplicates in Haskell", "body": "<p><code>hasPair</code> searches its first argument for a pair that matches its next two arguments.</p>\n\n<p>An empty list of pairs doesn't have a pair that matches the other arguments, regardless of what they are.</p>\n\n<pre><code>hasPair [] _ _ = False\n</code></pre>\n\n<p>A list with a student pair <code>(a, b, _)</code> and some more pairs <code>moreGroups</code> will match the pair of students <code>name1</code> and <code>name2</code> if ...</p>\n\n<pre><code>hasPair ((a,b,_):moreGroups) name1 name2 =\n</code></pre>\n\n<p>Students <code>a</code> and <code>b</code> are <code>name1</code> and <code>name2</code>. This could happen in either order.</p>\n\n<pre><code>    (a == name1 &amp;&amp; b == name2) || (a == name2 &amp;&amp; b == name1) || ...\n</code></pre>\n\n<p>Or if one of the remaining groups is <code>name1</code> and <code>name2</code>.</p>\n\n<pre><code>    ... hasPair moreGroups name1 name2\n</code></pre>\n\n<p><code>hasPair</code> doesn't make sure there's no group doing <em>any two projects</em>, but when considering a single project it can be used to make sure there's no <em>other project</em> being done by the same group.</p>\n"}, {"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 0, "last_activity_date": 1493068112, "creation_date": 1493068112, "answer_id": 43597747, "question_id": 43595428, "link": "https://stackoverflow.com/questions/43595428/avoid-duplicates-in-haskell/43597747#43597747", "title": "Avoid duplicates in Haskell", "body": "<pre><code>import Data.Set (Set,fromList)\n\ndata CourseData = CourseData String String Int deriving Show\n</code></pre>\n\n<p>Make <code>Eq</code> and <code>Ord</code> instances that ignore the grade and expect the student names to be sorted already.</p>\n\n<pre><code>instance Eq CourseData where\n  (==) (CourseData a b _) (CourseData a' b' _) = a == a' &amp;&amp; b == b'\n\ninstance Ord CourseData where\n  compare (CourseData a b _) (CourseData a' b' _) = compare a a' `mappend` compare b b'\n</code></pre>\n\n<p>Make it impossible to make an \"incorrect\" <code>CourseData</code> by sorting the names.</p>\n\n<pre><code>mkCourseData :: String -&gt; String -&gt; Int -&gt; CourseData\nmkCourseData a b = case compare a b of\n  -- Make sure the greater element is to the right\n  GT -&gt; CourseData b a\n  _ -&gt; CourseData a b\n</code></pre>\n\n<p>As you can see, this makes <code>Set</code>s of <code>CourseData</code> follow your rules:</p>\n\n<pre><code>test :: Set CourseData\ntest = fromList [mkCourseData \"a\" \"b\" 1,mkCourseData \"b\" \"a\" 2] \n</code></pre>\n\n<p>This comes out to <code>fromList [CourseData \"a\" \"b\" 2]</code></p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1493070042, "creation_date": 1493070042, "answer_id": 43598169, "question_id": 43595428, "link": "https://stackoverflow.com/questions/43595428/avoid-duplicates-in-haskell/43598169#43598169", "title": "Avoid duplicates in Haskell", "body": "<p>another compositional alternative</p>\n\n<pre><code>import Data.List(sort,group)\n\nlegalCourse = null . filter (&gt;1) . map length . group . sort . map dictOrder\n         where dictOder (x,y,_) = if (x&lt;y) then (x,y) else (y,x)\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1493070042, "creation_date": 1493059055, "last_edit_date": 1493060995, "question_id": 43595428, "link": "https://stackoverflow.com/questions/43595428/avoid-duplicates-in-haskell", "title": "Avoid duplicates in Haskell", "body": "<p>The students are doing projects in pairs. </p>\n\n<p>Rules: No one is allowed to work alone; every project is done by exactly two students. No two students may work together on more than one project.</p>\n\n<p>Each project is composed by the names of the two students who did the project and the mark (an integer from 0 to 100). </p>\n\n<p>I'm writing a function called <code>legalCourse</code> which takes a <code>CourseData</code> as a parameter and returns a <code>Bool</code>. Returns\n<code>True</code> if the course data is \u201clegal\u201d, meaning that it contains neither of the kinds of errors listed above.  For all of the remaining functions.\nsample output:</p>\n\n<pre><code>*legalCourse [(\"John\",\"Mary\",75)]\nTrue\n* legalCourse [(\"John\",\"John\",75)]\nFalse\n* legalCourse [(\"John\",\"Mary\",75),(\"Peter\",\"Paul\",90),(\"John\",\"Mary\",90)]\nFalse\n* legalCourse [(\"John\",\"Mary\",75),(\"Peter\",\"Paul\",90),(\"Mary\",\"John\",90)]\nFalse\n*Assignment2&gt; legalCourse [(\"John\",\"Mary\",75),(\"Peter\",\"Paul\",90),(\"Mary\",\"Fred\",90)]\nTrue\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>type CourseData = [(String, String, Int)]\nlegalCourse :: CourseData -&gt; Bool\nlegalCourse course = legal1 course &amp;&amp; legal2 course\nwhere\n    -- legal1 course means the course does not contain any projects like (\"David\",\"David\",90)\n    legal1 [] = True\n    legal1 ((name1,name2,_):moreGroups) = name1 /= name2 &amp;&amp; legal1 moreGroups\n    -- hasPair course name1 name2 means the course has a project done by name1 and name2\n    -- (in either order)\n    hasPair [] _ _ = False\n    hasPair ((a,b,_):moreGroups) name1 name2 =\n        (a == name1 &amp;&amp; b == name2) || (a == name2 &amp;&amp; b == name1) || hasPair moreGroups name1 name2\n    -- legal2 course means the course does not contain two projects done by the same\n    -- pair of students (regardless of order)\n    legal2 [] = True\n    legal2 [_] = True\n    legal2 ((name1,name2,_):moreProjects) = \n        not (hasPair moreProjects name1 name2) &amp;&amp; legal2 moreProjects\n</code></pre>\n\n<p>I don't understand <code>hasPair</code> and <code>legal2</code>, how does this part</p>\n\n<pre><code>hasPair ((a,b,_):moreGroups) name1 name2 =\n    (a == name1 &amp;&amp; b == name2) || (a == name2 &amp;&amp; b == name1) || hasPair moreGroups name1 name2\n</code></pre>\n\n<p>avoid same pairs of people doing project?</p>\n"}, {"tags": ["haskell", "constraints", "intervals"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1493056845, "post_id": 43594478, "comment_id": 74239400, "body": "What problem are you trying to solve?"}, {"owner": {"reputation": 817, "user_id": 1077657, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/77827a893cf80112cc4157d96d81f5e0?s=128&d=identicon&r=PG", "display_name": "BenJacob", "link": "https://stackoverflow.com/users/1077657/benjacob"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493057064, "post_id": 43594478, "comment_id": 74239517, "body": "I am trying to understand how I can approach the problem of solving a system of constraints in Haskell when it is purely functional"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1493058331, "post_id": 43594478, "comment_id": 74240274, "body": "What are the variables? Are they discrete? Are they continuous? What are the functions? Are they linear? Are they smooth? Are they analytic? Are they differentiable? What are the constraints themselves? Are they equalities? Are they inequalities? What problem or class of problems are you trying to solve?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1493058610, "post_id": 43594478, "comment_id": 74240454, "body": "Haskell being functional has nothing to do with having multiple constraints in a system of constraints. The type of <i>system</i> of constraints must necessarily be able to hold <i>multiple</i> constraints. Just like a list must be able to hold multiple values."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1493058833, "post_id": 43594478, "comment_id": 74240597, "body": "If you want to see how other authors have approached various constraint satisfaction problems go to <a href=\"https://hackage.haskell.org/packages/\" rel=\"nofollow noreferrer\">hackage</a> and search for &quot;satisf&quot; (the first part of &quot;satisfaction&quot;, &quot;satisfy&quot;, or &quot;satisfier&quot;), &quot;solve&quot;, or &quot;constraint&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 0, "last_activity_date": 1493083176, "creation_date": 1493083176, "answer_id": 43600040, "question_id": 43594478, "link": "https://stackoverflow.com/questions/43594478/updating-values-in-haskell/43600040#43600040", "title": "Updating values in Haskell", "body": "<p>This question might be bordering on \"too general\", so here's a possibly \"too general\" answer, though I've tried to include some specifics (including a working example).</p>\n\n<p>In a problem like this, a typical imperative approach might use a single data structure to (1) store the input constraints; (2) act as a live scratch space for processing as constraints are read; and (3) perform any final computations to produce the results.</p>\n\n<p>In a Haskell implementation, it's usual to separate this into distinct steps:</p>\n\n<ol>\n<li>Build a pure data structure that represents the input constraint system, without a lot of complex processing.</li>\n<li>Walk the data structure using a state monad to carry along the \"discoveries\" as constraints are processed.</li>\n<li>Generate the final result, either by querying the final state or as a by-product as the data structure is walked, whichever is more convenient.</li>\n</ol>\n\n<p>Haskell's lazy evaluation can help here.  Even though the implementation of these steps is separated, the on-demand evaluation scheme means that the computations are interleaved in practice, as they would be with the imperative implementation, so the result is generated as the data structure is walked as the input constraints are loaded into the constraint system representation.  However, the separate functional components are usually easier to construct and reason about.</p>\n\n<p>As an over-simplified example, imagine you're implementing equality constraints between variables (i.e., a set of constraints of the form <code>x==y</code>).  Here, for Step 1, a pure data structure representing the constraint system is pretty trivial:</p>\n\n<pre><code>type Name = String\ndata Constraint = Equals Name Name deriving (Show)    -- ^An equality constraint\ntype System = [Constraint]                            -- ^A constraint system\n</code></pre>\n\n<p>In a more realistic example, there might be multiple constraint types and/or you might choose to organize them in a map keyed by variables that are referenced by the constraint (whatever's convenient for processing).  The key insight here is that the data structure is pure and immutable and doesn't reflect any serious computation on the constraints.  It's mostly a direct representation of the input.</p>\n\n<p>For Step 2, in this simple case, a reasonable state representation of the \"knowledge\" gained by learning the constraints is a set of equivalence classes.  We can use a <code>Map Name Name</code> -- following a chain from a given name <code>n</code> to its final name <code>n'</code> gives a representative for the class, so if two names have chains that end with the same final name, they are equal:</p>\n\n<pre><code>type St = Map Name Name\n</code></pre>\n\n<p>Again, in a more realistic example, this state might incorporate a copy of the constraint system representation annotated with discoveries made as the system is processed.  These annotations can be added via the usual sorts of functional manipulations of data structures; or, you might find it useful here to introduce a true mutable data structure and run everything in the ST or IO monad.</p>\n\n<p>Anyway, to continue with Step 2 of our example, we can then imagine walking the constraint <code>System</code> to update this state.  Here <code>S</code> is shorthand for <code>State St</code>, a state monad with our <code>St</code> state.</p>\n\n<pre><code>walk :: System -&gt; S ()\nwalk = mapM_ learn\nlearn :: Constraint -&gt; S ()\nlearn = ...   -- update state to reflect knowledge from constraint\n</code></pre>\n\n<p>Finally, for Step 3, we can define a function to read off the \"solution\" which in our case takes the form of a list of <code>(Name,Name)</code> pairs where <code>(\"x\",\"u\")</code> indicates that variable \"x\" is equal to its representative \"u\" (and any other variable with that representative is also equal to \"u\" and \"x\"s).  This could be done outside of the <code>S</code> monad, as a pure computation on the final state returned by <code>walk</code>, but I've done it within the <code>S</code> monad here.</p>\n\n<pre><code>solution :: S [(Name,Name)]\nsolution = do ns &lt;- gets (Map.keys)\n              zip ns &lt;$&gt; mapM rep ns\n</code></pre>\n\n<p>Here, the function <code>rep :: Name -&gt; S Name</code> uses the state to follow a chain from a supplied name <code>n</code> to its representative <code>n'</code>.</p>\n\n<p>The only missing part is the implementation of <code>learn</code>.  Here it is all together in a full working example.  I hope that gives you some ideas on how to get started</p>\n\n<pre><code>module Constraint where\n\nimport Control.Monad.State\nimport Data.List\nimport Data.Maybe (catMaybes)\nimport Data.Map (Map)\nimport qualified Data.Map as Map\n\ntype Name = String\ndata Constraint = Equals Name Name deriving (Show)    -- ^An equality constraint\ntype System = [Constraint]                            -- ^A constraint system\n\n-- |State representing evolving computation as collection of\n-- equivalence classes.  Each name `n` maps to smaller `n'` and\n-- following chain leads to class representative.  A much more\n-- efficient implementation is possible (see the \"equivalence\"\n-- package, for example, which uses a mutable data structure).\ntype St = Map Name Name   -- ^Our state\ntype S = State St         -- ^Monad w/ our state\nevalS = flip evalState Map.empty\nrunS  = flip runState Map.empty\n\n-- |Get equivalence class representative\nrep :: Name -&gt; S Name\nrep n = do\n  s &lt;- gets (Map.lookup n)\n  case s of Just n' | n /= n' -&gt; rep n'\n                    | otherwise -&gt; error \"rep: cycle in chain\"\n            Nothing -&gt; return n\n\n-- |Set link in equivalence class chain\nset :: Name -&gt; Name -&gt; S ()\nset n n' = when (n /= n') $ modify (Map.insert n n')\n\n-- |Learn a new constraint\nlearn :: Constraint -&gt; S ()\nlearn (Equals x y) = do rx &lt;- rep x\n                        ry &lt;- rep y\n                        unify rx ry\n\n-- |Unify equivalence classes for two names\nunify :: Name -&gt; Name -&gt; S ()\nunify n n' | n &lt; n'    = unify n' n\n           | otherwise = set n n'\n\n-- |Walk a system of constraints, learning them as we go\nwalk :: System -&gt; S ()\nwalk = mapM_ learn\n\n-- |Generate solution from complete state\nsolution :: S [(Name,Name)]\nsolution = do ns &lt;- gets (Map.keys)\n              zip ns &lt;$&gt; mapM rep ns\n\n\ntest :: [(Name, Name)]\ntest = evalS $ do -- Step 1: a pure representation of the constraint system\n                  let sys = [ Equals \"x\" \"y\"\n                            , Equals \"u\" \"v\"\n                            , Equals \"v\" \"z\"\n                            , Equals \"a\" \"b\"\n                            , Equals \"x\" \"w\"\n                            ]\n                  -- Step 2: walk the system, learning state as we go\n                  walk sys\n                  -- Step 3: produce the solution from the state\n                  solution\n</code></pre>\n"}], "owner": {"reputation": 817, "user_id": 1077657, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/77827a893cf80112cc4157d96d81f5e0?s=128&d=identicon&r=PG", "display_name": "BenJacob", "link": "https://stackoverflow.com/users/1077657/benjacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 43600040, "answer_count": 1, "score": 0, "last_activity_date": 1493083176, "creation_date": 1493055295, "question_id": 43594478, "link": "https://stackoverflow.com/questions/43594478/updating-values-in-haskell", "title": "Updating values in Haskell", "body": "<p>I am trying to apply constraints to a set of values using intervals as their range of possible values. I am having difficulty formulating an approach to how i would apply these constraints in Haskell.</p>\n\n<p>Say I have a constraint of the form <code>b = 10</code> and a constraint <code>a = f(b,c)</code>, clearly the first constraint will alter how the second one is applied however I am unsure of how to implement this in a functional language. In an imperative program we would alter the interval of b and use its new value in the second constraint.</p>\n\n<p>Any help would be much appreciated, Ben</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5388697"}, "edited": false, "score": 0, "creation_date": 1493054529, "post_id": 43594230, "comment_id": 74238116, "body": "I need it to accept one or more characters, hence I don&#39;t believe oneOf is suitable?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493054601, "post_id": 43594230, "comment_id": 74238151, "body": "@datguywelbz <code>oneOf [&#39;a&#39; .. &#39;z&#39;]</code> accepts exactly one character; but <code>some (oneOf [&#39;a&#39; .. &#39;z&#39;])</code> accepts one or more (see the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#v:some\" rel=\"nofollow noreferrer\">documentation for <code>some</code></a>)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1493054410, "creation_date": 1493054410, "answer_id": 43594230, "question_id": 43594186, "link": "https://stackoverflow.com/questions/43594186/parse-a-string-of-length-at-least-one-character/43594230#43594230", "title": "Parse a string of length at least one character", "body": "<p>Probably you meant to use <a href=\"http://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Char.html#v:oneOf\" rel=\"nofollow noreferrer\"><code>oneOf</code></a> (or a similar function from your parser library) as in</p>\n\n<pre><code>pname = some (oneOf ['a' .. 'z']) &lt;* sc\n</code></pre>\n\n<p>to turn the list of characters into a parser that accepts one of those characters.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5388697"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1493054410, "creation_date": 1493054245, "question_id": 43594186, "link": "https://stackoverflow.com/questions/43594186/parse-a-string-of-length-at-least-one-character", "title": "Parse a string of length at least one character", "body": "<p>I am trying to write a parser in Haskell. In this I need a function that parses a string of length at least 1. I have the type declared below:</p>\n\n<pre><code>type Pname = String\n</code></pre>\n\n<p>but my function that I have doesn't work. The code I have is below, where <code>sc</code> is my space consumer for whitespace and comments (I have been following the tutorial at <a href=\"https://mrkkrp.github.io/megaparsec/tutorials/parsing-simple-imperative-language.html\" rel=\"nofollow noreferrer\">https://mrkkrp.github.io/megaparsec/tutorials/parsing-simple-imperative-language.html</a> for help with this parser):</p>\n\n<pre><code>pname :: Parser Pname\npname = (some ['a' .. 'z']) &lt;* sc\n</code></pre>\n\n<p>but it gives me the error:</p>\n\n<pre><code>    Couldn't match type \u2018[]\u2019\n                   with \u2018ParsecT Dec String Data.Functor.Identity.Identity\u2019\n    Expected type: ParsecT\n                     Dec String Data.Functor.Identity.Identity Char\n      Actual type: [Char]\n    In the first argument of \u2018some\u2019, namely \u2018['a' .. 'z']\u2019\n    In the first argument of \u2018(&lt;*)\u2019, namely \u2018(some ['a' .. 'z'])\u2019\n    In the expression: (some ['a' .. 'z']) &lt;* sc\n</code></pre>\n\n<p>Any ideas on why this doesn't work?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1493049270, "post_id": 43592549, "comment_id": 74234940, "body": "If x is green, 2x is not, and vice versa."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1493059400, "creation_date": 1493059400, "answer_id": 43595521, "question_id": 43592549, "link": "https://stackoverflow.com/questions/43592549/prime-factorization-in-haskell/43595521#43595521", "title": "prime factorization in Haskell", "body": "<p>something like this?</p>\n\n<pre><code>green x = go x 0\n       where go 0 n = even n\n             go x n | mod x 2 == 0 = go (div x 2) (n+1)\n                    | otherwise    = even n\n\n\n&gt; zip [1..] $ map green [1..16]\n\n[(1,True),(2,False),(3,True),(4,True),(5,True),(6,False),(7,True),(8,False),(9,True),\n (10,False),(11,True),(12,True),(13,True),(14,False),(15,True),(16,True)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 6515250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db8d3320f9de0401804a1058b27289c?s=128&d=identicon&r=PG&f=1", "display_name": "TanasaIoan", "link": "https://stackoverflow.com/users/6515250/tanasaioan"}, "is_accepted": false, "score": 0, "last_activity_date": 1493149023, "creation_date": 1493149023, "answer_id": 43619505, "question_id": 43592549, "link": "https://stackoverflow.com/questions/43592549/prime-factorization-in-haskell/43619505#43619505", "title": "prime factorization in Haskell", "body": "<p>If <code>x</code> is divisible by 2 n times then <code>mod x 2</code> is divisible by 2 n-1 times, what are we trying to figure out is if n is even.\nIf <code>x</code> is a green number then <code>mod x 2</code> is not because if n is even then n-1 is odd.\nIf <code>x</code> is not a green number then <code>mod x 2</code> is a green number because if n is odd then n-1 is even.\nThis recurrence relation is enough, you don't need to know n, you only need to know if n is even, so this \"not\" does the switching between is n even or is not.</p>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1493149023, "creation_date": 1493048932, "question_id": 43592549, "link": "https://stackoverflow.com/questions/43592549/prime-factorization-in-haskell", "title": "prime factorization in Haskell", "body": "<p>A \"green\" integer can be divided by 2 an even number of   times.<br>\nIn   other   words,   there   is  an   even   number   of   2s   in   the   number's   prime factorization.</p>\n\n<p>examples:</p>\n\n<p>\u202280 is green because it can be divided by 2 exactly four times, and four is even.<br>\n(80 = 2*2*2*2*5, and 5 isn't divisible by 2)</p>\n\n<p>\u202256 is not green because it can be divided by 2 exactly three times, and three is odd<br>\n  (56 = 2*2*2*7, and 7 isn't divisible by 2)</p>\n\n<p>\u202215 is green because it can be divided by 2 zero times, and zero is even</p>\n\n<p>I spent quite a lot time of this and the solution is suprisingly concise:</p>\n\n<pre><code>green 0 = error \"zero\"\ngreen x\n    | mod x 2 == 0 = not (green (div x 2))\n    | mod x 2 == 1 = True\n</code></pre>\n\n<p>I can't figure the purpose of the \"not (green (div x 2))\" part.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1493049881, "post_id": 43592521, "comment_id": 74235330, "body": "<code>import Database.Tables (Post)</code> doesn&#39;t import the fields or the constructors, only the type."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1493054260, "post_id": 43592521, "comment_id": 74237950, "body": "Why do you believe the fields have been imported as well? What are the other imports? What package provides <code>Database.Tables</code>? There are way too few details here to diagnose your problem."}], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 0, "last_activity_date": 1493298819, "creation_date": 1493298819, "answer_id": 43658952, "question_id": 43592521, "link": "https://stackoverflow.com/questions/43592521/is-there-a-way-to-import-record-type-without-fields/43658952#43658952", "title": "Is there a way to import record type without fields?", "body": "<p><code>import Database.Tables (Post)</code> doesn't import the fields or the constructors, only the type.</p>\n"}], "owner": {"reputation": 49, "user_id": 5651624, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/10156399227295220/picture?type=large", "display_name": "Frank John Li", "link": "https://stackoverflow.com/users/5651624/frank-john-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493298819, "creation_date": 1493048853, "last_edit_date": 1493060795, "question_id": 43592521, "link": "https://stackoverflow.com/questions/43592521/is-there-a-way-to-import-record-type-without-fields", "title": "Is there a way to import record type without fields?", "body": "<p>Is there a way to import record type without fields?</p>\n\n<p>Currently the code of issue is:\n<code>import Database.Tables (Post)</code> where <code>Post</code> is a record type. However I do not want the fields to be imported as well.</p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 3, "creation_date": 1493047699, "post_id": 43592025, "comment_id": 74233831, "body": "<code>String</code> is just a type alias of <code>[Char]</code>, which means they&#39;re <i>exactly</i> the same type. What makes you think <code>[(String)] -&gt; [String]</code> means &quot;a list of strings and get a string as the output&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1493054168, "creation_date": 1493054168, "answer_id": 43594164, "question_id": 43592025, "link": "https://stackoverflow.com/questions/43592025/a-haskell-function-that-converts-a-list-of-words-to-a-string/43594164#43594164", "title": "a Haskell function that converts a list of words to a string", "body": "<blockquote>\n  <p>I want to change the declaration to <code>wordsToString::[(String)]-&gt;[String]</code> but it won't work</p>\n</blockquote>\n\n<p>No, you want to change the declaration to <code>wordsToString :: [String] -&gt; String</code>. You aren't getting a list of strings out, just a single one.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1493071577, "post_id": 43595624, "comment_id": 74247167, "body": "As long as we&#39;re suggesting library functions, <code>unwords</code> seems like the closest fit."}], "tags": [], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "is_accepted": false, "score": 1, "last_activity_date": 1493060088, "last_edit_date": 1493060088, "creation_date": 1493059779, "answer_id": 43595624, "question_id": 43592025, "link": "https://stackoverflow.com/questions/43592025/a-haskell-function-that-converts-a-list-of-words-to-a-string/43595624#43595624", "title": "a Haskell function that converts a list of words to a string", "body": "<p>The function is called <code>concat</code>:</p>\n\n<pre><code>concat :: Foldable t =&gt; t [a] -&gt; [a]\nconcat xs = foldr (++) [] xs\n</code></pre>\n\n<p>In your case, you want to insert a whitespace between the characters. This function is called <code>intercalate</code>:</p>\n\n<pre><code>intercalate :: [a] -&gt; [[a]] -&gt; [a]\n</code></pre>\n\n<p>It's defined in terms of <code>intersperse</code>.</p>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1493060960, "creation_date": 1493047492, "last_edit_date": 1493060960, "question_id": 43592025, "link": "https://stackoverflow.com/questions/43592025/a-haskell-function-that-converts-a-list-of-words-to-a-string", "title": "a Haskell function that converts a list of words to a string", "body": "<p>For example:</p>\n\n<pre><code>wordsToString [\"all\",\"for\",\"one\",\"and\",\"one\",\"for\",\"all\"]\n\"all for one and one for all\"\n</code></pre>\n\n<p>My code works without a type declaration:</p>\n\n<pre><code>wordsToString [] = \"\"\nwordsToString [word] = word\nwordsToString (word:words) = word ++ ' ':(wordsToString words)\n</code></pre>\n\n<p>But when I do the type check,it shows that it is a list of Chars which seems wrong to me as I'm supposed to declare the input as a list of strings and get a string as the output:</p>\n\n<pre><code>*Main&gt; :type wordsToString\nwordsToString :: [[Char]] -&gt; [Char]\n</code></pre>\n\n<p>I want to change the declaration to <code>wordsToString::[(String)]-&gt;[String]</code> but it won't work</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1493041587, "post_id": 43589737, "comment_id": 74229067, "body": "This is not possible in Haskell. Nor in Python, for that matter; how about showing us some actual working Python code that uses the kind of mutation that you actually have in mind?"}, {"owner": {"reputation": 3, "user_id": 7913956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f7a4a5f8390e66e9b26785abe57a23?s=128&d=identicon&r=PG&f=1", "display_name": "Totoro", "link": "https://stackoverflow.com/users/7913956/totoro"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1493043631, "post_id": 43589737, "comment_id": 74230708, "body": "Thanks for your answer. I made a mistake in thinking about those functions like variables in Python."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7913956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f7a4a5f8390e66e9b26785abe57a23?s=128&d=identicon&r=PG&f=1", "display_name": "Totoro", "link": "https://stackoverflow.com/users/7913956/totoro"}, "edited": false, "score": 0, "creation_date": 1493044553, "post_id": 43589929, "comment_id": 74231440, "body": "I think what i really want to do is to change the function permanently or rather overwrite it. I was just a bit confused :)"}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 0, "last_activity_date": 1493041758, "creation_date": 1493041758, "answer_id": 43589929, "question_id": 43589737, "link": "https://stackoverflow.com/questions/43589737/haskell-how-to-modify-existing-function-values/43589929#43589929", "title": "Haskell - How to modify existing function values", "body": "<p>Maybe having a look at <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/syntax-in-functions</a> helps? Think of haskell functions as mathematical functions, there's no assignment there either.</p>\n\n<p>Anyway, you can ask an other function for a value to compare to, and e.g. in that case return <code>1</code>:</p>\n\n<pre><code>foo 0 1                    = 1\nfoo x y\n  | otherfunction x y == 7 = 1\n  | otherwise              = 0\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7913956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f7a4a5f8390e66e9b26785abe57a23?s=128&d=identicon&r=PG&f=1", "display_name": "Totoro", "link": "https://stackoverflow.com/users/7913956/totoro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 43589929, "answer_count": 1, "score": 0, "last_activity_date": 1493041758, "creation_date": 1493041220, "question_id": 43589737, "link": "https://stackoverflow.com/questions/43589737/haskell-how-to-modify-existing-function-values", "title": "Haskell - How to modify existing function values", "body": "<p>i have a basic question regarding Haskell that boggles my mind since i am new to functional programming.</p>\n\n<p>i've got simple functions for example</p>\n\n<pre><code>foo 1 1 = 0\nfoo 1 2 = 1\nfoo 2 1 = 1\nfoo 2 2 = 0\n</code></pre>\n\n<p>and i want to change the function values depending on a condition via another function (for example from 1 to 0, if the value is 1). How can i do that? I'm comming from python and am somehow stuck in the way of thought that i can simply assign the new value in the function body.</p>\n\n<p>im trying something along this lines:</p>\n\n<pre><code>changeValue x y\n        |(foo x y == 1) = foo x y = 0\n</code></pre>\n\n<p>A little hint would be appreciated, since it feels like a simple question that i just can't find a solution for. Thanks!</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1493037626, "creation_date": 1493037626, "answer_id": 43588347, "question_id": 43587855, "link": "https://stackoverflow.com/questions/43587855/understanding-state-monads-get/43588347#43588347", "title": "Understanding State Monad&#39;s `get`", "body": "<p>Have a close look at the arrows. <code>get</code> does not take any argument:</p>\n\n<pre><code>get :: MonadState s m =&gt; m s\n--     ^^^^^^^^^^^^^^\n--     constraint, not type\n</code></pre>\n\n<p>Neither does <code>s</code>:</p>\n\n<pre><code>s :: MonadState s m =&gt; m [Char]\n--   ^^^^^^^^^^^^^^\n--   constraint, not type\n</code></pre>\n\n<p>We can combine those stateful computations with <code>&gt;&gt;</code>, since any <code>MonadState s m</code> is also a <code>Monad</code>:</p>\n\n<pre><code>setAndGet = s &gt;&gt; get\n</code></pre>\n\n<p>And we can have a look at the result of <code>setAndGet</code> with <code>runState</code>:</p>\n\n<pre><code>ghci&gt; runState setAndGet \"example\"\n(\"example\",\"example\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1493063339, "last_edit_date": 1493063339, "creation_date": 1493063025, "answer_id": 43596472, "question_id": 43587855, "link": "https://stackoverflow.com/questions/43587855/understanding-state-monads-get/43596472#43596472", "title": "Understanding State Monad&#39;s `get`", "body": "<p>The state in the state monad is like an <a href=\"http://blog.sigfpe.com/2006/10/monads-field-guide.html\" rel=\"nofollow noreferrer\">underground river</a> that follows the ostensible path of the computation. It hides the state when you don't need it and lets you focus on composing the (monadic) functions that form the computation.</p>\n\n<p><code>get</code> is like a well that taps into that river and lets you bring the state into the open when you need it. It is \"part of the path you follow\" so to speak, not some external function that you apply to the monadic actions. </p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 43588347, "answer_count": 2, "score": 0, "last_activity_date": 1493063339, "creation_date": 1493036173, "last_edit_date": 1493036499, "question_id": 43587855, "link": "https://stackoverflow.com/questions/43587855/understanding-state-monads-get", "title": "Understanding State Monad&#39;s `get`", "body": "<p>Given:</p>\n\n<pre><code>*Main&gt; let s = state $ \\x -&gt; (\"foo\", x)\n*Main&gt; :t s\ns :: MonadState s m =&gt; m [Char]\n</code></pre>\n\n<p>I tried to call <code>get s</code>, but got the below compile-time error:</p>\n\n<pre><code>*Main&gt; :t get\nget :: MonadState s m =&gt; m s\n\n*Main&gt; let x = get s\n\n&lt;interactive&gt;:95:5: error:\n    \u2022 Non type-variable argument\n        in the constraint: MonadState t ((-&gt;) (m [Char]))\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        x :: forall s (m :: * -&gt; *) t.\n             (MonadState s m, MonadState t ((-&gt;) (m [Char]))) =&gt;\n             t\n</code></pre>\n\n<p>Then, I added that extension:</p>\n\n<pre><code>*Main&gt; :set -XFlexibleContexts\n</code></pre>\n\n<p>But, it still does not compile:</p>\n\n<pre><code>*Main&gt; let result = get s\n\n&lt;interactive&gt;:9:5: error:\n    \u2022 Could not deduce (MonadState s0 m0)\n      from the context: (MonadState s m, MonadState t ((-&gt;) (m [Char])))\n        bound by the inferred type for \u2018result\u2019:\n                   (MonadState s m, MonadState t ((-&gt;) (m [Char]))) =&gt; t\n        at &lt;interactive&gt;:9:5-18\n      The type variables \u2018s0\u2019, \u2018m0\u2019 are ambiguous\n    \u2022 In the ambiguity check for the inferred type for \u2018result\u2019\n      To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n      When checking the inferred type\n        result :: forall s (m :: * -&gt; *) t.\n                  (MonadState s m, MonadState t ((-&gt;) (m [Char]))) =&gt;\n                  t\n</code></pre>\n\n<p>Please explain why it's not compiling.</p>\n"}, {"tags": ["algorithm", "haskell", "tuples"], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493035476, "post_id": 43587110, "comment_id": 74224321, "body": "is there anyway to do it without using Maybe?"}, {"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493035940, "post_id": 43587110, "comment_id": 74224693, "body": "I found the second code works the same even if I deleted Maybe and Just, are they really necessary?"}, {"owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "reply_to_user": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493036077, "post_id": 43587110, "comment_id": 74224784, "body": "The Maybe type is used to indicate a failure and is quite useful. In the last code the program just crashes if something went wrong. In the second example one can test if there is a value <code>Just 4</code> or if there is `Nothing&#180;. Normally you just don&#39;t want your program to crash due to bad inputs."}, {"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493037449, "post_id": 43587110, "comment_id": 74225837, "body": "I like the third code the most but I never learnt $, in fact I&#39;m supposed to use Maybe/Just/$ cause they are not in my course scope, anyway to change the 3rd code a little bit so I don&#39;t have to use $?"}, {"owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "reply_to_user": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493037526, "post_id": 43587110, "comment_id": 74225895, "body": "<code>maximum $ [a+b+c|(a,b,c)&lt;-x]</code> is the same like <code>maximum ([a+b+c|(a,b,c)&lt;-x])</code>. But in this case you might even drop the parenthesis completely."}, {"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493038574, "post_id": 43587110, "comment_id": 74226711, "body": "yes,it works without $,but I got several errors when I deleted the $ in the first code"}, {"owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "reply_to_user": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1493038676, "post_id": 43587110, "comment_id": 74226795, "body": "Of course. There you have to replace <code>maximum $ tuplesum x</code> by <code>maximum (tuplesum x)</code>. An alternative might be <code>(maximum . tuplesum) x</code>, which is concatenation of functions."}], "tags": [], "owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "is_accepted": true, "score": 1, "last_activity_date": 1493037555, "last_edit_date": 1493037555, "creation_date": 1493034060, "answer_id": 43587110, "question_id": 43586821, "link": "https://stackoverflow.com/questions/43586821/addition-in-tuple-list/43587110#43587110", "title": "Addition in tuple list", "body": "<p>You can try this:</p>\n\n<pre><code>import Data.List\n\ntuplesum :: (Num a) =&gt; [(a,a,a)] -&gt; [a] \ntuplesum x = [a+b+c|(a,b,c)&lt;-x]\nmaxTotal::(Num a, Ord a) =&gt;[(a,a,a)]-&gt;Maybe a\nmaxTotal [] =Nothing\nmaxTotal x = Just (maximum $ tuplesum x)\n</code></pre>\n\n<p>Or if you like it even shorter: </p>\n\n<pre><code>import Data.List\n\nmaxTotal::(Num a, Ord a) =&gt;[(a,a,a)]-&gt;Maybe a\nmaxTotal [] = Nothing\nmaxTotal x = Just (maximum [a+b+c|(a,b,c)&lt;-x])\n</code></pre>\n\n<p>If you don't like Maybe you can use:</p>\n\n<pre><code>import Data.List\n\nmaxTotal::(Num a, Ord a) =&gt;[(a,a,a)]-&gt;a\nmaxTotal x = maximum [a+b+c|(a,b,c)&lt;-x]\n</code></pre>\n\n<p>It already gives an error for the empty list.</p>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 43587110, "answer_count": 1, "score": 0, "last_activity_date": 1493037555, "creation_date": 1493033133, "question_id": 43586821, "link": "https://stackoverflow.com/questions/43586821/addition-in-tuple-list", "title": "Addition in tuple list", "body": "<p>I'm tring to write a function called maxTotal which will take a list of tuples as a parameter, where each tuple in the list   consists   of   three    Ints.     I need to  find   the   tuple   whose   total   (the   sum   of   the   3 integers in the tuple) is greatest and return that total.  </p>\n\n<pre><code>example:\n*Main&gt; maxTotal [(1,2,3),(7,4,2),(5,5,1)]\n13\n*Main&gt; maxTotal [(1,2,3),(5,5,1),(3,15,0)]\n18\n*Main&gt; maxTotal [(3,3,3)]\n9\n</code></pre>\n\n<p>This is what I have:</p>\n\n<pre><code>tuplesum :: (Num a) =&gt; [(a,a,a)] -&gt; [a] \ntuplesum  [] = []\ntuplesum  ((a,b,c):xs) = (a+b+c) : tuplesum  xs\nmaxTotal::(Num a) =&gt;[(a,a,a)]-&gt;a\nmaxTotal[]=error\"empty list\"\nmaxTotal tuplesum (head : tail) = max head (maxTotal tail)\n</code></pre>\n\n<p>My tuplesum works but I keep getting errors saying \"parse error on input \u2018=\u2019\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "edited": false, "score": 1, "creation_date": 1493030787, "post_id": 43585921, "comment_id": 74220941, "body": "<code>f g = unwords . map (\\x-&gt; show x ++ &quot;=&quot; ++ show (g x))</code>  should work. For f (^2) [5,6,7] i get result &quot;5=25 6=36 7=49&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 7819680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d468281fa3da9559276ca6700baf7e8a?s=128&d=identicon&r=PG&f=1", "display_name": "toasttoast", "link": "https://stackoverflow.com/users/7819680/toasttoast"}, "edited": false, "score": 0, "creation_date": 1493034426, "post_id": 43586143, "comment_id": 74223504, "body": "Thanks for the answer. It works perfectly. Is there an easy way to implement new lines after each result?"}, {"owner": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "reply_to_user": {"reputation": 5, "user_id": 7819680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d468281fa3da9559276ca6700baf7e8a?s=128&d=identicon&r=PG&f=1", "display_name": "toasttoast", "link": "https://stackoverflow.com/users/7819680/toasttoast"}, "edited": false, "score": 0, "creation_date": 1493038595, "post_id": 43586143, "comment_id": 74226727, "body": "Yes. Use unlines instead of unwords."}], "tags": [], "owner": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "is_accepted": true, "score": 0, "last_activity_date": 1493031429, "last_edit_date": 1493031429, "creation_date": 1493031020, "answer_id": 43586143, "question_id": 43585921, "link": "https://stackoverflow.com/questions/43585921/haskell-intlist-to-string/43586143#43586143", "title": "Haskell IntList to String", "body": "<p>Yes, try</p>\n\n<pre><code>showBeforeAfter before after = show before ++ \"=\" ++ show after\ntransformBeforeAfter f x = showBeforeAfter x (f x)\nmapBeforeAfter f = map (transformBeforeAfter f)\nbeforeAfter f xs = unwords (mapBeforeAfter f xs)\n</code></pre>\n\n<p>where beforeAfter is an implementation of your IntListToString. Please note that function names must start with a symbol (excluding a colon) or a lowercase letter.</p>\n"}], "owner": {"reputation": 5, "user_id": 7819680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d468281fa3da9559276ca6700baf7e8a?s=128&d=identicon&r=PG&f=1", "display_name": "toasttoast", "link": "https://stackoverflow.com/users/7819680/toasttoast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 43586143, "answer_count": 1, "score": 0, "last_activity_date": 1493031429, "creation_date": 1493030394, "question_id": 43585921, "link": "https://stackoverflow.com/questions/43585921/haskell-intlist-to-string", "title": "Haskell IntList to String", "body": "<p>I'm trying to use operations like square on a list of Int and afterwards give the initial value and the result out in a string. For example:</p>\n\n<p>IntListToString square [5,6,7] should result in something like 5=25 6=36 =7=49</p>\n\n<p>My guess is the declaration has to look like this</p>\n\n<pre><code>IntListToString :: (Int -&gt; Int) -&gt; [Int] -&gt; String\n</code></pre>\n\n<p>Im struggling with the function itself. Do I have to use the map-function and afterwards convert into the right format?</p>\n\n<p>What would your suggestions on solving this be?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "edited": false, "score": 0, "creation_date": 1493027653, "post_id": 43584548, "comment_id": 74218839, "body": "<code>Ord a</code> says that <code>a</code> must be a member of the type class <code>Ord</code>. Members of the type class <code>Ord</code> can be ordered. If you are sure, that you only want to sort arrays of Int you might write <code>bubblesort :: [Int]-&gt;[Int]</code> instead.  The last line is necessary, as <code>bubblesort (x:y:xs)</code> expects an array containing at least two elements, namely <code>x</code> and <code>y</code>. At the end of the recursion <code>bubblesort</code> is called on an one element array. That causes the trouble.  Still calling <code>bubblesort []</code> would be a problem, as you didn&#39;t considered the empty case."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1493029470, "post_id": 43584548, "comment_id": 74220020, "body": "side note: I think your algorithm is incorrect - try <code>bubblesort [10,9..1]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1493031302, "creation_date": 1493031302, "answer_id": 43586227, "question_id": 43584548, "link": "https://stackoverflow.com/questions/43584548/implementation-of-first-pass-in-bubble-sort/43586227#43586227", "title": "Implementation of first Pass in Bubble sort", "body": "<ol>\n<li><p>The pattern <code>(x:y:xs)</code> matches with a list starting with <code>x</code> and <code>y</code>, and them continuing with the tail <code>xs</code>. So, it matches only with lists having at least length two. The other cases must be considered, otherwise the function will be a partial one and will crash at runtime as soon a short list is met.</p>\n\n<p>A possible way to fix this could be adding the two missing cases:</p>\n\n<pre><code>bubblesort (x:[]) = x:[]   -- length 1\nbubblesort [] = []         -- length 0\n</code></pre>\n\n<p>but it's simpler to just add one case at the end</p>\n\n<pre><code>bubblesort xs = xs\n</code></pre>\n\n<p>where <code>xs</code> is any list which was not handled by the cases above, i.e. a list whose length is less than two.</p></li>\n<li><p>The type signature <code>bubblesort :: (Ord Int) =&gt; [Int] -&gt; [Int]</code> is a bit weird. It states \"if integers can be ordered, then <code>bubblesort</code> has type ...\". We know that integers can be ordered, there's no need to require that. If you really want a more precise signature, just use</p>\n\n<pre><code>bubblesort :: [Int] -&gt; [Int]\n</code></pre>\n\n<p>(But what's wrong with the more general signature? I'd stick to that one)</p></li>\n</ol>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493031302, "creation_date": 1493026441, "question_id": 43584548, "link": "https://stackoverflow.com/questions/43584548/implementation-of-first-pass-in-bubble-sort", "title": "Implementation of first Pass in Bubble sort", "body": "<pre><code>bubblesort :: (Ord a) =&gt; [a] -&gt; [a]\nbubblesort (x:y:xs)\n    | x &gt; y = y : bubblesort (x:xs)\n    | otherwise = x : bubblesort (y:xs)\nbubblesort (x) = (x)\n</code></pre>\n\n<p>1.I don't understand the last line of the code; I tried to comment it out and the compiler says \" Non-exhaustive patterns in function bubblesort\", and when I tried to move it to the first line of the code, the compile says \"Pattern match is redundant.\" And the way it used round brackets confused me.</p>\n\n<p>2.I tried to change the type declaration as bubblesort :: (Ord Int) => [Int] -> [Int] and I got another error \" Non type-variable argument in the constraint: Ord Int (Use FlexibleContexts to permit this)\". Is there any way I can declare the list as an integer list?\n.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1492993681, "post_id": 43577758, "comment_id": 74205925, "body": "Your signature says that I (the caller) get to pick the types for <code>k</code> and <code>v</code>. I will make my own new types <code>Foo</code> and <code>Bar</code>, then send a list of <code>Connections</code> to <code>loadConn</code>. I want a <code>HashMap Foo Bar</code> out. Can you do that for me? This should indicate that the type of <code>loadConn</code> is <i>too general</i>."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1492997504, "creation_date": 1492997504, "answer_id": 43578449, "question_id": 43577758, "link": "https://stackoverflow.com/questions/43577758/trying-to-convert-a-list-of-data-records-to-a-hashmap/43578449#43578449", "title": "Trying to convert a list of data records to a hashmap", "body": "<p>Firstly, the do-block is out of place, as you aren't sequencing <code>IO</code> actions or writing any other kind of monadic code.</p>\n\n<p>Secondly, if you want the hashmap to have connection names as keys and connection properties as values, the type of your function should reflect that (see also crokeea's comment to the question):</p>\n\n<pre><code>loadConn :: [Connections] -&gt; HashMap String Object\n</code></pre>\n\n<p>Thridly, the general idea of building a list that you can give to <code>H.fromList</code> is sound, but you want <code>map</code> rather than a fold:</p>\n\n<pre><code>loadConn :: [Connections] -&gt; HashMap String Object\nloadConn cs = H.fromList $ map (\\c -&gt; (connectionName c, cfgProperty l)) cs\n</code></pre>\n\n<p>Or, using <code>.</code> for function composition and not mentioning the <code>cs</code> parameter:</p>\n\n<pre><code>loadConn :: [Connections] -&gt; HashMap String Object\nloadConn = H.fromList . map (\\c -&gt; (connectionName c, cfgProperty c))\n</code></pre>\n\n<p>Note that the function given to <code>map</code> converts a <em>single</em> connection into a <em>single</em> key-value pair. By the way, you'll probably want to change the name of your type from <code>Connections</code> to <code>Connection</code>, as each of its values appears to amounts to a single connection. </p>\n"}], "owner": {"reputation": 175, "user_id": 1044712, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c01a279faed71c8bec6492a519373d95?s=128&d=identicon&r=PG", "display_name": "peteofce", "link": "https://stackoverflow.com/users/1044712/peteofce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 0, "accepted_answer_id": 43578449, "answer_count": 1, "score": 0, "last_activity_date": 1492997504, "creation_date": 1492991376, "question_id": 43577758, "link": "https://stackoverflow.com/questions/43577758/trying-to-convert-a-list-of-data-records-to-a-hashmap", "title": "Trying to convert a list of data records to a hashmap", "body": "<p>Here is the code:</p>\n\n<pre><code>import Data.HashMap.Lazy as H\n\ndata Connections = Connections { connectionName :: String\n                    , cfgProperty  :: !Object\n                   } deriving (Show, Generic)\n\nloadConn :: [Connections] -&gt; HashMap k v\nloadConn c = H.fromList $ j c\n  where j cn = do\n              let h = foldl (\\l -&gt; [(connectionName l, cfgProperty l)]) cn\n              return h\n</code></pre>\n\n<p>OK, I know that \"loadConn\" is probably not even close.  I've fiddled with some different ideas, but none of them worked out.</p>\n\n<p>Any ideas? Is there more info needed?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "edited": false, "score": 1, "creation_date": 1492997084, "post_id": 43577617, "comment_id": 74206655, "body": "So why can&#39;t you 1) generate a data structure that represents your BNF [I assume you dont have trouble here], 2) pretty print that to produce happy BNF spec text 3) feed that to happy?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1493002511, "post_id": 43577617, "comment_id": 74207838, "body": "For constructs that are very similar to each other, you may be interested in Happy&#39;s parametrized productions."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1493008664, "post_id": 43577617, "comment_id": 74209264, "body": "You may be interested in <a href=\"https://hackage.haskell.org/package/BNFC-meta-0.4.0.3\" rel=\"nofollow noreferrer\"><code>BNFC-meta</code></a>, which is slightly more general in that it provides a metaprogram (in the form of TH) which converts a representation of a grammer to a meta-representation of a parser, which of course you can convert to an actual parser by just splicing that in. 1 is <code>read::String-&gt;Grammar</code> and 2 is <code>ebnf::Grammar-&gt;DecsQ</code> (I&#39;m not sure what you mean by 3 - what is &quot;BNF documentation&quot;?)"}], "answers": [{"tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": false, "score": 1, "last_activity_date": 1493002838, "creation_date": 1493002838, "answer_id": 43579123, "question_id": 43577617, "link": "https://stackoverflow.com/questions/43577617/generate-a-parser-from-programatically-generated-bnf/43579123#43579123", "title": "Generate a parser from programatically generated BNF", "body": "<p>The simplest thing to do would to make some data type representing the relevant grammar, and then convert it to a parser using some parser combinators as a (run-time) \"compile\" step.  Unfortunately, most parser combinators are less efficient and/or less flexible (in some ways) than the parser generators, so this would be a bit of a lowest common denominator approach.  That said, the <a href=\"https://hackage.haskell.org/package/grammar-combinators\" rel=\"nofollow noreferrer\">grammar-combinators</a> library may be useful, though it doesn't appear to be maintained.</p>\n\n<p>There are libraries that can generate parsers at run-time.  One I found just now is <a href=\"https://hackage.haskell.org/package/Grempa-0.2.2/docs/Data-Parser-Grempa-Dynamic.html\" rel=\"nofollow noreferrer\">Grempa</a>, which doesn't appear to be maintained but that may not be a problem.  Another option (by the same person who made Grempa but maintained) is <a href=\"https://hackage.haskell.org/package/Earley\" rel=\"nofollow noreferrer\">Earley</a> which, due to the way Earley parsers are made, it makes sense to have an explicit grammar that gets processed into a parser.  Earley parsing is certainly flexible, but may be overpowered for you (or maybe not).</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1493002838, "creation_date": 1492990077, "question_id": 43577617, "link": "https://stackoverflow.com/questions/43577617/generate-a-parser-from-programatically-generated-bnf", "title": "Generate a parser from programatically generated BNF", "body": "<p>I've seen two approaches to parsing:</p>\n\n<ol>\n<li><p>Use a parser generator like <a href=\"https://hackage.haskell.org/package/happy\" rel=\"nofollow noreferrer\"><code>happy</code></a>. This allows you to specify your language in BNF, and not worry about the intricacies of parsing. However, since it's a preprocessor you have to write your whole parse tree textually. </p></li>\n<li><p>Use a parser directly like <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\"><code>megaparsec</code></a>. With this approach you have direct access to your code so you can generate your parser programatically, but you haven't got the convenience of happy's simple BNF specification with precedence annotations etc. Also it seems non trivial to print out a BNF tree for documentation from your parsing code unless this is considered during it's construction.</p></li>\n</ol>\n\n<p>What I'd like to do is something like this:</p>\n\n<ol>\n<li>Generate a data structure programatically that represents BNF.</li>\n<li>Feed this through to a \"happy like\" parser generator to generate a parser.</li>\n<li>Feed this through a pretty printer to generate actual BNF documentation.</li>\n</ol>\n\n<p>The reason I want to do this is that the grammar I'm working on has grown quite large and has a lot of repetition, as a lot of it's constructs are similar to others but slightly different. It would improve maintenence effort if it could be generated programmatically instead of modifying happy BNF spec directly, but I'd rather not have to develop my own parser from scratch.</p>\n\n<p>Any ideas about a good approach here. It would be great if I could just generate a data structure and force it into <code>happy</code> (as it presumably generates it's own internal structure after parsing the BNF feed to it) but <code>happy</code> doesn't seem to have a library interface.</p>\n\n<p>I guess I could generate attonated BNF, and feed that through to happy, but it seems like a messy process of converting back and forth. A cleaner approach would be better. Perhaps even a BNF style extension to <code>parsec</code> or <code>megaparsec</code>? </p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1492980511, "post_id": 43576320, "comment_id": 74202883, "body": "what should the function return if either of num1,num2 isn&#39;t present in the list , e.g. <code>after [2,3,4] 5 2</code> or <code>after [2,3,4] 2 5</code> or <code>after [2,3,4] 1 7</code> ?"}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1492980652, "post_id": 43576320, "comment_id": 74202931, "body": "by the way, your function isn&#39;t recursive which it should be"}, {"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "reply_to_user": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1492980872, "post_id": 43576320, "comment_id": 74202993, "body": "then it should return false"}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1492980877, "post_id": 43576320, "comment_id": 74202995, "body": "also what if either of num1,num2 is repeated in the list , e.g. <code>after [2,3,4,2] 2 4</code> should the answer be <code>True</code> because <code>4</code> is after the first <code>2</code> or should it be <code>False</code> because the last <code>2</code> is after <code>4</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1493016347, "post_id": 43576412, "comment_id": 74212043, "body": "But you split the first part in two parts too. Combination of <code>elemIndex</code> and <code>drop</code> means you need to go over the first part of <code>xs</code> twice, which is bad if the first occurrence of <code>x</code> is somewhere close to the end. It&#39;s better done using <code>dropWhile</code>, as in Chris Penner&#39;s answer."}], "tags": [], "owner": {"reputation": 17464, "user_id": 2040251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UsW2G.jpg?s=128&g=1", "display_name": "kraskevich", "link": "https://stackoverflow.com/users/2040251/kraskevich"}, "is_accepted": false, "score": 1, "last_activity_date": 1492981797, "last_edit_date": 1492981797, "creation_date": 1492981000, "answer_id": 43576412, "question_id": 43576320, "link": "https://stackoverflow.com/questions/43576320/a-haskell-function-to-test-if-an-integer-appears-after-another-integer/43576412#43576412", "title": "a haskell function to test if an integer appears after another integer", "body": "<p>You can split it into two parts: the first one will find the first occurrence of <code>num1</code>. After that, you just need to drop all elements before it and just check that <code>num2</code> is in the remaining part of the list.</p>\n\n<p>There's a standard function <a href=\"http://hackage.haskell.org/package/base-4.2.0.0/docs/Data-List.html#v%3AelemIndex\" rel=\"nofollow noreferrer\"><code>elemIndex</code></a> for the first part. The second one is just <code>elem</code>.</p>\n\n<pre><code>import Data.List (elemIndex)\n\nafter xs x y = \n    case x `elemIndex` xs of \n        Just i -&gt; y `elem` (drop (i + 1) xs)\n        Nothing -&gt; False\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1492985186, "post_id": 43576512, "comment_id": 74204184, "body": "Nice alternatives. Some of these might not be perfectly equivalent in the case <code>a==b</code>, if I see correctly. My preferred solutions are the first (compact) and the last one (easy to read). <code>foldl</code> seems a bit unappropriate for this since you don&#39;t really need to fold over the full list."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1492985322, "post_id": 43576512, "comment_id": 74204212, "body": "@chi Agreed; they didn&#39;t mention preferred behaviour for that case so I didn&#39;t worry about it."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1492985604, "post_id": 43576512, "comment_id": 74204279, "body": "<code>not . null . dropWhile (&#47;= b) = elem b</code>"}], "tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": false, "score": 7, "last_activity_date": 1492993503, "last_edit_date": 1492993503, "creation_date": 1492981664, "answer_id": 43576512, "question_id": 43576320, "link": "https://stackoverflow.com/questions/43576320/a-haskell-function-to-test-if-an-integer-appears-after-another-integer/43576512#43576512", "title": "a haskell function to test if an integer appears after another integer", "body": "<p>There's a few different ways to approach this one; while it's tempting to go straight for recursion on this, it's nice to\navoid using recursion explicitly if there's another option.</p>\n\n<p>Here's a simple version using some list utilities. Note that it's a Haskell idiom that the object we're operating over is usually the last argument. In this case switching the arguments lets us write it as a pipeline with it's third argument (the list) passed implicitly:</p>\n\n<pre><code>after :: Int -&gt; Int -&gt; [Int] -&gt; Bool\nafter a b = elem b . dropWhile (/= a)\n</code></pre>\n\n<p>Hopefully this is pretty easy to understand; we drop elements of the list until we hit an <code>a</code>, assuming we find one we check if there's a <code>b</code> in the remaining list. If there was no <code>a</code>, this list is <code>[]</code> and obviously there's no <code>b</code> there, so it returns False as expected.</p>\n\n<p>You haven't specified what happens if 'a' and 'b' are equal, so I'll leave it up to you to adapt it for that case. HINT: add a <code>tail</code> somewhere ;)</p>\n\n<p>Here are a couple of other approaches if you're interested:</p>\n\n<p>This is pretty easily handled using a fold;</p>\n\n<p>We have three states to model. Either we're looking for the first elem, or\nwe're looking for the second elem, or we've found them (in the right order).</p>\n\n<pre><code>data State =\n  FindA | FindB | Found\n  deriving Eq\n</code></pre>\n\n<p>Then we can 'fold' (aka reduce) the list down to the result of whether it matches or not. </p>\n\n<pre><code>after :: Int -&gt; Int -&gt; [Int] -&gt; Bool\nafter a b xs = foldl go FindA xs == Found\n  where\n    go FindA x = if x == a then FindB else FindA\n    go FindB x = if x == b then Found else FindB\n    go Found _ = Found\n</code></pre>\n\n<p>You can also do it recursively if you like:</p>\n\n<pre><code>after :: Int -&gt; Int -&gt; [Int] -&gt; Bool\nafter _ _ [] = False\nafter a b (x:xs) \n  | x == a = b `elem` xs\n  | otherwise = after a b xs\n</code></pre>\n\n<p>Cheers!</p>\n"}, {"tags": [], "owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "is_accepted": false, "score": 1, "last_activity_date": 1492984557, "creation_date": 1492984557, "answer_id": 43576947, "question_id": 43576320, "link": "https://stackoverflow.com/questions/43576320/a-haskell-function-to-test-if-an-integer-appears-after-another-integer/43576947#43576947", "title": "a haskell function to test if an integer appears after another integer", "body": "<p>If you'd like to implement it without <code>elem</code> or <code>elemIndex</code>, you could include a subroutine. Something like:</p>\n\n<pre><code>after xs b c = go xs False\n  where go (x:xs) bFound\n          | x == b &amp;&amp; not (null xs) = go xs True\n          | bFound &amp;&amp; x == c        = True\n          | null xs                 = False\n          | otherwise               = go xs bFound\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 2, "answer_count": 3, "score": 4, "last_activity_date": 1492993503, "creation_date": 1492980311, "question_id": 43576320, "link": "https://stackoverflow.com/questions/43576320/a-haskell-function-to-test-if-an-integer-appears-after-another-integer", "title": "a haskell function to test if an integer appears after another integer", "body": "<p>I'm writing a function called  after  which takes a list of integers and two integers as parameters. after list num1 num2  should  return True  if  num1  occurs   in   the   list   and  num2  occurs   in  list afternum1. (Not necessarily immediately after).</p>\n\n<pre><code>after::[Int]-&gt;Int-&gt;Int-&gt;Bool\nafter [] _ _=False\nafter [x:xs] b c \n    |x==b &amp;&amp; c `elem` xs =True \n    |x/=b &amp;&amp; b `elem` xs &amp;&amp; b `elem` xs=True\n</code></pre>\n\n<p>This is what I have so far,my biggest problem is that I don't know how to force num2 to be after num1.</p>\n"}, {"tags": ["haskell", "build", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1493009889, "post_id": 43576208, "comment_id": 74209606, "body": "&quot;does this binary run on other platforms or do I need to build a binary for platforms independently?&quot; - yes, of course you must cross compile <b>binary</b> files (what is it such a file contains?). To get a GHC cross compiler, you must <a href=\"https://ghc.haskell.org/trac/ghc/wiki/CrossCompilation\" rel=\"nofollow noreferrer\">build it yourself</a>. With that in mind (building GHC yourself), getting <code>cabal</code> or <code>stack</code> to use that build is trivial by comparison. (Aside: if you want a program which functions like &quot;golang using ghr&quot;, you should explain what that is, instead of forcing readers of this question to learn <code>go</code>)"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1493014102, "post_id": 43576208, "comment_id": 74211019, "body": "@user2407038 hrmm, thanks! That helps; I edited the question. I think I might be able to avoid cross-compilation by running two builds via Travis (one on OSX, one on Linux)."}], "answers": [{"tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": true, "score": 2, "last_activity_date": 1577429677, "last_edit_date": 1577429677, "creation_date": 1493083545, "answer_id": 43600086, "question_id": 43576208, "link": "https://stackoverflow.com/questions/43576208/build-binaries-for-linux-mac-via-ci/43600086#43600086", "title": "Build binaries for Linux &amp; Mac via CI", "body": "<p>Managed to get it working for my <a href=\"https://github.com/ChrisPenner/tempered\" rel=\"nofollow noreferrer\">Tempered</a> project. You can check out the <a href=\"https://github.com/ChrisPenner/tempered/blob/02a9e81251d7947dd6a4b2a9e7303418f23555ea/.travis.yml\" rel=\"nofollow noreferrer\"><code>.travis.yml</code></a> file to see how it's done; or check out the blog post I wrote on how to ship binaries via homebrew (it also covers building for linux).</p>\n\n<p><a href=\"https://chrispenner.ca/posts/homebrew-haskell\" rel=\"nofollow noreferrer\">https://chrispenner.ca/posts/homebrew-haskell</a></p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 515, "favorite_count": 1, "accepted_answer_id": 43600086, "answer_count": 1, "score": 3, "last_activity_date": 1577429677, "creation_date": 1492979688, "last_edit_date": 1493013835, "question_id": 43576208, "link": "https://stackoverflow.com/questions/43576208/build-binaries-for-linux-mac-via-ci", "title": "Build binaries for Linux &amp; Mac via CI", "body": "<p>I wrote a Haskell program; I'd rather people not need to have Haskell installed to run it so I want to ship a binary for common platforms (OSX, Linux).</p>\n\n<p>I know that on my computer I can <code>stack build</code> or <code>cabal build</code> on CircleCI \nto generate a binary; but by default that'll only generate a binary for the OS of the container. How can I build a binary for each of OSX and Linux on either CircleCI (or Travis if necessary)? </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "semantics", "proof", "st-monad"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1492977304, "post_id": 43575670, "comment_id": 74201752, "body": "Rigorously proven \u2013 in what framework? <i>All</i> types in Haskell contain only pure values, so proving this property is a bit like proving that a given natural number, defined in some way, is not negative."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 4, "creation_date": 1492977623, "post_id": 43575670, "comment_id": 74201867, "body": "This paper claims that it hasn&#39;t: <code>none of the papers we came across in our literature study actually establishes the safety of the ST monad in Haskell</code> <a href=\"http://people.seas.harvard.edu/~pbuiras/publications/KeyMonadHaskell2016.pdf\" rel=\"nofollow noreferrer\">people.seas.harvard.edu/~pbuiras/publications/&hellip;</a>"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1492978079, "post_id": 43575670, "comment_id": 74202025, "body": "@leftaroundabout: I believe the issue is proving that an STRef can never escape from its runST prison."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1492979717, "post_id": 43575670, "comment_id": 74202605, "body": "@PaulJohnson That&#39;s delicate indeed. Since it <i>can</i> escape, if wrapped in an existential or <code>Dynamic</code>. But in such case, even if it can be fed to <code>readSTRef, writeSTRef</code>, the resulting action is still existentially quantified, hence can not be passed to <code>runST</code>. Proving all of this formally apparently is not trivial."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1492980396, "post_id": 43575670, "comment_id": 74202847, "body": "Great reference, @danidiaz; that probably constitutes a valid answer."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1493001409, "post_id": 43575670, "comment_id": 74207588, "body": "I noticed that I did not clarify what I mean with \u201cpure\u201d, and now I notice that there does not seem to exist a standard formal definition of pureness, let alone a proof that Haskell or Core is pure\u2026 What a rabbit hole."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1493004172, "post_id": 43575670, "comment_id": 74208179, "body": "Amr Sabry argues in <a href=\"https://doi.org/10.1017/S0956796897002943\" rel=\"nofollow noreferrer\">What is a Purely Functional Language</a>, that <i>lazy</i> <code>ST</code> isn&#39;t pure according to the definition of purity Sabry provides. To answer your question, the first thing you&#39;d need to do is actually define &quot;pure&quot;. Sabry provides arguments why the typical &quot;definitions&quot; are, perhaps, inadequate and proposes an alternative."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1493057910, "post_id": 43575670, "comment_id": 74240009, "body": "@DerekElkins, theoretical concerns aside, lazy ST had a major concurrency bug (fixed in 8.2) that made it really impure in multi-threaded programs."}], "answers": [{"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1492982086, "post_id": 43576492, "comment_id": 74203301, "body": "So one would have to prove parametricity for Haskell or Core, which, as far as I know, also has not been done yet."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1492998566, "post_id": 43576492, "comment_id": 74206994, "body": "Also, without commentary, the Agda formalization is not easy for me to follow, I must admit."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1493058126, "post_id": 43576492, "comment_id": 74240135, "body": "<code>do y &lt;- readSTRef x; y</code> is the same as <code>join (readSTRef x)</code>, right?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 3, "creation_date": 1493138211, "post_id": 43576492, "comment_id": 74281682, "body": "I did a <a href=\"https://gist.github.com/AndrasKovacs/07310be00e2a1bb9e94d7c8dbd1dced6\" rel=\"nofollow noreferrer\">much simpler</a> Agda formalization of  ST, if you&#39;re interested. It also computes properly, without any unsafe shenanigans."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 14, "last_activity_date": 1517646080, "last_edit_date": 1517646080, "creation_date": 1492981543, "answer_id": 43576492, "question_id": 43575670, "link": "https://stackoverflow.com/questions/43575670/is-there-a-proof-that-runst-is-indeed-pure/43576492#43576492", "title": "Is there a proof that runST is indeed pure?", "body": "<p>Here is an <a href=\"http://code.haskell.org/~Saizan/ST/ST.agda\" rel=\"nofollow noreferrer\">Agda formalization</a> by Andrea Vezzosi, which proves that <code>runST</code> is safe and total for an <code>ST</code> monad with readable/writable refs. It relies on postulated parametricity, i. e. the truth of the free theorems for the involved definitions, which is as expected, since parametricity is precisely the reason why the <code>forall s.</code> trick works.</p>\n\n<p>However, the proof assumes that we can't put values inside an <code>STRef s</code> with types which themselves depend on <code>ST s</code>. In Haskell we can use such dependency to get looping without recursion:</p>\n\n<pre><code>loop :: ()\nloop = runST $ do\n  x &lt;- newSTRef (pure ())\n  writeSTRef x $ do\n    y &lt;- readSTRef x\n    y\n  y &lt;- readSTRef x\n  y\n</code></pre>\n\n<p>Probably this version of the ST monad is still safe, just does not have provably total <code>writeSTRef</code> and <code>readSTRef</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1493042843, "post_id": 43584530, "comment_id": 74230085, "body": "Oh ok. There goes another research project idea down the has-been-done-before drain\u2026"}, {"owner": {"reputation": 448, "user_id": 4416280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c4e7c5ba681838526fb520fc8f36dec?s=128&d=identicon&r=PG&f=1", "display_name": "Zemyla", "link": "https://stackoverflow.com/users/4416280/zemyla"}, "edited": false, "score": 0, "creation_date": 1516312912, "post_id": 43584530, "comment_id": 83647862, "body": "The link is a 404 now. Where can I find an updated link?"}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1516539127, "post_id": 43584530, "comment_id": 83720466, "body": "Thanks for letting me know.  The paper has been published at POPL2018. Updated my answer to reflect this."}], "tags": [], "owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "is_accepted": true, "score": 8, "last_activity_date": 1516539092, "last_edit_date": 1516539092, "creation_date": 1493026394, "answer_id": 43584530, "question_id": 43575670, "link": "https://stackoverflow.com/questions/43575670/is-there-a-proof-that-runst-is-indeed-pure/43584530#43584530", "title": "Is there a proof that runST is indeed pure?", "body": "<p>It just so happens that Amin Timany et al. have recently published a paper at POPL2018 about exactly this topic.\nYou can find the paper <a href=\"http://iris-project.org/pdfs/2018-popl-runST-final.pdf\" rel=\"nofollow noreferrer\">here</a>.\nFull disclosure: I haven't found the time to read it thoroughly yet myself :).</p>\n"}], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 5, "accepted_answer_id": 43584530, "answer_count": 2, "score": 12, "last_activity_date": 1517646080, "creation_date": 1492976360, "question_id": 43575670, "link": "https://stackoverflow.com/questions/43575670/is-there-a-proof-that-runst-is-indeed-pure", "title": "Is there a proof that runST is indeed pure?", "body": "<p>The <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad-ST.html\" rel=\"noreferrer\">ST monad</a>, originally devised by <a href=\"http://dl.acm.org/citation.cfm?doid=178243.178246\" rel=\"noreferrer\">Launchbury and Peyton Jones</a>, allows Haskell programmers to write imperative code (with mutable variables, arrays, etc.) while obtaining a pure interface to that code.</p>\n\n<p>More concretely, the polymorphic type of the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad-ST.html#v:runST\" rel=\"noreferrer\">entry point function</a></p>\n\n<pre><code>runST :: (forall s. ST s a) -&gt; a\n</code></pre>\n\n<p>ensures that all side-effects of the <code>ST</code> computation is contained, and the resulting value is pure.</p>\n\n<p>Has this ever been rigorously (or even formally) proven?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1492971012, "post_id": 43574471, "comment_id": 74199553, "body": "With respect to <code>fib1</code>: <code>zip</code> is the same as <code>zipWith (,)</code> (or, more verbosely, <code>zipWith (\\a b -&gt; (a, b))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "is_accepted": true, "score": 1, "last_activity_date": 1492971176, "creation_date": 1492971176, "answer_id": 43574749, "question_id": 43574471, "link": "https://stackoverflow.com/questions/43574471/what-is-the-difference-between-these-two-haskell-function-fibonacci-functions/43574749#43574749", "title": "What is the difference between these two Haskell Function fibonacci functions?", "body": "<p>In the first function, what you have is an infinity recursion that create the Fibonacci series in a list. The tail is used to refer to the next element in the sequence, for adding those two together. I think that by tracing the creation of the third element you'll understand better what is happening:</p>\n\n<pre><code>zipWith (+) fibs (tail fibs) -&gt;\nzipWith (+) (0 : 1 : zipWith (+) fibs (tail fibs)) (1 : zipWith (+) fibs (tail fibs)) -&gt;\n(0 + 1 : 1 + zipWith (+) fibs (tail fibs) : ...)\n</code></pre>\n\n<p>You can see that each element in the fibs list is created by adding its two former numbers in the sequence.</p>\n\n<p>In fib1 something similar is happening. You are grouping in a tuple two adjacent numbers in the sequence and then declaring that the list is the sum of those two tuples (you can \"solve\" it like I did above to better understand what is happening). Note that the tuple itself is not important, just a way to pass data around. You can have the same effect with a list or a user-defined type.</p>\n\n<p>Please tell me if something is not clear.\nCheers</p>\n"}], "owner": {"reputation": 61, "user_id": 6055914, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/bac13b3a6a5bc3c7adbf4f24c55d599a?s=128&d=identicon&r=PG&f=1", "display_name": "agarc", "link": "https://stackoverflow.com/users/6055914/agarc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "closed_date": 1492971423, "accepted_answer_id": 43574749, "answer_count": 1, "score": 1, "last_activity_date": 1492971451, "creation_date": 1492969460, "question_id": 43574471, "link": "https://stackoverflow.com/questions/43574471/what-is-the-difference-between-these-two-haskell-function-fibonacci-functions", "closed_reason": "Duplicate", "title": "What is the difference between these two Haskell Function fibonacci functions?", "body": "<p>I'm new to Haskell, and was wondering what the difference between these two functions are.</p>\n\n<pre><code> fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n\n fib1 = 1 :1 : [a+b | (a,b) &lt;- zip fib1 (tail fib1)]\n</code></pre>\n\n<p>I would like to know how they are working more clearly. </p>\n\n<p>How I currently understand them is as follows:</p>\n\n<p>I know that zipWith in the first function will apply the addition function to two lists in this case \"fibs\" and \"tail fibs\". However I'm confused on how the recursion is working. I know fibs returns a list and tail fibs would be everything except the head of the list. However I guess I'm confused on the intermediate steps and how zipWith is working with this recursively.</p>\n\n<p>In fib1  I have the same question as above for \"zip\" but also how exactly is this getting applied to \"a\" and \"b\". Also why are \"a\" and \"b\" in a tuple?</p>\n\n<p>I'm sorry if I haven't been more clear. I appreciate any help people could offer</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell", "type-theory"], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492964251, "post_id": 43573307, "comment_id": 74196946, "body": "Perhaps poser would be a easier and more interesting example."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492964713, "post_id": 43573307, "comment_id": 74197132, "body": "<a href=\"https://en.wikipedia.org/wiki/Partially_ordered_set#In_category_theory\" rel=\"nofollow noreferrer\">Posets</a> you mean, I take it? They&#39;re <i>easier</i>, arguably, much <i>less</i> interesting. But if you add them as an extra example, certainly couldn&#39;t cause any harm."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492966918, "post_id": 43573307, "comment_id": 74198001, "body": "Yes (sorry stupid typo). More interesting because sums and products there have nothing to do with set-theoretical sums and products. In vector spaces you still kinda have set-theoretical sums and products (over sets of indices, when you fix a base for each space). This is my possibly incorrect understanding anyway."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492967911, "post_id": 43573307, "comment_id": 74198357, "body": "Ah, that&#39;s what you mean. Yes, <i>sets of indices</i> are a possible interpretation that matches the <i>sum</i> and <i>product</i> notion, though I&#39;m personally not a fan of this interpretation because in general, a vector space doesn&#39;t have a canonical basis."}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 1, "creation_date": 1493003815, "post_id": 43573307, "comment_id": 74208101, "body": "Categorically, there is no definition of &quot;sum type&quot; except for coproduct, so the statement like &quot;the coproduct is not a sum type&quot; is a bit nonsensical. I think what you are effectively trying to say is that the <i>underlying set</i> of the coproduct is not the disjoint union of the underlying set of the summands. Also, the category of vector spaces does have categorical products. They happen to coincide with coproducts in the finite case (and this is called a biproduct). They diverge when you consider co/products indexed by infinite sets. Tensor products are something else entirely, categorically."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1493032059, "post_id": 43573307, "comment_id": 74221747, "body": "@DerekElkins I understand \u201csum type\u201d as nothing category-theoretical, but just as an algebraic datatype with tagged-union structure. \u2014 It&#39;s good to hear that the product in <b>Vectk</b> is <i>not</i> the tensor product, it was ever nagging a bit on me that I&#39;d just used tuples as the product in my library and implemented tensors separately..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 18, "last_activity_date": 1493032177, "last_edit_date": 1493032177, "creation_date": 1492962868, "answer_id": 43573307, "question_id": 43572970, "link": "https://stackoverflow.com/questions/43572970/is-coproduct-the-same-as-sum-types/43573307#43573307", "title": "Is coproduct the same as sum types?", "body": "<p>Basically, yes. Coproducts are in principle more general, but that needn't \nnecessarily concern you as far as Haskell is concerned.</p>\n\n<p>An example of a category where the coproduct is not a sum type<sup>\u2020</sup> is the <a href=\"https://en.wikipedia.org/wiki/Category_of_modules\" rel=\"noreferrer\">category of vector spaces</a> with linear mappings as the arrows. In this category, disjoint-sum types don't make a lot of sense because they would give you two different zero-vector elements.</p>\n\n<p>Instead, it turns out that <em>product</em> types (which in linear algebra are called <a href=\"https://en.wikipedia.org/wiki/Direct_sum\" rel=\"noreferrer\">direct sums</a>, but implementation-wise they're tuples, not alternatives) are a coproduct on this category:</p>\n\n<pre><code>type LFun v w = v -&gt; w\n\ninitial :: VectorSpace w =&gt; LFun () w\ninitial () = zeroV\n\n(+++) :: VectorSpace w =&gt; LFun u w -&gt; LFun v w -&gt; LFun (u,v) w\n(f+++g) (u,v) = f u ^+^ g v\n</code></pre>\n\n<p><del>(The standard product on this category is then the <a href=\"https://en.wikipedia.org/wiki/Tensor_product\" rel=\"noreferrer\">tensor product</a>. Though it's possible to ignore this and use ordinary tuples as the product type, i.e. the actual coproducts. I think this has to do with the fact that any Hilbert space is isomorphic to its dual space. In my <a href=\"http://hackage.haskell.org/package/linearmap-category-0.3.2.0/docs/Math-LinearMap-Category.html\" rel=\"noreferrer\"><code>constrained-categories</code>/<code>linearmap-category</code></a> library, the products are tuples, whereas Mike Izbicki <a href=\"https://hackage.haskell.org/package/subhask-0.1.1.0/docs/SubHask-Algebra-Vector.html\" rel=\"noreferrer\">has not done this</a> in the topically similar <code>SubHask</code> library.)</del><sub>See Derek Elkins' comment.</sub></p>\n\n<p><hr>\n<sup>\u2020</sup><sub>I understand \u201csum type\u201d in the data sense, i.e. as an algebraic data type with structure of a tagged union.</sub></p>\n"}], "owner": {"reputation": 375, "user_id": 5773140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wXy7Z.jpg?s=128&g=1", "display_name": "Felipe Gusmao", "link": "https://stackoverflow.com/users/5773140/felipe-gusmao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 5, "accepted_answer_id": 43573307, "answer_count": 1, "score": 18, "last_activity_date": 1493032177, "creation_date": 1492961028, "last_edit_date": 1492962477, "question_id": 43572970, "link": "https://stackoverflow.com/questions/43572970/is-coproduct-the-same-as-sum-types", "title": "Is coproduct the same as sum types?", "body": "<p>I was watching <a href=\"https://www.youtube.com/watch?v=LkIRsNj9T-8&amp;index=4&amp;list=PLbgaMIhjbmEnaH_LTkxLI7FMa2HsnawM_#t=1635.142339\" rel=\"noreferrer\">this lecture from Bartosz Milewski</a> and he was explaining coproduct and sum types.</p>\n\n<p>On the lecture, He went from one to the other.</p>\n\n<p>Is the coproduct the same as the sum type?</p>\n"}, {"tags": ["haskell", "ghcjs", "ghcjs-dom"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1492954611, "post_id": 43571803, "comment_id": 74193306, "body": "what sort of JSVal would you expect <code>ByteString</code> to be? - one thing you can do for sure is encode it base64 and make a JSString out of it - this would be my choice."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1492955739, "post_id": 43571803, "comment_id": 74193688, "body": "I have no familiarity with this, but I think the JS value must be in the right format for this to work. Maybe the docs state which is the right format, e.g. array-of-array-of-integers ? Or a JS object of some sort."}], "answers": [{"comments": [{"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 3, "creation_date": 1492974787, "post_id": 43573870, "comment_id": 74200863, "body": "Unfortunately, this does not work. If you click at the <i>Source</i> link in your result link, then you see it says: <code>toJSString = const jsNull</code>. So it always results just in an empty JS string!"}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 1, "last_activity_date": 1492965952, "creation_date": 1492965952, "answer_id": 43573870, "question_id": 43571803, "link": "https://stackoverflow.com/questions/43571803/how-to-convert-a-bytestring-value-to-a-jsval/43573870#43573870", "title": "How to convert a ByteString value to a JSVal", "body": "<p>You can use hoogle to find a function by it's type signature <code>ByteString -&gt; GHCJS.Prim.JSVal</code>. <a href=\"https://www.stackage.org/lts-8.11/hoogle?q=ByteString+-%3E+GHCJS.Prim.JSVal\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-8.11/hoogle?q=ByteString+-%3E+GHCJS.Prim.JSVal</a></p>\n\n<p>Which has this in the results:\n<a href=\"https://www.stackage.org/haddock/lts-8.11/ghcjs-base-stub-0.1.0.2/GHCJS-Prim.html#v:toJSString\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-8.11/ghcjs-base-stub-0.1.0.2/GHCJS-Prim.html#v:toJSString</a></p>\n\n<pre><code>toJSString :: String -&gt; JSVal\n</code></pre>\n\n<p>So now you just need a function to do <code>ByteString -&gt; String</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 3, "last_activity_date": 1493218218, "last_edit_date": 1493218218, "creation_date": 1492970000, "answer_id": 43574564, "question_id": 43571803, "link": "https://stackoverflow.com/questions/43571803/how-to-convert-a-bytestring-value-to-a-jsval/43574564#43574564", "title": "How to convert a ByteString value to a JSVal", "body": "<p>As K.A. Buhr pointed out, after converting the <code>ByteString</code> to a <code>Uint8ClampedArray</code>, you can pass the clamped array to <code>newImageData</code> to get the desired <code>ImageData</code> object.</p>\n\n<p>You can use an inline Javascript function to generate the <code>Uint8ClampedArray</code>.  To pass a <code>ByteString</code> through the Javascript FFI, use <code>Data.ByteString.useAsCStringLen</code> .  </p>\n\n<p>The code below shows how to do this.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE JavaScriptFFI #-}\n{-# LANGUAGE CPP #-}\n\nimport Reflex.Dom\nimport Data.Monoid ((&lt;&gt;))\nimport Control.Monad.IO.Class (liftIO)\nimport GHCJS.DOM.ImageData (newImageData)\nimport GHCJS.DOM.HTMLCanvasElement (getContext)\nimport GHCJS.DOM.JSFFI.Generated.CanvasRenderingContext2D (putImageData)\nimport GHCJS.DOM.Types (CanvasRenderingContext2D(..), castToHTMLCanvasElement, Uint8ClampedArray(..))\nimport Foreign.Ptr (Ptr)\nimport GHCJS.Types (JSVal)\nimport GHCJS.Marshal.Pure (pFromJSVal, pToJSVal)\nimport Data.Map (Map)\nimport Data.Text as T (Text, pack)\nimport Data.ByteString as BS (ByteString, pack, useAsCStringLen)\n\n-- Some code and techniques taken from these sites:\n-- http://lpaste.net/154691\n-- https://www.snip2code.com/Snippet/1032978/Simple-Canvas-Example/\n\n-- import inline Javascript code as Haskell function : jsUint8ClampedArray\nforeign import javascript unsafe \n    -- Arguments\n    --     pixels : Ptr a -- Pointer to a ByteString \n    --     len    : JSVal -- Number of pixels\n    \"(function(){ return new Uint8ClampedArray($1.u8.slice(0, $2)); })()\" \n    jsUint8ClampedArray :: Ptr a -&gt; JSVal -&gt; IO JSVal\n\n-- takes pointer and length arguments as passed by useAsCStringLen\nnewUint8ClampedArray :: (Ptr a, Int) -&gt; IO Uint8ClampedArray\nnewUint8ClampedArray (pixels, len) = \n    pFromJSVal &lt;$&gt; jsUint8ClampedArray pixels (pToJSVal len)\n\ncanvasAttrs :: Int -&gt; Int -&gt; Map T.Text T.Text\ncanvasAttrs w h =    (\"width\" =: T.pack (show w)) \n                  &lt;&gt; (\"height\" =: T.pack (show h))\n\nmain = mainWidget $ do\n    -- first, generate some test pixels\n    let boxWidth = 120\n        boxHeight = 30\n        boxDataLen = boxWidth*boxHeight*4 -- 4 bytes per pixel\n\n        reds = take boxDataLen $ concat $ repeat [0xff,0x00,0x00,0xff]\n        greens = take boxDataLen $ concat $ repeat [0x00,0xff,0x00,0xff]\n        blues = take boxDataLen $ concat $ repeat [0x00,0x00,0xff,0xff]\n\n        pixels = reds ++ greens ++ blues\n        image = BS.pack pixels -- create a ByteString with the pixel data.\n\n    -- create Uint8ClampedArray representation of pixels\n    imageArray &lt;- liftIO $ BS.useAsCStringLen image newUint8ClampedArray\n\n    let imageWidth = boxWidth\n        imageHeight = (length pixels `div` 4) `div` imageWidth\n\n    -- use Uint8ClampedArray representation of pixels to create ImageData\n    imageData &lt;- newImageData (Just imageArray) (fromIntegral imageWidth) (fromIntegral imageHeight)\n\n    -- demonstrate the imageData is what we expect by displaying it.\n    (element, _) &lt;- elAttr' \"canvas\" (canvasAttrs 300 200) $ return ()\n    let canvasElement = castToHTMLCanvasElement(_element_raw element)\n    elementContext &lt;-  getContext canvasElement (\"2d\" :: String)\n\n    let renderingContext = CanvasRenderingContext2D elementContext\n    putImageData renderingContext (Just imageData) 80 20\n</code></pre>\n\n<p>Here's a link to a repository with the example code: <a href=\"https://github.com/dc25/stackOverflow__how-to-convert-a-bytestring-value-to-a-jsval\" rel=\"nofollow noreferrer\">https://github.com/dc25/stackOverflow__how-to-convert-a-bytestring-value-to-a-jsval</a></p>\n\n<p>Here's a link to a live demo : <a href=\"https://dc25.github.io/stackOverflow__how-to-convert-a-bytestring-value-to-a-jsval/\" rel=\"nofollow noreferrer\">https://dc25.github.io/stackOverflow__how-to-convert-a-bytestring-value-to-a-jsval/</a></p>\n"}, {"comments": [{"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1493022903, "post_id": 43575261, "comment_id": 74215793, "body": "Many thanks for your excellent example. I think that we are working in different universes: You are using <code>JSDOM.ImageData</code> and <code>JSDOM.HTMLCanvasElement</code>. However I&#39;m using <code>GHCJS.DOM.Types</code> and <code>GHCJS.DOM.JSFFI.Generated.CanvasRenderingContext2D</code>. I don&#39;t yet know how the two unverses are related and how I can apply your solution in my universe. I&#39;m using <code>GHCJS.DOM</code> because at the end of the day my example should work in reflex-dom."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1493053802, "post_id": 43575261, "comment_id": 74237710, "body": "I tried to setup a stack.yaml file to really compile and execute your full example. Unfortunately I failed. What is the Stackage LTS version you used to test your code? What are the commit ids of reflex and reflex-dom?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1493062105, "post_id": 43575261, "comment_id": 74242510, "body": "I added my <code>stack.yaml</code>.  (Note that it didn&#39;t use <code>reflex</code> which, given its dependence on <code>ghcjs-base</code>, is probably truly GHCJS-specific.)"}, {"owner": {"reputation": 4798, "user_id": 460175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dUcwY.png?s=128&g=1", "display_name": "comonad", "link": "https://stackoverflow.com/users/460175/comonad"}, "edited": false, "score": 0, "creation_date": 1613302788, "post_id": 43575261, "comment_id": 117028639, "body": "reflex-dom has a <a href=\"https://hackage.haskell.org/package/reflex-dom-core-0.6.1.0/docs/Foreign-JavaScript-Utils.html\" rel=\"nofollow noreferrer\">Foreign.JavaScript.Utils.bsToArrayBuffer</a>"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 4, "last_activity_date": 1493061538, "last_edit_date": 1493061538, "creation_date": 1492974026, "answer_id": 43575261, "question_id": 43571803, "link": "https://stackoverflow.com/questions/43571803/how-to-convert-a-bytestring-value-to-a-jsval/43575261#43575261", "title": "How to convert a ByteString value to a JSVal", "body": "<p><strong>Edit:</strong> Looks like my original answer was too GHC centric.  Added an untested fix that might work for GHCJS.</p>\n\n<p><strong>Edit #2:</strong> Added my <code>stack.yaml</code> file for the example.</p>\n\n<p>You can use <code>GHCJS.DOM.ImageData.newImageData</code> to construct the <code>ImageData</code> object.  It requires the data to be a <code>GHCJS.DOM.Types.Uint8ClampedArray</code> (which is a byte array in RGBA format).</p>\n\n<p>There are conversion functions in <code>GHCJS.Buffer</code> from <code>ByteString</code>s to <code>Buffer</code>s (via <code>fromByteString</code>) and from there to typed arrays (e.g., <code>getUint8Array</code>).  They do the conversion directly under GHCJS, and even under plain GHC they use a base64 conversion as an intermediary which should be pretty fast.  Unfortunately, the conversion function <code>getUint8ClampedArray</code> isn't included (and for plain GHC, it looks like <code>fromByteString</code> might be broken anyway -- in jsaddle 0.8.3.0, it's calling the wrong JavaScript helper function).</p>\n\n<p>For plain GHC, the following seems to work (the first line is copied from <code>fromByteString</code> with the helper renamed from the apparently incorrect <code>h$newByteArrayBase64String</code>):</p>\n\n<pre><code>uint8ClampedArrayFromByteString :: ByteString -&gt; GHCJSPure (Uint8ClampedArray)\nuint8ClampedArrayFromByteString bs = GHCJSPure $ do\n  buffer &lt;- SomeBuffer &lt;$&gt; jsg1 \"h$newByteArrayFromBase64String\"\n                                (decodeUtf8 $ B64.encode bs)\n  arrbuff &lt;- ghcjsPure (getArrayBuffer (buffer :: MutableBuffer))\n  liftDOM (Uint8ClampedArray &lt;$&gt; new (jsg \"Uint8ClampedArray\") [pToJSVal arrbuff])\n</code></pre>\n\n<p>Here is an untested GHCJS version that may work.  If they fix the above-mentioned jsaddle bug, it should work under plain GHC, too:</p>\n\n<pre><code>uint8ClampedArrayFromByteString :: ByteString -&gt; GHCJSPure (Uint8ClampedArray)\nuint8ClampedArrayFromByteString bs = GHCJSPure $ do\n  (buffer,_,_) &lt;- ghcjsPure (fromByteString bs)\n  buffer' &lt;- thaw buffer\n  arrbuff &lt;- ghcjsPure (getArrayBuffer buffer')\n  liftDOM (Uint8ClampedArray &lt;$&gt; new (jsg \"Uint8ClampedArray\") [pToJSVal arrbuff])\n</code></pre>\n\n<p>I don't have a running GHCJS installation, but here's a complete working example I tested using JSaddle+Warp under plain GHC which seems to work okay (i.e., if you point a browser at localhost:6868, it displays a 3x4 image on the canvas element):</p>\n\n<pre><code>module Main where\n\nimport Data.ByteString (ByteString)\nimport qualified Data.ByteString as BS\nimport Data.Text.Encoding (decodeUtf8)\nimport qualified Data.ByteString.Base64 as B64 (encode)\nimport Language.Javascript.JSaddle (js, js1, jss, jsg, jsg1,\n                                    new, pToJSVal, GHCJSPure(..), ghcjsPure, JSM,\n                                    fromJSVal, toJSVal, Object)\nimport Language.Javascript.JSaddle.Warp (run)\nimport JSDOM.Types (liftDOM, Uint8ClampedArray(..), RenderingContext(..))\nimport JSDOM.ImageData\nimport JSDOM.HTMLCanvasElement\nimport JSDOM.CanvasRenderingContext2D\nimport GHCJS.Buffer (getArrayBuffer, MutableBuffer)\nimport GHCJS.Buffer.Types (SomeBuffer(..))\nimport Control.Lens ((^.))\n\nmain :: IO ()\nmain = run 6868 $ do\n  let smallImage = BS.pack [0xff,0x00,0x00,0xff,  0xff,0x00,0x00,0xff,  0xff,0x00,0x00,0xff,\n                            0x00,0x00,0x00,0xff,  0x00,0xff,0x00,0xff,  0x00,0x00,0x00,0xff,\n                            0x00,0x00,0xff,0xff,  0x00,0x00,0xff,0xff,  0x00,0x00,0xff,0xff,\n                            0x00,0x00,0xff,0xff,  0x00,0x00,0x00,0xff,  0x00,0x00,0xff,0xff]\n  img &lt;- makeImageData 3 4 smallImage\n  doc &lt;- jsg \"document\"\n  doc ^. js \"body\" ^. jss \"innerHTML\" \"&lt;canvas id=c width=10 height=10&gt;&lt;/canvas&gt;\"\n  Just canvas &lt;- doc ^. js1 \"getElementById\" \"c\" &gt;&gt;= fromJSVal\n  Just ctx &lt;- getContext canvas \"2d\" ([] :: [Object])\n  let ctx' = CanvasRenderingContext2D (unRenderingContext ctx)\n  putImageData ctx' img 3 4\n  return ()\n\nuint8ClampedArrayFromByteString :: ByteString -&gt; GHCJSPure (Uint8ClampedArray)\nuint8ClampedArrayFromByteString bs = GHCJSPure $ do\n  buffer &lt;- SomeBuffer &lt;$&gt; jsg1 \"h$newByteArrayFromBase64String\"\n                                (decodeUtf8 $ B64.encode bs)\n  arrbuff &lt;- ghcjsPure (getArrayBuffer (buffer :: MutableBuffer))\n  liftDOM (Uint8ClampedArray &lt;$&gt; new (jsg \"Uint8ClampedArray\") [pToJSVal arrbuff])\n\nmakeImageData :: Int -&gt; Int -&gt; ByteString -&gt; JSM ImageData\nmakeImageData width height dat\n  = do dat' &lt;- ghcjsPure (uint8ClampedArrayFromByteString dat)\n       newImageData dat' (fromIntegral width) (Just (fromIntegral height))\n</code></pre>\n\n<p>To build this, I used the following <code>stack.yaml</code>:</p>\n\n<pre><code>resolver: lts-8.12\nextra-deps:\n- ghcjs-dom-0.8.0.0\n- ghcjs-dom-jsaddle-0.8.0.0\n- jsaddle-0.8.3.0\n- jsaddle-warp-0.8.3.0\n- jsaddle-dom-0.8.0.0\n- ref-tf-0.4.0.1\n</code></pre>\n"}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 0, "accepted_answer_id": 43574564, "answer_count": 3, "score": 4, "last_activity_date": 1493218218, "creation_date": 1492954179, "last_edit_date": 1493023952, "question_id": 43571803, "link": "https://stackoverflow.com/questions/43571803/how-to-convert-a-bytestring-value-to-a-jsval", "title": "How to convert a ByteString value to a JSVal", "body": "<p>In the module <em>GHCJS.DOM.JSFFI.Generated.CanvasRenderingContext2D</em> there is the function <code>putImageData</code> with the following type:</p>\n\n<pre><code>putImageData ::\n  Control.Monad.IO.Class.MonadIO m =&gt;\n  CanvasRenderingContext2D\n  -&gt; Maybe GHCJS.DOM.Types.ImageData -&gt; Float -&gt; Float -&gt; m ()\n</code></pre>\n\n<p>The second parameter has the type <code>Maybe GHCJS.DOM.Types.ImageData</code>.\nThis type is defined in the module <em>GHCJS.DOM.Types</em> as a newtype wrapper around a JSVal value:</p>\n\n<pre><code>newtype ImageData = ImageData {unImageData :: GHCJS.Prim.JSVal}\n</code></pre>\n\n<p>I have a value of type <code>ByteString</code> that has always 4 bytes with the RGBA values of each pixel. How to I convert my ByteString value to a GHCJS.Prim.JSVal?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 6, "last_activity_date": 1492952400, "creation_date": 1492952400, "answer_id": 43571483, "question_id": 43571368, "link": "https://stackoverflow.com/questions/43571368/parse-command-line-arguments/43571483#43571483", "title": "Parse command line arguments", "body": "<p>The list returned by <code>getArgs</code> will look like this: <code>[\"2\", \"10\", \"10\", \"[7,\", \"3,\", \"5,\", \"4,\", \"4]\"]</code>. The first three of those strings are valid string representations of integers, but the others are not. So when you use <code>read</code> on those, you'll get an error.</p>\n\n<p>The reason that you don't see an error when you calculate the length, is that <code>length</code> does not have to look at the values in the lists, so the <code>read</code>s are never evaluated.</p>\n\n<p>In order to sum the values, however, they definitely do need to be evaluated. So that's why you get an exception then.</p>\n\n<p>In order to fix your problem, you could either just change the format of the arguments to not include brackets and commas, or manually go through the arguments and remove the brackets and commas before you pass them to <code>read</code>.</p>\n\n<p>Another alternative would be to concatenate the later arguments together, separated by spaces, (so you end up with \"[7, 3, 5, 4, 4]\") and then pass that as a single string to <code>read</code> with type <code>[Integer]</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 7909153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000100456662/picture?type=large", "display_name": "Benjamin K&#246;nig", "link": "https://stackoverflow.com/users/7909153/benjamin-k%c3%b6nig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 43571483, "answer_count": 1, "score": 4, "last_activity_date": 1527817412, "creation_date": 1492951633, "last_edit_date": 1527817412, "question_id": 43571368, "link": "https://stackoverflow.com/questions/43571368/parse-command-line-arguments", "title": "Parse command line arguments", "body": "<p>I try to parse command line arguments in haskell. </p>\n\n<p>Below is a sample code:</p>\n\n<pre><code>import System.Environment\n\nwork :: [Integer] -&gt; Int\nwork (s:r:t:es) = length es\n\nmain :: IO ()\nmain = getArgs &gt;&gt;= putStrLn . show . work . (map read)\n</code></pre>\n\n<p>I execute it with:</p>\n\n<pre><code>./test 2 10 10 [7, 3, 5, 4, 4]\n</code></pre>\n\n<p>The output is 5 like expected.\nBut if I replace length with sum and Int with Integer the execution raises the error</p>\n\n<pre><code>test: Prelude.read: no parse\n</code></pre>\n\n<p>Can someone explain how to do this?</p>\n"}, {"tags": ["haskell", "ghcjs"], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1492979922, "creation_date": 1492951087, "last_edit_date": 1492979922, "question_id": 43571261, "link": "https://stackoverflow.com/questions/43571261/does-ghcjs-support-hot-code-reloading", "title": "Does GHCjs support hot code reloading?", "body": "<p>Couldn't find the answer on google. </p>\n\n<p>Something like <a href=\"https://github.com/bhauman/lein-figwheel\" rel=\"nofollow noreferrer\">https://github.com/bhauman/lein-figwheel</a> which is for Clojurescript.</p>\n"}, {"tags": ["haskell", "integer", "average"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1492956226, "post_id": 43571167, "comment_id": 74193872, "body": "<code>(sum m) quot 6</code> means &quot;take <code>sum</code> and apply it to <code>m</code>, then take the resulting function and apply it to <code>quot</code>, and then take the resulting function and apply it to <code>6</code>&quot;. It is the same as <code>sum m quot 6</code>. However, <code>sum m</code> does not return a function, so a type error is raised."}], "answers": [{"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 5, "last_activity_date": 1492951457, "creation_date": 1492951457, "answer_id": 43571327, "question_id": 43571167, "link": "https://stackoverflow.com/questions/43571167/why-isnt-this-function-to-calculate-the-average-of-an-integer-list-not-working/43571327#43571327", "title": "Why isn&#39;t this function to calculate the average of an integer list not working?", "body": "<p>You need backticks around <code>quot</code>, or write it first</p>\n\n<pre><code>sum m `quot` 6\nquot (sum m) 6\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": false, "score": 0, "last_activity_date": 1493301786, "creation_date": 1493301786, "answer_id": 43660110, "question_id": 43571167, "link": "https://stackoverflow.com/questions/43571167/why-isnt-this-function-to-calculate-the-average-of-an-integer-list-not-working/43660110#43660110", "title": "Why isn&#39;t this function to calculate the average of an integer list not working?", "body": "<p>In Haskell we write the function name before the arguments. For <em>quot</em> you write:</p>\n\n<pre><code>quot 17 2\n</code></pre>\n\n<p>So in your case:</p>\n\n<pre><code>quot (sum m) 6\n</code></pre>\n\n<p>Haskell has some sytactic sugar that allows you to write functions in so called <em>infix</em> notation. This is what user mb14 refers to.</p>\n"}], "owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1493301786, "creation_date": 1492950531, "question_id": 43571167, "link": "https://stackoverflow.com/questions/43571167/why-isnt-this-function-to-calculate-the-average-of-an-integer-list-not-working", "title": "Why isn&#39;t this function to calculate the average of an integer list not working?", "body": "<p>I'm trying to make a function which adds up all the numbers from a given list and then divides it by 6.</p>\n\n<pre><code>average :: [Integer] -&gt; Integer\naverage m = (sum m) quot 6\n</code></pre>\n\n<p>But this is the error message I'm receiving:</p>\n\n<pre><code>Couldn't match type `Integer'                                                                                \n              with `(a0 -&gt; a0 -&gt; a0) -&gt; a1 -&gt; Integer'                                                       \nExpected type: [(a0 -&gt; a0 -&gt; a0) -&gt; a1 -&gt; Integer]                                                           \n  Actual type: [Integer]                                                                                     \nIn the first argument of `sum', namely `m'                                                                   \nIn the expression: (sum m) quot 6\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "currying", "deriving"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1492947378, "post_id": 43570615, "comment_id": 74190855, "body": "You need <code>. takeWhile (&#47;=&#39;,&#39;)</code> don&#39;t you?"}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1492955965, "last_edit_date": 1492955965, "creation_date": 1492953360, "answer_id": 43571652, "question_id": 43570615, "link": "https://stackoverflow.com/questions/43570615/writing-a-proper-custom-read-instance/43571652#43571652", "title": "Writing a proper custom read instance", "body": "<p>There are a bunch of errors in your code - I think you should read up a bit on the difference between <code>$</code> and <code>.</code> it is an essential thing to know when handling functions, most of your errors are due to a try to apply a function to its argument <code>($)</code> instead of concatenating functions <code>(.)</code>.</p>\n\n<p>This is what I modified your code to at least type check - though I think <code>readsPrec</code> should not keep the original input but the remaining string after the parsing is done.</p>\n\n<h2>Fixing the code</h2>\n\n<pre><code>instance Read Position where\n  readsPrec _ input =\n      let absc = filter (/='(') . takeWhile (/=',')\n          ordn = filter (/=')') . tail . dropWhile (/=',')\n       in [(Position ( read (absc input) :: Int\n                     , read (ordn input) :: Int), input)]\n</code></pre>\n\n<p>But seeing this makes me unhappy - isn't haskell said to be abstract, slick and really expressive. Let us give it another try</p>\n\n<h2>tidying up</h2>\n\n<pre><code>instance Read Position where\n  readsPrec _ str = let ('(':absc,',':ordn') = break (==',') str\n                        (ordn,')':str') = break (==')') ordn'\n                     in [(Position (read absc, read ordn), str')]\n</code></pre>\n\n<p>much better, we capture that there should be the parens at the beginning and the end, but still a bit cumbersome.</p>\n\n<h2>using existing functionality</h2>\n\n<p>Knowing that <code>Tuple</code>s are already instances of <code>Read</code></p>\n\n<pre><code>instance Read Position where\n  readsPrec s str = [(Position x, rest) | (x,rest) &lt;- readsPrec s str]\n</code></pre>\n\n<h2>nice but still we can do better</h2>\n\n<p>Say we recently worked a bit with tuples and found the very handy module <code>Data.Bifunctor</code> that has functions <code>first</code> and <code>second</code> to transform the first and second component of a 2-tuple (any bifunctor in fact).</p>\n\n<p>We can simplify the above to</p>\n\n<pre><code>instance Read Position where\n  readsPrec s = map (first Position) . readsPrec s\n</code></pre>\n\n<p>clean and short.</p>\n"}, {"tags": [], "owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "is_accepted": false, "score": 0, "last_activity_date": 1492959946, "creation_date": 1492959946, "answer_id": 43572770, "question_id": 43570615, "link": "https://stackoverflow.com/questions/43570615/writing-a-proper-custom-read-instance/43572770#43572770", "title": "Writing a proper custom read instance", "body": "<p>Using <code>show \"(3,4)\"::Position</code> returns <code>Position (3,4)</code>.\nThank you very much for your detailed answer. I tend to confuse <code>$</code> and <code>.</code> notation, but after I went through the documentation, it became clear.</p>\n"}], "owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 43571652, "answer_count": 2, "score": 0, "last_activity_date": 1492959946, "creation_date": 1492947256, "last_edit_date": 1495541392, "question_id": 43570615, "link": "https://stackoverflow.com/questions/43570615/writing-a-proper-custom-read-instance", "title": "Writing a proper custom read instance", "body": "<p>Hello fellow Haskellers,</p>\n\n<p>I am learning Haskell from one month now, and I am struggling in creating a custom read instance for a personnal data type.</p>\n\n<p>I followed <a href=\"https://stackoverflow.com/questions/14006707/making-a-read-instance-in-haskell\" title=\"this\">this</a> and the <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#derived-instances\" rel=\"nofollow noreferrer\">relevant chapter in Learn Yourself a Haskell</a>, here is my code snippet.    </p>\n\n<pre><code>data Position      =  Position (Absc,Ordn) deriving (Show)\ninstance Read (Position) where\nreadsPrec _ input =\n    let absc = List.filter (/='(') $ takeWhile (/=',')\n        ordn = List.filter (/=')') $ tail (dropWhile (/=',') )\n    in (\\str -&gt; Position ( (read (absc str) :: Int)\n                       , (read (ordn str) :: Int) ) ) input\ntype Absc = Int\ntype Ordn = Int\n</code></pre>\n\n<p>My goal is to parse an input <code>\"(1,3)\"</code> to output something like <code>Position (1,3)</code></p>\n\n<p>I, however, get the following error messages:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018[Char]\u2019\n              with actual type \u2018[Char] -&gt; [Char]\u2019\n\u2022 Probable cause: \u2018takeWhile\u2019 is applied to too few arguments\n  In the second argument of \u2018($)\u2019, namely \u2018takeWhile (/= ',')\u2019\n  In the expression: filter (/= '(') $ takeWhile (/= ',')\n  In an equation for \u2018absc\u2019:\n      absc = filter (/= '(') $ takeWhile (/= ',')\n</code></pre>\n\n<p>Same for the ordn function.</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018[(Position, String)]\u2019\n              with actual type \u2018Position\u2019\n\u2022 In the expression:\n    (\\ str\n       -&gt; Position ((read (absc str) :: Int), (read (ordn str) :: Int)))\n      input\n  In the expression:\n    let\n      absc = filter (/= '(') $ takeWhile (/= ',')\n      ordn = filter (/= ')') $ tail (dropWhile (/= ','))\n    in\n      (\\ str\n         -&gt; Position ((read (absc str) :: Int), (read (ordn str) :: Int)))\n        input\n  In an equation for \u2018readsPrec\u2019:\n      readsPrec _ input\n        = let\n            absc = filter (/= '(') $ takeWhile (/= ',')\n            ordn = filter (/= ')') $ tail (dropWhile (/= ','))\n          in\n            (\\ str\n               -&gt; Position ((read (absc str) :: Int), (read (ordn str) :: Int)))\n              input\n</code></pre>\n\n<p>It seems that my <code>let</code> statement does not recognize <code>absc</code> and <code>ordn</code> as functions (or at least try to apply them directly, while I only want to define them as partially applied functions to apply them later at parameter <code>str</code>). I am also probably messing up with my <code>Position</code> value constructor.</p>\n\n<p>I am not familiar with Haskell coding style, and I may have used some keywords and tools that I do not fully understand. Could you hint me on how to write this to make it work? </p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1492949072, "post_id": 43570129, "comment_id": 74191399, "body": "Are you compiling (?) with optimizations? Also if I remember correctly i bytestring is faster than bytestring.char8. though I do not know the challenge, usually it is better to consume input while transforming it compared to reading and then  applying\u200b some function"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1492949484, "post_id": 43570129, "comment_id": 74191522, "body": "Also did you look at attoparsec?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492951019, "post_id": 43570129, "comment_id": 74192019, "body": "How do you arrive at 60 seconds? On my machine your code executes in about 0.3 seconds (compiled with <code>ghc -O0</code>)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1492954457, "post_id": 43570129, "comment_id": 74193256, "body": "FTR, it&#39;s rather insane to ever create a file with 200k integers in decimal, string form, in the first place. That&#39;s an amount you very definitely want to store in binary form."}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1492970484, "post_id": 43570129, "comment_id": 74199361, "body": "@epsilonhalbe: Don&#39;t know, how &quot;hackerearth&quot; compiles my code. Do you have any example for optimizations?"}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492970493, "post_id": 43570129, "comment_id": 74199364, "body": "@n.m.: Reproduced the timings on local machines as well. Maybe your code didn&#39;t do anything with the values, e.g. summing them?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492974947, "post_id": 43570129, "comment_id": 74200913, "body": "Did sum the values and print the sum."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1492975087, "post_id": 43570129, "comment_id": 74200962, "body": "It sounds like your problem is with &#39;hackerearth&#39;.  If you&#39;re performance concerned you always want to be compiling and using optimizations.  Shelling out to some site is no exceptional case."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492975348, "post_id": 43570129, "comment_id": 74201050, "body": "Repeated the test on my other machine. 0.1s including summation and printing the sum. Verified the sum is correct. What version of ghc and what compilation command are you using?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492976894, "post_id": 43570129, "comment_id": 74201607, "body": "Here it is <a href=\"http://www.tutorialspoint.com/compile_haskell_online.php?PID=0Bw_CjBb95KQMR3I0MS1xTzFsTmc\" rel=\"nofollow noreferrer\">online</a>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1493161105, "post_id": 43570129, "comment_id": 74293635, "body": "I can confirm @n.m.&#39;s results.  Your <code>Char8</code>-based implementation should be on par with a <code>scanf</code>-based C implementation. (My tests reading and summing 10 million 6-digit integers ran in 1.3 secs in C, 2.2 secs in Haskell w/ GHC 8.0.1, and only 0.6 secs in Haskell with a strict version of <code>sum</code>.  HackerEarth&#39;s old version of GHC (7.6.3) is likely to be slower, but not &quot;60 seconds&quot; slower.  You may wish to post a complete code example that illustrates the problem, and maybe we can help."}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1493199056, "post_id": 43570129, "comment_id": 74308651, "body": "I got word from HackerEarth that they had issues with their platform, so everything ran very slow. Now it&#39;s running perfectly again. But back to my question: Is this really the fastest way to read huge lines with ints?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1493307697, "creation_date": 1493307697, "answer_id": 43662277, "question_id": 43570129, "link": "https://stackoverflow.com/questions/43570129/what-is-the-fastest-way-to-parse-line-with-lots-of-ints/43662277#43662277", "title": "What is the fastest way to parse line with lots of Ints?", "body": "<p>It's always difficult to declare a particular approach \"the fastest\", since there's almost always some way to squeeze out more performance.  However, an approach using <code>Data.ByteString.Char8</code> and the general method you suggest should be among the fastest methods for reading numbers.  If you encounter a case where performance is poor, the problem likely lies elsewhere.</p>\n\n<p>To give some concrete results, I generated a 191Meg file of 20 million 9-digit numbers, space-separate on a single line.  I then tried several general methods of reading a line of numbers and printing their sum (which, for the record, was 10999281565534666).  The obvious approach using <code>String</code>:</p>\n\n<pre><code>reader :: IO [Int]\nreader = map read . words &lt;$&gt; getLine\nsum' xs = sum xs -- work around GHC ticket 10992\nmain = print =&lt;&lt; sum' &lt;$&gt; reader\n</code></pre>\n\n<p>took 52secs; a similar approach using <code>Text</code>:</p>\n\n<pre><code>import qualified Data.Text as T\nimport qualified Data.Text.IO as T\nimport qualified Data.Text.Read as T\nreadText = map parse . T.words &lt;$&gt; T.getLine\n  where parse s = let Right (n, _) = T.decimal s in n\n</code></pre>\n\n<p>ran in 2.4secs (but note that it would need to be modified to handle negative numbers!); and the same approach using <code>Char8</code>:</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as C\nreadChar8 :: IO [Int]\nreadChar8 = map parse . C.words &lt;$&gt; C.getLine\n  where parse s = let Just (n, _) = C.readInt s in n\n</code></pre>\n\n<p>ran in 1.4secs.  All examples were compiled with <code>-O2</code> on GHC 8.0.2.</p>\n\n<p>As a comparison benchmark, a <code>scanf</code>-based C implementation:</p>\n\n<pre><code>/* GCC 5.4.0 w/ -O3 */\n#include &lt;stdio.h&gt;  \nint main()\n{\n    long x, acc = 0;\n    while (scanf(\" %ld\", &amp;x) == 1) {\n        acc += x;\n    }\n    printf(\"%ld\\n\", acc);\n    return 0;\n}\n</code></pre>\n\n<p>ran in about 2.5secs, on par with the <code>Text</code> implementation.</p>\n\n<p>You can squeeze a bit more performance out of the <code>Char8</code> implementation.  Using a hand-rolled parser:</p>\n\n<pre><code>readChar8' :: IO [Int]\nreadChar8' = parse &lt;$&gt; C.getLine\n  where parse = unfoldr go\n        go s = do (n, s1) &lt;- C.readInt s\n                  let s2 = C.dropWhile C.isSpace s1\n                  return (n, s2)\n</code></pre>\n\n<p>runs in about 0.9secs -- I haven't tried to determine why there's a difference, but the compiler must be missing an opportunity to perform some optimization of the <code>words</code>-to-<code>readInt</code> pipeline.</p>\n\n<h3>Haskell Code for Reference</h3>\n\n<p>Make some numbers with Numbers.hs:</p>\n\n<pre><code>-- |Generate 20M 9-digit numbers:\n--    ./Numbers 20000000 100000000 999999999 &gt; data1.txt\n\nimport qualified Data.ByteString.Char8 as C\nimport Control.Monad\nimport System.Environment\nimport System.Random\n\nmain :: IO ()\nmain = do [n, a, b] &lt;- map read &lt;$&gt; getArgs\n          nums &lt;- replicateM n (randomRIO (a,b))\n          let _ = nums :: [Int]\n          C.putStrLn (C.unwords (map (C.pack . show) nums))\n</code></pre>\n\n<p>Find their sum with Sum.hs:</p>\n\n<pre><code>import Data.List\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as T\nimport qualified Data.Text.Read as T\nimport qualified Data.Char8 as C\nimport qualified Data.ByteString.Char8 as C\nimport System.Environment\n\n-- work around https://ghc.haskell.org/trac/ghc/ticket/10992\nsum' xs = sum xs\n\nreadString :: IO [Int]\nreadString = map read . words &lt;$&gt; getLine\n\nreadText :: IO [Int]\nreadText = map parse . T.words &lt;$&gt; T.getLine\n  where parse s = let Right (n, _) = T.decimal s in n\n\nreadChar8 :: IO [Int]\nreadChar8 = map parse . C.words &lt;$&gt; C.getLine\n  where parse s = let Just (n, _) = C.readInt s in n\n\nreadHand :: IO [Int]\nreadHand = parse &lt;$&gt; C.getLine\n  where parse = unfoldr go\n        go s = do (n, s1) &lt;- C.readInt s\n                  let s2 = C.dropWhile C.isSpace s1\n                  return (n, s2)\n\nmain = do [method] &lt;- getArgs\n          let reader = case method of\n                \"string\" -&gt; readString\n                \"text\"   -&gt; readText\n                \"char8\"  -&gt; readChar8\n                \"hand\"   -&gt; readHand\n          print =&lt;&lt; sum' &lt;$&gt; reader\n</code></pre>\n\n<p>where:</p>\n\n<pre><code>./Sum string &lt;data1.txt   # 54.3 secs\n./Sum text   &lt;data1.txt   # 2.29 secs\n./Sum char8  &lt;data1.txt   # 1.34 secs\n./Sum hand   &lt;data1.txt   # 0.91 secs\n</code></pre>\n"}], "owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 0, "accepted_answer_id": 43662277, "answer_count": 1, "score": 4, "last_activity_date": 1493307697, "creation_date": 1492944312, "last_edit_date": 1492962306, "question_id": 43570129, "link": "https://stackoverflow.com/questions/43570129/what-is-the-fastest-way-to-parse-line-with-lots-of-ints", "title": "What is the fastest way to parse line with lots of Ints?", "body": "<p>I'm learning Haskell for two years now and I'm still confused, whats the best (fastest) way to read tons of numbers from a single input line.\nFor learning I registered into hackerearth.com trying to solve every challenge in Haskell. But now I'm stuck with a challenge because I run into timeout issues. My program is just too slow for beeing accepted by the site.</p>\n\n<p>Using the profiler I found out it takes 80%+ of the time for parsing a line with lots of integers. The percentage gets even higher when the number of values in the line increases.</p>\n\n<p>Now this is the way, I'm reading numbers from an input line:</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as C8\n\nmain = do\n   scores &lt;- fmap (map (fst . fromJust . C8.readInt) . C8.words) C8.getLine :: IO [Int]\n</code></pre>\n\n<p>Is there any way to get the data faster into the variable?</p>\n\n<p>BTW: The biggest testcase consist of a line with 200.000 9-digits values. Parsing takes incredible long (> 60s).</p>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1492944763, "post_id": 43569721, "comment_id": 74190090, "body": "Is there a lot of disk activity in your code? I&#39;d expect writing to two files in parallel to be slower than doing so sequentially, at least for HDDs which have a seek time cost for every non sequential access."}, {"owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1492947112, "post_id": 43569721, "comment_id": 74190759, "body": "@chi Every <code>upsample</code> call reads the contents of the file into memory and writes the result to a new file. The files are 12MB in size."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1492955466, "post_id": 43569721, "comment_id": 74193595, "body": "If it&#39;s most CPU time, it looks weird indeed. Can you confirm both processors are used using some CPU monitor?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1493004599, "post_id": 43569721, "comment_id": 74208252, "body": "@chi Sequential access is many orders of magnitude faster than random access, even for solid state disks. In fact, sequential access is about an order of magnitude faster for RAM as compared to random access. Interestingly, sequential access of hard disks (not solid state) is faster than solid state sequential access (by a small factor) and comparable to random access of RAM(!) <a href=\"http://queue.acm.org/detail.cfm?id=1563874\" rel=\"nofollow noreferrer\">This</a> is circa 2009 but I imagine the general state of affairs hasn&#39;t changed much."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1493577886, "creation_date": 1493577886, "answer_id": 43710048, "question_id": 43569721, "link": "https://stackoverflow.com/questions/43569721/worse-forconcurrently-performance-than-sequential/43710048#43710048", "title": "Worse forConcurrently performance than sequential", "body": "<p>Here are a couple of possibilities.  First, make yourself 100% sure you're actually running your program with <code>+RTS -N2 -RTS</code>.  I can't tell you how many times I've been benchmarking a parallel program and written:</p>\n\n<pre><code>stack exec myprogram +RTS -N2 -RTS\n</code></pre>\n\n<p>in place of:</p>\n\n<pre><code>stack exec myprogram -- +RTS -N2 -RTS\n</code></pre>\n\n<p>and gotten myself hopelessly confused.  (The first version runs the <strong>stack executable</strong> on two processors but the target executable on one!)  Maybe add a <code>print $ getNumCapabilities</code> at the beginning of your <code>main</code> program to be sure.</p>\n\n<p>After confirming you're running on two processors, then the next most likely issue is that your implementation is not running in constant space and is blowing up the heap.  Here's a simple test program I used to try to duplicate your problem.  (Feel free to use my awesome upsampling filter yourself!)</p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent.Async\nimport System.Environment\nimport qualified Data.ByteString as B\n\nupsample :: FilePath -&gt; IO ()\nupsample fp = do c &lt;- B.readFile fp\n                 let c' = B.pack $ concatMap (replicate 4) $ B.unpack c\n                 B.writeFile (fp ++ \".out\") c'\n\nupsampleFiles :: [FilePath] -&gt; IO ()\nupsampleFiles files = do\n  forConcurrently_ files $ upsample\n\nmain :: IO ()\nmain = upsampleFiles =&lt;&lt; getArgs   -- sample all file on command line\n</code></pre>\n\n<p>When I ran this on a single 70meg test file, it ran in 14 secs.  When I ran it on two copies in parallel, it ran for more than a minute before it started swapping like mad, and I had to kill it.  After switching to:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as B\n</code></pre>\n\n<p>it ran in 3.7 secs on a single file, 7.8 secs on two copies on a single processor, and 4.0 secs on two copies on two processors with <code>+RTS -N2</code>.</p>\n\n<p>Make sure you're compiling with optimzations on, profile your program, and make sure it's running in a constant (or at least reasonable) heap space.  The above program runs in a constant 100k bytes of heap.  A similar version that uses a strict <code>ByteString</code> for reading and a lazy <code>ByteString</code> for writing reads the whole file into memory, but the heap almost immediately grows to 70megs (the size of the file) within a fraction of a second and then stays constant while the file is processed.</p>\n\n<p>No matter how complicated your filter is, if your program is growing gigabytes of heap, the implementation is broken, and you'll need to fix it before you worry about performance, parallel or otherwise.</p>\n"}], "owner": {"reputation": 303, "user_id": 4173209, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/caf52eb0e43490cabe3bb0cc1f850dfc?s=128&d=identicon&r=PG&f=1", "display_name": "Valerie94", "link": "https://stackoverflow.com/users/4173209/valerie94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1493577886, "creation_date": 1492941799, "question_id": 43569721, "link": "https://stackoverflow.com/questions/43569721/worse-forconcurrently-performance-than-sequential", "title": "Worse forConcurrently performance than sequential", "body": "<p>I've written a function that up-samples a file from 48kHz to 192kHz by means of a filter:</p>\n\n<pre><code>upsample :: Coefficients -&gt; FilePath -&gt; IO ()\n</code></pre>\n\n<p>It takes the filter coefficients, the path of the file (that has to be upsamples) and writes the result to a new file. </p>\n\n<p>I have to up-sample many files so I've written a function to up-sample a full directory in parallel, using <code>forConcurrently_</code> from <code>Control.Concurrent.Async</code>:</p>\n\n<pre><code>upsampleDirectory :: Directory -&gt; FilePath -&gt; IO ()\nupsampleDirectory dir coefPath = do\n  files &lt;- getAllFilesFromDirectory dir\n  coefs &lt;- loadCoefficients coefPath\n  forConcurrently_ files $ upsample coefs\n</code></pre>\n\n<p>I'm compiling with the <code>-threaded</code> option and running using <code>+RTS -N2</code>. What I see is that up-sampling 2 files sequentially is faster than up-sampling both files in parallel. </p>\n\n<p>Upsampling <code>file1.wav</code> takes 18.863s.\nUpsampling <code>file2.wav</code> takes 18.707s.\nUpsampling a directory with <code>file1.wav</code> and <code>file2.wav</code> takes 66.250s. </p>\n\n<p>What am I doing wrong? </p>\n\n<p>I've tried to keep this post concise, so ask me if you need more details on some of the functions. </p>\n"}, {"tags": ["haskell", "leksah"], "answers": [{"tags": [], "owner": {"reputation": 37, "user_id": 4369454, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b6f3e6c00c1a4a5f983f5a27deac5428?s=128&d=identicon&r=PG&f=1", "display_name": "veeco", "link": "https://stackoverflow.com/users/4369454/veeco"}, "is_accepted": true, "score": 0, "last_activity_date": 1493385252, "creation_date": 1493385252, "answer_id": 43681130, "question_id": 43568578, "link": "https://stackoverflow.com/questions/43568578/haskell-gui-application-runs-from-leksah-but-crashes-when-exe-invoked-from-com/43681130#43681130", "title": "Haskell GUI application runs from Leksah, but crashes when .exe invoked from command line", "body": "<p>I got this answer from Hamishmack here: <a href=\"https://github.com/leksah/leksah/issues/442\" rel=\"nofollow noreferrer\">https://github.com/leksah/leksah/issues/442</a> :</p>\n\n<p>Add leksah's bin directory to your <code>PATH</code> before launching the <code>.exe</code>. Something like:</p>\n\n<pre><code>set PATH=%PATH%;C:\\Leksah\\bin\n</code></pre>\n\n<p>Alternatively copy the missing DLL files from the <code>C:\\Leksah\\bin</code> directory into the same directory as your <code>.exe</code> file.</p>\n"}], "owner": {"reputation": 37, "user_id": 4369454, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b6f3e6c00c1a4a5f983f5a27deac5428?s=128&d=identicon&r=PG&f=1", "display_name": "veeco", "link": "https://stackoverflow.com/users/4369454/veeco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 43681130, "answer_count": 1, "score": 0, "last_activity_date": 1493385252, "creation_date": 1492932961, "question_id": 43568578, "link": "https://stackoverflow.com/questions/43568578/haskell-gui-application-runs-from-leksah-but-crashes-when-exe-invoked-from-com", "title": "Haskell GUI application runs from Leksah, but crashes when .exe invoked from command line", "body": "<p>When I <em>Run</em> the minimalistic program (listed below) from the Leksah IDE (version 0.16.2.2, on Win 7 64-bit system) the window opens correctly. But when the exe-file generated by Leksah is launched from the command line, some other window opens instead with the following message:</p>\n\n<p><em>Entry Point Not Found<br/>\nThe procedure entry point pthread_cond_timedwait_relative_np could not be located in the dynamic link library libwinpthread-1.dll.</em></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Graphics.UI.Gtk\n\nmain = do\n   initGUI\n   window &lt;- windowNew\n   widgetShowAll window\n   mainGUI\n</code></pre>\n\n<p>(To build this code in Leksah, the package-related cabal file has to also contain <code>gtk3 -any</code> in the <em>build-depends</em> section.)</p>\n"}, {"tags": ["haskell", "exception", "try-catch"], "answers": [{"tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": true, "score": 3, "last_activity_date": 1492922852, "creation_date": 1492922852, "answer_id": 43567486, "question_id": 43567192, "link": "https://stackoverflow.com/questions/43567192/how-to-use-catchioerror-as-catch/43567486#43567486", "title": "How to use catchIOError as catch?", "body": "<p>Use a type annotation:</p>\n\n<pre><code>(catch :: IO a -&gt; (IOError -&gt; IO a) -&gt; IO a) (readFile \"test\") (\\_ -&gt; return \"\")\n</code></pre>\n"}], "owner": {"reputation": 308, "user_id": 4179776, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-wqk14GQWaLA/AAAAAAAAAAI/AAAAAAAAARM/3nqY7GWkbTk/photo.jpg?sz=128", "display_name": "Vonfry", "link": "https://stackoverflow.com/users/4179776/vonfry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 43567486, "answer_count": 1, "score": 0, "last_activity_date": 1492962238, "creation_date": 1492919612, "last_edit_date": 1492962238, "question_id": 43567192, "link": "https://stackoverflow.com/questions/43567192/how-to-use-catchioerror-as-catch", "title": "How to use catchIOError as catch?", "body": "<p>I find the definition in source code.</p>\n\n<pre><code>catchIOError :: IO a -&gt; (IOError -&gt; IO a) -&gt; IO a\ncatchIOError = catch\n</code></pre>\n\n<p>If I want use <code>catch</code> instead of <code>catchIOError</code> with the same result, how could I do?</p>\n\n<pre><code>catchIOError (readFile \"test\") (\\_ -&gt; return \"\")\n</code></pre>\n\n<p>and use it like:</p>\n\n<pre><code>catch (readFile \"test\") (\\_ -&gt; return \"\")\n</code></pre>\n\n<p>It'll be throw an exception about variable type</p>\n\n<pre><code>Ambiguous type variable \u2018e0\u2019 arising from a use of \u2018catch\u2019\nprevents the constraint \u2018(Exception e0)\u2019 from being solved.\nProbable fix: use a type annotation to specify what \u2018e0\u2019 should be.\n</code></pre>\n\n<p>In other word, is there a way to limit the type without defining a new function.</p>\n"}, {"tags": ["haskell", "typeclass", "recursion-schemes"], "answers": [{"comments": [{"owner": {"reputation": 1410, "user_id": 846389, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9c5c3b395c30ab444a71bd0d52ddd73c?s=128&d=identicon&r=PG", "display_name": "Ian Macalinao", "link": "https://stackoverflow.com/users/846389/ian-macalinao"}, "edited": false, "score": 0, "creation_date": 1492926148, "post_id": 43567126, "comment_id": 74185844, "body": "Thanks. Excuse my ignorance, but how would I invoke a template Haskell script? Also, it looks like deriving-compat is a compat library-- would I need to use this if I&#39;m on the latest version of GHCi?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1410, "user_id": 846389, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9c5c3b395c30ab444a71bd0d52ddd73c?s=128&d=identicon&r=PG", "display_name": "Ian Macalinao", "link": "https://stackoverflow.com/users/846389/ian-macalinao"}, "edited": false, "score": 2, "creation_date": 1492947671, "post_id": 43567126, "comment_id": 74190949, "body": "Add <code>{-# LANGUAGE TemplateHaskell #-}</code> at the top of your file, import <code>Text.Show.Deriving</code>, add <code>$(deriveShow1 &#39;&#39;ExprF)</code> next to your data declaration. <code>deriving-compat</code> is more than a simple compat library, as the functionality provided by <code>deriveShow1</code> for instance can not be found anywhere else at the moment, even on the latest GHC."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1527328074, "post_id": 43567126, "comment_id": 88094065, "body": "Just a question, where did <code>Show1</code> come from? I can&#39;t find any documentation about this aspect of Haskell."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1527341330, "post_id": 43567126, "comment_id": 88097634, "body": "Sorry, I don&#39;t know a good reference about this. <code>Show1</code> and similar classes as they appear in <code>base</code> originally came from <code>transformers</code> a major user of higher-kinded types, which motivated those classes."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 12, "last_activity_date": 1492918924, "creation_date": 1492918924, "answer_id": 43567126, "question_id": 43567005, "link": "https://stackoverflow.com/questions/43567005/no-instance-for-data-functor-classes-show1-exprf/43567126#43567126", "title": "No instance for (Data.Functor.Classes.Show1 ExprF)", "body": "<p>The instance of <code>Show</code> for <code>Fix</code> is: <code>Show1 f =&gt; Show (Fix f)</code>, which is why the compiler expects <code>Show1 ExprF</code>.</p>\n\n<p><code>Show1</code> can be found in base under <code>Data.Functor.Classes</code>, and there is a TH script to derive it in <a href=\"https://hackage.haskell.org/package/deriving-compat-0.3.6/docs/Text-Show-Deriving.html\" rel=\"noreferrer\"><code>Text.Show.Deriving</code></a> from deriving-compat.</p>\n"}], "owner": {"reputation": 1410, "user_id": 846389, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9c5c3b395c30ab444a71bd0d52ddd73c?s=128&d=identicon&r=PG", "display_name": "Ian Macalinao", "link": "https://stackoverflow.com/users/846389/ian-macalinao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 802, "favorite_count": 1, "accepted_answer_id": 43567126, "answer_count": 1, "score": 7, "last_activity_date": 1492918924, "creation_date": 1492917435, "question_id": 43567005, "link": "https://stackoverflow.com/questions/43567005/no-instance-for-data-functor-classes-show1-exprf", "title": "No instance for (Data.Functor.Classes.Show1 ExprF)", "body": "<p>I've written a small program to find the prime factorization of a number. Everything seems to compile except for the <code>main</code> function, which complains about not being able to find a <code>Show1</code> instance.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\nmodule FactorAnamorphism where\n\nimport Data.Functor.Foldable\nimport Data.List\n\nnextPrimeFactor :: Integer -&gt; Maybe Integer\nnextPrimeFactor n = find (\\x -&gt; n `mod` x /= 0) [2..(floor $ sqrt $ fromIntegral n)]\n\ndata ExprF r = FactorF Integer | MultF r r deriving (Show, Functor)\ntype Expr = Fix ExprF\n\nfactor :: Integer -&gt; Expr\nfactor = ana coAlg where\n  coAlg fac = case (nextPrimeFactor fac) of\n    Just prime -&gt; MultF prime (fac `div` prime)\n    Nothing    -&gt; FactorF fac\n\nmain :: IO ()\nmain = putStrLn $ show $ factor 10\n</code></pre>\n\n<p>Logs:</p>\n\n<pre><code> % stack build\nhaskell-playground-0.1.0.0: build (lib + exe)\nPreprocessing library haskell-playground-0.1.0.0...\nPreprocessing executable 'factor-anamorphism' for\nhaskell-playground-0.1.0.0...\n[1 of 1] Compiling FactorAnamorphism ( app/FactorAnamorphism.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/factor-anamorphism/factor-anamorphism-tmp/FactorAnamorphism.o )\n\n/Users/ian/proj/macalinao/haskell-playground/app/FactorAnamorphism.hs:22:19: error:\n    \u2022 No instance for (Data.Functor.Classes.Show1 ExprF)\n        arising from a use of \u2018show\u2019\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018show $ factor 10\u2019\n      In the expression: putStrLn $ show $ factor 10\n      In an equation for \u2018main\u2019: main = putStrLn $ show $ factor 10\n\n--  While building package haskell-playground-0.1.0.0 using:\n      /Users/ian/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.24.2.0 build lib:haskell-playground exe:factor-anamorphism exe:haskell-playground-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n"}, {"tags": ["algorithm", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1492918090, "post_id": 43566703, "comment_id": 74184462, "body": "That&#39;s not the best way to check only up to the square root, since it has to loop through <code>2..n</code> and repeatedly immediately discard every number from <code>sqrt n..n</code>. Discarding all those numbers takes a lot of time. The code in the question deals with only half the numbers this does."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1492919797, "last_edit_date": 1492919797, "creation_date": 1492913679, "answer_id": 43566703, "question_id": 43566635, "link": "https://stackoverflow.com/questions/43566635/test-if-an-integer-is-prime/43566703#43566703", "title": "Test if an integer is prime", "body": "<p>here it's using the fact that the smallest prime factor of an integer is 2, so the largest can be at most n/2.</p>\n\n<p>A better algorithm will check numbers up to sqrt(n) to find whether there is a factor or not.</p>\n\n<p>something like this </p>\n\n<pre><code>prime n = null [ k | k &lt;- [2..n], k*k &lt;= n, mod n k == 0 ]\n</code></pre>\n\n<p>though you need to handle <code>1</code> as a special case as non prime</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>to short circuit the check between sqrt(n) to n for prime numbers, this might be a better approach</p>\n\n<pre><code>prime n = null [ k | k &lt;- takeWhile (\\x -&gt; x*x&lt;=n) [2..], mod n k == 0 ] \n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1492919797, "creation_date": 1492912942, "last_edit_date": 1492916855, "question_id": 43566635, "link": "https://stackoverflow.com/questions/43566635/test-if-an-integer-is-prime", "title": "Test if an integer is prime", "body": "<pre><code>isPrime::Integer-&gt;Bool\nisPrime n=not (hasfactor n 2(div n 2))\n\nhasfactor::Integer-&gt;Integer-&gt;Integer-&gt;Bool\nhasfactor n low high\n    |low&gt;high=False\n    |mod n low==0=True\n    |otherwise = hasfactor n (low+1) high\n</code></pre>\n\n<p>I understand most of the code, except for the second line, <code>not (hasfactor n 2(div n 2))</code>. Why is the higher bound <code>(div n 2)</code>?\nSay if we <code>test 8</code>, then <code>(hasfactor n 2(div n 2))</code> is <code>hasfactor 8 2 4</code>, I don't see the point of dividing <code>8</code> here.</p>\n"}, {"tags": ["swift", "haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1492918179, "post_id": 43567041, "comment_id": 74184479, "body": "Thanks, but I was actually hoping to avoid that."}, {"owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1492952026, "post_id": 43567041, "comment_id": 74192362, "body": "Unfortunately, the second version doesn&#39;t do what I want, which is to use parantheses to denote left-association in function types. In the end, I went with this, which uses a <code>where</code> clause: <a href=\"https://gist.github.com/igstan/b786d870eb28d7e73dcf5223771db6c4\" rel=\"nofollow noreferrer\">gist.github.com/igstan/b786d870eb28d7e73dcf5223771db6c4</a>"}, {"owner": {"reputation": 486150, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "reply_to_user": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1492952209, "post_id": 43567041, "comment_id": 74192429, "body": "@Ionu\u021bG.Stan: I had already thought about that approach but considered it as &quot;cheating&quot; because you still use a second switch statement (just indirectly)."}, {"owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1492952457, "post_id": 43567041, "comment_id": 74192518, "body": "Yeah, it is indeed cheating, but at least the main <code>switch</code> seems easier to read. That&#39;s all."}, {"owner": {"reputation": 486150, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "reply_to_user": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1492953417, "post_id": 43567041, "comment_id": 74192854, "body": "@Ionu\u021bG.Stan: Btw, there was a small error in the second version. It should now give the same output as your code in the question. \u2013 Note that in your gist version the last case is never executed (unless I am mistaken). You can reduce it to 3 cases."}, {"owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1492953925, "post_id": 43567041, "comment_id": 74193044, "body": "Yeah, works as expected now, but it gets ugly when there are other cases besides <code>.Int</code> and <code>.Fun</code>, say <code>.Bool</code> or <code>.String</code>. Now we&#39;d have to list those nested cases as well. Thanks for your help, though. Hopefully Swift will get as-patterns in the future."}, {"owner": {"reputation": 486150, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "reply_to_user": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "edited": false, "score": 0, "creation_date": 1492968864, "post_id": 43567041, "comment_id": 74198746, "body": "@Ionu\u021bG.Stan: Yes, I am aware of that. A <code>where case .Fun = p</code> clause would be a clean solution (as you wrote on the Swift mailing list)."}], "tags": [], "owner": {"reputation": 486150, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1492952649, "last_edit_date": 1492952649, "creation_date": 1492917880, "answer_id": 43567041, "question_id": 43566117, "link": "https://stackoverflow.com/questions/43566117/haskell-like-as-patterns-in-swift/43567041#43567041", "title": "Haskell-like as-patterns in Swift?", "body": "<p>Not the same as the Haskell as-pattern, but you can get rid of the\nsecond switch statement with a nested pattern like this:</p>\n\n<pre><code>var description: String {\n    switch self {\n    case .Int: return \"int\"\n    case .Fun(.Fun(let p, let q), let r): return \"(\\(Type.Fun(p, q))) -&gt; \\(r)\"\n    case .Fun(let p, let r): return \"\\(p) -&gt; \\(r)\"\n    }\n}\n</code></pre>\n\n<p>or by rearranging the cases:</p>\n\n<pre><code>var description: String {\n    switch self {\n    case .Int: return \"int\"\n    case .Fun(.Int, let r): return \"int -&gt; \\(r)\"\n    case .Fun(let p, let r): return \"(\\(p)) -&gt; \\(r)\"\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1492952649, "creation_date": 1492907409, "question_id": 43566117, "link": "https://stackoverflow.com/questions/43566117/haskell-like-as-patterns-in-swift", "title": "Haskell-like as-patterns in Swift?", "body": "<p>Does Swift have anything similar to Haskell's <a href=\"http://zvon.org/other/haskell/Outputsyntax/As-patterns_reference.html\" rel=\"noreferrer\">as-patterns</a> used in pattern matching? I'm trying to get rid of the second <code>switch</code> statement in the following piece of code by using a nested-pattern:</p>\n\n<pre class=\"lang-swift prettyprint-override\"><code>indirect enum Type: CustomStringConvertible {\n  case Int\n  case Fun(Type, Type)\n\n  var description: String {\n    switch self {\n      case .Int: return \"int\"\n      case .Fun(let p, let r):\n        switch p {\n          case .Fun(_): return \"(\\(p)) -&gt; \\(r)\"\n          case _: return \"\\(p) -&gt; \\(r)\"\n        }\n    }\n  }\n}\n\nType.Int                             // \"int\"\nType.Fun(.Int, .Int)                 // \"int -&gt; int\"\nType.Fun(Type.Fun(.Int, .Int), .Int) // \"(int -&gt; int) -&gt; int\"\n</code></pre>\n\n<p>The Haskell equivalent, using as-patterns, would be this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Type =\n    Int\n  | Fun Type Type\n\ndesc :: Type -&gt; String\ndesc t =\n  case t of\n    Int -&gt; \"int\"\n    Fun (p @ (Fun _ _)) r -&gt; \"(\" ++ desc p ++ \") -&gt; \" ++ desc r\n    Fun p r -&gt; desc p ++ \" -&gt; \" ++ desc r\n</code></pre>\n"}, {"tags": ["haskell", "functor", "python-3.6", "contravariance"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 3, "creation_date": 1492900781, "post_id": 43565317, "comment_id": 74181652, "body": "Is <code>_FunctorBase</code> meant to be a base class for all Functors? If so, why is it callable? Most Functors don&#39;t behave like functions. And why does it have a value? Many Functors don&#39;t have at least 1 value, like lists (which can be empty),  <code>Maybe</code> (which can be <code>Nothing</code>), and <code>Proxy</code> (which never holds any value)."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 1, "creation_date": 1492901187, "post_id": 43565317, "comment_id": 74181739, "body": "You won&#39;t be able to translate most Haskell concepts into Python because Python&#39;s type system is simply too weak to support most things. For example, your <code>fmap</code> is simply a function with the type <code>(FunctorBase,PythonValue -&gt; PythonValue) -&gt; FunctorBase</code>. This doesn&#39;t really encode what a functor is, namely <code>(a -&gt; b) -&gt; f a -&gt; f b</code>."}, {"owner": {"reputation": 1642, "user_id": 3928184, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-opJFz3zFjGI/AAAAAAAAAAI/AAAAAAAAAr0/2zAUOWaRv90/photo.jpg?sz=128", "display_name": "bjd2385", "link": "https://stackoverflow.com/users/3928184/bjd2385"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1492901374, "post_id": 43565317, "comment_id": 74181779, "body": "@Cirdec good points. I&#39;ll try to rewrite that definition. I wrote it as more of a helper-like base class. I&#39;ll simply remove those lines."}, {"owner": {"reputation": 1642, "user_id": 3928184, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-opJFz3zFjGI/AAAAAAAAAAI/AAAAAAAAAr0/2zAUOWaRv90/photo.jpg?sz=128", "display_name": "bjd2385", "link": "https://stackoverflow.com/users/3928184/bjd2385"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1492901417, "post_id": 43565317, "comment_id": 74181786, "body": "@Lazersmoke I&#39;ve found that in practice to be too true, why I&#39;m trying to figure out Haskell or Scala, which have far more powerful type systems."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1492905858, "post_id": 43565317, "comment_id": 74182602, "body": "@bjd2385 If you want to learn a functional language like Haskell, I encourage you to abandon trying to learn it by analogy to imperative languages, and dive into it as learning a new skill. If functional and imperative languages were sufficiently the same there&#39;d be little value to gain learning the other method. Good places to start are <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">Learn you a Haskell</a> or <a href=\"http://book.realworldhaskell.org/\" rel=\"nofollow noreferrer\">Real World Haskell</a> or any of the other resources listed on the <a href=\"http://stackoverflow.com/tags/haskell/info\">Haskell tag</a>."}, {"owner": {"reputation": 1642, "user_id": 3928184, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-opJFz3zFjGI/AAAAAAAAAAI/AAAAAAAAAr0/2zAUOWaRv90/photo.jpg?sz=128", "display_name": "bjd2385", "link": "https://stackoverflow.com/users/3928184/bjd2385"}, "edited": false, "score": 0, "creation_date": 1492906993, "post_id": 43565317, "comment_id": 74182787, "body": "@Circdec encouragement noted, and I&#39;m reading <i>Real World Haskell</i> as well."}], "owner": {"reputation": 1642, "user_id": 3928184, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-opJFz3zFjGI/AAAAAAAAAAI/AAAAAAAAAr0/2zAUOWaRv90/photo.jpg?sz=128", "display_name": "bjd2385", "link": "https://stackoverflow.com/users/3928184/bjd2385"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1492900539, "creation_date": 1492900047, "last_edit_date": 1492900539, "question_id": 43565317, "link": "https://stackoverflow.com/questions/43565317/how-do-i-write-a-basic-contravariant-functor-definition-in-python", "title": "How do I write a basic contravariant functor definition in Python?", "body": "<p>I've been trying to understand some of the abstract concepts in Haskell by translating them to Python, but I can't seem to figure out how to write a class that satisfies the axioms defining contravariant functor. </p>\n\n<p>I think the following class captures the concept of a basic functor on 'non-iterable' types.</p>\n\n<pre><code>from typing import Any, Iterable\nfrom types import FunctionType as Function\nfrom abc import abstractmethod\n\n\nclass _FunctorBase:\n\n    value: Any = None\n\n    def __call__(self, value: Any) -&gt; '_FunctorBase':\n        \"\"\" Make the functor type callable \"\"\"\n        self.value = value\n        return self\n\n    def __str__(self) -&gt; str:\n        return f'{self.__class__.__name__}({self.value})'\n\n    def __repr__(self) -&gt; str:\n        return self.__str__()\n\n    def __eq__(self, other: '_FunctorBase') -&gt; bool:\n        return self.value == other.value\n\n    def __ne__(self, other: '_FunctorBase') -&gt; bool:\n        return not self.__eq__(other)\n\n    @abstractmethod\n    def fmap(self, f: Function) -&gt; '_FunctorBase':\n        raise NotImplementedError\n\n\nclass FunctorWrapper(_FunctorBase):\n    \"\"\" Just a basic wrapping functor for a non-iterable value \"\"\"\n\n    def fmap(self, f: Function) -&gt; 'FunctorWrapper':\n        return FunctorWrapper()(f(self.value))\n</code></pre>\n\n<p>I can show that these types satisfy the following axioms (at least, for specific lambda functions), as shown on <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor.html\" rel=\"nofollow noreferrer\">Hackage</a>,</p>\n\n<pre><code>fmap id  ==  id\nfmap (f . g)  ==  fmap f . fmap g\n</code></pre>\n\n<p>as follows:</p>\n\n<pre><code>def id(x: Any) -&gt; Any: return x\n\n\ndef test_functor() -&gt; None:\n    wrap = FunctorWrapper()(3)\n\n    print(wrap.fmap(id))\n    print(wrap.fmap(lambda x: x + 1))\n    print(wrap.fmap(lambda x: x + 1).fmap(lambda x: x + 1))\n\n    assert wrap.fmap(lambda x: x + 1).fmap(lambda y: y * 2) == \\\n           wrap.fmap(lambda z: (z + 1) * 2), \\\n        'Functor does not satisfy composition axiom'\n\n    assert wrap.fmap(id) == wrap, 'Functor does not satisfy identity axiom'\n\n    print('** Functor passes all axioms')\n\ntest_functor()\n\n# FunctorWrapper(3)\n# FunctorWrapper(4)\n# FunctorWrapper(5)\n# ** Functor passes all axioms\n</code></pre>\n\n<p>Or, if you'd prefer a type that can be 'mapped over' in a more explicit manner:</p>\n\n<pre><code>class FunctorIterableList(_FunctorBase):\n\n    def fmap(self, f: Function) -&gt; 'FunctorIterable':\n        return FunctorIterableList()(list(map(f, self.value)))\n\n# FunctorIterableList([1, 2, 3, 4])\n# FunctorIterableList([2, 3, 4, 5])\n# FunctorIterableList([3, 4, 5, 6])\n# ** Functor passes all axioms\n</code></pre>\n\n<p>However, a contravariant functor must satisfy the reversal of composition,</p>\n\n<pre><code>contramap f . contramap g = contramap (g . f)\n</code></pre>\n\n<p>I don't know how to reverse function composition in Python in this manner; I've been thinking the solution might be to store the first action internally in the class definition, then, upon calling with a second, applying the second prior to the first ? There must be a way to satisfy this without storing that kind of information internally though.</p>\n"}, {"tags": ["haskell", "command-line-interface"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1492897636, "post_id": 43564919, "comment_id": 74180745, "body": "System.Process.callCommand"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1492897957, "post_id": 43564919, "comment_id": 74180836, "body": "@amalloy that will not return the stdout of the command"}], "answers": [{"comments": [{"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1493046305, "post_id": 43565336, "comment_id": 74232771, "body": "My purpose was to reach os.popen().read() feature known from Python. It worked without problems there..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1492901037, "last_edit_date": 1492901037, "creation_date": 1492900224, "answer_id": 43565336, "question_id": 43564919, "link": "https://stackoverflow.com/questions/43564919/execute-readprocess-by-giving-full-command/43565336#43565336", "title": "Execute readProcess by giving full command", "body": "<p>These are not features you can generally expect the OS or a process library to offer you. They're features of the <em>shell</em> language (i.e. <code>sh</code>/<code>dash</code>/<code>bash</code>/<code>zsh</code> etc., whatever you use). Thus you have to call the shell as the process, with the entire command as the argument:</p>\n\n<pre><code>Prelude System.Process&gt; readProcess \"bash\" [\"-c\", \"lsusb | grep 'Real'\"] \"\"\n\"Bus 001 Device 003: ID 0bda:57b5 Realtek Semiconductor Corp. \\n\"\n</code></pre>\n\n<p>Of course this won't work on a system that doesn't have Bash installed, like Windows.</p>\n\n<p>A nicer approach would be to <em>not</em> invoke any shell pipes and <code>grep</code>, but do the searching in Haskell itself. The <a href=\"https://hackage.haskell.org/package/turtle-1.3.2/docs/Turtle-Tutorial.html\" rel=\"nofollow noreferrer\"><code>turtle</code></a> library makes this easy:</p>\n\n<pre><code>Prelude Turtle&gt; :set -XOverloadedStrings\nPrelude Turtle&gt; stdout . grep (has \"Real\") $ inproc \"lsusb\" [] empty\nBus 001 Device 003: ID 0bda:57b5 Realtek Semiconductor Corp. \n</code></pre>\n"}], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 43565336, "answer_count": 1, "score": 0, "last_activity_date": 1492901037, "creation_date": 1492897181, "question_id": 43564919, "link": "https://stackoverflow.com/questions/43564919/execute-readprocess-by-giving-full-command", "title": "Execute readProcess by giving full command", "body": "<p>readProcess in Haskell takes command name and its args separately. I'd like to execute command as I have typed it exactly into shell, eg. \"ls -la\". The main problem is that I have no idea how to execute command with some pipes etc, so</p>\n\n<pre><code>./someprogram -s 2&gt; /dev/stdin | grep string\n</code></pre>\n\n<p>seems impossible. I cannot simply pass it into command name, because it throws exception then. So how can I do it? </p>\n"}, {"tags": ["haskell", "mingw", "ghc", "cabal", "cabal-install"], "answers": [{"tags": [], "owner": {"reputation": 145, "user_id": 457115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5d76471846fdcc576f003eb27a2e44b?s=128&d=identicon&r=PG", "display_name": "sumo", "link": "https://stackoverflow.com/users/457115/sumo"}, "is_accepted": true, "score": 1, "last_activity_date": 1492910375, "creation_date": 1492910375, "answer_id": 43566424, "question_id": 43564648, "link": "https://stackoverflow.com/questions/43564648/error-when-installing-cabal-package-cannot-determine-mingw-version/43566424#43566424", "title": "Error when installing cabal package (cannot determine mingw version)", "body": "<p>Win10 Creators Update changed some APIs that ghc was affected by. You may be seeing the result of this. If you have Win 10 build 15019 or later replace your gcc.exe as detailed at the <a href=\"https://github.com/Mistuke/ghc-compat\" rel=\"nofollow noreferrer\">ghc-compat repo</a> as see if that helps.</p>\n"}], "owner": {"reputation": 5861, "user_id": 3042117, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/dc6ec10c58136fc12bf83fe45001d672?s=128&d=identicon&r=PG", "display_name": "Iter Ator", "link": "https://stackoverflow.com/users/3042117/iter-ator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "accepted_answer_id": 43566424, "answer_count": 1, "score": 1, "last_activity_date": 1492910375, "creation_date": 1492895327, "last_edit_date": 1492897752, "question_id": 43564648, "link": "https://stackoverflow.com/questions/43564648/error-when-installing-cabal-package-cannot-determine-mingw-version", "title": "Error when installing cabal package (cannot determine mingw version)", "body": "<p>I would like to install a package using cabal, but I get this error:</p>\n\n<pre><code>Warning: cannot determine version of D:\\Program Files\\Haskell\nPlatform\\8.0.2\\mingw\\bin\\gcc.exe :\n\"\"\n`gcc.exe' failed in phase `C Compiler'. (Exit code: -1073741502)\n</code></pre>\n\n<p>The package is <code>stm</code>:</p>\n\n<pre><code>cabal install stm\n</code></pre>\n\n<p>I've installed the full x64 version of <code>Haskell Platform</code> on my Windows 10 PC.</p>\n\n<p>The error is almost the same as here: <a href=\"https://github.com/haskell/cabal/issues/4442\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/issues/4442</a></p>\n\n<p>But that is not answered</p>\n"}, {"tags": ["haskell", "ghc", "ffi"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1492895538, "post_id": 43563722, "comment_id": 74180096, "body": "I&#39;m voting to close since you didn&#39;t give nearly enough information. Where is the haskell code? How are you trying to build this?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1492895651, "post_id": 43563722, "comment_id": 74180117, "body": "It appears you are using <code>ghc</code> but have used CPP to include a C file... what did you think would happen when using a Haskell compiler on C code?  You linked to people talking about <code>hsc2hs</code> so perhaps you want to install and use that instead of invoking GHC directly."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1493772869, "creation_date": 1493772869, "answer_id": 43749399, "question_id": 43563722, "link": "https://stackoverflow.com/questions/43563722/parser-error-on-including-a-c-header-file-in-ghc-ffi/43749399#43749399", "title": "Parser error on including a C header file in GHC FFI", "body": "<p>This new error message suggests that the <code>libtreetagger.a</code> library in the directory <code>/home/frank/Workspace8/repo8/treeTaggerClient/treetaggerSourceC</code> doesn't actually contain definitions for <code>init_treetagger</code> or <code>tag_sentence</code>, whatever <code>tagger-api.h</code> might say.</p>\n\n<p>Can you run <code>nm libtreetagger.a</code> and see if <code>init_treetagger</code> and <code>tag_sentence</code> actually appear as defined symbols in that file?  There should be lines like:</p>\n\n<pre><code>00000000000003b0 T init_treetagger\n0000000000001c40 T tag_sentence\n</code></pre>\n\n<p>Specifically, the names should match exactly, the records should include addresses, and the types should be <code>T</code>.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1493772869, "creation_date": 1492889511, "last_edit_date": 1495541885, "question_id": 43563722, "link": "https://stackoverflow.com/questions/43563722/parser-error-on-including-a-c-header-file-in-ghc-ffi", "title": "Parser error on including a C header file in GHC FFI", "body": "<p>I am following examples (e.g. <a href=\"https://stackoverflow.com/questions/6056323/how-to-use-hsc2hs-to-bind-to-constants-functions-and-data-structures\">1</a> or <a href=\"https://stackoverflow.com/questions/30474224/hsc2hs-mutate-a-c-struct-with-haskell\">2</a>) to construct a data structure to pass to a C program using FFI in GHC (8.0.2). The C file <code>tagger-api.h</code> is:   </p>\n\n<pre><code> typedef struct {\n  int  number_of_words;  /* number of words to be tagged */\n  int  next_word;        /* needed internally */\n  char **word;           /* array of pointers to the words */\n  char **inputtag;       /* array of pointers to the pretagging information */\n  const char **resulttag;/* array of pointers to the tags */\n  const char **lemma;    /* array of pointers to the lemmas */\n} TAGGER_STRUCT;\n\nvoid init_treetagger(char *param_file_name);\ndouble tag_sentence( TAGGER_STRUCT *ts );\n</code></pre>\n\n<p>The code is in a MainFFI4TT.hsc file:</p>\n\n<pre><code>{-# LANGUAGE CPP #-}\n{-# LANGUAGE ForeignFunctionInterface   #-}\n{-# LANGUAGE FlexibleInstances, RecordWildCards #-}\n\nmodule Main     where      -- must have Main (main) or Main where\n\nimport Foreign\nimport Foreign.C\n\n#include \"tagger-api.h\"\n\nmain =  do    \n    withCString parameterFileName c_initTreeTagger    \n    return ()   \n\nparameterFileName = \"/home/frank/additionalSpace/AF_amd_install/treeTagger/TreeTaggerDaemon/lib/german-utf8.par\"\n\nforeign import ccall \"tagger-api.h init_treetagger\"\n    c_initTreeTagger :: CString -&gt; IO ()\n\nforeign import ccall \"tagger-api.h tag_sentence\"\n     c_tag_sentence :: CString -&gt; IO ()     -- structure required....\n\ndata Struct = Struct   -- this requires ccp\n    { noOfWords :: !Int\n    , nextWord :: !Int\n    , wordsIn :: ![String]\n    , pretag :: ![String]\n    , tags :: ![String]\n    , lemmas :: ![String]\n    }\n{-\ntype StructPtr = Ptr Struct\ninstance Storable Struct  where\n    alignement _ = #{alignment TAGGER_STRUCT}\n    sizeOf _ = #{size TAGGER_STRUCT}\n    poke p  Struct{..} = do\n        number_of_words &lt;- newCString noOfWords\n        nextWord &lt;- CInt nextWord\n     -}\n</code></pre>\n\n<p>the cabal stanza is:</p>\n\n<pre><code>executable ttclient\n    main-is:    MainFFI4TT.hs\n    build-depends: base\n    default-language: Haskell2010\n    hs-source-dirs: src\n    other-modules:\n    Include-dirs: treetaggerSourceC\n    Includes: tagger-api.h\n    extra-libraries: treetagger\n    extra-lib-dirs: /home/frank/Workspace8/repo8/treeTaggerClient/treetaggerSourceC\n</code></pre>\n\n<p>I was confused whether the file should have the extension <code>.hsc</code> or <code>.cpphs</code> - I  was under the erroneous impression, that the <code>.hsc</code> file is automatically produced, now I have one. I assume that cabal is automatically converting the <code>.hsc</code> to a <code>.hs</code>, but it now fails with: </p>\n\n<pre><code>Linking dist/build/ttclient/ttclient ...\ndist/build/ttclient/ttclient-tmp/Main.o: In function `c3Lp_info':\n(.text+0x49a): undefined reference to `init_treetagger'\ndist/build/ttclient/ttclient-tmp/Main.o: In function `c3Nl_info':\n(.text+0x762): undefined reference to `tag_sentence'\ncollect2: error: ld returned 1 exit status\n`gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>The next problem will be how to construct the structure with the array of pointers to strigs. </p>\n\n<p>I appreciated the help in clarifying what preprocessor I have to use and to overcome the first hurdle. Now i am at a different one, help is greatly appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1492896947, "post_id": 43562168, "comment_id": 74180499, "body": "There&#39;s no reason to declare all negative integers as neither even nor odd. <code>isOdd n | n &lt; 0 = isOdd (-n)</code> (and likewise for <code>isEven</code>) is perfectly sensible."}], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492888019, "post_id": 43562259, "comment_id": 74177713, "body": "What do you mean by &quot;In fact, Haskell compilers are allowed to execute any computation they want as long as it gives the correct result.&quot;?"}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492894015, "post_id": 43562259, "comment_id": 74179603, "body": "Haskell as a language only specifies the semantics of the language, so as long as the result is correct, they can perform any sort of optimization or execution model they want. For example, GHC might specialize <code>even</code> to the machine Word or machine Int to make it very slightly faster on those types. If it knows the value of something at compile time, it can even trim out unreachable cases. <code>let x = True in if x then 5 else 10</code> will optimize to just <code>5</code> because actually checking if True is True is a waste of time. When evaluating <code>f x y</code>, it can evaluate x or y first, and the result is the same"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492894856, "post_id": 43562259, "comment_id": 74179879, "body": "That is different than saying &quot;Haskell compilers are allowed to execute any computation they want as long as it gives the correct result&quot; because there are some formal rules about what parts of an expression a Haskell compiler evaluates and when. The Haskell 98/2010 Reports require a somewhat certain (non-strict) semantics of evaluation. There is an example <a href=\"http://stackoverflow.com/questions/40328862/is-there-any-guarantee-about-the-evaluation-order-within-a-pattern-match\">here</a>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492894876, "post_id": 43562259, "comment_id": 74179884, "body": "What I think you are referring to are certain optimizations, which must be guaranteed to not be &quot;visible&quot; as changing the evaluation order given by the Haskell Reports (except as maybe changing time and/or space usage)."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492897092, "post_id": 43562259, "comment_id": 74180556, "body": "Not terminating/behavior around <code>_|_</code> is denotational semantics, not operational semantics. Strictness/laziness are part of the &quot;result&quot; and therefore must be preserved by optimizations. Execution is operational, evaluation is denotational. Execution is up to the compiler, evaluation is defined by Haskell&#39;s semantics."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492898232, "post_id": 43562259, "comment_id": 74180919, "body": "My ultimate point is, Haskell compilers cannot compile code to execute the expressions in any order they want and saying that they can as long as it gets the (in my opinion) nebulous &quot;correct result&quot; seems a bit misleading. Haskell specifically has non-strict semantics (function arguments are only eval&#39;d if they are used), which means it goes outside-in. In a very practical sense, if it evaluated the other way around, this would change the behavior of programs from what the Haskell Reports specify it should be (unless you have explicit strictness annotations, which the report allows for)."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 4, "last_activity_date": 1492898466, "last_edit_date": 1492898466, "creation_date": 1492881751, "answer_id": 43562259, "question_id": 43562168, "link": "https://stackoverflow.com/questions/43562168/haskell-execution-sequence/43562259#43562259", "title": "Haskell execution sequence", "body": "<p>There are two different functions here: <code>isOdd</code> and <code>isEven</code>. They are defined in terms of each other: A number is \"not odd\" if it is negative or zero, and \"odd\" if one less than that number is \"even\". A number is \"not even\" if it is negative, and \"even\" if it is zero or one less than that number is \"odd\".</p>\n\n<p>It's a fairly unintuitive way to define these functions, but it has nothing to do with \"execution sequence\" or \"evaluation order\". In fact, Haskell compilers are allowed to execute any computation they want as long as it gives the correct value as a result and follows the lazy/strict semantics as specified in the Haskell Report.</p>\n\n<p>A better implementation of these functions is as follows: (from the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Real.html#even\" rel=\"nofollow noreferrer\">Prelude</a>)</p>\n\n<pre><code>even, odd       :: (Integral a) =&gt; a -&gt; Bool\neven n          =  n `rem` 2 == 0\nodd             =  not . even\n</code></pre>\n\n<p>In other words, and integer-like thing is even if the remainder when you divide it by 2 is 0, and odd if it is not even.</p>\n\n<p>Note: The <code>INLINEABLE</code> pragams in the link above are just an optimization, and can be ignored.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1492887467, "creation_date": 1492887467, "answer_id": 43563362, "question_id": 43562168, "link": "https://stackoverflow.com/questions/43562168/haskell-execution-sequence/43563362#43563362", "title": "Haskell execution sequence", "body": "<p>this is called \"mutual recursion\" or \"mutually recursive functions\", as in  the recursive functions you need to define the terminal state (or exit condition).  However, your definition is not the best, here is a better alternative</p>\n\n<pre><code>isEven,isOdd :: Int -&gt; Bool\nisEven 0 = True\nisEven n = isOdd  (n - 1)\nisOdd  0 = False\nisOdd  n = isEven (n - 1)\n</code></pre>\n\n<p>here the terminal condition is set for <code>0</code> (symmetrically) and mutual recursion will end up on one of them eventually.</p>\n\n<p>Note that this is only defined for non-negative integers but not enforced with the type <code>Int</code>.  </p>\n\n<p>Your definition is not correct either but at least will terminate for negative numbers.</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1492910463, "post_id": 43563429, "comment_id": 74183318, "body": "sorry I&#39;m confused, &quot;(0 == 0, so the second branch is taken)&quot; makes it sound like 3 should be even"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1492910740, "post_id": 43563429, "comment_id": 74183363, "body": "@user3358850 In that step, <code>isEven</code> is being called with the argument <code>0</code> (which is even, since it is evenly divisible by <code>2</code>). The second branch there is the one that says <code>if 0 == 0 then True ...</code>. <code>True</code> is the final result of evaluating <code>isOdd 3</code>. The stuff in between are the steps taken to get from <code>isOdd 3</code> to the final result of <code>True</code>. The overall chain of logic, from a higher level perspective, is something like &quot;To know if 3 is odd, see if 2 is even. To see if 2 is even, see if 1 is odd. To see if 1 is odd, see if 0 is even. 0 is even &#39;by definition&#39; (so to speak)&quot;."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "edited": false, "score": 0, "creation_date": 1492911125, "post_id": 43563429, "comment_id": 74183414, "body": "And since <code>0</code> is even, all those preceding statements are true (<code>1</code> is odd, <code>2</code> is even and, finally, <code>3</code> is odd)."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 2, "last_activity_date": 1492888747, "last_edit_date": 1492888747, "creation_date": 1492887804, "answer_id": 43563429, "question_id": 43562168, "link": "https://stackoverflow.com/questions/43562168/haskell-execution-sequence/43563429#43563429", "title": "Haskell execution sequence", "body": "<p>These functions are <em>mutually recursive</em> (each one can call the other one), with base cases. Lets follow an example evaluation using <code>isOdd</code>. First, I will start by changing the guards into the equivalent <code>if</code>s for (hopefully) more clarity in this answer (though I would usually suggest using guards).</p>\n\n<pre><code>isOdd, isEven :: Int -&gt; Bool\nisOdd n =\n  if n &lt;= 0\n    then False\n    else isEven (n-1)\n\nisEven n =\n  if n &lt; 0\n    then False\n    else if n == 0\n           then True\n           else isOdd (n-1)\n</code></pre>\n\n<p>Now, we can try stepping through an example evaluation<sup>[1]</sup>:</p>\n\n<pre><code>    isOdd 3\n\n==&gt; if 3 &lt;= 0                  (Applying isOdd to 5 and expanding the body)\n      then False\n      else isEven (3-1)\n\n==&gt; isEven (3-1)               (3 &gt; 0)\n\n==&gt; if 2 &lt; 0\n      then False\n      else if 2 == 0\n             then True\n             else isOdd (2-1)\n\n==&gt; isOdd (2-1)                (4 &gt; 0, so the first two branches aren't taken)\n\n==&gt; if 1 &lt;= 0                  (Applying isOdd to 1 and expanding the body)\n      then False\n      else isEven (1-1)\n\n==&gt; isEven 0\n\n==&gt; if 0 &lt; 0\n      then False\n      else if 0 == 0\n             then True\n             else isOdd (0-1)\n\n==&gt; True                      (0 == 0, so the second branch is taken)\n</code></pre>\n\n<p>The intuition behind why these functions work is this: if a non-negative integer (natural number) <code>n</code> is greater than <code>0</code>, it is odd if its predecessor (<code>n-1</code>) is even and it is even if its predecessor is odd. This is true since even and odd numbers alternate.</p>\n\n<p>I would recommend stepping through an evaluation whenever you run into a function (or, in this case, pair of functions) that you don't understand using a small example like this.</p>\n\n<p><sub><sup>[1]</sup>: Note for something that doesn't really matter for this question: I've slightly simplified when the expressions of the shape <code>x-1</code> get reduced to the corresponding number.</sub></p>\n"}], "owner": {"reputation": 131, "user_id": 3358850, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/ae4ac12b59d38f509b9ae01fd08f8407?s=128&d=identicon&r=PG&f=1", "display_name": "user3358850", "link": "https://stackoverflow.com/users/3358850/user3358850"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1492898466, "creation_date": 1492881193, "last_edit_date": 1492884895, "question_id": 43562168, "link": "https://stackoverflow.com/questions/43562168/haskell-execution-sequence", "title": "Haskell execution sequence", "body": "<pre><code>isOdd, isEven :: Int -&gt; Bool\nisOdd n\n    | n&lt;=0 = False\n    | otherwise = isEven (n-1)\nisEven n\n    | n&lt;0 = False\n    | n==0 = True\n    | otherwise = isOdd (n-1)\n</code></pre>\n\n<p>I'm having trouble understanding this code,in isOdd,it only defines what is False,and then switch to isEven,so how does haskell know when is n odd?</p>\n"}, {"tags": ["haskell", "ghc", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1492887704, "post_id": 43562277, "comment_id": 74177597, "body": "sounds like a useful abstraction to put somewhere in hackage... I will adapt your code and use it! Thank you!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1492881845, "creation_date": 1492881845, "answer_id": 43562277, "question_id": 43561936, "link": "https://stackoverflow.com/questions/43561936/convert-a-list-of-strings-to-a-c-array-in-haskell/43562277#43562277", "title": "convert a list of strings to a c array in haskell", "body": "<p>No, I don't think there is anything for this. <code>newCString</code> and <code>newArray</code> make it simple enough already:</p>\n\n<pre><code>import Foreign.Ptr\nimport Foreign.C.String\nimport Foreign.Marshal.Alloc\nimport Foreign.Marshal.Array\n\nmakeCStringArray :: [[String]] -&gt; IO (Ptr CString)\nmakeCStringArray arr = newArray =&lt;&lt; traverse newCString arr\n\nfreeCStringArray :: Int -&gt; Ptr CString -&gt; IO ()\nfreeCStringArray n ptr = do\n  strs &lt;- peekArray n ptr\n  traverse free strs\n  free ptr\n</code></pre>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 43562277, "answer_count": 1, "score": 1, "last_activity_date": 1492881845, "creation_date": 1492879893, "question_id": 43561936, "link": "https://stackoverflow.com/questions/43561936/convert-a-list-of-strings-to-a-c-array-in-haskell", "title": "convert a list of strings to a c array in haskell", "body": "<p>there are several instructions on how to convert a string to a CString to be passed in a call to C with FFI. My problem is to convert a list of strings to a <code>char **word</code> value, for which I cannot find an answer in stackoverflow nor on hackage. </p>\n\n<p>I see one option: I could convert each string from the list with <code>newCString</code> and then feed these to newArray - not forgetting to free the reserved memory. </p>\n\n<p>I guess there should be a better option for this relatively common operation? </p>\n"}, {"tags": ["haskell", "constructor"], "comments": [{"owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 0, "creation_date": 1492874480, "post_id": 43560243, "comment_id": 74172821, "body": "Why would you want to do that ? What if the list provides not enough arguments to the constructor ? List length is not a property that is checkable at compile time. You can use tuples for something similar and safe, and it&#39;s called currying."}, {"owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "reply_to_user": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "edited": false, "score": 0, "creation_date": 1492875319, "post_id": 43560243, "comment_id": 74173151, "body": "How would a tuple be used for this?"}], "owner": {"reputation": 554, "user_id": 1382487, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/JdQcl.jpg?s=128&g=1", "display_name": "wsaleem", "link": "https://stackoverflow.com/users/1382487/wsaleem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 0, "closed_date": 1492872034, "answer_count": 0, "score": 0, "last_activity_date": 1492871571, "creation_date": 1492870583, "last_edit_date": 1492871571, "question_id": 43560243, "link": "https://stackoverflow.com/questions/43560243/in-haskell-how-can-i-apply-a-constructor-to-a-list-of-values", "closed_reason": "Duplicate", "title": "In Haskell how can I apply a constructor to a list of values?", "body": "<p>I have a <code>TernaryTree</code> type.</p>\n\n<p><code>data TernaryTree a = Node a (TernaryTree a) (TernaryTree a) (TernaryTree a) | Nil deriving (Eq, Show)</code></p>\n\n<p>Given a list, I want to be able to apply the <code>Node</code> constructor to it, e.g.</p>\n\n<pre><code>Node v [t1, t2, t3]  -- error\n</code></pre>\n\n<p>The above is, of course, invalid.</p>\n\n<p>There are good ways through pattern matching to do the opposite, e.g</p>\n\n<pre><code>let Node v t1 t2 t3 = parent in [t1,t2,t3]\n</code></pre>\n\n<p>but I could not find a simple solution to my problem other than writing a function, e.g.</p>\n\n<pre><code>makeNode v lst@[t1,t2,t3] = Node v t1 t2 t3\n</code></pre>\n\n<p>Even if I had the function, it is not flexible, e.g. it cannot do this,</p>\n\n<pre><code>Node v t1 [t2, t3]  -- error\n</code></pre>\n\n<p>I now require another function.</p>\n\n<p>I could add further constructors to the type for this but it seems to me that there must be a simpler way.</p>\n\n<p>The type of the operation that would do what I want is</p>\n\n<pre><code>[a] -&gt; a a a\n</code></pre>\n\n<p>which, I think, should be undefined.</p>\n\n<p>This seems so simple a requirement that I am sure there is an easy built-in way to do this but I just cannot find it.</p>\n\n<p>Is there a built-in way to use a constructor on a list?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1492869984, "post_id": 43560134, "comment_id": 74171279, "body": "Iirc, you need to have something before the if that says what will be produced from the comprehension."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1492870076, "post_id": 43560134, "comment_id": 74171310, "body": "Are you doing this in ghci or is this in a file?"}, {"owner": {"reputation": 1, "user_id": 7205721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01c9b30663b242dada85af00b2489cbb?s=128&d=identicon&r=PG&f=1", "display_name": "amott42", "link": "https://stackoverflow.com/users/7205721/amott42"}, "edited": false, "score": 0, "creation_date": 1492870089, "post_id": 43560134, "comment_id": 74171315, "body": "This is in GHCi"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1492870144, "post_id": 43560134, "comment_id": 74171330, "body": "Are you typing this into GHCi or a Haskell file? In the latter case, can you show the entire code? When I try to run your code, I get a syntax error because you used <code>=</code> instead of <code>==</code> and a type error because you didn&#39;t use backticks around <code>mod</code>, but nothing about <code>if</code>. The <code>if</code> seems perfectly fine where it is."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1492870175, "post_id": 43560134, "comment_id": 74171341, "body": "I get <code>parse error in if statement: missing required then and else clauses</code>, which is caused by the <code>=</code>."}, {"owner": {"reputation": 1, "user_id": 7205721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01c9b30663b242dada85af00b2489cbb?s=128&d=identicon&r=PG&f=1", "display_name": "amott42", "link": "https://stackoverflow.com/users/7205721/amott42"}, "edited": false, "score": 0, "creation_date": 1492871103, "post_id": 43560134, "comment_id": 74171641, "body": "That code sample there so far is literally my entire code, done in GHCi. I named the function factors and have tried it both with the arguments x and i and only with the argument x."}], "answers": [{"tags": [], "owner": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "is_accepted": false, "score": 3, "last_activity_date": 1492871462, "creation_date": 1492871462, "answer_id": 43560375, "question_id": 43560134, "link": "https://stackoverflow.com/questions/43560134/parse-error-when-writing-a-factor-function-in-haskell/43560375#43560375", "title": "Parse error when writing a factor function in Haskell", "body": "<p>Because you're using <code>mod</code> function as an infix operator, you need to surround it in backquotes. The operator to compare equality is not <code>=</code> but <code>==</code> . The error free rewrite of your code is:</p>\n\n<pre><code>getFactors x = [if x `mod` i == 0 then i else succ i | i &lt;- [1..x]]\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7205721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01c9b30663b242dada85af00b2489cbb?s=128&d=identicon&r=PG&f=1", "display_name": "amott42", "link": "https://stackoverflow.com/users/7205721/amott42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1492871462, "creation_date": 1492869712, "question_id": 43560134, "link": "https://stackoverflow.com/questions/43560134/parse-error-when-writing-a-factor-function-in-haskell", "title": "Parse error when writing a factor function in Haskell", "body": "<p>I only started learning Haskell a few days ago, and I am currently trying to code a function that returns the factors of any number x. Based on my limited knowledge of the syntax thus far, this is what I have produced</p>\n\n<pre><code>[if x mod i = 0 then i else succ i | i &lt;- [1..x]]\n</code></pre>\n\n<p>However, this doesn't work. It produces a <strong>parse error on input 'if'</strong>. I have tried changing the arguments and defining i outside of the function, but it always produces the same error, which makes me think that it is most likely some kind of syntax error. Any help or advice regarding the syntax and/or defining the function correctly would be greatly appreciated. Thank you.</p>\n"}, {"tags": ["haskell", "recursion", "matrix"], "comments": [{"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1492868965, "post_id": 43559893, "comment_id": 74170940, "body": "Could you explain &quot;However, i have a restriction that i cant use anything related to lists&quot;. Is this a restriction of your course instructor, or are you working through some sort of self-study thing?"}, {"owner": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "reply_to_user": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "edited": false, "score": 0, "creation_date": 1492869108, "post_id": 43559893, "comment_id": 74170992, "body": "Yes, my course instructor made that task, so i&#39;m kind of forced to use something else."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "edited": false, "score": 0, "creation_date": 1492878784, "post_id": 43560274, "comment_id": 74174335, "body": "Thank you very much for your answer. I see know where the problem is :)  I also didnt know that i shouldnt use return. And guards really do look better ! I&#39;ve tried the structure proposed by Daniel&#39;s answer, see my edited question above :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1492870795, "creation_date": 1492870795, "answer_id": 43560274, "question_id": 43559893, "link": "https://stackoverflow.com/questions/43559893/checking-every-field-in-a-matrix-with-restriction/43560274#43560274", "title": "Checking every field in a &quot;matrix&quot; (with restriction)", "body": "<p>First let me clean up that code of yours, syntactically:</p>\n\n<pre><code>amountofships :: ... -- Always write out type signatures!\namountofships k board = rekurs 1 1 board res\n where res = 0\n       rekurs x y board res\n         | board x y == -1  = return res  -- guards usually read nicer than `if`\n         | otherwise        = return $ rekurs (x + 1) 1 board res\n        where new_rekurs a b board res2\n                | board a b == -1  = return res2 -- no need for parens around function arguments!\n                | board a b == k   = return $ new_rekurs a (b+1) board (res + 1)\n                | otherwise        = return $ new_rekurs a (b+1) board res\n               where res2 = 0\n</code></pre>\n\n<p>Now, a big problem here is <code>return</code>. Note that <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad-Instances.html#v:return\" rel=\"nofollow noreferrer\"><code>return</code></a> in Haskell is very different from <code>return</code> in most other languages. It is <em>not</em> a keyword that's generally needed for the result of functions, instead, <code>return</code> is itself just a library function:</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; m a\n</code></pre>\n\n<p>You need this to inject a value of \u201cpure type\u201d <code>a</code>, for example <code>3 :: Int</code>, into the result of a <em>monadic action</em> of type <code>m a</code>, e.g. <code>Just 3 :: Maybe Int</code>. For example, you might use it thus:</p>\n\n<pre><code>-- Find the first even number in the tuple, if any\nfstEven :: (Int, Int) -&gt; Maybe Int\nfstEven (a,b)\n | even a     = return a  -- for the `Maybe` monad, this is the\n | even b     = return b  --  same as writing `Just a` / `Just b`.\n | otherwise  = Nothing\n</code></pre>\n\n<p>Observe that I didn't write <code>return Nothing</code>: that would wrap the already monadic, <em>empty value</em> <code>Nothing :: Maybe Int</code> into another monadic layer, which is too much monad here.</p>\n\n<p>Similar in your code: you wrap every result in <code>return</code>, but never unwrap anything.</p>\n\n<p>Since in your case, everything is \u201cpure\u201d anyway, there's simply no need for that. To make something <em>the result of a function</em>, just write it out, like:</p>\n\n<pre><code>-- Use the first number in the tuple, if it's even; else use the second.\nfstIfEven :: (Int, Int) -&gt; Int\nfstIfEven (a,b)\n | even a     = a\n | otherwise  = b\n</code></pre>\n\n<p>Or, in your case,</p>\n\n<pre><code>amountofships :: ... -- Always write out type signatures!\namountofships k board = rekurs 1 1 board res\n where res = 0\n       rekurs x y board res\n         | board x y == -1  = res\n         | otherwise        = rekurs (x + 1) 1 board res\n        where new_rekurs a b board res2\n                | board a b == -1  = res2\n                | board a b == k   = new_rekurs a (b+1) board (res + 1)\n                | otherwise        = new_rekurs a (b+1) board res\n               where res2 = 0\n</code></pre>\n\n<p>That looks better, but it doesn't work \u2013 here comes the interesting problem. See, you seem to not really think of <em>recursion</em> here. For a \u201crecursive loop\u201d in Haskell, you don't <em>initialise</em> a variable with something like <code>res = 0</code> and then somehow change it in the course of the loop. Rather you straight up <em>call the loop-body function</em> with the initial value as the \u201cfront-end argument\u201d, and then keep the function calling itself with <em>other</em> arguments. I'll demonstrate it for the simplified problem with only one grid-dimension. Instead of these <em>magic numbers</em>, I shall use descriptive tag types:</p>\n\n<pre><code>data Player = PlayerA | PlayerB\n deriving (Eq, Show)\n\ndata BoardField = Coast | OpenSea | Ship Player\n deriving (Eq, Show)\n\ntype Board = Int -&gt; BoardField   -- \u201carray\u201d of fields which may have ships in them, starting with index 0\n\namountOfShips :: Player -&gt; Board -&gt; Int\namountOfShips k board = go 0 0  -- the `board` is always the same, no need to pass\n                                -- it explicitly to the worker-loop function `go`\n where go x res = case board x of  -- `case` is even better than guards, if all you're doing is equality comparison.\n        Coast -&gt; res             -- When we've reached the coast we're done, there can be no more ships.\n        Ship player\n          | player==k  -&gt; go (x+1) (res+1)  -- Found ship of the requested player,\n                                            -- therefore continue recursion with incremented accumulator\n        _  -&gt; go (x+1) res  -- No ships here, so continue recusion with the same accumulator.\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "edited": false, "score": 0, "creation_date": 1492878173, "post_id": 43560298, "comment_id": 74174135, "body": "Thank you so much for your answer. I understand where the problem in my own code is(also thanks to the other answer i got).  I&#39;ve tried to implement your structure and it least compiles. (see my edited question above).  I still get an <code>Could not deduce (Num Bool) arising from the literal \u20181\u2019</code> error when calling it, may it be because i didnt set function signatures like function :: int -&gt; int ?  however as i have a function as a parameter, how would i declare that correctly?  `"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "edited": false, "score": 0, "creation_date": 1492878365, "post_id": 43560298, "comment_id": 74174194, "body": "That error means that you&#39;re using a <code>1</code> somewhere where Haskell thinks you should have a boolean (<code>True</code> or <code>False</code>) - one possibility is that you&#39;re doing somewhere something like &quot;<code>if myfunction x y then ...</code>&quot;, where <code>myfunction</code> is something that returns a 0 or 1, and what you meant to write was &quot;<code>if myfunction x y == 1 then ...</code>&quot;."}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "edited": false, "score": 0, "creation_date": 1492878519, "post_id": 43560298, "comment_id": 74174255, "body": "But as for your question about function signatures: yes, if you take a function as input, you write it like (Int -&gt; Int). For example, your <code>amountofships</code> function could be declared as <code>amountofships :: Int -&gt; (Int -&gt; Int -&gt; Int) -&gt; Int</code>, since the function <code>board</code> has type <code>board :: Int -&gt; Int -&gt; Int</code>"}, {"owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "reply_to_user": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "edited": false, "score": 0, "creation_date": 1492878651, "post_id": 43560298, "comment_id": 74174296, "body": "But yes, I agree with the advice in the other answer to write out function signatures in many spots when you&#39;re first learning Haskell. Writing out function signatures will help the compiler realize where you went wrong, and give you error messages close to the actual error - without function signatures, the compiler can sometimes infer very unexpected types while it&#39;s trying to make everything compile, and the end result is that you get an error far away from where you made the mistake."}, {"owner": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "edited": false, "score": 0, "creation_date": 1492879214, "post_id": 43560298, "comment_id": 74174462, "body": "<code>amountofships :: Int -&gt; (Int -&gt; Int -&gt; Int) -&gt; Int</code> was also my first guess, now it complains that it  couldnt match the expected type bool with actual typ Integer. The error message: <code>\u2022 Couldn&#39;t match expected type \u2018Bool\u2019 with actual type \u2018Int\u2019     \u2022 In the expression: board x y </code>, and i saw that its because i forgot to check if ` board xy ==  -1 `.  It works now! Thank you so much."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 3, "last_activity_date": 1492870956, "creation_date": 1492870956, "answer_id": 43560298, "question_id": 43559893, "link": "https://stackoverflow.com/questions/43559893/checking-every-field-in-a-matrix-with-restriction/43560298#43560298", "title": "Checking every field in a &quot;matrix&quot; (with restriction)", "body": "<p>Okay, yes, you're a bit confused.</p>\n\n<p>So my advice first is to try to straighten out what you want to do, in mostly English. I'm going to try to lead you to that without outright giving you the answer, since the point of this exercise is for you to learn more Haskell.</p>\n\n<p>So it seems to me - though you haven't explained it - that what you intend to happen is:</p>\n\n<ol>\n<li><p><code>amountofships</code> calls internal function <code>rekurs</code> telling it to start at position <code>1</code> <code>1</code> and passing it an accumulator argument that should start at <code>0</code></p></li>\n<li><p><code>rekurs</code> should examine the spot it's given, and if that spot is <code>-1</code> say \"oh, I'm off the grid, return the accumulator argument\", and otherwise it should return the result of calling itself with one spot to the right.</p></li>\n</ol>\n\n<p>Then you also somewhere define something called <code>new_rekurs</code> that you don't ever call.</p>\n\n<p>So first let's try to fix your logic first, and then if you still have trouble translating that into Haskell we can work on that.</p>\n\n<p>So the general pattern that you seem to be following is \"call an internal tail-recursive function with an accumulator argument that checks \"am I done yet?\" and, if done, returns the accumulator argument. If not done, it computes the next place it should go and then calls itself on that.\"</p>\n\n<p>Now, that's an okay pattern to use to solve this, but there are two problems with what you're doing:</p>\n\n<ol>\n<li>You never add anything to the accumulator.</li>\n<li>You need to travel in two dimensions.</li>\n</ol>\n\n<p>So, traveling in two dimensions: there are two ways to do it. One is to keep a single function that keeps increasing <code>x</code> with each step until it gets to <code>-1</code> and then increases <code>y</code> by <code>1</code> and reset <code>x</code> to <code>1</code>. Another way - which I think in your case will be much, much easier - is to have two functions called <code>rekursBoard</code> and <code>rekursRow</code> (or whatever names you prefer) and the first function calls the second one to get the number of relevant ships in each row.</p>\n\n<p>With the two-function solution, what you'd want to do is:</p>\n\n<ol>\n<li>At the top level, call <code>rekursBoard 1 1 0</code> (the arguments there are <code>x</code>, <code>y</code>, and <code>res</code> - note that you don't need to keep passing the <code>board</code> function on down to the inner functions)</li>\n<li>In <code>rekursBoard</code> check if the given spot is off the board. If it is, the result is just <code>res</code>. If not, then the result is <code>rekursBoard (x+1) y (res+rowTotal)</code>, where <code>rowTotal</code> is computed by calling <code>rekursRow x y 0</code>.</li>\n<li>In <code>rekursRow</code>, check if the given spot is off the board. If it is, the result is just <code>res</code>. Otherwise, the result is <code>rekursRow x (y+1) (res+isOurBoat)</code>, where <code>isOurBoat</code> is computed as <code>1</code> if the boat at spot <code>x</code> and <code>y</code> matches the <code>k</code> the top-level function was given, and <code>0</code> if not.</li>\n</ol>\n\n<p>The overall structure of your function could look like this:</p>\n\n<pre><code>amountofships k board = -- .... some call here\n  where\n    rekursBoard x y res = -- ... some stuff here\n      where\n        rowTotal = -- ... some call here\n    rekursRow x y res = -- ... some stuff here\n      where\n        isOurBoat = -- ... something here\n</code></pre>\n\n<p>This isn't the only way to structure it, of course, it's just what I would do if I were writing up the answer sheet to this problem. Another very viable way to structure it is to make <code>rekursRow</code> something that's defined inside the <code>where</code> clause of <code>rekursBoard</code> and doesn't an <code>x</code> argument.</p>\n\n<p>Now, a word in general on working in Haskell - Haskell has a function called <code>return</code> that means <strong>almost nothing like you expect</strong>. Seriously, at this early stage of learning Haskell, don't use <code>return</code> unless you're copying boilerplate code from the book. <code>return</code> DOES NOT DO WHAT YOU EXPECT. I personally think that the function is poorly named and that modern Haskell courses should avoid ever putting <code>return</code> on the page and instead use <code>pure</code> every place where they use <code>return</code>. (since on modern Haskell compilers, <code>return</code> and <code>pure</code> are the same thing for all the standard Monads)</p>\n\n<p>Therefore, <em>if you put <code>return</code> in your Haskell code for this problem, you will be sorry</em>.</p>\n\n<p>Don't do it.</p>\n\n<p>Instead, get used to writing code like this:</p>\n\n<pre><code>countEmptySquare x y board = if board x y == 0 then 1 else 0\n</code></pre>\n\n<p>That is, just the form <code>if someExpression then onePossibility else otherPossibility</code>. No <code>return</code> statement, just bare expressions.</p>\n\n<p>This will seem tedious at first, breaking down each calculation into named pieces, but it gets better. However, for laying out what's going on at an early level you should work through the careful break down.</p>\n"}], "owner": {"reputation": 23, "user_id": 6726646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KDllX.jpg?s=128&g=1", "display_name": "Sarimon", "link": "https://stackoverflow.com/users/6726646/sarimon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 43560298, "answer_count": 2, "score": 1, "last_activity_date": 1492879421, "creation_date": 1492868157, "last_edit_date": 1492879421, "question_id": 43559893, "link": "https://stackoverflow.com/questions/43559893/checking-every-field-in-a-matrix-with-restriction", "title": "Checking every field in a &quot;matrix&quot; (with restriction)", "body": "<p>i just learned haskell yesterday and i'm stuck with a task.\ni have a Matrix given; implemented with a function like this:</p>\n\n<pre><code>board 1 1 = 0\nboard 1 2 = 1\nboard 1 3 = 0\nboard 2 1 = 2\nboard 2 2 = 0\nboard 2 3 = 0\nboard 3 1 = 1\nboard 3 2 = 0\nboard 3 3 = 2\nboard _ _ = -1\n</code></pre>\n\n<p>Just that you have a little context:\nthat matrix is used for a minified sinking ships game.\nso you would check an entry 2 1  like this</p>\n\n<pre><code>board 2 1\n</code></pre>\n\n<p>and get the respective result.\n0 is a default value, -1 doesnt exist; 1 stands for a ship owned by player 1, the same goes with 2.</p>\n\n<p>Now i have to write a function that just has to count the amount of ships owned by a specific player  and it should return that amount.\ne.g in that example board, the amount of 2's would be  2. \nHowever, i have a restriction that i cant use anything related to lists.\nI guess i have to work with recursion, and this is where i'm stuck.</p>\n\n<p>i already have made a try with this:\n(k is the player number and res should be the result.)</p>\n\n<pre><code>amountofships k board = rekurs 1 1 board res\n    where\n    res = 0\n    rekurs x y board res =\n        if (board x y == -1) then return(res)\n        else return(rekurs (x + 1) 1 board res)\n        where\n        new_rekurs a b board res2 =\n            if (board a b == -1) then return(res2)\n            else if (board a b == k) then return(new_rekurs a (b+1) board (res + 1))\n            else return(new_rekurs a (b+1) board res)\n            where\n            res2 = 0\n</code></pre>\n\n<p>Its meant to have a resursion function that goes through every column and inside that, it has another recursion function that would check every entry inside that column, return the amount, then check the next column, etc.</p>\n\n<p>it doesnt compile and i dont think its an elegant approach, but I cant think of another one.\nI would be thankful for any kind of help.</p>\n\n<p><strong>Edit :  Thank you all for your answers. I see where the problem in my Code was.</strong> </p>\n\n<p>I've used the structure proposed by Daniel, and it compiles at least:</p>\n\n<pre><code>amountofships k board = rekursColumn 1 1 0\n  where\n        rekursColumn x y res\n            | board x y = res\n            | otherwise = rekursColumn (x + 1) y (res + rowTotal)\n            where\n                rowTotal = rekursRow x y 0\n\n        rekursRow x y res\n            | board x y = res\n            | otherwise = rekursRow x (y + 1) (res + isOurBoat)\n            where\n                isOurBoat = if board x y == k then 1 else 0\n</code></pre>\n\n<p>I still get an <code>Could not deduce (Num Bool) arising from the literal \u20181\u2019</code> \nError when calling \n<code>amountofships 1 example_board</code>\n. I guess this is because i didnt specify what the input types are? Specially since one parameter is actually a function.</p>\n\n<p><strong>Edit2: Oh i see where the problem was. I need to check if <code>board x y == -1</code>\nmy Code is working now:</strong></p>\n\n<pre><code>amountofships :: Int -&gt; (Int -&gt; Int -&gt; Int) -&gt; Int\namountofships k board = rekursColumn 1 1 0\n  where\n        rekursColumn x y res\n            | board x y == -1 = res\n            | otherwise = rekursColumn (x + 1) y (res + rowTotal)\n            where\n                rowTotal = rekursRow x y 0\n\n        rekursRow x y res\n            | board x y == -1 = res\n            | otherwise = rekursRow x (y + 1) (res + isOurBoat)\n            where\n                isOurBoat = if board x y == k then 1 else 0\n</code></pre>\n\n<p><strong>Thank you all for your help!</strong></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1492870195, "creation_date": 1492870195, "answer_id": 43560197, "question_id": 43559234, "link": "https://stackoverflow.com/questions/43559234/scope-where-for-multiple-polymorphic-patterns/43560197#43560197", "title": "scope: where for multiple polymorphic patterns", "body": "<p>In your example, <code>buf'</code> is defined in terms of <code>x</code>, which is bound by the inner <code>case</code> expression, whereas <code>where</code> is actually \"outside\" of the expression in the right hand side.</p>\n\n<pre><code>paths' pt buf =\n  (case ... of ... -&gt; ...(1) ; ... -&gt; ...(2) )\n  where ...(3)\n</code></pre>\n\n<p><code>x</code> is only visible inside <code>(1)</code> and <code>(2)</code>, but not in <code>(3)</code>. The occurences of <code>x</code> in <code>(1)</code> and <code>(2)</code> should really be considered as two variables with the same name.</p>\n\n<p>If you want <code>x</code> to be visible inside that <code>where</code> clause, it must be bound on the left of the <code>=</code> sign. One way to do this is to factor <code>x</code> out of the <code>PolyTree</code> type.</p>\n\n<pre><code>data PolyTree a = PolyTree a (PolyBranch a)\ndata PolyBranch a = PolyBranch (PolyTree a) (PolyTree a) | PolyLeaf\n\npaths' (PolyTree x pt) buf = ...\n  where buf' = buf ++ [x]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1492872494, "creation_date": 1492872494, "answer_id": 43560573, "question_id": 43559234, "link": "https://stackoverflow.com/questions/43559234/scope-where-for-multiple-polymorphic-patterns/43560573#43560573", "title": "scope: where for multiple polymorphic patterns", "body": "<p>Having both variables named <code>x</code> in scope at that point would require quite weird scoping (and alpha-conversion) rules.</p>\n\n<p>Instead, you can handle each <code>x</code> separately.</p>\n\n<pre><code>paths' :: PolyTree a -&gt; [a] -&gt; PolyTree [a]\npaths' pt buf = case pt of\n  (PolyLeaf x)           -&gt; let\n     buf' = buf ++ [x]\n     in PolyLeaf buf'\n  (PolyBranch x pt1 pt2) -&gt; let\n     buf' = buf ++ [x]\n     in PolyBranch buf' (paths' pt1 buf') (paths' pt2 buf')\n</code></pre>\n\n<p>It could be a good idea to remove the <code>case</code> and using multiple defining equations, instead. You would still need to duplicate the <code>where</code>.</p>\n\n<pre><code>paths' (PolyLeaf x) buf = PolyLeaf buf'\n   where buf' = buf ++ [x]\npaths' (PolyBranch x pt1 pt2) buf = PolyBranch buf' (paths' pt1 buf') (paths' pt2 buf')\n   where buf' = buf ++ [x]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1492884087, "creation_date": 1492884087, "answer_id": 43562710, "question_id": 43559234, "link": "https://stackoverflow.com/questions/43559234/scope-where-for-multiple-polymorphic-patterns/43562710#43562710", "title": "scope: where for multiple polymorphic patterns", "body": "<p>Other answers already explain the reason, but here are two more alternative ways to write it which I would prefer to their suggestions:</p>\n\n<pre><code>paths' :: PolyTree a -&gt; [a] -&gt; PolyTree [a]\npaths' pt buf = case pt of\n  (PolyLeaf x)           -&gt; PolyLeaf (addBuf x)\n  (PolyBranch x pt1 pt2) -&gt; \n    let buf' = addBuf x in\n    PolyBranch buf' (paths' pt1 buf') (paths' pt2 buf')\n  where addBuf x = buf ++ [x]\n\npaths' :: PolyTree a -&gt; [a] -&gt; PolyTree [a]\npaths' pt buf = case pt of\n  (PolyLeaf x)           -&gt; PolyLeaf buf'\n  (PolyBranch x pt1 pt2) -&gt; PolyBranch buf' (paths' pt1 buf') (paths' pt2 buf')\n  where buf' = buf ++ [getX pt]\n        getX (PolyLeaf x) = x\n        getX (PolyBranch x pt1 pt2) = x\n</code></pre>\n"}], "owner": {"reputation": 2864, "user_id": 4858640, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c3eef6d48a6bc20ea9c2c2825dc9c6d6?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4858640/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 43560197, "answer_count": 3, "score": 2, "last_activity_date": 1492888647, "creation_date": 1492864276, "last_edit_date": 1495535463, "question_id": 43559234, "link": "https://stackoverflow.com/questions/43559234/scope-where-for-multiple-polymorphic-patterns", "title": "scope: where for multiple polymorphic patterns", "body": "<p>The accepted answer to <a href=\"https://stackoverflow.com/questions/27961795/where-clause-applied-to-multiple-patterns\">this SO post</a> shows how to use <code>case ... of</code> to utilize a <code>where</code> definition across multiple pattern-matches. Now in my case this doesn't seem to work (ghc complains: <code>Variable not in scope: x</code>).</p>\n\n<pre><code>data PolyTree a = PolyBranch a (PolyTree a) (PolyTree a) | PolyLeaf a\n\npaths' :: PolyTree a -&gt; [a] -&gt; PolyTree [a]\npaths' pt buf = case pt of\n  (PolyLeaf x)           -&gt; PolyLeaf buf'\n  (PolyBranch x pt1 pt2) -&gt; PolyBranch buf' (paths' pt1 buf') (paths' pt2 buf')\n  where buf' = buf ++ [x]\n</code></pre>\n\n<p>Can I do this another way?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1492861251, "post_id": 43558696, "comment_id": 74168615, "body": "In the <code>do</code> version you have 2 bindings and a return statement. In the version without <code>do</code> you use <code>&gt;&gt;</code>, which discards the result of its left operand and the only thing you ever return is <code>[]</code>. The <code>do</code> version also uses the <code>:</code> operator, which the <code>do</code>-less version does not."}], "answers": [{"comments": [{"owner": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "edited": false, "score": 0, "creation_date": 1492862031, "post_id": 43558807, "comment_id": 74168822, "body": "Thanks for your answer. If we call the function like: sequence [ putStr &quot;hi&quot; , pure 4] , this does not work, why?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "edited": false, "score": 1, "creation_date": 1492863375, "post_id": 43558807, "comment_id": 74169257, "body": "@AntonioSerrano What would be the type of <code>[ putStr &quot;hi&quot;, pure 4]</code>? <code>putStr &quot;hi&quot;</code> and <code>pure 4</code> have incompatible types, you can&#39;t put them in the same list (unless you create an <code>instance Num ()</code>, I suppose)."}, {"owner": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1495120168, "post_id": 43558807, "comment_id": 75128440, "body": "Okay, I got this, but why with the example [pure 1, pure 2] still does not work? @sepp2k"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "edited": false, "score": 0, "creation_date": 1495120715, "post_id": 43558807, "comment_id": 75128844, "body": "@AntonioSerrano <code>sequence [pure 1, pure 2]</code> produces <code>pure [1, 2]</code>. What makes you say it doesn&#39;t work?"}, {"owner": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1495121002, "post_id": 43558807, "comment_id": 75129060, "body": "Firstly, trying this: sequence (op:ops) =    op &gt;&gt;= (\\x -&gt; sequence ops &gt;&gt;= (\\xs -&gt; return (x:xs))) with sequence [pure 1, pure 2] , the console says &quot;main: main.hs:7:1-78: Non-exhaustive patterns in function mysequence &quot;. Secondly, when I solve this, with that example the console does not show anything, that&#39;s why I say it does not work. What result do you get? Thanks @sepp2k"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "edited": false, "score": 0, "creation_date": 1495121635, "post_id": 43558807, "comment_id": 75129469, "body": "@AntonioSerrano I type <code>sequence [pure 1, pure 2]</code> into GHCi and get <code>[1, 2]</code> as the result (because GHCi automatically unwraps IO). When you do something like <code>main = sequence [pure 1, pure 2]; return ()</code> in a program, then nothing will happen because the sequence has no side-effect - all the elements are pure after all."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1492861524, "creation_date": 1492861524, "answer_id": 43558807, "question_id": 43558696, "link": "https://stackoverflow.com/questions/43558696/io-sequence-haskell/43558807#43558807", "title": "IO sequence Haskell", "body": "<p>In applicative notation, it's quite simple:</p>\n\n<pre><code>sequence (op:ops) = (:) &lt;$&gt; op &lt;*&gt; sequence ops\n</code></pre>\n\n<p>Im monadic notation, just translate <code>do</code> while keeping its structure:</p>\n\n<pre><code>sequence (op:ops) =\n   op             &gt;&gt;= \\x -&gt;\n   sequence ops   &gt;&gt;= \\xs -&gt;\n   return (x:xs)\n</code></pre>\n\n<p>Roughly, <code>x &lt;- action; ...</code> becomes <code>action &gt;&gt;= \\x -&gt; ...</code>. Note that the scope of the lambdas above extends until the very end of the expressions. With explicit parentheses:</p>\n\n<pre><code>sequence (op:ops) =\n   op &gt;&gt;= (\\x -&gt; sequence ops &gt;&gt;= (\\xs -&gt; return (x:xs)))\n</code></pre>\n"}], "owner": {"reputation": 357, "user_id": 7559069, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a12d26c0f18887e7bd11431459b0fefd?s=128&d=identicon&r=PG&f=1", "display_name": "Antonio Serrano", "link": "https://stackoverflow.com/users/7559069/antonio-serrano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 884, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1495460497, "creation_date": 1492860674, "last_edit_date": 1495460497, "question_id": 43558696, "link": "https://stackoverflow.com/questions/43558696/io-sequence-haskell", "title": "IO sequence Haskell", "body": "<p>I have this function:</p>\n\n<pre><code>sequence :: [IO a] -&gt; IO [a]\nsequence [] = pure []\nsequence (op:ops) = do\n    x &lt;- op\n    xs &lt;- sequence ops\n    return (x:xs)\n</code></pre>\n\n<p>which just writes a sequence of IO actions.</p>\n\n<p>The problem is that I want to write the same function, but without using the 'do notation' at all, just using the operator >> and >>= instead.</p>\n\n<p>I already have this version: </p>\n\n<pre><code>mySequence:: [IO a]-&gt; IO [a]\nmySequence [] = pure []\nmySequence (op:ops) =\n    op &gt;&gt; sequence ops\n</code></pre>\n\n<p>but it does not work for example with the input [ pure 1 , pure 2 ].</p>\n\n<p>Could anyone help me with this?</p>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["algorithm", "haskell", "signal-processing"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1492879694, "post_id": 43558345, "comment_id": 74174643, "body": "BTW, this operation is called <a href=\"https://en.wikipedia.org/wiki/Convolution\" rel=\"nofollow noreferrer\">convolution</a>. In the <i>O</i> (<i>n</i> &#178;) form you have here, this is always slow regardless of language, if both input arrays are big. The industry standard is therefore to use a <i>fast convolution</i> based on <a href=\"https://en.wikipedia.org/wiki/Fast_Fourier_transform\" rel=\"nofollow noreferrer\">FFT</a>, which only takes <i>O</i> (<i>n</i> &#183; log <i>n</i>). If one of the arrays is small, Daniel Martin&#39;s version should be fine, though."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1492880482, "post_id": 43558345, "comment_id": 74174950, "body": "Yes, you&#39;re right! I&#39;ll think about looking into using the FFT."}], "answers": [{"comments": [{"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1492880368, "post_id": 43561481, "comment_id": 74174898, "body": "I was thinking about doing an implementation using slices but totally forgot about it for some reason. Thanks a lot for this version (and the correction)! It shaves a good 8 seconds of the time."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 2, "last_activity_date": 1492877555, "creation_date": 1492877555, "answer_id": 43561481, "question_id": 43558345, "link": "https://stackoverflow.com/questions/43558345/implementing-a-fir-filter-using-vectors/43561481#43561481", "title": "Implementing a FIR filter using Vectors", "body": "<p>First of all, I don't think that your initial vector code is a faithful translation - that is, I think it disagrees with the C# code. For example, suppose that both \"x\" and \"b\" (\"b\" is <code>coeff</code> in C#) have length 3, and have all values of <code>1.0</code>. Then for <code>y[0]</code> the C# code would produce <code>x[0] * coeff[0]</code>, or <code>1.0</code>. (it would hit <code>continue</code> for all other values of <code>bi</code>)</p>\n\n<p>With your Haskell code, however, <code>help 0</code> produces 0. Your <code>Repa</code> version seems to suffer from the same problem.</p>\n\n<p>So let's start with a more faithful translation:</p>\n\n<pre><code>applyFIR :: Vector Double -&gt; Vector Double -&gt; Vector Double\napplyFIR b x = generate (U.length x) help\n    where\n      help i = loop i (min i $ U.length b - 1)\n      loop yi bi = if bi &lt; 0 then 0 else b !! bi * x !! (yi-bi) + loop yi (bi-1)\n      vec !! i = unsafeIndex vec i -- Shorthand for unsafeIndex\n</code></pre>\n\n<p>Now, you're basically doing a calculation like this for computing, say, <code>y[3]</code>:</p>\n\n<pre><code>  ... b[3]   |   b[2]   |   b[1]   |   b[0]\n      x[0]   |   x[1]   |   x[2]   |   x[3]   |   x[4]   |   x[5]   | ....\n           multiply\n    b[3]*x[0]|b[2]*x[1] |b[1]*x[2] |b[0]*x[3] \n           sum\n      y[3] = b[3]*x[0] + b[2]*x[1] + b[1]*x[2] + b[0]*x[3]\n</code></pre>\n\n<p>So one way to think of what you're doing is \"take the <code>b</code> vector, reverse it, and to compute spot <code>i</code> of the result, line <code>b[0]</code> up with <code>x[i]</code>, multiply all the corresponding <code>x</code> and <code>b</code> entries, and compute the sum\".</p>\n\n<p>So let's do that:</p>\n\n<pre><code>applyFIR :: Vector Double -&gt; Vector Double -&gt; Vector Double\napplyFIR b x = generate (U.length x) help\n  where\n    revB = U.reverse b\n    bLen = U.length b\n    help i = let sliceLen = min (i+1) bLen\n                 bSlice = U.slice (bLen - sliceLen) sliceLen revB\n                 xSlice = U.slice (i + 1 - sliceLen) sliceLen x\n             in U.sum $ U.zipWith (*) bSlice xSlice\n</code></pre>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 43561481, "answer_count": 1, "score": 0, "last_activity_date": 1492877555, "creation_date": 1492858378, "question_id": 43558345, "link": "https://stackoverflow.com/questions/43558345/implementing-a-fir-filter-using-vectors", "title": "Implementing a FIR filter using Vectors", "body": "<p>I have implemented a FIR filter in Haskell. I don't know that much about FIR filters and my code is heavily based on an existing C# implementation. Therefore, I have a feeling that my implementation is has too much of a C# style and is not really Haskell-like. I would like to know if there is a more idiomatic Haskell way of implementing my code. Ideally, I'm lucky for some combination of higher-order functions (map, filter, fold, etc.) that implement the algorithm.  </p>\n\n<p>My Haskell code looks like this:</p>\n\n<pre><code>  applyFIR :: Vector Double -&gt; Vector Double -&gt; Vector Double\n  applyFIR b x = generate (U.length x) help\n      where\n        help i = if i &gt;= (U.length b - 1) then loop i (U.length b - 1) else 0\n        loop yi bi = if bi &lt; 0 then 0 else b !! bi * x !! (yi-bi) + loop yi (bi-1)\n        vec !! i = unsafeIndex vec i -- Shorthand for unsafeIndex\n</code></pre>\n\n<p>This code is based on the following C# code:</p>\n\n<pre><code>public float[] RunFilter(double[] x)\n      {\n         int M = coeff.Length;\n         int n = x.Length;\n         //y[n]=b0x[n]+b1x[n-1]+....bmx[n-M]\n         var y = new float[n];\n         for (int yi = 0; yi &lt; n; yi++)\n         {\n            double t = 0.0f;\n            for (int bi = M - 1; bi &gt;= 0; bi--)\n            {\n               if (yi - bi &lt; 0) continue;\n\n               t += coeff[bi] * x[yi - bi];\n            }\n            y[yi] = (float) t;\n         }\n\n         return y;\n      }\n</code></pre>\n\n<p>As you can see, it's almost a straight copy. How can I turn my implementation into a more Haskell-like one? Do you have any ideas? The only thing I could come up with was using <code>Vector.generate</code>. </p>\n\n<p>I know that the <code>DSP</code> library has an implementation available. But it uses lists and is way too slow for my use case. This <code>Vector</code> implementation is a lot faster than the one in <code>DSP</code>. </p>\n\n<p>I've also tried implementing the algorithm using <code>Repa</code>. It is faster than the <code>Vector</code> implementation. Here is the result:</p>\n\n<pre><code>applyFIR :: V.Vector Float -&gt; Array U DIM1 Float -&gt; Array D DIM1 Float\napplyFIR b x = R.traverse x id (\\_ (Z :. i) -&gt; if i &gt;= len then loop i (len - 1) else 0)\n  where\n    len = V.length b\n    loop :: Int -&gt; Int -&gt; Float\n    loop yi bi = if bi &lt; 0 then 0 else (V.unsafeIndex b bi) * x !! (Z :. (yi-bi)) + loop yi (bi-1)\n    arr !! i = unsafeIndex arr i\n</code></pre>\n"}, {"tags": ["haskell", "audio", "midi", "euterpea"], "answers": [{"tags": [], "owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "is_accepted": false, "score": 0, "last_activity_date": 1501681917, "creation_date": 1501681917, "answer_id": 45462838, "question_id": 43558317, "link": "https://stackoverflow.com/questions/43558317/euterpea-exception-no-midi-output-device-found/45462838#45462838", "title": "Euterpea Exception: No MIDI output device found", "body": "<p>Perhaps you solved this, but for posterity some ideas:</p>\n\n<hr>\n\n<p>Sounds like you didn't install <strong>and run</strong> a MIDI synth (e.g. <a href=\"http://notahat.com/simplesynth/\" rel=\"nofollow noreferrer\">SimpleSynth</a>) first. AFAICT, Audio MIDI Setup doesn't actually include a software synthesizer, it's more for <a href=\"http://www.soundonsound.com/techniques/audio-midi-setup\" rel=\"nofollow noreferrer\">advanced / hardware MIDI setup</a>.</p>\n\n<p>This should create the MIDI output devices that Euterpea couldn't find there. You may also need to play around with channels (e.g. use <code>playDev n</code> instead of <code>play</code> and work out a value for n from your device list... or even just try 1 through 8)</p>\n\n<p>Either way there's some good Mac-focussed help on Donya's <a href=\"http://www.donyaquick.com/working-with-midi-on-mac-os-x/\" rel=\"nofollow noreferrer\">working with MIDI on Mac OS X</a> page. Hope that helps.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1548887121, "creation_date": 1492858234, "last_edit_date": 1548887121, "question_id": 43558317, "link": "https://stackoverflow.com/questions/43558317/euterpea-exception-no-midi-output-device-found", "title": "Euterpea Exception: No MIDI output device found", "body": "<p>I am trying to get started using Haskell's <a href=\"https://hackage.haskell.org/package/Euterpea\" rel=\"nofollow noreferrer\">Euterpea</a> library. My first goal was to get it to play a given sound file (e.g. mp3 or wav), but first I ran into an issue following instructions to get it to just play a simple note sound in ghci.</p>\n\n<p>Following the \"Setting up MIDI\" instructions at Euterpea's <a href=\"http://www.euterpea.com/download-and-installation/\" rel=\"nofollow noreferrer\">web page</a>, I ran</p>\n\n<pre><code>import Euterpea\nplay $ c 4 qn\n</code></pre>\n\n<p>in ghci. The 'play' command resulted in the following error message:</p>\n\n<pre><code>Prelude Euterpea&gt; play $ c 4 qn\n*** Exception: No MIDI output device found\nCallStack (from HasCallStack):\n  error, called at ./Euterpea/IO/MIDI/MidiIO.lhs:122:18 in Euterpea-2.0.2-Iz37iWlkpjn2emP4FnvOI1:Euterpea.IO.MIDI.MidiIO\n</code></pre>\n\n<p>I thought I needed to specify midi output to my machine (macOS Sierra) and found an application called 'Audio MIDI Setup', but it showed that a midi output (my internal speakers) was already specified.</p>\n\n<p>Anyone know what this issue is or how to fix it?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1492853419, "post_id": 43557017, "comment_id": 74166291, "body": "Perhaps try nesting two or more list comprehensions"}, {"owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492897451, "post_id": 43557017, "comment_id": 74180685, "body": "Certanly, the question is how to go about it"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492930421, "post_id": 43557017, "comment_id": 74186598, "body": "Hmm it doesn&#39;t look like it is easily doable without recursion. Where did you find this exercise?"}, {"owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1492932828, "post_id": 43557017, "comment_id": 74187160, "body": "I found it in &quot;Introduction to functional programming&quot; (Bird/Wadlers), first edition, in the section related to list comprehensions."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1493017699, "post_id": 43557017, "comment_id": 74212760, "body": "I don&#39;t think it is possible to do this exercise with just the functions introduced up until that point in the book, unless you take <code>n</code> to be a known constant rather than a function parameter. I heard you can email Bird and ask for clarification."}, {"owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1493132505, "post_id": 43557017, "comment_id": 74277589, "body": "I sent him an email, if I get feedback, I&#39;ll post it. Thanks for the suggestion!"}, {"owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1493236751, "post_id": 43557017, "comment_id": 74335240, "body": "@n.m. I asked Richard Bird and he kindly replied. I posted the answer. Thanks for you help."}], "answers": [{"comments": [{"owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "edited": false, "score": 0, "creation_date": 1492890150, "post_id": 43557166, "comment_id": 74178447, "body": "One of the premises of the problem is solving it without using recursion. Thanks for your answer anyway"}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1492881094, "last_edit_date": 1492881094, "creation_date": 1492850777, "answer_id": 43557166, "question_id": 43557017, "link": "https://stackoverflow.com/questions/43557017/exponentiation-using-list-comprehension/43557166#43557166", "title": "Exponentiation using list comprehension", "body": "<p>May be you can do as follows;</p>\n\n<pre><code>pow :: Int -&gt; Int -&gt; Int\npow 0 _ = 1\npow 1 x = x\npow n x = length [1 | y &lt;- [1..x], z &lt;- [1..pow (n-1) x]]\n</code></pre>\n\n<p>so <code>pow 3 2</code> would return 8</p>\n"}, {"tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 3, "last_activity_date": 1492943684, "creation_date": 1492943684, "answer_id": 43570011, "question_id": 43557017, "link": "https://stackoverflow.com/questions/43557017/exponentiation-using-list-comprehension/43570011#43570011", "title": "Exponentiation using list comprehension", "body": "<p>A naturally-occurring exponential comes from <code>sequence</code>:</p>\n\n<pre><code>length (sequence [[1..x] | _ &lt;- [1..n]])\n</code></pre>\n\n<p>If you haven't seen <code>sequence</code> yet, it's quite a general function but\nwhen used with lists it works like:</p>\n\n<pre><code>sequence [xs1, ... , xsk] = [[x1, ... xk] | x1 &lt;- xs1, ... , xk &lt;- xsk]\n</code></pre>\n\n<p>But this is really cheating since <code>sequence</code> is defined recursively.</p>\n\n<hr>\n\n<p>If you want to use nothing but length and list comprehensions I think\nit might be impossible.  The rest of this answer will be sketchy and I half\nexpect someone to prove me wrong.  However:</p>\n\n<p>We'll try to prove that such an expression can only compute values up\nto some finite power of <em>x</em> or <em>n</em>, and therefore can't compute values\nas big as <em>x^n</em> for arbitrary <em>x</em> and <em>n</em>.</p>\n\n<p>Specifically we show by induction on the structure of expressions that\nany expression <em>expr</em> has an upper bound <em>ub(expr, m) = m^k</em> where <em>m</em>\nis the maximum of the free variables it uses, and <em>k</em> is a known finite\npower which we could calculate from the structure of the expression <em>expr</em>.</p>\n\n<p>(When we look at the whole expression, <em>m</em> will be <em>max x n</em>.)</p>\n\n<p>Our upper bounds on list expressions will be bounds on both the length of the list and also bounds on any of\nits elements (and lengths of its elements, etc.).</p>\n\n<p>For example if we have <code>[x..y]</code> and we know that <em>x &lt;= m</em> and <em>y &lt;= m</em>, we\nknow that all the elements are <em>&lt;= m</em> and the length is also <em>&lt;= m</em>.\nSo we have <em>ub([x..y], m) = m^1</em>.</p>\n\n<p>The tricky case is the list comprehension:</p>\n\n<pre><code>[eleft | x1 &lt;- e1, ... , xk &lt;- ek]\n</code></pre>\n\n<p>The result will have length equal to <em>length e1 * ... * length ek</em>, so\nan upper bound for it would be the product of the upper bounds for\n<em>e1</em> to <em>ek</em>, or if <em>m^i</em> is the maximum of these then an upper bound\nwould be <em>(m^i)^k = m^(i*k)</em>.</p>\n\n<p>To get a bound on the elements, suppose expression <em>eleft</em> has <em>ub(eleft, m') = m'^j</em>.  It can use <em>x1\n... xk</em>.  If <em>m^i</em> is an upper bound for these, as above, we need to\ntake <em>m' = m^i</em> and so <em>ub(eleft, m) = (m^i)^j = m^(i*j)</em></p>\n\n<p>As a conservative upper bound for the whole list comprehension <em>e</em> we\ncould take <em>ub(e, m) = m^(i*j*k)</em>.</p>\n\n<p>I should really also work through cases for pattern matching\n(shouldn't be a problem because the parts matched are smaller than\nwhat we already had), <code>let</code> definitions and functions (but we banned\nrecursion, so we can just fully expand these before we start), and\nlist literals like <code>[x,37,x,x,n]</code> (we can throw their lengths\ninto <em>m</em> as initially-available values).</p>\n\n<p>If infinite lists like <code>[x..]</code> or <code>[x,y..]</code> are allowed they would need some\nthinking about.  We can construct <code>head</code> and <code>filter</code>, which means we can get\nfrom an infinite list to its first element matching a predicate, and that looks suspiciously like a way to get recursive functions.  I don't\n<em>think</em> it's a problem since 1. they are only arithmetic sequences and\n2. we'll have to construct any numbers we want to use in the\npredicate.  But I'm not certain here.</p>\n"}, {"comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1493421173, "post_id": 43643444, "comment_id": 74426374, "body": "Wow.. i can not believe that this can be an exercise in a book targeting to teach you something. This turns out to be my previous answer (check the edits) that i have shamefully deleted. <code>pow n x = product [y | y &lt;- replicate n x]</code>. I did this and a few moments later i have thought, &quot;why in the world one should use a list comprehension for this job..?&quot; You can always do <code>product $ replicate n x</code>. No offence but i wouldn&#39;t bother reading that book further. Try Graham Hutton&#39;s Programming in Haskell instead."}, {"owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1504352994, "post_id": 43643444, "comment_id": 78986943, "body": "The book is incredibly good: it teaches you functional programming (not bound to haskell) in a mathematical way. The exercises are tough and lead you to think out of the box and try new solutions or explore new ways in order to solve them (which is great!). As I pointed out in my question, my premises to solve this exercise included no recursion or pattern matching (these techniques are well known and make the solution to the exercise trivial). I only added this answer to help anyone who tries to solve this exercise (or similar) trying to use list comprehension as well"}], "tags": [], "owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "is_accepted": true, "score": 1, "last_activity_date": 1493236599, "creation_date": 1493236599, "answer_id": 43643444, "question_id": 43557017, "link": "https://stackoverflow.com/questions/43557017/exponentiation-using-list-comprehension/43643444#43643444", "title": "Exponentiation using list comprehension", "body": "<p>As @n.m suggested, I asked Richard Bird (author of the book \"Introduction to functional programming\", first edition, the book where I got the exercise) for an answer/guidance in solving this exercise. He kindly replied and here I post the answer he gave me:</p>\n\n<blockquote>\n  <p>Since a list comprehension returns a list not a number, x^n cannot be\n  defined as an instance of a list comprehension. Your solution x^n =\n  product [x | c &lt;- [1..n]] is the correct one.</p>\n</blockquote>\n\n<p>So, I guess I'll stick to the solution I posted (and discarded for using recursion):</p>\n\n<pre><code>foldr (*) 1 [x | c &lt;- [1..n]]\n</code></pre>\n\n<p>He didn't say anything about creating a list of x^n elements with lists comprehensions (no recursion) though as @David Fletcher and @n.m point out in their comments, it might be impossible.</p>\n"}], "owner": {"reputation": 6566, "user_id": 3565885, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/BetMM.jpg?s=128&g=1", "display_name": "acontell", "link": "https://stackoverflow.com/users/3565885/acontell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 0, "accepted_answer_id": 43643444, "answer_count": 3, "score": 5, "last_activity_date": 1493236599, "creation_date": 1492849671, "question_id": 43557017, "link": "https://stackoverflow.com/questions/43557017/exponentiation-using-list-comprehension", "title": "Exponentiation using list comprehension", "body": "<p>I'm trying to solve the following exercise (I'm learning Haskell):</p>\n\n<blockquote>\n  <p>Define x^n using a list comprehension.</p>\n</blockquote>\n\n<p>And I'm struggling to find a solution.</p>\n\n<p>Using recursion or fold, the solution is not complicated (for instance, <code>foldr (*) 1 [x | c &lt;- [1..n]]</code>). However, using only list comprehension it gets difficult (at least for me).</p>\n\n<p>In order to solve the problem, I'm trying to create a list of x^n elements and then get the length. Generating a list of x*n elements is easy, but I fail to generate a list of x^n elements.</p>\n\n<pre><code>ppower x n = length [1 | p &lt;- [1..x], c &lt;- [1..n]]\n</code></pre>\n\n<p>returns a list of x*n elements giving a wrong result. Any ideas on this will be appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 0, "creation_date": 1492823866, "post_id": 43554099, "comment_id": 74160399, "body": "If you can change your signature to <code>countChar :: Char -&gt; Trie -&gt; Integer</code> you could do <code>sum(map (countChar target) children))</code>"}, {"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "reply_to_user": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 0, "creation_date": 1492824195, "post_id": 43554099, "comment_id": 74160461, "body": "@moondaisy thanks, I will try out your suggestion"}, {"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "reply_to_user": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 0, "creation_date": 1492824332, "post_id": 43554099, "comment_id": 74160487, "body": "@moondaisy Hmm...it doesn&#39;t compile correctly.  Is this what you were suggesting? countChar (MakeTrie root children) target = sum(map (countChar target) children)"}], "answers": [{"tags": [], "owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "is_accepted": true, "score": 2, "last_activity_date": 1492824514, "creation_date": 1492824514, "answer_id": 43554245, "question_id": 43554099, "link": "https://stackoverflow.com/questions/43554099/haskell-writing-a-function-that-searches-and-counts-in-trie-structure/43554245#43554245", "title": "Haskell - Writing a function that searches and counts in Trie structure", "body": "<p>If you can change the signature of your method to <code>countChar :: Char -&gt; Trie -&gt; Integer</code> then you can do this:</p>\n\n<pre><code>countChar :: Char -&gt; Trie -&gt; Integer\ncountChar target (MakeTrie root children) \n    | root == target = (1 + sum(map (countChar target) children))\n    | otherwise = (0 +sum(map (countChar target) children))\n</code></pre>\n\n<p>This way you can use <code>map</code> on the list of <code>Trie</code>.</p>\n\n<p>For example given <code>countChar 'A' (MakeTrie 'A' [MakeTrie 'B' [MakeTrie 'A' [] ], MakeTrie 'C' []])</code> it will return 2.</p>\n"}, {"comments": [{"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 0, "creation_date": 1492890324, "post_id": 43555301, "comment_id": 74178503, "body": "Great answer, although it&#39;s probably more advanced than what we&#39;re expected to know for Haskell types haha."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 4, "last_activity_date": 1492836028, "creation_date": 1492836028, "answer_id": 43555301, "question_id": 43554099, "link": "https://stackoverflow.com/questions/43554099/haskell-writing-a-function-that-searches-and-counts-in-trie-structure/43555301#43555301", "title": "Haskell - Writing a function that searches and counts in Trie structure", "body": "<p>A slightly more \"fun\" way to define <code>Trie</code> is</p>\n\n<pre><code>type Trie = Cofree [] Char\n</code></pre>\n\n<p>This gives us a <code>Foldable</code> instance for free, since <code>[]</code> is <code>Foldable</code>. We could have also just added a <code>deriving Foldable</code> to the data decl for <code>Trie</code>.</p>\n\n<p>This means we can do:</p>\n\n<pre><code>countChar :: (Eq a,Num n,Foldable t) =&gt; a -&gt; t a -&gt; n\ncountChar c = foldr (\\c' a -&gt; if c == c' then a + 1 else a) 0\n</code></pre>\n\n<p>That type signature can be specialized to just <code>Char -&gt; Trie -&gt; Integer</code> if you want. (With <code>a ~ Char</code>, <code>t ~ Cofree []</code>, <code>n ~ Integer</code>)</p>\n\n<p>You could also implement this with <code>Sum</code>:</p>\n\n<pre><code>countChar :: (Eq a,Num n,Foldable t) =&gt; a -&gt; t a -&gt; n\ncountChar c = getSum . foldMap (\\c' -&gt; if c == c' then Sum 1 else Sum 0)\n</code></pre>\n\n<p>Moral of the story: Utilize typeclasses and other existing mechanisms to sidestep boilerplate and generalize your code.</p>\n"}], "owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 43554245, "answer_count": 2, "score": 0, "last_activity_date": 1492836028, "creation_date": 1492823073, "question_id": 43554099, "link": "https://stackoverflow.com/questions/43554099/haskell-writing-a-function-that-searches-and-counts-in-trie-structure", "title": "Haskell - Writing a function that searches and counts in Trie structure", "body": "<p>This is how the Trie data structure is declared in my code:</p>\n\n<pre><code>data Trie = MakeTrie Char [Trie]\n</code></pre>\n\n<p>Now I have to write a function called countChar that receives a Trie and a target value (of Char type) and counts how many times target value appears in the Trie.</p>\n\n<p>This is the code I've written:</p>\n\n<pre><code>countChar :: Trie -&gt; Char -&gt; Integer\ncountChar (MakeTrie root []) target \n    | root == target = 1\n    | otherwise = 0\ncountChar (MakeTrie root children) target \n    | root == target = 1 + ...\n    | otherwise = 0 + ...\n</code></pre>\n\n<p>Originally I wanted to do something that maps the function like this:</p>\n\n<pre><code>...otherwise = 0 + foldr1 (+) (map count children target)\nwhere\ncount = countChar t c\n</code></pre>\n\n<p>But I think that doesn't work properly and now I'm more or less out of ideas of what to do in order to make the function work.</p>\n"}, {"tags": ["haskell", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1492855835, "post_id": 43552381, "comment_id": 74166999, "body": "Thank you a lot! This is a really stupid error - but I did not see anything in the documentation mention this? could somebody please add a hint! I will try on the two wiki entries for FFI - but perhaps somebody with more experience with FFI should do this!"}, {"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "reply_to_user": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1492971077, "post_id": 43552381, "comment_id": 74199571, "body": "@user855443 It&#39;s not Haskell-specific. Linking to <code>libfoo.so</code>/<code>libfoo.a</code> libraries is always done using <code>foo</code> as the name (e.g. <code>-lfoo</code> in C)."}, {"owner": {"reputation": 2696, "user_id": 1352426, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/mQFHO.png?s=128&g=1", "display_name": "v0d1ch", "link": "https://stackoverflow.com/users/1352426/v0d1ch"}, "edited": false, "score": 0, "creation_date": 1561404940, "post_id": 43552381, "comment_id": 100044751, "body": "This answer saved my life! Thank you"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 7, "last_activity_date": 1492810632, "creation_date": 1492810632, "answer_id": 43552381, "question_id": 43551745, "link": "https://stackoverflow.com/questions/43551745/missing-c-library/43552381#43552381", "title": "Missing C library:", "body": "<p>I assume you're getting the error message:</p>\n\n<pre><code>* Missing C library: libtreetagger\n</code></pre>\n\n<p>If so, the likely problem is that <code>extra-libraries</code> should list libraries without the <code>lib</code> prefix:</p>\n\n<pre><code>extra-libraries: treetagger\n</code></pre>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 965, "favorite_count": 0, "accepted_answer_id": 43552381, "answer_count": 1, "score": 1, "last_activity_date": 1492810632, "creation_date": 1492807587, "question_id": 43551745, "link": "https://stackoverflow.com/questions/43551745/missing-c-library", "title": "Missing C library:", "body": "<p>I have written some simplistic code to call a function in a C library. The code compiles (and a similar piece works for a standard C library) but when I compile and link, ghc cannot find the C library. My cabal files is:</p>\n\n<pre><code>executable ttclient\nmain-is:    MainFFI4TT.hs\nbuild-depends: base\ndefault-language: Haskell2010\nhs-source-dirs: src\nother-modules:\nInclude-dirs: treetaggerSourceC \nIncludes: tagger-api.h\nextra-libraries: libtreetagger\nextra-lib-dirs: /usr/lib \n</code></pre>\n\n<p>the file <code>libtreetagger.so</code> is in <code>/usr/lib</code> but cannot be found. what else would be reuqired? It does not make a difference whether I use <code>stack build</code> or <code>cabal install</code> (8.0.2 or 8.0.1). cabal is version 1.24.0.0 and the system is linux debian stretch. </p>\n\n<p>I would prefer to keep the library in a user dir and not a system dir. Can this be achieved? </p>\n\n<p>The haskell code is: </p>\n\n<pre><code>foreign import ccall \"tagger-api.h init_treetagger\"    \n    c_initTreeTagger :: CString -&gt; IO ()   \n    -- void init_treetagger(char *param_file_name);\n\nmainFFItest :: IO ()\nmainFFItest = do \n\n    c_initTreeTagger \"german-utf8.par\"\n</code></pre>\n"}, {"tags": ["haskell", "memory", "lazy-evaluation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1492795316, "post_id": 43548370, "comment_id": 74149446, "body": "My guess: the latter can&#39;t garbage-collect <code>x</code> as it&#39;s consumed. What is <code>L</code> and <code>readFiles</code>? It&#39;s kind of hard to reliably check such a guess without knowing the code."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1492795909, "post_id": 43548370, "comment_id": 74149777, "body": "I added the definitions for <code>L</code> and <code>readFiles</code>. In the second case is there something to collect? Since the list in <code>readFiles</code> is constructed as needed..."}], "answers": [{"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1492829144, "post_id": 43550035, "comment_id": 74161331, "body": "You might want to point out that this is in GHCI. In a GHC program, the former would be optimized to the latter variant."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1492800794, "creation_date": 1492800794, "answer_id": 43550035, "question_id": 43548370, "link": "https://stackoverflow.com/questions/43548370/cs240-the-extra-150-mb-used-by-recdir-under-two-similar-circumstances/43550035#43550035", "title": "cs240: the extra 150 MB used by recDir under two similar circumstances", "body": "<p>Compare this to:</p>\n\n<pre><code>&gt; let xs = [1..999999999]\n&gt; length xs\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; length [1..999999999]\n</code></pre>\n\n<p>In the second case, the garbage collector can clean up the list as it's being consumed, so you use up very little memory. But in the first case, you still hold a reference to <code>xs</code>, and you might type in <code>xs !! 555</code> at any time. So the garbage collector must keep the entirety of <code>xs</code> in memory for you.</p>\n\n<p>Likewise in your example, one version has a reference to <code>x</code> that might be reused later, and so the contents of <code>x</code> must be preserved.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 43550035, "answer_count": 1, "score": 1, "last_activity_date": 1492800794, "creation_date": 1492794310, "last_edit_date": 1492795882, "question_id": 43548370, "link": "https://stackoverflow.com/questions/43548370/cs240-the-extra-150-mb-used-by-recdir-under-two-similar-circumstances", "title": "cs240: the extra 150 MB used by recDir under two similar circumstances", "body": "<p>I'm going through the slides of <a href=\"http://www.scs.stanford.edu/16wi-cs240h/slides/iteratee-slides.html#(11)\" rel=\"nofollow noreferrer\">Functional Systems in Haskell</a>. In that lecture, there is a function defined <code>recDir2</code> which uses <code>unsafeInterleaveIO</code> to list all the files in a directory recursively:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy       as L\n\nrecDir2 :: FilePath -&gt; IO [FilePath]\nrecDir2 dir = do\n  ds &lt;- openDirStream dir\n  let protect m = m `onException` closeDirStream ds\n\n      nextName = unsafeInterleaveIO $\n                 protect (readDirStream ds) &gt;&gt;= checkName\n\n      checkName \"\" = closeDirStream ds &gt;&gt; return []\n      checkName \".\" = nextName\n      checkName \"..\" = nextName\n      checkName name = getSymbolicLinkStatus path &gt;&gt;= checkStat path\n          where path = dir &lt;/&gt; name\n\n      checkStat path stat\n          | isRegularFile stat = liftM (path :) nextName\n          | isDirectory stat =\n              liftM2 (++) (protect $ recDir2 path) nextName\n          | otherwise = nextName\n\n  nextName\n</code></pre>\n\n<p>Where</p>\n\n<pre><code>readFiles :: [FilePath] -&gt; IO L.ByteString\nreadFiles [] = return L.empty\nreadFiles (f:fs) = liftM2 L.append (L.readFile f)\n                   (unsafeInterleaveIO $ readFiles fs)\n</code></pre>\n\n<p>This function is used later in two seemingly equal situations:</p>\n\n<pre><code>*Main&gt; recDir2 \"/usr/include\" &gt;&gt;= readFiles &gt;&gt;= print . L.length\n\n*Main&gt; x &lt;- recDir2 \"/usr/include\" &gt;&gt;= readFiles\n*Main&gt; L.length x\n</code></pre>\n\n<p>However in the slides it is stated that the second case uses an extra 150 MB, but I fail to see the reasons why. What is causing this allegedly extra memory usage?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 2, "creation_date": 1492793952, "post_id": 43548216, "comment_id": 74148607, "body": "Why are you asking &quot;if any&quot;? Does it work as intended? Are you asking for a <a href=\"https://codereview.stackexchange.com\">Code Review</a>?"}, {"owner": {"reputation": 113, "user_id": 1751175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e50d1c468c5892705a645df69f9b5c?s=128&d=identicon&r=PG", "display_name": "UGPhysics", "link": "https://stackoverflow.com/users/1751175/ugphysics"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1492794102, "post_id": 43548216, "comment_id": 74148711, "body": "Yes. A code review. My answer: 266333 is supposedly incorrect according to Project Euler."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1492794696, "post_id": 43548216, "comment_id": 74149078, "body": "You&#39;re counting 15 twice."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 9, "creation_date": 1492794982, "post_id": 43548216, "comment_id": 74149255, "body": "I find <code>(multOfThree ++ multOfFive) -- commonValues</code> a pretty awesome mistake. I know exactly what you wanted this to do, but <code>--</code> starts a comment. (You must know, given how many other comments you wrote, but perhaps it slipped your mind. =) The function is actually called <code>(\\\\)</code>. (There are other mistakes, too, though: try predicting the value of <code>length commonValues</code>, then asking ghci whether your prediction is right.)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1492795346, "post_id": 43548216, "comment_id": 74149473, "body": "@UGPhysics: Please note that <a href=\"https://codereview.stackexchange.com\">Code Review</a> is only appropriate if your code works. At the moment, it doesn&#39;t. Keep that in mind before your question gets closed there."}, {"owner": {"reputation": 113, "user_id": 1751175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e50d1c468c5892705a645df69f9b5c?s=128&d=identicon&r=PG", "display_name": "UGPhysics", "link": "https://stackoverflow.com/users/1751175/ugphysics"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1492796182, "post_id": 43548216, "comment_id": 74149957, "body": "@DanielWagner How can I fix commonValues? (I&#39;m new to Haskell as you might surmise.)"}, {"owner": {"reputation": 113, "user_id": 1751175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e50d1c468c5892705a645df69f9b5c?s=128&d=identicon&r=PG", "display_name": "UGPhysics", "link": "https://stackoverflow.com/users/1751175/ugphysics"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1492798274, "post_id": 43548216, "comment_id": 74151040, "body": "@DanielWagner commonValues = [x | x &lt;- multOfThree, x &lt;- multOfFive, ((x &lt;- multOfThree) &amp;&amp; (x &lt;- multOfFive)) == True]"}, {"owner": {"reputation": 113, "user_id": 1751175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e50d1c468c5892705a645df69f9b5c?s=128&d=identicon&r=PG", "display_name": "UGPhysics", "link": "https://stackoverflow.com/users/1751175/ugphysics"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1492798381, "post_id": 43548216, "comment_id": 74151095, "body": "@DanielWagner Error message: parse error on input \u2018&lt;-\u2019     Perhaps this statement should be within a &#39;do&#39; block?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1492798582, "post_id": 43548216, "comment_id": 74151212, "body": "You probably want <code>commonValues = [ x | x &lt;- list1 , elem x list2 ]</code>, i.e. &quot;those x in list1 which are elements of list2&quot;."}, {"owner": {"reputation": 113, "user_id": 1751175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e50d1c468c5892705a645df69f9b5c?s=128&d=identicon&r=PG", "display_name": "UGPhysics", "link": "https://stackoverflow.com/users/1751175/ugphysics"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1492798780, "post_id": 43548216, "comment_id": 74151330, "body": "@chi I want to rewrite my code using a &#39;do&#39; block. How can I do that?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1492798980, "post_id": 43548216, "comment_id": 74151443, "body": "It depends on what you actually want to do. An example could be <code>main = do let x = 3; let y=4; print (x+y)</code>. You can start a new (indented) line instead of using semicolons. Anyway, any good tutorial should cover that stuff, try <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a> which seems to be quite popular nowadays."}, {"owner": {"reputation": 113, "user_id": 1751175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e50d1c468c5892705a645df69f9b5c?s=128&d=identicon&r=PG", "display_name": "UGPhysics", "link": "https://stackoverflow.com/users/1751175/ugphysics"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1492799397, "post_id": 43548216, "comment_id": 74151689, "body": "@chi The error is above- in relation to the list comprehension that I tried writing. | I want to rewrite the code using a &#39;do&#39; block instead."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1492829150, "post_id": 43548216, "comment_id": 74161332, "body": "@UGPhysics In the code that gives the error message, you want to use the <code>elem</code> function (you were very close): <code>elem x multOfThree &amp;&amp; elem x multOfFive</code>. The <code>&lt;-</code> thing is only for doing a bind, not for checking to see if something is in a list. You will also find that you need to separate names, not just <code>x</code> for both."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1492849652, "post_id": 43548216, "comment_id": 74165413, "body": "It should have been <code>commonValues = [x | x &lt;- multOfThree, y &lt;- multOfFive, x==y]</code>. Nested bindings in list comprehension shadow the outer ones (the second <code>x</code> in your code makes first <code>x</code> inaccessible;  it&#39;s a new variable with the same name, not a variable with the same value - for that we need to compare their values, with <code>==</code>).   As for the summation, you either do        <code>sum ((multOfThree ++ multOfFive) \\\\ commonValues)</code>  or      <code>(sum multOfThree + sum multOfFive) - sum commonValues</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1492932892, "post_id": 43548216, "comment_id": 74187178, "body": "and of course, <a href=\"https://en.wikipedia.org/wiki/Inclusion%E2%80%93exclusion_principle\" rel=\"nofollow noreferrer\"><code>commonValues = [15,30..1000]</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 1, "last_activity_date": 1492852377, "creation_date": 1492852377, "answer_id": 43557387, "question_id": 43548216, "link": "https://stackoverflow.com/questions/43548216/what-is-wrong-if-any-with-the-following-haskell-code/43557387#43557387", "title": "What is wrong - if any - with the following Haskell code?", "body": "<p>Two things do not work as you intended:</p>\n\n<h2>List subtraction</h2>\n\n<p>To use set difference with lists, use <code>\\\\</code> from <code>Data.List</code>. <code>--</code> actually starts a comment.</p>\n\n<pre><code>import Data.List ((\\\\))\nmultiplesOfThreeOrFive = (multOfThree ++ multOfFive) \\\\ commonValues\n</code></pre>\n\n<p>or skip commonValues and use <code>Data.List.union</code>.</p>\n\n<h2>List comprehension</h2>\n\n<pre><code>commonValues = [x | x &lt;- multOfThree, x &lt;- multOfFive]\n</code></pre>\n\n<p>Unfortunately, you cannot translate the common mathematical notation and turn  that '''e''' symbol into <code>&lt;-</code>. The reason is, it is only ''common'', not formal mathematics: The first <code>&lt;-</code> means to iterate over the first set, the second one is a predicate (condition). You can directly write this as</p>\n\n<pre><code>commonValues = [x | x &lt;- multOfThree, x `elem` multOfFive]\n</code></pre>\n\n<p>as mentioned by chi.</p>\n\n<h2>Remarks</h2>\n\n<p>These are the things that are wrong in the sense of \"produce a wrong result\". In the <a href=\"https://codereview.stackexchange.com/questions/161439/project-euler-1-sum-of-multiples-of-3-or-5-less-than-1000-in-haskell\">related code review question</a>, you will get further advice.</p>\n"}], "owner": {"reputation": 113, "user_id": 1751175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e50d1c468c5892705a645df69f9b5c?s=128&d=identicon&r=PG", "display_name": "UGPhysics", "link": "https://stackoverflow.com/users/1751175/ugphysics"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1492852377, "creation_date": 1492793797, "last_edit_date": 1492793906, "question_id": 43548216, "link": "https://stackoverflow.com/questions/43548216/what-is-wrong-if-any-with-the-following-haskell-code", "title": "What is wrong - if any - with the following Haskell code?", "body": "<p>Project Euler problem: 1\nNote: GHCi implementaion: type 'main' to output result</p>\n\n<p>Multiples of 3 and 5</p>\n\n<p>Problem:\nIf we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23.</p>\n\n<p>Find the sum of all the multiples of 3 or 5 below 1000.</p>\n\n<pre><code>-- all multiples of 3 less than 1000\nmultOfThree = [3*x | x &lt;- [1..333] ]\n\n-- all multiples of 5 less than 1000\nmultOfFive = [5*x | x &lt;- [1..199] ]\n\n-- common values of the two lists\ncommonValues = [x | x &lt;- multOfThree, x &lt;- multOfFive]\n\n-- list of all multiples, subtract commonValues (as there are two copies - one per list)\nmultiplesOfThreeOrFive = (multOfThree ++ multOfFive) -- commonValues\n\nsumOfMultiples = sum multiplesOfThreeOrFive\n\n-- display sum:\nmain = print sumOfMultiples\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "typeclass", "recursive-datastructures"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 3, "creation_date": 1492791653, "post_id": 43546843, "comment_id": 74147188, "body": "This might be massive overkill for your project, but if it&#39;s abstract DSLs you&#39;re looking for (and it seems like you are), then look no further: <a href=\"http://okmij.org/ftp/tagless-final/TaglessStaged/beyond.pdf\" rel=\"nofollow noreferrer\">okmij.org/ftp/tagless-final/TaglessStaged/beyond.pdf</a>. You can see a fully-functioning example using this technique <a href=\"https://github.com/cpeikert/Lol/tree/applicative-alchemy-env-in-interpreter/alchemy/Crypto/Alchemy\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1492793481, "post_id": 43546843, "comment_id": 74148338, "body": "@crockeea The paper looks great thank you. Even if an overkill, this is the sort of things I like to read anyway. Will definitely check out the code too."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1492796715, "post_id": 43546843, "comment_id": 74150220, "body": "Why&#39;ve you convinced yourself that you need your <code>FirstOrder</code> class in the first place?"}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1492800301, "post_id": 43546843, "comment_id": 74152200, "body": "@BenjaminHodgson No I am not saying I do need it. I just thought a class (like an interface in Java) would allow me to write code which is not tied to a particular implementation, giving more flexibility to undo possible design mistakes. So I simply tried to have a class as a matter of principle so to speak, thinking it is a good design habit. I am glad to see from your comment that it may not be a bad idea after all to use the (concrete) data type itself. Thank you !"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1492808458, "post_id": 43546843, "comment_id": 74156070, "body": "@SvenWilliamson &quot;Premature abstraction is the root of all evil&quot;, as they say"}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1492849533, "post_id": 43546843, "comment_id": 74165393, "body": "@BenjaminHodgson yes I can see why abstraction is an attempt at premature optimization (of the design) thank you. For my defense, the Gang of Four book does put forward the principle of &#39;program to an interface, not an implementation&#39; (page 30), and it is not clear to me that FP should invalidate this (unless it is that enforcing this principle in OOP can be done at no cost)."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1492857759, "post_id": 43546843, "comment_id": 74167581, "body": "I can see your point, however the usual way to do interfaces in Haskell is not typeclasss but records (with one field per &quot;method&quot;)."}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1492858629, "post_id": 43546843, "comment_id": 74167841, "body": "@mb14 Oh I am new to this, never thought of that, thank you !! I will certainly follow this suggestion and see where it takes me."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1492888438, "post_id": 43546843, "comment_id": 74177876, "body": "You can have a look at this post : <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">lukepalmer.wordpress.com/2010/01/24/&hellip;</a>"}, {"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1492890326, "post_id": 43546843, "comment_id": 74178505, "body": "@mb14 Excellent, I wanted to ask you actually coz I tried today to guess what the pattern would look like (an implementation as an instance of a record type) but wasn&#39;t very happy with my code. Thank you !!"}], "answers": [{"comments": [{"owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "edited": false, "score": 0, "creation_date": 1492848039, "post_id": 43552553, "comment_id": 74165031, "body": "This is beautiful thank you! (and thanks for advice and reading suggestions)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1492850593, "last_edit_date": 1492850593, "creation_date": 1492811603, "answer_id": 43552553, "question_id": 43546843, "link": "https://stackoverflow.com/questions/43546843/how-to-pattern-match-against-typeclass-whose-instance-are-recursive-data-types/43552553#43552553", "title": "How to pattern match against typeclass whose instance are recursive data types?", "body": "<p>This looks as an overgeneralization, but let's ignore that anyway.</p>\n\n<p>You can solve that with explicit F-(co-)algebras and fixed points.</p>\n\n<pre><code>data FormulaF v k\n   = Belong v v                      -- x in y\n   | Bot                             -- False\n   | Imply (k v) (k v)               -- p -&gt; q\n   | Forall v (k v)                  -- forall x, p\n\nnewtype Formula v = Formula (FormulaF v Formula)      \n   -- fixed point. You might not need it, but it's nice to have.\n   -- \n</code></pre>\n\n<p>Then, you can do</p>\n\n<pre><code>class FirstOrder m where\n  belong    :: v -&gt; v -&gt; m v\n  bot       :: m v\n  imply     :: m v -&gt; m v -&gt; m v\n  forall    :: v -&gt; m v -&gt; m v\n  asFormula :: m v -&gt; FormulaF v m\n</code></pre>\n\n<p>and</p>\n\n<pre><code>subst :: (FirstOrder m) =&gt; (v -&gt; w) -&gt; m v -&gt; m w\nsubst f (asFormula -&gt; Belong x y) = belong (f x) (f y)\nsubst f (asFormula -&gt; Imply p q)  = imply (subst f p) (subst f q)\n</code></pre>\n\n<p>should now work, because <code>asFormula</code> does not convert the whole <code>m v</code> into a full formula recursively, but it converts into a <code>FormulaF v m</code> which looks as a formula superficially (the very first constructor you pattern match, like <code>Imply</code>), but deep inside still looks as a <code>m v</code>.</p>\n\n<p>If you really want to pursue this overgeneral approach, maybe you should have a look at <code>recursion-schemes</code>, F-algebras and F-coalgebras, and their associated cata-/ana-/hylo-/para-/whatever morphisms.</p>\n\n<p>Finally, I would suggest to avoid trying to adapt OOP design patterns in FP. Sometimes you can shoehorn something in such way, but it can often be unidiomatic. For instance, in Haskell, we are quite used to types having a fixed amount of constructors (but an open set of functions which operate on them), just like in OOP interfaces have a fixed amount of methods (but an open set of subclasses). One can try to generalize this, but it's complex, and should be done only when needed.</p>\n"}], "owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 43552553, "answer_count": 1, "score": 2, "last_activity_date": 1492850593, "creation_date": 1492789298, "question_id": 43546843, "link": "https://stackoverflow.com/questions/43546843/how-to-pattern-match-against-typeclass-whose-instance-are-recursive-data-types", "title": "How to pattern match against typeclass whose instance are recursive data types?", "body": "<p>This question is a follow up on <a href=\"https://stackoverflow.com/questions/28998729/how-to-pattern-match-against-a-typeclass-value\">How to pattern match against a typeclass value?</a>.</p>\n\n<p>I am starting up a pet project on first order logic and have decided to use Haskell for this purpose. My first hurdle is to define a 'formula of first order logic', hence the data type:</p>\n\n<pre><code>data Formula v  = Belong v v                      -- x in y\n                | Bot                             -- False\n                | Imply (Formula v) (Formula v)   -- p -&gt; q\n                | Forall v (Formula v)            -- forall x, p\n</code></pre>\n\n<p>However, I am reluctant to write code based on the implementation specifics, and would rather abstract away the details, in case I change my mind, or in case I want to reuse functionality with an alternative implementation, hence the typeclass:</p>\n\n<pre><code>class FirstOrder m where\n  belong    :: v -&gt; v -&gt; m v\n  bot       :: m v\n  imply     :: m v -&gt; m v -&gt; m v\n  forall    :: v -&gt; m v -&gt; m v\n  asFormula :: m v -&gt; Formula v\n</code></pre>\n\n<p>I have added the last function <code>asFormula</code> in order to use the <code>ViewPatterns</code> (as suggested in the above link), so as to be able to pattern match on values of this typeclass.</p>\n\n<p>Now suppose I want to define a simple function:</p>\n\n<pre><code>subst :: (FirstOrder m) =&gt; (v -&gt; w) -&gt; m v -&gt; m w\n</code></pre>\n\n<p>which substitutes variables in a formula as per a given mapping <code>f::v -&gt; w</code> (feels like <code>fmap</code>), so the formula <code>belong x y</code> is mapped to <code>belong (f x) (f y)</code> etc. then using <code>ViewPatterns</code>:</p>\n\n<pre><code>subst f (asFormula -&gt; Belong x y) = belong (f x) (f y)\n</code></pre>\n\n<p>so far so good...</p>\n\n<p>However, when attempting to write <code>subst f p-&gt;q = (subst f p) -&gt; (subst f q)</code>:</p>\n\n<pre><code>subst f (asFormula -&gt; Imply p q)  = imply (subst f p) (subst f q)\n</code></pre>\n\n<p>I get a type error, which coming to think of it makes perfect sense: the pattern matching binds <code>p</code> and <code>q</code> to elements of type <code>Formula v</code> as opposed to the desired type <code>m v</code>. </p>\n\n<p>Now I can see the problem, and could even think of ways of solving it by adding a <code>fromFormula</code> function to the typeclass to convert back to the type <code>m v</code>, but I am thinking this is crazy from a performance point of view (just as crazy as <code>asFormula</code> mind you), a huge price to pay in order to keep the code generic.</p>\n\n<p>So here I am now, trying to define a simple function by structural recursion on a free algebra (recursive data type), but my desire to abstract away the implementation details (and write code off typeclass rather than data type) is putting me in what seems to be an impossible position.</p>\n\n<p>Is there a way out, or should I just forget about abstraction and work with the recursive data type?</p>\n"}, {"tags": ["haskell", "benchmarking", "criterion"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1492785041, "post_id": 43544782, "comment_id": 74142692, "body": "<i>&quot;It seems to load 12.9MB into memory in 3.617ms. This doesn&#39;t seem realistic since it indicates that my SSD can read 3+MB/s, which is not the case at all.&quot;</i> That does not seem right. 12MB in 4ms would be 3GB/s, not 3MB/s."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492785576, "post_id": 43544782, "comment_id": 74143100, "body": "@Zeta I&#39;m sorry, you&#39;re right. It&#39;s a typo and I corrected it. 3GB/s is still not realistic for my SSD."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 3, "creation_date": 1492792485, "post_id": 43544782, "comment_id": 74147718, "body": "I&#39;d say 3GB/s is realistic given a modern OS should cache the file in memory for you. This of course doesn&#39;t really explain the difference you get with Criterion."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 2, "creation_date": 1492803756, "post_id": 43544782, "comment_id": 74153796, "body": "Was the second benchmark ran on a cold OS FS cache? I believe criterion will run the benchmark many times and given sufficient free memory any subsequent runs apart from the first would use OS cache instead of re-reading from the disk, which could perhaps explain the difference. What measurements do you get when you invoke <code>runBenchmarks</code> twice / thrice?"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1492858628, "post_id": 43544782, "comment_id": 74167840, "body": "@ppb The second benchmark was not ran on a cold OS FS cache. If I invokd <code>runBenchmarks</code> multiple times in succession, it gets faster. I average around 10ms now. The fastest I&#39;ve seen is 8ms.  Maybe caching seems to be the reason."}], "answers": [{"tags": [], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "is_accepted": true, "score": 0, "last_activity_date": 1492952831, "creation_date": 1492952831, "answer_id": 43571561, "question_id": 43544782, "link": "https://stackoverflow.com/questions/43544782/benchmarking-io-action-with-criterion/43571561#43571561", "title": "Benchmarking IO action with Criterion", "body": "<p>I looked at the visual results of my <code>Criterion</code> benchmark by writing the output to a <code>html</code> file. I could clearly see that the first run took around 0.020s, whereas the rest (after caching) takes around 0.003s. </p>\n\n<p>So I'm getting these results because of caching. </p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 43571561, "answer_count": 1, "score": 4, "last_activity_date": 1492952831, "creation_date": 1492783485, "last_edit_date": 1492792255, "question_id": 43544782, "link": "https://stackoverflow.com/questions/43544782/benchmarking-io-action-with-criterion", "title": "Benchmarking IO action with Criterion", "body": "<p>I want to know how long it takes my program to read a 12.9MB <code>.wav</code> file into memory. The function that reads a file into memory looks as follows:</p>\n\n<pre><code>import qualified Data.ByteString        as BS\n\ngetSamplesFromFileAsBS :: FilePath -&gt; IO (BS.ByteString)\n</code></pre>\n\n<p>It takes the name of the file and returns the samples as a <code>ByteString</code>. It also performs some other validity checks on the data and ignores the header information. I read the <code>ByteString</code> of samples into memory using <code>ByteString.hGet</code>.</p>\n\n<p>If I now benchmark this function with a 12.9MB file, using <code>Criterion</code>:</p>\n\n<pre><code>bencher :: FilePath -&gt; IO ()\nbencher fp = defaultMain [\n  bench \"Reading all the samples from a file.\" $ nfIO (getSamplesFromFileAsBS fp)\n  ]\n</code></pre>\n\n<p>I get the following result:</p>\n\n<pre><code>benchmarking Reading all the samples from a file.\ntime                 3.617 ms   (3.520 ms .. 3.730 ms)\n                     0.989 R\u00b2   (0.981 R\u00b2 .. 0.994 R\u00b2)\nmean                 3.760 ms   (3.662 ms .. 3.875 ms)\nstd dev              354.0 \u03bcs   (259.9 \u03bcs .. 552.5 \u03bcs)\nvariance introduced by outliers: 62% (severely inflated)\n</code></pre>\n\n<p>It seems to load 12.9MB into memory in 3.617ms. This doesn't seem realistic since it indicates that my SSD can read 3+GB/s, which is not the case at all. What am I doing wrong?</p>\n\n<p>I decided to try this another (more naive) way, by manually measuring the time difference:</p>\n\n<pre><code>runBenchmarks :: FilePath -&gt; IO ()\nrunBenchmarks fp = do\n  start &lt;- getCurrentTime\n  samplesBS &lt;- getSamplesFromFileAsBS fp\n  end &lt;- samplesBS `deepseq` getCurrentTime\n  print (diffUTCTime end start)\n</code></pre>\n\n<p>This gives me the following result: 0.023105s. This is realistic because it would mean my SSD can read at a speed of around 600MB/s. What is wrong with the <code>Criterion</code> result?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1492782341, "post_id": 43544158, "comment_id": 74140658, "body": "So... what is your question?  Also, Stackoverflow is not necessarily the best place to get your homework done for you.  If you have working code then you can go to the code review stackexchange and get tips on how to improve it.  Does this code compile?  What are some inputs and outputs for it?  What should the output be here?  You haven&#39;t even really supplied a description of your problem."}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1492782442, "post_id": 43544158, "comment_id": 74140742, "body": "I only want to split  a list to m sublist"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1492782635, "post_id": 43544158, "comment_id": 74140881, "body": "I&#39;d recommend you give <a href=\"http://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a> a read, then come back and edit your question following those guidelines.  You&#39;re going to get a much better response on this site if you put a little effort into it.  Besides, by writing out a good question with an explanation of your thought process can help you understand the problem better and might help you come to the solution on your own.  That&#39;s happened to me personally several times in the past."}, {"owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1492783994, "post_id": 43544158, "comment_id": 74141930, "body": "I have changed .Thank you so much"}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "edited": false, "score": 0, "creation_date": 1493550487, "post_id": 43544158, "comment_id": 74455773, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/8680888/subdividing-a-list-in-haskell\">Subdividing a list in haskell</a>"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1492806792, "last_edit_date": 1492806792, "creation_date": 1492805818, "answer_id": 43551316, "question_id": 43544158, "link": "https://stackoverflow.com/questions/43544158/how-to-transfer-a-csv-to-a-graph/43551316#43551316", "title": "how to transfer a CSV to a graph", "body": "<p><strong>Edit:</strong> Oops, I missed the purpose of the special case.  Fixed the answer...</p>\n\n<p>Your program is almost correct, but unfortunately it won't type check.  If you're using GHC, you'll get a terrifying error like the following:</p>\n\n<pre><code>Fsplit.hs:5:30: error:\n    \u2022 Couldn't match type \u2018x\u2019 with \u2018[x]\u2019\n      \u2018x\u2019 is a rigid type variable bound by\n        the type signature for:\n          fsplit :: forall x. Eq x =&gt; Int -&gt; [x] -&gt; [[x]]\n        at Fsplit.hs:3:11\n      Expected type: [[x]]\n        Actual type: [x]\n    \u2022 In the expression: (l)\n      In the expression:\n        if n == 0 then (l) else (take n l) : (fsplit (m - 1) (drop n l))\n      In an equation for \u2018fsplit\u2019:\n          fsplit m l\n            = if n == 0 then (l) else (take n l) : (fsplit (m - 1) (drop n l))\n            where\n                n = div (length l) m\n    \u2022 Relevant bindings include\n        l :: [x] (bound at Fsplit.hs:5:10)\n        fsplit :: Int -&gt; [x] -&gt; [[x]] (bound at Fsplit.hs:4:1)\n</code></pre>\n\n<p>The important things to pick out of this error message are:</p>\n\n<ol>\n<li>The error occurred at line 5, column 30 (which in my source file corresponds to the <code>(l)</code> after the <code>then</code> keyword)</li>\n<li>Haskell expected the type <code>[[x]]</code> but encountered the actual type <code>[x]</code></li>\n<li>This happened when trying to type-check the expression <code>(l)</code></li>\n</ol>\n\n<p>Figuring this one out can be a little tricky when you're new to Haskell, but the problem is that you're trying to handle the special case where the original list <code>l</code> is shorter than the sublist size by returning the original list.  However, the type of <code>l</code> is <code>[x]</code>, a list of some type <code>x</code>, but your function returns a value of type <code>[[x]]</code>, which is a list of lists of some type <code>x</code>.</p>\n\n<p>This is a hint that you have a logic error in your program.  In this special case (<code>l</code> too short), you don't really want to return the original list <code>l</code>, instead you want to return a list of sublists where the only <em>sublist</em> is the list <code>l</code>.  That is, you want to return the singleton list <code>[l]</code>:</p>\n\n<pre><code>fsplit m l = if (n==0) then [l] else (take n l ):(fsplit (m-1)(drop n l))\n            where n = div (length l ) m\n</code></pre>\n\n<p>and that should work fine:</p>\n\n<pre><code>&gt; fsplit 5 []\n[]\n&gt; fsplit 5 [1..10]\n[[1,2],[3,4],[5,6],[7,8],[9,10]]\n&gt; fsplit 3 [1..10]\n[[1,2,3],[4,5,6],[7,8,9,10]]\n&gt; fsplit 20 [1..10]\n[[1,2,3,4,5,6,7,8,9,10]] \n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7900854, "user_type": "registered", "profile_image": "https://graph.facebook.com/1893746254170638/picture?type=large", "display_name": "Ada", "link": "https://stackoverflow.com/users/7900854/ada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1497342914, "creation_date": 1492781727, "last_edit_date": 1497342914, "question_id": 43544158, "link": "https://stackoverflow.com/questions/43544158/how-to-transfer-a-csv-to-a-graph", "title": "how to transfer a CSV to a graph", "body": "<p>I am a beginning student in Haskell. I have written a little csv file.</p>\n\n<pre><code>csv = [\"a1\",\"b1\",\"c1\",\"d1\"]\n      [\"a2\",\"b2\",\"c2\",\"d2\"]\n      [\"a3\",\"b3\",\"c3\",\"d3\"]\n</code></pre>\n\n<p>I want to transfer to a graph par:</p>\n\n<pre><code>graph :: [(Str,Str,Str)]\ngraph :: [(\"a1\",\"b\",\"b1\"),\n          (\"a1\",\"b\",\"c1\")\n          (\"a1\",\"b\",\"d1\")]\na::[[str]] -&gt; [String,String,String]\nf csv = ?\ntest = a csv == graph\n</code></pre>\n\n<p>Can you explain me how to do it?TKS</p>\n"}, {"tags": ["scala", "haskell", "linked-list", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1492871498, "post_id": 43535232, "comment_id": 74171781, "body": "Note that the exact same thing would have happened if you used a strict list in Haskell."}, {"owner": {"reputation": 7709, "user_id": 2093695, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6V1PZ.jpg?s=128&g=1", "display_name": "Brian McCutchon", "link": "https://stackoverflow.com/users/2093695/brian-mccutchon"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1492899759, "post_id": 43535232, "comment_id": 74181384, "body": "@J&#246;rgWMittag Interesting. I know very little Haskell, but I&#39;m surprised it has a strict list type."}], "tags": [], "owner": {"reputation": 7709, "user_id": 2093695, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6V1PZ.jpg?s=128&g=1", "display_name": "Brian McCutchon", "link": "https://stackoverflow.com/users/2093695/brian-mccutchon"}, "is_accepted": false, "score": 2, "last_activity_date": 1492755280, "creation_date": 1492755280, "answer_id": 43535232, "question_id": 43534944, "link": "https://stackoverflow.com/questions/43534944/why-does-a-recursive-lazy-list-blow-the-stack-in-scala/43535232#43535232", "title": "Why does a recursive lazy list blow the stack in Scala?", "body": "<p>Well, it looks like I figured it out while formulating the question. It seems to be more a problem with <code>List</code> than with <code>lazy val</code>. To try this out, I made a simple <code>LazyList</code> implementation:</p>\n\n<pre><code>class LazyList(h: Int, t: =&gt; LazyList) {\n  val head = h\n  lazy val tail = t\n}\n</code></pre>\n\n<p>Then I can do:</p>\n\n<pre><code>lazy val x: LazyList = new LazyList(1, x)\nx.head // 1\nx.tail.tail.tail.head // 1\n</code></pre>\n\n<p>So, Scala's laziness is really lazy after all, if you make everything lazy, at least.</p>\n"}, {"comments": [{"owner": {"reputation": 7709, "user_id": 2093695, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6V1PZ.jpg?s=128&g=1", "display_name": "Brian McCutchon", "link": "https://stackoverflow.com/users/2093695/brian-mccutchon"}, "edited": false, "score": 0, "creation_date": 1492755455, "post_id": 43535236, "comment_id": 74122510, "body": "Not quite, you need the return type for it to compile, but still nice. With lazy vals it&#39;s <code>lazy val x: Stream[Int] = 2 #:: x</code>."}, {"owner": {"reputation": 46362, "user_id": 4993128, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QkaxJ.jpg?s=128&g=1", "display_name": "jwvh", "link": "https://stackoverflow.com/users/4993128/jwvh"}, "reply_to_user": {"reputation": 7709, "user_id": 2093695, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6V1PZ.jpg?s=128&g=1", "display_name": "Brian McCutchon", "link": "https://stackoverflow.com/users/2093695/brian-mccutchon"}, "edited": false, "score": 0, "creation_date": 1492755879, "post_id": 43535236, "comment_id": 74122751, "body": "@BrianMcCutchon, right you are. Busy composing the 2nd paragraph and missed that. I would argue, however, that there is little point in making the <code>Stream</code> val lazy. If it&#39;s a <code>val</code> then the results (evaluated elements) are memoized. If it&#39;s a <code>var</code> they aren&#39;t. Making it a <code>lazy val</code> doesn&#39;t buy you much."}, {"owner": {"reputation": 46362, "user_id": 4993128, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QkaxJ.jpg?s=128&g=1", "display_name": "jwvh", "link": "https://stackoverflow.com/users/4993128/jwvh"}, "reply_to_user": {"reputation": 7709, "user_id": 2093695, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6V1PZ.jpg?s=128&g=1", "display_name": "Brian McCutchon", "link": "https://stackoverflow.com/users/2093695/brian-mccutchon"}, "edited": false, "score": 0, "creation_date": 1492757907, "post_id": 43535236, "comment_id": 74124006, "body": "Oops. Another typo trying to clarify the difference between <code>val</code> stream, which is memoized, and <code>def</code> (not <code>var</code>) stream, which is not memoized."}], "tags": [], "owner": {"reputation": 46362, "user_id": 4993128, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QkaxJ.jpg?s=128&g=1", "display_name": "jwvh", "link": "https://stackoverflow.com/users/4993128/jwvh"}, "is_accepted": true, "score": 10, "last_activity_date": 1492755519, "last_edit_date": 1492755519, "creation_date": 1492755293, "answer_id": 43535236, "question_id": 43534944, "link": "https://stackoverflow.com/questions/43534944/why-does-a-recursive-lazy-list-blow-the-stack-in-scala/43535236#43535236", "title": "Why does a recursive lazy list blow the stack in Scala?", "body": "<p>What you want is <code>def x: Stream[Int] = 2 #:: x</code>. This produces an <code>immutable.Stream[Int]</code>.</p>\n\n<p>A lazy variable is evaluated only if needed, but it is fully evaluated. A <code>Stream</code>, on the other hand, is a collection of lazy values. Each element is evaluated only when needed, but the entire collection might never be evaluated, which is why it can be infinite.</p>\n"}], "owner": {"reputation": 7709, "user_id": 2093695, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6V1PZ.jpg?s=128&g=1", "display_name": "Brian McCutchon", "link": "https://stackoverflow.com/users/2093695/brian-mccutchon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 0, "accepted_answer_id": 43535236, "answer_count": 2, "score": 3, "last_activity_date": 1492755519, "creation_date": 1492754210, "question_id": 43534944, "link": "https://stackoverflow.com/questions/43534944/why-does-a-recursive-lazy-list-blow-the-stack-in-scala", "title": "Why does a recursive lazy list blow the stack in Scala?", "body": "<p>I saw this snippet of Haskell in <a href=\"https://codegolf.stackexchange.com/a/44682/56183\">this answer</a> by <a href=\"https://codegolf.stackexchange.com/users/20370\">proud haskeller</a> on Meta PPCG:</p>\n\n<pre><code>x=2:x\n</code></pre>\n\n<p>I thought, \"wait, I can do that in Scala!\" So I tried:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>lazy val x: List[Int] = 2 :: x\n</code></pre>\n\n<p>It compiled, and my console printed a nice <code>x: List[Int] = &lt;lazy&gt;</code>. But each of these lines results in a <code>StackOverflowException</code>:</p>\n\n<pre><code>x take 1\nx.head\nx(1)\nx\n</code></pre>\n\n<p>Based on the last one, it looks like any attempt to use <code>x</code> blows the stack trying to compute <code>x</code> (either that or a stack overflow happens trying to print it in the console). How is Scala's laziness different from Haskell's laziness in this example? Is this a feature of Scala's <code>lazy val</code> or does the <code>List</code> class simply require a complete tail?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1492749976, "post_id": 43534050, "comment_id": 74120372, "body": "<code>m</code> is a <i>type constructor</i> like <code>IO</code> or <code>Maybe</code>. It&#39;s not a complete type (like <code>IO ()</code> or <code>Maybe String</code>). But <code>m (Thread m r)</code> is a complete type."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1492749986, "post_id": 43534050, "comment_id": 74120375, "body": "Additionally the data constructor <code>Atomic</code> only takes one argument, not two."}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "edited": false, "score": 0, "creation_date": 1492878517, "post_id": 43535346, "comment_id": 74174253, "body": "This is a great answer, I was even looking at the Either instance of Show and wondering if that Show1 class had relevance. This is absolutely worthy of being the accepted answer, but Jon Purdy&#39;s contains a such a great breakdown of the problem I couldn&#39;t not mark his as accepted. Just wanted you to know that there&#39;s a lot of value in this answer too and thank you for providing it."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 5, "last_activity_date": 1492755803, "creation_date": 1492755803, "answer_id": 43535346, "question_id": 43534050, "link": "https://stackoverflow.com/questions/43534050/errors-from-data-types-show-instance/43535346#43535346", "title": "Errors from data type&#39;s Show instance", "body": "<p>According to <code>Thread m r = Action (m (Thread m r) | \u2026</code>, <code>m</code> is something that takes a type and returns another type. We call <code>m</code> a type constructor or of kind <code>* -&gt; *</code>. Another example for something like that is <code>Maybe</code>:</p>\n\n<pre><code>data Maybe a = Just a | Nothing\n</code></pre>\n\n<p><code>Maybe</code> on it's own isn't a type. You have to provide it another type, e.g. <code>Maybe Int</code> or <code>Maybe String</code>.</p>\n\n<p>Now <code>Show</code> expects a type with kind <code>*</code>. But <code>Thread</code> needs <code>* -&gt; *</code>. Therefore, GHC gives up. Since <code>Show m</code> comes before <code>Thread m r</code>, GHC thinks its kind is <code>*</code>, which does not work for <code>Action (m (Thread m r))</code>, since that would need a type constructor (<code>* -&gt; *</code>).</p>\n\n<p>This problem, by the way, is why classes like <a href=\"https://hackage.haskell.org/package/prelude-extras-0.4.0.3/docs/Prelude-Extras.html#t:Show1\" rel=\"noreferrer\"><code>Show1</code></a> exist in some packages. You could adopt that and <em>then</em> write your <code>Show</code> instance:</p>\n\n<pre><code>instance (Show1 m, Show r) =&gt; Show (Thread m r) where\n  show (Atomic x) = \"Atomic \" ++ show1 x\n  show (Return x) = \"Return \" ++ show x\n</code></pre>\n\n<p>Or you can delve into the realm of <a href=\"https://downloads.haskell.org/~ghc/8.0-latest/docs/html/users_guide/glasgow_exts.html#undecidable-instances\" rel=\"noreferrer\">undecidable instances</a> and say that <code>Thread m r</code> can be shown if <code>m (Thread m r)</code> can be shown:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n\ninstance (Show r, Show (m (Thread m r))) =&gt; Show (Thread m r) where\n  show (Atomic x) = \"Atomic \" ++ show x\n  show (Return x) = \"Return \" ++ show x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1492758007, "last_edit_date": 1492758007, "creation_date": 1492756035, "answer_id": 43535400, "question_id": 43534050, "link": "https://stackoverflow.com/questions/43534050/errors-from-data-types-show-instance/43535400#43535400", "title": "Errors from data type&#39;s Show instance", "body": "<p>First of all, the error you receive is a <em>kind</em> error. A kind is the \u201ctype\u201d of a type. Just as types classify values, kinds classify types. And just as Haskell infers types from values, it also infers kinds from types. We use the same symbol <code>::</code> to denote that a value has a certain type (e.g., <code>1 :: Int</code>) and to denote that a type has a certain kind (e.g., <code>Int :: *</code>).</p>\n\n<p>There are two kinds mentioned in the error message: <code>*</code> is the kind of types that are inhabited by values, such as <code>Int</code> and <code>Bool</code>, while <code>* -&gt; *</code> is the kind of type <em>constructors</em> such as <code>Maybe</code>, <code>[]</code>, and <code>IO</code>. You can think of type constructors as type-level functions: <code>Maybe</code> takes a type (of kind <code>*</code>) as an argument and returns a type (also of kind <code>*</code>) as a result, e.g., <code>Maybe Int :: *</code>. Kinds are curried in the same way as functions; for example, <code>Either</code> has the kind <code>* -&gt; * -&gt; *</code> because it takes two arguments of kind <code>*</code> to produce a type of kind <code>*</code>:</p>\n\n<pre><code>Either :: * -&gt; * -&gt; *\nEither Int :: * -&gt; *\nEither Int Bool :: *\n</code></pre>\n\n<p>So the error comes from the typeclass constraint on your <code>Show</code> instance:</p>\n\n<pre><code>instance (Show m, Show r) =&gt; Show (Thread m r) where\n          ------\n</code></pre>\n\n<p><code>Show</code> is the class of types of kind <code>*</code> that can be shown. You can see this by typing <code>:kind Show</code> (or <code>:k Show</code>) in GHCi:</p>\n\n<pre><code>&gt; :kind Show\nShow :: * -&gt; Constraint\n</code></pre>\n\n<p>So <code>Show</code> takes a type of kind <code>*</code> and returns a typeclass constraint. Without getting into too much detail about constraints, this means <code>Show m</code> implies that <code>m :: *</code>. However, the definition of <code>Thread</code> passes an argument to <code>m</code> in the definition of its <code>Atomic</code> constructor, which has a field of type <code>m (Thread m r)</code>. Look at the kind of <code>Thread</code>:</p>\n\n<pre><code>&gt; :kind Thread\nThread :: (* -&gt; *) -&gt; * -&gt; *\n</code></pre>\n\n<p>That implies that <code>m :: * -&gt; *</code>, hence the mismatch.</p>\n\n<p>The next error is in the implementation of your <code>Show</code> instance, namely:</p>\n\n<pre><code>show (Atomic m x) = \"Atomic \" ++ show m ++ \" \" ++ show x\n               -                        ----------------\n</code></pre>\n\n<p>Here you\u2019ve provided a pattern that matches multiple fields, but <code>Atomic</code> only has one field. You should change the implementation to the following:</p>\n\n<pre><code>show (Atomic m) = \"Atomic \" ++ show m\n</code></pre>\n\n<p>If you remove the <code>Show m</code> constraint, you\u2019ll see a more useful error message:</p>\n\n<pre><code>Could not deduce (Show (m (Thread m r)))\n  arising from a use of \u2018show\u2019\nfrom the context (Show r)\n  bound by the instance declaration at \u2026\nIn the second argument of \u2018(++)\u2019, namely \u2018show m\u2019\nIn the expression: \"Atomic \" ++ show m\nIn an equation for \u2018show\u2019: show (Atomic m) = \"Atomic \" ++ show m\n</code></pre>\n\n<p>This says that you\u2019re trying to call <code>show</code> on a value of type <code>m (Thread m r)</code> but you don\u2019t have that constraint in the context. So you can add it:</p>\n\n<pre><code>instance (Show (m (Thread m r)), Show r) =&gt; Show (Thread m r) where\n          ---------------------\n</code></pre>\n\n<p>This is not \u201cstandard\u201d Haskell, so GHC starts suggesting extensions that allow it:</p>\n\n<pre><code>Non type-variable argument in the constraint: Show (m a)\n(Use FlexibleContexts to permit this)\nIn the context: (Show (m a), Show r)\nWhile checking an instance declaration\nIn the instance declaration for \u2018Show (Thread m r)\u2019\n</code></pre>\n\n<p>Let\u2019s try adding <code>-XFlexibleContexts</code> (on the command line with <code>ghci \u2026 -XFlexibleContexts</code>, in a session with <code>:set -XFlexibleContexts</code>, or in a source file with <code>{-# LANGUAGE FlexibleContexts #-}</code>), since it\u2019s actually a pretty benign extension. Now we get a different error:</p>\n\n<pre><code>Variable \u2018a\u2019 occurs more often than in the instance head\n  in the constraint: Show (m a)\n(Use UndecidableInstances to permit this)\nIn the instance declaration for \u2018Show (Thread m r)\u2019\n</code></pre>\n\n<p>We can add <code>-XUndecidableInstances</code>\u2014all this means is that you\u2019re writing a type-level computation that GHC can\u2019t prove will halt. Sometimes this is undesirable, but in this case it\u2019s fine, because we know that instance resolution will either find an acceptable <code>Show</code> instance or fail. Now the compiler accepts it, and we can try our <code>Show</code> instance, say with something simple like <code>m ~ []</code> and <code>r ~ Int</code>:</p>\n\n<pre><code>&gt; Atomic [Atomic [Return 1, Return 2]] :: Thread [] Int\nAtomic [Atomic [Return 1,Return 2]]\n</code></pre>\n\n<p>However, note that this won\u2019t work when you set <code>m</code> to a type constructor that doesn\u2019t have any <code>Show</code> instances, such as <code>IO</code>:</p>\n\n<pre><code>&gt; Atomic (return (Atomic (return (Return 1) &gt;&gt; return (Return 2)))) :: Thread IO Int\n\nNo instance for (Show (IO (Thread IO Int)))\n  arising from a use of \u2018print\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Additionally, you may also notice that you\u2019re missing some parentheses in the result of your <code>Show</code> instance:</p>\n\n<pre><code>&gt; Atomic (Right (Atomic (Left \"asdf\"))) :: Thread (Either String) Int\nAtomic Right Atomic Left \"asdf\"\n</code></pre>\n\n<p>That\u2019s an easy fix that I\u2019ll leave to you.</p>\n\n<p>This should enable your instance to work with a datatype such as <code>Toy</code> from the article, by way of <code>Free</code>:</p>\n\n<pre><code>&gt; Atomic (Free (Output \"foo\" (Pure (Return \"bar\"))))\nAtomic (Free (Output \"foo\" (Pure Return (\"bar\"))))\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "accepted_answer_id": 43535400, "answer_count": 2, "score": 3, "last_activity_date": 1492758007, "creation_date": 1492749356, "question_id": 43534050, "link": "https://stackoverflow.com/questions/43534050/errors-from-data-types-show-instance", "title": "Errors from data type&#39;s Show instance", "body": "<p>I have been working through Gabriel Gonzale's excellent <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">blog post on Free Monads</a>. To assist my understanding I wanted to create a Show instance for the following type and play around with it in GHCi, the type (from the blog post) is:</p>\n\n<pre><code>data Thread m r = Atomic (m (Thread m r)) | Return r\n</code></pre>\n\n<p>And my Show instance is:</p>\n\n<pre><code>instance (Show m, Show r) =&gt; Show (Thread m r) where\n  show (Atomic m x) = \"Atomic \" ++ show m ++ \" \" ++ show x\n  show (Return x)   = \"Return \" ++ show x\n</code></pre>\n\n<p>Unfortunately GHCi gives me this error when trying to load the file:</p>\n\n<pre><code>\u2022 Expected kind \u2018* -&gt; *\u2019, but \u2018m\u2019 has kind \u2018*\u2019\n\u2022 In the first argument of \u2018Thread\u2019, namely \u2018m\u2019\n  In the first argument of \u2018Show\u2019, namely \u2018Thread m r\u2019\n  In the instance declaration for \u2018Show (Thread m r)\u2019\n</code></pre>\n\n<p>So, most importantly: what does this error mean, why am I getting it? I think answering that will help my understanding of the blog post immensely (albeit in a slightly roundabout way).\nAlso, what would a working Show implementation look like? I tried looking at the instance for Either, but didn't understand what was going on.</p>\n"}, {"tags": ["haskell", "list-comprehension", "monads"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1492748766, "post_id": 43533947, "comment_id": 74120056, "body": "You just did use <code>getLine</code> within a list comprehension :P"}, {"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1492748838, "post_id": 43533947, "comment_id": 74120084, "body": "Yeah, I really want to use list comprehension so I can get coordinates for a matrix I will build."}], "answers": [{"comments": [{"owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 0, "creation_date": 1492749289, "post_id": 43533984, "comment_id": 74120190, "body": "The sequence does the trick, because I need to keep track of the index to turn the matrix cells into coordinates. Thanks!!"}, {"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "reply_to_user": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "edited": false, "score": 1, "creation_date": 1492750619, "post_id": 43533984, "comment_id": 74120541, "body": "@mac10688 In that case you may find a number of other useful functions such as <code>mapM</code> or <code>forM</code>. For example, <code>fun = forM [0..4] $ \\y -&gt; do { print y; getLine }</code>"}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 8, "last_activity_date": 1492748955, "creation_date": 1492748955, "answer_id": 43533984, "question_id": 43533947, "link": "https://stackoverflow.com/questions/43533947/getline-within-list-comprehension/43533984#43533984", "title": "GetLine within list comprehension", "body": "<p>If you\u2019d like to take a list of actions, evaluate each one in sequence, and return each result \u2013 <code>[IO\u00a0a]\u00a0-&gt;\u00a0IO\u00a0[a]</code> \u2013 there\u2019s <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:sequence\" rel=\"noreferrer\"><code>sequence</code></a>:</p>\n\n<pre><code>fun = sequence [getLine | y &lt;- [0..4]]\n</code></pre>\n\n<p>and this can be simplified to <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:replicateM\" rel=\"noreferrer\"><code>Control.Monad.replicateM</code></a>:</p>\n\n<pre><code>fun = replicateM 5 getLine\n</code></pre>\n"}], "owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 43533984, "answer_count": 1, "score": 1, "last_activity_date": 1492748955, "creation_date": 1492748725, "question_id": 43533947, "link": "https://stackoverflow.com/questions/43533947/getline-within-list-comprehension", "title": "GetLine within list comprehension", "body": "<p>I want to build a matrix in a list comprehension. For each row I need to getLine and parse it out.</p>\n\n<p>In short, I want to do something like this.</p>\n\n<pre><code>fun = [ getLine | y &lt;- [0..4]]\n</code></pre>\n\n<p>If I run this function, instead of trying to getLine from command prompt for each row, I get an error for No Instance for (Show (IO String)) arising from a use of 'print'.</p>\n\n<p>I get the error message, but how do I getLine within a list comprehension?</p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1492774025, "post_id": 43532911, "comment_id": 74134845, "body": "What you want can be achieved with <code>TemplateHaskell</code> or <i>generic programming</i>. Though exact functions require some time to write up. So maybe one who answers this question will give you exact functions."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1492819728, "post_id": 43532911, "comment_id": 74159630, "body": "You can&#39;t do such a thing, or your generated type would be infinite (and hence not a valid type). In particular, why would the lists <code>[D3] :: [D Any]</code>, <code>[D3] :: [D (Any Any)]</code>, not be generated?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1492819755, "post_id": 43532911, "comment_id": 74159634, "body": ".... Perhaps you want such an output from an input like <code>(D, [T1,T2])</code> (where you specify the types to check), or you want to assuming that there are actually closed kinds (they aren&#39;t!) - you are still in a bad position to achieve what you want, at least in this example. The reason is you must perform unification between <code>forall d . D d</code> and <code>D X</code> (where X is whatever type) - and only the GHC api (which isn&#39;t easy to use, to say the least) provides access to the GHC type unification algorithm."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492786084, "post_id": 43545518, "comment_id": 74143463, "body": "Did you accidentally post your answer too soon?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492786234, "post_id": 43545518, "comment_id": 74143563, "body": "Yes - I posted it accidentally a bit too early"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492786491, "post_id": 43545518, "comment_id": 74143762, "body": "Which GHC version do you use? I get a completely other output in 7.10. There, all non-restricted are <code>NormalC</code>, and the <code>GadtC</code> is <code>ForAllC ...</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492786590, "post_id": 43545518, "comment_id": 74143838, "body": "My GHC is <code>8.0.2</code> and <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.1.0/docs/Language-Haskell-TH.html\" rel=\"nofollow noreferrer\">template-haskell 2.11.1.0</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492786905, "post_id": 43545518, "comment_id": 74144087, "body": "I&#39;ll have a look at that as well tonight"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1492819946, "post_id": 43545518, "comment_id": 74159680, "body": "You are understandably &#39;stuck&#39; - you must perform type unification to solve this problem, and TH does not provide any access to the type unification algorithm used by GHC. (Also, re: &quot; if I call that within the file ..&quot; - yes, that&#39;s just how TH works! you need to split definitions and uses of meta-programs into different files)"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1492814245, "last_edit_date": 1492814245, "creation_date": 1492785624, "answer_id": 43545518, "question_id": 43532911, "link": "https://stackoverflow.com/questions/43532911/creating-a-list-of-valid-constructors/43545518#43545518", "title": "Creating a list of valid constructors", "body": "<p>Disclaimer - my TemplateHaskell-fu is almost non-existent - but I've investigated a bit which should give you a starting point to work with:</p>\n\n<p>For those who don't know Template Haskell is a kind of meta-programming (language) that allows to write programs that run at compile time - it is type checked so it is safe (for some definition of safe, I think you can write programs that take infinite time to compile).</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Language.Haskell.TH\n\ndata T = T1 | T2\n\ndata D (t :: T) where\n  D1 :: D T1\n  D2 :: D T2\n  D3 :: D d\n  D4 :: D T1\n</code></pre>\n\n<p>You can start by loading the file into GHCi (don't forget to <code>:set -XTemplateHaskell</code> there)</p>\n\n<pre><code>&gt; typeInfo = reify ''D\n&gt; $(stringE . show =&lt;&lt; typeInfo)\n</code></pre>\n\n<p><code>typeInfo</code> is a <code>Q Info</code> that allows you to extract information from a type (escaped by <code>''</code>) - the <code>$(..)</code> works like print.</p>\n\n<p>This gives you the template haskell Expression that constructs your (G)ADT:</p>\n\n<pre><code>TyConI (\n    DataD [] TMP.D [KindedTV t_6989586621679027167 (ConT TMP.T)] Nothing \n        [GadtC [TMP.D1] [] (AppT (ConT TMP.D) (ConT TMP.T1))\n        ,GadtC [TMP.D2] [] (AppT (ConT TMP.D) (ConT TMP.T2))\n        ,ForallC [KindedTV d_6989586621679027168 (ConT TMP.T)] [] (GadtC [TMP.D3] [] (AppT (ConT TMP.D) (VarT d_6989586621679027168)))\n        ,GadtC [TMP.D4] [] (AppT (ConT TMP.D) (ConT TMP.T1))] [])\n</code></pre>\n\n<p>I with a bit of pattern matching - you can find the constructors that have either no restriction (<code>ForallC</code>) or a certain type (<code>TMP.T1</code>/<code>TMP.T2</code>) and then write some expression - to create a new type from those.</p>\n\n<p>Right now I don't have enough time to supply that - but I will update this answer tonight.</p>\n\n<h2>EDIT</h2>\n\n<p>I looked some more at constructing types, but I have to admit I am a bit stuck myself - I deconstructed the type info kind of successfully.</p>\n\n<pre><code>d = reify ''D\n\ndataName :: Info -&gt; Maybe [Name]\ndataName (TyConI (DataD _ _ _ _ x _) )= Just [t | NormalC t _ &lt;- x]\ndataName _ = Nothing\n\ngadtDataUnsafe :: Info -&gt; Q Exp\ngadtDataUnsafe (TyConI (DataD _ _ _ _ cons _)) = return $ head $ concat [t | GadtC t _ _ &lt;- cons]\n</code></pre>\n\n<p>I think it is doable to filter the <code>T1</code>/<code>T2</code>/<code>forall d</code> from here, tedious but doable to construct the lists.</p>\n\n<p>What I failed at, is constructing the type - if I load the file into ghci I can execute</p>\n\n<pre><code>&gt; f = $(gadtDataUnsafe =&lt;&lt; d)\n&gt;:t f\nf :: D 'T1\n</code></pre>\n\n<p>but if I call that within the file I get the following error</p>\n\n<pre><code>error:\n    \u2022 GHC stage restriction:\n        \u2018gadtData\u2019 is used in a top-level splice, quasi-quote, or annotation,\n        and must be imported, not defined locally\n    \u2022 In the untyped splice: $(gadtData =&lt;&lt; d)\n</code></pre>\n\n<p>I know that for example Edward Kmett makes some th-magic creating lenses for stuff and there it works inside the same file, but the splice is not assigned to a variable - so maybe you need to construct the names for your lists inside the <code>Q Exp</code> - I guess <code>mkName</code> would be something you need there.</p>\n\n<p>This concludes everything I found out - I hope it helps, I at least learnt a few things - for a full answer maybe someone smarter/more experienced with template haskell can supply some of his/her knowledge in a second answer.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1492814245, "creation_date": 1492741435, "question_id": 43532911, "link": "https://stackoverflow.com/questions/43532911/creating-a-list-of-valid-constructors", "title": "Creating a list of valid constructors", "body": "<p>Consider the following:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE GADTs #-}\n\ndata T = T1 | T2\n\ndata D (t :: T) where\n  D1 :: D T1\n  D2 :: D T2\n  D3 :: D d\n  D4 :: D T1\n\nx1 :: [D T1]\nx1 = [D1, D3, D4]\n\nx2 :: [D T2]\nx2 = [D2, D3]\n</code></pre>\n\n<p>Basically <code>x1</code> is the list of all valid constructors for <code>D T1</code>, and <code>x2</code> is the list of all valid constructors for <code>D T2</code>.</p>\n\n<p>However, I want both this lists to reflect any additional constructors added to <code>D</code>, I don't want to hard code these lists like they are currently.</p>\n\n<p>Is there a way to define <code>x1</code> and <code>x2</code> such that they are automatically generated from <code>D</code>?</p>\n"}, {"tags": ["haskell", "docker", "docker-compose", "microservices", "haskell-stack"], "comments": [{"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 0, "creation_date": 1492967213, "post_id": 43529266, "comment_id": 74198104, "body": "As far as I know, stack&#39;s docker integration does not play nicely with docker-compose (yet?), but take a look at the servant-docker stack template for an example of using stack + docker-compose. It does not use stack&#39;s docker integration, but has worked okay for me.."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1492986641, "post_id": 43529266, "comment_id": 74204499, "body": "In the event it is helpful, here is an example project of mine: <a href=\"https://github.com/chrissound/ArchCompareTryCatchDeploy\" rel=\"nofollow noreferrer\">github.com/chrissound/ArchCompareTryCatchDeploy</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 1, "last_activity_date": 1492965474, "creation_date": 1492965474, "answer_id": 43573771, "question_id": 43529266, "link": "https://stackoverflow.com/questions/43529266/how-to-use-haskell-stack-with-docker-compose/43573771#43573771", "title": "How to use Haskell Stack with Docker Compose?", "body": "<p>This only answers your follow up question (stack ghci within docker). Yes it's possible.</p>\n\n<p>Depending what your service/container is named as (you can determine this with <code>docker ps</code>):</p>\n\n<p>If your container is already running (via <code>docker-compose up</code> / <code>docker run</code>):</p>\n\n<p><code>docker exec -it directoryName_my-service_1 /bin/stack ghci</code></p>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1492965474, "creation_date": 1492719934, "last_edit_date": 1492720386, "question_id": 43529266, "link": "https://stackoverflow.com/questions/43529266/how-to-use-haskell-stack-with-docker-compose", "title": "How to use Haskell Stack with Docker Compose?", "body": "<p>I am trying to use docker compose to tie together some haskell services for local development. Most of the time I'm messing around in <code>stack ghci</code>, running unit tests, etc, but I also need to be able to run code that hits a dependency. Docker compose is great for this: I can run the dependencies (databases, other services, etc), and link everything together. </p>\n\n<p>Stack has docker support. It can build in a docker container with <code>docker: enable: true</code>, and also can create an executable image with <code>stack image container</code>.</p>\n\n<p>How do I leverage stack's docker functionality from within <code>docker-compose.yml</code>? </p>\n\n<pre><code>version: \"3\"\n\nservices:\n\n  my-service:\n\n    # how can I use `stack image container` here? Is it possible?\n    build: '.'\n\n    links:\n    - other-service\n\n    env_file:\n    - test.env\n\n  other-service:\n    image: other-service-image\n</code></pre>\n\n<p>Do I have to make my own Dockerfile, or is there some way to use the <code>stack image container</code> functionality?</p>\n\n<p>Follow-up questions: Is there some way to run <code>stack ghci</code> with all the settings (env, links, etc) from the docker compose file? </p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1492722125, "post_id": 43529781, "comment_id": 74112471, "body": "Makes sense ; how can I best fix it to do what I expect?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1492722785, "post_id": 43529781, "comment_id": 74112715, "body": "<code>txt = many1 (notFollowedBy directive *&gt; anyChar)</code> is the easiest fix, though it runs <code>directive</code> twice per directive."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1492721851, "creation_date": 1492721851, "answer_id": 43529781, "question_id": 43528978, "link": "https://stackoverflow.com/questions/43528978/parsec-handling-overlapping-parsers/43529781#43529781", "title": "Parsec: Handling Overlapping Parsers", "body": "<pre><code>many1 (anyChar &lt;* notFollowedBy directive)\n</code></pre>\n\n<p>This parses only characters not followed by a directive.</p>\n\n<pre><code>{{ value }}\n\nThis is normal Text\n\n{{ expression }}\n</code></pre>\n\n<p>When parsing the text in the middle, it will stop at the last <code>t</code>, leaving the newline before the directive unconsumed (because it's, well, a character followed by a directive), so the next iteration, you try to parse a directive and you fail. Then you retry <code>txt</code> on that newline, the parser expects it not to be followed by a directive, but it finds one, hence the error.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1492722906, "creation_date": 1492722906, "answer_id": 43530046, "question_id": 43528978, "link": "https://stackoverflow.com/questions/43528978/parsec-handling-overlapping-parsers/43530046#43530046", "title": "Parsec: Handling Overlapping Parsers", "body": "<p>You have a couple of problems.  First, in Parsec, if a parser consumes any input and then fails, that's an error.  So, when the parser:</p>\n\n<pre><code>anyChar &lt;* notFollowedBy directive\n</code></pre>\n\n<p>fails (because the character <em>is</em> followed by a directive), it fails <em>after</em> <code>anyChar</code> has consumed input, and that generates an error immediately.  Therefore, the parser:</p>\n\n<pre><code>let p1 = many1 (anyChar &lt;* notFollowedBy directive)\n</code></pre>\n\n<p>will never succeed if it runs into a directive.  For example:</p>\n\n<pre><code>parse p1 \"\" \"okay\"   -- works\nparse p1 \"\" \"oops {{}}\"  -- will fail after consuming \"oops \"\n</code></pre>\n\n<p>You can fix this by inserting a <code>try</code> clause:</p>\n\n<pre><code>let p2 = many1 (try (anyChar &lt;* notFollowedBy directive))\nparse p2 \"\" \"okay {{}}\"\n</code></pre>\n\n<p>which yields <code>Right \"okay\"</code> and reveals the second problem.  Parser <code>p2</code> only consumes characters that aren't followed by a directive, so that excludes the space immediately before the directive, and you have no means in your parser to consume a character that <em>is</em> followed by a directive, so it gets stuck.</p>\n\n<p>You actually want something like:</p>\n\n<pre><code>let p3 = many1 (notFollowedBy directive *&gt; anyChar)\n</code></pre>\n\n<p>which first checks that, at the current position, we aren't looking at a directive before grabbing a character.  No <code>try</code> clause is needed because if this fails, it fails without consuming input.  (<code>notFollowedBy</code> never consumes input, as per the documentation.)</p>\n\n<pre><code>parse p3 \"\" \"okay\" -- returns Right \"okay\"\nparse p3 \"\" \"okay {{}}\" -- return Right \"okay \"\nparse p3 \"\" \"{{fails}}\"  -- correctly fails w/o consuming input\n</code></pre>\n\n<p>So, taking your original example with:</p>\n\n<pre><code>txt = Left &lt;$&gt; many1 (notFollowedBy directive *&gt; anyChar)\n</code></pre>\n\n<p>should work fine.</p>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 1, "last_activity_date": 1567238810, "creation_date": 1567238810, "answer_id": 57736286, "question_id": 43528978, "link": "https://stackoverflow.com/questions/43528978/parsec-handling-overlapping-parsers/57736286#57736286", "title": "Parsec: Handling Overlapping Parsers", "body": "<p><a href=\"https://hackage.haskell.org/package/replace-megaparsec/\" rel=\"nofollow noreferrer\">replace-megaparsec</a>\nis a library for doing search-and-replace with parsers. The\nsearch-and-replace function is\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:streamEdit\" rel=\"nofollow noreferrer\"><code>streamEdit</code></a>,\nwhich can find your <code>{{ value }}</code> patterns and then substitute in some other text.</p>\n\n<p><code>streamEdit</code> is built from a generalized version\nof your <code>template</code> function called\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:sepCap\" rel=\"nofollow noreferrer\"><code>sepCap</code></a>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Replace.Megaparsec\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport Data.Char\n\ninput = unlines\n    [ \"{{ value }}\"\n    , \"\"\n    , \"This is normal Text\"\n    , \"\"\n    , \"{{ expression }}\"\n    ]\n\ndirective :: Parsec Void String String\ndirective = do\n    _ &lt;- string \"{{\"\n    txt &lt;- manyTill anySingle (string \"}}\")\n    return  txt\n\neditor k = fmap toUpper k\n\nstreamEdit directive editor input\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code> VALUE \n\nThis is normal Text\n\n EXPRESSION \n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 43530046, "answer_count": 3, "score": 1, "last_activity_date": 1567238810, "creation_date": 1492718965, "question_id": 43528978, "link": "https://stackoverflow.com/questions/43528978/parsec-handling-overlapping-parsers", "title": "Parsec: Handling Overlapping Parsers", "body": "<p>I'm really new to parsing in Haskell, but it's mostly making sense.</p>\n\n<p>I'm working on building a Templating program mostly to learn parsing better; templates can interpolate values in via <code>{{ value }}</code> notation.</p>\n\n<p>Here's my current parser,</p>\n\n<pre><code>data Template a = Template [Either String a]\ndata Directive = Directive String\n\ntemplateFromFile :: FilePath -&gt; IO (Either ParseError (Template Directive))\ntemplateFromFile = parseFromFile templateParser\n\ntemplateParser :: Parser (Template Directive)\ntemplateParser = do\n  tmp &lt;- template\n  eof\n  return tmp\n\ntemplate :: Parser (Template Directive)\ntemplate = Template &lt;$&gt; many (dir &lt;|&gt; txt)\n    where\n      dir = Right &lt;$&gt; directive\n      txt = Left &lt;$&gt; many1 (anyChar &lt;* notFollowedBy directive)\n\ndirective :: Parser Directive\ndirective = do\n  _ &lt;- string \"{{\"\n  txt &lt;- manyTill anyChar (string \"}}\")\n  return $ Directive txt\n</code></pre>\n\n<p>Then I run it on a file something like this:</p>\n\n<pre><code>{{ value }}\n\nThis is normal Text\n\n{{ expression }}\n</code></pre>\n\n<p>When I run this using <code>templateFromFile \"./template.txt\"</code> I get the error:</p>\n\n<pre><code>Left \"./template.txt\" (line 5, column 17):\nunexpected Directive \" expression \"\n</code></pre>\n\n<p>Why is this happening and how can I fix it?</p>\n\n<p>My basic understanding is that <code>many1 (anyChar &lt;* notFollowedBy directive)</code>\nshould grab all of the characters up until the start of the next directive, then should fail and return the list of characters up till that point; then\nit should fall back to the previous <code>many</code> and should try parsing <code>dir</code> again and should succeed; clearly something else is happening though. I'm\nhaving trouble figuring out how to parse things <em>between</em> other things when\nthe parsers mostly overlap.</p>\n\n<p>I'd love some tips on how to structure this all more idiomatically, please let me know if I'm doing something in a silly way. Cheers! Thanks for your time!</p>\n"}, {"tags": ["haskell", "windows-10", "ghc"], "comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 3, "creation_date": 1492707149, "post_id": 43525257, "comment_id": 74104207, "body": "Editorial Note: These forced windows updates are nothing but trouble!"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1492707682, "creation_date": 1492707682, "answer_id": 43525652, "question_id": 43525257, "link": "https://stackoverflow.com/questions/43525257/windows-10-update-appears-to-have-broken-ghc/43525652#43525652", "title": "Windows 10 update appears to have broken GHC", "body": "<p>GCC should be in <code>mingw\\bin</code> in your installation directory, e.g.</p>\n\n<pre><code>C:\\Program Files\\Haskell Platform\\8.0.2\\mingw\\bin\\gcc.exe\n</code></pre>\n\n<p>The appropriate binary can be found in your linked repository. The one meant for GHC 8.0.X should suite you fine. Be sure to use the <code>x64</code> one if you've installed the 64bit variant of the platform, and <code>x86</code> otherwise.</p>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 5, "last_activity_date": 1492707997, "creation_date": 1492707997, "answer_id": 43525748, "question_id": 43525257, "link": "https://stackoverflow.com/questions/43525257/windows-10-update-appears-to-have-broken-ghc/43525748#43525748", "title": "Windows 10 update appears to have broken GHC", "body": "<p>As of 20 April 2017 1700 UTC this seems like the process:</p>\n\n<ul>\n<li>Download the <a href=\"https://downloads.haskell.org/~ghc/8.0.2/ghc-8.0.2-x86_64-unknown-mingw32-win10.tar.xz\" rel=\"noreferrer\">version of GHC 8.0.2</a> with the Windows 10 patch (<a href=\"https://mail.haskell.org/pipermail/ghc-devs/2017-April/014131.html\" rel=\"noreferrer\">As described here.</a>).</li>\n<li>Open the archive file.  Windows 10's native archive browser does not understand the .tar.xz format so you will need something like <a href=\"http://www.7-zip.org/\" rel=\"noreferrer\">7-Zip</a> to open it.</li>\n<li>Find the \"<code>gcc.exe</code>\" file under <code>\\ghc-8.0.2\\mingw\\bin\\</code> and copy it over the file in <code>C:\\Program Files\\Haskell Platform\\8.0.2\\mingw\\bin\\</code>.</li>\n</ul>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 43525652, "answer_count": 2, "score": 5, "last_activity_date": 1492716936, "creation_date": 1492706443, "last_edit_date": 1492716936, "question_id": 43525257, "link": "https://stackoverflow.com/questions/43525257/windows-10-update-appears-to-have-broken-ghc", "title": "Windows 10 update appears to have broken GHC", "body": "<p>I have the latest <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">Haskell Platform (8.0.2)</a> and it appears that the forced update of Windows10 (1703) has broken GHC. There is a ticket (<a href=\"https://ghc.haskell.org/trac/ghc/ticket/13411\" rel=\"nofollow noreferrer\">#13411</a>) about this, and it seems like I need to <a href=\"https://github.com/Mistuke/ghc-compat#readme\" rel=\"nofollow noreferrer\">replace the gcc.exe</a> file in my build.</p>\n\n<p>Where do I find the appropriate gcc.exe file and where do I put it (assuming standard installation of the Haskell Platform)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1492706384, "post_id": 43525193, "comment_id": 74103761, "body": "Do you want to define a variable or do you want to re-assign an existing variable? I&#39;m asking because your example looks like you&#39;re trying to change the value of the global <code>elephant</code> variable."}, {"owner": {"reputation": 387, "user_id": 7291355, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ed78a444f6b132a5c6af56e3c51462cb?s=128&d=identicon&r=PG&f=1", "display_name": "Fl4mer", "link": "https://stackoverflow.com/users/7291355/fl4mer"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1492706580, "post_id": 43525193, "comment_id": 74103870, "body": "im trying to re-assign an existing variable."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 37, "creation_date": 1492706672, "post_id": 43525193, "comment_id": 74103922, "body": "In either case, I think you are hitting up S.O. too soon and need to learn more of the syntax and language primitives.  I suggest you learn more Haskell by reading.  For example, the <a href=\"https://en.wikibooks.org/wiki/Haskell\" rel=\"nofollow noreferrer\">wikibooks</a> and &quot;The Craft of Functional Programming&quot; are good places to start."}, {"owner": {"reputation": 321, "user_id": 5628107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93cb979443202ee5441d1346af4b8ff?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan McCleary", "link": "https://stackoverflow.com/users/5628107/ryan-mccleary"}, "edited": false, "score": 6, "creation_date": 1492708945, "post_id": 43525193, "comment_id": 74105289, "body": "Almost all of the time in Haskell, it is better to create a new value than to modify an existing value.  In addition to the already mentioned resources, I&#39;d suggest &quot;Learn You A Haskell For Great Good&quot;."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 4, "creation_date": 1492735949, "post_id": 43525193, "comment_id": 74116758, "body": "You can&#39;t. Once a variable has a value, it has that value forever. Haskell is not like C."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1492778334, "post_id": 43525193, "comment_id": 74137726, "body": "@Fl4mer, If you&#39;re asking this question, you need a good Haskell resource for beginners. I recommend <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">learn you a haskell</a>."}], "answers": [{"comments": [{"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 8, "creation_date": 1492789591, "post_id": 43525372, "comment_id": 74145900, "body": "At this point I doubt there is any program logic to redesign. The OP just wants to know how to do stuff in Haskell that they do in other langs."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 44, "last_activity_date": 1492706816, "creation_date": 1492706816, "answer_id": 43525372, "question_id": 43525193, "link": "https://stackoverflow.com/questions/43525193/how-can-i-re-assign-a-variable-in-a-function-in-haskell/43525372#43525372", "title": "How can I re-assign a variable in a function in Haskell?", "body": "<blockquote>\n  <p>im trying to re-assign an existing variable</p>\n</blockquote>\n\n<p>You can't do that in Haskell. You can do something close by using <code>IORef</code>s, but this is very rarely the proper solution to a problem - certainly not in situations a beginner might encounter.</p>\n\n<p>Instead you should re-design your program logic, so that it does not require mutable variables to function.</p>\n"}, {"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 25, "creation_date": 1492715531, "post_id": 43526565, "comment_id": 74109064, "body": "While these are good things to know and use in general, I feel like this might not be the most appropriate time to talk about the <code>StateT</code>, monad transformers, type classes and lenses... If someone is unaware of this aspect of Haskell (not having assignment in the way a language like C does) and haven&#39;t previously come across this difference, I suspect they don&#39;t yet have the background for this and it might even scare them off (I <i>could</i> be wrong, of course, but I have a pretty strong suspicion...)."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 37, "creation_date": 1492715832, "post_id": 43526565, "comment_id": 74109209, "body": "@DavidYoung I don&#39;t expect my answer will provide any immediate utility to the asker. Others have already done that. This answer is here because I&#39;ve always believed it&#39;s valuable to catch occasional glimpses of things you can&#39;t understand yet, to look up from the path at your feet, and to gaze at the shape of the mountain through the clouds."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 39, "creation_date": 1492719612, "post_id": 43526565, "comment_id": 74111243, "body": "This answer is utterly silly and hardly adresses the question. +1."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492759746, "post_id": 43526565, "comment_id": 74125152, "body": "Ah, all of this reminds me of <a href=\"http://stackoverflow.com/q/23875471/1139697\">my old question</a>. Maybe you can incorporate some imperative syntax into your answer :D."}, {"owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "edited": false, "score": 1, "creation_date": 1492761784, "post_id": 43526565, "comment_id": 74126376, "body": "&quot;to look up from the path at your feet, and to gaze at the shape of the mountain through the clouds&quot; --- well. Climb up the mountain and you realize what looked like arrows and lenses is in fact the very same old kind of path you walked below.. just less lush and with thinner air  =)"}, {"owner": {"reputation": 11764, "user_id": 494373, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/yAS3h.png?s=128&g=1", "display_name": "Rob Agar", "link": "https://stackoverflow.com/users/494373/rob-agar"}, "edited": false, "score": 1, "creation_date": 1492784751, "post_id": 43526565, "comment_id": 74142459, "body": "minus 1 this feels like bullying a beginner to me.  +1 for the elephants."}, {"owner": {"reputation": 696, "user_id": 1441984, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9456b7e7871e35c759b99c2237ce5253?s=128&d=identicon&r=PG", "display_name": "Jean-Marie Comets", "link": "https://stackoverflow.com/users/1441984/jean-marie-comets"}, "edited": false, "score": 1, "creation_date": 1492789112, "post_id": 43526565, "comment_id": 74145611, "body": "Although I find this answer very interesting, I&#39;d appreciate if the &quot;don&#39;t do this&quot; part was a bit clearer, otherwise this sounds a lot like bullying."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1492809505, "post_id": 43526565, "comment_id": 74156500, "body": "Doesn&#39;t seem like bullying to me, but it definitely seems like Chris wrote this answer for his own pleasure rather than to be helpful to anyone."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1492821024, "post_id": 43526565, "comment_id": 74159910, "body": "The comments seem to imply this is a bad/silly/non- answer, but this is the only answer which answers the question(unless you interpret it literally as &quot;why does this syntax not parse&quot;). The other answers only say &quot;you can&#39;t do it - here is how to rewrite an imperative, mutable program into a functional, immutable one&quot;. This answer tells one how to define something to model mutable, global variables. (but perhaps this answer would benefit from less liberal use of esoteric symbols)"}, {"owner": {"reputation": 22993, "user_id": 1394393, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mSjIL.jpg?s=128&g=1", "display_name": "jpmc26", "link": "https://stackoverflow.com/users/1394393/jpmc26"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1492831077, "post_id": 43526565, "comment_id": 74161616, "body": "@user2407038 May God have mercy on the souls who technically answer the question when an actual answer is the worst possible thing for anyone reading."}, {"owner": {"reputation": 4226, "user_id": 2929337, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0fad97c24fbeec7e953f5d19ddc47a7?s=128&d=identicon&r=PG&f=1", "display_name": "cfh", "link": "https://stackoverflow.com/users/2929337/cfh"}, "edited": false, "score": 0, "creation_date": 1492845497, "post_id": 43526565, "comment_id": 74164430, "body": "This answer reminded me of this post on fizzbuzz: <a href=\"http://joelgrus.com/2016/05/23/fizz-buzz-in-tensorflow/\" rel=\"nofollow noreferrer\">joelgrus.com/2016/05/23/fizz-buzz-in-tensorflow</a>"}, {"owner": {"reputation": 638, "user_id": 6772989, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a05dc0e117ea9018de89f926894ea906?s=128&d=identicon&r=PG&f=1", "display_name": "Bulat M.", "link": "https://stackoverflow.com/users/6772989/bulat-m"}, "edited": false, "score": 0, "creation_date": 1512042011, "post_id": 43526565, "comment_id": 82102043, "body": "@Chris, ghc 8.0.2 outputs Parse error: naked expressions at top level - makeLenses &#39;&#39;Congo. How could one cope with it? Thanks."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 638, "user_id": 6772989, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a05dc0e117ea9018de89f926894ea906?s=128&d=identicon&r=PG&f=1", "display_name": "Bulat M.", "link": "https://stackoverflow.com/users/6772989/bulat-m"}, "edited": false, "score": 1, "creation_date": 1512087552, "post_id": 43526565, "comment_id": 82127162, "body": "@BulatM. It sounds like the Template Haskell extension isn&#39;t enabled. Did you include the first line <code>{-# LANGUAGE TemplateHaskell #-}</code>?"}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 115, "last_activity_date": 1521737061, "last_edit_date": 1521737061, "creation_date": 1492710762, "answer_id": 43526565, "question_id": 43525193, "link": "https://stackoverflow.com/questions/43525193/how-can-i-re-assign-a-variable-in-a-function-in-haskell/43526565#43526565", "title": "How can I re-assign a variable in a function in Haskell?", "body": "<p>Haskell is a great <a href=\"https://stackoverflow.com/questions/6622524\">imperative</a> language, and writing programs that can re-assign state is a really fun advanced topic! This is definitely not the approach you want right now, but come back to it some day \ud83d\ude42</p>\n\n<p>It takes a bit of effort to define an environment that models global mutable variables. Once you get the hang of it, though, the precision of the types ends up being pretty handy.</p>\n\n<p>We're going to be using the <a href=\"https://hackage.haskell.org/package/lens\" rel=\"noreferrer\">lens</a> and <a href=\"https://hackage.haskell.org/package/mtl\" rel=\"noreferrer\">mtl</a> libraries.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\nimport Control.Monad.State\n</code></pre>\n\n<p>I'll stick with using integers as your question does, but we'll throw in a type alias to remind ourselves that they are being used as the type of the <code>elephant</code> variable.</p>\n\n<pre><code>type Elephant = Integer\n</code></pre>\n\n<p>You wanted a program whose global mutable state has an elephant. So first let's define what it means to have an elephant. <code>Lens</code> captures this notion nicely.</p>\n\n<pre><code>class HasElephant a \n  where\n    elephant :: Lens' a Elephant\n</code></pre>\n\n<p>Now we can define <code>function</code>, which assigns a new value to <code>elephant</code>.</p>\n\n<pre><code>function :: (MonadState s m, HasElephant s) =&gt; Elephant -&gt; m ()\nfunction x =\n    elephant .= x\n</code></pre>\n\n<p>The constraints <code>MonadState s m</code> and <code>HasElephant s</code> are saying our program must be able to hold mutable state of some type <code>s</code>, and the type <code>s</code> must have an elephant.</p>\n\n<p>Let's also define a program that prints the elephant.</p>\n\n<pre><code>printElephant :: (MonadState s m, HasElephant s, MonadIO m) =&gt; m ()\nprintElephant =\n    use elephant &gt;&gt;= (liftIO . print)\n</code></pre>\n\n<p>This program does I/O (printing), so we have an additional constraint <code>MonadIO m</code> that says our program type <code>m</code> must be able to do I/O.</p>\n\n<p>The <code>elephant</code> variable is probably only one part of some larger program state. Let's define a data type here to represent the entire state (which we'll name <em>Congo</em> just to be cute because the Congo Basin is one place where elephants live).</p>\n\n<pre><code>data Congo = Congo \n    { _congoElephant :: Elephant\n    }\nmakeLenses ''Congo\n</code></pre>\n\n<p>(See <a href=\"https://hackage.haskell.org/package/lens-4.16/docs/Control-Lens-TH.html\" rel=\"noreferrer\">Control.Lens.TH</a> for a little bit about <code>makeLenses</code> does here using Template Haskell.)</p>\n\n<p>We must define the way in which the <code>Congo</code> has an elephant.</p>\n\n<pre><code>instance HasElephant Congo\n  where\n    elephant = congoElephant\n</code></pre>\n\n<p>Now we can write an example program. Our program will print the value of <code>elephant</code>, then change the value of <code>elephant</code>, then print it again.</p>\n\n<pre><code>main' :: StateT Congo IO ()\nmain' =\n  do\n    printElephant\n    function 2\n    printElephant\n</code></pre>\n\n<p>Then we can run this program.</p>\n\n<pre><code>main :: IO ()\nmain = Congo 0 &amp; runStateT main' &amp; void\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>0\n2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "is_accepted": false, "score": 26, "last_activity_date": 1492751119, "creation_date": 1492751119, "answer_id": 43534340, "question_id": 43525193, "link": "https://stackoverflow.com/questions/43525193/how-can-i-re-assign-a-variable-in-a-function-in-haskell/43534340#43534340", "title": "How can I re-assign a variable in a function in Haskell?", "body": "<p>Haskell is a leader in the functional programming world and functional programming is often called \"programming without assignment.\"  It's almost the entire <em>point</em> of functional programming to not use assignment. As soon as you've used it, you're not really doing it in a \"functional\" way any more. Of course there are times for it, but FP tries to minimize those times.</p>\n\n<p>So, to answer your question, \"Why doesn't this work?\" First of all the syntax is not correct. <code>=</code> does not mean assignment in Haskell. It binds a name to an expression. You cannot do that twice (in the same scope). In other words, \"variables\" are immutable (like in math). Second, mutation is a side-effecting action and Haskell treats those as impure actions which must be done in the <code>IO</code> world.</p>\n\n<p>I could show you how to <em>actually</em> mutate a reference in Haskell, but I don't think that's what you need at this point.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 16, "last_activity_date": 1492781017, "last_edit_date": 1492781017, "creation_date": 1492775251, "answer_id": 43541940, "question_id": 43525193, "link": "https://stackoverflow.com/questions/43525193/how-can-i-re-assign-a-variable-in-a-function-in-haskell/43541940#43541940", "title": "How can I re-assign a variable in a function in Haskell?", "body": "<p>The most primitive way to bind a variable <code>x</code> to a value <code>v</code> is to write a function taking <code>x</code> as argument, and pass <code>v</code> to that function.</p>\n\n<p>This can sometimes be used to \"simulate\" the effect of a mutable variable.</p>\n\n<p>E.g., the imperative code</p>\n\n<pre><code>// sum 0..100\ni = s = 0;\nwhile (i &lt;= 100) {\n   s = s+i;\n   i++;\n}\nreturn s;\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>final_s = f 0 0  -- the initial values\n  where\n  f i s | i &lt;=100   = f (i+1) (s+i)  // increment i, augment s\n        | otherwise = s              // return s at the end\n</code></pre>\n\n<p>The above code is not pretty FP code, but at least it is close enough to imperative code to make it possible to spot the connections.</p>\n\n<hr>\n\n<p>A final digression:</p>\n\n<p>When one first notices this, it is usually lured to fall into the <a href=\"http://www.paulgraham.com/avg.html\" rel=\"noreferrer\">Blub paradox</a>. One could easily think: \"What!? Haskell needs all that stuff to simulate a simple assignment? If in language Blub assignment is trivial, and simulating that in Haskell requires so much effort, then clearly Blub is much better than Haskell!\". And this would be a perfect case of the Blub paradox: when a Blub programmer moves to another language, they immediately perceive what can not be directly translated from Blub, and do not notice all the other features of the new language which were not present in Blub. \nTheir mind now thinks in \"Blub\", and it requires a great effort to adapt to new models.</p>\n\n<p>Almost as paradoxically, learning <em>both</em> FP and imperative programming is useful precisely because it's non trivial to learn the other paradigm when used to only one of those. If the step between them were narrow, it would not be worth the effort to learn two close approaches to the same problem.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1492871943, "post_id": 43560029, "comment_id": 74171925, "body": "You can indeed do this, but it&#39;s important to emphasize that the <code>let elephant = 1</code> and <code>let elephant = 2</code> do <b>not</b> re-assign the variable <code>elephant</code>. Instead, they just introduce a <i>new</i> variable, which happens to also be called <code>elephant</code>. The <code>print elephant</code> then picks the nearest previous occurence (more precisely speaking: the one in the <i>narrowest shared scope</i>), but outside of this scope the old <code>elephant</code> always keeps the same value. I recommend this should not be done in actual Haskell code (in fact <code>ghc -Wall</code> warns about it)."}, {"owner": {"reputation": 166, "user_id": 7107666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a456821ce229717a6e9500308c2f4377?s=128&d=identicon&r=PG&f=1", "display_name": "James Hollis", "link": "https://stackoverflow.com/users/7107666/james-hollis"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1492873935, "post_id": 43560029, "comment_id": 74172617, "body": "@leftaroundabout You&#39;re right I added a bit to illustrate the difference.  Also, I know it&#39;s not recommended but the question goes against everything the language stands for. It&#39;s hard to answer the question with something that can be recommended."}], "tags": [], "owner": {"reputation": 166, "user_id": 7107666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a456821ce229717a6e9500308c2f4377?s=128&d=identicon&r=PG&f=1", "display_name": "James Hollis", "link": "https://stackoverflow.com/users/7107666/james-hollis"}, "is_accepted": false, "score": 3, "last_activity_date": 1492874201, "last_edit_date": 1492874201, "creation_date": 1492868992, "answer_id": 43560029, "question_id": 43525193, "link": "https://stackoverflow.com/questions/43525193/how-can-i-re-assign-a-variable-in-a-function-in-haskell/43560029#43560029", "title": "How can I re-assign a variable in a function in Haskell?", "body": "<p>In general this doesn't work because you usually make immutable declarations, rather than specifying a sequence of operations. You can do:</p>\n\n<pre><code>elephant = 3\nmain = print elephant\n</code></pre>\n\n<p>But you can also do:</p>\n\n<pre><code>main = print elephant\nelephant = 3\n</code></pre>\n\n<p>Because the code doesn't specify an order of execution, there is no way to interpret multiple assignments as anything other than an error.</p>\n\n<p>If you want to specify a sequence of operations, use <strong>do</strong> notation:</p>\n\n<pre><code>main = do\n    let elephant = 0\n    print elephant\n    let elephant = 1\n    print elephant\n    let elephant = 2\n    print elephant\n</code></pre>\n\n<p>The code in a <strong>do</strong> block is executed in order, so you can effectively reassign variables the way you can in most programming languages.</p>\n\n<p>Note that this code really just creates a new binding for elephant. The old value still exists:</p>\n\n<pre><code>main = do\n    let elephant = 1\n    print elephant\n    let printElephant = print elephant\n    let elephant = 2\n    print elephant\n    printElephant\n</code></pre>\n\n<p>Because the printElephant function I define is still using the old value of elephant, this prints:</p>\n\n<pre><code>1\n2\n1\n</code></pre>\n"}], "owner": {"reputation": 387, "user_id": 7291355, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ed78a444f6b132a5c6af56e3c51462cb?s=128&d=identicon&r=PG&f=1", "display_name": "Fl4mer", "link": "https://stackoverflow.com/users/7291355/fl4mer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12232, "favorite_count": 9, "answer_count": 5, "score": 13, "last_activity_date": 1521737061, "creation_date": 1492706278, "last_edit_date": 1492707134, "question_id": 43525193, "link": "https://stackoverflow.com/questions/43525193/how-can-i-re-assign-a-variable-in-a-function-in-haskell", "title": "How can I re-assign a variable in a function in Haskell?", "body": "<p>I don't know how to re-assign a variable in a function.</p>\n\n<p>For example, </p>\n\n<pre><code>elephant = 0\n\nfunction x = elephant = x\n</code></pre>\n\n<p>Why doesn't this work?</p>\n"}, {"tags": ["haskell", "yesod", "haskell-warp"], "answers": [{"comments": [{"owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "edited": false, "score": 0, "creation_date": 1492706612, "post_id": 43525041, "comment_id": 74103896, "body": "Uh, but this is not my code, so I can&#39;t change it, unless I make my own version of this library."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "edited": false, "score": 0, "creation_date": 1492718644, "post_id": 43525041, "comment_id": 74110752, "body": "@Micha\u0142Per\u0142akowski Exactly, you must write a function just like that one, except it does the headers how you like. I&#39;m commenting on the library&#39;s poor design forcing you to do this."}, {"owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "edited": false, "score": 0, "creation_date": 1492719140, "post_id": 43525041, "comment_id": 74111000, "body": "I can&#39;t just &quot;write a function&quot;, because it&#39;s an internal function in an internal module and it uses other internal functions. Moreover, I&#39;m not even using this function directly, because I&#39;m just using Yesod and Yesod uses Warp (which is where this function is)."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "reply_to_user": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "edited": false, "score": 0, "creation_date": 1492720576, "post_id": 43525041, "comment_id": 74111738, "body": "Then you can&#39;t; it would violate the invariant set by that function. If Warp only exposes that part, then you can only use that part. You could request that feature if you want (or write it yourself), but I suspect there is a good reason for it to be designed that way."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": -1, "last_activity_date": 1492705765, "creation_date": 1492705765, "answer_id": 43525041, "question_id": 43524843, "link": "https://stackoverflow.com/questions/43524843/remove-the-server-response-header-in-yesod-warp/43525041#43525041", "title": "Remove the Server response header in Yesod/Warp", "body": "<p>You must call the methods inside of the function you linked. That function will \"The Date and Server header is added if not exist in HTTP response header\" so you need to reimplement it if you don't want that behavior.</p>\n\n<p>This is why people always say to keep your code modular and your functions small; this function is too big for your use case, and there is no specific smaller function that does exactly what you want (or else it would have been called by this function!)</p>\n"}, {"tags": [], "owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "is_accepted": true, "score": 0, "last_activity_date": 1493848007, "creation_date": 1493848007, "answer_id": 43770530, "question_id": 43524843, "link": "https://stackoverflow.com/questions/43524843/remove-the-server-response-header-in-yesod-warp/43770530#43770530", "title": "Remove the Server response header in Yesod/Warp", "body": "<p>I made <a href=\"https://github.com/yesodweb/wai/issues/619\" rel=\"nofollow noreferrer\">an issue</a> on GitHub Warp repository and they changed it that when the server name is empty, the \"Server\" header is not sent. Therefore, the solution is to set the server name to an empty string using <code>setServerName \"\"</code>. In my case I had to add this to the <code>warpSettings</code> function in <code>Application.hs</code>. Note that you have to use the Warp version which contains the fix (as of May 3 '17, it has not been released yet, but you can pull it directly from GitHub).</p>\n"}], "owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 43770530, "answer_count": 2, "score": 0, "last_activity_date": 1493848007, "creation_date": 1492705089, "question_id": 43524843, "link": "https://stackoverflow.com/questions/43524843/remove-the-server-response-header-in-yesod-warp", "title": "Remove the Server response header in Yesod/Warp", "body": "<p>How can I remove the <code>Server</code> HTTP response header in Yesod? I found <a href=\"https://hackage.haskell.org/package/warp-3.2.11.2/docs/src/Network-Wai-Handler-Warp-Response.html#line-166\" rel=\"nofollow noreferrer\">code that's responsible for setting that header</a>, but I don't know what to do next. I know that I can replace the header value with an empty string by using <code>addHeader \"Server\" \"\"</code>, but I'd prefer to remove it entirely.</p>\n"}, {"tags": ["mongodb", "haskell", "types", "type-inference"], "answers": [{"comments": [{"owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "edited": false, "score": 0, "creation_date": 1492705254, "post_id": 43524779, "comment_id": 74103128, "body": "And <a href=\"https://hackage.haskell.org/package/mongoDB-2.2.0/docs/Database-MongoDB-Query.html#g:1\" rel=\"nofollow noreferrer\">the current documentation</a> does not, although the tutorial and the comment on the current version still reference an <code>Either</code> return type. As of posting, this is an <a href=\"https://github.com/mongodb-haskell/mongodb/issues/67\" rel=\"nofollow noreferrer\">open issue on GitHub</a>. Thanks for pointing that out."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 0, "last_activity_date": 1492704881, "creation_date": 1492704881, "answer_id": 43524779, "question_id": 43524352, "link": "https://stackoverflow.com/questions/43524352/access-function-not-returning-either-failure-a/43524779#43524779", "title": "access function not returning Either Failure a", "body": "<p>You are confused by version mismatch. Version <a href=\"https://github.com/mongodb-haskell/mongodb/blob/1.3.2/Database/MongoDB/Query.hs#L114\" rel=\"nofollow noreferrer\">1.3.2 on GitHub</a> also has <code>Either</code> in the return type.</p>\n"}], "owner": {"reputation": 2044, "user_id": 6733371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a4c02ed1ce17fd1f60579e73384d310?s=128&d=identicon&r=PG&f=1", "display_name": "qfwfq", "link": "https://stackoverflow.com/users/6733371/qfwfq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 43524779, "answer_count": 1, "score": 2, "last_activity_date": 1492704948, "creation_date": 1492703501, "question_id": 43524352, "link": "https://stackoverflow.com/questions/43524352/access-function-not-returning-either-failure-a", "title": "access function not returning Either Failure a", "body": "<p>I am having some difficulty with the Haskell mongoDB driver and the return type of the <code>access</code> function. According to <a href=\"https://hackage.haskell.org/package/mongoDB-1.3.2/docs/Database-MongoDB-Query.html#access\" rel=\"nofollow noreferrer\">the hackage documentation</a> and <a href=\"https://github.com/mongodb-haskell/mongodb/blob/master/doc/tutorial.md#action-monad\" rel=\"nofollow noreferrer\">the tutorial on the haskell-mongodb github page</a>, <code>access</code> should have the type </p>\n\n<pre><code>MonadIO m =&gt; Pipe -&gt; AccessMode -&gt; Database -&gt; Action m a -&gt; m (Either Failure a)\n</code></pre>\n\n<p>However, in the type inference in my code, a local Hoogle query, and <a href=\"https://github.com/mongodb-haskell/mongodb/blob/master/Database/MongoDB/Query.hs#L118\" rel=\"nofollow noreferrer\">the source code</a>, there is no either involved. They are all showing the type</p>\n\n<pre><code>MonadIO m =&gt; Pipe -&gt; AccessMode -&gt; Database -&gt; Action m a -&gt; m a\n</code></pre>\n\n<p>I am still pretty new to Haskell so I hesitate to jump to the conclusion that the writers of the documentation were wrong, but from my frustrated perspective that feels like the case. </p>\n\n<p><strong>Is this monad/kind trickery, am I misreading the documentation, or is the documentation incorrect?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492708207, "post_id": 43523634, "comment_id": 74104856, "body": "By the way, if you&#39;re interested in a review (and your code works), try <a href=\"https://codereview.stackexchange.com\">Code Review</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1492705313, "post_id": 43524619, "comment_id": 74103158, "body": "This seems like a very obscure way to implement this function. Without list fusion, the second one would traverse the list four(!) times. The first one is OK, but I would take it one step further and compute the result directly rather than use a spurious O(n) index into a linked list."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1492705967, "post_id": 43524619, "comment_id": 74103537, "body": "Haskell won&#39;t traverse that many times even without list fusion due to laziness.  Try it out in ghci with <code>:print</code>, it won&#39;t even evaluate all of <code>ranges</code> if the score is less than 86.  Also, for a list this small it&#39;s pretty fast still.  Worrying about that level of optimization on a beginner problem like this is pointless."}, {"owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "edited": false, "score": 0, "creation_date": 1492710402, "post_id": 43524619, "comment_id": 74106149, "body": "I&#39;m not worried about actual performance, just if the design is good. Using lists here is really not needed. Probably the lowest barrier to understanding solution would be a Map from scores to grades or whatever the actual function is. Then you can use lookup and get a) proper failure handling b) O(log n) c) all the usual Map functions will work d) introspection into the lookup table (can get list of possible grades for example)"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 1, "last_activity_date": 1492704738, "last_edit_date": 1492704738, "creation_date": 1492704318, "answer_id": 43524619, "question_id": 43523634, "link": "https://stackoverflow.com/questions/43523634/haskell-beginner-optimal-way-to-solve-this/43524619#43524619", "title": "Haskell beginner - optimal way to solve this", "body": "<p>If you only accepted <code>Int</code> values (and still returned <code>Double</code>) then you could write it as</p>\n\n<pre><code>calcGrade x y =\n    let score = (min 46 (x + y) - 46) `div` 4\n        grades = [5.0, 4.0, 3.7, 3.3, 3.0, 2.7, 2.3, 2.0, 1.7, 1.3] ++ repeat 1.0\n    in grades !! score\n</code></pre>\n\n<p>But this leaves out the first 2 checks.  You could put them in rather easily, but it might be better to put that in a different function (also, the use of <code>error</code> is frowned upon in Haskell, better to use a type that indicates the function might fail, such as Maybe or Either).</p>\n\n<p>What this function does is calculates the sum of x and y first, then says \"which is smaller, x + y or 46?\".  This handles the case of <code>x + y &lt; 50</code>.  Next, it subtracts 46, so a score of 50 becomes 4, a score of 54 becomes 8, and so on.  The <code>div</code> function will do integer division by 4, so a score of 50 becomes 4 becomes 1, a score less than 50 becomes 0, and a score of 73 becomes 27 becomes 6.</p>\n\n<p>The grades themselves are stored in a list, any score less than 50 will index out the first element of 5.0, and then each range indexes out its corresponding element, so 73 indexes out the 7th element (index 6) of 2.3.  The <code>++ repeat 1.0</code> handles a score <code>&gt;= 86</code>.</p>\n\n<hr>\n\n<p>Another way you could solve this might make a bit more sense.  Just build a list of the ranges:</p>\n\n<pre><code>let score = x + y\n    mins = [0, 50, 54, 58, 62, 66, 70, 74, 78, 82, 86, 120]\n    ranges = zip mins (tail mins)  -- [(0, 50), (50, 54), ..., (86, 120)]\n    grades = [5.0, 4.0, 3.7, 3.3, 3.0, 2.7, 2.3, 2.0, 1.7, 1.3, 1.0]\n    inRange = map (\\(lower, upper) -&gt; lower &lt;= score &amp;&amp; score &lt; upper) ranges\nin snd $ head $ filter fst $ zip inRange grades\n</code></pre>\n\n<p>I think most of this logic is pretty clear, but the last line might be confusing.  It zips the <code>inRange</code> list of Bools with the grades, filters by the first element (whether that range included the score), takes the first element from the list, then grabs the second element of that <code>(Bool, Double)</code> tuple.</p>\n"}, {"comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1492706006, "post_id": 43524833, "comment_id": 74103558, "body": "Your suggestion to check in the reverse order is useful, but not because the order matters.  This technique could be applied with this order by not checking the lower bound since it&#39;s all done in order.  My second solution could also benefit from it by avoiding the <code>ranges</code> list altogether and modifying the <code>inRange</code> definition to follow suit.  The last line wouldn&#39;t even have to change if done correctly."}], "tags": [], "owner": {"reputation": 1735, "user_id": 2892792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5DNyi.jpg?s=128&g=1", "display_name": "Lazersmoke", "link": "https://stackoverflow.com/users/2892792/lazersmoke"}, "is_accepted": false, "score": 1, "last_activity_date": 1492705062, "creation_date": 1492705062, "answer_id": 43524833, "question_id": 43523634, "link": "https://stackoverflow.com/questions/43523634/haskell-beginner-optimal-way-to-solve-this/43524833#43524833", "title": "Haskell beginner - optimal way to solve this", "body": "<p>Some things you can try to clean it up a bit:</p>\n\n<ul>\n<li>Use a <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">where binding</a> to extract the common subexpression <code>x + y</code>.</li>\n<li>Better yet, just accept the already added number as an argument. Then this function will be your \"lookup grade\" function, and you can call it like <code>lookupGrade (exam + extra)</code>.</li>\n<li>Don't use <code>error</code>. Instead, return a <code>Maybe Double</code> (which is either <code>Just</code> a <code>Double</code>, or <code>Nothing</code> if you can't compute the score.</li>\n<li>List your guards in reverse order. This way, you only have to check one bound on each, not both. It is ok to overlap because they are checked <em>in order</em>.</li>\n<li>Try to extract the actual meaning of the grading algorithm, rather than trying to list out cases. Try to find a math formula that converts it like you want, then write that formula in Haskell.</li>\n</ul>\n\n<p>Applying these transformations is probably the best way to write this function, unless you want to use a Map (from <code>Data.Map</code>) to list larger numbers of cases. This code will express your intent better than using a bunch of unneeded lists.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1492746454, "post_id": 43532222, "comment_id": 74119430, "body": "I downvoted. This is clearly not computing the same function; has no discussion; and there are several questionable design decisions (e.g. why use a <code>Map</code> if you&#39;re just going to walk over every element anyway?)."}], "tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 1, "last_activity_date": 1492736597, "creation_date": 1492736597, "answer_id": 43532222, "question_id": 43523634, "link": "https://stackoverflow.com/questions/43523634/haskell-beginner-optimal-way-to-solve-this/43532222#43532222", "title": "Haskell beginner - optimal way to solve this", "body": "<p>Not sure about the performance, but this should work.</p>\n\n<pre><code>import Data.Map (fromAscList, filterWithKey)\n\ncalculate :: Double -&gt; Double -&gt; String \ncalculate exam bonus\n  | exam &gt; 20 || bonus &gt; 100 = \"Be real!\" \n  | otherwise = (foldr (++) \"\" . filterWithKey isInRange) letterGrade\n  where\n    isInRange k _ = percent `elem` k\n    percent = truncate $ (exam + bonus) * 10 / 12\n    letterGrade = fromAscList [ ([90..100], \"A\"), ([80..89],  \"B\"), ([70..79],  \"C\"), ([60..69],  \"D\"), ([0 ..59],  \"F\")]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1492747235, "creation_date": 1492747235, "answer_id": 43533742, "question_id": 43523634, "link": "https://stackoverflow.com/questions/43523634/haskell-beginner-optimal-way-to-solve-this/43533742#43533742", "title": "Haskell beginner - optimal way to solve this", "body": "<p>If I wanted to implement <em>that exact same function</em> (as opposed to changing the specification so that I could make the code cleaner -- which is sometimes possible), I think I would use <code>Map</code>'s <code>lookupGT</code> to encode the lookup table that is currently done with guards. So:</p>\n\n<pre><code>import Data.Map (fromAscList, lookupGT)\n\ncalcGrade :: Double -&gt; Double -&gt; Double\ncalcGrade x y\n    | x &gt; 20 = error \"Can't add more than 20 extra points\"  \n    | y &gt; 100 = error \"Can't achieve more than 100 points\"\n    | otherwise = case lookupGT (x+y) cutoffs of\n        Just (_, v) -&gt; v\n        Nothing -&gt; 1.0\n    where\n    cutoffs = fromAscList [(50, 5.0), (54, 4.0), (58, 3.7), (62, 3.3), (66, 3.0), (70, 2.7), (74, 2.3), (78, 2.0), (82, 1.7), (86, 1.3)]\n</code></pre>\n\n<p>This has a few advantages:</p>\n\n<ul>\n<li>Much less repetition. This is a virtue in and of itself.</li>\n<li>With the guards, the reader must carefully check that the condition is on <code>x+y</code> in every case, and not, say, the very visually similar <code>x+v</code> for some case for some reason. With this encoding, that's clear without careful attention.</li>\n<li>Each guard would be checked in turn, giving a linear runtime in the number of cutoffs. With <code>Map</code>'s <code>lookupGT</code>, only a log number of comparisons is done. Since you probably don't intend to vary the cutoffs dynamically, this probably doesn't matter; but the trick used here can occasionally be useful elsewhere, so it's nice to remember it for those cases where asymptotics do matter.</li>\n<li>Because cutoffs appear in only one place, if this changes later (you'd be surprised...) you don't have to be careful to change, e.g., <code>58</code> to <code>59</code> in two places as one would need to do with your code.</li>\n</ul>\n\n<p>The only wart, in my opinion, is that the default score case (<code>Nothing -&gt; 1.0</code>) doesn't live next to the cutoffs; though it's not clear to me how one might go about doing that sanely.</p>\n"}], "owner": {"reputation": 11, "user_id": 7896014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75a1587b660eff1f5e14fa298f7f0a33?s=128&d=identicon&r=PG&f=1", "display_name": "xxxxqwqxwxqbggqwcweqcwqc", "link": "https://stackoverflow.com/users/7896014/xxxxqwqxwxqbggqwcweqcwqc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1492747235, "creation_date": 1492701568, "question_id": 43523634, "link": "https://stackoverflow.com/questions/43523634/haskell-beginner-optimal-way-to-solve-this", "title": "Haskell beginner - optimal way to solve this", "body": "<p>I was assigned the task to create a function which is able to calculate the grade of your exam by adding the points you achieved to the extra points you collected through other means and then converting them into the grade system. I also had to add an error message if either the extra points or the exam points exceeded their maximum (20 and 100 respectively). </p>\n\n<p>The function I created works, but it probably isn't close to being optimal. </p>\n\n<pre><code>calcGrade :: Double -&gt; Double -&gt; Double\ncalcGrade x y\n| x &gt; 20 = error \"Can't add more than 20 extra points\"  \n| y &gt; 100 = error \"Can't achieve more than 100 points\"\n| x + y &lt; 50 = 5.0 \n| x + y &gt;= 50 &amp;&amp; x + y &lt; 54 = 4.0\n| x + y &gt;= 54 &amp;&amp; x + y &lt; 58 = 3.7\n| x + y &gt;= 58 &amp;&amp; x + y &lt; 62 = 3.3\n| x + y &gt;= 62 &amp;&amp; x + y &lt; 66 = 3.0\n| x + y &gt;= 66 &amp;&amp; x + y &lt; 70 = 2.7\n| x + y &gt;= 70 &amp;&amp; x + y &lt; 74 = 2.3\n| x + y &gt;= 74 &amp;&amp; x + y &lt; 78 = 2.0\n| x + y &gt;= 78 &amp;&amp; x + y &lt; 82 = 1.7\n| x + y &gt;= 82 &amp;&amp; x + y &lt; 86 = 1.3\n| x + y &gt;= 86               = 1.0 \n</code></pre>\n\n<p>Is there another way of doing this or is there anything I could do more efficiently? I'm pretty new to Haskell and programming in general so I'm thankful for any advice!</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1492701465, "post_id": 43523460, "comment_id": 74100569, "body": "The value returned from a function is <i>not</i> the parameter you are passing to it."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1492701540, "post_id": 43523460, "comment_id": 74100618, "body": "welcome to haskell, where values are immutable"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1492702873, "post_id": 43523460, "comment_id": 74101537, "body": "Why do you expect the function to modify <code>left</code>? Why not <code>c</code> for example?"}], "answers": [{"tags": [], "owner": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "is_accepted": false, "score": 3, "last_activity_date": 1492701534, "creation_date": 1492701534, "answer_id": 43523623, "question_id": 43523460, "link": "https://stackoverflow.com/questions/43523460/modify-a-list-in-haskell/43523623#43523623", "title": "Modify a list in haskell", "body": "<p>Haskell functions are <a href=\"https://en.wikipedia.org/wiki/Pure_function\" rel=\"nofollow noreferrer\">pure functions</a>, which means they can't have side effects such as modifying variables.  Your <code>typer</code> function computes a result <em>based</em> on its arguments, but it doesn't (and can't) actually modify its arguments.</p>\n\n<p>As an analogy, in mathematics, if <em>n</em> is 4 then sqrt(<em>n</em>) is 2, but <em>n</em> is still 4 even after you've computed its square root.</p>\n\n<p>If you want to capture the result of your function call so you can use it later, assign it to another variable:</p>\n\n<pre><code>right = typer left 'a'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "edited": false, "score": 1, "creation_date": 1492703622, "post_id": 43523724, "comment_id": 74102062, "body": "Regarding your last statement: you <i>can</i> redefine variables with consecutive <code>let</code> statements in a <code>do</code> block, which hide earlier definitions of the same name.  The GHCi REPL is similar to a big <code>do</code> block in that regard."}, {"owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "reply_to_user": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "edited": false, "score": 0, "creation_date": 1492708071, "post_id": 43523724, "comment_id": 74104794, "body": "Right, those are implicitly nested scopes, and you can do the same by explicitly nesting <code>let .. in</code> and <code>where</code> blocks in pure code. It&#39;s probably more confusing for newcomers in the latest GHCi because the <code>let</code> keyword is no longer required there for bindings, and it looks like you&#39;re doing regular Haskell declaration in the REPL."}], "tags": [], "owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "is_accepted": false, "score": 2, "last_activity_date": 1492701772, "creation_date": 1492701772, "answer_id": 43523724, "question_id": 43523460, "link": "https://stackoverflow.com/questions/43523460/modify-a-list-in-haskell/43523724#43523724", "title": "Modify a list in haskell", "body": "<p>Nope! Values in Haskell are immutable. </p>\n\n<p>You have declared your <code>left</code> to be equal to <code>\"hello\"</code>, and it will <em>always</em> be equal to <code>\"hello\"</code>. You can hide that particular <code>left</code> value with some new token called <code>left</code> in a closer scope (such as having a function argument called <code>left</code>, which will make the globally defined <code>left</code> invisible in the function body). There is however no way to change your declared <code>left</code> value[1].</p>\n\n<p>A <em>new</em> string is returned by <code>typer</code>, and you have to hold onto that value if you want to hold onto <code>\"helloa\"</code>.</p>\n\n<p>[1] In GHCi, you can hide previous definitions by re-defining them. This quietly re-purposes the existing name to point to a new value. You cannot do this in a Haskell source file.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7889142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9ed8ceac670397224c8c15fd691c484?s=128&d=identicon&r=PG&f=1", "display_name": "C. L. M. Petersson", "link": "https://stackoverflow.com/users/7889142/c-l-m-petersson"}, "is_accepted": false, "score": 0, "last_activity_date": 1492766618, "last_edit_date": 1492766618, "creation_date": 1492765410, "answer_id": 43538376, "question_id": 43523460, "link": "https://stackoverflow.com/questions/43523460/modify-a-list-in-haskell/43538376#43538376", "title": "Modify a list in haskell", "body": "<p>Not usually, no. Usually, Haskell variables are not mutable. There are however libraries that contain mutable variables. For example, <code>Data.IORef</code> contains <code>IORef</code>, which is mutable. I will explain how to use them below, but as a general rule, using I would recommend against it, and instead write your code in a more functional manner.</p>\n\n<p>With IORef, your function <code>typer</code> can be rewritten</p>\n\n<pre><code>typer :: IORef [Char] -&gt; Char -&gt; IO()\ntyper left c = writeIORef left . (++[c]) =&lt;&lt; readIORef left\n</code></pre>\n\n<p>Let us consider its different parts. </p>\n\n<ul>\n<li><code>readIORef left</code> pulls out the value <code>\"hello\"</code> from the <code>IORef</code> and wraps it in the <code>IO</code> monad.</li>\n<li><code>f =&lt;&lt; x</code> takes <code>x</code>, which is wrapped in a monad, unwraps it and passes it as an argument to <code>f</code>, but <strong>only</strong> if we promise that <code>f</code> returns a value wrapped in the same monad. Here, <code>x</code> is <code>\"hello\"</code> wrapped in <code>IO</code> and <code>f</code> is <code>writeIORef left . (++[c])</code>.</li>\n<li><code>.</code> combines the functions <code>writeIORef left</code> and <code>(++[c])</code> into one, so that <code>(++[c])</code> is applied before <code>writeIORef left</code>.</li>\n<li><code>(++[c])</code> appends the character <code>c</code>.</li>\n<li><code>writeIORef left</code> returns an empty action wrapped in <code>IO</code> (<code>IO()</code>), but it has the side effect that the value of the <code>IORef</code> <code>left</code> is modified. Since it returns a value wrapped in <code>IO</code>, the promise we made to <code>=&lt;&lt;</code> is fulfilled.</li>\n</ul>\n\n<p>With the above function, the code</p>\n\n<pre><code>main :: IO()\nmain = do x &lt;- newIORef \"hello\"\n          typer x 'a'\n          readIORef x &gt;&gt;= print\n</code></pre>\n\n<p>should yield the desired effect.</p>\n"}], "owner": {"reputation": 1, "user_id": 7896609, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fC9HR823ZLU/AAAAAAAAAAI/AAAAAAAAAAs/8CH-WisnRlM/photo.jpg?sz=128", "display_name": "hallamsamuel", "link": "https://stackoverflow.com/users/7896609/hallamsamuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1492766618, "creation_date": 1492701103, "question_id": 43523460, "link": "https://stackoverflow.com/questions/43523460/modify-a-list-in-haskell", "title": "Modify a list in haskell", "body": "<p>I have a list of chars</p>\n\n<pre><code>left = ['h', 'e', 'l', 'l', 'o']\n</code></pre>\n\n<p>and the function</p>\n\n<pre><code>typer :: [Char] -&gt; Char -&gt; [Char]\ntyper left c = left ++ [c]\n</code></pre>\n\n<p>Which seems to work if I type <code>typer left 'a'</code> into <code>ghci</code> it returns <code>\"helloa\"</code> but if I then try to read <code>left</code> it returns <code>\"hello\"</code>. Where does the <code>\"a\"</code> go? is there anyway to manipulate <code>left</code> using the function?</p>\n\n<p><a href=\"https://i.stack.imgur.com/wUBfT.png\" rel=\"nofollow noreferrer\">example of console output </a></p>\n"}, {"tags": ["haskell", "space-leak"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "edited": false, "score": 0, "creation_date": 1492703223, "post_id": 43523508, "comment_id": 74101794, "body": "Thanks for the quick reply. This is a fantastic and clear explanation. I have a couple of follow up questions though:   1. Why is it that the compiler can&#39;t optimize for this? It seems a ripe target.  2. Is there any practical way to do this with the standard distribution? I find this solution satisfactory, but unfortunately the competition server does not support the vectors package.  Thanks again."}, {"owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "reply_to_user": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "edited": false, "score": 0, "creation_date": 1492707642, "post_id": 43523508, "comment_id": 74104541, "body": "That would be a fairly complicated level of optimization. There is strictness analysis phase, but you cannot always get it right because of Turing Completeness. You can check for a strict list package being available or make your own strict list type of <code>data SList a = Cons !a !(SList a) | Nil</code> which will force the entire list if the head is forced. You can also check if deepseq is available, which you can use to force a regular list to be fully evaluated."}, {"owner": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "edited": false, "score": 1, "creation_date": 1492708633, "post_id": 43523508, "comment_id": 74105099, "body": "Very interesting, thank you for your time. It is a bit of a hack, but I have found that Data.IntMap.Strict is actually fast enough to work in this competition. Thanks again for your help."}], "tags": [], "owner": {"reputation": 295, "user_id": 1946543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bc3cc803d2303f47cb3d9c56fcfd1?s=128&d=identicon&r=PG", "display_name": "Steven Armstrong", "link": "https://stackoverflow.com/users/1946543/steven-armstrong"}, "is_accepted": true, "score": 1, "last_activity_date": 1492701228, "creation_date": 1492701228, "answer_id": 43523508, "question_id": 43522923, "link": "https://stackoverflow.com/questions/43522923/haskell-bottom-up-dp-space-leak/43523508#43523508", "title": "Haskell bottom-up DP space leak", "body": "<p>So, by using <code>foldl'</code> you have ensured that the accumulator will be in WHNF. Putting a list in WHNF only evaluates the first element of the list. The remainder of the list exists as a thunk, and will be passed around as a thunk to the subsequent calls of your fold. Since you are interested in multiple positions in the list at once (that is, you are dropping some parts of it in the <code>zipWith</code>) large portions of the lists are being kept from previous iterations.</p>\n\n<p>The structure you need here is an unboxed vector. An unboxed vector will ensure that everything is maximally strict, and will run in far less memory.</p>\n"}], "owner": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 43523508, "answer_count": 1, "score": 0, "last_activity_date": 1492703575, "creation_date": 1492699815, "last_edit_date": 1492703575, "question_id": 43522923, "link": "https://stackoverflow.com/questions/43522923/haskell-bottom-up-dp-space-leak", "title": "Haskell bottom-up DP space leak", "body": "<p>Apologies if this is too specific, I am new here and not exactly sure what is reasonable. I have been bashing my head against this problem for hours with nothing to show for it. The following code is my implementation of a competitive programming problem.</p>\n\n<pre><code>module Main where\n\nimport Data.List (foldl', groupBy)\nimport Debug.Trace\n\ntype Case = (Int, [(Int, Int)])\ntype Soln = Int\n\nmain = interact handle\n\nhandle :: String -&gt; String\nhandle = fmt . solve . parse\n\nfmt :: Soln -&gt; String\nfmt s = (show s) ++ \"\\n\"\n\nparse :: String -&gt; Case\nparse s = (l, fs)\n  where\n    (l:_:fs') = (map read) $ words s\n    fs = pairs fs'\n\npairs :: [a] -&gt; [(a, a)]\npairs [] = []\npairs (a:b:s) = (a, b):(pairs s)\n\nsolve :: Case -&gt; Soln\nsolve c@(l, fs) = last $ foldl' run [0..l] f\n  where\n    f = concat $ map rep $ map combine $ groupBy samev fs\n    samev a b = (snd a) == (snd b)\n    combine a = (sum $ map fst $ a, snd $ head $ a)\n    rep (n, v) = replicate (min n (l `div` v)) v\n\nrun :: [Int] -&gt; Int -&gt; [Int]\nrun b v = (take v b) ++ (zipWith min b (drop v b))\n-- run b v = (take v b) ++ (zipMin b (drop v b))\n\nzipMin :: [Int] -&gt; [Int] -&gt; [Int]\nzipMin [] _ = []\nzipMin _ [] = []\nzipMin (a:as) (b:bs) = (min a b):(zipMin as bs)\n</code></pre>\n\n<p>The intent is that this works like a bottom-up dynamic programming solution generating each row of the DP table from the previous using the fold in solve. In theory GHC should be able to optimize out all the old rows of the table. However, running this program on a moderately large input with approximately <code>l = 2000</code> and <code>length f = 5000</code>, I get this:</p>\n\n<pre><code>&gt; time ./E &lt; E.in \n0\n1.98user 0.12system 0:02.10elapsed 99%CPU (0avgtext+0avgdata 878488maxresident)k\n0inputs+0outputs (0major+219024minor)pagefaults 0swaps\n</code></pre>\n\n<p>That's using 878 MB of memory at peak! The table I am generating is only 10,000 Ints, and in theory I only need one row at a time! It seems obvious that this is some form of thunk leak or other space leak. Profiling reveals that <code>run</code> is consuming 99% of total runtime and memory. Digging further indicated that 98% of that was in the <code>zipWith</code> call. Interestingly, replacing the call to <code>zipWith min</code> with my custom <code>zipMin</code> function produces a significant improvement:</p>\n\n<pre><code>&gt; time ./E &lt; E.in \n0\n1.39user 0.08system 0:01.48elapsed 99%CPU (0avgtext+0avgdata 531400maxresident)k\n0inputs+0outputs (0major+132239minor)pagefaults 0swaps\n</code></pre>\n\n<p>That's just 70% the run time, and 60% the memory! I tried all sorts to make this work. I know <code>(++)</code> is generally a bad idea, so I replaced the lists in <code>run</code> with <code>Data.Sequence.Seq Int</code>... and it got slower and used more memory. I am not particularly experienced with Haskell, but I am at my wit's end here. I am sure the answer to this problem exists somehwere on SO, but I am too new to Haskell to be able to find it, it seems.</p>\n\n<p>Any help any of you can offer is very much appreciated. I would love an explanation of exactly what I have done wrong, how to diagnose it in future, and how to fix it.</p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>After following Steven's Excellent advice and replacing my lists with unboxed vectors the performance is... uh... <em>signficantly</em> improved:</p>\n\n<pre><code>&gt; time ./E &lt; E.in \n0\n0.01user 0.00system 0:00.02elapsed 80%CPU (0avgtext+0avgdata 5000maxresident)k\n24inputs+0outputs (0major+512minor)pagefaults 0swaps\n</code></pre>\n"}, {"tags": ["haskell", "generics"], "comments": [{"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1492694499, "post_id": 43520756, "comment_id": 74094852, "body": "<a href=\"https://stackoverflow.com/questions/2468226/how-to-zip-multiple-lists-in-haskell\" title=\"how to zip multiple lists in haskell\">stackoverflow.com/questions/2468226/&hellip;</a> <a href=\"https://stackoverflow.com/questions/39991581/how-can-i-implement-generalized-zipn-and-unzipn-in-haskell\" title=\"how can i implement generalized zipn and unzipn in haskell\">stackoverflow.com/questions/39991581/&hellip;</a> <a href=\"https://stackoverflow.com/questions/40342060/convert-a-tuple-of-lists-of-the-same-length-to-a-list-of-tuples-for-arbitrary\" title=\"convert a tuple of lists of the same length to a list of tuples for arbitrary\">stackoverflow.com/questions/40342060/&hellip;</a>"}, {"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1492694742, "post_id": 43520756, "comment_id": 74095041, "body": "<a href=\"https://stackoverflow.com/questions/7828072/how-does-haskell-printf-work\" title=\"how does haskell printf work\">stackoverflow.com/questions/7828072/&hellip;</a>"}, {"owner": {"reputation": 7463, "user_id": 1145760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/065408758852145010d28c2aa811ca68?s=128&d=identicon&r=PG", "display_name": "Vorac", "link": "https://stackoverflow.com/users/1145760/vorac"}, "reply_to_user": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1492694762, "post_id": 43520756, "comment_id": 74095058, "body": "@JoshLee thanks for the links. The seconds one gets the closest, but sill leaves me with a lot of qualms 1) why is the standard implementation for fixed n = 2 2) I need to pass the number of lists, that&#39;s unwieldy 3) even if I define my own zip, there will be collisions with Prelude.zip."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1492696334, "post_id": 43520756, "comment_id": 74096347, "body": "&quot;I need to pass the number of lists,&quot; then you need something other than <code>zip</code>. Even the more &quot;generic&quot; variants still need fixed numbers of arguments; I get the impression what you want is closer to the <code>transpose</code> function."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1492719808, "last_edit_date": 1492719808, "creation_date": 1492700441, "answer_id": 43523174, "question_id": 43520756, "link": "https://stackoverflow.com/questions/43520756/why-isnt-zip-generic-with-respect-to-argument-count/43523174#43523174", "title": "Why isn&#39;t zip generic with respect to argument count?", "body": "<p>Because the suggested duplicates answer most of this, I will focus on the questions in your followup comment.</p>\n\n<blockquote>\n  <p>1) why is the standard implementation for fixed n = 2</p>\n</blockquote>\n\n<p><code>zipWith</code> is for 2 arguments, and <code>repeat</code> is for 0 arguments. This is enough to get arbitrary-arity zips. For example, the 1 argument version (also called <code>map</code>) can be implemented as</p>\n\n<pre><code>map f = zipWith ($) (repeat f)\n</code></pre>\n\n<p>and the 3 argument version as</p>\n\n<pre><code>zipWith3 f = (.) (zipWith ($)) . zipWith f\n</code></pre>\n\n<p>and so on. There is a pretty pattern to the implementations of larger zips (admittedly not obvious from this small sample size). This result is analogous to the one in CT which says that any category with 0-ary and 2-ary products has all finitary products.</p>\n\n<p>The other half of the answer, I suppose, is that type-level numbers (which are the most frequent implementation technique for arbitrary-arity zips) are possible but annoying to use, and avoiding them tends to reduce both term- and type-level noise.</p>\n\n<blockquote>\n  <p>2) I need to pass the number of lists, that's unwieldy</p>\n</blockquote>\n\n<p>Use <code>ZipList</code>. You don't need to pass the number of lists (though you do need to write one infix operator per list -- a very light requirement, I think, as even in Python you need a comma between each list).</p>\n\n<p>Empirically: I have not found arbitrary-arity zips such a common need that I would label it \"unwieldy\".</p>\n\n<blockquote>\n  <p>3) even if I define my own zip, there will be collisions with Prelude.zip.</p>\n</blockquote>\n\n<p>So pick another name...?</p>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 6515250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db8d3320f9de0401804a1058b27289c?s=128&d=identicon&r=PG&f=1", "display_name": "TanasaIoan", "link": "https://stackoverflow.com/users/6515250/tanasaioan"}, "is_accepted": false, "score": 1, "last_activity_date": 1493191823, "last_edit_date": 1495535482, "creation_date": 1493191823, "answer_id": 43627696, "question_id": 43520756, "link": "https://stackoverflow.com/questions/43520756/why-isnt-zip-generic-with-respect-to-argument-count/43627696#43627696", "title": "Why isn&#39;t zip generic with respect to argument count?", "body": "<p>Because the type signatures would be different, for example the type signatures of zip and zip3 are different:</p>\n\n<p><code>zip :: [a] -&gt; [b] -&gt;[(a,b)]</code></p>\n\n<p><code>zip3:: [a] -&gt; [b] -&gt; [c] -&gt; [(a,b,c)]</code></p>\n\n<p><code>zip3</code> takes one more argument than <code>zip</code> and secondly the type, and haskell does not allow you to have a polymorphism with different numbers of arguments because of currying. <a href=\"https://stackoverflow.com/questions/36314/what-is-currying\">Here</a> is an explanation of what currying is on SO.</p>\n"}], "owner": {"reputation": 7463, "user_id": 1145760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/065408758852145010d28c2aa811ca68?s=128&d=identicon&r=PG", "display_name": "Vorac", "link": "https://stackoverflow.com/users/1145760/vorac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1493191823, "creation_date": 1492694373, "last_edit_date": 1492741767, "question_id": 43520756, "link": "https://stackoverflow.com/questions/43520756/why-isnt-zip-generic-with-respect-to-argument-count", "title": "Why isn&#39;t zip generic with respect to argument count?", "body": "<p>Haskell newbie here. It is my observation that:</p>\n\n<ul>\n<li><p><code>zip</code> and <code>zip3</code> are important functions - the are included in the Prelude, implemented by many other languages, represent a common operation in mathematics(transposition)</p></li>\n<li><p>not generic with respect to parameter structure</p></li>\n<li><p>easy to implement in traditional languages - C or C++ (say 20 hours work); python already has it as a build-in</p></li>\n</ul>\n\n<p>Why is <code>zip</code> so restricted? Is there an abstraction, generalizing it? Something wrong with n-sized tuples?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1492693382, "post_id": 43520248, "comment_id": 74093938, "body": "Err, is the indentation <i>exactly</i> like that? That being said, all patterns should stand next to each other, e.g. all <code>k + v</code>, then all <code>k - v</code> and so on."}, {"owner": {"reputation": 103, "user_id": 7087326, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FmwwcbQozgw/AAAAAAAAAAI/AAAAAAAACOI/9i0bxvfk1Mc/photo.jpg?sz=128", "display_name": "Ando Bando", "link": "https://stackoverflow.com/users/7087326/ando-bando"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492693616, "post_id": 43520248, "comment_id": 74094128, "body": "Oops, I should have fixed the indention in the question, my real code was indented differently. I&#39;ll try changing the order of the lines. Thanks!"}, {"owner": {"reputation": 103, "user_id": 7087326, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FmwwcbQozgw/AAAAAAAAAAI/AAAAAAAACOI/9i0bxvfk1Mc/photo.jpg?sz=128", "display_name": "Ando Bando", "link": "https://stackoverflow.com/users/7087326/ando-bando"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1492693752, "post_id": 43520248, "comment_id": 74094254, "body": "Thanks! it was the line order that did it. If i move the <code>Minus a + Minus b ...</code> up to just below  <code>Plus a + Plus b ...</code> it works"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1492703266, "creation_date": 1492703266, "answer_id": 43524283, "question_id": 43520248, "link": "https://stackoverflow.com/questions/43520248/conflicting-definitions-and-pattern-matching-in-typeclass-instance-declaration/43524283#43524283", "title": "Conflicting Definitions and Pattern Matching in typeclass instance declaration", "body": "<p>When you define a function <code>f</code>, all patterns of the function must be next to each other:</p>\n\n<pre><code>f 1 'a' = 0\nf 1 'b' = 1\nf k v   = 2\n</code></pre>\n\n<p>If you add a pattern of another function in-between, you have multiple declarations:</p>\n\n<pre><code>f 1 'a' = 0\nf 1 'b' = 1\n\nwhoops k = \"hello\"\n\nf k v   = 2 -- error here\n</code></pre>\n\n<p>So put all your <code>+</code> patterns next to each other.</p>\n"}], "owner": {"reputation": 103, "user_id": 7087326, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FmwwcbQozgw/AAAAAAAAAAI/AAAAAAAACOI/9i0bxvfk1Mc/photo.jpg?sz=128", "display_name": "Ando Bando", "link": "https://stackoverflow.com/users/7087326/ando-bando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 43524283, "answer_count": 1, "score": 0, "last_activity_date": 1492751632, "creation_date": 1492693074, "last_edit_date": 1492751632, "question_id": 43520248, "link": "https://stackoverflow.com/questions/43520248/conflicting-definitions-and-pattern-matching-in-typeclass-instance-declaration", "title": "Conflicting Definitions and Pattern Matching in typeclass instance declaration", "body": "<p>So, I'm Trying to write a typeclass instance for a type I've made and I'm running into issues.</p>\n\n<pre><code>data PlusMinus a = Plus a | Minus a | Zero\nderiving(Eq,Show)\n</code></pre>\n\n<p>Essentialy we've got a type that has 3 different data constructors and the instance of <code>Num</code> should behave differently based on those different constructors.</p>\n\n<pre><code>instance (Ord a, Eq a,Num a) =&gt; Num (PlusMinus a) where\n    Plus a + Plus b = Plus (a + b)\n    Plus a - Plus b\n        | a &gt; b  = Plus (a - b)\n        | a == b = Zero\n        | a &lt; b  = Minus (b - a)\n    Plus a * Plus b = Plus (a * b)\n    abs (Plus a)    = Plus (a)\n    signum (Plus a) = 1\n    fromInteger a\n        | a &gt; 0  = Plus (fromInteger a)\n        | a == 0 = Zero\n        | a &lt; 0  = Minus (fromInteger . abs $ a)\n</code></pre>\n\n<p>So, Up to here it works fine, and behaves like expected, but when I add</p>\n\n<pre><code>Minus a + Minus b = Minus (a + b)\n</code></pre>\n\n<p>Suddenly I am told i have conflicting definitions for <code>+</code>.\nWhy doesn't this work like pattern matching for function definitions?\nDoes it work the same way and I am just doing something wrong? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "edited": false, "score": 0, "creation_date": 1492764353, "post_id": 43520903, "comment_id": 74127925, "body": "Thanks for that. I replaced foldr with foldM, changed the parameters and type signatures around a bit and all good. Haven&#39;t looked at your alternative solution but will do so asap."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 1, "last_activity_date": 1492694782, "creation_date": 1492694782, "answer_id": 43520903, "question_id": 43519517, "link": "https://stackoverflow.com/questions/43519517/conflicting-type-signature/43520903#43520903", "title": "Conflicting Type Signature", "body": "<p>The expression <code>parseFromFile</code> would presumably have the type <code>IO (Maybe Config)</code> (I'm basing this off of it needing to do IO to read the file contents, and the fact that your case expression matches on Just and Nothing), so if you're going to use it in <code>getIni</code> then it also needs to return a type in <code>IO</code>, possibly something like <code>IO (Map FileName Config)</code>.  This would make <code>getIni</code> look more like</p>\n\n<pre><code>getIni :: FileName -&gt; Map FileName Config -&gt; IO (Map FileName Config)\ngetIni fn mp = do\n    rslt &lt;- parseFromFile parseIni fn\n    case rslt of\n        Nothing -&gt; return M.empty\n        Just confg -&gt; do\n            let ky = tail $ dropWhile (/= '\\\\') fn\n            return $ M.insert ky confg mp\n</code></pre>\n\n<p>Then to use it in <code>main</code>, you would have to use a monadic fold instead of the pure <code>foldr</code>.  Also, you may want to have <code>Nothing -&gt; return mp</code> instead, since a parse error will wipe out whatever files you've already parsed.</p>\n\n<p>Alternatively, you could build a <code>Map FileName String</code> mapping the filename to the contents, then you can use pure functions like <code>M.map</code> and <code>M.filter</code> to turn this into a <code>Map FileName Config</code>.  There's functions in <code>Data.Map</code> that would even allow you to do</p>\n\n<pre><code>parseIniFiles :: Map FileName String -&gt; (Map FileName ParseError, Map FileName Config)\nparseIniFiles contentMap = M.mapEither (parse parseIni \"ini\") contentMap\n</code></pre>\n\n<p>And your <code>main</code> would look like</p>\n\n<pre><code>main = do\n    iniF &lt;- (concat . fst) &lt;$&gt; globDir [compile \"*.ini\"] fPath\n    contentMap &lt;- M.fromList &lt;$&gt; do\n        contents &lt;- mapM readFile iniF\n        -- As an aside, there is a better way to get the stem of the file path\n        -- Go look for a function that will split file paths into their components\n        return (tail $ dropWhile (/= '\\\\') fn, contents)\n    let (invalidFiles, validFiles) = parseIniFiles contentMap\n    putStrLn \"Valid files\"\n    print validFiles\n    putStrLn \"Invalid Files\"\n    print invalidFiles\n</code></pre>\n\n<p>(Disclaimer: I haven't compiled any of this code, but it should give you the general idea)</p>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1492695124, "creation_date": 1492691172, "last_edit_date": 1492695124, "question_id": 43519517, "link": "https://stackoverflow.com/questions/43519517/conflicting-type-signature", "title": "Conflicting Type Signature", "body": "<p>This bit of code reads a directory and puts all the .ini filenames in a list. It then goes through the list reading each file, parsing it, and placing the parsed result and filename in a map (Key=filename, contents=parsed result - Config). My question is how can I get this line <code>rslt &lt;- parseFromFile parseIni fn</code> to fit in with the type signature of <code>getIni</code>? <code>parseFromFile</code> has type signature <code>monad m =&gt; m (Maybe Config)</code> which doesn't fit in. Alternatively could somebody suggest a better way of coding it? I have only included the relavent code here. The functions in question are <code>main</code> and <code>getIni</code>.</p>\n\n<pre><code>import System.FilePath.Glob (globDir, compile)\nimport Control.Monad.IO.Class\nimport Data.Map (Map)\nimport qualified Data.Map as M\nimport Data.ByteString (ByteString)\nimport Control.Applicative\nimport Text.Trifecta\n\nfPath = \"c:/users/tyrone/myprojects/chp29\"\n\ntype FileName = String\ntype Name = String\ntype Value = String\ntype Assignments = Map Name Value\n\nnewtype Header = Header String deriving (Eq, Ord, Show)\n\ndata Section = Section Header Assignments deriving (Eq, Show)\n\nnewtype Config = Config (Map Header Assignments) deriving (Eq, Show)\n\nparseIni :: Parser Config\nparseIni = do\n  sections &lt;- some parseSection\n  let mapOfSections = foldr rollup M.empty sections\n  return $ Config mapOfSections\n\ngetIni :: FileName -&gt; Map FileName Config -&gt; Map FileName Config\ngetIni fn mp = do\n  rslt &lt;- parseFromFile parseIni fn\n  case rslt of\n    Nothing -&gt; M.empty\n    Just confg -&gt; do let ky = tail $ dropWhile (/= '\\\\') fn\n                     M.insert ky confg mp\n\nmain :: IO ()\nmain = do\n  iniF &lt;- (concat . fst) &lt;$&gt; globDir [compile \"*.ini\"] fPath\n  print $ foldr getIni M.empty iniF\n</code></pre>\n"}, {"tags": ["haskell", "existential-type"], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1492795982, "post_id": 43529868, "comment_id": 74149825, "body": "I should have made clear &quot;work <i>uniformly</i> for all a&quot;. it&#39;s this notion of naturality I was wondering about. in different categories at value and at type level, obviously."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1492796922, "post_id": 43529868, "comment_id": 74150339, "body": "enforcing naturality can be useful for ensuring progress in a tree. [11] Hasuo, I., Jacobs, B., Uustalu, T.: Categorical Views on Computations on Trees."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1492797138, "post_id": 43529868, "comment_id": 74150469, "body": "there is a nice implementation at value level by patrick bahr <a href=\"http://itu.dk/people/paba/pubs/files/bahr12mpc-paper.pdf\" rel=\"nofollow noreferrer\">itu.dk/people/paba/pubs/files/bahr12mpc-paper.pdf</a>"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 2, "last_activity_date": 1492722750, "last_edit_date": 1492722750, "creation_date": 1492722213, "answer_id": 43529868, "question_id": 43518111, "link": "https://stackoverflow.com/questions/43518111/types-constructors-and-existential-types/43529868#43529868", "title": "Types constructors and existential types", "body": "<p>I think you've confused a couple of different ideas here.</p>\n\n<blockquote>\n  <p>This type constructor works for all <code>a</code>.</p>\n</blockquote>\n\n<p>That's <em>totality</em>. <code>List :: * -&gt; *</code> produces a valid type of kind <code>*</code> given any argument <code>a</code> of kind <code>*</code>. Haskell 98 datatypes are always total, but, as you point out, in modern Haskell you can write type families which don't cover all possible cases. <code>TRes Int</code> is not a \"real\" type, in the sense that it contains no values, it doesn't reduce to any other type, and it's not equal to any type other than <code>TRes Int</code>.</p>\n\n<p>Haskell has no totality checker at the value level or the type level (apart from the rules about undecidable instances, which are a blunt instrument), so, just as there is no way to rule out <code>undefined</code> values, there is no way to rule out \"stuck\" type families like <code>TRes Int</code>. (For more on \"stuck\" type families see <a href=\"https://typesandkinds.wordpress.com/2015/09/09/what-are-type-families/\" rel=\"nofollow noreferrer\">this blog post</a> by Richard Eisenberg, the designer of <code>TypeInType</code>.)</p>\n\n<p><em>Naturality</em> is an altogether different idea. In value-level Haskell, a natural transformation between <code>f</code> and <code>g</code> is a polymorphic function mapping values of type <code>f x</code> to values of type <code>g x</code>, without knowing anything about <code>x</code>.</p>\n\n<pre><code>type f ~&gt; g = forall x. f x -&gt; g x\n</code></pre>\n\n<p>With GHC 8 and <code>TypeInType</code> we can talk about kinds using the same language we use to talk about types, because kinds <em>are</em> types. The type expression <code>forall x. f x -&gt; g x</code> has kind <code>*</code> (<code>(~&gt;) :: forall k. (k -&gt; *) -&gt; (k -&gt; *) -&gt; *</code>), so it's a perfectly valid classifier for types as well. A type with that kind is a polymorphic type function mapping types of kind <code>f x</code> to types of kind <code>g x</code>.</p>\n\n<p>What would you use a type-level natural transformation for, in the real world? I dunno. You wouldn't, probably.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 43529868, "answer_count": 1, "score": 1, "last_activity_date": 1492722750, "creation_date": 1492687298, "question_id": 43518111, "link": "https://stackoverflow.com/questions/43518111/types-constructors-and-existential-types", "title": "Types constructors and existential types", "body": "<p>Only polymorphic function can be applied to values of existential types.\nThose properties can be expressed by the corresponding quantifiers for expressions, and characterized by natural transformations.</p>\n\n<p>Similarly, when we define a type constructor</p>\n\n<pre><code>data List a = Nil | Cons a (List a)\n</code></pre>\n\n<p>This type constructor works for all <code>a</code> whereas type families allows to have non uniform type constructors</p>\n\n<pre><code>type family TRes i o\ntype instance TRes Bool = String\ntype instance TRes String  = Bool\n</code></pre>\n\n<p>What natural transformation characterizes precisely this idea of \"uniformity\"  at type level ?</p>\n\n<p>Is there an equivalent of forcing naturality like we have at value level with rank-n types ?</p>\n\n<pre><code>ApplyNat :: (forall a. a -&gt; F a) -&gt; b -&gt; F b\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1492724393, "creation_date": 1492724393, "answer_id": 43530381, "question_id": 43513084, "link": "https://stackoverflow.com/questions/43513084/how-to-write-function-that-combines-all-the-following-to-reach-desired-output/43530381#43530381", "title": "How to write function that combines all the following to reach desired output", "body": "<p>Well, you have nearly everything in place.  All you seem to be missing is, first, a means to calculate the widths of the columns.  You can define:</p>\n\n<pre><code>colWidth :: Column -&gt; Int\ncolWidth fields = maximum (map length fields)\n</code></pre>\n\n<p>to calculate the width of a single column.</p>\n\n<p>Then, you can use <code>transpose</code> from <code>Data.List</code> to transpose your table from a list of rows into a list of columns and map <code>colWidth</code> over those columns:</p>\n\n<pre><code>colWidths :: Table -&gt; [Int]\ncolWidths table = map colWidth (transpose table)\n</code></pre>\n\n<p>Second, you'll need the definition of <code>print_table</code>, which is short because you've already put in all the hard work:</p>\n\n<pre><code>print_table :: Table -&gt; [String]\nprint_table table =\n  let wdths = colWidths table              -- the column widths\n      separator = print_line wdths         -- the row-by-row separator\n      heading:body = map (print_row wdths) table   -- the rows\n      heading' = convert heading           -- the heading in upper-case\n  in [separator] ++ intersperse separator (heading':body) ++ [separator]\n</code></pre>\n\n<p>The only \"trick\" here is using <code>intersperse</code> (also from <code>Data.List</code>) to stick a copy of the separator between every pair of rows.</p>\n"}], "owner": {"reputation": 53, "user_id": 7888923, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8d5e00d3fdb902cd98979b65909a6188?s=128&d=identicon&r=PG&f=1", "display_name": "adsbb pppp", "link": "https://stackoverflow.com/users/7888923/adsbb-pppp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1492724393, "creation_date": 1492673813, "last_edit_date": 1492674289, "question_id": 43513084, "link": "https://stackoverflow.com/questions/43513084/how-to-write-function-that-combines-all-the-following-to-reach-desired-output", "title": "How to write function that combines all the following to reach desired output", "body": "<pre><code>type Field = String\ntype Row = [Field]\ntype Column = [Field]\ntype Table = [Row]\n\n\n\nprint_line :: [Int] -&gt; String\nprint_line lstcolumnwidths = case lstcolumnwidths of\n    []      -&gt;  \"+\"\n    n:ns    -&gt; '+' :replicate n '-' ++ print_line ns\n</code></pre>\n\n<p>This code creates a line eg. with an input [3,6] it will return \"+---+------+\"</p>\n\n<pre><code>print_field :: Int -&gt; Field -&gt; String\nprint_field columnwidth fieldcont \n    |isNum fieldcont        =  replicate (columnwidth - length fieldcont) ' ' ++ fieldcont\n    |otherwise              = fieldcont ++ replicate (columnwidth - length fieldcont) ' '\n\nisNum :: String -&gt; Bool\nisNum s = case s of \n     []      -&gt; True\n     x:xs    -&gt; isDigit x &amp;&amp; isNum xs\n</code></pre>\n\n<p>This code formats a Field eg input 5 \"Amy\" returns \"Amy  \" and \nfor input 5 \"78\" returns \"   78\"</p>\n\n<pre><code>print_row :: [Int] -&gt; Row -&gt; String\nprint_row lstcolumnwidths lstfieldcont  = convertString (zipWith print_field \nlstcolumnwidths lstfieldcont)\n\n\nconvertString :: [String] -&gt; String     \nconvertString x = case x of\n    []      -&gt; \"|\"\n    x:xs    -&gt; '|' : x ++ convertString xs\n</code></pre>\n\n<p>This code returns a formatted row eg input [5,4] [\"Tommy\",\"20\" ] returns\n\"|Tommy|  20|\"</p>\n\n<pre><code>print_table :: Table -&gt; [String]\n</code></pre>\n\n<p>I want to write a function for this that takes a Table and returns a list of Fields.\nThe input will be </p>\n\n<pre><code>[[\"first\",\"last\",\"gender\",\"age\"],[\"Patricia\",\"Davies\",\"female\",\"20\"],\n[\"Paul\",\"Dowden\",\"male\",\"19\"],[\"John\",\"Doe\",\"male\",\"24\"],\n[\"David\",\"Barker\",\"male\",\"21\"],[\"Eve\",\"Lee\",\"female\",\"23\"],\n[\"Mary\",\"Hester\",\"female\",\"21\"]]\n</code></pre>\n\n<p>and i want the output to be</p>\n\n<pre><code> [\"+--------+------+------+---+\",\"|FIRST   |LAST    |GENDER|AGE\",\"|Paul    \n|Dowden  |male  | 19\",\"+--------+------+------+---+\",\"|David   |Barker  |male  | 21\"...etc ]\n</code></pre>\n\n<p>Any tips on how to write a function that combines all the previous to reach this would be helpful.    </p>\n\n<p>I also have a function</p>\n\n<pre><code>convert :: String -&gt; String\nconvert list = case list of\n   []          -&gt; []\n   c:cs\n     |isUpper c -&gt; c: convert cs\n     |otherwise -&gt; toUpper c : convert cs\n</code></pre>\n\n<p>Which is used to convert the first field into uppercase.</p>\n"}]