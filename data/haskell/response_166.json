[{"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "edited": false, "score": 0, "creation_date": 1521085694, "post_id": 49289268, "comment_id": 85585268, "body": "I tried to run that code but got errors stating type variable a and b not in scope, details here -&gt; <a href=\"https://pastebin.com/izWi4f9J\" rel=\"nofollow noreferrer\">pastebin.com/izWi4f9J</a>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "edited": false, "score": 1, "creation_date": 1521086661, "post_id": 49289268, "comment_id": 85585480, "body": "@DonKlein: It was missing the <code>forall</code> quantifier to define the scope of <code>a</code> and <code>b</code> with <code>ScopedTypeVariables</code>. (Works for me now.)"}, {"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "edited": false, "score": 0, "creation_date": 1521099132, "post_id": 49289268, "comment_id": 85589766, "body": "Out of curiosity, what does <code>@</code> mean here?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "edited": false, "score": 0, "creation_date": 1521112935, "post_id": 49289268, "comment_id": 85598003, "body": "@DonKlein <code>f x</code> applies value <code>x</code> to <code>f</code>, while <code>f @ a</code> applies <i>type</i> (not value) <code>a</code> to <code>f</code>. The latter assumes that <code>f :: forall t. ....</code> and chooses <code>t</code> to be <code>a</code>. E.g. <code>id @ (Int, Bool) (3, True)</code> first specializes the identity on a pair type, and then applies it to a pair; here there is no actual need to specify <code>@(Int,Bool)</code> since the type inferer can infer that from <code>(3, True)</code>. Instead, above <code>typeRep</code> has no value arguments to drive the inference, and the type must be provided."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1521139547, "post_id": 49289268, "comment_id": 85616199, "body": "<code>typeRep @a</code> is same as <code>typeRep :: TypeRep a</code>, could have written: <code>eqTypeRep (typeRep :: TypeRep a) (typeRep :: TypeRep b)</code>. It&#39;s enabled by <code>:set -XTypeApplications</code> (in ghci) and is super useful"}, {"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "edited": false, "score": 0, "creation_date": 1521163199, "post_id": 49289268, "comment_id": 85625414, "body": "Thanks for all the tips, never thought by asking a question could learn so many tricks :)"}], "tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": true, "score": 9, "last_activity_date": 1521245074, "last_edit_date": 1521245074, "creation_date": 1521070493, "answer_id": 49289268, "question_id": 49289149, "link": "https://stackoverflow.com/questions/49289149/rigid-type-and-equality-check-is-this-possible-in-haskell/49289268#49289268", "title": "Rigid type and equality check - is this possible in Haskell?", "body": "<p>No, the type of <code>(==)</code> requires its arguments to be of the same type</p>\n\n<pre><code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>You ask if it's possible (to test equality between different types), yes it is possible but not something you'd normally do. You can use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Type-Reflection.html\" rel=\"nofollow noreferrer\"><code>Typeable</code></a> to witness that <code>a</code> and <code>b</code> are the same type but you need a <code>Typeable</code> constraint on both of them (and <code>Eq</code> constraint on either)</p>\n\n<pre><code>{-# Language ScopedTypeVariables #-}\n{-# Language TypeApplications    #-}\n{-# Language ConstraintKinds     #-}\n{-# Language GADTs               #-}\n\nimport Type.Reflection\n\ntype Equal a b = (Eq a, Typeable a, Typeable b)\n\nequal :: forall a b. Equal a b =&gt; a -&gt; b -&gt; Bool\nequal x y =\n  case eqTypeRep (typeRep @a) (typeRep @b) of\n    -- In this branch, `a' and `b' are the SAME type\n    -- so `(==)' works\n    Just HRefl -&gt; x == y\n\n    -- Values of different types are never equal\n    Nothing -&gt; False\n</code></pre>\n\n<p>so the following works</p>\n\n<pre><code>&gt;&gt; equal 10 'a'\nFalse\n&gt;&gt; equal 'X' 'a'\nFalse\n&gt;&gt; equal 'X' 'X'\nTrue\n</code></pre>\n\n<p>Make sure you understand why we only constrain one of <code>Eq a</code>/<code>Eq b</code> and it doesn't matter which one.</p>\n"}, {"comments": [{"owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1521213061, "post_id": 49289337, "comment_id": 85649373, "body": "@Iceland_jack it doesn&#39;t do what is expected, but you can equip the typeclass <code>Eqq</code> with your answer (great answer by the way) using <code>Typeable</code> to compare types and use <code>==</code> when both types are the same."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1521392493, "post_id": 49289337, "comment_id": 85700817, "body": "(Thanks) :) Ah I see"}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 3, "last_activity_date": 1521071547, "last_edit_date": 1521071547, "creation_date": 1521070975, "answer_id": 49289337, "question_id": 49289149, "link": "https://stackoverflow.com/questions/49289149/rigid-type-and-equality-check-is-this-possible-in-haskell/49289337#49289337", "title": "Rigid type and equality check - is this possible in Haskell?", "body": "<p>Despite the fact <code>Eq</code> won't allow you to define that function due to <code>==</code>'s signature, you can define your own typeclass:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nclass Eqq a b where\n  eqq :: a -&gt; b -&gt; Bool\n\n-- Just an example of a possible instance for general types\ninstance Eqq a b where\n  eqq a b = True \n</code></pre>\n\n<p>And then,</p>\n\n<pre><code>equal :: (Eqq a b) =&gt; a -&gt; b -&gt; Bool\nequal a b = a `eqq` b\n</code></pre>\n"}], "owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 1, "accepted_answer_id": 49289268, "answer_count": 2, "score": 3, "last_activity_date": 1521245074, "creation_date": 1521069783, "last_edit_date": 1521070500, "question_id": 49289149, "link": "https://stackoverflow.com/questions/49289149/rigid-type-and-equality-check-is-this-possible-in-haskell", "title": "Rigid type and equality check - is this possible in Haskell?", "body": "<p>Wondering is following code ever possible in Haskell?</p>\n\n<pre><code>equal :: a -&gt; b -&gt; Bool\nequal a b = a == b\n</code></pre>\n"}, {"tags": ["haskell", "types", "automatic-differentiation", "haskell-linear"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1521066692, "post_id": 49288004, "comment_id": 85580468, "body": "Can&#39;t you just use <code>abs</code>?"}, {"owner": {"reputation": 1655, "user_id": 604955, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dee8e0c8c4b36334c2379c62b3e12054?s=128&d=identicon&r=PG", "display_name": "Charles Durham", "link": "https://stackoverflow.com/users/604955/charles-durham"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1521130974, "post_id": 49288004, "comment_id": 85611018, "body": "@leftaroundabout <code>abs</code> the function? On a Vector, in place of the squared dot product?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1521131481, "post_id": 49288004, "comment_id": 85611380, "body": "Can&#39;t do <code>abs</code> on a vector (well, <code>linear</code> does allow this as <i>element-wise</i>, but that is nonsense mathematically speaking), but  you can do <code>abs</code> on a quaternion."}, {"owner": {"reputation": 1655, "user_id": 604955, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dee8e0c8c4b36334c2379c62b3e12054?s=128&d=identicon&r=PG", "display_name": "Charles Durham", "link": "https://stackoverflow.com/users/604955/charles-durham"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1521131779, "post_id": 49288004, "comment_id": 85611591, "body": "@leftaroundabout oh, lol didn&#39;t know that! Thanks!"}], "owner": {"reputation": 1655, "user_id": 604955, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dee8e0c8c4b36334c2379c62b3e12054?s=128&d=identicon&r=PG", "display_name": "Charles Durham", "link": "https://stackoverflow.com/users/604955/charles-durham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1563316097, "creation_date": 1521063381, "last_edit_date": 1563316097, "question_id": 49288004, "link": "https://stackoverflow.com/questions/49288004/haskell-linear-ad-implementing-metric-for-forward", "title": "Haskell Linear + AD, implementing Metric for Forward?", "body": "<p>I'm trying to use <code>diff</code> from the <code>ad</code> package on a function <code>Quaternion a -&gt; Quaternion a</code> or more generally <code>Metric a =&gt; a -&gt; a</code> relying on <code>quadrance</code>. </p>\n\n<p>I'm not sure what the best way to go about this is, since <code>Forward</code> doesn't have a Metric instance and with <code>Metric</code>'s kind as <code>* -&gt; *</code> I'm not even sure it's possible (i.e. enforcing that a subtype of Forward has a Metric instance).  </p>\n\n<p>I was wondering how I might solve this problem, I'm not married to the idea of a Metric instance, just wanting to get the <code>diff</code> of an arbitrary function on Quaternions.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1521056212, "post_id": 49286189, "comment_id": 85575519, "body": "The question title seems to conflict with the body."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1521056470, "post_id": 49286189, "comment_id": 85575653, "body": "Thanks for pointing it out. I&#39;ve corrected the title."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1521056768, "post_id": 49286189, "comment_id": 85575815, "body": "Perhaps <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.8.1/docs/Data-MonoTraversable.html#t:MonoFoldable\" rel=\"nofollow noreferrer\"><code>MonoFoldable</code> from <code>mono-traversable</code></a>?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1521057267, "post_id": 49286189, "comment_id": 85576118, "body": "It seems like <code>otoList :: mono -&gt; [Element mono]</code> will do, but I&#39;d have to define a bunch of other functions that I don&#39;t need :/"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1521059984, "post_id": 49286189, "comment_id": 85577538, "body": "If you&#39;re comfortable with the idea of lenses, you&#39;ve described exactly what a <code>Prism</code> is."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1521062220, "post_id": 49286189, "comment_id": 85578564, "body": "Why do you need a typeclass? What is your goal? Can&#39;t you define your own typeclass with only the methods you need?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1521062375, "post_id": 49286189, "comment_id": 85578639, "body": "I&#39;ll look into <code>Prism</code>s then. @chi I have a lot of these kinds of <code>MyData</code> structures (nested into each other), so instead of having several functions <code>MyDataNToList</code> I&#39;d like to use the type-class function."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1521089491, "post_id": 49286189, "comment_id": 85586248, "body": "How about <code>Foldable</code>?  It has <code>toList</code>, and once you can convert to a list you can fold."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1521105437, "post_id": 49286189, "comment_id": 85593016, "body": "I thought about that, bot <code>MyData</code> has kind <code>*</code>."}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 286, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1521056452, "creation_date": 1521055563, "last_edit_date": 1521056452, "question_id": 49286189, "link": "https://stackoverflow.com/questions/49286189/typeclass-like-islist-without-the-fromlist-function", "title": "Typeclass like `IsList` without the `fromList` function", "body": "<p>The <code>GHC.Exts</code> module exports the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/OverloadedLists\" rel=\"nofollow noreferrer\"><code>IsList</code></a> typeclass:</p>\n\n<pre><code>class IsList l where\n  type Item l\n  fromList  :: [Item l] -&gt; l\n  toList    :: l -&gt; [Item l]\n\n  fromListN :: Int -&gt; [Item l] -&gt; l\n  fromListN _ = fromList  \n</code></pre>\n\n<p>I have a data-type defined as follows:</p>\n\n<pre><code>newtype MyData = MyData { toMap :: Map (RefTo X) X }\n</code></pre>\n\n<p>Somtimes it is convenient to work with the elements of <code>MyData</code> in a list, and since there's a bijection between <code>Ref X</code> and <code>X</code>, I thought about defining a <code>IsList</code> instance for <code>MyData</code>.</p>\n\n<p>Now the problem is that the constructor <code>MyData</code> is not exposed, and values of type <code>MyData</code> can only be created via a (smart?) constructor of the form:</p>\n\n<pre><code>mkMyData :: [X] -&gt; Either Error MyData \n</code></pre>\n\n<p>So defining a <code>fromList</code> will defeat the purpose of the smart constructor.</p>\n\n<p>Is there a type-class like <code>IsList</code> such that instances of this class can be converted to a list, but not the other way?</p>\n"}, {"tags": ["haskell", "makefile", "ghc"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1521046768, "post_id": 49283564, "comment_id": 85569931, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> (this includes the .hs file)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1521049541, "post_id": 49283564, "comment_id": 85571800, "body": "<code>crt0</code> is a C library, not a Haskell one. Something is going wrong, and it does not depend on Haskell libraries. I wonder if your <code>clang</code> can produce static executables from C sources (?)"}, {"owner": {"reputation": 157, "user_id": 7026851, "user_type": "registered", "accept_rate": 92, "profile_image": "https://lh6.googleusercontent.com/-h1VcP9Pdc_U/AAAAAAAAAAI/AAAAAAAAAGc/XvP4_p7qeZM/photo.jpg?sz=128", "display_name": "Sreten Joci\u0107", "link": "https://stackoverflow.com/users/7026851/sreten-joci%c4%87"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1521050104, "post_id": 49283564, "comment_id": 85572134, "body": "@chi thx for the answer, I dont know anything about c, but I was getting <code>gcc failed in phase Linker. (Exit code: 1) makefile:2: recipe for target &#39;program&#39; failed make: ***[program] Error 1</code> without the 2 static options and adding them fixed it"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1521055547, "post_id": 49283564, "comment_id": 85575131, "body": "As you seem to have anticipated, the reasonable answer is: <i>don&#39;t use <code>make</code> to build Haskell projects, use <code>cabal</code> or <code>stack</code> instead</i>. Make, especially GNU Make, is bogged down not only with anachronistic environment assumptions but also ridiculous implicit rules for languages nobody has been using for 30 years anymore. (Well, not literally <i>nobody</i>, and of course you can and should just turn those off, but still...) If it matters because you don&#39;t have root permissions and only GHC installed, note that <code>stack</code> can be installed entirely in user space."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1521067259, "post_id": 49283564, "comment_id": 85580696, "body": "@leftaroundabout Of course <code>cabal</code> can be installed entirely in user space, too (and that is the default behavior of <code>bootstrap.sh</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 0, "last_activity_date": 1521247211, "creation_date": 1521247211, "answer_id": 49331330, "question_id": 49283564, "link": "https://stackoverflow.com/questions/49283564/haskell-makefile-import-library/49331330#49331330", "title": "haskell makefile import library", "body": "<p>You went down the wrong path with static options. I assume you're on os-x. As explained at <a href=\"https://stackoverflow.com/questions/3801011/ld-library-not-found-for-lcrt0-o-on-osx-10-6-with-gcc-clang-static-flag\">ld: library not found for -lcrt0.o on OSX 10.6 with gcc/clang -static flag</a> that just makes things worse. In fact you got a different error, because you got an <em>earlier</em> error.</p>\n\n<p>To write a good makefile, first ensure you can run ghc to compile the program <em>without</em> make, just by running the commands in the shell.</p>\n\n<p>I.e. try to compile just <code>ghc --make program.hs</code> and see what happens. If you have the other libraries in your package environment already, it doesn't matter if they're in the standard distribution or not. </p>\n"}], "owner": {"reputation": 157, "user_id": 7026851, "user_type": "registered", "accept_rate": 92, "profile_image": "https://lh6.googleusercontent.com/-h1VcP9Pdc_U/AAAAAAAAAAI/AAAAAAAAAGc/XvP4_p7qeZM/photo.jpg?sz=128", "display_name": "Sreten Joci\u0107", "link": "https://stackoverflow.com/users/7026851/sreten-joci%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 49331330, "answer_count": 1, "score": 0, "last_activity_date": 1521247211, "creation_date": 1521046577, "last_edit_date": 1521048564, "question_id": 49283564, "link": "https://stackoverflow.com/questions/49283564/haskell-makefile-import-library", "title": "haskell makefile import library", "body": "<p>So I have the following makefile which I want to use to compile my haskell program. However, in my <code>program.hs</code> file I have imported a library that is not in the standard Haskell distribution (e.g. <code>Data.List</code>). As a result, when I try to compile I get the error below. How can I include the said library so that it compiles fine? P.S. I am <strong>NOT</strong> interested in other approaches which do not involve a makefile, thank you. </p>\n\n<p>error:</p>\n\n<pre><code>Linking program...\nld: library not found for -lcrt0.o\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>makefile:</p>\n\n<pre><code> program: program.hs\n        ghc --make -static -optl-static program.hs\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1521041103, "post_id": 49281530, "comment_id": 85565750, "body": "<a href=\"https://hayoo.fh-wedel.de/?query=%28a+-%3E+Bool%29+-%3E+a+-%3E+Maybe+a\" rel=\"nofollow noreferrer\">hayoo.fh-wedel.de/?query=%28a+-%3E+Bool%29+-%3E+a+-%3E+Maybe&zwnj;&#8203;+a</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1521041306, "post_id": 49281530, "comment_id": 85565916, "body": "The above comment provides links to several duplicate implementations in multiple non-standard packages, so I&#39;d say the answer is &quot;No&quot;."}, {"owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "edited": false, "score": 0, "creation_date": 1521041338, "post_id": 49281530, "comment_id": 85565938, "body": "Thanks. I&#39;ll just roll my own then."}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "edited": false, "score": 0, "creation_date": 1521041684, "post_id": 49281530, "comment_id": 85566214, "body": "Can be crafted, like <code>liftPredMaybe p = listToMaybe . (filter p) . (:[])</code>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1521067117, "post_id": 49282010, "comment_id": 85580631, "body": "This is my preferred spelling, and I&#39;ve frequently included it in projects. I like the name <code>ensure</code>, because it fits well with the &quot;0-1 nondeterminism&quot; interpretation of <code>Maybe</code> and with the &quot;n-way nondeterminism&quot; interpretation of <code>[]</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521079581, "post_id": 49282010, "comment_id": 85583934, "body": "@DanielWagner <code>ensure</code> is a very good name. One nice little thing about this spelling is that <code>guard @Maybe</code> is one half of the isomorphism between <code>Bool</code> and <code>Maybe ()</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521127047, "post_id": 49282010, "comment_id": 85608238, "body": "It is strange to call those &quot;golf spellings&quot; when the &quot;ungolfed&quot; spelling, <code>\\p a -&gt; a &lt;$ guard (p a)</code>, is as short or shorter (and more readable by far!)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521132840, "post_id": 49282010, "comment_id": 85612318, "body": "@DanielWagner Good point... I have changed the wording a bit."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1528474643, "post_id": 49282010, "comment_id": 88536960, "body": "@DanielWagner FWIW, I was just told that this combinator exists in <i>protolude</i>, <a href=\"https://hackage.haskell.org/package/protolude-0.2.2/docs/Protolude.html#v:guarded\" rel=\"nofollow noreferrer\">which calls it <code>guarded</code></a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557186134, "post_id": 49282010, "comment_id": 98672025, "body": "A very straightforward implementation is <code>\\p a -&gt; if p a then pure a else empty</code>. It can be spun into a prettier golf spelling, namely <code>liftA2 (bool empty) pure</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 9, "last_activity_date": 1521132851, "last_edit_date": 1521132851, "creation_date": 1521042059, "answer_id": 49282010, "question_id": 49281530, "link": "https://stackoverflow.com/questions/49281530/lift-to-maybe-using-a-predicate/49282010#49282010", "title": "Lift to Maybe using a predicate", "body": "<p>Not quite a ready-made solution, but with <code>guard</code> (from <code>Control.Monad</code>) and <code>(&lt;$)</code> (from <code>Data.Functor</code>) we can write:</p>\n\n<pre><code>ensure :: Alternative f =&gt; (a -&gt; Bool) -&gt; a -&gt; f a\nensure p a = a &lt;$ guard (p a)\n</code></pre>\n\n<p>(Thanks to Daniel Wagner for suggesting a nice name for this function.)</p>\n\n<p>A more pointfree spelling of dubious taste is <code>\\p -&gt; (&lt;$) &lt;*&gt; guard . p</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521194519, "post_id": 49282075, "comment_id": 85636834, "body": "[1/2] (1) You&#39;ll probably want to replace <code>pure</code> in <code>liftPredF</code> with a function for a concrete functor (e.g. <code>(:[])</code> or <code>Just</code>). As written, the compiler rejects it due to type ambiguity unless <code>ExtendedDefaultingRules</code> is enabled (or <a href=\"https://downloads.haskell.org/~ghc/8.4.1/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">if you are in GHCi</a>, which enables it by default).(2) By the way, thanks for giving me one more example of the <code>Foldable</code> instance for <code>Maybe</code> being potentially useful: <code>find @Maybe :: (a -&gt; Bool) -&gt; Maybe a -&gt; Maybe a</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521194527, "post_id": 49282075, "comment_id": 85636839, "body": "[2/2] (3) If one is willing to bring in <a href=\"https://hackage.haskell.org/package/witherable-0.2/docs/Data-Witherable.html\" rel=\"nofollow noreferrer\"><code>Data.Witherable</code></a>, <code>liftPredMaybe f = filter f . Just</code> becomes possible."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 6, "last_activity_date": 1521193477, "last_edit_date": 1521193477, "creation_date": 1521042226, "answer_id": 49282075, "question_id": 49281530, "link": "https://stackoverflow.com/questions/49281530/lift-to-maybe-using-a-predicate/49282075#49282075", "title": "Lift to Maybe using a predicate", "body": "<p>One way to compose it is like this, using <code>Control.Monad</code>:</p>\n\n<pre><code>liftPredM :: MonadPlus m =&gt; (a -&gt; Bool) -&gt; a -&gt; m a\nliftPredM p = mfilter p . return\n</code></pre>\n\n<p>Another alternative is to use <code>Data.Foldable</code>:</p>\n\n<pre><code>liftPredF :: (a -&gt; Bool) -&gt; a -&gt; Maybe a\nliftPredF f = find f . pure\n</code></pre>\n\n<p>This is, however, less general, so I'd lean towards favouring the <code>MonadPlus</code>-based implementation.</p>\n\n<p>In both cases, though, the idea is to first lift a 'naked' value into a container using either <code>pure</code> or <code>return</code>, and then apply a filter. Often, you don't need to declare an actual function for this; instead, you can just inline the composition where you need it.</p>\n\n<p>Examples:</p>\n\n<pre><code>Prelude Control.Monad&gt; liftPredMaybe even 42 :: Maybe Integer\nJust 42\nPrelude Control.Monad&gt; liftPredMaybe (even . length) \"foo\" :: Maybe String\nNothing\nPrelude Control.Monad&gt; liftPredMaybe (odd . length) \"foo\" :: Maybe String\nJust \"foo\"\n</code></pre>\n"}], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 49282010, "answer_count": 2, "score": 6, "last_activity_date": 1521193477, "creation_date": 1521040839, "question_id": 49281530, "link": "https://stackoverflow.com/questions/49281530/lift-to-maybe-using-a-predicate", "title": "Lift to Maybe using a predicate", "body": "<p>I'm searching for something like</p>\n\n<pre><code>liftPredMaybe :: (a -&gt; Bool) -&gt; a -&gt; Maybe a\nliftPredMaybe p a\n  | p a = Just a\n  | otherwise = Nothing\n</code></pre>\n\n<p>Is there such a function in Haskell already?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1521043743, "post_id": 49281016, "comment_id": 85567822, "body": "As a general tip, when a parse error arises, it is often due to what is before that point -- especially is that line looks OK."}], "answers": [{"comments": [{"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1521041434, "post_id": 49281355, "comment_id": 85566017, "body": "Thanks. I tried importing <code>Data.List</code> into my emacs file, and I received                                                                               <code>experiment.hs:149:1: error: parse error on input \u2018import\u2019     | 149 | import Data.List       | ^^^^^^</code>"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 2, "creation_date": 1521041682, "post_id": 49281355, "comment_id": 85566210, "body": "@user65526 Where did you put the import? It should be at the beginning of the module (right after the <code>module Name where</code> line or at the beginning of the file if there is no module line)."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 1, "creation_date": 1521041824, "post_id": 49281355, "comment_id": 85566334, "body": "It wasn&#39;t at the beginning of the file. Problem solved. :)"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 1, "last_activity_date": 1521040341, "creation_date": 1521040341, "answer_id": 49281355, "question_id": 49281016, "link": "https://stackoverflow.com/questions/49281016/an-error-of-variable-scope-experiment-hs15023-error/49281355#49281355", "title": "An error of variable scope experiment.hs:150:23: error", "body": "<p>The name in question is the one that's after the colon, i.e. <code>nub</code>.</p>\n\n<p><code>nub</code> is defined inside the <code>Data.List</code> module. You've said that you've imported that module in GHCi, but that does not matter because you're not using <code>nub</code> in GHCi, you're using <code>nub</code> in your Haskell file, which presumably did not import <code>Data.List</code>.</p>\n\n<p>Imports only apply to the file containing the import statement. If you import something in GHCi that only affects the code you enter into GHCi, it does not affect code you load from a file. In other words: you should write the import into your <code>experiment.hs</code>, not GHCi.</p>\n"}], "owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521041567, "creation_date": 1521039541, "last_edit_date": 1521041567, "question_id": 49281016, "link": "https://stackoverflow.com/questions/49281016/an-error-of-variable-scope-experiment-hs15023-error", "title": "An error of variable scope experiment.hs:150:23: error", "body": "<p>I am trying to use the following function, from <a href=\"http://learnyouahaskell.com/modules\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/modules</a>:</p>\n\n<pre><code>numUniques :: (Eq a) =&gt; [a] -&gt; Int\nnumUniques = length . nub\n</code></pre>\n\n<p>I have typed the above code onto an emacs file. On GHCi I have imported the <code>Data.List</code> module with <code>import Data.List</code>.\nHowever, when I upload the file onto GHCi, I receive</p>\n\n<pre><code>experiment.hs:150:23: error:\nVariable not in scope: nub :: [a] -&gt; t0 a0\n|\n150 | numUniques = length . nub     |                       ^^^\n</code></pre>\n\n<p>There are various questions here about the message <code>Variable not in scope</code>. However, it is not clear to me how they are able to help me with the problem I am having. From other answers I have gathered that \"Not in scope\" means you are trying to use a name which is not defined in the place in which you are trying to use it. </p>\n\n<p>However, I do not know which name this is.</p>\n\n<p>I have tried putting the following code into my emacs file, and then loading GHCi with it:</p>\n\n<pre><code>import Data.List  \n\nnumUniques :: (Eq a) =&gt; [a] -&gt; Int\nnumUniques = length . nub\n</code></pre>\n\n<p>However, I receive the following message:</p>\n\n<pre><code>experiment.hs:149:1: error: parse error on input \u2018import\u2019\n|\n 149 | import Data.List       | ^^^^^^\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "functional-programming", "permutation"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1521042695, "post_id": 49280797, "comment_id": 85567010, "body": "No, <code>p</code> is not the head of the list. You might want to re-read the chapter about list permutations. <code>&lt;-</code> means &quot;for all values in&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1521042955, "creation_date": 1521042955, "answer_id": 49282344, "question_id": 49280797, "link": "https://stackoverflow.com/questions/49280797/permutation-algorithm-in-haskell/49282344#49282344", "title": "Permutation Algorithm in Haskell", "body": "<p>The expression:</p>\n\n<pre><code>[x:xs | x &lt;- p, xs &lt;- perms (delete x p)]\n</code></pre>\n\n<p>is a list comprehension, which means that each of the <code>a &lt;- b</code> expressions on the right hand side form a sort of implicit loop that your pseudocode doesn't account for.</p>\n\n<p>Written in pseudocode with explicit loops, it's equivalent to:</p>\n\n<pre><code>for each x in p:\n  for each xs in perms (delete x p):\n    yield (x:xs)\n-- and return the list of all results yielded\n</code></pre>\n\n<p>It can then be helpful to think through the definition recursively from the bottom up.  If you run <code>perm [n]</code> for any <code>n</code>, then the outer loop is only evaluated for <code>x = n</code>, and since:</p>\n\n<pre><code>perms (delete n [n]) = perms [] = [[]]\n</code></pre>\n\n<p>the inner loop is equivalent to:</p>\n\n<pre><code>for each xs in [[]]\n  ...\n</code></pre>\n\n<p>and is only evaluated for <code>xs = []</code>.  Therefore, only one value is yielded:</p>\n\n<pre><code>x:xs = n:[] = [n]\n</code></pre>\n\n<p>So, <code>perm [n]</code> gives a list of the single element <code>[n]</code>, in other words <code>[[n]]</code>.</p>\n\n<p>If you move on to <code>perm [1,2]</code> and imagine unfolding the loops:</p>\n\n<pre><code>-- for each x in [1,2]\nfirst, for x = 1\n  -- for each xs in perms (delete 1 [1,2]) = perms [2] = [[2]]\n  so only for xs = [2]\n    yield (x:xs) = yield (1:[2]) = yield [1,2]\nsecond, for x = 2\n  -- for each xs in perms (delete 2 [1,2]) = perms [1] = [[1]]\n  so only for xs = [1]\n    yield (x:xs) = yield (2:[1]) = yield [2,1]\n</code></pre>\n\n<p>so two values are yielded, namely <code>[1,2]</code> and <code>[2,1]</code>, giving:</p>\n\n<pre><code>perm [1,2] = [[1,2],[2,1]]\n</code></pre>\n\n<p>This obviously generalizes to any <code>perm [a,b] = [[a,b],[b,a]]</code>, so we can finally calculate <code>perm [1,2,3]</code>:</p>\n\n<pre><code>-- for each x in [1,2,3]\nfirst, for x = 1\n  -- for each xs in perms (delete 1 [1,2,3]) = perms [2,3] = [[2,3],[3,2]]\n  first for xs = [2,3]\n    yield (x:xs) = yield (1:[2,3]) = yield [1,2,3]\n  second for xs = [3,2]\n    yield (x:xs) = yield [1,3,2]\nsecond, for x = 2\n  -- for each xs in perms (delete 2 [1,2,3]) = [[1,3],[3,1]]\n  first for xs = [1,3]\n    yield (x:xs) = yield [2,1,3]\n  second for xs = [3,1]\n    yield (x:xs) = yield [2,3,1]\nthird, for x = 3\n  first for xs = [1,2]\n    yield [3,1,2]\n  second for xs = [2,1]\n    yield [3,2,1]\n</code></pre>\n\n<p>In all, six values are yielded, giving the list:</p>\n\n<pre><code>perms [1,2,3] = [[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2573189"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "accepted_answer_id": 49282344, "answer_count": 1, "score": 2, "last_activity_date": 1586808786, "creation_date": 1521039002, "question_id": 49280797, "link": "https://stackoverflow.com/questions/49280797/permutation-algorithm-in-haskell", "title": "Permutation Algorithm in Haskell", "body": "<p>I read this permutation function example in a Haskell textbook and I was wondering if someone could help me understand what is happening. Also, assume that the function <em>delete</em> simply deletes the first occurrence of a value from a list and returns the list</p>\n\n<pre><code>perms [] = [[]]\nperms p = [x:xs | x &lt;-p, xs &lt;- perms (delete x p)]\n</code></pre>\n\n<p>I understand that an empty list equals a list with an empty list. For all other cases the head of the list is prepended to x and the numbers except the head recurses through the algorithm.</p>\n\n<p>My question is how does this work, for example, my pseudocode understanding is </p>\n\n<pre><code>perms[1,2,3]\nx &lt;- 1\nxs &lt;- [2,3]\nperms [2,3]\nx &lt;- 2\nxs &lt;- 3\nperms [3]\nx &lt;- 3\nxs &lt;- []\n</code></pre>\n\n<p>this would produce the list [1,2,3] how does the algorithm produce the other list results.</p>\n\n<p>An output of this code working is as follows:</p>\n\n<pre><code>&gt;perms [1,2,3]\n[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]] \n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1521034266, "post_id": 49278605, "comment_id": 85560610, "body": "I&#39;d argue the right solution here is not using <code>0</code> to indicate the element is missing (which causes your <code>Int</code> result to have two possible meanings). That is why the <code>elemIndex</code> function bipll mentions <a href=\"https://stackoverflow.com/a/49278937/2751851\">in their answer</a> returns a <code>Maybe Int</code> rather than an <code>Int</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1521038168, "post_id": 49278605, "comment_id": 85563516, "body": "As a general suggestion, if you are using <code>head</code> and <code>tail</code>, you are probably doing it in a non idiomatic way. These are dangerous partial functions which should be avoided when possible. Here, pattern matching on <code>(x:xs)</code> would simplify the code, and remove the partial functions."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1521051956, "post_id": 49278913, "comment_id": 85573210, "body": "I recommend forcing <code>pos</code> before recursing, otherwise you get nasty thunk buildup. <code>otherwise = pos `seq` elementPosition (pos + 1) key xs</code>"}], "tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": false, "score": 2, "last_activity_date": 1521047989, "last_edit_date": 1521047989, "creation_date": 1521033748, "answer_id": 49278913, "question_id": 49278605, "link": "https://stackoverflow.com/questions/49278605/how-to-end-the-pattern-matching-in-haskell/49278913#49278913", "title": "How to end the pattern matching in Haskell", "body": "<p>Try this:</p>\n\n<pre><code>elementPosition :: Eq t =&gt; Int -&gt; t -&gt; [t] -&gt; Int\nelementPosition _ _ [] = 0\nelementPosition pos key (x:xs)\n    | key == x   = pos\n    | otherwise  = elementPosition (pos + 1) key xs \n</code></pre>\n\n<p>and then <code>elementPosition 0</code> will do what you want</p>\n"}, {"tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 3, "last_activity_date": 1521033830, "creation_date": 1521033830, "answer_id": 49278937, "question_id": 49278605, "link": "https://stackoverflow.com/questions/49278605/how-to-end-the-pattern-matching-in-haskell/49278937#49278937", "title": "How to end the pattern matching in Haskell", "body": "<p>You have to turn your recursion into tail one, so that the final decision is made at the top of the stack, not on its bottom. This way you'll need to pass the distance currently accumulated from the head of the list as an argument (you'll need this distance when a match is found but can discard it if there's none). Something like</p>\n\n<pre><code>elementPosition :: Eq t =&gt; t -&gt;[t] -&gt; Int\nelementPosition pat lst = elementPosition' 1 pat lst where\n    elementPosition' _ _ [] = 0\n    elementPosition' i pat (h:t) | pat == h = i\n                                 | otherwise = elementPosition' (i + 1) pat t\n</code></pre>\n\n<p>But note that standard library has it already covered:</p>\n\n<pre><code>import Data.List\n\nelementPosition :: Eq t =&gt; t -&gt;[t] -&gt; Int\nelementPosition p l = maybe 0 succ $elemIndex p l\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1521038011, "post_id": 49280090, "comment_id": 85563403, "body": "I see: here, <code>0</code> would represent <code>Nothing</code>, and <code>n+1</code> would represent <code>Just n</code>. This exploit the standard bijection <code>Maybe Nat -&gt; Nat</code>. Using <code>Maybe</code>s would still be more understandable, though :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1, "user_id": 8492871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b6e783b59154bdd5e8daaf196069691?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/8492871/albert"}, "edited": false, "score": 1, "creation_date": 1521085784, "post_id": 49280090, "comment_id": 85585285, "body": "@Albert, what the heck are you saying? You&#39;re going to use his code and try not to get caught? Aside from academic honesty problems, that&#39;s a pretty good way to piss people off on this site and elsewhere."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 8492871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b6e783b59154bdd5e8daaf196069691?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/8492871/albert"}, "edited": false, "score": 1, "creation_date": 1521106784, "post_id": 49280090, "comment_id": 85593892, "body": "@Albert Excuse me, what? No: if you are not allowed to plagiarize, then the solution is not to plagiarize; a solution in which you plagiarize and attempt to hide it is not acceptable, neither to me, to your instructor, to the rules of this site, nor to your good education. If you learned something from this answer, I am pleased; but it is your responsibility to ask your questions ethically and use the answers ethically."}, {"owner": {"reputation": 1, "user_id": 8492871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b6e783b59154bdd5e8daaf196069691?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/8492871/albert"}, "edited": false, "score": 0, "creation_date": 1521341774, "post_id": 49280090, "comment_id": 85688349, "body": "@DanielWagner I apologyze for my unreasonable request. I did not realize the importance of sharing and just thought to finish my work. I know this place is perfect for sharing our thinking and communicating. Although I am a newbie here, I should know this.  Sorry again and your answer did help me a lot, I will use it in a right way. I hope I can learn more from you."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1521037119, "creation_date": 1521037119, "answer_id": 49280090, "question_id": 49278605, "link": "https://stackoverflow.com/questions/49278605/how-to-end-the-pattern-matching-in-haskell/49280090#49280090", "title": "How to end the pattern matching in Haskell", "body": "<p>The other answers discuss how to achieve this by adding an accumulator. However I think it can also be enlightening to see how to do it without an accumulator; the trick is just to check if the return value from the recursive call is <code>0</code> and maintain that value instead of incrementing if it is. So:</p>\n\n<pre><code>elementPosition :: Eq t =&gt; t -&gt; [t] -&gt; Int\nelementPosition t [] = 0\nelementPosition t lst\n    | t == head lst = 1\n    | otherwise = case elementPosition t (tail lst) of\n        0 -&gt; 0\n        n -&gt; n+1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1521085587, "post_id": 49280747, "comment_id": 85585248, "body": "If you&#39;re going for that style, you can mix the rest of the pattern matching using <code>maybe</code> with <code>listToMaybe</code>."}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": false, "score": 1, "last_activity_date": 1521219953, "last_edit_date": 1521219953, "creation_date": 1521038852, "answer_id": 49280747, "question_id": 49278605, "link": "https://stackoverflow.com/questions/49278605/how-to-end-the-pattern-matching-in-haskell/49280747#49280747", "title": "How to end the pattern matching in Haskell", "body": "<p>Also, using <code>zip</code> (to make the list a list of tuples of elements and their indexes) and <code>filter</code> (to filter out the value we are looking for) we can get this definition:</p>\n\n<pre><code>elementPosition :: Eq t =&gt; t -&gt; [t] -&gt; Int\nelementPosition e xs =\n  case filter ((== e) . fst) xsIndexed of\n    [] -&gt; 0\n    (_, i):_ -&gt; i\n  where xsIndexed = zip xs [1..]\n</code></pre>\n\n<p>As suggested by @dfeuer, we can get this in a one-liner:</p>\n\n<pre><code>import Data.Maybe\n\nelementPosition :: Eq t =&gt; t -&gt; [t] -&gt; Int\nelementPosition e = maybe 0 fst . listToMaybe . filter ((== e) . snd) . zip [1..]\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8492871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b6e783b59154bdd5e8daaf196069691?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/8492871/albert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1521219953, "creation_date": 1521032877, "last_edit_date": 1521080127, "question_id": 49278605, "link": "https://stackoverflow.com/questions/49278605/how-to-end-the-pattern-matching-in-haskell", "title": "How to end the pattern matching in Haskell", "body": "<p>I need to implement a function takes an element <code>elt</code> and a list <code>lst</code> , and returns the position of the \ufb01rst occurrence of <code>elt</code> in <code>lst</code>.</p>\n\n<p>This is my answer:</p>\n\n<pre><code>elementPosition :: Eq t =&gt; t -&gt;[t] -&gt; Int\nelementPosition t [] = 0 \nelmentPosition t lst \n    | t == head lst  = 1\n    | otherwise      = (elementPosition t (tail lst))+1\n</code></pre>\n\n<p>However, if <code>elt</code> is not in <code>lst</code>, I need to return 0. but this code will return the length of <code>lst</code>. Can I do something to return <code>0</code> when the first pattern is matched? If not, How can I implement this function?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1521032840, "post_id": 49278310, "comment_id": 85559542, "body": "Even <code>data [] a = MkNil</code> is a pseudo-code comment, contained as it is inside a <code>#if 0 ... #endif</code> block. <code>[]</code> as a type constructor and data constructor is special-cased, defined <i>by</i> the language but not definable <i>in</i> the language."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1521033848, "post_id": 49278310, "comment_id": 85560284, "body": "Oops. I did see that <code>#if 0</code> but didn&#39;t check its scope. (And was slightly surprised that parser would handle <code>[]</code> as a type name; clearly not enough.)"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 4, "last_activity_date": 1521048668, "last_edit_date": 1592644375, "creation_date": 1521032073, "answer_id": 49278310, "question_id": 49278138, "link": "https://stackoverflow.com/questions/49278138/create-type-with-double-symbol/49278310#49278310", "title": "Create type with double symbol", "body": "<blockquote>\n<p>The List type is created with</p>\n<pre><code>data [] a = [] | a : [a]\n</code></pre>\n</blockquote>\n<p>No, it isn't. If you look at <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html\" rel=\"nofollow noreferrer\">the source</a> (for GHC; other compilers may do it differently), it says</p>\n<pre><code>data [] a = MkNil\n</code></pre>\n<p>but <s>this is just a marker for the compiler</s> (not even this, see chepner's comment). This is because</p>\n<pre><code>data [] a = [] | a : [a]\n</code></pre>\n<p>isn't legal syntax in Haskell.</p>\n<p>What is true is that list works <em>as if</em> it were defined this way: it's entirely equivalent to</p>\n<pre><code>data List a = Nil | Cons a (List a)\n</code></pre>\n<p>except for the names.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1521039464, "creation_date": 1521039464, "answer_id": 49280990, "question_id": 49278138, "link": "https://stackoverflow.com/questions/49278138/create-type-with-double-symbol/49280990#49280990", "title": "Create type with double symbol", "body": "<p>Type and constructor names must either be alphanumeric names, starting with uppercase </p>\n\n<pre><code>data MyType a b = K a | L b a\n</code></pre>\n\n<p>or be symbolic infix operators, starting with <code>:</code></p>\n\n<pre><code>data a :** b = K a | b :+-&amp; a\n</code></pre>\n\n<p>Both types above are perfectly isomorphic: we only replaced <code>MyType</code> with the infix <code>:**</code> and <code>L</code> with the infix <code>:+-&amp;</code>.</p>\n\n<p>Also note that infixes must be binary, i.e. take two arguments. Alphanumeric names do not have such constraint (e.g. <code>K</code> above only takes one argument).</p>\n\n<p>List syntax <code>[]</code> is specially handled by the compiler, similarly to <code>(,),(,,),...</code> for tuples. Only <code>:</code> follows the general rule (perhaps incidentally).</p>\n"}], "owner": {"reputation": 195, "user_id": 9396078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/367b5945226775ca575eeb2e0db5d94f?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon Duck", "link": "https://stackoverflow.com/users/9396078/jhon-duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 49278310, "answer_count": 2, "score": 0, "last_activity_date": 1521048668, "creation_date": 1521031505, "question_id": 49278138, "link": "https://stackoverflow.com/questions/49278138/create-type-with-double-symbol", "title": "Create type with double symbol", "body": "<p>The List type is created with</p>\n\n<pre><code>data [] a = [] | a : [a]\n</code></pre>\n\n<p>But I can't create my own type with the same structure:</p>\n\n<pre><code>data %% a = %% | a : %a%\n</code></pre>\n\n<blockquote>\n  <p>error: parse error on input `%%'</p>\n</blockquote>\n"}, {"tags": ["haskell", "higher-order-functions"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1521039674, "post_id": 49277802, "comment_id": 85564680, "body": "<code>liftA2 id</code> is an obfuscated version of <code>liftA2 ($)</code>. Indeed, when <code>id</code> is considered as a <i>binary</i> function, it is better written as <code>($)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1521036828, "post_id": 49278339, "comment_id": 85562632, "body": "For an intuitive reading of &quot;you&#39;d have to unify...&quot;, try this one. <code>id</code> can leave an <code>Int</code> alone and have type <code>Int -&gt; Int</code> (this has the same argument type as <code>g</code>&#39;s argument); or <code>id</code> can leave an <code>Int -&gt; Int</code> function alone and have type <code>(Int -&gt; Int) -&gt; (Int -&gt; Int)</code> aka <code>(Int -&gt; Int) -&gt; Int -&gt; Int</code> (this has the same result type as <code>g</code>&#39;s argument). But, unlike with humans, if you try to leave two <code>Int</code>s alone, you don&#39;t get just one <code>Int</code> out the other end, so <code>id</code> can&#39;t have type <code>Int -&gt; Int -&gt; Int</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1521032132, "last_edit_date": 1592644375, "creation_date": 1521032132, "answer_id": 49278339, "question_id": 49277802, "link": "https://stackoverflow.com/questions/49277802/higher-order-functions-and-id/49278339#49278339", "title": "Higher order functions and id", "body": "<blockquote>\n<p>I've read somewhere that [<code>id</code>] is used to &quot;leave something alone&quot; but can't seem to get my head around it.</p>\n</blockquote>\n<p><code>id</code> is used to &quot;leave something alone&quot; because that is all it does -- that is, nothing:</p>\n<pre><code>id :: x -&gt; x\nid x = x\n</code></pre>\n<p>That being so, <code>id</code> often shows up as a do-nothing placeholder passed to higher-order functions. <code>fmap id foo</code> doesn't actually change the values found within <code>foo</code> (in fact, <code>fmap id = id</code>, which is the first functor law), <code>id . f</code> and <code>f . id</code> are both equivalent to <code>f</code>, and so forth. A more interesting example is <a href=\"https://stackoverflow.com/questions/6172004/writing-foldl-using-foldr\">the classic trick of defining <code>foldl</code> using <code>foldr</code></a>, in which <code>id</code> is used as a base case for building a function with <code>foldr</code>.</p>\n<blockquote>\n<p>For example, why is the type of <code>liftA2 id</code> <code>f (b -&gt; c) -&gt; f b -&gt; f c</code>?</p>\n</blockquote>\n<p>The type of <code>liftA2</code> is:</p>\n<pre><code>liftA2 :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n</code></pre>\n<p>In the case of <code>liftA2 id</code>, we have...</p>\n<pre><code>(a -&gt; (b -&gt; c)) ~ (x -&gt; x)\n</code></pre>\n<p>... and so...</p>\n<pre><code>a ~ x\n(b -&gt; c) ~ x\n</code></pre>\n<p>... therefore...</p>\n<pre><code>liftA2 id :: f (b -&gt; c) -&gt; f b -&gt; f c\n</code></pre>\n<p>(As you probably know, <code>liftA2 id = (&lt;*&gt;)</code>. What is going on is perhaps more obvious if you write it as <code>liftA2 ($)</code>, <code>($) :: (a -&gt; b) -&gt; (a -&gt; b)</code> being merely a specialised <code>id</code>.)</p>\n<blockquote>\n<p>Also, why can't I pass <code>id</code> to <code>g</code> for</p>\n<pre><code>g :: (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\n</code></pre>\n</blockquote>\n<p>Because then you'd have to unify...</p>\n<pre><code>(Int -&gt; (Int -&gt; Int)) ~ (x -&gt; x)\n</code></pre>\n<p>... which is impossible, as <code>x</code> cannot be both <code>Int</code> and <code>Int -&gt; Int</code>.</p>\n"}], "owner": {"reputation": 297, "user_id": 2935375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CYLMN.jpg?s=128&g=1", "display_name": "Shaurya Gupta", "link": "https://stackoverflow.com/users/2935375/shaurya-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 49278339, "answer_count": 1, "score": 2, "last_activity_date": 1521032132, "creation_date": 1521030505, "last_edit_date": 1521031231, "question_id": 49277802, "link": "https://stackoverflow.com/questions/49277802/higher-order-functions-and-id", "title": "Higher order functions and id", "body": "<p>I can't seem to understand how <code>id</code> is used as a parameter for some higher order functions. I've read somewhere that it is used to \"leave something alone\" but can't seem to get my head around it.</p>\n\n<p>For example, why is the type of <code>liftA2 id</code> <code>f (b -&gt; c) -&gt; f b -&gt; f c</code>?  </p>\n\n<p>Also, why can't I pass <code>id</code> to <code>g</code> for     </p>\n\n<pre><code>g :: (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1521028499, "post_id": 49276305, "comment_id": 85556547, "body": "The sole constructor for the type <code>Rec0</code> is <code>K1</code>, and it takes only one argument, not two..."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521044152, "post_id": 49276305, "comment_id": 85568116, "body": "Thank you for the advice. I have now: class   Zeros z where     zero :: z     default zero :: (Generic z, Gzero (Rep z)) =&gt; z     zero = gzero (from z)  class Gzero f  where     gzero :: f a -&gt; a instance Gzero (Rec0 Int) where     gzero (K1 i) = i but something is still wrong:     Variable not in scope: z 30 |     zero = gzero (from z)  and        \u2018a\u2019 is a rigid type variable...           gzero :: forall a. Rec0 Int a -&gt; a                 In an equation for \u2018gzero\u2019: gzero (K1 i) = i ... 35 |     gzero (K1 i) = i"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521048792, "post_id": 49276305, "comment_id": 85571329, "body": "You seem to be consistently confusing types and terms. <code>Rec0 i a</code> might be a type, but is not a term, which explains the error in the question. Similarly, in <code>zero :: z; zero = gzero (from z)</code>, <code>z</code> is a type and not a term, which explains the error in your followup comment."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521050144, "post_id": 49276305, "comment_id": 85572156, "body": "Thank you for your answer. I know that I am confused and I hope for clarification. I have not found the word <code>term</code> neither in GHC.Generics nor in the wiki page, therefore I do not understand what is wrong. Could you point me to an example for a similar case (e.g. monoid) or show me what I have to fix (i.e. paste a fixed piece of code). I know that this is aksing much, but if Generics should become useful for the non-specialist, more examples are required.."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521052741, "post_id": 49276305, "comment_id": 85573657, "body": "The things I said above have nothing to do with generics (and can&#39;t, because I don&#39;t know anything about generics). The distinction between type-level stuff and term-/value-level stuff is a fundamental one in Haskell, so if you haven&#39;t got a firm grip on that, I&#39;d suggest starting with a Haskell tutorial and covering the basics of standard programming before you try to get into advanced generic programming."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521186578, "post_id": 49276305, "comment_id": 85632399, "body": "Thank you for pointing out that Generics are Type Level Programming. I did not make this connection, despite having experimented with it since Kiselyovs et al. original paper in 2004. I do not think that this is part of  &quot;standard Haskell programming&quot;. - But: if you do not know anything about generics, why do you answers questions on it? I still think it would be useful to be able to derive Monoid. If somebody can help?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1521193901, "post_id": 49276305, "comment_id": 85636371, "body": "Generics are not type-level programming, and I don&#39;t believe I either said or implied that. And as far as I know, I have not written any answers to questions on generics, including this one."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1521205067, "post_id": 49276305, "comment_id": 85643682, "body": "It&#39;s unclear to me what you want your function to do. What is <code>zeros</code> supposed to yield if you derive it for a <code>String</code>, or a <code>[Int]</code>, or a <code>Bool</code>, or an <code>Either Int Bool</code>?"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1521236375, "post_id": 49276305, "comment_id": 85661824, "body": "For the base types (String, Int, [], Bool etc.) instances must be given in the code (as in the example code above for Int), but I would expect that a type like <code>data B1 = B1 Int</code> gets a derived  instance with <code>zero = B1 0</code>. Zero is like the identity of the Monoid class (mempty)"}, {"owner": {"reputation": 11510, "user_id": 5852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba340386ad2afc76d4a9602410b4e449?s=128&d=identicon&r=PG", "display_name": "Sjoerd Visscher", "link": "https://stackoverflow.com/users/5852/sjoerd-visscher"}, "edited": false, "score": 0, "creation_date": 1521315257, "post_id": 49276305, "comment_id": 85682291, "body": "If you want generic instances of your classes but don&#39;t want to learn the details of GHC.Generics, you can use my one-liner package. Then the implementation is nothing more than <code>zero = nullaryOp @Zeros zero</code>. Here&#39;s a complete example: <a href=\"https://gist.github.com/sjoerdvisscher/050ceb08b6fcb68cda64d5b5eac7e235\" rel=\"nofollow noreferrer\">gist.github.com/sjoerdvisscher/050ceb08b6fcb68cda64d5b5eac7e&zwnj;&#8203;235</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1521316648, "post_id": 49335338, "comment_id": 85682684, "body": "Using yet another library called <a href=\"https://hackage.haskell.org/package/one-liner\" rel=\"nofollow noreferrer\">one-liner</a>, which is a bit similar to generics-sop but slightly less heavy on type-level stuff, you can write <code>zero</code> in a yet more straight-forward way. See <a href=\"https://gist.github.com/sjoerdvisscher/050ceb08b6fcb68cda64d5b5eac7e235\" rel=\"nofollow noreferrer\">gist.github.com/sjoerdvisscher/050ceb08b6fcb68cda64d5b5eac7e&zwnj;&#8203;235</a>"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1521319711, "post_id": 49335338, "comment_id": 85683602, "body": "Regarding the necessity to use standalone deriving when deriving the <code>Zero</code> class via generics-sop: this seems to be a GHC bug, see <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14932\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/14932</a>"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1522005290, "post_id": 49335338, "comment_id": 85962593, "body": "thank you a lot - i will try it out in the next days!"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1522595359, "post_id": 49335338, "comment_id": 86206010, "body": "The extensive answer by kosmikus was extremely useful to understand the issue (especially that I need <code>TypeOperators</code> and multiple instances of GZero). I tried the generic and the one-liner answer - both work as described. I will go for the plain generic one; it is more code when declaring the generic, but simpler when using it. This may change after ghc 8.4 fixed the bug (I am on 8.2.2)."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 6, "last_activity_date": 1521285321, "creation_date": 1521285321, "answer_id": 49335338, "question_id": 49276305, "link": "https://stackoverflow.com/questions/49276305/how-to-write-an-instance-for-generic-to-derive-a-function-like-zeroa-i-e-a-c/49335338#49335338", "title": "How to write an instance for Generic to derive a function like zero::a (i.e. a constant)?", "body": "<p>Ok, since you said in the comments that what you're aiming for semantically is something like deriving <code>Monoid</code>, let's do that.</p>\n\n<h3>General observations</h3>\n\n<p>A class like <code>Monoid</code> is easy to derive for \"sum types\", i.e., types having more than one constructor, but it is possible to derive it for pure \"product types\", i.e., types having a single constructor and just one or more arguments. Let's focus just on <code>zero</code>, which corresponds to <code>mempty</code>, and is the subject of your question:</p>\n\n<ul>\n<li><p>if the single constructor has no arguments, we simply use that constructor,</p></li>\n<li><p>if the single constructor has one argument (as your <code>B1</code> example), then we require that argument to have a <code>Zero</code> instance already and use the <code>zero</code> of that type,</p></li>\n<li><p>if the single constructor has more than one argument, we do the same for all these arguments: we require all of them to have a <code>Zero</code> instance and then use <code>zero</code> for all of these.</p></li>\n</ul>\n\n<p>So really, we can phrase this as one simple rule: for all arguments of the single constructor, just apply <code>zero</code>.</p>\n\n<p>We have the choice of several approaches to generic programming to implement this rule. You've been asking about <code>GHC.Generics</code>, and I will explain how to do it in that approach, but let me nevertheless first explain how to do it with the <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"noreferrer\">generics-sop</a> package, because I think one can more directly transcribe the rule identified above into code in this approach.</p>\n\n<h3>Solution using generics-sop</h3>\n\n<p>With generics-sop, your code looks as follows:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE DeriveAnyClass #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE StandaloneDeriving #-}\nmodule Zero where\n\nimport qualified GHC.Generics as GHC\nimport Generics.SOP\n\nclass Zero a where\n  zero :: a\n  default zero :: (IsProductType a xs, All Zero xs) =&gt; a\n  zero = to (SOP (Z (hcpure (Proxy @Zero) (I zero))))\n\ninstance Zero Int where\n  zero = 0\n</code></pre>\n\n<p>Most of the code is enabling language extensions and the module header. Let's look at the rest:</p>\n\n<p>We are declaring the <code>Zero</code> class with the <code>zero</code> method as you did. Then we give a default signature for the <code>zero</code> method explaining under which conditions we can derive it. The type signature says that the type has to be a product type (i.e., have a single constructor). The <code>xs</code> is then bound to a list of types corresponding to the types of all the constructor arguments. The <code>All Zero xs</code> constraint says that all these argument types also have to be an instance of the <code>Zero</code> class. </p>\n\n<p>The code is then a one-liner, although admittedly a lot is going on in that line. The <code>to</code> call in transforms the produces generic representation into a value of the actually desired type in the end. The <code>SOP . Z</code> combination says we want to produce a value of the first (and only) constructor of the datatype. The <code>hcpure (Proxy @Zero) (I zero)</code> call produces as many copies of calls to <code>zero</code> as there are arguments of the constructor.</p>\n\n<p>In order to try it, we can define datatypes and derive instances of <code>Zero</code> for them now:    </p>\n\n<pre><code>data B1 = B1 Int\n  deriving (GHC.Generic, Generic, Show)\n\nderiving instance Zero B1\n\ndata B2 = B2 Int B1 Int\n  deriving (GHC.Generic, Generic, Show)\n\nderiving instance Zero B2\n</code></pre>\n\n<p>Because generics-sop is built on top of GHC generics, we have to define two <code>Generic</code> classes. The <code>GHC.Generic</code> class built into GHC, and the <code>Generic</code> class provided by generics-sop. The <code>Show</code> class is just for convience and testing.</p>\n\n<p>It's a bit unfortunate that even with the <code>DeriveAnyClass</code> extension, we cannot simply add <code>Zero</code> to the list of derived instances here, because GHC has difficulties inferring that the instance context should actually be empty. Perhaps a future version of GHC will be clever enough to recognise this. But in a standalone deriving declaration, we can explicitly provide the (empty) instance context and it is fine. In GHCi, we can see that this works:</p>\n\n<pre><code>GHCi&gt; zero :: B1\nB1 0\nGHCi&gt; zero :: B2\nB2 0 (B1 0) 0\n</code></pre>\n\n<h3>Solution using GHC generics</h3>\n\n<p>Let's look how we can do the same thing directly with GHC generics. Here, the code looks as follows:</p>\n\n<pre><code>{-# LANGUAGE DeriveAnyClass #-}\n{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeOperators #-}\nmodule Zero where\n\nimport GHC.Generics\n\nclass Zero a where\n  zero :: a\n  default zero :: (Generic a, GZero (Rep a)) =&gt; a\n  zero = to gzero\n\ninstance Zero Int where\n  zero = 0\n\nclass GZero a where\n  gzero :: a x\n\ninstance GZero U1 where\n  gzero = U1\n\ninstance Zero a =&gt; GZero (K1 i a) where\n  gzero = K1 zero\n\ninstance (GZero a, GZero b) =&gt; GZero (a :*: b) where\n  gzero = gzero :*: gzero\n\ninstance GZero a =&gt; GZero (M1 i c a) where\n  gzero = M1 gzero\n</code></pre>\n\n<p>The start is mostly what you also had in your question. The default signature for <code>zero</code> says that if <code>a</code> has a <code>Generic</code> instance and the type's generic representation <code>Rep a</code> is an instance of <code>GZero</code>, we can obtain a definition of <code>zero</code> by first calling <code>gzero</code>, and then using <code>to</code> to transform the generic representation into the actual type.</p>\n\n<p>We now have to give instances for the <code>GZero</code> class. We provide instances for <code>U1</code>, <code>K1</code>, <code>(:*:)</code> and <code>M1</code>, telling GHC how to deal with unit types (i.e., constructors without arguments), constants, pairs (binary products) and metadata, respectively. By not providing an instance for <code>(:+:)</code>, we implicitly exclude sum types (which was a bit more explicit via the <code>IsProductType</code> constraint in generics-sop).</p>\n\n<p>The instance for <code>U1</code> says that for a unit type we simply return the unique value.</p>\n\n<p>The instance for constants (these are the arguments of a constructor) says that for these, we need them to also be an instance of the <code>Zero</code> class and use a recursive call to <code>zero</code>.</p>\n\n<p>The instance for pairs says that in this case we produce a pair of <code>gzero</code> calls. This instance is applied repeatedly if a constructor has more than two arguments.</p>\n\n<p>The instance for metadata says that we want to ignore all metadata such as constructor names and record field selectors. We did not have to do anything about metadata in generics-sop, because GHC generics mixes metadata into the representation of every value, whereas in generics-sop it is separate.</p>\n\n<p>From here one, it's basically the same:</p>\n\n<pre><code>data B1 = B1 Int\n  deriving (Generic, Show, Zero)\n\ndata B2 = B2 Int B1 Int\n  deriving (Generic, Show, Zero)\n</code></pre>\n\n<p>This is a bit simpler, as we only have to derive a single <code>Generic</code> class, and in this scenario, GHC is clever enough to figure out the instance context for <code>Zero</code>, so we can just add it to the list of derived instances. The interaction with GHCi is exactly the same, so I won't repeat it here.</p>\n\n<h3>So what about mappend?</h3>\n\n<p>Now that we have <code>zero</code> which corresponds to <code>mzero</code>, perhaps you want to extend the class to cover <code>mappend</code> next. This is also possible, and of course, you're welcome to try it as an exercise.</p>\n\n<p>If you want to see solutions:</p>\n\n<p>For generics-sop, you can look at my <a href=\"https://www.youtube.com/watch?v=sQxH349HOik\" rel=\"noreferrer\">ZuriHac talk from 2016</a> which explains generics-sop in a bit more detail and uses how to derive <code>Monoid</code> instances as the initial example.</p>\n\n<p>For GHC generics, you can look at the <a href=\"https://hackage.haskell.org/package/generic-deriving\" rel=\"noreferrer\">generic-deriving</a> package which contains many example generic programs, including monoids. The source code\nof the <a href=\"https://hackage.haskell.org/package/generic-deriving-1.12.1/docs/src/Generics-Deriving-Monoid.html#GMonoid&#39;\" rel=\"noreferrer\"><code>Generics.Deriving.Monoid</code> module</a> contains the class instances for <code>GMonoid'</code> which are corresponding to <code>GZero</code> above and also contain code for <code>mappend</code>.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 1, "accepted_answer_id": 49335338, "answer_count": 1, "score": 4, "last_activity_date": 1521285321, "creation_date": 1521026106, "question_id": 49276305, "link": "https://stackoverflow.com/questions/49276305/how-to-write-an-instance-for-generic-to-derive-a-function-like-zeroa-i-e-a-c", "title": "How to write an instance for Generic to derive a function like zero::a (i.e. a constant)?", "body": "<p>I would like to derive with the <code>anyclass</code> strategy for the <code>class Zeros</code>. For this i need a default implementation and the corresponding instances for Generics:</p>\n\n<pre><code>import GHC.Generics\n\nclass   Zeros z where\n    zero :: z\n    default zero :: (Generic z, Gzero (Rep z)) =&gt; z\n    zero = gzero (from z)\n\nclass Gzero f  where\n    gzero :: f a -&gt; a\ninstance Gzero (Rec0 Int) where\n    gzero (Rec0 i a) = a\n\n\ndata B1 = B1 Int\n     deriving stock (Show, Read, Eq, Ord, Generic)\nderiving instance Zeros B1\n\n\ninstance Zeros Int where zero = 0\n</code></pre>\n\n<p>I get the error message (with stack LTS 10.8 - GHC 8.2.2):</p>\n\n<pre><code>Not in scope: data constructor \u2018Rec0\u2019\n    Perhaps you meant \u2018Rec1\u2019 (imported from GHC.Generics)\n   |\n37 |     gzero (Rec0 i a) = a\n   |            ^^^^\n</code></pre>\n\n<p>I have read the documentation for GHC.Generics, but cannot make the leap from the tree example to my case with a constant function. \nHelp is greatly appreciated!</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1521021056, "post_id": 49273860, "comment_id": 85551311, "body": "It might be enlightening to try to figure out how you think it should look instead."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1521022812, "post_id": 49273860, "comment_id": 85552562, "body": "Using <code>f</code> both as a type variable and as an argument of <code>fmap</code> might confuse you. I&#39;d avoid that."}, {"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 1, "creation_date": 1521024635, "post_id": 49273860, "comment_id": 85553861, "body": "Hm. This is free monad. <a href=\"https://www.stackage.org/haddock/lts-11.0/free-5.0.1/Control-Monad-Free.html#t:Free\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-11.0/free-5.0.1/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1521038390, "post_id": 49273860, "comment_id": 85563674, "body": "<code>fmap</code> turns <code>f :: a-&gt;b</code> into <code>fmap f :: F a -&gt; F b</code> where <code>F</code> is a functor. By the same reasoning, we get <code>fmap (fmap f) :: G (F a) -&gt; G (F b)</code> where both are functors. In your case, <code>F = GenTree f</code> and <code>G = f</code>, so that <code>G(F a) = f (GenTree f a)</code> which is the type of <code>ts</code>."}], "answers": [{"comments": [{"owner": {"reputation": 297, "user_id": 2935375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CYLMN.jpg?s=128&g=1", "display_name": "Shaurya Gupta", "link": "https://stackoverflow.com/users/2935375/shaurya-gupta"}, "edited": false, "score": 1, "creation_date": 1521026823, "post_id": 49274072, "comment_id": 85555430, "body": "Reasoning about the type of <code>(fmap g)</code> helped me understand this. Thanks!"}], "tags": [], "owner": {"reputation": 19421, "user_id": 3795501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaeec79535337d9a96f63f2d6ef3e49d?s=128&d=identicon&r=PG", "display_name": "Luka Jacobowitz", "link": "https://stackoverflow.com/users/3795501/luka-jacobowitz"}, "is_accepted": true, "score": 3, "last_activity_date": 1521028974, "last_edit_date": 1521028974, "creation_date": 1521020031, "answer_id": 49274072, "question_id": 49273860, "link": "https://stackoverflow.com/questions/49273860/how-is-this-functor-instance-implemented/49274072#49274072", "title": "How is this Functor instance implemented?", "body": "<p>If you look at the structure of <code>Node</code> it contains an <code>f (GenTree f a)</code>, so if we look at the types of the expression in question:</p>\n\n<pre><code>fmap f (Node ts) = Node (fmap (fmap f) ts)\n</code></pre>\n\n<p><code>f</code> here is of type <code>a -&gt; b</code></p>\n\n<p><code>ts</code> is of type <code>f (GenTree f a)</code>, but we should be aware that the <code>f</code> in this expression is not the function above, but actually the type constructor. In order to get rid of confusion we'll rename the function above to <code>g</code> as follows:</p>\n\n<pre><code>fmap g (Node ts) = Node (fmap (fmap g) ts)\n</code></pre>\n\n<p>Now in order to apply our function <code>g</code>, we'll need to get a hold of an actual value of <code>a</code>. We know that our <code>f</code> type constructor has a <code>Functor</code> instance, so if we map over it we get a <code>GenTree f a</code>:</p>\n\n<pre><code>fmap (\\tree -&gt; ...) ts\n</code></pre>\n\n<p>Now that we have our <code>GenTree</code> we can recursively call <code>fmap</code> on it so that at some point we'll get to the Leaves and actually apply our function to the value, if we wrote this out in all of its boilerplate, it'd look like this:</p>\n\n<pre><code>fmap g (Node ts) = Node (fmap (\\tree -&gt; fmap g tree) ts)\n</code></pre>\n\n<p>So in essence it is written that way, because we need to <code>fmap</code> over both the <code>f</code> type constructor and the actual <code>GenTree</code>.</p>\n"}], "owner": {"reputation": 297, "user_id": 2935375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CYLMN.jpg?s=128&g=1", "display_name": "Shaurya Gupta", "link": "https://stackoverflow.com/users/2935375/shaurya-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 49274072, "answer_count": 1, "score": 0, "last_activity_date": 1521028974, "creation_date": 1521019474, "question_id": 49273860, "link": "https://stackoverflow.com/questions/49273860/how-is-this-functor-instance-implemented", "title": "How is this Functor instance implemented?", "body": "<pre><code>data GenTree f a -- kind (* -&gt; *) -&gt; * -&gt; *\n    = Node (f (GenTree f a))\n    | Leaf a\n\ninstance Functor f =&gt; Functor (GenTree f) where\n    fmap f (Node ts) = Node (fmap (fmap f) ts)\n    fmap f (Leaf x)  = Leaf (f x)\n</code></pre>\n\n<p>I don't understand the <code>fmap (fmap f) ts</code> statement in the above Functor instance. Can somebody explain why it's written this way?</p>\n"}, {"tags": ["haskell", "gtk", "gtk3", "gtk2hs"], "answers": [{"tags": [], "owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "is_accepted": false, "score": 0, "last_activity_date": 1521036608, "creation_date": 1521036608, "answer_id": 49279922, "question_id": 49272714, "link": "https://stackoverflow.com/questions/49272714/gtk3-motionnotifyevent-doesnt-work-when-button-is-depressed/49279922#49279922", "title": "gtk3 motionNotifyEvent doesn&#39;t work when button is depressed", "body": "<p>Interesting, C documentation on motion-notify-event says </p>\n\n<blockquote>\n  <p>To receive this signal, the GdkWindow associated to the widget needs to enable the GDK_POINTER_MOTION_MASK mask</p>\n</blockquote>\n\n<p>Enabling only GDK_BUTTON1_MOTION_MASK doesn't work for me too. \nFortunately, GdkEventMotion has field <code>state</code>, where you can check whether button1 is pressed or not.</p>\n"}, {"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 1, "last_activity_date": 1525236986, "creation_date": 1525236986, "answer_id": 50127393, "question_id": 49272714, "link": "https://stackoverflow.com/questions/49272714/gtk3-motionnotifyevent-doesnt-work-when-button-is-depressed/50127393#50127393", "title": "gtk3 motionNotifyEvent doesn&#39;t work when button is depressed", "body": "<p>It doesn't seem to be mentioned in the documentation, but it turns out that you also need to enable <code>ButtonPressMask</code> to recieve <em>any</em> event with the mouse button pressed - including motion events which occur when the button is pressed down. This results in the paradoxical behaviour where enabling only <code>Button1MotionMask</code> results in no events being received unless you also enable <code>ButtonPressMask</code>. I finally figured this out after discovering the gtk-demo sample application - it's very useful for learning GTK!</p>\n"}], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 50127393, "answer_count": 2, "score": 0, "last_activity_date": 1525236986, "creation_date": 1521015643, "last_edit_date": 1521090376, "question_id": 49272714, "link": "https://stackoverflow.com/questions/49272714/gtk3-motionnotifyevent-doesnt-work-when-button-is-depressed", "title": "gtk3 motionNotifyEvent doesn&#39;t work when button is depressed", "body": "<pre><code>module Main where\n\nimport Control.Monad.IO.Class\nimport Graphics.UI.Gtk\n\nmain :: IO ()\nmain = do\n    initGUI\n    window &lt;- windowNew\n    canvas &lt;- drawingAreaNew\n\n    widgetAddEvents canvas [Button1MotionMask]\n\n    canvas `on` motionNotifyEvent $ do\n        c &lt;- eventCoordinates\n        liftIO $ print c\n        return False\n\n    containerAdd window canvas\n    widgetShowAll window\n    mainGUI\n</code></pre>\n\n<p>In the code above, I am trying to handle a 'mouse drag' on a <code>GtkDrawingArea</code>, where the left mouse button is depressed. However, nothing is printed, indicating that the event is never firing. Even stranger, when I change <code>Button1MotionMask</code> to <code>PointerMotionMask</code>, the event fires when I move my mouse normally (as expected), but not when I move the mouse while depressing the left mouse button. What is going on here? I am using the <code>gtk3-0.14.8</code> package on Windows 10.</p>\n\n<p><strong>EDIT:</strong> I should probably be a bit clearer about my problem. When I hold the left mouse button down while moving the mouse, <code>motionNotifyEvent</code>does not fire. This does not depend on whether I have added <code>PointerMotionMask</code> or <code>Button1MotionMask</code>.</p>\n"}, {"tags": ["haskell", "modal-logic"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520963947, "post_id": 49262771, "comment_id": 85529276, "body": "It is not garbage, it is simply a list of functions, all map <code>a</code>s to <code>b</code>s."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1520964036, "post_id": 49262771, "comment_id": 85529324, "body": "I don&#39;t know what your question is but <code>[a -&gt; b]  -&gt; [a] -&gt; [b]</code> is the type of <code>(&lt;*&gt;)</code> specialized to the <code>[]</code> instance of <code>Applicative</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1520964060, "post_id": 49262771, "comment_id": 85529340, "body": "We have <code>(&lt;*&gt;) :: [a -&gt; b] -&gt; [a] -&gt; [b]</code>, and also for the &quot;function modality&quot; we have <code>(&lt;*&gt;) :: (e -&gt; (a -&gt; b)) -&gt; (e -&gt; a) -&gt; (e -&gt; b)</code> which is the well-known K combinator. Probably just coincidence that they share the K name, though. ;-)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1520964110, "post_id": 49262771, "comment_id": 85529360, "body": "@DanielWagner Also probably a coincidence that these coincidences keep popping up all over the place."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520964339, "post_id": 49262771, "comment_id": 85529503, "body": "Does the operator <code>&lt;*&gt;</code> obey any of the other axioms of normal modal logics?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1520964371, "post_id": 49262771, "comment_id": 85529521, "body": "<a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Applicative.html\" rel=\"nofollow noreferrer\">Here are its laws</a>."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520964443, "post_id": 49262771, "comment_id": 85529582, "body": "Do other operators in Haskell obey other axioms common to normal modal logics. For example the T axiom, the S4 axiom and the S5 axiom, etc?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1520969789, "post_id": 49262771, "comment_id": 85532396, "body": "On the &quot;too broad&quot; close votes: FWIW, I don&#39;t feel this question should be closed. It is phrased in a rather speculative way (likely due to the OP&#39;s unfamiliarity with Haskell, which was mentioned in the original revision of the question); however, at its core there is a fairly reasonable question about whether the functor classes have something to do with modal operators."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1520976318, "post_id": 49262771, "comment_id": 85535569, "body": "<code>L</code> sure as heck looks like a comonad, not sure what a corresponding <code>M</code> would be offhand.  But e.g. known comonads such as nonempty lists of <code>a</code>, pairs <code>(w,a)</code> would satisfy."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520977646, "post_id": 49262771, "comment_id": 85536095, "body": "Ah, so <code>extract</code> is like (2) above (the T-axiom in modal logic), <code>duplicate</code> is like (4) (the S4 axiom). A simple example of an operator for (3) would take <code>M</code> to denote <code>False</code> and <code>L</code> to denote <code>Truth</code>, and this interpretation (obviously) works for some of the other examples."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520977954, "post_id": 49262771, "comment_id": 85536257, "body": "Known comonads such as nonempty lists of <code>a</code>, pairs <code>(w,a)</code> would satisfy what, sorry?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1520979612, "post_id": 49262771, "comment_id": 85536954, "body": "You should definitely read <a href=\"https://github.com/kwf/GQFC\" rel=\"nofollow noreferrer\">Getting a Quick Fix on Comonads</a>, which argues for (restricted use of) <code>ComonadApply</code> for some modal logic."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520980550, "post_id": 49262771, "comment_id": 85537282, "body": "Very interesting indeed! However, it still does not help with axioms (3) and (5) in my question. I&#39;ve thought of a potential example: the double negation translation with <code>L</code> as <code>not not</code> and <code>M</code> as <code>not</code> validates all the axioms above. I asked this question here <a href=\"https://math.stackexchange.com/questions/2347437/continuations-in-mathematics-nice-examples\" title=\"continuations in mathematics nice examples\">math.stackexchange.com/questions/2347437/&hellip;</a>  in which I argued the double negation translation was an example of the continuation monad. The endofunctor in this case would take every formula <code>a</code> to its double negation translation <code>(a -&gt; \u22a5) -&gt; \u22a5</code>."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1521028917, "post_id": 49262771, "comment_id": 85556828, "body": "Are you sure about (5)? If L is not.not and M is not, that would give <code>a -&gt; not (not (not a))</code> which seems a touch disturbing."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1521029374, "post_id": 49262771, "comment_id": 85557153, "body": "Ah, sorry, my mistake. It doesn&#39;t hold of (5) obviously!"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1521029457, "post_id": 49262771, "comment_id": 85557209, "body": "Can anyone think of any other examples of continuations which obey some of the axioms (1)-(5)?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1521088097, "post_id": 49262771, "comment_id": 85585860, "body": "Yeah, echoing what people have said already, my first impression here is that <code>M</code> \u2248 <code>Monad</code> and <code>L</code> \u2248 <code>ComonadApply</code> (#1: <code>(Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code>; #2: <code>extract :: (Comonad f) =&gt; f a -&gt; a</code>; #4: <code>duplicate :: (Comonad f) =&gt; f a -&gt; f (f a)</code>) or possibly <code>MonadTrans</code> (#3: <code>lift :: (MonadTrans t, Monad m) =&gt; m a -&gt; t (m a)</code>; #5: <code>instance (MonadTrans t, Monad m) =&gt; Monad (t m) where return :: a -&gt; t (m a)</code>). But I\u2019ve only really worked with epistemic modal logic (\u25a1 = \u201cknown to be true\u201d, \u25c7 = \u201cnot known to be false\u201d), not too familiar with modal logic in general."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1521105110, "post_id": 49262771, "comment_id": 85592806, "body": "Comonads obey the T axiom (my (1)), the S4 axiom (my (4)). Do comonads obey the K axiom (my (1))? That is, does <code>(Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code> when <code>f</code> is a comonad? If it does, then a Comonadic operator behaves syntatically like the necessity operator of S4 modal logic (the modal logic intertranslatable with intuitionistic logic via Godel&#39;s famous translation). Do monad transformers obey any of the other axioms I listed in my question?"}, {"owner": {"reputation": 9995, "user_id": 7879193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-bVdcN0nQCio/AAAAAAAAAAI/AAAAAAAACfs/jPa4Dr_Nzbk/photo.jpg?sz=128", "display_name": "Stanislav Kralin", "link": "https://stackoverflow.com/users/7879193/stanislav-kralin"}, "edited": false, "score": 0, "creation_date": 1521406398, "post_id": 49262771, "comment_id": 85705519, "body": "Hrm, K, T, S4, S5 are normal..."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1521454293, "post_id": 49262771, "comment_id": 85720834, "body": "I meant to write &quot;normal&quot;, but had non-normal modal logics in my mind, having just read a book on them!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1538551515, "post_id": 49262771, "comment_id": 92177251, "body": "@DanielWagner <code>&lt;*&gt;</code> is the <i>S</i> combinator though, not <i>K</i>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1538569562, "post_id": 49262771, "comment_id": 92187268, "body": "@WillNess Whoops, you&#39;re absolutely right!"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1541902241, "last_edit_date": 1541902241, "creation_date": 1538548344, "answer_id": 52620969, "question_id": 49262771, "link": "https://stackoverflow.com/questions/49262771/interesting-operators-in-haskell-that-obey-modal-axioms/52620969#52620969", "title": "Interesting operators in Haskell that obey modal axioms", "body": "<p><em>Preliminary note: I apologise for spending a good chunk of this answer talking about Propositional Lax Logic, a topic you are <a href=\"https://mathoverflow.net/q/296211/123749\">very familiar with</a> and not too interested in as far as this question is concerned. In any case, I do feel this theme is worthy of broader exposure -- and thanks for making me aware of it!</em></p>\n\n<hr>\n\n<p>The modal operator in propositional lax logic (PLL) is the Curry-Howard counterpart of <code>Monad</code> type constructors. Note the correspondence between its axioms...</p>\n\n<pre><code>DT: x -&gt; D x\nD4: D (D x) -&gt; D x\nDF: (x -&gt; y) -&gt; D x -&gt; D y\n</code></pre>\n\n<p>... and the types of <code>return</code>, <code>join</code> and <code>fmap</code>, respectively.</p>\n\n<p>There are a number of papers by Valeria de Paiva discussing intuitionistic modal logics and, in particular, PLL. The remarks about PLL here are largely based on <a href=\"https://www.cs.bham.ac.uk/~exr/papers/csl01.pdf\" rel=\"nofollow noreferrer\">Alechina <em>et. al.</em>, <em>Categorical and Kripke Semantics for Constructive S4 Modal Logic</em> (2001)</a>. Interestingly, that paper makes a case for the PLL being less weird than it might seem at first (cf. <a href=\"https://www.uni-bamberg.de/fileadmin/uni/fakultaeten/wiai_professuren/grundlagen_informatik/papersMM/pll.pdf\" rel=\"nofollow noreferrer\">Fairtlough and Mendler, <em>Propositional Lax Logic</em> (1997)</a>: \"As a modal logic it is special because it features a single modal operator [...] that has a flavour both of possibility and necessity\"). Starting with CS4, a version of intuitionistic S4 without distribution of possibility over disjunction...</p>\n\n<pre><code>B stands for box, and D for diamond\n\nBK: B (x -&gt; y) -&gt; (B x -&gt; B y)\nBT: B x -&gt; x\nB4: B x -&gt; B (B x)\n\nDK: B (x -&gt; y) -&gt; (D x -&gt; D y)\nDT: x -&gt; D x\nD4: B (B x) -&gt; B x\n</code></pre>\n\n<p>... and adding <code>x -&gt; B x</code> to it causes <code>B</code> to become trivial (or, in Haskell parlance, <code>Identity</code>), simplifying the logic to PLL. That being so, PLL can be regarded as a special case of a variant of intuitionistic S4. Furthermore, it frames PLL's <code>D</code> as a possibility-like operator. That is intuitively appealing if we take <code>D</code> as the counterpart to Haskell <code>Monad</code>s, which often do have a possibility flavour (consider <code>Maybe Integer</code> -- \"There might be an <code>Integer</code> here\" -- or <code>IO Integer</code> -- \"I will get an <code>Integer</code> when the program is executed\").</p>\n\n<hr>\n\n<p>A few other possibilities:</p>\n\n<ul>\n<li><p>At a glance, it seems the symmetrical move of making <code>D</code> trivial leads us to something very much like <code>ComonadApply</code>. I say \"very much like\" largely due to the functorial strength of Haskell <code>Functor</code>s, the matter being that <code>x /\\ B y -&gt; B (x /\\ y)</code> is an awkward thing to have if you are looking for a conventional necessity modality.</p></li>\n<li><p>Kenneth Foner's <a href=\"https://github.com/kwf/GQFC\" rel=\"nofollow noreferrer\"><em>Functional Pearl: Getting a Quick Fix on Comonads</em></a> (thanks to dfeuer for the reference) works towards expressing intuitionistic K4 in Haskell, covering some of the difficulties along the way (including the functorial strength issue mentioned above).</p></li>\n<li><p>Matt Parsons' <a href=\"https://github.com/parsonsmatt/modalities\" rel=\"nofollow noreferrer\"><em>Distributed Modal Logic</em></a> offers a Haskell-oriented presentation of intuitionistc S5 and an interpretation of it, originally by Tom Murphy VII, in terms of distributed computing: <code>B x</code> as a <code>x</code>-producing computation that can be run anywhere on a network, and <code>D x</code> as an address to a <code>x</code> somewhere on it. </p></li>\n<li><p>Temporal logics can be related via Curry-Howard to functional reactive programming (FRP). Suggestions of jumping-off points include <a href=\"https://vcvpaiva.github.io/includes/pubs/2017-grisha.pdf\" rel=\"nofollow noreferrer\">de Paiva and Eades III, <em>Constructive Temporal Logic, Categorically</em> (2017)</a>, as well as <a href=\"http://haskellexists.blogspot.com/2016/01/frp-for-free.html\" rel=\"nofollow noreferrer\">this blog post by Philip Schuster</a> alongside <a href=\"https://www.reddit.com/r/haskell/comments/40x4wf/frp_for_free/\" rel=\"nofollow noreferrer\">this interesting /r/haskell thread about it</a>.</p></li>\n</ul>\n"}], "owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 1, "accepted_answer_id": 52620969, "answer_count": 1, "score": 10, "last_activity_date": 1563228164, "creation_date": 1520963695, "last_edit_date": 1563228164, "question_id": 49262771, "link": "https://stackoverflow.com/questions/49262771/interesting-operators-in-haskell-that-obey-modal-axioms", "title": "Interesting operators in Haskell that obey modal axioms", "body": "<p>I was just looking at the type of <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> and just the shape of this function made me wonder whether we could see the list forming operator [ ] as obeying various axioms common to normal modal logics (e.g, T, S4, S5, B), since we seem to have at least the K-axiom of normal modal logics, with <code>[(a -&gt; b)] -&gt; [a] -&gt; [b]</code>.</p>\n\n<p>This leads to my question: are there familiar, interesting operators or functors in Haskell which have the syntax of modal operators of a certain kind, and which obey the axioms common to normal modal logics (i.e, K, T, S4, S5 and B)?</p>\n\n<p>This question can be sharpened and made more specific. Consider an operator <code>L</code>, and its dual <code>M</code>. Now the question becomes: are there any familiar, interesting operators in Haskell with some of the following properties:</p>\n\n<p>(1) <code>L(a -&gt; b) -&gt; La -&gt; Lb</code></p>\n\n<p>(2) <code>La -&gt; a</code></p>\n\n<p>(3)  <code>Ma -&gt; L(M a)</code> </p>\n\n<p>(4)  <code>La -&gt; L(L a)</code> </p>\n\n<p>(5) <code>a -&gt; L(M a)</code> </p>\n\n<p>It would be very interesting to see some nice examples.</p>\n\n<p>I've thought of a potential example, but it would be good to know whether I am correct: the double negation translation with <code>L</code> as <code>not not</code> and <code>M</code> as <code>not</code>. This translation takes every formula <code>a</code> to its double negation translation <code>(a -&gt; \u22a5) -&gt; \u22a5</code> and, crucially, validates axioms (1)-(4), but not axiom (5). I asked a question here <a href=\"https://math.stackexchange.com/questions/2347437/continuations-in-mathematics-nice-examples\">https://math.stackexchange.com/questions/2347437/continuations-in-mathematics-nice-examples</a>  and it seems the double negation translation can be simulated via the continuation monad, the endofunctor taking every formula <code>a</code> to its double negation translation <code>(a -&gt; \u22a5) -&gt; \u22a5</code>. There Derek Elkins notes the existence of a couple of double negation translations corresponding, via the Curry-Howard isomorphism, to different continuation-passing style transforms, e.g. Kolmogorov's corresponds to the call-by-name CPS transform.</p>\n\n<p>Perhaps there are other operations that can be done in the continuation monad via Haskell which can validate axioms (1)-(5).</p>\n\n<hr>\n\n<p>(And just to eliminate one example: there are clear relations between so-called Lax logic <a href=\"https://www.sciencedirect.com/science/article/pii/S0890540197926274\" rel=\"nofollow noreferrer\">https://www.sciencedirect.com/science/article/pii/S0890540197926274</a>     and Monads in Haskell, with the return operation obeying the laws of the modal operator of this logic (which is an endofunctor). I am not interested so much in those examples, but in examples of Haskell operators which obey some of the axioms of modal operators in classical normal modal logics)</p>\n"}, {"tags": ["haskell", "mapping", "bson", "template-haskell"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1520960425, "post_id": 49261529, "comment_id": 85527225, "body": "Does the deriveBson work if your Item is not parametric in &#39;a&#39;?  Also, what error are you getting?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520962713, "post_id": 49261529, "comment_id": 85528587, "body": "<code>bson-mapping</code>&#39;s Template Haskell macros look a bit strange \u2013 any reason you prefer that package over <code>bson-generic</code> or one of the converters to Aeson?"}, {"owner": {"reputation": 265, "user_id": 6815822, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-qkDbJWc-cz0/AAAAAAAAAAI/AAAAAAAABpI/NK0z5UCdS5A/photo.jpg?sz=128", "display_name": "Luke Morgenstern", "link": "https://stackoverflow.com/users/6815822/luke-morgenstern"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520981785, "post_id": 49261529, "comment_id": 85537704, "body": "@leftaroundabout I just tried to go with the &quot;native&quot; Data.Bson package!"}, {"owner": {"reputation": 265, "user_id": 6815822, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-qkDbJWc-cz0/AAAAAAAAAAI/AAAAAAAABpI/NK0z5UCdS5A/photo.jpg?sz=128", "display_name": "Luke Morgenstern", "link": "https://stackoverflow.com/users/6815822/luke-morgenstern"}, "reply_to_user": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1520981819, "post_id": 49261529, "comment_id": 85537721, "body": "@MarcTalbot I tried it out, but it didn&#39;t resolve it. The &quot;deriving&quot; of TemplateHaskell doesn&#39;t work"}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1520962614, "post_id": 49262464, "comment_id": 85528525, "body": "ps: code is not compiled - don&#39;t have a ghc with me right now"}, {"owner": {"reputation": 265, "user_id": 6815822, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-qkDbJWc-cz0/AAAAAAAAAAI/AAAAAAAABpI/NK0z5UCdS5A/photo.jpg?sz=128", "display_name": "Luke Morgenstern", "link": "https://stackoverflow.com/users/6815822/luke-morgenstern"}, "edited": false, "score": 0, "creation_date": 1520984389, "post_id": 49262464, "comment_id": 85538551, "body": "thank you very much, this is a very amazing explanation and solution! You put a lot of thought in this. I appreciate the effort \u263a\ufe0f"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1520982494, "last_edit_date": 1520982494, "creation_date": 1520962524, "answer_id": 49262464, "question_id": 49261529, "link": "https://stackoverflow.com/questions/49261529/how-does-one-transform-a-data-type-into-bson-in-haskell/49262464#49262464", "title": "How does one transform a data type into BSON in Haskell?", "body": "<p>You speak of an error but don't post the error itself so I cannot help with that - but serializing your data type should be fairly straightforward</p>\n\n<pre><code>data Item a = Item { content :: a\n                   , checked :: Bool\n                   } deriving (Eq, Show, Typeable)\n\ninstance (Bson a) =&gt; Bson (Item a) where\n  toBson (Item cont check) = [\"content\" := Doc (toBson cont)\n                             ,\"checked\" := Bool check]\n  fromBson d = do cont  &lt;- \"content\" `lookup` d\n                  check &lt;- \"checked\" `lookup` d\n                  pure $ Item cont check\n</code></pre>\n\n<p><code>toBson</code> has to create a <code>Document</code> which is just a type synonym for <code>[Field]</code> where Field is just a <code>Label</code> associated with a tagged value. Of course we have to require <code>a</code> to implement serialization and de-serialization in order to make <code>Item</code> an instance of <code>Bson</code>.</p>\n\n<p>For the de-serialization I chose the <code>lookup</code> function which gives back a monadic value i.e. the value if found and a way to fail if not. E.g. if our monad is <code>Maybe</code> then it would give back a <code>Nothing</code> if not found and a <code>Just x</code> otherwise, for IO we would get a run-time error (something we want to avoid). so when calling <code>toBson ...</code> make sure you execute it in a sane monad like <code>Maybe _</code> or <code>Either String _</code>.</p>\n\n<p>Test it with</p>\n\n<pre><code>toBson [\"no-content\":=Int64 1, \"checked\":= Bool True] :: Maybe (Item Int)\ntoBson [\"content\":=Int64 1, \"unchecked\":= Bool True] :: Either String (Item Int)\n</code></pre>\n\n<p>If you want to skip an implementation by hand - you need to show me the error, I'd be happy to help you with what went wrong.</p>\n"}], "owner": {"reputation": 265, "user_id": 6815822, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-qkDbJWc-cz0/AAAAAAAAAAI/AAAAAAAABpI/NK0z5UCdS5A/photo.jpg?sz=128", "display_name": "Luke Morgenstern", "link": "https://stackoverflow.com/users/6815822/luke-morgenstern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 49262464, "answer_count": 1, "score": 1, "last_activity_date": 1520982494, "creation_date": 1520959455, "question_id": 49261529, "link": "https://stackoverflow.com/questions/49261529/how-does-one-transform-a-data-type-into-bson-in-haskell", "title": "How does one transform a data type into BSON in Haskell?", "body": "<p>I've been trying to understand how to transform a Data type into a Document with Haskell's <a href=\"https://hackage.haskell.org/package/bson-mapping-0.1.4.1/docs/Data-Bson-Mapping.html#v:selectFields\" rel=\"nofollow noreferrer\">Data.Bson.Mapping</a> package, however, I couldn't figure it out and the example in the <a href=\"http://hackage.haskell.org/package/bson-mapping-0.1.5.1/docs/Data-Bson-Mapping.html\" rel=\"nofollow noreferrer\">docs</a> didn't help much either. </p>\n\n<p>How should I resolve this problem? No questions regarding this seem to have been posted yet. I'll attach relevant code below, so you may be able to understand where I'm coming from.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Main where\nimport Database.MongoDB.Connection  (host, connect)\nimport Database.MongoDB.Query       (access, master, insertMany)\nimport Data.Data                    (Typeable)\nimport Data.Bson.Mapping\n\ndata Item a = Item { content :: a\n                   , checked :: Bool\n                   } deriving (Eq, Show, Typeable)\n</code></pre>\n\n<p><strong>What I've tried so far</strong></p>\n\n<ul>\n<li>selectFields, but I don't know how to change the Expression (Q Exp) into a Document</li>\n<li>Implementing deriveBson, but I got the same error as with the example from the Docs</li>\n</ul>\n\n<p>Please note, I'm still fairly new to Haskell and I have spent 2 hours looking for a solution, but just couldn't figure it out.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1520952341, "post_id": 49258638, "comment_id": 85521367, "body": "I can&#39;t reproduce the error when loading the function from a file. How are you loading the file?"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520952397, "post_id": 49258638, "comment_id": 85521414, "body": "By using  <code>:l experiment</code>, where the emacs file is named experiment.hs"}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520952464, "post_id": 49258638, "comment_id": 85521464, "body": "Which GHC version is it? Did you export the function?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520952529, "post_id": 49258638, "comment_id": 85521513, "body": "Unless you have a typo that doesn&#39;t appear in your question, I don&#39;t see how you could get that error."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 3, "creation_date": 1520952618, "post_id": 49258638, "comment_id": 85521566, "body": "Version 8.2.2, WinGHCi. Also the file is experiment.hs~      I looked at the file&#39;s properties, and it is marked as HS~ File (.hs~). Perhaps it has to do with the type of file I saved?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520952734, "post_id": 49258638, "comment_id": 85521667, "body": "I would expect any problem specific to file metadata to occur immediately with the <code>:l experiment</code> command."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1520952819, "post_id": 49258638, "comment_id": 85521729, "body": "Have you actually written your file? <code>.hs~</code> is an emacs temporary backup file, not the &quot;actual&quot; file."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520952961, "post_id": 49258638, "comment_id": 85521839, "body": "The problem was the status of the emacs file. I looked at the file and the emacs file did not have the Haskell logo on it, whereas another file did. I looked at the file&#39;s properties, and they were listed as HS~ File (.hs~) instead of Haskell Source File (.hs). Also, the file was listed as opening with &quot;Windows Shell Common Dll&quot; instead of with &quot;GHCi&quot;"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520953065, "post_id": 49258638, "comment_id": 85521905, "body": "Yes, I didn&#39;t realise this. So I conclude (!) something obvious to most people au fait with these sorts of things that  temporary backup files cannot be loaded onto GHCi. :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520953084, "post_id": 49258638, "comment_id": 85521919, "body": "And <code>:l experiment</code> didn&#39;t give any indication that it didn&#39;t actually load the file? Regardless of the extension, the <i>contents</i> of the file are identical; I would expect GHCi to either load the file fine or complain that the file is invalid."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520953466, "post_id": 49258638, "comment_id": 85522207, "body": "<code>:l experiment&#39; loaded perfectly, with &quot;ghci&gt;&quot; :l experiment [1 of 1] Compiling Main             ( experiment.hs, interpreted )  Perhaps because of the bona fide file </code>experiment.hs` which I had"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520954570, "post_id": 49258638, "comment_id": 85523022, "body": "@chepner Thanks for undoing my duplicate closure. I got overconfident about it after looking at your answer, not realising the oddness of the issue as described by the OP."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520954785, "post_id": 49258638, "comment_id": 85523174, "body": "@duplode That fact that I <i>could</i> do it surprised me; I didn&#39;t realize until that moment that I&#39;d earned the gold <code>haskell</code> badge."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520956094, "post_id": 49258638, "comment_id": 85524158, "body": "(@chepner Looks like you earned it this Friday... Congratulations! :))"}], "answers": [{"comments": [{"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520952129, "post_id": 49259004, "comment_id": 85521183, "body": "But I want to have the function defined in my emacs file and then load it onto GHCi. Do I have to enclose the function in <code>:{...:}</code> on my emacs file, in order to do this?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520952460, "post_id": 49259004, "comment_id": 85521460, "body": "This explains the errors in the second half of your post. I can&#39;t reproduce the problem loading from a file; can you provide more information in the question about how you load it?"}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 0, "creation_date": 1520952666, "post_id": 49259004, "comment_id": 85521600, "body": "By using <code>:l experiment</code>, where the emacs file is named experiment.hs~."}, {"owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "edited": false, "score": 1, "creation_date": 1520952972, "post_id": 49259004, "comment_id": 85521844, "body": "I discovered the problem. It was the status of the emacs file. I looked at the file and the emacs file did not have the Haskell logo on it, whereas another file did. I looked at the file&#39;s properties, and they were listed as HS~ File (.hs~) instead of Haskell Source File (.hs). Also, the file was listed as opening with &quot;Windows Shell Common Dll&quot; instead of with &quot;GHCi&quot;"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1520951919, "creation_date": 1520951919, "answer_id": 49259004, "question_id": 49258638, "link": "https://stackoverflow.com/questions/49258638/interactive11-error-variable-not-in-scope/49259004#49259004", "title": "&lt;interactive&gt;:1:1: error: Variable not in scope", "body": "<p>To type a multiline definition in GHCi, you need to enclose it in <code>:{...:}</code></p>\n\n<pre><code>Prelude&gt; :{\nPrelude| joinedWithCommas :: [String] -&gt; String\nPrelude| joinedWithCommas []     = \"\"\nPrelude| joinedWithCommas [x]    = x\nPrelude| joinedWithCommas (x:xs) = x ++ \", \" ++ joinedWithCommas xs\nPrelude| :}\nPrelude&gt; joinedWithCommas []\n\"\"\n</code></pre>\n\n<p>Otherwise, each line is processed in isolation.</p>\n"}], "owner": {"reputation": 565, "user_id": 9485986, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d8c32271af227c9b61727271791a17de?s=128&d=identicon&r=PG", "display_name": "user65526", "link": "https://stackoverflow.com/users/9485986/user65526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3512, "favorite_count": 0, "accepted_answer_id": 49259004, "answer_count": 1, "score": 2, "last_activity_date": 1520952350, "creation_date": 1520950949, "last_edit_date": 1520952350, "question_id": 49258638, "link": "https://stackoverflow.com/questions/49258638/interactive11-error-variable-not-in-scope", "title": "&lt;interactive&gt;:1:1: error: Variable not in scope", "body": "<p>I have defined the following function (taken from <a href=\"http://www.happylearnhaskelltutorial.com/1/shop_for_food_with_list.html#s9\" rel=\"nofollow noreferrer\">http://www.happylearnhaskelltutorial.com/1/shop_for_food_with_list.html#s9</a>) on an emacs file:</p>\n\n<pre><code>firstOnesOrEmpty :: [String] -&gt; String\nfirstOnesOrEmpty [] = \"\"\nfirstOnesOrEmpty [x] = x\nfirstOnesOrEmpty (x:y:_) = x ++ \", \" ++ y\n</code></pre>\n\n<p>But when I load my file onto GHCi and write <code>:t firstOnesOrEmpty</code> into GHCi, I get the following error: </p>\n\n<pre><code>&lt;interactive&gt;:1:1: error: Variable not in scope: firstOnesOrEmpty \n</code></pre>\n\n<p>What is going wrong?  </p>\n\n<p>I also have a similar problem with another function defined on my emacs file (again from the website above):</p>\n\n<pre><code>joinedWithCommas :: [String] -&gt; String\njoinedWithCommas []     = \"\"\njoinedWithCommas [x]    = x\njoinedWithCommas (x:xs) = x ++ \", \" ++ joinedWithCommas xs\n</code></pre>\n\n<p>Trying to use this function in GHCi I get:</p>\n\n<pre><code>  \"ghci&gt;\" joinedWithCommas [] \n\n  &lt;interactive&gt;:40:1: error:\n  Variable not in scope: joinedWithCommas :: [a0] -&gt; t\n  \"ghci&gt;\" joinedWithCommas [x] \n\n  &lt;interactive&gt;:41:1: error:\n  Variable not in scope: joinedWithCommas :: [a0] -&gt; t\n\n  &lt;interactive&gt;:41:19: error: Variable not in scope: x\n  \"ghci&gt;\" joinedWithCommas [\"x\"] \n\n  &lt;interactive&gt;:42:1: error:\n  Variable not in scope: joinedWithCommas :: [[Char]] -&gt; t\n</code></pre>\n\n<p>I hope someone can help.</p>\n\n<p>I have looked at previous answers to questions on this topic, and am unable to see how they provide answers to my question. </p>\n\n<p>If someone could point me in the direction of a previous relevant answer and explain how that answer actually answers my question (which I repeat, is not clear to me), I would be extremely grateful.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9485443, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kH3Fu.jpg?s=128&g=1", "display_name": "Matt G", "link": "https://stackoverflow.com/users/9485443/matt-g"}, "edited": false, "score": 0, "creation_date": 1520948117, "post_id": 49256938, "comment_id": 85518178, "body": "Thanks for this, it does just what I need. Could I ask you add a couple more comments just to explain which bits do what, so I understand it for next time? Thanks a lot"}], "tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": true, "score": 6, "last_activity_date": 1521116042, "last_edit_date": 1521116042, "creation_date": 1520946133, "answer_id": 49256938, "question_id": 49256783, "link": "https://stackoverflow.com/questions/49256783/searching-a-txt-file-line-by-line-haskell/49256938#49256938", "title": "Searching a .txt file line by line Haskell", "body": "<p>Using your own approach, scan the file looking for a name:</p>\n\n<pre><code>main = do\n    putStrLn \"Enter Director's name\"\n    name &lt;- getLine\n    base &lt;- readFile \"Films.txt\"     -- base is the whole file contents as a single string\n    print $moviesBy name $lines base\n\nmoviesBy :: String -&gt; [String] -&gt; [[String]]\nmoviesBy name (title:director:year:_:others) | director == name = [title, director, year]:moviesBy name others\n                                             | otherwise = moviesBy name others -- a different director, scan the rest of the file\nmoviesBy _ _ = [] -- when there's no more records\n</code></pre>\n\n<p>In more detail...</p>\n\n<p><code>lines base</code> splits file contents in lines (newlines removed) producing a list of strings.</p>\n\n<p><code>moviesBy</code> accepts a string as a search pattern, and a list of strings which is your file's contents. From how this file was created, we expect to find director's name at each <strong>second</strong> line out of every four. Which is done as the first pattern-match:</p>\n\n<pre><code>moviesBy name (title:director:year:_:others)\n</code></pre>\n\n<p>Here, <code>(title:director:year:_:others)</code> matches a list of at least four elements, binding them to relevant variables (<code>_</code> in the fourth position is a wildcard pattern that is here matched against the whitespace string which is of no importance for us). <code>others</code>, as the rightmost operand to <code>:</code>, thus matches the remaining part of the list (4th tail, in Lisp parlance). After the pipe <code>|</code> we add an extra constraint on the match, that the second element from the quadruplet should equal to the director's name of concern. If true, a list of <code>[title, director, year]</code> is inserted in the output (being the left operand to <code>:</code> on the RHS of <code>=</code>, the right-hand part of a production rule) and the remaining part of the list (<code>other</code>) is examined via the recursive call (the right operand to that RHS <code>:</code>); <code>otherwise</code> this quadruplet is skipped and simply the remaining part is considered.</p>\n\n<p>The match in the last line deals with any list that is less than four elements (which is probably the end of file). Since we're unlikely to find any more director's movies in such a short list, we simply return <code>[]</code>.</p>\n\n<p>So, for instance, if we have a list</p>\n\n<pre><code>[\"Blade Runner\", \"Ridley Scott\", \"1982\", \" \", \"Alien\", \"Ridley Scott\", \"1979\", \" \"]\n</code></pre>\n\n<p>then looking for Scott's films we obtain:</p>\n\n<ol>\n<li><p>At first, list is matched against <code>(title:director:year:_:others)</code>. Then variables are bound: <code>title</code> is \"Blade Runner\", <code>director</code> is \"Riddley Scott\", <code>year</code> is \"1982\" and <code>others</code> is <code>[\"Alien\", \"Ridley Scott\", \"1979\", \" \"]</code>. Since <code>director</code> equals the name we're looking for, we take the first path and proclaim <code>[\"Blade Runner\", \"Ridley Scott\", \"1982\"]:moviesBy \"Ridley Scott\" [\"Alien\", \"Ridley Scott\", \"1979\", \" \"]</code> to be our result.</p></li>\n<li><p>Next, a recursive call follows to construct the tail of resulting list. Here again, <code>title</code> is \"Alien\", <code>director</code> \"Ridley Scott\", <code>year</code> is \"1979\" and <code>others</code> is bound to an empty list. So, the tail of the resulting list from step 1. is <code>[\"Alien\", \"Ridley Scott\", \"1979\"]:moviesBy \"Ridley Scott\" []</code>.</p></li>\n<li><p>The last recursive call. We cannot bind the at-least-four elements pattern to the empty list, so we take the last alternative, <code>moviesBy _ _</code> that matches any combination of a string and a list, and here the result is [] (the recursion stops). So, the result of step 2. is <code>[\"Alien\", \"Ridley Scott\", \"1979\"]:[]</code>, in other words, <code>[[\"Alien\", \"Ridley Scott\", \"1979\"]]</code>. and with head prepended in 1., the total result of the function is <code>[[\"Blade Runner\", \"Ridley Scott\", \"1982\"], [\"Alien\", \"Ridley Scott\", \"1979\"]]</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 21, "user_id": 9485443, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kH3Fu.jpg?s=128&g=1", "display_name": "Matt G", "link": "https://stackoverflow.com/users/9485443/matt-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 49256938, "answer_count": 1, "score": 0, "last_activity_date": 1521116042, "creation_date": 1520945670, "last_edit_date": 1520946128, "question_id": 49256783, "link": "https://stackoverflow.com/questions/49256783/searching-a-txt-file-line-by-line-haskell", "title": "Searching a .txt file line by line Haskell", "body": "<p>I am new to Haskell, and I have created a function to allow a \"user\" to add a new film to a database (a text file called Films.txt).</p>\n\n<pre><code>main = do\n    putStrLn \"Insert film title:\"\n    film &lt;- getLine\n    putStrLn (\"Who directed \" ++ film ++ \"?\")\n    director &lt;- getLine\n    putStrLn (\"What year was \" ++ film ++ \" released?\")\n    year &lt;- getLine\n    appendFile \"Films.txt\" $ (film ++ \"\\n\")\n    appendFile \"Films.txt\" $ (director ++ \"\\n\")\n    appendFile \"Films.txt\" $ (year ++ \"\\n\")\n    appendFile \"Films.txt\" $ (\" \" ++ \"\\n\")\n</code></pre>\n\n<p>An example of the text file created is:</p>\n\n<pre><code>Blade Runner\nRidley Scott\n1982\nThe Fly\nDavid Cronenberg\n1986\netc...\n</code></pre>\n\n<p>How would I then search this file, line by line, if I wanted to return only films by a certain director. In another language I would use a FOR loop to search the .txt file line by line until a line matched the search term e.g. \"Ridley Scott\". Then I would return to the line above the matched line, output it (film name) and continue the search until the .txt file was finished.</p>\n\n<p>However in Haskell I am having trouble turning this thought process into code, mainly because I can't find a way search the file line by line.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520936344, "post_id": 49253438, "comment_id": 85510380, "body": "How should Haskell know what the <code>zero</code> element should be? But indeed, only for some specific cases, Haskell can perform automatic derivations."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520938163, "post_id": 49253438, "comment_id": 85511533, "body": "Could you point me to the list of the <code>specific cases</code> ? what is different in the expected derived instance for Basis1 compared to deriving, e.g., show? The newtype constructor is added.. - Would it be difficutl to implement in GHC to derive for constans?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520938341, "post_id": 49253438, "comment_id": 85511633, "body": "see <a href=\"https://stackoverflow.com/a/3864746/67579\">stackoverflow.com/a/3864746/67579</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520938467, "post_id": 49253438, "comment_id": 85511709, "body": "and you do not really provide a way to derive what <code>zero</code> is, a conservative compiler can thus not simply make a lucky guess."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520941445, "post_id": 49253438, "comment_id": 85513547, "body": "Thank you for your patience. I must miss something: An instance for Text is given and I assume that the derivation for the newtype <code>Basis1 Text</code> should use it automatically - the same it would for <code>show</code>. In <a href=\"https://downloads.haskell.org/~ghc/7.4.2/docs/html/users_guide/generic-programming.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.4.2/docs/html/users_guide/&hellip;</a> mechanism for deriving constants are mentioned; should I use the mechanism described there?"}], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1520979759, "post_id": 49255937, "comment_id": 85537002, "body": "Thank you for the pointer to GHC.Generics, which I read but do not see how to apply it here. I have (naively) coded:                           class   Zeros z where     zero :: z     default zero :: (Generic z, Gzero (Rep z)) =&gt; z      zero = gzero (from z)   class Gzero f  where      gzero :: f a -&gt; a  instance Gzero U1 where     gzero U1 = a but  got errors on both lines with gzero.  I tried to derive Monoid from Data.Monoid, but cannot derive it for a data type (but for newtypes). Can automatic derivatin of Zeros not be done or can my code be improved? if not, why?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1520980018, "post_id": 49255937, "comment_id": 85537102, "body": "@user855443 Please open a fresh question with the details of your attempt (including an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>) and the exact error message it produces."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1521026202, "post_id": 49255937, "comment_id": 85555002, "body": "Thank you for the advice: the new question is <a href=\"https://stackoverflow.com/questions/49276305/how-to-write-an-instance-for-generic-to-derive-a-function-like-zeroa-i-e-a-c\" title=\"how to write an instance for generic to derive a function like zeroa i e a c\">stackoverflow.com/questions/49276305/&hellip;</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1520943244, "creation_date": 1520943244, "answer_id": 49255937, "question_id": 49253438, "link": "https://stackoverflow.com/questions/49253438/deriving-a-class-with-a-single-constant/49255937#49255937", "title": "Deriving a class with a single constant", "body": "<p><code>GeneralizedNewtypeDeriving</code> will write the instance you propose, but <code>DeriveAnyClass</code> will write this instance:</p>\n\n<pre><code>instance Zeros Text =&gt; Zeros Basis1\n</code></pre>\n\n<p>N.B. there are no method definitions! For that to work, you need to give a default implementation for every method; usually this is done with <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\">generics</a> or a similar generic programming toolkit.</p>\n"}, {"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1521023063, "post_id": 49267607, "comment_id": 85552749, "body": "I use this solution, but it is limited to types defined as newtype and does not work for <code>data X = X .. </code>. where I think I can only use the deriving strategy <code>anyclass</code> which does not produce an instance for the function <code>zero</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1521033871, "post_id": 49267607, "comment_id": 85560305, "body": "@user855443, yes, but your question asked about <code>newtype</code>. Was that unintentional?"}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1521043447, "post_id": 49267607, "comment_id": 85567597, "body": "I learned only from the advice i received that newtype deriving is only applicable to newtype definitions and that for data definitions i need anyclass. therefore Ryan&#39;s very useful blog post solved most of my problem and left the case where anyclass is required open. The question was posed with incomplete understanding..."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1520984372, "creation_date": 1520984372, "answer_id": 49267607, "question_id": 49253438, "link": "https://stackoverflow.com/questions/49253438/deriving-a-class-with-a-single-constant/49267607#49267607", "title": "Deriving a class with a single constant", "body": "<p>You pointed to Ryan's blog post that explains a fix. Why don't you use it? Add <code>DerivingStrategies</code> and then use <code>deriving newtype Zeros</code>.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1520984372, "creation_date": 1520935922, "last_edit_date": 1520984221, "question_id": 49253438, "link": "https://stackoverflow.com/questions/49253438/deriving-a-class-with-a-single-constant", "title": "Deriving a class with a single constant", "body": "<p>I would like to derive a class with a constant and some trivial operations: </p>\n\n<pre><code>class  Zeros z where\n    zero :: z\n    isZero  :: Eq z =&gt;  z -&gt; Bool\n    isZero z = zero == z\n</code></pre>\n\n<p>and in another module:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, DeriveAnyClass\n    , GeneralizedNewtypeDeriving #-}\nmodule Lib.DerivingExampleDerive\n    where\nimport Data.Text\nimport Lib.DerivingExample\nimport GHC.Generics\n\nnewtype Basis1 = Basis1 Text deriving (Show, Read, Eq, Ord, Generic, Zeros)\n</code></pre>\n\n<p>GHC 8.2.2 produces the error:</p>\n\n<pre><code>/home/frank/Workspace8/testSome/Lib/DerivingExampleDerive.hs:26:70: warning:\n    \u2022 Both DeriveAnyClass and GeneralizedNewtypeDeriving are enabled\n      Defaulting to the DeriveAnyClass strategy for instantiating Zeros\n    \u2022 In the newtype declaration for \u2018Basis1\u2019\n   |         \n26 | newtype Basis1 = Basis1 Text deriving (Show, Read, Eq, Ord, Generic, Zeros)\n   |                                                                      ^^^^^\n\n/home/frank/Workspace8/testSome/Lib/DerivingExampleDerive.hs:26:70: warning: [-Wmissing-methods]\n    \u2022 No explicit implementation for\n        \u2018zero\u2019\n    \u2022 In the instance declaration for \u2018Zeros Basis1\u2019\n   |         \n26 | newtype Basis1 = Basis1 Text deriving (Show, Read, Eq, Ord, Generic, Zeros)\n   |                                                                      ^^^^^\n</code></pre>\n\n<p>I understand the first message (considering <a href=\"https://ryanglscott.github.io/2017/04/12/improvements-to-deriving-in-ghc-82/\" rel=\"nofollow noreferrer\">Ryan Scott's blog post on deriving strategies</a> but not the second. </p>\n\n<p>Should I conclude that the deriving mechanism in Haskell cannot derive constants?  I have given </p>\n\n<pre><code>instance Zeros Text where zero = (\"\"::Text)\n</code></pre>\n\n<p>and the derivation for </p>\n\n<pre><code>instance Zeros Basis1 where zero = Basis1 zero  \n</code></pre>\n\n<p>should be resulting from the strategy of <code>DeriveAnyClass</code> but is not.</p>\n"}, {"tags": ["parsing", "haskell", "monads"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520933565, "post_id": 49252351, "comment_id": 85508500, "body": "In the pseudocode, what&#39;s <code>ws</code>? <code>wordsize</code>?"}, {"owner": {"reputation": 5559, "user_id": 386082, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/1CTwm.jpg?s=128&g=1", "display_name": "Oleiade", "link": "https://stackoverflow.com/users/386082/oleiade"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520937558, "post_id": 49252351, "comment_id": 85511164, "body": "It is Indeed :-)"}], "answers": [{"comments": [{"owner": {"reputation": 5559, "user_id": 386082, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/1CTwm.jpg?s=128&g=1", "display_name": "Oleiade", "link": "https://stackoverflow.com/users/386082/oleiade"}, "edited": false, "score": 0, "creation_date": 1520937774, "post_id": 49252752, "comment_id": 85511292, "body": "How have I not thought of that! Thanks a lot @luqui :-)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1520933978, "creation_date": 1520933978, "answer_id": 49252752, "question_id": 49252351, "link": "https://stackoverflow.com/questions/49252351/conditionally-binding-or-ignoring-a-value-in-do-notation/49252752#49252752", "title": "Conditionally binding or ignoring a value in do notation", "body": "<p>Another option, just leave the code as you have it, then at the end pick out the version that is relevant, i.e.</p>\n\n<pre><code>...  -- as before\nlet flags = case ws of\n                Bit32 -&gt; flags32\n                Bit64 -&gt; flags64\nreturn $ ProgramHeader st flags ...\n</code></pre>\n\n<p>(I use <code>case</code> instead of <code>if</code> because if you happen to add another case, you'll get a warning here instead of falling through to whichever branch you picked as the default)</p>\n"}], "owner": {"reputation": 5559, "user_id": 386082, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/1CTwm.jpg?s=128&g=1", "display_name": "Oleiade", "link": "https://stackoverflow.com/users/386082/oleiade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "accepted_answer_id": 49252752, "answer_count": 1, "score": 2, "last_activity_date": 1520937586, "creation_date": 1520932791, "last_edit_date": 1520937586, "question_id": 49252351, "link": "https://stackoverflow.com/questions/49252351/conditionally-binding-or-ignoring-a-value-in-do-notation", "title": "Conditionally binding or ignoring a value in do notation", "body": "<p>As a learning project I am currently trying to build a parser for the ELF file format in Haskell. Elf binary files have a section called a program header, and this header contains a word dedicated to flags. The program header contains two fields for flags: one for 64 bit flags, one for 32 bit flags, in non-sequential order.</p>\n\n<p>Like so:</p>\n\n<pre><code>data ProgramHeader =\n    ProgramHeader {\n        getSegmentType :: SegmentType\n      , get64SegmentFlags :: SegmentFlag\n      , getOffset :: Offset\n      , getVirtualAddress :: Address\n      , getPhysicalAddress :: Address\n      , getFileSize :: Size\n      , getMemorySize :: Size\n      , get32SegmentFlags :: SegmentFlag\n      , getAlignment :: Either Word32 Word64\n    }\n</code></pre>\n\n<p>And parsing looks like this:</p>\n\n<pre><code>parseProgramHeader :: WordSize -&gt; Endianness -&gt; Get Program\nparseProgramHeader wordsize en = do\n  st &lt;- parseSegmentType\n  flags64 &lt;- parseSegmentFlag\n  offset &lt;- parseVariant wordsize en\n  virtualAddress &lt;- parseVariant wordsize en\n  physicalAddress &lt;- parseVariant wordsize en\n  fileSize &lt;- parseVariant wordsize en\n  memorySize &lt;- parseVariant wordsize en\n  flags32 &lt;- parseSegmentFlag\n  a &lt;- parseVariableWord wordsize\n  return $ ProgramHeader st flags64 offset virtualAddress physicalAddress fileSize memorySize flags32 a\n</code></pre>\n\n<p>Now I'd like to be able to merge those two <code>SegmentFlag</code> fields into a single one as such:</p>\n\n<pre><code>data ProgramHeader =\n    ProgramHeader {\n        getSegmentType :: SegmentType\n      , getSegmentFlags :: SegmentFlag\n      , getOffset :: Offset\n      , getVirtualAddress :: Address\n      , getPhysicalAddress :: Address\n      , getFileSize :: Size\n      , getMemorySize :: Size\n      , getAlignment :: Either Word32 Word64\n    }\n</code></pre>\n\n<p>But, I would still need to parse the flags word twice (in each corresponding position), keeping only the relevant one. </p>\n\n<p>My intuition is that it means I need to bind the parseSegmentFlag value only for the corresponding wordsize; while still calling parseSegmentFlag if it's not the case, but discarding the value.\nIn pseudocode:</p>\n\n<pre><code>parseProgramHeader :: WordSize -&gt; Endianness -&gt; Get Program\nparseProgramHeader wordsize en = do\n  st &lt;- parseSegmentType\n  if wordsize == Bit64\n      then\n        do flags &lt;- parseSegmentFlag\n      else\n        discard $ parseSegmentFlag\n  [...]\n  if wordsize == Bit32\n    then do flags &lt;- parseSegmentFlag\n    else do discard $ parseSegmentFlag\n</code></pre>\n\n<p>Now I have absolutely no idea how I could perform that elegantly in Haskell. Any ideas? Pointers?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "cryptography", "elliptic-curve"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520929476, "post_id": 49249924, "comment_id": 85505968, "body": "What curve type are you using with <code>deriveEncrypt</code>? You almost certainly need to define your own curve type, but without concrete details it&#39;s awfully hard to say."}, {"owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520929976, "post_id": 49249924, "comment_id": 85506289, "body": "@dfeuer  <code>curve = Proxy :: Proxy Curve_X25519</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1520930695, "post_id": 49249924, "comment_id": 85506663, "body": "And finally you get to the point. But why is it in a comment? It&#39;s an essential piece of the question!"}, {"owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520942374, "post_id": 49249924, "comment_id": 85514170, "body": "Added in question"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520964215, "post_id": 49249924, "comment_id": 85529415, "body": "I&#39;ve modified my answer to match your modified question."}], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "edited": false, "score": 0, "creation_date": 1520925414, "post_id": 49250235, "comment_id": 85503924, "body": "Yeh we can do this if &#39;A&#39; is just calling &#39;B&#39; library then we can make instance of &#39;B&#39; and override it, but  if &#39;A&#39; is calling &#39;B&#39; , &#39;B&#39; is calling &#39;C&#39;, can we override instance of &#39;C&#39;  from &#39;A&#39;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "edited": false, "score": 0, "creation_date": 1520925967, "post_id": 49250235, "comment_id": 85504199, "body": "@MaheshUligade, it&#39;s really hard to come up with a concrete answer when the question is vague. Can you edit your question to explain more concretely and in more detail what you&#39;re trying to do?"}, {"owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "edited": false, "score": 0, "creation_date": 1520926242, "post_id": 49250235, "comment_id": 85504313, "body": "Sorry to be vague. Basically, I want to modify the random seed generation in <code>scalarGenerate</code> function of <code>Crypto.PubKey.ECC.P256</code> , so that will effect in <code>curveGenerateKeyPair</code>  in <code>Crypto.PubKey.ECIES</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "edited": false, "score": 0, "creation_date": 1520928718, "post_id": 49250235, "comment_id": 85505572, "body": "@MaheshUligade, that&#39;s still vague. Please improve your question instead of creating a long thread in the comments."}, {"owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "edited": false, "score": 0, "creation_date": 1520964435, "post_id": 49250235, "comment_id": 85529572, "body": "Thanks  I have done it some other way, I am upvoting your answer"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "edited": false, "score": 0, "creation_date": 1520966400, "post_id": 49250235, "comment_id": 85530621, "body": "@MaheshUligade, you should post your own answer to explain how you did it."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1520964139, "last_edit_date": 1520964139, "creation_date": 1520925146, "answer_id": 49250235, "question_id": 49249924, "link": "https://stackoverflow.com/questions/49249924/overriding-library-functions/49250235#49250235", "title": "Overriding Library Functions", "body": "<p><code>deriveEncrypt</code> uses <code>curveGenerateKeyPair</code> for the relevant curve. I don't see anything about <code>scalarGenerate</code> there. The <code>EllipticCurve</code> instance for <code>Curve_X25519</code> defines</p>\n\n<pre><code>curveGenerateKeyPair _ = do\n    s &lt;- X25519.generateSecretKey\n    return $ KeyPair (X25519.toPublic s) s\n</code></pre>\n\n<p>If you want to generate <code>X25519</code> keypairs some other way, you'll have to define your own version of the <code>Curve_X25519</code> type, copy the <code>EllipticCurve</code> and <code>EllipticCurveDH</code> instances for <code>Curve_X25519</code> type to make instances for your type, but replace the definition of <code>curveGenerateKeyPair</code> with your own.</p>\n"}], "owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520964139, "creation_date": 1520923865, "last_edit_date": 1592644375, "question_id": 49249924, "link": "https://stackoverflow.com/questions/49249924/overriding-library-functions", "title": "Overriding Library Functions", "body": "<p>I am trying to use <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/src/Crypto-PubKey-ECIES.html\" rel=\"nofollow noreferrer\">Crypto.PubKey.ECIES</a> library that call <code>curveGenerateKeyPair</code> function from <a href=\"https://hackage.haskell.org/package/cryptonite-0.21/docs/src/Crypto-ECC.html\" rel=\"nofollow noreferrer\">Crypto.ECC</a>  library and <a href=\"https://hackage.haskell.org/package/cryptonite-0.21/docs/src/Crypto-ECC.html\" rel=\"nofollow noreferrer\">Crypto.ECC</a> uses <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/src/Crypto-PubKey-ECC-P256.html\" rel=\"nofollow noreferrer\">Crypto.PubKey.ECC.P256</a> for  <code>scalarGenerate</code> function, how can i modify  this <code>scalarGenerate</code> function without modifying all those libraries?, is there any other way to do this?</p>\n<p>Basically, I want to modify <code>scalarGenerate</code> function of <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/src/Crypto-PubKey-ECC-P256.html\" rel=\"nofollow noreferrer\">Crypto.PubKey.ECC.P256</a>  library (to use randomByteString generation of <a href=\"https://hackage.haskell.org/package/raaz-0.2.0/docs/Raaz-Random.html\" rel=\"nofollow noreferrer\">Raaz</a> library),\nso that will affect the output of <code>deriveEncrypt</code> function from <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/src/Crypto-PubKey-ECIES.html\" rel=\"nofollow noreferrer\">Crypto.PubKey.ECIES</a> library</p>\n<p>I'm using curve type as <code>curve = Proxy :: Proxy Curve_X25519</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520954306, "post_id": 49248720, "comment_id": 85522821, "body": "FYI there is the function <code>findIndex</code> for that, in the <code>Data.List</code> module."}], "answers": [{"tags": [], "owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "is_accepted": false, "score": 3, "last_activity_date": 1520919060, "last_edit_date": 1520919060, "creation_date": 1520918508, "answer_id": 49248815, "question_id": 49248720, "link": "https://stackoverflow.com/questions/49248720/haskell-return-position-of-searched-item/49248815#49248815", "title": "Haskell return position of searched item", "body": "<p>Try this. If <code>0</code> is returned because element not present, I assume that it is <code>1</code> index start.</p>\n\n<pre><code>findMe x list = findMeP list 1\n  where\n    findMeP [] _ = 0\n    findMeP (y:ys) n\n      | x == y    = n\n      | otherwise = findMeP ys (n + 1)\n</code></pre>\n\n<p>As a demo, take a look at <a href=\"https://ideone.com/qDJRPm\" rel=\"nofollow noreferrer\">this</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "is_accepted": false, "score": 3, "last_activity_date": 1520947102, "last_edit_date": 1520947102, "creation_date": 1520921160, "answer_id": 49249315, "question_id": 49248720, "link": "https://stackoverflow.com/questions/49248720/haskell-return-position-of-searched-item/49249315#49249315", "title": "Haskell return position of searched item", "body": "<p>Although the previous answer is correct, here is a solution that I'd prefer since it makes use of basic building blocks from the base library and avoids explicit recursion.</p>\n\n<pre><code>import Data.List (find) {- for find :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a -}\n\nfindMe :: Eq a =&gt; a -&gt; [a] -&gt; Maybe (Int, a)\nfindMe x = find ((== x).snd) . zip [1..]\n</code></pre>\n\n<p>The function returns both the element and its index, counting from <strong>zero</strong>, wrapped in a <code>Maybe</code> type. If the element is not found, <code>Nothing</code> is returned. </p>\n\n<p>To extract the element or the index alone one can map the <code>fst</code> and <code>snd</code> functions over the <code>Maybe</code> result:</p>\n\n<pre><code>findMeIndex = fmap fst . findMe\nfindMeElem  = fmap snd . findMe\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>findMe 'c' ['a','b','c','d'] == Just (2,'c')\nfindMe 'z' ['a','b','c','d'] == Nothing\n\nfindMeIndex 'c' ['a','b','c','d'] == Just 2\nfindMeIndex 'z' ['a','b','c','d'] == Nothing\n</code></pre>\n\n<p>If you need to start counting from <code>1</code>, you can replace <code>[0..]</code> with <code>[1..]</code>. In either case, wrapping the result in a <code>Maybe</code> is preferred to returning some special value signaling the absence of the element (say <code>-1</code> or <code>0</code>), because then the user cannot ever mistake to interpret your result. For example, if you count from <code>1</code> and return <code>0</code> on failure, and someone uses your function erroneously thinking that you count from <code>0</code>, they may interpret a failure as if the element was found at the first position. Here instead, the user is forced to handle the failure case explicitly.</p>\n\n<p>The function works as follows. <code>zip [0..]</code> produces a list of pairs coupling each element with its index, starting from zero (<code>[0..]</code> is the infinite list <code>[0,1,2,3,..]</code>). Then, <code>find</code> scans the list (in exactly the same way as OP's original code), returning the first element for which the function <code>((== x).snd)</code> returns <code>True</code>, wrapped in a <code>Maybe</code> type, if found, or <code>Nothing</code> otherwise. Which element does <code>find</code> look for? Remember that <code>find</code> is fed with a list of <em>pairs</em>. So by composing the <code>snd</code> function with <code>(== x)</code> we find the pair whose second component is equal to <code>x</code></p>\n"}], "owner": {"reputation": 109, "user_id": 9483263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6b32a3928438fb127d3fda119065bff?s=128&d=identicon&r=PG&f=1", "display_name": "R.N", "link": "https://stackoverflow.com/users/9483263/r-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1520947102, "creation_date": 1520917962, "question_id": 49248720, "link": "https://stackoverflow.com/questions/49248720/haskell-return-position-of-searched-item", "title": "Haskell return position of searched item", "body": "<p>I have the following Haskell code, which returns the an instance of the requested element from the list (just the first instance) or returns 0 if the element is not present. I am trying to return the position of the element in the list instead but don't know how to (I am very new to programming).</p>\n\n<p>e.g. 'm' 'some' is returning m but I want it to return 3.</p>\n\n<pre><code>findMe x [] = 0\nfindMe x (y:ys) = if x == y\n                        then x\n                        else findMe x ys\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1520918079, "post_id": 49248575, "comment_id": 85500911, "body": "<code>[[a]]</code> is a pattern that matches a singleton list that contains a singleton list. You probably meant to just use <code>a</code> (without any brackets). Similarly, <code>[x]</code> is a pattern that matches a list with only one element (and that element is named <code>x</code>). <code>max_num</code> is missing a pattern that matches the empty list."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1520919096, "post_id": 49248575, "comment_id": 85501230, "body": "On the issue @4castle mentions, see also <a href=\"https://stackoverflow.com/q/48884276/2751851\"><i>Why doesn&#39;t this function work if I use &quot;&#91;xs&#93;&quot; instead of &quot;xs&quot;?</i></a>"}, {"owner": {"reputation": 43, "user_id": 9357905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e443db6b297cd131954d234484878af3?s=128&d=identicon&r=PG&f=1", "display_name": "xnv23", "link": "https://stackoverflow.com/users/9357905/xnv23"}, "edited": false, "score": 0, "creation_date": 1520920254, "post_id": 49248575, "comment_id": 85501644, "body": "oh thanks for that. I wasn&#39;t aware when reading through the documentation and patterns. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9357905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e443db6b297cd131954d234484878af3?s=128&d=identicon&r=PG&f=1", "display_name": "xnv23", "link": "https://stackoverflow.com/users/9357905/xnv23"}, "edited": false, "score": 0, "creation_date": 1520920390, "post_id": 49248711, "comment_id": 85501688, "body": "is there any way to write a general maximum by function using fold/recursion?"}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "reply_to_user": {"reputation": 43, "user_id": 9357905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e443db6b297cd131954d234484878af3?s=128&d=identicon&r=PG&f=1", "display_name": "xnv23", "link": "https://stackoverflow.com/users/9357905/xnv23"}, "edited": false, "score": 0, "creation_date": 1520921902, "post_id": 49248711, "comment_id": 85502291, "body": "@xnv23 <code>maximumBy fun (l:ls) = foldl (\\x y-&gt; if fun x &lt; fun y then y else x ) l ls</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520931310, "post_id": 49248711, "comment_id": 85507038, "body": "I think you got the imported function a bit wrong. The type is <code>maximumBy :: (a -&gt; b) -&gt; [a] -&gt; a</code>, so perhaps the answer should be updated w.r.t. this signature?"}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520943694, "post_id": 49248711, "comment_id": 85515052, "body": "@WillemVanOnsem That looks fine to me. if <code>:t [[1,2],[3,6],[10,34,5]]  :: [a]</code> then <code>:t [10,34,5] :: a</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 3, "creation_date": 1520944768, "post_id": 49248711, "comment_id": 85515828, "body": "@rjpj1998: sorry, I meant that the type is <i>not</i> that one, but <code>maximumBy :: Foldable t =&gt; (a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a</code>, and that <code>sum</code> does not match with <code>a -&gt;  a -&gt; Ordering</code>."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520972258, "post_id": 49248711, "comment_id": 85533668, "body": "@WillemVanOnsem fixed."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 7, "last_activity_date": 1520972250, "last_edit_date": 1520972250, "creation_date": 1520917874, "answer_id": 49248711, "question_id": 49248575, "link": "https://stackoverflow.com/questions/49248575/finding-max-list-within-a-list/49248711#49248711", "title": "Finding max list within a list", "body": "<p>There is a function in <code>Data.List</code> called <code>maximumBy</code> with the signature</p>\n\n<pre><code>maximumBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; a\n</code></pre>\n\n<p>and <code>Data.Function</code> has <code>on</code> with the signature</p>\n\n<pre><code>on :: (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c\n</code></pre>\n\n<p>Applied with the <code>compare</code> function (<code>compare :: Ord a =&gt; a -&gt; a -&gt; Ordering</code>), we can see how this is exactly what you're looking for.</p>\n\n<pre><code>import Data.List     (maximumBy)\nimport Data.Function (on)\n\n{- for clarity:\n   compare          :: Ord a          =&gt; b -&gt; b -&gt; Ordering\n   (compare `on`)   :: Ord b          =&gt; (a -&gt; b) -&gt; a  -&gt;  a  -&gt; Ordering\n   compare `on` sum :: (Num a, Ord a) =&gt;            [a] -&gt; [a] -&gt; Ordering\n   -- well actually [a] is t a for a foldable t, but same diff -}\nresult = maximumBy (compare `on` sum) [[1,2],[3,6],[10,34,5]] \n</code></pre>\n\n<hr>\n\n<p>to implement this yourself, you could write a fold that compares each value according to its sum, recursing until the sum of <code>x</code> is greater than anything that comes before after it.</p>\n\n<pre><code>myMaximumBySum []     = [] -- degenerate case\nmyMaximumBySum [x]    = x  -- tautological case\nmyMaximumBySum (x:xs)\n  | sum x &gt; sum (myMaximumBySum xs) = x\n  | otherwise                       = myMaximumBySum xs\n\n-- or more naturally:\nmyMaximumBySum = foldr f []\n  where f x acc = if sum x &gt; sum acc then x else acc\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 9357905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e443db6b297cd131954d234484878af3?s=128&d=identicon&r=PG&f=1", "display_name": "xnv23", "link": "https://stackoverflow.com/users/9357905/xnv23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 49248711, "answer_count": 1, "score": 2, "last_activity_date": 1520972250, "creation_date": 1520917033, "question_id": 49248575, "link": "https://stackoverflow.com/questions/49248575/finding-max-list-within-a-list", "title": "Finding max list within a list", "body": "<p>I was trying to get the list with the greatest sum within a list and then return that list. But when I call the function with</p>\n\n<pre><code>max_list [[1,2],[3,6],[10,34,5]] \n</code></pre>\n\n<p>it gives me the error: </p>\n\n<pre><code>Exception: a4.hs:65:1-64: Non-exhaustive patterns in function max_list\n</code></pre>\n\n<p>This is the code:</p>\n\n<pre><code>max_num :: [Int] -&gt; Int\nmax_num [x] = x\nmax_num (x:xs) | (max_num xs) &gt; x = maxVal xs\n               | otherwise        = x\n\nmax_list :: [[Int]] -&gt; [Int]\nmax_list [[a]] = head(filter (\\x -&gt; (sum_int x) == (max_num [[a]]) [[a]])\n</code></pre>\n\n<p>My logic is as follows:\nI will</p>\n\n<ol>\n<li>Sum the elements in the sublist</li>\n<li>Compare that element to see if it equals the max-value of the list</li>\n<li>Filter out the values that do not equal the max-value </li>\n</ol>\n\n<p>Example call:</p>\n\n<pre><code>head (filter (\\x -&gt; (sum x) == 11) [[1,3],[4,7],[2,5]])\n&gt; [4,7]\n</code></pre>\n\n<p>So in that case I calculated the value 11 before hand and its sum of each element is [4, 11, 7] and it will give me the value  whose sum is equal to the max value</p>\n"}, {"tags": ["haskell", "compiler-construction", "pattern-matching", "recursive-descent"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1520925401, "post_id": 49247047, "comment_id": 85503916, "body": "My immediate instinct is that your &quot;grammar&quot; looks a bit flat. Digits and while statements are lumped together unnaturally. I&#39;d expect this to be factored out into multiple types that reflect the structure of the language somewhat more closely."}], "answers": [{"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1520909972, "post_id": 49247548, "comment_id": 85498884, "body": "You should refactor your function into a function that generates a string instead of doing IO."}, {"owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "edited": false, "score": 0, "creation_date": 1520956821, "post_id": 49247548, "comment_id": 85524728, "body": "I&#39;ll try these suggestions out. Thanks!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1520909461, "creation_date": 1520909461, "answer_id": 49247548, "question_id": 49247047, "link": "https://stackoverflow.com/questions/49247047/is-there-a-more-maintainable-way-to-process-my-datatype/49247548#49247548", "title": "Is there a more maintainable way to process my datatype?", "body": "<p>Use generic-deriving to get the name of a constructor:</p>\n\n<ul>\n<li>Derive <code>Generic</code> (from <code>GHC.Generics</code>)</li>\n<li>Call <code>conNameOf :: CSTF -&gt; String</code> (from <code>Generics.Deriving</code>)</li>\n</ul>\n\n<p>Use recursion-schemes to traverse a recursive type:</p>\n\n<ul>\n<li>Derive the base functor of a recursive type with <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable-TH.html#v:makeBaseFunctor\" rel=\"nofollow noreferrer\"><code>makeBaseFunctor</code></a>. The base functor of <code>CST</code>, called <code>CSTF</code>, is a parameterized type that has the same shape as <code>CST</code>, but where recursive occurences of <code>CST</code> are replaced with the type parameter.</li>\n<li>Learn to use <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html#v:cata\" rel=\"nofollow noreferrer\"><code>cata</code></a> (it may be a bit mind bending at the beginning). In this case we want to recursively construct an <code>IO ()</code> action from a <code>CST</code>, i.e., a function <code>CST -&gt; IO ()</code>. For that, the type of <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html#v:cata\" rel=\"nofollow noreferrer\"><code>cata</code></a> becomes <code>(CSTF (IO ()) -&gt; IO ()) -&gt; CST -&gt; IO ()</code> (with <code>t ~ CST</code> and <code>a ~ IO ()</code>), where the first argument defines the body of the resulting recursive function, and the results of recursive calls are placed in the fields of the base functor.</li>\n</ul>\n\n<p>So, if your goal is to write a recursive function <code>checkAndPrintParse</code> with one case like:</p>\n\n<pre><code>checkAndPrintParse (Program c1 c2) = do\n  putStrLn \"Parser: parseProgram\" \n  checkAndPrintParse c1\n  checkAndPrintParse c2\n</code></pre>\n\n<p><code>cata</code> will put the results of its recursive calls on <code>c1</code> and <code>c2</code> in place of those fields:</p>\n\n<pre><code>-- goal: find f such that   cata f = checkAndPrintParse\n\n-- By definition of cata\ncata f (Program c1 c2) = f (ProgramF (cata f c1) (cata f c2))\n\n-- By the goal and the definition of checkAndPrintParse\ncata f (Program c1 c2) = checkAndPrintParse (Program c1 c2) = do\n  putStrLn \"Parser: parseProgram\" \n  checkAndPrintParse c1\n  checkAndPrintParse c2\n</code></pre>\n\n<p>Therefore</p>\n\n<pre><code>f (ProgramF (cata f c1) (cata f c2)) = do\n  putStrLn \"Parser: parseProgram\"\n  cata f c1\n  cata f c2\n</code></pre>\n\n<p>abstract <code>cata f c1</code> and <code>cata f c2</code></p>\n\n<pre><code>f (ProgramF x1 x2) = do\n  putStrLn \"Parser: parserProgram\"\n  x1 &gt;&gt; x2\n</code></pre>\n\n<p>Recognize a fold (in the <code>Foldable</code> sense)</p>\n\n<pre><code>f t@(ProgramF _ _) = do\n  putStrLn \"Parser: parserProgram\"\n  sequence_ t\n</code></pre>\n\n<p>Generalize again</p>\n\n<pre><code>f t = do\n  putStrLn $ \"Parser: \" ++ conNameOf t  -- Prints \"ProgramF\" instead of \"parserProgram\"... *shrugs*\n  sequence_ t\n</code></pre>\n\n<p>That's the argument we give to <code>cata</code>.</p>\n\n<hr>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveTraversable #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport GHC.Generics\nimport Generics.Deriving (conNameOf)\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH (makeBaseFunctor)\n\ndata CST \n    = Program CST CST\n    | Block CST CST CST \n    | StatementList CST CST\n    | EmptyStatementList\n    | Statement CST\n    | PrintStatement CST CST CST CST\n    | AssignmentStatement CST CST CST\n    | VarDecl CST CST\n    | WhileStatement CST CST CST \n    | IfStatement CST CST CST \n    | Expr CST\n    | IntExpr1 CST CST CST \n    | IntExpr2 CST\n    | StringExpr CST CST CST\n    | BooleanExpr1 CST CST CST CST CST\n    | BooleanExpr2 CST \n    | Id CST\n    | CharList CST CST \n    | EmptyCharList\n    | Type CST \n    | Character CST\n    | Space CST\n    | Digit CST\n    | BoolOp CST\n    | BoolVal CST\n    | IntOp CST\n    | TermComponent Token\n    | ErrorTermComponent (Token, Int)\n    | NoInput\n    deriving Generic\n\ndata Token = Token\n\nmakeBaseFunctor ''CST\n\nderiving instance Generic (CSTF a)\n\ncheckAndPrintParse :: CST -&gt; IO ()\ncheckAndPrintParse = cata $ \\t -&gt; do\n  putStrLn $ \"Parser: \" ++ conNameOf t\n  sequence_ t\n\nmain = checkAndPrintParse $\n  Program (Block NoInput NoInput NoInput) (Id NoInput)\n</code></pre>\n\n<hr>\n\n<p>Output:</p>\n\n<pre><code>Parser: ProgramF\nParser: BlockF\nParser: NoInputF\nParser: NoInputF\nParser: NoInputF\nParser: IdF\nParser: NoInputF\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 4266946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77cf02c0d2334188714fc5ecba5a75c5?s=128&d=identicon&r=PG&f=1", "display_name": "20XX", "link": "https://stackoverflow.com/users/4266946/20xx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 49247548, "answer_count": 1, "score": 2, "last_activity_date": 1520909461, "creation_date": 1520905340, "question_id": 49247047, "link": "https://stackoverflow.com/questions/49247047/is-there-a-more-maintainable-way-to-process-my-datatype", "title": "Is there a more maintainable way to process my datatype?", "body": "<p>I have productions for a recursive-descent parser defined with the following datatype:</p>\n\n<pre><code>data CST \n    = Program CST CST\n    | Block CST CST CST \n    | StatementList CST CST\n    | EmptyStatementList\n    | Statement CST\n    | PrintStatement CST CST CST CST\n    | AssignmentStatement CST CST CST\n    | VarDecl CST CST\n    | WhileStatement CST CST CST \n    | IfStatement CST CST CST \n    | Expr CST\n    | IntExpr1 CST CST CST \n    | IntExpr2 CST\n    | StringExpr CST CST CST\n    | BooleanExpr1 CST CST CST CST CST\n    | BooleanExpr2 CST \n    | Id CST\n    | CharList CST CST \n    | EmptyCharList\n    | Type CST \n    | Character CST\n    | Space CST\n    | Digit CST\n    | BoolOp CST\n    | BoolVal CST\n    | IntOp CST\n    | TermComponent Token\n    | ErrorTermComponent (Token, Int)\n    | NoInput\n</code></pre>\n\n<p>As the datatype name implies, the datatype constructs a concrete syntax tree. I'm wondering if there is a more maintainable way to pattern match over this type. For example, to trace execution of parse calls I have the following:</p>\n\n<pre><code>checkAndPrintParse :: CST -&gt; IO ()\ncheckAndPrintParse (Program c1 c2) = do\n    putStrLn \"Parser: parseProgram\" \n    checkAndPrintParse c1\n    checkAndPrintParse c2\ncheckAndPrintParse (Block c1 c2 c3) = do\n    putStrLn \"Parser: parseBlock\"\n    checkAndPrintParse c1\n    checkAndPrintParse c2\n    checkAndPrintParse c3\ncheckAndPrintParse (StatementList c1 c2) = do\n    putStrLn \"Parser: parseStatementList\"\n    checkAndPrintParse c1\n    checkAndPrintParse c2\n</code></pre>\n\n<p>and so on. I've looked into the <code>fix</code> function/pattern, but I'm not sure if it is applicable here.</p>\n"}, {"tags": ["haskell", "haskell-streaming"], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "is_accepted": true, "score": 0, "last_activity_date": 1522611474, "creation_date": 1522611474, "answer_id": 49601954, "question_id": 49246763, "link": "https://stackoverflow.com/questions/49246763/adapting-store-decoding-for-streaming-library/49601954#49601954", "title": "Adapting Store decoding for streaming library", "body": "<p>The <code>PeekException</code> happens because <code>Store</code> uses a different format when saving messages in streaming mode, unlike <code>Binary</code>. It expects a wrapper of type <code>Message</code> around <code>Store</code> data when using <code>decodeMessageBS</code> function. <code>decodeIOPortionWith</code> doesn't expect <code>Message</code> wrapper  and so, works fine with saved down <code>Store</code> data. After I fixed the serialization to save down the data as <code>Message</code> encoding, <code>decodeMessageBS</code> worked fine on that data.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 49601954, "answer_count": 1, "score": 1, "last_activity_date": 1522611474, "creation_date": 1520903268, "last_edit_date": 1521118052, "question_id": 49246763, "link": "https://stackoverflow.com/questions/49246763/adapting-store-decoding-for-streaming-library", "title": "Adapting Store decoding for streaming library", "body": "<p>I am trying to adapt <a href=\"https://www.stackage.org/haddock/lts-10.9/store-0.4.3.2/Data-Store-Streaming.html\" rel=\"nofollow noreferrer\"><code>Store</code></a> encoding and decoding for <a href=\"https://www.stackage.org/haddock/lts-10.7/streaming-0.2.0.0/Streaming.html\" rel=\"nofollow noreferrer\"><code>Streaming</code></a>. <code>Store</code> already implements a  streaming <a href=\"https://www.stackage.org/haddock/lts-10.9/store-0.4.3.2/src/Data.Store.Streaming.html#conduitDecode\" rel=\"nofollow noreferrer\"><code>decode</code></a> with a function called <code>decodeMessageBS</code>.</p>\n\n<p>I tried to do a basic implementation of <code>store</code> deserialization for <code>Streaming</code> as below (without <code>bracket</code> for now to keep it simple). However, there seems to be something wrong with the logic for <code>popper</code> because <code>decodeMessageBS</code> keeps throwing <code>PeekException</code>:</p>\n\n<pre><code>{-# LANGUAGE  RankNTypes #-}\nimport Streaming.Prelude as S hiding (print,show)\nimport Data.IORef\nimport Streaming as S\nimport qualified Data.ByteString as BS (ByteString,empty,length)\nimport System.IO.ByteBuffer\nimport Data.Store\nimport Data.Store.Streaming\n\nstreamDecode :: forall a. (Store a) =&gt; ByteBuffer -&gt; Stream (Of BS.ByteString) IO () -&gt; Stream (Of a) IO ()\nstreamDecode bb inp = do\n    ref &lt;- lift $ newIORef inp \n    let popper = do\n        r &lt;- S.uncons =&lt;&lt; readIORef ref\n        case r of\n          Nothing -&gt; return Nothing \n          Just (a,rest) -&gt; writeIORef ref rest &gt;&gt; return (Just a)\n    let go = do\n          r &lt;- lift $ decodeMessageBS bb $ popper\n          lift $ print \"Decoding\"\n          case r of \n            Nothing -&gt; return ()\n            Just msg -&gt; (lift $ print \"Message found\") &gt;&gt; (S.yield . fromMessage $ msg) &gt;&gt; go\n    go \n</code></pre>\n\n<p>I can decode my test file fine with <code>decodeIOPortionWith</code> - so, the problem seems to be in the logic needed to feed <code>decodeMessageBS</code>. Will appreciate pointers on what is wrong with the logic of <code>popper</code> here.</p>\n"}, {"tags": ["haskell", "fold"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1520909781, "last_edit_date": 1520909781, "creation_date": 1520905197, "answer_id": 49247030, "question_id": 49246652, "link": "https://stackoverflow.com/questions/49246652/haskells-foldr-foldl-definitions-trip-newbie-for-foldl-actual-function-takes-f/49247030#49247030", "title": "Haskell&#39;s foldr/foldl definitions trip newbie? For foldl Actual function takes f (default case) x while for foldr function takes f x (default case)?", "body": "<p>To make things a little clearer, I will rename a couple type variables in your <code>foldl</code> signature...</p>\n\n<pre><code>foldr: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldl: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>... so that in both cases <code>a</code> stands for the type of the list elements, and <code>b</code> for that of the fold results.</p>\n\n<p>The key difference between <code>foldr</code> and <code>foldl</code> can be seen by expanding their recursive definitions. The applications of <code>f</code> in <code>foldr</code> associate to the right, and the initial value shows up to the right of the elements:</p>\n\n<pre><code>foldr f a [x,y,z] = x `f` (y `f` (z `f` a))\n</code></pre>\n\n<p>With <code>foldl</code>, it is the other way around: the association is to the left, and the initial value shows up to the left (as Silvio Mayolo emphasises in <a href=\"https://stackoverflow.com/a/49247034/2751851\">his answer</a>, that's how it has to be so that the initial value is in the innermost sub-expression):</p>\n\n<pre><code>foldl f a [x,y,z] = ((a `f` x) `f` y) `f` z\n</code></pre>\n\n<p>That explains why the list element is the first argument to the function given to <code>foldr</code>, and the second to the one given to <code>foldl</code>. (One might, of course, give <code>foldl</code> the same signature of <code>foldr</code> and then use <code>flip f</code> instead of <code>f</code> when defining it, but that would achieve nothing but confusion.)</p>\n\n<p>P.S.: Here is a good, simple example of folds with the types <code>a</code> and <code>b</code> different from each other:</p>\n\n<pre><code>foldr (:) [] -- id\nfoldl (flip (:)) [] -- reverse\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "edited": false, "score": 0, "creation_date": 1520951502, "post_id": 49247034, "comment_id": 85520690, "body": "Thanks for the detailed and, and the code breakdown. However I think your last para &quot;short ans....&quot; might not be very accurate as it is not only about consistency but also correct to ensure that a left associative function  try and pass the left value as 1st parameter (left position) while for the right associative function the value is on the right or as second parameter."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 1, "last_activity_date": 1520905209, "creation_date": 1520905209, "answer_id": 49247034, "question_id": 49246652, "link": "https://stackoverflow.com/questions/49246652/haskells-foldr-foldl-definitions-trip-newbie-for-foldl-actual-function-takes-f/49247034#49247034", "title": "Haskell&#39;s foldr/foldl definitions trip newbie? For foldl Actual function takes f (default case) x while for foldr function takes f x (default case)?", "body": "<p>A fold is a type of catamorphism, or a way of \"tearing down\" a data structure into a scalar. In our case, we \"tear down\" a list. Now, when working with a catamorphism, we need to have a case for each data constructor. Haskell lists have two data constructors.</p>\n\n<pre><code>[] :: [a]\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>That is, <code>[]</code> is a constructor which takes no arguments and produces a list (the empty list). <code>(:)</code> is a constructor which takes two arguments and makes a list, prepending the first argument onto the second. So we need to have two  cases in our fold. <code>foldr</code> is the direct example of a catamorphism.</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>The first function will be called if we encounter the <code>(:)</code> constructor. It will be passed the first element (the first argument to <code>(:)</code>) and the result of the recursive call (calling <code>foldr</code> on the second argument of <code>(:)</code>). The second argument, the \"default case\" as you call it, is for when we encounter the <code>[]</code> constructor, in which case we simply use the default value itself. So it ends up looking like this</p>\n\n<pre><code>foldr (+) 4 [1, 2, 3]\n1 + (2 + (3 + 4))\n</code></pre>\n\n<p>Now, could we have designed <code>foldl</code> the same way? Sure. <code>foldl</code> isn't (exactly) a catamorphism, but it behaves like one in spirit. In <code>foldr</code>, the default case is the innermost value; it's only used at the \"last step\" of the recursion, when we've run out of list elements. In <code>foldl</code>, we do the same thing for consistency.</p>\n\n<pre><code>foldl (+) 4 [1, 2, 3]\n((4 + 1) + 2) + 3\n</code></pre>\n\n<p>Let's break that down in more detail. <code>foldl</code> can be thought of as using an accumulator to get the answer efficiently.</p>\n\n<pre><code>foldl (+) 4 [1, 2, 3]\nfoldl (+) (4 + 1) [2, 3]\nfoldl (+) ((4 + 1) + 2) [3]\nfoldl (+) (((4 + 1) + 2) + 3) []\n-- Here, we've run out of elements, so we use the \"default\" value.\n((4 + 1) + 2) + 3\n</code></pre>\n\n<p>So I suppose the short answer to your question is that it's more consistent (and more useful), mathematically speaking, to make sure the base case is always at the innermost position in the recursive call, rather than focusing on it being on the left or the right all the time.</p>\n"}, {"tags": [], "owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "is_accepted": false, "score": 1, "last_activity_date": 1520905299, "creation_date": 1520905299, "answer_id": 49247041, "question_id": 49246652, "link": "https://stackoverflow.com/questions/49246652/haskells-foldr-foldl-definitions-trip-newbie-for-foldl-actual-function-takes-f/49247041#49247041", "title": "Haskell&#39;s foldr/foldl definitions trip newbie? For foldl Actual function takes f (default case) x while for foldr function takes f x (default case)?", "body": "<p>Consider the calls <code>foldl (+) 0 [1,2,3,4]</code> and <code>foldr (+) 0 [1,2,3,4]</code> and try to visualize what they do:</p>\n\n<pre><code>foldl (+) 0 [1,2,3,4] = ((((0 + 1) + 2) + 3) + 4)\nfoldr (+) 0 [1,2,3,4] = (0 + (1 + (2 + (3 + 4))))\n</code></pre>\n\n<p>Now, let's try to swap the arguments to the call to <code>(+)</code> in each step:</p>\n\n<pre><code>foldl (+) 0 [1,2,3,4] = (4 + (3 + (2 + (1 + 0))))\n</code></pre>\n\n<p>Note that despite the symmetry this is not the same as the previous <code>foldr</code>. We are still accumulating from the left of the list, I've just changed the order of operands. </p>\n\n<p>In this case, because addition is commutative, we get the same result, but if you try to fold over some non-commutative function, e.g. string concatenation, the result is different. Folding over <code>[\"foo\", \"bar\", \"baz\"]</code>, you would obtain <code>\"foobarbaz\"</code> or <code>\"bazbarfoo\"</code> (while a <code>foldr</code> would result in <code>\"foobarbaz\"</code> as well because string concatenation is associative).</p>\n\n<p>In other words, the two definitions as they are make the two functions have the same result for commutative and associative binary operations (like common arithmetic addition/multiplication). Swapping the arguments to the accumulating function breaks this symmetry and forces you to use <code>flip</code> to recover the symmetric behavior.</p>\n"}, {"tags": [], "owner": {"reputation": 20427, "user_id": 2570261, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e71068b09fc539447a0cee3e99fc419d?s=128&d=identicon&r=PG&f=1", "display_name": "Haleemur Ali", "link": "https://stackoverflow.com/users/2570261/haleemur-ali"}, "is_accepted": false, "score": 1, "last_activity_date": 1520908824, "creation_date": 1520908824, "answer_id": 49247469, "question_id": 49246652, "link": "https://stackoverflow.com/questions/49246652/haskells-foldr-foldl-definitions-trip-newbie-for-foldl-actual-function-takes-f/49247469#49247469", "title": "Haskell&#39;s foldr/foldl definitions trip newbie? For foldl Actual function takes f (default case) x while for foldr function takes f x (default case)?", "body": "<p>The two folds yield different results due to their opposite associativity. The base value always shows up within the inner most parens. List traversal happens the same way for both folds.</p>\n\n<p>right fold with (+) using the prefix notation</p>\n\n<pre><code>foldr (+) 10 [1,2,3]\n=&gt; + 1 (+ 2 (+ 3 10))\n=&gt; + 1 (+ 2 13)\n=&gt; + 1 15\n=&gt; 16\n\nfoldl (+) 10 [1,2,3]\n=&gt; + (+ (+ 10 1) 2) 3\n=&gt; + (+ 11 2) 3\n=&gt; + 13 3\n=&gt; 16\n</code></pre>\n\n<p>both folds evaluate to the same result because <code>(+)</code> is commutative, i.e.</p>\n\n<pre><code>+ a b == + b a\n</code></pre>\n\n<p>lets see what happens when the function is not commutative, e.g. division or exponentiation</p>\n\n<pre><code>foldl (/) 1 [1, 2, 3]\n=&gt; / (/ (/ 1 1) 2) 3\n=&gt; / (/ 1 2) 3\n=&gt; / 0.5 3\n=&gt; 0.16666667\n\nfoldr (/) 1 [1, 2, 3]\n=&gt; / 1 (/ 2 (/ 3 1))\n=&gt; / 1 (/ 2 3)\n=&gt; / 1 0.666666667\n=&gt; 1.5\n</code></pre>\n\n<p>now, lets evaluate foldr with function <code>flip (/)</code></p>\n\n<pre><code>let f = flip (/)\nfoldr f 1 [1, 2, 3]\n=&gt; f 1 (f 2 (f 3 1))\n=&gt; f 1 (f 2 0.3333333)\n=&gt; f 1 0.16666667\n=&gt; 0.16666667\n</code></pre>\n\n<p>similarly, lets evaluate <code>foldl</code> with <code>f</code></p>\n\n<pre><code>foldl f 1 [1, 2, 3]\n=&gt; f (f (f 1 1) 2) 3\n=&gt; f (f 1 2) 3\n=&gt; f 2 3\n=&gt; 1.5\n</code></pre>\n\n<p>So, in this case, flipping the order of the arguments of the folding function can make left fold return the same value as a right fold and vice versa. But that is not guaranteed. Example:</p>\n\n<pre><code>foldr (^) 1 [1, 2, 3] = 1\nfoldl (^) 1 [1, 2, 3] = 1\nfoldr (flip (^)) 1 [1,2,3] = 1\nfoldl (flip (^)) 1 [1,2,3] = 9 -- this is the odd case\nfoldl (flip (^)) 1 $ reverse [1,2,3] = 1 \n-- we again get 1 when we reverse this list\n</code></pre>\n\n<p>incidentally, <code>reverse</code> is equivalent to </p>\n\n<pre><code>foldl (flip (:)) [] \n</code></pre>\n\n<p>but try defining reverse using <code>foldr</code></p>\n"}], "owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 0, "accepted_answer_id": 49247030, "answer_count": 4, "score": 2, "last_activity_date": 1520909781, "creation_date": 1520902522, "last_edit_date": 1520903710, "question_id": 49246652, "link": "https://stackoverflow.com/questions/49246652/haskells-foldr-foldl-definitions-trip-newbie-for-foldl-actual-function-takes-f", "title": "Haskell&#39;s foldr/foldl definitions trip newbie? For foldl Actual function takes f (default case) x while for foldr function takes f x (default case)?", "body": "<p>First thing, I understand (almost) fold functions. Given the function I can work out easily what will happen and how to use it. </p>\n\n<p>The question is about the way it is implemented which leads to slight difference in the function definition which took some time to understand.To make matters worse most example for folds have same type of the list and default case, which does not help in the understranding as these can be different.</p>\n\n<pre><code>Usage: \n  foldr f a xs\n  foldl f a xs\nwhere a is the default case \ndefinition:\n  foldr: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n  foldl: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a\n</code></pre>\n\n<p>In definition I understand <code>a</code> is the first variable to be passed and <code>b</code> second variable to be passed to function. </p>\n\n<p>Eventually I understood that this is happening due to the fact that when <code>f</code> finally gets evaluated in <code>foldr</code> it is implemented as <code>f x a</code> (i.e. default case is passed as second parameter). But for <code>foldl</code> it is implemented as <code>f a x</code> (i.e. default case is passed as first parameter).</p>\n\n<p>Would not the function definition be same if we had passed the default case as same (either 1st parameter in both or 2nd) in both cases? Was there any particular reason for this choice?</p>\n"}, {"tags": ["list", "haskell", "fold"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 9482540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f100d964945dc4956d7ebc702a471e7f?s=128&d=identicon&r=PG&f=1", "display_name": "anonymous", "link": "https://stackoverflow.com/users/9482540/anonymous"}, "edited": false, "score": 0, "creation_date": 1520906932, "post_id": 49246841, "comment_id": 85498140, "body": "thanks for the solution, but is there any way to include only the following concepts as I am new and still learning and exploring haskell. The following concepts include: Tuple construction &amp; component access: (), fst, snd List construction &amp; access: [], (:), head, tail, init, last, (!!), (++) Boolean operators: not, (&amp;&amp;), (||) Composition: (.) Arithmetic: (+), (-), (/), (*) Comparison: (==), (/=), (&lt;), (&lt;=), (&gt;), (&gt;=) HOFs: map, foldr, foldl"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1520907986, "post_id": 49246841, "comment_id": 85498407, "body": "That is a strangely specific list of requirements. Is this homework?"}, {"owner": {"reputation": 27, "user_id": 9482540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f100d964945dc4956d7ebc702a471e7f?s=128&d=identicon&r=PG&f=1", "display_name": "anonymous", "link": "https://stackoverflow.com/users/9482540/anonymous"}, "edited": false, "score": 0, "creation_date": 1520912693, "post_id": 49246841, "comment_id": 85499491, "body": "@ Rein Henrichs It was assigned as homework but the due date has passed, so I am trying to figure out how to solve it for my own benefit. The provided list of functions above were the only concepts that were taught in class, therefore our professor expected us to use the knowledge we had on those topics only to answer the homework questions."}], "tags": [], "owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "is_accepted": false, "score": 1, "last_activity_date": 1520903884, "creation_date": 1520903884, "answer_id": 49246841, "question_id": 49246572, "link": "https://stackoverflow.com/questions/49246572/gap-function-that-returns-the-integer-distance-between-first-appearance-of-two-e/49246841#49246841", "title": "Gap function that returns the integer distance between first appearance of two elements in a list using either foldl or foldr.(Haskell)", "body": "<p>You might <code>dropWhile</code> the list until you find the starting element and then fold from the right, starting with <code>Nothing</code>, replacing that with <code>Just 1</code> once you hit the end element, and <code>fmap</code>ing <code>+1</code> to the accumulator. In code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>gap :: Eq a =&gt; a -&gt; a -&gt; [a] -&gt; Maybe Int\ngap from to xs = case dropWhile (/= from) xs of\n                      [] -&gt; Nothing\n                      (_:rest) -&gt; gap' to rest\n\ngap' :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int\ngap' to = foldr f Nothing\n    where f x acc | x == to = Just 1\n                  | otherwise = (+1) &lt;$&gt; acc\n</code></pre>\n\n<p>The nice thing is that it works correctly if you have several occurences of the elements in your sequence:</p>\n\n<pre><code>*Main&gt; gap 3 8 $ [1..10] ++ [1..10]\nJust 5\n*Main&gt; gap 3 8 [1, 2, 3, 3, 3, 8]\nJust 3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "is_accepted": false, "score": 0, "last_activity_date": 1520930466, "creation_date": 1520930466, "answer_id": 49251627, "question_id": 49246572, "link": "https://stackoverflow.com/questions/49246572/gap-function-that-returns-the-integer-distance-between-first-appearance-of-two-e/49251627#49251627", "title": "Gap function that returns the integer distance between first appearance of two elements in a list using either foldl or foldr.(Haskell)", "body": "<p>Maybe my solution isn't nice, but it works</p>\n\n<pre><code>import Control.Monad\nimport Data.Function\nimport Data.Foldable     \n\n(...) = (.) . (.)\ngap x y = liftA2 ((guard . (&gt; 0) =&lt;&lt;) ... liftA2 (subtract `on` fst)) \n                 (find ((==x) . snd)) (find((==y) . snd)) . zip [0..]\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 9482540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f100d964945dc4956d7ebc702a471e7f?s=128&d=identicon&r=PG&f=1", "display_name": "anonymous", "link": "https://stackoverflow.com/users/9482540/anonymous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1520930466, "creation_date": 1520901833, "last_edit_date": 1520902148, "question_id": 49246572, "link": "https://stackoverflow.com/questions/49246572/gap-function-that-returns-the-integer-distance-between-first-appearance-of-two-e", "title": "Gap function that returns the integer distance between first appearance of two elements in a list using either foldl or foldr.(Haskell)", "body": "<p>the type is defined as follows:\ngap :: (Eq a) => a -> a -> [a] -> Maybe Int\nI have been stuck on this problem for more than an hour and have no idea how to approach the problem. I am aware that it requires the use of fold and am familiar with that topic.\nPlease take into consideration that either foldl or foldr must be used.\nThe output when called ought to look like this </p>\n\n<blockquote>\n  <p>gap 3 8 [1..10]\n  =Just 5</p>\n  \n  <p>gap 8 3 [1..10]\n  =Nothing</p>\n  \n  <p>gap 'h' 'l' \"hello\"\n  =Just 2</p>\n  \n  <p>gap 'h' 'z' \"hello\"\n  =Nothing</p>\n</blockquote>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1520894513, "post_id": 49243638, "comment_id": 85494896, "body": "Both <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">hoogle</a> and <a href=\"https://hayoo.fh-wedel.de/\" rel=\"nofollow noreferrer\">hayoo</a> are great for this."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 8, "last_activity_date": 1520885516, "creation_date": 1520885516, "answer_id": 49243678, "question_id": 49243638, "link": "https://stackoverflow.com/questions/49243638/look-up-type-synonyms-in-haskell/49243678#49243678", "title": "Look up type synonyms in haskell", "body": "<p>Yes, in GHCi you can use <code>:info</code>:</p>\n\n<pre><code>Prelude&gt; :info String\ntype String = [Char]    -- Defined in \u2018GHC.Base\u2019\nPrelude&gt;\n</code></pre>\n\n<p>EDIT and more examples including a non-alias example:</p>\n\n<pre><code>Prelude&gt; :info Rational\ntype Rational = GHC.Real.Ratio Integer  -- Defined in \u2018GHC.Real\u2019\nPrelude&gt; :i Double\ndata Double = GHC.Types.D# GHC.Prim.Double#\n        -- Defined in \u2018GHC.Types\u2019\n</code></pre>\n"}], "owner": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 49243678, "answer_count": 1, "score": 5, "last_activity_date": 1520885516, "creation_date": 1520885299, "question_id": 49243638, "link": "https://stackoverflow.com/questions/49243638/look-up-type-synonyms-in-haskell", "title": "Look up type synonyms in haskell", "body": "<p>Is there a way to look up what type synonyms actually mean? Is there perhaps some GHCi command that I can use to see if a given type is a synonym of something else?</p>\n"}, {"tags": ["haskell", "wreq"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1520880281, "creation_date": 1520880281, "answer_id": 49242432, "question_id": 49241978, "link": "https://stackoverflow.com/questions/49241978/how-do-i-set-the-http-request-body-with-wreq/49242432#49242432", "title": "How do I set the HTTP request body with Wreq?", "body": "<p>Use <a href=\"https://hackage.haskell.org/package/wreq-0.5.2.1/docs/Network-Wreq.html#v:customPayloadMethod\" rel=\"nofollow noreferrer\"><code>customPayloadMethod</code></a> to specify a custom method on a request with a postable body.</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>customPayloadMethod :: Postable a =&gt; String -&gt; String -&gt; a -&gt; IO (Response ByteString)\n</code></pre>\n\n<p>There are a few other variations of this depending on your needs:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>customPayloadMethodWith :: Postable a =&gt; String -&gt; Options -&gt; String -&gt; a -&gt; IO (Response ByteString) Source#\ncustomHistoriedPayloadMethod :: Postable a =&gt; String -&gt; String -&gt; a -&gt; IO (HistoriedResponse ByteString) Source#\ncustomHistoriedPayloadMethodWith :: Postable a =&gt; String -&gt; Options -&gt; String -&gt; a -&gt; IO (HistoriedResponse ByteString)\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 49242432, "answer_count": 1, "score": 1, "last_activity_date": 1520880281, "creation_date": 1520878683, "question_id": 49241978, "link": "https://stackoverflow.com/questions/49241978/how-do-i-set-the-http-request-body-with-wreq", "title": "How do I set the HTTP request body with Wreq?", "body": "<p>How can I set the request body when using <code>customMethod</code> <a href=\"https://hackage.haskell.org/package/wreq-0.5.2.1/docs/Network-Wreq.html#v:customMethod\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/wreq-0.5.2.1/docs/Network-Wreq.html#v:customMethod</a>?</p>\n\n<p><code>post</code>, <code>put</code> etc accept a parameter for the body, however there is no such parameter for <code>customMethod</code>.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1520867518, "post_id": 49238443, "comment_id": 85480463, "body": "Yes, using recursion to replace a for loop is a right direction to move into."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 4, "creation_date": 1520867537, "post_id": 49238443, "comment_id": 85480477, "body": "This function doesn&#39;t take two arguments, it returns two results. Any value passed in to <code>*perim1</code> or <code>*perim2</code> is obliderated when they are set to <code>0.0</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1520868338, "post_id": 49238443, "comment_id": 85481058, "body": "By passing and updating a tuple in the recursion."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520868967, "post_id": 49238443, "comment_id": 85481536, "body": "Here&#39;s an attempt at a describing how to rewrite a <code>for</code> loop with recursion (F# code): <a href=\"http://blog.ploeh.dk/2015/12/01/recurse\" rel=\"nofollow noreferrer\">blog.ploeh.dk/2015/12/01/recurse</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1520870543, "post_id": 49238443, "comment_id": 85482773, "body": "I&#39;d start from something like <code>zip polycake (drop 1 polycake)</code> and loop over that using some fold. Perhaps also use <code>cycle polycake</code> to make the access circular, and <code>take v</code> to stop the iteration."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1520879969, "post_id": 49238443, "comment_id": 85488250, "body": "What is this supposed to calculate? The perimeter of some polygon? Where did you got this from?"}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 7452686, "user_type": "registered", "profile_image": "https://graph.facebook.com/1404472329603931/picture?type=large", "display_name": "Jake McLaughlin", "link": "https://stackoverflow.com/users/7452686/jake-mclaughlin"}, "edited": false, "score": 0, "creation_date": 1520875185, "post_id": 49239772, "comment_id": 85485675, "body": "thanks for the detailed answer! It&#39;s been tough trying to switch my mode of thinking from the mutable world of C based languages to functional thinking, this helps a lot!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 9, "last_activity_date": 1520872397, "last_edit_date": 1520872397, "creation_date": 1520871055, "answer_id": 49239772, "question_id": 49238443, "link": "https://stackoverflow.com/questions/49238443/translating-c-function-with-a-loop-to-haskell/49239772#49239772", "title": "Translating C function with a loop to Haskell", "body": "<p>It might be a good idea to <em>not</em> translate it straight to Haskell but rather first to C++, which already allows to you structure it in a much more functional way.</p>\n\n<p>First thing, as Cirdec commented, this function doesn't really take <code>perim1</code> as arguments \u2013 those are \u201coutput arguments\u201d as Fortran people would say, i.e. they're really results. Also, the <code>v</code> parameter seems to be basically just <em>length of the input array</em>. So in C++ you can reduce it to:</p>\n\n<pre><code>std::pair&lt;double, double&gt; calcPerim(std::vector &lt;point&gt; polycake, int y){\n   double perim1 = 0, perim2 = 0;\n   ...\n   return std::make_pair(perim1, perim2);\n}\n</code></pre>\n\n<p>Now, you have this mutating <code>for</code> loop. In a functional language, the general approach would be to replace that with recursion. For this, you need to make all mutable-state variables <em>function parameters</em>. That includes <code>i</code>, <code>index</code>, <code>points</code> and the <code>perim</code> accumulators (so they're back, in a way... but now as <em>input</em> arguments). You don't need <code>next</code> (which is anyways re-computed from scratch in each iteration).</p>\n\n<pre><code>std::pair&lt;double, double&gt; calcPerim_rec\n                   ( std::vector&lt;point&gt; polycake, int y\n                   , int i, int index, std::array&lt;point,2&gt; points\n                   , double perim1Acc, double perim2Acc ){\n   ...\n}\n</code></pre>\n\n<p>...to be used by</p>\n\n<pre><code>std::pair&lt;double, double&gt; calcPerim(std::vector&lt;point&gt; polycake, int y){\n   return calcPerim_rec(polycake, y, 0, 0, {}, 0, 0);\n}\n</code></pre>\n\n<p>The recursive function looks very similar to your original loop body; you just need to phrase the end condition:</p>\n\n<pre><code>std::pair&lt;double, double&gt; calcPerim_rec\n                   ( std::vector&lt;point&gt; polycake, int y\n                   , int i, int index, std::array&lt;point,2&gt; points\n                   , double perim1Acc, double perim2Acc ){\n    if (i &lt; polycake.length()) {\n        int next = (i + 1) % polycake.length();\n        if(polycake[i].y &lt; y &amp;&amp; polycake[next].y &lt; y)\n            perim1Acc += distance(polycake[i], polycake[next]);\n        else if(polycake[i].y &gt; y &amp;&amp; polycake[next].y &gt; y)\n            perim2Acc += distance(polycake[i], polycake[next]);\n        else\n        {\n            points[index] = intersectPoint(polycake[i], polycake[next], y);\n            if(polycake[i].y &lt; y)\n            {\n                perim1Acc += distance(polycake[i], points[index]);\n                perim2Acc += distance(polycake[next],points[index]);\n            }\n            else\n            {\n                perim2Acc += distance(polycake[i], points[index]);\n                perim1Acc += distance(polycake[next],points[index]);\n            }\n            ++index;\n        }\n        ++i;\n        return calcPerim_rec\n                 ( polycake, y, i, index, points, perim1Acc, perim2Acc );\n    } else {\n       perim1Acc += distance(points[0], points[1]);\n       perim2Acc += distance(points[0], points[1]);\n       return std::make_pair(perim1Acc, perim2Acc);\n    }\n}\n</code></pre>\n\n<p>There's still quite a bit of mutability going on, but we've already encapsulated it to happen all on local variables of the recursion function call, instead of variables lying around during the loop execution. And each of these variables is only updated <em>once</em>, followed by the recursive call, so you can just skip the mutation and simply pass a value plus update to the recursive call:</p>\n\n<pre><code>std::pair&lt;double, double&gt; calcPerim_rec\n                   ( std::vector&lt;point&gt; polycake, int y\n                   , int i, int index, std::array&lt;point,2&gt; points\n                   , double perim1Acc, double perim2Acc ){\n    if (i &lt; polycake.length()) {\n        int next = (i + 1) % polycake.length();\n        if(polycake[i].y &lt; y &amp;&amp; polycake[next].y &lt; y)\n            return calcPerim_rec\n             ( polycake, y, i+1, index, points\n             , perim1Acc + distance(polycake[i], polycake[next])\n             , perim2Acc\n             );\n        else if(polycake[i].y &gt; y &amp;&amp; polycake[next].y &gt; y)\n            return calcPerim_rec\n             ( polycake, y, i+1, index, points\n             , perim1Acc\n             , perim2Acc + distance(polycake[i], polycake[next])\n             );\n        else\n        {\n            points[index] = intersectPoint(polycake[i], polycake[next], y);\n            if(polycake[i].y &lt; y)\n            {\n                return calcPerim_rec\n                 ( polycake, y, i+1, index+1\n                 , points\n                 , perim1Acc + distance(polycake[i], points[index])\n                 , perim2Acc + distance(polycake[next],points[index])\n                 );\n            }\n            else\n            {\n                return calcPerim_rec\n                 ( polycake, y, i+1, index+1\n                 , points\n                 , perim1Acc + distance(polycake[i], points[index])\n                 , perim2Acc + distance(polycake[next],points[index])\n                 );\n            }\n        }\n    } else {\n       return std::make_pair( perim1Acc + distance(points[0], points[1])\n                            , perim2Acc + distance(points[0], points[1]) );\n    }\n}\n</code></pre>\n\n<p>Well, quite a bit of awkward passing-on of parameters, and we still have a mutation of <code>points</code> \u2013 but essentially, the code can now be translated to Haskell.</p>\n\n<pre><code>import Data.Vector (Vector, (!), length) as V\n\ncalcPerim_rec :: Vector Point -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; [Point] -&gt; (Double, Double) -&gt; (Double, Double)\ncalcPerim_rec polycake y i index points (perim1Acc, perim2Acc)\n = if i &lt; V.length polycake\n    then\n     let next = (i + 1) `mod` V.length polycake\n     in if yCoord (polycake!i) &lt; y &amp;&amp; yCoord (polycake!next) &lt; y\n         then calcPerim_rec polycake v y (i+1) index points\n                (perim1Acc + distance (polycake!i) (polycake!next)\n                perim2Acc\n         else\n          if yCoord (polycake!i) &gt; y &amp;&amp; yCoord (polycake!next) &gt; y)\n           then calcPerim_rec polycake v y (i+1) index points\n                     perim1Acc\n                     (perim2Acc + distance (polycake!i) (polycake!next))\n           else\n            let points' = points ++ [intersectPoint (polycake!i) (polycake!next) y]\n            in if yCoord (polycake!i) &lt; y\n                then calcPerim_rec polycake v y (i+1) (index+1)\n                       points'\n                       (perim1Acc + distance (polycake!i) (points!!index))\n                       (perim2Acc + distance (polycake!next) (points!!index))\n                else calcPerim_rec polycake v y (i+1) (index+1)\n                       points'\n                       (perim1Acc + distance (polycake!i) points!!index))\n                       (perim2Acc + distance (polycake!next) points!!index))\n    else ( perim1Acc + distance (points!!0) (points!!1)\n         , perim2Acc + distance (points!!0) (points!!1) )\n</code></pre>\n\n<p>There's a lot here that could be stylistically improved, but it should in essence work.</p>\n\n<p>A good first thing to actually make it <em>idiomatic</em> is to try and get rid of indices. Indices are strongly eschewed in Haskell, and can often be avoided when you properly work with lists instead of arrays.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1520874981, "post_id": 49240752, "comment_id": 85485567, "body": "I&#39;m not sure, but perhaps <code>v</code> is meant to be (possibly) greater than <code>length ls</code>, in which case the original code cycles. So, maybe we should use <code>take v (cycle ls)</code> instead. (or <code>v+1</code> ?)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1520879483, "post_id": 49240752, "comment_id": 85487986, "body": "@thatotherguy Ah, right. I was fooled by <code>next = (i+1) % v</code>, but this is not the only index which is being used."}], "tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 3, "last_activity_date": 1523435161, "last_edit_date": 1523435161, "creation_date": 1520874141, "answer_id": 49240752, "question_id": 49238443, "link": "https://stackoverflow.com/questions/49238443/translating-c-function-with-a-loop-to-haskell/49240752#49240752", "title": "Translating C function with a loop to Haskell", "body": "<p>You can give this a try, it is a direct translation of your C algorithm to Haskell </p>\n\n<pre><code>data Point = Point {x :: Float, y :: Float}\n\n\ncalcPerim :: [Point] -&gt; Int -&gt; Int -&gt; (Float, Float)\ncalcPerim ls v some_y = \n    let (x:xs)       = take v ls\n        r            = zip (x:xs) (xs ++ [x])\n        (u, c, o, _) = foldl someFunction (0, 0, [], fromIntegral some_y :: Float) r\n        points_0     = last o\n        points_1     = o !! ((length o) - 2)\n        answer       = (u + (distance points_0 points_1), c + (distance points_0 points_1))\n    in  answer\n\n\nsomeFunction :: (Float, Float, [Point], Float) -&gt; (Point, Point) -&gt; (Float, Float, [Point], Float)\nsomeFunction (perim_1, perim_2, points, some_y) (i, nxt)\n    | y i &lt; some_y &amp;&amp; y nxt &lt; some_y    = (perim_1 + (distance i nxt), perim_2, points, some_y)\n    | y i &gt; some_y &amp;&amp; y nxt &gt; some_y    = (perim_1, perim_2 + (distance i nxt), points, some_y)\n    | y i &lt; some_y                      = (perim_1 + (distance i temp_pt), perim_2 + (distance nxt temp_pt), temp_pt:points, some_y)\n    | otherwise                         = (perim_1 + (distance nxt temp_pt), perim_2 + (distance i temp_pt), temp_pt:points, some_y)\n    where temp_pt = intersection i nxt some_y\n\n\ndistance :: Point -&gt; Point -&gt; Float\ndistance p q = undefined\n\n\nintersection :: Point -&gt; Point -&gt; Float -&gt; Point\nintersection p q f = undefined\n</code></pre>\n\n<p>I didn't run it. Not sure if I used the right fold. </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1520988304, "post_id": 49254049, "comment_id": 85539607, "body": "Assuming your interpretation is correct, can&#39;t you get around the two-crossing maximum by sorting the crossings and alternating inside/outside?"}], "tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": false, "score": 3, "last_activity_date": 1520937711, "creation_date": 1520937711, "answer_id": 49254049, "question_id": 49238443, "link": "https://stackoverflow.com/questions/49238443/translating-c-function-with-a-loop-to-haskell/49254049#49254049", "title": "Translating C function with a loop to Haskell", "body": "<p>It's rarely a good idea to first write a C version and then try to translate it to Haskell. </p>\n\n<p>Instead, consider what you're trying to do, rather than how you're trying to do it. </p>\n\n<p>It appears that given a series of point representing a polygon\nand a horizontal line at height <code>y</code>, you want to divide it into two polygons at line <code>y</code> and return the perimeter of both. The algorithm assumes the polygon is convex on the vertical axis:</p>\n\n<p><a href=\"https://i.stack.imgur.com/zgtwH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zgtwH.png\" alt=\"A polygon split by a horizontal line\"></a></p>\n\n<p>You're doing this by:</p>\n\n<ol>\n<li>Dividing the segments into those entirely over and entirely under <code>y</code></li>\n<li>Segments that cross <code>y</code> are split into two parts, the one above and the one below <code>y</code>, indicated by red dots.</li>\n<li>Adding the intersection line between the two split points (cyan) to both polygons.</li>\n</ol>\n\n<p>We can just implement that logic directly, rather than trying to emulate the iterative approach. Here's an example:</p>\n\n<pre><code>type Length = Double\ntype Point = (Double, Double)\ntype Segment = (Point, Point)\n\n-- Check whether a segment is over, under or on the line given by y\nsegmentCompare :: Double -&gt; Segment -&gt; Ordering\nsegmentCompare y (p,q) =                                                                          \n    case () of                                                                                        \n        _ | all (`isUnder` y) [p,q] -&gt; LT\n        _ | all (`isOver` y)  [p,q] -&gt; GT\n        _ -&gt; EQ\n\n-- Partition a list into (lt, eq, gt) based on f\npartition3 :: (Segment -&gt; Ordering) -&gt; [Segment] -&gt; ([Segment], [Segment], [Segment])\npartition3 f = p' ([], [], [])\n  where\n    p' (lt, eq, gt) (x:xs) =\n        case f x of\n            LT -&gt; p' (x:lt, eq, gt) xs\n            EQ -&gt; p' (lt, x:eq, gt) xs\n            GT -&gt; p' (lt, eq, x:gt) xs\n    p' result [] = result\n\n-- Split a crossing segment into an under part and over part, and return middle\ndivvy :: Double -&gt; Segment -&gt; (Segment, Segment, Point)\ndivvy y (start, end) =\n    if start `isUnder` y\n    then ((start, middle), (middle, end), middle)\n    else ((middle, end), (start, middle), middle)\n  where\n    middle = intersectPoint y (start, end)\n\n-- Split a polygon in two, or Nothing if it's not convex enough\nsplitPolygon :: Double -&gt; [Point] -&gt; Maybe ([Segment], [Segment])\nsplitPolygon y list = do\n    let (under, crossing, over) = partition3 (segmentCompare y) pairs\n    case crossing of\n        -- No lines cross. Simple.\n        [] -&gt; return (under, over)\n        -- Two segments cross. Divide them up.\n        [(p1,p2),(q1,q2)] -&gt;\n            let (u1, o1, mid1) = divvy y (p1,p2)\n                (u2, o2, mid2) = divvy y (q1, q2)\n                split = (mid1, mid2) :: Segment\n            in return (split:u1:u2:under, split:o1:o2:over)\n        -- More segments cross. Algorithm doesn't work.\n        rest -&gt; fail \"Can't split polygons concave at y\"\n  where\n    pairs = zip list (drop 1 $ cycle list) :: [Segment]\n\n-- Your original function that sums the perimeter of both polygons\ncalcPerim :: Double -&gt; [Point] -&gt; Maybe (Length, Length)\ncalcPerim y list = do\n    (under, over) &lt;- (splitPolygon y list :: Maybe ([Segment], [Segment]))\n    return (sumSegments under, sumSegments over)\n\n-- Self explanatory helpers\ndistance :: Segment -&gt; Length\ndistance ((ax, ay), (bx, by)) = sqrt $ (bx-ax)^2 + (by-ay)^2\n\nintersectPoint :: Double -&gt; Segment -&gt; Point\nintersectPoint y ((px, py), (qx, qy)) =\n    let slope     = (qx-px)/(qy-py)\n        intercept = qy - slope*qx\n        x = (y - intercept)/slope\n    in\n        if slope /= 0\n        then (x,y)\n        else (px, y)\n\nsumSegments :: [Segment] -&gt; Length\nsumSegments = sum . map distance\n\nisUnder :: Point -&gt; Double -&gt; Bool\nisUnder (_, py) y = py &lt; y\nisOver (_, py) y = py &gt; y\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 7452686, "user_type": "registered", "profile_image": "https://graph.facebook.com/1404472329603931/picture?type=large", "display_name": "Jake McLaughlin", "link": "https://stackoverflow.com/users/7452686/jake-mclaughlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1523435161, "creation_date": 1520867117, "last_edit_date": 1520868448, "question_id": 49238443, "link": "https://stackoverflow.com/questions/49238443/translating-c-function-with-a-loop-to-haskell", "title": "Translating C function with a loop to Haskell", "body": "<p>I am trying to reason how to convert an imperative style program into a functional one like Haskell. </p>\n\n<p>The function is:</p>\n\n<pre><code>void calcPerim(point polycake[], int v, int y, double *perim1, double *perim2){\n    int next = 0;\n    int index = 0;\n    point points[2];\n    *perim1 = 0.0;\n    *perim2 = 0.0;\n\n    for(int i = 0; i &lt; v; i++)\n    {\n        next = (i + 1) % v;\n        if(polycake[i].y &lt; y &amp;&amp; polycake[next].y &lt; y)\n            (*perim1) += distance(polycake[i], polycake[next]);\n        else if(polycake[i].y &gt; y &amp;&amp; polycake[next].y &gt; y)\n            (*perim2) += distance(polycake[i], polycake[next]);\n        else\n        {\n            points[index] = intersectPoint(polycake[i], polycake[next], y);\n            if(polycake[i].y &lt; y)\n            {\n                (*perim1) += distance(polycake[i], points[index]);\n                (*perim2) += distance(polycake[next],points[index]);\n            }\n            else\n            {\n                (*perim2) += distance(polycake[i], points[index]);\n                (*perim1) += distance(polycake[next],points[index]);\n            }\n            index++;\n        }\n    }\n\n    (*perim1) += distance(points[0], points[1]);\n    (*perim2) += distance(points[0], points[1]);\n}\n</code></pre>\n\n<p>I am finding it difficult to understand how I can turn this into a functional approach when it is updating two variables at the same time in some cases. Would it make sense when translating this into recursion to pass in a tuple <code>(perim1, perim2)</code>?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1520864347, "post_id": 49237435, "comment_id": 85478151, "body": "A <code>Functor</code> requires that <code>World</code> should be a higher-order type (so a <code>data World a = ...</code>). That is not the case here. Furthermore what do you intend to do with <code>fmap f snake</code>, <code>fmap</code> over the snake?"}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520864377, "post_id": 49237435, "comment_id": 85478172, "body": "Yes I want to fmap over the snake"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1520864425, "post_id": 49237435, "comment_id": 85478224, "body": "but as said, this only works if <code>World</code> is a higher-order type (the kind should be <code>* -&gt; *</code>)."}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520864824, "post_id": 49237435, "comment_id": 85478525, "body": "does a monad works as well only if world is a higher order type ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1520864868, "post_id": 49237435, "comment_id": 85478562, "body": "yes, <code>Functor</code>, <code>Monad</code>, and <code>Applicative</code>."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "edited": false, "score": 0, "creation_date": 1520954370, "post_id": 49237693, "comment_id": 85522864, "body": "Thank you very much! Can you give me an example of how could I use <b>Applicative</b> and <b>Monad</b> on the data World a? I&#39;m trying to play with it so I could figure out how it works"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1520864917, "creation_date": 1520864917, "answer_id": 49237693, "question_id": 49237435, "link": "https://stackoverflow.com/questions/49237435/using-functor-in-haskell/49237693#49237693", "title": "Using functor in haskell", "body": "<p>If we inspect the <code>Functor</code> type class, we see:</p>\n\n<pre><code>class Functor (f <b>:: * -&gt; *</b>) where\n  fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n  (&lt;$) :: a -&gt; f b -&gt; f a\n  {-# MINIMAL fmap #-}</code></pre>\n\n<p>So the <em>kind</em> of <code>f</code> should be <code>* -&gt; *</code>, a type with a type parameter. This is not the case here, so we can not declare <code>World</code> an instance of <code>Functor</code>. Since the user can use any function <code>f :: a -&gt; b</code> to map a <code>World a</code> to a <code>World b</code>, but there is no <code>World a</code> at all.</p>\n\n<p>If you still want to make it a <code>Functor</code>, we can first \"upgrade\" the <code>World</code> type such that it has a type parameter:</p>\n\n<pre><code>data World <b>a</b> = World\n    { resolution :: (Int, Int)\n    , direction :: Snake_direction\n    , snake_scale :: Int\n    , snake :: [(<b>a</b>, <b>a</b>)]\n    , isStuck :: Bool\n    , gen :: R.StdGen\n    , food :: (Int, Int)\n    , superFood :: (Int, Int)\n    } deriving (Read, Show)</code></pre>\n\n<p>then we can define an <code>fmap</code> as follows:</p>\n\n<pre><code>instance Functor World where\n    <b>fmap f w = w {snake = fmap (\\(x,y) -> (f x, f y)) (snake w)}</b></code></pre>\n\n<p>or if you want to <code>fmap</code> over the <code>snake</code> directly, and not over the <em>coordinates</em> of the <code>snake</code>:</p>\n\n<pre><code>data World <b>a</b> = World\n    { resolution :: (Int, Int)\n    , direction :: Snake_direction\n    , snake_scale :: Int\n    , snake :: <b>a</b>\n    , isStuck :: Bool\n    , gen :: R.StdGen\n    , food :: (Int, Int)\n    , superFood :: (Int, Int)\n    } deriving (Read, Show)</code></pre>\n\n<p>then we can define an <code>fmap</code> as follows:</p>\n\n<pre><code>instance Functor World where\n    fmap f w = w {snake = <b>f (snake w)</b>}</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1520882355, "post_id": 49238889, "comment_id": 85489573, "body": "This is the natural solution here. It doesn&#39;t sound like World is a real functor, you just want to map over one of its members."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1520901559, "post_id": 49238889, "comment_id": 85496807, "body": "Might also be worth mentioning that this is a special case of an <i>optic</i>, and as such can be generated automatically by a lens library."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520946653, "post_id": 49238889, "comment_id": 85517107, "body": "I suspected that was the case, but I don&#39;t really know enough about them yet to articulate it as such."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 11, "last_activity_date": 1520868517, "creation_date": 1520868517, "answer_id": 49238889, "question_id": 49237435, "link": "https://stackoverflow.com/questions/49237435/using-functor-in-haskell/49238889#49238889", "title": "Using functor in haskell", "body": "<p>Another option is to <em>not</em> make <code>World</code> a functor, since all you really want is a way to map a function over one piece of a <code>World</code> value.</p>\n\n<pre><code>snakeMap :: ((Int, Int) -&gt; (Int, Int)) -&gt; World -&gt; World\nsnakeMap f w = w { snake = fmap f (snake w) }\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 49237693, "answer_count": 2, "score": 1, "last_activity_date": 1573920626, "creation_date": 1520864157, "last_edit_date": 1573920626, "question_id": 49237435, "link": "https://stackoverflow.com/questions/49237435/using-functor-in-haskell", "title": "Using functor in haskell", "body": "<p>I've a World datatype that is defined this way: </p>\n\n<pre><code>     data World = World\n    { resolution :: (Int, Int)\n    , direction :: Snake_direction\n    , snake_scale :: Int\n    , snake :: [(Int, Int)]\n    , isStuck :: Bool\n    , gen :: R.StdGen\n    , food :: (Int, Int)\n    , superFood :: (Int, Int)\n    } deriving (Read, Show) \n</code></pre>\n\n<p>and I want to use a functor that uses fmap over the snake list which is a paramter of the world datatype. I'm struggling with functor syntax</p>\n\n<pre><code>instance Functor (World) where\n    fmap f (World) = World {fmap f snake}\n</code></pre>\n\n<p>but the compiler says </p>\n\n<pre><code>error: parse error on input \u2018f\u2019\n</code></pre>\n"}, {"tags": ["haskell", "lambda", "fold"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6306428"}, "edited": false, "score": 1, "creation_date": 1520867662, "post_id": 49236858, "comment_id": 85480564, "body": "Thanks for the step-by-step explanation! It works perfectly!"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1520901363, "post_id": 49236858, "comment_id": 85496755, "body": "Note also that <code>(\\acc t -&gt; crossCopyPaste t acc)</code> is more simply written as <code>(flip crossCopyPaste)</code>; or you could redefine <code>crossCopyPaste</code> to take its arguments in the other order so that the flip is unnecessary."}], "tags": [], "owner": {"reputation": 853, "user_id": 3645112, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QFHGj.jpg?s=128&g=1", "display_name": "Rainbacon", "link": "https://stackoverflow.com/users/3645112/rainbacon"}, "is_accepted": true, "score": 4, "last_activity_date": 1520864933, "last_edit_date": 1520864933, "creation_date": 1520862525, "answer_id": 49236858, "question_id": 49236390, "link": "https://stackoverflow.com/questions/49236390/properly-implementing-a-function-inside-foldls-lambda-function/49236858#49236858", "title": "Properly implementing a function inside foldl&#39;s lambda function", "body": "<p>Let's start by taking a look at the signature of your function <code>crossCopyPaste</code>. A quick check in ghci shows this</p>\n\n<pre><code>&gt; :t crossCopyPaste\ncrossCopyPaste :: Int -&gt; ([a], [a]) -&gt; ([a], [a])\n</code></pre>\n\n<p>And the signature of <code>foldl</code></p>\n\n<pre><code>&gt; :t foldl\nfoldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>So from that we can see that the function passed to <code>foldl</code> must output the same type that it is passed. Since <code>crossCopyPaste</code> outputs a value of type <code>([a], [a])</code> the folding function needs to accept a value of that type as an input (the accumulator). So your lambda needs to look something like this:</p>\n\n<pre><code>(\\(accx, accy) t -&gt; crossCopyPaste t (accx, accy))\n</code></pre>\n\n<p>Note that since we don't actually need to split the values of the tuple there's no need to pattern match on them and we can re-write the lambda as</p>\n\n<pre><code>(\\acc t -&gt; crossCopyPaste t acc)\n</code></pre>\n\n<p>Now, the initial value for the accumulator just needs to be the initial value of <code>xs</code> and <code>ys</code>. So we can put it all together like this</p>\n\n<pre><code>crossover ns xs ys = foldl (\\acc t -&gt; crossCopyPaste t acc) (xs, ys) ns\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6306428"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 49236858, "answer_count": 1, "score": 1, "last_activity_date": 1520864933, "creation_date": 1520861084, "question_id": 49236390, "link": "https://stackoverflow.com/questions/49236390/properly-implementing-a-function-inside-foldls-lambda-function", "title": "Properly implementing a function inside foldl&#39;s lambda function", "body": "<p>I'm new to haskell, trying to learn by solving some puzzles online.</p>\n\n<p>I have this function</p>\n\n<pre><code>crossCopyPaste t (as, bs) = (take t as ++ drop t bs, take t bs ++ drop t as) \n</code></pre>\n\n<p>which just takes a number <code>t</code> and a pair of lists <code>(as, bs)</code></p>\n\n<p>I have another function</p>\n\n<pre><code>crossover ns xs ys\n</code></pre>\n\n<p>which takes a list of ints <code>ns</code> and two lists <code>xs ys</code></p>\n\n<p>what I want <code>crossover</code> to do is take first element of list <code>ns</code> say <code>t'</code></p>\n\n<p>run <code>crossCopyPaste t' (xs, ys)</code>, take the result say <code>result1</code></p>\n\n<p>get the next number in the list <code>ns</code> say <code>t''</code></p>\n\n<p>and run <code>crossCopyPaste t'' (fst result1, snd result1)</code> (its result will be <code>result2</code>)</p>\n\n<p>next few would look like this</p>\n\n<pre><code>crossCopyPaste t''' (fst result2, snd result2)\n\ncrossCopyPaste t'''' (fst result3, snd result3)\n</code></pre>\n\n<p>and continuously do this until there aren't any elements left to cover in the list <code>ns</code></p>\n\n<p>So I thought of using foldl since it takes a function, starting element and a list and applys all like this </p>\n\n<pre><code>foldl (+) 0 (1:2:3:[])\n      =  foldl (+) (0 + 1)             (2:3:[])\n      =  foldl (+) ((0 + 1) + 2)       (3:[])\n      =  foldl (+) (((0 + 1) + 2) + 3) []\n      =            (((0 + 1) + 2) + 3)\n</code></pre>\n\n<p>but I don't know how I'd go about implementing it in the context I described above.</p>\n\n<hr>\n\n<p>this is the <code>crossover</code> I thought would work</p>\n\n<pre><code>crossover ns xs ys = foldl (\\acc t -&gt; crossCopyPaste t (xs, ys)) 0 ns  \n</code></pre>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 1748, "user_id": 936652, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Uwfmf.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/936652/christophe"}, "edited": false, "score": 0, "creation_date": 1520925939, "post_id": 49250197, "comment_id": 85504186, "body": "typo in the alternative: trans = scanlC (+) 0 ... I actually like the alternative better because the additional 0 is a small price to pay compared to the simplicity of the solution"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1748, "user_id": 936652, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Uwfmf.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/936652/christophe"}, "edited": false, "score": 1, "creation_date": 1520944492, "post_id": 49250197, "comment_id": 85515630, "body": "@Christophe Thanks; typo fixed. I think the main disadvantage of the alternative is that you have to change the rest of the pipeline to get the correct behaviour, while with the other solution the changes only affect the step that does the transformation you want to happen. If you need this kind of scan in multiple places, you can always define <code>scanl1C f = await &gt;&gt;= maybe (return ()) (scanl1C f)</code> and then have e.g. <code>trans = scanl1C f</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1520944114, "last_edit_date": 1520944114, "creation_date": 1520924975, "answer_id": 49250197, "question_id": 49235610, "link": "https://stackoverflow.com/questions/49235610/implementing-an-accumulating-function-using-conduit/49250197#49250197", "title": "Implementing an accumulating function using Conduit", "body": "<p><a href=\"https://hackage.haskell.org/package/conduit-1.3.0/docs/Conduit.html#v:scanlC\" rel=\"nofollow noreferrer\"><code>scanlC</code></a>, which is an \"analog of <code>scanl</code> for lists\", does almost what you want. I say \"almost\" because <code>scanlC</code> asks for and yields an initial \"seed\" value, which you don't need nor want (cf. the difference between <code>scanl</code> and <code>scanl1</code>). That being so, you will need to explicitly feed the first streamed value as the seed:</p>\n\n<pre><code>trans :: Monad m =&gt; ConduitM Int Int m ()\ntrans = await &gt;&gt;= maybe (return ()) (scanlC (+))\n</code></pre>\n\n<p>(The -- clearly inferior -- alternative would be having <code>trans = scanlC (+) 0</code> and using <code>dropC 1</code> in the next step of the pipeline to get rid of the <code>0</code>.) </p>\n"}], "owner": {"reputation": 1748, "user_id": 936652, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Uwfmf.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/936652/christophe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 2, "accepted_answer_id": 49250197, "answer_count": 1, "score": 3, "last_activity_date": 1520944114, "creation_date": 1520858785, "last_edit_date": 1520925346, "question_id": 49235610, "link": "https://stackoverflow.com/questions/49235610/implementing-an-accumulating-function-using-conduit", "title": "Implementing an accumulating function using Conduit", "body": "<p>I am exploring the possibility to use the Conduit package in order to implement complex event processing in Haskell. As an example, I would like to implement an accumulating function using Conduit.</p>\n\n<p>Starting from:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack script --resolver lts-8.12 --package conduit-combinators\n{-# LANGUAGE ExtendedDefaultRules #-}\nimport Conduit\n\ntrans :: Monad m =&gt; ConduitM Int Int m ()\ntrans = do\n    mapC (* 2)\n\nmain :: IO ()\nmain = runConduit $ yieldMany [1..10] .| trans .| mapM_C print\n</code></pre>\n\n<p>I get:</p>\n\n<blockquote>\n  <p>2 4 6 8 10 12 14 16 18 20</p>\n</blockquote>\n\n<p>How can I modify <code>trans</code> so that it yields</p>\n\n<blockquote>\n  <p>1 3 6 10 15 21 28 36 45 55</p>\n</blockquote>\n\n<p>instead?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1520852725, "post_id": 49233360, "comment_id": 85470454, "body": "<code>if condition then True else False</code> should be written as <code>condition</code>. Don&#39;t make things more complex."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1520855281, "last_edit_date": 1520855281, "creation_date": 1520852132, "answer_id": 49233497, "question_id": 49233360, "link": "https://stackoverflow.com/questions/49233360/couldnt-match-type-with-io/49233497#49233497", "title": "couldn&#39;t match type [] with IO", "body": "<pre><code>[ appendFile x y| x&lt;-filtered, y &lt;- [0..] ]\n</code></pre>\n\n<p>That's a stray list comprehension of type <code>[IO ()]</code> if <code>appendFile x y</code> was valid (it's not). You have to use <code>sequence</code> or similar:</p>\n\n<pre><code>sequence [ appendFile x y| x&lt;-filtered, y &lt;- [0..] ]\n</code></pre>\n\n<p>However, this won't work, since <code>y</code> must be a <code>String</code>, and <code>[0..]</code> is an infinite list, so you would end up with</p>\n\n<pre><code>appendFile x 0\nappendFile x 1\nappendFile x 2\nappendFile x 3\n...\n</code></pre>\n\n<p>You want something along</p>\n\n<pre><code>sequence [appendFile file (show counter) | (file, counter) &lt;- zip filtered [0..]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 406, "user_id": 1738086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44ffd4d27d01bce9b3425f88d83975a3?s=128&d=identicon&r=PG", "display_name": "Simon Courtenage", "link": "https://stackoverflow.com/users/1738086/simon-courtenage"}, "is_accepted": false, "score": 0, "last_activity_date": 1520854621, "creation_date": 1520854621, "answer_id": 49234280, "question_id": 49233360, "link": "https://stackoverflow.com/questions/49233360/couldnt-match-type-with-io/49234280#49234280", "title": "couldn&#39;t match type [] with IO", "body": "<p>In your code, <code>files</code> is a list of IO actions (<code>[IO ()]</code>), so to execute the IO actions in the list, you can simply call <code>sequence files</code>.  However, you also need to correct the list comprehension - as it stands, it will attempt to add all integers in the range <code>[0..]</code> to the end of the first file (the ranges in the list comprehension are nested from left to right, i.e,. given <code>x&lt;-A, y&lt;-B</code>, for each x, we take a y from B until B is exhausted, before taking the next x).  A better list comprehension would be</p>\n\n<pre><code>let files = [appendFile (path &lt;/&gt; x) (show y) | zip filtered [0..] ]\n</code></pre>\n\n<p>Note you also need to add the path to the beginning of the filename (I added <code>let path = \"c:\\program file\"</code> to the beginning of the main function), and you need to <code>show</code> the integer to turn it into a string for appendFile.</p>\n"}, {"tags": [], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "is_accepted": false, "score": 0, "last_activity_date": 1520854859, "creation_date": 1520854859, "answer_id": 49234368, "question_id": 49233360, "link": "https://stackoverflow.com/questions/49233360/couldnt-match-type-with-io/49234368#49234368", "title": "couldn&#39;t match type [] with IO", "body": "<pre><code>import System.IO\nimport qualified Data.ByteString.Lazy.Char8 as B\nimport Control.Applicative\nimport Data.List\nimport System.Directory\nimport System.FilePath\nimport Debug.Trace\n\ndebug = flip trace\n\nmain = do\n    let path = \"/tmp/test\"\n    files &lt;- getDirectoryContents path\n    let filtered = filter ( vmExtention ) files\n    let filteredWithIndex = zip filtered [0..]\n    sequence_ [ appendFile' (path &lt;/&gt; fp) (show i) | (fp,i) &lt;- filteredWithIndex ]\n\nappendFile' fp s =\n  -- note that the path was relative but is now fixed\n  appendFile fp s `debug` (\"filepath: \" ++ fp)\n\nvmExtention :: FilePath-&gt; Bool\nvmExtention s = \n    takeExtension s == \".vm\"\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9479016, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "n g ", "link": "https://stackoverflow.com/users/9479016/n-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1520855281, "creation_date": 1520851768, "last_edit_date": 1520852536, "question_id": 49233360, "link": "https://stackoverflow.com/questions/49233360/couldnt-match-type-with-io", "title": "couldn&#39;t match type [] with IO", "body": "<p>my program is supposed to go through all of the files in a given directory, and append a counter to the content of each file with the extension \".vm\". however, it has an error \"couldn't mach type [] with IO\" in the append.\nif anyone can help i'll be geatfull</p>\n\n<p>my code:</p>\n\n<pre><code>import System.IO\nimport qualified Data.ByteString.Lazy.Char8 as B\nimport Control.Applicative\nimport Data.List\nimport System.Directory\nimport System.FilePath\n\nmain = do\n    files &lt;- getDirectoryContents \"c:/program file\"\n    let filtered = filter ( vmExtention ) files\n    [ appendFile x y| x&lt;-filtered, y &lt;- [0..] ]\n    print filtered\n    print files\n\nvmExtention :: FilePath-&gt; Bool\nvmExtention s = \n    if ( takeExtension s )== \".vm\" then True else False\n</code></pre>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1520849124, "post_id": 49232503, "comment_id": 85468281, "body": "So that we can create instances, and thus are not forced to use the default ones. For example a function is an instance of <code>Functor</code>, but we do not necessarily want that for <code>Parser</code>."}, {"owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "edited": false, "score": 1, "creation_date": 1520850053, "post_id": 49232503, "comment_id": 85468884, "body": "It&#39;s explained <a href=\"https://wiki.haskell.org/Newtype#The_short_version\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520897254, "post_id": 49244952, "comment_id": 85495750, "body": "Definitely impossible with a type synonym. The <i>type</i> of <code>fmap</code> for the bare function is utterly wrong for parsers."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520897444, "post_id": 49244952, "comment_id": 85495805, "body": "It might or might not be worth mentioning that <code>type Parser = StateT String []</code> would actually work, but fails to enforce a potentially useful abstraction barrier."}, {"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1520930601, "post_id": 49244952, "comment_id": 85506615, "body": "Excellent explanation, Thank you."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1520891312, "creation_date": 1520891312, "answer_id": 49244952, "question_id": 49232503, "link": "https://stackoverflow.com/questions/49232503/haskell-graham-hutton-book-on-parsing-page-178-ch-13-3/49244952#49244952", "title": "Haskell: Graham Hutton Book on Parsing (page 178,CH 13.3)", "body": "<p>\"Dummy constructor\" may not be the best choice of terminology.  It's not really much like a \"dummy variable\", for example.  The text probably makes more sense if you just delete the word \"dummy\" everywhere it appears.</p>\n\n<p>The point of defining the newtype <code>Parser</code> and its associated constructor <code>P</code> is to allow type class instances to be defined for parsers in a convenient manner.</p>\n\n<p>To see how this helps, suppose you took the alternate approach of defining a type synonym using the <code>type</code> keyword:</p>\n\n<pre><code>type Parser a = String -&gt; [(a, String)]\n</code></pre>\n\n<p>This would make writing primitive parsing functions somewhat easier.  For example, the function <code>parse</code> above could be rewritten without needing to peel off the constructor:</p>\n\n<pre><code>parse :: Parser a -&gt; String -&gt; [(a,String)]\nparse p inp = p inp\n</code></pre>\n\n<p>You could even write the following!</p>\n\n<pre><code>parse :: Parser a -&gt; String -&gt; [(a,String)]\nparse = id\n</code></pre>\n\n<p>The <code>item</code> function would be much simpler, too:</p>\n\n<pre><code>item :: Parser Char\nitem [] = []\nitem (x:xs) = [(x,xs)]\n</code></pre>\n\n<p>The problem arises if you decide you want to define type class instances for parsers.  For example, a <code>Functor</code> instance is kind of nice, because it allows you to write something like:</p>\n\n<pre><code>data AST = Literal Int | ...\n\nparseInt :: Parser AST\nparseInt = Literal . read &lt;$&gt; digits\n</code></pre>\n\n<p>assuming that:</p>\n\n<pre><code>digits :: Parser String\n</code></pre>\n\n<p>is a parser that reads a string of digits.  What's happening here is that <code>Literal . read</code> is a function <code>String -&gt; AST</code>, and <code>digits</code> is a <code>Parser String</code>, so we can combine them with the operator form of fmap <code>(&lt;$&gt;)</code> to create a <code>Parser AST</code> by applying the <code>Literal . read</code> function \"under\" the <code>Parser</code> type.</p>\n\n<p>That assumes we can define a <code>Functor</code> instance for <code>Parser</code>, but there's a problem.  In standard Haskell (no extensions), instance definitions must be of the form:</p>\n\n<pre><code>instance SomeClass (T a1 a2 ... an) where ...\n</code></pre>\n\n<p>where <code>T</code> is type constructor and <code>a1..an</code> are type variables.  A type constructor is something that appears on the left-hand side of a <code>data</code> or <code>newtype</code> declaration (like <code>Int</code> or <code>Maybe</code>); but type <em>synonyms</em> defined with the <code>type</code> keyword aren't allowed.  So, we <em>can't</em> write:</p>\n\n<pre><code>instance Functor Parser where ...\n</code></pre>\n\n<p>While there are some extensions that relax the rules for defining instances, even with extensions, I believe it's impossible to define the instance we want here.  (Using <code>TypeSynonymInstances</code> and <code>FlexibleInstances</code>, we can define <code>instance Eq (Parser a)</code> if we want, but there's no way to define <code>instance Functor Parser</code>, even if we write out the definition of <code>Parser</code> explicitly.)  Even if we could, there would be horrifying problems with overlapping and orphan instances, because of the potential conflict between our instance and the built-in functor instance for general function types.</p>\n\n<p>That's why we instead define <code>Parser</code> using a <code>newtype</code> (which requires a constructor, named <code>P</code> for convenience):</p>\n\n<pre><code>newtype Parser a = P (String -&gt; [(a,String)])\n</code></pre>\n\n<p>The newtype \"contains\" our real parser, which is a value of type <code>String -&gt; [(a,String)]</code>, but by wrapping this value up into a newtype with a (data) constructor <code>P</code>, we make <code>Parser</code> a genuine <em>type</em> constructor, and instances can be defined directly:</p>\n\n<pre><code>instance Functor Parser where ...\n</code></pre>\n\n<p>The trade-off is that all the \"primitive\" functions are made more difficult to write, because they must unwrap and rewrap our \"real\" parsers by removing or adding the <code>P</code> constructor (e.g., the <code>item</code> from the book versus the <code>item</code> given earlier in my answer).</p>\n\n<p>If the only benefit was a <code>Functor</code> instance, it probably wouldn't be worth it, but we can also define <code>Applicative</code>, <code>Alternative</code>, and <code>Monad</code> instances, and these are incredibly useful for parsers.  Ultimately, defining <code>Parser</code> as a <code>newtype</code> makes primitive parser functions (the things you'd find in a parser library) harder to write but easier to use with existing type class infrastructure.  Usually, people writing parser libraries decide that the trade-off of a slightly more complex library for easier usage is worth it.</p>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1520896883, "creation_date": 1520849023, "last_edit_date": 1520896883, "question_id": 49232503, "link": "https://stackoverflow.com/questions/49232503/haskell-graham-hutton-book-on-parsing-page-178-ch-13-3", "title": "Haskell: Graham Hutton Book on Parsing (page 178,CH 13.3)", "body": "<p>Given the following Text:</p>\n\n<blockquote>\n  <p>To allow the <code>Parser</code> type to be made into instances of classes, it is first redefined using newtype, with a dummy constructor called <code>P</code>:</p>\n\n<pre><code>newtype Parser a = P (String -&gt; [(a,String)]) \n</code></pre>\n  \n  <p>A parser of this type can then be applied to an input string using a function that simply removes the dummy constructor:</p>\n\n<pre><code>parse :: Parser a -&gt; String -&gt; [(a,String)]\nparse (P p) inp = p inp \n</code></pre>\n  \n  <p>Our first parsing primitive is called item, which fails if the input string is empty, and succeeds with the first character as the result value otherwise:</p>\n\n<pre><code>item :: Parser Char\nitem = P (\\inp -&gt; case inp of [] -&gt; [] (x:xs) -&gt; [(x,xs)])\n</code></pre>\n</blockquote>\n\n<p>Question:\n Why do we need a \"dummy variable\" and how does it get used?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520848588, "post_id": 49231996, "comment_id": 85467973, "body": "Is it an ordered list?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 4, "creation_date": 1520849240, "post_id": 49231996, "comment_id": 85468349, "body": "Sort the list, find the second-largest element, and remove that element from the original list. Lots of edge cases to consider: What if the list is empty? What if it has only one element? What if it contains duplicate entries of the second-largest element? What if all the elements are the same?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1520850165, "post_id": 49231996, "comment_id": 85468956, "body": "Agreed with @MarkSeemann, many oustanding questions."}], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 1, "last_activity_date": 1520849839, "last_edit_date": 1520849839, "creation_date": 1520849098, "answer_id": 49232523, "question_id": 49231996, "link": "https://stackoverflow.com/questions/49231996/how-to-remove-second-largest-element-in-a-list-in-haskell/49232523#49232523", "title": "How to remove second largest element in a list in haskell?", "body": "<p>A possibility, surely not the best one.</p>\n\n<pre><code>import Data.Permute (rank)\n\nx = [4,2,3]\nranks = rank (length x) x -- this gives [2,0,1]; that means 3 (index 1) is the second smallest\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code> [x !! i | i &lt;- [0 .. length x -1], i /= 1]\n</code></pre>\n\n<p>Hmm.. not very cool, let me some time to think to something better please and I'll edit my post.</p>\n\n<h1>EDIT</h1>\n\n<p>Moreover my previous solution was wrong. This one should be correct, but again not the best one:</p>\n\n<pre><code>import Data.Permute (rank, elems, inverse)\n\nranks = elems $ rank (length x) x\niranks = elems $ inverse $ rank (length x) x\n\n&gt;&gt;&gt; [x !! (iranks !! i) | i &lt;- filter (/=1) ranks]\n[4,2]\n</code></pre>\n\n<p>An advantage is that this preserves the order of the list, I think.</p>\n"}, {"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520850757, "post_id": 49232606, "comment_id": 85469322, "body": "A possible problem with this solution is that we would get the  empty list if the list is constant. But the OP didn&#39;t give the precisions on such particular situations, so we can&#39;t really reply..."}, {"owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520850862, "post_id": 49232606, "comment_id": 85469388, "body": "Well that&#39;s a consequence of the problem definition. If all the duplicates of the biggest element have to be removed, an empty list is the right output in that case. It doesn&#39;t seem a &quot;problem&quot; to me."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520851123, "post_id": 49232606, "comment_id": 85469526, "body": "That&#39;s a way to see the issue, but what about the OP ? Maybe he has another idea in mind, and we dont know. That&#39;s not a criticism about your answer. I just claim we miss some &quot;parameters&quot; to provide an appropriate answer."}], "tags": [], "owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "is_accepted": false, "score": 0, "last_activity_date": 1520849400, "creation_date": 1520849400, "answer_id": 49232606, "question_id": 49231996, "link": "https://stackoverflow.com/questions/49231996/how-to-remove-second-largest-element-in-a-list-in-haskell/49232606#49232606", "title": "How to remove second largest element in a list in haskell?", "body": "<p>It was not clear if the OP is looking for the biggest (as the name <code>withoutBiggest</code> implies) or what. In this case, one solution is to combine the <code>filter :: (a-&gt;Bool) -&gt; [a] -&gt; [a]</code> and <code>maximum :: Ord a =&gt; [a] -&gt; a</code> functions from the <code>Prelude</code>.</p>\n\n<pre><code>withoutBiggest l = filter (/= maximum l) l\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "reply_to_user": {"reputation": 13, "user_id": 9478728, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6Je4n6bvwo8/AAAAAAAAAAI/AAAAAAAAAJI/Yu4dqiJ9MRE/photo.jpg?sz=128", "display_name": "MERCURY EDITS", "link": "https://stackoverflow.com/users/9478728/mercury-edits"}, "edited": false, "score": 0, "creation_date": 1521275291, "post_id": 49232761, "comment_id": 85669541, "body": "@MERCURYEDITS that&#39;s because the list is empty in <code>secondLargest</code>."}], "tags": [], "owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "is_accepted": true, "score": 1, "last_activity_date": 1520849798, "creation_date": 1520849798, "answer_id": 49232761, "question_id": 49231996, "link": "https://stackoverflow.com/questions/49231996/how-to-remove-second-largest-element-in-a-list-in-haskell/49232761#49232761", "title": "How to remove second largest element in a list in haskell?", "body": "<p>Here is a simple solution.</p>\n\n<pre><code>Prelude&gt; let list = [10,20,100,50,40,80]\nPrelude&gt; let secondLargest = maximum $ filter (/= (maximum list)) list\nPrelude&gt; let result = filter (/= secondLargest) list\nPrelude&gt; result\n[10,20,100,50,40]\nPrelude&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 1, "creation_date": 1520857435, "post_id": 49233141, "comment_id": 85473390, "body": "Isn\u2019t <code>deleteN</code> equal to <code>take</code>?"}, {"owner": {"reputation": 1099, "user_id": 4929834, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/C47BB.jpg?s=128&g=1", "display_name": "Alberto Centelles", "link": "https://stackoverflow.com/users/4929834/alberto-centelles"}, "reply_to_user": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 0, "creation_date": 1520858682, "post_id": 49233141, "comment_id": 85474201, "body": "No, <code>deleteN</code> removes an item at the nth position. <code>take</code> takes the first n elements"}], "tags": [], "owner": {"reputation": 1099, "user_id": 4929834, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/C47BB.jpg?s=128&g=1", "display_name": "Alberto Centelles", "link": "https://stackoverflow.com/users/4929834/alberto-centelles"}, "is_accepted": false, "score": 1, "last_activity_date": 1520853310, "last_edit_date": 1520853310, "creation_date": 1520851104, "answer_id": 49233141, "question_id": 49231996, "link": "https://stackoverflow.com/questions/49231996/how-to-remove-second-largest-element-in-a-list-in-haskell/49233141#49233141", "title": "How to remove second largest element in a list in haskell?", "body": "<p>Here is a solution that removes the n smallest elements from your list:</p>\n\n<pre><code>import Data.List\n\ndeleteN :: Int -&gt; [a] -&gt; [a]\ndeleteN _ []     = []\ndeleteN i (a:as)\n   | i == 0    = as\n   | otherwise = a : deleteN (i-1) as\n\nntails :: Int -&gt; [a] -&gt; [(a, Int)] -&gt; [a]\nntails 0 l _ = l\nntails n l s = ntails (n-1) (deleteN (snd $ head s) l) (tail s)\n\nremoveNSmallest :: Ord a =&gt; Int -&gt; [a] -&gt; [a]\nremoveNSmallest n l = ntails n l $ sort $ zip l [0..]\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>If you just want to remove the 2nd smallest element:</p>\n\n<pre><code>deleteN :: Int -&gt; [a] -&gt; [a]\ndeleteN _ []     = []\ndeleteN i (a:as)\n   | i == 0    = as\n   | otherwise = a : deleteN (i-1) as\n\nremove2 :: [a] -&gt; [(a, Int)] -&gt; [a]\nremove2 [] _  = []\nremove2 [a] _ = []\nremove2 l s = deleteN (snd $ head $ tail s) l\n\nremove2Smallest :: Ord a =&gt; [a] -&gt; [a]\nremove2Smallest l = remove2 l $ sort $ zip l [0..]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 0, "last_activity_date": 1520868979, "last_edit_date": 1520868979, "creation_date": 1520857245, "answer_id": 49235121, "question_id": 49231996, "link": "https://stackoverflow.com/questions/49231996/how-to-remove-second-largest-element-in-a-list-in-haskell/49235121#49235121", "title": "How to remove second largest element in a list in haskell?", "body": "<p>You can remove the biggest elements by first finding it and then filtering it:</p>\n\n<pre><code>withoutBiggest :: Ord a =&gt; [a] -&gt; [a]\nwithoutBiggest [] = []\nwithoutBiggest xs = filter (/= maximum xs) xs\n</code></pre>\n\n<p>You can then remove the second-biggest element in much the same way:</p>\n\n<pre><code>withoutSecondBiggest :: Ord a =&gt; [a] -&gt; [a]\nwithoutSecondBiggest xs =\n  case withoutBiggest xs of\n    [] -&gt; xs\n    rest -&gt; filter (/= maximum rest) xs\n</code></pre>\n\n<p>Assumptions made:</p>\n\n<ul>\n<li>You want each occurrence of the second-biggest element removed.</li>\n<li>When there is zero/one element in the list, there isn't a second element, so there isn't a second-biggest element. Having the list without an element that isn't there is equivalent to having the list.</li>\n<li>When the list contains only values equivalent to <code>maximum xs</code>, there also isn't a second-biggest element even though there may be two or more elements in total.</li>\n<li>The <code>Ord</code> type-class instance implies a total ordering. Otherwise you may have multiple maxima that are not equivalent; otherwise which one is picked as the biggest and second-biggest is not well-defined.</li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 9478728, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6Je4n6bvwo8/AAAAAAAAAAI/AAAAAAAAAJI/Yu4dqiJ9MRE/photo.jpg?sz=128", "display_name": "MERCURY EDITS", "link": "https://stackoverflow.com/users/9478728/mercury-edits"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 0, "accepted_answer_id": 49232761, "answer_count": 5, "score": 0, "last_activity_date": 1520868979, "creation_date": 1520847446, "last_edit_date": 1520847521, "question_id": 49231996, "link": "https://stackoverflow.com/questions/49231996/how-to-remove-second-largest-element-in-a-list-in-haskell", "title": "How to remove second largest element in a list in haskell?", "body": "<p>I have created a program to remove first smallest element but I dont how to do for second largest:</p>\n\n<pre><code>withoutBiggest (x:xs) =\n   withoutBiggestImpl (biggest x xs) [] (x:xs)\n     where\n       biggest :: (Ord a) =&gt; a -&gt; [a] -&gt; a\n       biggest big [] = big\n       biggest big (x:xs) =\n         if x &lt; big then\n           biggest x xs\n         else\n           biggest big xs\n       withoutBiggestImpl :: (Eq a) =&gt; a -&gt; [a] -&gt; [a] -&gt; [a]\n       withoutBiggestImpl big before (x:xs) =\n         if big == x then\n           before ++ xs\n         else\n             withoutBiggestImpl big (before ++ [x]) xs\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520858747, "post_id": 49230839, "comment_id": 85474246, "body": "FWIW, <code>(&amp;&amp;&amp;)</code> for functions is <code>liftA2 (,)</code>, using the function applicative. I don&#39;t feel it is worth it switching to that rather convoluted spelling just to avoid <code>Control.Arrow</code>, though."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520858083, "post_id": 49231397, "comment_id": 85473789, "body": "<code>(***)</code> for functions is <code>bimap</code> for tuples (sans the infixness)."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1520846759, "last_edit_date": 1520846759, "creation_date": 1520845333, "answer_id": 49231397, "question_id": 49230839, "link": "https://stackoverflow.com/questions/49230839/control-arrow-vs-data-tuple-extra/49231397#49231397", "title": "Control.Arrow vs Data.Tuple.Extra", "body": "<p>I'm not familiar with <code>Data.Tuple.Extra</code>, but from looking at the documentation, it seems to offer basically the same functionality as <code>Control.Arrow</code>. Its documentation even states:</p>\n\n<blockquote>\n  <p>Some of these functions are available in the <code>Control.Arrow</code> module</p>\n</blockquote>\n\n<p>You could easily implement the <code>dupe</code> and <code>both</code> functions using <code>Control.Arrow</code>:</p>\n\n<pre><code>dupe = id &amp;&amp;&amp; id\nboth f = first f &gt;&gt;&gt; second f\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>Prelude Control.Arrow&gt; dupe 42\n(42,42)\nPrelude Control.Arrow&gt; both (+1) (41, 1336)\n(42,1337)\n</code></pre>\n\n<p>Is there any advantage to using <code>Control.Arrow</code>? It's more general, since it's based on the <code>Arrow</code> type class, which again has its roots in category theory... Additionally, the module is included in the <code>base</code> package, so it's always available.</p>\n\n<p>Being more general, the type of <code>both</code> defined here is <code>Arrow a =&gt; a d c -&gt; a (d, d) (c, c)</code>, which means that you can use it with any <code>Arrow</code>, and not only with 'basic' functions. For instance, consider a <code>Kleisli</code> arrow.</p>\n\n<p>The <code>print</code> function in the <code>Prelude</code> has the type <code>Show a =&gt; a -&gt; IO ()</code>, and since <code>IO</code> is a <code>Monad</code>, you can make it a <code>Kleisli</code> instance, apply <code>both</code>, and run it on a pair:</p>\n\n<pre><code>Prelude Control.Arrow&gt; runKleisli (both $ Kleisli print) (42, 1337)\n42\n1337\n((),())\n</code></pre>\n\n<p>I don't know if this particular example is useful in real life, but it demonstrates that this implementation of <code>both</code> is more general.</p>\n\n<hr>\n\n<p>BTW, pairs are also <code>Bifunctor</code> instances, so you can also use <code>first</code> and <code>second</code> from <code>Data.Bifunctor</code>. You can define <code>both</code> in terms of <code>Bifunctor</code> instead:</p>\n\n<pre><code>Prelude Data.Bifunctor&gt; both f = bimap f f\nPrelude Data.Bifunctor&gt; :t both\nboth :: Bifunctor p =&gt; (a -&gt; d) -&gt; p a a -&gt; p d d\nPrelude Data.Bifunctor&gt; both (+2) (40, 1335)\n(42,1337)\nPrelude Data.Bifunctor&gt; both (*2) $ Right 21\nRight 42\nPrelude Data.Bifunctor&gt; both (*2) $ Left 8\nLeft 16\n</code></pre>\n\n<p>Notice how, since this works on any <code>Bifunctor</code>, it works on <code>Either</code> in addtion to a pair.</p>\n\n<p>You don't get <code>***</code> or <code>&amp;&amp;&amp;</code> from <code>Data.Bifunctor</code>, though...</p>\n"}, {"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520853267, "post_id": 49233666, "comment_id": 85470741, "body": "My problem with <code>Control.Arrow</code> is that I don&#39;t understand the types. E.g. <code>arr :: (b -&gt; c) -&gt; a b c</code> What does it mean, <code>a b c</code> ? That&#39;s weird to me."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 1, "creation_date": 1520853437, "post_id": 49233666, "comment_id": 85470828, "body": "Read it as <code>b `a` c</code>, which is usually simply <code>b -&gt; c</code>."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520853649, "post_id": 49233666, "comment_id": 85470946, "body": "Hmmm ok.. I&#39;ll try."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520858374, "post_id": 49233666, "comment_id": 85473983, "body": "@St&#233;phaneLaurent FWIW, I read <code>a b c</code> as <i>an <b>a</b>rrow from <b>b</b> to <b>c</i></b>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520858624, "post_id": 49233666, "comment_id": 85474155, "body": "@St&#233;phaneLaurent One way I like to spell such types (though it&#39;s not a broadly recognised convention) is <code>arr :: Arrow y =&gt; (a -&gt; b) -&gt; y a b</code>. <code>y</code> is an unusual enough letter in signatures to make it stand apart -- and it even looks a bit pointy..."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1520909213, "post_id": 49233666, "comment_id": 85498687, "body": "It would be nice to be able to give the type parameter an operator as a name: <code>arr :: Arrow (~&gt;) =&gt; (a -&gt; b) -&gt; a ~&gt; b</code>, that is: arr takes a <i>function</i> from <code>a</code> to <code>b</code> and turns it into an <i>Arrow</i> from <code>a</code> to <code>b</code>. They are arrows, after all, and should be notated as such."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1520852704, "creation_date": 1520852704, "answer_id": 49233666, "question_id": 49230839, "link": "https://stackoverflow.com/questions/49230839/control-arrow-vs-data-tuple-extra/49233666#49233666", "title": "Control.Arrow vs Data.Tuple.Extra", "body": "<p>In most Haskell use cases, it doesn't matter whether you use <code>Data.Tuple.Extra.first</code>, <code>Control.Arrow.first</code> or <code>Data.Bifunctor.first</code> \u2013 all three will be used as</p>\n\n<pre><code>first :: (b -&gt; c) -&gt; (b,d) -&gt; (c,d)\n</code></pre>\n\n<p>...and likewise for <code>second</code> / <code>***</code> / <code>&amp;&amp;&amp;</code>. Both the <code>Arrow</code> and <code>Bifunctor</code> versions are more general, in different ways, but it's often quite possible to just think of the generalisation <em>in terms of</em> the standard tuple / functor case.</p>\n\n<p>Pragmatically speaking, I'd suggest using the <code>Arrow</code> versions simply for the reason that they're in <code>base</code>. (Oh, I've just noticed <code>Bifunctor</code> is now in <code>base</code> too, so much for that...) Arguably, <code>Arrow</code> is also a better generalisation than <code>Bifunctor</code>, because it allows to actually leave the <strong>Hask</strong> category. Unfortunately, <code>Control.Arrow</code> itself doesn't really allow much more interesting categories \u2013 they largely boil down to Kleisli / Cokleisli categories (i.e. monads in different garment), and for those it's usually more practical to just stick to <code>do</code> notation etc..</p>\n\n<p>But there are many maths categories that aren't instances of <code>Control.Category.Category</code>, because they don't allow mapping between <em>any</em> Haskell types but only types with particular properties. One example is <strong>VectK</strong>, the category of vector spaces with linear mappings as morphisms. In this category, <code>.</code> is matrix multiplication, <code>***</code> is block-matrix diagonal-stacking, <code>&amp;&amp;&amp;</code> is vertical concatenation. Pretty nice IMO, in particular because it completely avoids the problems with runtime dimension checks you get in Matlab, NumPy or hmatrix \u2013 all that is already done by the compiler \u2013 and it even supports infinite-dimensional vector spaces.</p>\n\n<p>The catch, as I said, is that it only works for particular types, which the standard <code>Category</code> / <code>Arrow</code> classes can't express. It is actually quite easy to express it in Haskell though, and so I have done with the <a href=\"http://hackage.haskell.org/package/constrained-categories\" rel=\"nofollow noreferrer\"><code>constrained-categories</code> package</a>, used for implementing <strong>VectK</strong> in the <a href=\"http://hackage.haskell.org/package/linearmap-category-0.3.4.0/docs/Math-LinearMap-Category.html\" rel=\"nofollow noreferrer\"><code>linearmap-category</code> package</a>.</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1520852704, "creation_date": 1520843026, "last_edit_date": 1520845700, "question_id": 49230839, "link": "https://stackoverflow.com/questions/49230839/control-arrow-vs-data-tuple-extra", "title": "Control.Arrow vs Data.Tuple.Extra", "body": "<p>I often use the following functions of the <code>Data.Tuple.Extra</code> library: <code>first</code>, <code>second</code>, <code>***</code>, <code>&amp;&amp;&amp;</code>, and <code>both</code>.</p>\n\n<p>There are equivalent (?) functions in <code>Control.Arrow</code>. In fact I prefer <code>Data.Tuple.Extra</code> because I'm totally lost with the documentation of <code>Control.Arrow</code>. </p>\n\n<p>Is there any advantage to use <code>Control.Arrow</code> (for example from a performance perspective)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1520840744, "post_id": 49230245, "comment_id": 85463847, "body": "What would be the <i>type</i> of <code>[10,[1,2,3,4,5]]</code>?"}, {"owner": {"reputation": 655, "user_id": 2494631, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DCC31.jpg?s=128&g=1", "display_name": "vijoc", "link": "https://stackoverflow.com/users/2494631/vijoc"}, "edited": false, "score": 6, "creation_date": 1520840824, "post_id": 49230245, "comment_id": 85463882, "body": "Your question title and body have different questions: in the title you&#39;ve written a tuple <code>(Int, [Int])</code> while the body has... something else. Which are you looking for?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 5, "creation_date": 1520842337, "post_id": 49230245, "comment_id": 85464550, "body": "You can have <code>(10, [1,2,3])</code> or <code>[[10], [1,2,3]]</code>, but not <code>[10, [1,2,3]]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1520877449, "creation_date": 1520877449, "answer_id": 49241652, "question_id": 49230245, "link": "https://stackoverflow.com/questions/49230245/haskel-how-can-i-merge-an-int-and-int-into-one-int-int/49241652#49241652", "title": "Haskel: How can I merge an Int and [Int] into one (Int, [Int])?", "body": "<p>One of these may suit your needs:</p>\n\n<pre><code>(10, [1,2,3,4,5]) :: (Int, [Int])\n10 : [1,2,3,4,5] :: [Int] -- = [10,1,2,3,4,5]\n[Left 10, Right [1,2,3,4,5]] :: [Either Int [Int]]\n[[10], [1,2,3,4,5]] :: [[Int]]\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8542190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94df7875d89f82fef9a623707f97c2b9?s=128&d=identicon&r=PG&f=1", "display_name": "RobinXu", "link": "https://stackoverflow.com/users/8542190/robinxu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 49241652, "answer_count": 1, "score": 0, "last_activity_date": 1520877449, "creation_date": 1520840472, "question_id": 49230245, "link": "https://stackoverflow.com/questions/49230245/haskel-how-can-i-merge-an-int-and-int-into-one-int-int", "title": "Haskel: How can I merge an Int and [Int] into one (Int, [Int])?", "body": "<p>I am a new guy to Haskell and today I have a problem with a question.</p>\n\n<p>For example, I have an Int 10, an [Int] [1,2,3,4,5], how can I merge them together to [10,[1,2,3,4,5]]?</p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["variables", "haskell"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1520837033, "post_id": 49228652, "comment_id": 85462290, "body": "Just out of curiosity: Is there some other language you have in mind that can do this?"}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1520837401, "post_id": 49228652, "comment_id": 85462409, "body": "@ChrisMartin Maybe <a href=\"https://stackoverflow.com/questions/16348815/python-assigning-multiple-variables-to-same-value-list-behavior\">this one</a>."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1520845845, "post_id": 49228652, "comment_id": 85466329, "body": "@ChrisMartin in Python you can do <code>h = f = 5</code>."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1520883994, "post_id": 49228652, "comment_id": 85490447, "body": "@ChrisMartin In R you can even do <code>f &lt;- 5 -&gt; h</code>"}], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1520875256, "post_id": 49228900, "comment_id": 85485713, "body": "It could be mildly useful in conjunction with record wildcards, e.g. <code>origin = let x, y, z = 0 in Point{..}</code>"}], "tags": [], "owner": {"reputation": 516, "user_id": 3734057, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/j3grD.jpg?s=128&g=1", "display_name": "aeruhxi", "link": "https://stackoverflow.com/users/3734057/aeruhxi"}, "is_accepted": false, "score": 4, "last_activity_date": 1520833935, "creation_date": 1520833935, "answer_id": 49228900, "question_id": 49228652, "link": "https://stackoverflow.com/questions/49228652/assign-multiple-variables-haskell/49228900#49228900", "title": "Assign multiple variables Haskell", "body": "<p>No. And there's no reason to do so. Because variables are immutable in haskell, once some value is bound to some variable, that never changes within the scope. So, <code>h, f = 5</code> does not make sense in haskell. Just use <code>h</code> where 5 is expected; there's no need for <code>f</code></p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1520841739, "post_id": 49229033, "comment_id": 85464272, "body": "If you want to avoid the possible pattern match error if you mismatch the length of the list with the number to replicate, use <code>repeat</code> instead:  <code>let x:y:_ = repeat 5</code>.  And I, too, have never seen this idiom in the wild, and suspect it to be rather futile for reasons @absolutezero mentions."}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1520842868, "post_id": 49229033, "comment_id": 85464817, "body": "@luqui I forgot that I could use <code>repeat</code> and the feature of lazy evaluation. Thanks!"}], "tags": [], "owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "is_accepted": false, "score": 4, "last_activity_date": 1520842998, "last_edit_date": 1520842998, "creation_date": 1520834770, "answer_id": 49229033, "question_id": 49228652, "link": "https://stackoverflow.com/questions/49228652/assign-multiple-variables-haskell/49229033#49229033", "title": "Assign multiple variables Haskell", "body": "<pre><code>Prelude&gt; let [x, y] = replicate 2 5\nPrelude&gt; x\n5\nPrelude&gt; y\n5\nPrelude&gt;\n</code></pre>\n\n<p>You need <code>replicate</code> to \"duplicate\" a value. In this case, I duplicating 5 twice. <code>[x, y]</code> mean get <code>x</code> and <code>y</code> from a List. That list is <code>[5, 5]</code>. So, you got <code>x = 5</code> and <code>y = 5</code>.</p>\n\n<p>Well, I never did such behavior in the real world Haskell but you get what you want.</p>\n\n<p><strong>EDIT</strong>: We could use <code>repeat</code> function and the feature of lazy evaluation in the Haskell. Thanks to <a href=\"https://stackoverflow.com/users/33796/luqui\">luqui</a>.</p>\n\n<pre><code>Prelude&gt; let x:y:_ = repeat 5\nPrelude&gt; x\n5\nPrelude&gt; y\n5\nPrelude&gt;\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9148128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22967ef90119f07a3c7a84d93648c18?s=128&d=identicon&r=PG&f=1", "display_name": "David Contreras", "link": "https://stackoverflow.com/users/9148128/david-contreras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1520842998, "creation_date": 1520832503, "question_id": 49228652, "link": "https://stackoverflow.com/questions/49228652/assign-multiple-variables-haskell", "title": "Assign multiple variables Haskell", "body": "<p>Is there a way to assign the same value to multiple variables in Haskell?\ne.g something like this:</p>\n\n<pre><code>h,f = 5 \n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 3, "last_activity_date": 1520834589, "last_edit_date": 1520834589, "creation_date": 1520833593, "answer_id": 49228828, "question_id": 49228581, "link": "https://stackoverflow.com/questions/49228581/how-to-use-issuffixof-to-test-for-two-suffixes/49228828#49228828", "title": "how to use isSuffixOf to test for two suffixes", "body": "<p>You could use Arrows here.</p>\n\n<pre><code>import Control.Arrow\n\nf = isSuffixOf \"1\" &amp;&amp;&amp; isSuffixOf \"2\"\nresult = map (uncurry (||)) . map f $ [\"test1\", \"test2\", \"test3\", \"exam1\"]\n</code></pre>\n\n<p>or, more simply, just write a list comp.</p>\n\n<pre><code>result = [isSuffix \"1\" x || isSuffix \"2\" x | x &lt;- [\"test1\", \"test2\", \"test3\", \"exam1\"]]\n</code></pre>\n\n<p>or, even more simply, write a combinator of the two yourself.</p>\n\n<pre><code>anySuffixOf []     _ = False\nanySuffixOf (x:xs) y = isSuffixOf x y || f xs y\n\nresult = map (anySuffixOf [\"1\", \"2\"]) [\"test1\", \"test2\", \"test3\", \"exam1\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": false, "score": 5, "last_activity_date": 1520839542, "last_edit_date": 1520839542, "creation_date": 1520839044, "answer_id": 49229927, "question_id": 49228581, "link": "https://stackoverflow.com/questions/49228581/how-to-use-issuffixof-to-test-for-two-suffixes/49229927#49229927", "title": "how to use isSuffixOf to test for two suffixes", "body": "<p>You can use a lambda expression to specify the mapping function</p>\n\n<pre><code>map (\\x -&gt; isSuffixOf \"1\" x || isSuffixOf \"2\" x) [\"test1\", \"test2\", \"test3\", \"exam1\"]  \n</code></pre>\n\n<p>Alternatively you can use the <code>Applicative</code> instance of <code>(-&gt;) a</code> to build the function  </p>\n\n<pre><code>map ((||) &lt;$&gt; isSuffixOf \"1\" &lt;*&gt; isSuffixOf \"2\") [\"test1\", \"test2\", \"test3\", \"exam1\"]  \n</code></pre>\n\n<p>Or using <code>liftA2</code> (found in <code>Control.Applicative</code>)</p>\n\n<pre><code>map (liftA2 (||) (isSuffixOf \"1\") (isSuffixOf \"2\")) [\"test1\", \"test2\", \"test3\", \"exam1\"] \n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 3542837, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4749eee7d25388637be48cd5bac006aa?s=128&d=identicon&r=PG&f=1", "display_name": "user3542837", "link": "https://stackoverflow.com/users/3542837/user3542837"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "accepted_answer_id": 49228828, "answer_count": 2, "score": 0, "last_activity_date": 1520839542, "creation_date": 1520832138, "question_id": 49228581, "link": "https://stackoverflow.com/questions/49228581/how-to-use-issuffixof-to-test-for-two-suffixes", "title": "how to use isSuffixOf to test for two suffixes", "body": "<p>So I have a list of strings say [\"test1\", \"test2\", \"test3\", \"exam1\"], and I want to figure out which ones end with either \"1\" or \"2\".\nI know I can use </p>\n\n<pre><code>map (isSuffixOf \"1\") [\"test1\", \"test2\", \"test3\", \"exam1\"]\nmap (isSuffixOf \"2\") [\"test1\", \"test2\", \"test3\", \"exam1\"]\n</code></pre>\n\n<p>to get two different list of bools, but is there any way I can test both at the same time? I tried these two variations </p>\n\n<pre><code>map (isSuffixOf \"1\" || \"2\") [\"test1\", \"test2\", \"test3\", \"exam1\"]\nmap (isSuffixOf \"1\" || isSuffixOf \"2\") [\"test1\", \"test2\", \"test3\", \"exam1\"]\n</code></pre>\n\n<p>but they both gave me an error</p>\n"}, {"tags": ["string", "haskell", "split", "functional-programming"], "comments": [{"owner": {"reputation": 7450, "user_id": 2458858, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/N8Jbo.jpg?s=128&g=1", "display_name": "tryingToLearn", "link": "https://stackoverflow.com/users/2458858/tryingtolearn"}, "edited": false, "score": 1, "creation_date": 1520832077, "post_id": 49228467, "comment_id": 85460585, "body": "show us some code."}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 1, "creation_date": 1520835304, "post_id": 49228467, "comment_id": 85461650, "body": "Show us some code and its sample input and expected output."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520836550, "post_id": 49228467, "comment_id": 85462121, "body": "That&#39;s really not clear to me. Could you show us two or three examples, well formatted, with the expected inputs and outputs ?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520841144, "post_id": 49228467, "comment_id": 85464022, "body": "Thanks, that&#39;s clearer. Did you try to use successively Data.List.Split ? It is not convenient enough ?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520841476, "post_id": 49228467, "comment_id": 85464167, "body": "Just a thought. <code>splitWhen (</code>elem` [&#39;;&#39;,&#39;,&#39;]) input` gives <code>[&quot;&quot;,&quot;&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;10&quot;]</code>. Then you could remove the empty strings then."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520841984, "post_id": 49228467, "comment_id": 85464391, "body": "Or something like that <b>filter (\\x -&gt; not $ elem x [&quot;;&quot;,&quot;,&quot;,&quot;;,&quot;]) $ split (dropBlanks . condense $ whenElt (<code>elem</code> [&#39;;&#39;,&#39;,&#39;])) input</b>"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520842026, "post_id": 49228467, "comment_id": 85464413, "body": "sorry the markdown drops my backticks... that&#39;s tedious"}, {"owner": {"reputation": 55, "user_id": 5207050, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RK-EWb8XHu0/AAAAAAAAAAI/AAAAAAAABdQ/ixNldC0UAg4/photo.jpg?sz=128", "display_name": "Johan Jansen van Vuuren", "link": "https://stackoverflow.com/users/5207050/johan-jansen-van-vuuren"}, "edited": false, "score": 0, "creation_date": 1520843299, "post_id": 49228467, "comment_id": 85465044, "body": "I&#39;ve already solved this problem for when the delimiting markers are characters, i.e. length of one.  The problem is when the delimiter is of unspecified length - this gets especially tricky, because the methods in Data.List.Split assume the delimiters are characters.  <b>splitOn</b> takes a string argument - what I need is essentially a <b>splitOn</b> that takes a list of strings"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520870910, "post_id": 49228467, "comment_id": 85483008, "body": "Is there some sort of contest going on? Or is this homework? <a href=\"https://stackoverflow.com/q/49211131/126014\">stackoverflow.com/q/49211131/126014</a>"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520874683, "post_id": 49228467, "comment_id": 85485381, "body": "You can use <code>splitWhen</code> followed by any condition, this way you&#39;re not restricted to lenght one characters."}, {"owner": {"reputation": 55, "user_id": 5207050, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RK-EWb8XHu0/AAAAAAAAAAI/AAAAAAAABdQ/ixNldC0UAg4/photo.jpg?sz=128", "display_name": "Johan Jansen van Vuuren", "link": "https://stackoverflow.com/users/5207050/johan-jansen-van-vuuren"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520922736, "post_id": 49228467, "comment_id": 85502658, "body": "@mark-seemann I&#39;m attempting the coding exercise located at <a href=\"http://osherove.com/tdd-kata-1/\" rel=\"nofollow noreferrer\">codekata</a> just for practice."}], "answers": [{"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 2, "last_activity_date": 1520865988, "creation_date": 1520865988, "answer_id": 49238071, "question_id": 49228467, "link": "https://stackoverflow.com/questions/49228467/split-string-on-multiple-delimiters-of-any-length-in-haskell/49238071#49238071", "title": "Split string on multiple delimiters of any length in Haskell", "body": "<p>This problem has two kinds of solutions: the simple, and the efficient. I will not cover the efficient (because it is not simple), though I will hint on it.</p>\n\n<p>But first, the part where you extract the <code>delimiter</code> and <code>body</code> parts of the input, may be simplified with <code>Data.List.break</code>:</p>\n\n<pre><code>delims = splitOn \"/\" . fst . break (== '\\n')  -- Presuming the delimiters are delimited with\n                                              -- a slash.\nbody   =               snd . break (== '\\n')\n</code></pre>\n\n<p>In any way, we may reduce this problem to <em><strong>finding</strong></em> the positions of all the given <em><strong>patterns</strong></em> in a given <em><strong>string</strong></em>. (By saying \"string\", I do not mean the haskell <code>String</code>. Rather, I mean an arbitrarily long sequence (or even an infinite <em>stream</em>) of any <em><strong>symbols</strong></em> for which an <code>Eq</code>uality relation is defined, which is typed in Haskell as <code>Eq a =&gt; [a]</code>. I hope this is not too confusing.) As soon as we have the positions, we may slice the string to our hearts' content. If we want to deal with an infinite stream, we must obtain the positions incrementally, and yield the results as we go, which is a restriction that must be kept in mind. Haskell is equipped well enough to handle the stream case as well as the finite string.</p>\n\n<p>A <strong>simple approach</strong> is to cast <code>isPrefixOf</code> on the string, for each of the patterns.</p>\n\n<ul>\n<li>If some of them matches, we replace it with a <code>Nothing</code>.</li>\n<li>Otherwise we mark the first symbol as <code>Just</code> and move to the next position.</li>\n</ul>\n\n<p>Thus, we will have replaced all the different delimiters by a single one: <code>Nothing</code>. We may then readily slice the string by it.</p>\n\n<p>This is fairly idiomatic, and I will bring the code to your judgement shortly. The problem with this approach is that it is inefficient: in fact, if a pattern failed to match, we would rather advance by more than one symbol.</p>\n\n<p>It would be <strong>more efficient</strong> to base our work on the research that has been made into finding patterns in a string; this problem is well known and there are great, intricate algorithms that solve it an order of magnitude faster. These algorithms are designed to work with a single pattern, so some work must be put into adapting them to our case; however, I believe they are adaptable. The simplest and eldest of such algorithms is the <a href=\"https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm\" rel=\"nofollow noreferrer\">KMP</a>, and it is already <a href=\"https://github.com/CindyLinz/Haskell-KMP\" rel=\"nofollow noreferrer\">encoded</a> in Haskell. You may wish to take arms and generalize it \u2212 a quick path to some amount of fame.</p>\n\n<p>&nbsp;</p>\n\n<p>Here is the code:</p>\n\n<pre><code>module SplitSubstr where\n\n-- stackoverflow.com/questions/49228467\n\nimport Data.List (unfoldr, isPrefixOf, elemIndex)\nimport Data.List.Split (splitWhen)  -- Package `split`.\nimport Data.Maybe (catMaybes, isNothing)\n\n-- | Split a (possibly infinite) string at the occurrences of any of the given delimiters.\n--\n-- \u03bb take 10 $ splitOnSubstrs [\"||\", \"***\"] \"la||la***fa\"\n-- [\"la\",\"la\",\"fa\"]\n--\n-- \u03bb take 10 $ splitOnSubstrs [\"||\", \"***\"] (cycle \"la||la***fa||\")\n-- [\"la\",\"la\",\"fa\",\"la\",\"la\",\"fa\",\"la\",\"la\",\"fa\",\"la\"]\n--\nsplitOnSubstrs :: [String] -&gt; String -&gt; [String]\nsplitOnSubstrs delims\n    = fmap catMaybes       -- At this point, there will be only `Just` elements left.\n    . splitWhen isNothing  -- Now we may split at nothings.\n    . unfoldr f            -- Replace the occurences of delimiters with a `Nothing`.\n  where\n\n-- | This is the base case. It will terminate the `unfoldr` process.\n    f [ ]  = Nothing\n\n-- | This is the recursive case. It is divided into 2 cases:\n-- * One of the delimiters may match. We will then replace it with a Nothing.\n-- * Otherwise, we will `Just` return the current element.\n--\n-- Notice that, if there are several patterns that match at this point, we will use the first one.\n-- You may sort the patterns by length to always match the longest or the shortest. If you desire\n-- more complicated behaviour, you must plug a more involved logic here. In any way, the index\n-- should point to one of the patterns that matched.\n--\n--                       vvvvvvvvvvvvvv\n    f body@(x:xs) = case elemIndex True $ (`isPrefixOf` body) &lt;$&gt; delims of\n        Just index -&gt; return (Nothing, drop (length $ delims !! index) body)\n        Nothing    -&gt; return (Just x, xs)\n</code></pre>\n\n<p>&nbsp;</p>\n\n<p>It might happen that you will not find this code straightforward. Specifically, the <code>unfoldr</code> part is somewhat dense, so I will add a few words about it.</p>\n\n<p><code>unfoldr f</code> is an embodiment of a recursion scheme. <code>f</code> is a function that may chip a part from the <code>body</code>: <code>f :: (body -&gt; Maybe (chip, body))</code>.</p>\n\n<ul>\n<li>As long as it keeps chipping, <code>unfoldr</code> keeps applying it to the <code>body</code>. This is called <em>recursive case</em>.</li>\n<li>Once it fails (returning <code>Nothing</code>), <code>unfoldr</code> stops and hands you all the chips it thus collected. This is called <em>base case</em>.</li>\n</ul>\n\n<p>In our case, <code>f</code> takes symbols from the string, and fails once the string is empty.</p>\n\n<p>&nbsp;</p>\n\n<p>That's it. I hope you send me a postcard when you receive a Turing award for a fast splitting algorithm.</p>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 5207050, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RK-EWb8XHu0/AAAAAAAAAAI/AAAAAAAABdQ/ixNldC0UAg4/photo.jpg?sz=128", "display_name": "Johan Jansen van Vuuren", "link": "https://stackoverflow.com/users/5207050/johan-jansen-van-vuuren"}, "edited": false, "score": 0, "creation_date": 1520925519, "post_id": 49240295, "comment_id": 85503973, "body": "Thank you! For my use case, this method is fine - my input strings will not be very long, so performance won&#39;t be an issue."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1520969924, "post_id": 49240295, "comment_id": 85532464, "body": "Prelude&gt; [read n :: Int | n &lt;- [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;9&quot;,&quot;10&quot;]] &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; [1,2,3,9,10]"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1520872819, "creation_date": 1520872819, "answer_id": 49240295, "question_id": 49228467, "link": "https://stackoverflow.com/questions/49228467/split-string-on-multiple-delimiters-of-any-length-in-haskell/49240295#49240295", "title": "Split string on multiple delimiters of any length in Haskell", "body": "<p>If you don't mind making multiple passes over the input string, you can use <code>splitOn</code> from <code>Data.List.Split</code>, and gradually split the input string using one delimiter at a time.</p>\n\n<p>You can write this fairly succinctly using <code>foldl'</code>:</p>\n\n<pre><code>import Data.List\nimport Data.List.Split\n\nsplitOnAnyOf :: Eq a =&gt; [[a]] -&gt; [a] -&gt; [[a]]\nsplitOnAnyOf ds xs = foldl' (\\ys d -&gt; ys &gt;&gt;= splitOn d) [xs] ds\n</code></pre>\n\n<p>Here, the accumulator for the fold operation is a list of strings, or more generally <code>[[a]]</code>, so you have to 'lift' <code>xs</code> into a list, using <code>[xs]</code>.</p>\n\n<p>Then you fold over the delimiters <code>ds</code> - not the input string to be parsed. For each delimiter <code>d</code>, you split the accumulated list of strings with <code>splitOn</code>, and concatenate them. You could also have used <code>concatMap</code>, but here I arbitrarily chose to use the more general <code>&gt;&gt;=</code> (<em>bind</em>) operator.</p>\n\n<p>This seems to do what is required in the OP:</p>\n\n<pre><code>*Q49228467&gt; splitOnAnyOf [\";\", \",\"] \"1;2,3,4;10\"\n[\"1\",\"2\",\"3\",\"4\",\"10\"]\n*Q49228467&gt; splitOnAnyOf [\"***\", \"||\"] \"1***2||3||4***10\"\n[\"1\",\"2\",\"3\",\"4\",\"10\"]\n</code></pre>\n\n<p>Since this makes multiple passes over temporary lists, it's most likely not the fastest implementation you can make, but if you don't have too many delimiters, or extremely long lists, this may be good enough.</p>\n"}], "owner": {"reputation": 55, "user_id": 5207050, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RK-EWb8XHu0/AAAAAAAAAAI/AAAAAAAABdQ/ixNldC0UAg4/photo.jpg?sz=128", "display_name": "Johan Jansen van Vuuren", "link": "https://stackoverflow.com/users/5207050/johan-jansen-van-vuuren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1230, "favorite_count": 1, "accepted_answer_id": 49240295, "answer_count": 2, "score": 4, "last_activity_date": 1520872948, "creation_date": 1520831479, "last_edit_date": 1520872948, "question_id": 49228467, "link": "https://stackoverflow.com/questions/49228467/split-string-on-multiple-delimiters-of-any-length-in-haskell", "title": "Split string on multiple delimiters of any length in Haskell", "body": "<p>I am attempting a Haskell coding challenge where, given a certain string with a prefix indicating which substrings are delimiting markers, a list needs to be built from the input. </p>\n\n<p>I have already solved the problem for multiple single-length delimiters, but I am stuck with the problem where the delimiters can be any length.  I use splitOneOf from Data.List.Split, but this works for character (length 1) delimiters only.</p>\n\n<p>For example, given</p>\n\n<p><strong>input</strong> <code>\";,\\n1;2,3,4;10\"</code>, </p>\n\n<p><strong>delimiters</strong> are <code>';'</code> and <code>','</code></p>\n\n<p><strong>splitting</strong> the input on the above delivers</p>\n\n<p><strong>output</strong> <code>[1,2,3,4,10]</code>  </p>\n\n<p>The problem I'm facing has two parts: </p>\n\n<p>Firstly, a single delimiter of any length, e.g. </p>\n\n<p><code>\"****\\n1****2****3****4****10\"</code> should result in the list <code>[1,2,3,4,10]</code>. </p>\n\n<p>Secondly, more than one delimiter can be specified, e.g. </p>\n\n<p><strong>input</strong> <code>\"[***][||]\\n1***2||3||4***10\"</code>, </p>\n\n<p><strong>delimiters</strong> are <code>\"***\"</code> and <code>\"||\"</code></p>\n\n<p><strong>splitting</strong> the input on the above delivers</p>\n\n<p><strong>output</strong> <code>[1,2,3,4,10]</code>  </p>\n\n<p>My code for retrieving the delimiter in the case of character delimiters: </p>\n\n<pre><code>--This gives the delimiters as a list of characters, i.e. a String.\ngetDelimiter::String-&gt;[Char]\ngetDelimiter text = head . splitOn \"\\n\" $ text\n\n--drop \"[delimiters]\\n\" from the input\nbody::String-&gt;String\nbody text = drop ((length . getDelimiter $ text)+1)) $ text \n\n--returns tuple with fst being the delimiters, snd the body of the input\ndoc::String-&gt;(String,String) \ndoc text = (getDelimiter text, body text)\n\n--given the delimiters and the body of the input, return a list of strings\nnumbers::(String,String)-&gt;[String]\nnumbers (delim, rest) = splitOneOf delim rest\n\n--input \",@#\\n1,2@3#4\" gives output [\"1\",\"2\",\"3\",\"4\"]\ngetList::String-&gt;[String]\ngetList text = numbers . doc $ text\n</code></pre>\n\n<p>So my question is, how do I do the processing for when the delimiters are e.g. <code>\"***\"</code> and <code>\"||\"</code>?</p>\n\n<p>Any hints are welcome, especially in a functional programming context.</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520859356, "post_id": 49228157, "comment_id": 85474686, "body": "N.B.: In future questions, note the tag for Stack is [haskell-stack], and not just [stack] (which is about the data structure). I removed the tag from this question because it doesn&#39;t really involve Stack."}, {"owner": {"reputation": 383, "user_id": 5181829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LQG85.jpg?s=128&g=1", "display_name": "Marronnier", "link": "https://stackoverflow.com/users/5181829/marronnier"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521512685, "post_id": 49228157, "comment_id": 85751922, "body": "Thanks. I&#39;ll be careful next time:)"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1520966820, "creation_date": 1520966820, "answer_id": 49263713, "question_id": 49228157, "link": "https://stackoverflow.com/questions/49228157/conduit-weird-behavior/49263713#49263713", "title": "Conduit weird behavior", "body": "<p>This is the behavior of leftovers. Leftovers cannot propagate from outside of the <code>.|</code> fusion operator. As <a href=\"https://www.stackage.org/haddock/lts-11.0/conduit-1.3.0/Data-Conduit.html#v:.-124-\" rel=\"nofollow noreferrer\">the Haddocks</a> say:</p>\n\n<blockquote>\n  <p>Leftover data returned from the right Conduit will be discarded.</p>\n</blockquote>\n\n<p>You can use the <a href=\"https://www.stackage.org/haddock/lts-11.0/conduit-1.3.0/Data-Conduit.html#g:14\" rel=\"nofollow noreferrer\">fusion with leftovers</a> functions if you need to recover the leftovers.</p>\n"}], "owner": {"reputation": 383, "user_id": 5181829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LQG85.jpg?s=128&g=1", "display_name": "Marronnier", "link": "https://stackoverflow.com/users/5181829/marronnier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 49263713, "answer_count": 1, "score": 2, "last_activity_date": 1520966820, "creation_date": 1520828811, "last_edit_date": 1520859264, "question_id": 49228157, "link": "https://stackoverflow.com/questions/49228157/conduit-weird-behavior", "title": "Conduit weird behavior", "body": "<p>I'm new to Haskell Conduit and I'm learning how to use it. I encountered a weird behevior.</p>\n\n<p>Here, we have:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-10.9 script\n\nimport Conduit\n\nmain :: IO ()\nmain = runConduit\n  $ yieldMany [1..10::Int]\n .| do\n      mapC id .| (await &gt;&gt;= maybe (return ()) leftover)\n      printC\n .| do\n      leftover \"Hello There!\"\n      printC\n</code></pre>\n\n<p>and the result is:</p>\n\n<pre><code>$ ./Example21.hs\n\"Hello There!\"\n2\n3\n4\n5\n6\n7\n8\n9\n10\n</code></pre>\n\n<p>I don't understand why <code>1</code> isn't printed.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": false, "score": 1, "last_activity_date": 1520830489, "last_edit_date": 1520830489, "creation_date": 1520830014, "answer_id": 49228295, "question_id": 49227754, "link": "https://stackoverflow.com/questions/49227754/aeson-convert-array-to-object/49228295#49228295", "title": "Aeson Convert Array to Object", "body": "<p>You can reuse the <code>FromJSON</code> instance for lists and the <a href=\"https://hackage.haskell.org/package/aeson-1.3.0.0/docs/Data-Aeson-Types.html#t:Value\" rel=\"nofollow noreferrer\"><code>Value</code></a> type, and then construct your type after pattern matching. If the pattern match fails, the parser will fail.</p>\n\n<pre><code>import Data.Text (unpack)\n\ninstance FromJSON MixArray where\n  parseJSON jsn = do\n    [String s, Number n, Bool b] &lt;- parseJSON jsn\n    return MixArray { vStr = unpack s, vNum = truncate n, vBool = b }\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 4826652, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/5eKU9.png?s=128&g=1", "display_name": "Squallcx", "link": "https://stackoverflow.com/users/4826652/squallcx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520830489, "creation_date": 1520825180, "question_id": 49227754, "link": "https://stackoverflow.com/questions/49227754/aeson-convert-array-to-object", "title": "Aeson Convert Array to Object", "body": "<p>What is the best way \nData.Aeson FromJSON instance \nConvert Array to Object:</p>\n\n<pre><code>import Data.Aeson\n\ndata MixArray = MixArray {                                                                                                                                                                                         \n  vStr :: String,                                                                                                                                                                                                   \n  vNum :: Int,\n  vBool :: Bool                                                                                                                                                                                                  \n} deriving Show   \n\nmain = do\n  jsonStr = [\"a\",1,true]\n  mix &lt;- eitherDecode $ jsonStr :: IO (Either String [MixArray])\n  show mix\n</code></pre>\n\n<p>to: </p>\n\n<pre><code>MixArray { vStr = \"a\", vNum = 1, vBool= true}\n</code></pre>\n"}, {"tags": ["arrays", "list", "performance", "haskell", "optimization"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1520830695, "post_id": 49226682, "comment_id": 85460215, "body": "It&#39;s not useful to say you&#39;re using &quot;the last version of GHC&quot;. I assume you meant &quot;latest&quot;, as in newest, not the final version that will ever be published. But that is still not useful, because new versions are being released all the time, and your statement will soon stop being true. If you&#39;re going to mention a version, use a number that doesn&#39;t change."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1520882298, "post_id": 49226682, "comment_id": 85489546, "body": "Could not reproduce. On my machine, <code>memoized_fib_list 15000</code> takes ~1s while <code>memoized_fib_array 15000</code> takes ~0.009s. How are you testing this? Are you sure you&#39;re forcing the answer properly?"}, {"owner": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1520894650, "post_id": 49226682, "comment_id": 85494948, "body": "@amalloy sorry, yes, it&#39;s latest."}, {"owner": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1520895069, "post_id": 49226682, "comment_id": 85495075, "body": "@DanielWagner i added how i&#39;m running the tests."}, {"owner": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1520895855, "post_id": 49226682, "comment_id": 85495340, "body": "@amalloy You are right. There is a new version 4 days old. I have versions 8.2.1 and 8.0.2 in my machines."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1520896787, "post_id": 49226682, "comment_id": 85495624, "body": "What options did you use to compile the code?"}, {"owner": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "edited": false, "score": 0, "creation_date": 1520898878, "post_id": 49226682, "comment_id": 85496208, "body": "For those results the only flag is -O2"}], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "edited": false, "score": 0, "creation_date": 1526949599, "post_id": 50457795, "comment_id": 87929987, "body": "Thanks for the answer! That explains a lot."}, {"owner": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "edited": false, "score": 0, "creation_date": 1526950104, "post_id": 50457795, "comment_id": 87930067, "body": "I also made tests using Vectors (both with safe and unsafe access and creation) but the improvement wasn&#39;t significative. I also used some other data structures and the best result where obtained using Tries. But as a newbie in haskell i found the list vs array counterintuitive and puzzling."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "edited": false, "score": 0, "creation_date": 1526985187, "post_id": 50457795, "comment_id": 87944135, "body": "@SergioDanielCoronelMalvarez well, Haskell is very good at lists. And the ability to make them infinite is really useful, this being a straightforward example. Generally, I would stick to purely functional data structures unless it&#39;s clear that an array is needed (and this actually makes most sense when you can make it an <i>unboxed</i> array, which isn&#39;t possible with <code>Integer</code>)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1526984996, "last_edit_date": 1526984996, "creation_date": 1526945307, "answer_id": 50457795, "question_id": 49226682, "link": "https://stackoverflow.com/questions/49226682/dynamic-programming-fibonacci-performance-of-list-better-than-array/50457795#50457795", "title": "Dynamic Programming - Fibonacci - Performance of List better than Array", "body": "<p>What's happening here is quite simple: with <code>-O2</code>, GHC decides to make the memoisation-list in <code>memoized_fib_list</code> global.</p>\n\n<pre><code>$ ghc -fforce-recomp wtmpf-file4545.hs -O2 -ddump-prep\n\n...\n\nMain.memoizedFib_list :: GHC.Types.Int -&gt; GHC.Integer.Type.Integer\n[GblId, Arity=1, Str=&lt;S(S),1*U(U)&gt;, Unf=OtherCon []]\nMain.memoizedFib_list\n  = \\ (n_sc61 [Occ=Once] :: GHC.Types.Int) -&gt;\n      GHC.List.!! @ GHC.Integer.Type.Integer Main.main_fibTab n_sc61\n\n...\n\nMain.main_fibTab :: [GHC.Integer.Type.Integer]\n[GblId]\nMain.main_fibTab\n  = case Main.$wgo 0# of\n    { (# ww1_sc5M [Occ=Once], ww2_sc5N [Occ=Once] #) -&gt;\n    GHC.Types.: @ GHC.Integer.Type.Integer ww1_sc5M ww2_sc5N\n    }\n\n...\n</code></pre>\n\n<p>That means, your criterion benchmark doesn't actually evaluate the fibonacci function repeatedly \u2013 it just performs repeated lookups in the same global list. And averaged over many evaluations, this gives a very good score, which is however not representative of how fast the <em>calculation</em> is.</p>\n\n<p>GHC performs this optimisation in the list implementation because you don't need lists of different length \u2013 it's always an infinite list of <em>all</em> Fibonacci number. That's not possible in the array implementation, so this can't keep up here.</p>\n\n<p>The simples way to prevent this globalisation would be to make <code>fibm</code> explicitly dependent on <code>n</code>, by just trimming it to the needed finite lenght like the arrays are as well.</p>\n\n<pre><code>memoizedFib_list :: Int -&gt; Integer\nmemoizedFib_list n = fibTab !! n\n   where fibTab = map fibm [0 ..]\n         fibm 0 = 0\n         fibm 1 = 1\n         fibm n = fibTab !! (n-2) + fibTab !! (n-1)\n</code></pre>\n\n<p>With this, the list implementation becomes much slower than the array one, as one would expect seeing memo-lookup is <em>O</em>(<em>n</em>) for lists:</p>\n\n<pre><code>$ ghc -fforce-recomp wtmpf-file4545.hs -O2 &amp;&amp; ./wtmpf-file4545 \n[1 of 1] Compiling Main             ( wtmpf-file4545.hs, wtmpf-file4545.o )\nLinking wtmpf-file4545 ...\n--------------EJECUTANDO BENCHMARK N=40------------------\nbenchmarking fibonacci/memoizedFib_list\ntime                 10.47 \u03bcs   (10.42 \u03bcs .. 10.51 \u03bcs)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 10.40 \u03bcs   (10.35 \u03bcs .. 10.44 \u03bcs)\nstd dev              163.3 ns   (122.2 ns .. 225.8 ns)\nvariance introduced by outliers: 13% (moderately inflated)\n\nbenchmarking fibonacci/memoizedFib_array\ntime                 1.618 \u03bcs   (1.617 \u03bcs .. 1.620 \u03bcs)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 1.620 \u03bcs   (1.618 \u03bcs .. 1.623 \u03bcs)\nstd dev              7.521 ns   (4.079 ns .. 12.48 ns)\n\nbenchmarking fibonacci/memoizedFib_vector\ntime                 1.573 \u03bcs   (1.572 \u03bcs .. 1.574 \u03bcs)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 1.572 \u03bcs   (1.571 \u03bcs .. 1.573 \u03bcs)\nstd dev              2.351 ns   (1.417 ns .. 4.040 ns)\n\n--------------EJECUTANDO BENCHMARK N=1500----------------\nbenchmarking fibonacci/memoizedFib_list\ntime                 18.52 ms   (18.41 ms .. 18.68 ms)\n                     1.000 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 18.65 ms   (18.53 ms .. 18.84 ms)\nstd dev              355.1 \u03bcs   (204.8 \u03bcs .. 592.1 \u03bcs)\n\nbenchmarking fibonacci/memoizedFib_array\ntime                 135.2 \u03bcs   (131.2 \u03bcs .. 140.1 \u03bcs)\n                     0.996 R\u00b2   (0.991 R\u00b2 .. 1.000 R\u00b2)\nmean                 132.7 \u03bcs   (131.9 \u03bcs .. 135.0 \u03bcs)\nstd dev              4.463 \u03bcs   (2.024 \u03bcs .. 8.327 \u03bcs)\nvariance introduced by outliers: 32% (moderately inflated)\n\nbenchmarking fibonacci/memoizedFib_vector\ntime                 131.8 \u03bcs   (130.6 \u03bcs .. 133.2 \u03bcs)\n                     0.999 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 132.5 \u03bcs   (131.4 \u03bcs .. 134.1 \u03bcs)\nstd dev              4.383 \u03bcs   (3.463 \u03bcs .. 5.952 \u03bcs)\nvariance introduced by outliers: 31% (moderately inflated)\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html\" rel=\"nofollow noreferrer\"><code>Vector</code></a> which I also tested here performs yet a bit faster, but not really significantly. I think as soon as you use a container with <em>O</em>(1) lookup, the performance is dominated by the additions of the pretty huge numbers, so you're really benchmarking GMP rather than anything Haskell has to do with.</p>\n\n<pre><code>import qualified Data.Vector as V\n\nmemoizedFib_vector :: Int -&gt; Integer\nmemoizedFib_vector n = fibTab V.! n\n  where fibTab = V.generate (n+1) mfib\n        mfib 0 = 0\n        mfib 1 = 1\n        mfib x = fibTab V.! (x - 1) + fibTab V.! (x - 2)\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 9477059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I3Eqs9jKZd4/AAAAAAAAAAI/AAAAAAAAAC8/0OqRTKQ3QSY/photo.jpg?sz=128", "display_name": "Sergio Daniel Coronel Malvarez", "link": "https://stackoverflow.com/users/9477059/sergio-daniel-coronel-malvarez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 50457795, "answer_count": 1, "score": 1, "last_activity_date": 1533047850, "creation_date": 1520815621, "last_edit_date": 1533047850, "question_id": 49226682, "link": "https://stackoverflow.com/questions/49226682/dynamic-programming-fibonacci-performance-of-list-better-than-array", "title": "Dynamic Programming - Fibonacci - Performance of List better than Array", "body": "<p>I'm playing a little with Haskell and dynamic programming. </p>\n\n<p>I have implemented a lot of problems, but in Fibonacci's case i'm getting some results that are PC dependants and i would like to confirm.</p>\n\n<p>Assume the following implementations:</p>\n\n<p>1)- List:</p>\n\n<pre><code>memoized_fib_list n = fibTab !! n\n   where fibTab = map fibm [0 ..]\n         fibm 0 = 0\n         fibm 1 = 1\n         fibm n = fibTab !! (n-2) + fibTab !! (n-1)\n</code></pre>\n\n<p>2)- Array:</p>\n\n<pre><code>memoized_fib_array n = fibTab ! n\n  where fibTab = listArray (0, n) [mfib x | x &lt;- [0..n]]\n        mfib 0 = 0\n        mfib 1 = 1\n        mfib x = fibTab ! (x - 1) + fibTab ! (x - 2)\n</code></pre>\n\n<p>Result (with Criterion):</p>\n\n<ol>\n<li><p>N = 15.000:<br>\nList implementation: 171.5 \u03bcs<br>\nArray implementation: 8.782 ms</p></li>\n<li><p>N = 100.000:<br>\nList implementation: 2.289 ms<br>\nArray implementation: 195.7 ms</p></li>\n<li><p>N = 130.000:<br>\nList implementation: 3.708 ms<br>\nArray implementation: 410.4 ms</p></li>\n</ol>\n\n<p>The tests were run on a Notebook with a Core i7 Skylake, 8gb DDR4 and SSD (Ubuntu).</p>\n\n<p>I was expecting the array implementation to be much better, and this was the only problem where the list implementation is better. </p>\n\n<p>Could it be because of the sequential access? On some hardware with lower specs the list implementation has worse performance.</p>\n\n<p>Note: I'm using the last (edit: latest) version of GHC. </p>\n\n<p>Thanks.</p>\n\n<hr>\n\n<p>Edit: </p>\n\n<pre><code>benchmark n = defaultMain [\n    bgroup \"fibonacci\" [ \n                   bench \"memoized_fib_list\" $ whnf (memoized_fib_list) n\n                 , bench \"memoized_fib_array\" $ whnf (memoized_fib_array) n\n                 ]\n                ]\n\nmain = do\n{\n    putStrLn \"--------------EJECUTANDO BENCHMARK N=40------------------\";\n    benchmark 40;\n    putStrLn \"--------------EJECUTANDO BENCHMARK N=15000---------------\";\n    benchmark 15000;\n    putStrLn \"--------------EJECUTANDO BENCHMARK N=50000---------------\";\n    benchmark 50000;\n    putStrLn \"--------------EJECUTANDO BENCHMARK N=100000--------------\";\n    benchmark 100000;\n    putStrLn \"--------------EJECUTANDO BENCHMARK N=130000--------------\";\n    benchmark 130000;\n}\n</code></pre>\n\n<hr>\n\n<p>Edit2: I installed Haskell Platform 8.2.2 on my windows 10 PC and got very similar results.</p>\n\n<p>Intel i5 6600K, 16gb DDR4, SSD. </p>\n\n<pre><code>-------------------EJECUTANDO BENCHMARK N=130000------------------------\nbenchmarking best algo/memoized_fib_list\ntime                 1.818 ms   (1.774 ms .. 1.855 ms)\n                     0.993 R\u00b2   (0.985 R\u00b2 .. 0.998 R\u00b2)\nmean                 1.853 ms   (1.826 ms .. 1.904 ms)\nstd dev              119.2 \u03bcs   (84.15 \u03bcs .. 191.3 \u03bcs)\nvariance introduced by outliers: 48% (moderately inflated)\n\nbenchmarking best algo/memoized_fib_array\ntime                 139.8 ms   (63.05 ms .. 221.8 ms)\n                     0.884 R\u00b2   (0.623 R\u00b2 .. 1.000 R\u00b2)\nmean                 287.0 ms   (221.4 ms .. 353.0 ms)\nstd dev              83.83 ms   (64.91 ms .. 101.6 ms)\nvariance introduced by outliers: 78% (severely inflated)\n</code></pre>\n\n<hr>\n\n<p>Edit3: Some additional information after running criterion with Linear Regression. All the values correspond to the execution with N = 130000.</p>\n\n<p>-Number of garbage collections:</p>\n\n<p>List implementation:</p>\n\n<pre><code>numGcs:              NaN R\u00b2     (NaN R\u00b2 .. NaN R\u00b2)\n  iters              0.000      (0.000 .. 0.000)\n  y                  0.000      (0.000 .. 0.000)\n</code></pre>\n\n<p>Array Implementation:</p>\n\n<pre><code>numGcs:              1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\n  iters              739.000    (739.000 .. 739.000)\n  y                  2.040e-12  (-3.841e-12 .. 2.130e-12)\n</code></pre>\n\n<p>-Bytes allocated:</p>\n\n<p>List implementation:</p>\n\n<pre><code>allocated:           0.001 R\u00b2   (0.000 R\u00b2 .. 0.089 R\u00b2)\n  iters              1.285      (-9.751 .. 13.730)\n  y                  2344.014   (1748.809 .. 2995.439)\n</code></pre>\n\n<p>Array Implementation:</p>\n\n<pre><code>allocated:           1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\n  iters              7.586e8    (7.586e8 .. 7.586e8)\n  y                  1648.000   (1648.000 .. NaN)\n</code></pre>\n\n<p>-CPU cycles:</p>\n\n<p>List implementation:</p>\n\n<pre><code>cycles:              0.992 R\u00b2   (0.984 R\u00b2 .. 0.997 R\u00b2)\n  iters              6759303.406 (6579945.392 .. 6962148.091)\n  y                  -141047.582 (-4701325.840 .. 4674847.149)\n</code></pre>\n\n<p>Array Implementation:</p>\n\n<pre><code>cycles:              1.000 R\u00b2   (NaN R\u00b2 .. 1.000 R\u00b2)\n  iters              1.729e9    (1.680e9 .. 1.757e9)\n  y                  -3311041.000 (NaN .. 6.513e7)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching", "list-comprehension"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1520807693, "post_id": 49225819, "comment_id": 85455306, "body": "Try <code>[a | (a, 3) &lt;- xs]</code>."}, {"owner": {"reputation": 107, "user_id": 9278225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c78a691a3f82dee01c5c5e918dbf4c?s=128&d=identicon&r=PG&f=1", "display_name": "CoreNoob", "link": "https://stackoverflow.com/users/9278225/corenoob"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1520807918, "post_id": 49225819, "comment_id": 85455357, "body": "Thank you so much. :) Now I know what is meant!"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1521081529, "post_id": 49225819, "comment_id": 85584385, "body": "The pattern is indeed (a,b) just like in a function (\\a b -&gt; a+b) 1 2 --vs-- ((a,b) -&gt; a+b) (1,2), (a b) in your example would fail. You could use a single variable a &lt;- xs but you would have to split them with fst a snd a in the result clause or feed a 2-tuple to a function that takes one."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 9278225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c78a691a3f82dee01c5c5e918dbf4c?s=128&d=identicon&r=PG&f=1", "display_name": "CoreNoob", "link": "https://stackoverflow.com/users/9278225/corenoob"}, "edited": false, "score": 0, "creation_date": 1520808040, "post_id": 49225854, "comment_id": 85455388, "body": "Thank you very much for this example. I got it."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1520808387, "last_edit_date": 1520808387, "creation_date": 1520807855, "answer_id": 49225854, "question_id": 49225819, "link": "https://stackoverflow.com/questions/49225819/haskell-how-does-a-pattern-match-fail-in-a-list-comprehension/49225854#49225854", "title": "Haskell - How does a pattern match fail in a list comprehension?", "body": "<p>Here are a few cases of failing pattern matching in list comprehensions, demoed in GHCi:</p>\n\n<pre><code>Prelude&gt; [ () | True &lt;- [True, False,True] ]\n[(),()]\nPrelude&gt; [ x | (x, True) &lt;- [(1,True), (2,False), (3,True)] ]\n[1,3]\nPrelude&gt; [ x+1 | Left x &lt;- [Left 1, Right \"Hello\", Right \"world\", Left 2] ]\n[2,3]\n</code></pre>\n\n<p>Note that some patterns can never fail, e.g. <code>x</code>, <code>(x,y)</code>, or <code>(x,(a,b),z)</code>. This is because they match types having only a constructor, which has to match being the only one.</p>\n\n<p>In general, pattern matching involves multiple branches, e.g.</p>\n\n<pre><code>case someValue of\n   Left x  -&gt; ...\n   Right y -&gt; ...\n\nfoo Nothing = ...\nfoo (Just x) = ...\n</code></pre>\n\n<p>In these cases, if we forget to handle a constructor, we get a runtime error when that case occurs. (Turning on warnings helps in avoiding this!).</p>\n\n<p>In list comprehensions generators <code>p &lt;- ...</code>, instead, we can only specify one pattern. However, a special rule applies: failure of pattern matching is not an error, but is simply ignored.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1520807866, "creation_date": 1520807866, "answer_id": 49225855, "question_id": 49225819, "link": "https://stackoverflow.com/questions/49225819/haskell-how-does-a-pattern-match-fail-in-a-list-comprehension/49225855#49225855", "title": "Haskell - How does a pattern match fail in a list comprehension?", "body": "<p>That's <em>not</em> an example of pattern-match failure (the tuple pattern matches <em>always</em>). This would be an example:</p>\n\n<pre><code>Prelude&gt; xs = [Just (1,3), Just (4,3), Nothing, Just (5,3), Nothing]\nPrelude&gt; [a+b | Just (a, b) &lt;- xs]\n[4,7,8]\n</code></pre>\n\n<p>Here, the pattern <code>Just (a, b)</code> matches only the elements <code>Just (1,3)</code>, <code>Just (4,3)</code> and <code>Just (5,3)</code>, but not the <code>Nothing</code>s, so these positions just don't turn up in the final list.</p>\n"}], "owner": {"reputation": 107, "user_id": 9278225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c78a691a3f82dee01c5c5e918dbf4c?s=128&d=identicon&r=PG&f=1", "display_name": "CoreNoob", "link": "https://stackoverflow.com/users/9278225/corenoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 49225854, "answer_count": 2, "score": 5, "last_activity_date": 1520808387, "creation_date": 1520807599, "question_id": 49225819, "link": "https://stackoverflow.com/questions/49225819/haskell-how-does-a-pattern-match-fail-in-a-list-comprehension", "title": "Haskell - How does a pattern match fail in a list comprehension?", "body": "<p>I'm learning Haskell with Miran Lipovaca's \"Learn You a Haskell for Great Good!\". In page 82 it says </p>\n\n<blockquote>\n  <p>If a pattern match fails, the list comprehension will just move on to the next element, and the element that failed won\u2019t be included in the resulting list.</p>\n</blockquote>\n\n<p>Example:</p>\n\n<pre><code>ghci&gt; let xs = [(1,3),(4,3),(2,4),(5,3),(5,6),(3,1)]\nghci&gt; [a+b | (a, b) &lt;- xs]\n[4,7,6,8,11,4]\n</code></pre>\n\n<p>My question is how does a pattern match fail?\nWhat does he mean by that? I really don't get it. It could be because of my weak english. I please you for an example because I think the book doesn't give any example for failing pattern match.</p>\n\n<p>I thought about something like if the list contains a type that couldn't be processed by the list comprehension then it moves to the next element but if I change the list in this way:</p>\n\n<pre><code>let xs = [(1,3),(4,3),(2,4),(5,3),True,(5,6)]\n</code></pre>\n\n<p>Then it doesn't even compile because it \"couldn't match expected type\"...</p>\n"}, {"tags": ["haskell", "list-comprehension", "evaluation"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 2, "creation_date": 1520805529, "post_id": 49225530, "comment_id": 85454724, "body": "Imagine that the two arrows represent nested for loops; the outer one over <code>xs</code>, the inner one over <code>ys</code>. The thing to the left of the pipe is the loop body."}, {"owner": {"reputation": 1233, "user_id": 101326, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b67dd441d570e1913e87396718b70f48?s=128&d=identicon&r=PG", "display_name": "anru ", "link": "https://stackoverflow.com/users/101326/anru"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1520805811, "post_id": 49225530, "comment_id": 85454821, "body": "@Sebastian Redl, can you move your comment to answer section?"}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 1, "creation_date": 1520806809, "post_id": 49225530, "comment_id": 85455070, "body": "If you&#39;re just trying to concatenate two lists, you can do <code>[1, 2] ++ []</code>, which yields the expected <code>[1, 2]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1520810431, "post_id": 49225530, "comment_id": 85456030, "body": "<code>{ for each x in [1,2]: { for each ys in []: yield (x:ys) } }</code> == <code>{ { for each ys in []: yield (1:ys)} ; { for each ys in []: yield (2:ys)} }</code> == <code>{ for none: yield ... } ; { for none: yield ... } }</code> == <code>{none ; none }</code> == <code>none</code>."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1521081798, "post_id": 49225530, "comment_id": 85584440, "body": "ys in the result is not a list. Try ys&lt;-[[]] ] to produce a list in x:ys -- it will yield x, that is x:[]"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1520805785, "creation_date": 1520805785, "answer_id": 49225607, "question_id": 49225530, "link": "https://stackoverflow.com/questions/49225530/haskell-list-comprehension-outputs-empty-list-why/49225607#49225607", "title": "Haskell, list comprehension outputs empty list. Why?", "body": "<p>There are two problems with your expectation:</p>\n\n<ol>\n<li><code>x:ys</code> always creates a new list; <code>x:[] == [x]</code>, not <code>x:[] == x</code>.</li>\n<li>Even if <code>x:[] == x</code>, the fact remains that <code>ys &lt;- []</code> does not assign the name <code>ys</code> to the empty list; it assigns <code>ys</code> to a value <em>contained</em> in the empty list (and of course, there is no such value to assign to <code>ys</code>).</li>\n</ol>\n\n<p>You could change <code>ys &lt;- []</code> to <code>ys &lt;- [[]]</code>, in which case you would get</p>\n\n<pre><code>&gt; [x:ys | x&lt;-[1,2], ys&lt;-[[]]]\n[[1], [2]]\n</code></pre>\n\n<p>but if you want <code>[1,2]</code>, the trivial list comprehension would simply be</p>\n\n<pre><code>&gt; [x | x &lt;- [1,2]]\n[1,2]\n</code></pre>\n\n<p>with no other list involved, because you don't want a list of lists as your answer.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1520878488, "last_edit_date": 1520878488, "creation_date": 1520811533, "answer_id": 49226291, "question_id": 49225530, "link": "https://stackoverflow.com/questions/49225530/haskell-list-comprehension-outputs-empty-list-why/49226291#49226291", "title": "Haskell, list comprehension outputs empty list. Why?", "body": "<p>List comprehensions express nested loops:</p>\n\n<pre><code>[x:ys | x&lt;-[1,2], ys&lt;-[]]\n ==\ndo { x&lt;-[1,2] ; do { ys&lt;-[] ; return (x:ys) } }\n ==\n{ for each x in [1,2]: { for each ys in []: yield (x:ys) } }\n == \n{ { for each ys in []: yield (1:ys) }     \n; { for each ys in []: yield (2:ys) }     \n}\n == \n{ { for none: yield ... } ; { for none: yield ... } }\n == \n{ none ; none }\n == \nnone.\n</code></pre>\n\n<p>This is reminiscent of matrix multiplication:</p>\n\n<pre><code>join [ {- for 1: -}  [ a,b,c   ],       [  1a, 1b, 1c,\n       {- for 2: -}  [ d,e     ],   =      2d, 2e,\n       {- for 3: -}  [ f,g,h,i ],          3f, 3g, 3h, 3i\n        ]                                                 ]\n</code></pre>\n\n<p>Thus if the list produced for each element of the first list is empty, the total list is empty as well, because <code>concat [ [], [], [] ] == []</code>.</p>\n\n<p>See also: <a href=\"https://stackoverflow.com/questions/48960899/how-does-the-list-monad-work-in-this-example/49030523#49030523\">How does the List monad work in this example?</a></p>\n"}], "owner": {"reputation": 1233, "user_id": 101326, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b67dd441d570e1913e87396718b70f48?s=128&d=identicon&r=PG", "display_name": "anru ", "link": "https://stackoverflow.com/users/101326/anru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "accepted_answer_id": 49226291, "answer_count": 2, "score": 1, "last_activity_date": 1520878488, "creation_date": 1520805286, "last_edit_date": 1520810681, "question_id": 49225530, "link": "https://stackoverflow.com/questions/49225530/haskell-list-comprehension-outputs-empty-list-why", "title": "Haskell, list comprehension outputs empty list. Why?", "body": "<p><code>[x:ys | x&lt;-[1,2], ys&lt;-[]]</code></p>\n\n<p>above code outputs <code>[]</code>. I thought it should output <code>[1,2]</code>.</p>\n\n<p>So what am I get wrong with Haskell evaluation?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520806782, "post_id": 49225469, "comment_id": 85455066, "body": "Sounds like <a href=\"http://plv.mpi-sws.org/backpack/backpack-paper.pdf\" rel=\"nofollow noreferrer\">backpack</a> would be the ideal fit, but that&#39;s a pretty bleeding-edge feature still. Realistically speaking, parameterising <code>GameStateType</code> is the most sensible option, and certainly a safer one if you need to get it working quickly \u2013 this really shouldn&#39;t be too difficult, the compiler will guide you through all the refactoring. Extra type classes should <i>not</i> be required, given that simple CPP switching seems to work."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1520811118, "post_id": 49225469, "comment_id": 85456176, "body": "I propose that you replace <code>GameState</code> by <code>a</code> everywhere in your API. But whether that will work depends a lot on how <code>GameState</code> appears in your library&#39;s API, and you haven&#39;t said anything about that. That makes it very difficult to evaluate whether a potential answer would fit your situation well."}], "owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520806304, "creation_date": 1520804889, "last_edit_date": 1520806304, "question_id": 49225469, "link": "https://stackoverflow.com/questions/49225469/how-to-define-user-definable-custom-types-at-compile-time-for-a-library-using-st", "title": "How to define user-definable custom types at compile-time for a library using stack", "body": "<p>After working on my Haskell project for a while I decided on using multiple executables with a single library with stack. The reason behind, is that I want to have multiple test executables so that each can showcase some uses for the  single library that I am writing. The problem occurred when I tried to define a type that could be potentially different for each executable. </p>\n\n<p>To give you an idea of what I would like to accomplish:</p>\n\n<p>I currently have a type synonim defined in my library:</p>\n\n<pre><code>type GameState = Int\n</code></pre>\n\n<p>The type <code>Int</code> woks for executable 1, however, for the compilation of the executable two, I want <code>MyOtherDataType</code> to take place of the <code>Int</code>:</p>\n\n<pre><code>type GameState = AnotherDataType\n</code></pre>\n\n<p>I tried setting the state type variable using a <code>#define</code>, with the help of the <a href=\"https://downloads.haskell.org/~ghc/7.2.1/docs/html/libraries/Cabal-1.12.0/Language-Haskell-Extension.html%20%22CPP\" rel=\"nofollow noreferrer\">CPP Language extension</a>. This variable could be passed as a parameter at compile time for the library, but I couldn't make stack route a defined type variable in the executable definition to the library (Eg: <code>-DGAME_STATE_TYPE=Int</code>). This is the closest idea I have for a clean solution that wouldn't require rewriting a lot of my code.</p>\n\n<p>I also tried changing the type definition to:</p>\n\n<pre><code>data GameStateType a = GameStateType a\n</code></pre>\n\n<p>but I soon learned that this would require me to rewrite a lot of type classes, type definitions, monad stacks, and enable extensions such as MultiParamTypeClasses. I don't think that is a path I want to go given the time constraint, however, I would like to hear it anyways should you consider this the only/better option.</p>\n"}, {"tags": ["haskell", "haskell-pipes", "haskell-streaming"], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1520977646, "post_id": 49265389, "comment_id": 85536094, "body": "Perfect, that is what I was looking for! I saw the <code>sum</code> encoding in the documentation but haven&#39;t been able to piece together the various pieces until you answered it by pointing out <code>toSum</code> and <code>fromSum</code> approach."}, {"owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1520988460, "post_id": 49265389, "comment_id": 85539646, "body": "question - if <code>compress</code> is specialized to a concrete return type (.e.g.,<code>Stream (Of ByteString) m ()</code> - instead of <code>r</code> we now have <code>()</code>), then <code>hoist</code> won&#39;t work because of <code>forall</code> quantifier. In that case, what would be a replacement for <code>hoist</code>?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "edited": false, "score": 0, "creation_date": 1521006573, "post_id": 49265389, "comment_id": 85544014, "body": "@Sal I don&#39;t know how to replace <code>hoist</code> in that case."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1520983884, "last_edit_date": 1520983884, "creation_date": 1520973179, "answer_id": 49265389, "question_id": 49224990, "link": "https://stackoverflow.com/questions/49224990/handling-sum-encoding-in-streaming-libraries/49265389#49265389", "title": "Handling sum encoding in Streaming libraries", "body": "<p>A common trick to solve these cases is to put each branch of the sum in different monadic layers (so there will be two streaming layers) manipulate each layer separately, and then either consume them separately or re-join them in a single layer.</p>\n\n<p>First, two auxiliary functions that use <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming.html#v:maps\" rel=\"nofollow noreferrer\"><code>maps</code></a> to convert to and from the <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming.html#t:Sum\" rel=\"nofollow noreferrer\"><code>Sum</code></a> composition of functors: </p>\n\n<pre><code>toSum :: Monad m \n      =&gt; Stream (Of (Either ByteString ByteString)) m r \n      -&gt; Stream (Sum (Of ByteString) (Of ByteString)) m r\ntoSum = maps $ \\(eitherBytes :&gt; x) -&gt; \n    case eitherBytes of\n        Left bytes -&gt; InL (bytes :&gt; x)\n        Right bytes -&gt; InR (bytes :&gt; x)\n\nfromSum :: Monad m \n        =&gt; Stream (Sum (Of ByteString) (Of ByteString)) m r \n        -&gt; Stream (Of (Either ByteString ByteString)) m r\nfromSum = maps $ \\eitherBytes -&gt;\n    case eitherBytes of\n        InL (bytes :&gt; x) -&gt; Left bytes :&gt; x\n        InR (bytes :&gt; x) -&gt; Right bytes :&gt; x\n</code></pre>\n\n<p>We do this to be able to use the <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming.html#v:separate\" rel=\"nofollow noreferrer\"><code>separate</code></a> and <a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming.html#v:unseparate\" rel=\"nofollow noreferrer\"><code>unseparate</code></a> functions.</p>\n\n<p>The actual compression function would be:</p>\n\n<pre><code>eitherCompress :: MonadIO m \n               =&gt; Int \n               -&gt; Stream (Of (Either ByteString ByteString)) m r \n               -&gt; Stream (Of (Either ByteString ByteString)) m r\neitherCompress level =\n     fromSum . unseparate . hoist (compress level) . compress level . separate . toSum\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Streaming.html#v:hoist\" rel=\"nofollow noreferrer\"><code>hoist</code></a> is used to work over the monadic layer below the topmost one.</p>\n"}], "owner": {"reputation": 4185, "user_id": 986475, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dd36406ee6957594a633373c297a3ab1?s=128&d=identicon&r=PG", "display_name": "Sal", "link": "https://stackoverflow.com/users/986475/sal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1520983884, "creation_date": 1520801667, "last_edit_date": 1520822270, "question_id": 49224990, "link": "https://stackoverflow.com/questions/49224990/handling-sum-encoding-in-streaming-libraries", "title": "Handling sum encoding in Streaming libraries", "body": "<p>The motivation behind this question is this scenario - we have a stream of values which are represented by a <code>Sum</code> encoding. Let us assume <code>Either ByteString ByteString</code> where we represent streams of bytes in error and good states respectively. Now, we have another function which can compress the <code>ByteString</code> stream. Is it possible to run this function on <code>Either ByteString ByteString</code> input stream, and compress either one (not just <code>Right</code> but also <code>Left</code> in case <code>Left</code> is yielded instead of <code>Right</code>). A <code>compress</code> function type signature is below (I am using <a href=\"https://www.stackage.org/lts-10.7/package/streaming-0.2.0.0\" rel=\"nofollow noreferrer\">Streaming</a> library):</p>\n\n<pre><code>compress ::  MonadIO m \n         =&gt;  Int \n         -- ^ Compression level.\n         -&gt; Stream (Of ByteString) m r\n         -&gt; Stream (Of ByteString) m r \n</code></pre>\n\n<p>Our input stream is of type <code>Stream (Of (Either ByteString ByteString)) m r</code>. So, is there some kind of transformer function that can run <code>compress</code> on input stream, and output a stream of type <code>Stream (Of (Either ByteString ByteString)) m r</code> where both are compressed.</p>\n\n<p>It seems to me that I should write a custom <code>compress</code> instead, let us say <code>eitherCompress</code> as follows:</p>\n\n<pre><code>eitherCompress :: MonadIO m \n             =&gt;  Int \n             -- ^ Compression level.\n             -&gt; Stream (Of (Either ByteString ByteString)) m r\n             -&gt; Stream (Of (Either ByteString ByteString)) m r \n</code></pre>\n\n<p>Is that correct? If that is the case, what is a good way to write <code>eitherCompress</code> using the function below from <a href=\"https://hackage.haskell.org/package/zstd-0.1.0.0/docs/Codec-Compression-Zstd-Streaming.html\" rel=\"nofollow noreferrer\"><code>zstd</code></a> library:</p>\n\n<pre><code>compress :: Int \n         -- ^ Compression level. Must be &gt;= 1 and &lt;= maxCLevel.\n         -&gt; IO Result    \n</code></pre>\n\n<p>I have written <code>stream</code> producers using <code>yield</code>, but I have implemented them for simple cases where the input is just a source, not a stream. Will very much appreciate help with this problem.</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "stackage", "cabal-new"], "answers": [{"tags": [], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "is_accepted": false, "score": 2, "last_activity_date": 1520799119, "creation_date": 1520799119, "answer_id": 49224588, "question_id": 49224474, "link": "https://stackoverflow.com/questions/49224474/how-can-i-use-stackages-cabal-config-files-with-nix-style-cabal/49224588#49224588", "title": "How can I use Stackage&#39;s cabal.config files with nix-style cabal?", "body": "<p>The <code>cabal.config</code> files from Stackage only contain a single huge <code>constraints</code> section with the same syntax that the <code>cabal.project</code> files use.</p>\n\n<p>So you can simply copy these constraints into your <code>cabal.project.local</code> file, delete any constraints for packages in your local project and <code>new-build</code>.</p>\n"}], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1520799119, "creation_date": 1520798362, "question_id": 49224474, "link": "https://stackoverflow.com/questions/49224474/how-can-i-use-stackages-cabal-config-files-with-nix-style-cabal", "title": "How can I use Stackage&#39;s cabal.config files with nix-style cabal?", "body": "<p>Stackage provides a <code>cabal.config</code> file with each snapshot, e.g. <a href=\"https://www.stackage.org/lts-10.9/cabal.config\" rel=\"nofollow noreferrer\">this one</a>. How can I make cabal <code>new-configure</code> a project with the package versions from that file?</p>\n\n<p>(Alternatively: Is there another way to configure a nix-style cabal project with dependency versions from a specific Stackage snapshot?)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1520794304, "post_id": 49223533, "comment_id": 85450991, "body": "Why should <code>(+5)</code> be a number?  What number should it be?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1520794337, "post_id": 49223533, "comment_id": 85451004, "body": "Do you understand currying and how it relates to your quesetion?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520803227, "post_id": 49223533, "comment_id": 85454062, "body": "There is no type <code>Number</code>. The type <code>Num a =&gt; a -&gt; a -&gt; a</code> is more general than something like <code>Int -&gt; Int -&gt; Int</code>, but less general than <code>a -&gt; a -&gt; a</code>. Essentially, <code>(+)</code> is defined for some, but not all, types."}, {"owner": {"reputation": 13, "user_id": 9475735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/026429ec1cf004c3b793d56decf3a626?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Windisch", "link": "https://stackoverflow.com/users/9475735/thomas-windisch"}, "edited": false, "score": 0, "creation_date": 1520857768, "post_id": 49223533, "comment_id": 85473594, "body": "Currying - Is that how you make a curry? I looked it up and it is intuitive, i just didn&#39;t know that that is the notation used for Haskell type signatures."}], "answers": [{"tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": false, "score": 1, "last_activity_date": 1520796370, "last_edit_date": 1520796370, "creation_date": 1520794321, "answer_id": 49223780, "question_id": 49223533, "link": "https://stackoverflow.com/questions/49223533/how-to-read-type-signatures-in-haskell/49223780#49223780", "title": "How to Read Type Signatures in Haskell", "body": "<p>The two types for <code>(+)</code> you suggested are actually isomorphic (the same). To prove two things are isomorphic, we must show that there is a pair of invertible functions which go back and forth between the representations. These functions already exist in the standard library as <code>uncurry</code> and <code>curry</code></p>\n\n<pre><code>&gt; :t uncurry (+)\nuncurry (+) :: Num a =&gt; (a, a) -&gt; a\n\n&gt; let add (a, b) = a + b\n&gt; :t curry add\ncurry add :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Proving that <code>curry/uncurry</code> are actually inverses of each other is an exercise for the reader.</p>\n\n<p>To your second question \"why does <code>(+)</code> take one argument and return a function rather than a number\", this is called partial application. Calling <code>(+)</code> with a single argument returns a partially applied function that captures or \"closes over\" that argument. For example,</p>\n\n<pre><code>addOne :: Num a =&gt; a -&gt; a\naddOne = (1+)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 9475735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/026429ec1cf004c3b793d56decf3a626?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Windisch", "link": "https://stackoverflow.com/users/9475735/thomas-windisch"}, "edited": false, "score": 0, "creation_date": 1520857954, "post_id": 49223970, "comment_id": 85473705, "body": "Thanks for the in-depth explanation!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1520795432, "creation_date": 1520795432, "answer_id": 49223970, "question_id": 49223533, "link": "https://stackoverflow.com/questions/49223533/how-to-read-type-signatures-in-haskell/49223970#49223970", "title": "How to Read Type Signatures in Haskell", "body": "<p>The <code>(+)</code> function is used as a <em>binary operator</em>. Indeed: if you write:</p>\n\n<pre><code>5 + 2\n</code></pre>\n\n<p>you have, behind the curtains, written:</p>\n\n<pre><code>(+) 5 2\n</code></pre>\n\n<p>So you call the function with <code>5</code> and <code>2</code> as arguments. Now in Haskell every function takes exactly <em>one</em> argument as input. So <code>(+) 5 2</code> is actually a compact notation of:</p>\n\n<pre><code>((+) 5) 2\n</code></pre>\n\n<p>Indeed, we first takes <code>5</code> as argument for the <code>(+)</code> function, and this will produce a <em>new</em> function that takes as input a number and returns a number such that the outcome is five plus that number.</p>\n\n<p>We can thus define a function:</p>\n\n<pre><code>f5 = (+) 5\n</code></pre>\n\n<p>and then apply <code>f5</code> to for example <code>3</code> and <code>7</code>, and we will get <code>f5 3 = 8</code> and <code>f5 7 = 12</code>. So if we analyze the types, we will see that:</p>\n\n<pre><code>(+) :: Num a =&gt; a -&gt; (a -&gt; a)\n(+) 5 :: Num a =&gt; a -&gt; a\n((+) 5) 2 :: Num a =&gt; a\n</code></pre>\n\n<p>So now we can answer your question:</p>\n\n<blockquote>\n  <p>Why does it output a function and not a number?</p>\n</blockquote>\n\n<p>If it would immediately output a number, then we could only give it a single number, so in that case we would have written <code>(+) 5</code> and immediately obtain a number. The only logical way to do that would be to return <code>5</code> and thus let <code>(+)</code> act as a <em>unary operator</em> (an operator that takes one parameter into account). But in Haskell, the <code>(+)</code> is a binary operator.</p>\n\n<blockquote>\n  <p>Why is it not</p>\n\n<pre><code>:type (+)\n(+) :: (Number, Number) -&gt; Number\n</code></pre>\n</blockquote>\n\n<p>Haskell has a notion of tuples. But again that tuple is a <em>single</em> argument. In case we would construct such function, we would call it with:</p>\n\n<pre><code>f (2, 3)\n</code></pre>\n\n<p>If <code>f = (+)</code>, then <code>f (2, 3)</code> would result in <code>5</code>. But it is not very flexible. A frequent pattern in functional programming is taking a function, and apply a limited number of arguments on it (like we did with <code>f5 = (+) 5</code> and then pass that function as an argument again. By using tuples, we lose that flexibility.</p>\n\n<p>Since some functions work with tuples, there are two popular functions called <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:curry\" rel=\"nofollow noreferrer\"><strong><code>curry :: ((a, b) -&gt; c) -&gt; a -&gt; b -&gt; c</code></strong></a> and <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:uncurry\" rel=\"nofollow noreferrer\"><strong><code>uncurry :: (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c</code></strong></a>. These functions can transform a given function that takes a tuple as input into a function with two arguments, and vice versa.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; :t uncurry (+)\nuncurry (+) :: Num c =&gt; (c, c) -&gt; c\n</code></pre>\n\n<p>So by constructing <code>uncurry (+)</code> we have constructed a function that takes as input a 2-tuple.</p>\n\n<p>Note that <code>curry</code> and <code>uncurry</code> work only with 2-tuples (and thus two arguments). There are variants that work with more arguments, but these are not that popular.</p>\n\n<p>Usually using the approach of functions constructing more specialized functions allows more flexibility and thus are more useful.</p>\n\n<p>Say for instance I had an <code>uncurry</code> version of <code>(+)</code>:</p>\n\n<pre><code>uplus :: Num c =&gt; (c, c) -&gt; c\nuplus = uncurry (+)\n</code></pre>\n\n<p>Then how would I construct a partially applied function <code>f5 :: Num c =&gt; c -&gt; c</code> with that? I could write it like:</p>\n\n<pre><code>f5 :: Num c =&gt; c -&gt; c\nf5 x = uplus (5, x)\n</code></pre>\n\n<p>but this requires a lot more syntax. Furthermore if I extend <code>uplus</code> to work with 3-tuples. I have to introduce more variables (<code>y</code>, <code>z</code>, etc.) to write the partially applied function.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1520796391, "creation_date": 1520796391, "answer_id": 49224130, "question_id": 49223533, "link": "https://stackoverflow.com/questions/49223533/how-to-read-type-signatures-in-haskell/49224130#49224130", "title": "How to Read Type Signatures in Haskell", "body": "<blockquote>\n  <p>Why is it not</p>\n\n<pre><code>:type (+)\n(+) :: (Number, Number) -&gt; Number\n</code></pre>\n</blockquote>\n\n<p>I am assuming that with <code>Number</code> you mean any type in class <code>Num</code>.</p>\n\n<p>This would make ti possible to add an <code>Integer</code> (numeric type) and a <code>Complex Double</code> (another numeric type) and get as a result a <code>Rational</code>.\nWe can't really do that. </p>\n\n<p>We can only sum two values of the <em>same</em> numeric type, and obtain a result of the <em>same</em> type. We need to express that all these three numeric types are equal. This is done by the standard signature:</p>\n\n<pre><code>(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>If you instead consider <code>Number</code> as a single, specific, numeric type, then we could not add <code>Int</code>s, since that is a different type. We could remove all numeric types and use only <code>Number</code>, extending it to encompass complexes, rationals, integers, and all other numeric types. The programmer would then lose control of the underlying representation (making it hard to predict performance) and types would be much less precise: we can't guarantee that <code>length :: [a] -&gt; Number</code> does not return a complex number, for instance...</p>\n"}], "owner": {"reputation": 13, "user_id": 9475735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/026429ec1cf004c3b793d56decf3a626?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Windisch", "link": "https://stackoverflow.com/users/9475735/thomas-windisch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 49223970, "answer_count": 3, "score": 0, "last_activity_date": 1520796391, "creation_date": 1520792828, "question_id": 49223533, "link": "https://stackoverflow.com/questions/49223533/how-to-read-type-signatures-in-haskell", "title": "How to Read Type Signatures in Haskell", "body": "<p>I would like understand how the type signature works, in other words: I am baffled by the output I get from <code>:type</code>.</p>\n\n<pre><code> :type (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Why is it not</p>\n\n<pre><code> :type (+)\n(+) :: (Number, Number) -&gt; Number\n</code></pre>\n\n<p>instead?</p>\n\n<p>I understand that</p>\n\n<pre><code>(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>can be rewritten as</p>\n\n<pre><code>(+) :: Num a =&gt; a -&gt; (a -&gt; a)\n</code></pre>\n\n<p>which means that <code>(+)</code> takes an argument <code>a</code> and outputs a function with type <code>a -&gt;a</code>. Why does it output a function and not a number?</p>\n"}, {"tags": ["windows", "google-app-engine", "haskell", "docker", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 2007549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4938a3a24d781090702afa69346e264?s=128&d=identicon&r=PG", "display_name": "Emanuel Borsboom", "link": "https://stackoverflow.com/users/2007549/emanuel-borsboom"}, "edited": false, "score": 5, "creation_date": 1520786009, "post_id": 49222297, "comment_id": 85448162, "body": "If you want to really go nuts, here&#39;s a blog post about making a Docker image with a Haskell executable in &lt; 5 MB: <a href=\"https://www.fpcomplete.com/blog/2015/05/haskell-web-server-in-5mb\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2015/05/haskell-web-server-in-5mb</a>"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1520808544, "post_id": 49222297, "comment_id": 85455537, "body": "Thanks this works sorry I was trying to test it but had also been trying to switch to 16.04 which caused some trouble. I had seen the <code>FROM+COPY</code> somewhere but missed the <code>AS</code> so didn&#39;t follow where <code>--from</code> came from."}], "tags": [], "owner": {"reputation": 24981, "user_id": 1094246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dda38b3b4f0bd9b57759601a3652e520?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/1094246/robert"}, "is_accepted": true, "score": 7, "last_activity_date": 1520785805, "creation_date": 1520785805, "answer_id": 49222297, "question_id": 49222022, "link": "https://stackoverflow.com/questions/49222022/haskell-and-docker-reasonable-deployed-image-size/49222297#49222297", "title": "Haskell and Docker reasonable deployed image size?", "body": "<p>This is perfect for docker multi stage builds:</p>\n\n<p><a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" rel=\"noreferrer\">https://docs.docker.com/develop/develop-images/multistage-build/</a></p>\n\n<p>You can apply as follows:</p>\n\n<pre><code>FROM ubuntu:14.04 as mybuild\n\nENV APP_ROOT=/usr/share/app\n\nRUN apt-get update &amp;&amp; apt-get install curl -y &amp;&amp; curl -sSL https://get.haskellstack.org/ | sh\n\nCOPY . ${APP_ROOT}/\nWORKDIR ${APP_ROOT}/\nRUN stack setup\nRUN stack build\n\nFROM ubuntu:14.04\n\nCOPY --from=mybuild /path/to/app-exe /dest/app-exe #edit this line accordingly\n\nEXPOSE 8000\n\nENTRYPOINT [\"stack\",\"exec\",\"app-exe\"]\n</code></pre>\n\n<p>Everything before the second <code>FROM</code> is not included in the final image, except what you copy with <code>COPY --from</code>.</p>\n"}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 49222297, "answer_count": 1, "score": 5, "last_activity_date": 1520785805, "creation_date": 1520784138, "question_id": 49222022, "link": "https://stackoverflow.com/questions/49222022/haskell-and-docker-reasonable-deployed-image-size", "title": "Haskell and Docker reasonable deployed image size?", "body": "<p>I had tried building a PoC Happstack executable running in Google App Engine using this Dockerfile:</p>\n\n<pre><code>FROM ubuntu:14.04\n\nENV APP_ROOT=/usr/share/app\n\nRUN apt-get update &amp;&amp; apt-get install curl -y &amp;&amp; curl -sSL https://get.haskellstack.org/ | sh\n\nCOPY . ${APP_ROOT}/\nWORKDIR ${APP_ROOT}/\nRUN stack setup\nRUN stack build\n\nEXPOSE 8000\n\nENTRYPOINT [\"stack\",\"exec\",\"app-exe\"]\n</code></pre>\n\n<p>This works and I was able to deploy, but the resulting image seems huge.</p>\n\n<p>I think the image is about 450MB following the <code>stack</code> installation, about 1.8GB following <code>stack setup</code>, and about 3GB following <code>stack build</code>.</p>\n\n<p>I think hundreds of MB seems reasonable, even up to a GB. Is there a different approach I should be taking, perhaps extracting the resulting executable to another image somehow to eliminate everything unnecessary at runtime?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520782253, "post_id": 49221677, "comment_id": 85446876, "body": "No, the problem is that you can not simply use <code>&#47;</code> on integers."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1520782874, "creation_date": 1520782874, "answer_id": 49221810, "question_id": 49221677, "link": "https://stackoverflow.com/questions/49221677/haskell-instance-of-fractional-int-required-for-definition-of-average/49221810#49221810", "title": "haskell Instance of Fractional Int required for definition of average", "body": "<p>You have given a definition so that is not the problem. The problem is that Haskell can not apply the <code>/</code> operator on two <code>Int</code>s, indeed:</p>\n\n<pre><code>Prelude&gt; (2 :: Int) / 3\n\n&lt;interactive&gt;:1:1: error:\n    \u2022 No instance for (Fractional Int) arising from a use of \u2018/\u2019\n    \u2022 In the expression: (2 :: Int) / 3\n      In an equation for \u2018it\u2019: it = (2 :: Int) / 3\n</code></pre>\n\n<p>Here in the terminal we want to divide <code>2</code> with <code>3</code>. We force Haskell to use an <code>Int</code> for the <code>2</code>, and it complains about the same thing.</p>\n\n<p>The reason is that <code>(/)</code> is defined in <code>Fractional</code>:</p>\n\n<pre><code>class Num a =&gt; Fractional a where\n  (/) :: a -&gt; a -&gt; a\n  recip :: a -&gt; a\n  fromRational :: Rational -&gt; a\n  {-# MINIMAL fromRational, (recip | (/)) #-}\n</code></pre>\n\n<p>as you can see, the definition states that all <code>Fractional</code>s are <code>Num</code>s, but not all <code>Num</code>s are <code>Fractional</code>s. That is logical. Notice the signature of <code>(/) :: a -&gt; a -&gt; a</code>. If we would use that on <code>Int</code>s, it would have signature <code>(/) :: Int -&gt; Int -&gt; Int</code>. But that would mean that <code>2/3</code> would be <code>0</code> or <code>1</code> (given we take the closest results). Buth are quite off. Since people would make a lot of errors with this, the designers of the Haskell library decided <em>not</em> to make <code>Int</code> a <code>Fractional</code>, but offered a <code>div</code> function for <em>integral</em> division.</p>\n\n<p>Of course this is not helping us much. Since we probably do not want the result to be an <code>Int</code> in the first place. So what we can do is <em>convert</em> the <code>length</code> result to a <code>Fractional</code>. We can do this for instance with the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:fromIntegral\" rel=\"nofollow noreferrer\"><strong><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code></strong></a> function. So we can then redefine the function as:</p>\n\n<pre><code>average :: Fractional a =&gt; [a] -&gt; a\naverage xs = sum xs / fromIntegral (length xs)\n</code></pre>\n\n<p>Note that here the type of the <em>elements</em> of the list decide what the type of the output of average will be. That type needs to be <code>Fractional</code> as well. So we can not process a list of <code>Int</code>s, unless we thus first preprocess the list (for instance calling <code>fromIntegral</code> to the elements of the list). In case the list contains integral elements, we can first calculate the sum, and then convert it to a <code>Fractional</code> (since then the result will be more precise). We can then define it like:</p>\n\n<pre><code>integrals_average :: (Integral a, Fractional b) =&gt; [a] -&gt; b\nintegrals_average xs = fromIntegral (sum xs) / fromIntegral (length xs)\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 9334592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916e57d2232be4b4a5f99a1e06182f95?s=128&d=identicon&r=PG&f=1", "display_name": "SyedaAyesha Kirmani", "link": "https://stackoverflow.com/users/9334592/syedaayesha-kirmani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "accepted_answer_id": 49221810, "answer_count": 1, "score": 2, "last_activity_date": 1520796657, "creation_date": 1520782187, "last_edit_date": 1520796657, "question_id": 49221677, "link": "https://stackoverflow.com/questions/49221677/haskell-instance-of-fractional-int-required-for-definition-of-average", "title": "haskell Instance of Fractional Int required for definition of average", "body": "<p>i got this error while writing my average function which is as follow</p>\n\n<pre><code>module Assignment where\n\naverage xs = sum xs / length xs\n</code></pre>\n\n<p>what does it actually want?\nis it asking for definition ? I provided that too but same error occured</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520779594, "post_id": 49221258, "comment_id": 85445997, "body": "Well <code>pad</code> does not work correct in case the number of characters in the string is odd."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 2, "creation_date": 1520779829, "post_id": 49221258, "comment_id": 85446079, "body": "If it&#39;s already working, <a href=\"https://codereview.stackexchange.com\">Code Review</a> is a better site."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520780790, "post_id": 49221258, "comment_id": 85446369, "body": "@WillemVanOnsem I have edited my question. the required width will always be odd. See the expected output above"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520780975, "post_id": 49221258, "comment_id": 85446432, "body": "@matthias: but then it would not work in case the input string is even. If the difference of length of the string, and the expected length is odd, you can not split it over the two parts evenly."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520781887, "post_id": 49221258, "comment_id": 85446749, "body": "@WillemVanOnsem yes that is fine. The canvas will always have an odd width and the element in the middle that is to be padded out will itself always be odd."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1520781911, "post_id": 49221258, "comment_id": 85446762, "body": "You can, however, make either the leading or trailing pad <code>(div n 2) + rem n 2</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520795618, "post_id": 49221258, "comment_id": 85451496, "body": "@matthias: although you can of course add such contracts yourself. It is usually a good idea to not assume anything that is not enforced by the type system. After all, if the type system allows it, a programmer can call the function with all possible values. So in that case it is better to return something that makes sense.\\"}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1520785350, "creation_date": 1520785350, "answer_id": 49222232, "question_id": 49221258, "link": "https://stackoverflow.com/questions/49221258/haskell-padding-out-elements-of-a-list/49222232#49222232", "title": "Haskell: padding out elements of a list", "body": "<p>Top level declarations should always have an explicit type.</p>\n\n<p>I know that you say the total number of padding underscores will always be even, but it is never a good idea to build that kind of assumption into your code. Instead you should make your functions correct under all inputs if possible. That way you don't get hidden bugs when something changes and your assumption is no longer correct.</p>\n\n<p>You should also make the padded width a parameter for the same reason. You can always create a specialized version as well.</p>\n\n<p>Putting these things together, an improved version would be:</p>\n\n<pre><code>pad' :: Int -&gt; String -&gt; String\npad' n x = replicate s1 '_' ++ x ++ replicate s2 '_'\n  where \n    len = length x\n    s1 = (n - len) `div` 2\n    s2 = n - s1 - len\n\npad11 :: String -&gt; String\npad11 = pad' 11\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520785350, "creation_date": 1520779537, "last_edit_date": 1520780725, "question_id": 49221258, "link": "https://stackoverflow.com/questions/49221258/haskell-padding-out-elements-of-a-list", "title": "Haskell: padding out elements of a list", "body": "<p>I have a list: <code>[\"1\", \"111\", \"11111\", \"1111111\"]</code> and I would like to pad out each element with underscores to a length of 11 with the the original element in the middle i.e. <code>[\"_____1_____\",\"____111____\",\"___11111___\",\"__1111111__\"]</code></p>\n\n<p>I am using:</p>\n\n<pre><code>pad' x = s ++ x ++ s\n  where \n    s = replicate ((11 - length x) `div` 2 ) '_'\n</code></pre>\n\n<p>is there a tidier/more efficient way to do this?</p>\n\n<p>NB the required width will always be odd</p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 4, "creation_date": 1520768713, "post_id": 49219577, "comment_id": 85442823, "body": "The pattern <code>2^0, 2^1, 2^1 +1, 2^2, 2^2 +1, 2^2 +2, 2^2 +3 .. </code> would just create the list of positive integers. That does not match the list you showed above."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1520768881, "post_id": 49219577, "comment_id": 85442874, "body": "An attempt from your side? The specifications do not fully match the sample output."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1520769535, "post_id": 49219577, "comment_id": 85443038, "body": "Since you claim you can create such list, it would be interesting to share the code for that."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1520778123, "last_edit_date": 1520778123, "creation_date": 1520776963, "answer_id": 49220831, "question_id": 49219577, "link": "https://stackoverflow.com/questions/49219577/how-can-i-create-such-list-in-haskell-using-list-comprehension/49220831#49220831", "title": "How can I create such list in Haskell using list comprehension", "body": "<p>Based on your example, the list looks like:</p>\n\n<pre><code> 2\n 4  5\n 8  9 10 11\n16 17 18 19 20 21 22 23\n32 33 34 35 36 37 38 39 40 41 ...\n</code></pre>\n\n<p>So for every <em>i</em> from 1 to infinity, we yield the elements in the range <em>[2<sup>i</sup>,2<sup>i</sup>+2<sup>i-1</sup>)</em>. We can write this directly into  list comprehension:</p>\n\n<pre><code>[ j | i &lt;- [1..], j &lt;- [2^i .. 2^i + 2^(i-1) - 1] ]\n</code></pre>\n\n<p>We can also let <code>i</code> take powers of two, and yield elements between <code>i</code>, and <code>div (3*i) 2</code> (exclusive), so:</p>\n\n<pre><code>[ j | i &lt;- iterate (2*) 2, j &lt;- [i .. div (2*i) 3 - 1] ]\n</code></pre>\n\n<p>We can turn that also into a list monad, like:</p>\n\n<pre><code>iterate (*2) 2 &gt;&gt;= \\i -&gt; [i..div (3*i) 2 - 1]\n</code></pre>\n\n<p>or more point-free (and point-less):</p>\n\n<pre><code>import Control.Monad(ap)\n\niterate (*2) 2 &gt;&gt;= ap enumFromTo (pred . flip div 2 . (3 *))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": false, "score": 0, "last_activity_date": 1520781235, "creation_date": 1520781235, "answer_id": 49221519, "question_id": 49219577, "link": "https://stackoverflow.com/questions/49219577/how-can-i-create-such-list-in-haskell-using-list-comprehension/49221519#49221519", "title": "How can I create such list in Haskell using list comprehension", "body": "<p>One could try to write the i<em>th</em> term of the list using a function <em>f</em>(<em>i</em>), where i >= 0 </p>\n\n<p>The overall infinite list can be represented as</p>\n\n<p><code>L_0 ++ L_1 ++ L_2 ++ ...</code></p>\n\n<p>where each L_n is a finite list of the form</p>\n\n<p><code>L_n = [ 2^(n+1), 2^(n+1) + 1, ..., 2^(n+1) + (2^n - 1) ]</code></p>\n\n<p>The size of L_n is 2^n and we know that for any k, 2^0 + 2^1 + ... + 2^k = 2^(k+1) - 1 (it's a geometric progression) so if we're asked to find which finite list the i<em>th</em> term of the infinite list is in, we can find the highest integer m for which i >= 2^m - 1. Once that's done, we can safely say the i<em>th</em> term is in L_m. We can <em>also</em> say that the i<em>th</em> term of the infinite list is the (i - 2^m + 1)<em>th</em> element of L_m.</p>\n\n<p>This allows us to define the final sequence (let's call it thatList) as</p>\n\n<p><code>thatList :: [Int]\n thatList = [ f i | i &lt;- [0..] ]</code></p>\n\n<p>and</p>\n\n<p><code>f :: Int -&gt; Int\n f i = (2 ^ (m + 1)) + (i - (2 ^ m) + 1)\n         where\n     m = floor (logBase 2 (fromIntegral i + 1))</code></p>\n"}], "owner": {"reputation": 87, "user_id": 7714503, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/85baa6296d02f229da40a98a4c4f696d?s=128&d=identicon&r=PG&f=1", "display_name": "Nagato", "link": "https://stackoverflow.com/users/7714503/nagato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 49220831, "answer_count": 2, "score": 2, "last_activity_date": 1520781235, "creation_date": 1520768372, "last_edit_date": 1520776985, "question_id": 49219577, "link": "https://stackoverflow.com/questions/49219577/how-can-i-create-such-list-in-haskell-using-list-comprehension", "title": "How can I create such list in Haskell using list comprehension", "body": "<p>So I need to create such list </p>\n\n<pre><code>[2,4,5,8,9,10,11,16,17,18,19,20,21,22,23,32 ..]\n</code></pre>\n\n<p>The pattern goes as follows:\n2^1,2^2, 2^2 +1, 2^3, 2^3 +1, 2^3 +2, 2^3 +3 .. So the number of repeats of (2^n +1, 2^n +2 .. is also doubling with each go ) I hope you got the point. \nI can create such list using functions in Haskell but I was interested whether or not it is possible to do it using solely list Comprehension</p>\n\n<p>EDIT: Some people asked me to demonstrate a functional approach to this problem. Here it is </p>\n\n<pre><code>rep _ 0 = []\nrep a b = a : rep (a+1) (b-1)\ncreatelist a = rep (2^(a+1)) (2^a)  ++ createlist (a+1))\n</code></pre>\n\n<p>So if we say `take 50 (createlist 0) the results would be </p>\n\n<pre><code>[2,4,5,8,9,10,11,16,17,18,19,20,21,22,23,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82]\n</code></pre>\n\n<p>So you always need to call the function with initial parameter 0. It is really a nasty solution I would like to make it easier. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1520755421, "post_id": 49217768, "comment_id": 85439664, "body": "I think you make the comparisons rather hard to begin with."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1520757903, "post_id": 49217768, "comment_id": 85440202, "body": "The answers below suggest the right solution. However, you should turn on warnings! Above you missed the case <code>eqAssert (Vec1 []) (Vec1 (x:xs))</code>, making your program crash when the first list is shorter -- warnings can spot this for you. Further, there is no reason to check for the length, since it is implied by the other checks. Finally, your <code>if</code>s are hard to read, and could be replaced by <code>... &amp;&amp; ... &amp;&amp; ...</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520770096, "post_id": 49217768, "comment_id": 85443219, "body": "On the warnings chi mentions, see also: <a href=\"https://stackoverflow.com/questions/2737650/better-exception-for-non-exhaustive-patterns-in-case\"><i>Better exception for non-exhaustive patterns in case</i></a>"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1520755702, "creation_date": 1520755702, "answer_id": 49217966, "question_id": 49217768, "link": "https://stackoverflow.com/questions/49217768/haskell-override-function/49217966#49217966", "title": "Haskell override function", "body": "<p>You can take advantage of the fact that both <code>Integer</code> and <code>String</code> are <code>Eq</code> instances, and for all <code>Eq a</code>, <code>[a]</code> is also an instance of <code>Eq</code>.</p>\n\n<p>You you can pattern-match the lists out of their data constructors and compare them:</p>\n\n<pre><code>eqAssert :: MyVector -&gt; MyVector -&gt; Bool\neqAssert (Vec1 xs) (Vec1 ys) = xs == ys\neqAssert (VecS xs) (VecS ys) = xs == ys\neqAssert        _         _  = False\n</code></pre>\n\n<p>Why not make <code>MyVector</code> an instance of <code>Eq</code>, though?</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1520765164, "post_id": 49217977, "comment_id": 85441918, "body": "N.B. this is exactly the function that <code>deriving (Eq)</code> would write for you."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1520774607, "post_id": 49217977, "comment_id": 85444445, "body": "@luqui: yes, although that would imply that we make it an instance of <code>Eq</code> and furthermore that we thus loose the freedom to implement <code>(==)</code> in another way. But you are right."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1520774697, "last_edit_date": 1520774697, "creation_date": 1520755754, "answer_id": 49217977, "question_id": 49217768, "link": "https://stackoverflow.com/questions/49217768/haskell-override-function/49217977#49217977", "title": "Haskell override function", "body": "<p>I think you aim to do too much work yourself. Haskell has an <code>Eq</code> typeclass, and an equality check <code>(==) :: Eq a =&gt; a -&gt; a -&gt; a</code> function for that.</p>\n\n<p>Furthermore in Haskell for every <code>a</code> such that <code>Eq a</code> holds, it also means that <code>Eq [a]</code> holds. In that case the equality check is done on lists such that two lists are equal given these have the same number of elements, and if we enumerate the two lists in parallel, each element of the first list is equal to the corresponding element in the other list.</p>\n\n<p>So wen can simplify the function like:</p>\n\n<pre><code>eqAssert :: MyVector -&gt; MyVector -&gt; Bool\neqAssert (Vec1 a) (Vec1 b) = a == b\neqAssert (VecS a) (VecS b) = a == b\neqAssert _ _ = False\n</code></pre>\n\n<p>So the function has three clauses. The first one deels with two <code>Vec1</code>s, in that case we check the equality of the two lists <code>a</code> and <code>b</code>. The second clause is almost identical, except that we check for two <code>VecS</code>s. Finally we use <code>eqAssert _ _</code>. Here <code>_</code> is a wildcard: it matches everything. The remaining patterns are <code>(Vec1 a) (VecS b)</code> and <code>(VecS a) (Vec1 b)</code> regardless what <code>a</code> and <code>b</code> are, we simply return <code>False</code> in that case.</p>\n\n<p>It is furthermore a bit odd to implement an <code>eqAssert</code> here. We can make it <em>automatically</em> an instance of <code>Eq</code>, in that case Haskell will implement an <code>(==)</code> function for <code>MyVector</code> automatically. So we can write:</p>\n\n<pre><code>data MyVector = Vec1 [Integer] | VecS[String] <b>deriving Eq</b></code></pre>\n\n<p>and then use <code>myvec1 == myvec2</code> instead.</p>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 49217977, "answer_count": 2, "score": 2, "last_activity_date": 1520774697, "creation_date": 1520754093, "last_edit_date": 1520755191, "question_id": 49217768, "link": "https://stackoverflow.com/questions/49217768/haskell-override-function", "title": "Haskell override function", "body": "<p>I try to write a function to check whether two vectors are equal or not:</p>\n\n<pre><code>Compare Vec1 [1, 2, 3]   Vec1 [1, 2, 4]\nCompare VecS [\"a\",\"b\", \"c\"] VecS [\"a\", \"b\", \"d\"]\n</code></pre>\n\n<p>However, on my function I have \"almost\" identical implementation for both cases,</p>\n\n<p>is there a way to <strong>simplify</strong> my code so that it has only one implementation for Integer and String</p>\n\n<pre><code>data MyVector = Vec1 [Integer] | VecS[String]  \n\neqAssert::MyVector-&gt;MyVector-&gt;Bool\neqAssert (Vec1 []) (Vec1 []) = True\neqAssert (Vec1  _) (Vec1 []) = False \neqAssert (Vec1 (x:cx)) (Vec1 (y:cy)) =\n  if length (x:cx) /= length (y:cy)\n    then False\n    else (if x /= y then False else eqAssert (Vec1 cx) (Vec1 cy))\n\neqAssert (VecS []) (VecS []) = True\neqAssert (VecS  _) (VecS []) = False \neqAssert (VecS (x:cx)) (VecS (y:cy)) =\n  if length (x:cx) /= length (y:cy)\n    then False\n    else (if x /= y then False else eqAssert (VecS cx) (VecS cy))\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1122, "user_id": 892584, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4403f52eda5458b0ce029c80a379a09d?s=128&d=identicon&r=PG", "display_name": "Chase Walden", "link": "https://stackoverflow.com/users/892584/chase-walden"}, "edited": false, "score": 0, "creation_date": 1520807248, "post_id": 49217133, "comment_id": 85455184, "body": "That is very concise. Thank you. I guess I will take a leap into using the extensions. It is funny how many of these extensions have been around since Haskell 98 and they&#39;re not just standard in the language yet."}], "tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": true, "score": 2, "last_activity_date": 1520793471, "last_edit_date": 1520793471, "creation_date": 1520747872, "answer_id": 49217133, "question_id": 49217019, "link": "https://stackoverflow.com/questions/49217019/haskell-ast-reduction-causing-type-issues/49217133#49217133", "title": "Haskell: AST reduction causing type issues", "body": "<pre><code>class ... where\n  simplify :: (Expr a, ...) =&gt; ... -&gt; (a o)\n</code></pre>\n\n<p>This declaration means than you need to be able to construct <code>a o</code> for any type which is in class Expr, selected by usage of <code>simplify</code>. You cannot specify in instances concrete type.</p>\n\n<p><strong>Edit</strong>: you could introduce into Expr a construction:</p>\n\n<pre><code>class Expr e where\n    ...\n    constant :: a -&gt; e a\n    add :: e a -&gt; e a -&gt; e a\n    ...\n</code></pre>\n\n<p>And use those. Though expressions like (add _ _ :: Constant Int) would not make sense.</p>\n\n<p><strong>What you could do</strong> is to <strong>specify class with dependency</strong>:</p>\n\n<pre><code>class Simplify e1 e2 | e1 -&gt; e2 where ...\n</code></pre>\n\n<p>Or <strong>with type family</strong>:</p>\n\n<pre><code>class Simplify e where\n    data Simplified e :: *\n    ....\n</code></pre>\n\n<p>They would need corresponding extensions, but you should not fear it. That's what modern Haskell is.</p>\n"}], "owner": {"reputation": 1122, "user_id": 892584, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4403f52eda5458b0ce029c80a379a09d?s=128&d=identicon&r=PG", "display_name": "Chase Walden", "link": "https://stackoverflow.com/users/892584/chase-walden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 49217133, "answer_count": 1, "score": 1, "last_activity_date": 1520793471, "creation_date": 1520746731, "question_id": 49217019, "link": "https://stackoverflow.com/questions/49217019/haskell-ast-reduction-causing-type-issues", "title": "Haskell: AST reduction causing type issues", "body": "<p>I have the following code for an extensible AST. My goal was to allow more expression types to be added later with the <code>Expr</code> class and not have all of the types in a single data block.</p>\n\n<pre><code>data Constant o = Constant o deriving (Show)\ndata Add l r o = Add (l o) (r o) deriving (Show)\n\nclass Expr e where\n  simplify :: (Expr a, Num o) =&gt; (e o) -&gt; (a o)\n\ninstance Expr Constant where\n  simplify (Constant a) = Constant a\n\ninstance (Expr l, Expr r) =&gt; Expr (Add l r) where\n  simplify (Add l r) = case (simplify l, simplify r) of\n    (Conatant a, Constant b) -&gt; Constant $ a + b\n    (sl@_, sr@_) -&gt; Add sl sr\n</code></pre>\n\n<p>I'm running into these errors:</p>\n\n<pre><code>math.hs:10:27: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018Constant\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          simplify :: forall (a :: * -&gt; *) o.\n                      (Expr a, Num o) =&gt;\n                      Constant o -&gt; a o\n        at math.hs:10:3-10\n      Expected type: a o\n        Actual type: Constant o\n    \u2022 In the expression: Constant a\n      In an equation for \u2018simplify\u2019: simplify (Constant a) = Constant a\n      In the instance declaration for \u2018Expr Constant\u2019\n    \u2022 Relevant bindings include\n        simplify :: Constant o -&gt; a o (bound at math.hs:10:3)\n\nmath.hs:15:21: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018Add l0 r0\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          simplify :: forall (a :: * -&gt; *) o.\n                      (Expr a, Num o) =&gt;\n                      Add l r o -&gt; a o\n        at math.hs:13:3-10\n      Expected type: a o\n        Actual type: Add l0 r0 o\n    \u2022 In the expression: Add sl sr\n      In a case alternative: (sl@_, sr@_) -&gt; Add sl sr\n      In the expression:\n        case (simplify l, simplify r) of { (sl@_, sr@_) -&gt; Add sl sr }\n    \u2022 Relevant bindings include\n        sr :: r0 o (bound at math.hs:15:12)\n        sl :: l0 o (bound at math.hs:15:6)\n        simplify :: Add l r o -&gt; a o (bound at math.hs:13:3)\n</code></pre>\n\n<p>I can't understand why this doesn't work. Then again, I am fairly new to Haskell from spending almost a decade in OOP land. I'm hoping someone can give me insight on this. </p>\n\n<p>I am trying to do this without any GHC extensions, since I want to understand the vanilla language before I start adding more.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1520741241, "post_id": 49216369, "comment_id": 85437082, "body": "In your actual problem, do you know what <code>D</code> is? Because if it&#39;s really something polymorphic, you&#39;re going to struggle mightily to make a rewrite rule work on it."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 5, "last_activity_date": 1520739875, "creation_date": 1520739875, "answer_id": 49216431, "question_id": 49216369, "link": "https://stackoverflow.com/questions/49216369/writing-a-rewrite-rule-involving-rank-n-types/49216431#49216431", "title": "Writing a rewrite rule involving rank-n types", "body": "<p>Polymorphic free variables in <code>RULES</code> must have type signatures. Simply use</p>\n\n<pre><code>{-# RULES\n\"f2/f1\" forall (x :: forall t. t -&gt; D t). f2 (f1 x) = x\n  #-}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1520741250, "post_id": 49216487, "comment_id": 85437083, "body": "Thanks for the reply @dfuser. Perhaps my simplifications have hidden something here, which is my fault, and I&#39;ve now noted this in my answer. Not that my code never actually defines <code>g</code>, just <code>f1</code> and <code>f2</code>, defining <code>g</code> was just for illustrative purposes to show <code>f1 . f2 == id</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1520741334, "post_id": 49216487, "comment_id": 85437092, "body": "@Clinton, perhaps, but I think you&#39;ll likely still find it hard to be entirely correct, <i>especially</i> if you trust other people&#39;s <code>Functor</code> instances. Can you maybe ask about your actual problem? That could be more interesting to look at."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1520741447, "post_id": 49216487, "comment_id": 85437107, "body": "I think I&#39;ll finish the library as is, using what @HTNW has suggested, whack it up on github and drop a link here to the actual code."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1520740479, "creation_date": 1520740479, "answer_id": 49216487, "question_id": 49216369, "link": "https://stackoverflow.com/questions/49216369/writing-a-rewrite-rule-involving-rank-n-types/49216487#49216487", "title": "Writing a rewrite rule involving rank-n types", "body": "<p>HTNW got the answer written faster than I could. But let me address your underlying concern. If I define</p>\n\n<pre><code>g :: (forall t'. t' -&gt; D t') -&gt; t -&gt; D t\ng x = f2 (f1 x)\n</code></pre>\n\n<p>and compile with <code>-O2 -ddump-simpl -dsuppress-coercions -dsuppress-idinfo</code>, I get</p>\n\n<pre><code>Clinton.g1\n  :: forall t_aGp.\n     (forall t'_aqH. t'_aqH -&gt; D t'_aqH) -&gt; t_aGp -&gt; D (T t_aGp)\nClinton.g1 =\n  \\ (@ t_aGp)\n    (x_aqY :: forall t'_aqH. t'_aqH -&gt; D t'_aqH)\n    (x1_Xrz :: t_aGp) -&gt;\n    x_aqY @ (T t_aGp) (x1_Xrz `cast` ...)\n\n-- RHS size: {terms: 1, types: 0, coercions: 16}\ng :: forall t_aqG.\n     (forall t'_aqH. t'_aqH -&gt; D t'_aqH) -&gt; t_aqG -&gt; D t_aqG\ng = Clinton.g1 `cast` ...\n</code></pre>\n\n<p>Ignoring the type arguments and casts, which go away in code generation, this basically says</p>\n\n<pre><code>g f y = f y\n</code></pre>\n\n<p>which is pretty darn good. With your rewrite rule, we get</p>\n\n<pre><code>g :: forall t_aqG.\n     (forall t'_aqH. t'_aqH -&gt; D t'_aqH) -&gt; t_aqG -&gt; D t_aqG\ng =\n  \\ (@ t_aGr) (x_aqY :: forall t'_aqH. t'_aqH -&gt; D t'_aqH) -&gt;\n    x_aqY @ t_aGr\n</code></pre>\n\n<p>which is basically</p>\n\n<pre><code>g f = f\n</code></pre>\n\n<p>Better? Well, sort of. They're actually slightly <em>different</em>. Without the rewrite rule,</p>\n\n<pre><code>g undefined `seq` () = ()\n</code></pre>\n\n<p>With the rule,</p>\n\n<pre><code>g undefined `seq` () = undefined\n</code></pre>\n\n<p>Personally, I don't like to use rewrite rules that change semantics <em>at all</em>, and most especially ones that can reduce definedness, so I'd never write that one.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 49216431, "answer_count": 2, "score": 4, "last_activity_date": 1520740950, "creation_date": 1520739159, "last_edit_date": 1520740950, "question_id": 49216369, "link": "https://stackoverflow.com/questions/49216369/writing-a-rewrite-rule-involving-rank-n-types", "title": "Writing a rewrite rule involving rank-n types", "body": "<p>Below is a simplified version of a very similar problem I'm facing.</p>\n\n<p>Consider the following types, and the function <code>f1</code>:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nnewtype D t = D t deriving Functor\nnewtype T t = T { getT :: t }\n\nf1 :: (forall t'. t' -&gt; D t') -&gt; T t -&gt; D (T t)\n</code></pre>\n\n<p>Notice that <code>f1</code> can actually be <code>id</code>, because if we get passed function that works for all <code>t</code> we can of course specialise it like so:</p>\n\n<pre><code>f1 = id\n</code></pre>\n\n<p>Now lets consider the \"inverse\" function, <code>f2</code>:</p>\n\n<pre><code>f2 :: (T t -&gt; D (T t)) -&gt; t -&gt; D t\n</code></pre>\n\n<p>This \"unspecialises\" the function, which can be implemented as follows:</p>\n\n<pre><code>f2 f x = getT &lt;$&gt; (f (T x))\n</code></pre>\n\n<p>We can combine <code>f2</code> and <code>f1</code> as follows, which is basically an identity function: </p>\n\n<pre><code>g :: (forall t'. t' -&gt; D t') -&gt; t -&gt; D t\ng x = f2 (f1 x)\n</code></pre>\n\n<p>Indeed, <code>g</code> is pretty much equivalent to the <code>id</code> function, and indeed we can instead define <code>g</code> as follows:</p>\n\n<pre><code>g = id\n</code></pre>\n\n<p>So we've established as <code>f2 . f1 == id</code>. </p>\n\n<p>But when we write <code>f2 . f1</code>, I suspect GHC may not compile that down to <code>id</code>, because, <code>f2</code> at least does some non trivial work. </p>\n\n<p>I'd like to write a rewrite rule for <code>f2 . f1</code>, and here's my attempt:</p>\n\n<pre><code>{-# RULES\n\"f2f1\" forall x. f2 (f1 x) = g x\n#-}\n</code></pre>\n\n<p>As <code>g</code> as can be defined as <code>id</code> I figured this might be good.</p>\n\n<p>But unfortunately this fails to compile. I suspect this is due to the higher ranked type in <code>f1</code>.</p>\n\n<p>I realise if I changed the type signature of <code>f1</code> like follows:</p>\n\n<pre><code>f1 :: (t -&gt; D t) -&gt; T t -&gt; D (T t)\nf1 f x = T &lt;$&gt; f (getT x) \n</code></pre>\n\n<p>I could write a rewrite rule like follows:</p>\n\n<pre><code>{-# RULES\n\"f2f1\" forall x. f2 (f1 x) = x\n#-}\n</code></pre>\n\n<p>But now whenever I use <code>f1</code> it isn't just <code>id</code>, but quite a bit more complex.</p>\n\n<p>Is there a way to write a rewrite rule like <code>f2 . f1 == id</code>, without giving <code>f1</code> an non <code>id</code> style implementation?</p>\n\n<p><strong>Further information:</strong></p>\n\n<p>Note that in my actual problem, both <code>D</code> and <code>T</code> are not newtypes. </p>\n\n<p><code>D</code> is any <code>Functor f</code>, and <code>T</code> is actually a <a href=\"https://hackage.haskell.org/package/kan-extensions-5.1/docs/Data-Functor-Coyoneda.html#t:Coyoneda\" rel=\"nofollow noreferrer\"><code>Coyoneda</code></a>, following on from <a href=\"https://stackoverflow.com/questions/48848571/generalised-newtype-deriving-on-class-functions-with-functors\">this previous question regarding newtype deriving</a>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1520737139, "post_id": 49216186, "comment_id": 85436440, "body": "They are not the same. <code>Ord a =&gt; [a] -&gt; a</code> means a function that produces a value of type <code>a</code> for a list of values of type <code>a</code> where <code>a</code> is any type that is totally ordered (has an <code>Ord</code> instance). <code>Int</code>s fit that definition, but so do many other types. You can use the second <code>func</code> on strings, floats, \u2026"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520737490, "post_id": 49216186, "comment_id": 85436483, "body": "To further clarify your question: before Ryan&#39;s explanation, how would you have explained what <code>(Ord a) =&gt; [a] -&gt; a</code> means?"}], "answers": [{"tags": [], "owner": {"reputation": 346, "user_id": 9471091, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3u7syQcEK7E/AAAAAAAAAAI/AAAAAAAAABw/YYdbq_1w6uY/photo.jpg?sz=128", "display_name": "Stephano", "link": "https://stackoverflow.com/users/9471091/stephano"}, "is_accepted": true, "score": 5, "last_activity_date": 1520737699, "last_edit_date": 1520737699, "creation_date": 1520737432, "answer_id": 49216219, "question_id": 49216186, "link": "https://stackoverflow.com/questions/49216186/how-does-these-two-notations-differ-in-haskell/49216219#49216219", "title": "How does these two notations differ in Haskell?", "body": "<p>The first one is very simple and as you have said, it takes a list of <code>Int</code> and returns a single <code>Int</code>.</p>\n\n<p>The second one, however, can accept many different types for its input (including types you define yourself).</p>\n\n<p>The key is <code>(Ord a)</code>. What this is saying is that it has to be a list of <strong>orderable</strong> types, and if it satisfies that requirement then it is a valid type that can be passed into this particular function.</p>\n\n<p>The Ord typeclass includes the following members:</p>\n\n<ul>\n<li><code>&lt;</code></li>\n<li><code>&lt;=</code></li>\n<li><code>&gt;</code></li>\n<li><code>&gt;=</code></li>\n</ul>\n\n<p>So</p>\n\n<pre><code>func :: (Ord a) =&gt; [a] -&gt; a\n</code></pre>\n\n<p>could potentially be a function that takes a list of orderable types and returns the maximum member of that list, as an example. This could be <code>[Int]</code>, <code>[Integer]</code>, <code>[Float]</code>, and many other things.</p>\n"}], "owner": {"reputation": 5029, "user_id": 8836582, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5f737b956bfd27d77d622fb17290f5d5?s=128&d=identicon&r=PG&f=1", "display_name": "Dawn17", "link": "https://stackoverflow.com/users/8836582/dawn17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 49216219, "answer_count": 1, "score": 0, "last_activity_date": 1520739302, "creation_date": 1520736977, "last_edit_date": 1520739302, "question_id": 49216186, "link": "https://stackoverflow.com/questions/49216186/how-does-these-two-notations-differ-in-haskell", "title": "How does these two notations differ in Haskell?", "body": "<p>I am new to Haskell and still kind of confused with some notations.</p>\n\n<p>In the function header, i know that</p>\n\n<pre><code>func :: [Int] -&gt; Int\n</code></pre>\n\n<p>indicates that the input is a list of integers and the output is an integer.</p>\n\n<p>How does this differ from</p>\n\n<pre><code>func :: (Ord a) =&gt; [a] -&gt; a\n</code></pre>\n\n<p>I am asking because they seem to be same, and I wonder why we use different notations for something identical.</p>\n"}, {"tags": ["haskell", "monads", "fold"], "answers": [{"comments": [{"owner": {"reputation": 152, "user_id": 3832665, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/520fa46dfc3474e5183d8810bc4ee58b?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/3832665/james"}, "edited": false, "score": 1, "creation_date": 1520777586, "post_id": 49216036, "comment_id": 85445356, "body": "Thanks so much! Would it be possible for you to tell me why I intended that? No problem if not"}], "tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": true, "score": 4, "last_activity_date": 1520751006, "last_edit_date": 1520751006, "creation_date": 1520735051, "answer_id": 49216036, "question_id": 49215816, "link": "https://stackoverflow.com/questions/49215816/converting-a-fold-to-a-monadic-fold-haskell/49216036#49216036", "title": "Converting a fold to a monadic fold haskell", "body": "<p>The problem is from here:</p>\n\n<pre><code>     mon (Question s xs) = Question s (map return xs)\n</code></pre>\n\n<p>Where <code>return</code> has type of <code>RTree a -&gt; RTree (RTree a)</code>.</p>\n\n<p>You probably intended:</p>\n\n<pre><code>     mon (Question s xs) = Question s (map (fmap return) xs)\n</code></pre>\n\n<p>Also, <code>foldRTM</code> can be simplified to:</p>\n\n<pre><code>foldRTM :: (Monad m) =&gt; (a -&gt; m b) -&gt; (String -&gt; [b] -&gt; m b) -&gt; RTree a -&gt; m b \nfoldRTM v q t = foldRT (&gt;&gt;= v) q' (return &lt;$&gt; t)\n   where q' s ls = sequence ls &gt;&gt;= q s\n</code></pre>\n\n<p>If you make proper instance of <code>Functor RTree</code>:</p>\n\n<pre><code>instance Functor RTree where\n    fmap f (Val x) = Val (f x)\n    fmap f (Question s xs) = Question s (map (fmap f) xs)\n</code></pre>\n"}], "owner": {"reputation": 152, "user_id": 3832665, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/520fa46dfc3474e5183d8810bc4ee58b?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/3832665/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 0, "accepted_answer_id": 49216036, "answer_count": 1, "score": 2, "last_activity_date": 1520751006, "creation_date": 1520732713, "last_edit_date": 1520737062, "question_id": 49215816, "link": "https://stackoverflow.com/questions/49215816/converting-a-fold-to-a-monadic-fold-haskell", "title": "Converting a fold to a monadic fold haskell", "body": "<p>I am having some difficulty converting a fold of a custom data type into a monadic fold. The idea is I should be able to fold with <code>IO</code> or <code>Maybe</code> using <code>&gt;&gt;=</code>. However, I'm getting errors I don't fully understand.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>data RTree a = Val a | Question String [RTree a] deriving (Show)\n\nfoldRT :: (a -&gt; b) -&gt; (String -&gt; [b] -&gt; b) -&gt; RTree a -&gt; b\nfoldRT v q (Val x) = v x \nfoldRT v q (Question s xs) = q s $ map (foldRT v q) xs\n\n\n\nfoldRTM :: (Monad m) =&gt; (a -&gt; m b) -&gt; (String -&gt; [b] -&gt; m b) -&gt; RTree a -&gt; m b \nfoldRTM v q t = foldRT (&gt;&gt;= v) q' (mon t)\n   where q' s ls = mapM id ls &gt;&gt;= (\\xs -&gt; q s xs) \n         mon (Val x) = Val $ return x\n         mon (Question s xs) = Question s (map return xs)\n</code></pre>\n\n<p>And here is the error message:</p>\n\n<pre><code>main.hs:14:36: error:\n    \u2022 Couldn't match type \u2018m\u2019 with \u2018RTree\u2019\n      \u2018m\u2019 is a rigid type variable bound by\n        the type signature for:\n          foldRTM :: forall (m :: * -&gt; *) a b.\n                     Monad m =&gt;\n                     (a -&gt; m b) -&gt; (String -&gt; [b] -&gt; m b) -&gt; RTree a -&gt; m b\n        at main.hs:13:1-78\n      Expected type: RTree (m a)\n        Actual type: RTree (RTree a)\n    \u2022 In the third argument of \u2018foldRT\u2019, namely \u2018(mon t)\u2019\n      In the expression: foldRT (&gt;&gt;= v) q' (mon t)\n      In an equation for \u2018foldRTM\u2019:\n          foldRTM v q t\n            = foldRT (&gt;&gt;= v) q' (mon t)\n            where\n                q' s ls = mapM id ls &gt;&gt;= (\\ xs -&gt; q s xs)\n                mon (Val x) = Val $ return x\n                mon (Question s xs) = Question s (map return xs)\n    \u2022 Relevant bindings include\n        q' :: String -&gt; [m b] -&gt; m b (bound at main.hs:15:10)\n        q :: String -&gt; [b] -&gt; m b (bound at main.hs:14:11)\n        v :: a -&gt; m b (bound at main.hs:14:9)\n        foldRTM :: (a -&gt; m b) -&gt; (String -&gt; [b] -&gt; m b) -&gt; RTree a -&gt; m b\n          (bound at main.hs:14:1)\n   |\n14 | foldRTM v q t = foldRT (&gt;&gt;= v) q' (mon t)\n   |                                    ^^^^^\n</code></pre>\n\n<p>The idea is that <code>&gt;&gt;= v</code> and <code>q'</code> as arguments to <code>foldRT</code> make its type...</p>\n\n<pre><code>(Monad m) :: (m a -&gt; m b) -&gt; (String -&gt; [m b] -&gt; m b) -&gt; RTree m a -&gt; m b\n</code></pre>\n\n<p>... but mapping getting the initial input of the tree into this form seems to not be working. I assume it's a stupid misunderstanding on my part.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "infinite-loop"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 4, "last_activity_date": 1520729231, "creation_date": 1520729231, "answer_id": 49215528, "question_id": 49215503, "link": "https://stackoverflow.com/questions/49215503/infinitely-displaying-same-value-haskell/49215528#49215528", "title": "Infinitely displaying same value Haskell", "body": "<pre><code>let empty = add_element : empty\n</code></pre>\n\n<p>That defines an infinite list of repeated <code>add_element</code>. Since <code>let</code> is always recursive, use a different name.</p>\n\n<pre><code>let notempty = add_element : empty\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9148128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22967ef90119f07a3c7a84d93648c18?s=128&d=identicon&r=PG&f=1", "display_name": "David Contreras", "link": "https://stackoverflow.com/users/9148128/david-contreras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1520729231, "creation_date": 1520728985, "question_id": 49215503, "link": "https://stackoverflow.com/questions/49215503/infinitely-displaying-same-value-haskell", "title": "Infinitely displaying same value Haskell", "body": "<p>So i am making a program to display the combined atomic mass of chosen elements. Here is a snippet of my code: </p>\n\n<pre><code>start :: Integer -&gt; [Double] -&gt; IO()\nstart num empty = \n    if num /= 0\n        then do\n            putStrLn \"Term:\"\n            term &lt;- getLine\n            let atom = element term\n            putStrLn \"Subscript:\"\n            subscript &lt;- getLine\n            let sub = convertToDouble subscript\n            let add_element = atom * sub\n            let empty = add_element : empty\n            putStrLn \"Done\"\n            start (num - 1) empty\n        else \n            putStrLn . show $ empty\n</code></pre>\n\n<p>Whenever I run this and pass 0 as num, it works perfectly. But when I pass any other number as an argument, it creates an infinite loop and displays the same value over and over again. </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 0, "creation_date": 1520729423, "post_id": 49215502, "comment_id": 85435231, "body": "This compiles fine for me after I fix the indentation in the numMatching definition. What exactly is the compiler error, and are you sure it&#39;s pointing to this code?"}, {"owner": {"reputation": 21, "user_id": 7038186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ff87cb63e3062922cf657126211d5f3?s=128&d=identicon&r=PG&f=1", "display_name": "Avioddddd", "link": "https://stackoverflow.com/users/7038186/avioddddd"}, "reply_to_user": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 0, "creation_date": 1520729709, "post_id": 49215502, "comment_id": 85435276, "body": "@Erik It has no compiles error but it does not work if I put something like numMatching 1 1."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520730048, "post_id": 49215502, "comment_id": 85435328, "body": "What do you mean by &quot;does not work&quot; (that is, what did you expect to happen)?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1520730766, "post_id": 49215502, "comment_id": 85435461, "body": "@Avioddddd If it doesn&#39;t have a compiler error, why does your question say it does? Please put a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in your question."}, {"owner": {"reputation": 21, "user_id": 7038186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ff87cb63e3062922cf657126211d5f3?s=128&d=identicon&r=PG&f=1", "display_name": "Avioddddd", "link": "https://stackoverflow.com/users/7038186/avioddddd"}, "edited": false, "score": 0, "creation_date": 1520730987, "post_id": 49215502, "comment_id": 85435494, "body": "Sorry about that. I have edited my question and put a screenshot on it"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520732064, "post_id": 49215502, "comment_id": 85435666, "body": "That clarifies things a bit. It would be better, though, if you copied and pasted the error as text, and not as an image (you can copy from the Windows console by selecting with the mouse and then pressing Enter)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520736121, "post_id": 49215502, "comment_id": 85436275, "body": "Tangential question: if your class isn&#39;t just a type system experiment, do you have any other instances for it in mind?"}, {"owner": {"reputation": 21, "user_id": 7038186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ff87cb63e3062922cf657126211d5f3?s=128&d=identicon&r=PG&f=1", "display_name": "Avioddddd", "link": "https://stackoverflow.com/users/7038186/avioddddd"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520737591, "post_id": 49215502, "comment_id": 85436501, "body": "@duplode yep. Its for homework tho but I have to create other instance for Char, Lists etc.."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520737903, "post_id": 49215502, "comment_id": 85436547, "body": "That&#39;s fine. I asked that because in the first version of your question you mentioned an example with lists, and that left me wondering. (The obvious type for a <code>numMatching</code> for lists would be <code>Eq a =&gt; a -&gt; [a] -&gt; Int</code>. <code>Eq a =&gt; [a] -&gt; [a] -&gt; Int</code> might make sense, but then you&#39;d have to decide what should happen with e.g. <code>numMatching [6,2] [5,1,6,2,4,2,1,6,6,3]</code>.)"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7038186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ff87cb63e3062922cf657126211d5f3?s=128&d=identicon&r=PG&f=1", "display_name": "Avioddddd", "link": "https://stackoverflow.com/users/7038186/avioddddd"}, "edited": false, "score": 0, "creation_date": 1520736195, "post_id": 49216104, "comment_id": 85436284, "body": "Thank you for this awesome explanation :)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1520736487, "last_edit_date": 1520736487, "creation_date": 1520735776, "answer_id": 49216104, "question_id": 49215502, "link": "https://stackoverflow.com/questions/49215502/create-a-haskell-type-class-that-can-define-a-function-that-counts-the-occurrenc/49216104#49216104", "title": "Create a Haskell type class that can define a function that counts the occurrences of two values", "body": "<p>To begin with, the type of <code>1</code> is not <code>Int</code>, but rather:</p>\n\n<pre><code>GHCi&gt; :t 1\n1 :: Num p =&gt; p\n</code></pre>\n\n<p>That means the <code>1</code> literal can stand for a value of any type which is an instance of <code>Num</code>, the specific type being determined by how you use it. That is why, for instance, both <code>1 + 2 :: Integer</code> and <code>1 + 2.5 :: Double</code> work: <code>1</code> is an <code>Integer</code> in one case and a <code>Double</code> in the other one. The type of <code>(+)</code> is...</p>\n\n<pre><code>GHCi&gt; :t (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>... so if you say the result of <code>1 + 2</code> should be an <code>Integer</code>, GHC will infer that the types of <code>1</code> and <code>2</code> there should be <code>Integer</code> as well, because the result of <code>(+)</code> has the same type of its arguments.</p>\n\n<p>Now, let's have a look at the type of <code>numMatching</code>:</p>\n\n<pre><code>GHCi&gt; :t numMatching\nnumMatching :: Counter a =&gt; a -&gt; a -&gt; Int\n</code></pre>\n\n<p>We know the result of <code>numMatching</code> is an <code>Int</code>, but, unlike what happens with <code>(+)</code>, that tells us nothing about the type of the arguments. As a consequence, GHC doesn't have enough information to decide which instance of <code>Num</code> should be picked as the type of the <code>1</code>s in <code>numMatching 1 1</code>. That is what \"ambiguous type variable [...] prevents the constraint [...] from being solved\" means. One of the consequences of this inability to pick a type for <code>1</code> is that there is no way to choose an instance of <code>Counter</code>, or even decide whether there actually is one (e.g. you have defined one for <code>Int</code>, but not for <code>Double</code>). That is why you get a separate error mentioning <code>Counter</code>.</p>\n\n<p>To avoid this issue while leaving your instances as they are (i.e. keeping your <code>Int</code> instance and not having to add any other ones), add an explicit type annotation to either of the <code>1</code>s that you pass to <code>numMatching</code>:</p>\n\n<pre><code>GHCi&gt; numMatching (1 :: Int) 1\n1\n</code></pre>\n\n<p>Note that if one of the arguments already has a concrete type, no extra annotations are necessary:</p>\n\n<pre><code>GHCi&gt; :{\nGHCi| foo :: Int\nGHCi| foo = 1\nGHCi| :}\nGHCi&gt; :t foo\nfoo :: Int\nGHCi&gt; numMatching foo 1\n1\n</code></pre>\n\n<p>For the sake of contrast:</p>\n\n<pre><code>GHCi&gt; numMatching (1 :: Double) 1\n\n&lt;interactive&gt;:64:1: error:\n    * No instance for (Counter Double)\n        arising from a use of `numMatching'\n    * In the expression: numMatching (1 :: Double) 1\n      In an equation for `it': it = numMatching (1 :: Double) 1\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 7038186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ff87cb63e3062922cf657126211d5f3?s=128&d=identicon&r=PG&f=1", "display_name": "Avioddddd", "link": "https://stackoverflow.com/users/7038186/avioddddd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520736487, "creation_date": 1520728977, "last_edit_date": 1520736273, "question_id": 49215502, "link": "https://stackoverflow.com/questions/49215502/create-a-haskell-type-class-that-can-define-a-function-that-counts-the-occurrenc", "title": "Create a Haskell type class that can define a function that counts the occurrences of two values", "body": "<p>I am trying to create a type class that defines two functions. One called numMatching. It takes two values and return the count of occurrence the first value in the second value. For example: numMatching 1 1 = 1 since the first value 1 appear once in the second value 1. numMatching 1 0 = 0 since the first value never appear in the second value 0.</p>\n\n<p>For now I have defined the class:</p>\n\n<pre><code>class Counter a where\n    numMatching :: a -&gt; a -&gt; Int\n    numNonMatching :: a -&gt; a -&gt; Int \n</code></pre>\n\n<p>and I am trying to create an instance of this class for Int types but I am really\nconfused. </p>\n\n<pre><code>instance Counter Int where\n    numMatching a b =\n        if a == b\n            then 1\n            else 0\n</code></pre>\n\n<p>I tried to run this function in the ghci by input numMatching 1 1. It should return a value of 1 but I got an error says I need a type annotation to specify what a and b is.</p>\n\n<p>Error: <a href=\"https://i.stack.imgur.com/PtDMg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PtDMg.png\" alt=\"enter image description here\"></a></p>\n\n<p>any help would be appreciated :)</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 0, "last_activity_date": 1521646809, "creation_date": 1521646809, "answer_id": 49410644, "question_id": 49215242, "link": "https://stackoverflow.com/questions/49215242/how-to-make-ghc-generate-dynamically-linked-binaries-by-default/49410644#49410644", "title": "How to make GHC generate dynamically linked binaries by default?", "body": "<p>Indeed, you can alter your <code>~/.cabal/config</code> file to have the following lines:</p>\n\n<pre><code>shared: True\nexecutable-dynamic: True\n</code></pre>\n"}], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 2, "accepted_answer_id": 49410644, "answer_count": 1, "score": 2, "last_activity_date": 1521646809, "creation_date": 1520726170, "last_edit_date": 1520726406, "question_id": 49215242, "link": "https://stackoverflow.com/questions/49215242/how-to-make-ghc-generate-dynamically-linked-binaries-by-default", "title": "How to make GHC generate dynamically linked binaries by default?", "body": "<p><em>Is it possible to change cabal or GHC settings so that <code>cabal install</code> generates dynamic binaries and libraries by default?</em></p>\n\n<p>I'm using GHC 8.2.2, installed using <code>apt-get</code> in Ubuntu (16.04) without Haskell Platform or stack. Searching around, I found the SO question <a href=\"https://stackoverflow.com/q/12232471/683218\">Why can&#39;t cabal build mighttpd2 dynamically?</a> . The answers/comments there said something about adding <code>--enable-shared --enable-executable-dynamic</code> when <code>cabal install</code>. And this can be done <strong>manually</strong> for all dependency libraries (which would be a pain).</p>\n\n<p>In <a href=\"https://stackoverflow.com/q/6115459/683218\">Small Haskell program compiled with GHC into huge binary</a>, the accepted answer says that one needs to: </p>\n\n\n\n<pre><code>cabal install some_package --enable-shared --reinstall \n</code></pre>\n\n<p>The option <code>-dynamic</code> is also mentioned. </p>\n\n<p>My question is: </p>\n\n<p>Is it possible to change the options in the cabal configuration file (<code>~/.cabal/config</code>) from the very beginning so that all binaries and their dependency libraries use dynamic linkage (i.e. with <code>--enable-shared</code> <code>--enable-executable-dynamic</code> or <code>-dynamic</code> by default)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1520716832, "post_id": 49214044, "comment_id": 85432684, "body": "I don&#39;t think you can do that. <code>Maybe</code> is simply not a valid instance of your class as defined."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1520719469, "post_id": 49214044, "comment_id": 85433365, "body": "The reason that your last example gives an error is that the class says <code>f :: Foo a =&gt; a -&gt; b</code> so your instance must have <code>f :: Num b =&gt; Maybe b -&gt; c</code>, that is given anything that is <code>Maybe b</code> for some numeric type <code>b</code>, you need to be able to produce something of <i>any</i> type and the only thing which inhabits any type is bottom."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520721238, "post_id": 49214348, "comment_id": 85433739, "body": "Why don&#39;t you think MPTC is the right approach? On the surface, at least, it looks good to me. Relatively, anyway. I&#39;m not convinced the whole goal is right."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1520737484, "post_id": 49214348, "comment_id": 85436480, "body": "The MPTC solution you gave is exactly what I was looking for; I didn&#39;t realize you could do that. I needed to enable <code>FlexibleContexts</code> to get it to work, though. Why do you think this is not a good way to go?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1520739543, "post_id": 49214348, "comment_id": 85436811, "body": "@bwroga, well, I don&#39;t know what you&#39;re <i>actually</i> doing, but a class that adds one to the contents of a <code>Maybe</code> and does somethiing else for other types smells pretty ad hoc."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520775921, "post_id": 49214348, "comment_id": 85444829, "body": "@dfeuer Yes, this is just a simplified example."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520783258, "post_id": 49214348, "comment_id": 85447240, "body": "The reason I&#39;m doubtful about the MPTC solution is that it makes the <code>Foo</code> class quite fundamentally different from the original, namely, it has a different kind <code>* -&gt; * -&gt; *</code> instead of <code>* -&gt; *</code>. That makes it quite deeply incompatible."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1520718428, "creation_date": 1520718428, "answer_id": 49214348, "question_id": 49214044, "link": "https://stackoverflow.com/questions/49214044/type-constraints-in-instance-declaration-but-not-class/49214348#49214348", "title": "Type constraints in instance declaration but not class", "body": "<p>It is not possible without changing either the class or the type.</p>\n\n<ul>\n<li><p>The <code>MultiParamTypeClasses</code> approach actually doesn't require that you write separate instances for all <code>Num</code> types \u2013 the following works:</p>\n\n<pre><code>class Foo a b where\n  f :: a b -&gt; b\n\ninstance (Num b) =&gt; Foo Maybe b where\n  f = fMaybe\n</code></pre>\n\n<p>Still, I don't think that's a particularly good approach.</p></li>\n<li><p>You can use <code>ConstraintKinds</code> to allow each instance to optionally constrain the contained type.</p>\n\n<pre><code>{-# LANGAUGE TypeFamilies, ConstraintKinds #-}\n\nimport GHC.Exts (Constraint)\n\nclass Foo a where\n  type FooCstrt a b :: Constraint\n  type FooCstrt a b = () -- default to unconstrained\n  f :: FooCstrt a b =&gt; a b -&gt; b\n\ninstance Foo Maybe where\n  type FooCstrt Maybe b = Num b\n  f = fMaybe\n</code></pre></li>\n<li><p>You can switch to a type that only allows containing <code>Num</code> types in the first place.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata NMaybe where\n  NJust :: Num b =&gt; b -&gt; NMaybe b\n  NNothing :: Num b =&gt; NMaybe b\n</code></pre>\n\n<p>Then,</p>\n\n<pre><code>class Foo a where\n  f :: a b -&gt; b\n\ninstance Foo NMaybe where\n  f (NJust i) = i+1\n  f (NNothing) = 0\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 49214348, "answer_count": 1, "score": 1, "last_activity_date": 1520718428, "creation_date": 1520716000, "question_id": 49214044, "link": "https://stackoverflow.com/questions/49214044/type-constraints-in-instance-declaration-but-not-class", "title": "Type constraints in instance declaration but not class", "body": "<p>I want to create an instance with a function definition that has type constraints, but I don't want to add the type constraints to the class.</p>\n\n<pre><code>class Foo a where\n  f :: a b -&gt; b\n\ninstance Foo Maybe where\n  f = fMaybe\n\nfMaybe :: (Num a) =&gt; Maybe a -&gt; a\nfMaybe (Just i) = i+i\nfMaybe _ = 0\n</code></pre>\n\n<p>How can I specify that this is an instance for <code>Maybe</code>s that contain <code>Nums</code>?</p>\n\n<p>This works:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\nclass Foo a b where\n  f :: a b -&gt; b\n\ninstance Foo Maybe Int where\n  f = fMaybe\n\nfMaybe :: (Num a) =&gt; Maybe a -&gt; a\nfMaybe (Just i) = i+i\nfMaybe _ = 0\n</code></pre>\n\n<p>But I don't want to have to declare instances for each type of <code>Num</code></p>\n\n<p>I tried this:</p>\n\n<pre><code>class Foo a where\n  f :: a -&gt; b\n\ninstance (Num b) =&gt; Foo (Maybe b) where\n  f = fMaybe\n\nfMaybe :: (Num a) =&gt; Maybe a -&gt; a\nfMaybe (Just i) = i+i\nfMaybe _ = 0\n</code></pre>\n\n<p>but I get an error:</p>\n\n<blockquote>\n<pre><code>Couldn't match type \u2018b\u2019 with \u2018b1\u2019\n  \u2018b\u2019 is a rigid type variable bound by\n      the instance declaration at Test.hs:31:10\n  \u2018b1\u2019 is a rigid type variable bound by\n       the type signature for f :: Maybe b -&gt; b1 at Test.hs:32:3\nExpected type: Maybe b -&gt; b1\n  Actual type: Maybe b1 -&gt; b1\nRelevant bindings include\n  f :: Maybe b -&gt; b1 (bound at Test.hs:32:3)\nIn the expression: fMaybe\nIn an equation for \u2018f\u2019: f = fMaybe\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell", "tree", "ternary-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1520715972, "post_id": 49214037, "comment_id": 85432467, "body": "Why do you use <code>do</code> here?"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1520716501, "creation_date": 1520716501, "answer_id": 49214101, "question_id": 49214037, "link": "https://stackoverflow.com/questions/49214037/haskell-find-a-value-in-a-ternary-tree-and-the-tree-is-not-sorted/49214101#49214101", "title": "Haskell: Find a value in a Ternary Tree and the tree is not sorted", "body": "<p><code>do</code> is a keyword that is used to enable some syntactical sugar for <em>monads</em>. In this sitation, there is no need for monads.</p>\n\n<p>There are two cases here: the <code>EmptyTree</code> that means that we failed to find the value, so we return <code>False</code>.</p>\n\n<p>For the <code>Node</code> we can check up to four conditions: is the value the value we look for, is the value in the first subtree, is the value in the second subtree, and is the value in the third subtree. From the moment one of the checks is <code>True</code>, we can return <code>True</code>. If all checks fail, we return <code>False</code>, this is the behavior of a logical or (<code>||</code>). So we can write it like:</p>\n\n<pre><code>treeLook :: Eq a =&gt; a -&gt; TernaryTree a -&gt; Bool\ntreeLook _ EmptyTree = False\ntreeLook x (Node a l m r) = x == a || treeLook x l || treeLook x m || treeLook x r\n</code></pre>\n\n<p>Or we can define a locally scoped function preventing us from recursively passing the value we are looking for:</p>\n\n<pre><code>treeLook :: Eq a =&gt; a -&gt; TernaryTree a -&gt; Bool\ntreeLook x = go\n    where go EmptyTree = False\n          go (Node a l m r) = x == a || go l || go m || go r\n</code></pre>\n\n<p>Note that since the tree is not sorted, we do not need the <code>Ord a</code> type constraint, we only need to check equality (here in <code>x == a</code>), so the <code>Eq a</code> type constraint is sufficient.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520717484, "post_id": 49214192, "comment_id": 85432854, "body": "FTR, it is not completely absurd to see <code>do</code> in a situation similar to this, because it can also be used in the <i>list monad</i>. For this particular function, that doesn&#39;t seem to make any sense though."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520718419, "post_id": 49214192, "comment_id": 85433093, "body": "@leftaroundabout I think the <code>Maybe</code> monad is much more the sort of thing one might expect in this context than the <code>[]</code> one"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1520718520, "post_id": 49214192, "comment_id": 85433125, "body": "@DanRobertson not really, <code>Maybe</code> has AND-ish semantics but this is an OR-like situation. It could be done with the <code>Left</code> side of <code>Either</code>, but that&#39;s a bit weird."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520719151, "post_id": 49214192, "comment_id": 85433287, "body": "@leftaroundabout you\u2019re right of course. That totally slipped my mind. I suppose I was thinking of the <code>Alternative</code> instance which does have disjunction semantics but doesn\u2019t necessarily use <code>do</code> notation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1520760028, "post_id": 49214192, "comment_id": 85440730, "body": "<code>any</code> looks wrong here: the above code does not type check. You probably mean <code>or</code> instead of <code>any</code>."}, {"owner": {"reputation": 106, "user_id": 5687336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f5e70e820e87c24fb53e4338f49576b?s=128&d=identicon&r=PG&f=1", "display_name": "Anicka Burova", "link": "https://stackoverflow.com/users/5687336/anicka-burova"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1520782964, "post_id": 49214192, "comment_id": 85447116, "body": "@chi you are right, I didn&#39;t have haskell compiler at hand to test it at that moment."}], "tags": [], "owner": {"reputation": 106, "user_id": 5687336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f5e70e820e87c24fb53e4338f49576b?s=128&d=identicon&r=PG&f=1", "display_name": "Anicka Burova", "link": "https://stackoverflow.com/users/5687336/anicka-burova"}, "is_accepted": false, "score": 5, "last_activity_date": 1520785283, "last_edit_date": 1520785283, "creation_date": 1520717200, "answer_id": 49214192, "question_id": 49214037, "link": "https://stackoverflow.com/questions/49214037/haskell-find-a-value-in-a-ternary-tree-and-the-tree-is-not-sorted/49214192#49214192", "title": "Haskell: Find a value in a Ternary Tree and the tree is not sorted", "body": "<p>Do is for monads.</p>\n\n<p>Instead use <a href=\"https://www.haskell.org/hoogle/?hoogle=any\" rel=\"nofollow noreferrer\">any</a>.</p>\n\n<pre><code>treeLook _ EmptyTree = False\ntreeLook x (Node y l m r) = any id [x == y, look l, look m, look r]\n    where look = treeLook x\n</code></pre>\n\n<p>As pointed out, or is better use.</p>\n\n<pre><code>treeLook x (Node y l m r) = or [x == y, look l, look m, look r]\n    where look = treeLook x\n</code></pre>\n\n<p>Tho my favourite would be this:</p>\n\n<pre><code>treeLook _ EmptyTree = False\ntreeLook x (Node y l m r) = x == y || any (treeLook x) [l, m, r]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1520724597, "creation_date": 1520724597, "answer_id": 49215088, "question_id": 49214037, "link": "https://stackoverflow.com/questions/49214037/haskell-find-a-value-in-a-ternary-tree-and-the-tree-is-not-sorted/49215088#49215088", "title": "Haskell: Find a value in a Ternary Tree and the tree is not sorted", "body": "<p>One option is to use <code>elem</code>, which checks whether a value is an element of a <code>Foldable</code> container.</p>\n\n<pre><code>treeLook :: Eq a =&gt; a -&gt; TernaryTree a -&gt; Bool\ntreeLook = elem\n</code></pre>\n\n<p>Now you just have to write an instance of <code>Foldable</code>. One option is to enable the <code>DeriveFoldable</code> extension and just use <code>deriving (Show, Foldable)</code> to get GHC to write the instance for you. But you won't learn much that way. So let's explore some ways to do it.</p>\n\n<pre><code>-- This import is needed for non-bleeding-edge GHC versions.\nimport Data.Monoid ((&lt;&gt;))\n\ninstance Foldable TernaryTree where\n  -- Fold over the tree in pre-order\n  foldMap _ EmptyTree = mempty\n  foldMap f (Node x ls cs rs) =\n    f x &lt;&gt; foldMap f ls &lt;&gt; foldMap f cs &lt;&gt; foldMap f rs\n</code></pre>\n\n<p>But that repeated <code>foldMap</code> is itself a sort of \"pattern\" you can pull out by writing the \"catamorphism\" for trees:</p>\n\n<pre><code>cataTree :: r -&gt; (a -&gt; r -&gt; r -&gt; r -&gt; r) -&gt; TernaryTree a -&gt; r\ncataTree e _ EmptyTree = e\ncataTree e f (Node x ls cs rs) =\n  f x (cataTree e f ls) (cataTree e f cs) (cataTree e f rs)\n</code></pre>\n\n<p>Now you can define <code>foldMap</code> thus:</p>\n\n<pre><code>foldMap f = cataTree mempty (\\a lr cr rr -&gt; f a &lt;&gt; lr &lt;&gt; cr &lt;&gt; rr)\n</code></pre>\n\n<p>Now <code>foldMap</code> itself has a more-powerful cousin, <code>traverse</code>. So another option is to start there:</p>\n\n<pre><code>import Data.Traversable (fmapDefault, foldMapDefault)\n\ninstance Traversable TernaryTree where\n  -- Traverse the tree in pre-order\n  traverse f =\n    cataTree (pure EmptyTree)\n             (\\a ls cs rs -&gt; Node &lt;$&gt; f a &lt;*&gt; ls &lt;*&gt; cs &lt;*&gt; rs)\n\ninstance Functor TernaryTree where\n  fmap = fmapDefault\n\ninstance Foldable TernaryTree where\n  foldMap = foldMapDefault\n</code></pre>\n\n<p>Obviously, you're not at a point where you're going to want to do anything so fancy, but such techniques are actually useful once you're in the position of wanting to produce a bunch of functions quickly.</p>\n"}], "owner": {"reputation": 21, "user_id": 7038186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ff87cb63e3062922cf657126211d5f3?s=128&d=identicon&r=PG&f=1", "display_name": "Avioddddd", "link": "https://stackoverflow.com/users/7038186/avioddddd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1520785283, "creation_date": 1520715945, "last_edit_date": 1520721448, "question_id": 49214037, "link": "https://stackoverflow.com/questions/49214037/haskell-find-a-value-in-a-ternary-tree-and-the-tree-is-not-sorted", "title": "Haskell: Find a value in a Ternary Tree and the tree is not sorted", "body": "<p>For now I have the tree data type:</p>\n\n<pre><code>data TernaryTree a = EmptyTree\n                   | Node a (TernaryTree a) (TernaryTree a) (TernaryTree a)\n                   deriving (Show)\n</code></pre>\n\n<p>And I am trying to create a function that can loop up a value in the Ternary Tree.\nThe tree is not sorted.</p>\n\n<pre><code>treeLook :: (Ord a)=&gt; a -&gt; TernaryTree a -&gt; Bool\ntreeLook x EmptyTree = False\ntreeLook x (Node a left mid right) =\n    if x /= a\n        then do\n        treeLook x left \n        treeLook x mid\n        treeLook x right\n        else \n        True\n</code></pre>\n\n<p>I have this for now but I can't compile it. It says:</p>\n\n<pre><code>Couldn't match expected type \"m0 b0\" with actual type \"bool\" on the line:\n    treeLook x right\n</code></pre>\n"}, {"tags": ["c++", "haskell", "winapi", "error-handling", "filesystems"], "comments": [{"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1520706126, "post_id": 49212400, "comment_id": 85429408, "body": "<code>FindNextFileW</code> can also fail, an example would be network resource becoming unavailable."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1520706324, "post_id": 49212400, "comment_id": 85429479, "body": "@RichardCritten Oh. What you imply is that results are searched for one after one? I would appreciate a more extended introduction into the inner workings of <code>Find...File</code> functions."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1520706343, "post_id": 49212400, "comment_id": 85429484, "body": "Windows is not open source AFAIK, thus it is impossible for an end-user / programmer to know exactly what return codes are issued.  Even a Windows update could add additional codes to certain API functions.  You just have to live with <code>GetLastError</code> -- it is what it is."}, {"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1520706428, "post_id": 49212400, "comment_id": 85429515, "body": "Have a read of: <a href=\"https://blogs.msdn.microsoft.com/oldnewthing/20060406-13/?p=31633\" rel=\"nofollow noreferrer\">blogs.msdn.microsoft.com/oldnewthing/20060406-13/?p=31633</a>"}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 4, "creation_date": 1520706492, "post_id": 49212400, "comment_id": 85429535, "body": "The question doesn&#39;t make much sense. <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa364418.aspx\" rel=\"nofollow noreferrer\">FindFirstFile</a> and <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa364428.aspx\" rel=\"nofollow noreferrer\">FindNextFile</a> can both fail. The documentation tells you how to distinguish a successful call from reaching the end of the list from a failed call. Asking about anything more is essentially asking about implementation details. Those aren&#39;t contractual, nor is there any guarantee, that they will not ever change across versions of Windows."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1520706664, "post_id": 49212400, "comment_id": 85429581, "body": "@IInspectable What you are saying is very unfortunate. Would it mean that I cannot even know from the error code whether the error is due to permissions, path existence, or the path not being a directory?"}, {"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1520706839, "post_id": 49212400, "comment_id": 85429641, "body": "Unless the MSDN page explicitly states a return value, Microsoft does not conciser error code values part of the API contract."}, {"owner": {"reputation": 7466, "user_id": 2146682, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7120fc7548c43237662da906e3c84f43?s=128&d=identicon&r=PG", "display_name": "MrEricSir", "link": "https://stackoverflow.com/users/2146682/mrericsir"}, "edited": false, "score": 0, "creation_date": 1520706981, "post_id": 49212400, "comment_id": 85429686, "body": "This seems like one of those edge cases where the only plausible answer is to try it and see for yourself how Windows behaves. My advice is to avoid the assumption it will behave exactly the same between one version of Windows to the next, or even between user permission levels."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1520707471, "post_id": 49212400, "comment_id": 85429854, "body": "Those API calls cannot reliably report even certain classes of errors. After all, at some point the requests are passed down the file system (or network) stack, and those implementations and the error codes they return are usually not controlled by the team implementing the API."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 1, "creation_date": 1520707486, "post_id": 49212400, "comment_id": 85429861, "body": "<i>I cannot even know from the error code whether the error is due to permissions, path existence, or the path not being a directory?</i> - no, we can know this by error code. also much better call <code>RtlGetLastNtStatus</code> instead <code>GetLastError</code> (frequently <code>GetLastError</code> lost sensetive info from original status). despite concrete and possible error values not documented (and this is device depended - as result and can not be documented) usual error status give enough info for understanding source of problem"}, {"owner": {"reputation": 33827, "user_id": 506413, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1a474f3be606bcc6f964913b523626e9?s=128&d=identicon&r=PG", "display_name": "Jonathan Potter", "link": "https://stackoverflow.com/users/506413/jonathan-potter"}, "edited": false, "score": 0, "creation_date": 1520707576, "post_id": 49212400, "comment_id": 85429901, "body": "Windows is the most popular operating system in the world. To describe it as &quot;rare&quot; is stretching things somewhat."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1520708005, "post_id": 49212400, "comment_id": 85430032, "body": "@IgnatInsarov -- This has been the framework of Windows API programming for over two decades now.  You call a Windows API function, you get an error code.  If the error code means failure, then you look at the documentation to see if you can get more information by calling <code>GetLastError</code> (that is almost always documented).  That is what your Haskell wrapper does.  If there was a better way of figuring out these errors, the writers of that wrapper would have used it, but even they knew that it is pointless to try and enumerate all of the possible return codes."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 33827, "user_id": 506413, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1a474f3be606bcc6f964913b523626e9?s=128&d=identicon&r=PG", "display_name": "Jonathan Potter", "link": "https://stackoverflow.com/users/506413/jonathan-potter"}, "edited": false, "score": 0, "creation_date": 1520709140, "post_id": 49212400, "comment_id": 85430407, "body": "@JonathanPotter I dunno. My cheapskate friends use Linux, the rich ones sport a Mac. Both being by and large Posix compliant. Perhaps I have a skewed perspective due to being immersed in hacker / developer circles."}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 187, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520743235, "creation_date": 1520705564, "last_edit_date": 1592644375, "question_id": 49212400, "link": "https://stackoverflow.com/questions/49212400/what-happens-if-i-call-findfirstfile-on-an-erroneous-path-would-the-error-be-me", "title": "What happens if I call FindFirstFile on an erroneous path? Would the error be meaningful?", "body": "<p>In order to obtain a satisfactory answer to <a href=\"https://stackoverflow.com/q/48699422\">another question nearby</a>, I am investigating the failure modes of <a href=\"https://hackage.haskell.org/package/directory-1.3.2.0/docs/src/System-Directory.html#getDirectoryContents\" rel=\"nofollow noreferrer\"><code>System.Directory.getDirectoryContents</code></a> from <a href=\"https://hackage.haskell.org/package/directory\" rel=\"nofollow noreferrer\"><code>directory</code></a> Haskell library. This is a platform agnostic function that compiles to different code on Posix and Windows platforms, that then call platform specific API. My goal is to determine failure modes and errors that I may expect if the path I provide does not allow directory listing.</p>\n<ul>\n<li>It may be a non-existent path.</li>\n<li>It may not be a directory.</li>\n<li>The caller may lack the permissions to obtain a listing.</li>\n<li>There are other failure modes I can think of as well, but I refrain from listing them all here.</li>\n</ul>\n<p>The Posix part is clear to me as I have some experience with Linux, and it is actually very straightforward; the error codes that may be raised are all listed in <a href=\"https://www.systutorials.com/docs/linux/man/3-opendir/\" rel=\"nofollow noreferrer\"><code>man 3 opendir</code></a>, and I do not expect any surprises.</p>\n<p>The Windows part is not clear to me at all. It is an expensive, closed source operating system, written (apparently?) in <code>C++</code> (rather than <code>C</code>), with which I am only superficially familiar. Due to its price and rarity, I am not going to lay my hands on a Windows operated computer any time soon, so I need help from my better endowed fellows.</p>\n<h3>My questions:</h3>\n<ol>\n<li><p>I wish I was at least certain that, if <code>getDirectoryContents</code> is to fail for any foreseeable reason (I'm not considering sudden hardware failure), it will fail in the call to <code>FindFirstFileW</code>, which is made <a href=\"https://hackage.haskell.org/package/Win32-2.7.0.0/docs/src/System.Win32.File.html#findFirstFile\" rel=\"nofollow noreferrer\">here</a>. Is this the case? That is, can it not also fail in subsequent calls to <code>FindNextFileW</code>? I presume not, as the directory entries should be mapped to memory at this point and, while the handle is held open, even the removal of the file in the underlying storage should not destroy them. At least, that is what I would expect from Linux. Does the same thinking apply to Windows? I am suspicious due to, for one, the fact that a search for a glob may be by any measure more complicated than just reading a single entry of a filesystem (which is what a Posix system does through <code>opendir</code>).</p>\n</li>\n<li><p>The Haskell wrapper calls <code>GetLastError</code> in case <code>FindFirstFileW</code> returns a null handle or <code>FindNextFileW</code> errors out. How can I find out what error codes may manifest themselves and in what circumstances? I discovered <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa364418(v=vs.85).aspx\" rel=\"nofollow noreferrer\">some official help</a> for <code>FindFirstFile</code> but I do not think there is any mention of error code values and their meanings there; neither is in the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa364428(v=vs.85).aspx\" rel=\"nofollow noreferrer\">help for <code>FindNextFile</code></a>.</p>\n</li>\n</ol>\n<p>Overall, I obviously lack the understanding of WinApi and I expect the answers to these questions could be derived from the general understanding of the Windows operating system. Thus, I would enjoy a principled answer, or a correction of my presuppositions, more than an answer that plainly states the facts.</p>\n<h3>Update.</h3>\n<p>I <a href=\"https://mail.haskell.org/pipermail/libraries/2018-March/028615.html\" rel=\"nofollow noreferrer\">asked</a> the maintainers and I had pointed out to me the existence of a <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/src/cbits/Win32Utils.c\" rel=\"nofollow noreferrer\">file</a> that contains a table of conversion between Windows and Posix error codes.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1520706036, "post_id": 49212318, "comment_id": 85429378, "body": "From a quick glance, your evaluation looks correct -- in particular, replacing <code>fmap</code> with its definition for the function instance in the fourth step is the right thing to do. Do you have some more specific question about it?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520706362, "post_id": 49212318, "comment_id": 85429491, "body": "It looks correct."}], "answers": [{"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1520782699, "post_id": 49213696, "comment_id": 85447015, "body": "Additionally, the constant <code>1</code> expands to <code>fromIntegral (1::Integer)</code>, defaulting to <code>Integer</code>, which is indeed an instance of <code>Num</code>.  So, <code>a</code> is <code>Integer</code> here."}, {"owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "edited": false, "score": 1, "creation_date": 1520813631, "post_id": 49213696, "comment_id": 85456749, "body": "Thank you very much for great detail explanation Willem."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 7, "last_activity_date": 1520715856, "last_edit_date": 1520715856, "creation_date": 1520713648, "answer_id": 49213696, "question_id": 49212318, "link": "https://stackoverflow.com/questions/49212318/evaluation-of-expression-fmap-3-5-1/49213696#49213696", "title": "Evaluation of expression fmap (*3) (+5) 1", "body": "<p>The reasoning you demonstrate seems <em>correct</em>.</p>\n\n<p>We can make a more rigorous answer on how Haskell does it. First the type checker will be activated.</p>\n\n<p>Haskell sees the expression</p>\n\n<pre><code>((fmap (*3)) (+5)) 1\n</code></pre>\n\n<p>So first it does some type reasoning:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n(*3) :: Num c =&gt; c -&gt; c\n(+5) :: Num d =&gt; d -&gt; d\n1 :: Num e =&gt; e\n</code></pre>\n\n<p>Since we call <code>fmap</code> with <code>(*3)</code> this thus means that <code>a -&gt; b ~ c -&gt; c</code>, and thus <code>a ~ b ~ c</code>, so we get:</p>\n\n<pre><code>fmap :: (Num a, Functor f) =&gt; (a -&gt; a) -&gt; f a -&gt; f a\n(*3) :: Num a =&gt; a -&gt; a\n(+5) :: Num d =&gt; d -&gt; d\n1 :: Num e =&gt; e\n</code></pre>\n\n<p>So that means that <code>fmap (*3)</code> has type <code>fmap (*3) :: (Num a, Functor f) =&gt; f a -&gt; f a</code>. Since <code>(+5) :: Num d =&gt; d -&gt; d</code> is the argument of that function, we see that <code>f a ~ d -&gt; d</code>. Or in a more canonical form: <code>f a ~ (-&gt;) d d</code>. So that means that <code>f ~ (-&gt; d)</code> and <code>a ~ d</code>. This holds since there is  <code>Functor</code> for <code>(-&gt;) a</code>:</p>\n\n<blockquote>\n<pre><code>instance Functor ((-&gt;) a) where\n    fmap = (.)\n</code></pre>\n</blockquote>\n\n<p>So we now have types:</p>\n\n<pre><code>fmap :: Num a =&gt; (a -&gt; a) -&gt; (a -&gt; a) -&gt; (a -&gt; a)\nfmap :: Num a =&gt; (a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a\nfmap = (.)\n(*3) :: Num a =&gt; a -&gt; a\n(+5) :: Num a =&gt; a -&gt; a\n1 :: Num e -&gt; e\n</code></pre>\n\n<p>So that means that <code>fmap (*3) (+5)</code> has type <code>(-&gt;) a a</code>. We call this function with <code>1</code>, so that means that <code>e ~ a</code>, so:</p>\n\n<pre><code>fmap :: Num a =&gt; (a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a\nfmap = (.)\n(*3) :: Num a =&gt; a -&gt; a\n(+5) :: Num a =&gt; a -&gt; a\n1 :: Num a -&gt; a\n</code></pre>\n\n<p>So now we type checked the function, and we came to the conclusion that <code>fmap = (.)</code>, so we have basically written:</p>\n\n<pre><code>(((.) (*3)) (+5)) 1\n</code></pre>\n\n<p>And now if we want to evaluate this, we get:</p>\n\n<pre><code>   (((.) (*3)) (+5)) 1\n-&gt; (*3) ((+5) 1)\n-&gt; (*3) 6\n-&gt; 18\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 9472767, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yw-8Kvw0uFQ/AAAAAAAAAAI/AAAAAAAAAHc/OjJ3Y_xR650/photo.jpg?sz=128", "display_name": "\u0160ef\u010d&#237;kov&#225; Jana", "link": "https://stackoverflow.com/users/9472767/%c5%a0ef%c4%8d%c3%adkov%c3%a1-jana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1520732241, "creation_date": 1520705093, "last_edit_date": 1520732241, "question_id": 49212318, "link": "https://stackoverflow.com/questions/49212318/evaluation-of-expression-fmap-3-5-1", "title": "Evaluation of expression fmap (*3) (+5) 1", "body": "<p>Could you please help me verify evaluation of following Haskell expression: fmap (*3) (+5) 1 ?  I struggle especially with the correct parsing of the fmap x y z.</p>\n\n<p>Thank you</p>\n\n<p>My trial: </p>\n\n<pre><code>fmap (*3) (+5) 1 -- nothing to do 1 is 1\n=&gt; (fmap (*3)) (+5) 1 -- function application infixl 10\n=&gt; ((fmap (*3)) (+5)) 1 -- function application infixl 10\n=&gt; ((fmap (*3) (+5)) 1 -- (f (x) y) equivalent to (f x y)\n=&gt; ((*3) . (+5)) 1 -- fmap f g = f.g; \n=&gt; (*3) ((+5) 1) -- (f.g) x = f (g x) \n=&gt; (*3) 6 \n=&gt; 18\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9386849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/997c4413a30c42e0de04a0a0058b3162?s=128&d=identicon&r=PG&f=1", "display_name": "imran7", "link": "https://stackoverflow.com/users/9386849/imran7"}, "edited": false, "score": 0, "creation_date": 1520794467, "post_id": 49219484, "comment_id": 85451058, "body": "<code>@skvadrik</code> Thank you so much ma&#39;am for your nice feedback. However, in the meantime I have found something more interesting. Anyways, your response means a lot to me, ok. Once again, thank you....:)"}], "tags": [], "owner": {"reputation": 566, "user_id": 815525, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ac16f4513ae5d27116a7680285f1e97d?s=128&d=identicon&r=PG", "display_name": "skvadrik", "link": "https://stackoverflow.com/users/815525/skvadrik"}, "is_accepted": false, "score": 1, "last_activity_date": 1520767756, "creation_date": 1520767756, "answer_id": 49219484, "question_id": 49211892, "link": "https://stackoverflow.com/questions/49211892/tag-operations-for-tagged-transitions-in-tdfatagged-dfa-for-sub-regex-matching/49219484#49219484", "title": "Tag operations for tagged transitions in TDFA(tagged DFA) for sub regex matching", "body": "<p>It is not possible to write explicit tags into the regexp passed to Regex-TDFA. Regex-TDFA supports <a href=\"http://pubs.opengroup.org/onlinepubs/7908799/xbd/re.html\" rel=\"nofollow noreferrer\">POSIX regular expressions</a>, and in POSIX submatch extraction concerns <em>capturing groups</em> (that is, parenthesized subexpressions). You can use capturing groups with Regex-TDFA as follows:</p>\n\n<pre><code>Prelude Text.Regex.TDFA&gt; \"bbbb\" =~ \"((b)|(bb)|(bbb)|(bbbb))*\" :: MatchArray\narray (0,5) [(0,(0,4)),(1,(0,4)),(2,(-1,0)),(3,(-1,0)),(4,(-1,0)),(5,(0,4))]\n</code></pre>\n\n<p>Here you see that your expression has 6 capturing groups: <code>(b)</code>, <code>(bb)</code>, <code>(bbb)</code>, <code>(bbbb)</code>, <code>((b)|(bb)|(bbb)|(bbbb))</code> and the whole regexp, which in POSIX is always the implicit first group.</p>\n\n<ol>\n<li>the whole regexp matches at offset <code>0</code> and spans <code>4</code> symbols</li>\n<li><code>((b)|(bb)|(bbb)|(bbbb))</code> matches at offset <code>0</code> and spans <code>4</code> symbols</li>\n<li><code>(b)</code> does not match -- hence the starting offset <code>-1</code> and match length <code>0</code></li>\n<li>likewise <code>(bb)</code> does not match</li>\n<li>likewise <code>(bbb)</code> does not match</li>\n<li>finally, <code>(bbbb)</code> matches at offset <code>0</code> and spans <code>4</code> symbols.</li>\n</ol>\n\n<p>You can use submatch extraction with other interfaces as well:</p>\n\n<pre><code>Prelude Text.Regex.TDFA&gt; \"bbbb\" =~ \"((b)|(bb)|(bbb)|(bbbb))*\" :: [[String]]\n[[\"bbbb\",\"bbbb\",\"\",\"\",\"\",\"bbbb\"],[\"\",\"\",\"\",\"\",\"\",\"\"]]\n</code></pre>\n\n<p>The <em>tags</em> are added implicitly by Regex-TDFA internal algorithm -- they are an implementation detail hidden from the user. If what you want is submatch extraction with Haskell regexp, then you should stop reading at this point. If, however, you are interested in Regex-TDFA theory of operation, than the answer to your question is much more involved.</p>\n\n<p>Regex-TDFA is based on the concept of Tagged DFA, <a href=\"https://laurikari.net/ville/spire2000-tnfa.pdf\" rel=\"nofollow noreferrer\">invented by Ville Laurikari</a> in 2000.</p>\n\n<p>Chris Kuklewicz, the author of Regex-TDFA, extended Ville's algorithm to support POSIX disambiguation semantics. He informally described his disambiguation algorithm <a href=\"https://wiki.haskell.org/index.php?title=Regular_expressions/Bounded_space_proposal&amp;oldid=11475\" rel=\"nofollow noreferrer\">on Haskell wiki</a> in 2007, and <a href=\"https://github.com/ChrisKuklewicz/regex-tdfa/issues/12\" rel=\"nofollow noreferrer\">recently showed little interest</a> in its formalization or development.</p>\n\n<p>Kuklewicz disambiguation algorithm was adopted in <a href=\"http://re2c.org\" rel=\"nofollow noreferrer\">lexer generator RE2C</a> and formalized in <a href=\"http://re2c.org/2017_trofimovich_tagged_deterministic_finite_automata_with_lookahead.pdf\" rel=\"nofollow noreferrer\">this unpublished paper</a> (of which I happen to be the author). RE2C also supports leftmost greedy disambiguation semantics and allows you to <a href=\"http://re2c.org/manual/features/submatch/submatch.html\" rel=\"nofollow noreferrer\">use explicit tags</a>. See also the simple example of <a href=\"http://re2c.org/examples/example_08.html\" rel=\"nofollow noreferrer\">parsing IPv4 address</a> or the more complex <a href=\"http://re2c.org/examples/example_10.html\" rel=\"nofollow noreferrer\">URI RFC-3986 parsing</a> example to get the idea.</p>\n\n<p>Back to your question:</p>\n\n<blockquote>\n  <p>how many times these tags have to be updated in order to match the sub-regex withing the regex for the given accepted input string</p>\n</blockquote>\n\n<p>The answer is, it depends on the <em>non-determinism degree</em> of the given regular expression (see <a href=\"http://re2c.org/2017_trofimovich_tagged_deterministic_finite_automata_with_lookahead.pdf\" rel=\"nofollow noreferrer\">the paper</a>, page 16, for the explanation). For a simple <em>tag-deterministic</em> regexp it is an insignificant constant-time overhead. For pathological cases with bounded repetition, see example 5 in the paper (page 21). See also the benchmarks (pages 27-29), they show that in real-world tests the overhead on submatch extraction is quite modest.</p>\n\n<p>Note also that Regex-TDFA uses <em>lazy</em> derminization, that is, all the overhead on determinization and POSIX disambiguation is in run-time, therefore the overall overhead on submatch extraction is greater than in RE2C case.</p>\n\n<p>Finally, you can explore Regex-TDFA internals by using <code>examineDFA</code> debug function defined in <code>/Text/Regex/TDFA/TDFA.hs</code> and further tweaking it to print the information you need.</p>\n"}], "owner": {"reputation": 33, "user_id": 9386849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/997c4413a30c42e0de04a0a0058b3162?s=128&d=identicon&r=PG&f=1", "display_name": "imran7", "link": "https://stackoverflow.com/users/9386849/imran7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1520767756, "creation_date": 1520702531, "question_id": 49211892, "link": "https://stackoverflow.com/questions/49211892/tag-operations-for-tagged-transitions-in-tdfatagged-dfa-for-sub-regex-matching", "title": "Tag operations for tagged transitions in TDFA(tagged DFA) for sub regex matching", "body": "<p>I am a beginner at Haskell programming. I was trying to match strings for regex using Haskell programming + TDFA for regex backend. And, I did successfully sub-regex matching operations, but not using tags concept proposed in TDFA. For example please see the following code. </p>\n\n<pre><code>{-# LANGUAGE MagicHash #-}\n\nimport Control.Monad\nimport Data.Array\nimport qualified Data.Text as T\nimport Text.Regex.TDFA\nimport Text.Regex.TDFA.Common       \n\nstr = \"bbbb\" :: String\nregex = \"(b|bb|bbb|bbbb)*\" :: String\n</code></pre>\n\n<p>/*   regex = \"(tag1 b|tag2 bb|tag3 bbb|tag4 bbbb)*\" :: String ---->interested now */</p>\n\n<pre><code>main = do\n  if str =~ regex then putStrLn \"matched\" else putStrLn \"no matches\"\n\n  let matches = getAllTextMatches (str =~ regex) :: Array Int (Array Int String)\n  print matches\n-- Output: array (0,1) [(0,array (0,1) [(0,\"bbbb\"),(1,\"bbbb\")]),(1,array (0,1) [(0,\"\"),(1,\"\")])]\n\n  let matches = getAllTextMatches $ str =~ regex :: [Array Int String]\n  print matches\n-- Output: [array (0,1) [(0,\"bbbb\"),(1,\"bbbb\")],array (0,1) [(0,\"\"),(1,\"\")]]\n\n  let matches = getAllTextMatches $ str =~ regex :: Array Int [String]\n  print matches\n-- Output: array (0,1) [(0,[\"bbbb\",\"bbbb\"]),(1,[\"\",\"\"])]\n\n  let matches = getAllTextMatches $ str =~ regex :: Array Int String\n  print matches\n-- Output: array (0,1) [(0,\"bbbb\"),(1,\"\")]\n\n  let matches = getAllTextMatches $ str =~ regex :: [String]\n  print matches\n-- Output: [\"bbbb\",\"\"]\n\n  let matches = str =~ regex :: [[String]]\n  print matches\n-- Output: [[\"bbbb\",\"bbbb\"],[\"\",\"\"]]\n\n  let matches = getAllTextMatches $ str =~ regex :: Array Int (MatchText String)\n  print matches\n-- Output: array (0,1) [(0,array (0,1) [(0,(\"bbbb\",(0,4))),(1,(\"bbbb\",(0,4)))]),(1,array (0,1) [(0,(\"\",(4,0))),(1,(\"\",(-1,0)))])]\n\n-- Using getAllMatches\n\n  let matches = getAllMatches $ str =~ regex :: Array Int MatchArray\n  print matches\n-- Output: array (0,1) [(0,array (0,1) [(0,(0,4)),(1,(0,4))]),(1,array (0,1) [(0,(4,0)),(1,(-1,0))])]\n\n  let matches = getAllMatches $ str =~ regex :: Array Int (MatchOffset,MatchLength)\n  print matches\n-- Output: array (0,1) [(0,(0,4)),(1,(4,0))]\n\n  let matches = getAllMatches $ str =~ regex :: [(MatchOffset,MatchLength)]\n  print matches\n-- Output: [(0,4),(4,0)]\n</code></pre>\n\n<p>Anyways, now, I am actually very much interested to see how tags operations on TDFA are performing while matching the subexpression for the accepted input strings. For example, </p>\n\n<p>Let's we have a regex, <code>R = (b|bb|bbb|bbbb)*</code> and input string = <code>\"bbbb\"</code>. So, using TDFA concept if I rewrite the regex <code>R = (tag1 b| tag2 bb | tag3 bbb| tag4 bbbb)*</code> and then if I try to match it for the input string = <code>\"bbbb\"</code> then, my interest is to see how many times <code>these tags{1,2,3,4}</code> are performing to match the regex <code>R</code>. As, on the given input string <code>\"bbbb\"</code>, first <code>b</code> will be the extent of matched <code>tag1</code>, same as input substring <code>\"bb\"</code> of <code>\"bbbb\"</code> will be the extent of <code>tag2</code>, and so on. This is how, if we now consider the full given input string <code>\"bbbb\"</code> then <code>tag4</code> will give the extent of it also at the same time will give the result such that <code>\"bbb\"</code> of <code>\"bbbb\"</code> matched the extent of <code>tag3</code>, same as <code>\"bb\"</code> of <code>\"bbbb\"</code> matched the extent of <code>tag2</code> and, finally <code>\"b\"</code> of <code>\"bbbb\"</code> matched the extent of <code>tag1</code>. Thus, I want to see these operations <code>using the TDFA module</code>. That's it. I mean, <code>how many times these tags have to be updated in order to match the sub-regex withing the regex for the given accepted input string</code>. That's it. </p>\n\n<p>Thus, any kind of help would be a lot to me...:) \nP.S.: It's a challenge for the Haskell beginner, thus looking for Haskell hacker. I mean sagacious one...:) Anyways,, hope for the best...:)</p>\n"}, {"tags": ["performance", "sorting", "haskell"], "comments": [{"owner": {"reputation": 29901, "user_id": 58737, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/95bd14f2b84f4af133b18d541dd33530?s=128&d=identicon&r=PG", "display_name": "Pratik Deoghare", "link": "https://stackoverflow.com/users/58737/pratik-deoghare"}, "edited": false, "score": 0, "creation_date": 1520698836, "post_id": 49211198, "comment_id": 85426956, "body": "Wikipedia <a href=\"https://en.wikipedia.org/wiki/Insertion_sort\" rel=\"nofollow noreferrer\">says</a> &gt; Adaptive, i.e., efficient for data sets that are already substantially sorted: the time complexity is O(nk) when each element in the input is no more than k places away from its sorted position  So if an element thats supposed to be last is first in the array, the complexity will be O(n^2) for insertion sort."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "reply_to_user": {"reputation": 29901, "user_id": 58737, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/95bd14f2b84f4af133b18d541dd33530?s=128&d=identicon&r=PG", "display_name": "Pratik Deoghare", "link": "https://stackoverflow.com/users/58737/pratik-deoghare"}, "edited": false, "score": 0, "creation_date": 1520699006, "post_id": 49211198, "comment_id": 85427009, "body": "Yes. By that logic, in [0..100000] the value of k is 1, So the current (not worst) time complexity of insertion sort should be 1 * n . Which is n."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1520701197, "post_id": 49211198, "comment_id": 85427784, "body": "Try making mkInsertionSort\u2019 a foldr or forM, because currently, I believe, the range [x-1, x-2 .. 0] is not fusing into a loop with it."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1520702083, "post_id": 49211198, "comment_id": 85428068, "body": "Actually, scratch that. There\u2019s no need for mvInsertionSort\u2019 to take a [Int] in the first place. You can just count down manually (which is what a foldr version would do, anyway)."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520702362, "post_id": 49211198, "comment_id": 85428167, "body": "Can you elaborate &quot;the range [x-1, x-2 .. 0] is not fusing into a loop with it&quot; ? How would I use foldr with with? These are mutable vectors, not lists."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1520711737, "post_id": 49211198, "comment_id": 85431252, "body": "I don&#39;t know haskell, but the linked to merge sort appears to be a natural merge sort that splits up an array or vector into ascending (and descending?) runs, then merges the runs. For nearly sorted data, it only takes a few merge passes. For already sorted data, it detects a single sorted (ascending) run in O(n) time."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1520712536, "post_id": 49211198, "comment_id": 85431486, "body": "A range [x, y, .. z] is produced by a loop. This loop stores values into a list. You immediately consume this list (the first argument of mkInsertionSort\u2019) in another loop. The list is allocated and wastes resources even when it doesn\u2019t need to exist, because the two loops can be fused into one by looping directly from the starting value to 0. Turning mkInsertionSort\u2019 into a foldr or forM over its first argument (I\u2019m not talking about the vectors) will allow the compiler to notice this and fuse the list into nonexistence, or you can do it manually."}], "answers": [{"comments": [{"owner": {"reputation": 52741, "user_id": 555045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/182d0ce855c8324a596648c04643e8f9?s=128&d=identicon&r=PG", "display_name": "nicomp", "link": "https://stackoverflow.com/users/555045/nicomp"}, "edited": false, "score": 0, "creation_date": 1520698340, "post_id": 49211229, "comment_id": 85426769, "body": "Insertion sort is not supposed to be quadratic on (almost) sorted data though"}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520698431, "post_id": 49211229, "comment_id": 85426802, "body": "I am well aware of that. My list is almost sorted. Here&#39;s a link. <a href=\"https://www.toptal.com/developers/sorting-algorithms/nearly-sorted-initial-order\" rel=\"nofollow noreferrer\">toptal.com/developers/sorting-algorithms/&hellip;</a>"}, {"owner": {"reputation": 8852, "user_id": 1383240, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/41093f55db0d5feaa0012ed6b5c3ca5c?s=128&d=identicon&r=PG&f=1", "display_name": "NiVeR", "link": "https://stackoverflow.com/users/1383240/niver"}, "edited": false, "score": 0, "creation_date": 1520698505, "post_id": 49211229, "comment_id": 85426824, "body": "Well, I believe than the implemented sort may include some optimizations for such cases as well."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520698596, "post_id": 49211229, "comment_id": 85426862, "body": "It&#39;s impossible to know how sorted/unsorted a data set is. Unless it makes an educated guess, scanning some % of the data."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 2, "creation_date": 1520699389, "post_id": 49211229, "comment_id": 85427138, "body": "&quot;some optimizations for such cases&quot; -- As @rjpj1998 hints at, there is no such optimisation. That can be verified through <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.OldList.html#sort\" rel=\"nofollow noreferrer\">the source code of <code>Data.List.sort</code></a>."}, {"owner": {"reputation": 8852, "user_id": 1383240, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/41093f55db0d5feaa0012ed6b5c3ca5c?s=128&d=identicon&r=PG&f=1", "display_name": "NiVeR", "link": "https://stackoverflow.com/users/1383240/niver"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520699566, "post_id": 49211229, "comment_id": 85427191, "body": "@duplode I see. Other than what you mentioned in the comment, I guess that it also depends on how much &#39;almost sorted&#39; the data is."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520699846, "post_id": 49211229, "comment_id": 85427292, "body": "With respect to that, the OP&#39;s test case is with fully sorted data (<code>[0..1000000]</code>)."}], "tags": [], "owner": {"reputation": 8852, "user_id": 1383240, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/41093f55db0d5feaa0012ed6b5c3ca5c?s=128&d=identicon&r=PG&f=1", "display_name": "NiVeR", "link": "https://stackoverflow.com/users/1383240/niver"}, "is_accepted": false, "score": 0, "last_activity_date": 1520698267, "creation_date": 1520698267, "answer_id": 49211229, "question_id": 49211198, "link": "https://stackoverflow.com/questions/49211198/why-is-my-insertion-sort-slower-than-library-merge-sort-on-almost-sorted-data/49211229#49211229", "title": "Why is my insertion sort slower than library merge sort on (almost) sorted data?", "body": "<p>Because the complexity of <code>merge/quick</code> sort is <code>O(n * log(n))</code> as opposed to <code>O(n*n)</code> of <code>insertion</code> sort.</p>\n"}, {"comments": [{"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520700912, "post_id": 49211522, "comment_id": 85427646, "body": "This seems to be the main problem. However the library sort is still faster. Should I use arrays instead of vectors? I just can&#39;t seem to figure out this last piece of the puzzle."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520707741, "post_id": 49211522, "comment_id": 85429948, "body": "You could redesign <code>mvInsertionSort&#39;</code> so that it just takes the first integer <code>y</code> instead of the list <code>[y,y-1..0]</code>.  That seems to speed it up by about 35% or so."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520743425, "post_id": 49211522, "comment_id": 85437460, "body": "K. A. Buhr. That sped things up, but it still seems 25% slower than the library sort."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520743965, "post_id": 49211522, "comment_id": 85437552, "body": "I have removed creation of all loops and used counters instead. Still similar performance."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520744551, "post_id": 49211522, "comment_id": 85437661, "body": "With both in -O2, my algorithm seems twice as faster. I can&#39;t seem to tag you."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1520700200, "creation_date": 1520700200, "answer_id": 49211522, "question_id": 49211198, "link": "https://stackoverflow.com/questions/49211198/why-is-my-insertion-sort-slower-than-library-merge-sort-on-almost-sorted-data/49211522#49211522", "title": "Why is my insertion sort slower than library merge sort on (almost) sorted data?", "body": "<p>The following self-contained program, compiled with GHC 8.2.2 using <code>ghc -O2</code> runs in a tenth of a second and allocates 176M on the heap.  If you bump it up to <code>[0..10000000]</code> instead of <code>[0..1000000]</code>, it runs in under a second and allocates 1.8G on the heap.  If I run the big version (10 million) under GHCi after <code>:set +s</code>, then I approximately duplicate your results: 12.1 secs and 12.9Gig.  If you're running timing tests under GHCi, don't do that!  GHCi compiles to an unoptimized, interpreted byte code.</p>\n\n<pre><code>import Control.Monad\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as Mv\n\nmvInsertionSort :: Ord a =&gt; Mv.IOVector a -&gt; IO (Mv.IOVector a)\nmvInsertionSort mv = do\n    forM_ [1 .. Mv.length mv - 1] $ \\x -&gt; do\n        pivot &lt;- Mv.read mv x\n        mvInsertionSort' [x-1, x-2 .. 0] mv pivot\n    return mv\n\n-- insertion Sort helper\nmvInsertionSort' :: Ord a =&gt; [Int] -&gt; Mv.IOVector a -&gt; a -&gt; IO ()\nmvInsertionSort' (y:ys) mv pivot = do\n    currElem &lt;- Mv.read mv y\n    if pivot &lt; currElem\n        then do \n                Mv.write mv y pivot \n                Mv.write mv (y+1) currElem \n                mvInsertionSort' ys mv pivot\n        else Mv.write mv (y+1) pivot\n\nmvInsertionSort' [] _ _ = return ()\n\nmain = do\n  let v = V.fromList [0..1000000]  -- one million\n  v' &lt;- V.freeze =&lt;&lt; mvInsertionSort =&lt;&lt; V.thaw v\n  print $ V.length v'\n</code></pre>\n"}], "owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 49211522, "answer_count": 2, "score": 0, "last_activity_date": 1520744497, "creation_date": 1520698140, "last_edit_date": 1520744497, "question_id": 49211198, "link": "https://stackoverflow.com/questions/49211198/why-is-my-insertion-sort-slower-than-library-merge-sort-on-almost-sorted-data", "title": "Why is my insertion sort slower than library merge sort on (almost) sorted data?", "body": "<p>The default <code>Data.List.sort</code> <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.OldList.html#sort\" rel=\"nofollow noreferrer\">is implemented using merge sort</a>. I have a huge list of almost sorted data. I figured using insertion sort would be much more beneficial. This was not the case unfortunately.</p>\n\n<p>Edit: Ok. So with -O2 my algorithm seems twice as faster when writing to /dev/null.</p>\n\n<p><code>length . mySort [0..1000000]</code> takes 18.5 seconds and consumes around 13gb of memory. whereas <code>length . sort [0..1000000]</code> takes 1.8 seconds and uses around 1.2 gb. This is more than 10 times as performant. Where did I go wrong? Here's my code</p>\n\n<pre><code>mvInsertionSort :: Ord a =&gt; Mv.IOVector a -&gt; IO (Mv.IOVector a)\nmvInsertionSort mv = do\n    forM_ [1 .. Mv.length mv - 1] $ \\x -&gt; do\n        pivot &lt;- Mv.read mv x\n        mvInsertionSort' [x-1, x-2 .. 0] mv pivot\n    return mv\n\n-- insertion Sort helper\nmvInsertionSort' :: Ord a =&gt; [Int] -&gt; Mv.IOVector a -&gt; a -&gt; IO ()\nmvInsertionSort' (y:ys) mv pivot = do\n    currElem &lt;- Mv.read mv y\n    if pivot &lt; currElem\n        then do \n                Mv.write mv y pivot \n                Mv.write mv (y+1) currElem \n                mvInsertionSort' ys mv pivot\n        else Mv.write mv (y+1) pivot\n\nmvInsertionSort' [] _ _ = return ()\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 4, "creation_date": 1520698358, "post_id": 49211131, "comment_id": 85426776, "body": "&quot;Write this code for me&quot; isn&#39;t really a good SO question.  And &quot;Write this code for me with some arbitrary constraint&quot; seems even worse.  Note that this function is traditionally called <code>splitOn</code> rather than <code>split</code>.  Maybe Hoogle for some examples and see what&#39;s already out there."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1520698597, "post_id": 49211131, "comment_id": 85426863, "body": "(<a href=\"https://meta.stackoverflow.com/questions/303701/when-a-users-question-amounts-to-write-this-code-for-me-what-is-the-best-cou\">Meta double dupe</a>)."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1520698693, "post_id": 49211131, "comment_id": 85426895, "body": "<a href=\"https://stackoverflow.com/questions/4978578/how-to-split-a-string-in-haskell\">Related</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1520710013, "post_id": 49211131, "comment_id": 85430712, "body": "Everything in Haskell can be reduced to a one-line implementation."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520763645, "post_id": 49211131, "comment_id": 85441536, "body": "There&#39;s <a href=\"https://hackage.haskell.org/package/split/docs/Data-List-Split.html#v:splitOn\" rel=\"nofollow noreferrer\">Data.List.Split.splitOn</a>, which seems to be included when in my Haskell environment."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1520781235, "post_id": 49211131, "comment_id": 85446529, "body": "@K. A. Buhr firstly, I post this question to <a href=\"https://codegolf.stackexchange.com/questions/157792/one-line-implementation-of-split-in-haskell\">code golf</a>, and they think this should be asked here, so I post this here...  I&#39;m wondering why this question can&#39;t be asked??"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1520781589, "post_id": 49211131, "comment_id": 85446648, "body": "@chepner When I say &quot;one-line implementation&quot;, I mean a very short and direct implementation, sorry for not explain this very clear."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1520781682, "post_id": 49211131, "comment_id": 85446675, "body": "@user202729 This question is very different since it is not asking for some packages to import, it is asking for some easy and direct implementation."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520781720, "post_id": 49211131, "comment_id": 85446687, "body": "@MarkSeemann yes, but not everywhere."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1520781861, "post_id": 49211131, "comment_id": 85446740, "body": "@K.A.Buhr There are many third-party packages who implemented this function, with different names,  maybe  <code>splitOn</code> is the most used one. giving the type signature and usage sample, I think there is no ambiguity, what do you think?"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 2, "creation_date": 1520782041, "post_id": 49211131, "comment_id": 85446810, "body": "Because it is not nice to ask someone else to do the whole work for you. I don&#39;t know, but such questions are not generally upvoted (with some exceptions)"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1520782268, "post_id": 49211131, "comment_id": 85446882, "body": "I&#39;m not asking someone else to do the work for me, I have found the package, and I also searched the related questions, but I never get a short and direct implementation of this function, I think this is an interesting question, and want to see if there is somebody else know the answer.  I think this is much like some &#39;golf&#39; question, so I firstly post it there, but not welcomed... and then here,, but still not welcomed..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1520868184, "post_id": 49211131, "comment_id": 85480941, "body": "While I do think there is an interesting question in here, and I will write an answer to it once I get some free time, the way it is phrased is a bit of a downvote magnet, unfortunately, for the reasons others have mentioned. I feel you&#39;d have had better luck with something like &quot;<code>split</code>  from <code>Data.List.Utils</code> isn&#39;t in <i>base</i>. I feel there should be a short-and-sweet implementation by composing a few <i>base</i> functions, but I can&#39;t figure it out. Am I missing something?&quot;"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521121677, "post_id": 49211131, "comment_id": 85604029, "body": "@duplode Thanks for your words, I feel better now.  I think there are many people in this platform voting by their feeling, without understand of the question itself...  Maybe my English is not good enough to embellish my words..."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 1, "creation_date": 1521380150, "post_id": 49211131, "comment_id": 85696614, "body": "Also, some people vote a question based on the existing votes. ..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1537514516, "post_id": 49211131, "comment_id": 91820072, "body": "@duplode OP had followed your advice but (my guess is) not many of the downvotes were undone. related: <a href=\"https://meta.stackexchange.com/questions/194108/responsibility-of-close-voters-to-re-examine-edited-question\" title=\"responsibility of close voters to re examine edited question\">meta.stackexchange.com/questions/194108/&hellip;</a> .........."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1537534441, "post_id": 49211131, "comment_id": 91831096, "body": "@WillNess Indeed. The system doesn&#39;t encourage folks to revisit their votes, and there is a lot of push back against suggestions along those lines (<a href=\"https://meta.stackoverflow.com/q/336788/2751851\">I tried that once, too</a>). To be fair, I must admit I hadn&#39;t actually noticed luochen1990&#39;s edit until now, even though I did read the comment accompanying the edit back when it was posted."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1537536362, "post_id": 49211131, "comment_id": 91832252, "body": "@duplode all the more evidence that a reminder from the system would go a long way. :) :)"}], "answers": [{"comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1521379995, "post_id": 49271176, "comment_id": 85696552, "body": "<a href=\"https://tio.run/##RcyxCsIwEIDhVzkOh3YRXXPEyVGouwhJm7QNpmnIHejQd48OiuvPzzdbfvgYaw1LXovA2YrdXwILseEcg3TJyCZaI@ob4n1jE/ha/Bhe3Wjkk9V3A25cWXMTfZpkBm6l3Y6ng26sGlrl4Dn74sGqXgsNyum/39fFhgQacglJYAc/EYkQ0PZEg/NE44T1DQ\" rel=\"nofollow noreferrer\">My implementation</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1521380856, "post_id": 49271176, "comment_id": 85696815, "body": "@user202729 Further evidence that you can make it compact, as long as you&#39;re willing to go full PCG :) You might want to post it as an actual answer."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1537533989, "last_edit_date": 1537533989, "creation_date": 1521009467, "answer_id": 49271176, "question_id": 49211131, "link": "https://stackoverflow.com/questions/49211131/one-line-implementation-of-split-in-haskell/49271176#49271176", "title": "One-line implementation of split in Haskell", "body": "<p>Arguably, the best way to check how feasible a short-and-sweet <code>splitOn</code> (or <code>split</code>, as you and <a href=\"http://hackage.haskell.org/package/MissingH-1.4.0.1/docs/Data-List-Utils.html#v:split\" rel=\"nofollow noreferrer\"><em>MissingH</em></a> call it -- here I will stick to the name used by the <a href=\"https://hackage.haskell.org/package/split-0.2.3.3/docs/Data-List-Split.html#v:splitOn\" rel=\"nofollow noreferrer\"><em>split</em></a> and <a href=\"http://hackage.haskell.org/package/extra-1.6.4/docs/Data-List-Extra.html#splitOn\" rel=\"nofollow noreferrer\"><em>extra</em></a> packages) is trying to write it [note 1].</p>\n\n<p>(By the way, I will use <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2\" rel=\"nofollow noreferrer\"><em>recursion-schemes</em></a> functions and concepts in this answer, as I find systematising things a bit helps me think about this kind of problem. Do let me know if anything is unclear.)</p>\n\n<p>The type of <code>splitOn</code> is [note 2]:</p>\n\n<pre><code>splitOn :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>One way to write a recursive function that builds one data structure from another, like <code>splitOn</code> does, begins by asking whether to do it by walking the original structure in a <em>bottom-up</em> or a <em>top-down</em> way (for lists, that amounts to right-to-left and left-to-right respectively). A bottom-up walk is more naturally expressed as some kind of fold:</p>\n\n<pre><code>foldr @[] :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\ncata @[_] :: (ListF a b -&gt; b) -&gt; [a] -&gt; b\n</code></pre>\n\n<p>(<code>cata</code>, short for catamorphism, is how <em>recursion-schemes</em> expresses a vanilla fold. The <code>ListF a b -&gt; b</code> function, called an <em>algebra</em> in the jargon, specifies what happens in each fold step. <code>data ListF a b = Nil | Cons a b</code>, and so, in the case of lists, the algebra amounts to the two first arguments of <code>foldr</code> rolled into one -- the binary function corresponds to the <code>Cons</code> case, and the seed of the fold, to the <code>Nil</code> one.)</p>\n\n<p>A top-down walk, on the other hand, lends itself to an unfold:</p>\n\n<pre><code>unfoldr :: (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a] -- found in Data.List\nana @[_] :: (b -&gt; ListF a b) -&gt; b -&gt; [a]\n</code></pre>\n\n<p>(<code>ana</code>, short for anamorphism, is the vanilla unfold in <em>recursion-schemes</em>. The <code>b -&gt; ListF a b</code> function is a <em>coalgebra</em>; it specifies what happens in each unfold step. For a list, the possibilities are either emitting a list element and an updated seed or generating an empty list and terminating the unfold.)</p>\n\n<p>Should <code>splitOn</code> be bottom-up or top-down? To implement it, we need to, at any given position in the list, look ahead in order to check whether the current list segment starts with the delimiter. That being so, it makes sense to reach for a top-down solution i.e. an unfold/anamorphism.</p>\n\n<p>Playing with ways to write <code>splitOn</code> as an unfold shows another thing to consider: you want each individual unfold step to generate a fully-formed list chunk. Not doing so will, at best, lead you to unnecessarily walk the original list twice [note 3]; at worst, catastrophic memory usage and stack overflows on long list chunks await [note 4]. One way to achieve that is through a <code>breakOn</code> function, like the one in <a href=\"http://hackage.haskell.org/package/extra-1.6.4/docs/Data-List-Extra.html#v:breakOn\" rel=\"nofollow noreferrer\"><code>Data.List.Extra</code></a>...</p>\n\n<pre><code>breakOn :: Eq a =&gt; [a] -&gt; [a] -&gt; ([a], [a]) \n</code></pre>\n\n<p>... which is like <code>break</code> from the Prelude, except that, instead of applying a predicate to each element, it checks whether the remaining list segment has the first argument as a prefix [note 5].</p>\n\n<p>With <code>breakOn</code> at hand, we can write a proper <code>splitOn</code> implementation -- one that, compiled with optimisations, matches in performance the library ones mentioned at the beginning:</p>\n\n<pre><code>splitOnAtomic :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]\nsplitOnAtomic delim\n    | null delim = error \"splitOnAtomic: empty delimiter\"\n    | otherwise = apo coalgSplit\n    where\n    delimLen = length delim\n    coalgSplit = \\case\n        [] -&gt; Cons [] (Left [])\n        li -&gt;\n            let (ch, xs) = breakOn (delim `isPrefixOf`) li\n            in Cons ch (Right (drop delimLen xs))\n</code></pre>\n\n<p>(<code>apo</code>, short for apomorphism, is an unfold that can be short-circuited. That is done by emitting from an unfold step, rather than the usual updated seed -- signaled by <code>Right</code> -- a final result -- signaled by <code>Left</code>. Short-circuiting is needed here because, in the empty list case, we want neither to produce an empty list by returning <code>Nil</code> -- which would wrongly result in <code>splitOn delim [] = []</code> -- nor to resort to <code>Cons [] []</code> -- which would generate an infinite tail of <code>[]</code>. This trick corresponds directly to the additional <code>splitOn _ [] = [[]]</code> case added to the <a href=\"http://hackage.haskell.org/package/extra-1.6.4/docs/src/Data-List-Extra.html#splitOn\" rel=\"nofollow noreferrer\"><code>Data.List.Extra</code> implementation</a>.)</p>\n\n<p>After a few slight detours, we can now address your actual question. <code>splitOn</code> is tricky to write in a short way because, firstly, the recursion pattern it uses isn't entirely trivial; secondly, a good implementation requires a few details that are inconvenient for golfing; and thirdly, what appears to be the best implementation relies crucially on <code>breakOn</code>, which is not in <em>base</em>.</p>\n\n<hr>\n\n<p>Notes:</p>\n\n<p><strong>[note 1]:</strong> Here are the imports and pragmas needed to run the snippets in this answer:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveTraversable #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\nimport Data.List\nimport Data.Maybe\n</code></pre>\n\n<p><strong>[note 2]:</strong> An alternative type might be <code>Eq a =&gt; NonEmpty a -&gt; [a] -&gt; NonEmpty [a]</code>, if one wants to put precision above all else. I won't bother with that here to avoid unnecessary distractions.</p>\n\n<p><strong>[note 3]:</strong> As in this rather neat implementation, which uses two unfolds -- the first one (<code>ana coalgMark</code>) replaces the delimiters with <code>Nothing</code>, so that the second one (<code>apo coalgSplit</code>) can split in a straightforward way:</p>\n\n<pre><code>splitOnMark :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]\nsplitOnMark delim\n    | null delim = error \"splitOnMark: empty delimiter\"\n    | otherwise = apo coalgSplit . ana coalgMark\n    where\n    coalgMark = \\case\n        [] -&gt; Nil\n        li@(x:xs) -&gt; case stripPrefix delim li of\n            Just ys -&gt; Cons Nothing ys\n            Nothing -&gt; Cons (Just x) xs\n    coalgSplit = \\case\n        [] -&gt; Cons [] (Left [])\n        mxs -&gt;\n            let (mch, mys) = break isNothing mxs\n            in Cons (catMaybes mch) (Right (drop 1 mys))\n</code></pre>\n\n<p>(What <code>apo</code> is and what <code>Left</code> and <code>Right</code> are doing here will be covered a little further in the main body of the answer.)</p>\n\n<p>This implementation has fairly acceptable performance, though with optimisations it is a slower than the one in the main body of the answer by a (modest) constant factor. It might be a little easier to golf this one, though...</p>\n\n<p><strong>[note 4]:</strong> As in this single unfold implementation, which uses a coalgebra that calls itself recursively to build each chunk as a (difference) list:</p>\n\n<pre><code>splitOnNaive :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]\nsplitOnNaive delim \n    | null delim = error \"splitOn: empty delimiter\"\n    | otherwise = apo coalgSplit . (,) id\n    where\n    coalgSplit = \\case\n        (ch, []) -&gt; Cons (ch []) (Left [])\n        (ch, li@(x:xs)) -&gt; case stripPrefix delim li of\n            Just ys -&gt; Cons (ch []) (Right (id, ys))\n            Nothing -&gt; coalg (ch . (x :), xs)\n</code></pre>\n\n<p>Having to decide at each element whether to grow the current chunk or to start a new one is in itself problematic, as it breaks laziness.</p>\n\n<p><strong>[note 5]:</strong> <a href=\"http://hackage.haskell.org/package/extra-1.6.4/docs/src/Data-List-Extra.html#breakOn\" rel=\"nofollow noreferrer\">Here is how <code>Data.List.Extra</code> implements <code>breakOn</code></a>. If we want to achieve that using a <em>recursion-schemes</em> unfold, one good strategy is defining a data structure that encodes exactly what we are trying to build:</p>\n\n<pre><code>data BrokenList a = Broken [a] | Unbroken a (BrokenList a)\n    deriving (Eq, Show, Functor, Foldable, Traversable)\nmakeBaseFunctor ''BrokenList\n</code></pre>\n\n<p>A <code>BrokenList</code> is just like a list, except that the empty list is replaced by the (non-recursive) <code>Broken</code> constructor, which marks the break point and holds the remainder of the list. Once generated by an unfold, a <code>BrokenList</code> can be easily folded into a pair of lists: the elements in the <code>Unbroken</code> values are consed into one list, and the list in <code>Broken</code> becomes the other one:</p>\n\n<pre><code>breakOn :: ([a] -&gt; Bool) -&gt; [a] -&gt; ([a], [a])\nbreakOn p = hylo algPair coalgBreak\n    where\n    coalgBreak = \\case\n        [] -&gt; BrokenF []\n        li@(x:xs)\n            | p li -&gt; BrokenF li\n            | otherwise -&gt; UnbrokenF x xs\n    algPair = \\case \n        UnbrokenF x ~(xs, ys) -&gt; (x : xs, ys)\n        BrokenF ys -&gt; ([], ys)\n</code></pre>\n\n<p>(<code>hylo</code>, short for hylomorphism, is simply an <code>ana</code> followed by a <code>cata</code>, i.e. an unfold followed by a fold. <code>hylo</code>, as implemented in <em>recursion-schemes</em>, takes advantage of the fact that the intermediate data structure, created by the unfold and then immediately consumed by the fold, can be fused away, leading to significant performance gains.) </p>\n\n<p>It is worth mentioning that the lazy pattern match in <code>algPair</code> is crucial to preserve laziness. The <code>Data.List.Extra</code> implementation linked to above achieves that by using <code>first</code> from <code>Control.Arrow</code>, which also matches the pair given to it lazily.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1217, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1537533989, "creation_date": 1520697731, "last_edit_date": 1521121868, "question_id": 49211131, "link": "https://stackoverflow.com/questions/49211131/one-line-implementation-of-split-in-haskell", "title": "One-line implementation of split in Haskell", "body": "<p>What I want is the following one (which I think should be included in prelude since it is very useful in text processing):</p>\n\n<pre><code>split :: Eq a =&gt; [a] -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>e.g:</p>\n\n<pre><code>split \";;\" \"hello;;world\" = [\"hello\", \"world\"]\n</code></pre>\n\n<p><code>split</code> from <code>Data.List.Utils</code> isn't in base. I feel there should be a short-and-sweet implementation by composing a few base functions, but I can't figure it out. Am I missing something?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": true, "score": 18, "last_activity_date": 1587610587, "last_edit_date": 1587610587, "creation_date": 1520691335, "answer_id": 49210065, "question_id": 49209788, "link": "https://stackoverflow.com/questions/49209788/simplest-examples-demonstrating-the-need-for-nominal-type-role-in-haskell/49210065#49210065", "title": "Simplest examples demonstrating the need for nominal type role in Haskell", "body": "<p>Should you be able to coerce?</p>\n\n<pre><code> coerce :: Coercible a b =&gt; F a -&gt; F b\n</code></pre>\n\n<p>If not, then the argument of <code>F</code> should be nominal.</p>\n\n<p>In the case of <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Set.html#t:Set\" rel=\"nofollow noreferrer\"><code>Set</code></a> its first role is nominal</p>\n\n<pre><code>type role Set nominal\n</code></pre>\n\n<p>because we don't want</p>\n\n<pre><code>coerce :: Set Int -&gt; Set ReversedInt\n</code></pre>\n\n<p>because <code>newtype ReversedInt = RevInt Int deriving (Eq, Ord) via Data.Ord.Down Int</code> has a completely different <code>Ord</code> than <code>Int</code> and the internal structure of <code>Set</code> depends on the ordering of its elements. Same for <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Lazy.html#t:Map\" rel=\"nofollow noreferrer\"><code>Map</code></a></p>\n\n<pre><code>type role Map nominal representational\n</code></pre>\n\n<hr>\n\n<p>For a GADT like</p>\n\n<pre><code>data F :: Type -&gt; Type where\n  FInt :: F Int\n</code></pre>\n\n<p>we have a single inhabitant, so we don't want to allow</p>\n\n<pre><code>coerce :: F Int -&gt; F ReversedInt\n</code></pre>\n\n<p>So, GHC infers <code>type role F nominal</code>.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 4, "accepted_answer_id": 49210065, "answer_count": 1, "score": 13, "last_activity_date": 1587610587, "creation_date": 1520689685, "question_id": 49209788, "link": "https://stackoverflow.com/questions/49209788/simplest-examples-demonstrating-the-need-for-nominal-type-role-in-haskell", "title": "Simplest examples demonstrating the need for nominal type role in Haskell", "body": "<p>I'm trying to understand what determines whether a type parameter must be nominal.</p>\n\n<p>While GADTs and type familes seem different in the sense they are not \"simple containers\" as their instance definitions can \"look at\" their parameters, can simple types have obvious need for nominal parameters, like Set?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1520684531, "post_id": 49209012, "comment_id": 85422495, "body": "You need to specify that the type <code>a</code> is of class <code>Eq</code> as well in the signature of <code>myLength</code> (as shown <a href=\"https://en.wikibooks.org/wiki/Haskell/Classes_and_types#Type_constraints\" rel=\"nofollow noreferrer\">here</a>), otherwise the compiler doesn&#39;t know if it can compare <code>[a]</code>."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1520684578, "post_id": 49209012, "comment_id": 85422508, "body": "@hnefatl Thanks for your comment, however, I&#39;m new to Haskell, so I do not know how to do that, can you post s little example."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1520684735, "post_id": 49209012, "comment_id": 85422547, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/16154592/haskell-no-instance-for-eq-a-arising-from-a-use-of\">Haskell: No instance for (Eq a) arising from a use of `==&#39;</a>"}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1520684888, "post_id": 49209012, "comment_id": 85422590, "body": "@hnefatl I totally understood your argument, but from my point of view, should any list of type [a] be comparable ? I mean I cannot think any type <code>a</code> whose such that we cannot compare the values of that type. Is there any such type on top of your head right now ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1520685421, "post_id": 49209012, "comment_id": 85422738, "body": "@onurcanbektas <code>[Integer-&gt;Bool]</code> must not be of class <code>Eq</code>, since we can&#39;t decide whether two functions are the same in finite time."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1520685715, "post_id": 49209012, "comment_id": 85422841, "body": "As a general thumb rule, try to use pattern matching before anything else. A function on lists is often defined with <code>foo [] = ... ; foo (x:xs) = ...</code> where in the latter case we recurse as <code>foo xs</code>. Your approach to find the length is way more complex than needed, and even less general. You can also follow some <a href=\"http://learnyouahaskell.com/syntax-in-functions#pattern-matching\" rel=\"nofollow noreferrer\">tutorial on pattern matching</a>"}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1520686235, "post_id": 49209012, "comment_id": 85422989, "body": "@chi Thanks for your helpful comments, actually, I haven&#39;t even studied pattern matching yet, and I know my solution is not efficient nor elegant, but just trying to use the things that I have learned, and get use the functional programming paradigm for the time being, but I will try to find another solution with that structure as well."}], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520685321, "post_id": 49209097, "comment_id": 85422705, "body": "But the code you have provided still gives the same error ?"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520685591, "post_id": 49209097, "comment_id": 85422789, "body": "@onurcanbektas Ah, sorry, <code>go</code> must be also contexted the same."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1520685632, "post_id": 49209097, "comment_id": 85422811, "body": "You should have <code>{-# Language ScopedTypeVariables #-}</code> at the very top and write <code>myLength :: forall a. Eq a =&gt; [a] -&gt; Int</code>. Otherwise <code>a</code> in <code>myLength</code> and <code>a</code> in <code>go</code> refer to completely different types"}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520685645, "post_id": 49209097, "comment_id": 85422816, "body": "Ok, now it works, but shouldn&#39;t the compiler pass the info that <code>a</code> is a is of class <code>Eq</code> to <code>go</code> function ?"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520685714, "post_id": 49209097, "comment_id": 85422840, "body": "@onurcanbektas You explicitly specified <code>go</code>&#39;s instance context to be none, so it is."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520685845, "post_id": 49209097, "comment_id": 85422879, "body": "@DannyuNDos I have specified only that <code>go</code> is going to be fed with <code>[a]</code> where what is <code>a</code> is going to be determined by what is fed with <code>myLength</code> where I have specified that the parameter is of class <code>Eq</code> ?"}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1520685882, "post_id": 49209097, "comment_id": 85422889, "body": "@Iceland_jack That does not work, I mean the compiler also suggested that, but it still gives error with that."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1520685961, "post_id": 49209097, "comment_id": 85422912, "body": "@Iceland_jack After reading your comment third time, I guess I have misunderstood what you mean, so can you provide an example, just to be clear."}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520686026, "post_id": 49209097, "comment_id": 85422930, "body": "@onurcanbektas The type parameter <code>a</code> in <code>go</code>&#39;s type signature is independent from <code>myLength</code>&#39;s. (Try substituting <code>go</code>&#39;s <code>a</code> to <code>b</code> and it will be clear.)"}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1520686089, "post_id": 49209097, "comment_id": 85422951, "body": "GHC doesn&#39;t suggest <code>ScopedTypeVariables</code> so I doubt it. I created another answer <a href=\"https://stackoverflow.com/a/49209220/165806\">stackoverflow.com/a/49209220/165806</a>"}], "tags": [], "owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "is_accepted": true, "score": 2, "last_activity_date": 1521606599, "last_edit_date": 1521606599, "creation_date": 1520685055, "answer_id": 49209097, "question_id": 49209012, "link": "https://stackoverflow.com/questions/49209012/compiler-cannot-decide-the-type-of-the-return-value-of-take-function/49209097#49209097", "title": "Compiler cannot decide the type of the return value of `take` function", "body": "<p>What you need is instance contexts (here <code>Eq a</code>), which is indicated by <code>=&gt;</code>:</p>\n\n<pre><code>myLength :: Eq a =&gt; [a] -&gt; Int\nmyLength [] = 0\nmyLength ys = go 1 ys\n where\n  go :: Eq a =&gt; Int -&gt; [a] -&gt; Int\n  go n xs\n   | ( (take n xs) == (take (n+1) xs) ) = n\n   | otherwise = go (n+1) xs\n</code></pre>\n\n<p>But this is not a proper answer to the question #4, because it adds an additional constraint to the function.</p>\n\n<p><strong>EDIT</strong>: For the question <strong>\"Shouldn't every list be equality comparable?\"</strong>:<br>\nLists are comparable iff their elements are comparable. For example, functions, <code>Kleisli</code> arrows, <code>WrappedArrow</code>s are not equality comparable, so aren't lists of them.</p>\n"}, {"comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1520686156, "post_id": 49209220, "comment_id": 85422967, "body": "@onurcanbektas Here, <code>go</code>&#39;s <code>a</code> is same as <code>myLength</code>&#39;s, because of the <code>forall a</code>. (I don&#39;t know a thing about <code>ScopedTypeVariables</code>, though.)"}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520686483, "post_id": 49209220, "comment_id": 85423058, "body": "It throws the error <code>Illegal symbol &#39;.&#39; in type     Perhaps you intended to use RankNTypes or a similar language     extension to enable explicit-forall syntax: forall &lt;tvs&gt;. &lt;type&gt;</code>."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1520686518, "post_id": 49209220, "comment_id": 85423066, "body": "@DannyuNDos that <code>forall .</code> thing does not work, I mean the compiler also suggested it for several times."}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520691840, "post_id": 49209220, "comment_id": 85424723, "body": "@onurcanbektas Note the <code>{-# LANGUAGE ScopedTypedVariables #-}</code>. Using that along with the <code>forall a.</code> means the <code>a</code> in the <code>go</code> signature is the same as the one in the <code>myLength</code> signature. Also I believe <code>LANGUAGE</code> needs to be all caps unlike what has been written here."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1520700487, "post_id": 49209220, "comment_id": 85427510, "body": "<code>Language</code> is fine, \u201ccase is ignored\u201d per <a href=\"https://downloads.haskell.org/~ghc/7.8.1/docs/html/users_guide/pragmas.html\" rel=\"nofollow noreferrer\">user guide</a>"}, {"owner": {"reputation": 3887, "user_id": 7914637, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-x_BhuHcC8Ww/AAAAAAAAAAI/AAAAAAAAABg/hiPWIjRXbhI/photo.jpg?sz=128", "display_name": "Alexander", "link": "https://stackoverflow.com/users/7914637/alexander"}, "edited": false, "score": 1, "creation_date": 1520703045, "post_id": 49209220, "comment_id": 85428426, "body": "While this code may answer the question, providing additional context regarding <b>how</b> and <b>why</b> it solves the problem would improve the answer&#39;s long-term value."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520705741, "post_id": 49209220, "comment_id": 85429281, "body": "Actually, <code>{-# LANGUAGE ScopedTypedVariables #-}</code> is not read by ghci. I mean at least I couldn&#39;t make it work."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1520719462, "post_id": 49209220, "comment_id": 85433363, "body": "For ghci you need to run <code>ghci&gt; :set -XScopedTypeVariables</code>, I was posting a <code>.hs</code> file"}], "tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": false, "score": 1, "last_activity_date": 1520686031, "creation_date": 1520686031, "answer_id": 49209220, "question_id": 49209012, "link": "https://stackoverflow.com/questions/49209012/compiler-cannot-decide-the-type-of-the-return-value-of-take-function/49209220#49209220", "title": "Compiler cannot decide the type of the return value of `take` function", "body": "<pre><code>{-# Language ScopedTypeVariables #-}\n\nmyLength :: forall a. Eq a =&gt; [a] -&gt; Int\nmyLength [] = 0\nmyLength ys = go 1 ys\n where\n\n  go :: Int -&gt; [a] -&gt; Int\n  go n xs\n   | take n xs == take (n+1) xs = n\n   | otherwise = go (n+1) xs\n</code></pre>\n"}], "owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 49209097, "answer_count": 2, "score": 1, "last_activity_date": 1521606599, "creation_date": 1520684410, "last_edit_date": 1520686387, "question_id": 49209012, "link": "https://stackoverflow.com/questions/49209012/compiler-cannot-decide-the-type-of-the-return-value-of-take-function", "title": "Compiler cannot decide the type of the return value of `take` function", "body": "<p>I'm trying to solve <a href=\"https://wiki.haskell.org/99_questions/1_to_10\" rel=\"nofollow noreferrer\">the 99 problems in Haskell</a>, and for the 4th question, I have first tried such a solution</p>\n\n<pre><code>myLength :: [a] -&gt; Int\nmyLength [] = 0\nmyLength ys = go 1 ys\n where\n  go :: Int -&gt; [a] -&gt; Int\n  go n xs\n   | ( (take n xs) == (take (n+1) xs) ) = n\n   | otherwise = go (n+1) xs\n</code></pre>\n\n<p>However, the compiler gives the error:</p>\n\n<pre><code>Problem4.hs:10:8: error:\n    \u2022 No instance for (Eq a1) arising from a use of \u2018==\u2019\n      Possible fix:\n        add (Eq a1) to the context of\n          the type signature for:\n            go :: forall a1. Int -&gt; [a1] -&gt; Int\n    \u2022 In the expression: ((take n xs) == (take (n + 1) xs))\n      In a stmt of a pattern guard for\n                     an equation for \u2018go\u2019:\n        ((take n xs) == (take (n + 1) xs))\n      In an equation for \u2018go\u2019:\n          go n xs\n            | ((take n xs) == (take (n + 1) xs)) = n\n            | otherwise = go (n + 1) xs\n   |\n10 |    | ( (take n xs) == (take (n+1) xs) ) = n\n   |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>As far as I understood, the reason for the error it that when we try to compare the lists returned from <code>(take n xs)</code> and <code>(take (n+1) xs)</code>, the compiler does not know the types of lists in advance, so it cannot compare them, and this is why it complains, so before this line, I need to tell the compiler that both return values are the same type, and the type is <code>[a]</code>, but how can we do that ?</p>\n\n<p><strong>A confusion:</strong> when we specify the type signature of <code>go</code>, we are explicitly fixing the what is the type of <code>xs</code>, i.e so shouldn't the list that is return by the function <code>take</code> have the same type, namely <code>[a]</code>, hence shouldn't the compiler be able to compare them ?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Note that, I have another function in the definition of a function, and there are lots of things that are different from the question that is marked as duplicate, and as you can observe, the given answer to that question does not fully solves this question.</p>\n"}, {"tags": ["haskell", "compiler-errors"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1520678572, "post_id": 49207052, "comment_id": 85420944, "body": "Could you write down the type of <code>item</code> please?"}, {"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1520690923, "post_id": 49207052, "comment_id": 85424462, "body": "item :: Parser Char item = \\inp -&gt; case inp of                    [] -&gt; []                    (x:xs) -&gt; [(x,xs)]"}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 0, "last_activity_date": 1520691938, "creation_date": 1520691938, "answer_id": 49210149, "question_id": 49207052, "link": "https://stackoverflow.com/questions/49207052/haskell-graham-hutton-book-old-yellow-parsing-ch-8/49210149#49210149", "title": "Haskell: Graham Hutton Book-(old-Yellow), Parsing (Ch-8)", "body": "<p>You have <code>type Parser a = String -&gt; [(a,String)]</code>?</p>\n\n<p>Therefore you are using the <code>(-&gt;) String</code> <code>Monad</code> instance. So <code>x</code> has type <code>[(Char, String)]</code>, as does <code>y</code>. Your code wants to <code>return</code> the pair <code>(x,y)</code> which has type <code>([(Char,String)],[(Char,String)])</code>. Therefore you get <code>p :: String -&gt; ([(Char,String)],[(Char,String)])</code> but you are claiming that <code>p :: Parser (Char, Char)</code> which is the same as <code>p :: String -&gt; [(Char, Char)]</code>. These don\u2019t match so you get a type error.</p>\n\n<p>Your problem is that you are treating <code>Parser</code> like a monad but it isn\u2019t. Specifically you expect:</p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; (a -&gt; Parser b) -&gt; Parser b\nreturn :: a -&gt; Parser a\n</code></pre>\n\n<p>But you have:</p>\n\n<pre><code>(&gt;&gt;=) :: Parser a -&gt; ([(a,String)] -&gt; Parser b) -&gt; Parser b\nreturn :: [(a,String)] -&gt; Parser a\n</code></pre>\n\n<p>Or more generally:</p>\n\n<pre><code>(&gt;&gt;=) :: (String -&gt; a) -&gt; (a -&gt; String -&gt; b) -&gt; (String -&gt; b)\nreturn :: a -&gt; (String -&gt; a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": false, "score": 0, "last_activity_date": 1520693665, "creation_date": 1520693665, "answer_id": 49210411, "question_id": 49207052, "link": "https://stackoverflow.com/questions/49207052/haskell-graham-hutton-book-old-yellow-parsing-ch-8/49210411#49210411", "title": "Haskell: Graham Hutton Book-(old-Yellow), Parsing (Ch-8)", "body": "<p>It seems like you haven't defined the monad instance for type <code>Parser</code>. You can try to do so or just use the <a href=\"http://www.cs.nott.ac.uk/~pszgmh/Parsing.lhs\" rel=\"nofollow noreferrer\">library for parsing</a> that includes the definitions from the book. </p>\n"}, {"comments": [{"owner": {"reputation": 1099, "user_id": 4929834, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/C47BB.jpg?s=128&g=1", "display_name": "Alberto Centelles", "link": "https://stackoverflow.com/users/4929834/alberto-centelles"}, "edited": false, "score": 0, "creation_date": 1520707371, "post_id": 49212667, "comment_id": 85429820, "body": "Stephen Diehl&#39;s tutorial is also a great resource <a href=\"http://dev.stephendiehl.com/fun/002_parsers.html\" rel=\"nofollow noreferrer\">dev.stephendiehl.com/fun/002_parsers.html</a>"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1520718100, "post_id": 49212667, "comment_id": 85433006, "body": "I suppose you\u2019re using <code>concatMap</code> to be consistent but you can use plain old regular <code>map</code> or <code>fmap</code> in your <code>Functor</code> instance and your instance for <code>&lt;$&gt;</code> seems a tiny bit convoluted, why not <code>concatMap (\\(f, s&#39;) -&gt; fmap f pa s&#39;) (parse pf s)</code>? If you were feeling particularly silly I guess <code>parse pf s &gt;&gt;= uncurry (flip fmap pa)</code> but that is obtuse"}, {"owner": {"reputation": 1099, "user_id": 4929834, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/C47BB.jpg?s=128&g=1", "display_name": "Alberto Centelles", "link": "https://stackoverflow.com/users/4929834/alberto-centelles"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1520757545, "post_id": 49212667, "comment_id": 85440124, "body": "Totally. You can write it as clever as you want it to be. I just find the way I wrote it easy to understand for beginners.  The Functor instance would look more terse like: <code>instance Functor Parser where    fmap f p = Parser $ fmap (first f) . parse p</code> The Applicative instance: <code>instance Applicative Parser where   pf &lt;*&gt; pa = Parser $ parse pf &gt;=&gt; (\\(f, s&#39;) -&gt; first f &lt;$&gt; parse pa s&#39;)</code> Monad: <code>instance Monad Parser where   pa &gt;&gt;= f = Parser $ parse pa &gt;=&gt; (\\(a, s&#39;) -&gt; parse (f a) s&#39;)</code> But, again, I think it doesn&#39;t help here"}], "tags": [], "owner": {"reputation": 1099, "user_id": 4929834, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/C47BB.jpg?s=128&g=1", "display_name": "Alberto Centelles", "link": "https://stackoverflow.com/users/4929834/alberto-centelles"}, "is_accepted": false, "score": 1, "last_activity_date": 1520756375, "last_edit_date": 1520756375, "creation_date": 1520706988, "answer_id": 49212667, "question_id": 49207052, "link": "https://stackoverflow.com/questions/49207052/haskell-graham-hutton-book-old-yellow-parsing-ch-8/49212667#49212667", "title": "Haskell: Graham Hutton Book-(old-Yellow), Parsing (Ch-8)", "body": "<p>You are right. Parser is just an alias of a function, so it makes use of the Monad instance of (->). That's why you get <code>String -&gt; ([(Char, String)], [(Char, String)])</code> instead of <code>Parser (Char, Char)</code> or <code>String -&gt; [((Char, Char), String)]</code>.</p>\n\n<p>I would recommend to create a new type yourself and instantiate Functor, Applicative and Monad to get the expected results.</p>\n\n<p>This would do the work:</p>\n\n<pre><code>newtype Parser a = Parser { parse :: String -&gt; [(a, String)] }\n\nitem :: Parser Char\nitem = Parser $ \\case\n  [] -&gt; []\n  (c:cs) -&gt; [(c, cs)]\n\ninstance Functor Parser where\n  fmap f p = Parser $ \\s -&gt;\n    concatMap (\\(a, s) -&gt; [(f a, s)]) $ parse p s\n\ninstance Applicative Parser where\n  pure a = Parser $ \\s -&gt; [(a, s)]\n  pf &lt;*&gt; pa = Parser $ \\s -&gt;\n    concatMap\n      (\\(f, s') -&gt; fmap (\\(a, s'') -&gt; (f a, s'')) (parse pa s'))\n      (parse pf s)\n\ninstance Monad Parser where\n  return a = Parser $ \\s -&gt; [(a, s)]\n  pa &gt;&gt;= f = Parser $ \\s -&gt;\n    concatMap (\\(a, s') -&gt; parse (f a) s') (parse pa s)\n\np :: Parser (Char,Char)\np =  do x &lt;- item\n        item\n        y &lt;- item\n        return (x,y)\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1520756375, "creation_date": 1520670931, "question_id": 49207052, "link": "https://stackoverflow.com/questions/49207052/haskell-graham-hutton-book-old-yellow-parsing-ch-8", "title": "Haskell: Graham Hutton Book-(old-Yellow), Parsing (Ch-8)", "body": "<p>I copied this example exactly as it appeared in the book (first version).</p>\n\n<p>given in the book:</p>\n\n<pre><code>p :: Parser (Char,Char)\n\np =  do x &lt;- item\n        item\n        y &lt;- item\n        return (x,y)\n</code></pre>\n\n<p>compile error on x, Why?</p>\n\n<p>|</p>\n\n<pre><code>40 | p =  do x &lt;- item\n   |         ^^^^^^^^^\n\n:40:9: error:\n    * Couldn't match type `([(Char, String)], [(Char, String)])'\n                     with `[((Char, Char), String)]'\n      Expected type: Parser (Char, Char)\n        Actual type: String -&gt; ([(Char, String)], [(Char, String)])\n    * In a stmt of a 'do' block: x &lt;- item\n      In the expression:\n        do x &lt;- item\n           item\n           y &lt;- item\n           return (x, y)\n      In an equation for `p':\n          p = do x &lt;- item\n                 item\n                 y &lt;- item\n                 ....\n(deferred type error)\n</code></pre>\n"}, {"tags": ["haskell", "types", "pattern-matching", "typeclass", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 267, "user_id": 7318794, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d82a70837b8e59b6237e9deb68e2771e?s=128&d=identicon&r=PG&f=1", "display_name": "Liisi", "link": "https://stackoverflow.com/users/7318794/liisi"}, "edited": false, "score": 0, "creation_date": 1520674261, "post_id": 49207305, "comment_id": 85419750, "body": "What is <code>$(singletons [d|</code> syntax? For example, what does it do in this case, for Nat? Could I also generate singletons manually, and if yes, then how? (Just trying to understand how it works.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 267, "user_id": 7318794, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d82a70837b8e59b6237e9deb68e2771e?s=128&d=identicon&r=PG&f=1", "display_name": "Liisi", "link": "https://stackoverflow.com/users/7318794/liisi"}, "edited": false, "score": 1, "creation_date": 1520681582, "post_id": 49207305, "comment_id": 85421701, "body": "@Liisi There is a lot going on here. <code>$(singletons ...</code> is Template Haskell syntax, calling a <code>singletons</code> function during compile time. The function returns Haskell syntax which is then compiled. This will produce a GADT <code>SNat n</code> with constructors <code>SZero,SNext</code>, the idea being that there will be only one value of type <code>SNat n</code> for each <code>n</code>. In this way, compile time information on <code>n</code> is carried on at runtime. It is possible to define this manually (plus its <code>SingI</code> instances) but it is boring repetitive boilerplate. You can load the fine in GHCi and use <code>:i SNat</code> to see some of the result."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1520673248, "last_edit_date": 1520673248, "creation_date": 1520672796, "answer_id": 49207305, "question_id": 49206636, "link": "https://stackoverflow.com/questions/49206636/how-to-make-fixed-length-vectors-instance-of-applicative/49207305#49207305", "title": "How to make fixed-length vectors instance of Applicative?", "body": "<p>This is a (commented) alternative which exploits the <code>singletons</code> package.</p>\n\n<p>Very roughly, Haskell does not let us pattern match on type-level values such as <code>n</code> in the code above. With <code>singletons</code>, we can, at the cost of requiring and providing a few instances of <code>SingI</code> here and there.</p>\n\n<pre><code>{-# LANGUAGE GADTs , KindSignatures, DataKinds, TemplateHaskell, \n             TypeFamilies, ScopedTypeVariables #-}\n{-# OPTIONS -Wall #-}\n\nimport Data.Singletons.TH\n\n-- Autogenerate singletons for this type\n$(singletons [d|\n   data Nat = Next Nat | Zero\n   |])\n\n-- as before\ndata Vector :: Nat -&gt; * -&gt; * where\n   Construct :: t -&gt; Vector n t -&gt; Vector ('Next n) t\n   Empty :: Vector 'Zero t\n\n-- as before\ninstance Functor (Vector n) where\n   fmap _ Empty = Empty\n   fmap f (Construct x b) = Construct (f x) (fmap f b)        \n\n-- We now require n to carry its own SingI instance.\n-- This allows us to pattern match on n.\ninstance SingI n =&gt; Applicative (Vector n) where\n   Empty &lt;*&gt; Empty = Empty\n   -- Here, we need to access the singleton on n, so that later on we\n   -- can provide the SingI (n-1) instance we need for the recursive call.\n   -- The withSingI allows us to use m :: SNat (n-1) to provide the instance.\n   (Construct f c) &lt;*&gt; (Construct x d) = case sing :: SNat n of\n      SNext m -&gt; withSingI m $ Construct (f x) (c &lt;*&gt; d)\n\n   -- Here, we can finally pattern match on n.\n   -- As above, we need to provide the instance with withSingI\n   -- to the recursive call.\n   pure x = case sing :: SNat n of\n      SZero -&gt; Empty\n      SNext m -&gt; withSingI m $ Construct x (pure x)\n</code></pre>\n\n<p>Using this will require to provide a <code>SingI n</code> instance at every use, which is a bit inconvenient, but not too much (IMO). The sad part is that <code>&lt;*&gt;</code> does not really need <code>SingI n</code>, since, in principle, it could recompute that from the two vectors at hand. However, <code>pure</code> has no input vector, so it can only pattern match with a provided singleton.</p>\n\n<p>As another alternative, similar to the original code, one could write</p>\n\n<pre><code>instance Applicative (Vector Zero) where\n   ...\ninstance Applicative (Vector n) =&gt; Applicative (Vector (Next n)) where\n   ...\n</code></pre>\n\n<p>This is not completely equivalent, and will require to add contexts <code>Applicative (Vector n) =&gt;</code> in all the functions later on where <code>n</code> is unknown, but could be enough for many purposes.</p>\n"}, {"tags": [], "owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "is_accepted": true, "score": 7, "last_activity_date": 1520684707, "last_edit_date": 1520684707, "creation_date": 1520673238, "answer_id": 49207359, "question_id": 49206636, "link": "https://stackoverflow.com/questions/49206636/how-to-make-fixed-length-vectors-instance-of-applicative/49207359#49207359", "title": "How to make fixed-length vectors instance of Applicative?", "body": "<p>You could make same directly:</p>\n\n<pre><code>instance Applicative (Vector Zero) where\n  a &lt;*&gt; b = Empty\n  pure x = Empty\n\ninstance Applicative (Vector n) =&gt; Applicative (Vector (Next n)) where\n  a &lt;*&gt; b = \n    case a of\n      Construct f c -&gt;\n        case b of\n          Construct x d -&gt; Construct (f x) (c &lt;*&gt; d)\n  pure x = Construct x (pure x)\n</code></pre>\n\n<p>As I can reason about it: for different types of the class, the code should be type-aware. If you had several instances, different types would get different implementation, and it would be easily resolved. But, if you try to make it with single non-recursive instance, there is basically no information about the type in runtime, and code which is always the same still needs to decide which type to handle. When you have input parameters, you can exploit GADTs to provide you the type information. But for <code>pure</code> there are no input parameters. So you have to have some context for the <code>Applicative</code> instance.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520725250, "post_id": 49212557, "comment_id": 85434548, "body": "I really like your <code>vapp</code>/<code>vcopies</code> approach. It&#39;s very clean."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1520706351, "creation_date": 1520706351, "answer_id": 49212557, "question_id": 49206636, "link": "https://stackoverflow.com/questions/49206636/how-to-make-fixed-length-vectors-instance-of-applicative/49212557#49212557", "title": "How to make fixed-length vectors instance of Applicative?", "body": "<p>Consider this an addendum to @chi's answer to provide additional explanation of the singleton approach...</p>\n\n<p>I would suggest reading the <a href=\"http://homepages.inf.ed.ac.uk/slindley/papers/hasochism.pdf\" rel=\"nofollow noreferrer\">Hasochism paper</a> if you haven't already done so.  In particular, in section 3.1 of that paper, they deal with exactly this problem, and use it as the motivating example for when implicit singleton parameters (the <code>SingI</code> of @chi's answer, and the <code>NATTY</code> type class in the Hasochism paper) are necessary, rather than merely convenient.</p>\n\n<p>As it applies to your code, the main issue is that <code>pure</code> needs a run-time representation of the length of the vector that it's supposed to be generating, and the type-level variable <code>n</code> doesn't fit the bill.  The solution is to introduce a new GADT, a \"singleton\" that provides runtime values that correspond directly to the promoted types <code>Next</code> and <code>Zero</code>:</p>\n\n<pre><code>data Natty (n :: Nat) where\n  ZeroTy :: Natty Zero\n  NextTy :: Natty n -&gt; Natty (Next n)\n</code></pre>\n\n<p>I tried to use roughly the same naming convention as the paper:  <code>Natty</code> is the same, and <code>ZeroTy</code> and <code>NextTy</code> correspond to the paper's <code>Zy</code> and <code>Sy</code>.</p>\n\n<p>By itself, this explicit singleton is useful.  For example, see the definition of <code>vchop</code> in the paper.  Also, we can easily write a variant of <code>pure</code> that takes the explicit singleton to do its job:</p>\n\n<pre><code>vcopies :: Natty n -&gt; a -&gt; Vector n a\nvcopies ZeroTy _ = Empty\nvcopies (NextTy n) x = Construct x (vcopies n x)\n</code></pre>\n\n<p>We can't yet use this to define <code>pure</code>, though, because <code>pure</code>'s signature is determined by the <code>Applicative</code> type class, and we have no way to squeeze the explicit singleton <code>Natty n</code> in there. </p>\n\n<p>The solution is to introduce implicit singletons, which allow us to retrieve an explicit singleton whenever needed through the <code>natty</code> function in the context of the following type class:</p>\n\n<pre><code>class NATTY n where\n  natty :: Natty n\ninstance NATTY Zero where\n  natty = ZeroTy\ninstance NATTY n =&gt; NATTY (Next n) where\n  natty = NextTy natty\n</code></pre>\n\n<p>Now, provided we're in a <code>NATTY n</code> context, we can call <code>vcopies natty</code> to supply <code>vcopies</code> with its explicit <code>natty</code> parameter, which allows us to write:</p>\n\n<pre><code>instance NATTY n =&gt; Applicative (Vector n) where\n  (&lt;*&gt;) = vapp\n  pure = vcopies natty\n</code></pre>\n\n<p>using the definitions of <code>vcopies</code> and <code>natty</code> above, and the definition of <code>vapp</code> below:</p>\n\n<pre><code>vapp :: Vector n (a -&gt; b) -&gt; Vector n a -&gt; Vector n b\nvapp Empty Empty = Empty\nvapp (Construct f c) (Construct x d) = Construct (f x) (vapp c d)\n</code></pre>\n\n<p>Note one oddity.  We needed to introduce this <code>vapp</code> helper function for an obscure reason.  The following instance <em>without</em> <code>NATTY</code> matches your <code>case</code>-based definition and type-checks fine:</p>\n\n<pre><code>instance Applicative (Vector n) where\n  Empty &lt;*&gt; Empty = Empty\n  Construct f c &lt;*&gt; Construct x d = Construct (f x) (c &lt;*&gt; d)\n  pure = error \"Argh!  No NATTY!\"\n</code></pre>\n\n<p>If we add the <code>NATTY</code> constraint to define <code>pure</code>:</p>\n\n<pre><code>instance NATTY n =&gt; Applicative (Vector n) where\n  Empty &lt;*&gt; Empty = Empty\n  Construct f c &lt;*&gt; Construct x d = Construct (f x) (c &lt;*&gt; d)\n  pure = vcopies natty\n</code></pre>\n\n<p>the definition of <code>(&lt;*&gt;)</code> doesn't type check any more.  The problem is that the <code>NATTY n</code> constraint on the left-hand side of the second <code>(&lt;*&gt;)</code> case doesn't automatically imply a <code>NATTY n1</code> constraint on the right-hand side (where <code>Next n ~ n1</code>), so GHC doesn't want to allow us to call <code>(&lt;*&gt;)</code> on the right-hand side.  In this case, because the constraint isn't actually needed after it's used for the first time, a helper function without a <code>NATTY</code> constraint, namely <code>vapp</code>, works around the problem.</p>\n\n<p>@chi uses case matching on <code>natty</code> and the helper function <code>withSingI</code> as an alternative workaround.  The equivalent code here would use a helper function that turns an explicit singleton into an implicit <code>NATTY</code> context:</p>\n\n<pre><code>withNATTY :: Natty n -&gt; (NATTY n =&gt; a) -&gt; a\nwithNATTY ZeroTy a = a\nwithNATTY (NextTy n) a = withNATTY n a\n</code></pre>\n\n<p>allowing us to write:</p>\n\n<pre><code>instance NATTY n =&gt; Applicative (Vector n) where\n  Empty &lt;*&gt; Empty = Empty\n  Construct f c &lt;*&gt; Construct x d = case (natty :: Natty n) of\n    NextTy n -&gt; withNATTY n $ Construct (f x) (c &lt;*&gt; d)\n  pure x = case (natty :: Natty n) of\n    ZeroTy -&gt; Empty\n    NextTy n -&gt; Construct x (withNATTY n $ pure x)\n</code></pre>\n\n<p>This would need both <code>ScopedTypeVariables</code> and <code>RankNTypes</code>.</p>\n\n<p>Anyway, sticking with the helper functions, the complete program looks like this:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures #-}\n\nmodule Vector where\n\ndata Nat = Next Nat | Zero\ndata Vector :: Nat -&gt; * -&gt; * where\n  Construct :: t -&gt; Vector n t -&gt; Vector ('Next n) t\n  Empty :: Vector 'Zero t\n\ndata Natty (n :: Nat) where\n  ZeroTy :: Natty Zero\n  NextTy :: Natty n -&gt; Natty (Next n)\n\nclass NATTY n where\n  natty :: Natty n\ninstance NATTY Zero where\n  natty = ZeroTy\ninstance NATTY n =&gt; NATTY (Next n) where\n  natty = NextTy natty\n\ninstance Functor (Vector n) where\n  fmap f a =\n    case a of\n      Construct x b -&gt; Construct (f x) (fmap f b)\n      Empty -&gt; Empty\n\ninstance NATTY n =&gt; Applicative (Vector n) where\n  (&lt;*&gt;) = vapp\n  pure = vcopies natty\n\nvapp :: Vector n (a -&gt; b) -&gt; Vector n a -&gt; Vector n b\nvapp Empty Empty = Empty\nvapp (Construct f c) (Construct x d) = Construct (f x) (vapp c d)\n\nvcopies :: Natty n -&gt; a -&gt; Vector n a\nvcopies ZeroTy _ = Empty\nvcopies (NextTy n) x = Construct x (vcopies n x)\n</code></pre>\n\n<p>The correspondence with the <code>singletons</code> library is that:</p>\n\n<pre><code>$(singletons [d|\n  data Nat = Next Nat | Zero\n  |])\n</code></pre>\n\n<p>automatically generates the singletons (with constructors <code>SZero</code> and <code>SNat</code> instead of <code>ZeroTy</code> and <code>NatTy</code>; and with type <code>SNat</code> instead of <code>Natty</code>) and the implicit singleton class (called <code>SingI</code> instead of <code>NATTY</code> and using the function <code>sing</code> instead of <code>natty</code>), giving the complete program:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures, TemplateHaskell, TypeFamilies #-}\n\nmodule Vector where\n\nimport Data.Singletons\nimport Data.Singletons.TH\n\n$(singletons [d|\n  data Nat = Next Nat | Zero\n  |])\n\ndata Vector :: Nat -&gt; * -&gt; * where\n  Construct :: t -&gt; Vector n t -&gt; Vector ('Next n) t\n  Empty :: Vector 'Zero t\n\ninstance Functor (Vector n) where\n  fmap f a =\n    case a of\n      Construct x b -&gt; Construct (f x) (fmap f b)\n      Empty -&gt; Empty\n\ninstance SingI n =&gt; Applicative (Vector n) where\n  (&lt;*&gt;) = vapp\n  pure = vcopies sing\n\nvapp :: Vector n (a -&gt; b) -&gt; Vector n a -&gt; Vector n b\nvapp Empty Empty = Empty\nvapp (Construct f c) (Construct x d) = Construct (f x) (vapp c d)\n\nvcopies :: SNat n -&gt; a -&gt; Vector n a\nvcopies SZero _ = Empty\nvcopies (SNext n) x = Construct x (vcopies n x)\n</code></pre>\n\n<p>For more on what the <code>singletons</code> library does and how it's built, I'd suggest reading <a href=\"https://blog.jle.im/entries/series/+introduction-to-singletons.html\" rel=\"nofollow noreferrer\">Introduction to Singletons</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1520728140, "last_edit_date": 1520728140, "creation_date": 1520727791, "answer_id": 49215396, "question_id": 49206636, "link": "https://stackoverflow.com/questions/49206636/how-to-make-fixed-length-vectors-instance-of-applicative/49215396#49215396", "title": "How to make fixed-length vectors instance of Applicative?", "body": "<p>Several other answers have introduced a <code>Natty</code> or <code>SNat</code> type to implement <code>pure</code>. Indeed, having such a type greatly reduces the need for one-off type classes. A potential downside of the traditional <code>Natty</code>/<code>SNat</code> GADT, however, is that your program will actually build the representation and then use it, even if the <code>Nat</code> is known at compile time. This generally <em>wouldn't</em> happen with the auxiliary-class approach. You can get around this by using a different representation.</p>\n\n<p>I'm going to use these names:</p>\n\n<pre><code>data Nat = Z | S Nat\n</code></pre>\n\n<p>Suppose we define the usual</p>\n\n<pre><code>data Natty n where\n  Zy :: Natty 'Z\n  Sy :: Natty n -&gt; Natty ('S n)\n</code></pre>\n\n<p>We can write its eliminator (induction principle) thus:</p>\n\n<pre><code>natty :: p 'Z -&gt; (forall k. p k -&gt; p ('S k)) -&gt; Natty n -&gt; p n\nnatty z _ Zy = z\nnatty z s (Sy n) = s (natty z s n)\n</code></pre>\n\n<p>For our purpose, we don't really need the <code>Natty</code>; we only need its induction principle! So let's define another version. I imagine there's a proper name for this encoding, but I have no idea what it might be.</p>\n\n<pre><code>newtype NatC n = NatC\n  { unNatC :: forall p.\n              p 'Z  -- base case\n           -&gt; (forall k. p k -&gt; p ('S k))  -- inductive step\n           -&gt; p n }\n</code></pre>\n\n<p>This is isomorphic to <code>Natty</code>:</p>\n\n<pre><code>nattyToNatC :: Natty n -&gt; NatC n\nnattyToNatC n = NatC (\\z s -&gt; natty z s n)\n\nnatCToNatty :: NatC n -&gt; Natty n\nnatCToNatty (NatC f) = f Zy Sy\n</code></pre>\n\n<p>Now we can write a class for <code>Nat</code>s we know how to eliminate:</p>\n\n<pre><code>class KnownC n where\n  knownC :: NatC n\ninstance KnownC 'Z where\n  knownC = NatC $ \\z _ -&gt; z\ninstance KnownC n =&gt; KnownC ('S n) where\n  knownC = NatC $ \\z s -&gt; s $ unNatC knownC z s\n</code></pre>\n\n<p>Now here's a vector type (I've renamed things to match my own taste):</p>\n\n<pre><code>infixr 4 :&lt;\ndata Vec :: Nat -&gt; * -&gt; * where\n  (:&lt;) :: t -&gt; Vec n t -&gt; Vec ('S n) t\n  Nil :: Vec 'Z t\n</code></pre>\n\n<p>Because <code>Vec</code>'s length parameter isn't its last one, we'll have to flip it to use with <code>NatC</code>:</p>\n\n<pre><code>newtype Flip f a n = {unFlip :: f n a}\n\ninduct2 :: f 'Z a\n         -&gt; (forall k. f k a -&gt; f ('S k) a)\n         -&gt; NatC n -&gt; f n a\ninduct2 z s n = unFlip $ unNatC n (Flip z) (\\(Flip r) -&gt; Flip (s r))\n\nreplC :: NatC n -&gt; a -&gt; Vec n a\nreplC n a = induct2 Nil (a :&lt;) n\n\ninstance KnownC n =&gt; Applicative (Vec n) where\n   pure = replC knownC\n   (&lt;*&gt;) = ...\n</code></pre>\n\n<p>Now if the vector length is known at compile time, the <code>pure</code> vector will be built directly, with no intermediate structure needed.</p>\n"}], "owner": {"reputation": 267, "user_id": 7318794, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d82a70837b8e59b6237e9deb68e2771e?s=128&d=identicon&r=PG&f=1", "display_name": "Liisi", "link": "https://stackoverflow.com/users/7318794/liisi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 49207359, "answer_count": 4, "score": 6, "last_activity_date": 1520728140, "creation_date": 1520668018, "last_edit_date": 1520685753, "question_id": 49206636, "link": "https://stackoverflow.com/questions/49206636/how-to-make-fixed-length-vectors-instance-of-applicative", "title": "How to make fixed-length vectors instance of Applicative?", "body": "<p>I recently learned about promotion and decided to try writing vectors.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures #-}\nmodule Vector where\n  data Nat = Next Nat | Zero\n  data Vector :: Nat -&gt; * -&gt; * where\n    Construct :: t -&gt; Vector n t -&gt; Vector ('Next n) t\n    Empty :: Vector 'Zero t\n  instance Functor (Vector n) where\n    fmap f a =\n      case a of\n        Construct x b -&gt; Construct (f x) (fmap f b)\n        Empty -&gt; Empty\n</code></pre>\n\n<p>So far, everything is working. But I ran into a problem when trying to make <code>Vector</code> instance of <code>Applicative</code>.</p>\n\n<pre><code>instance Applicative (Vector n) where\n  a &lt;*&gt; b =\n    case a of\n      Construct f c -&gt;\n        case b of\n          Construct x d -&gt; Construct (f x) (c &lt;*&gt; d)\n      Empty -&gt; Empty\n  pure x = _\n</code></pre>\n\n<p>I had no idea how to do <code>pure</code>. I tried this:</p>\n\n<pre><code>case n of\n  Next _ -&gt; Construct x (pure x)\n  Zero -&gt; Empty\n</code></pre>\n\n<p>but got <code>Variable not in scope: n :: Nat</code> error for the first line and <code>Couldn't match type n with 'Zero</code> for the third line of this expression.</p>\n\n<p>So, I used the following hack.</p>\n\n<pre><code>class Applicative' n where\n  ap' :: Vector n (t -&gt; u) -&gt; Vector n t -&gt; Vector n u\n  pure' :: t -&gt; Vector n t\ninstance Applicative' n =&gt; Applicative' ('Next n) where\n  ap' (Construct f a) (Construct x b) = Construct (f x) (ap' a b)\n  pure' x = Construct x (pure' x)\ninstance Applicative' 'Zero where\n  ap' Empty Empty = Empty\n  pure' _ = Empty\ninstance Applicative' n =&gt; Applicative (Vector n) where\n  (&lt;*&gt;) = ap'\n  pure = pure'\n</code></pre>\n\n<p>It gets the job done, but it's not pretty. It introduces a useless class <code>Applicative'</code>. And every time I want to use <code>Applicative</code> for <code>Vector</code> in any function, I have to supply the additional useless constraint <code>Applicative' n</code> which actually holds for any <code>n</code>.</p>\n\n<p>What would be a better, cleaner way of doing this?</p>\n"}, {"tags": ["haskell", "insertion-sort"], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520659203, "post_id": 49205581, "comment_id": 85416419, "body": "i am still having some trouble. The monad types are not matching."}, {"owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520659227, "post_id": 49205581, "comment_id": 85416427, "body": "<code>Expected type: V.MVector                        (Control.Monad.Primitive.PrimState (ContT () IO)) a         Actual type: Mv.IOVector a     \u2022 In the first argument of \u2018Mv.read\u2019, namely \u2018mv\u2019       In a stmt of a &#39;do&#39; block: pivot &lt;- Mv.read mv x</code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "edited": false, "score": 0, "creation_date": 1520660788, "post_id": 49205581, "comment_id": 85416724, "body": "The code I have shown type checks.  It sounds like you probably want to <code>liftIO</code> the various <code>read</code>, <code>write</code>, etc calls in <code>mvInsertionSort</code> but I&#39;m not sure."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1520658707, "creation_date": 1520658707, "answer_id": 49205581, "question_id": 49205295, "link": "https://stackoverflow.com/questions/49205295/breaking-out-of-a-form-insertion-sort-with-mutable-vectors/49205581#49205581", "title": "Breaking out of a forM_ (insertion Sort with mutable vectors)", "body": "<p>Well you can always use a continuation monad to provide extra return points:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.Cont\nimport Data.Vector.Mutable as Mv\n\n    mvInsertionSort :: Ord a =&gt; Mv.IOVector a -&gt; IO (Mv.IOVector a)\n    mvInsertionSort mv = do\n     () &lt;- evalContT $ callCC $ \\exit -&gt;\n             forM_ [1 .. Mv.length mv - 1] $ \\x -&gt;\n              do pivot &lt;- Mv.read mv x\n                 forM_ [x-1 , x-2 .. 0] $ \\y -&gt;\n                  do currElem &lt;- Mv.read mv y\n                     if pivot &lt; currElem\n                         then do Mv.write mv y pivot\n                                 Mv.write mv (y+1) currElem\n                         else do Mv.write mv (y+1) pivot\n                                 exit ()\n     return mv\n</code></pre>\n\n<p>But I think most people just write custom recursive definitions instead.</p>\n"}], "owner": {"reputation": 341, "user_id": 6436616, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0808fbba3e3cd9d518a297d070dc1e03?s=128&d=identicon&r=PG&f=1", "display_name": "rjpj1998", "link": "https://stackoverflow.com/users/6436616/rjpj1998"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "accepted_answer_id": 49205581, "answer_count": 1, "score": 0, "last_activity_date": 1520685502, "creation_date": 1520655725, "last_edit_date": 1520685502, "question_id": 49205295, "link": "https://stackoverflow.com/questions/49205295/breaking-out-of-a-form-insertion-sort-with-mutable-vectors", "title": "Breaking out of a forM_ (insertion Sort with mutable vectors)", "body": "<p>I am writing an insertion sort in Haskell using mutable vectors. I can't figure out how to break out of a <code>forM_</code> loop. I have commented where I need to do that.</p>\n\n<pre><code>mvInsertionSort :: Ord a =&gt; Mv.IOVector a -&gt; IO (Mv.IOVector a)\nmvInsertionSort mv = do\n    forM_ [1 .. Mv.length mv - 1] $ \\x -&gt; do\n        pivot &lt;- Mv.read mv x\n        forM_ [x-1 , x-2 .. 0] $ \\y -&gt; do\n            currElem &lt;- Mv.read mv y\n            if pivot &lt; currElem then Mv.write mv y pivot &gt;&gt; Mv.write mv (y+1) currElem\n                else Mv.write mv (y+1) pivot -- Exit out of the second forM_ loop here\n    return mv\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1520655792, "post_id": 49205288, "comment_id": 85415869, "body": "Could you 1. format your code 2. show the errors you get (though I see there should be many) 3. Tell us where you got this function since it evidently wasn&#39;t written by you."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1520658859, "post_id": 49205288, "comment_id": 85416375, "body": "(1) You&#39;re missing an equality sign between <code>a b c</code> and <code>(a+b&gt;c)</code>. (2) types in Haskell are capitalized. <code>Integer</code> and <code>Bool</code>, not <code>integer</code> and <code>bool</code>. (3) there is an extra space between the two colons."}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 1, "creation_date": 1520665977, "post_id": 49205288, "comment_id": 85417706, "body": "Also, I suggest to lowerCamelCase the name of the function, hence <code>isValidTriangle</code>."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 9465412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/414669b36dbd7b08ed4c7e43a9d02cc1?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/9465412/tony"}, "edited": false, "score": 0, "creation_date": 1520762498, "post_id": 49206690, "comment_id": 85441255, "body": "Thanks\uff0cthis question was written in a messy , I should not write this question with exhausted mind. Actually I did everything you mentioned but thank you nonetheless, the real question is that how I can write a function definition so that it fits the function types\uff0c assuming the type I put here is correct.And second question is that after this &quot;test&quot; , how to combine the calculation function so that It can filter the invalid values and continue to calculate. : )"}], "tags": [], "owner": {"reputation": 346, "user_id": 9471091, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3u7syQcEK7E/AAAAAAAAAAI/AAAAAAAAABw/YYdbq_1w6uY/photo.jpg?sz=128", "display_name": "Stephano", "link": "https://stackoverflow.com/users/9471091/stephano"}, "is_accepted": false, "score": 3, "last_activity_date": 1520668486, "creation_date": 1520668486, "answer_id": 49206690, "question_id": 49205288, "link": "https://stackoverflow.com/questions/49205288/what-should-be-the-type-of-this-haskell-function/49206690#49206690", "title": "What should be the type of this Haskell function", "body": "<p>Here are a couple of things to help you out:</p>\n\n<ol>\n<li>Keep your colons together, i.e. :: instead of : :</li>\n<li><p>Haskell types start with capital letters, so you should do</p>\n\n<p>isvalidtriangle :: Integer -> Integer -> Integer -> Bool</p></li>\n<li><p>As others have said, you need an equals sign before you write the body of the function. Also, <strong><em>camelCase</em></strong> is better than <strong><em>alllowercase</em></strong> with no separators for readability purposes.</p></li>\n</ol>\n\n<p>The final code becomes:</p>\n\n<pre><code>isValidTriangle :: Integer -&gt; Integer -&gt; Integer -&gt; Bool\nisValidTriangle a b c = (a+b&gt;c)&amp;&amp;(a+c&gt;b)&amp;&amp;(b+c&gt;a)\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 9465412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/414669b36dbd7b08ed4c7e43a9d02cc1?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/9465412/tony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1520668486, "creation_date": 1520655647, "last_edit_date": 1520656296, "question_id": 49205288, "link": "https://stackoverflow.com/questions/49205288/what-should-be-the-type-of-this-haskell-function", "title": "What should be the type of this Haskell function", "body": "<p>I have to write a Haskell function in order to check out if the triangle is valid.I just cannot figure the type of the functions.Here is my work.</p>\n\n<pre><code>isvalidtriangle : : integer -&gt; integer -&gt; integer -&gt;bool\nisvalidtriangle a b c (a+b&gt;c)&amp;&amp;(a+c&gt;b)&amp;&amp;(b+c&gt;a)\n</code></pre>\n\n<p>it always shows errors and i cannot see the logic behind that how this function helps to calculate the area of triangle later (there is area of triangle function after this one ) Thanks in advance and I am very tired ,I have no idea how it can be down.</p>\n"}, {"tags": ["haskell", "opaleye"], "answers": [{"tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": true, "score": 0, "last_activity_date": 1523476178, "creation_date": 1523476178, "answer_id": 49783391, "question_id": 49205146, "link": "https://stackoverflow.com/questions/49205146/in-opaleye-how-to-insert-to-two-tables-in-the-same-query/49783391#49783391", "title": "In Opaleye, how to insert to two tables in the same query?", "body": "<blockquote>\n  <p>Can Opaleye insert into two different tables within the same query?</p>\n</blockquote>\n\n<p>No, it can't.  I didn't even know that was possible!  If you email me (my contact details are in the README) then we can discuss your use case.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 49783391, "answer_count": 1, "score": 1, "last_activity_date": 1523476178, "creation_date": 1520653976, "question_id": 49205146, "link": "https://stackoverflow.com/questions/49205146/in-opaleye-how-to-insert-to-two-tables-in-the-same-query", "title": "In Opaleye, how to insert to two tables in the same query?", "body": "<p>My database has two tables with bijective row correspondence (as described in <a href=\"https://stackoverflow.com/questions/48964851/is-it-good-practice-to-have-two-sql-tables-with-bijective-row-correspondence\">this</a> question). It seems this means that to insert a row to each table without violating foreign key constraints requires the two inserts to occur within the same query.</p>\n\n<p>In the <a href=\"https://hackage.haskell.org/package/opaleye-0.6.0.0/docs/Opaleye-Manipulation.html\" rel=\"nofollow noreferrer\">Opaleye.Manipulation</a> module I see functions such as <code>runInsertMany</code>, which insert into a single table. However, these return an <code>IO</code> action and not a query, and I do not see how to combine them into one. Nowhere in Opaleye do I see how to insert into two tables, or an insert <code>Query</code> possible of combining with another.</p>\n\n<p><strong>Can Opaleye insert into two different tables within the same query? How?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1520650890, "post_id": 49204888, "comment_id": 85415068, "body": "A type that\u2019s a <code>Traversable</code> has to implement at least one of <code>traverse</code> or <code>sequenceA</code>. The default definitions are ways of deriving the functionality of one from the other,"}, {"owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1520650985, "post_id": 49204888, "comment_id": 85415087, "body": "Oh my god, get it...thx!"}], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 5, "last_activity_date": 1520651074, "creation_date": 1520651074, "answer_id": 49204922, "question_id": 49204888, "link": "https://stackoverflow.com/questions/49204888/how-to-unfold-the-definition-of-sequencea-and-where-its-recursive-base-case-is/49204922#49204922", "title": "How to unfold the definition of sequenceA, and where its recursive base case is?", "body": "<p>A type that\u2019s a <code>Traversable</code> has to implement at least one of <code>traverse</code> or <code>sequenceA</code>. The default definitions are ways of deriving the functionality of one from the other.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.Traversable.html#line-230\" rel=\"noreferrer\">Here\u2019s <code>Maybe</code>\u2019s <code>Traversable</code> implementation:</a></p>\n\n<pre><code>instance Traversable Maybe where\n    traverse _ Nothing = pure Nothing\n    traverse f (Just x) = Just &lt;$&gt; f x\n</code></pre>\n\n<p>Now you can expand <code>sequenceA (Just (Right 3))</code> to <code>traverse id (Just (Right 3))</code> = <code>Just &lt;$&gt; id (Right 3)</code> = <code>Just &lt;$&gt; Right 3</code> = <code>Right (Just 3)</code>.</p>\n"}], "owner": {"reputation": 699, "user_id": 7093297, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Pi7EY.jpg?s=128&g=1", "display_name": "wind2412", "link": "https://stackoverflow.com/users/7093297/wind2412"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 49204922, "answer_count": 1, "score": 1, "last_activity_date": 1520651582, "creation_date": 1520650695, "last_edit_date": 1520651582, "question_id": 49204888, "link": "https://stackoverflow.com/questions/49204888/how-to-unfold-the-definition-of-sequencea-and-where-its-recursive-base-case-is", "title": "How to unfold the definition of sequenceA, and where its recursive base case is?", "body": "<p>It's very fantastic that <code>sequenceA</code> function can reverse the container of a variable -- for instance, running <code>sequence (Just $ Right 3)</code> will get <code>Right $ Just 3</code>. I want to unfold <code>sequenceA</code> to see how it works, but I get sucked into it...</p>\n\n<pre><code>-- source code of `sequenceA` for reference\ntraverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\ntraverse f = sequenceA . fmap f\n\nsequenceA :: Applicative f =&gt; t (f a) -&gt; f (t a)\nsequenceA = traverse id\n\n-- unfold it\n&gt; sequenceA (Just $ Right 3)\n&gt; (traverse id) (Just $ Right 3)\n&gt; (sequenceA . fmap id) (Just $ Right 3)\n&gt; sequenceA (fmap id (Just $ Right 3))\n&gt; (traverse id) (fmap id (Just $ Right 3))\n&gt; (sequenceA . fmap id) (fmap id (Just $ Right 3))\n&gt; traverse id . fmap id . fmap id $ Just (Right 3)\n-- and so on...\n&gt; traverse id . fmap id . fmap id . fmap id $ Just (Right 3)\n&gt; traverse id . fmap id . fmap id . fmap id . fmap id $ Just (Right 3)\n......\n</code></pre>\n\n<p>Where is the recursive base case?</p>\n"}, {"tags": ["haskell", "emacs", "spacemacs", "haskell-mode", "intero"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520648940, "post_id": 49204436, "comment_id": 85414767, "body": "Note that it is not recommended to use a single installation for all your projects. Quoting <a href=\"https://github.com/commercialhaskell/intero/blob/3f9cfc452faffbdb5c23c110ce0d0c7b099bc6c9/TOOLING.md\" rel=\"nofollow noreferrer\">the docs</a>: &quot;Use <code>stack build</code> (not <code>install</code>) for each of your package sets. Each LTS or nightly should have a separate <code>stack build</code>. <b>If you use <code>stack install</code> you will run into incompatibility issues between package sets</b>.&quot;"}], "owner": {"reputation": 126, "user_id": 4538137, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J1z3wpsHPug/AAAAAAAAAAI/AAAAAAAAABE/zNTiUxJjVqc/photo.jpg?sz=128", "display_name": "Vimniky Luo", "link": "https://stackoverflow.com/users/4538137/vimniky-luo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 334, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1520647909, "creation_date": 1520645258, "last_edit_date": 1520647909, "question_id": 49204436, "link": "https://stackoverflow.com/questions/49204436/how-to-configure-spacemacs-to-use-the-global-installed-intero", "title": "How to configure Spacemacs to use the global installed intero?", "body": "<p>Whenever I create a new project and I open it with Spacemacs, Spacemacs will try to install a local intero over and over again leaving me waiting for it to finish the installation. Can I just use my global installed intero for all my stack projects?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 9, "creation_date": 1520642385, "post_id": 49204161, "comment_id": 85413727, "body": "I think <code>map (id &amp;&amp;&amp; f)</code> is simple enough and short enough that it doesn&#39;t need its own name."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1520643195, "post_id": 49204161, "comment_id": 85413863, "body": "Agreed, although I personally wish that the Prelude contained (the equivalent) <code>fanout f g x = (f x, g x)</code>, which appears frequently in Bird&#39;s work. That would make this <code>map . fanout id</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1520646761, "post_id": 49204161, "comment_id": 85414461, "body": "<code>zip &lt;*&gt; map f</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1520648672, "post_id": 49204161, "comment_id": 85414729, "body": "@WillNess Although I find that Applicative version neater than the arrows one, I believe it doesn\u2019t optimize as well."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1520681989, "post_id": 49204161, "comment_id": 85421838, "body": "@HTNW hmm, indeed. too bad, huh."}], "answers": [{"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 1, "last_activity_date": 1520693254, "creation_date": 1520693254, "answer_id": 49210365, "question_id": 49204161, "link": "https://stackoverflow.com/questions/49204161/stdlib-synonym-to-my-zipwithmap-function/49210365#49210365", "title": "Stdlib synonym to my zipWithMap function?", "body": "<p>Also:</p>\n\n<pre><code>Data.Tuple.Extra&gt;  map (second (+3) . dupe) [1..4]\n[(1,4),(2,5),(3,6),(4,7)]\n</code></pre>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1520693254, "creation_date": 1520642256, "last_edit_date": 1520642784, "question_id": 49204161, "link": "https://stackoverflow.com/questions/49204161/stdlib-synonym-to-my-zipwithmap-function", "title": "Stdlib synonym to my zipWithMap function?", "body": "<p>I often find myself looking to use a function like:</p>\n\n<pre><code>zipWithMap :: (a -&gt; b) -&gt; [a] -&gt; [(a, b)]\nzipWithMap f xs = zip xs $ map f xs\n</code></pre>\n\n<p>Such that:</p>\n\n<pre><code>zipWithMap (+3) [1..4] = [(1, 4), (2, 5), (3, 6), (4, 7)]\n</code></pre>\n\n<p>I find myself looking for this so often, in fact, that I fear I am either reinventing the wheel or using an idiom so poorly-suited to Haskell that Real Programmers have moved away from it, thus its exclusion from stdlib.</p>\n\n<p><a href=\"https://www.haskell.org/hoogle/?hoogle=(a+-%3E+b)+-%3E+%5Ba%5D+-%3E+%5B(a%2C+b)%5D\" rel=\"nofollow noreferrer\">Hoogle gives me nothing with that type signature</a>, so I'm forced to ask: is there a more idiomatic approach? Perhaps with Arrows?</p>\n\n<pre><code>zipWithMap f = map $ id &amp;&amp;&amp; f\n</code></pre>\n\n<p>though I'm not sure that's any better than the (subjectively) simpler style above.</p>\n"}, {"tags": ["loops", "haskell", "functional-programming", "iteration"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1520617486, "post_id": 49199318, "comment_id": 85403685, "body": "You do not need anything like <code>mapM</code>, that is for monads (yes a list is a monad, but this is making things very complex). You can use <code>filter</code> here."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1520620149, "post_id": 49199318, "comment_id": 85405024, "body": "<code>all (\\xs -&gt; sum xs &gt; 5 &amp;&amp; 2 `elem` xs)</code>  I expect that you have learned almost nothing from this answer though.  How about you try implementing solutions manually (both using functions from <code>base</code> and your own primitive recursive functions) then come back with questions specific to those attempts?  You&#39;d learn a lot faster that way."}], "answers": [{"tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": false, "score": 2, "last_activity_date": 1520618580, "creation_date": 1520618580, "answer_id": 49199628, "question_id": 49199318, "link": "https://stackoverflow.com/questions/49199318/iterating-over-a-list-of-lists-in-haskell/49199628#49199628", "title": "Iterating Over a List of Lists in Haskell?", "body": "<blockquote>\n  <p>how would I go about first iterating through each list to see if the sum of values in each list is > 5</p>\n</blockquote>\n\n<p>Lets say your list is</p>\n\n<pre><code>l = [[0, 1, 2], [2, 3, 4], [4, 5, 6]]\n</code></pre>\n\n<p>You can get the lists whose values sum up more than five, using <code>filter</code>. The first argument of <code>filter</code> is a function <code>(\\xs -&gt; sum xs &gt; 5)</code>, that given a list <code>xs</code>, decides if the sum of its elements is bigger than 5</p>\n\n<pre><code>&gt; filter (\\xs -&gt; sum xs &gt; 5) l\n[[2,3,4],[4,5,6]]\n</code></pre>\n\n<blockquote>\n  <p>and then within each list, iterating through the individual values to check if there is an integer = 2 in the list</p>\n</blockquote>\n\n<p>Same as before, you use filter, but now you check if number <code>2</code> is an element of each list <code>xs</code></p>\n\n<pre><code>&gt; filter (\\xs -&gt; 2 `elem` xs) l\n[[0,1,2],[2,3,4]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21422, "user_id": 333698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca080b4ef1c6cb4df9bc123d3b3af61?s=128&d=identicon&r=PG", "display_name": "psmears", "link": "https://stackoverflow.com/users/333698/psmears"}, "is_accepted": false, "score": 2, "last_activity_date": 1520628179, "last_edit_date": 1520628179, "creation_date": 1520618757, "answer_id": 49199680, "question_id": 49199318, "link": "https://stackoverflow.com/questions/49199318/iterating-over-a-list-of-lists-in-haskell/49199680#49199680", "title": "Iterating Over a List of Lists in Haskell?", "body": "<p>It's not 100% clear to me exactly what you want to do, but here are some building blocks that may help:</p>\n\n<ol>\n<li><p>Find which lists have a sum greater than 5:</p>\n\n<pre><code>Prelude&gt; filter ((&gt;5) . sum) [[0, 1, 2], [2, 3, 4], [4, 5, 6]]\n[[2,3,4],[4,5,6]]\n</code></pre></li>\n<li><p>Find whether a list contains the number 2:</p>\n\n<pre><code>Prelude&gt; any (==2) [1,2,3]\nTrue\nPrelude&gt; any (==2) [4,5,6]\nFalse\n</code></pre></li>\n<li><p>Combine the above, to give True / False for each list whose sum is greater than 5:</p>\n\n<pre><code>Prelude&gt; (map (any (==2)) . filter ((&gt;5) . sum)) [[0, 1, 2], [2, 3, 4], [4, 5, 6]]\n[True,False]\n</code></pre></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1520731128, "creation_date": 1520731128, "answer_id": 49215701, "question_id": 49199318, "link": "https://stackoverflow.com/questions/49199318/iterating-over-a-list-of-lists-in-haskell/49215701#49215701", "title": "Iterating Over a List of Lists in Haskell?", "body": "<p>List comprehensions are iterative. I'm not sure what you want so the following creates a tuple of the sum greater than 5 of each list and the second item of the tuple weather any element of the list is 2. The check for elements equal to 2 is another short list comprehension.</p>\n\n<pre><code>[(a,[True|t&lt;-b,t == 2])|b&lt;-[[0,1,2],[2,3,4,5],[6,7,8]], a&lt;-[sum b], a&gt;5]\n</code></pre>\n\n<blockquote>\n  <p>[(14,[True]),(21,[])]</p>\n</blockquote>\n"}], "owner": {"reputation": 109, "user_id": 8149354, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b7820719b9fc38499f64d0554092caab?s=128&d=identicon&r=PG&f=1", "display_name": "374", "link": "https://stackoverflow.com/users/8149354/374"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1878, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1520731128, "creation_date": 1520617373, "question_id": 49199318, "link": "https://stackoverflow.com/questions/49199318/iterating-over-a-list-of-lists-in-haskell", "title": "Iterating Over a List of Lists in Haskell?", "body": "<p>I'm having some difficulties understanding how to iterate through a list in Haskell. I've been trying to work with mapM but for some reason I keep on coming up with parsing errors. I know that this can be done recursively, but the code within the iteration/for loop is only a small part of the whole function so I wouldn't want to recursively call the function. So for example, if I have a list of lists like</p>\n\n<pre><code>[[0, 1, 2], [2, 3, 4], [4, 5, 6]]\n</code></pre>\n\n<p>how would I go about first iterating through each list to see if the sum of values in each list is > 5 and then within each list, iterating through the individual values to check if there is an integer = 2 in the list (and return True in that case)?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520616357, "post_id": 49199011, "comment_id": 85403093, "body": "No, in Haskell for all clauses, the number of parameters has to be the same."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520616603, "post_id": 49199011, "comment_id": 85403226, "body": "@WillemVanOnsem Thanks for pointing out, but I can understand that from the given error. What I&#39;m asking is that what kind of &quot;trick&quot; that I can use to achieve the thing that I&#39;m trying."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1520632932, "post_id": 49199011, "comment_id": 85410935, "body": "if <code>a = (b . c)</code>, then also <code>a x = (b . c) x</code>."}], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520616840, "post_id": 49199146, "comment_id": 85403355, "body": "First of all, thanks for your answer @Buhr. I&#39;m new to Haskell, so is there any chance that you can explain your code from the second line to the end ? For example, I do not know what does <code>go</code> do, and what does the syntax <code>go f xs</code> means, etc."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520617452, "post_id": 49199146, "comment_id": 85403665, "body": "@onurcanbektas <code>go</code> is defined above: it&#39;s just a name for an arbitrary function. You can replace each <code>go</code> above with <code>helperFunction</code> or any other name and achieve the same result."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520617679, "post_id": 49199146, "comment_id": 85403789, "body": "what about <code>go f xs</code> ? what does this do ? Plus, why does <code>go</code> function takes two arguments ?"}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520618158, "post_id": 49199146, "comment_id": 85404064, "body": "Ok, I have now understood why what does the code do. It is a pretty good method actually. Thanks for sharing :)"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1520619281, "post_id": 49199146, "comment_id": 85404567, "body": "I added some additional explanation as well."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1520621477, "post_id": 49199146, "comment_id": 85405752, "body": "IMO, using the helper <code>go</code> here adds more complexity than it saves. Just define <code>init&#39;</code> in terms of <code>init</code>, with the same three cases. Then <code>myButLast = last . init&#39; where init&#39; = ...</code>."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1520619263, "last_edit_date": 1520619263, "creation_date": 1520616701, "answer_id": 49199146, "question_id": 49199011, "link": "https://stackoverflow.com/questions/49199011/defining-new-function-as-a-composition-of-functions-while-adding-additional-beha/49199146#49199146", "title": "Defining new function as a composition of functions while adding additional behaviours", "body": "<p>The best you can do is probably something like the following, where the error checking is moved into an auxiliary function (which I've named <code>go</code> for lack of a better name) defined in a <code>where</code> clause:</p>\n\n<pre><code>myButLast :: [a] -&gt; a\nmyButLast = go (last . init)\n\n  where\n    go _ []  = bad\n    go _ [x] = bad\n    go f xs  = f xs\n\n    bad = error \"The list has to have at least 2 elements!\"\n</code></pre>\n\n<p>It might help make it clearer what's going on if we define <code>go</code> separately with a type signature.  Also, in case you find the underscores confusing, I've replaced them with <code>f</code>:</p>\n\n<pre><code>myButLast :: [a] -&gt; a\nmyButLast = go (last . init)\n\ngo :: ([a] -&gt; a) -&gt; [a] -&gt; a\ngo f []  = bad\ngo f [x] = bad\ngo f xs  = f xs\n\nbad = error \"The list has to have at least 2 elements!\"\n</code></pre>\n\n<p>Here, you can see that <code>go</code> is a function that takes two arguments, the first being itself a <strong>function</strong> of type <code>[a] -&gt; a</code> and the second being a list of type <code>[a]</code>.</p>\n\n<p>The above definition of <code>go</code> pattern matches on the second argument (the list).  If the list is empty or a singleton, then the result of <code>go</code> is just <code>bad</code> (the error message), regardless of the function <code>f</code>.  Otherwise (if the list is at least two elements), the result of <code>go f xs</code> is simply to apply the first argument (that function <code>f</code>) to the list <code>xs</code>.</p>\n\n<p>How does this work?  Well, let's see what happens if we apply <code>myButLast</code> to a list.  I've used the symbol \"\u2261\" here to show equivalence of Haskell expressions with comments explaining why they are equivalent:</p>\n\n<pre><code>myButLast [1,2,3]\n-- by the definition of \"myButLast\"\n\u2261 go (last . init) [1,2,3]\n-- by the definition of \"go\", third pattern w/\n--    f \u2261 last . init\n--    xs = [1,2,3]\n\u2261 (last . init) [1,2,3]   -- this is just f xs w/ the pattern substitutions\n-- because of your original, correct answer\n\u2261 2\n</code></pre>\n\n<p>If we apply it to a \"bad\" list, the only difference is the pattern matched from the definition of <code>go</code>:</p>\n\n<pre><code>myButLast [1]\n-- by the definition of \"myButLast\"\n\u2261 go (last . init) [1]\n-- by the definition of \"go\", second pattern w/\n--    f \u2261 last . init\n--    x = 1\n\u2261 bad\n-- gives an error message by definition of \"bad\"\n</code></pre>\n\n<p>As an interesting aside, another way to look at <code>go</code> is that it's a function:</p>\n\n<pre><code>go :: ([a] -&gt; a) -&gt; ([a] -&gt; a)\n</code></pre>\n\n<p>Because the function application arrow <code>-&gt;</code> is right associative, this type signature is exactly the same as <code>([a] -&gt; a) -&gt; [a] -&gt; a</code>.  The neat thing about this is that now it's clear that <code>go</code> takes a function of type <code>[a] -&gt; a</code> (such as <code>last . init</code>) and returns another function of type <code>[a] -&gt; a</code> (such as <code>myButLast</code>).   That is, <code>go</code> is a transformer that adds additional behavior to an existing function to create a new function, which is exactly what you were asking for in your original question.</p>\n\n<p>In fact, if you slightly generalize the type signature so that <code>go</code> can operate on a function taking a list, regardless of what it returns:</p>\n\n<pre><code>go :: ([a] -&gt; b) -&gt; [a] -&gt; b\ngo _ [] = bad\ngo _ [x] = bad\ngo f xs = f xs\n</code></pre>\n\n<p>this still works.  Then, you could use this <strong>same</strong> <code>go</code> on anything that needed a list of length two, whatever it returned.  For example, if you had an original implementation to return the last two elements of a list:</p>\n\n<pre><code>lastTwoElements :: [a] -&gt; [a]\nlastTwoElements = (!! 2) . reverse . tails   -- tails from Data.List\n</code></pre>\n\n<p>you could re-write it as:</p>\n\n<pre><code>lastTwoElements :: [a] -&gt; [a]\nlastTwoElements = go ((!! 2) . reverse . tails)\n</code></pre>\n\n<p>to add error handling for the empty and singleton list cases.</p>\n\n<p>In this case, you'd probably want to rename <code>go</code> to <code>usingTwoElements</code> or <code>withList2</code> or something...</p>\n"}, {"comments": [{"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520617190, "post_id": 49199212, "comment_id": 85403545, "body": "Actually, that is my original solution to the problem, but defining the <code>myButLast</code> function as a composition of other function is mathematically intriguing, and that is why I&#39;m trying to learn how can I use the composition method while I&#39;m not losing anything."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 2, "creation_date": 1520617353, "post_id": 49199212, "comment_id": 85403622, "body": "@onurcanbektas Would <code>myButLast&#39; x = (last . init) x</code> still be acceptable to you? This style (using composition) does not always lead to simpler code -- sometimes it&#39;s better to avoid it."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1520617225, "last_edit_date": 1520617225, "creation_date": 1520616993, "answer_id": 49199212, "question_id": 49199011, "link": "https://stackoverflow.com/questions/49199011/defining-new-function-as-a-composition-of-functions-while-adding-additional-beha/49199212#49199212", "title": "Defining new function as a composition of functions while adding additional behaviours", "body": "<p>Use an explicit argument in the solution:</p>\n\n<pre><code>myButLast' x = last (init x)\n</code></pre>\n\n<p>Now you can add your special cases just above that line.</p>\n\n<p>The original solution used a pointfree style <code>last . init</code> to avoid mentioning the <code>x</code> argument. However, if you have to add further equations, you need to make the argument explicit.</p>\n\n<p>Moving from</p>\n\n<pre><code>fun :: A -&gt; B\nfun = something\n</code></pre>\n\n<p>to</p>\n\n<pre><code>fun :: A -&gt; B\nfun a = something a\n</code></pre>\n\n<p>is called eta-expansion, and is a common transformation of Haskell code. The first style is usually called point-free (or, jokingly, point-less), while the second one is called pointful. Here \"point\" refers to the variable <code>a</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520652477, "post_id": 49201196, "comment_id": 85415289, "body": "Thanks for your answer @chepner, can I ask what does <code>Maybe</code> syntax do in general ? What is it purpose ?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520708433, "post_id": 49201196, "comment_id": 85430172, "body": "A value of type <code>Maybe a</code> is either a value of type <code>a</code> wrapped in the <code>Just</code> constructor, or it is the absence of such a value, represented by <code>Nothing</code>. Compare <code>&lt;=&lt; :: (b -&gt; Maybe c) -&gt; (a -&gt; Maybe b) -&gt; a -&gt; Maybe c</code> (specialized for <code>Maybe</code> here) with <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>; think of it as function composition where you need to unwrap the return value of the first function before passing it to the second function."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1520625132, "creation_date": 1520625132, "answer_id": 49201196, "question_id": 49199011, "link": "https://stackoverflow.com/questions/49199011/defining-new-function-as-a-composition-of-functions-while-adding-additional-beha/49201196#49201196", "title": "Defining new function as a composition of functions while adding additional behaviours", "body": "<p>Somewhat sidestepping the original question, but you may be interested in the <code>safe</code> package for tasks like this. In general, you should strive to use total functions that don't raise errors. In this case, that means using something like <code>lastMay :: [a] -&gt; Maybe a</code> and <code>initMay :: [a] -&gt; Maybe a</code>, which simply return <code>Nothing</code> if given an empty list. They can be composed using <code>&lt;=&lt;</code>, found in <code>Control.Monad</code>.</p>\n\n<pre><code>import Safe\n\nmyButLast :: [a] -&gt; Maybe a\nmyButLast = lastMay &lt;=&lt; initMay\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>&gt; myButLast []\nNothing\n&gt; myButLast [1]\nNothing\n&gt; myButLast [1,2]\nJust 1\n</code></pre>\n\n<p>If you really want an error message, <code>Safe</code> provides <code>lastNote</code> and <code>initNote</code> as well.</p>\n\n<pre><code>myButLast = let msg = \"Need at least 2 elements\" in (lastNote msg . initNote msg)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1520633747, "creation_date": 1520633747, "answer_id": 49203005, "question_id": 49199011, "link": "https://stackoverflow.com/questions/49199011/defining-new-function-as-a-composition-of-functions-while-adding-additional-beha/49203005#49203005", "title": "Defining new function as a composition of functions while adding additional behaviours", "body": "<p>You could often simply compose an additional function that has the additional behaviour:</p>\n\n<pre><code>myButLast' :: [a] -&gt; a\nmyButLast' = last . init . assertAtLeastTwo\n  where assertAtLeastTwo xs@(_:_:_) = xs\n        assertAtLeastTwo _ = error \"The list has to have at least 2 elements!\"\n</code></pre>\n\n<p>Here we've added a function that checks for the conditions we want to raise an error, and otherwise simply returns its input so that the other functions can act on it exactly as if <code>assertAtLeastTwo</code> wasn't there.</p>\n\n<p>Another alternative that allows you to clearly highlight the error conditions is:</p>\n\n<pre><code>myButLast' :: [a] -&gt; a\nmyButLast' [] = error \"The list has to have at least 2 elements!\"\nmyButLast' [x] = error \"The list has to have at least 2 elements!\"    \nmyButLast' xs = go xs\n  where go = last . init\n</code></pre>\n\n<p>Where you do the error checking as you originally wrote, but have the main definition simply defer to an implementation function <code>go</code>, which can then be defined point-free using composition.</p>\n\n<p>Or you can of course inline <code>go</code> from above, and have:</p>\n\n<pre><code>myButLast' xs = (last . init) xs\n</code></pre>\n\n<p>Sine a composition of functions is itself an expression, and can simply be used in a larger expression directly as the function. In fact a fairly common style is in fact to write code of the form \"compose a bunch of functions then apply to this argument\" this way, using the <code>$</code> operator:</p>\n\n<pre><code>myButLast' xs = last . init $ xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520742394, "post_id": 49215285, "comment_id": 85437280, "body": "That makes lots of sense @fpmore, thanks for your answer."}], "tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 1, "last_activity_date": 1520726540, "creation_date": 1520726540, "answer_id": 49215285, "question_id": 49199011, "link": "https://stackoverflow.com/questions/49199011/defining-new-function-as-a-composition-of-functions-while-adding-additional-beha/49215285#49215285", "title": "Defining new function as a composition of functions while adding additional behaviours", "body": "<p>If you would use wrappers you can have the best of both worlds and a clear separation between the two. Robust error checking and reporting and a vanilla function to use however you wish, with or without the wrapper.\nInteresting, the vanilla function reports 'last' cannot process an empty list given a one element list and 'init' cannot process an empty list when given an empty list. </p>\n\n<pre><code>mbl2 = last . init\nmbl xs = if length xs &lt; 2 then error errmsg else mbl2 xs\n    where errmsg = \"Input list must contain at least two members.\"\n</code></pre>\n"}], "owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 49199146, "answer_count": 5, "score": 1, "last_activity_date": 1520726540, "creation_date": 1520616163, "question_id": 49199011, "link": "https://stackoverflow.com/questions/49199011/defining-new-function-as-a-composition-of-functions-while-adding-additional-beha", "title": "Defining new function as a composition of functions while adding additional behaviours", "body": "<p>I have started to solve the <a href=\"https://wiki.haskell.org/99_questions/1_to_10\" rel=\"nofollow noreferrer\">99 problems in Haskell</a>, and for the second question, it is given the following solution:</p>\n\n<pre><code>myButLast' :: [a] -&gt; a\nmyButLast' = last . init\n</code></pre>\n\n<p>and if we give the empty list to this function, we get and error, however, I would like to print a specific error as </p>\n\n<pre><code>myButLast' [] = error \"The list has to have at least 2 elements!\"\nmyButLast' [x] = error \"The list has to have at least 2 elements!\"\n</code></pre>\n\n<p>but when I add these line to the code, I get </p>\n\n<blockquote>\n  <p>Equations for \u2018myButLast'\u2019 have different numbers of arguments</p>\n</blockquote>\n\n<p>, so is there a way to use the composition type of defining my new function while also adding some specific behaviour ?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1520599113, "post_id": 49193936, "comment_id": 85392547, "body": "<code>w == x*2 + y*2 + z*2</code> doesn&#39;t define <code>w</code>, but sets up an equality check involving an (undefined) <code>w</code>. You mean <code>let w = x*2 + y*2 + z*2</code> instead. (Though if your intended formula is the Pythagoras one, you actually mean <code>let w = x^2 + y^2 + z^2</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520599209, "post_id": 49193962, "comment_id": 85392600, "body": "There is some problematics comma somewhere"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520599225, "post_id": 49193962, "comment_id": 85392614, "body": "@onurcanbektas I just tried to copy &amp; paste the above into GHCi, and I can see no errors. Keep it on a single line, if you have indentation errors (or indent the second line more)."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "edited": false, "score": 0, "creation_date": 1520599725, "post_id": 49193962, "comment_id": 85392877, "body": "Ok, apparently, I was putting an extra &quot;=&quot;. Thanks a lot for the answer."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1520599480, "last_edit_date": 1520599480, "creation_date": 1520598940, "answer_id": 49193962, "question_id": 49193936, "link": "https://stackoverflow.com/questions/49193936/getting-variable-not-in-scope-w-integer-error-while-defining-the-type-of/49193962#49193962", "title": "Getting &quot;Variable not in scope: w :: Integer&quot; error while defining the type of &quot;w&quot;", "body": "<p>The condition <code>w == x*2 + ...</code> checks whether an <em>already defined</em> variable <code>w</code> is equal to <code>x*2 + ...</code>. If you want to define <code>w</code> there, you need <code>let w = x*2 + ...</code> instead.</p>\n\n<pre><code>[ w :: Integer \n| x &lt;- [1..10], y &lt;- [1..10], z &lt;- [1..10], let w = x*2 + y*2 + z*2, w &lt; 20]\n</code></pre>\n\n<p>GHCi demo:</p>\n\n<pre><code>&gt; [ w :: Integer | x &lt;- [1..10], y &lt;- [1..10], z &lt;- [1..10], let w = x*2 + y*2 + z*2, w &lt; 20]\n[6,8,10,12,14,16,18,8,10,12,14,16,18,10,12,14,16,18,12,14,16,18,14,16,18,16,18,18,8,10,12,14,16,18,10,12,14,16,18,12,14,16,18,14,16,18,16,18,18,10,12,14,16,18,12,14,16,18,14,16,18,16,18,18,12,14,16,18,14,16,18,16,18,18,14,16,18,16,18,18,16,18,18,18]\n</code></pre>\n"}], "owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1191, "favorite_count": 0, "accepted_answer_id": 49193962, "answer_count": 1, "score": 0, "last_activity_date": 1520599480, "creation_date": 1520598810, "question_id": 49193936, "link": "https://stackoverflow.com/questions/49193936/getting-variable-not-in-scope-w-integer-error-while-defining-the-type-of", "title": "Getting &quot;Variable not in scope: w :: Integer&quot; error while defining the type of &quot;w&quot;", "body": "<p>I'm a new to Haskell, and learning list comprehensions.From what I have seen from the examples, I'm trying to execute the following code in </p>\n\n<pre><code>[ w :: Integer | x &lt;- [1..10], y &lt;- [1..10], z &lt;- [1..10], w == x*2 + y*2 + z*2, w &lt; 20]\n</code></pre>\n\n<p>However, I'm getting the following error:</p>\n\n<blockquote>\n  <p>:66:3: error: Variable not in scope: w :: Integer</p>\n  \n  <p>:66:60: error: Variable not in scope: w :: Integer</p>\n  \n  <p>:66:82: error: Variable not in scope: w :: Integer</p>\n</blockquote>\n\n<p>I have searched the cause of the problem, and from <a href=\"https://stackoverflow.com/questions/22478551/haskell-not-in-scope-list-comprehension\">this</a> question, the problem seems that Haskell does not know the type of the variable, but in my code, I'm defining it (as we do while we are doing math), but still the problems occurs, so what is wrong with this kind of definition and how can we solve it ?</p>\n\n<p>Note that, the whole purpose of trying to execute this piece of code is just to learn how can I do list comprehension by using the same notation as I use in mathematics.</p>\n"}, {"tags": ["haskell", "functional-programming", "equality"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1520594172, "post_id": 49191039, "comment_id": 85389869, "body": "Generally the best strategy is to <b>avoid equality comparisons</b>. They aren&#39;t really that useful \u2013 in fact if two values turn up that are equal, it hints that duplicate work has already been done. Best design algorithms so they simply don&#39;t care whether any values are equal. If you do compare, it&#39;s usually a good idea to <b>start with a hash</b> rather than the values themselves."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1520595005, "post_id": 49191039, "comment_id": 85390260, "body": "You could do that like in Javascript, but you should do that in IO or ST (which is default in Javascript). Just wrap your objects to IORef or STRef and you will can compare them. But if you want to be pure, you should not think about phisical comparison."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520595261, "post_id": 49191039, "comment_id": 85390380, "body": "@leftaroundabout I&#39;d hoped a little bit that equality checks themselves are often the problem - like an indicator for poor or imperative programming (simply put)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1520595460, "post_id": 49191039, "comment_id": 85390477, "body": "@freestyle I didn&#39;t know <code>IORef</code>, thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1520599392, "post_id": 49191039, "comment_id": 85392713, "body": "See also: <a href=\"https://stackoverflow.com/questions/1976247\">1</a> <a href=\"https://stackoverflow.com/questions/5701893\">2</a> <a href=\"https://stackoverflow.com/questions/30175974\">3</a> <a href=\"https://stackoverflow.com/questions/18077428\">4</a> <a href=\"https://stackoverflow.com/questions/1717553\">5</a> <a href=\"https://stackoverflow.com/questions/27762441\">6</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1520600342, "post_id": 49191039, "comment_id": 85393250, "body": "@DanielWagner It&#39;s certainly a duplicate. I actually did some research before. It is amazing how many formulations there are for basically the same question. Thanks for the links."}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "closed_date": 1520599286, "answer_count": 0, "score": 3, "last_activity_date": 1520592082, "creation_date": 1520589334, "last_edit_date": 1520592082, "question_id": 49191039, "link": "https://stackoverflow.com/questions/49191039/is-there-an-approach-strategy-to-mitigate-the-cost-of-equality-checks", "closed_reason": "Duplicate", "title": "Is there an approach/strategy to mitigate the cost of equality checks?", "body": "<p>Immutability along with referential transparency leads to a couple of desirable properties. But together they have two drawbacks:</p>\n\n<ul>\n<li>deep copying</li>\n<li>determination of equality</li>\n</ul>\n\n<p>Both operations are expensive.</p>\n\n<p>The first issue is mitigated by structural sharing. The <code>List</code> type is one of the simplest persistent data structures and as a result of structural sharing prepending to lists is rather cheap:</p>\n\n<pre><code>xs = [1, 2, 3] --     [1, [2, [3, []]]]\nys = 0 : xs    -- [0, [1, [2, [3, []]]]]\n</code></pre>\n\n<p>But how can I determine the equality between <code>xs</code> and <code>ys</code> without checking the equality of each element?</p>\n\n<p>In an imperative language like Javascript I would simply conduct a physical equality check of the root node. Since this invalidates referential transparency, it is not possible in Haskell, of course.</p>\n\n<p>Is there an approach/strategy to avoid the brute force method - at least for some cases?</p>\n\n<p>What I am currently trying in Javascript is to create a equality type that implements the monad class, so that I can determine reference equality without losing RT. But I am too inexperienced to see if this is a promising approach.</p>\n"}, {"tags": ["haskell", "typeclass", "aeson", "higher-kinded-types"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1520608058, "post_id": 49188247, "comment_id": 85398109, "body": "Those classes were introduced through <a href=\"https://github.com/bos/aeson/issues/352\" rel=\"nofollow noreferrer\"><i>aeson</i> issue #352</a>. There might be a good answer to be extracted from the discussion there (and in the related <a href=\"https://github.com/bos/aeson/pull/341\" rel=\"nofollow noreferrer\">issue #341</a>)."}], "answers": [{"comments": [{"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1520613890, "post_id": 49197426, "comment_id": 85401673, "body": "Thanks!  This is a really nice explanation.  I&#39;m going to have to go through this slowly to really let it sink in.  In my own code I don&#39;t think I tend to use recursive types that pack on more and more type constructors (like <code>data Tree m a = Branch (Tree m (m a))</code>).  I&#39;ll have to keep my eyes open for places when that will be useful.  Also, will <code>Eq (Tree m a)</code> be possible to write now with <a href=\"https://ghc.haskell.org/trac/ghc/wiki/QuantifiedConstraints\" rel=\"nofollow noreferrer\">quantified constraints</a>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 1, "creation_date": 1520642989, "post_id": 49197426, "comment_id": 85413825, "body": "@illabout This <code>Tree</code> type and things like it aren&#39;t super common, but existentially-quantified boxes are and need a similar trick. Your link looks closely related, but <code>Eq1</code> has the distinct advantage of existing today."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1520648805, "post_id": 49197426, "comment_id": 85414752, "body": "Tbf, quantified contexts do exist today. They just exist very experimentally."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1520610638, "creation_date": 1520610638, "answer_id": 49197426, "question_id": 49188247, "link": "https://stackoverflow.com/questions/49188247/what-are-fromjson1-and-tojson1-used-for-in-aeson/49197426#49197426", "title": "What are FromJSON1 and ToJSON1 used for in aeson?", "body": "<p><code>Eq1</code> offers another feature that you haven't discussed in your exposition: it lets you write a function that calls <code>(==)</code> at many different types, without necessarily knowing ahead of time which types you will use it on.</p>\n\n<p>I'll give a toy example; hopefully you can see through the apparent uselessness of this example to the reason <code>Eq1</code> gives you some interesting powers.</p>\n\n<p>Imagine you want to make a tree that is parameterized on the branching factor, so you parameterize it by the child container. So values might look like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\ndata Tree m a where\n    Branch :: Tree m (m a) -&gt; Tree m a\n    Leaf :: a -&gt; Tree m a\n</code></pre>\n\n<p>For example, I can get binary trees with <code>Tree Pair</code>, trinary trees with <code>Tree Triple</code>, finger trees with <code>Tree TwoThree</code>, and rose trees with <code>Tree []</code>, where <code>data Pair a = Pair a a</code>, <code>data Triple a = Triple a a a</code>, and <code>data TwoThree a = Two a a | Three a a a</code>. Now I would like to write an <code>Eq</code> instance for this. If we only rely on <code>Eq</code> constraints, we can't get where we want to go. Let's try:</p>\n\n<pre><code>instance Eq (Tree m a) where\n    Leaf a == Leaf a' = a == a'\n    Branch t == Branch t' = t == t'\n    _ == _ = False\n</code></pre>\n\n<p>Naturally, GHC complains that it doesn't know how to compare <code>a</code> and <code>a'</code> for equality. So add <code>Eq a</code> to the context:</p>\n\n<pre><code>instance Eq a =&gt; Eq (Tree m a) where ...\n</code></pre>\n\n<p>Now GHC complains that it doesn't know how to compare <code>m a</code>s for equality in the <code>Branch</code> case. Makes sense.</p>\n\n<pre><code>instance (Eq a, Eq (m a)) =&gt; Eq (Tree m a) where ...\n</code></pre>\n\n<p>Still no go! Now the implementation of <code>(==) :: Tree m a -&gt; Tree m a -&gt; Bool</code> has a recursive call to <code>(==) :: Tree m (m a) -&gt; Tree m (m a) -&gt; Bool</code> in its <code>Branch</code> case, hence must provide the context <code>(Eq (m a), Eq (m (m a)))</code> to make that recursive call. Okay, let's add that to the instance context...</p>\n\n<pre><code>instance (Eq a, Eq (m a), Eq (m (m a))) =&gt; Eq (Tree m a) where ...\n</code></pre>\n\n<p>Still no good. Now the recursive call has to prove even more stuff! What we'd really like to say is that if we have <code>Eq b</code>, then we have <code>Eq (m b)</code>, for all <code>b</code>s and not just for the specific <code>a</code> being used as <code>Tree</code>'s second parameter.</p>\n\n<pre><code>instance (Eq a, (forall b. Eq b =&gt; Eq (m b))) =&gt; Eq (Tree m a) where ...\n</code></pre>\n\n<p>Of course that's totally not a thing in Haskell. But <code>Eq1</code> gives us that:</p>\n\n<pre><code>instance Eq1 m =&gt; Eq1 (Tree m) where\n    liftEq (==) (Leaf a) (Leaf a') = a == a'\n    liftEq (==) (Branch t) (Branch t') = liftEq (liftEq (==)) t t'\n    liftEq (==) _ _ = False\n\ninstance (Eq1 m, Eq a) =&gt; Eq (Tree m a) where\n    (==) = eq1\n</code></pre>\n\n<p>Here the <code>Eq1 m</code> constraint is serving the role we asked for before, namely, that all of <code>(Eq a, Eq (m a), Eq (m (m a)), ...)</code> are possible.</p>\n\n<p>The <code>ToJSON1</code> and <code>FromJSON1</code> classes serve a similar role: they give you a single constraint that you can give that amounts to a potentially infinite collection of <code>ToJSON</code> and <code>FromJSON</code> constraints, so that you can choose which <code>ToJSON</code> or <code>FromJSON</code> constraint you need in a data-driven way and be guaranteed that it's available.</p>\n"}], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 49197426, "answer_count": 1, "score": 4, "last_activity_date": 1520610638, "creation_date": 1520578910, "last_edit_date": 1520600812, "question_id": 49188247, "link": "https://stackoverflow.com/questions/49188247/what-are-fromjson1-and-tojson1-used-for-in-aeson", "title": "What are FromJSON1 and ToJSON1 used for in aeson?", "body": "<p>Aeson provides <a href=\"https://hackage.haskell.org/package/aeson-1.3.0.0/docs/Data-Aeson.html#t:FromJSON1\" rel=\"nofollow noreferrer\"><code>FromJSON1</code></a> and <a href=\"https://hackage.haskell.org/package/aeson-1.3.0.0/docs/Data-Aeson.html#t:ToJSON1\" rel=\"nofollow noreferrer\"><code>ToJSON1</code></a> type classes.  These are similar to the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Classes.html#t:Eq1\" rel=\"nofollow noreferrer\"><code>Eq1</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Classes.html#t:Show1\" rel=\"nofollow noreferrer\"><code>Show1</code></a> classes defined in the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Classes.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Classes</code></a> module.</p>\n\n<p>My understanding of the <code>Eq1</code> and <code>Show1</code> classes is that they are needed to be able to express constraints on arguments of transformers without using extensions like <code>FlexibleContexts</code> and <code>UndecidableInstances</code>.</p>\n\n<p>The example from the documentation in the <code>Data.Functor.Classes</code> module is as follows:</p>\n\n<p>Assume we have a data type that acts as a transformer: <code>T</code>.  For an example, let's have it be isomorphic to <code>IdentityT</code>:</p>\n\n<pre><code>data T f a = T (f a)\n</code></pre>\n\n<p>The kind of <code>T</code> is as follows:</p>\n\n<pre><code>T :: (* -&gt; *) -&gt; * -&gt; *\n</code></pre>\n\n<p>If there is an <code>Eq1</code> instance for <code>f</code>, it is possible to use it when writing the <code>Eq1</code> instance for <code>T f</code>:</p>\n\n<pre><code>instance Eq1 f =&gt; Eq1 (T f) where\n  liftEq :: (a -&gt; b -&gt; Bool) -&gt; T f a -&gt; T f b -&gt; Bool\n  liftEq eq (T fa1) (T fa2) = liftEq eq fa1 fa2\n</code></pre>\n\n<p>If we have an <code>Eq1</code> instance for <code>f</code>, an <code>Eq</code> instance for <code>a</code>, and the <code>Eq1</code> instance for <code>T f</code> above is in scope, we can easily write the <code>Eq</code> instance for <code>T f a</code>:</p>\n\n<pre><code>instance (Eq1 f, Eq a) =&gt; Eq (T f a) where\n  (==) :: T f a -&gt; T f a -&gt; Bool\n  (==) = eq1\n</code></pre>\n\n<p>The type of <code>eq1</code> is defined as follows:</p>\n\n<pre><code>eq1 :: (Eq1 h, Eq a) =&gt; h a -&gt; h a -&gt; Bool\n</code></pre>\n\n<p>In our instance above, <code>h</code> becomes <code>T f</code>, so the type of <code>eq1</code> can be thought of as the following:</p>\n\n<pre><code>eq1 :: Eq a =&gt; T f a -&gt; T f a -&gt; Bool\n</code></pre>\n\n<hr>\n\n<p>Now, the <code>Eq1</code>, <code>Show1</code>, etc classes make sense.  It seems like it makes it easier to write instances of <code>Eq</code>, <code>Show</code>, etc for transformers.</p>\n\n<p>However, I'm wondering what types <code>FromJSON1</code> and <code>ToJSON1</code> are used for in Aeson?  I rarely have transformers that I want to turn to and from JSON.</p>\n\n<p>Most of the data types I end up changing to JSON are normal types (not type constructors).  That is to say, types with the kind <code>*</code>.  I also uses types like <code>Maybe</code> with a kind of <code>* -&gt; *</code>.</p>\n\n<p>However, I don't think I often create <code>ToJSON</code> or <code>FromJSON</code> instances for transformers, like the <code>T</code> above.  What is a transformer that is often used to go to and from JSON?  Am I missing out on some helpful transformers?</p>\n"}, {"tags": ["haskell", "gtk", "gtk3", "gtk2", "gtk2hs"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 2, "creation_date": 1520582023, "post_id": 49187267, "comment_id": 85383155, "body": "These bind to gtk2 and gtk3 respectively."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520584361, "post_id": 49187267, "comment_id": 85384257, "body": "It is not the Haskell part that is much different. The Haskell library acts as a wrapper to the gtk library. So it calls a different one."}, {"owner": {"reputation": 10263, "user_id": 518853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IjKPw.png?s=128&g=1", "display_name": "liberforce", "link": "https://stackoverflow.com/users/518853/liberforce"}, "edited": false, "score": 0, "creation_date": 1520588578, "post_id": 49187267, "comment_id": 85386480, "body": "Seems that in Gtk2Hs, the 2 means &quot;to&quot;, not &quot;two&quot; (like in GTK bindings <i>to</i> Haskell). The naming is infortunate as it leads to confusion."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1520598358, "creation_date": 1520598358, "answer_id": 49193807, "question_id": 49187267, "link": "https://stackoverflow.com/questions/49187267/differences-between-gtk-and-gtk2/49193807#49193807", "title": "Differences between gtk and gtk2", "body": "<p>As pointed out in the comments, <em>gtk</em> binds to GTK+ 2, and <em>gtk3</em>, to GTK+ 3. One place where that information shows up is in the <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#pkg-field-pkgconfig-depends\" rel=\"nofollow noreferrer\"><code>pkg-config</code> fields</a> of their respective .cabal files (cf. <a href=\"http://hackage.haskell.org/package/gtk-0.14.7/src/gtk.cabal\" rel=\"nofollow noreferrer\"><code>gtk.cabal</code></a> and <a href=\"http://hackage.haskell.org/package/gtk3-0.14.8/src/gtk3.cabal\" rel=\"nofollow noreferrer\"><code>gtk3.cabal</code></a>).</p>\n"}], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 49193807, "answer_count": 1, "score": 2, "last_activity_date": 1520598358, "creation_date": 1520573935, "question_id": 49187267, "link": "https://stackoverflow.com/questions/49187267/differences-between-gtk-and-gtk2", "title": "Differences between gtk and gtk2", "body": "<p>There seem to be two gtk2hs libraries on Hackage - <a href=\"http://hackage.haskell.org/package/gtk\" rel=\"nofollow noreferrer\">gtk</a> and <a href=\"http://hackage.haskell.org/package/gtk3\" rel=\"nofollow noreferrer\">gtk3</a>. Looking at the <a href=\"https://github.com/gtk2hs/gtk2hs\" rel=\"nofollow noreferrer\">source</a>, they seem to share the same files and have only minor differences. How are these libraries different?</p>\n"}, {"tags": ["haskell", "optimization"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1520558667, "post_id": 49185194, "comment_id": 85376044, "body": "What optimization level is being used?"}, {"owner": {"reputation": 530, "user_id": 778488, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70d1e74448d8b36262ee8ee1430a4fc1?s=128&d=identicon&r=PG", "display_name": "Luke Worth", "link": "https://stackoverflow.com/users/778488/luke-worth"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1520559359, "post_id": 49185194, "comment_id": 85376222, "body": "It seems the same with and without -O"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1520559449, "post_id": 49185194, "comment_id": 85376239, "body": "what about -O2?"}, {"owner": {"reputation": 530, "user_id": 778488, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70d1e74448d8b36262ee8ee1430a4fc1?s=128&d=identicon&r=PG", "display_name": "Luke Worth", "link": "https://stackoverflow.com/users/778488/luke-worth"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1520563521, "post_id": 49185194, "comment_id": 85377188, "body": "<code>stack ghc Test.hs -- -O2 -funbox-strict-fields -prof -fprof-auto</code> gives the same results"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1520563599, "post_id": 49185194, "comment_id": 85377207, "body": "Cost centers ruin optimization. GHC essentially refuses to optimize code out of or between cost centers, to give more accurate results within the cost centers, but, in this case (and basically whenever you use -fprof-auto) it also confounds the data."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1520565294, "post_id": 49185194, "comment_id": 85377562, "body": "To be clear, I\u2019m not saying that removing the \u201cgenerateList\u201d cost center <i>will</i> improve allocation (but it <i>might</i>), because I\u2019m not sure if fromAscList participates in fusion anyway, but that the measurement will be more accurate without it. If removing it doesn\u2019t do much, you can use a simple \u201cfoldr insert empty\u201d, which will definitely fuse the list away, but then you lose whatever fromAscList is supposed to give you. You may also want to look at fromDistinctAscList."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1520602733, "post_id": 49185194, "comment_id": 85394778, "body": "Those integers are boxed, aren&#39;t they? So maybe those are just the allocations of those boxes (from generate_list) and the allocations needed for the internal data of Data.IntSet (fromAscList)."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1520627087, "post_id": 49185194, "comment_id": 85408337, "body": "Utterly trivial stylistic note: making a single statement into a <code>do</code> block is redundant."}], "answers": [{"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 2, "last_activity_date": 1520623148, "last_edit_date": 1520623148, "creation_date": 1520621341, "answer_id": 49200295, "question_id": 49185194, "link": "https://stackoverflow.com/questions/49185194/haskell-optimisation-how-to-stop-list-from-performing-allocations/49200295#49200295", "title": "Haskell optimisation: how to stop list from performing allocations?", "body": "<p>You should use <code>fromDistinctAscList</code>, otherwise every next <code>Int</code> has to be compared with its predecessor to determine whether to add it or to skip, which must be incurring the overhead you observe. <em>(Though I have not looked at the source code, it seems a plausible guess that this happens, and we could hardly expect memory to be allocated in an optimal way in such case.)</em></p>\n\n<p>Try this code:</p>\n\n<pre><code>main = do\n   print $ size\n         $ {-# SCC \"fromDistinctAscList\" #-} fromDistinctAscList\n         $ {-# SCC \"generate_list\" #-} [1..1000]\n</code></pre>\n\n<p>The performance that I observe is about 36% better memory-wise. (This figure seems to align with yours.) Here is the relevant section of the profiling report:</p>\n\n<pre><code>COST CENTRE            MODULE                SRC                        no.     entries  %time %alloc   %time %alloc\n....\n  main                 ListAlloc             ListAlloc.hs:(5,1)-(8,55)  276          1    0.0    0.2     0.0   62.5\n   fromDistinctAscList ListAlloc             ListAlloc.hs:(7,46)-(8,55) 278          1    0.0    1.1     0.0   62.4\n    generate_list      ListAlloc             ListAlloc.hs:8:40-55       279          1    0.0   61.2     0.0   61.2\n...\n</code></pre>\n\n<p>&nbsp;</p>\n\n<p>Concerning the reality of the allocations, I'm not sure I understand the question but, looking at garbage collections with <code>+RTS -S</code>, both variants run in almost same memory all along, linearly growing due to the growth of the <code>IntMap</code>. It seems all other computations are done in reasonably small constant memory.</p>\n"}], "owner": {"reputation": 530, "user_id": 778488, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/70d1e74448d8b36262ee8ee1430a4fc1?s=128&d=identicon&r=PG", "display_name": "Luke Worth", "link": "https://stackoverflow.com/users/778488/luke-worth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1520623148, "creation_date": 1520558498, "question_id": 49185194, "link": "https://stackoverflow.com/questions/49185194/haskell-optimisation-how-to-stop-list-from-performing-allocations", "title": "Haskell optimisation: how to stop list from performing allocations?", "body": "<p>In this program:</p>\n\n<pre><code>module Main where\nimport Data.IntSet\nmain = do\n   print $ size\n         $ {-# SCC \"fromAscList\" #-} fromAscList\n         $ {-# SCC \"generate_list\" #-} [1..1000]\n</code></pre>\n\n<p>(Compile and run with <code>stack ghc Main.hs -- -prof -fprof-auto &amp;&amp; ./Main +RTS -p</code>)</p>\n\n<p>I get this output from the GHC profiler (edited for brevity):</p>\n\n<pre><code>    total alloc =     202,704 bytes  (excludes profiling overheads)\n\nCOST CENTRE   MODULE           SRC                    %time %alloc\n\ngenerate_list Main             Main.hs:6:40-48          0.0   39.5\nfromAscList   Main             Main.hs:(5,38)-(6,48)    0.0   36.2\nmain          Main             Main.hs:(3,1)-(6,48)     0.0    5.0\n\n                                          individual      inherited\nCOST CENTRE       MODULE                %time %alloc   %time %alloc\n\n  main            Main                   0.0    0.1     0.0   75.8\n   fromAscList    Main                   0.0   36.2     0.0   75.7\n    generate_list Main                   0.0   39.5     0.0   39.5\n</code></pre>\n\n<p>This seems to indicate that <code>[1..a']</code> is allocating 80Kb (39.5% of 202,704 bytes) over the course of the program, and then <code>fromAscList</code> is allocating the same amount again. (One allocation for the input Int, and another for the stored Int?)</p>\n\n<p>Two questions:</p>\n\n<ol>\n<li>Are these \"real\" allocations from <code>generate_list</code>, or would it be reusing the same piece of memory repeatedly? (I want to know if heap allocations could be a bottleneck.)</li>\n<li>If this is repeatedly using the heap, is there a way to instead stream unboxed values 1..1000 directly into <code>fromAscList</code>?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 2, "creation_date": 1520557766, "post_id": 49185040, "comment_id": 85375834, "body": "If I understand correctly, the error message is complaining about the entire expression <code>(fromIntegral (a - b)) &#47; 2</code> \u2014 this is Fractional, but you&#39;ve asked (via the type signature of <code>calcAxis</code>) for it to be <code>Int</code>."}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "reply_to_user": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 0, "creation_date": 1520557878, "post_id": 49185040, "comment_id": 85375859, "body": "If I remove the division and update the signature for <code>calcAxis</code> to return a <code>Float</code> it typechecks ok."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1520557917, "post_id": 49185040, "comment_id": 85375867, "body": "@Globalkeith: Why would you do both? Update the signature to return a <code>Float</code> and don\u2019t remove the division."}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "edited": false, "score": 0, "creation_date": 1520557996, "post_id": 49185040, "comment_id": 85375888, "body": "Doh, ignore me - it typechecks when it returns a <code>Float</code>!! thanks"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1520558689, "post_id": 49185040, "comment_id": 85376050, "body": "Yes, it&#39;s probably the right thing to just keep the result a fractional type. Though <code>Float</code> is pretty unusual in Haskell, normally the higher-precision <code>Double</code> or exact <code>Rational</code> are prefered."}], "answers": [{"comments": [{"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "edited": false, "score": 0, "creation_date": 1520558225, "post_id": 49185091, "comment_id": 85375935, "body": "thanks for your detailed answer, I do appreciate it. Yes I realised when @Shreevatsar asked about the signature."}], "tags": [], "owner": {"reputation": 1159, "user_id": 3953988, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/803352198cc6f048e409a07eefa19d7b?s=128&d=identicon&r=PG", "display_name": "Rahul Manne", "link": "https://stackoverflow.com/users/3953988/rahul-manne"}, "is_accepted": false, "score": 3, "last_activity_date": 1520557903, "creation_date": 1520557903, "answer_id": 49185091, "question_id": 49185040, "link": "https://stackoverflow.com/questions/49185040/no-instance-for-fractional-int-arising-from-a-use-of/49185091#49185091", "title": "No instance for (Fractional Int) arising from a use of \u2018/\u2019", "body": "<p>The problem is that you end up with a float after using <code>/</code> and your type spec says you should be returning an Int.</p>\n\n<p>You need to either round/truncate convert to Int or change the type signature of calcAxis.</p>\n\n<pre><code>&gt; let a = 1 :: Int\n&gt; let b = 2 :: Int\n&gt; let c = (fromIntegral (a - b)) / 2\n&gt; :t c\nc :: Fractional a =&gt; a\n</code></pre>\n\n<p>And there's no instance for <code>Fractional Int</code> is what the type error is indicating.</p>\n"}, {"comments": [{"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "edited": false, "score": 0, "creation_date": 1520646587, "post_id": 49185243, "comment_id": 85414436, "body": "Thank you, for anyone at my level this response is rich in educational value. I appreciate it."}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "edited": false, "score": 0, "creation_date": 1520646786, "post_id": 49185243, "comment_id": 85414468, "body": "I hope I don&#39;t offend anyone by selecting this response but it goes above and beyond to help me, so that deserves recognition, and would be helpful for future users."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1520558916, "creation_date": 1520558916, "answer_id": 49185243, "question_id": 49185040, "link": "https://stackoverflow.com/questions/49185040/no-instance-for-fractional-int-arising-from-a-use-of/49185243#49185243", "title": "No instance for (Fractional Int) arising from a use of \u2018/\u2019", "body": "<p>As Ryan commented, it's probably the right thing to just keep the result a fractional type. <code>Float</code> is pretty unusual in Haskell though, normally the higher-precision <code>Double</code> or exact <code>Rational</code> are prefered.</p>\n\n<pre><code>calcAxis :: High -&gt; Low -&gt; Double\ncalcAxis (Just (Tick a _)) (Just (Tick b _)) = fromIntegral (a - b) / 2\ncalcAxis _ _ = ... -- keep in mind to handle the `Nothing` case as well!\n</code></pre>\n\n<p>That said, if you have a reason to make the result <code>Int</code>, and always want to round towards zero, that can be done simply with <em>integer division</em>:</p>\n\n<pre><code>calcAxis :: High -&gt; Low -&gt; Int\ncalcAxis (Just (Tick a _)) (Just (Tick b _)) = (a - b) `quot` 2\n</code></pre>\n\n<p>...or, if you always want to round down,</p>\n\n<pre><code>calcAxis (Just (Tick a _)) (Just (Tick b _)) = (a - b) `div` 2\n</code></pre>\n"}], "owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1184, "favorite_count": 0, "accepted_answer_id": 49185243, "answer_count": 2, "score": 0, "last_activity_date": 1520558916, "creation_date": 1520557388, "question_id": 49185040, "link": "https://stackoverflow.com/questions/49185040/no-instance-for-fractional-int-arising-from-a-use-of", "title": "No instance for (Fractional Int) arising from a use of \u2018/\u2019", "body": "<pre><code>data Tick = Tick\n  { _price :: Int\n  , _timestamp :: TimeOfDay\n  } deriving (Eq, Ord)\n\ninstance Num Tick where\n  (-) (Tick a b) (Tick a' _) = Tick (a - a') b\n\n\ncalcAxis :: High -&gt; Low -&gt; Int\ncalcAxis (Just (Tick a _)) (Just (Tick b _)) = (fromIntegral (a - b)) / 2\n</code></pre>\n\n<p>I understand dividing <code>Int</code>'s will produce a <code>Float</code>, so I need to cast the <code>Int</code>'s using <code>fromIntegral</code> before using <code>(/)</code> however I still get error:</p>\n\n<pre><code>\u2022 No instance for (Fractional Int) arising from a use of \u2018/\u2019\n\u2022 In the expression: (fromIntegral (a - b)) / 2\n  In an equation for \u2018calcAxis\u2019:\n      calcAxis (Just (Tick a _)) (Just (Tick b _))\n        = (fromIntegral (a - b)) / 2\n</code></pre>\n\n<p>I dont really understand what its asking me to do. Surely I don't have to define an instance for <code>Fractional Int</code>? </p>\n\n<p>I assume I'm doing something wrong.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1520552817, "post_id": 49183831, "comment_id": 85374583, "body": "The key point is in the error message: &quot;where T is not a synonym,&quot; and the solution is there too &quot;Use TypeSynonymInstances if you want to disable this.&quot; Of course the way your instance is defined, you&#39;ll also have to define <code>instance Num Tick</code>"}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1520554973, "post_id": 49183831, "comment_id": 85375177, "body": "Thanks @AdamSmith defining <code>instance Num Tick</code> and pattern matching the <code>Just</code> is enough to get me past this error!"}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1520589785, "post_id": 49185159, "comment_id": 85387255, "body": "I think it would be great if you actually explain why having <code>instance Num a =&gt; Num (Maybe a)</code> is wrong, rather than being emotional and referring to a supposed authority. <i>(There are many things in Prelude that are widely considered wrong, such as <code>foldl</code> and <code>head</code>.)</i> I believe you in that experience may show it&#39;s not as great as it looks, but it does look plausible to be able to say just <code>a - b</code> rather than <code>(-) &lt;$&gt; a &lt;*&gt; b</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1520593162, "post_id": 49185159, "comment_id": 85389326, "body": "Yeah, I didn&#39;t really mean \u201cthe standard is perfect\u201d (though one thing I&#39;d attest is that if it&#39;s at all sensible to define an instance, they <i>will</i> generally have written it already... in fact IMO they&#39;ve defined rather <i>too many</i> instances, such as <code>Foldable (a,)</code>). I mostly meant that it&#39;s generally not a good idea to add orphan instances to a library, unless you have a very good reason."}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "edited": false, "score": 0, "creation_date": 1520647179, "post_id": 49185159, "comment_id": 85414521, "body": "Maybe I should point out this is my first Haskell project, and I&#39;m only a few weeks in. I appreciate the lesson though, I&#39;ll try to unpick and understand your answer so I can correct my mistake."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1520592958, "last_edit_date": 1520592958, "creation_date": 1520558304, "answer_id": 49185159, "question_id": 49183831, "link": "https://stackoverflow.com/questions/49183831/arithmetic-for-values-inside-a-maybe-inside-a-record-or-how-to-write-the-instan/49185159#49185159", "title": "Arithmetic for values inside a maybe, inside a record or How to write the instance for (Num (Maybe a))", "body": "<p>Arghhhh... no! Don't do that! Why do you think this is a good idea?</p>\n\n<p><code>High</code> is not a number type, because it also contains the non-number value <code>Nothing</code><sup>&star;</sup>. (Even any such reasoning aside, it's basically never a good idea to define an instance for a type and class that are both in an established standard library, most certainly not <code>base</code>. Such an instance will surprise everybody who knows these libraries and suddenly runs into unexpected instances! Also, if the instance did make sense, the GHC people would probably have already defined it.)</p>\n\n<p>What the <code>Maybe</code> does is, it forces you to think about the case where there <em>is</em> no number, i.e. where either upper or lower boundary aren't given. I don't know what behaviour you want for this case, but plausible would be to immediately make the <code>axis</code>-result <code>Nothing</code> too then. This is readily accomplished using <code>Maybe</code>'s <code>Applicative</code> instance:</p>\n\n<pre><code>axis :: Maybe Int\naxis = (-) &lt;$&gt; candle^.high &lt;*&gt; candle^.low\n</code></pre>\n\n<p>...provided that <code>Tick</code> itself has a <code>Num</code> instance, which might not be very prudent either<sup>&dagger;</sup> but at least plausible. If it doesn't have a <code>Num</code> instance, you need to unwrap the <code>Tick</code> constructor:</p>\n\n<pre><code>axis = Tick &lt;$&gt; ((-) &lt;$&gt; (_price &lt;$&gt; candle^.high) &lt;*&gt; (_price &lt;$&gt; candle^.low)\n</code></pre>\n\n<hr>\n\n<p>That said, if you insist to define that instance (as you shouldn't), then it's easy enough to do. For one thing, you could just unravel the type synonym:</p>\n\n<pre><code>instance Num (Maybe Tick) where\n  Just (Tick a) - Just (Tick b) = Just . Tick $ a - b\n  _ - _ = Nothing\n</code></pre>\n\n<p>But that's not even necessary; as the compiler already hinted you <em>can</em> directly give instances via type synonyms, it's just not Haskell98. Just enable the extension</p>\n\n<pre><code>{-# LANGUAGE TypeSynonymInstances #-}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>instance Num High where\n  ...\n</code></pre>\n\n<p>is accepted, for better or for worse.</p>\n\n<p><hr>\n<sup>&star;</sup>\nNote that just using <code>Applicative</code> for defining a <code>Num</code> instance leads to trouble: you want <code>-</code> and <code>+</code> to be cancellative, i.e. <code>(a - b) + b \u2261 a</code>. But with the straightforward <code>a+b = (+)&lt;$&gt;a&lt;*&gt;b</code> (which can also be written <code>(+)=liftA2(+)</code>) you would have</p>\n\n<pre><code>(Just 1 - Nothing) + Nothing = Nothing\n                             \u2021 Just 1\n</code></pre>\n\n<p>...mind, much the same behaviour is already exhibited by the floating-point instances</p>\n\n<pre><code>Prelude&gt; (1 - 1/0) + 1/0\nNaN\n</code></pre>\n\n<p>but at least there it's understood that infinities and NaN are corner cases where everything gets a bit weird, whereas for a <code>Maybe Int</code> you'd expect the <code>Nothing</code> to be a pretty normal, \u201cit's just not here\u201d value.</p>\n\n<p><sup>&dagger;</sup>\nA better instance is probably</p>\n\n<pre><code>import Data.AdditiveGroup\ninstance AdditiveGroup Tick\n</code></pre>\n\n<p>...which works without any explicit implementation, provided you add <code>Generic</code> to the data definition:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nimport GHC.Generics\ndata Tick = Tick { _price :: Int } deriving (Eq, Ord)\n</code></pre>\n\n<p>With that defined, you can then do</p>\n\n<pre><code>axis = (^-^) &lt;$&gt; candle^.high &lt;*&gt; candle^.low\n</code></pre>\n"}], "owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 49185159, "answer_count": 1, "score": 0, "last_activity_date": 1520592958, "creation_date": 1520549520, "last_edit_date": 1520551544, "question_id": 49183831, "link": "https://stackoverflow.com/questions/49183831/arithmetic-for-values-inside-a-maybe-inside-a-record-or-how-to-write-the-instan", "title": "Arithmetic for values inside a maybe, inside a record or How to write the instance for (Num (Maybe a))", "body": "<p>Given I have the following:</p>\n\n<pre><code>data Tick = Tick { _price :: Int } deriving (Eq, Ord)\n\ntype High = Maybe Tick\ntype Low = Maybe Tick\n\ndata Candle = Candle\n  { _open :: Open\n  , _high :: High\n  , _low :: Low\n  , _close :: Close\n  } deriving (Eq, Ord)\n\nmakeLenses ''Candle\n</code></pre>\n\n<p>When I create a Candle:</p>\n\n<pre><code>candle = ...\n</code></pre>\n\n<p>Then I wish to use the calculate the difference between high and low:</p>\n\n<pre><code> axis = high - low\n</code></pre>\n\n<p>Results in:</p>\n\n<pre><code>\u2022 No instance for (Num High) arising from a use of \u2018-\u2019\n\u2022 In the expression: high - low\n  In an equation for \u2018axis\u2019: axis = high - low\n</code></pre>\n\n<p>I have tried creating an instance like this:</p>\n\n<pre><code>instance Num High where\n    (-) (Just a) (Just b) = Just (a - b)\n</code></pre>\n\n<p>But that results in the error:</p>\n\n<pre><code>\u2022 Illegal instance declaration for \u2018Num High\u2019\n    (All instance types must be of the form (T t1 ... tn)\n     where T is not a synonym.\n     Use TypeSynonymInstances if you want to disable this.)\n\u2022 In the instance declaration for \u2018Num High\u2019\n</code></pre>\n\n<p>So my question is, what should the instance for <code>(Num High)</code> look like to allow my calculation? </p>\n"}, {"tags": ["http", "haskell", "asynchronous", "servant"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 1, "last_activity_date": 1551690085, "last_edit_date": 1551690085, "creation_date": 1551201421, "answer_id": 54890865, "question_id": 49182193, "link": "https://stackoverflow.com/questions/49182193/how-to-asynchronously-consume-a-steaming-end-point-generated-with-servants-st/54890865#54890865", "title": "How to (asynchronously) consume a steaming end-point generated with servant&#39;s StreamGenerators?", "body": "<p>Note: that in newer <code>servant</code> (<code>0.15</code> IIRC) streaming was refactored. However, the question of how to consume <em>streaming endpoints</em> in JavaScript is irrelevant of backend implementation.</p>\n\n<p>For example if you use <em>Fetch API</em>, you can use reader API, which is well explained in <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Streams_API/Using_readable_streams\" rel=\"nofollow noreferrer\">MDN</a>. Summarizing that:</p>\n\n<pre><code>// Fetch the original image\n  fetch('./tortoise.png')\n  // Retrieve its body as ReadableStream\n  .then(response =&gt; {\n    const reader = response.body.getReader();\n</code></pre>\n\n<p>Then you can call <code>reader.read()</code> to get response in parts.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 54890865, "answer_count": 1, "score": 0, "last_activity_date": 1551690085, "creation_date": 1520542215, "question_id": 49182193, "link": "https://stackoverflow.com/questions/49182193/how-to-asynchronously-consume-a-steaming-end-point-generated-with-servants-st", "title": "How to (asynchronously) consume a steaming end-point generated with servant&#39;s StreamGenerators?", "body": "<p>The servant documentation describes how to create <a href=\"http://haskell-servant.readthedocs.io/en/stable/tutorial/Server.html#streaming-endpoints\" rel=\"nofollow noreferrer\">streaming endpoints</a>:</p>\n\n<pre><code>type StreamAPI = \"userStream\" :&gt; StreamGet NewlineFraming JSON (StreamGenerator User)\nstreamAPI :: Proxy StreamAPI\nstreamAPI = Proxy\n\nstreamUsers :: StreamGenerator User\n</code></pre>\n\n<p>Now the question is how can a client (written in javascript for instance) consume the end-point in an asynchronous fashion?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1520540224, "post_id": 49181738, "comment_id": 85369043, "body": "You wrote <code>-</code> instead of <code>=</code>."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1520547693, "post_id": 49181785, "comment_id": 85372761, "body": "Another handy simplification: <code>z == c &amp;&amp; y == b</code> = <code>(z, y) == (c, b)</code> (or maybe clearer, <code>(y, z) == (b, c)</code>)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1520580806, "last_edit_date": 1520580806, "creation_date": 1520540440, "answer_id": 49181785, "question_id": 49181738, "link": "https://stackoverflow.com/questions/49181738/naked-expression-at-top-level/49181785#49181785", "title": "naked expression at top level", "body": "<p>The error means that at the top level, you usually only define <em>functions</em> (as well as datatypes, typeclasses, type instances, etc. but let us ignore that for now).</p>\n\n<p>Now you write:</p>\n\n<pre><code>enrollment :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nenrollment (x:y:z:xs) (a:b:c:as) - if z == c &amp;&amp; y == b then True else False\n--                               ^\n</code></pre>\n\n<p>But as you can see, you did not define a function: indeed there is no equality sign (<code>=</code>). So Haskell interprets this like you want to subtract the body of the function from the head of the function.</p>\n\n<p>We can solve the error with:</p>\n\n<pre><code>enrollment :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nenrollment (x:y:z:xs) (a:b:c:as) = if z == c &amp;&amp; y == b then True else False\n--                               ^\n</code></pre>\n\n<p>But now there is still a problem: if one of the two lists contains less than three elements, then the function will error. So we better add a rule for such cases:</p>\n\n<pre><code>enrollment :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nenrollment (x:y:z:xs) (a:b:c:as) = if z == c &amp;&amp; y == b then True else False\nenrollment _ _ = False\n</code></pre>\n\n<p>Furthermore writing <code>if &lt;expr&gt; then True else False</code> is a quite verbose version of <code>&lt;expr&gt;</code>, so we can rewrite it as:</p>\n\n<pre><code>enrollment :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nenrollment (x:y:z:xs) (a:b:c:as) = z == c &amp;&amp; y == b\nenrollment _ _ = False\n</code></pre>\n\n<p>Or we can - like @JonPurdy says - construct two tuples and compare these, like:</p>\n\n<pre><code>enrollment :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nenrollment (x:y:z:xs) (a:b:c:as) = (y, z) == (b, c)\nenrollment _ _ = False\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8945991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c75656dd8c0aba55e2651f787443c1ff?s=128&d=identicon&r=PG&f=1", "display_name": "rainbowtornado", "link": "https://stackoverflow.com/users/8945991/rainbowtornado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 0, "closed_date": 1521247321, "accepted_answer_id": 49181785, "answer_count": 1, "score": 1, "last_activity_date": 1520580806, "creation_date": 1520540189, "last_edit_date": 1520543091, "question_id": 49181738, "link": "https://stackoverflow.com/questions/49181738/naked-expression-at-top-level", "closed_reason": "Not suitable for this site", "title": "naked expression at top level", "body": "<p>I've been trying to get my head around this parse error on ghci for a while and I can't seem to find an answer online that isn't vague:</p>\n\n<pre><code>enrollment :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nenrollment (x:y:z:xs) (a:b:c:as) - if z == c &amp;&amp; y == b then True else False\n\nParse error: naked expression at top level\nPerhaps you intended to use TemplateHaskell\n</code></pre>\n\n<p>There were no imports to make typos on, and I've spent ages making little tweaks with no progress!\nThanks</p>\n"}, {"tags": ["haskell", "gtk2hs"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520563142, "post_id": 49185346, "comment_id": 85377102, "body": "This would be more useful to other readers (not to mention more comfortable to answer) if you isolated and identified the changes you made to your program, and then edited that information into your question above."}], "tags": [], "owner": {"reputation": 152, "user_id": 3832665, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/520fa46dfc3474e5183d8810bc4ee58b?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/3832665/james"}, "is_accepted": false, "score": 0, "last_activity_date": 1520731960, "last_edit_date": 1520731960, "creation_date": 1520559645, "answer_id": 49185346, "question_id": 49181583, "link": "https://stackoverflow.com/questions/49181583/why-are-buttons-not-rendering-in-a-table-in-gtk2hs/49185346#49185346", "title": "Why are buttons not rendering in a table in gtk2hs", "body": "<p>I'm not 100% sure why the error arose, I have some new code which works:</p>\n\n<pre><code>import Graphics.UI.Gtk\nimport Control.Concurrent\n\nmkBtn :: String -&gt; IO Button\nmkBtn label = buttonNew &gt;&gt;= (\\b -&gt; set b [buttonLabel := label] &gt;&gt; return b)\n\nbuildTable :: Int -&gt; Int -&gt; IO(Grid)\nbuildTable r c = do\n   t &lt;- gridNew\n   gridSetRowHomogeneous t True\n   mapM (\\f -&gt; mkBtn \"Hello\" &gt;&gt;= (\\b -&gt; gridAttach t b (f `mod` c) (f `div` c) 1 1)) [0..(r*c)-1]\n   return (t) \n\nmain = do\n   initGUI\n   window &lt;- windowNew\n   mainSplit &lt;- vBoxNew False 10\n   contPannel &lt;- hBoxNew False 5\n\n   rowTF &lt;- entryNew\n   colTF &lt;- entryNew\n   buildBTN &lt;- buttonNew\n   set buildBTN [buttonLabel := \"Build Table\"]\n\n   set window [containerChild := mainSplit]\n   boxPackStart mainSplit contPannel PackGrow 0\n   boxPackStart contPannel rowTF PackGrow 0\n   boxPackStart contPannel colTF PackGrow 0\n   boxPackStart contPannel buildBTN PackNatural 0\n\n   on window objectDestroy mainQuit\n   widgetShowAll window\n\n   on buildBTN buttonActivated $ do\n      rT &lt;- get rowTF entryText\n      cT &lt;- get colTF entryText\n      r &lt;- return $ read rT\n      c &lt;- return $ read cT\n      t &lt;- buildTable r c \n      boxPackStart mainSplit t PackGrow 0\n      widgetShowAll t\n      return ()\n\n   mainGUI\n</code></pre>\n\n<p>Maybe someone will know why this works and the last didn't? I assume it was how I was creating new buttons.</p>\n\n<p>First thing I changed was from gtk2 to 3, this enabled me to use grid instead of table. Instead of using repeat, I used a helper function <code>mkBtn</code>. The other changes are just how I went about populating the grid. Instead of a rather silly list comprehension, I used <code>mapM</code> and converted the index in the list of buttons to table coords instead of table coords to list index (originally done in <code>t2l</code>) </p>\n"}], "owner": {"reputation": 152, "user_id": 3832665, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/520fa46dfc3474e5183d8810bc4ee58b?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/3832665/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520731960, "creation_date": 1520539488, "question_id": 49181583, "link": "https://stackoverflow.com/questions/49181583/why-are-buttons-not-rendering-in-a-table-in-gtk2hs", "title": "Why are buttons not rendering in a table in gtk2hs", "body": "<p>I'm trying to write a simple UI in gtk2hs. It starts with two text boxes and a button. When the button is pressed, it makes a table of buttons of size (m,n) where m and n are taken from the text boxes. For some reason, when the button is pressed, space is allocated for the table but none of the buttons are shown!</p>\n\n<pre><code>import Graphics.UI.Gtk\nimport Control.Concurrent\n\nt2l :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int \nt2l r c rr cc = (r * cc) + c \n\nbuildTable :: Int -&gt; Int -&gt; IO(Table, [Button])\nbuildTable r c = do\n   t &lt;- tableNew r c True\n   buttons &lt;- sequence $ take (r * c) (repeat buttonNew)\n   mapM (`set` [buttonLabel := \"HELLO\"]) buttons\n   return [tableAttachDefaults t (buttons !! (t2l rr cc r c)) cc (cc+1) rr (rr+1) | cc &lt;- [0..(c+1)] , rr &lt;- [0..(r+1)]]\n   return (t,buttons)\n\nmain = do\n   initGUI\n   window &lt;- windowNew\n   mainSplit &lt;- vBoxNew False 10\n   contPannel &lt;- hBoxNew False 5\n\n   rowTF &lt;- entryNew\n   colTF &lt;- entryNew\n   buildBTN &lt;- buttonNew\n   set buildBTN [buttonLabel := \"Build Table\"]\n\n   set window [containerChild := mainSplit]\n   boxPackStart mainSplit contPannel PackGrow 0\n   boxPackStart contPannel rowTF PackGrow 0\n   boxPackStart contPannel colTF PackGrow 0\n   boxPackStart contPannel buildBTN PackNatural 0\n\n   on window objectDestroy mainQuit\n   widgetShowAll window\n\n   on buildBTN buttonActivated $ do\n      rT &lt;- get rowTF entryText\n      cT &lt;- get colTF entryText\n      r &lt;- return $ read rT\n      c &lt;- return $ read cT\n      (t,b) &lt;- buildTable r c \n      boxPackStart mainSplit t PackGrow 0\n      widgetShowAll t\n      return ()\n\n   mainGUI\n</code></pre>\n"}, {"tags": ["haskell", "types", "polymorphism", "list-comprehension", "parametric-polymorphism"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1520510020, "post_id": 49172424, "comment_id": 85349757, "body": "<code>y</code> seems to be &#39;overwritten&#39; by the second part, since <code>[ y | y &lt;- [&quot;a&quot;], y &lt;- &quot;a&quot;]</code> evaluates to <code>&quot;a&quot;</code>. Also backed up by the fact that <code>[ y | y &lt;- &quot;a&quot;, y &lt;- &quot;b&quot; ]</code>  being <code>&quot;b&quot;</code>."}, {"owner": {"reputation": 537, "user_id": 3562282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bb2a1b86f4f810371ecf35b5320d2e65?s=128&d=identicon&r=PG&f=1", "display_name": "Pierrot", "link": "https://stackoverflow.com/users/3562282/pierrot"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1520510395, "post_id": 49172424, "comment_id": 85349990, "body": "@AJFarmar thanks for this addition. I am even more puzzled, I would guess the types would be invalid in this <code>[ y | y &lt;- &quot;a&quot;, y &lt;- [[[&quot;b&quot;]]], y &lt;- &quot;c&quot;]</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520510518, "post_id": 49172424, "comment_id": 85350058, "body": "Why would that be invalid, you have defined three <code>y</code>&#39;s (this is <i>not</i> the same variable). And the yield is always in the lowest scope, so that takes values from the third <code>y</code>."}], "answers": [{"comments": [{"owner": {"reputation": 537, "user_id": 3562282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bb2a1b86f4f810371ecf35b5320d2e65?s=128&d=identicon&r=PG&f=1", "display_name": "Pierrot", "link": "https://stackoverflow.com/users/3562282/pierrot"}, "edited": false, "score": 0, "creation_date": 1520510853, "post_id": 49172541, "comment_id": 85350294, "body": "thank you for this, meanwhile I does answer half of the question. The other half being why <code>[y | y &lt;- &#39;a&#39;, y &lt;- [&#39;a&#39;]]</code> is giving an error and <code>[y | y &lt;- [&#39;a&#39;], y &lt;- [[&#39;a&#39;]]]</code> doesn&#39;t."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 537, "user_id": 3562282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bb2a1b86f4f810371ecf35b5320d2e65?s=128&d=identicon&r=PG&f=1", "display_name": "Pierrot", "link": "https://stackoverflow.com/users/3562282/pierrot"}, "edited": false, "score": 3, "creation_date": 1520510936, "post_id": 49172541, "comment_id": 85350343, "body": "@Pierrot With <code>y &lt;- &#39;a&#39;</code>, you are attempting to draw an element from something that isn&#39;t a list."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1520519657, "post_id": 49172541, "comment_id": 85356215, "body": "More precisely, the list comprehension is equivalent to <code>&quot;a&quot; &gt;&gt;= (\\y -&gt; [&quot;a&quot;] &gt;&gt;= (\\y -&gt; return y))</code>, where you can clearly see the outer use of <code>y</code> being shadowed by the inner."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1520537495, "last_edit_date": 1520537495, "creation_date": 1520510319, "answer_id": 49172541, "question_id": 49172424, "link": "https://stackoverflow.com/questions/49172424/why-does-a-list-comprehension-accept-mixed-char-and-char-without-error/49172541#49172541", "title": "Why does a list comprehension accept mixed `[Char]` and `[[Char]]` without error in Haskell?", "body": "<p>Turn on warnings! You should see that the first <code>y</code> is being shadowed by the second one.</p>\n\n<p>It is somehow similar to</p>\n\n<pre><code>let y = True\nin let y = \"a\"\nin y\n</code></pre>\n\n<p>where the first definition is overshadowed, as if it were</p>\n\n<pre><code>let _ = True\nin let y = \"a\"\nin y\n</code></pre>\n\n<p>or even, removing the shadowed binding,</p>\n\n<pre><code>let y = \"a\"\nin y\n</code></pre>\n\n<p>Similarly, a list comprehension such as</p>\n\n<pre><code>[y | y &lt;- \"a\", y &lt;- [\"a\"]]\n</code></pre>\n\n<p>evaluates to the same result as</p>\n\n<pre><code>[y | _ &lt;- \"a\", y &lt;- [\"a\"]]\n-- or, if you prefer\n[y | x &lt;- \"a\", y &lt;- [\"a\"]]\n</code></pre>\n\n<p>Note that, unlike the <code>let</code> above, in list comprehensions we can not simply remove the overshadowed binding <code>y &lt;- ...</code>. For instance,</p>\n\n<pre><code>[y | y &lt;- [1,2], y &lt;- [3,4]]\n</code></pre>\n\n<p>produces <code>[3,4,3,4]</code>, unlike <code>[y | y &lt;- [3,4]]</code>.</p>\n\n<p>Here you can see the produced warning for each examples :</p>\n\n<pre><code>Prelude&gt; :set -Wall\n\nPrelude&gt; [y | y &lt;- \"a\", y &lt;- [\"a\"]]\n\n&lt;interactive&gt;:41:6: warning: [-Wunused-matches]\n    Defined but not used: `y'\n\n&lt;interactive&gt;:41:16: warning: [-Wname-shadowing]\n    This binding for `y' shadows the existing binding\n      bound at &lt;interactive&gt;:41:6\n[\"a\"]\n\nPrelude&gt; [y | x &lt;- \"a\", y &lt;- [\"a\"]]\n\n&lt;interactive&gt;:47:6: warning: [-Wunused-matches]\n    Defined but not used: `x'\n[\"a\"]\n\n-- no warning here\nPrelude&gt; [y | _ &lt;- \"a\", y &lt;- [\"a\"]]\n[\"a\"]\n\nPrelude&gt; [y | y &lt;- [1,2] , y &lt;- [3,4]]\n\n&lt;interactive&gt;:49:1: warning: [-Wtype-defaults]\n    * Defaulting the following constraints to type `Integer'\n        (Show a0) arising from a use of `print' at &lt;interactive&gt;:49:1-29\n        (Num a0) arising from a use of `it' at &lt;interactive&gt;:49:1-29\n    * In a stmt of an interactive GHCi command: print it\n\n&lt;interactive&gt;:49:6: warning: [-Wunused-matches]\n    Defined but not used: `y'\n\n&lt;interactive&gt;:49:12: warning: [-Wtype-defaults]\n    * Defaulting the following constraint to type `Integer'\n        Num t0 arising from the literal `1'\n    * In the expression: 1\n      In the expression: [1, 2]\n      In a stmt of a list comprehension: y &lt;- [1, 2]\n\n&lt;interactive&gt;:49:12: warning: [-Wtype-defaults]\n    * Defaulting the following constraint to type `Integer'\n        Num t0 arising from the literal `1'\n    * In the expression: 1\n      In the expression: [1, 2]\n      In a stmt of a list comprehension: y &lt;- [1, 2]\n\n&lt;interactive&gt;:49:19: warning: [-Wname-shadowing]\n    This binding for `y' shadows the existing binding\n      bound at &lt;interactive&gt;:49:6\n[3,4,3,4]\n</code></pre>\n"}], "owner": {"reputation": 537, "user_id": 3562282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bb2a1b86f4f810371ecf35b5320d2e65?s=128&d=identicon&r=PG&f=1", "display_name": "Pierrot", "link": "https://stackoverflow.com/users/3562282/pierrot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 49172541, "answer_count": 1, "score": 9, "last_activity_date": 1520621725, "creation_date": 1520509868, "last_edit_date": 1520621725, "question_id": 49172424, "link": "https://stackoverflow.com/questions/49172424/why-does-a-list-comprehension-accept-mixed-char-and-char-without-error", "title": "Why does a list comprehension accept mixed `[Char]` and `[[Char]]` without error in Haskell?", "body": "<p>While learning Haskell I found something which puzzled me. </p>\n\n<p>I don't understand why this code is valid:</p>\n\n<pre><code>Prelude&gt; [y | y &lt;- \"a\", y &lt;- [\"a\"]]\n[\"a\"]\n</code></pre>\n\n<p>I tried to change to an explicit <code>[Char]</code> and got the same result (which makes sense):</p>\n\n<pre><code>Prelude&gt; [y | y &lt;- ['a'], y &lt;- [\"a\"]]\n[\"a\"]\n</code></pre>\n\n<p>Surprisingly this is valid too :</p>\n\n<pre><code>Prelude&gt; [y | y &lt;- \"a\", y &lt;- [[\"a\"]]]\n[[\"a\"]]\n</code></pre>\n\n<p>[EDIT]\nthe error given is not related to the same fact :</p>\n\n<p><strike>This on the contrary is invalid as I would expect:</p>\n\n<pre><code>Prelude&gt; [y | y &lt;- 'a', y &lt;- ['a']]\n&lt;interactive&gt;:12:11: error:\n* Couldn't match expected type `[t0]' with actual type `Char'\n* In the expression: 'a'\n  In a stmt of a list comprehension: y &lt;- 'a'\n  In the expression: [y | y &lt;- 'a', y &lt;- ['a']]\n</code></pre>\n\n<p></strike></p>\n\n<p><code>[y | y &lt;- 'a']</code> is invalid because 'a' is not a list.</p>\n\n<p>[/EDIT]</p>\n\n<p>I thought it was some usual mess caused by <code>String</code> vs <code>Char</code> but definitely not:</p>\n\n<pre><code>Prelude&gt; [y | y &lt;- [1], y &lt;- [[2]]]\n[[2]]\n</code></pre>\n\n<p>For the record I'm using GHCi version 8.2.2 and Arch Linux.</p>\n"}, {"tags": ["haskell", "travis-ci", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1520531264, "post_id": 49178465, "comment_id": 85364165, "body": "Thanks. I understood that the stack build was succeeding, but I didn&#39;t know why there was a cabal based build that succeeded. I wonder what can I do to avoid getting a warning because of the O2 flag. What if a package needs it."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1520539022, "post_id": 49178465, "comment_id": 85368441, "body": "Remove O2 option from here is an option: <a href=\"https://github.com/capitanbatata/hierarchy/blob/5ec3dcce8b479337264f3fd2730c78a6056f6a0e/hierarchy.cabal#L20\" rel=\"nofollow noreferrer\">github.com/capitanbatata/hierarchy/blob/&hellip;</a>"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1520541124, "post_id": 49178465, "comment_id": 85369496, "body": "Yeah, but what if a package actually needs the O2 option :)"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 1, "last_activity_date": 1520528165, "creation_date": 1520528165, "answer_id": 49178465, "question_id": 49172090, "link": "https://stackoverflow.com/questions/49172090/travis-build-failing-after-a-cabal-check-warning/49178465#49178465", "title": "Travis build failing after a cabal check warning", "body": "<p>There are two types of build in your travis config:</p>\n\n<ul>\n<li>Stack based build </li>\n<li>Cabal based build</li>\n</ul>\n\n<p>If you follow the <a href=\"https://raw.githubusercontent.com/commercialhaskell/stack/stable/doc/travis-complex.yml\" rel=\"nofollow noreferrer\">script code</a>, you will see that only <code>Cabal</code> based build has the command <code>cabal check</code> in it. That will explain why all of your Stack based builds are working fine. Now, let's see the cabal check command line in detail:</p>\n\n<pre><code>cabal check || [ \"$CABALVER\" == \"1.16\" ]\n</code></pre>\n\n<p>So, if your installed cabal version is 1.16, it will ignore the output of cabal check and that command is treated as a success. And infact, that's what is happening. Only one Cabal based build job is success in your travis, because it's version is <code>1.16</code>.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 49178465, "answer_count": 1, "score": 0, "last_activity_date": 1520528165, "creation_date": 1520508812, "last_edit_date": 1520513342, "question_id": 49172090, "link": "https://stackoverflow.com/questions/49172090/travis-build-failing-after-a-cabal-check-warning", "title": "Travis build failing after a cabal check warning", "body": "<p>Several builds, like <a href=\"https://travis-ci.org/capitanbatata/hierarchy/jobs/350766350\" rel=\"nofollow noreferrer\">this one</a>, fail when executing <code>cabal check</code>:</p>\n\n<pre><code>++cabal check\nThese warnings may cause trouble when distributing the package:\n* 'ghc-options: -O2' is rarely needed. Check that it is giving a real benefit\nand not just imposing longer compile times on your users.\n</code></pre>\n\n<p>However, most of the other <a href=\"https://travis-ci.org/capitanbatata/hierarchy/builds/350766349\" rel=\"nofollow noreferrer\">builds in the matrix</a> do not fail after this check.</p>\n\n<p>I'm using the <a href=\"https://raw.githubusercontent.com/commercialhaskell/stack/stable/doc/travis-complex.yml\" rel=\"nofollow noreferrer\">complex Travis configuration</a> suggested at the <a href=\"https://docs.haskellstack.org/en/stable/travis_ci/\" rel=\"nofollow noreferrer\"><code>stack</code> docs</a>, and <a href=\"https://github.com/capitanbatata/hierarchy/blob/master/.travis.yml\" rel=\"nofollow noreferrer\">this</a> is the Travis configuration specific for the project I'm trying to get on CI.</p>\n\n<p>Any ideas on what might be causing this behavior?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1520508971, "post_id": 49171905, "comment_id": 85349154, "body": "Have you tried doing as it says and compiling with <code>-threaded</code>?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1520509647, "post_id": 49171905, "comment_id": 85349543, "body": "That seems to have done it, thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1520613642, "post_id": 49172339, "comment_id": 85401512, "body": "Most of these have nothing to do with threading. All that&#39;s needed here is the <code>-threaded</code> option as mentioned in the error message; The <code>-rtsopts</code> is needed for parsing of RTS arguments."}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1520509620, "creation_date": 1520509620, "answer_id": 49172339, "question_id": 49171905, "link": "https://stackoverflow.com/questions/49171905/connectionfailure-user-error-rts-doesnt-support-multiple-os-threads-use-ghc/49172339#49172339", "title": "ConnectionFailure user error ( RTS doesn&#39;t support multiple OS threads ( use ghc -threaded when linking ) )", "body": "<pre><code>  ghc-options: -O2 -Wall -fwarn-tabs -funbox-strict-fields -threaded -fno-warn-unused-do-bind -rtsopts\n</code></pre>\n\n<p>add above to cabal </p>\n\n<p>I'm just guessing with the above options. Found more info here: <a href=\"https://github.com/snapframework/snap-server/issues/51\" rel=\"nofollow noreferrer\">https://github.com/snapframework/snap-server/issues/51</a></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 190, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520513292, "creation_date": 1520508144, "last_edit_date": 1520513292, "question_id": 49171905, "link": "https://stackoverflow.com/questions/49171905/connectionfailure-user-error-rts-doesnt-support-multiple-os-threads-use-ghc", "title": "ConnectionFailure user error ( RTS doesn&#39;t support multiple OS threads ( use ghc -threaded when linking ) )", "body": "<p>I run into the below error when running a executable I built with <code>stack build</code>:</p>\n\n<pre><code> ( ConnectionFailure user error ( RTS doesn't support multiple OS threads ( use ghc -threaded when linking ) ) )\n</code></pre>\n\n<p>Surprisingly this executable works on my machine, but not on another...</p>\n\n<p>What is the cause of this error? Why does it have different behavior on two machines?</p>\n\n<p>The machine it works on uses an AMD CPU, while the other non working one uses an Intel CPU.</p>\n\n<hr>\n\n<p>Within my <code>~/stack/config.yaml</code> I have: <code>ghc-build: nopie</code> due to <a href=\"https://github.com/commercialhaskell/stack/issues/2712\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/2712</a>. I've just removed this now and trying a <code>stack build</code> again...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520506923, "post_id": 49170879, "comment_id": 85347960, "body": "Why is <code>reverseAndMinimum&#39;</code> listed? Is it used at all? Also, what input did you use for the tests?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1520507438, "post_id": 49170879, "comment_id": 85348261, "body": "@MarkSeemann I lost an apostrophe. Will fix shortly. I used ascending and descending lists of length about 10^5."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1520508126, "post_id": 49170879, "comment_id": 85348642, "body": "How are you running it? Is it compiled with optimizations? (benchmarking with no optimizations is kind of meaningless since inlining is a big part of Haskell performance.) Are you using strict or lazy state? Strict gets much fewer allocations, though it&#39;s still slower than the naive version."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1520508792, "post_id": 49170879, "comment_id": 85349042, "body": "@Li-yaoXia Yes, it is compiled with optimizations. I used lazy state; the strict takes exactly 2/3 as much space, which is great \u2212 but the processor cycles spent actually doing work appear the same."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1520511879, "post_id": 49170879, "comment_id": 85350934, "body": "I was confused because I didn&#39;t get measurements in the same order of magnitude (but the same relative ratio). I get the 300MB number with lists of length 10^(6). Also, <code>[1, 1..]</code> is a constant list."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1520512423, "post_id": 49170879, "comment_id": 85351270, "body": "@Li-yaoXia Yes, it&#39;s constant, but I don&#39;t think it matters. I tried all kinds of lists. The proportion of values that are lower than the current minimum must be determining how often the state gets changed, but the impact of this seems to be minor: ascending and descending lists give very similar performance."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1520514597, "post_id": 49172866, "comment_id": 85352678, "body": "I went on and got rid of dlist, borrowing from <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.List.html#reverse\" rel=\"nofollow noreferrer\"><code>Prelude.reverse</code></a> instead. It still runs slower than the naive implementation by about a third. Even if I print the minimum. (I actually <code>evaluate . force</code> everything now.) Can you produce code that achieves speedup?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1520515437, "post_id": 49172866, "comment_id": 85353244, "body": "I updated the post with, hopefully, more precise measurements, and the new code. Kindly take a look."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1520516104, "post_id": 49172866, "comment_id": 85353704, "body": "You almost got it! The accumulator needed to just be a list. I updated my answer."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1520516909, "post_id": 49172866, "comment_id": 85354280, "body": "Oh! This is actually <b>faster</b> than the naive variant <b>by</b> almost <b>23% !</b>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 3, "creation_date": 1520517274, "post_id": 49172866, "comment_id": 85354559, "body": "BTW there is a library for single-pass folds: <a href=\"https://hackage.haskell.org/package/foldl\" rel=\"nofollow noreferrer\">foldl</a>."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 6, "last_activity_date": 1520516067, "last_edit_date": 1520516067, "creation_date": 1520511349, "answer_id": 49172866, "question_id": 49170879, "link": "https://stackoverflow.com/questions/49170879/performance-of-state-in-a-certain-case-is-slower-than-i-would-expect-why/49172866#49172866", "title": "Performance of State in a certain case is slower than I would expect. Why?", "body": "<p><strong>EDIT</strong>: <em>this refers to a previous version of the question where <code>reverseAndMinimum :: Ord a =&gt; [a] -&gt; State a ([a] -&gt; [a])</code>.</em></p>\n\n<p>In the naive version, <code>reverse</code> is efficient because it can build up the reversed list directly while traversing the list, and <code>minimum</code> is ignored because it's not needed.</p>\n\n<p>The \"one pass\" <code>reverseAndMinimum</code> allocates a difference list, that must be applied to yield an actual list which is then traversed again to find its last element.</p>\n\n<hr>\n\n<p>Replicating the accumulator technique used in <code>reverse</code>, the following code compiles to a tight loop to compute the reverse and minimum of a list in one pass.</p>\n\n<pre><code>import Control.Monad.State.Strict\n\nreverseAndMinimum :: Ord a =&gt; [a] -&gt; ([a], a)\nreverseAndMinimum [ ] = error \"Empty list!\"\nreverseAndMinimum (x:xs) = runState (reverseAndMinimum' xs [x]) x\n\nreverseAndMinimum' :: Ord a =&gt; [a] -&gt; [a] -&gt; State a [a]\nreverseAndMinimum' [ ] acc = return acc\nreverseAndMinimum' (x:xs) acc = do\n    smallestSoFar &lt;- get\n    when (x &lt; smallestSoFar) (put $ x)\n    reverseAndMinimum' xs (x : acc)\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "accepted_answer_id": 49172866, "answer_count": 1, "score": 1, "last_activity_date": 1520516067, "creation_date": 1520504969, "last_edit_date": 1520515399, "question_id": 49170879, "link": "https://stackoverflow.com/questions/49170879/performance-of-state-in-a-certain-case-is-slower-than-i-would-expect-why", "title": "Performance of State in a certain case is slower than I would expect. Why?", "body": "<p>Consider the function <code>reverseAndMinimum</code> (slightly modified from <a href=\"https://stackoverflow.com/a/49168835\">another answer nearby</a>):</p>\n\n<pre><code>import Control.Monad.State.Strict\n\nreverseAndMinimum' :: Ord a =&gt; [a] -&gt; State a [a] -&gt; State a [a]\nreverseAndMinimum' [ ] res = res\nreverseAndMinimum' (x:xs) res = do\n        smallestSoFar &lt;- get\n        when (x &lt; smallestSoFar) (put x)\n        reverseAndMinimum' xs ((x:) &lt;$&gt; res)\n\nreverseAndMinimum :: Ord a =&gt; [a] -&gt; ([a], a)\nreverseAndMinimum [ ] = error \"StateSort.reverseAndMinimum: This branch is unreachable.\"\nreverseAndMinimum xs@(x:_) = runState (reverseAndMinimum' xs (return [ ])) x\n</code></pre>\n\n<p>It traverses the argument only once; however, it is about 30% slower than a naive function that does it two times:</p>\n\n<pre><code>reverseAndMinimum_naive :: Ord a =&gt; [a] -&gt; ([a], a)\nreverseAndMinimum_naive xs = (reverse xs, minimum xs)\n</code></pre>\n\n<p>It also consumes about 57% as much memory.</p>\n\n<p>Here are the relevant extracts from a run with <code>+RTS -s</code>:</p>\n\n<p><em><code>reverseAndMinimum</code></em></p>\n\n<pre><code>     176,672,280 bytes allocated in the heap\n...\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.064s  (  0.063s elapsed)\n  GC      time    0.311s  (  0.311s elapsed)\n  EXIT    time    0.005s  (  0.005s elapsed)\n  Total   time    0.379s  (  0.380s elapsed)\n\n  %GC     time      82.0%  (82.0% elapsed)\n</code></pre>\n\n<p><em><code>reverseAndMinimum_naive</code></em></p>\n\n<pre><code>     112,058,976 bytes allocated in the heap\n...\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.041s  (  0.040s elapsed)\n  GC      time    0.245s  (  0.245s elapsed)\n  EXIT    time    0.005s  (  0.005s elapsed)\n  Total   time    0.291s  (  0.291s elapsed)\n\n  %GC     time      84.2%  (84.3% elapsed)\n</code></pre>\n\n<p>&nbsp;</p>\n\n<p>What's happening, how can I diagnose, is it possible to improve?</p>\n\n<p><strong>P.S.</strong> A handy <code>main</code> for running tests:</p>\n\n<pre><code>main = do\n    top &lt;- (read :: String -&gt; Int) . (!! 0) &lt;$&gt; getArgs\n    val &lt;- evaluate . force $ reverseAndMinimum (take top [top, top - 1.. 1 :: Int])\n    print $ (\\x -&gt; (last . fst $ x, snd x)) $ val\n</code></pre>\n"}, {"tags": ["haskell", "cryptography", "elliptic-curve"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1520516368, "post_id": 49170105, "comment_id": 85353904, "body": "<code>Point</code> is a type family and the instance for <code>Curve_Edwards25519</code> is <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/src/Crypto-ECC.html#line-240\" rel=\"nofollow noreferrer\">here</a>. <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/Crypto-ECC-Edwards25519.html#t:Point\" rel=\"nofollow noreferrer\">This</a> is the type you use as the public key."}], "owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1521488648, "creation_date": 1520502664, "last_edit_date": 1520503118, "question_id": 49170105, "link": "https://stackoverflow.com/questions/49170105/curve-edwards25519-in-crypto-pubkey-ecies", "title": "Curve_Edwards25519 in Crypto.PubKey.ECIES", "body": "<p>I am trying to use  <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/Crypto-PubKey-ECIES.html\" rel=\"nofollow noreferrer\">this</a> library, when i use <code>Curve_X25519</code> form <a href=\"https://hackage.haskell.org/package/cryptonite-0.21/docs/Crypto-ECC.html\" rel=\"nofollow noreferrer\">this</a>  it works fine. </p>\n\n<p>Here is my code</p>\n\n<pre><code>import Crypto.PubKey.ECIES\nimport Crypto.ECC\nimport Crypto.Error\nimport Crypto.PubKey.Curve25519\nimport Data.Proxy\nimport Data.ByteString.Char8\n\n\ncurve = Proxy :: Proxy Curve_X25519\n\nrandomString = \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"\n\nrandomSeed = Data.ByteString.Char8.pack randomString\n\n\nreceiversSK = Crypto.PubKey.Curve25519.secretKey randomSeed\nreceiversPK = Crypto.PubKey.Curve25519.toPublic (throwCryptoError receiversSK)\n\n\nderiveEncrypt curve receiversPK\n</code></pre>\n\n<p>but when i use <code>Curve_Edwards25519</code> from same library </p>\n\n<p>here is my code</p>\n\n<pre><code>import Crypto.PubKey.ECIES\nimport Crypto.ECC\nimport Crypto.Error\nimport Crypto.PubKey.Ed25519\nimport Data.Proxy\nimport Data.ByteString.Char8\n\n\ncurve = Proxy :: Proxy Curve_Edwards25519\n\nrandomString = \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"\n\nrandomSeed = Data.ByteString.Char8.pack randomString\n\n\nreceiversSK = Crypto.PubKey.Ed25519.secretKey randomSeed\nreceiversPK = Crypto.PubKey.Ed25519.toPublic (throwCryptoError receiversSK)\n\n\nderiveEncrypt curve receiversPK\n</code></pre>\n\n<p>it gives an error in ghci </p>\n\n<pre><code>&lt;interactive&gt;:21:21: error:\n    \u2022 Couldn't match type \u2018PublicKey\u2019\n                     with \u2018Crypto.ECC.Edwards25519.Point\u2019\n      Expected type: Point Curve_Edwards25519\n        Actual type: PublicKey\n    \u2022 In the second argument of \u2018deriveEncrypt\u2019, namely \u2018receiversPK\u2019\n      In the expression: deriveEncrypt curve receiversPK\n      In an equation for \u2018it\u2019: it = deriveEncrypt curve receiversPK\n</code></pre>\n\n<p>can someone help out how to convert <code>PublicKey</code> to <code>Crypto.ECC.Edwards25519.Point</code></p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 6, "last_activity_date": 1520500906, "creation_date": 1520500906, "answer_id": 49169486, "question_id": 49169254, "link": "https://stackoverflow.com/questions/49169254/how-do-i-determine-what-os-dependency-packages-are-required-for-a-haskell-execut/49169486#49169486", "title": "How do I determine what OS dependency packages are required for a Haskell executable?", "body": "<p>This is actually not specific to Haskell, but rather to the way Linux dynamically links shared libraries. You can use <code>ldd &lt;file&gt;</code>:</p>\n\n<pre><code>% ldd ./StateSort\n    linux-vdso.so.1 (0x00007ffd29385000)\n    libm.so.6 =&gt; /usr/lib/libm.so.6 (0x00007fd986bd1000)\n    libgmp.so.10 =&gt; /usr/lib/libgmp.so.10 (0x00007fd98693e000)\n    librt.so.1 =&gt; /usr/lib/librt.so.1 (0x00007fd986736000)\n    libdl.so.2 =&gt; /usr/lib/libdl.so.2 (0x00007fd986532000)\n    libpthread.so.0 =&gt; /usr/lib/libpthread.so.0 (0x00007fd986314000)\n    libc.so.6 =&gt; /usr/lib/libc.so.6 (0x00007fd985f5c000)\n    /lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007fd986f1d000)\n</code></pre>\n\n<p>If there are missing libraries, you will notice them right away: the right hand side with the path to the <code>so</code> file will be absent.</p>\n\n<p>You will then have to refer to your Linux distro's package management system to find out what package may contain the desired <code>so</code> file. For Ubuntu you would use <code>apt-file</code>, for ArchLinux \u2212 <code>pkgfile</code>, and so on.</p>\n\n<p>I must warn you that <code>ldd</code> actually executes some of the code found in a file, so a malicious program may take over and wreak havoc. If you want to dissect an executable of unknown origin this way, you must do so in a disposable forensic containment. As I understand, this is not applicable in the case at hand, but nevertheless I must warn you.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 49169486, "answer_count": 1, "score": 4, "last_activity_date": 1549236252, "creation_date": 1520500025, "last_edit_date": 1549236252, "question_id": 49169254, "link": "https://stackoverflow.com/questions/49169254/how-do-i-determine-what-os-dependency-packages-are-required-for-a-haskell-execut", "title": "How do I determine what OS dependency packages are required for a Haskell executable?", "body": "<p>I've just compiled an executable with <code>stack build</code> and then just copying over the executable to a different machine, however running the application results in: </p>\n\n<pre><code>./app: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory\n</code></pre>\n\n<p>I'm guessing I need to install some packages from the appropriate Linux distro's packages - but is there more efficient way then googling for each error that comes up and trying to identify the package?</p>\n\n<p>I've tried running executable within some docker images:\n<code>fpco/haskell-scratch</code>, <code>debian:stretch-slim</code> which all result in the same behaviour:</p>\n\n<pre><code>sudo docker run --rm -it -v $(pwd):/abcxyz fpco/haskell-scratch sh\n# /abcxyz/app\n/abcxyz/app: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory\n</code></pre>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>With the debian image I installed openssl:</p>\n\n<p><code>apt-get install openssl</code></p>\n\n<p>New error:</p>\n\n<p>/abcxyz/app: error while loading shared libraries: libgmp.so.10: cannot open shared object file: No such file or directory</p>\n\n<p><code>apt-get install libgmp-dev</code></p>\n\n<p>And it works...</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 0, "creation_date": 1520535954, "post_id": 49168127, "comment_id": 85366828, "body": "No way around stack huh? Seems like such a simple thing though for cabal, I wonder if I can get some more mileage out of it before I make the switch"}, {"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 0, "creation_date": 1520568075, "post_id": 49168127, "comment_id": 85378255, "body": "Sorry, I actually switched to hpack and I still can&#39;t get the desired behavior. I need to both expose some library and add the exposes modules as dependencies to an executable. This solution doesn&#39;t declare the library part."}], "tags": [], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "is_accepted": false, "score": 0, "last_activity_date": 1520496030, "creation_date": 1520496030, "answer_id": 49168127, "question_id": 49167726, "link": "https://stackoverflow.com/questions/49167726/cabal-library-cannot-import-exposed-modules/49168127#49168127", "title": "Cabal library cannot import exposed modules", "body": "<p>You'll have to add the library to the dependencies of the executable. Here's the hpack version of your cabal file, I can never remember the cabal syntax:</p>\n\n<pre><code>name: foo\nversion: 0.1.0\ndependencies:\n  - base\n\nsource-dirs: lib\n\n# no need for exponsed-modules, hpack does that for you\n\nexecutable:\n  main: Main.hs\n  source-dirs: src\n  dependencies:\n    - base\n    - foo\n</code></pre>\n\n<p>Or just use <code>stack new</code>, and you get a working project.</p>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1521140033, "creation_date": 1521140033, "answer_id": 49307195, "question_id": 49167726, "link": "https://stackoverflow.com/questions/49167726/cabal-library-cannot-import-exposed-modules/49307195#49307195", "title": "Cabal library cannot import exposed modules", "body": "<p>Add the line <code>build-depends:       foo</code> to your executable stanza to indicate the executable depends on the library you're defining.</p>\n"}], "owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 1, "accepted_answer_id": 49307195, "answer_count": 2, "score": 1, "last_activity_date": 1521140033, "creation_date": 1520494519, "last_edit_date": 1520495670, "question_id": 49167726, "link": "https://stackoverflow.com/questions/49167726/cabal-library-cannot-import-exposed-modules", "title": "Cabal library cannot import exposed modules", "body": "<p>I have my foo.cabal file looking like this:</p>\n\n<pre><code>library\n  exposed-modules:\n      Foo.Bar,\n      Foo.Something\n  hs-source-dirs:      lib\n  default-language:    Haskell2010\n\nexecutable foobar\n  main-is:             Main.hs\n  other-modules:\n      Utils,  -- Local module in ./src\n      Foo.Bar\n\n  hs-source-dirs:      src\n  default-language:    Haskell2010\n</code></pre>\n\n<p>According to the sample code here: \n<a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#example-a-package-containing-a-library-and-executable-programs\" rel=\"nofollow noreferrer\">https://www.haskell.org/cabal/users-guide/developing-packages.html#example-a-package-containing-a-library-and-executable-programs</a></p>\n\n<p>And I get the following error: </p>\n\n<pre><code>$ cabal build\nResolving dependencies...\nConfiguring foobar-0.1.0.0...\nPreprocessing executable 'foobar' for foobar-0.1.0.0..\ncabal: can't find source for Foo/Bar in src, dist/build/foobar/autogen,\ndist/build/global-autogen\n</code></pre>\n"}, {"tags": ["string", "haskell", "split", "char", "chunks"], "comments": [{"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520488532, "post_id": 49166299, "comment_id": 85337930, "body": "I think you missed the <b>base case</b> of the function."}, {"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "reply_to_user": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520488819, "post_id": 49166299, "comment_id": 85338010, "body": "It&#39;s because it&#39;s a recursive function right? I just need to know how to make it stop once the string has been grouped into chunks"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1520488900, "post_id": 49166299, "comment_id": 85338054, "body": "Compile with warnings, it will show you your error (see the unused variable)."}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 1, "creation_date": 1520488970, "post_id": 49166299, "comment_id": 85338088, "body": "@MikeNoelHiggs Yes, it is. Anyway, you should give us an example input and the expected output."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1520489045, "post_id": 49166299, "comment_id": 85338125, "body": "IOW <code>x</code> should be <code>y</code>."}, {"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520490648, "post_id": 49166299, "comment_id": 85338679, "body": "I don&#39;t know what you mean by this ^"}, {"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520490720, "post_id": 49166299, "comment_id": 85338704, "body": "expected input is <code>splitList 2 &quot;HelloWorld&quot;&#39;</code> expect output is <code>[He, ll, oW, or, ld]</code> however it will just group He infinity."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520494147, "post_id": 49166299, "comment_id": 85340284, "body": "@MikeNoelHiggs: where do you use <code>y</code> in the <code>in ...</code> part?"}, {"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520494463, "post_id": 49166299, "comment_id": 85340448, "body": "y is the string, x is the number to group by"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1520494499, "post_id": 49166299, "comment_id": 85340465, "body": "@MikeNoelHiggs: but you write <code>splitList i x</code>."}, {"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520494647, "post_id": 49166299, "comment_id": 85340550, "body": "how would you write it?"}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520494897, "post_id": 49167748, "comment_id": 85340666, "body": "Yes, would you be able to fix this for me? I&#39;m just getting really confused where I should use the tail or how to update x after a pass"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520495373, "post_id": 49167748, "comment_id": 85340904, "body": "@MikeNoelHiggs From your recent history of questions, it looks like you&#39;re learning Haskell. That&#39;s great! You learn best by doing exercises yourself, so while I&#39;m happy to help making things clearer, and to teach you how to solve problems yourself, I don&#39;t think you&#39;ll learn anything if I just give you the solution. You are, however, welcome to ask another question if you&#39;re stuck on other parts of the problem."}, {"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520495872, "post_id": 49167748, "comment_id": 85341155, "body": "In that case can you direct me to a slimier question? from what I understand the tail (y) isn&#39;t being used as it&#39;s just calling x (head) over and over, however I don&#39;t know how to step over to the tail after x has been grouped :/"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 1, "creation_date": 1520496071, "post_id": 49167748, "comment_id": 85341271, "body": "@MikeNoelHiggs: <code>y</code> is <i>not</i> the tail. Note that we pattern match with a tuple (<code>(x, y)</code>), not a list cons <code>(x : y)</code>."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 0, "creation_date": 1520496332, "post_id": 49167748, "comment_id": 85341408, "body": "@MikeNoelHiggs Indeed, <code>y</code> isn&#39;t being used. Why not? I assume that you wrote the <code>splitList</code> code, so you ought to be in a better position to answer why you chose to do that than I am."}, {"owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "edited": false, "score": 2, "creation_date": 1520496692, "post_id": 49167748, "comment_id": 85341573, "body": "solved   <code>splitList i &quot;&quot;  = [] splitList i str = let (x, y) = splitAt i str                        in x : splitList i y</code>  Basically I was chopping the list at x after each recursion rather than y (being the rest of the string) is this correct?"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1520494590, "creation_date": 1520494590, "answer_id": 49167748, "question_id": 49166299, "link": "https://stackoverflow.com/questions/49166299/haskell-splitting-a-list-into-specified-chunks-causing-infinite-loop/49167748#49167748", "title": "Haskell, splitting a list into specified chunks causing infinite loop", "body": "<p>Try to step through the implementation in GHCi:</p>\n\n<pre><code>Prelude&gt; i = 2\nPrelude&gt; str = \"HelloWorld\"\nPrelude&gt; let (x, y) = splitAt i str\nPrelude&gt; x\n\"He\"\nPrelude&gt; y\n\"lloWorld\"\n</code></pre>\n\n<p>In the next pass, <code>splitList</code> calls itself recursively with <code>i</code> and <code>x</code>, where <code>x</code> is <code>\"He\"</code>:</p>\n\n<pre><code>Prelude&gt; str = x\nPrelude&gt; let (x, y) = splitAt i str\nPrelude&gt; x\n\"He\"\nPrelude&gt; y\n\"\"\n</code></pre>\n\n<p>In the third pass, <code>splitList</code> again calls itself recursively with <code>i</code> and <code>x</code>. Notice that <code>x</code> hasn't changed between the first and the second call. Do you see the infinite recursion now?</p>\n"}], "owner": {"reputation": 67, "user_id": 4729595, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153211906528464/picture?type=large", "display_name": "Mike Noel Higgs", "link": "https://stackoverflow.com/users/4729595/mike-noel-higgs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520494640, "creation_date": 1520488255, "last_edit_date": 1520494640, "question_id": 49166299, "link": "https://stackoverflow.com/questions/49166299/haskell-splitting-a-list-into-specified-chunks-causing-infinite-loop", "title": "Haskell, splitting a list into specified chunks causing infinite loop", "body": "<p>How can I stop Haskell from infinity performing the function?</p>\n\n<pre><code>splitList i \"\"  = []\nsplitList i str = let (x, y) = splitAt i str\n                  in x : splitList i x\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1520491749, "post_id": 49166131, "comment_id": 85339140, "body": "Have you tried setting the buffer mode to <code>LineBuffering</code>, or are you just assuming that&#39;s the default? (It&#39;s more complicated than that. Specifically, the default is <code>LineBuffering</code> for tty devices and <code>BlockBuffering</code> otherwise.)"}, {"owner": {"reputation": 4625, "user_id": 1861521, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dda04c7abdfe8b05f4a258b7a01900a6?s=128&d=identicon&r=PG", "display_name": "jcarpenter2", "link": "https://stackoverflow.com/users/1861521/jcarpenter2"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1520493853, "post_id": 49166131, "comment_id": 85340143, "body": "@Carl When I add at the beginning of the program <code>buffering &lt;- hGetBuffering stdout</code> and <code>putStrLn (show buffering)</code> the output is <code>LineBuffering</code>, and from that I assumed it was the default.  However, if I run <code>hSetBuffering stdout LineBuffering</code> I actually get the same output as if I run <code>hSetBuffering stdout NoBuffering</code> -- so apparently it was <i>not</i> the default, and <code>hGetBuffering</code> actually returned the wrong value."}, {"owner": {"reputation": 4625, "user_id": 1861521, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dda04c7abdfe8b05f4a258b7a01900a6?s=128&d=identicon&r=PG", "display_name": "jcarpenter2", "link": "https://stackoverflow.com/users/1861521/jcarpenter2"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1520493994, "post_id": 49166131, "comment_id": 85340212, "body": "Or maybe it&#39;s <code>LineBuffering</code> when I don&#39;t run it as a background task, and <code>BlockBuffering</code> when I do run it as a background task."}, {"owner": {"reputation": 4625, "user_id": 1861521, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dda04c7abdfe8b05f4a258b7a01900a6?s=128&d=identicon&r=PG", "display_name": "jcarpenter2", "link": "https://stackoverflow.com/users/1861521/jcarpenter2"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1520494127, "post_id": 49166131, "comment_id": 85340269, "body": "Confirmed, that is what&#39;s happening."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1520501910, "post_id": 49166131, "comment_id": 85344772, "body": "@jcarpenter2 Maybe you could answer your own question, so we have an answer here?"}, {"owner": {"reputation": 4625, "user_id": 1861521, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dda04c7abdfe8b05f4a258b7a01900a6?s=128&d=identicon&r=PG", "display_name": "jcarpenter2", "link": "https://stackoverflow.com/users/1861521/jcarpenter2"}, "edited": false, "score": 0, "creation_date": 1520505122, "post_id": 49166131, "comment_id": 85346884, "body": "If you answer I&#39;ll accept it, then we&#39;ll both get some rep."}], "answers": [{"tags": [], "owner": {"reputation": 4625, "user_id": 1861521, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dda04c7abdfe8b05f4a258b7a01900a6?s=128&d=identicon&r=PG", "display_name": "jcarpenter2", "link": "https://stackoverflow.com/users/1861521/jcarpenter2"}, "is_accepted": true, "score": 0, "last_activity_date": 1520635462, "creation_date": 1520635462, "answer_id": 49203293, "question_id": 49166131, "link": "https://stackoverflow.com/questions/49166131/haskell-program-run-in-background-does-not-redirect-output-to-file-unless-buffer/49203293#49203293", "title": "Haskell program run in background does not redirect output to file unless buffer mode is NoBuffering", "body": "<p>See comments on question.  Adding this answer mainly just so that the question is marked as \"Answered\".</p>\n\n<p>It was <em>not</em> necessary to set the buffering mode strictly to <code>NoBuffering</code> -- either that or <code>LineBuffering</code> causes logging output to be created as expected.</p>\n\n<p>The problem was that the default was <code>BlockBuffering</code>, not <code>LineBuffering</code>, when the program was run in background mode.  I did not think that running the program in background mode would affect the default setting for stdout buffering.</p>\n"}], "owner": {"reputation": 4625, "user_id": 1861521, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dda04c7abdfe8b05f4a258b7a01900a6?s=128&d=identicon&r=PG", "display_name": "jcarpenter2", "link": "https://stackoverflow.com/users/1861521/jcarpenter2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 2, "accepted_answer_id": 49203293, "answer_count": 1, "score": 4, "last_activity_date": 1520635462, "creation_date": 1520487389, "question_id": 49166131, "link": "https://stackoverflow.com/questions/49166131/haskell-program-run-in-background-does-not-redirect-output-to-file-unless-buffer", "title": "Haskell program run in background does not redirect output to file unless buffer mode is NoBuffering", "body": "<p>I've got a Haskell program that logs some data periodically.  When I run it as a background process, my logging statements are not redirected to my log file unless I change the buffering mode to <code>NoBuffering</code>.  I do not understand why the default setting of <code>LineBuffering</code> does not work.</p>\n\n<p>Here is my test program:</p>\n\n<pre><code>import Control.Concurrent (forkIO, threadDelay)\nimport Control.Monad (forever)\nimport System.IO (BufferMode(..), hSetBuffering, stdout)\n\nmain :: IO ()\nmain = forever $ do\n  -- hSetBuffering stdout NoBuffering\n  threadDelay $ 1000 * 1000\n  putStrLn \"log\"\n</code></pre>\n\n<p>When I run this program normally in the console, I get the expected output:</p>\n\n<pre><code>$ ./Main\nlog\nlog\nlog\n</code></pre>\n\n<p>Outputting \"log\" once per second.  When I redirect it to a file, it also works as expected:</p>\n\n<pre><code>$ ./Main &gt;log\n^C\n$ cat log\nlog\nlog\nlog\n</code></pre>\n\n<p>However, when I run it as a background process:</p>\n\n<pre><code>$ ./Main &gt;log &amp;\n$ cat log\n</code></pre>\n\n<p>then there is nothing written to the log file, unless I uncomment the line that sets stdout buffering to <code>NoBuffering</code>.</p>\n\n<p>I used the <code>hGetBuffering</code> function to determine the default buffering setting, and it is <code>LineBuffering</code>.  Considering that each \"log\" statement is indeed on a different line, why do I need to set the buffering mode to <code>NoBuffering</code> in order for the logs to be written to the log file?  I.E. Why does the buffer not flush at each newline when the buffer mode is set to <code>LineBuffering</code>?</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1520479508, "post_id": 49164810, "comment_id": 85335142, "body": "Do you have an actual question though?"}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520479848, "post_id": 49164810, "comment_id": 85335206, "body": "What is your question actually?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520479899, "post_id": 49164810, "comment_id": 85335212, "body": "Why doesn&#39;t my code compile.  I will post the error."}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520480124, "post_id": 49164810, "comment_id": 85335259, "body": "Also, show us how you pass the argument (value) to the function."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1520480292, "post_id": 49164810, "comment_id": 85335297, "body": "<code>return</code> takes one argument."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520480367, "post_id": 49164810, "comment_id": 85335314, "body": "So what do you suggest &quot;returning &quot; ?"}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520480527, "post_id": 49164810, "comment_id": 85335351, "body": "How about <code>return (s a)</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520480594, "post_id": 49164810, "comment_id": 85335372, "body": "That does not work either.  I got -- Couldn&#39;t match expected type \u2018a -&gt; [a]\u2019 with actual type \u2018[a]\u2019"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520480637, "post_id": 49164810, "comment_id": 85335386, "body": "I am thinking some kind of helper function is needed but I am at a mental block right now."}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520480652, "post_id": 49164810, "comment_id": 85335391, "body": "Then, try <code>return (s [a])</code>."}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520480719, "post_id": 49164810, "comment_id": 85335414, "body": "I think it should be <code>return (a s)</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520480855, "post_id": 49164810, "comment_id": 85335448, "body": "None of those work lol similar error"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 2, "creation_date": 1520481017, "post_id": 49164810, "comment_id": 85335493, "body": "@WisnuAdiNurcahyo These won&#39;t work. Neither <code>s</code> nor <code>a</code> are functions. The OP is probably looking for, among other things, the <code>set</code> function."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520481085, "post_id": 49164810, "comment_id": 85335522, "body": "please tell me more about this &quot;set&quot; you speak of"}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520481385, "post_id": 49164810, "comment_id": 85335607, "body": "@duploade Okay."}, {"owner": {"reputation": 824, "user_id": 6914498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/025023af1858a74ebe1cb8c9b21f47ab?s=128&d=identicon&r=PG", "display_name": "wisn", "link": "https://stackoverflow.com/users/6914498/wisn"}, "edited": false, "score": 0, "creation_date": 1520481425, "post_id": 49164810, "comment_id": 85335617, "body": "@loneWolf is your State type like this? <code>newtype State s a = State { runState :: (s -&gt; (a,s)) }</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520481579, "post_id": 49164810, "comment_id": 85335658, "body": "Yes, what ever the &quot;default&quot; is, that is what I use"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1520481593, "post_id": 49164810, "comment_id": 85335661, "body": "@loneWolf There was a typo in my comment above: I meant <code>put</code>, not <code>set</code>. <code>put</code> is a straightforward way to change the state when working with the <code>State</code> monad. See, for instance, <a href=\"https://stackoverflow.com/q/36585863/2751851\"><i>State Monad and &#39;put&#39; function in Haskell</i></a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520481938, "post_id": 49164810, "comment_id": 85335747, "body": "&quot;I can&#39;t find an other material on this either&quot; -- <a href=\"https://stackoverflow.com/q/33194267/2751851\"><i>Haskell State Monad</i></a>; <a href=\"https://stackoverflow.com/q/31475770/2751851\"><i>Why must we use state monad instead of passing state directly?</i></a>; <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads/State\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Understanding_monads/State</a> ; <a href=\"http://learnyouahaskell.com/for-a-few-monads-more#state\" rel=\"nofollow noreferrer\">learnyouahaskell.com/for-a-few-monads-more#state</a>"}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1520698782, "post_id": 49164810, "comment_id": 85426926, "body": "Another nice tutorial for the State Monad is <a href=\"https://wiki.haskell.org/Simple_StateT_use\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Simple_StateT_use</a>"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1520493796, "creation_date": 1520493796, "answer_id": 49167532, "question_id": 49164810, "link": "https://stackoverflow.com/questions/49164810/haskell-state-as-function-type/49167532#49167532", "title": "Haskell State as function type", "body": "<p>Since you're using a <code>do</code> block, I assume that you want to use <code>State</code> as the <code>Monad</code> it is. That's fine, but I'd suggest, then, to make the list of values (<code>[a]</code>) the state, and the single, minimum value the 'return value'.</p>\n\n<p>This means that you can simplify the type of your function to <code>myFunct :: Ord a =&gt; State [a] a</code>. <code>[a]</code> is the type of the state, and <code>a</code> is the type of the return value.</p>\n\n<p>Notice that there's no explicit 'input value'. Inside the <code>State</code> monad, the state is an implicit context that's always there.</p>\n\n<p>You can now rewrite the computation like this:</p>\n\n<pre><code>myFunct :: Ord a =&gt; State [a] a\nmyFunct = do\n  t &lt;- get\n  let s = reverse t\n  put s\n  let a = minimum t\n  return a\n</code></pre>\n\n<p>You can write the computation more succinctly, but I chose to write it out explicitly to make it clearer what's going on. <code>get</code> retrieves the current value of the implicit state, and <code>put</code> overwrites the state. See <a href=\"https://hackage.haskell.org/package/mtl/docs/Control-Monad-State-Lazy.html\" rel=\"nofollow noreferrer\">the documentation</a> for more details.</p>\n\n<p>You can run it like this:</p>\n\n<pre><code>*Q49164810&gt; runState myFunct [42, 1337]\n(42,[1337,42])\n*Q49164810&gt; runState myFunct [42, 1337, 0]\n(0,[0,1337,42])\n*Q49164810&gt; evalState myFunct [42, 1337, 0]\n0\n*Q49164810&gt; execState myFunct [42, 1337, 0]\n[0,1337,42]\n</code></pre>\n\n<p><code>runState</code> takes an initial state, runs the <code>myFunct</code> computation, and returns both return value and final state. <code>evalState</code> works the same way, but returns only the return value, while <code>exacState</code> only returns the final state.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "edited": false, "score": 0, "creation_date": 1520524457, "post_id": 49168835, "comment_id": 85359746, "body": "Thank you for taking the time to write this.  I appreciate it a lot. It really did help."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 2, "last_activity_date": 1520517377, "last_edit_date": 1520517377, "creation_date": 1520498515, "answer_id": 49168835, "question_id": 49164810, "link": "https://stackoverflow.com/questions/49164810/haskell-state-as-function-type/49168835#49168835", "title": "Haskell State as function type", "body": "<p>You're in luck: <code>State</code> is the easiest monad to understand.</p>\n\n<p>Please do not get discouraged by the fact that your function does not need <code>State</code> at all, insofar as you use <code>reverse</code> and <code>minimum</code> from the standard library.</p>\n\n<pre><code>myFunct' :: Ord a =&gt; [a] -&gt; ([a], a)\nmyFunct' xs = (reverse xs, minimum xs)\n</code></pre>\n\n<p>(It would run like this:)</p>\n\n<pre><code>\u03bb myFunct' [1,2,3]\n([3,2,1],1)\n</code></pre>\n\n<p>Notice though that, in order for you to apply both <code>reverse</code> and <code>minimum</code> to a list, you will need to traverse it two times. This is when <code>State</code> may get handy: using it, you can only traverse the list once, thus, hopefully, gaining some speedup. Read on to find out how.</p>\n\n<p>So, <strong><code>State</code> is a function</strong> of a special kind: the thing you give it (also called \"state\") is kept in a magic box where you can observe it, or replace it with another thing of the same type at any time. If you have experience with imperative languages, you may find it easy to think of <code>State</code> as an imperative procedure and \"state\" as a local variable. Let us review the tools that you may use to construct and execute a <code>State</code>:</p>\n\n<ul>\n<li><p>You may <strong>observe</strong> the thing in the box with the <em>(inappropriately named)</em> function <code>get</code>. Notice that this does not change the state in any way \u2212 what you obtain is merely an immutable copy of its current value; the thing stays in the box.</p>\n\n<p>You would usually associate your observation with a name, then use it as an ordinary value \u2212 for example, pass to a pure function:</p>\n\n<pre><code>stateExample1 :: State Integer Integer\nstateExample1 = do\n    x &lt;- get  -- This is where we observe state and associate it with the name \"x\".\n    return $ x * 2  -- (* 2) is an example of a pure function.\n</code></pre>\n\n<p>&nbsp;</p>\n\n<pre><code>\u03bb runState stateExample1 10\n(20,10)  -- The first is the return value, the second is the (unchanged) state.\n</code></pre></li>\n<li><p>You may <strong>replace</strong> the thing in the box with another suitably typed thing; use the function <code>put</code>:</p>\n\n<pre><code>stateExample2 :: State Integer Integer\nstateExample2 = do\n    x &lt;- get\n    put $ x * 2  -- You may think of it as though it were \"x = x * 2\" \n                 -- in an imperative language.\n    return x\n</code></pre>\n\n<p>&nbsp;</p>\n\n<pre><code>\u03bb runState stateExample2 10\n(10,20)  -- Now we have changed the state, and return its initial value for reference.\n</code></pre>\n\n<p>Notice that, though we changed the state, our observation of it (that we named \"x\") still has the same value.</p></li>\n<li><p>You may <strong>run</strong> the <code>State</code> function, giving it an argument (we'd call it \"<em>initial state</em>\"):</p>\n\n<pre><code>y = runState stateExample1 10\n</code></pre>\n\n<p>It is the same as:</p>\n\n<pre><code>y = stateExample1(10);\n</code></pre>\n\n<p>\u2212 in an imperative language with C-like syntax, except that you obtain both the return value and the <em>final state</em>.</p></li>\n</ul>\n\n<p>Armed with this knowledge, we can now rewrite your proposed <code>myFunct</code> like this:</p>\n\n<pre><code>myFunct :: Ord a =&gt; [a] -&gt; State (Maybe a) [a]\nmyFunct [ ] = return [ ]\nmyFunct t = do\n        let s = reverse t\n        let a = minimum t\n        put (Just a)\n        return s\n</code></pre>\n\n<p>&nbsp;</p>\n\n<pre><code>\u03bb runState (myFunct [1,2,3]) (Just (-100))\n([3,2,1],Just 1)\n\u03bb runState (myFunct []) (Just (-100))\n([],Just (-100))\n</code></pre>\n\n<p>If we regard <code>State</code> as an imperative procedure, then the reversed list is what it returns, while the minimum of the list is what its final state would be. As the list may be empty, we have provisioned an optional default value for the minimum. This makes the function <em>total</em>, which is considered good Haskell style:</p>\n\n<pre><code>\u03bb myFunct' []\n([],*** Exception: Prelude.minimum: empty list\n\u03bb runState (myFunct []) Nothing\n([],Nothing)\n</code></pre>\n\n<p>&nbsp;</p>\n\n<p>Now, let us reap the benefit of <code>State</code> by writing a function that returns both the minimum and the reverse of a list in one pass:</p>\n\n<pre><code>reverseAndMinimum :: Ord a =&gt; [a] -&gt; ([a], Maybe a)\nreverseAndMinimum xs = runState (reverseAndMinimum' xs [ ]) Nothing\n\nreverseAndMinimum' :: Ord a =&gt; [a] -&gt; [a] -&gt; State (Maybe a) [a]\nreverseAndMinimum' [ ] res = return res\nreverseAndMinimum' (x:xs) res = do\n        smallestSoFar &lt;- get\n        case smallestSoFar of\n            Nothing -&gt; put $ Just x\n            Just y  -&gt; when (x &lt; y) (put $ Just x)\n        reverseAndMinimum' xs (x: res)\n</code></pre>\n\n<ul>\n<li><p>First off, this is an iterative algorithm that thus needs a starting value for the minimum. We hide this fact in <code>reverseAndMinimum'</code>, supplying <code>Nothing</code> for the starting value.</p></li>\n<li><p>The logic of the reverse part I borrowed from the modern <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.List.html#reverse\" rel=\"nofollow noreferrer\"><code>Prelude.reverse</code></a>. We simply move elements from the first argument <code>xs</code> to the second argument <code>res</code>, until <code>xs</code> is empty.</p></li>\n<li><p>This is the part that finds the smaller of the current <code>x</code> and the value stored in the state box. I hope you'll find it readable.</p>\n\n<pre><code>    case smallestSoFar of\n        Nothing -&gt; put $ Just x\n        Just y  -&gt; when (x &lt; y) (put $ Just x)\n</code></pre></li>\n<li><p>This is the part that does the recursion:</p>\n\n<pre><code>    reverseAndMinimum' xs (x: res)\n</code></pre>\n\n<p>It applies <code>reverseAndMinimum'</code> again, but to a strictly smaller list <code>xs</code>; the monadic wiring automagically transfers the box with the current minimum down the line.</p></li>\n</ul>\n\n<p>Let us trace the execution of a call to <code>reverseAndMinimum'</code>. Suppose we say:</p>\n\n<pre><code>runState (reverseAndMinimum' [1,2,3] [ ]) Nothing\n</code></pre>\n\n<p>What will happen?</p>\n\n<ol>\n<li>The smaller of <code>1</code> and <code>Nothing</code> is <code>1</code>. So, the <code>Nothing</code> in the box will be replaced by <code>Just 1</code>.</li>\n<li><p>The <code>State</code> will be called again, as though we called it with a code like this:</p>\n\n<pre><code>runState (reverseAndMinimum' [2,3] [1]) (Just 1)\n</code></pre></li>\n</ol>\n\n<p>And so on, until the parameter becomes an empty list, by which time the box will surely contain the smallest number.</p>\n\n<p>This version actually performs <strong>faster</strong> than <code>myFunct'</code> <strong>by</strong> about <strong>22%</strong>, and uses somewhat less memory as well. (Though, as you may check in edit history, it took some effort to get to it.)</p>\n\n<p>That's it. I hope it helps!</p>\n\n<p>Special thanks to Li-Yao Xia who <a href=\"https://stackoverflow.com/a/49172866\">helped me</a> devise the code for <code>reverseAndMinimum</code> that actually beats <code>myFunct'</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5651011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 49168835, "answer_count": 2, "score": 1, "last_activity_date": 1520517377, "creation_date": 1520479143, "last_edit_date": 1520493834, "question_id": 49164810, "link": "https://stackoverflow.com/questions/49164810/haskell-state-as-function-type", "title": "Haskell State as function type", "body": "<p>I am having a hard time understanding this tutorial: <a href=\"https://acm.wustl.edu/functional/state-monad.php\" rel=\"nofollow noreferrer\">https://acm.wustl.edu/functional/state-monad.php</a></p>\n\n<p>I am creating my own function that reverses a list and returns a <code>State</code> with the lowest element and the reverse of the list.  I am very new to Haskell as well.  Here is my code:</p>\n\n<pre><code>myFunct :: Ord a =&gt; [a] -&gt; State a [a]\nmyFunct t = do\n        let s = reverse t\n        let a = minimum t\n        return s a\n</code></pre>\n\n<p>I can't find an other material on this either. This is the error I am getting.</p>\n\n<pre><code> Couldn't match type \u2018[a]\u2019\n                 with \u2018StateT a Data.Functor.Identity.Identity [a]\u2019\n  Expected type: a -&gt; State a [a]\n    Actual type: a -&gt; [a]\n\u2022 The function \u2018return\u2019 is applied to two arguments,\n  its type is \u2018a0 -&gt; m0 a0\u2019,\n  it is specialized to \u2018[a] -&gt; a -&gt; [a]\u2019\n  In a stmt of a 'do' block: return s a\n  In the expression:\n    do let s = reverse t\n       let a = minimum t\n       return s a\n</code></pre>\n"}]