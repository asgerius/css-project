[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1532554146, "post_id": 51527866, "comment_id": 90024462, "body": "What have you tried? What happened?"}, {"owner": {"reputation": 517, "user_id": 7312355, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57ce505140904fd60f4e0d002b9a842e?s=128&d=identicon&r=PG&f=1", "display_name": "599644", "link": "https://stackoverflow.com/users/7312355/599644"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1532555493, "post_id": 51527866, "comment_id": 90024931, "body": "It compiles and seems to be working, but that&#39;s not the point. I want to be sure I am doing it the recommended/correct way and not creating problems that I don&#39;t understand or see as I am pretty new in Haskell"}], "owner": {"reputation": 517, "user_id": 7312355, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57ce505140904fd60f4e0d002b9a842e?s=128&d=identicon&r=PG&f=1", "display_name": "599644", "link": "https://stackoverflow.com/users/7312355/599644"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532553820, "creation_date": 1532553820, "question_id": 51527866, "link": "https://stackoverflow.com/questions/51527866/how-do-use-wai-warp-with-a-database-pool", "title": "How do use Wai/Warp with a Database Pool", "body": "<p>I was wondering if somebody could point me towards the correct direction of how am I supposed to use Wai/Warp with a Database Pool.</p>\n\n<p>Warp <code>run</code> is of type <code>Port -&gt; Application -&gt; IO ()</code>, where <code>Application</code> is  <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code></p>\n\n<p>Assuming I have a DB connection somehow,  I don't see how I can wrap my <code>Application</code> around that every request share the <code>ConnectionPool</code>.</p>\n\n<p>I was thinking maybe doing something like this. Will that work?</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Network.Wai\nimport Network.HTTP.Types\nimport Network.Wai.Handler.Warp (run)\nimport Database.MySQL.Base\n\ncreatePool = do\n    connect\n        defaultConnectInfo \n            { ciUser = \"username\"\n            , ciPassword = \"password\"\n            , ciDatabase = \"dbname\" }\n\napp :: IO MySQLConn -&gt; Application\napp conn _ respond = do\n    respond $ responseLBS\n        status200\n        [(\"Content-Type\", \"text/plain\")]\n        \"Hello, Web!\"\n\nmain :: IO ()\nmain = do\n    putStrLn $ \"http://localhost:8080/\"\n    run 8080 $ app $ createPool\n</code></pre>\n"}, {"tags": ["haskell", "arrows"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 11624866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d011f9d79b722372dee0cc0959f4c6f?s=128&d=identicon&r=PG&f=1", "display_name": "Myuri", "link": "https://stackoverflow.com/users/11624866/myuri"}, "edited": false, "score": 0, "creation_date": 1583925447, "post_id": 51527395, "comment_id": 107273882, "body": "To add, arrow notation does provide syntactic sugar that allows application of arrows within arrow scope if necessary. Namely, <code>proc (f,x) -&gt; f -&lt;&lt; x \u2261 proc (f,x) -&gt; app -&lt; (f,x)</code> (source: Programming with Arrows by John Hughes)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1532551561, "creation_date": 1532551561, "answer_id": 51527395, "question_id": 51525950, "link": "https://stackoverflow.com/questions/51525950/why-arrows-in-input-are-not-useable-in-arrow-commands-in-a-proc-block/51527395#51527395", "title": "Why arrows in input are not useable in arrow commands in a proc block?", "body": "<p>Indeed the grammar appears to be too weak to point out this issue.</p>\n\n<p>You've basically discovered exactly what makes \u201cArrow less powerful than Monad\u201d. (FTR, I dislike this comparison \u2013 arrows are an abstraction that comes from a fundamentally different direction than monads, only they happen to be able to support most monad operations if used with a <code>Kleisli</code> category.)</p>\n\n<p><code>proc</code> notation is a cheat. It allows you to give names to \u201cvariables\u201d which don't necessarily correspond to actual values at all (i.e., to something that could also be bound with a lambda). That's ok as long as you only use those to the right of <code>-&lt;</code>, where the desugarer will know how to translate it to fanout/projection operations. In particular,  your <code>caseII</code> desugars as</p>\n\n<pre><code>   proc (f,x) -&gt; returnA &lt;- otherArrow -&lt; x\n\u2261  proc   fx -&gt; returnA &lt;- otherArrow -&lt; snd fx\n\u2261                 id  &lt;&lt;&lt; otherArrow &lt;&lt;&lt; arr snd\n</code></pre>\n\n<p>But in <code>caseII</code>, you try to bind a virtual variable <code>f</code> that itself represents an arrow to be used in the chain. That's a problem, because you can't build up the chain that would pipe through this \u201cvariable\u201d withour already having it available!</p>\n"}], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 51527395, "answer_count": 1, "score": 1, "last_activity_date": 1532552685, "creation_date": 1532545232, "last_edit_date": 1532552685, "question_id": 51525950, "link": "https://stackoverflow.com/questions/51525950/why-arrows-in-input-are-not-useable-in-arrow-commands-in-a-proc-block", "title": "Why arrows in input are not useable in arrow commands in a proc block?", "body": "<p>During my learning about arrows, I stumble on a point which doesn't get clearer with time:</p>\n\n<p>from John Hughes's paper \"Generalizing Monads To Arrows\", I have noted that this below (case I) is not possible, because the <strong>arrow</strong> <code>f</code> in parameter cannot be used inside the local scope of the arrow procedure.</p>\n\n<pre><code>-- case I\nproc (f,x) -&gt; returnA &lt;- f -&lt; x     --- here the f is illegal   \n</code></pre>\n\n<p>If we had another arrow, <code>otherArrow</code>, defined elsewhere, we could do:</p>\n\n<pre><code>-- case II\nproc (f,x) -&gt; returnA &lt;- otherArrow -&lt; x\n</code></pre>\n\n<p>I understand the need for the <code>-&lt;</code> like there is no apply for arrows so as to apply <code>x</code> to its input. So we use <code>-&lt;</code> to achieve this (case II).</p>\n\n<p>But I do not see the reason for the impossibility to use an arrow given in parameter to the <code>proc</code> block. (<code>f</code> in <code>proc (f,x)</code> in the case I).</p>\n\n<p>And my not-understanding collides with a term that is often used: <strong>arrow command</strong>. Papers insists that it is not equivalent to haskell expressions, and that the Haskell type system is not suited for making arrow commands first-class in the language.</p>\n\n<p>Again I do not see what is the fact/the property that makes it impossible to make it first-class in the Haskell type system. Understanding the reason  behind this impossibility seems to be the insight I need.</p>\n\n<p>Given the grammar in Ross Paterson's paper:</p>\n\n<pre><code>exp ::=   ...\n        | proc pat -&gt; cmd\n\ncmd ::=   exp -&lt; exp\n        | form exp cmd1 ... cmdn \n        | cmd1 op cmd2\n        | K pat -&gt; cmd\n        | (cmd)\n</code></pre>\n\n<p>From this grammar I do not grasp the reason for the impossibility.</p>\n\n<p>But from translation rules we have:</p>\n\n<pre><code>proc p -&gt; e1 -&lt; e2 = arr $ \\p -&gt; e2 &gt;&gt;&gt; e1 -- if intersect Vars(p) and Vars (e1) is empty \n                   = arr $ \\p -&gt; (e1,e2) &gt;&gt;&gt; app -- otherwise\n</code></pre>\n\n<p>In the first branch, we see that the intersection of variables in <code>p</code> and in <code>e1</code> should be empty... Is this variable scope-limitation the main trait of an arrow command, I mean the reason behind what makes it not possible to make arrow command first-class in Haskell ? </p>\n\n<p>As I am asking, my mind makes not much difference between an <em>arrow-command</em> and a <em>composition-of-arrows</em> (with operators like >>>, which eventually results in an arrow itself) and a simple <em>arrow</em>.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1532530829, "post_id": 51521874, "comment_id": 90012997, "body": "What about <code>taxes = foldl ((+).taxes) 0 . employees</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1532531465, "post_id": 51521874, "comment_id": 90013472, "body": "A simpler approach is however <code>taxes = sum . map taxes . employees</code>."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 2, "creation_date": 1532531497, "post_id": 51521874, "comment_id": 90013504, "body": "Have you tried <code>foldr</code>?. I haven&#39;t ckeck it but I think the type of <code>(+) . taxes</code> is <code>Company -&gt; Double -&gt; Double</code> so in this case <code>foldl</code> takes an input function of type <code>Double -&gt; Company -&gt; Double</code>. wrong types"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1532537256, "post_id": 51521874, "comment_id": 90016728, "body": "Please paste code you&#39;re actually using, preferably with the <i>full</i> error message, not just a snippet. Your supposed foldr code uses foldl but the error message says you are using foldr."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1532691867, "post_id": 51521874, "comment_id": 90081152, "body": "I do not understand.If i use :  <code>taxes=foldl ((+).taxes) .employees </code> this means that  i  am trying to compose a partially applied function which is <code>fodl</code> in our case,since the source parameter is not provided."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1532537400, "creation_date": 1532537400, "answer_id": 51524029, "question_id": 51521874, "link": "https://stackoverflow.com/questions/51521874/can-not-use-instance-method-implementation-inside-another-definition/51524029#51524029", "title": "Can not use instance method implementation inside another definition", "body": "<p>There is already a function in the Prelude that is excellent for summing lists of numbers. Why are we reinventing summation with a fold? Break the problem down into a few parts:</p>\n\n<ul>\n<li>Find the company's employees</li>\n<li>Compute taxes for each</li>\n<li>Sum the results</li>\n</ul>\n\n<p>Thus:</p>\n\n<pre><code>instance Charges Company where \n    taxes = sum . map taxes . employees\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 51524029, "answer_count": 1, "score": 0, "last_activity_date": 1532612816, "creation_date": 1532530214, "last_edit_date": 1532612816, "question_id": 51521874, "link": "https://stackoverflow.com/questions/51521874/can-not-use-instance-method-implementation-inside-another-definition", "title": "Can not use instance method implementation inside another definition", "body": "<p>Hello i do not understand why i do have the following problem :\nI am trying to define <code>taxes</code> definition for <code>Company</code> using <code>taxes</code> implementation  from <code>Employee</code>.I do not understand why i face the following errors: </p>\n\n<pre><code>data Employee=Employee{\n        age::Int,\n        name::String,\n        job::Job,\n        wage::Double\n    }\ndata Job= Worker | Manager |Unemployed deriving(Eq,Ord,Show)\n\ndata Company=Company{\n    compName::String,\n    year::Int,\n    employees::[Employee]\n}\n\nclass Charges a where \n     taxes::a-&gt;Double\ninstance Charges Employee where \n    taxes Employee{age=a,wage=w}=fromIntegral a * w\n</code></pre>\n\n<p><strong>Implementation 1:</strong></p>\n\n<pre><code>instance Charges Company where \n    taxes comp=foldl ((+).taxes) 0 employees  \n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>Couldn't match type `[Employee]' with `Double'\n  Expected type: Company -&gt; Double\n    Actual type: Company -&gt; [Employee]\n</code></pre>\n\n<p>Why is it a problem since i take an <code>Employee</code> one by one i apply <code>taxes</code> which is already implemented for <code>Employee</code> and i add it to the counter??</p>\n\n<p><strong>Implementation2</strong> - using foldr</p>\n\n<pre><code> instance Charges Company where \n        taxes comp =foldl ((+).taxes) 0 (employees comp)\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>Couldn't match expected type `Company -&gt; Double'\n                  with actual type `Double'\n    * Possible cause: `foldr' is applied to too many arguments\n</code></pre>\n\n<p>I see no more then 3 arguments what is the problem?</p>\n"}, {"tags": ["haskell", "hxt"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532529146, "post_id": 51521052, "comment_id": 90011796, "body": "I think you need to move up <i>twice</i>, since with <code>hasText</code>, you obtain the <i>text element</i>, not the <code>&lt;string&gt;</code> tag. As you can see with the <code>XText</code>."}, {"owner": {"reputation": 1009, "user_id": 848808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04493e2e65773c7ae616dbe1cbebabe?s=128&d=identicon&r=PG", "display_name": "Nick Ager", "link": "https://stackoverflow.com/users/848808/nick-ager"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532686500, "post_id": 51521052, "comment_id": 90078296, "body": "@WillemVanOnsem Thanks for hint which sounds right, however I&#39;m struggling to compose <code>moveUp</code> with the above. It seems <code>withNav</code> might need to be in the mix but I&#39;m fighting type errors without success when I&#39;m trying to compose the whole expression. Any more hints?"}], "answers": [{"tags": [], "owner": {"reputation": 1009, "user_id": 848808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04493e2e65773c7ae616dbe1cbebabe?s=128&d=identicon&r=PG", "display_name": "Nick Ager", "link": "https://stackoverflow.com/users/848808/nick-ager"}, "is_accepted": true, "score": 0, "last_activity_date": 1532686927, "creation_date": 1532686927, "answer_id": 51555934, "question_id": 51521052, "link": "https://stackoverflow.com/questions/51521052/using-hxt-to-modify-xml/51555934#51555934", "title": "Using HXT to modify XML", "body": "<p>I've solved the problem in a different way. It doesn't feel as robust (matching a substring for <code>xyz.ipa</code>), but it unblocked me while I await inspiration:</p>\n\n<pre><code>import Text.XML.HXT.Core\nimport Data.Char (toUpper)\n\nuppercase = map toUpper\n\nmain = do\n  plistString &lt;- readFile \"manifest.plist\"\n  let plistDoc = readString [withValidate no, withSubstDTDEntities no] plistString\n  node &lt;- runX . xshow $ plistDoc &gt;&gt;&gt; processTopDown (ifA (hasText ( isInfixOf \"xyz.ipa\")) (changeText uppercase) (this))\n  print node\n</code></pre>\n"}], "owner": {"reputation": 1009, "user_id": 848808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04493e2e65773c7ae616dbe1cbebabe?s=128&d=identicon&r=PG", "display_name": "Nick Ager", "link": "https://stackoverflow.com/users/848808/nick-ager"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 51555934, "answer_count": 1, "score": 0, "last_activity_date": 1532686927, "creation_date": 1532527815, "question_id": 51521052, "link": "https://stackoverflow.com/questions/51521052/using-hxt-to-modify-xml", "title": "Using HXT to modify XML", "body": "<p>I'm trying to modify an XML file of the form:</p>\n\n<pre><code>&lt;plist version=\"1.0\"&gt;\n&lt;dict&gt;\n    &lt;key&gt;items&lt;/key&gt;\n    &lt;array&gt;\n        &lt;dict&gt;\n            &lt;key&gt;assets&lt;/key&gt;\n            &lt;array&gt;\n                &lt;dict&gt;\n                    &lt;key&gt;kind&lt;/key&gt;\n                    &lt;string&gt;software-package&lt;/string&gt;\n                    &lt;key&gt;url&lt;/key&gt;\n                    &lt;string&gt;https://s3.xyz.amazonaws.com/xyz/xyz.ipa&lt;/string&gt;\n                &lt;/dict&gt;\n                &lt;dict&gt;\n                    &lt;key&gt;kind&lt;/key&gt;\n                    &lt;string&gt;display-image&lt;/string&gt;\n                    &lt;key&gt;url&lt;/key&gt;\n                    &lt;string&gt;https://s3.xyz.amazonaws.com/xyz/xyz.57x57.png&lt;/string&gt;\n                &lt;/dict&gt;\n            &lt;/array&gt;\n        &lt;/dict&gt;\n    &lt;/array&gt;\n&lt;/dict&gt;\n</code></pre>\n\n<p></p>\n\n<p>I want to modify the contents of the node <code>&lt;string&gt;https://s3.xyz.amazonaws.com/xyz/xyz.ipa&lt;/string&gt;</code></p>\n\n<p>I can find the related sibling node with the following</p>\n\n<pre><code>import Text.XML.HXT.Core\n\nmain = do\n  plistString &lt;- readFile \"manifest.plist\"\n  let plistDoc = readString [withValidate no, withSubstDTDEntities no] plistString\n  node &lt;- runX  $ plistDoc &gt;&gt;&gt; deep (hasText ( == \"software-package\")) \n  print node\n</code></pre>\n\n<p>but I don't seem to be able to select the associated sibling nodes (tried <code>followingSiblingAxis</code> and <code>moveUp &gt;&gt;&gt; getChildren</code>) which would then allow me to manipulate the required node. Is it a problem to do with the difference between <code>NavigatableTree</code> and <code>NTree</code>; the node I'm <code>show</code>s as <code>NTree (XText \"software-package\") []]</code></p>\n\n<p>It would really help me if any answers assume a very limited exposure to arrows.</p>\n\n<p>Thanks. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532524736, "post_id": 51519883, "comment_id": 90008516, "body": "What if you remove it from the <code>class</code>? Since there there is no <code>a</code> at all in the &quot;head&quot; of the type constraint."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 5, "last_activity_date": 1532525400, "creation_date": 1532525400, "answer_id": 51520170, "question_id": 51519883, "link": "https://stackoverflow.com/questions/51519883/is-it-possible-to-use-ghc-stack-hascallstack-in-a-typeclass-declaration-and-or-i/51520170#51520170", "title": "Is it possible to use GHC.Stack.HasCallStack in a typeclass declaration and/or instantiation?", "body": "<p>You only need a the stack at the call site of <code>foo</code>, so this compiles, and I believe it will propagate the implicit as expected:</p>\n\n<pre><code>class Foo a where\n    foo :: HasCallStack =&gt; a\n</code></pre>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 51520170, "answer_count": 1, "score": 4, "last_activity_date": 1532525400, "creation_date": 1532524653, "question_id": 51519883, "link": "https://stackoverflow.com/questions/51519883/is-it-possible-to-use-ghc-stack-hascallstack-in-a-typeclass-declaration-and-or-i", "title": "Is it possible to use GHC.Stack.HasCallStack in a typeclass declaration and/or instantiation?", "body": "<p>Let's say I have this typeclass:</p>\n\n<pre><code>import GHC.Stack\n\nclass Foo a where\n  foo :: a\ninstance Foo Int where\n  foo = undefined\n</code></pre>\n\n<p>How can I add the HasCallStack constraint to the <code>foo</code> value? I've tried like this:</p>\n\n<pre><code>class (HasCallStack) =&gt; Foo a where\n  foo :: a\ninstance (HasCallStack) =&gt; Foo Int where\n  foo = undefined\n</code></pre>\n\n<p>And I get a type error like:</p>\n\n<pre><code>source.hs:10:1: error:\n    \u2022 Illegal implicit parameter \u2018?callStack::CallStack\u2019\n    \u2022 In the context: HasCallStack\n      While checking the super-classes of class \u2018Foo\u2019\n      In the class declaration for \u2018Foo\u2019\n</code></pre>\n\n<p>I've also tried only having the constraints on either the class or the instance. I got similar errors in both cases.</p>\n\n<p>Is this possible somehow? Or is it impossible to get call stacks for class members?  It would help me debug something quite a bit more easily at the moment if it was possible somehow to get the call stack.</p>\n"}, {"tags": ["haskell", "types", "ghci", "unification"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1532519290, "post_id": 51518117, "comment_id": 90004664, "body": "<code>foldr</code> has been generalized to <code>Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1532519693, "post_id": 51518117, "comment_id": 90004956, "body": "Yes, it is correct. Nowadays <code>foldr</code> is more general than it used to be, so it returns a more general type. To simplify these &quot;new&quot; types, you can pretend that <code>Foldable t</code> isn&#39;t there if you replace every <code>t something</code> in the type with <code>[something]</code>. In this way, you lose the more general type, and get what you would expect."}, {"owner": {"reputation": 135, "user_id": 3342072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/840d5d10b7878671cf04d645af5f4d37?s=128&d=identicon&r=PG&f=1", "display_name": "user3342072", "link": "https://stackoverflow.com/users/3342072/user3342072"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1532519817, "post_id": 51518117, "comment_id": 90005044, "body": "Thank you @chi!"}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 4, "last_activity_date": 1532519896, "creation_date": 1532519896, "answer_id": 51518309, "question_id": 51518117, "link": "https://stackoverflow.com/questions/51518117/deriving-type-of-foldr/51518309#51518309", "title": "Deriving type of foldr (!!)", "body": "<p>As noted in the comments, in recent GHC, <code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code>.  When <code>t ~ []</code>, <code>Foldable t =&gt; Int -&gt; t [Int] -&gt; Int</code> simplifies to <code>Int-&gt;[[Int]]-&gt;Int</code>, as you expected.</p>\n\n<p>There are a couple of ways to get GHCi to print the more specific type.  One is to add the type signature that you expect, and have GHCi verify.</p>\n\n<pre><code>&gt; :t foldr (!!) :: Int-&gt;[[Int]]-&gt;Int\nfoldr (!!) :: Int-&gt;[[Int]]-&gt;Int :: Int -&gt; [[Int]] -&gt; Int\n</code></pre>\n\n<p>Another is to give an explicit type for <code>t</code>, before the normal (term) arguments to <code>foldr</code>:</p>\n\n<pre><code>&gt; :t foldr @[] (!!)\nfoldr @[] (!!) :: Int -&gt; [[Int]] -&gt; Int\n</code></pre>\n\n<p>This uses <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#visible-type-application\" rel=\"nofollow noreferrer\">TypeApplications</a>.  The syntax is <code>@</code> followed by the type name.</p>\n"}, {"comments": [{"owner": {"reputation": 135, "user_id": 3342072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/840d5d10b7878671cf04d645af5f4d37?s=128&d=identicon&r=PG&f=1", "display_name": "user3342072", "link": "https://stackoverflow.com/users/3342072/user3342072"}, "edited": false, "score": 0, "creation_date": 1532520513, "post_id": 51518342, "comment_id": 90005557, "body": "I wasn&#39;t familiar with the generalized type of foldr.   Thanks for your informative answer and clear derivations."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1532522818, "last_edit_date": 1532522818, "creation_date": 1532520000, "answer_id": 51518342, "question_id": 51518117, "link": "https://stackoverflow.com/questions/51518117/deriving-type-of-foldr/51518342#51518342", "title": "Deriving type of foldr (!!)", "body": "<p>The <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:foldr\" rel=\"nofollow noreferrer\"><strong><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code></strong></a> indeed in the early days had the signature <code>(a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>, but they have <em>generalized</em> the function, such that it <em>not only</em> works with lists (where <code>t ~ []</code>), but with other <code>Foldable</code> types (like <code>Maybe</code>, <code>Sum</code>, etc. as well). But for the list case, nothing changes, the function is simply applicable to more <code>Foldable</code> types.</p>\n\n<h1>Deriving the type for the \"old\" <code>foldr</code></h1>\n\n<p>In that case we take as ingredients:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n(!!) :: [c] -&gt; Int -&gt; c\n</code></pre>\n\n<p>or more verbose:</p>\n\n<pre><code>foldr :: (a -&gt; (b -&gt; b)) -&gt; (b -&gt; ([a] -&gt; b))\n(!!) :: [c] -&gt; (Int -&gt; c)\n</code></pre>\n\n<p>Since <code>(!!)</code> is the parameter of the call with <code>foldr</code> as function, we know that the type of the <code>(!!) :: [c] -&gt; (Int -&gt; c)</code> function should match with the type of the parameter of <code>foldr</code>, so <code>(a -&gt; b -&gt; b)</code>. So that means:</p>\n\n<pre><code>  a -&gt; (b -&gt; b)\n~ [c] -&gt; (Int -&gt; c)\n--------------------\na ~ [c], b ~ c ~ Int\n</code></pre>\n\n<p>So we know that <code>a</code> is the same type as <code>[c]</code>, and that both <code>b</code> and <code>c</code> are actually <code>Int</code>. Therefore we know that <code>a ~ [Int]</code>.</p>\n\n<p>So now the type of <code>foldr (!!)</code> is the output type of <code>foldr</code>, but specialized with what we derived, so:</p>\n\n<pre><code>b -&gt; ([a] -&gt; b)\n</code></pre>\n\n<p>which is equal to:</p>\n\n<pre><code>Int -&gt; ([[Int]] -&gt; Int)\n</code></pre>\n\n<p>or less verbose:</p>\n\n<pre><code>Int -&gt; [[Int]] -&gt; Int\n</code></pre>\n\n<h1>Deriving the type of the \"<em>new</em>\" <code>folr</code></h1>\n\n<p>In that case we take as ingredients:</p>\n\n<pre><code>foldr :: Foldable t =&gt; (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n(!!) :: [c] -&gt; Int -&gt; c\n</code></pre>\n\n<p>and we follow the same reasoning for the first parameter of <code>foldr</code>:</p>\n\n<pre><code>  a -&gt; (b -&gt; b)\n~ [c] -&gt; (Int -&gt; c)\n--------------------\na ~ [c], b ~ c ~ Int\n</code></pre>\n\n<p>So the output type of <code>foldr</code> is:</p>\n\n<pre><code>Foldable t =&gt; b -&gt; (t a -&gt; b)\n</code></pre>\n\n<p>or specified with what we know:</p>\n\n<pre><code>Foldable t =&gt; Int -&gt; t [Int] -&gt; Int\n</code></pre>\n\n<p>Which is what <code>ghci</code> derived.</p>\n\n<h1>The semantics of the function</h1>\n\n<p>As for the semantics, the function:</p>\n\n<pre><code>f = foldr (!!)\n</code></pre>\n\n<p>takes as input an <code>Int</code> (an index), and a <code>Foldable</code> of lists of <code>Int</code>s. In case of a list, it will - right-to-left - obtain the element with that index, of the most right list, and use that element as an index for the one last but one list. We keep doing that until the first list, and return the element.</p>\n\n<p>For example:</p>\n\n<pre><code>foldr (!!) 1 [] -&gt; 1\nfoldr (!!) 1 [[2, 0]] -&gt; 0\nfoldr (!!) 1 [[3, 5], [2, 0]] -&gt; 3\n</code></pre>\n\n<p>For the <code>t ~ Maybe</code> case, we will thus return the original index in case of a <code>Nothing</code>, or we will return the element at that index in case it is a <code>Just [1, 4, 2, 5]</code> (a <code>Just</code> that carries a <code>[Int]</code> object). For example:</p>\n\n<pre><code>foldr (!!) 1 Nothing -&gt; 1\nfoldr (!!) 3 Nothing -&gt; 3\nfoldr (!!) 1 (Just [1, 4, 2, 5])-&gt; 4\nfoldr (!!) 3 (Just [1, 4, 2, 5])-&gt; 5\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 3342072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/840d5d10b7878671cf04d645af5f4d37?s=128&d=identicon&r=PG&f=1", "display_name": "user3342072", "link": "https://stackoverflow.com/users/3342072/user3342072"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 51518342, "answer_count": 2, "score": 1, "last_activity_date": 1532522818, "creation_date": 1532519227, "question_id": 51518117, "link": "https://stackoverflow.com/questions/51518117/deriving-type-of-foldr", "title": "Deriving type of foldr (!!)", "body": "<pre><code>foldr :: (a-&gt;b-&gt;b)-&gt;b-&gt;[a]-&gt;b\n(!!)::[c]-&gt;Int-&gt;c\n</code></pre>\n\n<p>From that we get <code>a-&gt;b-&gt;b=[c]-&gt;Int-&gt;c</code>\nor <code>a=[c],b=Int,b=c</code>.<br>\nWe conclude that type of foldr (!!) is <code>Int-&gt;[[Int]]-&gt;Int</code>.<br>\nIs it correct?<br>\nWinGHCi tells me something different:</p>\n\n<pre><code>Prelude&gt; :t foldr (!!)\nfoldr (!!) :: Foldable t =&gt; Int -&gt; t [Int] -&gt; Int\n</code></pre>\n"}, {"tags": ["haskell", "haddock"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1532564080, "post_id": 51517424, "comment_id": 90026880, "body": "Both <code>stack haddock</code> and <code>cabal new-haddock</code> have a <code>--haddock-internal</code> flag that you could try."}], "answers": [{"comments": [{"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1532525067, "post_id": 51518192, "comment_id": 90008744, "body": "Thanks for the input. The problem with the module header is if the module (as in my case) is a hidden module as well. Good to know that ignore-exports can be used like this."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1532530884, "post_id": 51518192, "comment_id": 90013037, "body": "@fredefox I have no idea about how one could handle that :-/"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1532519427, "creation_date": 1532519427, "answer_id": 51518192, "question_id": 51517424, "link": "https://stackoverflow.com/questions/51517424/generate-haddock-for-hidden-members/51518192#51518192", "title": "Generate Haddock for hidden members", "body": "<p>One option is to add</p>\n\n<pre><code>{-# OPTIONS_HADDOCK ignore-exports #-}\n</code></pre>\n\n<p>which will generate Haddock documentation as if there were an empty export list -- i.e., as if everything were exported in the module.</p>\n\n<p>Alternatively, the C preprocessor can be used to hide/show some entries in the Haddock docs. One probably has to invoke haddock with something like this (untested)</p>\n\n<pre><code>haddock --optghc=-cpp --optghc=-DHADDOCK ...\n</code></pre>\n\n<p>and then, in the haskell source,</p>\n\n<pre><code>{-# LANGUAGE CPP #-}\nmodule M\n    ( export1\n    , export2\n#ifdef HADDOCK\n    , notExportedButWeWantDocsAnyway\n#endif\n    , export3\n    ) where\n...\n</code></pre>\n\n<p>(I thought that haddock already defined a macro to witness its presence, but I can't find that in its docs. One can always use a user-defined haddock flag. Or maybe it was <a href=\"https://github.com/haskell/cabal/issues/1237\" rel=\"nofollow noreferrer\">this one</a>.)</p>\n"}], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 51518192, "answer_count": 1, "score": 0, "last_activity_date": 1532519427, "creation_date": 1532516980, "question_id": 51517424, "link": "https://stackoverflow.com/questions/51517424/generate-haddock-for-hidden-members", "title": "Generate Haddock for hidden members", "body": "<p>Can I generate Haddock documentation for hidden members. My use case is that I have a type <code>T</code> that is shown in the signature of some functions. As in e.g. <code>f :: T -&gt; U</code>, <code>g :: T -&gt; U</code>. I'd like users of my library to know what <code>T</code> is used for, but not actually export it. Does it make sense? Is this possible?</p>\n"}, {"tags": ["haskell", "types", "subtyping"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1532508439, "post_id": 51513731, "comment_id": 89997491, "body": "Looks like <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa\">XY</a> problem."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1532509165, "post_id": 51513731, "comment_id": 89997993, "body": "This is dependent typing. See <a href=\"https://en.wikipedia.org/wiki/Dependent_type\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Dependent_type</a>. Basically no, Haskell can&#39;t do that."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1532509409, "post_id": 51513731, "comment_id": 89998166, "body": "@PaulJohnson I am not sure it is, since the value of <code>unique</code> does not actually depend on anything particular in the input. This is why I am guessing there might be a way to implement it without run time type manipulations."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1532509905, "post_id": 51513731, "comment_id": 89998498, "body": "I&#39;m finding your question a little hard to follow. Your core question appears to be about how to use types to prevent leaking information but all the talk of polynomials and subtyping is quite distracting. If I&#39;ve understood you correctly, what you want is possible with existentials or higher-rank types. The idea is to require clients to write a block of code polymorphic in some type parameter. Parametricity ensures you can&#39;t leak the parameter. cf <a href=\"https://wiki.haskell.org/Monad/ST\" rel=\"nofollow noreferrer\">the <code>ST</code> monad&#39;s <code>s</code> parameter</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1532510231, "post_id": 51513731, "comment_id": 89998710, "body": "Your polynomial example does seem like a rather odd application of that idea though. I agree with @freestyle, seems like you might be asking the wrong question"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1532510569, "post_id": 51513731, "comment_id": 89998965, "body": "@BenjaminHodgson I am actually looking at <code>ST</code> even now, but it is anything but clear how to transplant the same approach to subtyping. Consider the code in <a href=\"https://stackoverflow.com/q/51502879/2108477\">my previous question</a>; does it make sense if I say I want to obtain any number of instances of <code>Collected</code> with <code>collection</code> determined at run time?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1532510628, "post_id": 51513731, "comment_id": 89999006, "body": "It&#39;s true that you can do this in an enclosed block, as the ST monad does, but the more general case where you can sling these values around in arbitrary ways does not seem to be possible. I wanted to do something similar with coordinates in my geodetics library (<a href=\"http://hackage.haskell.org/package/geodetics\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/geodetics</a>), e.g so that a position in one reference frame was type-level distinct from a position in another. AFAIK it can only be done with values of Polynomial declared at compile-time."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1532523870, "post_id": 51515531, "comment_id": 90007958, "body": "This appears to be a sort of a continuation, therefore isomorphic to monad. Maybe we could try to consider it as such and see if it would be useable? Also, are you sure you do not want the universal quantifier inside the parentheses <i>(because in ST it would be)</i>?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1532527710, "post_id": 51515531, "comment_id": 90010760, "body": "@IgnatInsarov Type corrected. There may well be a monad instance to be had, but its not a primary feature. I don&#39;t think its a continuation monad because the <code>s</code> would escape if it was, but by all means try to prove me wrong (I&#39;m off camping the day after tomorrow, so I don&#39;t have time to work on this)."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 1, "last_activity_date": 1532527731, "last_edit_date": 1532527731, "creation_date": 1532511143, "answer_id": 51515531, "question_id": 51513731, "link": "https://stackoverflow.com/questions/51513731/can-i-attach-a-unique-run-time-determined-tag-to-a-selection-of-objects/51515531#51515531", "title": "Can I attach a unique, run time determined tag to a selection of objects?", "body": "<p>To do it in an ST-like way you would need a library of functions to operate on the <code>Value s</code> and <code>Polynomial s</code> types, and then have a function with a type like this:</p>\n\n<pre><code>withPolynomial :: (forall s . Polynomial s -&gt; Integer) -&gt; [Integer] -&gt; Integer\n</code></pre>\n\n<p>This will convert the <code>[Integer]</code> into a <code>Polynomial s</code> and pass it to the argument function. This function will then do whatever it wants, using your library of functions where appropriate. Any <code>Value s</code> values are guaranteed not to leak from the enclosing <code>withPolynomial</code> application, so they can't get mixed up. However this will also prevent you from storing polynomials and their values for use in future computations.  </p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532527731, "creation_date": 1532505621, "question_id": 51513731, "link": "https://stackoverflow.com/questions/51513731/can-i-attach-a-unique-run-time-determined-tag-to-a-selection-of-objects", "title": "Can I attach a unique, run time determined tag to a selection of objects?", "body": "<p>Consider type <code>B</code> and its subtype <code>A</code>, determined by a predicate <code>P</code>. An instance would be natural numbers for <code>B</code> and prime numbers for <code>A</code>, with some primality test as <code>P</code>. It is straightforward to implement a smart constructor for such <code>A</code>, defined as a <code>newtype</code> or a <code>Tagged</code>. </p>\n\n<p>Now suppose the subtyping predicate is not completely determined at compile time. For example, let <code>P</code> be membership in a collection determined by <code>IO</code> input: the operator enters the coefficients for an integral polynomial and we obtain a predicate that verifies that a given number is a value of that polynomial at some index.</p>\n\n<p><strong>Can I make sure that each polynomial, and the values validated for it, are tagged in a fashion that makes them compatible with each other and incompatible with any other polynomial?</strong> Among the operations I am going to need is conversion between values and their indices, and I want to type safeguard them to avoid confusion.</p>\n\n<p>This is how I imagine it to be:</p>\n\n<pre><code>polynomial :: [Integer] -&gt; Polynomial unique\n\ntoValue   :: Integer -&gt; Polynomial unique -&gt; Value unique\n\nfromValue :: Integer -&gt; Polynomial unique -&gt; Maybe (Index unique)\n\ntoValue'   :: Index unique -&gt; Value unique\n\nfromValue' :: Value unique -&gt; Index unique\n</code></pre>\n\n<p>The point is to obtain these latter two <em>total</em> functions.</p>\n\n<p>But I have no idea how to go about defining this <code>polynomial</code> function. Where would it get the <code>unique</code> type from?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1532525943, "post_id": 51512317, "comment_id": 90009437, "body": "Yes, that&#39;s what <code>O_WRONLY</code> means. The distinction between opening a file for writing and opening a file for appending predates Haskell by quite a bit, and is defined at a lower level than any one programming language&#39;s semantics."}], "answers": [{"comments": [{"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1532509253, "post_id": 51512470, "comment_id": 89998056, "body": "Yes but ReadWriteMode requires read permissions. I only want to write."}], "tags": [], "owner": {"reputation": 1673, "user_id": 562505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e41c5ece2b0554d025e458e05e501c9?s=128&d=identicon&r=PG", "display_name": "jkoshy", "link": "https://stackoverflow.com/users/562505/jkoshy"}, "is_accepted": false, "score": 1, "last_activity_date": 1532501288, "creation_date": 1532501288, "answer_id": 51512470, "question_id": 51512317, "link": "https://stackoverflow.com/questions/51512317/why-does-openfile-with-writemode-truncate-the-file-how-not-to/51512470#51512470", "title": "Why does openFile with WriteMode truncate the file? How not to?", "body": "<p>IO modes <code>AppendMode</code> or <code>ReadWriteMode</code> should open the file for writing without truncating it.</p>\n"}, {"comments": [{"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1532509461, "post_id": 51512544, "comment_id": 89998202, "body": "That seems legitimate. Interestingly there&#39;s no way to fopen write only without truncating either."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 4, "last_activity_date": 1532502589, "last_edit_date": 1532502589, "creation_date": 1532501591, "answer_id": 51512544, "question_id": 51512317, "link": "https://stackoverflow.com/questions/51512317/why-does-openfile-with-writemode-truncate-the-file-how-not-to/51512544#51512544", "title": "Why does openFile with WriteMode truncate the file? How not to?", "body": "<p>I think <code>IOMode</code> was designed like the <code>mode</code> argument in the <code>fopen</code> function.</p>\n\n<p>From <code>man fopen</code>:</p>\n\n<blockquote>\n  <p>w - Truncate file to zero length or create text file for writing. The stream is positioned at the beginning of the file.</p>\n</blockquote>\n\n<p>If you wanna to open a file for writing only (without truncate it) then you wanna append it usually. So just use <code>AppendMode</code>. If you don't wanna to have position on the end of a file (also you don't wanna to have position on the begin of a file usually) you can use the <code>hSeek</code> to change it.</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1532502589, "creation_date": 1532500695, "question_id": 51512317, "link": "https://stackoverflow.com/questions/51512317/why-does-openfile-with-writemode-truncate-the-file-how-not-to", "title": "Why does openFile with WriteMode truncate the file? How not to?", "body": "<p>Haskell's <code>openFile</code> has this tidbit in the source:</p>\n\n<pre><code>-- we want to truncate() if this is an open in WriteMode, but only\n-- if the target is a RegularFile.  ftruncate() fails on special files\n-- like /dev/null.\nwhen (iomode == WriteMode &amp;&amp; fd_type == RegularFile) $\n  setSize fD 0\n</code></pre>\n\n<p>This was very surprising, I assumed that the <code>IOMode</code>s were merely wrappers around <code>O_WRONLY</code>, <code>O_RDONLY</code> and <code>O_RDWR</code>. Why is this the case? How does one open a file for write only without truncating?</p>\n"}, {"tags": ["haskell", "applicative", "category-theory"], "comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 7, "creation_date": 1532500693, "post_id": 51512233, "comment_id": 89992999, "body": "<code>pure</code> encapsulates a value into an arbitrary <code>Applicative</code> functor. Hence, <code>pure 0</code> can mean any of: <code>Just 0</code>, <code>[0]</code>, <code>\\_ -&gt; 0</code>, <code>(mempty, 0)</code>, etc. Also note that <code>return = pure</code>."}, {"owner": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "reply_to_user": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1532503322, "post_id": 51512233, "comment_id": 89994401, "body": "Perfect, I could see how <code>pure</code> can be used to get a kind of polymorphism. Thank you :)"}], "answers": [{"comments": [{"owner": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "edited": false, "score": 1, "creation_date": 1532502414, "post_id": 51512551, "comment_id": 89993882, "body": "&quot;wanting to apply a function that is not residing in the applicative&quot;, in this case I would prefer using <code>fmap</code> because I know it is already a Functor isn&#39;t it ?"}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "reply_to_user": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "edited": false, "score": 0, "creation_date": 1532503098, "post_id": 51512551, "comment_id": 89994275, "body": "@SumanthKumarMora That&#39;s exactly right. <code>fmap</code> is more compact in that case."}, {"owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "reply_to_user": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "edited": false, "score": 1, "creation_date": 1532503137, "post_id": 51512551, "comment_id": 89994295, "body": "@SumanthKumarMora yes, there may however be other cases where we simply wish to promote a function to reside in the Applicative. These are my teachers lecture notes for Applicatives, i hope they might be helpful :) <a href=\"http://www.cse.chalmers.se/edu/course/TDA342_Advanced_Functional_Programming/lecture4.html\" rel=\"nofollow noreferrer\">cse.chalmers.se/edu/course/&hellip;</a>"}, {"owner": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "edited": false, "score": 0, "creation_date": 1532503396, "post_id": 51512551, "comment_id": 89994450, "body": "@RobertK, Thanks a lot, I will have at look at those lecture notes."}], "tags": [], "owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "is_accepted": false, "score": 12, "last_activity_date": 1532502980, "last_edit_date": 1532502980, "creation_date": 1532501606, "answer_id": 51512551, "question_id": 51512233, "link": "https://stackoverflow.com/questions/51512233/what-is-the-purpose-of-pure-in-applicative-functor/51512551#51512551", "title": "What is the purpose of `pure` in Applicative Functor", "body": "<p><code>&lt;*&gt; :: f (a -&gt; b) -&gt; f a -&gt; f b</code>, this operator accepts a function in the applicative type, as well as a value in the applicative type. The first argument of this operator can not thus be simply a function, but it has to be residing within an applicative.</p>\n\n<p>The <code>pure</code> function solves problems that might occur here (e.g wanting to apply a function that is not residing in the applicative). It accepts a function that is not currently residing in the applicative, and lifts it into the applicative.<code>pure :: a -&gt; f a</code></p>\n\n<p><code>(+3) :: Int -&gt; Int</code>, and <code>Just 10 :: Maybe Int</code>, you can not thus evaluate <code>(+3) &lt;*&gt; Just 10</code> as the types do not work; the <code>(+3)</code> has to be promoted to a value in the <code>Maybe</code> applicative.</p>\n\n<p>For <code>Maybe a</code>, the definition of <code>pure</code> is <code>pure = Just</code>, which is why you can write either <code>pure (+3)</code> or <code>Just (+3)</code></p>\n\n<p>--</p>\n\n<p>I'll leave it to you to look into the <code>&lt;$&gt;</code> operator :-) Remember, every Applicative is a Functor.</p>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 6, "last_activity_date": 1532507131, "last_edit_date": 1532507131, "creation_date": 1532503638, "answer_id": 51513144, "question_id": 51512233, "link": "https://stackoverflow.com/questions/51512233/what-is-the-purpose-of-pure-in-applicative-functor/51513144#51513144", "title": "What is the purpose of `pure` in Applicative Functor", "body": "<p><code>pure</code> is like <code>mempty</code> for <code>Monoid</code>. <code>mempty</code> is neutral for <code>mappend</code>. <code>pure</code> is also neutral (in some sence) for <code>&lt;*&gt;</code>, it lifts some value to the functor without any effects or lifts with neutral effect.</p>\n\n<p>This sentence can be formalized with four properties (copy/past from docs on <code>Applicative</code>):</p>\n\n<pre><code>pure id &lt;*&gt; v = v\npure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w = u &lt;*&gt; (v &lt;*&gt; w)\npure f &lt;*&gt; pure x = pure (f x)\nu &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u\n</code></pre>\n\n<blockquote>\n  <p>What is the true purpose of defining pure and when do I get to use it (or) who is already using it?</p>\n</blockquote>\n\n<p>Well, basically for writing more generalized code. For example:</p>\n\n<pre><code>when :: Applicative f =&gt; Bool -&gt; f () -&gt; f ()\nwhen p s = if p then s else pure ()\n\nsequenceA_ :: Applicative f =&gt; [f a] -&gt; f ()\nsequenceA_ = foldr (*&gt;) (pure ())\n\ntraverse_ :: Applicative f =&gt; (a -&gt; f b) -&gt; [a] -&gt; f ()\ntraverse_ f = foldr ((*&gt;) . f) (pure ())\n</code></pre>\n\n<p>Also, sometime more simpler to use <code>pure</code> then implicitly wrap a value to a functor. For example, compare:</p>\n\n<pre><code>pure 3 ~ StateT (\\s -&gt; Identity (3, s))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 3, "last_activity_date": 1532717856, "creation_date": 1532717856, "answer_id": 51563993, "question_id": 51512233, "link": "https://stackoverflow.com/questions/51512233/what-is-the-purpose-of-pure-in-applicative-functor/51563993#51563993", "title": "What is the purpose of `pure` in Applicative Functor", "body": "<p>There are a few situations to use <code>pure</code>.</p>\n\n<ol>\n<li><p>As freestyle's answer illustrated, when you don't know what specific <code>Applicative</code> is being used.</p></li>\n<li><p>Also from freestyle, when its just more convenient to use <code>pure</code>.</p></li>\n</ol>\n\n<p>In addition to just being simpler to write in some cases, it can make your code more robust. As I've develop software, my key data structures often evolve. Using <code>pure</code> instead of a specific constructor helps create spots of code that can remain unchanged during refactoring.</p>\n\n<ol start=\"3\">\n<li>When the implementation of the specific <code>Applicative</code> is unavailable. </li>\n</ol>\n\n<p>Sometimes a library will not export constructors for their data types. Instead they rely on functions to build valid instances of the types. Making that type a member of <code>Applicative</code> is one way to do this. The <code>IO</code> Monad (Applicative) is another example of a type for which a constructor just isn't available. Instead, we are forced to use <code>pure</code> (aka <code>return</code>). </p>\n"}], "owner": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3523, "favorite_count": 1, "accepted_answer_id": 51563993, "answer_count": 3, "score": 10, "last_activity_date": 1532717856, "creation_date": 1532500368, "last_edit_date": 1532501031, "question_id": 51512233, "link": "https://stackoverflow.com/questions/51512233/what-is-the-purpose-of-pure-in-applicative-functor", "title": "What is the purpose of `pure` in Applicative Functor", "body": "<blockquote>\n  <p>Meet the Applicative typeclass. It lies in the Control.Applicative module and it defines two methods, <code>pure and &lt;*&gt;</code>. It doesn't provide a default implementation for any of them, so we have to define them both if we want something to be an applicative functor.</p>\n</blockquote>\n\n<p>I am trying to understand who is using <code>pure</code> function. I do use <code>(&lt;*&gt;)</code> function for which applicative functors are most useful for. But I am not sure who really uses <code>pure</code>.</p>\n\n<p>I read something like <code>pure (+3) &lt;*&gt; Just 10</code> but it can be written as <code>Just (+3) &lt;*&gt; Just 10</code> too.</p>\n\n<p>Above is just one confusion of too many I have. What is the true purpose of defining <code>pure</code> and when do I get to use it (or) who is already using it?</p>\n"}, {"tags": ["haskell", "functional-programming", "algebraic-data-types"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1532623234, "post_id": 51509949, "comment_id": 90055291, "body": "to sum up the answers: 1. plain records of three Float values, tagged as &quot;Circle&quot;; 2. we just did, with the <code>data</code> declaration."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 19, "last_activity_date": 1557018736, "last_edit_date": 1557018736, "creation_date": 1532488111, "answer_id": 51510246, "question_id": 51509949, "link": "https://stackoverflow.com/questions/51509949/what-do-haskell-data-constructors-construct/51510246#51510246", "title": "What do Haskell (data) constructors construct?", "body": "<p>In Haskell, without considering the underlying implementation, a data constructor creates a value, essentially by fiat. &ldquo;&thinsp;&lsquo;Let there be a <code>Circle</code>&rsquo;, said the programmer, and there was a <code>Circle</code>.&rdquo; Asking what <code>Circle 1 2 3</code> creates is akin to asking what the literal <code>1</code> creates in Python or Java.</p>\n\n<p>A nullary constructor is closer to what you usually think of as a literal. The <code>Boolean</code> type is <em>literally</em> defined as </p>\n\n<pre><code>data Boolean = True | False\n</code></pre>\n\n<p>where <code>True</code> and <code>False</code> are data constructors, not literals defined by Haskell grammar.</p>\n\n<p>The data type is also the definition of the constructor; as there isn't really anything to a value beyond the constructor name and its arguments, simply stating it <em>is</em> the definition. You create a value of type <code>Circle</code> by calling the data constructor <code>Circle</code> with 3 arguments, and that's it.</p>\n\n<p>A so-called \"smart constructor\" is just a function that calls a data constructor, with perhaps some other logic to restrict which instances can be created. For example, consider a simple wrapper around <code>Integer</code>:</p>\n\n<pre><code>newtype PosInteger = PosInt Integer\n</code></pre>\n\n<p>The constructor is <code>PosInt</code>; a smart constructor might look like</p>\n\n<pre><code>mkPosInt :: Integer -&gt; PosInteger\nmkPosInt n | n &gt; 0 = PosInt n\n           | otherwise = error \"Argument must be positive\"\n</code></pre>\n\n<p>With <code>mkPosInt</code>, there is no way to create a <code>PosInteger</code> value with a non-positive argument, because only positive arguments actually call the data constructor. A smart constructor makes the most sense when it, and not the data constructor, is exported by a module, so that a typical user cannot create arbitrary instances (because the data constructor does not exist outside the module).</p>\n"}, {"comments": [{"owner": {"reputation": 2127, "user_id": 1935088, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/huPA6.jpg?s=128&g=1", "display_name": "Ashley Aitken", "link": "https://stackoverflow.com/users/1935088/ashley-aitken"}, "edited": false, "score": 0, "creation_date": 1532499467, "post_id": 51510390, "comment_id": 89992419, "body": "Yes, thanks.  I guessed this was the case but could not find confirmation anywhere (easily).  I&#39;m thinking there could perhaps be a better word to use than constructor (specifically for those coming from OO).  In fact, I think it may be easier to think of all data constructors as literals, just in a very big space that is too large to enumerate :-)  For example, Circle 1.0 2.0 3.0 as a literal?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 2127, "user_id": 1935088, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/huPA6.jpg?s=128&g=1", "display_name": "Ashley Aitken", "link": "https://stackoverflow.com/users/1935088/ashley-aitken"}, "edited": false, "score": 2, "creation_date": 1532527717, "post_id": 51510390, "comment_id": 90010769, "body": "Yes, that seems fairly accurate.  Of course, you can write <code>Circle (10&#47;10) (1+1) (sqrt 9)</code> which looks less literal, but it&#39;s a literal in much the same sense a Javascript array or object literal or a Python tuple literal is a literal."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1532534488, "post_id": 51510390, "comment_id": 90015385, "body": "In an expression context, a constructor really <i>is</i> a function (or value). Ultimately, a non-nullary constructor is compiled to (inlined) code that allocates a heap object. What makes that so different from another function? In a pattern context, a constructor takes on an entirely different meaning to the compiler, of course."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1532539055, "post_id": 51510390, "comment_id": 90017647, "body": "Reasonable people can disagree, but I stand by my claim that a constructor isn&#39;t a function, and calling it one (which includes claiming it really is a function in one context but not another) trivializes the differences and -- as evidenced by this question -- mostly causes confusion."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1532540075, "post_id": 51510390, "comment_id": 90018166, "body": "I&#39;ve updated my answer, though, to avoid claiming that the &quot;constructor as function&quot; view is a &quot;mistake&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1532603806, "post_id": 51510390, "comment_id": 90042542, "body": "... and the closest we can come to Haskell constructors in OO -- say, C++ -- is with compound data types, aka records, aka structs: in pseudocode <code>struct {float x,y,r} circle; main(){ struct circle c1; &#47;* here c1 is created with its fields still _unassigned_ *&#47; c1.x = 0.0; &#47;* etc. *&#47; }</code>. There&#39;s no &quot;unassigned&quot; in Haskell, and so <code>c1 = Circle 0.0 1.0 2.0</code> creates it in one step. For sum types, we add tagged unions to the above. SICP calls this &quot;tagged lists&quot;; EOPL has <code>variant-case</code> to handle these; etc."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 13, "last_activity_date": 1532539921, "last_edit_date": 1532539921, "creation_date": 1532489489, "answer_id": 51510390, "question_id": 51509949, "link": "https://stackoverflow.com/questions/51509949/what-do-haskell-data-constructors-construct/51510390#51510390", "title": "What do Haskell (data) constructors construct?", "body": "<p>Good question.  As you know, given the definition:</p>\n\n<pre><code>data Foo = A | B Int\n</code></pre>\n\n<p>this defines a type with a (nullary) type constructor <code>Foo</code> and two data constructors, <code>A</code> and <code>B</code>.</p>\n\n<p>Each of these data constructors, when fully applied (to no arguments in the case of <code>A</code> and to a single <code>Int</code> argument in the case of <code>B</code>) constructs a value of type <code>Foo</code>.  So, when I write:</p>\n\n<pre><code>a :: Foo\na = A\n\nb :: Foo\nb = B 10\n</code></pre>\n\n<p>the names <code>a</code> and <code>b</code> are bound to two values of type <code>Foo</code>.</p>\n\n<p><strong>So, data constructors for type <code>Foo</code> construct values of type <code>Foo</code>.</strong></p>\n\n<p>What are values of type <code>Foo</code>?  Well, first of all, they are different from values of any other type.  Second, they are wholly defined by their data constructors.  There is a distinct value of type <code>Foo</code>, different from all other values of <code>Foo</code>, for each combination of a data constructor with a set of distinct arguments passed to that data constructor.  That is, two values of type <code>Foo</code> are identical if and only if they were constructed with the same data constructor given identical sets of arguments.  (\"Identical\" here means something different from \"equality\", which may not necessarily be defined for a given type <code>Foo</code>, but let's not get into that.)</p>\n\n<p>That's also what makes data constructors different from functions in Haskell.  If I have a function:</p>\n\n<pre><code>bar :: Int -&gt; Bool\n</code></pre>\n\n<p>It's possible that <code>bar 1</code> and <code>bar 2</code> might be exactly the same value.  For example, if <code>bar</code> is defined by:</p>\n\n<pre><code>bar n = n &gt; 0\n</code></pre>\n\n<p>then it's obvious that <code>bar 1</code> and <code>bar 2</code> (and <code>bar 3</code>) are identically <code>True</code>.  Whether the value of <code>bar</code> is the same for different values of its arguments will depend on the function definition.</p>\n\n<p>In contrast, if <code>Bar</code> is a constructor:</p>\n\n<pre><code>data BarType = Bar Int\n</code></pre>\n\n<p>then it's never going to be the case that <code>Bar 1</code> and <code>Bar 2</code> are the same value.  By definition, they will be different values (of type <code>BarType</code>).</p>\n\n<p>By the way, the idea that constructors are just a special kind of function is a common viewpoint.  I personally think this is inaccurate and causes confusion.  While it's true that constructors can often be used as if they are functions (specifically that they behave very much like functions when used in expressions), I don't think this view stands up under much scrutiny -- constructors are represented differently in the surface syntax of the language (with capitalized identifiers), can be used in contexts (like pattern matching) where functions cannot be used, are represented differently in compiled code, etc.</p>\n\n<p>So, when you ask \"can we define the constructor function\", the answer is \"no\", because there is no constructor function.  Instead, a constructor like <code>A</code> or <code>B</code> or <code>Bar</code> or <code>Circle</code> is what it is -- something different from a function (that sometimes behaves like a function with some special additional properties) which is capable of constructing a value of whatever type the data constructor belongs to.</p>\n\n<p>This makes Haskell constructors very different from OO constructors, but that's not surprising since Haskell values are very different from OO objects.  In an OO language, you can typically provide a constructor function that does some processing in building the object, so in Python you might write:</p>\n\n<pre><code>class Bar:\n    def __init__(self, n):\n        self.value = n &gt; 0\n</code></pre>\n\n<p>and then after:</p>\n\n<pre><code>bar1 = Bar(1)\nbar2 = Bar(2)\n</code></pre>\n\n<p>we have two distinct objects <code>bar1</code> and <code>bar2</code> (which would satify <code>bar1 != bar2</code>) that have been configured with the same field values and are in some sense \"equal\".  This is sort of halfway between the situation above with <code>bar 1</code> and <code>bar 2</code> creating two identical values (namely <code>True</code>) and the situation with <code>Bar 1</code> and <code>Bar 2</code> creating two distinct values that, by definition, can't possibly be the \"same\" in any sense.</p>\n\n<p>You can never have this situation with Haskell constructors.  Instead of thinking of a Haskell constructor as running some underlying function to \"construct\" an object which might involve some cool processing and deriving of field values, you should instead think of a Haskell constructor as a passive tag attached to a value (which may also contain zero or more other values, depending on the arity of the constructor).</p>\n\n<p>So, in your example, <code>Circle 10 20 5</code> doesn't \"construct\" an object of type <code>Circle</code> by running some function.  It directly creates a tagged object that, in memory, will look something like:</p>\n\n<pre><code>&lt;Circle tag&gt;\n&lt;Float value 10&gt;\n&lt;Float value 20&gt;\n&lt;Float value 5&gt;\n</code></pre>\n\n<p>(or you can at least pretend that's what it looks like in memory).</p>\n\n<p>The closest you can come to OO constructors in Haskell is using smart constructors.  As you note, eventually a smart constructor just calls a regular constructor, because that's the only way to create a value of a given type.  No matter what kind of bizarre smart constructor you build to create a <code>Circle</code>, the value it constructs will need to look like:</p>\n\n<pre><code>&lt;Circle tag&gt;\n&lt;some Float value&gt;\n&lt;another Float value&gt;\n&lt;a final Float value&gt;\n</code></pre>\n\n<p>which you'll need to construct with a plain old <code>Circle</code> constructor call.  There's nothing else the smart constructor could return that would still be a <code>Circle</code>.  That's just how Haskell works.</p>\n\n<p>Does that help?</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532674576, "post_id": 51549110, "comment_id": 90071645, "body": "SO is badly broken, is too much time-dependent. your great answer only got a small number of views! (and more than one of those are from me.) :[  The more answers we add, the more less discoverable in the future they become. And there&#39;s no mechanism for the &quot;community&quot; to assign weight/importance to entries so that the system would propagate them more. if our goal is a set of canonical Q&amp;A entries -- much less the actual knowledge discovery and maintenance system -- then SO is definitely <b>not it</b>. (IMO the root cause is the &quot;one man one vote&quot; attitude.) cf. meta.stackoverflow.com/q/366192 :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532674895, "post_id": 51549110, "comment_id": 90071799, "body": "also, we need a classification of entries for their target audience level -- novice, beginner .. expert (even better, paragraphs (auto-)collapsible dependent on the reader&#39;s level!). but SO is too rigid, and meta is affected by different communities with diff&#39;t attitudes, -- no hope for any meaningful change. looking back, if all these efforts were spent on the long abandoned haskellwiki / haskell wikibook(s), maybe the <i>Haskell</i> community overall would&#39;ve been the better for it. (some kind of reputation tracking system probably would need to have been added, for that to have happened). alas."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532734363, "post_id": 51549110, "comment_id": 90100092, "body": "@WillNess: Thanks, and yeah, I feel it\u2014sometimes I\u2019ll even refrain from upvoting a question for a while after answering it so that my answer gets another round of views when I bump the question by upvoting it. I suppose I (or you or anybody) could share a question/answer elsewhere as well, if it seems useful or interesting enough to put in front of a wider audience such as /r/haskell."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532798090, "post_id": 51549110, "comment_id": 90112972, "body": "Didn&#39;t know mere upvoting bumps the question. Where does it do that?  I usually open a tag-based search page, and choose either &quot;newest&quot; or &quot;active&quot;. I don&#39;t think it&#39;s showing up there."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532809059, "post_id": 51549110, "comment_id": 90115597, "body": "@WillNess: I think voting counts as \u201cactivity\u201d\u2014might be mistaken. I usually browse <a href=\"https://stackoverflow.com/questions/tagged/haskell\">questions/tagged/haskell</a> by \u201cnewest\u201d though when trawling for questions."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 10, "last_activity_date": 1532734111, "last_edit_date": 1532734111, "creation_date": 1532650601, "answer_id": 51549110, "question_id": 51509949, "link": "https://stackoverflow.com/questions/51509949/what-do-haskell-data-constructors-construct/51549110#51549110", "title": "What do Haskell (data) constructors construct?", "body": "<p>I\u2019m going to answer this in a somewhat roundabout way, with an example that I hope illustrates my point, which is that Haskell <em>decouples</em> several distinct ideas that are coupled in OOP under the concept of a \u201cclass\u201d. Understanding this will help you translate your experience from OOP into Haskell with less difficulty. The example in OOP pseudocode:</p>\n\n<pre><code>class Person {\n\n    private int id;\n    private String name;\n\n    public Person(int id, String name) {\n        if (id == 0)\n            throw new InvalidIdException();\n        if (name == \"\")\n            throw new InvalidNameException();\n\n        this.name = name;\n        this.id = id;\n    }\n\n    public int getId() { return this.id; }\n\n    public String getName() { return this.name; }\n\n    public void setName(String name) { this.name = name; }\n\n}\n</code></pre>\n\n<p>In Haskell:</p>\n\n<pre><code>module Person\n  ( Person\n  , mkPerson\n  , getId\n  , getName\n  , setName\n  ) where\n\ndata Person = Person\n  { personId :: Int\n  , personName :: String\n  }\n\nmkPerson :: Int -&gt; String -&gt; Either String Person\nmkPerson id name\n  | id == 0 = Left \"invalid id\"\n  | name == \"\" = Left \"invalid name\"\n  | otherwise = Right (Person id name)\n\ngetId :: Person -&gt; Int\ngetId = personId\n\ngetName :: Person -&gt; String\ngetName = personName\n\nsetName :: String -&gt; Person -&gt; Either String Person\nsetName name person = mkPerson (personId person) name\n</code></pre>\n\n<p>Notice:</p>\n\n<ul>\n<li><p>The <code>Person</code> class has been translated to a <em>module</em> which happens to export a data type by the same name\u2014<em>types</em> (for domain representation and invariants) are decoupled from <em>modules</em> (for namespacing and code organisation).</p></li>\n<li><p>The fields <code>id</code> and <code>name</code>, which are specified as <code>private</code> in the <code>class</code> definition, are translated to ordinary (public) fields on the <code>data</code> definition, since in Haskell they\u2019re made private by omitting them from the export list of the <code>Person</code> module\u2014<em>definitions</em> and <em>visibility</em> are decoupled.</p></li>\n<li><p>The constructor has been translated into two parts: one (the <code>Person</code> data constructor) that simply initialises the fields, and another (<code>mkPerson</code>) that performs validation\u2014<em>allocation &amp; initialisation</em> and <em>validation</em> are decoupled. Since the <code>Person</code> type is exported, but its constructor is not, this is the only way for clients to construct a <code>Person</code>\u2014it\u2019s an \u201cabstract data type\u201d.</p></li>\n<li><p>The public interface has been translated to functions that <em>are</em> exported by the <code>Person</code> module, and the <code>setName</code> function that previously <em>mutated</em> the <code>Person</code> object has become a function that returns a new instance of the <code>Person</code> data type that happens to share the old ID. <strong>The OOP code has a bug</strong>: it should include a check in <code>setName</code> for the <code>name != \"\"</code> invariant; the Haskell code can avoid this by using the <code>mkPerson</code> smart constructor to ensure that all <code>Person</code> values are valid by construction. So <em>state transitions</em> and <em>validation</em> are also decoupled\u2014you only need to check invariants when constructing a value, because it can\u2019t change thereafter.</p></li>\n</ul>\n\n<p>So as for your actual questions:</p>\n\n<blockquote>\n  <ol>\n  <li>What is actually constructed by this function, specifically?</li>\n  </ol>\n</blockquote>\n\n<p>A constructor of a data type allocates space for the tag and fields of a value, sets the tag to which constructor was used to create the value, and initialises the fields to the arguments of the constructor. You can\u2019t override it because the process is completely mechanical and there\u2019s no reason (in normal safe code) to do so. It\u2019s an internal detail of the language and runtime.</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>Can we define the constructor function?</li>\n  </ol>\n</blockquote>\n\n<p>No\u2014if you want to perform additional validation to enforce invariants, you should use a \u201csmart constructor\u201d function which calls the lower-level data constructor. Because Haskell values are immutable by default, values can be made <em>correct by construction</em>; that is, when you don\u2019t have mutation, you don\u2019t need to enforce that all state <em>transitions</em> are correct, only that all states <em>themselves</em> are constructed correctly. And often you can arrange your types so that smart constructors aren\u2019t even necessary.</p>\n\n<p>The only thing you can change about the generated data constructor \u201cfunction\u201d is making its type signature <em>more restrictive</em> using GADTs, to help enforce more invariants at compile-time. And as a side note, GADTs also let you do <em>existential quantification</em>, which lets you carry around encapsulated/type-erased information at runtime, <em>exactly</em> like an OOP vtable\u2014so this is another thing that\u2019s decoupled in Haskell but coupled in typical OOP languages.</p>\n\n<p>Long story short (too late), you can do all the same things, you just arrange them differently, because Haskell provides the various features of OOP classes under separate orthogonal language features.</p>\n"}], "owner": {"reputation": 2127, "user_id": 1935088, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/huPA6.jpg?s=128&g=1", "display_name": "Ashley Aitken", "link": "https://stackoverflow.com/users/1935088/ashley-aitken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2311, "favorite_count": 2, "answer_count": 3, "score": 16, "last_activity_date": 1557018736, "creation_date": 1532485303, "last_edit_date": 1532543184, "question_id": 51509949, "link": "https://stackoverflow.com/questions/51509949/what-do-haskell-data-constructors-construct", "title": "What do Haskell (data) constructors construct?", "body": "<p>Haskell enables one to construct algebraic data types using type constructors and data constructors.  For example,</p>\n\n<pre><code>data Circle = Circle Float Float Float\n</code></pre>\n\n<p>and we are told this data constructor (Circle on right) is a function that constructs a circle when give data, e.g. x, y, radius.</p>\n\n<pre><code>Circle :: Float -&gt; Float -&gt; Float -&gt; Circle \n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>What is actually constructed by this function, specifically?  </p></li>\n<li><p>Can we define the constructor function?</p></li>\n</ol>\n\n<p>I've seen Smart Constructors but they just seem to be extra functions that eventually call the regular constructors.</p>\n\n<p>Coming from an OO background, constructors, of course, have imperative specifications.  In Haskell, they seem to be system-defined.</p>\n"}, {"tags": ["haskell", "ghcjs", "reflex"], "answers": [{"tags": [], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "is_accepted": true, "score": 2, "last_activity_date": 1532478542, "creation_date": 1532478542, "answer_id": 51509299, "question_id": 51505171, "link": "https://stackoverflow.com/questions/51505171/how-can-i-use-ghci-with-my-reflex-project-using-only-stack-yaml/51509299#51509299", "title": "How can I use ghci with my reflex project using only stack.yaml?", "body": "<p>The clue to the answer came from this project, <a href=\"https://github.com/nomeata/reflex-dom-fragment-shader-canvas\" rel=\"nofollow noreferrer\">https://github.com/nomeata/reflex-dom-fragment-shader-canvas</a>.</p>\n\n<p>Specifically, this flag: <code>package reflex-dom\n                     flags: +use-warp -webkit2gtk</code>.</p>\n\n<p>I have updated the git project above to reflect a working stack.yaml file.</p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 1, "accepted_answer_id": 51509299, "answer_count": 1, "score": 3, "last_activity_date": 1532478542, "creation_date": 1532456196, "question_id": 51505171, "link": "https://stackoverflow.com/questions/51505171/how-can-i-use-ghci-with-my-reflex-project-using-only-stack-yaml", "title": "How can I use ghci with my reflex project using only stack.yaml?", "body": "<p>I've removed nix from my reflex project, having replaced it with stack. Everything is good, except being able to use the repl. I've tried to create a minimal reflex project to demonstrate what I have tried, and the errors my attempt produces.</p>\n\n<p><a href=\"https://github.com/mlitchard/reflex-todo\" rel=\"nofollow noreferrer\">https://github.com/mlitchard/reflex-todo</a></p>\n\n<p>stack repl --stack-yaml=stack-ghc.yaml</p>\n\n<p>Truncated error log</p>\n\n<pre><code>Error: -- While building custom Setup.hs for package jsaddle-dom \n-0.9.2.0 using: /home/mlitchard/.stack/setup-exe-cache/x86_64- \nlinux/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack- \nwork/dist/x86_64-linux/Cabal-1.24.2.0 build lib:jsaddle-dom --ghc- \noptions \" -ddump-hi -ddump-to-file\" Process exited with code: \nExitFailure 1 Logs have been written to:\n\n/home/mlitchard/projects/git/reflex-todo/.stack-work/logs/jsaddle-dom-0.9.2.0.log\n\nPreprocessing library jsaddle-dom-0.9.2.0...\n[587 of 599] Compiling JSDOM.Custom.XMLHttpRequest ( \nsrc/JSDOM/Custom/XMLHttpRequest.hs, .stack-work/dist/x86_64- \nlinux/Cabal-1.24.2.0/build/JSDOM/Custom/XMLHttpRequest.o )\n\n/home/mlitchard/projects/git/reflex-todo/.stack- \nwork/downloaded/Vheiln5kqwE0/src/JSDOM/Custom/XMLHttpRequest.hs:39:46: \nerror:\n    \u2022 Could not deduce (Control.Monad.Catch.MonadThrow\n                      Language.Javascript.JSaddle.Types.JSM)\n    arising from a use of \u2018throwM\u2019\n  from the context: MonadDOM m\n    bound by the type signature for:\n               throwXHRError :: MonadDOM m =&gt; Maybe XHRError -&gt; m ()\n    at src/JSDOM/Custom/XMLHttpRequest.hs:38:1-53\n\u2022 In the second argument of \u2018(.)\u2019, namely \u2018throwM\u2019\n  In the second argument of \u2018maybe\u2019, namely \u2018(liftDOM . throwM)\u2019\n  In the expression: maybe (return ()) (liftDOM . throwM)\n\n/home/mlitchard/projects/git/reflex-todo/.stack- \nwork/downloaded/Vheiln5kqwE0/src/JSDOM/Custom/XMLHttpRequest.hs:42:20: \nerror:\n\u2022 No instance for (Control.Monad.Catch.MonadMask\n                     Language.Javascript.JSaddle.Types.JSM)\n    arising from a use of \u2018bracket\u2019\n\u2022 In the first argument of \u2018(.)\u2019, namely \u2018bracket aquire id\u2019\n  In the expression: bracket aquire id . const\n  In an equation for \u2018withEvent\u2019:\n      withEvent aquire = bracket aquire id . const\n\n/home/mlitchard/projects/git/reflex-todo/.stack- \nwork/downloaded/Vheiln5kqwE0/src/JSDOM/Custom/XMLHttpRequest.hs:45:31: \nerror:\n\u2022 Could not deduce (Control.Monad.Catch.MonadCatch\n                      Language.Javascript.JSaddle.Types.JSM)\n    arising from an operator section\n  from the context: MonadDOM m\n    bound by the type signature for:\n               send' :: MonadDOM m =&gt; XMLHttpRequest -&gt; Maybe JSVal -&gt; m ()\n    at src/JSDOM/Custom/XMLHttpRequest.hs:44:1-62\n\u2022 In the expression: (`onException` abort self)\n  In the second argument of \u2018($)\u2019, namely\n    \u2018(`onException` abort self)\n     $ do { result &lt;- liftIO newEmptyMVar;\n            r &lt;- withEvent\n                   (onAsync self Generated.error . liftIO\n                    $ putMVar result (Just XHRError))\n                 $ withEvent\n                     (onAsync self abortEvent . liftIO\n                      $ putMVar result (Just XHRAborted))\n                   $ withEvent (onAsync self load . liftIO $ putMVar result Nothing)\n                     $ do { void\n                            $ case mbVal of {\n                                Nothing -&gt; ...\n                                Just val -&gt; ... };\n                            liftIO $ takeMVar result };\n            throwXHRError r }\u2019\n  In the expression:\n    liftDOM\n    $ (`onException` abort self)\n      $ do { result &lt;- liftIO newEmptyMVar;\n             r &lt;- withEvent\n                    (onAsync self Generated.error . liftIO\n                     $ putMVar result (Just XHRError))\n                  $ withEvent\n                      (onAsync self abortEvent . liftIO\n                       $ putMVar result (Just XHRAborted))\n                    $ withEvent (onAsync self load . liftIO $ putMVar result Nothing)\n                      $ do { void\n                             $ case mbVal of {\n                                 Nothing -&gt; ...\n                                 Just val -&gt; ... };\n                             liftIO $ takeMVar result };\n             throwXHRError r }\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1532452722, "post_id": 51504277, "comment_id": 89977332, "body": "What happened when you tried to compile this?"}, {"owner": {"reputation": 91, "user_id": 9225974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c64efccc21c8c7b16c70047cc213a93?s=128&d=identicon&r=PG&f=1", "display_name": "Bronia Berlin", "link": "https://stackoverflow.com/users/9225974/bronia-berlin"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1532453010, "post_id": 51504277, "comment_id": 89977527, "body": "the compiler could not match the Type Int with month or year"}, {"owner": {"reputation": 91, "user_id": 9225974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c64efccc21c8c7b16c70047cc213a93?s=128&d=identicon&r=PG&f=1", "display_name": "Bronia Berlin", "link": "https://stackoverflow.com/users/9225974/bronia-berlin"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1532453027, "post_id": 51504277, "comment_id": 89977539, "body": "yeartoday year = ((year-1)*365) this line is also wrong"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1532454169, "post_id": 51504277, "comment_id": 89978217, "body": "Can you add the error messages you&#39;re seeing (or at least the first part of them) to your question?  This has a number of benefits -- it helps people searching for a similar question to find it, and it helps potential answerers ensure that they are talking about the same error as you are."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1532455526, "post_id": 51504277, "comment_id": 89978911, "body": "Your <code>monthtoday</code> doesn&#39;t take the year into account. February occasionally has 29 days, not 28."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 3, "last_activity_date": 1532454397, "creation_date": 1532454397, "answer_id": 51504738, "question_id": 51504277, "link": "https://stackoverflow.com/questions/51504277/how-to-convert-date-to-days-in-haskell/51504738#51504738", "title": "How to convert Date to days in Haskell?", "body": "<p>There are two problems with your code:</p>\n\n<pre><code>yeartoday :: year -&gt; day\n</code></pre>\n\n<p><code>year</code> and <code>day</code> should be capitalised. If you don't, this is equivalent to <code>a -&gt; b</code>, since uncapitalised identifiers are seen as type variables. This applies to your other signatures. So, this should be: </p>\n\n<pre><code>yeartoday :: Year -&gt; Day\n</code></pre>\n\n<p>And the same for the other signatures.</p>\n\n<p>Here's the second problem.</p>\n\n<pre><code>monthtoday month\n     |month 1 = 0\n     |month 2 = 31\n     (...)\n</code></pre>\n\n<p>The part where you write <code>month 1</code>, <code>month 2</code> etc. expects a <code>Bool</code>, so you need to compare <code>month</code> and each value, so this should be:</p>\n\n<pre><code>monthtoday month\n     |month == 1 = 0\n     |month == 2 = 31\n     (...)\n</code></pre>\n\n<p>But even better, you should rewrite this as:</p>\n\n<pre><code>monthtoday month = case month of\n    1 -&gt; 0\n    2 -&gt; 31\n    (..)\n</code></pre>\n\n<p>There are other errors to do with correctness, and there are better ways of doing this, but I'll leave this to you since the issue here is to do with the type system.</p>\n"}], "owner": {"reputation": 91, "user_id": 9225974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c64efccc21c8c7b16c70047cc213a93?s=128&d=identicon&r=PG&f=1", "display_name": "Bronia Berlin", "link": "https://stackoverflow.com/users/9225974/bronia-berlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1532454397, "creation_date": 1532452640, "last_edit_date": 1532452885, "question_id": 51504277, "link": "https://stackoverflow.com/questions/51504277/how-to-convert-date-to-days-in-haskell", "title": "How to convert Date to days in Haskell?", "body": "<p>So I have a problem... I have to write a programm for my college course where I count the exact number of days </p>\n\n<p>so for example</p>\n\n<p>the date January 1st, 0001 will be 1\nand the July 26nd, 2018 will be 736412</p>\n\n<p>Beneath I tried to solve this problem, but no luck. Can you point me to my mistake?</p>\n\n<pre><code>type Date = (Int, Int, Int)\n\ntype Year = Int\ntype Month = Int\ntype Day = Int\n\n\ndatetoday :: Date -&gt; Int\ndatetoday (year, month , day) = day + monthtoday month + yeartoday year\n\n\nyeartoday :: year -&gt; day\nyeartoday year = ((year-1)*365)\n\n\nmonthtoday :: month -&gt; day\nmonthtoday month\n     |month 1 = 0\n     |month 2 = 31\n     |month 3 = 59\n     |month 4 = 90\n     |month 5 = 120\n     |month 6 = 151\n     |month 7 = 181\n     |month 8 = 211\n     |month 9 = 243\n     |month 10 = 273\n     |month 11 = 304\n     |month 12 = 334\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1532451586, "post_id": 51503815, "comment_id": 89976695, "body": "I think this is your answer: <a href=\"https://stackoverflow.com/questions/14688119/redirecting-haskell-ghci-output-to-text-file#14688202\" title=\"redirecting haskell ghci output to text file%2314688202\">stackoverflow.com/questions/14688119/&hellip;</a>"}, {"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "reply_to_user": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1532451968, "post_id": 51503815, "comment_id": 89976898, "body": "Thx, I saw the post before. But I&#39;m looking for something that put in the ./ghc/ghci.conf and log all my output and input in the GHCI prompt."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1532452064, "post_id": 51503815, "comment_id": 89976938, "body": "<code>screen -L ghci</code> but this will log <i>literally</i> all input and output, including your editing actions."}, {"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1532453629, "post_id": 51503815, "comment_id": 89977881, "body": "I use tmux currently, but thanks for the suggestion."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 3, "creation_date": 1532453997, "post_id": 51503815, "comment_id": 89978118, "body": "The historic unix command for that is <a href=\"http://man7.org/linux/man-pages/man1/script.1.html\" rel=\"nofollow noreferrer\"><code>script</code></a>."}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1532450838, "creation_date": 1532450838, "question_id": 51503815, "link": "https://stackoverflow.com/questions/51503815/how-to-log-all-output-in-ghci-prompt", "title": "How to log all output in GHCI Prompt", "body": "<p>I would like to log all <strong>output and input</strong> to a file in GHCI.</p>\n\n<p>What I have done so far:</p>\n\n<p>I have tried to use <code>:h</code> in GHCI, but I did not see any <code>options</code> or <code>flags</code> to do so.</p>\n\n<p>I also have tried to search some configuration for <code>.ghc/ghci.conf</code> and I still have no luck. </p>\n\n<p>I knew the <code>.ghc/ghci_history</code> stores all the input :commands.  </p>\n\n<p>My GHCI version:  version 7.10.3</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1532450223, "post_id": 51503528, "comment_id": 89975942, "body": "You have a bare function call. A module can contain only definitions."}, {"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1532450768, "post_id": 51503528, "comment_id": 89976246, "body": "GHCi docs explain this, :load is for loading modules, as chepner says, you don&#39;t have a module, just a function call.  <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#ghci-cmd-:load\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "is_accepted": true, "score": 4, "last_activity_date": 1532450624, "creation_date": 1532450624, "answer_id": 51503751, "question_id": 51503528, "link": "https://stackoverflow.com/questions/51503528/why-doesnt-my-ord-function-work/51503751#51503751", "title": "Why doesn&#39;t my ord function work", "body": "<p>The error message is saying that <code>ord 'a'</code> is not</p>\n\n<ol>\n<li>A module header </li>\n<li>An import declaration</li>\n<li>A top-level declaration</li>\n</ol>\n\n<p>It basically doesn't know what to do with the result of evaluating <code>ord 'a'</code>. It would be valid to write <code>foo = ord 'a'</code> and in <code>ghci</code> you can then write <code>foo</code> and get the result of the evaluation.</p>\n"}], "owner": {"reputation": 3, "user_id": 10128975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94661e9bff95e4778c37e2c77de1511b?s=128&d=identicon&r=PG&f=1", "display_name": "tutu", "link": "https://stackoverflow.com/users/10128975/tutu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 51503751, "answer_count": 1, "score": -2, "last_activity_date": 1532450624, "creation_date": 1532449696, "question_id": 51503528, "link": "https://stackoverflow.com/questions/51503528/why-doesnt-my-ord-function-work", "title": "Why doesn&#39;t my ord function work", "body": "<p>I am pretty new to this language and I wrote this in Notepad and used it in ghci</p>\n\n<pre><code>import Data.Char\nord 'a'\n</code></pre>\n\n<p>In ghci it gives me this error </p>\n\n<pre><code>dayBefore.hs:2:1: error:\nParse error: module header, import declaration\nor top-level declaration expected.\n</code></pre>\n\n<p>When I write this in ghci it works though???</p>\n"}, {"tags": ["haskell", "types", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1532452911, "last_edit_date": 1532452911, "creation_date": 1532451203, "answer_id": 51503924, "question_id": 51502879, "link": "https://stackoverflow.com/questions/51502879/how-can-i-move-this-instance-method-definition-to-class-default/51503924#51503924", "title": "How can I move this instance method definition to class default?", "body": "<p>It appears that the following will work.  The idea is to instantiate <code>collection</code> at the right type in the default (with <code>collection @phantom</code>) which also requires <code>ScopedTypeVariables</code>.</p>\n\n<p><em>Update:</em> I see now that this is what you <em>tried</em> to do with your second attempt.  The problem is that your <code>where</code> clause defined an infinite loop, as the <code>collection</code> on the RHS is the same <code>collection</code> being bound on the LHS (insert facepalm as appropriate).</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n{-# LANGUAGE TypeApplications #-}\n\nmodule Collection where\n\nimport Data.Tagged\n\nclass Collected phantom\n  where\n    type Element phantom = r | r -&gt; phantom\n    type Element phantom = Tagged phantom Int\n\n    type Collection phantom = r | r -&gt; phantom\n    type Collection phantom = Tagged phantom [Int]\n\n    collection :: Collection phantom\n\n    inCollection :: Int -&gt; Maybe (Element phantom)\n    default inCollection :: ( Collection phantom ~ Tagged phantom [Int]\n                            , Element phantom ~ Tagged phantom Int)\n                            =&gt; Int -&gt; Maybe (Element phantom)\n    inCollection element\n        | element `elem` unTagged (collection @phantom) = Just $ Tagged element\n        | otherwise = Nothing\n\ndata Primes\n\ninstance Collected Primes\n  where\n    type Element Primes = Tagged Primes Int\n    type Collection Primes = Tagged Primes [Int]\n\n    collection = Tagged [2, 3, 5, 7, 11, 13, 17, 19, 23, 29]\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 51503924, "answer_count": 1, "score": 4, "last_activity_date": 1532452911, "creation_date": 1532447376, "question_id": 51502879, "link": "https://stackoverflow.com/questions/51502879/how-can-i-move-this-instance-method-definition-to-class-default", "title": "How can I move this instance method definition to class default?", "body": "<p>Consider this class, and an example instance.</p>\n\n<p>The purpose is to provide a type level switch that allows to convert the base type \u2014 <code>Int</code>, in this case, \u2014 to a proven predicate subtype, for future use. Granted, the class is somewhat contrived, but I extracted it from actual code, and I would populate it with more useful methods, save that I am stuck.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n{-# LANGUAGE TypeApplications #-}\n\nmodule Collection where\n\nimport Data.Tagged\n\n-- $setup\n--\n-- \u03bb :set -XTypeApplications\n\nclass Collected phantom\n  where\n    type Element phantom = r | r -&gt; phantom\n    type Element phantom = Tagged phantom Int\n\n    type Collection phantom = r | r -&gt; phantom\n    type Collection phantom = Tagged phantom [Int]\n\n    collection :: Collection phantom\n\n    inCollection :: Int -&gt; Maybe (Element phantom)\n\ndata Primes\n\ninstance Collected Primes\n  where\n    type Element Primes = Tagged Primes Int\n    type Collection Primes = Tagged Primes [Int]\n\n    collection = Tagged [2, 3, 5, 7, 11, 13, 17, 19, 23, 29]\n\n    -- inCollection :: Int -&gt; Maybe (Element Primes)\n    inCollection element\n        | element `elem` unTagged (collection @Primes) = Just $ Tagged element\n        | otherwise = Nothing\n\n-- ^\n-- \u03bb inCollection @Primes 7\n-- Just (Tagged 7)\n-- \u03bb inCollection @Primes 8\n-- Nothing\n</code></pre>\n\n<p><em>(This is a runnable code complete with repl tests that pass as written.)</em></p>\n\n<p>I will be dealing with several subtypes over the same base type that only differ by the definition of <code>collection</code>, while the method of proof is consistently lookup. So there is no reason not to have a default code for that method. However, I was not able to devise such code. My first draft fails to type check, while the second, adjusted draft runs, but does not seem to terminate.</p>\n\n<p>Here is the first draft:</p>\n\n<pre><code>...\n{-# LANGUAGE DefaultSignatures #-}\n...\n\nclass Collected phantom\n...\n    inCollection :: Int -&gt; Maybe (Element phantom)\n    default inCollection :: ( Element phantom    ~ Tagged phantom  Int\n                            , Collection phantom ~ Tagged phantom [Int] )\n                         =&gt; Int -&gt; Maybe (Element phantom)\n    inCollection element\n        | element `elem` unTagged collection = Just $ Tagged element\n        | otherwise = Nothing\n...\n</code></pre>\n\n<p>Here is the second:</p>\n\n<pre><code>...\n{-# LANGUAGE ScopedTypeVariables #-}\n...\n\nclass Collected phantom\n...\n    inCollection :: ...\n    default inCollection :: ...\n    inCollection ...\n      where\n        collection = (collection :: Collection phantom)\n</code></pre>\n\n<p><em>(Only the added parts are shown. The corresponding method definition in the instance was removed. In the second draft, the only addition aside from the pragma is the last line that attempts to type <code>collection</code>.)</em></p>\n\n<p>&nbsp;</p>\n\n<p>What is the problem? What can be done?</p>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1532443252, "post_id": 51500811, "comment_id": 89971143, "body": "Why do you not want to use another function? That would be the &#39;normal&#39; way to do something like this in Haskell."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1532443488, "post_id": 51500811, "comment_id": 89971322, "body": "You are making the same mistake with <code>let inHandle = (=&lt;&lt;ioIn)</code> that was pointed out in <a href=\"https://stackoverflow.com/q/51491915/1126841\">your previous question</a>. Please fix your code here using the <a href=\"https://stackoverflow.com/a/51493281/1126841\">answer you accepted</a> before trying to ask further questions about this."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1532455284, "post_id": 51500811, "comment_id": 89978771, "body": "Use <code>loop :: Handle -&gt; Handle -&gt; Int -&gt; IO Int</code> as the type instead, and pass 0 as the initial integer accumulator. In the recursive call, you can use <code>loop ioIn ioOut (accu+1)</code>"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1532455800, "post_id": 51500811, "comment_id": 89979065, "body": "Thanks for pointing me out i didn&#39;t know if i have to declare the variable with <code>let</code> or i can just name the binding on the go <code>x&gt;&gt;=y</code> ,y existing from that point on."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1532458117, "post_id": 51500811, "comment_id": 89980263, "body": "You cannot create a new binding with <code>&gt;&gt;=</code>. <code>&gt;&gt;=</code> is just a function (so its arguments must already exist). In a <code>do</code> block, you can only create a new binding with <code>let</code> or <code>&lt;-</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1532771552, "post_id": 51500811, "comment_id": 90106360, "body": "<code>inHandle&gt;&gt;= \\a -&gt;outHandle&gt;&gt;= \\b -&gt;loop a b 0&gt;&gt;=print . show</code> is really <code>inHandle &gt;&gt;= (\\a -&gt; outHandle &gt;&gt;= (\\b -&gt;loop a b 0 &gt;&gt;= (print . show)))</code> so when we get to the <code>(print . show)</code> both <code>b</code> and <code>a</code> are <i>in scope</i> -- the second  ( <code>\\b -&gt; ...</code>) lambda is <i>nested</i> inside the first ( <code>\\a -&gt; ...</code> ) lambda."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532782250, "post_id": 51500811, "comment_id": 90109055, "body": "(contd.) and <code>hGetLine inHandle &gt;&gt;= hPutStrLn outHandle &gt;&gt; loop inHandle outHandle (cnt + 1)</code> is really <code>((hGetLine inHandle) &gt;&gt;= (hPutStrLn outHandle)) &gt;&gt; (loop inHandle outHandle (cnt + 1))</code> which is the same as <code>((hGetLine inHandle) &gt;&gt;= (\\s -&gt; hPutStrLn outHandle s)) &gt;&gt;= (\\x -&gt; loop inHandle outHandle (cnt + 1))</code>."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1532556133, "post_id": 51509020, "comment_id": 90025142, "body": "<code>IORef</code> would be easier for a beginner to handle than <code>StateT</code> imo, but otherwise this is an excellent answer"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532624044, "post_id": 51509020, "comment_id": 90055711, "body": "I find the &quot;is an IO action&quot; language extremely confusing, even with the immediate qualifier about it being a &quot;recipe&quot;.  I think just saying &quot;is an IO action recipe&quot; right away is much much clearer. Could not agree more about starting with the do notation. (just thought of something -- what about using &quot;Doable&quot; for Monads, as the parallel of &quot;Mappable&quot; for Functors...? as hints for the newbies of course, not as a serious naming proposal.)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532625426, "post_id": 51509020, "comment_id": 90056425, "body": "contd. so, it would read as &quot;(1) In Haskell, any value of type <code>IO a</code> is an I/O actions recipe. This recipe describes some I/O actions that can be executed to perform some actual input/output resulting in producing some value of type <code>a</code>. So, a value of type <code>IO String</code> is an I/O actions recipe that, if executed, will perform those input/output actions and produce a value of type <code>String</code> as a result. ... (3) Several I/O actions recipes can be combined using do-notation into a single combined I/O actions recipe&quot; .... For your consideration. :) (haven&#39;t yet read the rest...)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532625871, "post_id": 51509020, "comment_id": 90056664, "body": "(cf. a <a href=\"https://stackoverflow.com/questions/11323300/using-return-vs-not-using-return-in-the-list-monad/11326549#11326549\">related answer</a> by Conor McBride, with a picture)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532626764, "post_id": 51509020, "comment_id": 90057081, "body": "but, having read through more of your excellent answer, I see that this change would necessitate a pretty extensive re-write, so, never mind. :) (to clarify: &quot;action&quot; is confusing to me because, for me, &quot;action&quot; is something that is already being executed, is already being performed)."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1584179507, "last_edit_date": 1584179507, "creation_date": 1532475718, "answer_id": 51509020, "question_id": 51500811, "link": "https://stackoverflow.com/questions/51500811/how-to-use-an-accumulator-in-a-recursive-io-action/51509020#51509020", "title": "How to use an accumulator in a recursive IO action", "body": "<p>It looks like the answer to your last question still left you confused.</p>\n\n<p><strong>tl;dr:</strong>  stop using <code>&gt;&gt;=</code> and <code>=&lt;&lt;</code> until you master the do-block notation which you can do by Googling \"understanding haskell io\" and working through lots of examples from tutorials.</p>\n\n<p>Long answer...</p>\n\n<p>First, I would suggest avoiding the <code>&gt;&gt;=</code> and <code>=&lt;&lt;</code> operators for now.  Even though they are sometimes named \"bind\", they don't bind variables or bind parameters to methods or anything else like that, and they seem to be tripping you up.  You may also find the <a href=\"https://www.haskell.org/tutorial/io.html\" rel=\"nofollow noreferrer\">section about IO from \"A Gentle Introduction to Haskell\"</a> helpful as a quick introduction to how IO works.</p>\n\n<p>Here's a very short explanation of IO that may help you, and it'll provide a basis for answering your question.  Google for \"understanding haskell io\" to get a more in-depth explanation:</p>\n\n<h3>Super short IO explanation in three paragraphs:</h3>\n\n<p>(1) In Haskell, any value of type <code>IO a</code> is an IO <strong>action</strong>.  An IO action is like a recipe that can be used (by <strong>executing</strong> the action) to perform some actual input/output and then produce a value of type <code>a</code>.  So, a value of type <code>IO String</code> is an action that, if executed, will perform some input/output and produce a value of type <code>String</code>, while an <code>IO ()</code> is an action that, if executed, will perform some input/output and produce a value of type <code>()</code>.  In the latter case, because values of type <code>()</code> are useless, actions of type <code>IO ()</code> are normally executed for their I/O side effects, such as printing a line of output.</p>\n\n<p>(2) The only way to execute an IO action in a Haskell program is to give it the special name <code>main</code>.  (The interactive interpreter GHCi provides more ways to execute IO actions, but let's ignore that.)</p>\n\n<p>(3) IO actions can be combined using do-notation into a larger IO action.  A <code>do</code> block consists of lines of the following form:</p>\n\n<pre><code>act             -- action to be executed, with the result\n                -- thrown away (unless it's the last line)\n\nx &lt;- act        -- action to be executed, with the result\n                -- named @x@ for later lines\n\nlet y = expr    -- add a name @y@ for the value of @expr@\n                -- for later lines, but this has nothing to\n                -- do with executing actions\n</code></pre>\n\n<p>In the above templates, <code>act</code> can be any expression that evaluates to an IO action (i.e., a value of type <code>IO a</code> for some <code>a</code>).  It's important to understand that the do-block does not itself execute any IO actions.  Instead, it builds a new IO action that -- when executed -- will execute the given set of IO actions in the order they appear in the do-block, either throwing away or naming the values produced by executing these actions.  The value produced by executing the whole do-block will be the value produced by the last line of the do-block (which has to be a line of the first form above).</p>\n\n<h3>A simple exmple</h3>\n\n<p>Therefore, if a Haskell program includes:</p>\n\n<pre><code>myAction :: IO ()\nmyAction = do\n  putStrLn \"Your name?\"\n  x &lt;- getLine\n  let stars = \"***\"\n  putStrLn (stars ++ x ++ stars)\n</code></pre>\n\n<p>then this defines a value <code>myAction</code> of type <code>IO ()</code>, an IO action.  By itself, it does nothing, but if it is ever executed, then it will execute each of the IO actions (values of type <code>IO a</code> for various types <code>a</code>) in the do-block in the order they appear.  The value produced by executing <code>myAction</code> will be the value produced by the last line (in this case, the value <code>()</code> of type <code>()</code>).</p>\n\n<h3>Applied to the problem of copying lines</h3>\n\n<p>Armed with this explanation, let's tackle your question.  First, how do we write a Haskell program to copy lines from one file to another using a loop, ignoring the problem of counting lines?  Here's one way that's fairly similar to your code example:</p>\n\n<pre><code>import System.IO\n\nmyAction :: IO ()\nmyAction = do\n  inHandle &lt;- openFile \"in.txt\" ReadMode\n  outHandle &lt;- openFile \"out.txt\" WriteMode\n  loop inHandle outHandle\n  hClose outHandle\n  hClose inHandle\n</code></pre>\n\n<p>Here, if we check the type of one of these <code>openFile</code> calls in GHCi:</p>\n\n<pre><code>&gt; :t openFile \"in.txt\" ReadMode\nopenFile \"in.txt\" ReadMode :: IO Handle\n&gt;\n</code></pre>\n\n<p>we see that it has type <code>IO Handle</code>.  That is, this is an IO <strong>action</strong> that, when executed, performs some actual I/O (namely an operating system call to open a file) and then produces a value of type <code>Handle</code>, which is the Haskell value representing the open file handle.  In your original version, when you wrote:</p>\n\n<pre><code>let inHandle = openFile \"in.txt\" ReadMode\n</code></pre>\n\n<p>all this did was assign a name <code>inHandle</code> to an IO action -- it didn't actually execute the IO action and so didn't actually open the file.  In particular, the value of <code>inHandle</code> of type <code>IO Handle</code> was not <em>itself</em> a file handle, just an IO action (or \"recipe\") for producing a file handle.</p>\n\n<p>In the version of <code>myAction</code> above, we've used the notation:</p>\n\n<pre><code>inHandle &lt;- openFile \"in.txt\" ReadMode\n</code></pre>\n\n<p>to indicate that, if and when the IO action named by <code>myAction</code> is ever executed, it will start by executing the IO action <code>openFile \"in.txt\" ReadMode\"</code> (that is, the value of that expression which has type <code>IO Handle</code>), and that execution will produce a <code>Handle</code> which will be named <code>inHandle</code>.  Ditto for the next line to produce and name an open <code>outHandle</code>.  We will then pass these open handles to <code>loop</code> in the expression <code>loop inHandle outHandle</code>.</p>\n\n<p>Now, <code>loop</code> can be defined like so:</p>\n\n<pre><code>loop :: Handle -&gt; Handle -&gt; IO ()\nloop inHandle outHandle = do\n  end &lt;- hIsEOF inHandle\n  if end\n    then return ()\n    else do\n      line &lt;- hGetLine inHandle\n      hPutStrLn outHandle line\n      loop inHandle outHandle\n</code></pre>\n\n<p>It's worth taking a moment to explain this.  <code>loop</code> is a fuction that takes two arguments, each <code>Handle</code>.  When it's applied to two handles, as in the expression <code>loop inHandle outHandle</code>, the resulting value is of type <code>IO ()</code>.  That means it's an IO action, specifically, the IO action created by the outer do-block in the definition of <code>loop</code>.  This do-block creates an IO action that -- when it is executed -- executes two IO actions in order, as given by the lines of the outer do-block.  The first line is:</p>\n\n<pre><code>end &lt;- hIsEOF inHandle\n</code></pre>\n\n<p>which takes the IO action <code>hEof inHandle</code> (a value of type <code>IO Bool</code>), executes it (which consists of asking the operating system if we've reached the end of file for the file represented by handle <code>inHandle</code>), and names the result <code>end</code> -- note that <code>end</code> will be a value of type <code>Bool</code>.</p>\n\n<p>The second line of the do-block is the entire <code>if</code> statement.  It produces a value of type <code>IO ()</code>, so a second IO action.  The IO action depends on the value of <code>end</code>.  If <code>end</code> is true, the IO action will be the value of <code>return ()</code> which, if executed, will perform no actual I/O and will produce a value <code>()</code> of type <code>()</code>.  If <code>end</code> is false, the IO action will be the value of the inner do-block.  This inner do-block is an IO action (a value of type <code>IO ()</code>) which, if executed, will execute three IO actions in order:</p>\n\n<ol>\n<li><p>The IO action <code>hGetLine inHandle</code>, a value of type <code>IO String</code> that, when executed, will read a line from <code>inHandle</code> and produce the resulting <code>String</code>.  As per the do-block, this result will be given the name <code>line</code>.</p></li>\n<li><p>The IO action <code>hPutStrLn outHandle line</code>, a value of type <code>IO ()</code> that, when exectued, will write <code>line</code> to <code>outHandle</code>.</p></li>\n<li><p>The IO action <code>loop inHandle outHandle</code>, a recursive use of the IO action produced by the outer do-block, which -- when executed -- starts the whole process over again, starting with the EOF check.</p></li>\n</ol>\n\n<p>If you put these two definitions (for <code>myAction</code> and <code>loop</code>) in a program, they won't do anything, because they're just definitions of IO actions.  The only way to have them execute is to name one of them <code>main</code>, like so:</p>\n\n<pre><code>main :: IO ()\nmain = myAction\n</code></pre>\n\n<p>Of course, we could have just used the name <code>main</code> in place of <code>myAction</code> to get the same effect, as in the whole program:</p>\n\n<pre><code>import System.IO\n\nmain :: IO ()\nmain = do\n  inHandle &lt;- openFile \"in.txt\" ReadMode\n  outHandle &lt;- openFile \"out.txt\" WriteMode\n  loop inHandle outHandle\n  hClose inHandle\n  hClose outHandle\n\nloop :: Handle -&gt; Handle -&gt; IO ()\nloop inHandle outHandle = do\n  end &lt;- hIsEOF inHandle\n  if end\n    then return ()\n    else do\n      line &lt;- hGetLine inHandle\n      hPutStrLn outHandle line\n      loop inHandle outHandle\n</code></pre>\n\n<p>Take some time to compare this to your \"concrete example\" above, and see where it's different and where it's simliar.  In particular, can you figure out why I wrote:</p>\n\n<pre><code>end &lt;- hIsEOF inHandle\nif end\n  then ...\n</code></pre>\n\n<p>instead of:</p>\n\n<pre><code>if hIsEOF inHandle\n  then ...\n</code></pre>\n\n<h3>Copying lines with a line count</h3>\n\n<p>To modify this program to count lines, a fairly standard way to do it would be to make the count a parameter to the <code>loop</code> function, and have <code>loop</code> produce the final value of the count.  Since the expression <code>loop inHandle outHandle</code> is an IO action (above, it's of type <code>IO ()</code>), to have it produce a count we need to give it type <code>IO Int</code>, as you've done in your example.  It will still be an IO action but now -- when it is executed -- it'll produce a useful <code>Int</code> value instead of a useless <code>()</code> value.</p>\n\n<p>To make this change, <code>main</code> will have to invoke loop with a starting counter, name the value it produces, and output that value to the user.</p>\n\n<p>To make it absolutely clear:  <code>main</code>'s value is still an IO action created by a do-block.  We're just modifying one of the lines of the do-block.  It used to be:</p>\n\n<pre><code>loop inHandle outHandle\n</code></pre>\n\n<p>which evaluated to a value of type <code>IO ()</code> representing an IO action that -- when the whole do-block was executed -- would be executed when its turn came to copy the lines from one file to the other before producing a <code>()</code> value to be thrown away.  Now, it's going to be:</p>\n\n<pre><code>count &lt;- loop inHandle outHandle 0\n</code></pre>\n\n<p>where the right-hand side will evaluate to a value of type <code>IO Int</code> representing an IO action that -- when the whole do-block is executed -- will be executed when its turn comes to copy the lines from one file to the other before producing a count value of type <code>Int</code> to be named <code>count</code> for later do-block steps.</p>\n\n<p>Anyway, the modified <code>main</code> looks like this:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  inHandle &lt;- openFile \"in.txt\" ReadMode\n  outHandle &lt;- openFile \"out.txt\" WriteMode\n  count &lt;- loop inHandle outHandle 0\n  hClose inHandle\n  hClose outHandle\n  putStrLn (show count)    -- could just write @print count@\n</code></pre>\n\n<p>Now, we rewrite <code>loop</code> to maintain a count (taking the running count as a parameter through recursive calls and producing the final value when the IO action is executed):</p>\n\n<pre><code>loop :: Handle -&gt; Handle -&gt; Int -&gt; IO Int\nloop inHandle outHandle count = do\n  end &lt;- hIsEOF inHandle\n  if end\n    then return count\n    else do\n      line &lt;- hGetLine inHandle\n      hPutStrLn outHandle line\n      loop inHandle outHandle (count + 1)\n</code></pre>\n\n<p>The whole program is:</p>\n\n<pre><code>import System.IO\n\nmain :: IO ()\nmain = do\n  inHandle &lt;- openFile \"in.txt\" ReadMode\n  outHandle &lt;- openFile \"out.txt\" WriteMode\n  count &lt;- loop inHandle outHandle 0\n  hClose inHandle\n  hClose outHandle\n  putStrLn (show count)    -- could just write @print count@\n\nloop :: Handle -&gt; Handle -&gt; Int -&gt; IO Int\nloop inHandle outHandle count = do\n  end &lt;- hIsEOF inHandle\n  if end\n    then return count\n    else do\n      line &lt;- hGetLine inHandle\n      hPutStrLn outHandle line\n      loop inHandle outHandle (count + 1)\n</code></pre>\n\n<h3>The rest of your question</h3>\n\n<p>Now, you asked about how to use an accumulator within a do-block without using another function.  I don't know if you meant without using another function besides <code>loop</code> (in which case the answer above satisfies the requirement) or if you meant without using any explicit <code>loop</code> at all.</p>\n\n<p>If the latter, there are a couple of approaches.  First, there are monadic loop combinators available in the <code>monad-loops</code> package that can allow you to do the following (to copy without counting).  I've also switched to using <code>withFile</code> in place of explicit open/close calls:</p>\n\n<pre><code>import Control.Monad.Loops\nimport System.IO\nmain :: IO ()\nmain =\n  withFile \"in.txt\" ReadMode $ \\inHandle -&gt;\n  withFile \"out.txt\" WriteMode $ \\outHandle -&gt;\n    whileM_ (not &lt;$&gt; hIsEOF inHandle) $ do\n      line &lt;- hGetLine inHandle\n      hPutStrLn outHandle line\n</code></pre>\n\n<p>and you can count lines with a state monad:</p>\n\n<pre><code>import Control.Monad.State\nimport Control.Monad.Loops\nimport System.IO\nmain :: IO ()\nmain = do\n  n &lt;- withFile \"in.txt\" ReadMode $ \\inHandle -&gt;\n       withFile \"out.txt\" WriteMode $ \\outHandle -&gt;\n       flip execStateT 0 $\n         whileM_ (not &lt;$&gt; liftIO (hIsEOF inHandle)) $ do\n           line &lt;- liftIO (hGetLine inHandle)\n           liftIO (hPutStrLn outHandle line)\n           modify succ\n  print n\n</code></pre>\n\n<p>With respect to removing the last <code>do</code> block from the definition of <code>loop</code> above, there's no good reason to do this.  It's not like <code>do</code> blocks have overhead or introduce some extra processing pipeline or something.  They're just ways of constructing IO action values.  So, you <em>could</em> replace:</p>\n\n<pre><code>else do\n  line &lt;- hGetLine inHandle\n  hPutStrLn outHandle line\n  loop inHandle outHandle (count + 1)\n</code></pre>\n\n<p>with</p>\n\n<pre><code>else hGetLine inHandle &gt;&gt;= hPutStrLn outHandle &gt;&gt; loop inHandle outHandle (count + 1)\n</code></pre>\n\n<p>but this is a purely syntactic change.  The two are otherwise identical (and will almost certainly compile to equivalent code).</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 51509020, "answer_count": 1, "score": 1, "last_activity_date": 1584351034, "creation_date": 1532441421, "last_edit_date": 1584351034, "question_id": 51500811, "link": "https://stackoverflow.com/questions/51500811/how-to-use-an-accumulator-in-a-recursive-io-action", "title": "How to use an accumulator in a recursive IO action", "body": "<p>I have the following problem:</p>\n\n<p>I want to read from a file line by line and write the lines to another file. However, I want to return the number of lines.</p>\n\n<p>Therefore, inside a pure function I would use an accumulator like this:</p>\n\n<pre><code>function parameters=method 0 ......\n                    method accu  {end case scenario} =accu\n                    method accu  {not end case} = accu+1 //and other stuff\n</code></pre>\n\n<p>How can I achieve the same in a do-block without using another function?</p>\n\n<p><strong>Concrete example</strong></p>\n\n<pre><code>module Main where \n\n    import System.IO\n    import Data.Char(toUpper)\n\n\n    main::IO()\n    main=do\n        let inHandle=openFile \"in.txt\" ReadMode\n        let outHandle=openFile \"out.txt\" WriteMode\n        inHandle&gt;&gt;= \\a -&gt;outHandle&gt;&gt;= \\b -&gt;loop a b 0&gt;&gt;=print . show \n\n\n    loop::Handle-&gt;Handle-&gt;Int-&gt;IO Int\n    loop inh outh cnt=hIsEOF inh&gt;&gt;= \\l -&gt;if l then return elem\n                                        else\n                                            do\n                                                hGetLine inh&gt;&gt;=hPutStrLn outh\n                                                loop inh outh (cnt+1)\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>Refactored the way <code>loop</code> gets its parameters</p>\n\n<p><strong>P.S 2</strong> (after <strong>K. A. Buhr's</strong> thorough response)</p>\n\n<p><strong>I.</strong> What I really wanted to achieve, was the last expression of the <code>main</code> method. I wanted to take the multiple <code>IO Action</code>s and bind their results to a method. Specifically:</p>\n\n<pre><code>inHandle&gt;&gt;= \\a -&gt;outHandle&gt;&gt;= \\b -&gt;loop a b 0&gt;&gt;=print . show\n</code></pre>\n\n<p>What I do not understand in this case is:</p>\n\n<p>If <code>inHandle&gt;&gt;=</code> is supplied to <code>\\a -&gt;</code> and then the result is passed to <code>...&gt;&gt;=\\b</code>, do the variables inside the outer scope get closured in <code>\\b</code>?</p>\n\n<p>If not, shouldn't it be <code>&gt;&gt;=\\a-&gt;..&gt;&gt;= \\a b</code>? Shouldn't the inner scope hold a parameter corresponding to the result of the outer scope?</p>\n\n<p><strong>Eliminating the do inside the helper method</strong></p>\n\n<p>What I wanted to know, is if there is a way to glue together multiple actions without them being in a <code>do</code> block.</p>\n\n<p>In my case:</p>\n\n<pre><code>loop::Handle-&gt;Handle-&gt;Int-&gt;IO Int\n        loop inh outh cnt=hIsEOF inh&gt;&gt;= \\l -&gt;if l then return elem\n                                            else\n                                                do\n                                                    hGetLine inh&gt;&gt;=hPutStrLn outh\n                                                    loop inh outh (cnt+1)\n</code></pre>\n\n<p>Can't I say something like:</p>\n\n<p><code>if ... then ...</code> <br> <code>else</code><br><code>hPutStrLn=&lt;&lt;action1 [something] v2=&lt;&lt;action2 [something]  loop inh outh (cnt+1)</code></p>\n\n<p>where <code>something</code> could be an operator? I do not know, that is why I am asking.</p>\n"}, {"tags": ["haskell", "containers", "intervals"], "comments": [{"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1532431198, "post_id": 51497198, "comment_id": 89962377, "body": "I&#39;m not sure which use cases of yours I&#39;m missing, but why would functions of the type <code>Ord k =&gt; k -&gt; Maybe a</code> be a bad solution?"}, {"owner": {"reputation": 2530, "user_id": 6658809, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5d30a3055ca065bcc94e1c7386de4e48?s=128&d=identicon&r=PG&f=1", "display_name": "siracusa", "link": "https://stackoverflow.com/users/6658809/siracusa"}, "reply_to_user": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1532431793, "post_id": 51497198, "comment_id": 89962709, "body": "@Koterpillar The series should be defined dynamically and be stored in a file eventually. While the former would be doable with a function (not sure how efficiently), I see no way for the latter."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1532436241, "post_id": 51497198, "comment_id": 89965795, "body": "Can the intervals within one container overlap?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1532436609, "post_id": 51497198, "comment_id": 89966045, "body": "I think <a href=\"http://hackage.haskell.org/package/scalendar\" rel=\"nofollow noreferrer\">scalendar</a> does essentially what you&#39;re asking for. A bit stupidly, it&#39;s not at all set up as a container though but... well, as a calendar, totally domain-specific."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1532439812, "post_id": 51497198, "comment_id": 89968602, "body": "@siracusa How do you expect to store the series in a file if the series can be unbounded?"}, {"owner": {"reputation": 2530, "user_id": 6658809, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5d30a3055ca065bcc94e1c7386de4e48?s=128&d=identicon&r=PG&f=1", "display_name": "siracusa", "link": "https://stackoverflow.com/users/6658809/siracusa"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1532473847, "post_id": 51497198, "comment_id": 89986489, "body": "@leftaroundabout They do not need to overlap for my use case, though it wouldn&#39;t hurt if the implementation allows for it"}, {"owner": {"reputation": 2530, "user_id": 6658809, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5d30a3055ca065bcc94e1c7386de4e48?s=128&d=identicon&r=PG&f=1", "display_name": "siracusa", "link": "https://stackoverflow.com/users/6658809/siracusa"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1532474029, "post_id": 51497198, "comment_id": 89986533, "body": "@4castle The infinite parts may only occur at the left-most or right-most side of the series, so they would fit into a single interval <code>[-infinity, x]</code> or  <code>[x, infinity]</code>. The representation of the series will always be finite"}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "edited": false, "score": 2, "creation_date": 1532485145, "post_id": 51497198, "comment_id": 89988873, "body": "Does <a href=\"http://hackage.haskell.org/package/step-function-0.2/docs/Data-Function-Step.html\" rel=\"nofollow noreferrer\">step-function</a> meet your requirements? In particular, the Applicative instance for merging appears appropriate. Perhaps <code>SF k (Maybe a)</code> with <code>k</code> an instance of <code>Ord</code> for partial functions, and the <code>show</code> function for storage."}], "answers": [{"tags": [], "owner": {"reputation": 2530, "user_id": 6658809, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5d30a3055ca065bcc94e1c7386de4e48?s=128&d=identicon&r=PG&f=1", "display_name": "siracusa", "link": "https://stackoverflow.com/users/6658809/siracusa"}, "is_accepted": false, "score": 0, "last_activity_date": 1532579962, "creation_date": 1532579962, "answer_id": 51531121, "question_id": 51497198, "link": "https://stackoverflow.com/questions/51497198/map-like-container-with-intervals-as-keys-and-zip-like-combining-operation/51531121#51531121", "title": "Map-like container with intervals as keys and zip-like combining operation", "body": "<p>The best suggestion from the comments above seems to be the <a href=\"http://hackage.haskell.org/package/step-function-0.2/docs/Data-Function-Step.html\" rel=\"nofollow noreferrer\"><code>step-function</code></a> package, as suggested by B. Mehta. I haven't tried that package yet, but it looks like building a wrapper around that <code>SF</code> type is what I was looking for.</p>\n\n<hr>\n\n<p>Meanwhile, I implemented another solution which I'd like to share. The code for the combining function (<code>combineAscListWith</code> in the code below) is a bit clumsy as it's more general than for just getting the intersection of both maps, so I'll sketch the idea:</p>\n\n<p>First we need an <code>Interval</code> type with an <code>Ord</code> instance which stores pairs of <code>Val a</code> values which can either be -infinity, some value x or +infinity. Form that we can build an <code>IntervalMap</code> which is just a normal <code>Map</code> that maps these intervals to the final values.</p>\n\n<p>When combining two such <code>IntervalMaps</code> by intersection, we first convert the maps into lists of key/value pairs. Next we traverse both lists in parallel to zip both lists into another one which corresponds to the final intersection map. There are two main cases when combining the list elements:</p>\n\n<ol>\n<li>Both left-most intervals start at the same value. In that case we found an interval that actually overlaps/intersects. We clip the longer interval to the shorter one, and use the values associated with the two intervals to get the result value, which now\u2014together with the shorter interval\u2014goes into the result list. The rest of the longer interval goes back to the input lists.</li>\n<li>One of the intervals starts at a smaller value than the other, which means we found a part of the two series that do not overlap. So for the intersection, all of the non-overlapping part of the interval (or even the whole interval) can be discared. The rest (if any) goes back to the input list.</li>\n</ol>\n\n<p>For completeness, here's the full example code. Again, the code is rather clumsy; a step-function-based implementation would certainly be more elegant.</p>\n\n<pre><code>import           Control.Applicative\nimport           Data.List\nimport qualified Data.Map as Map\n\n\ndata Val a = NegInf | Val a | Inf deriving (Show, Read, Eq, Ord)\n\ninstance Enum a =&gt; Enum (Val a) where\n    succ v = case v of\n        NegInf -&gt; NegInf\n        Val x  -&gt; Val $ succ x\n        Inf    -&gt; Inf\n    pred v = case v of\n        NegInf -&gt; NegInf\n        Val x  -&gt; Val $ pred x\n        Inf    -&gt; Inf\n    toEnum = Val . toEnum\n    fromEnum (Val x) = fromEnum x\n\n\ndata Interval a = Interval { lowerBound :: Val a, upperBound :: Val a } deriving (Show, Read, Eq)\n\ninstance Ord a =&gt; Ord (Interval a) where\n    compare ia ib = let (a, a') = (lowerBound ia, upperBound ia)\n                        (b, b') = (lowerBound ib, upperBound ib)\n                    in  case () of\n                            _ | a' &lt; b             -&gt; LT\n                            _ | b' &lt; a             -&gt; GT\n                            _ | a == b &amp;&amp; a' == b' -&gt; EQ\n                            _ -&gt; error \"Ord.Interval.compare: undefined for overlapping intervals\"\n\n\nnewtype IntervalMap i a = IntervalMap { unIntervalMap :: Map.Map (Interval i) a }\n                          deriving (Show, Read)\n\ninstance Functor (IntervalMap i) where\n    fmap f = IntervalMap . fmap f . unIntervalMap\n\ninstance (Ord i, Enum i) =&gt; Applicative (IntervalMap i) where\n    pure = IntervalMap . Map.singleton (Interval NegInf Inf)\n    (&lt;*&gt;) = intersectionWith ($)\n\n\nintersectionWith :: (Ord i, Enum i) =&gt; (a -&gt; b -&gt; c)\n                 -&gt; IntervalMap i a -&gt; IntervalMap i b -&gt; IntervalMap i c\nintersectionWith f = combineWith (liftA2 f)\n\ncombineWith :: (Ord i, Enum i) =&gt; (Maybe a -&gt; Maybe b -&gt; Maybe c)\n            -&gt; IntervalMap i a -&gt; IntervalMap i b -&gt; IntervalMap i c\ncombineWith f (IntervalMap mpA) (IntervalMap mpB) =\n    let cs = combineAscListWith f (Map.toAscList mpA) (Map.toAscList mpB)\n    in IntervalMap $ Map.fromList [ (i, v) | (i, Just v) &lt;- cs ]\n\ncombineAscListWith :: (Ord i, Enum i) =&gt; (Maybe a -&gt; Maybe b -&gt; c)\n            -&gt; [(Interval i, a)] -&gt; [(Interval i, b)] -&gt; [(Interval i, c)]\ncombineAscListWith f as bs = case (as, bs) of\n    ([], _) -&gt; map (\\(i, v) -&gt; (i, f Nothing (Just v))) bs\n    (_, []) -&gt; map (\\(i, v) -&gt; (i, f (Just v) Nothing)) as\n    ((Interval a a', va) : as', (Interval b b', vb) : bs')\n        | a == b -&gt; case () of\n            _ | a' == b' -&gt; (Interval a a', f (Just va) (Just vb)) : combineAscListWith f as' bs'\n            _ | a' &lt; b'  -&gt; (Interval a a', f (Just va) (Just vb)) : combineAscListWith f as' ((Interval (succ a') b', vb) : bs')\n            _ | a' &gt; b'  -&gt; (Interval a b', f (Just va) (Just vb)) : combineAscListWith f ((Interval (succ b') a', va) : as') bs'\n        | a &lt; b  -&gt; case () of\n            _ | a' &lt; b   -&gt; ((Interval a a', f (Just va) Nothing)) :\n                (if succ a' == b then id else ((Interval (succ a') (pred b), f Nothing Nothing) :)) (combineAscListWith f as' bs)\n            _ | True     -&gt; (Interval a (pred b), f (Just va) Nothing) : combineAscListWith f ((Interval b a', va) : as') bs\n        | a &gt; b  -&gt; case () of\n            _ | b' &lt; a   -&gt; ((Interval b b', f Nothing (Just vb))) :\n                (if succ b' == a then id else ((Interval (succ b') (pred a), f Nothing Nothing) :)) (combineAscListWith f as bs')\n            _ | True     -&gt; (Interval b (pred a), f Nothing (Just vb)) : combineAscListWith f as ((Interval a b', vb) : bs')\n\n\nshowIntervalMap :: (Show i, Show a, Eq i) =&gt; IntervalMap i a -&gt; String\nshowIntervalMap = intercalate \"; \" . map (\\(i, v) -&gt; showInterval i ++ \" -&gt; \" ++ show v)\n    . Map.toAscList . unIntervalMap\n    where\n        showInterval (Interval (Val a) (Val b)) | a == b = \"[\" ++ show a ++ \"]\"\n        showInterval (Interval a b) = \"[\" ++ showVal a ++ \" .. \" ++ showVal b ++ \"]\"\n        showVal NegInf  = \"-inf\"\n        showVal (Val x) = show x\n        showVal Inf     = \"inf\"\n\nmain :: IO ()\nmain = do\n    let signumMap = IntervalMap $ Map.fromList [(Interval NegInf (Val $ -1), -1),\n            (Interval (Val 0) (Val 0), 0), (Interval (Val 1) Inf, 1)]\n    putStrLn $ showIntervalMap $ (*) &lt;$&gt; signumMap &lt;*&gt; pure 5\n</code></pre>\n"}], "owner": {"reputation": 2530, "user_id": 6658809, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5d30a3055ca065bcc94e1c7386de4e48?s=128&d=identicon&r=PG&f=1", "display_name": "siracusa", "link": "https://stackoverflow.com/users/6658809/siracusa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 189, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1532579962, "creation_date": 1532430864, "question_id": 51497198, "link": "https://stackoverflow.com/questions/51497198/map-like-container-with-intervals-as-keys-and-zip-like-combining-operation", "title": "Map-like container with intervals as keys and zip-like combining operation", "body": "<p>I'm looking for a Haskell container type like <code>Data.Map</code> that uses intervals as keys, where the left-most and right-most keys may also be unbounded intervals, but are otherwise non-overlapping. Additionally, the container should support a function similar to <code>zipWith</code> that allows to merge two containers into a new one, using the intersection of both key sets as the new key set and the argument function for a pointwise combination of both value sets.</p>\n\n<p>There already are several packages that provide interval-based maps. I've had a look at <code>IntervalMap</code>, <code>fingertree</code> and <code>SegmentTree</code>, but none of these packages seem to provide the desired combination function. They all seem to use intervals for the intersection functions, that are <em>equal</em> in both maps, while I need a version that breaks intervals down into smaller ones if necessary.</p>\n\n<p>The container should basically provide an efficient and storable mapping for key/value series of the form <code>Ord k =&gt; k -&gt; Maybe a</code>, i.e. functions only defined on specific intervals or having larger intervals mapping to the same value.</p>\n\n<p>Here is a small example to demonstrate the issue:</p>\n\n<pre><code>... -4 -3 -2 -1  0  1  2  3  4  ...  -- key set\n-----------------------------------\n... -1 -1 -1 -1  0  1  1  1  1  ...  -- series corresponding to signum\n...  5  5  5  5  5  5  5  5  5  ...  -- series corresponding to const 5\n</code></pre>\n\n<p>The first series could be efficiently expressed by a mapping <code>[-infinity, -1] -&gt; -1; [0, 0] -&gt; 0; [1, infinity] -&gt; 1</code> and the second one by <code>[-infinity, infinity] -&gt; 5</code>. Now applying a combination function with <code>(*)</code> as arument function should give a new series</p>\n\n<pre><code>... -4 -3 -2 -1  0  1  2  3  4  ...  -- key set\n-----------------------------------\n... -5 -5 -5 -5  0  5  5  5  5  ...  -- combined series\n</code></pre>\n\n<p>The crucial point here\u2014and all of the afore-mentioned packages don't seem to be able to do that\u2014is that, when combining the key sets for these two series, you have to take the different values also into account. Both series span the full range of <code>[-infinity, infinity]</code> but it's necessary to break it into three parts for the final series.</p>\n\n<p>There are also packages for working with intervals, e.g. the <code>range</code> package, which also provides an intersection operation on lists of intervals. However, I didn't found a way to use that in combination with one of the Map variants because it collapses adjacents intervals when doing calculations with them.</p>\n\n<p>NB: Such a container is somewhat similar to a <code>ZipList</code> that extends to both sides, which is why I think it should also be possible to define a lawful <code>Applicative</code> instance for it, where <code>&lt;*&gt;</code> corresponds to the above-mentioned combining function.</p>\n\n<p>To cut a long story short, is there already a package that provides such a container? Or is there an easy way to use the existing packages to build one?</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 8102627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a67e2665b8f38a4bbf43f4b0633c5d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Stanislav Lyahnovich", "link": "https://stackoverflow.com/users/8102627/stanislav-lyahnovich"}, "is_accepted": false, "score": 0, "last_activity_date": 1532462502, "creation_date": 1532462502, "answer_id": 51506668, "question_id": 51493608, "link": "https://stackoverflow.com/questions/51493608/haskell-turtle-get-out-of-shell-monad/51506668#51506668", "title": "Haskell Turtle get out of Shell Monad", "body": "<p>Actually I've managed to get rid of <code>IO</code> here by using helper transformation</p>\n\n<pre><code>sio :: Shell (IO a) -&gt; Shell a\nsio s = Shell (\\(FoldShell step begin done) -&gt;\n                let step' x a = do\n                      a' &lt;- a\n                      step x a'\n                in\n                  _foldShell s (FoldShell step' begin done))\n</code></pre>\n\n<p>But now I wonder is there any simpler solution to this task...</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 8102627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a67e2665b8f38a4bbf43f4b0633c5d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Stanislav Lyahnovich", "link": "https://stackoverflow.com/users/8102627/stanislav-lyahnovich"}, "edited": false, "score": 0, "creation_date": 1532491595, "post_id": 51507271, "comment_id": 89989938, "body": "Thanks, I should guess myself for such simple solution. Thats because I trapped myself with <code>fmap</code>, where more direct approach should be used."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 0, "last_activity_date": 1532465966, "last_edit_date": 1532465966, "creation_date": 1532465192, "answer_id": 51507271, "question_id": 51493608, "link": "https://stackoverflow.com/questions/51493608/haskell-turtle-get-out-of-shell-monad/51507271#51507271", "title": "Haskell Turtle get out of Shell Monad", "body": "<p>You have an <code>IO</code> action, and you really want a <code>Shell</code> action. The usual way to handle that is with the <code>liftIO</code> method, which is available because <code>Shell</code> is an instance of <code>MonadIO</code>.</p>\n\n<pre><code>file &lt;- find (suffix \".hs\") \".\"\nsize &lt;- liftIO $ getFileSize file\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>size &lt;- liftIO . getFileSize =&lt;&lt; find (suffix \".hs\") \".\"\n</code></pre>\n\n<p>Fortunately, the <code>Turtle</code> package itself offers some size functions you can use directly with <code>MonadIO</code> instances like <code>Shell</code> <a href=\"http://hackage.haskell.org/package/turtle-1.5.10/docs/Turtle-Prelude.html#g:8\" rel=\"nofollow noreferrer\">in <code>Turtle.Prelude</code></a> so you don't need to use <code>liftIO</code> yourself.</p>\n\n<p>Now you actually have to sum these up, but you can do that with <code>fold</code> and <code>sum</code>.</p>\n\n<p>I would recommend that you avoid breaking open the <code>Shell</code> type itself. That should be reserved for adding totally new functionality to the API. That certainly isn't necessary in this case.</p>\n"}], "owner": {"reputation": 11, "user_id": 8102627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a67e2665b8f38a4bbf43f4b0633c5d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Stanislav Lyahnovich", "link": "https://stackoverflow.com/users/8102627/stanislav-lyahnovich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 1, "accepted_answer_id": 51507271, "answer_count": 2, "score": 0, "last_activity_date": 1532465966, "creation_date": 1532419732, "last_edit_date": 1532448783, "question_id": 51493608, "link": "https://stackoverflow.com/questions/51493608/haskell-turtle-get-out-of-shell-monad", "title": "Haskell Turtle get out of Shell Monad", "body": "<p>could you please help me with <a href=\"http://hackage.haskell.org/package/turtle\" rel=\"nofollow noreferrer\">Turtle</a> library.\nI want to write simple program, that calculates disk space usage.\nHere is the code:</p>\n\n<pre><code>getFileSize :: FilePath -&gt; IO Size\ngetFileSize f = do\n  status &lt;- stat f\n  return $ fileSize status\n\nmain = sh $ do\n  let sizes = fmap getFileSize $ find (suffix \".hs\") \".\"\n</code></pre>\n\n<p>so now I have <code>sizes</code> bind of type <code>Shell (IO Size)</code>. But I can't just sum it,  with <code>sum</code> fold, cause there is <code>IO Size</code> in there. If it was something like <code>[IO Size]</code> I could pull <code>IO</code> monad out of there by using <code>sequence</code> to transform it to <code>IO [Size]</code>. But I can't do this with <code>Shell</code> monad since it is not <code>Traversable</code>. So I wrote something like this</p>\n\n<pre><code>import qualified Control.Foldl as F\n\nmain = sh $ do\n  let sizes = fmap getFileSize $ find (suffix \".hs\") \".\"\n  lst &lt;- fold sizes F.list\n  let cont = sequence lst\n  sz &lt;- liftIO $ cont\n  liftIO $ putStrLn (show (sum sz))  \n</code></pre>\n\n<p>First I folded <code>Shell (IO Size)</code> to <code>[IO Size]</code> and then to <code>IO [Size]</code> to sum list afterwards.\nBut I wonder if there is more canonical or elegant solution to this, because here I created two lists to accomplish my task. And I throught that <code>Shell</code> monad is for manipulating entities in constant space. Maybe there is some <code>fold</code> to make <code>IO (Shell Size)</code> from <code>Shell (IO Size)</code>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "functional-programming", "tree", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532416470, "post_id": 51492598, "comment_id": 89953754, "body": "Should all nodes get numbered? What about nodes with a name that occurs only once?"}, {"owner": {"reputation": 1307, "user_id": 1389844, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/caaeb43920f240c93d4df5d455e2360d?s=128&d=identicon&r=PG", "display_name": "tanman", "link": "https://stackoverflow.com/users/1389844/tanman"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532416506, "post_id": 51492598, "comment_id": 89953772, "body": "Yes all nodes would be numbered, it would include the number 1 on the first use of the name"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532416576, "post_id": 51492598, "comment_id": 89953808, "body": "You could write a recursive function, where you pass a <code>Map String Int</code> object as an accumulator, and update it at each &quot;<i>iteration</i>&quot;."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1532421885, "post_id": 51492598, "comment_id": 89956799, "body": "You may be looking for <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Traversable.html#v:mapAccumL\" rel=\"nofollow noreferrer\"><code>mapAccum</code> of Traversables</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532463786, "post_id": 51492598, "comment_id": 89982930, "body": "I suspect switching to <code>Data.Tree</code> will be less trouble than you fear, if you want to give it a go. The compiler will spray a ton of errors at you, pointing you to all the spots you need to change. The actual changes are all trivial."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532464435, "post_id": 51492598, "comment_id": 89983284, "body": "No, I don&#39;t think <code>Data.Foldable</code> has anything for you. You should check out <code>Data.Functor.Foldable</code> in the <code>recursion-schemes</code> package if you want to see some fancy tools that might be able to do what you want. But rose trees are probably better imagined as cofree comonads than as fixed points, so I don&#39;t know if that&#39;s the &quot;right&quot; way to think about the problem."}], "answers": [{"tags": [], "owner": {"reputation": 1307, "user_id": 1389844, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/caaeb43920f240c93d4df5d455e2360d?s=128&d=identicon&r=PG", "display_name": "tanman", "link": "https://stackoverflow.com/users/1389844/tanman"}, "is_accepted": false, "score": 0, "last_activity_date": 1532418686, "creation_date": 1532418686, "answer_id": 51493285, "question_id": 51492598, "link": "https://stackoverflow.com/questions/51492598/best-way-to-name-a-tree-with-children-structure-with-no-duplicate-names-in-has/51493285#51493285", "title": "Best way to name a tree (with children) structure with no duplicate names in Haskell", "body": "<p>I think this answers my question although I'm still wondering if there's a more concise way to do this with Foldable.</p>\n\n<pre><code>mapTree :: ((a, Tree) -&gt; (a, Tree)) -&gt; (a, Tree) -&gt; (a, Tree)\nmapTree f startingPoint =\n  let\n    root = f startingPoint\n\n    (rootAcc, rootTree) = root\n\n    originalChildren :: [Tree]\n    originalChildren = children rootTree\n\n    (newAcc, newChildren) =\n      foldr (\\child (acc, children) -&gt;\n        let\n          (newAcc, newTree) = mapTree f (acc, child)\n        in\n          (newAcc, newTree : children)\n      ) (rootAcc, []) originalChildren\n  in\n    ( newAcc\n    , rootTree\n      { children = newChildren\n      }\n    )\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532463924, "post_id": 51506179, "comment_id": 89982993, "body": "I don&#39;t think <code>Traversable</code> is too relevant, except perhaps for traversing the forests. Even if it were available for <code>Tree</code>, I don&#39;t think it would have the necessary power. You could surely do something with recursion schemes."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 0, "last_activity_date": 1532460328, "creation_date": 1532460328, "answer_id": 51506179, "question_id": 51492598, "link": "https://stackoverflow.com/questions/51492598/best-way-to-name-a-tree-with-children-structure-with-no-duplicate-names-in-has/51506179#51506179", "title": "Best way to name a tree (with children) structure with no duplicate names in Haskell", "body": "<p>Well, you can't use <code>Foldable</code> (or the related class <code>Traversable</code>) because these classes are for types of kind <code>* -&gt; *</code>.  That is, a <code>Foldable</code> instance can only be defined for a type like <code>data Tree a = ...</code> that is parameterized in another type <code>a</code>, but your <code>data Tree = ...</code> is unparameterized.</p>\n\n<p>What you <strong>can</strong> do is write a function that traverses your tree applying a monadic action to each node, sort of a <code>mapM</code> tailored to your tree that maps a per-node action across the whole tree:</p>\n\n<pre><code>mapTreeM :: Monad m =&gt; (Tree -&gt; m Tree) -&gt; Tree -&gt; m Tree\nmapTreeM f = mtm  -- @f@ is the per-node action, @mtm@ the whole-tree action\n  where mtm tree = do\n          -- apply node action @f@ to root node\n          tree' &lt;- f tree\n          -- recurse over children with @mtm@\n          children' &lt;- mapM mtm (children tree')\n          -- update the children\n          return $ tree' { children = children' }\n</code></pre>\n\n<p>Now, this can apply any monadic action, including a <code>State</code>-based monadic action that assigns a numbered suffix, with a separate counter for each <code>name</code>.  This is, given:</p>\n\n<pre><code>data Tree = Tree\n  { name :: String\n  , children :: [Tree]\n  } deriving (Show, Eq)\n</code></pre>\n\n<p>you can define the node-renamer:</p>\n\n<pre><code>uniquifyNode :: Tree -&gt; State (Map String Int) Tree\nuniquifyNode node = do\n  let nm = name node\n  -- get current count for this name\n  n &lt;- gets (Map.findWithDefault 1 nm)\n  -- store an updated count\n  modify (Map.insert nm (n+1))\n  -- return uniquified name\n  return (node { name = nm ++ show n })\n</code></pre>\n\n<p>and combine the two to create a tree-renamer:</p>\n\n<pre><code>uniquifyTree :: Tree -&gt; Tree\nuniquifyTree t = evalState (mapTreeM uniquifyNode t) Map.empty\n</code></pre>\n\n<p>and test it on a tree:</p>\n\n<pre><code>t0 :: Tree\nt0 = Tree \"a\" [ Tree \"a\" []\n              , Tree \"b\" [ Tree \"a\" []\n                         , Tree \"b\" []\n                         , Tree \"c\" []\n             ]\n      , Tree \"c\" [ Tree \"a\" [] ]\n      ]\n</code></pre>\n\n<p>like so:</p>\n\n<pre><code>&gt; uniquifyTree t0\n</code></pre>\n\n<p>which prints a tree equivalent to:</p>\n\n<pre><code>t1 :: Tree\nt1 = Tree \"a1\" [ Tree \"a2\" []\n               , Tree \"b1\" [ Tree \"a3\" []\n                           , Tree \"b2\" []\n                           , Tree \"c1\" []\n                           ]\n              , Tree \"c2\" [ Tree \"a4\" [] ]\n              ]\n</code></pre>\n\n<p>Note that <code>mapTreeM</code> is essentially equivalent to your <code>mapTree</code>, and you can define <code>mapTree</code> in terms of <code>mapTreeM</code> using <code>runState</code> and <code>state</code> which don't actually <em>do</em> anything except wrap and unwrap data types:</p>\n\n<pre><code>mapTree :: ((a, Tree) -&gt; (a, Tree)) -&gt; (a, Tree) -&gt; (a, Tree)\nmapTree f (a, t) = let (t', a') = runState (mapTreeM g t) a in (a', t')\n  where g t = state (\\a -&gt; let (a', t') = f (a, t) in (t', a'))\n</code></pre>\n\n<p>So, structurally, this isn't much different from what you've already done.  You just reinvented the state monad (as <code>(a, Tree) -&gt; (a, Tree)</code>) and wrote a sort of custom <code>mapM</code> to traverse the tree without making the monadic action general.</p>\n\n<p>One thing about the explicit monadic version is that you can use it with some other monadic actions.  Here are some examples:</p>\n\n<pre><code>&gt; -- replace all names with \"foo\" (Identity action)\n&gt; import Data.Functor.Identity\n&gt; runIdentity $ mapTreeM (\\(Tree n c) -&gt; Identity (Tree \"foo\" c)) t0\n&gt; -- read the names from a file (IO action)\n&gt; import System.IO\n&gt; withFile \"/usr/share/dict/words\" ReadMode $ \n    \\h -&gt; mapTreeM (\\(Tree n c) -&gt; flip Tree c &lt;$&gt; hGetLine h) t0    \n&gt; -- get a list of names in order (Writer action)\n&gt; import Control.Monad.Writer\n&gt; execWriter $ mapTreeM (\\t@(Tree n _) -&gt; tell [n] &gt;&gt; return t) t0\n</code></pre>\n\n<p>Anyway, the full program is:</p>\n\n<pre><code>import Control.Monad.State\nimport Data.Map.Strict (Map)\nimport qualified Data.Map.Strict as Map\n\ndata Tree = Tree\n  { name :: String\n  , children :: [Tree]\n  } deriving (Show, Eq)\n\nmapTreeM :: Monad m =&gt; (Tree -&gt; m Tree) -&gt; Tree -&gt; m Tree\nmapTreeM f = mtm\n  where mtm tree = do\n          tree' &lt;- f tree\n          children' &lt;- mapM mtm (children tree')\n          return $ tree' { children = children' }\n\nuniquifyNode :: Tree -&gt; State (Map String Int) Tree\nuniquifyNode node = do\n  let nm = name node\n  n &lt;- gets (Map.findWithDefault 1 nm)\n  modify (Map.insert nm (n+1))\n  return (node { name = nm ++ show n })\n\nuniquifyTree :: Tree -&gt; Tree\nuniquifyTree t = evalState (mapTreeM uniquifyNode t) Map.empty\n\nt0 :: Tree\nt0 = Tree \"a\" [ Tree \"a\" []\n              , Tree \"b\" [ Tree \"a\" []\n                         , Tree \"b\" []\n                         , Tree \"c\" []\n                         ]\n              , Tree \"c\" [ Tree \"a\" [] ]\n              ]\n\nt1 :: Tree\nt1 = Tree \"a1\" [ Tree \"a2\" []\n               , Tree \"b1\" [ Tree \"a3\" []\n                           , Tree \"b2\" []\n                           , Tree \"c1\" []\n                           ]\n              , Tree \"c2\" [ Tree \"a4\" [] ]\n              ]\n\nmain = print $ uniquifyTree t0 == t1\n</code></pre>\n"}], "owner": {"reputation": 1307, "user_id": 1389844, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/caaeb43920f240c93d4df5d455e2360d?s=128&d=identicon&r=PG", "display_name": "tanman", "link": "https://stackoverflow.com/users/1389844/tanman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 51506179, "answer_count": 2, "score": 0, "last_activity_date": 1532460328, "creation_date": 1532416362, "question_id": 51492598, "link": "https://stackoverflow.com/questions/51492598/best-way-to-name-a-tree-with-children-structure-with-no-duplicate-names-in-has", "title": "Best way to name a tree (with children) structure with no duplicate names in Haskell", "body": "<p>Let's say I have the following data structure.</p>\n\n<pre><code>data Tree = Tree\n  { name        :: String\n  , children    :: [Tree]\n  , ...\n  }\n</code></pre>\n\n<p>My goal is to be able to map over a list of trees and their children, so that I can name each tree uniquely, hence the Map structure in the following code which represents the number of times a particular name has been used, in other words, <code>Map Name Count</code>. So if I have function <code>baseName :: SystemTree -&gt; String</code> which returns the unnumbered name based on the unlisted attributes, it can be combined with the number in the map, such that even if a baseName is reused no name is ever used twice.</p>\n\n<pre><code>nameSystemTrees :: Map String Int -&gt; [Tree] -&gt; (Map String Int, [Tree])\nnameSystemTrees nameState trees =\n  ...\n</code></pre>\n\n<p>My question is, what is the best way to approach this in Haskell? Is it possible to use Foldable here? I noticed there's the <code>Data.Tree</code> package but unfortunately I already have a lot of custom code to construct these trees so I think it would take some work to be able to use the constructors in that package.</p>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 4, "creation_date": 1532414527, "post_id": 51491915, "comment_id": 89952628, "body": "<code>&lt;-</code> is not a function, it is part of the syntax. It is syntactic sugar for calls to <code>(&gt;&gt;=)</code>. This is why you can&#39;t use it in that way. If you do not yet want to use these <code>Monad</code> methods directly, how about <code>inh &lt;- openFile ...; outh &lt;- openFile ...; r &lt;- hGetLine inh; hPutStrLn outh r</code> instead of the <code>let</code>s?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1532416153, "post_id": 51491915, "comment_id": 89953573, "body": "Ok <code>variable&lt;-expression</code> cannot be used without the left argument.So i must enter the <code>monad</code> chapter.So i can use it like this? <code>hPutStrLn (=&lt;&lt;inh) ((=&lt;&lt;outh)&gt;&gt;=hGetLine</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532416358, "post_id": 51491915, "comment_id": 89953691, "body": "yes, it is part of the &quot;<code>do</code>-notation&quot;. start with the do notation."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1532418530, "post_id": 51491915, "comment_id": 89955019, "body": "Was proposal <a href=\"https://gist.github.com/evincarofautumn/9cb3fb0197d2cfc1bc6fe88f7827216a\" rel=\"nofollow noreferrer\">InlineDoBind</a> which similar to what you are thinking."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1532430689, "post_id": 51491915, "comment_id": 89962066, "body": "<code>&lt;-</code> and <code>do</code>, by definition, relate to monads (ignoring the <code>ApplicativeDo</code> extension). I gently suggest reading your chapter on monads."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1532556364, "post_id": 51491915, "comment_id": 90025212, "body": "@freestyle: Which I actually submitted as <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/64\" rel=\"nofollow noreferrer\">InlineBindings</a> but my work on it fizzled out; I hope to get to it at some point still."}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1532420135, "post_id": 51493281, "comment_id": 89955850, "body": "But what i do not understand is when do you use <code>=&lt;&lt;</code> and when <code>&gt;&gt;=</code>"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 2, "creation_date": 1532421005, "post_id": 51493281, "comment_id": 89956285, "body": "it mostly the same, the only difference is the order of the arguments. For example, you have <code>line</code> of type <code>IO String</code> and want to print it. You can do it either by <code>print =&lt;&lt; a</code> or by <code>a &gt;&gt;= print</code>"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 3, "last_activity_date": 1532418679, "creation_date": 1532418679, "answer_id": 51493281, "question_id": 51491915, "link": "https://stackoverflow.com/questions/51491915/unwrap-value-from-io-operation-at-a-later-time/51493281#51493281", "title": "Unwrap value from IO operation at a later time", "body": "<p>You already understand that <code>&lt;-</code> operator kind of unwraps <code>IO</code> value, but it's actually the syntax of <code>do</code> notation and can be expressed like this (actually I'm not sure, which results you're trying to achieve, but the following example just reads the content from one file and puts the content to another file):</p>\n\n<pre><code>import System.IO\n\nmain = do\n  inh &lt;- openFile \"myfile\" ReadMode\n  outh &lt;- openFile \"out.txt\" WriteMode\n  inContent &lt;- hGetLine inh\n  hPutStrLn outh inContent\n  hClose outh\n</code></pre>\n\n<p>According to <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/System-IO.html\" rel=\"nofollow noreferrer\">documentation</a> <code>hGetLine</code>, <code>hPutStrlLn</code> and <code>hClose</code> accept values of <code>Handle</code> type as an argument, but <code>openFile</code> returns <code>IO Handle</code>, so we need to unwrap it using <code>&lt;-</code> operator</p>\n\n<p>But if you want to use <code>&gt;&gt;=</code> function instead, then this is one of the options of doing it:</p>\n\n<pre><code>import System.IO\n\nwriteContentOfMyFile :: Handle -&gt; IO ()\nwriteContentOfMyFile handler =\n  openFile \"myfile\" ReadMode &gt;&gt;= hGetLine &gt;&gt;= hPutStrLn handler\n\nmain =\n  withFile \"out.txt\" WriteMode writeContentOfMyFile\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 51493281, "answer_count": 1, "score": 1, "last_activity_date": 1532418679, "creation_date": 1532413965, "last_edit_date": 1532414490, "question_id": 51491915, "link": "https://stackoverflow.com/questions/51491915/unwrap-value-from-io-operation-at-a-later-time", "title": "Unwrap value from IO operation at a later time", "body": "<p>Hello i was wondering how can you unwrap a value at a later time in the IO monad?\nIf <code>a&lt;-expression</code> binds the result to <code>a</code> then can't i use <code>(&lt;-expression)</code> as a parameter for a given method eg:\n<code>method (&lt;-expression)</code> where method <code>method</code> accepts the result of the evaluation?</p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>let inh=openFile \"myfile\" WriteMode\nlet outh=openFile \"out.txt\" WriteMode \nhPutStrLn (&lt;-outh) ((&lt;-inh)&gt;&gt;=getLine)\n</code></pre>\n\n<p>I have not entered the <code>Monad</code> chapter just basic <code>&lt;-</code> and <code>do</code> blocks but i suppose it has to do with monads.\nThen if i want to pass the <code>result</code> if the evaluation to <code>hGetLine</code> can't i use something like:</p>\n\n<pre><code>(&lt;-expression)=&gt;&gt;hGetLine\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "cabal-new"], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 5, "last_activity_date": 1532400422, "creation_date": 1532400422, "answer_id": 51489739, "question_id": 51488620, "link": "https://stackoverflow.com/questions/51488620/how-can-i-stream-test-results-with-cabal-new-test/51489739#51489739", "title": "How can I stream test results with cabal new-test?", "body": "<p>I just ran into this an hour ago myself!</p>\n\n<p>The <code>--show-details</code> flag is not yet supported by <code>new-test</code>: <a href=\"https://github.com/haskell/cabal/issues/4766\" rel=\"noreferrer\">https://github.com/haskell/cabal/issues/4766</a></p>\n\n<p>The discussion in the bug report indicate that maybe <code>--show-details</code> was a misfeature anyways, and it should always just stream.</p>\n"}], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 51489739, "answer_count": 1, "score": 5, "last_activity_date": 1532400422, "creation_date": 1532389808, "question_id": 51488620, "link": "https://stackoverflow.com/questions/51488620/how-can-i-stream-test-results-with-cabal-new-test", "title": "How can I stream test results with cabal new-test?", "body": "<p>Using <code>cabal test</code>, you're able to stream results with <code>cabal test --show-details=streaming</code>.</p>\n\n<p>I can't find a comparable option for <code>cabal new-test</code>. Is it possible to stream results using <code>new-test</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532381762, "post_id": 51487467, "comment_id": 89944083, "body": "What do you mean by &quot;thread name&quot;? A thread has a <code>ThreadId</code>, but that&#39;s not exactly a name."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1532381770, "post_id": 51487467, "comment_id": 89944085, "body": "Haskell doesn&#39;t have an async operator. What module are you using?"}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1532381789, "post_id": 51487467, "comment_id": 89944091, "body": "import Control.Concurrent.Async and about the name, in other language based in JVM you normally has a name per Thread"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1532381816, "post_id": 51487467, "comment_id": 89944099, "body": "@Michael_Litchard, specifically, @paul is using the <code>async</code> package."}, {"owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "edited": false, "score": 0, "creation_date": 1532381931, "post_id": 51487467, "comment_id": 89944137, "body": "Maybe I&#180;m blind but I read the async package docu and I was not able to find a thing. Is that bad my question BTW?."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1532381933, "creation_date": 1532381933, "answer_id": 51487551, "question_id": 51487467, "link": "https://stackoverflow.com/questions/51487467/get-thread-name/51487551#51487551", "title": "Get Thread name", "body": "<p>You can use <code>myThreadId</code> to get a <code>ThreadId</code>, which serves as an identifier for the thread, as in the following program:</p>\n\n<pre><code>import Control.Concurrent\nimport Control.Concurrent.Async\n\nmain = asyncResponse\n\nasyncResponse = do\n  resAsync &lt;- async operation\n  response &lt;- wait resAsync\n  print response\n\noperation = do\n  threadDelay 5000000\n  myid &lt;- myThreadId\n  return (\"hello async world!!  my name is \" ++ show myid)\n</code></pre>\n\n<p>When I run this, it pauses for 5 seconds and prints:</p>\n\n<pre><code>\"hello async world!!  i am thread ThreadId 5\"\n</code></pre>\n\n<p>That's more or less as close as you'll get to a thread \"name\".  Is that what you wanted?</p>\n"}], "owner": {"reputation": 10216, "user_id": 854207, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/R6DhK.jpg?s=128&g=1", "display_name": "paul", "link": "https://stackoverflow.com/users/854207/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 51487551, "answer_count": 1, "score": -1, "last_activity_date": 1532381933, "creation_date": 1532381379, "question_id": 51487467, "link": "https://stackoverflow.com/questions/51487467/get-thread-name", "title": "Get Thread name", "body": "<p>I\u00b4m playing with async operator of Haskell and I would like to print the thread name, but I google about it and I cannot find a way to do it.</p>\n\n<p>Here my code</p>\n\n<pre><code>asyncResponse = do\n                resAsync &lt;- async operation\n                response &lt;- wait resAsync\n                print response\n\noperation = do\n           threadDelay 5000000\n           return \"hello async world!!\" --&gt; Here Thread name\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1532372239, "post_id": 51485518, "comment_id": 89940102, "body": "Well you need to add a binding, so a signature, and an implementation. Right now, you only defined the fixity."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532372345, "post_id": 51485518, "comment_id": 89940153, "body": "So you mean I can&#39;t only write this in ghci? And I have to add biding in a text editor and run it instead?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532372379, "post_id": 51485518, "comment_id": 89940172, "body": "no, you can write this in <code>ghci</code>, but you need to group the lines,"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532372415, "post_id": 51485518, "comment_id": 89940187, "body": "Ok, get it &amp; thanks"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1532384543, "post_id": 51485581, "comment_id": 89944865, "body": "You can also do it in the same line in ghci; <code>infixr 5 .++ ; (.++) = (++)</code>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1532372509, "creation_date": 1532372509, "answer_id": 51485581, "question_id": 51485518, "link": "https://stackoverflow.com/questions/51485518/the-fixity-signature-for-lacks-an-accompanying-binding/51485581#51485581", "title": "The fixity signature for \u2018.++\u2019 lacks an accompanying binding", "body": "<p>Well like the error says, you indeed defined the fixity, but you still need to <strong>define a signature and implementation</strong>. Since otherwise, there is actually no operator (or at least we can not use such operator, which is usually why one declares such operator). Since Haskell can derive the signature itself, the signature is strictly speaking not necessary (although it is advisable to write one since it is probably a \"top-level function\").</p>\n\n<p>For example:</p>\n\n<pre><code>infixr 5 .++\n(.++) :: [a] -&gt; [a] -&gt; [a]\n(.++) = (++)\n</code></pre>\n\n<p>Here the second line is the <em>signature</em>, and the third one the <em>implementation</em>. Of course you can pick another signature and implementation.</p>\n\n<p>If you run this in an interpreter, you need to define these all in the same \"<em>statement</em>\". You can do so by grouping lines, for example with the <code>:{</code> and <code>:}</code> commands:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| infixr 5 .++\nPrelude| (.++) :: [a] -&gt; [a] -&gt; [a]\nPrelude| (.++) = (++)\nPrelude| :}\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 0, "accepted_answer_id": 51485581, "answer_count": 1, "score": 3, "last_activity_date": 1532372509, "creation_date": 1532372183, "question_id": 51485518, "link": "https://stackoverflow.com/questions/51485518/the-fixity-signature-for-lacks-an-accompanying-binding", "title": "The fixity signature for \u2018.++\u2019 lacks an accompanying binding", "body": "<pre><code>infixr 5 .++\n</code></pre>\n\n<p>I do this in ghci and it gives the error message.</p>\n\n<pre><code>&lt;interactive&gt;:26:10: error:\n    The fixity signature for \u2018.++\u2019 lacks an accompanying binding\n</code></pre>\n\n<p>How can I fix it? Thank you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1532365462, "post_id": 51483783, "comment_id": 89936787, "body": "The foldable is the <i>outer</i> structure, so here a list."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1532366026, "post_id": 51483783, "comment_id": 89937065, "body": "<code>cc</code> is not an <i>arbitrary</i> foldable (which would be indicated by a type like, perhaps, <code>(Foldable t1, Foldable t2) =&gt; t1 [a] -&gt; t2 a</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 6, "last_activity_date": 1532365483, "creation_date": 1532365483, "answer_id": 51483987, "question_id": 51483783, "link": "https://stackoverflow.com/questions/51483783/does-concat-return-a-foldable/51483987#51483987", "title": "Does concat return a Foldable?", "body": "<pre><code>concat :: Foldable t =&gt; t [a] -&gt; [a]\n</code></pre>\n\n<p>The way we read this, <code>concat</code> takes a foldable collection of lists and returns a list. <code>t</code> could be substituted for a lot of things, so long as the resulting thing is foldable.</p>\n\n<pre><code>concat :: [[a]] -&gt; [a]\nconcat :: ZipList [a] -&gt; [a]\nconcat :: Set [a] -&gt; [a]\n</code></pre>\n\n<p>These are all valid specializations of this function. So we could pass it a list of lists, a zip-list of lists, a set of lists, or any other of the myriad of containers available in the Haskell ecosystem.</p>\n\n<p>Now, in your case, you make lists <code>aa</code> and <code>bb</code>. So<sup>1</sup></p>\n\n<pre><code>aa :: [Int]\nbb :: [Int]\n</code></pre>\n\n<p>Now, as we said, lists are foldable, so <code>[]</code> is a valid substitution for <code>t</code> in the type above. Then you do</p>\n\n<pre><code>let cc = concat [aa, bb]\n</code></pre>\n\n<p>You're passing a list of lists to <code>concat</code>, so the specific version you're using is</p>\n\n<pre><code>concat :: [[Int]] -&gt; [Int]\n</code></pre>\n\n<p>and so <code>cc</code> has type</p>\n\n<pre><code>cc :: [Int]\n</code></pre>\n\n<p>Likewise, calling it with <code>[cc, aa]</code> causes no issues, as you're <em>still</em> passing a list of lists, so we're using the same specialization as before.</p>\n\n<pre><code>dd :: [Int]\n</code></pre>\n\n<p>I hope this helps! It can be confusing getting used to Haskell's infrastructure if you're used to a more \"is-a\" style relationship from OOP.</p>\n\n<hr>\n\n<p><sup>1</sup> I'm assuming type <code>Int</code> for simplicity. Strictly speaking, your variables, in full generality, have type <code>Num a =&gt; [a]</code> which, again, can be specialized to <code>[Int]</code>. But I imagine you were thinking of them as integers anyway, so this is beside the point.</p>\n"}, {"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 3, "last_activity_date": 1532365548, "creation_date": 1532365548, "answer_id": 51483998, "question_id": 51483783, "link": "https://stackoverflow.com/questions/51483783/does-concat-return-a-foldable/51483998#51483998", "title": "Does concat return a Foldable?", "body": "<p>Every list is Foldable; there are other foldable types besides lists.  Other examples include <code>Vector</code> and <code>Seq</code>.  <code>concat</code> always returns a list.</p>\n\n<p>The input to <code>concat</code> is <code>Foldable t =&gt; t [a]</code>.  One type that satisfies the <code>Foldable</code> constraint is <code>[[Int]]</code> - lists of (lists of integers).  Another would be <code>Vector [Int]</code>.  The inside is always list, but the outside can vary.</p>\n\n<p>In both of your calls to <code>concat</code>, you pass a <code>[[Int]]</code> - the named inner lists <code>aa</code>, <code>bb</code>, <code>cc</code>, and the outer set of <code>[]</code> on the line with <code>concat</code>.  </p>\n\n<p><code>cc</code> has the same type as <code>aa</code> or <code>bb</code>.  I've been writing this as <code>[Int]</code>.  GHCi will give the more general type <code>Num a =&gt; [a]</code>, meaning a list of <code>a</code> for any numeric type you like - <code>Int</code>, <code>Float</code>, <code>Double</code>, <code>Integer</code>.</p>\n"}], "owner": {"reputation": 850, "user_id": 5484068, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/a2ec720ad8a18aa36c86f0d6db5672fb?s=128&d=identicon&r=PG&f=1", "display_name": "vincedjango", "link": "https://stackoverflow.com/users/5484068/vincedjango"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 51483987, "answer_count": 2, "score": 1, "last_activity_date": 1532365548, "creation_date": 1532364759, "question_id": 51483783, "link": "https://stackoverflow.com/questions/51483783/does-concat-return-a-foldable", "title": "Does concat return a Foldable?", "body": "<pre><code>Prelude&gt; :t concat\nconcat :: Foldable t =&gt; t [a] -&gt; [a]\n</code></pre>\n\n<p>Looking at the type information above, I understood that the value returned was not derived of the <em>Foldable</em> typeclass. So, in the code below, I was expecting the line <em>dd=concat [cc,aa]</em> to fail because cc is not a <em>Foldable</em>. But, as you can notice, it worked, why?</p>\n\n<pre><code>Prelude&gt; aa = [1,2]\nPrelude&gt; bb=[3,4]\nPrelude&gt; cc = concat[aa,bb]\nPrelude&gt; dd=concat [cc,aa]\nPrelude&gt; dd\n[1,2,3,4,1,2]\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1532363595, "post_id": 51483393, "comment_id": 89935814, "body": "Please show the actual code you&#39;ve tried this with."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1532366850, "post_id": 51483393, "comment_id": 89937466, "body": "If you want to be able to backtrack an arbitrary distance, you are creating a parser with O(2^N) runtime. Each comma in the source represents a choice (decimal point or field separator), and your parser&#39;s task is to search all possible choices for one that doesn&#39;t cause a parse failure."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532375300, "post_id": 51484325, "comment_id": 89941516, "body": "I don&#39;t even think <code>try</code> is enough. Doesn&#39;t this application require ambiguity detection? If there&#39;s more than one way to parse the file, that&#39;s pretty important to know!"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532376544, "post_id": 51484325, "comment_id": 89942059, "body": "@dfeuer From OP&#39;s description of the steps, I didn&#39;t get the impression that any ambiguity detection was supposed to take place. But you&#39;re right, that that&#39;s pretty dangerous."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532418772, "post_id": 51484325, "comment_id": 89955140, "body": "@dfeuer I am hoping that the whole thing is unambiguous by adding range constraints. Not sure thou if that is really the case."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 3, "last_activity_date": 1532370223, "last_edit_date": 1532370223, "creation_date": 1532367052, "answer_id": 51484325, "question_id": 51483393, "link": "https://stackoverflow.com/questions/51483393/how-far-does-try-back-track/51484325#51484325", "title": "How far does &quot;try&quot; back track?", "body": "<blockquote>\n  <p>How far does \u201ctry\u201d back track?</p>\n</blockquote>\n\n<p>The parser <code>try p</code> consumes exactly as much input as <code>p</code> if <code>p</code> parses successfully, otherwise it does not consume any input at all. So if you look at that in terms of backtracking, it backtracks to the point where you were when you invoked it.</p>\n\n<blockquote>\n  <p>My problem is that apparently the try only works in the 'current' float. There is no backtracking to previous positions. Is this correct?</p>\n</blockquote>\n\n<p>Yes, <code>try</code> does not \"unconsume\" input. All it does is to recover from a failure in the parser you give it without consuming any input. It does not undo the effects of any parsers that you've applied previously, nor does it affect subsequent parsers that you apply after <code>try p</code> succeeded.</p>\n\n<blockquote>\n  <p>And if so ... how would I go about implementing further back tracking?</p>\n</blockquote>\n\n<p>Basically what you want is to not only know whether <code>pointyFloatP</code> succeeds on the current input, but also whether the rest of your <code>lineP</code> would succeed after successfully <code>pointyFloatP</code> - and if it doesn't you want to backtrack back to before you applied <code>pointyFloatP</code>. So basically you want the parser for the whole remaining line in the <code>try</code>, not just the float parser.</p>\n\n<p>To achieve that you can make <code>floatP</code> take the parser for the remaining line as an argument like this:</p>\n\n<pre><code>floatP restP = try (pointyFloatP &lt;*&gt; restP) &lt;|&gt; unpointyFloatP &lt;*&gt; restP\n</code></pre>\n\n<p>Note that this kind of backtracking isn't going to be very efficient (but I assume you knew that going in).</p>\n"}, {"comments": [{"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1532418761, "post_id": 51488601, "comment_id": 89955135, "body": "I guess I should have noted that the values are not only doubles. But yes I am looking for a &quot;try all combinations&quot; method."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1532449797, "post_id": 51488601, "comment_id": 89975678, "body": "I added an example of a custom monadic parser for &quot;all possible parses&quot;.  This might help get you started."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1532449716, "last_edit_date": 1532449716, "creation_date": 1532389669, "answer_id": 51488601, "question_id": 51483393, "link": "https://stackoverflow.com/questions/51483393/how-far-does-try-back-track/51488601#51488601", "title": "How far does &quot;try&quot; back track?", "body": "<p><em>Update:</em> Include a custom monadic parser for more complex rows.</p>\n\n<h3>Using the List Monad for Simple Parsing</h3>\n\n<p>The list monad makes a better backtracking \"parser\" than Megaparsec.  For example, to parse the cells:</p>\n\n<pre><code>row :: [String]\nrow = [\"23\", \"95489\", \"0\", \"20\", \"9888\"]\n</code></pre>\n\n<p>into exactly three columns of values satisfying a particular bound (e.g., less than 30), you can generate all possible parses with:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n\nimport Control.Monad\nimport Control.Applicative\n\nrowResults :: [String] -&gt; [[Double]]\nrowResults = cols 3\n  where cols :: Int -&gt; [String] -&gt; [[Double]]\n\n        cols 0 [] = pure []   -- good, finished on time\n        cols 0 _  = empty     -- bad, didn't use all the data\n\n        -- otherwise, parse exactly @n@ columns from cells @xs@\n        cols n xs = do\n          -- form @d@ from one or two cells\n          (d, ys) &lt;- num1 xs &lt;|&gt; num2 xs\n          -- only accept @d &lt; 30@\n          guard $ d &lt; 30\n          ds &lt;- cols (n-1) ys\n          return $ d : ds\n\n        -- read number from a single cell\n        num1 (x:xs) | ok1 x = pure (read x, xs)\n        num1 _ = empty\n\n        -- read number from two cells\n        num2 (x:y:zs) | ok1 x &amp;&amp; ok2 y = pure (read (x ++ \".\" ++ y), zs)\n        num2 _ = empty\n\n        -- first cell: \"0\" is okay, but otherwise can't start with \"0\"\n        ok1 \"0\" = True\n        ok1 (c:_) | c /= '0' = True\n        ok1 _ = False\n\n        -- second cell: can't end with \"0\" (or *be* \"0\")\n        ok2 xs = last xs /= '0'\n</code></pre>\n\n<p>The above list-based parser tries to reduce ambiguity by assuming that if \"xxx,yyy\" is a number, the \"xxx\" won't start with zeros (unless it's just \"0\"), and the \"yyy\" won't end with a zero (or, for that matter, be a single \"0\").  If this isn't right, just modify <code>ok1</code> and <code>ok2</code> as appropriate.</p>\n\n<p>Applied to <code>row</code>, this gives the single unambiguous parse:</p>\n\n<pre><code>&gt; rowResults row\n[[23.95489,0.0,20.9888]]\n</code></pre>\n\n<p>Applied to an ambiguous row, it gives all parses:</p>\n\n<pre><code>&gt; rowResults [\"0\", \"12\", \"5\", \"0\", \"8601\"]\n[[0.0,12.5,0.8601],[0.0,12.5,0.8601],[0.12,5.0,0.8601]]\n</code></pre>\n\n<p>Anyway, I'd suggest using a standard CSV parser to parse your file into a matrix of <code>String</code> cells like so:</p>\n\n<pre><code>dat :: [[String]]\ndat = [ [\"23\", \"95489\", \"0\", \"20\", \"9888\"]\n      , [\"0\", \"12\", \"5\", \"0\", \"8601\"]\n      , [\"23\", \"2611\", \"2\", \"233\", \"14\", \"422\"]\n      ]\n</code></pre>\n\n<p>and then use <code>rowResults</code> above get the row numbers of rows that were ambiguous:</p>\n\n<pre><code>&gt; map fst . filter ((&gt;1) . snd) . zip [1..] . map (length . rowResults) $ dat\n[2]\n&gt;\n</code></pre>\n\n<p>or unparsable:</p>\n\n<pre><code>&gt; map fst . filter ((==0) . snd) . zip [1..] . map (length . rowResults) $ dat\n[]\n&gt;\n</code></pre>\n\n<p>Assuming there are no unparsable rows, you can regenerate one possible fixed file, even if some rows are ambiguous, but just grabbing the first successful parse for each row:</p>\n\n<pre><code>&gt; putStr $ unlines . map (intercalate \",\" . map show . head . rowResults) $ dat\n23.95489,0.0,20.9888\n0.0,12.5,0.8601\n23.2611,2.233,14.422\n&gt;\n</code></pre>\n\n<h3>Using a Custom Monad based on the List Monad for More Complex Parsing</h3>\n\n<p>For more complex parsing, for example if you wanted to parse a row like:</p>\n\n<pre><code>type Stream = [String]\nrow0 :: Stream\nrow0 = [\"Apple\", \"15\", \"1\", \"5016\", \"2\", \"5\", \"3\", \"1801\", \"11/13/2018\", \"X101\"]\n</code></pre>\n\n<p>with a mixture of strings and numbers, it's actually not that difficult to write a monadic parser, based on the list monad, that generates all possible parses.</p>\n\n<p>The key idea is to define a parser as a function that takes a stream and generates a list of possible parses, with each possible parse represented as a <em>tuple</em> of the object successfully parsed from the beginning of the stream paired with the remainder of the stream.  Wrapped in a newtype, our parallel parser would look like:</p>\n\n<pre><code>newtype PParser a = PParser (Stream -&gt; [(a, Stream)]) deriving (Functor)\n</code></pre>\n\n<p>Note the similarity to the type <code>ReadS</code> from <code>Text.ParserCombinators.ReadP</code>, which is also technically an \"all possible parses\" parser (though you usually only expect one, unambiguous parse back from a <code>reads</code> call):</p>\n\n<pre><code>type ReadS a = String -&gt; [(a, String)]\n</code></pre>\n\n<p>Anyway, we can define a <code>Monad</code> instance for <code>PParser</code> like so:</p>\n\n<pre><code>instance Applicative PParser where\n  pure x = PParser (\\s -&gt; [(x, s)])\n  (&lt;*&gt;) = ap\ninstance Monad PParser where\n  PParser p &gt;&gt;= f = PParser $ \\s1 -&gt; do  -- in list monad\n    (x, s2) &lt;- p s1\n    let PParser q = f x\n    (y, s3) &lt;- q s2\n    return (y, s3)\n</code></pre>\n\n<p>There's nothing too tricky here:  <code>pure x</code> returns a single possible parse, namely the result <code>x</code> with an unchanged stream <code>s</code>, while <code>p &gt;&gt;= f</code> applies the first parser <code>p</code> to generate a list of possible parses, takes them one by one within the list monad to calculate the next parser <code>q</code> to use (which, as per usual for a monadic operation, can depend on the result of the first parse), and generates a list of possible final parses that are returned.</p>\n\n<p>The <code>Alternative</code> and <code>MonadPlus</code> instances are pretty straightforward -- they just lift emptiness and alternation from the list monad:</p>\n\n<pre><code>instance Alternative PParser where\n  empty = PParser (const empty)\n  PParser p &lt;|&gt; PParser q = PParser $ \\s -&gt; p s &lt;|&gt; q s\ninstance MonadPlus PParser where\n</code></pre>\n\n<p>To run our parser, we have:</p>\n\n<pre><code>parse :: PParser a -&gt; Stream -&gt; [a]\nparse (PParser p) s = map fst (p s)\n</code></pre>\n\n<p>and now we can introduce primitives:</p>\n\n<pre><code>-- read a token as-is\ntoken :: PParser String\ntoken = PParser $ \\s -&gt; case s of\n  (x:xs) -&gt; pure (x, xs)\n  _ -&gt; empty\n\n-- require an end of stream\neof :: PParser ()\neof = PParser $ \\s -&gt; case s of\n  [] -&gt; pure ((), s)\n  _ -&gt; empty\n</code></pre>\n\n<p>and combinators:</p>\n\n<pre><code>-- combinator to convert a String to any readable type\nconvert :: (Read a) =&gt; PParser String -&gt; PParser a\nconvert (PParser p) = PParser $ \\s1 -&gt; do\n  (x, s2) &lt;- p s1     -- for each possible String\n  (y, \"\") &lt;- reads x  -- get each possible full read\n                      -- (normally only one)\n  return (y, s2)\n</code></pre>\n\n<p>and parsers for various \"terms\" in our CSV row:</p>\n\n<pre><code>-- read a string from a single cell\nstr :: PParser String\nstr = token\n\n-- read an integer (any size) from a single cell\nint :: PParser Int\nint = convert (mfilter ok1 token)\n\n-- read a double from one or two cells\ndbl :: PParser Double\ndbl = dbl1 &lt;|&gt; dbl2\n  where dbl1 = convert (mfilter ok1 token)\n        dbl2 = convert $ do\n          t1 &lt;- mfilter ok1 token\n          t2 &lt;- mfilter ok2 token\n          return $ t1 ++ \".\" ++ t2\n\n-- read a double that's &lt; 30\ndbl30 :: PParser Double\ndbl30 = do\n  x &lt;- dbl\n  guard $ x &lt; 30\n  return x\n\n-- rules for first cell of numbers:\n-- \"0\" is okay, but otherwise can't start with \"0\"\nok1 :: String -&gt; Bool\nok1 \"0\" = True\nok1 (c:_) | c /= '0' = True\nok1 _ = False\n\n-- rules for second cell of numbers:\n-- can't be \"0\" or end in \"0\"\nok2 :: String -&gt; Bool\nok2 xs = last xs /= '0'\n</code></pre>\n\n<p>Then, for a particular row schema, we can write a row parser as we normally would with a monadic parser:</p>\n\n<pre><code>-- a row\ndata Row = Row String Int Double Double Double\n               Int String String deriving (Show)\nrowResults :: PParser Row\nrowResults = Row &lt;$&gt; str &lt;*&gt; int &lt;*&gt; dbl30 &lt;*&gt; dbl30 &lt;*&gt; dbl30\n                 &lt;*&gt; int &lt;*&gt; str &lt;*&gt; str &lt;* eof\n</code></pre>\n\n<p>and get all possible parses:</p>\n\n<pre><code>&gt; parse rowResults row0\n[Row \"Apple\" 15 1.5016 2.0 5.3 1801 \"11/13/2018\" \"X101\"\n,Row \"Apple\" 15 1.5016 2.5 3.0 1801 \"11/13/2018\" \"X101\"]\n&gt;\n</code></pre>\n\n<p>The full program is:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n{-# OPTIONS_GHC -Wall #-}\n\nimport Control.Monad\nimport Control.Applicative\n\ntype Stream = [String]\n\nnewtype PParser a = PParser (Stream -&gt; [(a, Stream)]) deriving (Functor)\ninstance Applicative PParser where\n  pure x = PParser (\\s -&gt; [(x, s)])\n  (&lt;*&gt;) = ap\ninstance Monad PParser where\n  PParser p &gt;&gt;= f = PParser $ \\s1 -&gt; do  -- in list monad\n    (x, s2) &lt;- p s1\n    let PParser q = f x\n    (y, s3) &lt;- q s2\n    return (y, s3)\ninstance Alternative PParser where\n  empty = PParser (const empty)\n  PParser p &lt;|&gt; PParser q = PParser $ \\s -&gt; p s &lt;|&gt; q s\ninstance MonadPlus PParser where\n\nparse :: PParser a -&gt; Stream -&gt; [a]\nparse (PParser p) s = map fst (p s)\n\n-- read a token as-is\ntoken :: PParser String\ntoken = PParser $ \\s -&gt; case s of\n  (x:xs) -&gt; pure (x, xs)\n  _ -&gt; empty\n\n-- require an end of stream\neof :: PParser ()\neof = PParser $ \\s -&gt; case s of\n  [] -&gt; pure ((), s)\n  _ -&gt; empty\n\n-- combinator to convert a String to any readable type\nconvert :: (Read a) =&gt; PParser String -&gt; PParser a\nconvert (PParser p) = PParser $ \\s1 -&gt; do\n  (x, s2) &lt;- p s1     -- for each possible String\n  (y, \"\") &lt;- reads x  -- get each possible full read\n                      -- (normally only one)\n  return (y, s2)\n\n-- read a string from a single cell\nstr :: PParser String\nstr = token\n\n-- read an integer (any size) from a single cell\nint :: PParser Int\nint = convert (mfilter ok1 token)\n\n-- read a double from one or two cells\ndbl :: PParser Double\ndbl = dbl1 &lt;|&gt; dbl2\n  where dbl1 = convert (mfilter ok1 token)\n        dbl2 = convert $ do\n          t1 &lt;- mfilter ok1 token\n          t2 &lt;- mfilter ok2 token\n          return $ t1 ++ \".\" ++ t2\n\n-- read a double that's &lt; 30\ndbl30 :: PParser Double\ndbl30 = do\n  x &lt;- dbl\n  guard $ x &lt; 30\n  return x\n\n-- rules for first cell of numbers:\n-- \"0\" is okay, but otherwise can't start with \"0\"\nok1 :: String -&gt; Bool\nok1 \"0\" = True\nok1 (c:_) | c /= '0' = True\nok1 _ = False\n\n-- rules for second cell of numbers:\n-- can't be \"0\" or end in \"0\"\nok2 :: String -&gt; Bool\nok2 xs = last xs /= '0'\n\n-- a row\ndata Row = Row String Int Double Double Double\n               Int String String deriving (Show)\nrowResults :: PParser Row\nrowResults = Row &lt;$&gt; str &lt;*&gt; int &lt;*&gt; dbl30 &lt;*&gt; dbl30 &lt;*&gt; dbl30\n                 &lt;*&gt; int &lt;*&gt; str &lt;*&gt; str &lt;* eof\n\nrow0 :: Stream\nrow0 = [\"Apple\", \"15\", \"1\", \"5016\", \"2\", \"5\", \"3\", \"1801\", \"11/13/2018\", \"X101\"]\n\nmain = print $ parse rowResults row0\n</code></pre>\n\n<h3>Off-the-shelf Solutions</h3>\n\n<p>I find it a little surprising I can't find an existing parser library out there that provides this kind of \"all possible parses\" parser.  The stuff in <code>Text.ParserCombinators.ReadP</code> takes the right approach, but it assumes that you're parsing characters from a <code>String</code> rather than arbitrary tokens from some other stream (in our case, <code>String</code>s from a <code>[String]</code>).</p>\n\n<p>Maybe someone else can point out an off-the-shelf solution that would save you from having to role your own parser type, instances, and primitives.</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 1, "accepted_answer_id": 51484325, "answer_count": 2, "score": 3, "last_activity_date": 1532449716, "creation_date": 1532363210, "question_id": 51483393, "link": "https://stackoverflow.com/questions/51483393/how-far-does-try-back-track", "title": "How far does &quot;try&quot; back track?", "body": "<p>So ... I messed up a recording in CSV format:</p>\n\n<pre><code>23,95489,0,20,9888\n</code></pre>\n\n<p>Due to language settings floating point numbers were written with commas as seperator ... in a comma separated value file ...</p>\n\n<p>Problem is that the file does not have a nice formatting for every float. Some have no point at all and the number of numbers behind the point varies too.</p>\n\n<p>My idea was to build a <code>MegaParsec</code> parser that would try to read every possible floating point formatting, move on and if back track if it finds an error.</p>\n\n<p>Eg for the example above:</p>\n\n<ol>\n<li>read 23,95489 -> good</li>\n<li>read 0,20 -> good (so far)</li>\n<li>read 9888 -> error (because value is too high for column (checked by <code>guard</code>))</li>\n<li>(back tracking to 2.) read 0 -> good again</li>\n<li>read 20,9888 -> good</li>\n<li>done</li>\n</ol>\n\n<p>I've implemented that as (pseudo code here):</p>\n\n<pre><code>floatP = try pointyFloatP &lt;|&gt; unpointyFloatP\n\nlineP = (,,) &lt;$&gt; floatP &lt;* comma &lt;*&gt; floatP &lt;* comma &lt;*&gt; floatP &lt;* comma\n</code></pre>\n\n<p>My problem is that apparently the <code>try</code> only works in the 'current' float. There is no backtracking to previous positions. Is this correct?</p>\n\n<p>And if so ... how would I go about implementing further back tracking?</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1532357943, "post_id": 51480345, "comment_id": 89932373, "body": "How much input would you want <code>satisfyForString isURI</code> to read? Do you want it to read the largest prefix for which the predicate is true? That would mean going through the entire input, testing the predicate at each point, and then backtracking to the last point where the predicate was true. That would be pretty inefficient."}, {"owner": {"reputation": 11426, "user_id": 877028, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abf13baadf16bf12da0851a321850720?s=128&d=identicon&r=PG", "display_name": "Waiting for Dev...", "link": "https://stackoverflow.com/users/877028/waiting-for-dev"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1532358639, "post_id": 51480345, "comment_id": 89932814, "body": "The parser needs to be applied to a very small section of a line, because a new line character is expected just after the URI."}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1532357749, "post_id": 51480733, "comment_id": 89932239, "body": "&quot;I wouldn&#39;t be surprised if that already existed as a combinator somewhere&quot; I believe that&#39;d be <code>mfilter</code> from <code>Control.Monad</code>."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 4, "last_activity_date": 1532358050, "last_edit_date": 1532358050, "creation_date": 1532354680, "answer_id": 51480733, "question_id": 51480345, "link": "https://stackoverflow.com/questions/51480345/parsec-parse-string-that-satisfies-some-predicate/51480733#51480733", "title": "Parsec: parse string that satisfies some predicate", "body": "<p><code>ParsecT</code> is an instance of <code>Alternative</code>, so you can use <code>guard</code> to do something like this:</p>\n\n<pre><code>predicateP :: (a -&gt; Bool) -&gt; Parsec s u a -&gt; Parsec s u a\npredicateP pr p = do\n   x &lt;- p\n   guard $ pr x\n   return x\n</code></pre>\n\n<p>I wouldn't be surprised if that already existed as a combinator somewhere, but I'm not super familiar with <code>parsec</code>.</p>\n\n<p>Now that only gives you a way to apply a predicate; To apply that to a string you'll have to get a string which you think is or might be a URL first. How you get that depends on your domain (when parsing XML you'll most likely find those in attributes or text contents for instance).</p>\n"}], "owner": {"reputation": 11426, "user_id": 877028, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abf13baadf16bf12da0851a321850720?s=128&d=identicon&r=PG", "display_name": "Waiting for Dev...", "link": "https://stackoverflow.com/users/877028/waiting-for-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 51480733, "answer_count": 1, "score": 0, "last_activity_date": 1532358050, "creation_date": 1532353524, "question_id": 51480345, "link": "https://stackoverflow.com/questions/51480345/parsec-parse-string-that-satisfies-some-predicate", "title": "Parsec: parse string that satisfies some predicate", "body": "<p>Parsec already have a <code>satisfy</code> parser which succeeds when a given predicate returns <code>True</code> when applied to given char:</p>\n\n<pre><code>punctuationOrSymbol = satisfy isPunctuation &lt;|&gt; satisfy isSymbol\n</code></pre>\n\n<p>How can I do something similar for a whole string? I need it because I want to parse an URI but only if it is valid. For that, I want to leverage <a href=\"http://hackage.haskell.org/package/network-uri-2.6.1.0/docs/Network-URI.html#v:isURI\" rel=\"nofollow noreferrer\"><code>isURI</code> function in <code>network-uri</code> package</a>. Something like:</p>\n\n<pre><code>uri :: ParsecT s u m URI\nuri = parseURI &lt;$&gt; satisfyForString isURI\n</code></pre>\n\n<p>I suspect that it has something to do with <a href=\"http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec.html#v:token\" rel=\"nofollow noreferrer\"><code>token</code></a> function, but I'm new to Haskell and I haven't been able to understand it well.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1532350547, "post_id": 51479341, "comment_id": 89927051, "body": "What is your question?"}, {"owner": {"reputation": 1, "user_id": 10119789, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BJrQ8HISfy0/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oKR29xfZjpT-k02jJqcaHX1Ok9VQ/mo/photo.jpg?sz=128", "display_name": "israr amin", "link": "https://stackoverflow.com/users/10119789/israr-amin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532350740, "post_id": 51479341, "comment_id": 89927180, "body": "I want to write interactively one line in Hugs for finding out in what containers and what quantities apples are available in the store."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1532350961, "post_id": 51479341, "comment_id": 89927325, "body": "<code>filter ((&quot;apple&quot; ==) . first) fruit</code>. I would advice to use <code>ghc</code> instead, Hugs latest release was in 2006, so the project is &quot;<i>dead</i>&quot; for more than a decade."}, {"owner": {"reputation": 1, "user_id": 10119789, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BJrQ8HISfy0/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oKR29xfZjpT-k02jJqcaHX1Ok9VQ/mo/photo.jpg?sz=128", "display_name": "israr amin", "link": "https://stackoverflow.com/users/10119789/israr-amin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532351450, "post_id": 51479341, "comment_id": 89927683, "body": "Thank you. Works perfectly."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1532351059, "creation_date": 1532351059, "answer_id": 51479552, "question_id": 51479341, "link": "https://stackoverflow.com/questions/51479341/haskell-filtering-data/51479552#51479552", "title": "Haskell filtering data", "body": "<p>A couple of alternatives:</p>\n\n<pre><code>filter ((==\"apple\") . first) fruit\n[ f | f@(\"apple\",_,_) &lt;- fruit ]\n</code></pre>\n\n<p>The first one exploits your <code>first</code> projection, checking whether its result is equal to <code>\"apple\"</code>.</p>\n\n<p>The second one instead exploits list comprehensions, where elements that fail to pattern match are discarded.</p>\n\n<p>Perhaps an even more basic approach is using a lambda abstraction and equality.</p>\n\n<pre><code>filter (\\(s,_,_) -&gt; s == \"apple\") fruit\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10119789, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BJrQ8HISfy0/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oKR29xfZjpT-k02jJqcaHX1Ok9VQ/mo/photo.jpg?sz=128", "display_name": "israr amin", "link": "https://stackoverflow.com/users/10119789/israr-amin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 51479552, "answer_count": 1, "score": -1, "last_activity_date": 1532351059, "creation_date": 1532350481, "last_edit_date": 1532350541, "question_id": 51479341, "link": "https://stackoverflow.com/questions/51479341/haskell-filtering-data", "title": "Haskell filtering data", "body": "<p>I want to be able to filter the below data so I can find specific data for example if I wanted to find an item with only apples it would look similar to this output: <code>[(\"apple\",\"crate\",6),(\"apple\",\"box\",3)]</code></p>\n\n<pre><code>fruit :: [(String, String, Int)]\nfruit = [(\"apple\", \"crate\", 6), (\"pear\", \"crate\", 5), (\"mango\", \"box\", 4),\n(\"apple\", \"box\", 3), (\"banana\", \"box\", 5), (\"pear\", \"box\", 10), (\"apricot\",\n\"box\", 4), (\"peach\", \"box\", 5), (\"walnut\", \"box\", 4), (\"blueberry\", \"tray\", 10),\n (\"blackberry\", \"tray\", 4), (\"watermelon\", \"piece\", 8), (\"marrow\", \"piece\", 7), \n (\"hazelnut\", \"sack\", 2), (\"walnut\", \"sack\", 4)]\n\nfirst :: (a, b, c) -&gt; a\nfirst (x, _, _) = x\n\nsecond :: (a, b, c) -&gt; b\nsecond (_, y, _) = y\n\nthird :: (a, b, c) -&gt; c\nthird (_, _, z) = z\n</code></pre>\n"}, {"tags": ["haskell", "haskell-miso"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 2, "creation_date": 1532352358, "post_id": 51479306, "comment_id": 89928329, "body": "In the one Miso app I\u2019ve written, I didn\u2019t need any JavaScript at all; where I might have written a \u201ctemplate\u201d in an old-school framework, I\u2019d write an ordinary Haskell function to generate the HTML for me."}], "owner": {"reputation": 35, "user_id": 5214913, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/afb49429e8c01b361694ad12239f0f32?s=128&d=identicon&r=PG&f=1", "display_name": "Teddy", "link": "https://stackoverflow.com/users/5214913/teddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1532350374, "creation_date": 1532350374, "question_id": 51479306, "link": "https://stackoverflow.com/questions/51479306/can-templates-with-javascript-work-in-haskell-miso", "title": "can templates with javascript work in haskell miso", "body": "<p>For DTL(Django template language), usually I find templates and just fill contents, everything will work. Now I am looking at elm and haskell miso. It seems that for elm, I have to handle javascript carefully, some may need to implement in elm.  </p>\n\n<p>What about haskell miso? I looked into some examples, it seems that if a template include javascript files, I can still include them in miso, just need to handle something like OnClick, etc.? Is it behave the same as in DTL?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "monads", "standard-library"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532349461, "post_id": 51478836, "comment_id": 89926293, "body": "Furthermore in the context of <code>IO</code>, there is the <code>finally</code>: <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Exception-Base.html#v:finally\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/&hellip;</a>. But this is more used in combination with the <i>exception</i> mechanism, so is is not semantically entirely the same."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532349890, "post_id": 51478836, "comment_id": 89926593, "body": "@WillemVanOnsem Can I ask you to undelete the previous comments, or, even better, consolidate them into leftaroundabout&#39;s answer? They are of value."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1532356354, "post_id": 51478836, "comment_id": 89931262, "body": "Check out <a href=\"https://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a> for info on hoogle and other FAQs"}], "answers": [{"comments": [{"owner": {"reputation": 5728, "user_id": 7907591, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/0vpof.jpg?s=128&g=1", "display_name": "Morse", "link": "https://stackoverflow.com/users/7907591/morse"}, "edited": false, "score": 1, "creation_date": 1532986755, "post_id": 51479089, "comment_id": 90171252, "body": "Please put some explanation, that helps."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5728, "user_id": 7907591, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/0vpof.jpg?s=128&g=1", "display_name": "Morse", "link": "https://stackoverflow.com/users/7907591/morse"}, "edited": false, "score": 0, "creation_date": 1532993021, "post_id": 51479089, "comment_id": 90172941, "body": "@Prateek I don&#39;t see what&#39;s to explain for a question that asks \u201cwhat standard function is equivalent to <code>\\a b -&gt; a &gt;&gt;= \\x -&gt; b &gt;&gt; return x</code>\u201d, if it can be answered fully with \u201c<code>(&lt;*)</code> is\u201d. I actually find it a bit silly that this trivial answer to a trivial question is upvoted so much, but here we go."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 13, "last_activity_date": 1532349690, "creation_date": 1532349690, "answer_id": 51479089, "question_id": 51478836, "link": "https://stackoverflow.com/questions/51478836/is-there-a-standard-function-like-but-returning-the-result-of-the-first-op/51479089#51479089", "title": "Is there a standard function like `&gt;&gt;`, but returning the result of the first operand?", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Applicative.html#v:-60--42-\" rel=\"noreferrer\"></p>\n\n<pre><code>(&lt;*) :: Applicative f =&gt; f a -&gt; f b -&gt; f a\n</code></pre>\n\n<p></a></p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 51479089, "answer_count": 1, "score": 4, "last_activity_date": 1532349690, "creation_date": 1532348968, "question_id": 51478836, "link": "https://stackoverflow.com/questions/51478836/is-there-a-standard-function-like-but-returning-the-result-of-the-first-op", "title": "Is there a standard function like `&gt;&gt;`, but returning the result of the first operand?", "body": "<p>For instance, suppose I want to read a line and also ring a bell:</p>\n\n<pre><code>\u03bb getLine &gt;&gt; putChar '\\007'\nHow lang and dreary is the night when I am frae my Dearie.\n-- Blip and `()`. The line is lost.\n\u03bb getLine &gt;&gt;= (\\x -&gt; putChar '\\007' &gt;&gt; return x\nI restless lie frae e'en to morn though I were ne'er sae weary.\n\"I restless lie frae e'en to morn though I were ne'er sae weary.\"\n-- A line and also a blip side effect.\n</code></pre>\n\n<p>The idea seems to have much in common with <code>const</code>, the only difference being that the values given are effectful, and are both executed, even though only the value of the first action is retained. <em>(Unlike with <code>&gt;&gt;</code>, which retains the value from the second.)</em> What I mean exactly is this:</p>\n\n<pre><code>\u03bb constM a b = a &gt;&gt;= \\x -&gt; b &gt;&gt; return x\n</code></pre>\n\n<p>Here is a more complex example, involving parsers from <code>Text.ParserCombinators.ReadP</code>:</p>\n\n<pre><code>\u03bb readP_to_S (many1 (munch1 (not . isSpace) `constM` skipSpaces ) `constM` eof) &lt;$&gt; getLine\nHow slow ye move, ye heavy hours.\n[([\"How\",\"slow\",\"ye\",\"move,\",\"ye\",\"heavy\",\"hours.\"],\"\")]\n</code></pre>\n\n<p>&nbsp;</p>\n\n<p>I wonder if this function is available in <code>base</code>, or easily constructible from other functions in <code>base</code>.</p>\n"}, {"tags": ["haskell", "gadt", "coercion", "existential-type"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1532318394, "post_id": 51470829, "comment_id": 89911064, "body": "The issue is that GHC doesn&#39;t know what how to use a <code>Coercible Int (t a)</code>. The error message becomes a tiny bit clearer if you swap out <code>Coercible Int (t a)</code> for <code>Int ~ t a</code>. OTOH, something like <code>Coercible [Int] (t a)</code> is fine, since you are coercing from from type constructor to type constructor."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1532339081, "post_id": 51470829, "comment_id": 89919862, "body": "<code>g (B t) = 42</code> already triggers the error. It seems the issue lies in pattern matching, not in the use of <code>coerce</code>. Maybe, for some reason, the constraint is <i>required</i> in the pattern matching, instead of <i>provided</i> (as one would expect with GADTs)?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1532364747, "post_id": 51470829, "comment_id": 89936399, "body": "@chi It\u2019s not required, not directly. The compiler believes that the constraint is impossible and is saying that the entire equation is therefore unreachable. I think Alec is on to something: however GHC is checking the constraint may have confused representational equality with propositional equality (a bug). That is my hypothesis."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1532371343, "post_id": 51470829, "comment_id": 89939667, "body": "@HTNW It is quite weird. Using <code>Int</code> triggers &quot;Inaccessible code&quot;. Using <code>Identity Int</code> does that as well. Using <code>[Int]</code> instead is OK. Maybe GHC needs to know that <code>t</code> is representational, but there&#39;s no way to specify that."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1532371422, "post_id": 51484218, "comment_id": 89939699, "body": "I&#39;d try to <code>UNPACK</code> that, hoping that it becomes free. I&#39;m unsure about what would happen, though."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1532375458, "post_id": 51484218, "comment_id": 89941592, "body": "@chi There is currently no way whatsoever to unpack a <code>Coercible</code> constraint. I opened a GHC proposal about that, but it&#39;s dormant. The <code>Coercion</code> itself will be unpacked by the default <code>-funbox-small-strict-fields</code> when compiling with optimization."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532393175, "post_id": 51484218, "comment_id": 89946768, "body": "@dfeuer I don&#39;t think <code>Coercion</code> is unpacked. At least, an explicit <code>{-# UNPACK #-}</code> emits a &quot;this does nothing&quot; warning, so I can&#39;t see why <code>-funbox-small-strict-fields</code> would work."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532404098, "post_id": 51484218, "comment_id": 89948785, "body": "@HTNW, <code>Coercion</code> should unpack to <code>Coercible</code>, which is not itself unpacked. The best way to check is to use <code>-ddump-simpl</code> and look at the code for the constructor wrapper. I&#39;m pretty surprised by that warning. What version are you using?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1532415337, "post_id": 51484218, "comment_id": 89953092, "body": "@dfeuer 8.4.3, -O2. -Wall tells me the UNPACK is unusable. -ddump-simpl shows that the constructor wrapper takes a full Coercion, evaluates it, and stores it wholesale. EDIT: It works on HEAD."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532436413, "post_id": 51484218, "comment_id": 89965902, "body": "Oh yes, I missed the fact that the former inability of GADTs to unpack (ever) affected <code>Coercion</code> too. There&#39;s still a restriction on existentials, but I think that can usually be worked around."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 1, "last_activity_date": 1532445427, "last_edit_date": 1532445427, "creation_date": 1532366560, "answer_id": 51484218, "question_id": 51470829, "link": "https://stackoverflow.com/questions/51470829/coercible-and-existential/51484218#51484218", "title": "Coercible and existential", "body": "<p>As a workaround, you may replace the constraint (which is not free in the first place) with a <code>Data.Type.Coercion.Coercion</code> (which adds an extra <code>data</code> wrapper around the dictionary).</p>\n\n<pre><code>data T t where\n  A :: Show (t a) =&gt; t a -&gt; T t\n  B :: !(Coercion Int (t a)) -&gt; t a -&gt; T t\n    -- ! for correctness: you can\u2019t have wishy-washy values like B _|_ (I \"a\")\n    -- Such values decay to _|_\nf :: T t -&gt; String\nf (A x) = show x\nf (B c x) = show (coerceWith (sym c) x)\n\nnewtype I a = I a\nmain = putStrLn $ f $ B Coercion $ I (5 :: Int)\n</code></pre>\n\n<p>GHC 8.6 will improve this situation in two ways:</p>\n\n<ul>\n<li><p>Your original code will work, as the underlying bug was fixed.</p></li>\n<li><p>The <code>Coercion</code> can be unpacked to a <code>Coercible</code> constraint, and this will happen automatically, due to <code>-funbox-small-strict-fields</code>. Thus, this <code>T</code> will get performance characteristics equivalent to your original for free.</p></li>\n</ul>\n"}], "owner": {"reputation": 581, "user_id": 3394868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/402bcd81a3d7272953e077610bc54db9?s=128&d=identicon&r=PG&f=1", "display_name": "NioBium", "link": "https://stackoverflow.com/users/3394868/niobium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1532445427, "creation_date": 1532312114, "last_edit_date": 1532376884, "question_id": 51470829, "link": "https://stackoverflow.com/questions/51470829/coercible-and-existential", "title": "Coercible and existential", "body": "<pre><code>data T t where\n  A :: Show (t a) =&gt; t a -&gt; T t\n  B :: Coercible Int (t a) =&gt; t a -&gt; T t\n\nf :: T t -&gt; String\nf (A t) = show t\n\ng :: T t -&gt; Int\ng (B t) = coerce t\n</code></pre>\n\n<p>Why does <code>f</code> compile but <code>g</code> generate an error like follows? I'm using GHC 8.4.</p>\n\n<pre><code>\u2022 Couldn't match representation of type \u2018Int\u2019 with that of \u2018t a\u2019\n  Inaccessible code in\n    a pattern with constructor:\n      B :: forall k (t :: k -&gt; *) (a :: k).\n           Coercible Int (t a) =&gt;\n           t a -&gt; T t,\n    in an equation for \u2018g\u2019\n\u2022 In the pattern: B t\n  In an equation for \u2018g\u2019: g (B t) = coerce t\n</code></pre>\n\n<p>Also, are <code>Coercible</code> constraints zero-cost even when they are embedded in GADTs?</p>\n\n<p>UPD: Compiler bug: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15431\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/15431</a></p>\n"}, {"tags": ["haskell", "haskell-thyme"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1532298441, "creation_date": 1532298441, "answer_id": 51469745, "question_id": 51469719, "link": "https://stackoverflow.com/questions/51469719/couldnt-match-type-time-1-8-0-2data-time-clock-internal-utctime-utctime-with/51469745#51469745", "title": "Couldn&#39;t match type \u2018time-1.8.0.2:Data.Time.Clock.Internal.UTCTime.UTCTime\u2019 with \u2018UTCTime\u2019", "body": "<p>Because:</p>\n\n<pre><code>fromThyme :: Thyme b a =&gt; a -&gt; b\ninstance Thyme Data.Time.Clock.UTCTime UTCView\n</code></pre>\n\n<p>You should probably use <a href=\"http://hackage.haskell.org/package/thyme-0.3.5.5/docs/Data-Thyme-Clock.html#v:utcTime\" rel=\"nofollow noreferrer\"><code>utcTime</code></a> instead.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 51469745, "answer_count": 1, "score": 1, "last_activity_date": 1532298441, "creation_date": 1532298088, "question_id": 51469719, "link": "https://stackoverflow.com/questions/51469719/couldnt-match-type-time-1-8-0-2data-time-clock-internal-utctime-utctime-with", "title": "Couldn&#39;t match type \u2018time-1.8.0.2:Data.Time.Clock.Internal.UTCTime.UTCTime\u2019 with \u2018UTCTime\u2019", "body": "<p>I don't understand why I am getting this error using the <code>thyme</code> library:</p>\n\n<pre><code>\u03bb import qualified Data.Thyme.Format as ABC (formatTime)                                                                                          \n\u03bb import qualified Data.Thyme.Clock as XYZ                                        \n\u03bb import Data.Thyme.Time.Core (fromThyme)                                         \n\u03bb let test123 :: XYZ.UTCView -&gt; String; test123 p = ABC.formatTime defaultTimeLocale \"%Y-%m-%d\" (fromThyme p :: XYZ.UTCTime)\n\n&lt;interactive&gt;:4:96: error:\n    \u2022 Couldn't match type \u2018time-1.8.0.2:Data.Time.Clock.Internal.UTCTime.UTCTime\u2019\n                     with \u2018XYZ.UTCTime\u2019\n      NB: \u2018XYZ.UTCTime\u2019\n            is defined in \u2018Data.Thyme.Clock.Internal\u2019\n                in package \u2018thyme-0.3.5.5\u2019\n          \u2018time-1.8.0.2:Data.Time.Clock.Internal.UTCTime.UTCTime\u2019\n            is defined in \u2018Data.Time.Clock.Internal.UTCTime\u2019\n                in package \u2018time-1.8.0.2\u2019\n        arising from a functional dependency between:\n          constraint \u2018Data.Thyme.Time.Core.Thyme XYZ.UTCTime XYZ.UTCView\u2019\n            arising from a use of \u2018fromThyme\u2019\n          instance \u2018Data.Thyme.Time.Core.Thyme\n                      time-1.8.0.2:Data.Time.Clock.Internal.UTCTime.UTCTime XYZ.UTCView\u2019\n            at &lt;no location info&gt;\n    \u2022 In the third argument of \u2018formatTime\u2019, namely\n        \u2018(fromThyme p :: XYZ.UTCTime)\u2019\n      In the expression:\n        formatTime\n          defaultTimeLocale \"%Y-%m-%d\" (fromThyme p :: XYZ.UTCTime)\n      In an equation for \u2018test123\u2019:\n          test123 p\n            = formatTime\n                defaultTimeLocale \"%Y-%m-%d\" (fromThyme p :: XYZ.UTCTime)\n</code></pre>\n\n<p>Why is it referencing the UTCTime defined within the <code>time</code> library?</p>\n\n<p><a href=\"http://hackage.haskell.org/package/thyme-0.3.5.5/docs/Data-Thyme-Format.html#t:FormatTime\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/thyme-0.3.5.5/docs/Data-Thyme-Format.html#t:FormatTime</a></p>\n"}, {"tags": ["haskell", "hdbc"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1532293372, "post_id": 51468126, "comment_id": 89906913, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21319802/deserializing-data-form-a-sql-database\">Deserializing data form a SQL Database</a>"}], "answers": [{"comments": [{"owner": {"reputation": 566, "user_id": 2749966, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Lpw8X.jpg?s=128&g=1", "display_name": "FlogFR", "link": "https://stackoverflow.com/users/2749966/flogfr"}, "edited": false, "score": 0, "creation_date": 1534234509, "post_id": 51469319, "comment_id": 90626738, "body": "GeneralizedNewtypeDeriving seems to not be safe for production."}], "tags": [], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "is_accepted": true, "score": 0, "last_activity_date": 1532294098, "creation_date": 1532294098, "answer_id": 51469319, "question_id": 51468126, "link": "https://stackoverflow.com/questions/51468126/haskell-hdbc-library-is-there-an-elegant-way-to-convert-between-sqlvalue-and/51469319#51469319", "title": "Haskell HDBC library: Is there an elegant way to convert between [SqlValue] and records?", "body": "<p>Depending on what library you're using the type <code>(Int, Int, String, ...)</code> may already have a (as in e.g. <code>sqlite-simple</code>) <code>FromRow</code> instance. If you need <code>Item</code> to be a new type you can use the <code>GeneralizedNewtypeDeriving</code> extension to get that instance for free. Barring this you could of course define your own type class/helper method to make it more DRY.</p>\n"}], "owner": {"reputation": 94, "user_id": 5504651, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/36f9632b5e73c225475a644e029ead84?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/5504651/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 51469319, "answer_count": 1, "score": 0, "last_activity_date": 1532294098, "creation_date": 1532284480, "question_id": 51468126, "link": "https://stackoverflow.com/questions/51468126/haskell-hdbc-library-is-there-an-elegant-way-to-convert-between-sqlvalue-and", "title": "Haskell HDBC library: Is there an elegant way to convert between [SqlValue] and records?", "body": "<p>Since I can't <code>map</code> over a record, the best method I have found is to just use brute force:</p>\n\n<pre><code>data Item = Item {\n  vendor :: Int,\n  lotNumber :: Int,\n  description :: String,\n  reserve :: Maybe Double,\n  preSaleBids :: Maybe Double,\n  salePrice :: Maybe Double,\n  purchaser :: Maybe Int,\n  saleID :: Maybe Int\n}\n\nhsToDb :: Item -&gt; [SqlValue]\nhsToDb (Item a b c d e f g h) = [toSql a, toSql b, toSql c, toSql d, toSql e, toSql f, toSql g, toSql h]\n\ndbToHs :: [SqlValue] -&gt; Item\ndbToHs [a,b,c,d,e,f,g,h] = Item (fromSql a) (fromSql b) (fromSql c) (fromSql d) (fromSql e) (fromSql f) (fromSql g) (fromSql h)\n</code></pre>\n\n<p>This code looks ugly and also requires updating if I change the length of my <code>Item</code> record so I was wondering whether there's a clever way of generalizing this idea.</p>\n"}, {"tags": ["haskell", "time", "haskell-thyme"], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1578159009, "post_id": 51466080, "comment_id": 105351462, "body": "This actually seems to give a type of <code>UTCView</code> <code>:t UTCTime ((YearMonthDay 2018 7 21)^.from gregorian) (toEnum 0)UTCTime ((YearMonthDay 2018 7 21)^.from gregorian) (toEnum 0)   :: UTCView</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1578160062, "last_edit_date": 1578160062, "creation_date": 1532269653, "answer_id": 51466080, "question_id": 51465700, "link": "https://stackoverflow.com/questions/51465700/how-do-i-create-a-utctime-from-int-values-using-the-thyme-library-in-haskell/51466080#51466080", "title": "How do I create a UTCTime from Int values, using the thyme library in Haskell?", "body": "<p>The following imports are required:</p>\n\n<pre><code>import Control.Lens\nimport Data.Thyme.Clock\nimport Data.Thyme.Calendar\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>makeUtcTime :: Year -&gt; Month -&gt; DayOfMonth -&gt; Int -&gt; UTCTime\nmakeUtcTime y m d x =  UTCTime ((YearMonthDay y m d)^.from gregorian) (toEnum x) ^. from utcTime\n</code></pre>\n\n<p>Within ghci:</p>\n\n<pre><code>:t makeUtcTime 2020 1 1 9143892431\nmakeUtcTime 2020 1 1 9143892431 :: UTCTime\n</code></pre>\n\n<p>(Perhaps there's a simpler way, but this is not too bad)</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 51466080, "answer_count": 1, "score": 2, "last_activity_date": 1578160062, "creation_date": 1532267029, "last_edit_date": 1532267843, "question_id": 51465700, "link": "https://stackoverflow.com/questions/51465700/how-do-i-create-a-utctime-from-int-values-using-the-thyme-library-in-haskell", "title": "How do I create a UTCTime from Int values, using the thyme library in Haskell?", "body": "<p>I've got a year, month, day, hour and minute value (all of them are of type <code>Int</code>) - how can I convert these to a <code>UTCTime</code> or <code>UniversalTime</code>?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1532269486, "post_id": 51465667, "comment_id": 89900521, "body": "Doesn&#39;t answer your question but you could try to look at server in this project template: <a href=\"https://github.com/Holmusk/three-layer/blob/master/src/Lib/Server.hs\" rel=\"nofollow noreferrer\">github.com/Holmusk/three-layer/blob/master/src/Lib/Server.hs</a> Also, <code>servant-generic</code> got merged to <code>servant-0.14</code> and API slightly changed. So be aware of this when you will bump up <code>servant</code> version."}], "answers": [{"comments": [{"owner": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "edited": false, "score": 0, "creation_date": 1532294585, "post_id": 51466928, "comment_id": 89907149, "body": "Thanks, that works. I just had to make <code>page</code> a top-level function and specify its type signature to avoid ambiguous type errors, do you know if it&#39;s possible to avoid turning it into a top-level function? Also I had to add <code>conns</code> as an parameter for <code>app</code> and pass it to <code>oldStyleServerInHandler</code>, and I replaced <code>genericServerT</code> with <code>toServant</code> to make it work with <code>servant-server-0.13.0.1</code>. <code>home</code> still doesn&#39;t work because it returns <code>Server Raw</code> (but this one might be the subject of another question)."}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "reply_to_user": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "edited": false, "score": 1, "creation_date": 1532299919, "post_id": 51466928, "comment_id": 89908053, "body": "For the ambiguous types, you probably need to give a type annotation somewhere just so that GHC knows the monad once and for all. For <code>conns</code>, yes sorry, I forgot to make it an argument of <code>app</code>. For <code>home</code> just try calling <code>Data.Tagged.retag</code> on the handler that serves the files, so that it is tagged with your monad instead of <code>Handler</code>. Or use <code>servant &gt;= 0.14</code> where the file serving utilities are made polymorphic in the monad."}], "tags": [], "owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "is_accepted": true, "score": 1, "last_activity_date": 1532360051, "last_edit_date": 1532360051, "creation_date": 1532275749, "answer_id": 51466928, "question_id": 51465667, "link": "https://stackoverflow.com/questions/51465667/using-servant-generic-routes-with-readert-pool-connection-io/51466928#51466928", "title": "Using Servant.Generic routes with ReaderT (Pool Connection) IO", "body": "<p>At least for the record-style routes supported by servant-* >= 0.14 (see <a href=\"https://hackage.haskell.org/package/servant-server-0.14.1/docs/Servant-Server-Generic.html\" rel=\"nofollow noreferrer\">here</a>), if you want to work with another monad than <code>Handler</code>, you will want to look at <code>AsServerT</code> and <code>genericServerT</code>.</p>\n\n<p>Applied to your example, this means <code>siteServer</code> should be defined as follows (not typechecked, but should be very close to correct).</p>\n\n<pre><code>siteServer :: Site (AsServerT AppM)\nsiteServer = Site\n  { page = ... something in AppM ...\n  , home = ... something in AppM ...\n  }\n\n-- turning that into a usual chain of :&lt;|&gt;-separated handlers\noldStyleServer :: ServerT API AppM\noldStyleServer = genericServerT siteServer\n\n-- bringing it all back in Handler\noldStyleServerInHandler :: Pool Connection -&gt; Server API -- same as ServerT API Handler\noldStyleServerInHandler conns = hoistServer (Proxy @API) appToHandler oldStyleServer\n  where appToHandler = liftIO . flip runReaderT conns\n        -- or something along those lines\n\n-- serving it\napp :: Pool Connection -&gt; Application\napp conns = serve (Proxy @API) (oldStyleServerInHandler conns)\n</code></pre>\n\n<p><strong>Edit:</strong> Since you're using servant-* &lt; 0.14 with servant-generic, you should replace <code>genericServerT</code> with <a href=\"https://hackage.haskell.org/package/servant-generic-0.1.0.3/docs/Servant-Generic.html#v:toServant\" rel=\"nofollow noreferrer\"><code>toServant</code></a>.</p>\n"}], "owner": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 51466928, "answer_count": 1, "score": 1, "last_activity_date": 1532360051, "creation_date": 1532266825, "question_id": 51465667, "link": "https://stackoverflow.com/questions/51465667/using-servant-generic-routes-with-readert-pool-connection-io", "title": "Using Servant.Generic routes with ReaderT (Pool Connection) IO", "body": "<p>I was using <code>servant-generic-0.1.0.3</code> and <code>servant-server-0.13.0.1</code> to do the following:</p>\n\n<pre><code>data Site route = Site\n  { page :: route :-\n      \"page\" :&gt; Capture \"x\" Int :&gt; Capture \"y\" Int :&gt; Get '[JSON] [Int]\n  , home :: route :-\n      Raw\n  } deriving (Generic)\n\ntype API = ToServant (Site AsApi)\n\nsiteServer :: Pool Connection -&gt; Site AsServer\nsiteServer pool = Site\n  { page = \\x y -&gt;\n      liftIO $ withResource pool $ \\conn -&gt; someDbFunction conn x y\n  , home = serveDirectoryWebApp \"static\"\n  }\n\napi :: Proxy API\napi = Proxy\n\napp :: Pool Connection -&gt; Application\napp pool = serve api (toServant $ siteServer pool)\n</code></pre>\n\n<p>That worked fine, then I tried to use <code>ReaderT</code> to avoid passing <code>Pool Connection</code> to <code>siteServer</code>, so I added <code>AppM</code> and replaced <code>siteServer</code> like this:</p>\n\n<pre><code>type AppM = ReaderT (Pool Connection) IO\n\nsiteServer :: ServerT API AppM\nsiteServer = Site\n  { page = do\n      pool &lt;- ask\n      \\x y -&gt;\n        liftIO $ withResource pool $ \\conn -&gt; someDbFunction conn x y\n  , home = serveDirectoryWebApp \"static\"\n  }\n</code></pre>\n\n<p>but I got a bunch of errors when I tried to compile it.</p>\n\n<p>I followed the same steps shown in the <a href=\"https://haskell-servant.readthedocs.io/en/stable/cookbook/using-custom-monad/UsingCustomMonad.html\" rel=\"nofollow noreferrer\">servant cookbook</a>, but I couldn't make this work with generic routes, although it works when using regular routes.</p>\n\n<p>Am I missing something that could make this work?</p>\n"}, {"tags": ["haskell", "interface", "type-inference", "typeclass", "partial-application"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532239358, "post_id": 51462005, "comment_id": 89893864, "body": "Can you provide a bit more information?  Why is it important that two functions with incompatible signatures share a name?  What sort of code are you writing that abstracts over the interface?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532239965, "post_id": 51462005, "comment_id": 89893973, "body": "@Carl I would like to unify these two functions: <code>insert :: Ord k =&gt; k -&gt; v -&gt; Map k v -&gt; Map k v</code> and <code>insert :: Ord a =&gt; a -&gt; Set a -&gt; Set a</code>. Yes, I know that this might be a bad idea and that some people might not like it. But I don&#39;t force anyone to use this approach. I just interested whether it&#39;s possible or not."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1532240283, "post_id": 51462005, "comment_id": 89894024, "body": "That doesn&#39;t sound like a useful thing to do. You should create unified interfaces when it&#39;s possible to write meaningful code that doesn&#39;t care what instance of the interface it&#39;s using, not when names happen to be the same.  This is true in all languages.  If you don&#39;t have the ability to use different instantiations interchangeably, you don&#39;t have an abstraction, you have a coincidence."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1532241915, "post_id": 51462005, "comment_id": 89894265, "body": "The indentation you show on types can be misleading. You should match the first argument with the first, the second with the second, etc. At the end on one type you have the return type <code>y</code> which is matched on the other side with <code>x -&gt; x</code>. In general, overloading could be done via type classes, but it can create ambiguities in some cases during type inference, especially when using partial application and/or higher order functions (<code>map (foo a)</code>). This will require the user to use a type annotation, making it less convenient."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1532243148, "post_id": 51462005, "comment_id": 89894497, "body": "@Carl It&#39;s possible to have separate names like <code>insertMap</code> and <code>insertSet</code> to separate use cases. But it&#39;s less convenient since historically name is <code>insert</code> for different types :( I don&#39;t think this is only <i>coincidence</i> because <code>Set a</code> can be just a special case of <code>Map</code> like <code>Map a ()</code>. But it&#39;s not convenient to insert <code>()</code> manually."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1532243274, "post_id": 51462005, "comment_id": 89894514, "body": "@chi Yes, I have solution which works with all arguments provided but requires <code>-XTypeApplications</code> in case of partial application. This is not very convenient because one of most often uses cases is something like <code>x = foldr insert mempty myData</code> but when type of <code>x</code> is known in advance so I want compiler to be able to pick <code>insert</code> for <code>Set</code>. Re indentation: that&#39;s a fair point, I fixed this."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1532273075, "post_id": 51462005, "comment_id": 89901504, "body": "If <code>foo</code> were uncurried to <code>foo :: (a, b) -&gt; x -&gt; x</code>, it would make more sense to unify <code>foo</code> and <code>bar</code>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1532273546, "post_id": 51462005, "comment_id": 89901624, "body": "@chepner Yeah, it&#39;s quite trivial to unify <code>(a, b)</code> and <code>c</code> but <code>insert k v</code> is more convenient than <code>insert (k, v)</code> and has less performance overhead."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1532277756, "post_id": 51462005, "comment_id": 89902818, "body": "You said you tried something and weren&#39;t satisfied with it.  How about including what you tried and what specifically was wrong with it (e.g., in what context did you need to provide an explicit type application)?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1532326089, "post_id": 51462005, "comment_id": 89913004, "body": "@K.A.Buhr Done. I&#39;ve added my solution."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1532353937, "creation_date": 1532353937, "answer_id": 51480492, "question_id": 51462005, "link": "https://stackoverflow.com/questions/51462005/unified-interface-between-functions-of-different-number-of-arguments/51480492#51480492", "title": "Unified interface between functions of different number of arguments", "body": "<p>I guess the following probably works.  As per the comments, it's still a terrible, terrible, terrible idea.  If you really want to write Haskell like this, then you don't really want to write Haskell.</p>\n\n<p>Anyway, the idea is to provide a type class for:</p>\n\n<pre><code>insert :: (Ord k) =&gt; k -&gt; v -&gt; a\n</code></pre>\n\n<p>parameterized in all three parameters with a functional dependency specifying that <code>a</code> determines <code>k</code> and <code>v</code>.  In your case, <code>a ~ (Map k' v' -&gt; Map k' v')</code> implies <code>k ~ k'</code> and <code>v ~ v'</code>, while <code>a ~ Set t</code> implies <code>k ~ t</code> and <code>v ~ Set t</code>.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FunctionalDependencies,\n             NoMonomorphismRestriction #-}\n\nmodule UnifiedInsert where\n\n-- insert :: Ord k =&gt; k -&gt; v -&gt; Map k v -&gt; Map k v\n-- insert :: Ord a =&gt; a -&gt; Set a -&gt; Set a\n\nimport Data.Map (Map)\nimport qualified Data.Map as Map\nimport Data.Set (Set)\nimport qualified Data.Set as Set\n\nclass Insert k v a | a -&gt; k, a -&gt; v where\n  insert :: (Ord k) =&gt; k -&gt; v -&gt; a\ninstance Insert k (Set k) (Set k) where\n  insert = Set.insert\ninstance Insert k v (Map k v -&gt; Map k v) where\n  insert = Map.insert\n\nfromList = foldr insert mempty\n\nfoo1 :: Set Int\nfoo1 = fromList [1..10]\n</code></pre>\n\n<p>Note that the type checker can deduce the type of the function <code>fromList</code> (even if <code>foo1</code> is dropped from the program), as long as the monomorphism restriction is off.  It will have the rather preposterous type:</p>\n\n<pre><code>fromList :: (Foldable t, Insert k v v, Ord k, Monoid v) =&gt; t k -&gt; v\n</code></pre>\n\n<p>which can, indeed, be specialized to <code>Ord a =&gt; [a] -&gt; Set a</code>, as required.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 1, "accepted_answer_id": 51480492, "answer_count": 1, "score": 2, "last_activity_date": 1532353937, "creation_date": 1532233098, "last_edit_date": 1532326052, "question_id": 51462005, "link": "https://stackoverflow.com/questions/51462005/unified-interface-between-functions-of-different-number-of-arguments", "title": "Unified interface between functions of different number of arguments", "body": "<p>I have two functions like these:</p>\n\n<pre><code>foo :: a -&gt; b -&gt; x -&gt; x\nbar :: c -&gt; y -&gt; y\n</code></pre>\n\n<p>I would like to unify them into single interface so they both could have same name. In my case it's guaranteed that types <code>x</code> and <code>y</code> are different (but there might be multiple <code>x</code>'s). So it looks possible. But all my attempts have bad type inference in case of partial application :(</p>\n\n<p>Could you help to come up with interface for this case?</p>\n\n<p>My previous attempts look like this but this solution requires explicit type application to disambiguate cases:</p>\n\n<pre><code>class Insert s i where\n  insert :: i\n\ninstance (Ord k, i ~ (k -&gt; Set k -&gt; Set k)) =&gt; Insert Set i where\n  insert = Set.insert\n</code></pre>\n"}, {"tags": ["haskell", "random", "random-seed"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 3, "creation_date": 1532226874, "post_id": 51461570, "comment_id": 89892339, "body": "I don&#39;t have any firsthand experience with these modules, but at a glance it looks like <a href=\"https://hackage.haskell.org/package/mwc-random-0.14.0.0/docs/System-Random-MWC.html#v:createSystemRandom\" rel=\"nofollow noreferrer\"><code>createSystemRandom</code></a> might give you an entropy source that&#39;s more like what you&#39;re looking for."}], "answers": [{"comments": [{"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 0, "creation_date": 1532314605, "post_id": 51469811, "comment_id": 89910436, "body": "Perfect solution, thank you! Both blocks of <code>main</code> will do it; the second is simpler while the first lets you capture the seed to rerun everything."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 2, "last_activity_date": 1532299165, "creation_date": 1532299165, "answer_id": 51469811, "question_id": 51461570, "link": "https://stackoverflow.com/questions/51461570/haskell-how-to-seed-set-the-entropy-used-by-data-random/51469811#51469811", "title": "Haskell: How to seed (set the entropy used by) Data.Random?", "body": "<p>If you want to seed it from the clock, you can get the time with <code>getPOSIXTime</code> . It probably makes more sense to use <code>createSystemRandom</code> as Silvio Mayolo suggested.  Both methods are demonstrated in the code below.</p>\n\n<pre><code>import Data.Random\nimport Data.Vector (singleton)\nimport Data.Time.Clock.POSIX (getPOSIXTime)\nimport System.Random.MWC\n\nlogNormal :: Double -&gt; Double -&gt; RVar Double\nlogNormal mu sigmaSq = do\n  x &lt;- normal mu sigmaSq\n  return (exp x)\n\nmain = do\n\n  t0 &lt;- getPOSIXTime \n  mwc &lt;- initialize (singleton (floor t0))\n  y &lt;- sampleFrom mwc (logNormal 5 1)\n  print y\n\n  mwc2 &lt;- createSystemRandom\n  z &lt;- sampleFrom mwc2 (logNormal 5 1)\n  print z\n</code></pre>\n"}], "owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 51469811, "answer_count": 1, "score": 3, "last_activity_date": 1532299165, "creation_date": 1532226559, "question_id": 51461570, "link": "https://stackoverflow.com/questions/51461570/haskell-how-to-seed-set-the-entropy-used-by-data-random", "title": "Haskell: How to seed (set the entropy used by) Data.Random?", "body": "<p>The random-fu (Data.Random) package in Haskell <a href=\"https://github.com/mokus0/random-fu/tree/69a563a7b0cf444748e4b38a8bda7ada0b9acf14\" rel=\"nofollow noreferrer\">offers</a> the following example:</p>\n\n<pre><code>import Data.Random\nimport System.Random.MWC\n\nlogNormal :: Double -&gt; Double -&gt; RVar Double\nlogNormal mu sigmaSq = do\n  x &lt;- normal mu sigmaSq\n  return (exp x)\n\nmain = do\n  mwc &lt;- create\n  y &lt;- sampleFrom mwc (logNormal 5 1)\n  print y\n</code></pre>\n\n<p>It always generates the same result. I want to seed it from the clock. Ideally without having to get my hands dirty by actually reading the time.</p>\n\n<p>(I haven't seen the word \"seed\" anywhere in the random-fu documentation, but I have found the phrsae \"source of entropy\" in a few places.)</p>\n"}, {"tags": ["haskell", "typeclass", "dependent-type", "liquid-haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1532218592, "post_id": 51460945, "comment_id": 89891366, "body": "<code>bar</code> is incorrect, because if the caller chooses <code>s</code> to be <code>B</code> (which satisfies the constraint <code>AorB</code>) then the implementation <code>SomeA</code> is not valid.   Does that help guide your thinking?"}], "answers": [{"comments": [{"owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "edited": false, "score": 0, "creation_date": 1532223721, "post_id": 51461159, "comment_id": 89891943, "body": "I did come up with the <code>IsAorB</code> type family, but I wouldn&#39;t get to the <code>AorB</code> and (certainly not) to the <code>Ex c f</code> tricks. Cheers!"}, {"owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "edited": false, "score": 0, "creation_date": 1532282263, "post_id": 51461159, "comment_id": 89904200, "body": "I was thinking and experimenting with this a bit more. I tried <code>bar :: AorB s =&gt; Some s</code>, but it still cannot match the type of <code>s</code>. Shouldn&#39;t this <code>AorB s</code> (<code>IsAorB s ~ &#39;True</code>) constraint be enough to limit the resulting types (and not necessarily controlled by the caller)?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "edited": false, "score": 0, "creation_date": 1532287021, "post_id": 51461159, "comment_id": 89905394, "body": "@ThalesMG no the caller still chooses.  The caller chooses any unquantified variable in a type signature (IOW all variables are implicitly <code>forall</code> at the top level)."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1532256429, "last_edit_date": 1532256429, "creation_date": 1532220266, "answer_id": 51461159, "question_id": 51460945, "link": "https://stackoverflow.com/questions/51460945/returning-a-subset-of-types-in-haskell/51461159#51461159", "title": "Returning a subset of types in Haskell", "body": "<p>A few things here.  If you compile with <code>-Wall</code> <em>(which you should!)</em> you would find that your definition of <code>foo</code> gives an inexhaustive patterns warning.  And it should, because the way you have defined <code>AorB</code> is \"open\".  That is, somebody in another module is free to declare</p>\n\n<pre><code>instance AorB 'C\n</code></pre>\n\n<p>and then your definition of <code>foo</code> will suddenly become invalid as it fails to handle the <code>SomeC</code> case.  To get what you are looking for, you should use a <em>closed type family</em>:</p>\n\n<pre><code>type family IsAorB s where\n    IsAorB 'A = 'True\n    IsAorB 'B = 'True\n    IsAorB _  = 'False\n</code></pre>\n\n<p>This family is totally defined on <code>State</code>s.  We would then define your previous <code>AorB</code> constraint like so:</p>\n\n<pre><code>type AorB s = IsAorB s ~ 'True\n</code></pre>\n\n<p>However, in a moment we will need to use <code>AorB</code> in curried form, which is not allowed for type synonyms.  There is an idiom for declaring curriable synonyms which is a bit clunky, but is the best we have at the moment:</p>\n\n<pre><code>class    (IsAorB s ~ 'True) =&gt; AorB s\ninstance (IsAorB s ~ 'True) =&gt; AorB s\n</code></pre>\n\n<p>Anyway, with this new definition, you will find that the inexhaustive pattern warning goes away for <code>foo</code>.  Good.</p>\n\n<p>Now on to your question.  The trouble with your definition (with an explicit <code>forall</code> added for clarity)</p>\n\n<pre><code>bar :: forall s. AorB s =&gt; Some s\nbar = SomeA\n</code></pre>\n\n<p>is that we are allowed to instantiate <code>bar @B</code>, giving us</p>\n\n<pre><code>bar @B :: AorB B =&gt; Some B\nbar = SomeA\n</code></pre>\n\n<p><code>AorB B</code> is satisfiable, so we should be able to get a <code>Some B</code>, right?  But not according to your implementation.  So something is logically wrong here.  You are probably looking to return an <em>existentially quantified</em> <code>s</code>, in other words, you want the <code>bar</code> function to choose which <code>s</code> it is, not the caller.  Informally</p>\n\n<pre><code>bar :: exists s. AorB s &lt;AND&gt; Some s\n</code></pre>\n\n<p>That is, <code>bar</code> chooses an <code>s</code>, and returns a <code>Some s</code>, together with some evidence that <code>AorB s</code> holds.  This is no longer an implication, we would not put the responsibility on the caller to prove that the type <code>bar</code> chose was either <code>A</code> or <code>B</code> -- the caller has no idea what was chosen.</p>\n\n<p>Haskell does not directly support existential types, but we can model them with a GADT (make sure to use <code>PolyKinds</code> and <code>ConstraintKinds</code>)</p>\n\n<pre><code>data Ex c f where\n     Ex :: c a =&gt; f a -&gt; Ex c f\n</code></pre>\n\n<p><code>Ex c f</code> can be read as \"there exists <code>a</code> such that <code>c a</code> holds <em>and</em> there is a value <code>f a</code>\".  This is existential becuase the variable <code>a</code> does not appear in <code>Ex c f</code>, it's hidden by the constructor. And now we can implement <code>bar</code></p>\n\n<pre><code>bar :: Ex AorB Some\nbar = Ex SomeA\n</code></pre>\n\n<p>We can test that the constraints are correctly propagated by passing this to your <code>foo</code>:</p>\n\n<pre><code>test :: Bool\ntest = case bar of Ex s -&gt; foo s\n</code></pre>\n\n<p>There you go.</p>\n\n<p>That said, design-wise I would just say</p>\n\n<pre><code>bar :: Some A\n</code></pre>\n\n<p>instead.  Type signatures should be as informative as possible.  Don't hide information that you know -- let abstraction do the hiding. When you hide information about your assumptions/arguments, you are making your signature <em>stronger</em>; when you hide about your results, you are making it <em>weaker</em>.  Make it strong.</p>\n"}, {"tags": [], "owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "is_accepted": false, "score": 1, "last_activity_date": 1532223792, "creation_date": 1532223792, "answer_id": 51461402, "question_id": 51460945, "link": "https://stackoverflow.com/questions/51460945/returning-a-subset-of-types-in-haskell/51461402#51461402", "title": "Returning a subset of types in Haskell", "body": "<p>Here is the full working code based on @luqui's answer, for reference:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeInType #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nmodule Test2 where\n\ndata State = A | B | C\n\ntype family IsAorB (s :: State) where\n  IsAorB 'A = 'True\n  IsAorB 'B = 'True\n  IsAorB _  = 'False\n\n-- type AorB s = IsAorB s ~ 'True\n\nclass (IsAorB s ~ 'True) =&gt; AorB s\ninstance (IsAorB s ~ 'True) =&gt; AorB s\n\ndata Some (s :: State) where\n  SomeA :: Some 'A\n  SomeB :: Some 'B\n  SomeC :: Some 'C\n\ndata Ex c f where\n  Ex :: c a =&gt; f a -&gt; Ex c f\n\nbar :: Ex AorB Some\nbar = Ex SomeA\n</code></pre>\n"}], "owner": {"reputation": 730, "user_id": 2708711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13eb7bf6018c00d359233c47b63f43be?s=128&d=identicon&r=PG&f=1", "display_name": "Thales MG", "link": "https://stackoverflow.com/users/2708711/thales-mg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 51461159, "answer_count": 2, "score": 1, "last_activity_date": 1532256429, "creation_date": 1532217037, "question_id": 51460945, "link": "https://stackoverflow.com/questions/51460945/returning-a-subset-of-types-in-haskell", "title": "Returning a subset of types in Haskell", "body": "<p>I'm trying to restrict the return type of a function to a subset of (kind) constructors. I can use <a href=\"https://www.reddit.com/r/haskell/comments/3u03ce/define_a_subset_of_constructors_of_an_adt_as_a/cxaxoxb\" rel=\"nofollow noreferrer\">typeclasses</a> to restrict the input types, but when I try the same technique on return types as shown below, I get a <code>Couldn't match type \u2018s\u2019 with \u2018'A\u2019</code> error.</p>\n\n<p>Is there a way to restrict the <code>bar</code> function below to return either <code>SomeA</code> or <code>SomeB</code>?</p>\n\n<p>It seems that Liquid Haskell is an alternative, but it seems that this should be possible using only things like <code>DataKinds</code>, <code>GADTs</code> and/or <code>TypeInType</code>.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n\nmodule Test where\n\ndata State = A | B | C\n\nclass AorB (s :: State)\ninstance AorB 'A\ninstance AorB 'B\n\ndata Some (s :: State) where\n  SomeA :: Some 'A\n  SomeB :: Some 'B\n  SomeC :: Some 'C\n\n-- This works\nfoo :: AorB s =&gt; Some s -&gt; Bool\nfoo aorb = case aorb of\n  SomeA -&gt; True\n  SomeB -&gt; False\n\n-- This fails to compile with \"\"Couldn't match type \u2018s\u2019 with \u2018'A\u2019\"\"\nbar :: AorB s =&gt; Some s\nbar = SomeA\n</code></pre>\n"}, {"tags": ["performance", "haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1532201849, "post_id": 51459457, "comment_id": 89888287, "body": "No there is no caching, this is exactly the reason why this takes that much time."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1532201913, "post_id": 51459457, "comment_id": 89888302, "body": "You can search this site for <code>memoization</code> and see many strategies.  Be sure you compile your program instead of time it in the interpreter when you care about performance."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1532202947, "post_id": 51459457, "comment_id": 89888503, "body": "You may want to look into the package <a href=\"http://hackage.haskell.org/package/memoize-0.8.1/docs/Data-Function-Memoize.html\" rel=\"nofollow noreferrer\">memoise</a>, which provides memoisation tools."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1532209581, "post_id": 51459457, "comment_id": 89890027, "body": "It is strange that you are seeing the first call take such a long time.  Especially <code>e 20 1</code> which ought to reduce immediately.  Try something like <code>print &quot;hello&quot;</code> -- does that also take a long time if it&#39;s the first thing you do?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532286412, "post_id": 51459457, "comment_id": 89905251, "body": "I have to wonder if this recurrence has a closed-form solution."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1532206021, "creation_date": 1532206021, "answer_id": 51459978, "question_id": 51459457, "link": "https://stackoverflow.com/questions/51459457/improving-efficiency-of-recursion-in-haskell/51459978#51459978", "title": "Improving efficiency of Recursion in Haskell", "body": "<p>GHC does <em>not</em> magically produce lookup tables for memoization. That said, there are libraries that make this a lot easier. As @AJFarmar suggests, you could use the <a href=\"http://hackage.haskell.org/package/memoize-0.8.1\" rel=\"nofollow noreferrer\"><code>memoize</code></a> package.</p>\n\n<pre><code>import Data.Function.Memoize\n\ne :: Integer -&gt; Integer -&gt; Integer\ne = memoFix2 $ \\rec -&gt; let e' _ 1 = 1\n                           e' n m | n == m = rec n (n-1)\n                                  | otherwise = rec (n-1) m + rec n (m-1)\n                       in e'\n</code></pre>\n"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1532206021, "creation_date": 1532201642, "question_id": 51459457, "link": "https://stackoverflow.com/questions/51459457/improving-efficiency-of-recursion-in-haskell", "title": "Improving efficiency of Recursion in Haskell", "body": "<p>Given this function :</p>\n\n<pre><code>e :: Integer -&gt; Integer -&gt; Integer\ne _ 1 = 1 \ne n m \n |n == m = e n (n-1) \n |otherwise = e (n-1) m + e n (m-1)\n</code></pre>\n\n<p>If I run it in GHCI, the first evaluation has a huge time e 20 1 takes ~10 seconds, but after that calls to even larger numbers are far reduced, ~0.25 seconds. I assume there is some kind of caching happening?</p>\n\n<p>I kind of see why it explodes because each call to e n m makes two more calls, which then each make two calls, etc. so the number of evaluations eventually gets very large, but a lot of them are just the same reference. </p>\n\n<p>Is there anyway to make Haskell realize this, like some kind of automatic lookup table?</p>\n"}, {"tags": ["haskell", "lambda", "identifier"], "comments": [{"owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1532200026, "post_id": 51458371, "comment_id": 89887900, "body": "@dfeuer I don&#39;t see what relation does my question have with getting started with haskell. of course i&#39;m getting started with haskell but i guess not all people that are beginning with haskell and have specific doubts should in your opinion redirect to &quot;getting started with haskell&quot;. please tell me if i&#39;m missing something here"}, {"owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1532200186, "post_id": 51458371, "comment_id": 89887933, "body": "@dfeuer the link you asked for is just another example of an identifier that may be weird for newcomers in haskell, i was linking in order to show that this kind of question is legitimate here (over 17 upvotes). I also ask myself why my question is marked as a duplicate and the linked question <a href=\"https://stackoverflow.com/questions/5673916/apostrophe-in-identifiers-in-haskell?rq=1\" title=\"apostrophe in identifiers in haskell\">stackoverflow.com/questions/5673916/&hellip;</a> is not."}, {"owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "edited": false, "score": 1, "creation_date": 1532200264, "post_id": 51458371, "comment_id": 89887943, "body": "it would be nice if those who downvoted the question kindly explained what they find wrong with it"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1532200609, "post_id": 51458371, "comment_id": 89888018, "body": "FYI, I did not downvote your question. I marked this as a duplicate of the canonical dupe target because it is something that will be covered in the first few pages of a typical Haskell tutorial or textbook. Stack Overflow is not a good place to learn the bare basics of a new programming language; there are much better resources available for that. Whether the other question should also be considered a duplicate is a judgement call. It is quite a basic question, but it&#39;s more a lexical syntax detail than a fundamental language construct."}, {"owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532200742, "post_id": 51458371, "comment_id": 89888048, "body": "@dfeur alright thanks a lot for clarifying"}, {"owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532203129, "post_id": 51458371, "comment_id": 89888536, "body": "it would have been also nice to note that this can be browsed in Hoogle as i learned in this question: <a href=\"https://stackoverflow.com/questions/37286376/what-does-mean-in-haskell\" title=\"what does mean in haskell\">stackoverflow.com/questions/37286376/what-does-mean-in-haske&zwnj;&#8203;ll</a>"}, {"owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532203390, "post_id": 51458371, "comment_id": 89888599, "body": "or even this other <a href=\"https://stackoverflow.com/questions/6824255/whats-the-point-of-map-in-haskell-when-there-is-fmap\" title=\"whats the point of map in haskell when there is fmap\">stackoverflow.com/questions/6824255/&hellip;</a> who shows how to do so in ghci"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1532229649, "post_id": 51458371, "comment_id": 89892609, "body": "`\\` is not an operator, and can&#39;t be found by Hoogle. It&#39;s part of the basic syntax of the language."}], "answers": [{"comments": [{"owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "edited": false, "score": 0, "creation_date": 1532200545, "post_id": 51458425, "comment_id": 89888003, "body": "i wonder what happens if parameter1&#39;s name has been already used before. is this possible in haskell?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "edited": false, "score": 0, "creation_date": 1532201188, "post_id": 51458425, "comment_id": 89888137, "body": "@Rodrigo Yes, parameter names can shadow variables from the outer scope."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 8, "last_activity_date": 1532193320, "creation_date": 1532193320, "answer_id": 51458425, "question_id": 51458371, "link": "https://stackoverflow.com/questions/51458371/meaning-of-in-haskell-identifier/51458425#51458425", "title": "Meaning of \\ in Haskell identifier", "body": "<p><code>\\parameter1 ... parameterN -&gt; expression</code> is Haskell's syntax for lambdas. The Scala equivalent would be <code>(parameter1, ..., parameterN) =&gt; expression</code> (or, if we want to maintain the fact that the function is curried, <code>parameter1 =&gt; ... =&gt; parameterN =&gt; expression</code>).</p>\n\n<p>The backslash was chosen for this syntax since it's the ASCII character that looks most like a \u03bb.</p>\n"}], "owner": {"reputation": 2322, "user_id": 5069802, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0d39cfdfa3a97d21908ae7f43171b41b?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/5069802/rodrigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 1, "closed_date": 1532194349, "accepted_answer_id": 51458425, "answer_count": 1, "score": 1, "last_activity_date": 1532202910, "creation_date": 1532192925, "last_edit_date": 1532202910, "question_id": 51458371, "link": "https://stackoverflow.com/questions/51458371/meaning-of-in-haskell-identifier", "closed_reason": "Duplicate", "title": "Meaning of \\ in Haskell identifier", "body": "<p>This one of these tricks that when you're unfamiliar with a language is more difficult to find but everybody else knows about and use it.</p>\n\n<p>In my case I wonder what does it mean when you have the name of a variable, say <code>ts</code>, and you put the symbol <code>\\</code> before it:</p>\n\n<pre><code>newtype Parser a = Parser (String -&gt; [(String, a)])\nproduce :: a -&gt; Parser a\nproduce x = Parser (\\ts -&gt; [(ts, x)])\n</code></pre>\n\n<p>My guess is this is abstracting the variable? If so what would be its translation to other languages like Scala?</p>\n"}, {"tags": ["haskell", "unicode"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1532190302, "post_id": 51457849, "comment_id": 89885326, "body": "Your function seems fine.  If you&#39;re looking for a standard library function, if it was anywhere, it would be in either <code>Data.Char</code> or maybe <code>Data.Text</code>, and I don&#39;t see it there."}], "answers": [{"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 1, "last_activity_date": 1532193032, "creation_date": 1532193032, "answer_id": 51458386, "question_id": 51457849, "link": "https://stackoverflow.com/questions/51457849/is-there-a-function-that-works-like-chr-but-fails-if-its-argument-is-not-a-unico/51458386#51458386", "title": "Is there a function that works like chr but fails if its argument is not a Unicode scalar value?", "body": "<p>is this is something you use to do, you can create an adds modules, like <code>Data.Char.Adds</code> and import whenever you want. It seems like it doesn't exist in the present. I cannot see another workaround. </p>\n"}], "owner": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1532243882, "creation_date": 1532189084, "last_edit_date": 1532243882, "question_id": 51457849, "link": "https://stackoverflow.com/questions/51457849/is-there-a-function-that-works-like-chr-but-fails-if-its-argument-is-not-a-unico", "title": "Is there a function that works like chr but fails if its argument is not a Unicode scalar value?", "body": "<p>I was thinking that there should be a function that works like <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Char.html#v:chr\" rel=\"noreferrer\"><code>chr</code></a> but fails in the case when its argument is not a Unicode scalar value.</p>\n\n<p>I usually write my own function this way:</p>\n\n<pre><code>toUnicode :: Int -&gt; Maybe Char\ntoUnicode x\n  -- Ranges from \"The Unicode Standard\".\n  -- See definition D76 in Section 3.9, Unicode Encoding Forms.\n  | x &gt;= 0      &amp;&amp; x &lt;= 0xD7FF   = Just (chr x)\n  | x &gt;= 0xE000 &amp;&amp; x &lt;= 0x10FFFF = Just (chr x)\n  | otherwise                    = Nothing\n</code></pre>\n\n<p>But it would be nice if there's a better way to do that.</p>\n"}, {"tags": ["haskell", "interpreter"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532194489, "post_id": 51457533, "comment_id": 89886503, "body": "Please don&#39;t embed images of text. Copy the text as text."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1532214260, "post_id": 51457533, "comment_id": 89890781, "body": "Thanks for the feedback. Is there any reason why embedding an image is not convenient?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1532229765, "post_id": 51457533, "comment_id": 89892621, "body": "Embedded images are useless for people using screen readers or Braille displays. They&#39;re hard to read with mobile browsers. And there&#39;s no hope of searching for text within them. So just don&#39;t do that."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1532192726, "creation_date": 1532192726, "answer_id": 51458340, "question_id": 51457533, "link": "https://stackoverflow.com/questions/51457533/typed-tagless-final-interpreters-what-is-the-use-of-duplicate/51458340#51458340", "title": "Typed Tagless Final Interpreters: what is the use of duplicate?", "body": "<p>First, as an aside, note that the code in that article is already valid Haskell code, except that some symbols are used in place of usual Haskell syntax.  For example, the symbol \"\u25e6\" is used in place of the <code>(.)</code> operator for function composition.</p>\n\n<p>So you can write <code>thrice</code> as the following valid Haskell code, straight from its definition in the article:</p>\n\n<pre><code>thrice x = dup_consume eval x &gt;&gt;= dup_consume view \n             &gt;&gt;= print . toTree\n\ndup_consume ev x = print (ev x1) &gt;&gt; return x2\n  where (x1, x2) = duplicate x\n</code></pre>\n\n<p>Anyway, back to your question...  As you have rightly pointed out, the interpreter <code>duplicate</code> has no real purpose.  For example, you can define <code>dup_consume</code> as either the version above or else drop the <code>duplicate</code> entirely and write:</p>\n\n<pre><code>dup_consume ev x = print (ev x1) &gt;&gt; return x2\n  where (x1, x2) = x\n</code></pre>\n\n<p>And, of course, you can merge the definition of <code>dup_consume</code> directly into <code>thrice</code>, as you've done.</p>\n\n<p>However, <em>all</em> the final \"interpreters\" in the article have no real purpose.  That's kind of the point.  In particular, you don't need <code>eval</code> or <code>view</code> to define <code>thrice</code> either.  The following works fine, too:</p>\n\n<pre><code>thrice' :: (Int, (String, Tree)) -&gt; IO ()\nthrice' (reprInt, (reprStr, reprTree)) = do\n  print $ reprInt\n  print $ reprStr\n  print $ reprTree\n</code></pre>\n\n<p>after which you can do the following:</p>\n\n<pre><code>&gt; thrice' (add (lit 5) (neg (lit 2)))\n3\n\"(5 + (-2))\"\nNode \"Add\" [Node \"Lit\" [Leaf \"5\"],Node \"Neg\" [Node \"Lit\" [Leaf \"2\"]]]\n&gt; \n</code></pre>\n\n<p>The idea with these final interpreters is that the <em>typing</em> determines the interpretation.  The purpose of the interpreters is only to add typing information without explicit type signatures.  So, <code>eval (neg (lit 1))</code> can be entered at the GHCi prompt without a type signature:</p>\n\n<pre><code>&gt; eval (neg (lit 1))\n-1\n&gt;\n</code></pre>\n\n<p>and it \"works\" because <code>eval</code> -- which is just the <code>id</code> function -- forces the return value to be an integer, which in turn selects the correct instance to <em>evaluate</em> the final expression rather than <code>view</code>ing it or something else.  But you could also write:</p>\n\n<pre><code>&gt; neg (lit 1) :: Int\n-1\n&gt;\n</code></pre>\n\n<p>to get the same effect.</p>\n\n<p>It turns out that <code>duplicate</code> is even less necessary than the other interpreters, because in the only place where it's used -- namely the definition of <code>dup_consume</code>:</p>\n\n<pre><code>dup_consume ev x = print (ev x1) &gt;&gt; return x2\n  where (x1, x2) = duplicate x\n</code></pre>\n\n<p>the type checker can already infer that a tuple is needed, so any final expression provided for <code>x</code>, like <code>neg (lit 1)</code> will necessarily be interpreted as the duplicating instance for tuples (i.e,. the instance defined right before the definition of <code>duplicate</code>), so -- as noted above -- you could just write:</p>\n\n<pre><code>dup_consume ev x = print (ev x1) &gt;&gt; return x2\n  where (x1, x2) = x\n</code></pre>\n\n<p>and the type checker would figure it out.</p>\n"}, {"comments": [{"owner": {"reputation": 978, "user_id": 1753545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p8AyY.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/1753545/max"}, "edited": false, "score": 0, "creation_date": 1608373890, "post_id": 65368679, "comment_id": 115567546, "body": "Also, I suspect the <code>duplicate</code> trick is also needed for languages that don&#39;t easily support  polymorphic values like Rust."}], "tags": [], "owner": {"reputation": 978, "user_id": 1753545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p8AyY.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/1753545/max"}, "is_accepted": false, "score": 0, "last_activity_date": 1608372761, "creation_date": 1608372761, "answer_id": 65368679, "question_id": 51457533, "link": "https://stackoverflow.com/questions/51457533/typed-tagless-final-interpreters-what-is-the-use-of-duplicate/65368679#65368679", "title": "Typed Tagless Final Interpreters: what is the use of duplicate?", "body": "<p>I might be wrong, but I suspect your <code>thrice'</code> function may involve parsing the expression multiple times, whereas Oleg's <code>duplicate</code> trick will only copy the parse tree (<em>i.e.</em> parse result).</p>\n<p>The need for duplication arises from the pattern matching on parse result, which assigns a monomorphic type to the matched parse result. Therefore, once you've chosen an interpreter for it, you're stuck with it. The paper mentions a higher-rank encoding to reclaim this lost polymorphism at the expense of extensibility, which defeats the point of tagless final interpreters.</p>\n<p>An alternative is the <code>duplicate</code> trick which copies the (monomorphic) parse result into another (monomorphic) value to be interpreted differently.</p>\n<p>Of course, if parsing always succeeds (for instance by encoding parse errors directly in your parse tree) then there's no need for <code>duplicate</code> since the parse result can remain polymorphic and be interpreted differently.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 51458340, "answer_count": 2, "score": 1, "last_activity_date": 1608372761, "creation_date": 1532187089, "question_id": 51457533, "link": "https://stackoverflow.com/questions/51457533/typed-tagless-final-interpreters-what-is-the-use-of-duplicate", "title": "Typed Tagless Final Interpreters: what is the use of duplicate?", "body": "<p>This question is related to the paper <a href=\"http://okmij.org/ftp/tagless-final/course/lecture.pdf\" rel=\"nofollow noreferrer\">Typed Tagless Final Interpreters</a>. In page 11, a function <code>trice</code> is presented, which relies on a <code>duplicate</code> function:</p>\n\n<p><a href=\"https://i.stack.imgur.com/fnAaP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fnAaP.png\" alt=\"enter image description here\"></a></p>\n\n<p>I've tried coding this into Haskell, and the resulting functions look as follows:</p>\n\n<pre><code>thrice :: (Int, (String, Tree)) -&gt; IO () -- Is this the most generic type we can give?\nthrice x0 = do\n    x1 &lt;- dupConsume eval x0\n    x2 &lt;- dupConsume view x1\n    print $ toTree x2\n    where\n      dupConsume ev y = do\n          print (ev y0)\n          return y1\n              where\n                (y0, y1) = duplicate y\n</code></pre>\n\n<p>However, since I cannot seem to be able to give a more generic type to <code>thrice</code> I could have just written the simpler function:</p>\n\n<pre><code>thrice' :: (Int, (String, Tree)) -&gt; IO ()\nthrice' (reprInt, (reprStr, reprTree)) = do\n    print $ eval reprInt\n    print $ view reprStr\n    print $ toTree reprTree    \n</code></pre>\n\n<p>So I was wondering what is the use of <code>duplicate</code> in this example?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1532181332, "post_id": 51456200, "comment_id": 89882980, "body": "what is <code>:&gt;</code>? have you tried specifying pattern with <code>Cons</code> directly?"}, {"owner": {"reputation": 135, "user_id": 10114851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GQ9U9bcmo4U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obkxAvManOl513KgOEqn1OZOLXmw/mo/photo.jpg?sz=128", "display_name": "Anmol Sahoo", "link": "https://stackoverflow.com/users/10114851/anmol-sahoo"}, "reply_to_user": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1532182605, "post_id": 51456200, "comment_id": 89883295, "body": "@max630, Yeah I have used Cons, I updated the definition for :&gt; as well"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1532184954, "post_id": 51456200, "comment_id": 89883861, "body": "What do you mean you used <code>Cons</code>?  It&#39;s not exported by the library.  How did you use it?"}, {"owner": {"reputation": 135, "user_id": 10114851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GQ9U9bcmo4U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obkxAvManOl513KgOEqn1OZOLXmw/mo/photo.jpg?sz=128", "display_name": "Anmol Sahoo", "link": "https://stackoverflow.com/users/10114851/anmol-sahoo"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1532191459, "post_id": 51456200, "comment_id": 89885672, "body": "@K.A.Buhr, You got me there. I had used it and gotten the error that it is not exported by the library! My bad, careless comment there."}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 10114851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GQ9U9bcmo4U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obkxAvManOl513KgOEqn1OZOLXmw/mo/photo.jpg?sz=128", "display_name": "Anmol Sahoo", "link": "https://stackoverflow.com/users/10114851/anmol-sahoo"}, "edited": false, "score": 1, "creation_date": 1532191583, "post_id": 51457801, "comment_id": 89885704, "body": "Wow! I am super-impressed by your knowledge of Haskell and assuming that you read up the Clash library docs, you managed to get out so much information! Thank you so much for taking out time to answer this. This is an amazing answer!"}, {"owner": {"reputation": 576, "user_id": 478503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c1b8e9154a084498c7eb1576f32a8488?s=128&d=identicon&r=PG&f=1", "display_name": "Martijn", "link": "https://stackoverflow.com/users/478503/martijn"}, "edited": false, "score": 0, "creation_date": 1532245218, "post_id": 51457801, "comment_id": 89894863, "body": "See this discussion on (<code>:&gt;</code>) vs <code>Cons</code> too: <a href=\"https://github.com/clash-lang/clash-compiler/issues/170\" rel=\"nofollow noreferrer\">github.com/clash-lang/clash-compiler/issues/170</a>"}, {"owner": {"reputation": 135, "user_id": 10114851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GQ9U9bcmo4U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obkxAvManOl513KgOEqn1OZOLXmw/mo/photo.jpg?sz=128", "display_name": "Anmol Sahoo", "link": "https://stackoverflow.com/users/10114851/anmol-sahoo"}, "reply_to_user": {"reputation": 576, "user_id": 478503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c1b8e9154a084498c7eb1576f32a8488?s=128&d=identicon&r=PG&f=1", "display_name": "Martijn", "link": "https://stackoverflow.com/users/478503/martijn"}, "edited": false, "score": 0, "creation_date": 1532284267, "post_id": 51457801, "comment_id": 89904683, "body": "@Martijn, Yes!. I discussed the same on the Google Group as well. Thank you!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1532193053, "last_edit_date": 1532193053, "creation_date": 1532188752, "answer_id": 51457801, "question_id": 51456200, "link": "https://stackoverflow.com/questions/51456200/unable-to-match-haskell-type/51457801#51457801", "title": "Unable to match Haskell type", "body": "<p>This is a bug/limitation in the Clash library.  You'll find that you can't even define something straightforward like:</p>\n\n<pre><code>safeHead :: Vec n a -&gt; Maybe a\nsafeHead Nil = Nothing\nsafeHead (x :&gt; _) = Just x\n</code></pre>\n\n<p>The problem is the definition of the <code>(:&gt;)</code> pattern:</p>\n\n<pre><code>pattern (:&gt;) :: a -&gt; Vec n a -&gt; Vec (n + 1) a\npattern (:&gt;) x xs &lt;- ((\\ys -&gt; (head ys,tail ys)) -&gt; (x,xs))\n  where\n    (:&gt;) x xs = Cons x xs\n</code></pre>\n\n<p>Despite first appearances, its signature is wrong!  Had it instead been given the much simpler (and essentially equivalent) definition:</p>\n\n<pre><code>pattern (:&gt;) x xs = Cons x xs\n</code></pre>\n\n<p>the inferred type signature would have been:</p>\n\n<pre><code>pattern (:&gt;) :: () =&gt; (n ~ n1 + 1) =&gt; a -&gt; Vec n1 a -&gt; Vec n a\n</code></pre>\n\n<p>(which could have been given explicitly, too), and your code would have worked fine (as it would if you were able to use <code>Cons</code> directly in place of <code>(:&gt;</code>).</p>\n\n<p>The unusual form of this signature, with two sets of constraints, is specific to pattern synonyms.  The first set of constraints gives a set of \"required\" constraints, those that are required to be satisfied in order to consider the <em>code</em> using the  pattern to be type correct.  The second gives the set of \"provided\" constraints, those that are brought into scope in a case-branch by actually matching the pattern at runtime.  You can read more about this in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#typing-of-pattern-synonyms\" rel=\"nofollow noreferrer\">Typing of Pattern Synonyms</a> in the GHC docs.</p>\n\n<p>Unfortunately, the explicit signature used in the library:</p>\n\n<pre><code>pattern (:&gt;) :: a -&gt; Vec n a -&gt; Vec (n + 1) a\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>pattern (:&gt;) :: (n ~ n1 + 1) =&gt; () =&gt; Vec n1 a -&gt; Vec n a\n</code></pre>\n\n<p>where the constraint on <code>n</code> and <code>n1</code> appears in the \"required\" instead of the \"provided\" constraint set.  This is a big problem!</p>\n\n<p>In this part of the definition of <code>init'</code>:</p>\n\n<pre><code>init' (x :&gt; (xs:&gt;ys)) = x :&gt; (init' (xs:&gt;ys))\n</code></pre>\n\n<p>the first <code>:&gt;</code> <em>requires</em> that the argument being matched by the whole expression <code>x :&gt; (xs :&gt; ys)</code> be a <code>Vec (n + 1) a</code> for some <code>n</code>.  Fortunately, it <em>is</em> because of the type signature of <code>init'</code>.  Unfortunately, the second <code>:&gt;</code> <em>requires</em> that the argument (which is known to be of type <code>Vec n a</code>) be a <code>Vec (m + 1) a</code> for some <code>m</code> in order to type check.  No such constraint is available!  It would be the matching by this second <code>:&gt;</code> (as opposed to matching by <code>Nil</code>, as in the previous line) that would <strong>PROVIDE</strong> such a constraint.</p>\n\n<p>Ultimately, we're stuck in a kind of constraint loop where in order to provide <code>n ~ m + 1</code> for some <code>m</code>, we need to already have <code>n ~ m + 1</code> for some <code>m</code>.</p>\n\n<p>So, what can you do?  It's hard to say.  According to the <code>CHANGELOG</code> for <code>Clash</code>, this bizarre pattern definition was intentionally added so that \"pattern matching on <code>:&gt;</code> is now synthesisable by the CLaSH compiler\".  I don't know what this means, but the Clash maintainer probably does.  I would send an email to him or her, point out that the pattern definition for <code>(:&gt;)</code> prevents you from doing simple things like defining <code>safeHead</code> or <code>init'</code>, and see if he or she can rewrite the pattern to both allow proper pattern matching and also keep this \"synthesisable\" business working.</p>\n"}], "owner": {"reputation": 135, "user_id": 10114851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GQ9U9bcmo4U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obkxAvManOl513KgOEqn1OZOLXmw/mo/photo.jpg?sz=128", "display_name": "Anmol Sahoo", "link": "https://stackoverflow.com/users/10114851/anmol-sahoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 51457801, "answer_count": 1, "score": 1, "last_activity_date": 1532193053, "creation_date": 1532177059, "last_edit_date": 1532182574, "question_id": 51456200, "link": "https://stackoverflow.com/questions/51456200/unable-to-match-haskell-type", "title": "Unable to match Haskell type", "body": "<p>I know there are lots of questions on this topic, but I feel that there is something specific about the library that I am using that is giving me the error.</p>\n\n<pre><code>module Test where\n\nimport Clash.Prelude\n\ninit' :: Vec (n + 1) a -&gt; Vec n a\ninit' (_ :&gt; Nil) = Nil\ninit' (x :&gt; (xs:&gt;ys)) = x :&gt; (init' (xs:&gt;ys))\n</code></pre>\n\n<p>The error I am getting is, </p>\n\n<pre><code>Test.hs:28:14: error:\n    \u2022 Couldn't match type \u2018n\u2019 with \u2018n0 + 1\u2019\n      \u2018n\u2019 is a rigid type variable bound by\n        the type signature for:\n          init' :: forall (n :: Nat) a. Vec (n + 1) a -&gt; Vec n a\n        at Test.hs:26:1-33\n      Expected type: Vec n a\n        Actual type: Vec (n0 + 1) a\n    \u2022 In the pattern: xs :&gt; ys\n      In the pattern: x :&gt; (xs :&gt; ys)\n      In an equation for \u2018init'\u2019:\n          init' (x :&gt; (xs :&gt; ys)) = x :&gt; (init' (xs :&gt; ys))\n    \u2022 Relevant bindings include\n        init' :: Vec (n + 1) a -&gt; Vec n a (bound at Test.hs:27:1)\n   |\n28 | init' (x :&gt; (xs:&gt;ys)) = x :&gt; (init' (xs:&gt;ys))\n   | \n</code></pre>\n\n<p>The definitions from the Clash.Prelude library are</p>\n\n<pre><code>data Vec :: Nat -&gt; * -&gt; * where\n  Nil  :: Vec 0 a\n  Cons :: a -&gt; Vec n a -&gt; Vec (n + 1) a\n\npattern (:&gt;) :: a -&gt; Vec n a -&gt; Vec (n + 1) a\npattern (:&gt;) x xs &lt;- ((\\ys -&gt; (head ys,tail ys)) -&gt; (x,xs))\n  where\n    (:&gt;) x xs = Cons x xs\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "template-haskell"], "comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 4, "creation_date": 1532129230, "post_id": 51451043, "comment_id": 89873234, "body": "Is there a reason you couldn&#39;t just define <code>data Parameter a = Param a Constraint</code> instead of using typeclasses? Then you could just define <code>value (Param v _) = v</code> and <code>constraint (Param _ c) = c</code>."}, {"owner": {"reputation": 1007, "user_id": 1086786, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ce82726817f3ad51e97718e5ffcef219?s=128&d=identicon&r=PG", "display_name": "AndyJost", "link": "https://stackoverflow.com/users/1086786/andyjost"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1532191684, "post_id": 51451043, "comment_id": 89885735, "body": "If I understand you, that would put the definition of the parameter value and constraint together, so then Circle would need to be defined as <code>Circle Parameter</code> and constructed as <code>Circle (Parameter r (\\x -&gt; x &gt; 0))</code>.  But I want to encode the constraint into the type of Circle.  Later, when (or after) one constructs a Circle, it should be possible to validate the parameter."}], "answers": [{"comments": [{"owner": {"reputation": 1007, "user_id": 1086786, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ce82726817f3ad51e97718e5ffcef219?s=128&d=identicon&r=PG", "display_name": "AndyJost", "link": "https://stackoverflow.com/users/1086786/andyjost"}, "edited": false, "score": 1, "creation_date": 1532190940, "post_id": 51453896, "comment_id": 89885509, "body": "Interesting link. I think I&#39;ll give template Haskell a shot.  To answer your question, the application is a system for modeling an extremely complex physical process.  It&#39;s the work of hundreds of people over dozens of years.  So it really is like a bag of details.  Very hard to reduce."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1532215983, "post_id": 51453896, "comment_id": 89891045, "body": "<a href=\"https://hackage.haskell.org/package/refined\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/refined</a> is also related - a combination of smart constructors and type-level tagging for them."}, {"owner": {"reputation": 1007, "user_id": 1086786, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ce82726817f3ad51e97718e5ffcef219?s=128&d=identicon&r=PG", "display_name": "AndyJost", "link": "https://stackoverflow.com/users/1086786/andyjost"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1532280561, "post_id": 51453896, "comment_id": 89903700, "body": "@Carl Refined seems to be exactly what I was looking for!"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1532158438, "creation_date": 1532158438, "answer_id": 51453896, "question_id": 51451043, "link": "https://stackoverflow.com/questions/51451043/how-should-i-structure-constrained-parameters-in-haskell/51453896#51453896", "title": "How should I structure constrained parameters in Haskell?", "body": "<p>It sounds like you wish Haskell had the ability to declare subtypes from predicates.  This can be done with <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">smart constructors</a>, but it's true, there is a bit of boilerplate involved.  I don't think Template Haskell is such a bad idea.  It wouldn't be too hard to wrap up the definition of a smart constructor into something like</p>\n\n<pre><code>subtype \"Radius\" 'Float [| \\x -&gt; x &gt;= 0 |]\n</code></pre>\n\n<p>You said that there might be hundreds of these things, which raises a design alarm in my mind.  I would be looking very hard at this point for opportunities to add more conceptual abstraction to your schema&mdash;hundreds is too many.  But without more info and context all that's all I can really say: <em>beware!</em></p>\n"}], "owner": {"reputation": 1007, "user_id": 1086786, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ce82726817f3ad51e97718e5ffcef219?s=128&d=identicon&r=PG", "display_name": "AndyJost", "link": "https://stackoverflow.com/users/1086786/andyjost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 51453896, "answer_count": 1, "score": 1, "last_activity_date": 1532158438, "creation_date": 1532124964, "question_id": 51451043, "link": "https://stackoverflow.com/questions/51451043/how-should-i-structure-constrained-parameters-in-haskell", "title": "How should I structure constrained parameters in Haskell?", "body": "<p>I want to build a large schema in Haskell.  The constituents take parameters and the parameters are constrained.  As an example, I might decide that a circle takes one parameter called Radius, which is constrained to be non-negative.  I will define the parameters globally, since each can be used by multiple constituents.  There may be hundreds of parameters, and many will have long, difficult-to-type names.</p>\n\n<p>I have a solution of sorts, but the parameter declarations are repetitive and I'd like to simplify them.  My criteria for \"simple\" is just to minimize the number of times a parameter name must be typed.  One part of this is to simplify the parameter definitions themselves.  Another is to avoid typing parameter names when creating data objects, if possible.  So, one should be able to construct a Circle without actually typing \"Radius\".</p>\n\n<p>The code is below, followed by a few more specific questions.  Thanks in advance for any help!</p>\n\n<pre><code>data Constraint = Constraint\ntest :: Float -&gt; Constraint -&gt; Bool\ntest _ _ = undefined\n--\nnonnegative :: Constraint\nnonnegative = undefined\n--\ndata Expr = Constant Float -- | Variable String | Add Parameter Parameter ...\neval (Constant x) = x\n--\nclass Parameter a where\n  value :: a -&gt; Float\n  constraint :: a -&gt; Constraint\n  validate :: a -&gt; Bool\n  validate x = test (value x) (constraint x)\n\n-- Schema.  Expecting dozens of constituents with many parameters existing\n-- in complex relationships.\ndata Shape = Circle Radius\n--\n-- There may be hundreds of parameters like Radius, many with long,\n-- difficult-to-type names.\ndata Radius = Radius Expr\ninstance Parameter Radius where\n  constraint _ = nonnegative\n  value (Radius r) = eval r\n</code></pre>\n\n<ol>\n<li><p>Can you suggest a better way to structure this code?</p></li>\n<li><p>I think Template Haskell could be used to define a parameter (like Radius) without repeating the name.  Would you recommend that approach?</p></li>\n<li><p>Is it possible to write a default rule for value?  Naively, I want to\nmatch the pattern <code>value (_ x)</code>, but that's not well-typed, of course.\nIs there some way of accomplishing the same thing?</p></li>\n<li><p>Is there a simpler way to associate a value with a type?  For instance,\nRadius has a constraint associated with the type, but it seems unnecessary to\nhave to construct a Radius to get its constraint.  When I try to write\n<code>constraint :: Constraint</code>, GHC complains that the type parameter <code>a</code> is\nnot used.</p></li>\n</ol>\n"}, {"tags": ["pointers", "haskell", "ffi", "c2hs"], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1534117455, "creation_date": 1532119155, "question_id": 51450051, "link": "https://stackoverflow.com/questions/51450051/c2hs-pointer-type-correspondences", "title": "C2HS Pointer Type Correspondences", "body": "<p>I have some conceptual questions about how C2HS generates type correspondences from <code>{#pointer \u2026}</code> declarations. First, let <code>~</code> denote a type correspondence operator between C types and Haskell types. Then is it correct to say that</p>\n\n<pre><code>{#pointer *CTypeName as HaskellName newtype#}\n</code></pre>\n\n<p>generates the correspondence <code>*CTypeName ~ HaskellName</code>, while</p>\n\n<pre><code>{#pointer *CTypeName as HaskellName foreign newtype#}\n</code></pre>\n\n<p>generates the correspondence <code>*CTypeName ~ (Ptr HaskellName)</code>? (If so, does this imply in the latter case that <code>CTypeName ~ HaskellName</code> also?)</p>\n\n<p>This is despite the fact that C2HS generates slightly different type definitions for each of the different declarations:</p>\n\n<pre><code>-- {#pointer *CTypeName as HaskellName newtype#}\ndata HaskellName = HaskellName (Ptr HaskellName)\n\n-- {#pointer *CTypeName as HaskellName foreign newtype#}\ndata HaskellName = HaskellName (ForeignPtr HaskellName)\n</code></pre>\n\n<p>The <code>~</code> correspondences I mentioned above are somehow enforced by GHC/C2HS in the background, and they are only used to make <code>foreign import \u2026</code> FFI declarations more type safe. If instead of writing <code>{#pointer ...}</code> declarations, we wrote instead their generated <code>data HaskellName ..</code> declarations as above (i.e., not using C2HS), then the C-to-Haskell type associations wouldn't be enforced by GHC natively (I'm assuming).</p>\n\n<p>Finally, if we delete the <code>*</code> character in the <code>{#pointer \u2026}</code> declarations above, then instead of us having type correspondences between  <code>*CTypeName ~ HaskellName</code> and  <code>*CTypeName ~ (Ptr HaskellName)</code>, we would have type correspondences between <code>CTypeName ~ HaskellName</code> and <code>CTypeName ~ (Ptr HaskellName)</code>.</p>\n\n<p>Is all of my understanding correct?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1532116739, "post_id": 51449517, "comment_id": 89869622, "body": "It sees the <code>-</code> as an operator in <code>-1</code>, try using <code>take&#39; (-1) [1..10]</code>."}, {"owner": {"reputation": 317, "user_id": 8072803, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e8b236ca5200f4946bef2b03a218a55?s=128&d=identicon&r=PG&f=1", "display_name": "riley lyman", "link": "https://stackoverflow.com/users/8072803/riley-lyman"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1532116817, "post_id": 51449517, "comment_id": 89869642, "body": "Ahh... I remember reading about this earlier. Makes sense, thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 7, "last_activity_date": 1532116981, "creation_date": 1532116981, "answer_id": 51449609, "question_id": 51449517, "link": "https://stackoverflow.com/questions/51449517/non-type-variable-argument-error/51449609#51449609", "title": "Non Type-Variable Argument Error", "body": "<p><code>take' -1</code> is interpreted as subtracting 1 from <code>take'</code>, which is an error because you can't subtract something from a function. You want <code>take' (-1)</code> instead.</p>\n\n<p>Note that this is not specific to your definition of <code>take'</code>. The same thing would have happened with the regular <code>take</code> as well.</p>\n"}], "owner": {"reputation": 317, "user_id": 8072803, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e8b236ca5200f4946bef2b03a218a55?s=128&d=identicon&r=PG&f=1", "display_name": "riley lyman", "link": "https://stackoverflow.com/users/8072803/riley-lyman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 51449609, "answer_count": 1, "score": 1, "last_activity_date": 1532116981, "creation_date": 1532116500, "question_id": 51449517, "link": "https://stackoverflow.com/questions/51449517/non-type-variable-argument-error", "title": "Non Type-Variable Argument Error", "body": "<p>I am trying to write my own version of the <code>take</code> function in Haskell, and I don't understand where I am going wrong. This is my code:</p>\n\n<pre><code>take' :: (Num i, Ord i) =&gt; i -&gt; [a] -&gt; [a]\ntake' n xs\n    | n &lt;= 0  = []\n    | null xs = []\n    | otherwise = first : rest \n    where first = head xs\n          rest  = take' (n - 1) (tail xs)\n</code></pre>\n\n<p>To my understanding, specifying <code>(Num i, Ord i) =&gt; i ...</code> at the beginning of the function means that I should be able to pass in a negative integer. But when I try <code>take' -1 [1..10]</code> in the interactive interpreter, I get this error:</p>\n\n<pre><code>*Main&gt; take' -1 [1..10]\n\n&lt;interactive&gt;:154:1: error:\n    * Non type-variable argument\n        in the constraint: Num (i -&gt; [a2] -&gt; [a2])\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall i a1 a2.\n              (Ord i, Num i, Num a1, Num (i -&gt; [a2] -&gt; [a2]),\n               Num ([a1] -&gt; i -&gt; [a2] -&gt; [a2]), Enum a1) =&gt;\n              i -&gt; [a2] -&gt; [a2]\n</code></pre>\n\n<p>I tried enabling FlexibleContexts in my code and that didn't change anything. To my understanding, I need <code>Num i</code> since I decrement <code>i</code> in the where statement, and I need <code>Ord i</code> since there needs to be a way to count how many elements I want to take. What am I getting wrong here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1532113664, "post_id": 51448942, "comment_id": 89868317, "body": "This question is meaningless without at least including details on your compilation and execution."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1532113855, "post_id": 51448942, "comment_id": 89868395, "body": "Well perhaps you have to include the C and/or swift version of your test as well, since otherwise, it is quite meaningless."}], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1532114548, "post_id": 51448974, "comment_id": 89868676, "body": "Thanks to point that out, I&#39;m new to Haskell"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532114602, "post_id": 51448974, "comment_id": 89868698, "body": "I can&#39;t see that code taking 24 seconds even in the interpreter. It just doesn&#39;t do that many iterations."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532119517, "post_id": 51448974, "comment_id": 89870694, "body": "@Carl It takes about half that time on my box when I run it in GHCi. Maybe he just has a really slow computer."}, {"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1532126446, "post_id": 51448974, "comment_id": 89872707, "body": "Yep, my computer is Pentium 4E, it is pretty old computer and I&#39;m very poor kid."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 9, "last_activity_date": 1532113794, "creation_date": 1532113794, "answer_id": 51448974, "question_id": 51448942, "link": "https://stackoverflow.com/questions/51448942/why-my-haskell-code-is-so-slow-compare-to-swift-and-c/51448974#51448974", "title": "Why My Haskell Code is so slow compare to Swift and C", "body": "<p>I measure the Haskell code running in <code>0.03 seconds</code>, leading me to believe you have ran this in the interpreter (which is for development, not performant execution) instead of compiling the code.  Also, you probably let the type default to Integer instead of using machine <code>Int</code> values.</p>\n\n<pre><code>tommd@HalfAndHalf /tmp% ghc -O2 t.hs &amp;&amp; time ./t &gt;/dev/null\n[1 of 1] Compiling Main             ( t.hs, t.o )\nLinking t ...\n./t &gt; /dev/null  0.03s user 0.00s system 87% cpu 0.040 total\ntommd@HalfAndHalf /tmp% cat t.hs\n\nmain :: IO ()\nmain = do\n  let l = [1..200] :: [Int]\n  let pythagoras = [ x | x &lt;- l, y &lt;- l, z &lt;- l, x^2 == y^2 + z^2]\n  print pythagoras\n</code></pre>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "closed_date": 1554229783, "answer_count": 1, "score": 3, "last_activity_date": 1554229795, "creation_date": 1532113619, "question_id": 51448942, "link": "https://stackoverflow.com/questions/51448942/why-my-haskell-code-is-so-slow-compare-to-swift-and-c", "closed_reason": "Duplicate", "title": "Why My Haskell Code is so slow compare to Swift and C", "body": "<p>Here is very simple Haskell code to find all the Pythagoras integers from 1 to 200 that satisfied the Pythagoras Theorem X^2 = Y^2 + Z^2</p>\n\n<p>Haskell:</p>\n\n<pre><code>let l = [1..200]\nlet pythagoras = [ x | x &lt;- l, y &lt;- l, z &lt;- l, x^2 == y^2 + z^2]\n</code></pre>\n\n<p>It takes <strong>24.1 seconds</strong> to finish it,</p>\n\n<p>Swift: \nUsing standard for loop\n<strong>0.05 seconds</strong></p>\n\n<p>C: \nUsing standard for loop\n<strong>0.022 seconds</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/cXqJA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cXqJA.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1532111175, "post_id": 51448362, "comment_id": 89867320, "body": "I understand this. But in English or in Math, I still don&#39;t know in what condition we could get a <code>Vector a</code> from the input <code>Vector a a a</code>. And also, should we avoid using the same type constructor name and value constructor name?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1532111269, "post_id": 51448362, "comment_id": 89867360, "body": "@user8314628 I don&#39;t understand what you mean by &quot;in what condition ...&quot;, but it is not bad practice to use the same value and constructor names, as long as you&#39;re not using the <code>DataKinds</code> language extension."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1532111788, "post_id": 51448362, "comment_id": 89867541, "body": "A <code>Vector 1 2 3</code> value can have type <code>Vector Int</code>.  If you use the <code>Vector</code> constructor fully applied (three fields) then you will always end up with a value of type <code>Vector a</code> for some <code>a</code>."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1532112366, "post_id": 51448362, "comment_id": 89867771, "body": "I\u2019m mostly happy with this answer but I don\u2019t really like the phrase \u201cwhere <code>a</code> is some not yet known type.\u201d It seems it could be read as implying that once you\u2019ve made a <code>Vector Int</code> you can no longer make a <code>Vector String</code>. On the other hand I can\u2019t think of a good concise way to write it"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1532112960, "post_id": 51448362, "comment_id": 89868036, "body": "@DanRobertson brevity can be enemy of clarity. matters of elegance to the tailor and to the cobbler, etc."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1532114330, "post_id": 51448362, "comment_id": 89868593, "body": "@WillNess you seem to have come up with a good way to put it in your own answer"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1532114695, "post_id": 51448362, "comment_id": 89868740, "body": "@DanRobertson I just like that quote, and try to bring it up when appropriate. :)"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1532116420, "post_id": 51448362, "comment_id": 89869494, "body": "@AJFarmar Now I understand it better. Could I regard <code>a</code> in <code>Vector a</code> as some kind of container that has a <code>Vector a a a</code> in it, where <code>Vector a</code> and <code>Vector a a a</code> are 2 totally different things?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1532117043, "post_id": 51448362, "comment_id": 89869720, "body": "@user8314628 The <code>a</code> in <code>Vector a</code> is a type variable, the type-level equivalent of the <code>x</code> in <code>\\x -&gt; x + 1</code>. It allows you to make a vector of any type."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 1, "last_activity_date": 1532111530, "last_edit_date": 1532111530, "creation_date": 1532110859, "answer_id": 51448362, "question_id": 51447920, "link": "https://stackoverflow.com/questions/51447920/can-type-constructor-be-the-same-as-value-constructor/51448362#51448362", "title": "Can type constructor be the same as value constructor?", "body": "<p>This defines a new datatype called <code>Vector</code>. Let's break it up into a few different parts:</p>\n\n<pre><code>data Vector a     -- Type part\n  = Vector a a a  -- Constructor part\n  deriving (Show) -- Automatic derivation part\n</code></pre>\n\n<p>The type part says that \"The following will be defined to have type <code>Vector a</code>, where <code>a</code> is some not yet known type\":</p>\n\n<pre><code>data Vector a     -- Type part\n</code></pre>\n\n<p>The constructor part defines a function <code>Vector :: a -&gt; a -&gt; a -&gt; Vector a</code>. Note that types and values have different namespaces and thus can have the same name.</p>\n\n<pre><code>  = Vector a a a  -- Constructor part\n</code></pre>\n\n<p>The automatic derivation part tells the compiler to automatically implement the function <code>show</code> for this type, allowing us to ignore the details. If you don't yet know about typeclasses, don't worry too much about what this means, but bear in mind that without this you can't <code>show</code> or <code>print</code> these values.</p>\n\n<pre><code>  deriving (Show) -- Automatic derivation part\n</code></pre>\n\n<p>We can play with these values in GHCi:</p>\n\n<pre><code>\u03bb&gt; data Vector a = Vector a a a deriving (Show)\n\u03bb&gt; Vector 1 2 3\nVector 1 2 3\n\u03bb&gt; :type Vector True False True\nVector True False True :: Vector Bool\n\u03bb&gt; :type Vector \"Hello,\" \" World\" \"!\"\nVector \"Hello,\" \" World\" \"!\" :: Vector [Char]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1532112081, "creation_date": 1532112081, "answer_id": 51448632, "question_id": 51447920, "link": "https://stackoverflow.com/questions/51447920/can-type-constructor-be-the-same-as-value-constructor/51448632#51448632", "title": "Can type constructor be the same as value constructor?", "body": "<pre><code>data Vector a = MkVector a a a \n</code></pre>\n\n<p>defines a parameterized data type, <code>Vector a</code> for any type <code>a</code>. </p>\n\n<p>It also defines a way for us to create values of that type: by using a data constructor function <code>MkVector</code> with three parameters of the same type.</p>\n\n<p>For whatever type <code>a</code>, calling <code>MkVector</code> with three values of type <code>a</code> produces a value of type <code>Vector a</code>. For example,</p>\n\n<pre><code>let a :: Int ; a = 1 ; v = MkVector a 3 4 in v :: Vector Int\n\nlet a :: Float ; a = 1 ; v = MkVector a 3 4 in v :: Vector Float\n</code></pre>\n\n<p>It so happens that we are allowed to use the same name as in the type, <code>Vector</code>, as the name of the data constructor as well. This can be confusing at first.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 51448632, "answer_count": 2, "score": 2, "last_activity_date": 1532112081, "creation_date": 1532108937, "last_edit_date": 1532110151, "question_id": 51447920, "link": "https://stackoverflow.com/questions/51447920/can-type-constructor-be-the-same-as-value-constructor", "title": "Can type constructor be the same as value constructor?", "body": "<p>In the <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">Haskell tutorial, </a>I see an expression like this</p>\n\n<pre><code>data Vector a = Vector a a a deriving (Show)\n</code></pre>\n\n<p>Probably not the same, but very similar. I'm a bit confused. Could anyone explain what it is doing?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "is_accepted": true, "score": 4, "last_activity_date": 1532103709, "last_edit_date": 1532103709, "creation_date": 1532103365, "answer_id": 51446640, "question_id": 51446524, "link": "https://stackoverflow.com/questions/51446524/why-doesnt-this-type-check/51446640#51446640", "title": "Why doesn&#39;t this type check?", "body": "<p>Type variables, by default, are not scoped that way. The <code>t</code> in the function signature and the <code>t</code> in the function body are not the same. Your code is equivalent to this:</p>\n\n<pre><code>repro :: (Binary t, Foo t) =&gt; Proxy t -&gt; ()\nrepro _proxy =\n  bar (foo :: a)\n</code></pre>\n\n<p>You need to enable the ScopedTypeVariables extension, and add an explicit <code>forall t</code>.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nrepro :: forall t. (Binary t, Foo t) =&gt; Proxy t -&gt; ()\nrepro _proxy =\n  bar (foo :: t)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1532103461, "creation_date": 1532103461, "answer_id": 51446665, "question_id": 51446524, "link": "https://stackoverflow.com/questions/51446524/why-doesnt-this-type-check/51446665#51446665", "title": "Why doesn&#39;t this type check?", "body": "<p>You probably need to turn on the <code>ScopedTypeVariables</code> extension and then use</p>\n\n<pre><code>repro :: forall t. (Binary t, Foo t) =&gt; Proxy t -&gt; ()\nrepro _proxy = bar (foo :: t)\n</code></pre>\n\n<p>Otherwise, the <code>t</code> in <code>foo :: t</code> is not related to the other <code>t</code> in the <code>repro</code> signature. Essentially <code>foo :: t</code> becomes equivalent to <code>foo :: forall a. a</code>.</p>\n\n<p>This is arguably one the most disliked features of the Haskell definition, and <code>ScopedTypeVariables</code> is very popular since it allows to work around that. (In my opinion, it should be on by default.)</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1532107504, "creation_date": 1532107504, "answer_id": 51447597, "question_id": 51446524, "link": "https://stackoverflow.com/questions/51446524/why-doesnt-this-type-check/51447597#51447597", "title": "Why doesn&#39;t this type check?", "body": "<p>For completeness, this can also be handled without extensions. The key trick here is to write a function whose type is <em>more</em> restricted than it needs to be, to connect the <code>Proxy</code>'s type argument with the <code>Foo</code> instance. So:</p>\n\n<pre><code>-- most general possible type is Foo b =&gt; a -&gt; b\nfooForProxy :: Foo t =&gt; proxy t -&gt; t\nfooForProxy _proxy = foo\n\n-- I've changed Proxy to proxy here because that's good practice, but everything\n-- works fine with your original signature.\nrepro :: (Binary t, Foo t) =&gt; proxy t -&gt; ()\nrepro = bar . fooForProxy\n</code></pre>\n\n<p>Of course, the modern way is to use even <em>more</em> extensions to eliminate proxies entirely:</p>\n\n<pre><code>{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nrepro :: forall t. (Binary t, Foo t) =&gt; ()\nrepro = bar @t foo\n</code></pre>\n\n<p>Invoking <code>repro</code> will again require a type application, as in <code>repro @Int</code> or whatever.</p>\n"}], "owner": {"reputation": 4390, "user_id": 5978, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f17c0b98ba353560769ef225c5c5c9fe?s=128&d=identicon&r=PG", "display_name": "luntain", "link": "https://stackoverflow.com/users/5978/luntain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 51446640, "answer_count": 3, "score": 2, "last_activity_date": 1532107504, "creation_date": 1532102991, "question_id": 51446524, "link": "https://stackoverflow.com/questions/51446524/why-doesnt-this-type-check", "title": "Why doesn&#39;t this type check?", "body": "<pre><code>class Foo t where\n  foo :: t\n\nbar :: Binary t =&gt; t -&gt; ()\nbar = undefined\n\nrepro :: (Binary t, Foo t) =&gt; Proxy t -&gt; ()\nrepro _proxy =\n  bar (foo :: t)\n</code></pre>\n\n<p>The compiler complains:</p>\n\n<ul>\n<li><p>Could not deduce (Binary t0) arising from a use of \u2018bar\u2019\n      from the context: (Binary t, Foo t)\n        bound by the type signature for:\n                   repro :: forall t. (Binary t, Foo t) => Proxy t -> ()</p></li>\n<li><p>Could not deduce (Foo t2) arising from a use of \u2018foo\u2019\n      from the context: (Binary t, Foo t)\n        bound by the type signature for:\n                   repro :: forall t. (Binary t, Foo t) => Proxy t -> ()</p></li>\n</ul>\n\n<p>Specifically, I am surprised it does not see I am passing <code>t</code> to <code>bar</code>, and creates a <code>t0</code> type var. <code>t2</code> is even more mysterious, because <code>foo</code> is explicitly annotated with type <code>t</code>.</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1532093503, "post_id": 51443506, "comment_id": 89857291, "body": "Hello! Have you checked out <a href=\"https://haskell-servant.readthedocs.io/en/stable/tutorial/Authentication.html#generalized-authentication\" rel=\"nofollow noreferrer\">this tutorial page</a> or say <a href=\"https://haskell-servant.readthedocs.io/en/stable/cookbook/jwt-and-basic-auth/JWTAndBasicAuth.html#authentication\" rel=\"nofollow noreferrer\">this cookbook recipe</a> ? If you use servant&#39;s mechanism for specifying your authentication scheme, servant will actually extract and pass that <code>Entity User</code> value around for you, as shown in the examples. Let me know here if that&#39;s not clear enough."}, {"owner": {"reputation": 1, "user_id": 10107646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/273074672a2641aef0e3559b9b78abef?s=128&d=identicon&r=PG&f=1", "display_name": "Nachos Tolstoy", "link": "https://stackoverflow.com/users/10107646/nachos-tolstoy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1532119197, "post_id": 51443506, "comment_id": 89870559, "body": "Hi @AlpMestanogullari thank you for response. I guess generalized authentication is the way to go then. In fact I tried to use regular jwt with an additional step of fetching user from db so I wondered if there is any easier method to accomplish this. Furthermore I can imagine such a way of executing certain code for a group of handlers could be helpful in other cases too so I wondered if it is possible in servant"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1532128989, "post_id": 51443506, "comment_id": 89873185, "body": "Note that there&#39;s also a <a href=\"http://hackage.haskell.org/package/servant-auth\" rel=\"nofollow noreferrer\">servant-auth</a> package which provides JWT out of the box, but still works on the same principle of declaring the auth-protection and having some user data be given to all the handlers that are protected behind authentication."}, {"owner": {"reputation": 1, "user_id": 10107646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/273074672a2641aef0e3559b9b78abef?s=128&d=identicon&r=PG&f=1", "display_name": "Nachos Tolstoy", "link": "https://stackoverflow.com/users/10107646/nachos-tolstoy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1532175294, "post_id": 51443506, "comment_id": 89881312, "body": "Sorry I didnt clearly state that I&#39;m using servant-auth and it&#39;s JWT already. To make it clear: authentication itself works. I just wanted to pass Entity User to handlers instead of Token but I dunno how to accomplish this (generalized authentication seems a bit too much for such a simple modification) since it needs to run in specific monad to access database and throw exceptions (as shown in getUser function). That&#39;s why I generalized my question since it&#39;s not strictly related to authentication rather to  passing db objects to handlers at a higher level."}, {"owner": {"reputation": 1, "user_id": 10107646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/273074672a2641aef0e3559b9b78abef?s=128&d=identicon&r=PG&f=1", "display_name": "Nachos Tolstoy", "link": "https://stackoverflow.com/users/10107646/nachos-tolstoy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1532176054, "post_id": 51443506, "comment_id": 89881519, "body": "Also please note I&#39;m aware that there are some workarounds to fix it. I just asked out of curiosity if it is possible in servant to define behaviour common for group of handlers. Alternatively I thought if I can use FromJWT to fetch user from db but it is unfortunately underdocumented and I didnt find any example of such"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1532249659, "post_id": 51443506, "comment_id": 89895831, "body": "Oh I see! It feels like this is a terrible place to discuss your problem. I&#39;m not sure I understand it 100% yet so I don&#39;t feel like posting a proper answer that&#39;s actually full of questions, but those comments just feel so tiny and inappropriate for discussing things. Would you mind opening an issue on servant&#39;s issue tracker? Thanks a lot!"}, {"owner": {"reputation": 1, "user_id": 10107646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/273074672a2641aef0e3559b9b78abef?s=128&d=identicon&r=PG&f=1", "display_name": "Nachos Tolstoy", "link": "https://stackoverflow.com/users/10107646/nachos-tolstoy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1532390908, "post_id": 51443506, "comment_id": 89946296, "body": "Sure, will do. Thank you for help"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10107646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/273074672a2641aef0e3559b9b78abef?s=128&d=identicon&r=PG&f=1", "display_name": "Nachos Tolstoy", "link": "https://stackoverflow.com/users/10107646/nachos-tolstoy"}, "is_accepted": true, "score": 0, "last_activity_date": 1550267080, "creation_date": 1550267080, "answer_id": 54717461, "question_id": 51443506, "link": "https://stackoverflow.com/questions/51443506/how-to-feed-a-group-of-handlers-with-value-fetched-from-db-in-servant/54717461#54717461", "title": "How to feed a group of handlers with value fetched from Db in servant?", "body": "<p>In this particular problem creating a custom instance of IsAuth seems to be the best solution. There seem to be no official/idiomatic way though.</p>\n\n<p>I've solved the problem by doing:</p>\n\n<pre><code>data UserCookie\n\nextractUser userId = (maybe mzero (return . Entity userId)) =&lt;&lt; fetch\n  where\n    fetch = liftIO $ runSql $ get userId\n\ninstance IsAuth UserCookie (Entity User) where\n  type AuthArgs UserCookie = '[CookieSettings, JWTSettings]\n  runAuth _ _ = \\c jwt -&gt; extractUser =&lt;&lt; cookieAuthCheck c jwt\n</code></pre>\n\n<p>This link might also be helpful: <a href=\"https://github.com/haskell-servant/servant-auth/issues/73\" rel=\"nofollow noreferrer\">https://github.com/haskell-servant/servant-auth/issues/73</a></p>\n"}], "owner": {"reputation": 1, "user_id": 10107646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/273074672a2641aef0e3559b9b78abef?s=128&d=identicon&r=PG&f=1", "display_name": "Nachos Tolstoy", "link": "https://stackoverflow.com/users/10107646/nachos-tolstoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 54717461, "answer_count": 1, "score": 0, "last_activity_date": 1550267080, "creation_date": 1532092908, "question_id": 51443506, "link": "https://stackoverflow.com/questions/51443506/how-to-feed-a-group-of-handlers-with-value-fetched-from-db-in-servant", "title": "How to feed a group of handlers with value fetched from Db in servant?", "body": "<p>I'm using servant with JWT authentication. I'm trying to fetch authenticated user and pass it to handlers not to have to repeat same logic in each handler.</p>\n\n<p>With a single argument function it works like a charm:  </p>\n\n<pre><code>listMeters :: Entity User -&gt; Handler [Meter]\nprotected :: Servant.Auth.Server.AuthResult Token -&gt; Server Protected\nprotected (Servant.Auth.Server.Authenticated email) = do\n  user &lt;- getUser email\n  listMeters user\n</code></pre>\n\n<p>On the other hand when I try to do the same with function that takes two parameters:  </p>\n\n<pre><code>addMeter :: Entity User -&gt; Meter -&gt; Handler Meter\nprotected :: Servant.Auth.Server.AuthResult Token -&gt; Server Protected\nprotected (Servant.Auth.Server.Authenticated email) = do\n  user &lt;- getUser email\n  addMeter user \n</code></pre>\n\n<p>It throws compilation error:  </p>\n\n<pre><code>/usr/src/app/src/Handlers.hs:57:3: error:\n    \u2022 Couldn't match type \u2018Handler b0\u2019 with \u2018Meter -&gt; Handler Meter\u2019\n      Expected type: Server Protected\n        Actual type: Handler b0\n    \u2022 In a stmt of a 'do' block: user &lt;- getUser email\n      In the expression:\n        do user &lt;- getUser email\n           addMeter user\n      In an equation for \u2018protected\u2019:\n          protected (Authenticated email)\n            = do user &lt;- getUser email\n                 addMeter user\n   |\n57 |   user &lt;- getUser email\n   |   ^^^^^^^^^^^^^^^^^^^^^\n\n/usr/src/app/src/Handlers.hs:64:3: error:\n    \u2022 Couldn't match expected type \u2018Handler b0\u2019\n                  with actual type \u2018Meter -&gt; Handler Meter\u2019\n    \u2022 Probable cause: \u2018addMeter\u2019 is applied to too few arguments\n      In a stmt of a 'do' block: addMeter user\n      In the expression:\n        do user &lt;- getUser email\n           addMeter user\n      In an equation for \u2018protected\u2019:\n          protected (Authenticated email)\n            = do user &lt;- getUser email\n                 addMeter user\n   |\n64 |   addMeter user\n   |   ^^^^^^^^^^^^^\n</code></pre>\n\n<p>Function fetching users from db:   </p>\n\n<pre><code>getUser :: Token -&gt; Handler (Entity User)\ngetUser email = do\n  userEntity &lt;- liftIO $ runSql $ getBy $ UniqueEmail email\n  case userEntity of\n        Nothing -&gt; throwError err401\n        Just user -&gt; return user\n</code></pre>\n\n<p>Why does the first example work and the other doesn't? How to resolve such a case properly in servant? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1532092303, "post_id": 51443192, "comment_id": 89856466, "body": "This seems to be doable with a <code>custom-setup</code> field in the cabal file. At least <a href=\"http://hackage.haskell.org/package/gtk-0.14.10/gtk.cabal\" rel=\"nofollow noreferrer\">that&#39;s what the gtk package does</a>, which depends on executables from <a href=\"http://hackage.haskell.org/package/gtk2hs-buildtools\" rel=\"nofollow noreferrer\">gtk2hs-buildtools</a>."}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1532092994, "post_id": 51443192, "comment_id": 89856966, "body": "This also requires some custom setup code to be written, right? It sounds like a solution, even though i thought there was a simpler way"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 3, "creation_date": 1532095269, "post_id": 51443192, "comment_id": 89858485, "body": "There&#39;s also <code>build-tool-depends</code> field since <code>Cabal-2.0</code> : <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#pkg-field-build-tool-depends\" rel=\"nofollow noreferrer\">haskell.org/cabal/users-guide/&hellip;</a>"}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "edited": false, "score": 0, "creation_date": 1533458567, "post_id": 51443192, "comment_id": 90346982, "body": "so will executables added with <code>build-tool-depends</code> be available also at runtime, or only at compile time? if the first option holds, it feels like a different name would be more suited to the field"}], "owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1532091855, "creation_date": 1532091855, "question_id": 51443192, "link": "https://stackoverflow.com/questions/51443192/is-there-a-way-to-install-an-haskell-executable-as-a-dependency", "title": "Is there a way to install an Haskell executable as a dependency?", "body": "<p>I found myself writing Haskell commands based upon other commands provided by other Haskell packages, but i could not find a way to install an executable as a dependency.</p>\n\n<p>As far as i could see, Cabal and Stack provide ways for a package to depend on a library, but not on an executable.</p>\n\n<p>If i want to build upon the functionality already provided by another executable, the only way i know is to ask the users to install that other package as well. That also means that i cannot assume the executable is there or its version is the right one.</p>\n\n<p>So is there a way for an Haskell package to depend on an executable provided by another package?</p>\n"}, {"tags": ["haskell", "types"], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "is_accepted": false, "score": 4, "last_activity_date": 1532094141, "last_edit_date": 1532094141, "creation_date": 1532069844, "answer_id": 51436770, "question_id": 51436769, "link": "https://stackoverflow.com/questions/51436769/why-does-map-have-this-type/51436770#51436770", "title": "Why does (.) map have this type?", "body": "<p>You have probably tried to match the functions by looking at the definition</p>\n\n<pre><code>Types of the two functions\n(.) :: ((b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c)\nmap :: (d -&gt; e) -&gt; [d] -&gt; [e]\n</code></pre>\n\n<p>and then trying to match <code>d</code> to <code>b</code> and <code>e</code> to <code>c</code>. Which gives you <code>((a -&gt; d) -&gt; (a -&gt; e)) -&gt; ([d] -&gt; [e])</code>, now you could match <code>[d]</code> to <code>a</code> and <code>[e]</code> to <code>d</code>. This is however not correct because according to the type definition of <code>map</code>, <code>e</code> and <code>d</code> could be of different type, i.e. <code>d</code> could be of type <code>[e]</code> but it doesn't have to.</p>\n\n<p>The correct way to find the type of this function is to look at the definition of the types</p>\n\n<pre><code>Types of the two functions\n(.) :: ((b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c)\nmap :: (d -&gt; e) -&gt; [d] -&gt; [e]\n</code></pre>\n\n<p>and then to match <code>(d -&gt; e)</code> to <code>b</code> and <code>[d] -&gt; [e]</code> to <code>c</code> which gives you <code>(a -&gt; (d -&gt; e)) -&gt; a -&gt; ([d] -&gt; [e])</code>, by removing the superfluous brackets and renaming the type variables you get <code>(a -&gt; b -&gt; c) -&gt; a -&gt; [b] -&gt; [c]</code>. This is the same result GHCI gives you.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1532081535, "last_edit_date": 1532081535, "creation_date": 1532079641, "answer_id": 51439649, "question_id": 51436769, "link": "https://stackoverflow.com/questions/51436769/why-does-map-have-this-type/51439649#51439649", "title": "Why does (.) map have this type?", "body": "<h1>Deriving the type...</h1>\n\n<p>We have as ingredients:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\nmap :: (d -&gt; e) -&gt; [d] -&gt; [e]\n</code></pre>\n\n<p>(here I used different type identifiers for the two functions to avoid any confusion). A more verbose form (where we make it more explicit that every function takes exactly <em>one</em> parameter) is:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; ((a -&gt; b) -&gt; (a -&gt; c))\nmap :: (d -&gt; e) -&gt; ([d] -&gt; [e])\n</code></pre>\n\n<p>Since <code>map</code> is the first parameter of <code>(.)</code> that means that its type <code>(d -&gt; e) -&gt; ([d] -&gt; [e])</code> should match the input type of the <code>(.)</code> function (so <code>b -&gt; c</code>). This thus means:</p>\n\n<pre><code>  b        -&gt; c\n~ (d -&gt; e) -&gt; ([d] -&gt; [e])\n------------------------------\nb ~ (d -&gt; e), c ~ ([d] -&gt; [e])\n</code></pre>\n\n<p>So that means that the result type of <code>(.) map</code> is:</p>\n\n<pre><code>(a -&gt; b) -&gt; (a -&gt; c)\n</code></pre>\n\n<p>which is equivalent to:</p>\n\n<pre><code>(a -&gt; (d -&gt; e)) -&gt; (a -&gt; ([d] -&gt; [e]))\n</code></pre>\n\n<p>or less verbose:</p>\n\n<pre><code>(.) map :: (a -&gt; d -&gt; e) -&gt; a -&gt; [d] -&gt; [e]\n</code></pre>\n\n<h1>... and its implementation</h1>\n\n<p>The <code>(.)</code> function can be seen as <code>(.) f g == \\x -&gt; f (g x)</code>. So that means that our function</p>\n\n<pre><code>h = (.) map\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>h f x = map (f x)\n</code></pre>\n\n<p>It thus takes as input a function <code>f</code> and an object <code>x</code>, and than performs a <code>map</code> with <code>f x</code> as function.</p>\n\n<p>Semancially you could say that we make a \"<em>map where one has to inject a 'contect'-objecct</em>\" of type <code>a</code>. This context is then taken into account by the processor. This could be useful if we want to apply multiple <code>map</code>s, each with a small change, and thus first pass a \"context-object\". This is of course <em>an</em> interpretation of humans. For a compiler, the <code>x</code> can have any use, interpretation, etc.</p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1532081457, "post_id": 51439705, "comment_id": 89850371, "body": "Usually the tilde (<code>~</code>) is used to denote that two types are the same. Nevertheless +1 :)"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1532082081, "post_id": 51439705, "comment_id": 89850767, "body": "@WillemVanOnsem didn&#39;t know it. Thanks for sharing :)"}], "tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 3, "last_activity_date": 1532079775, "creation_date": 1532079775, "answer_id": 51439705, "question_id": 51436769, "link": "https://stackoverflow.com/questions/51436769/why-does-map-have-this-type/51439705#51439705", "title": "Why does (.) map have this type?", "body": "<p>When I don't understand the type of a function, I write types using different letters: </p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\nmap :: (x -&gt; y) -&gt; [x] -&gt; [y]\n</code></pre>\n\n<p>now we are providing <code>map</code> as the first argument of <code>(.)</code> so we can deduce:</p>\n\n<pre><code>b -&gt; c == (x -&gt; y) -&gt; [x] -&gt; [y] -- by matching first arguments we get...\nb == x -&gt; y                      \nc == [x] -&gt; [y]\n</code></pre>\n\n<p>since we have already provided the first argument of <code>(.)</code>, the whole <code>b -&gt; c</code> part disappears.</p>\n\n<pre><code>(.) map :: (a -&gt; b) -&gt; a -&gt; c                -- Using the above equations for b and c\n(.) map :: (a -&gt; x -&gt; y) -&gt; a -&gt; [x] -&gt; [y]  -- changing variables names\n(.) map :: (a1 -&gt; a2 -&gt; b) -&gt; a1 -&gt; [a2] -&gt; [b]\n</code></pre>\n\n<p>as <code>GHCi</code> plots</p>\n"}], "owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 51439649, "answer_count": 3, "score": 3, "last_activity_date": 1532094141, "creation_date": 1532069844, "question_id": 51436769, "link": "https://stackoverflow.com/questions/51436769/why-does-map-have-this-type", "title": "Why does (.) map have this type?", "body": "<p>I tried to find the type of the function <code>(.) map</code> but somehow find that it is <code>((a -&gt; d) -&gt; (a -&gt; e)) -&gt; ([d] -&gt; [e])</code> which according to GHCI is not correct because it should be <code>(.) map :: (a1 -&gt; a2 -&gt; b) -&gt; a1 -&gt; [a2] -&gt; [b]</code>.</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1532071255, "creation_date": 1532071255, "answer_id": 51437171, "question_id": 51436388, "link": "https://stackoverflow.com/questions/51436388/error-installing-data-aeson/51437171#51437171", "title": "Error installing Data.Aeson", "body": "<p><code>Data.Aeson</code> is not a package, it is one of many modules within the package called <code>aeson</code>.  Try <code>cabal install aeson</code>.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 828, "favorite_count": 0, "accepted_answer_id": 51437171, "answer_count": 1, "score": 0, "last_activity_date": 1532071255, "creation_date": 1532068368, "question_id": 51436388, "link": "https://stackoverflow.com/questions/51436388/error-installing-data-aeson", "title": "Error installing Data.Aeson", "body": "<p>Hello can anyone tell me how can i install the <code>Data.Aeson</code> package?I am running into the following error:</p>\n\n<pre><code>WARNING: cache is out WoAfR NdaItNeG::  Cc:a/cUhsee riss/ aodurti aonf.b edrcaotev:i ciC/:Ap/pUDsaeta/rLso/caadlr/iParno.gbrearmcso/vsitcaic/kA/pxp8D6a_t6a4/-Lwoicnadlo/ws/Pgrhocg-r8a.ms0./2s\\ltiabc\\kp/xack8a6g_e6.4c-ownfi.ndd\\poawcsk/agghec.-c8a.c0h.e2\n\\glhicb \\wpialclk asgeee. caonn fo.ldd\\ pvaicekwa goef. ctahcihse\npgahcck awgiel ld bs.e eU saen  'oglhdc -vpikegw  roefc atchhies'  ptaoc kfaigxe.\ndb. Use 'ghc-pkg recache' to fix.\nError parsing targets: Directory not found: Data.Aeson\n</code></pre>\n\n<p>Below it says <code>Use ghc-pkg recache</code>.When i try running this command i get the following error:</p>\n\n<pre><code>ghc-pkg.exe: C:\\Program Files\\Haskell Platform\\8.4.2\\lib\\package.conf.d\\package.cache: you don't have permission to modify this file\n</code></pre>\n\n<p>I have tried installing <code>Data.Aeson</code> both with <code>cabal install Data.Aeson</code> and with <code>Stack install Data.Aeson</code>.With the latter i get the following error:</p>\n\n<pre><code>WARNING:WA caRcNhIeN Gi:s  coaucth eo fi sd oautte :o fC :d/aUtsee:r sC/a:d/riaUns.ebresr/caodvriicain/.AbpeprDcatova/Lioccia/lA/pPprDoagtraa/mLso/csatla/cPkr/oxg8r6a_m6s4/-swtiancdko/wxs8/6g_h6c4--8w.i0n.d2o\\wlsi/bg\\hpca-c8k.a0g.e2.\\cloinbf\\.pda\\cpkaacgkea.gceo.ncfa.cdh\\ep\nagchkca gwei.lcla csheee\n gahnc  owlidl lv iseewe  oafn  tohlids  vpiaecwk aogfe  tdhbi.s  Upsaec k'agghec -dpbk.g  Urseec a'cghhec'- ptkog  friexc.a\nche' to fix.\nError parsing targets: Directory not found: Data.Aeson\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1532035299, "post_id": 51431708, "comment_id": 89834665, "body": "As you see, changing the type signature doesn&#39;t solve the problem. As a general rule, you should only change the type of a function if you determine that the type is in fact incorrect. In this case, you know you want to return <code>y</code>, not <code>[y]</code>, so changing the type is not the right solution. Instead, you should figure out what the error message is telling you is wrong. Haskell errors are very intimidating to start. Feel free to post the error when you ask a question here and members of the community will help explain what it means."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1532036464, "post_id": 51431708, "comment_id": 89835119, "body": "Prefer pattern-matching to using <code>head</code> and <code>tail</code>."}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1532076981, "post_id": 51431708, "comment_id": 89847439, "body": "Incidentally, your <code>taken :: [\u03b3] -&gt; Int -&gt; [\u03b3]</code> version has another name in the Prelude - it&#39;s <code>flip drop</code>. <code>drop</code> is the complement of <code>take</code>, and the combination is done by <code>splitAt</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1532034972, "creation_date": 1532034972, "answer_id": 51431839, "question_id": 51431708, "link": "https://stackoverflow.com/questions/51431708/recursive-definition-of-the-function/51431839#51431839", "title": "Recursive definition of the (!!)-function", "body": "<p>Yes, a straightforward one is:</p>\n\n<pre><code>nth0 :: [a] -&gt; Int -&gt; a\nnth0 (x:xs) i | i &gt;= 1 = nth0 xs (i-1)\n              | i &lt; 0 = error \"Index less than zero\"\n              | otherwise = x\nnth0 [] i = error \"Index too large\"\n</code></pre>\n\n<p>So the recursive part is the <code>nth0 xs (i-1)</code>. Here we thus perform recursion on the tail of the list <code>xs</code>, and with a decremented index <code>i-1</code>.</p>\n\n<p>The base case is the <code>otherwise</code> (which fires in case <code>i == 0</code>), in which case we return the head of the list <code>x</code>.</p>\n\n<p>The remaining cases cover the fact that the index could be negative, or that the index is greater than, or equal to the length of the list.</p>\n"}, {"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 7, "last_activity_date": 1532046688, "last_edit_date": 1532046688, "creation_date": 1532035492, "answer_id": 51431944, "question_id": 51431708, "link": "https://stackoverflow.com/questions/51431708/recursive-definition-of-the-function/51431944#51431944", "title": "Recursive definition of the (!!)-function", "body": "<pre><code>taken :: [\u03b3] -&gt; Int -&gt; [\u03b3] -- works, but returns a list\ntaken \u03b3s 0 = \u03b3s\ntaken \u03b3s 1 = tail \u03b3s\ntaken \u03b3s n = tail (taken \u03b3s (n-1))\n</code></pre>\n\n<p>This is very close. There are three problems:</p>\n\n<ol>\n<li><p>You have too many cases. You only need these two:</p>\n\n<pre><code>taken ys 0 = ...\ntaken ys n = ...\n</code></pre></li>\n<li><p>You want to return an element of the list, not a list. In particular, the first rule needs to return the first element of the list. One way to do this is with <code>head</code>:</p>\n\n<pre><code>taken ys 0 = head ys\n</code></pre></li>\n<li><p>Now we need to fix the second rule. We want to write this recursively, so we want to do something like this:</p>\n\n<pre><code>taken ys n = taken ?? ??\n</code></pre>\n\n<p>What do we put in place of the <code>??</code>s? Well, we know that <code>n</code> is at least <code>1</code>. And if we get down to <code>0</code>, we can use the first rule to return the result. This suggests that the second parameter should be <code>(n-1)</code> as you already have tried.</p>\n\n<p>We also know that the first element of <code>ys</code> isn't the right one to use, so we want to throw it away. To do this, we can use <code>tail ys</code>. Putting this all together we get</p>\n\n<pre><code>taken ys n = taken (tail ys) (n-1)\n</code></pre></li>\n</ol>\n\n<p>So it seems that the main mistake here is you were applying <code>tail</code> in the wrong place.</p>\n\n<p><strong>Notes</strong></p>\n\n<ol>\n<li><p>This solution isn't robust. It will cause an infinite recursion if you call it with a negative index. Handling for this case is left as an exercise for the reader.</p></li>\n<li><p>You can use pattern matching instead of <code>head</code> and <code>tail</code>. For example, the first case can be written as</p>\n\n<pre><code>taken (y:_) 0 = y\n</code></pre>\n\n<p>I leave implementing the second case with pattern matching as an exercise for the reader.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 5, "last_activity_date": 1532051767, "creation_date": 1532051767, "answer_id": 51434021, "question_id": 51431708, "link": "https://stackoverflow.com/questions/51431708/recursive-definition-of-the-function/51434021#51434021", "title": "Recursive definition of the (!!)-function", "body": "<p>Writing a recursive function on lists, you should almost always start by mirroring the recursive definition of the list type itself: a case for empty lists, and a case for a cons pair:</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; \u03b3\ntaken [] n = _\ntaken (\u03b3:\u03b3s) n = _\n</code></pre>\n\n<p>Note, the above syntax with underscore placeholders is actual Haskell syntax (for recent enough GHC), which will cause the compiler to print out errors like this asking you to fill in the blanks, and telling you about the pieces you have available to fill them in:</p>\n\n<pre><code>foo.hs:2:14: error:\n    \u2022 Found hole: _ :: \u03b3\n      Where: \u2018\u03b3\u2019 is a rigid type variable bound by\n               the type signature for:\n                 taken :: forall \u03b3. [\u03b3] -&gt; Int -&gt; \u03b3\n               at foo.hs:1:1-24\n    \u2022 In the expression: _\n      In an equation for \u2018taken\u2019: taken [] n = _\n    \u2022 Relevant bindings include\n        n :: Int (bound at foo.hs:2:10)\n        taken :: [\u03b3] -&gt; Int -&gt; \u03b3 (bound at foo.hs:2:1)\n  |\n2 | taken [] n = _\n  |              ^\n\nfoo.hs:3:18: error:\n    \u2022 Found hole: _ :: \u03b3\n      Where: \u2018\u03b3\u2019 is a rigid type variable bound by\n               the type signature for:\n                 taken :: forall \u03b3. [\u03b3] -&gt; Int -&gt; \u03b3\n               at foo.hs:1:1-24\n    \u2022 In the expression: _\n      In an equation for \u2018taken\u2019: taken (\u03b3 : \u03b3s) n = _\n    \u2022 Relevant bindings include\n        n :: Int (bound at foo.hs:3:14)\n        \u03b3s :: [\u03b3] (bound at foo.hs:3:10)\n        \u03b3 :: \u03b3 (bound at foo.hs:3:8)\n        taken :: [\u03b3] -&gt; Int -&gt; \u03b3 (bound at foo.hs:2:1)\n  |\n3 | taken (\u03b3:\u03b3s) n = _\n  |  \n</code></pre>\n\n<p>So the first hole we need to fill in is of type <code>\u03b3</code>. However the only things we have available are the <code>Int</code> <code>n</code>, and making a recursive call to <code>taken</code>. Since the list is empty, recursing isn't going to help us; it'll just end up back at the same case we're in. And thinking about what our function is supposed to do, we can't get the <code>n</code>th element of an empty list no matter what <code>n</code> is. So we'll need to just call <code>error</code> here.</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; \u03b3\ntaken [] n = error \"Index out of range\"\ntaken (\u03b3:\u03b3s) n = _\n</code></pre>\n\n<p>The second hole is also of type <code>\u03b3</code>, and GHC tells us:</p>\n\n<pre><code>\u2022 Relevant bindings include\n    n :: Int (bound at foo.hs:3:14)\n    \u03b3s :: [\u03b3] (bound at foo.hs:3:10)\n    \u03b3 :: \u03b3 (bound at foo.hs:3:8)\n    taken :: [\u03b3] -&gt; Int -&gt; \u03b3 (bound at foo.hs:2:1)\n</code></pre>\n\n<p>So we can obviously just use <code>\u03b3</code> to appease the type checker, but logically which value we return should depend on <code>n</code>. If we're taking the 0th element of this list, well we've already got the head element decomposed as value <code>\u03b3</code> due to our pattern match, so that'll be correct in that case. Lets try:</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; \u03b3\ntaken [] n = error \"Index out of range\"\ntaken (\u03b3:\u03b3s) n\n  | n == 0    = \u03b3\n  | otherwise = _\n</code></pre>\n\n<p>Which gives us:</p>\n\n<pre><code>foo.hs:5:17: error:\n    \u2022 Found hole: _ :: \u03b3\n      Where: \u2018\u03b3\u2019 is a rigid type variable bound by\n               the type signature for:\n                 taken :: forall \u03b3. [\u03b3] -&gt; Int -&gt; \u03b3\n               at foo.hs:1:1-24\n    \u2022 In the expression: _\n      In an equation for \u2018taken\u2019:\n          taken (\u03b3 : \u03b3s) n\n            | n == 0 = \u03b3\n            | otherwise = _\n    \u2022 Relevant bindings include\n        n :: Int (bound at foo.hs:3:14)\n        \u03b3s :: [\u03b3] (bound at foo.hs:3:10)\n        \u03b3 :: \u03b3 (bound at foo.hs:3:8)\n        taken :: [\u03b3] -&gt; Int -&gt; \u03b3 (bound at foo.hs:2:1)\n  |\n5 |   | otherwise = _\n  |                \n</code></pre>\n\n<p>Same type of hole, same relevant bindings available. But we know that <code>\u03b3</code> isn't the right answer, since we've already handled the case when it is. The answer we <em>do</em> want to return should be somewhere in <code>\u03b3s</code>, and we know we want to write this function recursively, so the obvious thing to do is insert a recursive call:</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; \u03b3\ntaken [] n = error \"Index out of range\"\ntaken (\u03b3:\u03b3s) n\n  | n == 0    = \u03b3\n  | otherwise = taken \u03b3s _\n\nfoo.hs:5:26: error:\n    \u2022 Found hole: _ :: Int\n    \u2022 In the second argument of \u2018taken\u2019, namely \u2018_\u2019\n      In the expression: taken \u03b3s _\n      In an equation for \u2018taken\u2019:\n          taken (\u03b3 : \u03b3s) n\n            | n == 0 = \u03b3\n            | otherwise = taken \u03b3s _\n    \u2022 Relevant bindings include\n        n :: Int (bound at foo.hs:3:14)\n        \u03b3s :: [\u03b3] (bound at foo.hs:3:10)\n        \u03b3 :: \u03b3 (bound at foo.hs:3:8)\n        taken :: [\u03b3] -&gt; Int -&gt; \u03b3 (bound at foo.hs:2:1)\n  |\n5 |   | otherwise = taken \u03b3s _\n  |                 \n</code></pre>\n\n<p>Now we're getting somewhere. The remaining hole is of type <code>Int</code>, and we have <code>n :: Int</code> available. Plugging that straight in is tempting, but doesn't make sense if we stop to think about what we're doing. Taking the <code>n</code>th element of the list <code>(\u03b3:\u03b3s)</code> (which is the result we're supposed to be returning) when <code>n \\= 0</code> should be the same as taking the <code>(n - 1)</code>th element of <code>\u03b3s</code>, so:</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; \u03b3\ntaken [] n = error \"Index out of range\"\ntaken (\u03b3:\u03b3s) n\n  | n == 0    = \u03b3\n  | otherwise = taken \u03b3s (n - 1)\n</code></pre>\n\n<p>No more holes! And this actually works. The only problem is that we don't handle negative values of <code>n</code>. It turns out that's actually sortof okay; for finite lists we eventually run off the end and hit the <code>error \"Index out of range\"</code> case, which is accurate. But it would be nicer to fail before iterating the whole list. So:</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; \u03b3\ntaken [] n = error \"Index out of range\"\ntaken (\u03b3:\u03b3s) n\n  | n == 0    = \u03b3\n  | n &lt; 0     = error \"Negative index\"\n  | otherwise = taken \u03b3s (n - 1)\n</code></pre>\n\n<p>I highly recommend this \"hole driven development\" style (whether you use actual hole syntax and get GHC to typecheck them or just do it yourself as you write the code). Let the structure of the types you're using guide the \"shape\" of the function you're writing (e.g. when writing a function on lists, use a case for <code>[]</code> and a case for <code>(x:xs)</code>), and then fill in the holes one at a time. Sometimes you'l need a different structure than this guides you towards, but very often not, and even when you do having started this approach and found out what the problems are gives you much better information for guessing the right structure.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10107719"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 51434021, "answer_count": 3, "score": 4, "last_activity_date": 1532051767, "creation_date": 1532034425, "question_id": 51431708, "link": "https://stackoverflow.com/questions/51431708/recursive-definition-of-the-function", "title": "Recursive definition of the (!!)-function", "body": "<p>So I tried to build the (!!) function as already defined in GHC.List recursively.\nI want to extract the n-th element of a list and return that.\nHere's what I got first:</p>\n\n<pre><code>taken0 :: [\u03b2] -&gt; Int -&gt; \u03b2 -- but not recursive\n\u03b2s `taken0` 0 = head \u03b2s\n\u03b2s `taken0` n = last (take (n+1) \u03b2s)\n</code></pre>\n\n<p>This worked, but it wasn't recursive...</p>\n\n<p>then I tried the following:</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; \u03b3 -- doesn't compile\ntaken \u03b3s 0 = head \u03b3s\ntaken \u03b3s 1 = head (tail \u03b3s)\ntaken \u03b3s n = head ( tail (takenth \u03b3s (n-1)) )\n</code></pre>\n\n<p>After some fixing I ended up with this:</p>\n\n<pre><code>taken :: [\u03b3] -&gt; Int -&gt; [\u03b3] -- works, but returns a list\ntaken \u03b3s 0 = \u03b3s\ntaken \u03b3s 1 = tail \u03b3s\ntaken \u03b3s n = tail (taken \u03b3s (n-1))\n</code></pre>\n\n<p>Which does indeed compile but is ugly to handle, it returns a list whoose first element is that one \"entered\" by n.</p>\n\n<pre><code>*Main&gt; head ([0,1,2,3,4,5,6,7,8,9] `taken` 0)      returns 0\n*Main&gt; head ([0,1,2,3,4,5,6,7,8,9] `taken` 1)      returns 1\n*Main&gt; head ([0,1,2,3,4,5,6,7,8,9] `taken` 2)      returns 2\netc.\n</code></pre>\n\n<p>Always returns the right (n-th element)\nbut I had to insert head before.</p>\n\n<p>What I want is a function, which, although recursive, returns a single element instead of a list...\nIs there a way to accomplish this without writing another function or using head everytime ?\nlike:</p>\n\n<pre><code>*Main&gt; taken2 [5,8,6,0,2,5,7] 3                    returns 0\n</code></pre>\n\n<p>thanks in advance !</p>\n"}, {"tags": ["performance", "loops", "haskell", "ghc", "compiler-optimization"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 1, "creation_date": 1532034494, "post_id": 51431355, "comment_id": 89834334, "body": "Have you considered checking whether your expectation about what GHC can do is correct? If it isn&#39;t, your <code>iterate</code> version would be generating, matching and collecting billions of elements, which would go a long way towards explaining the difference."}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1532034681, "post_id": 51431355, "comment_id": 89834413, "body": "@thatotherguy Ultimately, I&#39;m fairly sure my expectations about GHC are too high, but I&#39;m fairly sure Haskell&#39;s laziness prevents billions of unnecessary elements being generated in <code>iterate</code> before any are consumed."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1532036087, "post_id": 51431355, "comment_id": 89834961, "body": "It&#39;s fair to assume each <code>iterate</code> would stop after generating no more than 800, but 800*10^7 is still billions."}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1532036434, "post_id": 51431355, "comment_id": 89835108, "body": "I&#39;m struggling to see how that justifies a difference though, since both versions have to make the same number of calculations"}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1532037843, "post_id": 51431355, "comment_id": 89835561, "body": "I&#39;m getting 25s vs 53s for these two implementations. <code>.&#47;foo +RTS -s</code> shows that the fast version has <code>1,200,041,152 bytes allocated on the heap</code> vs <code>151,781,624,928 bytes</code> for the slow one, which does indicate that lists are being generated and searched. Number of arithmetic calculations is often not a good measure of workload due to how cheap they are compared to memory access or branch misprediction or such that CS analysis often considers free"}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1532038287, "post_id": 51431355, "comment_id": 89835671, "body": "Yes, I get similar values for allocation. Ah, I see how number of calculations may not reflect workload. My frustration is more that my understanding of GHC was that it is better at working with implicit recursion, and produces more efficient code when built-in functions are used instead of hand-rolled recursion."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1532039803, "post_id": 51431355, "comment_id": 89836064, "body": "When I add a <code>trace</code> inside <code>collatz</code>, both versions print exactly the same trace and take roughly the same amount of time. I don&#39;t understand why this would make such a difference ..."}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "edited": false, "score": 0, "creation_date": 1532039967, "post_id": 51431355, "comment_id": 89836101, "body": "My suspicion is that values are being allocated in the lists version, but the explicit version is compiled into a tighter loop in machine code yet I don&#39;t see why GHC makes this distinction."}, {"owner": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 0, "creation_date": 1532044867, "post_id": 51431355, "comment_id": 89837249, "body": "I&#39;d expect you&#39;re seeing GHC is only managing to fully unbox the first example, because it&#39;s a simpler structure. Loop fusion isn&#39;t magic unfortunately."}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "reply_to_user": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 0, "creation_date": 1532044927, "post_id": 51431355, "comment_id": 89837266, "body": "@Veedrac This would make sense, is there any nice way I can demonstrate/see this without intuiting it?"}, {"owner": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 0, "creation_date": 1532045131, "post_id": 51431355, "comment_id": 89837314, "body": "@B.Mehta I believe you should look at the Core output; unboxing is denoted with <code>#</code>s. <a href=\"https://wiki.haskell.org/Performance/GHC#Looking_at_the_Core\" rel=\"nofollow noreferrer\">wiki.haskell.org/Performance/GHC#Looking_at_the_Core</a>"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532053140, "post_id": 51431355, "comment_id": 89838713, "body": "Those allocation numbers suggest to me that the list version isn&#39;t fusing the allocations away. That doesn&#39;t really surprise me, to be honest. Not sure <code>elemIndex</code> was ever written to participate in fusion. Regarding your tracing versions taking equal time - they&#39;re probably just both being dominated by the time taken to write to stdout, which is really quite slow."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1532089581, "post_id": 51431355, "comment_id": 89854838, "body": "I am not an expert on GHC but I think <code>elemIndex</code> is been evaluating lazily, that is: <code>GHC</code> is not waiting to <code>take</code> to finish. So for every call of <code>iterate</code> you check if <code>take m</code> can be applied and if <code>elemIndex 1</code> can be apply so that makes code slower. You can check my point executing this lines: <code>elemIndex 10 $ take 100000000000 $ map (+1) [1..]</code> and <code>elemIndex 100000000 $ take 100000000000 $ map (+1) [1..]</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1532094437, "post_id": 51431355, "comment_id": 89857954, "body": "@LuisMorillo sure, but that&#39;s actually a good thing. If it did wait for <code>take</code> to finish then it would have to build up the entire big list in memory. Making this unnecessary is one of the main selling points of laziness. Just, it doesn&#39;t seem to work properly in this case."}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532094664, "post_id": 51431355, "comment_id": 89858094, "body": "@Carl Then I guess my question becomes, why isn&#39;t <code>findIndices</code> (which <code>elemIndex</code> is written in terms of) written to participate in fusion - surely it can be implemented as a zip, filter then map which can all be fused."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532095347, "post_id": 51431355, "comment_id": 89858540, "body": "Hmm.  I traced the actual implementations GHC uses.  Everything in there should in fact be in terms of <code>foldr</code> and <code>build</code>."}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1532095415, "post_id": 51431355, "comment_id": 89858588, "body": "@Carl Right, I don&#39;t fully understand the implementation of <code>findIndices</code> but it does look like it has fusion."}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1532116694, "post_id": 51449149, "comment_id": 89869608, "body": "It&#39;s so rare to see these sorts of questions uncover deficiencies in the language itself. I feel like I&#39;ve glimpsed something under the water of Loch Ness!"}, {"owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "edited": false, "score": 0, "creation_date": 1532129090, "post_id": 51449149, "comment_id": 89873205, "body": "Wow! I expected there was a deficiency in my understanding of fusion for <code>iterate</code>, rather than a missed inlinable."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1532412970, "post_id": 51449149, "comment_id": 89951807, "body": "@AdamSmith but this is not a deficiency in the language, it is merely a deficiency in GHC, a particular Haskell compiler."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1532443504, "post_id": 51449149, "comment_id": 89971337, "body": "@Cactus nitpicks :) But you&#39;re right, GHC /= Haskell, even if it&#39;s easy to see why someone might think it is."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 9, "last_activity_date": 1532115871, "last_edit_date": 1532115871, "creation_date": 1532114643, "answer_id": 51449149, "question_id": 51431355, "link": "https://stackoverflow.com/questions/51431355/haskell-explicit-recursion-vs-iterate/51449149#51449149", "title": "Haskell explicit recursion vs `iterate`", "body": "<p><em>Updated:</em> I submitted <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15426\" rel=\"noreferrer\">Trac 15426</a> for this bug.</p>\n\n<p>The problem disappears if you copy the definitions of <code>elemIndex</code> and <code>findIndex</code> into your module:</p>\n\n<pre><code>import Control.Exception (evaluate)\nimport Control.DeepSeq (rnf)\n\nimport Data.Maybe (listToMaybe)\nimport Data.List (findIndices)\n\nelemIndex       :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int\nelemIndex x     = findIndex (x==)\n\nfindIndex       :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe Int\nfindIndex p     = listToMaybe . findIndices p\n\ncollatz :: Int -&gt; Int\ncollatz n\n  | even n    = n `quot` 2\n  | otherwise = 3 * n + 1\n\nsteps' :: Int -&gt; Int -&gt; Maybe Int\nsteps' m = elemIndex 1 . take m . iterate collatz\n\nmain :: IO ()\nmain = evaluate $ rnf $ map (steps' 800) $ [1..10^7]\n</code></pre>\n\n<p>The problem <em>seems</em> to be that these must be inlinable for GHC to get the fusion right.  Unfortunately, neither of them is marked inlinable in <code>Data.OldList</code>.</p>\n\n<p>The change to allow <code>findIndex</code> to participate in fusion is relatively recent (see <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14387\" rel=\"noreferrer\">Trac 14387</a>) where <code>listToMaybe</code> was reimplemented as a <code>foldr</code>.  So, it probably hasn't seen a lot of testing yet.</p>\n"}], "owner": {"reputation": 445, "user_id": 8325918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d1e006df16aae84a423c8268656e4ba?s=128&d=identicon&r=PG&f=1", "display_name": "B. Mehta", "link": "https://stackoverflow.com/users/8325918/b-mehta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 3, "accepted_answer_id": 51449149, "answer_count": 1, "score": 15, "last_activity_date": 1532186955, "creation_date": 1532032759, "last_edit_date": 1532186955, "question_id": 51431355, "link": "https://stackoverflow.com/questions/51431355/haskell-explicit-recursion-vs-iterate", "title": "Haskell explicit recursion vs `iterate`", "body": "<p>While writing a function using <code>iterate</code> in Haskell, I found that an equivalent version with explicit recursion seemed noticeably faster - even though I believed that explicit recursion ought to be frowned upon in Haskell. </p>\n\n<p>Similarly, I expected GHC to be able to inline/optimise list combinators appropriately so that the resulting machine code is at least similarly performing to the explicit recursion.</p>\n\n<p>Here's a (different) example, which also displays the slowdown I observed. </p>\n\n<p><code>steps m n</code> and its variant <code>steps'</code> compute the number of Collatz steps <code>n</code> takes to reach 1, giving up after <code>m</code> attempts. </p>\n\n<p><code>steps</code> uses explicit recursion while <code>steps'</code> uses list functions.</p>\n\n<pre><code>import Data.List (elemIndex)\nimport Control.Exception (evaluate)\nimport Control.DeepSeq (rnf)\n\ncollatz :: Int -&gt; Int\ncollatz n\n  | even n    = n `quot` 2\n  | otherwise = 3 * n + 1\n\nsteps :: Int -&gt; Int -&gt; Maybe Int\nsteps m = go 0\n  where go k n\n          | n == 1    = Just k\n          | k == m    = Nothing\n          | otherwise = go (k+1) (collatz n)\n\nsteps' :: Int -&gt; Int -&gt; Maybe Int\nsteps' m = elemIndex 1 . take m . iterate collatz\n\nmain :: IO ()\nmain = evaluate $ rnf $ map (steps 800) $ [1..10^7]\n</code></pre>\n\n<p>I tested these by evaluating for all values up to <code>10^7</code>, each giving up after <code>800</code> steps. On my machine (compiled with <code>ghc -O2</code>), explicit recursion took just under 4 seconds (<code>3.899s</code>) but list combinators took about 5 times longer (<code>19.922s</code>).</p>\n\n<p>Why is explicit recursion so much better in this case, and is there a way of writing this without explicit recursion while preserving performance?</p>\n"}, {"tags": ["haskell", "operators", "decimal-point", "function-composition"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 1, "creation_date": 1532030041, "post_id": 51430705, "comment_id": 89832471, "body": "Do you understand how <code>(max 6.7) 8.9</code> works?"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1532030157, "post_id": 51430705, "comment_id": 89832532, "body": "Not quite understand. I know how <code>(max 6) 7</code> works"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1532030286, "post_id": 51430705, "comment_id": 89832573, "body": "@user8314628: the <code>.</code> is <code>6.7</code> is <i>not</i> function composition, it is the decimal dot."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 1, "creation_date": 1532030335, "post_id": 51430705, "comment_id": 89832595, "body": "Ahhh... That was silly-,-"}], "answers": [{"tags": [], "owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "is_accepted": false, "score": 3, "last_activity_date": 1532030233, "creation_date": 1532030233, "answer_id": 51430817, "question_id": 51430705, "link": "https://stackoverflow.com/questions/51430705/how-does-sum-replicate-5-max-6-7-8-9-and-sum-replicate-5-max-6-7-8/51430817#51430817", "title": "How does `sum (replicate 5 (max 6.7 8.9))` and `(sum . replicate 5 . max 6.7) 8.9` get the same result?", "body": "<p><code>max 6.7</code> takes a <code>Double</code> and returns a <code>Double</code>. <code>replicate 5</code> takes a <code>Double</code> and makes a <code>[Double]</code>. <code>sum</code> takes a <code>[Double]</code> and returns something of type <code>Double</code>. (after type inference.)</p>\n\n<p><code>.</code> just chains all of these functions together, so you're left with a function of type <code>Double -&gt; Double</code>. Then you pass <code>8.9</code> to that function.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1532030236, "creation_date": 1532030236, "answer_id": 51430820, "question_id": 51430705, "link": "https://stackoverflow.com/questions/51430705/how-does-sum-replicate-5-max-6-7-8-9-and-sum-replicate-5-max-6-7-8/51430820#51430820", "title": "How does `sum (replicate 5 (max 6.7 8.9))` and `(sum . replicate 5 . max 6.7) 8.9` get the same result?", "body": "<p>If you write <code>f . g</code>, this is basically short for <code>\\x -&gt; f (g x)</code>. Since the <code>(.)</code> operator is right associative your function is equivalent to:</p>\n\n<pre><code>=    (sum . replicate 5 . max 6.7) 8.9\n--------------------------------------\n   (sum . (replicate 5 . max 6.7)) 8.9\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>=                    (sum . (replicate 5 . max 6.7)) 8.9\n--------------------------------------------------------\n   (\\x -&gt; sum ((\\y -&gt; (replicate 5 (max 6.7 y))) x)) 8.9\n</code></pre>\n\n<p>So now if we perform evaluation, we see:</p>\n\n<pre><code>=  (\\x -&gt; sum ((\\y -&gt; (replicate 5 (max 6.7 y))) x)) 8.9\n--------------------------------------------------------\n             sum ((\\y -&gt; (replicate 5 (max 6.7 y))) 8.9)\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>=  sum ((\\y -&gt; (replicate 5 (max 6.7 y))) 8.9)\n----------------------------------------------\n               sum (replicate 5 (max 6.7 8.9))\n</code></pre>\n\n<p>So the function composition will first place the <code>8.9</code> as second parameter of the <code>max</code>, and then apply all other functions to the result in some sort of chain from right-to-left.</p>\n"}, {"tags": [], "owner": {"reputation": 2350, "user_id": 10033674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbU6P.jpg?s=128&g=1", "display_name": "Karol Samborski", "link": "https://stackoverflow.com/users/10033674/karol-samborski"}, "is_accepted": false, "score": 1, "last_activity_date": 1532030555, "creation_date": 1532030555, "answer_id": 51430880, "question_id": 51430705, "link": "https://stackoverflow.com/questions/51430705/how-does-sum-replicate-5-max-6-7-8-9-and-sum-replicate-5-max-6-7-8/51430880#51430880", "title": "How does `sum (replicate 5 (max 6.7 8.9))` and `(sum . replicate 5 . max 6.7) 8.9` get the same result?", "body": "<p>If you understand the part <code>(sum . replicate 5 . max 6.7)</code> then you know that it returns a function that sums the maximum number of 6.7 and given number replicated 5 times. The type of this new function is Float -> Float.</p>\n\n<p>So next we apply 8.9 to this function and we get final value. We can write it in more intuitive way:</p>\n\n<pre><code>mySum :: Float -&gt; Float\nmySum = sum . replicate 5 . max 6.7\n\nresult :: Float\nresult = mySum 8.9\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1532101155, "creation_date": 1532101155, "answer_id": 51446056, "question_id": 51430705, "link": "https://stackoverflow.com/questions/51430705/how-does-sum-replicate-5-max-6-7-8-9-and-sum-replicate-5-max-6-7-8/51446056#51446056", "title": "How does `sum (replicate 5 (max 6.7 8.9))` and `(sum . replicate 5 . max 6.7) 8.9` get the same result?", "body": "<p>Functions in Haskell are curried. A curried function that otherwise takes two parameter values you can use with only one.</p>\n\n<pre><code>f = max 2\nf 3\n</code></pre>\n\n<p>3</p>\n\n<p>When you write <code>max 2 3</code> it is actually translated into (max 2) with a parameter 3, (max 2) 3 is what Haskell is doing anyway.</p>\n\n<p>This lends itself to point-free code. You do not have to specify the final parameter of a function or function composition but do have to supply it when calling the function or functions composition.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 51430820, "answer_count": 4, "score": 1, "last_activity_date": 1532101798, "creation_date": 1532029690, "last_edit_date": 1532101798, "question_id": 51430705, "link": "https://stackoverflow.com/questions/51430705/how-does-sum-replicate-5-max-6-7-8-9-and-sum-replicate-5-max-6-7-8", "title": "How does `sum (replicate 5 (max 6.7 8.9))` and `(sum . replicate 5 . max 6.7) 8.9` get the same result?", "body": "<p>Rewrite <code>(sum . replicate 5 . max 6.7) 8.9</code> using function composition. We have </p>\n\n<p><code>(sum . replicate 5 . max 6.7) 8.9</code></p>\n\n<p>I understand the part <code>(sum . replicate 5 . max 6.7)</code>. But then how does it deal with <code>8.9</code>?</p>\n\n<p><em>edit from comments:</em> turns out, the <code>.</code> in <code>6.7</code> is not a function composition operator, but a decimal dot!</p>\n"}, {"tags": ["haskell", "monads", "persistent"], "comments": [{"owner": {"reputation": 209, "user_id": 7658944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/197708885c5d718abd5711f49b17c6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Robert", "link": "https://stackoverflow.com/users/7658944/robert"}, "edited": false, "score": 0, "creation_date": 1532008316, "post_id": 51424362, "comment_id": 89819846, "body": "Can you post the output of the error?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1532011647, "post_id": 51424362, "comment_id": 89822310, "body": "What&#39;s <code>t</code> when it isn&#39;t a <code>Maybe</code>?  Is it intended to be any <code>Traversable</code>?  If so, then this seems related to <a href=\"https://stackoverflow.com/questions/33189135/compose-nested-monads-in-haskell\" title=\"compose nested monads in haskell\">stackoverflow.com/questions/33189135/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 3, "last_activity_date": 1532018763, "creation_date": 1532018763, "answer_id": 51428011, "question_id": 51424362, "link": "https://stackoverflow.com/questions/51424362/haskells-mapm-when-there-are-3-monadic-results/51428011#51428011", "title": "Haskell&#39;s mapM when there are 3 monadic results", "body": "<p>When you want to flatten several <code>Maybe</code>s, you can use <code>join</code>.  It works for any <code>Monad</code>, but comes up most often for <code>Maybe</code>.</p>\n\n<pre><code>getVehicleDealership :: MonadIO m =&gt; Key Vehicle -&gt; SqlPersistT m (Maybe (Key Dealership))\ngetVehicleDealership vehicleKey =\n    join . fmap (vehicleDealershipId . entityVal) &lt;$&gt; getEntity vehicleKey\n</code></pre>\n\n<p><code>mapM</code> (AKA <code>traverse</code>) is useful in many situations, but I don't think it applies here.  It doesn't matter which order the <code>Maybe</code>s appear, and you want <code>SqlPersistT m (Maybe a)</code>, not <code>Maybe (SqlPersistT m a)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "is_accepted": true, "score": 0, "last_activity_date": 1614947019, "creation_date": 1614947019, "answer_id": 66492556, "question_id": 51424362, "link": "https://stackoverflow.com/questions/51424362/haskells-mapm-when-there-are-3-monadic-results/66492556#66492556", "title": "Haskell&#39;s mapM when there are 3 monadic results", "body": "<p>What I have come to realise now, is that what I wanted here was <code>MaybeT</code>.</p>\n<p>My example can be re-written using <code>MaybeT</code> like so:</p>\n<pre><code>findDealership :: MonadIO m =&gt; Key Vehicle -&gt; SqlPersistT m (Maybe (Entity Dealership))\nfindDealership vehicleKey = runMaybeT $ do\n  dealershipKey &lt;- MaybeT (getVehicleDealership vehicleKey) \n  selectDealership dealershipKey\n\ngetVehicleDealership :: MonadIO m =&gt; Key Vehicle -&gt; SqlPersistT m (Maybe (Key Dealership))\ngetVehicleDealership vehicleKey = runMaybeT $ do\n  vehicleEntity &lt;- MaybeT (getEntity vehicleKey)\n  hoistMaybe $ vehicleDealershipId (entityVal vehicleEntity)\n\nselectDealership :: MonadIO m =&gt; Key Dealership -&gt; SqlPersistT m (Maybe (Entity Dealership))\nselectDealership dealershipKey = \n  selectFirst [DealershipId ==. dealershipKey] []\n</code></pre>\n"}], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 66492556, "answer_count": 2, "score": 1, "last_activity_date": 1614947019, "creation_date": 1532008113, "last_edit_date": 1532009001, "question_id": 51424362, "link": "https://stackoverflow.com/questions/51424362/haskells-mapm-when-there-are-3-monadic-results", "title": "Haskell&#39;s mapM when there are 3 monadic results", "body": "<p>Now and again I keep running into Haskell code where I feel like I should be able to use <code>mapM</code> to make operating over the monads cleaner, but if I have two computations of type <code>m (t a)</code>, and perhaps there is another operation that uses <code>t</code>, something like <code>a -&gt; t a</code> (typically this is <code>Maybe</code>)... say I have this persistent code:</p>\n\n<pre><code>findDealership :: MonadIO m =&gt; Key Vehicle -&gt; SqlPersistT m (Maybe (Entity Dealership))\nfindDealership vehicleKey = mapM selectDealership (getVehicleDealership vehicleKey)\n\ngetVehicleDealership :: MonadIO m =&gt; Key Vehicle -&gt; SqlPersistT m (Maybe (Key Dealership))\ngetVehicleDealership vehicleKey =\n  (\\x -&gt; x &gt;&gt;= vehicleDealershipId . entityVal) &lt;$&gt; getEntity vehicleKey\n\nselectDealership :: MonadIO m =&gt; Key Dealership -&gt; SqlPersistT m (Maybe (Entity Dealership))\nselectDealership dealershipKey = selectFirst [DealershipId ==. dealershipKey] []\n</code></pre>\n\n<p>Where <code>vehicleDealershipId</code> is a field of type <code>Maybe (Key Dealership)</code>, the above code will not compile and I'm unable to work out the right combination of <code>&gt;&gt;=</code>'s and <code>mapM</code>'s.... I feel this problem is a bit like the one <code>mapM</code> is solving, only there is another level of monad in there... you can end up with <code>SqlPersistT m (Maybe (Maybe (Maybe (Key Dealership))))</code> but obviously I need the inner type to be completely flattened...</p>\n\n<p>Error output for the above code:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Control.Monad.Trans.Reader.ReaderT\n                             SqlBackend m0\u2019\n                     with \u2018Maybe\u2019\n      Expected type: SqlPersistT m (Maybe (Entity Dealership))\n        Actual type: Control.Monad.Trans.Reader.ReaderT\n                       SqlBackend\n                       m\n                       (Control.Monad.Trans.Reader.ReaderT\n                          SqlBackend m0 (Maybe (Entity Dealership)))\n    \u2022 In the expression:\n        mapM selectDealership $ getVehicleDealership vehicleKey\n      In an equation for \u2018findDealership\u2019:\n          findDealership vehicleKey\n            = mapM selectDealership $ getVehicleDealership vehicleKey\n   |\n46 | findDealership vehicleKey = mapM selectDealership $ getVehicleDealership vehicleKey\n   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>and: </p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Maybe (Key Dealership)\u2019\n                     with \u2018Key Dealership\u2019\n      Expected type: Control.Monad.Trans.Reader.ReaderT\n                       SqlBackend m0 (Key Dealership)\n        Actual type: SqlPersistT m0 (Maybe (Key Dealership))\n    \u2022 In the second argument of \u2018($)\u2019, namely\n        \u2018getVehicleDealership vehicleKey\u2019\n      In the expression:\n        mapM selectDealership $ getVehicleDealership vehicleKey\n      In an equation for \u2018findDealership\u2019:\n          findDealership vehicleKey\n            = mapM selectDealership $ getVehicleDealership vehicleKey\n   |\n46 | findDealership vehicleKey = mapM selectDealership $ getVehicleDealership vehicleKey\n   |                                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1532000362, "post_id": 51421661, "comment_id": 89814283, "body": "What do you mean? <code>x</code> and <code>xs</code> are simply variables. You could have written <code>xs:x</code> in which case <code>xs</code> is an element, and <code>x</code> the list, or <code>a:z</code>..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1532004336, "post_id": 51421661, "comment_id": 89816929, "body": "Easy: <code>sum&#39;</code> doesn&#39;t have a pattern like <code>x:xs</code>, but <code>foldl</code> does."}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1532000457, "creation_date": 1532000457, "answer_id": 51421777, "question_id": 51421661, "link": "https://stackoverflow.com/questions/51421661/how-does-fold-distinguish-x-from-xs-in-haskell/51421777#51421777", "title": "How does fold distinguish x from xs in Haskell?", "body": "<blockquote>\n  <p>how does the expression <code>acc + x</code> knows that <code>x</code> is the element in <code>xs</code>?</p>\n</blockquote>\n\n<p>It doesn't. It computes a sum of whatever is passed to it.</p>\n\n<p>Note that <code>(\\acc x -&gt; acc + x)</code> can be written simply as <code>(+)</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1532000750, "creation_date": 1532000750, "answer_id": 51421877, "question_id": 51421661, "link": "https://stackoverflow.com/questions/51421661/how-does-fold-distinguish-x-from-xs-in-haskell/51421877#51421877", "title": "How does fold distinguish x from xs in Haskell?", "body": "<blockquote>\n  <p>There is no pattern like <code>x:xs</code>. xs is a list. In the lambda function, how does the expression <code>acc + x</code> knows that <code>x</code> is the element in <code>xs</code>?</p>\n</blockquote>\n\n<p>In Haskell - like in many programming languages - the <strong>name of a variable does not matter</strong>. For Haskell it does not matter if you write <code>xs</code>, or <code>x</code>, or <code>acc</code>, or use another identifier. What matters here is actually the position of the arguments.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:foldl\" rel=\"noreferrer\"><strong><code>foldl :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a</code></strong></a> is a function that takes as input a function with type <code>a -&gt; b -&gt; a</code>, followed by an object of type <code>a</code>, followed by a list of elements of type <code>b</code>, and returns an object of type <code>a</code>.</p>\n\n<p>Semantically the <em>second</em> parameter of the function, will be the elements of the list. If you thus wrote <code>\\x acc -&gt; x + acc</code>, <code>acc</code> would be the eleemnts of the list, and <code>x</code> the accumulator.</p>\n\n<p>The reason why this binds is because <code>foldl</code> is implemented like:</p>\n\n<pre><code>foldl f z [] = z\nfoldl f z (x:xs) = foldl f (f z x) xs\n</code></pre>\n\n<p>It thus is defined itself in Haskell, and thus binds the function to <code>f</code>, the initial element to <code>z</code>, and performs recursion to eventually obtain the result by making a recurslive call where we take the tail of the list, and use <code>(f z x)</code> as new initial value until the list is exhausted.</p>\n\n<p>You can write the sum more elegant as:</p>\n\n<pre><code>sum' :: Num n =&gt; [n] -&gt; n\nsum' = foldl (+) 0\n</code></pre>\n\n<p>so here there are no <em>explicit</em> variables in use at all.</p>\n"}, {"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 2, "last_activity_date": 1532000991, "creation_date": 1532000991, "answer_id": 51421965, "question_id": 51421661, "link": "https://stackoverflow.com/questions/51421661/how-does-fold-distinguish-x-from-xs-in-haskell/51421965#51421965", "title": "How does fold distinguish x from xs in Haskell?", "body": "<p>It doesn't \"know\" anything like that - there's no magic going on here.</p>\n\n<p>The definition of foldl is equivalent to:</p>\n\n<pre><code>foldl f acc (x:xs) = foldl f (f acc x) xs\nfoldl _ acc [] = acc\n</code></pre>\n\n<p>So going through a simple example using your <code>sum'</code> function:</p>\n\n<p>We start with</p>\n\n<pre><code>sum' [1,2,3]\n</code></pre>\n\n<p>substituting the definition of <code>sum'</code> we get</p>\n\n<pre><code>foldl (\\acc x -&gt; acc + x) 0 [1,2,3]\n</code></pre>\n\n<p>substituting the definition of <code>foldl</code> (first case):</p>\n\n<pre><code>foldl (\\acc x -&gt; acc + x) ((\\acc x -&gt; acc + x) 0 1) [2,3]\n</code></pre>\n\n<p>evaluation the function application of your lambda, we get</p>\n\n<pre><code>foldl (\\acc x -&gt; acc + x) (0 + 1) [2,3]\n</code></pre>\n\n<p>substituting foldl again...</p>\n\n<pre><code>foldl (\\acc x -&gt; acc + x) ((\\acc x -&gt; acc + x) (0+1) 2) [3]\n</code></pre>\n\n<p>and evaluating the accumulator:</p>\n\n<pre><code>foldl (\\acc x -&gt; acc + x) ((0 + 1) + 2) [3]\n</code></pre>\n\n<p>and substituting foldl again...</p>\n\n<pre><code>foldl (\\acc x -&gt; acc + x) ((\\acc x -&gt; acc + x) ((0 + 1) + 2) 3) []\n</code></pre>\n\n<p>again, evaluating the accumulator:</p>\n\n<pre><code>foldl (\\acc x -&gt; acc + x) (((0 + 1) + 2) + 3) []\n</code></pre>\n\n<p>now we get to the second (terminating) case of foldl because we apply it to an empty list and are left with only:</p>\n\n<pre><code>(((0 + 1) + 2 ) + 3)\n</code></pre>\n\n<p>which we can of course evaluate to get <code>6</code>.</p>\n\n<p>As you can see, there's no magic involved here: <code>x</code> is just a name you gave to a function argument. You could've named it <code>user8314628</code> instead and it would've worked the same way. What's binding the value of the head of the list to that argument isn't any pattern matching you do yourself, but what <code>foldl</code> actually does with the list.</p>\n\n<p>Note that you can evaluate any haskell expression using this step-by-step process; You usually won't have to, but it's useful to do this a couple of times with functions that do more-or-less complicated things and you are unfamiliar with.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1532036627, "creation_date": 1532036627, "answer_id": 51432145, "question_id": 51421661, "link": "https://stackoverflow.com/questions/51421661/how-does-fold-distinguish-x-from-xs-in-haskell/51432145#51432145", "title": "How does fold distinguish x from xs in Haskell?", "body": "<p>Folds take each consecutive values of the input list while making passing the remainder back to a function transparent. If you were to write your own <code>sum\u2019</code> function, you would have to pass the remainder back to your function. You would also have to pass an <strong>accumulator</strong> back to your own function to keep a running total. Fold does not make explicit the processing of a list by taking the first value and passing the remainder. What it does explicate is the accumulator. It does also have to keep a running total in the case of a sum function. The accumulator is explicit because some recursive functions may do different things with it.   </p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 51421877, "answer_count": 4, "score": 1, "last_activity_date": 1532036627, "creation_date": 1532000122, "question_id": 51421661, "link": "https://stackoverflow.com/questions/51421661/how-does-fold-distinguish-x-from-xs-in-haskell", "title": "How does fold distinguish x from xs in Haskell?", "body": "<pre><code>sum' :: (Num a) =&gt; [a] -&gt; a\nsum' xs = foldl (\\acc x -&gt; acc + x) 0 xs\n</code></pre>\n\n<p>There is no pattern like <code>x:xs</code>. <code>xs</code> is a list. In the lambda function, how does the expression <code>acc + x</code> knows that <code>x</code> is the element in <code>xs</code>?</p>\n"}, {"tags": ["haskell", "types", "monad-transformers"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1532000137, "post_id": 51420350, "comment_id": 89814119, "body": "Please avoid complexity that&#39;s not relevant to the question (do you need <code>ProcExecCtxt</code> here?). Also add, references to what <code>Reader</code>, <code>Stream</code> and <code>Of</code> are."}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 0, "last_activity_date": 1532003299, "last_edit_date": 1532003299, "creation_date": 1532000436, "answer_id": 51421766, "question_id": 51420350, "link": "https://stackoverflow.com/questions/51420350/building-a-monad-around-streaming-reader/51421766#51421766", "title": "Building a monad around Streaming &amp; Reader", "body": "<p><a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Compose</code></a> implements your <code>Functor</code> and <code>Applicative</code> instances.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Reader.html\" rel=\"nofollow noreferrer\"><code>ReaderT</code></a> implements a <code>Monad</code> instance for you.</p>\n"}, {"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1532032488, "post_id": 51428588, "comment_id": 89833502, "body": "uh, wow, and thank you.  So indeed, the use of ReaderT is the key here; I had actually started with a ReaderT, but removed it at one point as I felt it was adding complexity and obscuring what I needed to do.  I think I kindof understand now why that was wrong, but I&#39;ll need to stare at it for a bit.  Many thanks for the help, @dfeuer."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1532071296, "post_id": 51428588, "comment_id": 89844151, "body": "For the record, I needed to use <code>CmdY . lift . lift</code> to create the MonadTrans instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1532088504, "post_id": 51428588, "comment_id": 89854179, "body": "@user3416536, thanks for the correction. I&#39;ve edited my answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1532101563, "post_id": 51428588, "comment_id": 89862505, "body": "@user3416536, one way to think about it: monads don&#39;t compose in general, so there&#39;s no <i>systematic</i> way to write a <code>Monad</code> instance for something like <code>Reader e . m</code>--we&#39;d have to break open the <code>Reader</code> and work with its guts. Monad transformers, however, <i>do</i> compose in general, so we can systematically write a <code>Monad</code> instance for <code>(ReaderT e . Stream f) m</code> with no need to dig into the detailed mechanics of either transformer."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1532088819, "last_edit_date": 1532088819, "creation_date": 1532020956, "answer_id": 51428588, "question_id": 51420350, "link": "https://stackoverflow.com/questions/51420350/building-a-monad-around-streaming-reader/51428588#51428588", "title": "Building a monad around Streaming &amp; Reader", "body": "<pre><code>Reader \u03c1 (Stream (Of CmdSpec) \u03b7 \u03c9)\n</code></pre>\n\n<p>is really just</p>\n\n<pre><code> \u03c1 -&gt; Stream (Of CmdSpec) \u03b7 \u03c9\n</code></pre>\n\n<p>There's a third way to spell that type that probably makes more sense in this context:</p>\n\n<pre><code>ReaderT \u03c1 (Stream (Of CmdSpec) \u03b7) \u03c9\n</code></pre>\n\n<p>using <code>Control.Monad.Trans.Reader.ReaderT</code> (also exported by <code>Control.Monad.Reader</code>), a monad transformer defined</p>\n\n<pre><code>newtype ReaderT e m a = ReaderT\n  { runReaderT :: e -&gt; m a }\n</code></pre>\n\n<p>Since <code>ReaderT e</code> is a monad transformer, <code>ReaderT e m</code> is a monad whenever <code>m</code> is. Therefore, it will provide all the instances you want for free, and a couple more. Indeed, using</p>\n\n<pre><code>{-# language GeneralizedNewtypeDeriving #-}\n</code></pre>\n\n<p>you can write</p>\n\n<pre><code>newtype CmdY \u03c1 \u03b7 \u03c9 = CmdY\n  { unCmdY :: ReaderT \u03c1 (Stream (Of CmdSpec) \u03b7) \u03c9 }\n  deriving (Functor, Applicative, Monad\n           , Alternative, MonadPlus, MonadReader \u03c1)\n</code></pre>\n\n<p>Or, if you like, you can define the instances manually by wrapping and unwrapping <code>CmdY</code>:</p>\n\n<pre><code>instance Monad \u03b7 =&gt; Functor (CmdY \u03c1 \u03b7) where\n  fmap f (CmdY m) = CmdY (fmap f m)\n\ninstance Monad \u03b7 =&gt; Applicative (CmdY \u03c1 \u03b7) where\n  pure = CmdY . pure\n  CmdY fs &lt;*&gt; CmdY xs = CmdY (fs &lt;*&gt; xs)\n\ninstance Monad \u03b7 =&gt; Monad (CmdY \u03c1 \u03b7) where\n  CmdY m &gt;&gt;= f = CmdY $ m &gt;&gt;= unCmdY . f\n</code></pre>\n\n<p><code>CmdY \u03c1</code> is itself a monad transformer:</p>\n\n<pre><code>import Control.Monad.Trans.Class\n\ninstance MonadTrans (CmdY \u03c1) where\n  lift = CmdY . lift . lift\n</code></pre>\n"}], "owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 51428588, "answer_count": 2, "score": 1, "last_activity_date": 1532088819, "creation_date": 1531996265, "last_edit_date": 1532021665, "question_id": 51420350, "link": "https://stackoverflow.com/questions/51420350/building-a-monad-around-streaming-reader", "title": "Building a monad around Streaming &amp; Reader", "body": "<p>I am trying to build a <code>Monad</code> instance of the following type: </p>\n\n<pre><code>data CmdY \u03c1 \u03b7 \u03c9 = CmdY (Reader \u03c1 ((Stream (Of CmdSpec) \u03b7 \u03c9)))\n</code></pre>\n\n<p>where <code>Stream</code> and <code>Of</code> come from <code>Streaming</code> in the <code>streaming</code> package.</p>\n\n<p>I have successfully written <code>Functor</code> <code>Applicative</code> instances:</p>\n\n<pre><code>instance (Monad \u03b7) =&gt; Functor (CmdY \u03c1 \u03b7) where\n  fmap :: (\u03b1 -&gt; \u03b2) -&gt; CmdY \u03c1 \u03b7 \u03b1 -&gt; CmdY \u03c1 \u03b7 \u03b2\n  fmap f (CmdY a) = CmdY $ (fmap f) &lt;$&gt; a\n\ninstance (Monad \u03b7) =&gt; Applicative (CmdY \u03c1 \u03b7) where\n  pure    = CmdY . pure . return\n\n  (&lt;*&gt;) :: CmdY \u03c1 \u03b7 (\u03b1 -&gt; \u03b2) -&gt; CmdY \u03c1 \u03b7 \u03b1 -&gt; CmdY \u03c1 \u03b7 \u03b2\n  (CmdY f) &lt;*&gt; (CmdY a) = let ff = (&lt;*&gt;) &lt;$&gt; f\n                           in CmdY $ ff &lt;*&gt; a\n</code></pre>\n\n<p>But I'm going round in circles trying to implement the bind <code>(&gt;&gt;=)</code> of the Monad.</p>\n\n<p>I have a function to evaluate a CmdY and give me a stream &amp; result:</p>\n\n<pre><code>runCmdY :: (MonadIO \u03b7, MonadIO \u03bc, MonadReader (ProcExecCtxt \u03bc) \u03c8) =&gt;\n           CmdY (ProcExecCtxt \u03bc) \u03b7 \u03c9 -&gt; \u03c8 (Stream (Of CmdSpec) \u03b7 \u03c9)\n</code></pre>\n\n<p>But given a bind of the form <code>a &gt;&gt;= f</code>, a is of type <code>CmdY (ProcExecCtxt \u03b7) \u03b7 \u03b1</code> while f is of type <code>\u03b1 -&gt; CmdY (ProcExecCtxt \u03b7) \u03b7 \u03b2</code>, I need to get something of type \u03b1 to feed to my f, and I am failing to get there.</p>\n\n<p><code>ProcExecCtxt m</code> here is an execution context; it provides a means to evaluate cmds within the monad m.</p>\n\n<p>I'm sure I'm missing something obvious (or at least, I'm hoping it will be obvious once I see it); but I'd grateful for any pointers.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell", "continuous-integration", "automated-tests", "hspec"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1531994381, "post_id": 51419606, "comment_id": 89810260, "body": "Hm, one idea that just sprung to my mind was to run CI formatter in CI, and stdio formatter in stdio. That sounds like a plausible workaround."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 0, "last_activity_date": 1532072585, "creation_date": 1532072585, "answer_id": 51437547, "question_id": 51419606, "link": "https://stackoverflow.com/questions/51419606/how-can-i-log-hspec-test-output-through-two-formatters-simultaneously/51437547#51437547", "title": "How can I log HSpec test output through two formatters simultaneously?", "body": "<p>In the end I've decided that it's not worth the effort, but I did make a working PoC of the workaround:</p>\n\n<pre><code>hspecCi :: String -&gt; Spec -&gt; IO ()\nhspecCi filename spec = do\n    isCiBuild &lt;- (== \"true\") &lt;$&gt; getEnv \"CI\" `catch` \\(e :: SomeException) -&gt; return \"\"\n\n    let ciConfig = defaultConfig\n                 { configFormatter = Just xmlFormatter\n                 , configOutputFile = Right $ testResultsPath ++ filename ++ \"/results.xml\"\n                 }\n\n    hspecWith (if isCiBuild then ciConfig else defaultConfig) spec\n</code></pre>\n\n<p>This will run stdio output in local builds and XML in CI. Not too hard to write, but maybe it'll help someone. <code>xmlFormatter</code> is something you need to get from somewhere or write yourself.</p>\n"}], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532072585, "creation_date": 1531994149, "question_id": 51419606, "link": "https://stackoverflow.com/questions/51419606/how-can-i-log-hspec-test-output-through-two-formatters-simultaneously", "title": "How can I log HSpec test output through two formatters simultaneously?", "body": "<p>I run my HSpec tests both locally and in the CI. The default <code>specdoc</code> formatter produces nice, colored stdio output. However, for the CI, I need the results in the XML format so that they can be presented on the web.</p>\n\n<p>I added my XML format to the HSpec config, but that disabled the stdio output altogether. I've tried hacking the formatter so that it ran both formatting commands, but that just resulted in an XML file with mixed text and XML messages (since there's only one <code>configOutputFile</code> option).</p>\n\n<p>A few options at this point are:</p>\n\n<ul>\n<li>To run the tests twice, once with each formatter</li>\n<li>To run the tests with <code>silent</code> formatter and then somehow try to run the fomatters on the results.</li>\n<li>To hack my formatter output so that e.g. some commands go straight to stdio.</li>\n</ul>\n\n<p>Neither of those sound particularly easy and straightforward. Is there a better way? Being able to use just one Formatter at once sounds like a rather annoying limitation.</p>\n"}, {"tags": ["haskell", "compilation", "ghc", "hint", "ghc-api"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1531985361, "post_id": 51414366, "comment_id": 89804602, "body": "For efficiency, I suppose?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1531986454, "post_id": 51414366, "comment_id": 89805240, "body": "You appear to be asking for a way to write a compiler. I hope you understand that this is <i>quite</i> difficult. Do you mean to find a way to use GHC to compile your <code>.bf</code> files?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1531986900, "post_id": 51414366, "comment_id": 89805515, "body": "Saving the IO action, if it were possible, would essentially reduce to saving the BF source code along with the interpreter. This would result into a quite trivial compiler (at least without a serious partial evaluator, which is not available at the moment, AFAIK). Since the interpreter part is fixed, it looks much simpler to save only the source code -- essentially avoiding the compilation step. If you want  real compilation you probably need to write a real compiler."}], "answers": [{"comments": [{"owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 0, "creation_date": 1531986293, "post_id": 51414417, "comment_id": 89805143, "body": "Thanks for your answer. I realized that I oversimplified my question because this answers correctly, but is not what I wanted. Please see the edit."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 0, "creation_date": 1532005170, "post_id": 51414417, "comment_id": 89817503, "body": "@firefrorefiddle Is this one more what you had in mind?"}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1532006259, "last_edit_date": 1532006259, "creation_date": 1531974914, "answer_id": 51414417, "question_id": 51414366, "link": "https://stackoverflow.com/questions/51414366/haskell-can-a-function-be-compiled/51414417#51414417", "title": "Haskell: Can a function be compiled?", "body": "<p>I\u2019m not sure whether you\u2019re asking how you write a compiler that can take as its input a file such as <code>helloworld.bf</code>, or how you compile a Haskell program that runs <code>helloworld.bf</code>.</p>\n\n<p>In the former case, you would want something a little more fleshed out than this:</p>\n\n<pre><code>import System.Environment (getArgs)\n\nmain :: IO ()\nmain = do\n  (_:fileName:_) &lt;- getArgs\n  source &lt;- readFile fileName\n  interpret source\n\ninterpret :: String -&gt; IO ()\ninterpret = undefined -- You can fill in this piddly little detail yourself.\n</code></pre>\n\n<p>If you want the latter, there are a few different options.  First, you can store the contents of your <code>*.bf</code> file in a string constant (or bettter yet, a <code>Text</code> or strict <code>ByteString</code>), and pass that to your interpreter function.  I\u2019d be surprised if GHC is optimistic enough to fully inline and expand that call at compile time, but in principle a Haskell compiler could.</p>\n\n<p>The second is to turn Brainfuck into a domain-specific language with operators you define, so that you can actually write something like</p>\n\n<pre><code>interpret [^&lt;,^+,^&gt;,^.]\n</code></pre>\n\n<p>If you define <code>(^&lt;)</code> and the other operators, the Brainfuck commands will compile to bytecode representing the Brainfuck program. </p>\n\n<p>In this case, there isn\u2019t an obvious benefit over the first approach, but with a more structured language, you can do an optimization pass, compile the source to stack-based bytecode more suitable for an interpreter to execute, or generate a more complex AST.</p>\n\n<p>You might also express this idea as</p>\n\n<pre><code>interpret\n  (^&lt; ^+ ^&gt; ^.)\n  input\n</code></pre>\n\n<p>Here, if the Brainfuck commands are higher-order functions with right-to-left precedence, and <code>interpret bf input = (bf begin) input</code>, the Brainfuck code would simply compile to a function that the interpreter calls.  This has the best chance of being turned into fast native code.</p>\n\n<h2>Previous Answer</h2>\n\n<p>In certain cases, a compiler can inline a function call (there are pragmas in GHC to tell it to do this).  The compiler is also more likely to do what you want if you name the closure, such as:</p>\n\n<pre><code>main = interpret foo\n</code></pre>\n\n<p>In GHC, you can give the compiler a hint by adding</p>\n\n<pre><code>{-# INLINE main #-}\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>{-# INLINE interpret #-}\n</code></pre>\n\n<p>You can check what code GHC generated by compiling the module with <code>-S</code> and looking through the source.</p>\n"}, {"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 2, "last_activity_date": 1531990023, "creation_date": 1531990023, "answer_id": 51418178, "question_id": 51414366, "link": "https://stackoverflow.com/questions/51414366/haskell-can-a-function-be-compiled/51418178#51418178", "title": "Haskell: Can a function be compiled?", "body": "<p>The answer is basically no.</p>\n\n<p>There are many ways to construct <code>IO</code> values:</p>\n\n<ol>\n<li>Built in functions like <code>putStrLn</code></li>\n<li>Monad operations like <code>return</code> or <code>&gt;&gt;=</code></li>\n</ol>\n\n<p>Once you have an IO value there are three ways to break it down:</p>\n\n<ol>\n<li>Set <code>main</code> equal to the value</li>\n<li><code>unsafePerformIO</code></li>\n<li>As the return value of an exported C function</li>\n</ol>\n\n<p>All of these break down into converting an <code>IO a</code> into an <code>a</code>. There is no other way to inspect it to see what it does.</p>\n\n<p>Similarly the only thing you can do with functions is put them in variables or call them (or convert them to C function pointers).</p>\n\n<p>There is no sane way to otherwise inspect a function.</p>\n\n<p>One thing you could do which isn\u2019t compiling but is linking is to have your interpreter main function run on some external c string, build that into a static object, and then your \u201ccompiler\u201d could make a new object with this C string of the program in it and link that to what you already have.</p>\n\n<hr>\n\n<p>There is this theory of partial evaluation that says that if you do partial evaluation of a partial evaluator applied to an interpreter applied to some input then what you get is a compiler but ghc is not a sufficiently advanced partial evaluator.</p>\n"}], "owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 51418178, "answer_count": 2, "score": 0, "last_activity_date": 1532006259, "creation_date": 1531974592, "last_edit_date": 1531986231, "question_id": 51414366, "link": "https://stackoverflow.com/questions/51414366/haskell-can-a-function-be-compiled", "title": "Haskell: Can a function be compiled?", "body": "<p>Consider a simple Haskell <a href=\"https://en.wikipedia.org/wiki/Brainfuck\" rel=\"nofollow noreferrer\">Brainf*ck</a> interpreter. Just look at the <code>interpret</code> function.</p>\n\n<pre><code>import Prelude hiding (Either(..))\nimport Control.Monad\nimport Data.Char (ord, chr)\n\n-- function in question\ninterpret :: String -&gt; IO ()\ninterpret strprog = let (prog, []) = parse strprog\n                    in execBF prog\n\n\ninterpretFile :: FilePath -&gt; IO ()\ninterpretFile fp = readFile fp &gt;&gt;= interpret\n\n\ntype BF = [BFInstr]\ndata BFInstr = Left | Right | Inc | Dec | Input | Output | Loop BF\n\ntype Tape = ([Integer], [Integer])\n\nemptyTape = (repeat 0, repeat 0)\n\nexecBFTape :: Tape -&gt; BF -&gt; IO Tape\nexecBFTape = foldM doBF\n\nexecBF :: BF -&gt; IO ()\nexecBF prog = do\n  execBFTape emptyTape prog\n  return ()\n\ndoBF :: Tape -&gt; BFInstr -&gt; IO Tape\ndoBF ((x:lefts),   rights)   Left     = return (lefts,         x:rights)\ndoBF (lefts,    (x:rights))  Right    = return (x:lefts,         rights)\ndoBF (left,     (x:rights))  Inc      = return (left,      (x+1):rights)\ndoBF (left,     (x:rights))  Dec      = return (left,      (x-1):rights)\ndoBF (left,     (_:rights))  Input    = getChar &gt;&gt;= \\c -&gt; return (left, fromIntegral (ord c):rights)\ndoBF t@(_,      (x:     _))  Output   = putChar (chr (fromIntegral x)) &gt;&gt; return t\ndoBF t@(left,   (x:     _)) (Loop bf) = if x == 0\n                                        then return t\n                                        else do t' &lt;- execBFTape t bf\n                                                doBF t' (Loop bf)\n\nsimpleCommands = [('&lt;', Left),\n                  ('&gt;', Right),\n                  (',', Input),\n                  ('.', Output),\n                  ('+', Inc),\n                  ('-', Dec)]\n\nparse :: String -&gt; (BF, String)\nparse []          = ([], [])\nparse (char:prog) = case lookup char simpleCommands of\n                      Just command -&gt; let (rest, prog') = parse prog\n                                      in (command : rest, prog')\n                      Nothing      -&gt;\n                        case char of\n                          ']' -&gt; ([], prog)\n                          '[' -&gt; let (loop, prog')  = parse prog\n                                     (rest, prog'') = parse prog'\n                                 in (Loop loop:rest, prog'')\n                          _   -&gt; parse prog\n</code></pre>\n\n<p>So I have a function applied like <code>interpret \"[-&gt;+&lt;]\"</code>. This gives me an <code>IO ()</code> monadic action which executes the given program. It has the right type to be a <code>main</code> of some program.</p>\n\n<p>Let's say I would like to have this action compiled to an executable, that is, I would like to generate an executable file with the result of <code>interpret ...</code> to be the main function. Of course, this executable would have to contain the GHC runtime system (for infinite lists, integer arithmetic etc.).</p>\n\n<p>Questions:</p>\n\n<ol>\n<li>It is my opinion that it is not possible at all to just take the monadic action and save it to be a new file. Is this true?</li>\n<li>How could one go about reaching a comparable solution? Do the GHC Api and <a href=\"http://hackage.haskell.org/package/hint\" rel=\"nofollow noreferrer\">hint</a> help?</li>\n</ol>\n\n<p><strong>EDIT</strong></p>\n\n<p>Sorry, I oversimplified in the original question. Of course, I can just write a file like this:</p>\n\n<pre><code>main = interpret \"...\"\n</code></pre>\n\n<p>But this is not what we usually do when we try to compile something, so consider <code>interpretFile :: FilePath -&gt; IO ()</code> instead. Let the BF program be saved in a file (<code>helloworld.bf</code>).</p>\n\n<p>How would I go about creating an executable which executes the contents of <code>helloworld.bf</code> without actually needing the file?</p>\n\n<pre><code>$ ./MyBfCompiler helloworld.bf -o helloworld\n</code></pre>\n"}]