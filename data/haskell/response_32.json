[{"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 771, "user_id": 2056507, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/219495fc4a1c75c27711864d5f14287a?s=128&d=identicon&r=PG", "display_name": "George Madrid", "link": "https://stackoverflow.com/users/2056507/george-madrid"}, "edited": false, "score": 0, "creation_date": 1440036816, "post_id": 32108041, "comment_id": 52111118, "body": "Fantastic. Excellent explanation with extras. Thanks. You&#39;ve helped my learning as well as answering my question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440039211, "post_id": 32108041, "comment_id": 52111683, "body": "I&#39;m pretty sure <code>EitherT</code> crept in by mistake."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440040891, "post_id": 32108041, "comment_id": 52112045, "body": "@dfeuer Thanks! I had a feeling that would happen. If only that were the actual name..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440045004, "post_id": 32108041, "comment_id": 52113057, "body": "How did we end up with a name that wasn&#39;t that?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1440054134, "post_id": 32108041, "comment_id": 52116440, "body": "<a href=\"https://hackage.haskell.org/package/either/docs/Control-Monad-Trans-Either.html\" rel=\"nofollow noreferrer\"><code>EitherT</code></a>"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 5, "last_activity_date": 1440040874, "last_edit_date": 1440040874, "creation_date": 1440033314, "answer_id": 32108041, "question_id": 32106814, "link": "https://stackoverflow.com/questions/32106814/moving-statet-into-and-out-of-io/32108041#32108041", "title": "Moving StateT into and out of IO", "body": "<p>You're close. Let's follow the types with type holes (<code>_</code>s):</p>\n\n<pre><code>impuree :: String -&gt; PlayMIO String\nimpuree s = do\n  a &lt;- _ . runIdentity . runExceptT $ puree s\n  return $ \"aa\" ++ a\n</code></pre>\n\n<p>This tells us we need a type:</p>\n\n<pre><code>Test.hs:15:8:\n    Found hole \u2018_\u2019\n      with type: m0 (Either String String) -&gt; ExceptT String IO [Char]\n    Where: \u2018m0\u2019 is an ambiguous type variable\n    Relevant bindings include\n      s :: String (bound at Test.hs:13:9)\n      impuree :: String -&gt; PlayMIO String (bound at Test.hs:13:1)\n    In the first argument of \u2018(.)\u2019, namely \u2018_\u2019\n    In the expression: _ . return . runIdentity . runExceptT\n    In a stmt of a 'do' block:\n      a &lt;- _ . return . runIdentity . runExceptT $ puree s\n</code></pre>\n\n<p>Now, we have something that can turn a <code>m (Either e b)</code> into an <code>ExceptT e m b</code>:</p>\n\n<pre><code>ExceptT :: m (Either e b) -&gt; ExceptT e m b\n</code></pre>\n\n<p>Applying that, we get the correct answer:</p>\n\n<pre><code>impuree :: String -&gt; PlayMIO String\nimpuree s = do\n  a &lt;- ExceptT . return . runIdentity . runExceptT $ puree s\n  return $ \"aa\" ++ a\n</code></pre>\n\n<p>If we look at the docs, we can see that the pattern <code>ExceptT . f . runExceptT</code> is abstracted with the function</p>\n\n<pre><code>mapExceptT :: (m (Either e a) -&gt; n (Either e' b)) -&gt; ExceptT e m a -&gt; ExceptT e' n b\n</code></pre>\n\n<p>In our case, the <code>m</code> is <code>Identity</code> and the <code>n</code> is <code>IO</code>. Using this, we get:</p>\n\n<pre><code>impuree :: String -&gt; PlayMIO String\nimpuree s = do\n  a &lt;- mapExceptT (return . runIdentity) $ puree s\n  return $ \"aa\" ++ a\n</code></pre>\n\n<h2>Abstracting the pattern</h2>\n\n<p>This would probably be overkill here, but it is worth noting that there is a package called <a href=\"http://hackage.haskell.org/package/mmorph\" rel=\"nofollow\"><code>mmorph</code></a> which makes it nicer to work with monad morphisms (transformations from one monad to another). This package has a function <a href=\"http://hackage.haskell.org/package/mmorph-1.0.4/docs/Control-Monad-Morph.html#v:generalize\" rel=\"nofollow\"><code>generalize :: Monad m =&gt; Identity a -&gt; m a</code></a> which we can use:</p>\n\n<pre><code>impuree :: String -&gt; PlayMIO String\nimpuree s = do\n  a &lt;- mapExceptT generalize $ puree s\n  return $ \"aa\" ++ a\n</code></pre>\n\n<h2>A further generalization</h2>\n\n<p>While we're talking about <code>mmorph</code>, we may as well use the more general form:</p>\n\n<pre><code>impuree :: String -&gt; PlayMIO String\nimpuree s = do\n  a &lt;- hoist generalize $ puree s\n  return $ \"aa\" ++ a\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/mmorph-1.0.4/docs/Control-Monad-Morph.html#v:hoist\" rel=\"nofollow\"><code>hoist</code></a> generalizes <code>mapExceptT</code> to any monad transformer-like thing where you can apply a monad morphism to the underlying monad:</p>\n\n<pre><code>hoist :: (MFunctor t, Monad m) =&gt; (forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b\n</code></pre>\n\n<p>Everything after the first correct answer here is just bonus stuff and it isn't necessary to understand it in order to understand and use the solution. It could come in handy at some point though, which is why I included it. Recognizing the general pattern of monad morphisms saves time, but you can always do things more explicitly without that additional level of abstraction.</p>\n"}, {"comments": [{"owner": {"reputation": 771, "user_id": 2056507, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/219495fc4a1c75c27711864d5f14287a?s=128&d=identicon&r=PG", "display_name": "George Madrid", "link": "https://stackoverflow.com/users/2056507/george-madrid"}, "edited": false, "score": 0, "creation_date": 1440167288, "post_id": 32109389, "comment_id": 52175193, "body": "Thanks. This is a great response, too, and educational for me.  It looks like I need FlexibleContexts in order to put &quot;MonadError String m&quot; into the context of puree? Any downside to that?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 771, "user_id": 2056507, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/219495fc4a1c75c27711864d5f14287a?s=128&d=identicon&r=PG", "display_name": "George Madrid", "link": "https://stackoverflow.com/users/2056507/george-madrid"}, "edited": false, "score": 0, "creation_date": 1440172878, "post_id": 32109389, "comment_id": 52178852, "body": "@GeorgeMadrid Practically speaking, there&#39;s no downside. Hypothetically, this would rule out using your code with compilers that don&#39;t support that extension; since GHC is such a powerhouse in the Haskell compiler domain, I wouldn&#39;t worry about that unless you&#39;re already planning to use a niche compiler. There aren&#39;t many technical downsides, either: the restrictions that extension relaxes were put in place to make language implementation easier before it was really known how feasible typeclasses were as a language feature at all. With what we know now I think different choices would be made."}, {"owner": {"reputation": 771, "user_id": 2056507, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/219495fc4a1c75c27711864d5f14287a?s=128&d=identicon&r=PG", "display_name": "George Madrid", "link": "https://stackoverflow.com/users/2056507/george-madrid"}, "edited": false, "score": 0, "creation_date": 1440173342, "post_id": 32109389, "comment_id": 52179129, "body": "I am fascinated with how quickly the understanding of functional programming in general and Haskell in particular are changing. Any book you read is already out of date. And I am amazed at the power of the Haskell type inference engine and how it is more that a convenience. I&#39;m learning that it is a fundamental tool of working with Haskell. Thanks again."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1440043614, "creation_date": 1440043614, "answer_id": 32109389, "question_id": 32106814, "link": "https://stackoverflow.com/questions/32106814/moving-statet-into-and-out-of-io/32109389#32109389", "title": "Moving StateT into and out of IO", "body": "<p>An alternate approach is to simply make your <code>puree</code> and <code>impuree</code> operations type-class polymorphic. This is the usual <code>mtl</code> way: require some classes, then somewhere at the top-level pick a concrete monad that instantiates all the appropriate classes. Thus:</p>\n\n<pre><code>import Control.Monad.Except\nimport Control.Monad.Identity\n\ntype PlayM = Except String \ntype PlayMIO = ExceptT String IO\n\npuree :: Monad m =&gt; String -&gt; m String\npuree = return . (\"bb\"++)\n\nimpuree :: Monad m =&gt; String -&gt; m String\nimpuree s = do\n  a &lt;- puree s\n  return $ \"aa\" ++ a\n\nmain = do\n  runExceptT $ impuree \"foo\"\n  putStrLn \"hi\"\n</code></pre>\n\n<p>In this example, your code is especially uninteresting, because you didn't use any of the special powers of <code>IO</code> or <code>ExceptT</code>. Here's how it might look if you had:</p>\n\n<pre><code>-- in particular, puree :: String -&gt; PlayM String\npuree :: MonadError String m =&gt; String -&gt; m String\npuree \"heck\" = throwError \"Watch your language!\"\npuree s = return (\"bb\" ++ s)\n\n-- in particular, impuree :: String -&gt; PlayMIO String\nimpuree :: (MonadError String m, MonadIO m) =&gt; String -&gt; m String\nimpuree s = do\n  s' &lt;- puree s\n  liftIO . putStrLn $ \"hah! what kind of input is \" ++ s ++ \"?!\"\n  return (\"aa\" ++ s)\n\nmain = do\n  runExceptT (impuree \"foo\")\n  putStrLn \"hi\"\n</code></pre>\n"}], "owner": {"reputation": 771, "user_id": 2056507, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/219495fc4a1c75c27711864d5f14287a?s=128&d=identicon&r=PG", "display_name": "George Madrid", "link": "https://stackoverflow.com/users/2056507/george-madrid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 32109389, "answer_count": 2, "score": 4, "last_activity_date": 1440043614, "creation_date": 1440024141, "question_id": 32106814, "link": "https://stackoverflow.com/questions/32106814/moving-statet-into-and-out-of-io", "title": "Moving StateT into and out of IO", "body": "<p>I'm sure I must be missing something.</p>\n\n<p>I'm new to Haskell and the curve is very steep. I'm reaching the point in my toy project where I really want to use a State monad to avoid passing a thousand arguments everywhere. I'm having trouble understanding how to pass that State monad from IO into pure code. Something conceptually like this (except with StateT instead of ExceptT):</p>\n\n<pre><code>import Control.Monad.Except\nimport Control.Monad.Identity\n\ntype PlayM = Except String \ntype PlayMIO = ExceptT String IO\n\npuree :: String -&gt; PlayM String\npuree = return . (\"bb\"++)\n\nimpuree :: String -&gt; PlayMIO String\nimpuree s = do\n  a &lt;- return $ runIdentity $ runExceptT $ puree s\n  return $ \"aa\" ++ a\n\nmain = do\n  runExceptT $ impuree \"foo\"\n  putStrLn \"hi\"\n</code></pre>\n\n<p>except this doesn't compile, giving me something like this:</p>\n\n<pre><code>play.hs:15:20:\nCouldn't match expected type \u2018[Char]\u2019\n            with actual type \u2018Either String String\u2019\nIn the second argument of \u2018(++)\u2019, namely \u2018a\u2019\nIn the second argument of \u2018($)\u2019, namely \u2018\"aa\" ++ a\u2019\n</code></pre>\n\n<p>I understand now why this doesn't compile and why the types are what they are, but for the life of me, I cannot understand how to do this. This feels like it shouldn't be hard, but my intuition in Haskell is far from accurate. </p>\n\n<p>Thanks for your help!</p>\n\n<p>-g</p>\n"}, {"tags": ["haskell", "category-theory", "type-theory", "type-kinds", "polykinds"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 4, "creation_date": 1440022931, "post_id": 32106435, "comment_id": 52107728, "body": "<code>type Const3 a b c = Compose (Const a) (Const b) c</code> ? As the <code>but \u2018Const\u2019 has kind \u2018* -&gt; * -&gt; *\u2019</code> message implies, you need to supply one type to the type constructor to arrive at the kind expected by <code>Compose</code>."}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1440033678, "post_id": 32106834, "comment_id": 52110336, "body": "I think it&#39;s <code>Const</code> that&#39;s the hardest problem here, not <code>Compose</code>. Specifically, in the wanted expansion <code>Const (Const a) b c</code>, the first <code>Const</code> needs to have kind <code>(* -&gt; *) -&gt; * -&gt; * -&gt; *</code> and the second needs to have kind <code>* -&gt; * -&gt; *</code>, different number of arguments, so they cannot be a common <code>newtype</code> either."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1440034463, "post_id": 32106834, "comment_id": 52110534, "body": "@&#216;rjanJohansen: Oh, good point. But making <code>Const</code> a type synonym doesn&#39;t really do what we want..."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1440041579, "post_id": 32106834, "comment_id": 52112212, "body": "Interestingly, if you make both <code>Const</code> and <code>Compose</code> kind-polymorphic enough, you can get GHCi&#39;s <code>:kind</code> to show the correct kind, e.g. <code>Compose Const Const Int Bool String :: *</code>, but it still doesn&#39;t work as a type annotation: &quot;Type synonym <code>Const</code> should have 4 arguments, but has been given 2 in the expression: <code>42 :: Compose Const Const Int Bool String</code>&quot;"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1440110198, "post_id": 32106834, "comment_id": 52150227, "body": "@Cactus That works if you enable <a href=\"https://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/data-type-extensions.html#type-synonyms\" rel=\"nofollow noreferrer\"><code>LiberalTypeSynonyms</code></a>, which expands everything as far as possible before checking number of arguments. Alas, all this is still useless for OP&#39;s goal of defining <i>instances</i> for the partially applied type synonyms."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 2, "last_activity_date": 1440024282, "creation_date": 1440024282, "answer_id": 32106834, "question_id": 32106435, "link": "https://stackoverflow.com/questions/32106435/can-i-implement-this-newtype-as-a-composition-of-other-types/32106834#32106834", "title": "Can I implement this newtype as a composition of other types?", "body": "<p>The thing that's confusing\u2014or, at least, the thing that confused <em>me</em>\u2014is that <code>*</code> acts like a <em>concrete type</em>, not a type variable. So without <code>PolyKinds</code>, <code>Compose</code> has a type that's more like:</p>\n\n<pre><code>compose :: (A -&gt; A) -&gt; (A -&gt; A) -&gt; A -&gt; A\n</code></pre>\n\n<p>Crucially, we can't replace an <code>A</code> with <code>A -&gt; A</code> because they'd be different types, so, by the same logic, we can't replace <code>*</code> with <code>* -&gt; *</code> either.</p>\n\n<p>Even with <code>PolyKinds</code>, the kinds still aren't right. In particular, <code>Compose</code> expects <code>(k -&gt; *)</code> as its first argument and you're trying to give it <code>(k -&gt; (k2 -&gt; *))</code>.</p>\n\n<p>The reason you're forced to return a <code>*</code> kind is because you're using <code>newtypes</code>, and newtypes have to return a concrete type (ie of kind <code>*</code>). I tried to overcome this by turning <code>Compose</code> into a type synonym which finally had exactly the kind we want (with <code>PolyKinds</code>):</p>\n\n<pre><code>type Compose f g a = (f (g a))\n\n\u03bb&gt; :k Compose\nCompose :: (k1 -&gt; k) -&gt; (k2 -&gt; k1) -&gt; k2 -&gt; k\n</code></pre>\n\n<p>However, using this still gave me a similar error, and I'm not certain if we can get it to work properly. The problem arose because applying <code>Compose</code> to the first <code>Const</code> gives us a kind with a <code>*</code> in it, probably because on limitations of type aliases like this:</p>\n\n<pre><code>\u03bb&gt; :k Compose Const\nCompose Const :: (k -&gt; *) -&gt; k -&gt; k1 -&gt; *\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": false, "score": 2, "last_activity_date": 1440177980, "creation_date": 1440177980, "answer_id": 32146092, "question_id": 32106435, "link": "https://stackoverflow.com/questions/32106435/can-i-implement-this-newtype-as-a-composition-of-other-types/32146092#32146092", "title": "Can I implement this newtype as a composition of other types?", "body": "<p>From the other answers, it seems like it's not that easy, however if the only thing you want to have are the \"free\" instances, one quick way is using a <code>newtype</code> over the regular <code>Const</code> with the <code>GeneralizedNewtypeDeriving</code> extension:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE DeriveTraversable #-}\n{-# LANGUAGE PatternSynonyms #-}\nmodule ConstThree (Const3,pattern Const3,getConst3) where\nimport Data.Foldable\nimport Data.Traversable\nimport Control.Applicative\nimport Data.Monoid\n\nnewtype Const3 a b c = MkConst3 (Const a c) deriving (Functor,Applicative,Foldable,Traversable,Eq,Ord,Show,Monoid)\n\npattern Const3 :: a -&gt; Const3 a b c\npattern Const3 x = MkConst3 (Const x)\n\ngetConst3 :: Const3 a b c -&gt; a\ngetConst3 (Const3 x) = x\n</code></pre>\n\n<p>In the above, I'm also using <code>PatternSynonyms</code> to hide the internal use of <code>Const</code> from clients.</p>\n\n<p>This is what you get:</p>\n\n<pre><code>\u03bb&gt; :t Const3\nConst3 :: a -&gt; Const3 a b c\n\u03bb&gt; :t getConst3\ngetConst3 :: Const3 a b c -&gt; a\n\u03bb&gt; :i Const3\npattern Const3 :: a -&gt; Const3 a b c\n        -- Defined at /tmp/alpha-dbcdf.hs:13:5\n\ntype role Const3 representational phantom phantom\nnewtype Const3 a b c = MkConst3 (Const a c)\n        -- Defined at /tmp/alpha-dbcdf.hs:10:5\ninstance Eq a =&gt; Eq (Const3 a b c)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:100\ninstance Functor (Const3 a b)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:59\ninstance Ord a =&gt; Ord (Const3 a b c)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:103\ninstance Show a =&gt; Show (Const3 a b c)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:107\ninstance Monoid a =&gt; Applicative (Const3 a b)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:67\ninstance Foldable (Const3 a b)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:79\ninstance Traversable (Const3 a b)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:88\ninstance Monoid a =&gt; Monoid (Const3 a b c)\n  -- Defined at /tmp/alpha-dbcdf.hs:10:112\n</code></pre>\n\n<p>And as expected you can do:</p>\n\n<pre><code>instance Monoid m =&gt; Category (Const3 m) where\n  id = Const3 mempty\n  Const3 x . Const3 y = Const3 (mappend x y)\n</code></pre>\n"}], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "answer_count": 2, "score": 12, "last_activity_date": 1440177980, "creation_date": 1440022067, "last_edit_date": 1592644375, "question_id": 32106435, "link": "https://stackoverflow.com/questions/32106435/can-i-implement-this-newtype-as-a-composition-of-other-types", "title": "Can I implement this newtype as a composition of other types?", "body": "<p>I've written a newtype <code>Const3</code> that's very similar to <code>Const</code>, but contains the first of three given type arguments:</p>\n<pre><code>newtype Const3 a b c = Const3 { getConst3 :: a }\n</code></pre>\n<p>I can define very many useful instances for this newtype, but I'd have to do it all myself.</p>\n<p>However, the function I'm applying on the type level resembles the function</p>\n<pre><code>\\a b c -&gt; a\n</code></pre>\n<p>which <code>@pl</code> tells me is equivalent to <code>const . const</code>.</p>\n<p>Both <code>(.)</code> and <code>const</code> have matching newtype wrappers: <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Data-Functor-Compose.html\" rel=\"noreferrer\"><code>Compose</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#t:Const\" rel=\"noreferrer\"><code>Const</code></a>. So I figured I'd be able to write:</p>\n<pre><code>type Const3 = Compose Const Const\n</code></pre>\n<p>And inherit useful instances automatically, such as:</p>\n<pre><code>instance Functor (Const m)\ninstance (Functor f, Functor g) =&gt; Functor (Compose f g)\n-- a free Functor instance for Const3!\n</code></pre>\n<p>But GHC disagrees:</p>\n<pre><code>const3.hs:5:23:\n    Expecting one more argument to \u2018Const\u2019\n    The first argument of \u2018Compose\u2019 should have kind \u2018* -&gt; *\u2019,\n      but \u2018Const\u2019 has kind \u2018* -&gt; * -&gt; *\u2019\n    In the type \u2018Compose Const Const\u2019\n    In the type declaration for \u2018Const3\u2019\n</code></pre>\n<p>This seems to be related to the kinds of <code>Compose</code> and <code>Const</code>:</p>\n<pre><code>*Main&gt; :k Compose\nCompose :: (* -&gt; *) -&gt; (* -&gt; *) -&gt; * -&gt; *\n*Main&gt; :k Const\nConst :: * -&gt; * -&gt; *\n</code></pre>\n<p>So after a little bit of searching, I found that there's a GHC extension called <code>PolyKinds</code> that allows me to do something like:</p>\n<pre><code>{-# LANGUAGE PolyKinds #-}\nnewtype Compose f g a = Compose { getCompose :: f (g a) }\nnewtype Const a b = Const { getConst :: a }\n</code></pre>\n<p>And as if by magic the kinds are right:</p>\n<pre><code> *Main&gt; :k Compose\n Compose :: (k -&gt; *) -&gt; (k1 -&gt; k) -&gt; k1 -&gt; *\n *Main&gt; :k Const\n Const :: * -&gt; k -&gt; *\n</code></pre>\n<p>But I <em>still</em> can't compose them to write <code>Const3 = Compose Const Const</code>.</p>\n<pre><code>const3.hs:12:23:\n    Expecting one more argument to \u2018Const\u2019\n    The first argument of \u2018Compose\u2019 should have kind \u2018* -&gt; *\u2019,\n      but \u2018Const\u2019 has kind \u2018* -&gt; k0 -&gt; *\u2019\n    In the type \u2018Compose Const Const\u2019\n    In the type declaration for \u2018Const3\u2019\n</code></pre>\n<p>What gives? Is there some clever way to do this, so I can reap the benefits of inheriting the <code>Functor</code> etc. instances from <code>Const</code> and <code>Compose</code>?</p>\n<blockquote>\n<p>(As a side note, the original thought that led me to <code>Const3</code> was writing:</p>\n<pre><code>newtype Const3 a b c = Const3 { getConst3 :: a }\n\ninstance Monoid m =&gt; Category (Const3 m) where\n  id = Const3 mempty\n  Const3 x . Const3 y = Const3 (mappend x y)\n</code></pre>\n<p>capturing the idea that a <em>monoid is a single-object category</em>. It would be nice if there's a solution that still allows me to write the above instance somehow.)</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 4, "creation_date": 1440016051, "post_id": 32104971, "comment_id": 52104615, "body": "What would that mean for non-Windows systems? I use Linux and if you asked about where my &quot;system OS directory&quot; was I wouldn&#39;t know how to answer. (Then again, I&#39;m hardly an expert!)"}, {"owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1440017337, "post_id": 32104971, "comment_id": 52105324, "body": "Yeah, I&#39;m not entirely sure, either. I&#39;ve never tried to stray out of the user space in Linux. (Maybe that would be equivalent to <code>root</code>&#39;s home directory?) [Edit:] Actually, I think <code>&#47;boot</code> would be the equivalent. Basically, it would be where the kernel lives."}, {"owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "edited": false, "score": 3, "creation_date": 1440017358, "post_id": 32104971, "comment_id": 52105333, "body": "Since \u201cOS directory\u201d is a Windows-specific concept, look for libraries dedicated to Windows programming. You can&#39;t do anything useful with the \u201cOS directory\u201d that isn&#39;t very specific to the OS anyway. In Windows, I expect that you can get the information through an environment variable (a portable concept) or through a registry key (a Windows-specific concept)."}, {"owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "edited": false, "score": 0, "creation_date": 1440017718, "post_id": 32104971, "comment_id": 52105510, "body": "Gilles, any suggestions as to a library? That&#39;s what I was searching for and could find nothing on. I&#39;m specifically trying to <i>avoid</i> entering it, for a tool that can automate certain kinds of file changes. I&#39;d rather do it in a more correct manner (library-supported), rather than hack it in. Worst case, I suppose I can use a library that wraps kernel32."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1440019255, "post_id": 32104971, "comment_id": 52106232, "body": "The environment variable <code>SystemRoot</code> will contain something like <code>C:\\Windows</code>. (Try navigating to <code>%SystemRoot%</code> in Explorer.)"}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 2, "creation_date": 1440019697, "post_id": 32104971, "comment_id": 52106448, "body": "@stormont: Instead of avoiding certain directories based on the OS, I would consider letting the user specify which directories they <i>do</i> want your tool to monitor, and stay out of everywhere else."}, {"owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1440020066, "post_id": 32104971, "comment_id": 52106643, "body": "@Mauris, that&#39;s part of the plan. Part of the tool involves a system-wide scan. I was planning on using checks for special folders to filter out critical paths."}], "answers": [{"comments": [{"owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "edited": false, "score": 0, "creation_date": 1440020777, "post_id": 32106012, "comment_id": 52106916, "body": "Annoyingly, searching for these doesn&#39;t show up in Hoogle or Stackage (at the time I posted this question)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1440150735, "post_id": 32106012, "comment_id": 52164854, "body": "<a href=\"https://www.haskell.org/hoogle/?hoogle=%2Bwin32+getSystemDirectory\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=%2Bwin32+getSystemDirectory</a> hoogle searches a rather small set of packages by default.  There used to be (are?) OS specific flags in Google."}, {"owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440185481, "post_id": 32106012, "comment_id": 52185380, "body": "Yeah, I was aware of that, but I did think that Stackage was more consistent. Eventually, I found what I needed by looking up the Win32 methods in MSDN and searching for similar names through Google. (Of course, trying &quot;Windows directory&quot; doesn&#39;t help the results much, but &quot;Win32&quot; is more effective.) The missing key for Hoogle was knowing to look for the Win32 library to begin with."}], "tags": [], "owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "is_accepted": true, "score": 4, "last_activity_date": 1440019969, "creation_date": 1440019969, "answer_id": 32106012, "question_id": 32104971, "link": "https://stackoverflow.com/questions/32104971/haskell-how-to-get-the-system-os-directory/32106012#32106012", "title": "Haskell - How to get the system OS directory?", "body": "<p>The <code>Win32</code> library contains this functionality.</p>\n\n<pre><code>import System.Win32.Info\n\n-- Calls Win32's GetWindowsDirectory() function in kernel32.dll\n-- Corresponds to: C:\\Windows\ngetWindowsDirectory :: IO String\n\n-- Calls Win32's GetSystemDirectory() function in kernel32.dll\n-- Corresponds to: C:\\Windows\\system32   \ngetSystemDirectory :: IO String\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1440188270, "creation_date": 1440188270, "answer_id": 32148656, "question_id": 32104971, "link": "https://stackoverflow.com/questions/32104971/haskell-how-to-get-the-system-os-directory/32148656#32148656", "title": "Haskell - How to get the system OS directory?", "body": "<p>The correct way to find OS specific operations is to tell hoogle which operating system you're talking about. Hopefully it is obvious when one is looking for something OS specific.  In this case you get success with the straight-forward <a href=\"http://hoogle.haskell.org/?hoogle=os%3Awindows+system+directory&amp;scope=set%3Astackage\" rel=\"nofollow\"><code>os:windows system directory</code></a>.</p>\n"}], "owner": {"reputation": 529, "user_id": 1207773, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K20g9.png?s=128&g=1", "display_name": "stormont", "link": "https://stackoverflow.com/users/1207773/stormont"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 32106012, "answer_count": 2, "score": 1, "last_activity_date": 1440188270, "creation_date": 1440015768, "question_id": 32104971, "link": "https://stackoverflow.com/questions/32104971/haskell-how-to-get-the-system-os-directory", "title": "Haskell - How to get the system OS directory?", "body": "<p>The <code>directory</code> library contains many helper methods for getting certain reserved directories. However, as of the latest version (1.2.3.1), there does not appear to be a function that can get the system OS directory; e.g., \"C:\\Windows\". I'd expect this to be a function like <code>getSystemDirectory</code>, but I don't see any equivalent. At least on Windows, it is possible for a user to install the OS to a non-standard location, therefore, it's not safe to make any assumptions as to its location.</p>\n\n<p>Is there another library that exposes a function like this?</p>\n"}, {"tags": ["performance", "haskell", "stack-overflow", "lazy-evaluation"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1440012772, "post_id": 32103905, "comment_id": 52102690, "body": "yes your code would help - till then maybe you can have a look at <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow noreferrer\">this Wiki article dealing with the different folds and their properties</a>"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440013599, "post_id": 32103905, "comment_id": 52103195, "body": "<code>foldl&#39;</code> will probably alleviate any space issues..."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1440014045, "post_id": 32103905, "comment_id": 52103476, "body": "Also, be sure you&#39;re compiling with optimization (<code>-O2</code>)."}, {"owner": {"reputation": 111, "user_id": 1207981, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1bcf7b1fe691cab855041450e9828df?s=128&d=identicon&r=PG", "display_name": "Nick Tobey", "link": "https://stackoverflow.com/users/1207981/nick-tobey"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440019085, "post_id": 32103905, "comment_id": 52106151, "body": "@recursion.ninja: I&#39;m using maximumBy for the folding."}, {"owner": {"reputation": 111, "user_id": 1207981, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1bcf7b1fe691cab855041450e9828df?s=128&d=identicon&r=PG", "display_name": "Nick Tobey", "link": "https://stackoverflow.com/users/1207981/nick-tobey"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440019248, "post_id": 32103905, "comment_id": 52106228, "body": "@ThomasM.DuBuisson: The compiler flag prevents the overflow for the input on the cryptopals site, but still triggers an overflow on input that is only twice as large."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440019969, "post_id": 32103905, "comment_id": 52106586, "body": "My Haskell &quot;spidey-sense&quot; tells me that you need enforce strictness after reading the lines from the file..."}, {"owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "edited": false, "score": 1, "creation_date": 1440038058, "post_id": 32103905, "comment_id": 52111403, "body": "Well since someone deleted my answer (admittedly wasn&#39;t fleshed out but I was at work and didn&#39;t have time to finish it out), there is a good explanation of the issue you&#39;re running into <a href=\"https://wiki.haskell.org/Stack_overflow\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1458454079, "creation_date": 1458454079, "answer_id": 36110752, "question_id": 32103905, "link": "https://stackoverflow.com/questions/32103905/haskell-stack-overflow-when-finding-max-on-a-large-list/36110752#36110752", "title": "Haskell: Stack overflow when finding max on a large list", "body": "<p>As discussed in <a href=\"http://comments.gmane.org/gmane.comp.lang.haskell.libraries/25602\" rel=\"nofollow\">this thread</a>, the <code>maximumBy</code> on list that we now have in the prelude isn't optimally performant, for a variety of, well, let's just say \"reasons.\"</p>\n\n<p>If you use the proposed <code>maximumBy'</code> function, which is strict, you'll likely fix the leak:</p>\n\n<pre><code>foldl1' f l = foldl' f (head l) (tail l)\n\nmaximumBy' f = foldl1' max'\n  where max' x y = case f x y of\n                        GT -&gt; y\n                        _  -&gt; x\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 1207981, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1bcf7b1fe691cab855041450e9828df?s=128&d=identicon&r=PG", "display_name": "Nick Tobey", "link": "https://stackoverflow.com/users/1207981/nick-tobey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1458454175, "creation_date": 1440011985, "last_edit_date": 1458454175, "question_id": 32103905, "link": "https://stackoverflow.com/questions/32103905/haskell-stack-overflow-when-finding-max-on-a-large-list", "title": "Haskell: Stack overflow when finding max on a large list", "body": "<p>I have the following implementation of <a href=\"http://cryptopals.com/sets/1/challenges/4/\" rel=\"nofollow\">problem 1-4 of the Matasano Cryptopals Challenge</a>, to find one line in a file that is a text string xor'd with a single byte. It works well enough for large files, but displays \"Stack space overflow: current size 8388608 bytes.\" for the file provided.</p>\n\n<pre><code>import System.IO\nimport System.Environment\nimport Control.Monad\nimport Data.Bits\nimport Data.Word\nimport Data.Maybe\nimport Data.List hiding (maximumBy)\nimport Data.Char\nimport Data.Ord\nimport Data.Foldable hiding (sum)\n\n\nhexChars = \"0123456789ABCDEF\"\n\nhexToBytes :: String -&gt; Maybe [Word8]\n{- Converts a hex string into a byte array -}\n\nhexToBytes hexes = hexToBytes' (map toUpper hexes)\nhexToBytes' (char1 : char2 : xs) = do\n    tail &lt;- hexToBytes' xs\n    byte1 &lt;- char1 `elemIndex` hexChars\n    byte2 &lt;- char2 `elemIndex` hexChars\n    return ((fromIntegral(byte1*16 + byte2) :: Word8) : tail)\nhexToBytes' [_] = Nothing\nhexToBytes' [] = Just []\n\nmaxBy :: Ord b =&gt; Foldable f =&gt; (a -&gt; b) -&gt; f a -&gt; a\nmaxBy = maximumBy . comparing\n\nbytesToString :: Integral i =&gt; Monad m =&gt; m i -&gt; m Char\nbytesToString = liftM (chr . fromIntegral)  \n\nisLowercase x = (x &gt;= 'a') &amp;&amp; (x &lt;= 'z')\n\nasciiCheck :: Word8 -&gt; Int\nasciiCheck x = if (isLowercase . chr . fromIntegral) x then 1 else 0\n\nscore = (sum . map asciiCheck)\n\nreadLines :: Handle -&gt; IO [String]\nreadLines handle = do\n    eof &lt;- hIsEOF handle\n    if eof then\n        return []\n    else liftM2 (:) (hGetLine handle) (readLines handle)\n\ndecode key = map (xor key)\n\nkeys = [minBound ..] :: [Word8]\n\nmassDecode inputs =\n    maxBy score (liftM2 decode keys inputs)\n\nmain = do\n    hSetEncoding stdout latin1\n    args &lt;- getArgs\n    handle &lt;- case args of\n        [] -&gt; return stdin\n        (x:xs) -&gt; openFile x ReadMode\n    lines &lt;- readLines handle\n    putStrLn $ bytesToString $ massDecode $ catMaybes $ map hexToBytes lines\n</code></pre>\n\n<p>The program works by traversing a list containing every input line xor'd with every possible key. I suspect that this large list is responsible for the overflow somehow, but I assumed that this would not cause memory issues because the list would be generated lazily. I don't think I have a firm enough understanding of when thunks are evaluated to intuit how this is causing a stack overflow.</p>\n\n<p>So my question is: Why is generating or traversing this list causing a stack overflow?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1440009677, "post_id": 32102996, "comment_id": 52100812, "body": "Yes, this is a major version change. Adding or removing type-classes constitutes a possibly breaking change and <a href=\"https://wiki.haskell.org/Package_versioning_policy#Leaking_instances\" rel=\"nofollow noreferrer\">should be packaged as a major version change</a>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1440038456, "post_id": 32102996, "comment_id": 52111480, "body": "@recursion.ninja Actually, <i>adding</i> non-orphan instances is specifically exempt (this is a relatively recent adjustment). But not removing them."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1440099155, "post_id": 32102996, "comment_id": 52145012, "body": "These comments look answer worthy to me..."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1440111395, "creation_date": 1440111395, "answer_id": 32129790, "question_id": 32102996, "link": "https://stackoverflow.com/questions/32102996/dropping-a-typeclass-instance-and-the-package-version-policy/32129790#32129790", "title": "Dropping a typeclass instance and the package version policy", "body": "<p>Yes, it's a major version change. The <a href=\"https://wiki.haskell.org/Package_versioning_policy#Version_numbers\" rel=\"nofollow\">Haskell wiki page on the PVP</a> states about A.B.C version numbers (relevant phrase bolded):</p>\n\n<blockquote>\n  <ol>\n  <li>If any entity was removed, or the types of any entities or the definitions of datatypes or classes were changed, or orphan instances were added <strong>or any instances were removed</strong>, then the new A.B must be greater than the previous A.B. Note that modifying imports or depending on a newer version of another package may cause extra orphan instances to be exported and thus force a major version change. </li>\n  <li>Otherwise, if only new bindings, types, classes, non-orphan instances or modules (but see below) were added to the interface, then A.B may remain the same but the new C must be greater than the old C. Note that modifying imports or depending on a newer version of another package may cause extra non-orphan instances to be exported and thus force a minor version change. </li>\n  <li>Otherwise, A.B.C may remain the same (other version components may change). </li>\n  </ol>\n</blockquote>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 32129790, "answer_count": 1, "score": 5, "last_activity_date": 1440111395, "creation_date": 1440008887, "question_id": 32102996, "link": "https://stackoverflow.com/questions/32102996/dropping-a-typeclass-instance-and-the-package-version-policy", "title": "Dropping a typeclass instance and the package version policy", "body": "<p>I've <a href=\"https://github.com/rampion/ReadArgs/issues/7\" rel=\"noreferrer\">been asked to drop my dependency on <code>system-filepath</code></a>.</p>\n\n<p>My package defines a typeclass <code>Arguable</code>, and defines an instance for <code>Filesystem.Path</code>'s <code>FilePath</code> type. No <code>system-filepath</code> means no <code>Filesystem.Path</code> means no <code>FilePath</code>, so by dropping this dependency, I'd be changing my API to no longer provide the <code>Arguable</code> instance.</p>\n\n<p>How does that line up with the PVP? Is this a major version change?</p>\n"}, {"tags": ["haskell", "design-patterns", "refactoring", "idioms"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1440010312, "post_id": 32102830, "comment_id": 52101213, "body": "Well, you can always change the type signature and the arguments list (you are writing type signatures, aren&#39;t you?), then see where the compiler complains.  Fix the first spot, then go back to step 2 until all errors are exhausted.  If you have a common set of arguments that gets passed to many functions, it would probably be better to make a new data type to hold all those values, then you can avoid changing the function arguments and instead just change the definition of that type.  This is a software problem, not really a Haskell one."}], "answers": [{"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1440042098, "post_id": 32104749, "comment_id": 52112320, "body": "The neat thing about this is that it works well with defaults with respect to future API changes, too.  So if you had a <code>defaultSettings</code>, you can have the user do <code>defaultSettings { getC  = 3 }</code> to modify <code>getC</code>.  The best part is that if you decided to add, say, a <code>getE</code> field, the <code>defaultSettings { getC = 3 }</code> code still works :)"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 0, "last_activity_date": 1440015292, "last_edit_date": 1440015292, "creation_date": 1440014991, "answer_id": 32104749, "question_id": 32102830, "link": "https://stackoverflow.com/questions/32102830/how-to-refactor-this-haskell-chain-of-functions-code/32104749#32104749", "title": "how to refactor this Haskell chain of functions code?", "body": "<p>One thing you can do is bundle up parameters like this into a single parameter object, as bhelkir suggests in a comment. If you add a new parameter to this object you will still need to change the client code that calls <code>f1</code>, and change direct consumers of that new parameter (here, <code>f5</code>), but those are both unavoidable: someone has to provide an <code>x</code> at some point, and you need it to be the client; and you have to consume the <code>x</code> somehow otherwise why are you adding it to begin with?</p>\n\n<p>But, you can avoid changing intermediary functions like <code>f1</code> and <code>f2</code>, because they can ignore the new fields they don't care about. And you can get a little fancy by using the <code>Applicative</code> instance for <code>((-&gt;) t)</code> (generally called <code>Reader</code>) to pass along this object, rather than doing it manually. Here is one way to write that:</p>\n\n<pre><code>module Test where\nimport Control.Applicative\n\ndata Settings = Settings {getA :: Int,\n                          getB :: Int,\n                          getC :: Int,\n                          getD :: Int}\nf1 :: Settings -&gt; Int\nf1 = liftA2 (+) f2 f4\n-- f1 = do\n--   e1 &lt;- f2\n--   e2 &lt;- f4\n--   return $ e1 + e2\n\nf2 :: Settings -&gt; Int\n-- probably something clever with liftA3 and (+) is possible here too\nf2 s = f5 s + getC s + f3 s\n\nf3 :: Settings -&gt; Int\nf3 = liftA (* 2) getA\n\nf4 :: Settings -&gt; Int\nf4 = liftA (+ 3) getD\n\nf5 :: Settings -&gt; Int\n-- f5 = liftA (join (*)) getB -- perhaps a bit opaque\nf5 = liftA square getB\n  where square b = b * b\n</code></pre>\n\n<p>Now, this has its pluses and its minuses: the logic that was in <code>f1</code> (ie, knowing that you need to call <code>f3</code> with <code>a</code>) has moved into <code>f3</code> itself, and this will happen for any function that originally read a parameter and mucked with it before passing it along to some subsidiary function. That may be clearer than the original, or it may obscure the intent behind <code>f1</code>, depending on your problem domain. You can always write a function more explicitly, eg by having it modify the passed-in <code>Settings</code> object to change its <code>a</code> field before passing it along, as I did with <code>f2</code> as an example. More generally, you can write any function in whichever style is most convenient for it: do-notation, applicative functions, or plain old pattern-matching on the record object being passed in.</p>\n\n<p>But the big plus is that it's very easy to add a new parameter: you just add a field to the <code>Settings</code> record, and read it in the function that needs it:</p>\n\n<pre><code>module Test where\nimport Control.Applicative\n\ndata Settings = Settings {getA :: Int,\n                          getB :: Int,\n                          getC :: Int,\n                          getD :: Int,\n                          getX :: Int}\nf1 :: Settings -&gt; Int\nf1 = liftA2 (+) f2 f4\n-- f1 = do\n--   e1 &lt;- f2\n--   e2 &lt;- f4\n--   return $ e1 + e2\n\nf2 :: Settings -&gt; Int\n-- probably something clever with liftA3 and (+) is possible here too\nf2 s = f5 s + getC s + f3 s\n\nf3 :: Settings -&gt; Int\nf3 = liftA (* 2) getA\n\nf4 :: Settings -&gt; Int\nf4 = liftA (+ 3) getD\n\nf5 :: Settings -&gt; Int\nf5 = liftA2 squareAdd getB getX\n  where squareAdd b x = b * b + x\n</code></pre>\n\n<p>Note that everything is the same except the <code>data Settings</code> and <code>f5</code>.</p>\n"}], "owner": {"reputation": 13, "user_id": 5244502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eff26d7589b823ef641db7fcbfb4e81c?s=128&d=identicon&r=PG&f=1", "display_name": "kiump2", "link": "https://stackoverflow.com/users/5244502/kiump2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 32104749, "answer_count": 1, "score": 1, "last_activity_date": 1440015292, "creation_date": 1440008349, "question_id": 32102830, "link": "https://stackoverflow.com/questions/32102830/how-to-refactor-this-haskell-chain-of-functions-code", "title": "how to refactor this Haskell chain of functions code?", "body": "<p>I have some software design experience, and I am learning Haskell now. In many real world software developments, one faces a situation like the one given, for instance, below:</p>\n\n<p>Suppose, I have this code</p>\n\n<pre><code>f1 a b c d = e \n where\n  e1 = f2 b c (f3 a)\n  e2 = f4 d\n  e = e1 + e2\n\nf2 b c d = n + c + d\n where\n  n = f5 b\n\nf5 n = n*n\n\nf3 a = a * 2\n\nf4 a = a + 3\n</code></pre>\n\n<p>Now if I want to change f5 so that it takes yet another parameter, I will have to change all the chain of functions right upto f1.\nIt can be done as shown below. Note the added parameter x.</p>\n\n<pre><code>f1 a b c d x = e -- f1 needs to be changed\n where\n  e1 = f2 b c (f3 a) x\n  e2 = f4 d\n  e = e1 + e2\n\nf2 b c d x = n + c + d -- f2 needs to be changed\n where\n  n = f5 b x\n\nf5 n x = n*n -- f5 changed (**bang**)\n\nf3 a = a * 2\n\nf4 a = a + 3\n</code></pre>\n\n<p>Is this a normal Haskell way of doing this type of thing or is there a better (more Haskell-ish) way?\nI know such a change in API will disturb the client code, but how the impact can be kept minimum and is there any Hasekll way for it?</p>\n\n<p>On a more general level: How well does Haskell perform in such cases (especially taking into consideration its <em>immutable state</em> feature)? What has it to offer the developers in this regard? Or is it that Haskell has got no role, per se, to play in this and that this is just a difficult software engineering problem (no such thing as <em>future proof</em>) that we have to keep up with?</p>\n\n<p>I apologize for asking more than one question in a single post, but I cannot help as these are related to each other. Also, I could not find similar question asked, sorry if I might have missed it.</p>\n"}, {"tags": ["haskell", "types", "casting", "ihaskell"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440007790, "post_id": 32102624, "comment_id": 52099613, "body": "So perhaps the question then is why I&#39;m prevented from shadowing in some cases and allowed in others (see edit above) ."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440007859, "post_id": 32102624, "comment_id": 52099648, "body": "And: Is there way to configure Haskell to warn about shadowing?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1440007919, "post_id": 32102624, "comment_id": 52099682, "body": "@raxacoricofallapatorius: Yep. I was about to add that to my answer :). You can turn on the <code>-fwarn-name-shadowing</code> flag: <code>:set -fwarn-name-shadowing</code>. That works from <code>ghci</code> for sure and <i>probably</i> works from IHaskell, but I don&#39;t have it running locally to test."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440008154, "post_id": 32102624, "comment_id": 52099812, "body": "Cool. I&#39;ll see if I can set up IHaskell to do that (maybe a new question)."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440008224, "post_id": 32102624, "comment_id": 52099853, "body": "So, to be clear: What looks like (coming from other languages) <i>assignment</i> is in fact <i>definition</i>? Doing <code>thing = 5</code> after <code>thing = King</code> doesn&#39;t attempt to assign <code>5</code> to the existing <code>thing</code> but creates something new? If so, what about <code>thing = Ship</code> after <code>thing = King</code>?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440008553, "post_id": 32102624, "comment_id": 52100088, "body": "@raxacoricofallapatorius: Yep, it&#39;s always definition, never assignment. It&#39;s a bit less obvious in a setting like IHaskell because the normally static change of defining a new value with the same name happens interactively."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440008636, "post_id": 32102624, "comment_id": 52100144, "body": "And that&#39;s true even if the types match (as in <code>thing = Ship</code> after <code>thing = King</code>): <code>King</code> is still around, just shadowed by <code>Ship</code>, right?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1440008920, "post_id": 32102624, "comment_id": 52100302, "body": "@raxacoricofallapatorius: Yep. It would be inconsistent otherwise."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 5, "last_activity_date": 1440008003, "last_edit_date": 1440008003, "creation_date": 1440007680, "answer_id": 32102624, "question_id": 32102540, "link": "https://stackoverflow.com/questions/32102540/why-can-i-change-the-type-of-a-variable-in-separate-ihaskell-notebook-cells/32102624#32102624", "title": "Why can I change the type of a variable in separate IHaskell Notebook cells?", "body": "<p>In Haskell, you <em>can't</em> change or reassign variables. What you're doing is declaring a <em>new</em> variable that just reuses the <em>name</em> <code>shoe</code>, but is otherwise entirely distinct.</p>\n\n<p>Your second definition of <code>show</code> <strong>shadows</strong> the first because it takes the same name, but it doesn't affect it in any other way.</p>\n\n<p>The single-cell example is a bit more confusing: essentially, a <code>:t</code> separates the cell into multiple definitions. With the <code>:t</code>, it's as if you had two cells; without it, it's as if you simultaneously tried to define <code>x</code> in two different ways\u2014which wouldn't have worked even if they had the same type.</p>\n\n<p>In general, shadowing names in Haskell is a bit awkward and not good style. You can even enable a warning about it:</p>\n\n<pre><code>:set -fwarn-name-shadowing\n</code></pre>\n\n<p>It can also be turned on as part of a larger suite of warnings:</p>\n\n<pre><code>:set -Wall\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 32102624, "answer_count": 1, "score": 2, "last_activity_date": 1440008003, "creation_date": 1440007360, "last_edit_date": 1440007677, "question_id": 32102540, "link": "https://stackoverflow.com/questions/32102540/why-can-i-change-the-type-of-a-variable-in-separate-ihaskell-notebook-cells", "title": "Why can I change the type of a variable in separate IHaskell Notebook cells?", "body": "<p>If I define</p>\n\n<pre><code>data Thing = Shoe\n           | Ship\n           | SealingWax\n           | Cabbage\n           | King\n</code></pre>\n\n<p>and then in a later cell in an IHaskell Notebook enter</p>\n\n<pre><code>thing :: Thing\nthing = 4\n</code></pre>\n\n<p>I get an error (\"No instance for (Num Thing) arising from the literal \u20184\u2019\") as expected. But if I first complete a valid binding with</p>\n\n<pre><code>thing :: Thing\nthing = King\n</code></pre>\n\n<p>and then later, in a separate cell make the same (invalid) assignment with</p>\n\n<pre><code>thing = 4\n</code></pre>\n\n<p>I get no error, and <code>t: thing</code> yields <code>thing :: (Num a) =&gt; a</code>.</p>\n\n<p>More perplexingly, if I put</p>\n\n<pre><code>thing = Cabbage\n:t thing\nthing = 5\n:t thing\n</code></pre>\n\n<p>in a single cell I get no errors and</p>\n\n<pre><code>thing :: Thing\nthing :: (Num a) =&gt; a\n</code></pre>\n\n<p>but a single cell without the <code>:t</code> lines</p>\n\n<pre><code>thing = Cabbage\nthing = 5\n</code></pre>\n\n<p>gives an error:</p>\n\n<pre><code>Multiple declarations of \u2018thing\u2019\nDeclared at: :1:1\n             :2:1\n</code></pre>\n\n<p>Why can I change the type of a variable in separate IHaskell Notebook cells? </p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1440008217, "post_id": 32102718, "comment_id": 52099847, "body": "@Jono See the reference to list comprehensions"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 2, "creation_date": 1440010915, "post_id": 32102718, "comment_id": 52101569, "body": "You could leave out the singleton case - the x:xs case covers it correctly."}], "tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": true, "score": 1, "last_activity_date": 1440017457, "last_edit_date": 1440017457, "creation_date": 1440008002, "answer_id": 32102718, "question_id": 32102485, "link": "https://stackoverflow.com/questions/32102485/learning-haskell-a-recursive-function-for-creating-skip-bigrams/32102718#32102718", "title": "Learning haskell: a recursive function for creating skip-bigrams", "body": "<p><a href=\"http://ideone.com/ywn1S8\" rel=\"nofollow\"><strong>Try this definition:</strong></a></p>\n\n<pre><code>skipBigram :: [a] -&gt; [(a,a)]\nskipBigram     [] = [] -- nothing to do with an empty list\nskipBigram (x:xs) = [(x,y) | y &lt;- xs] ++ skipBigram xs\n</code></pre>\n\n<p>Your <code>skipBigram</code> function is generating all the \"2-tuple left-to-right combinations\" of words in the list. We can capture this concept with a <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow\">simple list comprehension</a> in the recursive definition. By recursively concatenating the simple list comprehensions, we gain the desired result list.</p>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440009340, "post_id": 32102744, "comment_id": 52100569, "body": "@recursion.ninja I am perfectly aware of this (I test my snippets before I post them) ... the idea was to let him experiment with it and solve the problem by himself ;) (if you understand the one I gave you should be able to understand/write all kind of combinatorial stuff ...)"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440009496, "post_id": 32102744, "comment_id": 52100679, "body": "I understand your pedagogical approach. I wonder if @Jono can see <i>why</i> it computes too much by comparing our answers... likely a good exercise!"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 2, "last_activity_date": 1440009450, "last_edit_date": 1440009450, "creation_date": 1440008105, "answer_id": 32102744, "question_id": 32102485, "link": "https://stackoverflow.com/questions/32102485/learning-haskell-a-recursive-function-for-creating-skip-bigrams/32102744#32102744", "title": "Learning haskell: a recursive function for creating skip-bigrams", "body": "<p>you get this because your result is a list-of-pairs, where the second-part of the first item in that list is some element and the second-part of the second item in your result list is, whatever you are trying to give back (you use recursion here so it will have the same type) - so you say:</p>\n\n<blockquote>\n  <p>my result is a list-of-tuples, but part of those tuples is the result-type itself</p>\n</blockquote>\n\n<p>that is what the error tells you</p>\n\n<hr>\n\n<p>here are some details:</p>\n\n<p>look at your last line</p>\n\n<pre><code>skipBigram (x:xs) = [(x, (head xs)), (x, skipBigram xs)]\n</code></pre>\n\n<p>you have a list of tuples on the right side so it's type will be like (based on the first element of the result list):</p>\n\n<pre><code>skipBigram :: [a] -&gt; [(a,a)]\n</code></pre>\n\n<p>but in the second-item you have <code>(x, skipBigram xs)</code> meaning it will have the type <code>(a, [(a,a)])</code> (remember the type of <code>skipBigram xs</code> is the above part).</p>\n\n<p>and so - comparing the second parts of the tuples - you have <code>a ~ [(a,a)]</code> which produces your error because somehow the type <code>a</code> should be the same as <code>[(a,a)]</code> which you could expand in all eternity ;)</p>\n\n<hr>\n\n<p>now to the algorithm itself:</p>\n\n<p>It will not work like this - you somehow have to get all combinations and to do this you have to work with the items in the list.</p>\n\n<p>Usually you either do this with list-comprehensions or with the do-notation of the list-monad.</p>\n\n<p>To get going think about this:</p>\n\n<pre><code>f [] = [[]]\nf (x:xs) =\n  let xss = f xs\n  in [ x:xs | xs &lt;- xss ] ++ xss\n</code></pre>\n\n<p>test it and play with it in ghci - you will have to combine this with what you got somehow</p>\n\n<p>(ok recursion.ninja ^^ spoiled your fun - I'll let this here anyway if you don't mind)</p>\n"}, {"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1440008408, "post_id": 32102825, "comment_id": 52099996, "body": "<code>skipBigram (x:xs) = map (x,) xs</code> doesn&#39;t make any recursive calls... so it won&#39;t generate the desired result list"}], "tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": false, "score": 1, "last_activity_date": 1440025353, "last_edit_date": 1440025353, "creation_date": 1440008340, "answer_id": 32102825, "question_id": 32102485, "link": "https://stackoverflow.com/questions/32102485/learning-haskell-a-recursive-function-for-creating-skip-bigrams/32102825#32102825", "title": "Learning haskell: a recursive function for creating skip-bigrams", "body": "<p>The infinite type error is complaining about your use of lists. Your function should have the type <code>[a] -&gt; [a] -&gt; [(a, a)]</code>, but when GHC tries to infer your function's type, it gets that <code>a = [a]</code>, an infinite type. Relevant bindings are just the types of other variables which may be causing the error.</p>\n\n<p>However, even ignoring the type errors, your function will not do what you want at all. Firstly, your function will always return a list of length two, because you have explicitly constructed the list. Also, the result would include <code>(\"Colorless\", \"Colorless\")</code>, because <code>(x, head xs)</code> is the same here as <code>(x, x)</code>. </p>\n\n<p>Instead, try this solution</p>\n\n<pre><code>skipBigram :: [a] -&gt; [(a, a)]\nskipBigram [] = []\nskipBigram (x:xs) = map (x,) xs ++ skipBigram xs\n</code></pre>\n\n<p>For this function to work, you will need to put the line</p>\n\n<pre><code>{-# LANGUAGE TupleSections #-}\n</code></pre>\n\n<p>at the beginning of your file.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 1, "accepted_answer_id": 32102718, "answer_count": 3, "score": 2, "last_activity_date": 1440025353, "creation_date": 1440007116, "last_edit_date": 1592644375, "question_id": 32102485, "link": "https://stackoverflow.com/questions/32102485/learning-haskell-a-recursive-function-for-creating-skip-bigrams", "title": "Learning haskell: a recursive function for creating skip-bigrams", "body": "<p>I'm working my way through the <a href=\"http://nlpwp.org/book/\" rel=\"nofollow noreferrer\">NLPWP Book</a>, and I'm at the chapter that deals with recursive functions. A recursive function for computing bigrams looks like this:</p>\n<pre><code>bigram :: [a] -&gt; [[a]]\nbigram [] = [] \nbigram [_] = []\nbigram xs = take 2 xs : bigram (tail xs)\n</code></pre>\n<p>And if I run it on the <code>wordlist = [&quot;colorless&quot;, &quot;green&quot;, &quot;ideas&quot;, &quot;sleep&quot;, &quot;furiously&quot;]</code> I get this:</p>\n<pre><code>bigram chomsky\n\n[(&quot;colorless&quot;,&quot;green&quot;),(&quot;green&quot;,&quot;ideas&quot;),(&quot;ideas&quot;,&quot;sleep&quot;),(&quot;sleep&quot;,&quot;furiously&quot;)]\n</code></pre>\n<p>The exercise says:</p>\n<blockquote>\n<p>A skip-bigram is any pair of words in sentence order. Write a function skipBigrams that extracts skip-bigrams from a sentence as a list of binary tuples, using explicit recursion. Running your function on <code>[&quot;Colorless&quot;, &quot;green&quot;, &quot;ideas&quot;, &quot;sleep&quot;, &quot;furiously&quot;]</code> should give the following output:</p>\n<p><code>Prelude&gt; skipBigrams [&quot;Colorless&quot;, &quot;green&quot;, &quot;ideas&quot;, &quot;sleep&quot;, &quot;furiously&quot;]</code>\n<code>[(&quot;Colorless&quot;,&quot;green&quot;),(&quot;Colorless&quot;,&quot;ideas&quot;),(&quot;Colorless&quot;,&quot;sleep&quot;),(&quot;Colorless&quot;,&quot;furiously&quot;),(&quot;green&quot;,&quot;ideas&quot;),(&quot;green&quot;,&quot;sleep&quot;),(&quot;green&quot;,&quot;furiously&quot;),(&quot;ideas&quot;,&quot;sleep&quot;),(&quot;ideas&quot;,&quot;furiously&quot;),(&quot;sleep&quot;,&quot;furiously&quot;)]</code></p>\n</blockquote>\n<p>Here is the definition I've tried:</p>\n<pre><code>skipBigram [] = [] \nskipBigram [_] = []\nskipBigram (x:xs) = [(x, (head xs)), (x, skipBigram xs)]\n</code></pre>\n<p>But I'm getting the following error:</p>\n<pre><code>Occurs check: cannot construct the infinite type: t ~ [(t, t)]\nRelevant bindings include\n  xs :: [t] (bound at :3:15)\n  x :: t (bound at :3:13)\n  skipBigram :: [t] -&gt; [(t, t)] (bound at :1:1)\nIn the expression: interactive:IHaskell384.skipBigram xs\nIn the expression: (x, interactive:IHaskell384.skipBigram xs)\n</code></pre>\n<p>Which, new to Haskell as I am, I don't understand in the slightest. What is an infinite type? A relevant binding?</p>\n<p><em>How should I define</em> <code>skipBigram</code> <em>to resolve this compile-time error?</em></p>\n"}, {"tags": ["sqlite", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 3422518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/79deac9c0f02f03696c16c7af110ab59?s=128&d=identicon&r=PG", "display_name": "Piesek64", "link": "https://stackoverflow.com/users/3422518/piesek64"}, "edited": false, "score": 0, "creation_date": 1439996260, "post_id": 32098956, "comment_id": 52092567, "body": "Will be this same if request will be limited to one row?"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 57, "user_id": 3422518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/79deac9c0f02f03696c16c7af110ab59?s=128&d=identicon&r=PG", "display_name": "Piesek64", "link": "https://stackoverflow.com/users/3422518/piesek64"}, "edited": false, "score": 0, "creation_date": 1439996432, "post_id": 32098956, "comment_id": 52092700, "body": "@Piesek64 yes, the compiler can&#39;t know at compile time how many rows the query may return"}, {"owner": {"reputation": 57, "user_id": 3422518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/79deac9c0f02f03696c16c7af110ab59?s=128&d=identicon&r=PG", "display_name": "Piesek64", "link": "https://stackoverflow.com/users/3422518/piesek64"}, "edited": false, "score": 0, "creation_date": 1439996745, "post_id": 32098956, "comment_id": 52092933, "body": "Applied the patch from your message and new problem. <a href=\"http://pastebin.com/vtEMY60C\" rel=\"nofollow noreferrer\">pastebin.com/vtEMY60C</a>"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 57, "user_id": 3422518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/79deac9c0f02f03696c16c7af110ab59?s=128&d=identicon&r=PG", "display_name": "Piesek64", "link": "https://stackoverflow.com/users/3422518/piesek64"}, "edited": false, "score": 0, "creation_date": 1439996900, "post_id": 32098956, "comment_id": 52093057, "body": "@Piesek64 add an explicit type signature for <code>res</code>. <code>mapM_</code> is not limited to lists in <code>ghc-7.10</code>, so the compiler needs a hint."}, {"owner": {"reputation": 57, "user_id": 3422518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/79deac9c0f02f03696c16c7af110ab59?s=128&d=identicon&r=PG", "display_name": "Piesek64", "link": "https://stackoverflow.com/users/3422518/piesek64"}, "edited": false, "score": 0, "creation_date": 1439996988, "post_id": 32098956, "comment_id": 52093137, "body": "Sorry if I am irritating but I am new to Haskell. How can I do that?"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 2, "last_activity_date": 1439997042, "last_edit_date": 1439997042, "creation_date": 1439996050, "answer_id": 32098956, "question_id": 32098328, "link": "https://stackoverflow.com/questions/32098328/no-instance-for-database-sqlite-simple-fromfield-fromfield-char/32098956#32098956", "title": "No instance for Database.SQLite.Simple.FromField.FromField Char", "body": "<p>You are using <code>res</code> as a <code>[String]</code>:</p>\n\n<pre><code>mapM_ putStrLn res\n</code></pre>\n\n<p>It is equivalent to <code>[[Char]]</code>. But <code>queryNamed</code> returns a list of rows, so each row has type <code>[Char]</code>. There is an <code>instance FromField a =&gt; FromRow [a]</code>, but there is no <code>instance FromField Char</code>. That is what the error messages says.</p>\n\n<p>I never used <code>sqlite-simple</code>, but it is clear that each row contains a number of fields, so you are trying to fetch a row that contains a number of fields of type <code>Char</code>. That makes no sense. Depending on actual database scheme, each row should be e.g. a number of text field, then the <code>res</code> can have type <code>[[String]]</code>. In that case you should use it like the next:</p>\n\n<pre><code>mapM_ (mapM_ putStrLn) (res :: [[String]])\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 3422518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/79deac9c0f02f03696c16c7af110ab59?s=128&d=identicon&r=PG", "display_name": "Piesek64", "link": "https://stackoverflow.com/users/3422518/piesek64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 32098956, "answer_count": 1, "score": 2, "last_activity_date": 1439997042, "creation_date": 1439994460, "last_edit_date": 1439994560, "question_id": 32098328, "link": "https://stackoverflow.com/questions/32098328/no-instance-for-database-sqlite-simple-fromfield-fromfield-char", "title": "No instance for Database.SQLite.Simple.FromField.FromField Char", "body": "<p>This code gives me an error:</p>\n\n<pre><code>67:    isFileInstalled f = do\n68:                dbcon &lt;- open \"/var/lib/beaver/pkgs.db\"\n69:                res &lt;- queryNamed dbcon \"SELECT * FROM files WHERE path = :path\" [\":path\" := (\"/usr/bin/getpkg\" :: String)]\n70:                mapM_ putStrLn res\n71:                -- when (null res) (return ())\n72:                -- putStrLn (\"File \" ++ res ++ \" is already installed and comes from \" ++ res ++ \".\") -- first res is `owner` and second is `path`\n73:                close dbcon\n74:                exit\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>No instance for (Database.SQLite.Simple.FromField.FromField Char)\n     arising from a use of `queryNamed'    In a stmt of a 'do' block:\n     res &lt;- queryNamed\n              dbcon\n              \"SELECT * FROM files WHERE path = :path\"\n              [\":path\" := (\"/usr/bin/getpkg\" :: String)]    In the expression:\n     do { dbcon &lt;- open \"/var/lib/beaver/pkgs.db\";\n          res &lt;- queryNamed\n                   dbcon\n                   \"SELECT * FROM files WHERE path = :path\"\n                   [\":path\" := (\"/usr/bin/getpkg\" :: String)];\n          mapM_ putStrLn res;\n          close dbcon;\n          .... }    In an equation for `isFileInstalled':\n       isFileInstalled f\n         = do { dbcon &lt;- open \"/var/lib/beaver/pkgs.db\";\n                res &lt;- queryNamed\n                         dbcon\n                         \"SELECT * FROM files WHERE path = :path\"\n                         [\":path\" := (\"/usr/bin/getpkg\" :: String)];\n                mapM_ putStrLn res;\n</code></pre>\n\n<p>I didn't find anything in Google. If it's important, OverloadedStrings are enabled. Is there workaround (or way to fix it)?</p>\n"}, {"tags": ["list", "haskell", "tuples", "combinations"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 3, "creation_date": 1440026134, "post_id": 32093912, "comment_id": 52108601, "body": "When types of <code>[a, b]</code> and <code>[c, d]</code> are equal, you can write <code>sequence [[a, b], [c, d]]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "edited": false, "score": 0, "creation_date": 1439983723, "post_id": 32093988, "comment_id": 52082909, "body": "No, it doesn&#39;t indeed, thanks; I was just wondering whether there was a builtin that does this; something like <code>combos xs ys</code> that produces the same result."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "edited": false, "score": 11, "creation_date": 1439983785, "post_id": 32093988, "comment_id": 52082958, "body": "@Ben: <code>combos = liftA2(,)</code>, which is basically equivalent to Jubobs&#39; suggestion."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439991052, "post_id": 32093988, "comment_id": 52088346, "body": "@leftaroundabout very nice use of applicatives!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 30, "last_activity_date": 1439983038, "creation_date": 1439983038, "answer_id": 32093988, "question_id": 32093912, "link": "https://stackoverflow.com/questions/32093912/all-combinations-of-elements-of-two-lists-in-haskell/32093988#32093988", "title": "All combinations of elements of two lists in Haskell", "body": "<pre><code>[ (x,y) | x&lt;-[a,b], y&lt;-[c,d] ]\n</code></pre>\n\n<p>This doesn't really require any further explanation, does it?</p>\n"}, {"tags": [], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "is_accepted": false, "score": 7, "last_activity_date": 1439983057, "creation_date": 1439983057, "answer_id": 32093997, "question_id": 32093912, "link": "https://stackoverflow.com/questions/32093912/all-combinations-of-elements-of-two-lists-in-haskell/32093997#32093997", "title": "All combinations of elements of two lists in Haskell", "body": "<p>use List Comprehension:</p>\n\n<pre><code>s = [a,b]\ns' = [c,d]\n\nall_combinations = [(x,y) | x &lt;- s, y &lt;- s']\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1439983706, "post_id": 32094043, "comment_id": 52082895, "body": "Worth to note that <code>do</code>-notation and list comprehensions are actually both syntactic sugar for the the same monadic combinators, namely <code>[a,b] &gt;&gt;= \\x -&gt; [c,d] &gt;&gt;= \\y -&gt; return (x,y)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1461627676, "post_id": 32094043, "comment_id": 61274794, "body": "@leftaroundabout, that&#39;s simply not true. List comprehensions have not one but two treatments in the desugarer, neither of which produces <code>&gt;&gt;=</code> or <code>return</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1461661343, "post_id": 32094043, "comment_id": 61287996, "body": "Indeed; one needs to enable <code>-XMonadComprehensions</code> so the list comprehensions actually use <code>&gt;&gt;=</code> and <code>return</code>. Without that extension, they use the equivalent list-specific functions."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 11, "last_activity_date": 1439986482, "last_edit_date": 1439986482, "creation_date": 1439983188, "answer_id": 32094043, "question_id": 32093912, "link": "https://stackoverflow.com/questions/32093912/all-combinations-of-elements-of-two-lists-in-haskell/32094043#32094043", "title": "All combinations of elements of two lists in Haskell", "body": "<p>How can you do this in an imperative pseudocode?</p>\n\n<pre><code>for each element x in [a,b]:\n    for each element y in [c,d]:\n        produce (x,y)\n</code></pre>\n\n<p>In Haskell, this is written as</p>\n\n<pre><code>outerProduct xs ys =\n   do\n       x &lt;- xs          -- for each x drawn from xs:\n       y &lt;- ys          --   for each y drawn from ys:\n       return (x,y)     --      produce the (x,y) pair\n</code></pre>\n\n<hr>\n\n<p><em>(following comments by leftaroundabout)</em> this is of course <em>extremely</em> close to how <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#v:liftM2\" rel=\"noreferrer\"><code>liftM2</code></a> monadic combinator is defined, so in fact</p>\n\n<pre><code>outerProduct = liftM2 (,)\n</code></pre>\n\n<p>which  is the same as <code>liftA2 (,)</code>, and its various re-writes in terms of list comprehensions, <code>concatMap</code> function, <code>&gt;&gt;=</code>, <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> operators. </p>\n\n<p>Conceptually though this is the stuff of the <code>Applicative</code> &ndash; which would be better named as <code>Pairing</code>, &ndash; because this pairing up of the elements of two <em>\"containers\" &frasl; \"carriers\" &frasl; whatever</em> is exactly what Applicative Functor is about. It just so happens that Haskell's <code>do</code> notation works for monads, and not (<em>yet</em>) <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ApplicativeDo\" rel=\"noreferrer\">for applicatives</a>.</p>\n\n<p>In some sense <em>compile-time</em> nested loops <em>are</em> Applicative &frasl; Pairing functors; Monads add the ability to create nested loops on the fly, depending on the values produced by an \"outer\" enumeration. </p>\n"}, {"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": false, "score": 18, "last_activity_date": 1440146140, "last_edit_date": 1495540040, "creation_date": 1439983632, "answer_id": 32094190, "question_id": 32093912, "link": "https://stackoverflow.com/questions/32093912/all-combinations-of-elements-of-two-lists-in-haskell/32094190#32094190", "title": "All combinations of elements of two lists in Haskell", "body": "<p>Applicative style all the way!</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; :m + Control.Applicative\n\u03bb&gt; (,) &lt;$&gt; ['a','b'] &lt;*&gt; ['c','d']\n[('a','c'),('a','d'),('b','c'),('b','d')]\n</code></pre>\n\n<p>(I've eschewed any <code>String</code> syntactic sugar above, in order to stay close to your example.)</p>\n\n<p>For information, <code>(,)</code> is special syntax for a function that takes two arguments and makes a pair out of them:</p>\n\n<pre><code>\u03bb&gt; :t (,)\n(,) :: a -&gt; b -&gt; (a, b)\n</code></pre>\n\n<hr>\n\n<p>Edit: As noted by <a href=\"https://stackoverflow.com/users/745903/leftaroundabout\">leftaroundabout</a> in <a href=\"https://stackoverflow.com/questions/32093912/all-combinations-of-elements-of-two-lists-in-haskell#comment52082958_32093988\">his comment</a>, you can also use <code>liftA2</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; :m + Control.Applicative\n\u03bb&gt; let combine = liftA2 (,)\n\u03bb&gt; combine \"ab\" \"cd\"\n[('a','c'),('a','d'),('b','c'),('b','d')]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2138, "user_id": 2794292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e3e4f141c783c6562d345d77f685417?s=128&d=identicon&r=PG&f=1", "display_name": "concept3d", "link": "https://stackoverflow.com/users/2794292/concept3d"}, "is_accepted": false, "score": 9, "last_activity_date": 1439994927, "last_edit_date": 1439994927, "creation_date": 1439983841, "answer_id": 32094269, "question_id": 32093912, "link": "https://stackoverflow.com/questions/32093912/all-combinations-of-elements-of-two-lists-in-haskell/32094269#32094269", "title": "All combinations of elements of two lists in Haskell", "body": "<p>The most inuitive would be using list comprehension, other aproaches include using applicative functors: </p>\n\n<pre><code>(,) &lt;$&gt; [1,2,3] &lt;*&gt; [4,5,6]\n</code></pre>\n\n<p>So what does this do? </p>\n\n<p>Remember that <code>(,) :: a -&gt; b -&gt; (a, b)</code> Takes two arguments and returns a tuple.</p>\n\n<p><code>&lt;$&gt;</code> is acutally fmap, <code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>\nIt takes a function and lift it. In this case it takes <code>(,)</code> and lift it to work on list. So <code>let x = (,) &lt;$&gt; [1,2]</code> would generate <code>x :: [b -&gt; (Integer, b)]</code> which is the the list of functions that takes <code>b</code> and returns tuple with one fixed argument (Integer,b). Finally we apply it using <code>&lt;*&gt;</code> to generate all the combinations.</p>\n"}], "owner": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12400, "favorite_count": 5, "answer_count": 5, "score": 19, "last_activity_date": 1440146140, "creation_date": 1439982842, "last_edit_date": 1440145595, "question_id": 32093912, "link": "https://stackoverflow.com/questions/32093912/all-combinations-of-elements-of-two-lists-in-haskell", "title": "All combinations of elements of two lists in Haskell", "body": "<p>Given two lists, <code>[a, b]</code> and <code>[c, d]</code>, I'd like to get the following result:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[(a,c), (a,d), (b,c), (b,d)]\n</code></pre>\n\n<p>How can I do this in Haskell? Is there a built-in function for this, or should I implement one myself?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1439977469, "post_id": 32091612, "comment_id": 52078594, "body": "See <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1439984959, "post_id": 32092110, "comment_id": 52083733, "body": "if you are depending on the <a href=\"http://hackage.haskell.org/package/system-filepath-0.4.13.4\" rel=\"nofollow noreferrer\">system-filepath</a> library FilePath is <b>not</b> the same as <code>String</code> even though this library is deprecated a few projects still use it."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": true, "score": 3, "last_activity_date": 1439977849, "creation_date": 1439977849, "answer_id": 32092110, "question_id": 32091612, "link": "https://stackoverflow.com/questions/32091612/couldnt-match-type-char-with-value/32092110#32092110", "title": "Couldn&#39;t match type `[Char]&#39; with `Value&#39;", "body": "<p>The type of <code>execParamStatement</code> in <code>isFileInstalled</code> is:</p>\n\n<pre><code>execParamStatement :: SQLiteResult a =&gt; SQLiteHandle -&gt; String -&gt; [(String, Value)] -&gt; IO (Either String [[Row a]])\n</code></pre>\n\n<p>that means that <code>[(\":path\", f)]</code> is of type <code>[(String, Value)]</code> and <code>f</code> is dedecued to be of type <code>Value</code>. </p>\n\n<p>This all means that <code>isFileInstalled</code> is deduced to take a <code>Value</code> as first argument.</p>\n\n<p>Now in the other <code>installpkg</code> function you are calling:</p>\n\n<pre><code>mapM isFileInstalled (splitOn \" \" files)\n</code></pre>\n\n<p>and <code>mapM</code> is deduced to be from:</p>\n\n<pre><code>mapM :: (Traversable t, Monad m) =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>mapM :: (Value -&gt; IO b) -&gt; [Value] -&gt; IO [b]\n</code></pre>\n\n<p>for whatever <code>b</code> is deduced there (it's hard to figure out because you don't put explicit type signatures for functions).</p>\n\n<p>This all means that <code>mapM</code> is expected to get a list of <code>[Value]</code> from <code>(splitOn \" \" files)</code>, which it's not. <code>(splitOn \" \" files)</code> is returning a <code>[String]</code> which is incompatible with <code>[Value]</code>.</p>\n\n<p>Since <code>Value</code> has a constructor that takes a <code>String</code>, you can use:</p>\n\n<pre><code>(map Text . splitOn \" \" $ files)\n</code></pre>\n\n<p>instead of:</p>\n\n<pre><code>(splitOn \" \" files)\n</code></pre>\n\n<p>and make it type check at least.</p>\n\n<hr>\n\n<blockquote>\n  <p>Also, is there a way to convert string or text to FilePath?</p>\n</blockquote>\n\n<p>As far as <code>FilePath</code> is concerned, that's <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.html#FilePath\" rel=\"nofollow\">just an alias</a> for <code>String</code>, so you don't need to convert to it to use it in the context where it's required a <code>String</code>.</p>\n\n<hr>\n\n<p>Finally for the sake of those reading the code and you reasoning about it, <strong>write top level types signatures for functions</strong>, thanks.</p>\n"}], "owner": {"reputation": 57, "user_id": 3422518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/79deac9c0f02f03696c16c7af110ab59?s=128&d=identicon&r=PG", "display_name": "Piesek64", "link": "https://stackoverflow.com/users/3422518/piesek64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 32092110, "answer_count": 1, "score": 1, "last_activity_date": 1439977849, "creation_date": 1439976554, "question_id": 32091612, "link": "https://stackoverflow.com/questions/32091612/couldnt-match-type-char-with-value", "title": "Couldn&#39;t match type `[Char]&#39; with `Value&#39;", "body": "<p>I am writing package manager and I stuck at checking is file installed.</p>\n\n<pre><code>[1 of 1] Compiling Main             ( ../src/beaver.hs, ../src/.o/Main.o)\n../src/beaver.hs:57:37:\nCouldn't match type `[Char]' with `Value'\nExpected type: [Value]\n  Actual type: [[Char]]\nIn the second argument of `mapM', namely `(splitOn \" \" files)'\nIn a stmt of a 'do' block: mapM isFileInstalled (splitOn \" \" files)\n</code></pre>\n\n<p>Here is code of problematic function(s):</p>\n\n<pre><code>installpkg = do\n          args &lt;- getArgs\n          pkgname &lt;- readProcess \"beaver-pkgname\" [(args !! 1)] \"\"\n          extractpkg pkgname\n          files &lt;- metaprop \"files\" pkgname\n          mapM isFileInstalled (splitOn \" \" files)\n isFileInstalled f = do\n            dbcon &lt;- openConnection \"/var/lib/beaver/pkgs.db\"\n            res &lt;- execParamStatement dbcon \"SELECT owner FROM files WHERE path = :path\" [(\":path\", f)] :: IO (Either String [[Row Value]])\n            when (null res) (putStrLn \"file exists\")\n            closeConnection dbcon\n</code></pre>\n\n<p>I were searching for solution but I cannot find anything.</p>\n\n<p>Also, is there a way to convert string or text to FilePath?</p>\n"}, {"tags": ["algorithm", "performance", "list", "haskell"], "comments": [{"owner": {"reputation": 9484, "user_id": 1327235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e92c96d4ad697e78400e312fe40b23dc?s=128&d=identicon&r=PG", "display_name": "Juan Lopes", "link": "https://stackoverflow.com/users/1327235/juan-lopes"}, "edited": false, "score": 0, "creation_date": 1439965847, "post_id": 32087530, "comment_id": 52071512, "body": "What do you mean by &quot;all 3 perform roughly the same&quot;?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1439970021, "post_id": 32087530, "comment_id": 52073711, "body": "Not relevant, but... :  <code>go 0 result</code> should be <code>result (+) nil </code> (right?)"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 4, "creation_date": 1439972012, "post_id": 32087530, "comment_id": 52074911, "body": "Can you post the corresponding Core? (I.e., if it isn&#39;t absolutely gigantic.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1439973110, "post_id": 32087530, "comment_id": 52075598, "body": "For what it&#39;s worth, on my machine your native list version takes 0.76s on GHC 7.6.3 and GHC 7.8.4, but only 0.05s on GHC 7.10.1. The Church version takes about 0.06s on all three."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1439973250, "post_id": 32087530, "comment_id": 52075678, "body": "(Oh, and the custom list version is dog slow on all three. But considering that it&#39;s not written in the same guarded recursive style that the other two are, that&#39;s pretty understandable.)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 9484, "user_id": 1327235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e92c96d4ad697e78400e312fe40b23dc?s=128&d=identicon&r=PG", "display_name": "Juan Lopes", "link": "https://stackoverflow.com/users/1327235/juan-lopes"}, "edited": false, "score": 0, "creation_date": 1440046597, "post_id": 32087530, "comment_id": 52113451, "body": "@JuanLopes no less than 3x slower."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1440046643, "post_id": 32087530, "comment_id": 52113465, "body": "@MathematicalOrchid I&#39;m not well versed in Core, it is giving me something giant. What should I do?"}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1439976253, "post_id": 32090937, "comment_id": 52077682, "body": "Omitted GHC Core because it doesn&#39;t show us anything interesting beyond what I wrote above."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1439996919, "post_id": 32090937, "comment_id": 52093072, "body": "I would like to see it :( but okay! Thanks Andr&#225;s, I know someone would have the answer."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440038239, "post_id": 32090937, "comment_id": 52111441, "body": "Eh, are you sure it is compiled to a loop? The executable works even for really, really huge numbers. Looks like it is compiled to the sum formula... (?)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440046681, "post_id": 32090937, "comment_id": 52113472, "body": "(Maybe LLVM itself is compiling the loop to the formula, though?)"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440867053, "post_id": 32090937, "comment_id": 52454405, "body": "@Viclib Computers are really good at adding big numbers. They are bad at storing a big number of numbers."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 19, "last_activity_date": 1439974845, "creation_date": 1439974845, "answer_id": 32090937, "question_id": 32087530, "link": "https://stackoverflow.com/questions/32087530/why-summing-native-lists-is-slower-than-summing-church-encoded-lists-with-ghc/32090937#32090937", "title": "Why summing native lists is slower than summing church-encoded lists with `GHC -O2`?", "body": "<p>GHC 7.10 has <a href=\"http://www.joachim-breitner.de/publications/CallArity-TFP.pdf\">call arity</a> analysis, which lets us define <code>foldl</code> in terms of <code>foldr</code> and thus let left folds, including <code>sum</code>, participate in fusion. GHC 7.8 also defines <code>sum</code> with <code>foldl</code> but it can't fuse the lists away. Thus GHC 7.10 performs optimally and identically to the Church version.</p>\n\n<p>The Church version is child's play to optimize in either GHC versions. We just have to inline <code>(+)</code> and <code>0</code> into <code>fenumTil</code>, and then we have a patently tail-recursive <code>go</code> which can be readily unboxed and then turned into a loop by the code generator. </p>\n\n<p>The user-defined version is not tail-recursive and it works in linear space, which wrecks performance, of course. </p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 5, "accepted_answer_id": 32090937, "answer_count": 1, "score": 17, "last_activity_date": 1439974845, "creation_date": 1439963800, "last_edit_date": 1439964401, "question_id": 32087530, "link": "https://stackoverflow.com/questions/32087530/why-summing-native-lists-is-slower-than-summing-church-encoded-lists-with-ghc", "title": "Why summing native lists is slower than summing church-encoded lists with `GHC -O2`?", "body": "<p>In order to test how church-encoded lists perform against user-defiend lists and native lists, I've prepared 3 benchmarks:</p>\n\n<h3>User-defined lists</h3>\n\n<pre><code>data List a = Cons a (List a) | Nil deriving Show\nlenumTil n        = go n Nil where\n    go 0 result   = result\n    go n result   = go (n-1) (Cons (n-1) result)\nlsum Nil          = 0\nlsum (Cons h t)   = h + (lsum t)\n\nmain = print (lsum (lenumTil (100000000 :: Int)))\n</code></pre>\n\n<h3>Native lists</h3>\n\n<pre><code>main = print $ sum ([0..100000000-1] :: [Int])\n</code></pre>\n\n<h3>Church lists</h3>\n\n<pre><code>fsum   = (\\ a -&gt; (a (+) 0))\nfenumTil n cons nil = go n nil where\n    go 0 result    = result\n    go n result    = go (n-1) (cons (n-1) result)\nmain = print $ (fsum (fenumTil (100000000 :: Int)) :: Int)\n</code></pre>\n\n<p>The benchmark results are unexpected:</p>\n\n<h3>User-defined lists</h3>\n\n<pre><code>-- 4999999950000000\n-- real 0m22.520s\n-- user 0m59.815s\n-- sys  0m20.327s\n</code></pre>\n\n<h3>Native Lists</h3>\n\n<pre><code>-- 4999999950000000\n-- real 0m0.999s\n-- user 0m1.357s\n-- sys  0m0.252s\n</code></pre>\n\n<h3>Church Lists</h3>\n\n<pre><code>-- 4999999950000000\n-- real 0m0.010s\n-- user 0m0.002s\n-- sys  0m0.003s\n</code></pre>\n\n<p>One would expect that, with the huge amount of specific optimizations targeted to native lists, they would perform the best. Yet, church lists outperform them by a 100x factor, and outperform user-defined ADTs by a 2250x factor. I've compiled all programs with <code>GHC -O2</code>. I've tried replacing <code>sum</code> by <code>foldl'</code>, same result. I've attempted adding user-inputs to make sure the church-list version wasn't optimized to a constant. <code>arkeet</code> pointed out on #haskell that, by inspecting Core, the native version has an intermediate lists, but why? Forcing allocation with an additional <code>reverse</code>, all 3 perform roughly the same. </p>\n"}, {"tags": ["haskell", "functor", "monomorphism-restriction"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1439979368, "post_id": 32087134, "comment_id": 52079927, "body": "A l w a y s _ u s e _ t y p e _ s i g n a t u r e s _ a t _ t h e _ t o p _ l e v e l."}], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 2, "creation_date": 1439963258, "post_id": 32087263, "comment_id": 52070459, "body": "Uh, I feel some more dopamine flowing. That&#39;s a spectacular answer! Thank you!"}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1439967504, "post_id": 32087263, "comment_id": 52072304, "body": "+1 for the &quot;... it&#39;s useful to know the other two options...to write quick-and-dirty throaway Haskell scripts...&quot;... a world of possibilities to explore...."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 1, "creation_date": 1439979570, "post_id": 32087263, "comment_id": 52080054, "body": "@dsign can&#39;t really agree. To <i>explore possibilities</i>, it&#39;s much more efficient to let type signatures guide you. Omitting type signatures is OK for very simple tasks where you already know exactly what the type is, and can&#39;t be bothered to state the obvious by writing it down. OTOH, when entering new terrain, that&#39;s where you need signatures most, to ascertain you&#39;re going in the right direction."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 19, "last_activity_date": 1439963153, "last_edit_date": 1495541175, "creation_date": 1439962492, "answer_id": 32087263, "question_id": 32087134, "link": "https://stackoverflow.com/questions/32087134/haskell-type-inference-for-functors/32087263#32087263", "title": "Haskell type inference for Functors", "body": "<p>Your code is actually fine, except you ran into the <a href=\"https://stackoverflow.com/questions/4179453/why-are-polymorphic-values-not-inferred-in-haskell\"><strong>dreaded monomorphism restriction</strong></a> which kept Haskell from <em>inferring</em> the most general possible type for <code>replicator</code>.</p>\n\n<p>Essentially, with the restriction on, Haskell will not <em>infer</em> polymorphic types for bindings that do not look like functions. This means it <em>has</em> to pick a concrete functor like <code>[]</code> or <code>IO</code> for <code>replicate</code> and causes an error if you try to use it in two different contexts.</p>\n\n<p>You can make your code work in three ways:</p>\n\n<ul>\n<li><p>turn off the monomorphism restriction: add <code>{-# LANGUAGE NoMonomorphismRestriction #-}</code> at the top of your module.</p></li>\n<li><p>make <code>replicator</code> <em>look</em> like a function:</p>\n\n<pre><code>replicator x = fmap (replicate 3) x\n</code></pre></li>\n<li><p>add explicit type signatures to your code</p>\n\n<pre><code>replicator :: Functor f =&gt; f a -&gt; f [a]\nreplicator = fmap (replicate 3)\n</code></pre></li>\n</ul>\n\n<p>The third option is the most idiomatic. Good Haskell style involves adding explicit type signatures to all of your top-level identifiers. However, it's useful to know the other two options to understand what's going on and to be able to write quick-and-dirty throwaway scripts in Haskell without worrying about type signatures.</p>\n"}], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 32087263, "answer_count": 1, "score": 8, "last_activity_date": 1439972302, "creation_date": 1439961869, "last_edit_date": 1439972302, "question_id": 32087134, "link": "https://stackoverflow.com/questions/32087134/haskell-type-inference-for-functors", "title": "Haskell type inference for Functors", "body": "<p>Lately I've been playing around with Haskell, and specifically the whole functors concept. The more I dive into it, the more a-ha moments I'm getting, and it certainly tickles my dopamine receptors quite a bit.</p>\n\n<p>The problem I'm stuck with is the following. Here's the code that works, it lifts the function and then applies it first to the IO value, and then to a List.</p>\n\n<pre><code>replicator1 =\n  fmap (replicate 3)\n\nreplicator2 =\n  fmap (replicate 3)\n\nmain = do\n  replicated &lt;- replicator1 getLine\n  print (replicator2 replicated)\n</code></pre>\n\n<p>It is very tempting to write it in a more concise manner, i.e.:</p>\n\n<pre><code>replicator =\n  fmap (replicate 3)\n\nmain = do\n  replicated &lt;- replicator getLine\n  print (replicator replicated)\n</code></pre>\n\n<p>Part of me says it's conceptually right, since <code>replicator</code> should be applyable both to IO and to List instances, but being a strongly typed language Haskell doesn't allow me to do so. I think I pretty much understand why is this happening.</p>\n\n<p>The question is: is there any way I can get any closer to the latter variant? Or is it fine to live with the former?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["swift", "haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1439933591, "post_id": 32082724, "comment_id": 52062042, "body": "To add to this answer, contravariance happens when the type variables appear in &quot;negative&quot; positions - that is, to the left of the function arrow. Covariance happens when the type variables appear on the right side of the function arrow. In this case the type variables are <code>A</code> and <code>B</code>. We have contravariance here because in <code>(C,B) -&gt; C</code> and (C,A) -&gt; C` both <code>A</code> and <code>B</code> are in negative positions."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1439932698, "creation_date": 1439932698, "answer_id": 32082724, "question_id": 32082320, "link": "https://stackoverflow.com/questions/32082320/transducers-in-swift/32082724#32082724", "title": "Transducers in Swift", "body": "<p>The order is inverted because your <code>mapping</code> is acting on the argument. You are using an <code>A -&gt; B</code> function to make a <code>(C,A)</code> pair fit the type of a <code>(C,B) -&gt; C</code> function. So what you get in the end is a <code>(C,A) -&gt; C</code> function which converts the <code>A</code> in the pair to a <code>B</code> as a preliminary step.</p>\n\n<p>On a more general note, <code>mapping</code> provides an example of a <em>contravariant functor</em>, as opposed to covariant functors (e.g. Haskell's <code>Functor</code> class) in which the order is not inverted. For the sake of illustration, here is a <a href=\"https://hackage.haskell.org/package/contravariant-1.3.2/docs/Data-Functor-Contravariant.html\" rel=\"nofollow\">relevant Haskell package</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 4958, "user_id": 1950419, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eb2dbe4bb1fc718c1bd15bc4de84065c?s=128&d=identicon&r=PG", "display_name": "avismara", "link": "https://stackoverflow.com/users/1950419/avismara"}, "edited": false, "score": 0, "creation_date": 1439991718, "post_id": 32085173, "comment_id": 52088892, "body": "Took a while to get this answer. Had to refresh my Engineering Mathematics. Thanks!"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 4, "last_activity_date": 1439948163, "creation_date": 1439948163, "answer_id": 32085173, "question_id": 32082320, "link": "https://stackoverflow.com/questions/32082320/transducers-in-swift/32085173#32085173", "title": "Transducers in Swift", "body": "<p>Look at where the call to <code>f</code> actually takes place. It's transforming an <code>A</code> to a <code>B</code>, and the result is used as an argument to <code>r</code>. Therefore <code>r</code> must be expecting a <code>B</code>; we're using an <code>A -&gt; B</code> function to preprocess the input to a <code>(C, B) -&gt; C</code> function, resulting in a <code>(C, A) -&gt; C</code> function.</p>\n\n<p>In general this reversal happens whenever we're transforming a system to change its \"input\". If we're transforming a system to change its \"output\", there is no reversal<sup>1</sup>.</p>\n\n<pre><code>X -&gt; A   ---&gt;   A -&gt; B   ---&gt;   B -&gt; Y\n</code></pre>\n\n<p>If I have an <code>A -&gt; B</code> function and I want to make from it something that emits <code>Y</code>s instead, I need to map a over it's output <code>B -&gt; Y</code> function. This is known as <em>covariance</em>, because the thing I want to change (the <code>B</code> in <code>A -&gt; B</code>) \"varies with\" the function I map over it (<code>B -&gt; Y</code>). The <code>B</code> is said to be in a positive position in <code>A -&gt; B</code>.</p>\n\n<p>If I have an <code>A -&gt; B</code> function and I want to make from it something that takes <code>X</code>s instead, I need to map a <code>X -&gt; A</code> function over its input. This is known as <em>contravariance</em>, because the thing I want to change (the <code>A</code> in <code>A -&gt; B</code>) \"varies against\" the function I map over it (<code>X -&gt; A</code>). The <code>A</code> is said to be in a negative position in <code>A -&gt; B</code>.</p>\n\n<hr>\n\n<p><sup>1</sup> Higher order programming means that we can be transforming a system to change an input within the output of something that's an input to an outpu \"of our system...! The terms \"negative position\" and \"positive position\" help hint that the negative of a negative is a positive, etc.</p>\n"}], "owner": {"reputation": 4958, "user_id": 1950419, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eb2dbe4bb1fc718c1bd15bc4de84065c?s=128&d=identicon&r=PG", "display_name": "avismara", "link": "https://stackoverflow.com/users/1950419/avismara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 32085173, "answer_count": 2, "score": 5, "last_activity_date": 1439948163, "creation_date": 1439931009, "question_id": 32082320, "link": "https://stackoverflow.com/questions/32082320/transducers-in-swift", "title": "Transducers in Swift", "body": "<p>I was learning functional programming in Swift through Haskell and came across this interesting concept of Transducers. One code example implemented a <code>mapping</code> function that basically spits out a Transducer, given that we pass the transformation rule as a parameter.</p>\n\n<p>Inspired, I quickly translated this to a Swift equivalent and this is what I got: </p>\n\n<pre><code>func mapping &lt; A, B, C&gt; (f: A -&gt; B) -&gt; ( ( (C,B) -&gt; C) -&gt; ( (C,A) -&gt; C) ) {\n    return { r in\n        return { result, a in\n            return r(result,f(a))\n\n        }\n\n    }\n}\n</code></pre>\n\n<p>My question now is that notice how the transformation function goes from A to B ( <code>(A -&gt; B)</code> ), but the transducer goes from B to A ( <code>( (C,B) -&gt; C) -&gt; ( (C,A) -&gt; C)</code> )? Why is that? I'm sure that this is not coincidental, because that order matters. Haskell experts, anyone?</p>\n"}, {"tags": ["haskell", "ghc", "overlapping-instances"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439934007, "post_id": 32082281, "comment_id": 52062220, "body": "The overlapping/overlappable thing is 7.10 only. I don&#39;t know what&#39;s causing your problem, but you might be able to solve it by not using overlapping instances."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1439934392, "post_id": 32082281, "comment_id": 52062383, "body": "Also, <code>MIN_VERSION_base</code> isn&#39;t really a sane way to check for GHC features. Use <code>__GLASGOW_HASKELL__ &gt;= 710</code> instead. Check the base library version only to check if the base library is what you need."}, {"owner": {"reputation": 97, "user_id": 594712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/266afa3fd63f97c25fc5dc4b5305235c?s=128&d=identicon&r=PG", "display_name": "codedmart", "link": "https://stackoverflow.com/users/594712/codedmart"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439946723, "post_id": 32082281, "comment_id": 52065880, "body": "@dfeuer you mean not using overlapping instances by rewriting the instances so I don&#39;t need overlapping?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439949157, "post_id": 32082281, "comment_id": 52066435, "body": "I&#39;m not yet convinced that they&#39;re actually a good idea. They can make for pretty APIs, but they feel limited in odd ways."}], "answers": [{"tags": [], "owner": {"reputation": 97, "user_id": 594712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/266afa3fd63f97c25fc5dc4b5305235c?s=128&d=identicon&r=PG", "display_name": "codedmart", "link": "https://stackoverflow.com/users/594712/codedmart"}, "is_accepted": true, "score": 0, "last_activity_date": 1440597819, "creation_date": 1440597819, "answer_id": 32228885, "question_id": 32082281, "link": "https://stackoverflow.com/questions/32082281/can-i-specify-overlapping-overlappable-in-7-8-like-7-10-in-haskell/32228885#32228885", "title": "Can I specify overlapping/overlappable in 7.8 like 7.10 in Haskell?", "body": "<p>This is not possible with OverlappingInstances in 7.8. Need to rewrite instances so there is no need for the OverlappingInstances pragma.</p>\n"}], "owner": {"reputation": 97, "user_id": 594712, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/266afa3fd63f97c25fc5dc4b5305235c?s=128&d=identicon&r=PG", "display_name": "codedmart", "link": "https://stackoverflow.com/users/594712/codedmart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 32228885, "answer_count": 1, "score": 2, "last_activity_date": 1440597819, "creation_date": 1439930826, "last_edit_date": 1439932714, "question_id": 32082281, "link": "https://stackoverflow.com/questions/32082281/can-i-specify-overlapping-overlappable-in-7-8-like-7-10-in-haskell", "title": "Can I specify overlapping/overlappable in 7.8 like 7.10 in Haskell?", "body": "<p>Is it possible to specify which instance is overlapping and which instance is overlappable with ghc 7.8 OverlappingInstances?</p>\n\n<p>I am trying to make some updates/changes in the servant/servant-server packages. Everything compiles fine and all test pass except one doctest which was passing before I added this change <a href=\"https://github.com/haskell-servant/servant/pull/178/files#diff-26c77b42ff1a73d56e9ffbc3da5c0377L55\" rel=\"nofollow\">Enter instance for Raw</a>. The doctest only fails on ghc 7.8, and passes on ghc 7.10. I believe this is related to the fact that ghc 7.10 I can specify which instance is overlapping and which instance is overlappable. How can I accomplish this is ghc 7.8? Any ideas/pointers would be greatly appreciated. Here is the doctest and failing error I am getting on ghc 7.8:</p>\n\n<pre><code>-- &gt;&gt;&gt; import Control.Monad.Reader\n-- &gt;&gt;&gt; import qualified Control.Category as C\n-- &gt;&gt;&gt; type ReaderAPI = \"ep1\" :&gt; Get '[JSON] Int :&lt;|&gt; \"ep2\" :&gt; Get '[JSON] String\n-- &gt;&gt;&gt; let readerServer = return 1797 :&lt;|&gt; ask :: ServerT ReaderAPI (Reader String)\n-- &gt;&gt;&gt; let mainServer = enter (generalizeNat C.. (runReaderTNat \"hi\")) readerServer :: Server ReaderAPI\n--\n\n-- $setup\n-- &gt;&gt;&gt; import Servant.API\n-- &gt;&gt;&gt; import Servant.Server\n\n-- Error\n### Failure in src/Servant/Server.hs:129: expression `let mainServer = enter (generalizeNat C.. (runReaderTNat \"hi\")) readerServer :: Server ReaderAPI'\nexpected:\nbut got:\n          &lt;interactive&gt;:44:18:\n              Couldn't match type \u2018Control.Monad.Trans.Either.EitherT\n                                     ServantErr IO [Char]\u2019\n                            with \u2018ReaderT String Data.Functor.Identity.Identity [Char]\u2019\n              In the expression:\n                  enter (generalizeNat C.. (runReaderTNat \"hi\")) readerServer ::\n                    Server ReaderAPI\n              In an equation for \u2018mainServer\u2019:\n                  mainServer\n                    = enter (generalizeNat C.. (runReaderTNat \"hi\")) readerServer ::\n                        Server ReaderAPI\n</code></pre>\n"}, {"tags": ["haskell", "overloading"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439972831, "post_id": 32082109, "comment_id": 52075421, "body": "The error means: &quot;You want a type that satisfies both the constraint <code>Fractional</code> and <code>Integral</code> but I don&#39;t know any type that does.&quot; Moreover this probably has also to do with defaulting (which is used in <code>Num</code> contexts), so the problem is also that <code>13</code> is polymorphic and <code>getNext</code> is polymorphic too, so even having a type that has both instances you&#39;d get an error similar to doing things like: <code>show . read</code>."}], "answers": [{"tags": [], "owner": {"reputation": 21422, "user_id": 333698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca080b4ef1c6cb4df9bc123d3b3af61?s=128&d=identicon&r=PG", "display_name": "psmears", "link": "https://stackoverflow.com/users/333698/psmears"}, "is_accepted": true, "score": 7, "last_activity_date": 1439930199, "creation_date": 1439930199, "answer_id": 32082144, "question_id": 32082109, "link": "https://stackoverflow.com/questions/32082109/unresolved-overloading-error-in-haskell/32082144#32082144", "title": "Unresolved overloading error in Haskell", "body": "<p>You probably want</p>\n\n<pre><code>a `div` 2\n</code></pre>\n\n<p>rather than</p>\n\n<pre><code>a/2\n</code></pre>\n\n<p>The error is happening because <code>even a</code> implies that <code>a</code> is an integer, but the use of the non-integer division operator <code>/</code> implies otherwise.</p>\n"}], "owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "accepted_answer_id": 32082144, "answer_count": 1, "score": 4, "last_activity_date": 1439930199, "creation_date": 1439930028, "question_id": 32082109, "link": "https://stackoverflow.com/questions/32082109/unresolved-overloading-error-in-haskell", "title": "Unresolved overloading error in Haskell", "body": "<pre><code>getNext a = if even a then a/2 else (3*a)+1 \n</code></pre>\n\n<p>for some reason this line of code returns an unresolved overloading error. </p>\n\n<pre><code>Main&gt; getNext 13\nERROR - Unresolved overloading\n*** Type       : (Fractional a, Integral a) =&gt; a\n</code></pre>\n\n<p>What am I doing wrong or what am I missing? I haven't used Haskell in quite some time so I might have forgotten a few things. </p>\n"}, {"tags": ["shell", "haskell", "io", "lazy-evaluation"], "comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 3, "creation_date": 1439923560, "post_id": 32080172, "comment_id": 52056690, "body": "First thing I notice is that your <code>if then else</code> phrase seems wrong. Try swapping the then expression with the else expression. You want to return when n==0... Of course you could also split it up using pattern matching: <code>main1 0 = do return(); main1 n = do ExitSuccess &lt;- system (...); main1 (n-1);</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1439923861, "post_id": 32080172, "comment_id": 52056847, "body": "There are nicer ways to write this, but the only real problem is the the test in your loop is wrong. You want something like <code>n &gt; 1</code> rather than <code>n == 0</code>."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1439923869, "post_id": 32080172, "comment_id": 52056856, "body": "@BitTickler thanks a lot. it works fine. sorry for the trouble. I accept your suggestion as answer turn it into answer."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439972974, "post_id": 32080172, "comment_id": 52075507, "body": "A note on your python program: you <i>should</i> avoid <code>os.system</code>. Use <code>subprocess.call</code> instead: <code>from subprocess import call; call([&#39;echo&#39;, str(i)]); call([&#39;sleep&#39;, &#39;2&#39;])</code>. When (and only when) you need shell features you can pass <code>shell=True</code> to <code>call</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1439953837, "post_id": 32080445, "comment_id": 52067647, "body": "Why count down? The Python program looks like it counts up."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439995225, "post_id": 32080445, "comment_id": 52091726, "body": "The original Haskell program counts down, that&#39;s all. I just wanted to point out how to use a <code>forM_</code> loop - just like you would do in Python - instead of using recursion."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1439923845, "creation_date": 1439923845, "answer_id": 32080445, "question_id": 32080172, "link": "https://stackoverflow.com/questions/32080172/haskell-not-executing-all-external-shell-commands/32080445#32080445", "title": "Haskell not executing all external shell commands", "body": "<p>How about writing more like the Python version using <code>forM_</code>:</p>\n\n<pre><code>import Control.Monad\n\nmain1 n = do\n  forM_ [n,n-1 .. 1] $ \\n -&gt; do\n    ExitSuccess &lt;- system (\"echo \" ++ (show n))\n    ExitSuccess &lt;- system \"sleep 2\"\n    return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 0, "last_activity_date": 1439973666, "creation_date": 1439973666, "answer_id": 32090528, "question_id": 32080172, "link": "https://stackoverflow.com/questions/32080172/haskell-not-executing-all-external-shell-commands/32090528#32090528", "title": "Haskell not executing all external shell commands", "body": "<p>The program is doing what you are telling him to do:</p>\n\n<pre><code>main1 n = do\n ExitSuccess &lt;- system (\"echo \" ++ (show n))\n ExitSuccess &lt;- system \"sleep 2\"\n if n == 0 then (main1 (n-1)) else return ()\n</code></pre>\n\n<p>Here we have <code>n == 6</code> so the condition of the <code>if</code> is false and then <code>return ()</code> is executed, which terminates <code>main1</code> doing nothing.</p>\n\n<p>Note that if you passed <code>n == 0</code> the condition would be true and it would execute <code>main1 (-1)</code> which then stops. In any case <code>main1</code> will <strong>not</strong> repeat the commands <code>n</code> times it will always either execute them once (if <code>n /= 0</code>) or twice (if <code>n == 0</code>).</p>\n\n<p>You could fix this by doing:</p>\n\n<pre><code>main1 n = do\n ExitSuccess &lt;- system (\"echo \" ++ (show n))\n ExitSuccess &lt;- system \"sleep 2\"\n if n &gt; 0 then main1 (n-1) else return ()\n</code></pre>\n\n<p>Or, equivalently:</p>\n\n<pre><code>import Control.Monad\n\nmain1 n = do\n ExitSuccess &lt;- system (\"echo \" ++ (show n))\n ExitSuccess &lt;- system \"sleep 2\"\n when (n &gt; 0) $ main1 (n-1)\n</code></pre>\n\n<p>The problem here is that you are using general recursion to repeat a given statement. But general recursion can do anything and so you can easily produce bugs (as in your case). To avoid this it's often useful to use some other function to build your code. For example:</p>\n\n<pre><code>main1 n = sequence_ $ map execute [1..n]\n\nexecute i = do\n  ExitSuccess &lt;- system $ \"echo\" ++ show i\n  ExitSuccess &lt;- system $ \"sleep 2\"\n  return ()\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>main1 n = mapM_ execute [1..n]\n</code></pre>\n\n<p>Here you know what <code>mapM_</code> and <code>[1..n]</code> do and so combining them tells you that you the <code>execute</code> action will be executed <code>n</code> times.</p>\n\n<hr>\n\n<p>In any case the <code>IO</code> monad <em>guarantees</em> the the actions are all executed and in order, so you should not attribute to Haskell lazyness the fact that the code wasn't executed the expected number of times.</p>\n\n<p>The problem with lazyness and input/output are different.</p>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 32080445, "answer_count": 2, "score": 0, "last_activity_date": 1439973666, "creation_date": 1439922862, "last_edit_date": 1495541177, "question_id": 32080172, "link": "https://stackoverflow.com/questions/32080172/haskell-not-executing-all-external-shell-commands", "title": "Haskell not executing all external shell commands", "body": "<p><strong>I wrote this program and I compiled with:</strong></p>\n\n<pre><code>ghc --make shell.hs\n</code></pre>\n\n<p><strong>When I run it looks like:</strong></p>\n\n<pre><code>$./shell\nenter your number:\n6\n6\nokay... it execute 6 time...\n</code></pre>\n\n<p>If I remove the <code>sleep 2</code> statement then it exits fast but outputs only <code>6</code>.</p>\n\n<p>I tried to follow the advice (which is what is in the code below) given <a href=\"https://stackoverflow.com/a/9713739/4725700\">at this answer</a> of a similar question but it didn't work.</p>\n\n<p>It seems very strange that it is not executing all the commands. How do I force it to execute all commands and in a strict order? the lazyness is a good feature but when it comes to <em>IO</em> it just sucks or I am not enough of an expert to understand it.</p>\n\n<p>What I want to do is execute all commands from a list in a strict order and I don't want <em>Haskell</em> to \"intelligently\" remove some of the commands on my behalf (if I want to execute sleep for 2 seconds in the shell, I should be allowed to do so).</p>\n\n<p>If <code>waitForProcess</code> has to be used to resolve this, then my problem is I don't know how to use it. I have tried google but failed to see a simple example of it.</p>\n\n<p>Please note that I want a working code solution for the program code I have given below and there should be a reasonable guarantee that the program works as expected on bash running on a typical Linux (say, Debian 7) as the <em>Python</em> program given below it runs.</p>\n\n<pre><code>import System.Process\nimport System.Exit\n\nmain = do\n putStrLn \"enter your number:\"\n n &lt;- getLine\n main1 (readInt n)\n putStrLn (\"okay... it execute \" ++ n ++\" time...\")\n\nreadInt:: String -&gt; Int\nreadInt = read\n\nmain1 n = do\n ExitSuccess &lt;- system (\"echo \" ++ (show n))\n ExitSuccess &lt;- system \"sleep 2\"\n if n == 0 then (main1 (n-1)) else return ()\n</code></pre>\n\n<p><strong>Below is a <em>Python</em> program and it works as desired with proper <code>sleep</code>:</strong></p>\n\n<pre><code>import os\nfor i in range(6):\n  os.system(\"echo \" + str(i))\n  os.system(\"sleep 2\")\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439915730, "post_id": 32077856, "comment_id": 52052215, "body": "Almost all <code>cabal</code> packages are not dependent on the newest version of a dependency package, but rather a specific version of that dependency. <code>Cabal</code> resolves the dependencies by downloading the <i>required</i> package version not the <i>newest</i> package version."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439915879, "post_id": 32077856, "comment_id": 52052276, "body": "@recursion.ninja: Is there a way to do (2) \u2014 wait, where&#39;d my numbers go?! \u2014that is, to get a list of the packages that have updates relative to those currently on my system?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439916049, "post_id": 32077856, "comment_id": 52052386, "body": "@recursion.ninja: And, I&#39;m not sure I understand the model. Say, for example, the version of X (which depends on a, b, and c which have not changed, and on p, q, and r, which have) I have is older than the current version, and I&#39;d like to upgrade it. How am I to proceed to update X? (Using pip for Python, for example I&#39;d just update X, p, q, and r \u2014 or more succinctly, update X which would update p, q, and r \u2014 and I&#39;d be done; no worries.)"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439916472, "post_id": 32077856, "comment_id": 52052589, "body": "<code>cabal update &amp;&amp; cabal info packageName</code>. Look at the output to see the available version numbers for <code>packageName</code>. This will show you all the available versions and which version(s) you have installed. To install a specific version, such as a newer version do the following: <code>cabal install packageName-1.2.3.4</code> where <code>1.2.3.4</code> is the newer version number."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 2, "creation_date": 1439916604, "post_id": 32077856, "comment_id": 52052651, "body": "You should note that installing a newer version <b>will not</b> link the newer version to other packages that depend on <code>packageName</code>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439917459, "post_id": 32077856, "comment_id": 52053121, "body": "@recursion.ninja: To a pip user, if the only option is to wade through the output of <code>cabal info</code>, then it sounds like the answer to (2) is &quot;no&quot;."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439917881, "post_id": 32077856, "comment_id": 52053358, "body": "You are correct, you might be able to come up with some slick <code>awk</code> &amp; <code>sed</code> command to generate the list from <code>cabal info</code> output after iterating over the results of <code>ghc-pkg list</code>..."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439917511, "post_id": 32078182, "comment_id": 52053154, "body": "Does running <a href=\"http://stackoverflow.com/a/6905267/656912\">this workaround</a> periodically make sense?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1439918010, "post_id": 32078182, "comment_id": 52053431, "body": "@raxacoricofallapatorius I would advise against running it automatically periodically. Just run it when you discover that you <i>need</i> a newer version of a package and the <code>cabal install packageName-1.2.3.4</code> can&#39;t resolve dependencies due to already installed packages. Expect at least an hour of recompiling many packages..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439918032, "post_id": 32078182, "comment_id": 52053446, "body": "@raxacoricofallapatorius That looks like a stupendous way to initiate what is colloquially known as &quot;cabal hell&quot;. (At the very least, you should tell cabal about <i>all</i> the packages you want to reinstall in one command, rather than running one command per package.) On the other hand, figuring your way out of cabal hell a few times will teach you a lot about how cabal works..."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439918346, "post_id": 32078182, "comment_id": 52053632, "body": "Yes, it seems like maybe that workaround with <code>--dry-run</code> instead of <code>--reinstall</code>, might yield some information that could be used as a starting point for targeted reinstalls as necessary. &quot;Cabal Hell&quot; seems redundant to me."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439918761, "post_id": 32078182, "comment_id": 52053894, "body": "@raxacoricofallapatorius By the way, you might like <a href=\"http://www.vex.net/~trebla/haskell/sicp.xhtml\" rel=\"nofollow noreferrer\">SICP</a>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439919468, "post_id": 32078182, "comment_id": 52054325, "body": "So suppose that the Haskel Platform changes (say GHC is updated). What do I need to do to update my configuration, which includes (a) several additional packages, and (b) IHaskell, which is (c) installed into Jupyter? Do I need to remove the platform, re-install it, reinstall my additional packages, reinstall IHaskel, and re-run <code>ihaskell install</code>? (I&#39;m loosing my interest in Haskell.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439924033, "post_id": 32078182, "comment_id": 52056944, "body": "@raxacoricofallapatorius I don&#39;t know much about ihaskell or jupyter. It might be worth opening a fresh question with further details about what you want to do. That said, you should not need to remove anything during a GHC upgrade."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439953653, "post_id": 32078182, "comment_id": 52067594, "body": "@raxacoricofallapatorius, all package management tools suck. They just all suck differently. Cabal has the advantage of failing loudly and early, and the accompanying disadvantages. Cabal sandboxes can ease the pain, and some people swear by Stackage. Others reach in a whole different direction and use Nix. You don&#39;t <i>need</i> to use cabal as anything but a build tool I&#39;d you don&#39;t want to."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439981710, "post_id": 32078182, "comment_id": 52081493, "body": "@dfeuer: Yes. I&#39;m just having trouble wrapping my mind around how the Haskell environment works, and Cabal seemed to make it unnecessarily fiddly to manage."}, {"owner": {"reputation": 199, "user_id": 4516267, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A898h.jpg?s=128&g=1", "display_name": "Alex Trueman", "link": "https://stackoverflow.com/users/4516267/alex-trueman"}, "edited": false, "score": 0, "creation_date": 1495734627, "post_id": 32078182, "comment_id": 75387317, "body": "&quot;Cabal is not a Package Manager&quot; - <a href=\"https://ivanmiljenovic.wordpress.com/2010/03/15/repeat-after-me-cabal-is-not-a-package-manager/\" rel=\"nofollow noreferrer\">ivanmiljenovic.wordpress.com/2010/03/15/&hellip;</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 13, "last_activity_date": 1439916519, "creation_date": 1439916519, "answer_id": 32078182, "question_id": 32077856, "link": "https://stackoverflow.com/questions/32077856/is-there-a-way-to-use-cabal-to-keep-haskell-packages-up-to-date/32078182#32078182", "title": "Is there a way to use Cabal to keep Haskell packages up-to-date?", "body": "<p>There are a number of standard package-management features missing from cabal. This is one of them, and (transitive) removal of packages is another. The party line is that cabal is intended to be an automatic build tool, nothing more; though that line grows thinner and thinner as the years drag on.</p>\n\n<p>If you know which packages you want to upgrade, you can; generally <code>cabal update</code> and <code>cabal install those packages</code> will grab the newest package list from Hackage and try to find an install plan that installs the newest versions of the requested packages. You can ask for the install plan without executing it with <code>cabal install --dry-run those packages</code>; if it doesn't look like it picked the versions you want, you can add constraints, as in</p>\n\n<pre><code>cabal install those packages --constraint 'those&gt;=9000'\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2663, "favorite_count": 3, "accepted_answer_id": 32078182, "answer_count": 1, "score": 7, "last_activity_date": 1439922108, "creation_date": 1439915395, "last_edit_date": 1439922108, "question_id": 32077856, "link": "https://stackoverflow.com/questions/32077856/is-there-a-way-to-use-cabal-to-keep-haskell-packages-up-to-date", "title": "Is there a way to use Cabal to keep Haskell packages up-to-date?", "body": "<p>I'm confused by how Cabal works. I'm used to packages managers that have as part of their core functionality the ability to easily update all packages that have changed, or at least to get a list of packages on my system that have updates available. But Cabal seems to lack this functionality. Am I missing something? </p>\n\n<p>Is there a way to:</p>\n\n<ol>\n<li>Automatically or easily update all out-of-date packages; or, failing that,</li>\n<li>Get a list of packages installed on my system that have updates available?</li>\n</ol>\n"}, {"tags": ["haskell", "cabal", "hint"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1439913100, "post_id": 32076977, "comment_id": 52050585, "body": "I would guess that the one of the packages does not have it&#39;s <code>build-depends</code> configured correctly..."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1439914556, "post_id": 32076977, "comment_id": 52051549, "body": "More specifically, it looks like the package version bounds are wrong."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439915906, "post_id": 32076977, "comment_id": 52052297, "body": "If I had to guess, it would be the older version of <code>ghc</code>. We are on version <code>7.10.2</code> currently and the OP is compiling with <code>7.4.1</code>. The version of <code>base</code> he is using might not be compatible with the package. Still the package configuration should define that in the <code>build-depends</code> section..."}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1439914419, "creation_date": 1439912830, "last_edit_date": 1439914419, "question_id": 32076977, "link": "https://stackoverflow.com/questions/32076977/haskell-cabal-install-hint-error-module-errutils-does-not-export-pprerrms", "title": "haskell - cabal install hint : error Module `ErrUtils&#39; does not export `pprErrMsgBagWithLoc&#39;", "body": "<p>While trying to install <code>hint</code> on my machine <em>Debian GNU/Linux 7.6 (wheezy)</em> with <code>ghc 7.4.1</code> and <code>cabal-install version 0.14.0</code>\n <code>using version 1.14.0 of the Cabal library</code></p>\n\n<p>I got the following error: </p>\n\n<pre><code>Registering ghc-paths-0.1.0.9...\nDownloading hint-0.4.2.2...\nConfiguring hint-0.4.2.2...\nBuilding hint-0.4.2.2...\nPreprocessing library hint-0.4.2.2...\n[ 1 of 23] Compiling Hint.SignalHandlers ( src/Hint/SignalHandlers.hs, dist/build/Hint/SignalHandlers.o )\n[ 2 of 23] Compiling Hint.Util        ( src/Hint/Util.hs, dist/build/Hint/Util.o )\n[ 3 of 23] Compiling Hint.CompatPlatform ( src/Hint/CompatPlatform.hs, dist/build/Hint/CompatPlatform.o )\n[ 4 of 23] Compiling Hint.GHC         ( src/Hint/GHC.hs, dist/build/Hint/GHC.o )\n\nsrc/Hint/GHC.hs:45:37:\n    Module `ErrUtils' does not export `pprErrMsgBagWithLoc'\ncabal: Error: some packages failed to install:\nhint-0.4.2.2 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>How to resolve this error? </p>\n"}, {"tags": ["haskell", "ipython-notebook", "jupyter"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439912925, "post_id": 32076846, "comment_id": 52050465, "body": "strange - can you do a <code>:i Either</code> and look for the <code>Show</code> instance for it (maybe you use some non-default prelude)"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439913148, "post_id": 32076846, "comment_id": 52050621, "body": "@Carsten: <code>data Either a b = Left a | Right b \t-- Defined in \u2018Data.Either\u2019 at &lt;interactive&gt;:1:1</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439913365, "post_id": 32076846, "comment_id": 52050777, "body": "no list of instances? Strange but AFAIK it should be right there (by <code>deriving ...</code>) - I don&#39;t know Jupyter nor Kronos - can you tell us how <code>ghci</code> is called?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439913652, "post_id": 32076846, "comment_id": 52050964, "body": "@Carsten: That&#39;s all Notebook shows. A popup with just that one line. Maybe there&#39;s a way to see the instances too, but I don&#39;t know."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439914527, "post_id": 32076846, "comment_id": 52051529, "body": "Are you sure that IHaskell currently <a href=\"https://github.com/gibiansky/IHaskell/issues/556\" rel=\"nofollow noreferrer\">supports IPython/Jupyter 4</a>?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439914573, "post_id": 32076846, "comment_id": 52051560, "body": "@Carsten IHaskell does <b>not</b> call GHCi. It uses the GHC libraries to parse and execute the code."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439914617, "post_id": 32076846, "comment_id": 52051587, "body": "@Bakuriu: The same thing happens in Kronos-Haskell. And I&#39;m <a href=\"http://stackoverflow.com/a/32076954/656912\">using IPython 3.0</a>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439917746, "post_id": 32076846, "comment_id": 52053283, "body": "@Bakuriu as I said I don&#39;t know anything about IHaskell etc. - it was just an guess based on the output given - I hope you both can figure it out - good luck"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439920831, "post_id": 32076846, "comment_id": 52055143, "body": "fwiw, I tried your code in my build of IHaskell and it worked. Using 7.10 built with stack. I think there&#39;s something corrupted with your setup."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439920884, "post_id": 32076846, "comment_id": 52055180, "body": "@user5402: You tried it in a notebook?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439922354, "post_id": 32076846, "comment_id": 52055997, "body": "Yup - did it in a notebook. I basically followed the build recipe in the IHaskell README for stack, but I also used <code>stack setup --no-system-ghc</code>  to make sure it used it&#39;s own ghc and tools."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439922663, "post_id": 32076846, "comment_id": 52056182, "body": "@user5402: What version of GHC does that end up being?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1439923462, "post_id": 32076846, "comment_id": 52056637, "body": "7.10.2 (la di la di da filler)"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439923626, "post_id": 32076846, "comment_id": 52056719, "body": "@user5402: Maybe I have some config issue then. But Haskell/Cabal is such a mess (learning fresh and really astounded how messed up the install and config and package management is) I may just try another language."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439923928, "post_id": 32076846, "comment_id": 52056889, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/87307/discussion-between-user5402-and-raxacoricofallapatorius\">continue this discussion in chat</a>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439984903, "post_id": 32076846, "comment_id": 52083693, "body": "@Carsten: It turns out (<i>blush</i>) that you were on the right track. Earlier on the notebook I had <code>Either a b = Left a | Right b</code>, which (remarkably!) Haskell let me do without posting any warning, redefining <code>Either</code>!. That&#39;s why there were no instances and why (right in front of us!) it said it was defined in &quot;&lt;interactive&gt;&quot;. Removing or not executing that statement fixes the issue (and has <code>:t Either</code> report instances as expected)."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439985057, "post_id": 32076846, "comment_id": 52083801, "body": "@Carsten: The <a href=\"http://chat.stackoverflow.com/rooms/87307/discussion-between-user5402-and-raxacoricofallapatorius\">chat transcript</a> shows how we convinced ourselves it was <a href=\"http://stackoverflow.com/a/32081764/656912\">something else</a>."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1439928994, "last_edit_date": 1439928994, "creation_date": 1439928679, "answer_id": 32081764, "question_id": 32076846, "link": "https://stackoverflow.com/questions/32076846/haskell-code-fails-to-show-output-in-notebook/32081764#32081764", "title": "Haskell code fails to show output in Notebook", "body": "<p>If you are using the Haskell Platform, make sure that the directory</p>\n\n<pre><code>~/Library/Haskell/bin\n</code></pre>\n\n<p>is present and appears <strong><em>before</em></strong> <code>/usr/bin</code> in your PATH.</p>\n\n<p>That's where the Platform installs new binaries, so you'll need it your PATH to access apps you build and to use upgraded versions of tools which come with the Platform (e.g. cabal, happy, alex, etc.)</p>\n\n<p>Also, you can use these instructions to install IHaskell yourself:</p>\n\n<p><a href=\"https://github.com/gibiansky/IHaskell#install-haskell-tools\" rel=\"nofollow\">https://github.com/gibiansky/IHaskell#install-haskell-tools</a></p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 32081764, "answer_count": 1, "score": 2, "last_activity_date": 1439928994, "creation_date": 1439912440, "question_id": 32076846, "link": "https://stackoverflow.com/questions/32076846/haskell-code-fails-to-show-output-in-notebook", "title": "Haskell code fails to show output in Notebook", "body": "<p>In the <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#recursive-data-structures\" rel=\"nofollow\">Haskell tutorial</a> I'm reading through there is an example that works fine in GHCI (7.10.2) but fails to produce output in a Notebook (both Jupyter, 4.0 or Kronos-Haskell).</p>\n\n<p>The issue seems to involve a function</p>\n\n<pre><code>lockerLookup :: Int -&gt; LockerMap -&gt; Either String Code\n</code></pre>\n\n<p>which in the tutorial and in GHCI produces a result, for example</p>\n\n<pre><code>ghci&gt; lockerLookup 101 lockers  \nRight \"JAH3I\"\n</code></pre>\n\n<p>in a Notebook gives an error</p>\n\n<pre><code>No instance for (Show (Either String Code)) arising from a use of \u2018print\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Is this the correct behavior in a Notebook? Is there something I can do to produce the expected output in a Notebook?</p>\n\n<hr>\n\n<pre><code>import qualified Data.Map as Map    \n\ndata LockerState = Taken | Free deriving (Show, Eq)    \ntype Code = String    \ntype LockerMap = Map.Map Int (LockerState, Code) \n\nlockerLookup :: Int -&gt; LockerMap -&gt; Either String Code  \nlockerLookup lockerNumber lockerMap =   \n    case Map.lookup lockerNumber lockerMap of   \n        Nothing -&gt; Left $ \"Locker number \" ++ show lockerNumber ++ \" doesn't exist!\"  \n        Just (state, code) -&gt; if state /= Taken\n            then Right code\n            else Left $ \"Locker \" ++ show lockerNumber ++ \" is already taken!\"\n\nlockers :: LockerMap  \nlockers = Map.fromList   \n    [(100,(Taken,\"ZD39I\"))  \n    ,(101,(Free,\"JAH3I\"))  \n    ,(103,(Free,\"IQSA9\"))  \n    ,(105,(Free,\"QOTSA\"))  \n    ,(109,(Taken,\"893JJ\"))  \n    ,(110,(Taken,\"99292\"))  \n    ]  \n</code></pre>\n"}, {"tags": ["haskell", "notation"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 3, "creation_date": 1439945709, "post_id": 32075064, "comment_id": 52065626, "body": "If you want, you can just think of it as <code>instance Fluffy (t -&gt;) where</code>, except operator sections are syntactically illegal in this case."}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 4, "last_activity_date": 1439908861, "creation_date": 1439908861, "answer_id": 32075529, "question_id": 32075064, "link": "https://stackoverflow.com/questions/32075064/what-is-t-in-haskell/32075529#32075529", "title": "What is ((-&gt;) t ) in haskell?", "body": "<p><code>(-&gt;)</code> is the type constructor for functions which has kind <code>* -&gt; * -&gt; *</code> so it requires two type parameters - the input and result type of the function. <code>((-&gt;) t</code> is a partial application of this constructor so it is functions with an argument type of <code>t</code> i.e. (t -> a) for some type <code>a</code>. </p>\n\n<p>If you substitute that into the type of the <code>furry</code> function you get:</p>\n\n<pre><code>furry :: (a -&gt; b) -&gt; (t -&gt; a) -&gt; (t -&gt; b)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1765, "user_id": 2181660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bda83eedd4ccbae9799c1fab98aed7ff?s=128&d=identicon&r=PG", "display_name": "viorior", "link": "https://stackoverflow.com/users/2181660/viorior"}, "is_accepted": false, "score": 0, "last_activity_date": 1439998387, "creation_date": 1439998387, "answer_id": 32099890, "question_id": 32075064, "link": "https://stackoverflow.com/questions/32075064/what-is-t-in-haskell/32099890#32099890", "title": "What is ((-&gt;) t ) in haskell?", "body": "<p>You should read prefix <code>(-&gt;) t a</code> as infix <code>t -&gt; a</code>.</p>\n\n<p>If we have </p>\n\n<pre><code>instance Fluffy Maybe where\n</code></pre>\n\n<p>for <code>Maybe a</code> type (and <code>* -&gt; *</code> kind), then </p>\n\n<pre><code>instance Fluffy ((-&gt;) t) where\n</code></pre>\n\n<p>is for <code>(-&gt;) t a == t -&gt; a</code> type (and <code>* -&gt; *</code> kind) - for any function with 1 argument</p>\n"}], "owner": {"reputation": 29901, "user_id": 58737, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/95bd14f2b84f4af133b18d541dd33530?s=128&d=identicon&r=PG", "display_name": "Pratik Deoghare", "link": "https://stackoverflow.com/users/58737/pratik-deoghare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 2, "answer_count": 2, "score": 9, "last_activity_date": 1439998387, "creation_date": 1439907627, "question_id": 32075064, "link": "https://stackoverflow.com/questions/32075064/what-is-t-in-haskell", "title": "What is ((-&gt;) t ) in haskell?", "body": "<p>I am doing <a href=\"http://blog.tmorris.net/posts/20-intermediate-haskell-exercises/\">20 intermediate Haskell exercises</a>. </p>\n\n<p>After finishing first 2 exercise there is this strange thing. </p>\n\n<p>I would like to know what is <code>((-&gt;) t)</code>? </p>\n\n<pre><code>-- Exercise 3\n-- Relative Difficulty: 5\ninstance Fluffy ((-&gt;) t) where\n  furry = error \"todo\"\n</code></pre>\n\n<p>Thanks! :-) </p>\n"}, {"tags": ["haskell", "amazon-s3"], "answers": [{"comments": [{"owner": {"reputation": 737, "user_id": 105367, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/bee024ad9234098c14cb1ab5b3ea72c8?s=128&d=identicon&r=PG", "display_name": "jyurek", "link": "https://stackoverflow.com/users/105367/jyurek"}, "edited": false, "score": 0, "creation_date": 1439987117, "post_id": 32082590, "comment_id": 52085293, "body": "Thanks for the link to the other question. As for amazonka, I believe I saw that a while ago, but it relies on lens. It (IIRC) is a really large dependency (as in, it added many minutes to compilation), so I disregarded it."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1439932230, "last_edit_date": 1495540281, "creation_date": 1439932230, "answer_id": 32082590, "question_id": 32075001, "link": "https://stackoverflow.com/questions/32075001/how-do-i-upload-to-s3-if-im-already-in-a-conduit/32082590#32082590", "title": "How do I upload to S3 if I&#39;m already in a Conduit?", "body": "<p>This is not really an answer, but merely a hint. <a href=\"https://hackage.haskell.org/package/amazonka-1.0.1/docs/Control-Monad-Trans-AWS.html\" rel=\"nofollow noreferrer\"><code>amazonka</code></a> seems to expose <a href=\"https://hackage.haskell.org/package/amazonka-core-1.0.1/docs/Network-AWS-Data-Body.html#t:RqBody\" rel=\"nofollow noreferrer\"><code>RequestBody</code></a> of requests from <code>http-client</code>. So in theory it's possible to pipe data there from conduits. Yet seems that you have to know digest of the data beforehand. </p>\n\n<p>So does tell <a href=\"https://stackoverflow.com/questions/8653146/can-i-stream-a-file-upload-to-s3-without-a-content-length-header\">Can I stream a file upload to S3 without a content-length header?</a> too.</p>\n"}, {"tags": [], "owner": {"reputation": 681, "user_id": 1072240, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1ef5bf598c44bbfa8b87fd77ccf2a993?s=128&d=identicon&r=PG", "display_name": "Jason Whittle", "link": "https://stackoverflow.com/users/1072240/jason-whittle"}, "is_accepted": false, "score": 1, "last_activity_date": 1506975833, "creation_date": 1506975833, "answer_id": 46533179, "question_id": 32075001, "link": "https://stackoverflow.com/questions/32075001/how-do-i-upload-to-s3-if-im-already-in-a-conduit/46533179#46533179", "title": "How do I upload to S3 if I&#39;m already in a Conduit?", "body": "<p>There is now a package\u2014<a href=\"https://hackage.haskell.org/package/amazonka-s3-streaming\" rel=\"nofollow noreferrer\">amazonka-s3-streaming</a>\u2014that exposes a multi-part upload to S3 as a conduit <a href=\"https://www.stackage.org/haddock/lts-9.3/conduit-1.2.11/Data-Conduit.html#t:Sink\" rel=\"nofollow noreferrer\">Sink</a>. </p>\n"}], "owner": {"reputation": 737, "user_id": 105367, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/bee024ad9234098c14cb1ab5b3ea72c8?s=128&d=identicon&r=PG", "display_name": "jyurek", "link": "https://stackoverflow.com/users/105367/jyurek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1506975833, "creation_date": 1439907456, "question_id": 32075001, "link": "https://stackoverflow.com/questions/32075001/how-do-i-upload-to-s3-if-im-already-in-a-conduit", "title": "How do I upload to S3 if I&#39;m already in a Conduit?", "body": "<p>In Haskell, I'm processing some data via conduits. During that processing, I want to conditionally store that data in S3. Are there any S3 libraries that will allow me to do this? Effectively, what I want to do is \"tee\" the pipeline created by the conduit and put the data it contains on S3 while continuing to process it.</p>\n\n<p>I've found the aws library (<a href=\"https://hackage.haskell.org/package/aws\" rel=\"nofollow\">https://hackage.haskell.org/package/aws</a>), but the functions like <code>multipartUpload</code> take a <code>Source</code> as an argument. Given that I'm already inside the conduit, this doesn't seem like something I can use.</p>\n"}, {"tags": ["haskell", "gtk", "gtk3"], "owner": {"reputation": 1774, "user_id": 844614, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2d23e5966afffe052801e20b0a558c1a?s=128&d=identicon&r=PG&f=1", "display_name": "kai", "link": "https://stackoverflow.com/users/844614/kai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1439906864, "creation_date": 1439906864, "question_id": 32074742, "link": "https://stackoverflow.com/questions/32074742/how-do-i-resize-a-gtk-comboboxtext-to-fit-its-contents", "title": "How do I resize a GTK ComboBox(Text) to fit its contents?", "body": "<p>I would like to add a <code>GtkComboBoxText</code> to the center of my widget, and take up the minimal amount of space required to display the largest item. So far I've tried to do this with a <code>GtkAlignment</code>, but the <code>GtkComboBox</code> does not expand to fit its content.</p>\n\n<p>Below is a minimal example (in Haskell), but suggestions in any language would be appreciated.</p>\n\n<pre><code>import Graphics.UI.Gtk\n\nimport Data.Text(pack)\nimport Control.Monad.Trans(liftIO)\nimport Control.Monad(mapM)\n\nmain :: IO ()\nmain = do\n   initGUI\n\n   window1 &lt;- windowNew\n   alignment1 &lt;- alignmentNew 0.5 0.5 0.1 0.1\n   comboboxtext1 &lt;- comboBoxNewText\n\n   mapM ((comboBoxAppendText comboboxtext1).pack) [\"Foo\", \"Bar\", \"LongFooBarText\"]\n\n   containerAdd window1 alignment1\n   containerAdd alignment1 comboboxtext1\n\n   on window1 deleteEvent $ liftIO mainQuit &gt;&gt; return False\n\n   widgetShowAll window1\n   mainGUI\n</code></pre>\n"}, {"tags": ["haskell", "io-monad"], "answers": [{"comments": [{"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1439897331, "post_id": 32070776, "comment_id": 52038915, "body": "Works nice in the ghci environment, but doesn&#39;t print anything compiled as a program: &quot;putStrLn &lt;$&gt; intercalate &quot; &quot; &lt;$&gt; sequence [ show . myFunc . read &lt;$&gt; getLine | _ &lt;- [1..num]]&quot;. It only works, when I bind this to a variable and print this variable in the next statement."}], "tags": [], "owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1439896248, "creation_date": 1439896248, "answer_id": 32070776, "question_id": 32070639, "link": "https://stackoverflow.com/questions/32070639/reading-numbers-inline/32070776#32070776", "title": "Reading numbers inline", "body": "<p>You can build a list of monadic actions with <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:-60--36--62-\" rel=\"nofollow\"><code>&lt;$&gt;</code></a> (or <code>fmap</code>) and execute them all with <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:sequence\" rel=\"nofollow\"><code>sequence</code></a>.</p>\n\n<pre><code>\u03bb intercalate \" \" &lt;$&gt; sequence [show . (2*) . read &lt;$&gt; getLine | _ &lt;- [1..4]]\n1\n2\n3\n4\n\"2 4 6 8\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1439897482, "post_id": 32070814, "comment_id": 52039035, "body": "Not neccessarily the requested one-liner, but structured nicely. I think I&#39;ll take this to start with. Many thanks."}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1439898171, "post_id": 32070814, "comment_id": 52039464, "body": "So if I got you correctly it&#39;s not possible to read numbers from stdin without that extra function getOneInt as Dogbert stated in his comment?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1439899475, "post_id": 32070814, "comment_id": 52040295, "body": "@Hennes You could just use <code>read &lt;$&gt; getLine :: IO Int</code> instead. However, since it&#39;s used in multiple places of the code, it makes sense to define a <code>getOneInt</code> function."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": false, "score": 2, "last_activity_date": 1439899547, "last_edit_date": 1439899547, "creation_date": 1439896359, "answer_id": 32070814, "question_id": 32070639, "link": "https://stackoverflow.com/questions/32070639/reading-numbers-inline/32070814#32070814", "title": "Reading numbers inline", "body": "<blockquote>\n  <p>Is it even possible to write this function as a one-liner?</p>\n</blockquote>\n\n<p>Sure, but there is a problem with the last line of your <code>main</code> function. Because you're trying to apply <code>intercalate \" \"</code> to</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[ show $ myFunc $ read getLine | c &lt;- [1..num]]\n</code></pre>\n\n<p>I'm guessing you expect the latter to have type <code>[String]</code>, but it is in fact not a well-typed expression. How can that be fixed? Let's first define</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getOneInt :: IO Int\ngetOneInt = read &lt;$&gt; getLine\n</code></pre>\n\n<p>for convenience (we'll be using it multiple times in our code). Now, what you meant is probably something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[ show . myFunc &lt;$&gt; getOneInt | c &lt;- [1..num]]\n</code></pre>\n\n<p>which, if the type of <code>myFunc</code> aligns with the rest, has type <code>[IO String]</code>. You can then pass that to <code>sequence</code> in order to get a value of type <code>IO [String]</code> instead. Finally, you can \"pass\" that (using <code>=&lt;&lt;</code>) to</p>\n\n<pre><code>putStrLn . intercalate \" \"\n</code></pre>\n\n<p>in order to get the desired one-liner:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad ( replicateM )\nimport Data.List     ( intercalate )\n\nmain :: IO ()\nmain = do\n    num  &lt;- getOneInt\n    putStrLn . intercalate \" \" =&lt;&lt; sequence [ show . myFunc &lt;$&gt; getOneInt | c &lt;- [1..num]]\n  where\n    myFunc = (* 3) -- for example\n\ngetOneInt :: IO Int\ngetOneInt = read &lt;$&gt; getLine\n</code></pre>\n\n<p>In GHCi:</p>\n\n<pre><code>\u03bb&gt; main\n3\n45\n23\n1\n135 69 3\n</code></pre>\n\n<p>Is the code idiomatic and readable, though? Not so much, in my opinion...</p>\n\n<blockquote>\n  <p>[...] what is the correct (read: the Haskell way) way to do this properly?</p>\n</blockquote>\n\n<p>There is no \"correct\" way of doing it, but the following just feels more natural and readable to me:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad ( replicateM )\nimport Data.List     ( intercalate )\n\nmain :: IO ()\nmain = do\n    n  &lt;- getOneInt\n    ns &lt;- replicateM n getOneInt\n    putStrLn $ intercalate \" \" $ map (show . myFunc) ns\n  where\n    myFunc = (* 3) -- replace by your own function\n\ngetOneInt :: IO Int\ngetOneInt = read &lt;$&gt; getLine\n</code></pre>\n\n<p>Alternatively, if you want to eschew the <code>do</code> notation:</p>\n\n<pre><code>main =\n    getOneInt                                        &gt;&gt;=\n    flip replicateM getOneInt                        &gt;&gt;=\n    putStrLn . intercalate \" \" . map (show . myFunc)\n  where\n    myFunc = (* 3) -- replace by your own function\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1439900252, "post_id": 32072119, "comment_id": 52040837, "body": "Nice! Why not replace <code>fmap</code> by <code>&lt;$&gt;</code>, though, in order to get rid of the outer parens?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1439900364, "post_id": 32072119, "comment_id": 52040927, "body": "@Jubobs: Because I&#39;m still on GHC 7.8.x. And the default installed GHC in Ubuntu is ancient (7.6.3). This answer works with 7.4+ (maybe even earlier versions) without importing <code>Control.Applicative</code>, and I like to keep my answers somewhat backward compatible ;)."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1439900427, "post_id": 32072119, "comment_id": 52040968, "body": "Fair enough. For my part, since <code>&lt;$&gt;</code> is part of the <code>Prelude</code>, I use it all the time."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1440139179, "last_edit_date": 1440139179, "creation_date": 1439899986, "answer_id": 32072119, "question_id": 32070639, "link": "https://stackoverflow.com/questions/32070639/reading-numbers-inline/32072119#32072119", "title": "Reading numbers inline", "body": "<blockquote>\n  <p>Is it even possible to write this function as a one-liner?</p>\n</blockquote>\n\n<p>Well, it is, and it's kind of concise, but see for yourself:</p>\n\n<pre><code>main = interact $ unwords . map (show . myFunc . read) . drop 1 . lines\n</code></pre>\n\n<p>So, how does this work?</p>\n\n<ol>\n<li><code>interact :: (String -&gt; String) -&gt; IO ()</code> takes all contents from STDIN, passes it through the given function, and prints the output.</li>\n<li>We use <code>unwords . map (show . myFunc . read) . drop 1 . lines :: String -&gt; String</code>:\n\n<ol>\n<li><code>lines :: String -&gt; [String]</code> breaks a string at line ends.</li>\n<li><code>drop 1</code> removes the first line, as we don't actually need the number of lines.</li>\n<li><code>map (show . myFunc . read)</code> converts each <code>String</code> to the correct type, uses <code>myFunc</code>, and then converts it back to a `String.</li>\n<li><code>unwords</code> is basically the same as <code>intercalate \" \"</code>.</li>\n</ol></li>\n</ol>\n\n<p>However, keep in mind that <code>interact</code> isn't very GHCi friendly.</p>\n"}], "owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 32072119, "answer_count": 3, "score": 1, "last_activity_date": 1440139179, "creation_date": 1439895846, "last_edit_date": 1439896530, "question_id": 32070639, "link": "https://stackoverflow.com/questions/32070639/reading-numbers-inline", "title": "Reading numbers inline", "body": "<p>Imagine I read an input block via stdin that looks like this:</p>\n\n<pre><code>3\n12\n16\n19\n</code></pre>\n\n<p>The first number is the number of following rows. I have to process these numbers via a function and report the results separated by a space.</p>\n\n<p>So I wrote this main function:</p>\n\n<pre><code>main = do         \n    num &lt;- readLn\n    putStrLn $ intercalate \" \" [ show $ myFunc $ read getLine | c &lt;- [1..num]]\n</code></pre>\n\n<p>Of course that function doesn't compile because of the <code>read getLine</code>.</p>\n\n<p>But what is the correct (read: the Haskell way) way to do this properly? Is it even possible to write this function as a one-liner?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1439892826, "post_id": 32069478, "comment_id": 52035978, "body": "This doesn&#39;t really answer the question. Instead, it provides steps how authors can help their users to avoid getting into the situation."}, {"owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1439893057, "post_id": 32069478, "comment_id": 52036111, "body": "I wrote this from the understanding that the OP may or <code>may not</code> have checked for explicit imports first. That said, their use of <code>ghc-pkg list errors</code> probably precludes them from having not done this already, which I did not think about."}], "tags": [], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "is_accepted": false, "score": 1, "last_activity_date": 1439892607, "creation_date": 1439892607, "answer_id": 32069478, "question_id": 32068776, "link": "https://stackoverflow.com/questions/32068776/how-to-find-package-version-documentation-for-a-haskell-name/32069478#32069478", "title": "How to find package, version, documentation for a Haskell name", "body": "<p>Ideally, every module explicitly imports every function it uses. Assuming that <code>throwT</code> was used in <code>Module.hs</code>, but not defined in it, the first thing to check for is if there is an import statement at the top of <code>Module.hs</code> that explicitly imports the function, which would look something like <code>import Some-Module (throwT, someOtherFunction, possiblyAnotherFunction)</code>, where <code>Some-Module</code> is the module being imported, and the functions within the parenthesis are the only things being imported from that module (this is what an explicit import is). You'd then find <code>Some-Module</code> and look for the definition of <code>throwT</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1439892955, "post_id": 32069483, "comment_id": 52036041, "body": "You can also build a local hoogle database and use hoogle locally, but I don&#39;t have time to build and check this at the moment. Then should be as easy as <code>hoogle-local throwT</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 7, "last_activity_date": 1439892622, "creation_date": 1439892622, "answer_id": 32069483, "question_id": 32068776, "link": "https://stackoverflow.com/questions/32068776/how-to-find-package-version-documentation-for-a-haskell-name/32069483#32069483", "title": "How to find package, version, documentation for a Haskell name", "body": "<p>You could use <code>ghc-pkg find-module</code> instead of <code>list</code>, which gives you the installed version of the package containing the module right away:</p>\n\n<ol>\n<li>Fire up GHCi</li>\n<li><code>:load YourModule.hs</code>, get <code>:info</code> on your value</li>\n<li>Use the given module name with <code>ghc-pkg find-module</code>.</li>\n<li>You now know the exact module, package and version.</li>\n</ol>\n\n<p>This still forces you to check the hackage documentation. However, if you add <code>documentation: true</code> to your cabal configuration or <code>--enable-documentation</code>, cabal will automatically build the documentation during the installation of the given package. Then you can shorten the procedure to</p>\n\n<ol>\n<li>Fire up GHCi</li>\n<li><code>:load YourModule.hs</code>, get <code>:info</code> on your value</li>\n<li>Check your local documentation for the references module.</li>\n</ol>\n\n<p>The local documentation will be stored in your cabal directory, or, if you are in a sandbox, in <code>.cabal-sandbox/share/doc/&lt;plattform&gt;/index.html</code>.</p>\n"}], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 468, "favorite_count": 1, "accepted_answer_id": 32069483, "answer_count": 2, "score": 5, "last_activity_date": 1519873379, "creation_date": 1439890678, "last_edit_date": 1519873379, "question_id": 32068776, "link": "https://stackoverflow.com/questions/32068776/how-to-find-package-version-documentation-for-a-haskell-name", "title": "How to find package, version, documentation for a Haskell name", "body": "<p>My concrete problem is this: I ran across the name <code>throwT</code> in <code>Module.hs</code> in a big Haskell project. I want to know what <code>throwT</code> does. I eventually managed to figure this one out as follows:</p>\n\n<ol>\n<li>fire up ghci for the project</li>\n<li><code>:load Module.hs</code> followed by <code>:i throwT</code>\n<code>\nthrowT :: Monad m =&gt; e -&gt; Control.Monad.Trans.Either.EitherT e m r \n   -- Defined in \u2018Data.EitherR\u2019\n</code></li>\n<li>query <a href=\"http://hayoo.fh-wedel.de/?query=data.eitherr\">hayoo</a> for <code>Data.EitherR</code>, which points at the package <code>errors</code></li>\n<li><code>ghc-pkg list errors</code> gives <code>errors-1.4.7</code></li>\n<li>browse hackage to the documentation of that version of the errors package: <a href=\"http://hackage.haskell.org/package/errors-1.4.7/docs/Data-EitherR.html#v:throwT\">throwT</a></li>\n</ol>\n\n<p>Is there a better way to do this, both in the sense of being more precise (step 3 is not), and less tedious?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1439863590, "post_id": 32062235, "comment_id": 52023225, "body": "Hey man, is it possible to make a list receive the return of a <code>filter</code> ? like:  <code>let logins = [...]</code> now I want to make logins become the result of a <code>filter</code> where elements with lenght &lt; 8. Is it possible ? ( I know how to filter the lenght) but cant make logins receive the result"}, {"owner": {"reputation": 10045, "user_id": 77542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2bb52913c4cebae8835bb50c03996d5?s=128&d=identicon&r=PG", "display_name": "Tordek", "link": "https://stackoverflow.com/users/77542/tordek"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 1, "creation_date": 1439869102, "post_id": 32062235, "comment_id": 52024419, "body": "Just write <code>let logins = filter (\\x -&gt; length x &lt; 8)</code>. However, Haskell is a functional language and its paradigm is very different from iterative languages: You do not typically define steps in the order in which they must be processed (e.g.: &quot;Sort this list, then take the elements with length 8, then...&quot;); instead you compose functions to obtain your desired results."}], "tags": [], "owner": {"reputation": 10045, "user_id": 77542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2bb52913c4cebae8835bb50c03996d5?s=128&d=identicon&r=PG", "display_name": "Tordek", "link": "https://stackoverflow.com/users/77542/tordek"}, "is_accepted": true, "score": 1, "last_activity_date": 1439861858, "creation_date": 1439861858, "answer_id": 32062235, "question_id": 32062208, "link": "https://stackoverflow.com/questions/32062208/how-to-get-a-list-as-parameter-of-a-function-in-haskell-using-ghci/32062235#32062235", "title": "How to get a list as parameter of a function in haskell using GHCi", "body": "<p>In order to specify the type of the parameters of a function, you use <code>::</code>. You can make a function that takes a list and returns a list by saying</p>\n\n<pre><code>teste :: [a] -&gt; [a]\nteste x = x\n</code></pre>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1439885603, "accepted_answer_id": 32062235, "answer_count": 1, "score": -1, "last_activity_date": 1439861858, "creation_date": 1439861667, "question_id": 32062208, "link": "https://stackoverflow.com/questions/32062208/how-to-get-a-list-as-parameter-of-a-function-in-haskell-using-ghci", "closed_reason": "Needs details or clarity", "title": "How to get a list as parameter of a function in haskell using GHCi", "body": "<p>I'm starting to learn <code>Haskell</code> now in college and I need to make anything in haskell. I tried to generate a random number but it seems too complicated. So I think I'll do something with <code>lists</code> but I can't make it work when trying to pass a list as parameter. I tried something like:  </p>\n\n<pre><code>teste x[] = x  \n</code></pre>\n\n<p>Just to receive a list and print it but I get some erros. What's the correct way to pass list as parameter ?  </p>\n\n<p>Also: Any ideia what I could implement? Just an example a little toy programm.</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "elm", "type-theory"], "comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 7, "creation_date": 1439856542, "post_id": 32059754, "comment_id": 52021686, "body": "Ed Kmett&#39;s been working on making Fritz Henglein&#39;s generalizations of radix sort practical. It turns out that these &quot;discriminators&quot; are natural Divisibles and much of the technique can be written out along the lines of that type class <a href=\"https://hackage.haskell.org/package/discrimination\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/discrimination</a>"}, {"owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "reply_to_user": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1439912792, "post_id": 32059754, "comment_id": 52050375, "body": "Oh wow, that&#39;s impressive. That&#39;s pretty much the last place I&#39;d ever think to use a type class."}, {"owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "reply_to_user": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 2, "creation_date": 1439971249, "post_id": 32059754, "comment_id": 52074424, "body": "@J.Abrahamson you should formulate your comment into an answer because it deserves all of the upvotes.  Especially if you include code samples ^_^"}], "answers": [{"comments": [{"owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439912733, "post_id": 32060193, "comment_id": 52050329, "body": "This is interesting. It seems that, in playing around with these types, that there has to be a way of merging the inputs so the instance of monoid does make a lot of sense.  One of the cool things though with the folds is that you can chain the operations with applicative combinators. (i.e. <code>&lt;*&gt;</code>) I wonder if there is an equivalent to that in the Divisible world that provides that sort of chaining."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 16, "last_activity_date": 1439849764, "last_edit_date": 1439849764, "creation_date": 1439847834, "answer_id": 32060193, "question_id": 32059754, "link": "https://stackoverflow.com/questions/32059754/are-there-useful-applications-for-the-divisible-type-class/32060193#32060193", "title": "Are there useful applications for the Divisible Type Class?", "body": "<p>Here's a possible use case. </p>\n\n<p>In streaming libraries, one can have fold-like constructs like the ones from the <a href=\"http://hackage.haskell.org/package/foldl-1.1.1/docs/Control-Foldl.html\">foldl</a> package, that are fed a sequence of inputs and return a summary value when the sequence is exhausted.</p>\n\n<p>These folds are contravariant on their inputs, and can be made <code>Divisible</code>. This means that if you have a stream of elements where each element can be somehow decomposed into <code>b</code> and <code>c</code> parts, and you also happen to have a fold that consumes <code>b</code>s and another fold that consumes <code>c</code>s, then you can build a fold that consumes the original stream.</p>\n\n<p>The actual folds from <code>foldl</code> don't implement <code>Divisible</code>, but they could, using a newtype wrapper. In my <code>process-streaming</code> package I have a <a href=\"http://hackage.haskell.org/package/process-streaming-0.7.2.2/docs/System-Process-Streaming.html#t:SiphonOp\">fold-like type</a> that does implement <code>Divisible</code>.</p>\n\n<p><code>divide</code> requires the return values of the constituent folds to be of the same type, and that type must be an instance of <code>Monoid</code>. If the folds return different, unrelated monoids, a workaround is to put each return value in a separate field of a tuple, leaving the other field as <code>mempty</code>. This works because a tuple of monoids is itself a <code>Monoid</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 6, "creation_date": 1439852849, "post_id": 32060682, "comment_id": 52020770, "body": "People call the opposite of parsing &quot;pretty printing&quot;. Admittedly, I like coparsing more :)."}, {"owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439862396, "post_id": 32060682, "comment_id": 52022933, "body": "This is an interesting perspective because my use case is very similar. Basically, I have another type that is applicative and I see the two types as a sort of duality working in opposite directions but in lockstep. I think the serializing/deserializing argument is interesting and would be interested in seeing such an API with example code to get an idea of the usability of the API."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439865193, "post_id": 32060682, "comment_id": 52023553, "body": "@TheSeamau5 I&#39;m experimenting with an approach where I&#39;m polymorphic in the functor type, using a type class that requires it to be <i>either</i> Applicative or Divisible. This means user-defined structures require <i>both</i> a combiner function and a splitter function, and work out of the box on all of my several parsers and encoders, plus on any future Avro schema interpreters I write."}, {"owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439865415, "post_id": 32060682, "comment_id": 52023609, "body": "@Ben so, if I understand correctly, your library provides functions that automatically work on a whole bunch of decoders (applicative) and encoders (divisible)?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 1, "creation_date": 1439866128, "post_id": 32060682, "comment_id": 52023762, "body": "@TheSeamau5 Basically yes. If you have an <code>f a</code>, an <code>f b</code>, (where <code>f</code> is constrained to implement an <code>Avro</code> type class and a <code>Polyvariant</code> type class), plus a function <code>a -&gt; b -&gt; r</code>, and a function <code>r -&gt; (a, b)</code>, then you (thrid party code) can make an <code>f r</code> without needing to choose an implementation of <code>f</code>. This lets you build up a complex Avro schema which can be used as an encoder or decoder (or for reconciliation of different-but-compatible schemas, etc). (The actual approach for Avro is different, because there are record headers and such, but that&#39;s the idea)."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439866242, "post_id": 32060682, "comment_id": 52023788, "body": "@TheSeamau5 Polyvariant is my slightly dumb name for a type constructor that is known to be either a covariant Applicative functor, or a contravariant Divisible functor, but which it is isn&#39;t known. Instances only need the Applicative/Divisible instance and a single line declaration."}, {"owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439914717, "post_id": 32060682, "comment_id": 52051664, "body": "@Ben Thanks for the detail. Your comments have made me wonder a bit and I have a question. Wouldn&#39;t it be better if the divide function were defined to have the type <code>(a -&gt; Maybe (b, c)) -&gt; f b -&gt; f c -&gt; f a</code>? Because I&#39;m thinking that if you have some sort of recursive schema where a,b,c all happen to be of the same type (for example a binary tree), you may want to capture the fact that you have reached the very bottom of the tree by just returing Nothing. For example, the splitter on a binary tree would return the two subtrees, but if it&#39;s a leaf node you just want to return Nothing"}, {"owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439914797, "post_id": 32060682, "comment_id": 52051718, "body": "Or perhaps more generally: <code>(a -&gt; g b c) -&gt; f b -&gt; f c -&gt; f a</code>"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 21, "last_activity_date": 1439850234, "creation_date": 1439850234, "answer_id": 32060682, "question_id": 32059754, "link": "https://stackoverflow.com/questions/32059754/are-there-useful-applications-for-the-divisible-type-class/32060682#32060682", "title": "Are there useful applications for the Divisible Type Class?", "body": "<p>One example:</p>\n\n<p>Applicative is useful for parsing, because you can turn Applicative parsers of parts into a parser of wholes, needing only a pure function for combining the parts into a whole.</p>\n\n<p>Divisible is useful for serializing (should we call this coparsing now?), because you can turn Divisible serializers of parts into a serializer of wholes, needing only a pure function for splitting the whole into parts.</p>\n\n<p>I haven't actually seen a project that worked this way, but I'm (slowly) working on an Avro implementation for Haskell that does.</p>\n\n<p>When I first came across Divisible I wanted it for <code>divide</code>, and had no idea what possible use <code>conquer</code> could be other than cheating (an <code>f a</code> out of nowhere, for any <code>a</code>?). But to make the Divisible laws check out for my serializers <code>conquer</code> became a \"serializer\" that encodes anything to zero bytes, which makes a lot of sense.</p>\n"}, {"comments": [{"owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "edited": false, "score": 0, "creation_date": 1439995033, "post_id": 32096869, "comment_id": 52091579, "body": "Wow. Thanks for your detailed answer. I have noticed the need for the divided function (which I called <code>zip</code>) and it&#39;s nice to see that validated so wonderfully here. I have a question about the refining of divisible. Given the existence of conquer (or lose), wouldn&#39;t it better if divide were defined as <code>divide :: (a -&gt; Maybe (b, c)) -&gt; f b -&gt; f c -&gt; f a</code>? With <code>conquer</code>, we can handle the case where trying to split <code>a</code> yields nothing. For example, with a binary tree, one can split a branch in two and get the subtrees, but the leaves cannot be split."}], "tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 10, "last_activity_date": 1439996272, "last_edit_date": 1439996272, "creation_date": 1439990809, "answer_id": 32096869, "question_id": 32059754, "link": "https://stackoverflow.com/questions/32059754/are-there-useful-applications-for-the-divisible-type-class/32096869#32096869", "title": "Are there useful applications for the Divisible Type Class?", "body": "<p>I'll examine the example of the core data types in Fritz Henglein's generalized radix sort techniques as implemented by Edward Kmett in the <a href=\"https://hackage.haskell.org/package/discrimination\" rel=\"noreferrer\">discrimination</a> package.</p>\n\n<p>While there's a great deal going on there, it largely focuses around a type like this</p>\n\n<pre><code>data Group a = Group (forall b . [(a, b)] -&gt; [[b]])\n</code></pre>\n\n<p>If you have a value of type <code>Group a</code> you essentially must have an equivalence relationship on <code>a</code> because if I give you an association between <code>a</code>s and some type <code>b</code> completely unknown to you then you can give me \"groupings\" of <code>b</code>.</p>\n\n<pre><code>groupId :: Group a -&gt; [a] -&gt; [[a]]\ngroupId (Group grouper) = grouper . map (\\a -&gt; (a, a))\n</code></pre>\n\n<p>You can see this as a core type for writing a utility library of groupings. For instance, we might want to know that if we can <code>Group a</code> and <code>Group b</code> then we can <code>Group (a, b)</code> (more on this in a second). Henglein's core idea is that if you can start with some basic <code>Group</code>s on integers\u2014we can write very fast <code>Group Int32</code> implementations via radix sort\u2014and then use combinators to extend them over all types then you will have generalized radix sort to algebraic data types.</p>\n\n<hr>\n\n<p>So how might we build our combinator library?</p>\n\n<p>Well, <code>f :: Group a -&gt; Group b -&gt; Group (a, b)</code> is pretty important in that it lets us make groups of product-like types. Normally, we'd get this from <code>Applicative</code> and <code>liftA2</code> but <code>Group</code>, you'll notice, is <code>Contravaiant</code>, not a <code>Functor</code>.</p>\n\n<p>So instead we use <code>Divisible</code></p>\n\n<pre><code>divided :: Group a -&gt; Group b -&gt; Group (a, b)\n</code></pre>\n\n<p>Notice that this arises in a strange way from</p>\n\n<pre><code>divide :: (a -&gt; (b, c)) -&gt; Group b -&gt; Group c -&gt; Group a\n</code></pre>\n\n<p>as it has the typical \"reversed arrow\" character of contravariant things. We can now understand things like <code>divide</code> and <code>conquer</code> in terms of their interpretation on <code>Group</code>.</p>\n\n<p><strong>Divide</strong> says that if I want to build a strategy for equating <code>a</code>s using strategies for equating <code>b</code>s and <code>c</code>s, I can do the following for any type <code>x</code></p>\n\n<ol>\n<li><p>Take your partial relation <code>[(a, x)]</code> and map over it with a function <code>f :: a -&gt; (b, c)</code>, and a little tuple manipulation, to get a new relation <code>[(b, (c, x))]</code>.</p></li>\n<li><p>Use my <code>Group b</code> to discriminate <code>[(b, (c, x))]</code> into <code>[[(c, x)]]</code></p></li>\n<li><p>Use my <code>Group c</code> to discriminate each <code>[(c, x)]</code> into <code>[[x]]</code> giving me <code>[[[x]]]</code></p></li>\n<li><p>Flatten the inner layers to get <code>[[x]]</code> like we need</p>\n\n<pre><code>instance Divisible Group where\n  conquer = Group $ return . fmap snd\n  divide k (Group l) (Group r) = Group $ \\xs -&gt;\n    -- a bit more cleverly done here...\n    l [ (b, (c, d)) | (a,d) &lt;- xs, let (b, c) = k a] &gt;&gt;= r\n</code></pre></li>\n</ol>\n\n<p>We also get interpretations of the more tricky <a href=\"https://hackage.haskell.org/package/contravariant-1.3.1.1/docs/Data-Functor-Contravariant-Divisible.html#t:Decidable\" rel=\"noreferrer\"><code>Decidable</code> refinement of <code>Divisible</code></a></p>\n\n<pre><code>class Divisible f =&gt; Decidable f where\n  lose   :: (a -&gt; Void) -&gt; f a\n  choose :: (a -&gt; Either b c) -&gt; f b -&gt; f c -&gt; f a\n\ninstance Decidable Group where\n  lose   :: (a -&gt; Void) -&gt; Group a\n  choose :: (a -&gt; Either b c) -&gt; Group b -&gt; Group c -&gt; Group a\n</code></pre>\n\n<p>These read as saying that for any type <code>a</code> of which we can guarantee there are no values (we cannot produce values of <code>Void</code> by any means, a function <code>a -&gt; Void</code> is a means of producing <code>Void</code> given <code>a</code>, thus we must not be able to produce values of <code>a</code> by any means either!) then we immediately get a grouping of zero values</p>\n\n<pre><code>lose _ = Group (\\_ -&gt; [])\n</code></pre>\n\n<p>We also can go a similar game as to <code>divide</code> above except instead of sequencing our use of the input discriminators, we alternate.</p>\n\n<hr>\n\n<p>Using these techniques we build up a library of \"<code>Group</code>able\" things, namely <a href=\"https://hackage.haskell.org/package/discrimination-0.1/docs/Data-Discrimination.html#t:Grouping\" rel=\"noreferrer\"><code>Grouping</code></a></p>\n\n<pre><code>class Grouping a where\n  grouping :: Group a\n</code></pre>\n\n<p>and note that <a href=\"https://hackage.haskell.org/package/discrimination-0.1/docs/src/Data-Discrimination-Grouping.html#Grouping\" rel=\"noreferrer\">nearly all the definitions arise</a> from the basic definition atop <code>groupingNat</code> which uses fast monadic vector manipuations to achieve an efficient radix sort.</p>\n"}], "owner": {"reputation": 1036, "user_id": 949744, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d484b7248110c782ee47ea93817292a?s=128&d=identicon&r=PG", "display_name": "TheSeamau5", "link": "https://stackoverflow.com/users/949744/theseamau5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1333, "favorite_count": 10, "accepted_answer_id": 32096869, "answer_count": 3, "score": 30, "last_activity_date": 1439996272, "creation_date": 1439845784, "question_id": 32059754, "link": "https://stackoverflow.com/questions/32059754/are-there-useful-applications-for-the-divisible-type-class", "title": "Are there useful applications for the Divisible Type Class?", "body": "<p>I've lately been working on an API in Elm where one of the main types is contravariant. So, I've googled around to see what one can do with contravariant types and found that <a href=\"https://hackage.haskell.org/package/contravariant-1.2/docs/Data-Functor-Contravariant-Divisible.html\">the Contravariant package in Haskell defines the Divisible type class</a>.</p>\n\n<p>It is defined as follows:</p>\n\n<pre><code>class Contravariant f =&gt; Divisible f where\n  divide  :: (a -&gt; (b, c)) -&gt; f b -&gt; f c -&gt; f a\n  conquer :: f a \n</code></pre>\n\n<p>It turns out that my particular type does suit the definition of the Divisible type class. While Elm does not support type classes, I do look at Haskell from time to time for some inspiration.</p>\n\n<p>My question: Are there any practical uses for this type class? Are there known APIs out there in Haskell (or other languages) that benefit from this divide-conquer pattern? Are there any gotchas I should be aware of?</p>\n\n<p>Thank you very much for your help.</p>\n"}, {"tags": ["haskell", "purescript"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1439881118, "post_id": 32059650, "comment_id": 52028617, "body": "Do you want the edges to <i>be</i> or to <i>do</i>? I&#39;m asking because @Daniel Wagner presents a solution in his answer where edges are functions, and I&#39;m curious if you&#39;re interested in a solution where edges are pure data (so you can give a sequence of state transitions several semantics after-the-fact)"}, {"owner": {"reputation": 21877, "user_id": 131227, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/60e3c03e227b84e2898c29fd711cae5b?s=128&d=identicon&r=PG", "display_name": "z5h", "link": "https://stackoverflow.com/users/131227/z5h"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1439906080, "post_id": 32059650, "comment_id": 52045207, "body": "@Cactus my goal is making it clear to developers what transitions are legal through the type system. I want to avoid an API where calling an illegal transition is possible, and returns a <code>Nothing</code> or results in some failure. I&#39;m interested in what you propose if it&#39;s possible with those constraints."}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1439852967, "post_id": 32060194, "comment_id": 52020804, "body": "Perhaps a bit nicer with a type class: <code>class Trans x y where trans :: Thing x -&gt; Thing y</code>."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439911532, "post_id": 32060194, "comment_id": 52049447, "body": "@user3237465 not as handy as you may think. What is <code>thing . thing</code> for example?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1439915899, "post_id": 32060194, "comment_id": 52052295, "body": "@phadej, it&#39;s not possible to even state this with <code>trans**</code> functions, so you don&#39;t lose anything. If you want instantiated versions of <code>trans</code>, you can always add them, or, if rules are hardcoded, you can make a <code>GADT</code>, indexed by two <code>State</code>s, and define <code>transBy</code> (and you can go further with <code>Constraints</code>). <code>trans . trans</code> is <a href=\"http://ideone.com/xA8Fnn\" rel=\"nofollow noreferrer\"><code>transThrough</code></a>."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1439916913, "post_id": 32060194, "comment_id": 52052814, "body": "for <code>Staty</code> use of <code>Data.Proxy</code> is enough. IMHO this is an example where you shouldn&#39;t do stuff, even you can. OTOH, <code>class Trans x y</code> enforces, that transition from some <code>x</code> to <code>y</code> is unique, if exists."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439950820, "post_id": 32060194, "comment_id": 52066848, "body": "Which &quot;other answer&quot;?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439956838, "post_id": 32060194, "comment_id": 52068385, "body": "@dfeuer It seems the answer I was referring to has been deleted for some reason. I&#39;ve updated my answer to be self-contained."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1439956955, "post_id": 32060194, "comment_id": 52068423, "body": "@phadej, &quot;for <code>Staty</code> use of <code>Data.Proxy</code> is enough&quot; \u2014 good point. Haskell made me more hasochistic than it&#39;s needed. @dfeuer, mine, but I deleted it, since it was misleading."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1439956812, "last_edit_date": 1439956812, "creation_date": 1439847848, "answer_id": 32060194, "question_id": 32059650, "link": "https://stackoverflow.com/questions/32059650/how-can-i-encode-and-enforce-legal-fsm-state-transitions-with-a-type-system/32060194#32060194", "title": "How can I encode and enforce legal FSM state transitions with a type system?", "body": "<p>Here's a fairly simple way that uses a (potentially phantom) type parameter to track which state a <code>Thing</code> is in:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures #-}\n-- note: not exporting the constructors of Thing\nmodule Thing (Thing, transAB, transAC, transCA) where\n\ndata State = A | B | C\ndata Thing (s :: State) = {- elided; can even be a data family instead -}\n\ntransAB :: Thing A -&gt; Thing B\ntransAC :: Thing A -&gt; Thing C\ntransCA :: Thing C -&gt; Thing A\n\ntransAB = {- elided -}\ntransAC = {- elided -}\ntransCA = {- elided -}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 532, "user_id": 4793244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc34a48d137aed9294b41858ef956c69?s=128&d=identicon&r=PG&f=1", "display_name": "John A. De Goes", "link": "https://stackoverflow.com/users/4793244/john-a-de-goes"}, "is_accepted": false, "score": 2, "last_activity_date": 1439907513, "creation_date": 1439907513, "answer_id": 32075023, "question_id": 32059650, "link": "https://stackoverflow.com/questions/32059650/how-can-i-encode-and-enforce-legal-fsm-state-transitions-with-a-type-system/32075023#32075023", "title": "How can I encode and enforce legal FSM state transitions with a type system?", "body": "<p>Since your goal is to prevent developers from performing illegal transitions, you may want to look into <em>phantom types</em>. Phantom types allow you to model type-safe transitions without leveraging more advanced features of the type system; as such they are portable to many languages.</p>\n\n<p>Here's a PureScript encoding of your above problem:</p>\n\n<pre><code>foreign import data A :: *\nforeign import data B :: *\nforeign import data C :: *\n\ndata Thing a = Thing\n\ntransitionToA :: Thing C -&gt; Thing A\n</code></pre>\n\n<p>Phantom types work well to model valid state transitions when you have the property that two different states cannot transition to the same state (unless <em>all</em> states can transition to that state). You can workaround this limitation by using type classes (<code>class CanTransitionToA a where trans :: Thing a -&gt; Thing A</code>), but at this point, you should investigate other approaches.</p>\n"}, {"tags": [], "owner": {"reputation": 4039, "user_id": 1341956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbed6f201f9a0e735e5660d118c6662d?s=128&d=identicon&r=PG", "display_name": "Phil Freeman", "link": "https://stackoverflow.com/users/1341956/phil-freeman"}, "is_accepted": false, "score": 5, "last_activity_date": 1439920566, "creation_date": 1439920566, "answer_id": 32079443, "question_id": 32059650, "link": "https://stackoverflow.com/questions/32059650/how-can-i-encode-and-enforce-legal-fsm-state-transitions-with-a-type-system/32079443#32079443", "title": "How can I encode and enforce legal FSM state transitions with a type system?", "body": "<p>You could use a type class (available in PureScript) along with phantom types as John suggested, but using the type class as a final encoding of the type of paths:</p>\n\n<pre><code>data A -- States at the type level\ndata B\ndata C\n\nclass Path p where\n  ab :: p A B -- One-step paths\n  ac :: p A C\n  ca :: p C A\n  trans :: forall a b c. p c b -&gt; p b a -&gt; p c a -- Joining paths\n  refl :: forall a. p a a\n</code></pre>\n\n<p>Now you can create a type of valid paths:</p>\n\n<pre><code>type ValidPath a b = forall p. (Path p) =&gt; p a b\n\nroundTrip :: ValidPath A A\nroundTrip = trans ca ac\n</code></pre>\n\n<p>Paths can only be constructed by using the one-step paths you provide.</p>\n\n<p>You can write instances to use your paths, but importantly, any instance has to respect the valid transitions at the type level.</p>\n\n<p>For example, here is an interpretation which calculates lengths of paths:</p>\n\n<pre><code>newtype Length = Length Int\n\ninstance pathLength :: Path Length where\n  ab = Length 1\n  ac = Length 1\n  ca = Length 1\n  trans (Length n) (Length m) = Length (n + m)\n  refl = Length 0\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439952448, "post_id": 32085128, "comment_id": 52067272, "body": "<code>Domino Edge</code> should, I believe, be an instance of Phil Freeman&#39;s class. This structure seems to suggest that the class be broken up into one describing single edges, one enforcing reflexivity (allowing do-nothing transitions), and one enforcing transitivity (allowing arbitrary chaining). Relaxing either of the latter, or imposing other rules like symmetry, changes the allowable systems."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439955363, "post_id": 32085128, "comment_id": 52068000, "body": "@dfeuer: I&#39;ve added a <code>Path</code> instance, and realized in the process that what we have is an indexed monoid."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1439955896, "post_id": 32085128, "comment_id": 52068117, "body": "<code>Domino</code> is precisely <a href=\"https://github.com/agda/agda-stdlib/blob/master/src/Data/Star.agda\" rel=\"nofollow noreferrer\"><code>Star</code></a>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439956048, "post_id": 32085128, "comment_id": 52068158, "body": "@user3237465: Yes! Dammit I was sure I&#39;ve seen it somewhere before."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439976297, "post_id": 32085128, "comment_id": 52077708, "body": "Ha! I didn&#39;t mention that because I was sure you chose the name in jest."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1439976368, "post_id": 32085128, "comment_id": 52077751, "body": "I think <code>Domino</code> is a nicely evocative name for this."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 1, "creation_date": 1487338713, "post_id": 32085128, "comment_id": 71753158, "body": "Your IMonoid is equivalent to <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Category.html\" rel=\"nofollow noreferrer\">Category</a>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1439955326, "last_edit_date": 1495540406, "creation_date": 1439947827, "answer_id": 32085128, "question_id": 32059650, "link": "https://stackoverflow.com/questions/32059650/how-can-i-encode-and-enforce-legal-fsm-state-transitions-with-a-type-system/32085128#32085128", "title": "How can I encode and enforce legal FSM state transitions with a type system?", "body": "<p>If you want to store a list of transitions so that you can process it later, you can do something like this:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures, PolyKinds #-}\n\ndata State = A | B | C\ndata Edge (a :: State) (b :: State) where\n    EdgeAB :: Edge A B\n    EdgeAC :: Edge A C\n    EdgeCA :: Edge C A\n\ndata Domino (f :: k -&gt; k -&gt; *) (a :: k) (b :: k)  where\n    I :: Domino f a a\n    (:&gt;&gt;:) :: f a b -&gt; Domino f b c -&gt; Domino f a c\n\ninfixr :&gt;&gt;:\n\nexample :: Domino Edge A B\nexample = EdgeAC :&gt;&gt;: EdgeCA :&gt;&gt;: EdgeAB :&gt;&gt;: I\n</code></pre>\n\n<p>You can turn that into an instance of <a href=\"https://stackoverflow.com/a/32079443/477476\"><code>Path</code></a> by writing a concatenation function for <code>Domino</code>:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\ninstance Path (Domino Edge) where\n    ab = EdgeAB :&gt;&gt;: I\n    ac = EdgeAC :&gt;&gt;: I\n    ca = EdgeCA :&gt;&gt;: I\n\n    refl = I\n    trans I es' = es'\n    trans (e :&gt;&gt;: es) es' = e :&gt;&gt;: (es `trans` es')\n</code></pre>\n\n<p>In fact, this makes me wonder if Hackage already has a package that defines \"indexed monoids\":</p>\n\n<pre><code>class IMonoid (m :: k -&gt; k -&gt; *) where\n    imempty :: m a a\n    imappend :: m a b -&gt; m b c -&gt; m a c\n\ninstance IMonoid (Domino e) where\n    imempty = I\n    imappend I es' = es'\n    imappend (e :&gt;&gt;: es) es' = e :&gt;&gt;: (es `imappend` es')\n</code></pre>\n"}], "owner": {"reputation": 21877, "user_id": 131227, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/60e3c03e227b84e2898c29fd711cae5b?s=128&d=identicon&r=PG", "display_name": "z5h", "link": "https://stackoverflow.com/users/131227/z5h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 772, "favorite_count": 1, "accepted_answer_id": 32060194, "answer_count": 4, "score": 10, "last_activity_date": 1439956812, "creation_date": 1439845367, "question_id": 32059650, "link": "https://stackoverflow.com/questions/32059650/how-can-i-encode-and-enforce-legal-fsm-state-transitions-with-a-type-system", "title": "How can I encode and enforce legal FSM state transitions with a type system?", "body": "<p>Suppose I have a type <code>Thing</code> with a state property <code>A | B | C</code>,<br>\nand legal state transitions are <code>A-&gt;B, A-&gt;C, C-&gt;A</code>.</p>\n\n<p>I could write:</p>\n\n<p><code>transitionToA :: Thing -&gt; Maybe Thing</code></p>\n\n<p>which would return <code>Nothing</code> if <code>Thing</code> was in a state which cannot transition to <code>A</code>. </p>\n\n<p>But I'd like to define my type, and the transition functions in such a way that transitions can only be called on appropriate types.</p>\n\n<p>An option is to create separate types <code>AThing BThing CThing</code> but that doesn't seem maintainable in complex cases. </p>\n\n<p>Another approach is to encode each state as it's own type:</p>\n\n<pre><code>data A = A Thing\ndata B = B Thing\ndata C = C Thing\n</code></pre>\n\n<p>and</p>\n\n<p><code>transitionCToA :: C Thing -&gt; A Thing</code></p>\n\n<p>This seems cleaner to me. But it occurred to me that A,B,C are then functors where all of Things functions could be mapped except the transition functions. </p>\n\n<p>With typeclasses I could create somthing like:</p>\n\n<pre><code>class ToA t where  \n    toA :: t -&gt; A Thing\n</code></pre>\n\n<p>Which seems cleaner still.</p>\n\n<p>Are there other preferred approaches that would work in Haskell and PureScript? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": true, "score": 0, "last_activity_date": 1439846502, "creation_date": 1439846502, "answer_id": 32059919, "question_id": 32059046, "link": "https://stackoverflow.com/questions/32059046/what-is-the-implementation-of-foldgall-in-wiki-example/32059919#32059919", "title": "what is the implementation of foldGAll in wiki example", "body": "<p>You seem to have several problems with indentation in that source file. Your question is also not clear, so it's hard to help you, without more information on what you are trying to achieve.</p>\n\n<p>In any case, the error message is quite clear: there is a problem where ghci is unable to parse an '=' sign in line 39, character 22. Keep in mind that indentation is part of the language and that many of these parsing errors are a consequence of improper indentation.</p>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 32059919, "answer_count": 1, "score": 0, "last_activity_date": 1439846502, "creation_date": 1439842868, "question_id": 32059046, "link": "https://stackoverflow.com/questions/32059046/what-is-the-implementation-of-foldgall-in-wiki-example", "title": "what is the implementation of foldGAll in wiki example", "body": "<p><a href=\"https://wiki.haskell.org/The_Monad.Reader/Issue5/Practical_Graph_Handling#foldG\" rel=\"nofollow\">https://wiki.haskell.org/The_Monad.Reader/Issue5/Practical_Graph_Handling#foldG</a>\ni follow 1.5.2</p>\n\n<p>after load trees.hs has error, just hope to run some examples in above link and export some graph jpeg or png file</p>\n\n<pre><code>Prelude&gt; :l trees.hs\n[1 of 1] Compiling Main ( trees.hs, interpreted )\n\n\ntrees.hs:39:22: parse error on input `='\nFailed, modules loaded: none.\n\n\n\nimport Data.List\nimport Data.Array\n--import Data.Graph \nimport Control.Monad\nimport Math.Combinat\nimport Math.Core.Utils\nimport Math.Core.Field\nimport Math.Algebras.VectorSpace\nimport Math.Algebras.Structures\n--import Math.CommutativeAlgebra.GroebnerBasis\n--import Math.CommutativeAlgebra.Polynomial\n--import Math.Algebras.Matrix\nimport System.IO\nimport qualified Data.Map as M\n\n\ntype Vertex = Int\ntype Table a = Array Vertex a\ntype Graph e = Table [(e, Vertex)]\ntype Bounds = (Vertex, Vertex)\ntype Edge e = (Vertex, e, Vertex)\n\n\ntype Labeling a = Vertex -&gt; a\ndata LabGraph n e = LabGraph (Graph e) (Labeling n)\n\n\nfoldGAll :: (Eq r) =&gt; r -&gt; (Vertex -&gt; [(e, r)] -&gt; r) -&gt; Graph e -&gt; Table r\nfoldGAll bot f gr = finalTbl\n where finalTbl = fixedPoint updateTbl initialTbl\n          initialTbl = listArray bnds (replicate (rangeSize bnds) bot)\n\n          fixedPoint f x = fp x\n              where fp z = if z == z' then z else fp z'\n                        where z' = f z\n          updateTbl tbl = listArray bnds $ map recompute $ indices gr\n              where recompute v = f v [(b, tbl!k) | (b, k) &lt;- gr!v]\n          bnds = bounds gr\n\n\nfoldG :: (Eq r) =&gt; r -&gt; (Vertex -&gt; [(e, r)] -&gt; r) -&gt; Graph e -&gt; Vertex -&gt; r\nfoldG i f g v = foldGAll i f g ! v\n\n\n-- | Build a graph from a list of edges.\nbuildG :: Bounds -&gt; [Edge e] -&gt; Graph e\nbuildG bounds0 edges0 = accumArray (flip () [] bounds0 [(v, (l,w)) | (v,l,w) &lt;- edges0]\n\n-- | The graph obtained by reversing all edges.\ntransposeG :: Graph e -&gt; Graph e\ntransposeG g = buildG (bounds g) (reverseE g)\n\n\nedges :: Graph e -&gt; [Edge e]\nedges g = [ (v, l, w) | v &lt;- indices g, (l, w) &lt;- g!v ]\n\nreverseE :: Graph e -&gt; [Edge e]\nreverseE g = [ (w, l, v) | (v, l, w) &lt;- edges g ]\n\n\nshowGraphViz (LabGraph gr lab) = \n\"digraph name {\\n\" ++\n\"rankdir=LR;\\n\" ++\n(concatMap showNode $ indices gr) ++\n(concatMap showEdge $ edges gr) ++\n\"}\\n\"\nwhere showEdge (from, t, to) = show from ++ \" -&gt; \" ++ show to ++\n\" [label = \\\"\" ++ show t ++ \"\\\"];\\n\"\nshowNode v = show v ++ \" [label = \" ++ (show $ lab v) ++ \"];\\n\"\n\n\n\n-- | Compute the distance to v for every vertex of gr.\ndistsTo :: Vertex -&gt; Graph Float -&gt; Table Float\ndistsTo v gr = foldGAll infinite distance gr \nwhere infinite = 10000000 -- well, you get the idea\ndistance v' neighbours \n| v == v' = 0\n| otherwise = minimum [distV+arcWeight | (distV, arcWeight) &lt;- neighbours]\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1439844135, "post_id": 32058733, "comment_id": 52017497, "body": "it&#39;s hard to tell in this generality (what are data that change?) - for example an usual approach to write algorithms dealing with trees is to write recursive functions (as trees are normally defined recursive themselves) - here you don&#39;t have to remember the <i>path</i> as the recursion will do it for you - but yes if you want to move inside such structures and want to edit them locally zippers are a good idea"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1439849733, "post_id": 32058733, "comment_id": 52019856, "body": "Having to remember which nodes have already been visited is part of dfs (and any other search). You can bake that information into your graph of course, but what that primarily buys you is making your graph structure more complex for an often negligible gain in performance."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1439853956, "post_id": 32058733, "comment_id": 52021070, "body": "For graphs specifically, checkout inductive graphs and the <a href=\"https://hackage.haskell.org/package/fgl\" rel=\"nofollow noreferrer\">fgl</a>. I recently wrote an answer about <a href=\"http://stackoverflow.com/questions/30464163/functional-breadth-first-search/30469287#30469287\">breadth first search</a> which fits just as well for depth-first search. For more detail, check out my blog post about <a href=\"http://jelv.is/blog/Generating-Mazes-with-Inductive-Graphs\" rel=\"nofollow noreferrer\">generating mazes with inductive graphs</a>."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1439849319, "post_id": 32060378, "comment_id": 52019744, "body": "Your &quot;dfs&quot; only works because your graph is a directed tree. There is no way to traverse a directed tree that involves revisiting previous nodes that isn&#39;t completely idiotic. For non-acyclic graphs you have to remember previously visited nodes <i>somehow</i>."}, {"owner": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1439850118, "post_id": 32060378, "comment_id": 52019968, "body": "I interpreted the question as &quot;Do you always need to store visited nodes for all data structures in Haskell&quot; and demonstrated that the answer is &quot;no&quot;. For non-acyclic graphs, you do need to track visited nodes, regardless of language choice, but that&#39;s assuming a different set of specifics than the question referred to."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1439851421, "post_id": 32060378, "comment_id": 52020371, "body": "The OP seems to be implicitly talking about graph DFS. They also seem to be imagining that this need to track paths is arising out of the limitations of functional programming, rather than being to do with the particular problem they&#39;re working on (and that you wouldn&#39;t need to track visited nods in a graph DFS implementation in a non-functional language)."}], "tags": [], "owner": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "is_accepted": false, "score": 1, "last_activity_date": 1439848675, "creation_date": 1439848675, "answer_id": 32060378, "question_id": 32058733, "link": "https://stackoverflow.com/questions/32058733/how-to-deal-with-losing-objects-in-functional-programming/32060378#32060378", "title": "How to deal with &#39;losing objects&#39; in functional programming?", "body": "<pre><code>data SimpleTree a = Leaf a | Branch a (SimpleTree a) (SimpleTree a)\n\ndfs :: Eq a =&gt; a -&gt; SimpleTree a -&gt; Bool\ndfs val (Leaf v2) = v2 == val\ndfs val (Branch v2 t2 t3) = v2 == val\n                            || dfs val t2\n                            || dfs val t3\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>*Main&gt; let sampleTree = Branch 5 (Branch 4 (Leaf 3) (Leaf 2)) (Leaf 6)\n*Main&gt; map (\\n -&gt; dfs n sampleTree) [1..7]\n[False,True,True,True,True,True,False]\n</code></pre>\n\n<p>My DFS algorithm does not explicitly carry around a list of visited tree nodes.</p>\n\n<p>The <em>correct</em> way to write algorithms for your structures depends on your structures, but there is no universal requirement that you drag around a list of visited nodes. (Zippers do have that requirement - it's essential to how they work.)</p>\n"}], "owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "closed_date": 1439882610, "answer_count": 1, "score": 3, "last_activity_date": 1439848675, "creation_date": 1439841782, "question_id": 32058733, "link": "https://stackoverflow.com/questions/32058733/how-to-deal-with-losing-objects-in-functional-programming", "closed_reason": "Needs details or clarity", "title": "How to deal with &#39;losing objects&#39; in functional programming?", "body": "<p>I am working with Haskell, and one of the big problems I have with writing programs is that when I want to do something to an object, my program forgets everything I did with it before. When you implement trees with zippers for example, to be able to tell where you are on the tree, every time you move you have to store all the nodes to your left and right in your path. Similarly, if I want to write a simple depth first search, I feel like I have to keep another, separate record of which vertices I've visited, and which I want to go to next, lest I return to an old vertex and forget where I've been.  </p>\n\n<p>My question is: does this keep happening? Is the 'correct' way to write functional programs for data that changes to drag around all the things you've done in the past?</p>\n"}, {"tags": ["haskell", "optional"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439841427, "post_id": 32058593, "comment_id": 52016122, "body": "So its a kind of (deliberate) windfall, in a sense then? The language requires a constructor, and having one allows both pattern matching to <code>Just _</code> and <code>isJust</code>, etc."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 3, "creation_date": 1439841583, "post_id": 32058593, "comment_id": 52016193, "body": "@raxacoricofallapatorius: Right. It&#39;s a conscious design decision with some powerful results. Apart from pattern matching it also helps with type inference, among other things."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439841672, "post_id": 32058593, "comment_id": 52016245, "body": "Yes, a bit of tree shaking by the designers."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 4, "creation_date": 1439860608, "post_id": 32058593, "comment_id": 52022571, "body": "Suppose you had a variable of type <code>Maybe Maybe String</code> holding the value <code>Nothing</code>. Is the inner Maybe Nothing, or the outer one?"}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 35, "last_activity_date": 1439841526, "last_edit_date": 1439841526, "creation_date": 1439841215, "answer_id": 32058593, "question_id": 32058506, "link": "https://stackoverflow.com/questions/32058506/why-does-maybe-include-just/32058593#32058593", "title": "Why does Maybe include Just?", "body": "<p>Haskell's algebraic data types are <strong>tagged unions</strong>. By design, when you combine two different types into another type, they <em>have</em> to have constructors to disambiguate them.</p>\n\n<p>Your definition does not fit with how algebraic data types work.</p>\n\n<pre><code>data Maybe a = Nothing | a\n</code></pre>\n\n<p>There's no \"tag\" for <code>a</code> here. How would we tell an <code>Maybe a</code> apart from a normal, unwrapped <code>a</code> in your case?</p>\n\n<p><code>Maybe</code> has a <code>Just</code> constructor because it <em>has</em> to have a constructor <em>by design</em>.</p>\n\n<p>Other languages do have <a href=\"https://en.wikipedia.org/wiki/Union_type\" rel=\"noreferrer\">union types</a> which could work like what you imagine, but they would not be a good fit for Haskell. They play out differently in practice and tend to be somewhat error-prone.</p>\n\n<p>There are some strong design reasons for preferring tagged unions to normal union types. They play well with type inference. Unions in real code often have a tag anyhow\u00b9. And, from the point of view of elegance, tagged unions are a <strong>natural fit</strong> to the language because they are the dual of <strong>products</strong> (ie tuples and records). If you're curious, I wrote about this in a blog post <a href=\"http://tech.esper.com/2014/07/30/algebraic-data-types/\" rel=\"noreferrer\">introducing and motivating algebraic data types</a>.</p>\n\n<p><strong>footnotes</strong></p>\n\n<p>\u00b9 I've played with union types in two places: TypeScript and C. TypeScript compiles to JavaScript which is dynamically typed, meaning it keeps track of the type of a value at runtime\u2014basically a tag. </p>\n\n<p>C doesn't but, in practice, something like 90% of the uses of union types either have a tag or effectively emulate struct subtyping. One of my professors actually did an empirical study on how unions are used in real C code, but I don't remember what paper it was in off-hand.</p>\n"}, {"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439841532, "post_id": 32058645, "comment_id": 52016165, "body": "Ah, of course. I didn&#39;t see that (I&#39;m new to Haskell, clearly). And (as in my comment below) the fact that it enables some extra convenience is really a side effect."}], "tags": [], "owner": {"reputation": 10220, "user_id": 2720372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/olQxk.jpg?s=128&g=1", "display_name": "w.b", "link": "https://stackoverflow.com/users/2720372/w-b"}, "is_accepted": false, "score": 7, "last_activity_date": 1439841443, "creation_date": 1439841443, "answer_id": 32058645, "question_id": 32058506, "link": "https://stackoverflow.com/questions/32058506/why-does-maybe-include-just/32058645#32058645", "title": "Why does Maybe include Just?", "body": "<p><code>Just</code> is a constructor,  <code>a</code> alone would be of type <code>a</code>, when <code>Just a</code> constructs a different type <code>Maybe a</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 17, "last_activity_date": 1439880979, "last_edit_date": 1439880979, "creation_date": 1439847715, "answer_id": 32060179, "question_id": 32058506, "link": "https://stackoverflow.com/questions/32058506/why-does-maybe-include-just/32060179#32060179", "title": "Why does Maybe include Just?", "body": "<p>Another way to look at it (in addition to Tikhon's answer) is to consider another one of the basic Haskell types, <code>Either</code>, which is defined like this:</p>\n\n<pre><code>-- | A value that contains either an @a@ (the 'Left') constructor) or \n-- a @b@ (the 'Right' constructor).\ndata Either a b = Left a | Right b\n</code></pre>\n\n<p>This allows you to have values like these:</p>\n\n<pre><code>example1, example2 :: Either String Int\nexample1 = Left \"Hello!\"\nexample2 = Right 42\n</code></pre>\n\n<p>...but also like this one:</p>\n\n<pre><code>example3, example4 :: Either String String\nexample3 = Left \"Hello!\"\nexample4 = Right \"Hello!\"\n</code></pre>\n\n<p>The type <code>Either String String</code>, the first time you encounter it, sounds like \"either a <code>String</code> or a <code>String</code>,\" and you might therefore think that it's the same as just <code>String</code>.  But it isn't, because Haskell unions are <em>tagged</em> unions, and therefore an <code>Either String String</code> records not just a <code>String</code>, but also which of the \"tags\" (data constructors; in this case <code>Left</code> and <code>Right</code>) was used to construct it.  So even though both alternatives carry a <code>String</code> as their payload, you're able to tell how any one value was originally built.  This is good because there are lots of cases where the alternatives are the same type but the constructors/tags impart extra meaning:</p>\n\n<pre><code>data ResultMessage = FailureMessage String | SuccessMessage String\n</code></pre>\n\n<p>Here the data constructors are <code>FailureMessage</code> and <code>SuccessMessage</code>, and you can guess from the names that even though the payload in both cases is a <code>String</code>, they would mean very different things!</p>\n\n<p>So bringing it back to <code>Maybe</code>/<code>Just</code>, what's happening here is that Haskell just uniformly works like that: every alternative of a union type has a distinct data constructor that must always be used to construct and pattern match values of its type.  Even if at first you might think it would be possible to guess it from context, it just doesn't do it.</p>\n\n<p>There are other reasons, a bit more technical.  First, the rules for lazy evaluation are defined in terms of data constructors.  The short version: lazy evaluation means that if Haskell is forced to peek inside of a value of type <code>Maybe a</code>, it will try to do the bare minimum amount of work needed to figure out whether it looks like <code>Nothing</code> or like <code>Just x</code>\u2014preferably it won't peek inside the <code>x</code> when it does this.</p>\n\n<p>Second: the language needs to be able distinguish types like <code>Maybe a</code>, <code>Maybe (Maybe a)</code> and <code>Maybe (Maybe (Maybe a))</code>.  If you think about it, if we had a type definition that worked like you wrote:</p>\n\n<pre><code>data Maybe a = Nothing | a  -- NOT VALID HASKELL\n</code></pre>\n\n<p>...and we wanted to make a value of type <code>Maybe (Maybe a)</code>, you wouldn't be able to tell these two values apart:</p>\n\n<pre><code>example5, example6 :: Maybe (Maybe a)\nexample5 = Nothing\nexample6 = Just Nothing\n</code></pre>\n\n<p>This might seem a bit silly at first, but imagine you have a map whose values are \"nullable\":</p>\n\n<pre><code>-- Map of persons to their favorite number.  If we know that some person\n-- doesn't have a favorite number, we store `Nothing` as the value for\n-- that person.\nfavoriteNumber :: Map Person (Maybe Int)\n</code></pre>\n\n<p>...and want to look up an entry:</p>\n\n<pre><code>Map.lookup :: Ord k =&gt; Map k v -&gt; k -&gt; Maybe v\n</code></pre>\n\n<p>So if we look up <code>mary</code> in the map we have:</p>\n\n<pre><code>Map.lookup favoriteNumber mary :: Maybe (Maybe Int)\n</code></pre>\n\n<p>And now the result <code>Nothing</code> means Mary's not in the map, while <code>Just Nothing</code> means Mary's in the map but she doesn't have a favorite number.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1439851119, "creation_date": 1439851119, "answer_id": 32060828, "question_id": 32058506, "link": "https://stackoverflow.com/questions/32058506/why-does-maybe-include-just/32060828#32060828", "title": "Why does Maybe include Just?", "body": "<p><code>Maybe a</code> is designed so to have one more value than the type <code>a</code>. In type theory, sometimes it is written as <code>1 + a</code> (up to iso), which makes that fact even more evident.</p>\n\n<p>As an experiment, consider the type <code>Maybe (Maybe Bool)</code>. Here we have <code>1 + 1 + 2</code> values, namely:</p>\n\n<pre><code>Nothing\nJust Nothing\nJust (Just False)\nJust (Just True)\n</code></pre>\n\n<p>If we were allowed to define</p>\n\n<pre><code>data Maybe a = Nothing | a\n</code></pre>\n\n<p>we would lose the distinction between the cases <code>Just Nothing</code> and <code>Nothing</code>, since there is no longer <code>Just</code> to make them apart. Indeed, <code>Maybe (Maybe a)</code> would collapse into <code>Maybe a</code>. This would be an inconvenient special case.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1610, "favorite_count": 1, "accepted_answer_id": 32058593, "answer_count": 4, "score": 23, "last_activity_date": 1439880979, "creation_date": 1439840892, "last_edit_date": 1495540409, "question_id": 32058506, "link": "https://stackoverflow.com/questions/32058506/why-does-maybe-include-just", "title": "Why does Maybe include Just?", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/a/18809252/656912\">some excellent answers here</a>, I generally understand (clearly in a limited way) the purpose of Haskell's <code>Maybe</code> and that its definition is</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>however I'm not entity clear exactly why <code>Just</code> is a part of this definition. As near as I can tell, this is where <code>Just</code> itself is defined, but the the relevant documentation doesn't say much about it.</p>\n\n<p>Am I correct is thinking that the primary benefit of using <code>Just</code> in the definition of <code>Maybe</code>, rather than simply</p>\n\n<pre><code>data Maybe a = Nothing | a\n</code></pre>\n\n<p>is that it allows for pattern matching to with <code>Just _</code> and for useful functionality like <code>isJust</code> and <code>fromJust</code>?</p>\n\n<p>Why is <code>Maybe</code> defined in the former way rather than the latter?</p>\n"}, {"tags": ["haskell", "exception-handling", "runtime-error"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1439834382, "post_id": 32056598, "comment_id": 52012446, "body": "Your code is correct. This is a bug in the chesshs library you&#39;re using. On bad input it should return <code>Left NoParse</code>, but instead it crashes due to the use of partial functions like <code>head</code> and <code>digitToInt</code> :("}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439835813, "post_id": 32056598, "comment_id": 52013254, "body": "I agree, the solution is total function, which can only themselves be composed of total functions. You will need to wrap the library calls in a catch statement to make the functions total..."}, {"owner": {"reputation": 2487, "user_id": 1324356, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/EqyV4.png?s=128&g=1", "display_name": "Jaap Joris Vens", "link": "https://stackoverflow.com/users/1324356/jaap-joris-vens"}, "edited": false, "score": 0, "creation_date": 1439835854, "post_id": 32056598, "comment_id": 52013281, "body": "&quot;You will need to wrap the library calls in a catch statement&quot;  How do I do that?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1439836946, "post_id": 32056598, "comment_id": 52013833, "body": "This may be informative: <a href=\"http://stackoverflow.com/a/6009807/1465011\"><b>Exception handling in Haskell</b></a>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1439841242, "post_id": 32056598, "comment_id": 52016023, "body": "The provided answer, <code>spoon</code>, is something of a band-aid when you should fix the foundation (though a useful band-aid and the answer is great, not attacking that).  Consider instead: 1) send a patch to the upstream library 2) validate the input before calling the partial function in question."}], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 7, "last_activity_date": 1439838198, "last_edit_date": 1495542583, "creation_date": 1439838198, "answer_id": 32057810, "question_id": 32056598, "link": "https://stackoverflow.com/questions/32056598/how-to-handle-runtime-errors-in-haskell/32057810#32057810", "title": "How to handle runtime errors in Haskell?", "body": "<p>In an ideal world, you would avoid functions like <code>head</code> and not have runtime errors at all. Runtime errors are <strong>fundamentally awkward</strong>, especially in Haskell.</p>\n\n<p>In this case, you want to catch the runtime error. If you're content to turn it into a <code>Maybe</code>, you can use the <a href=\"https://hackage.haskell.org/package/spoon\" rel=\"nofollow noreferrer\"><code>spoon</code></a> package.</p>\n\n<p>Exceptions in Haskell are subtle thanks to laziness. Particularly, if you don't evaluate the part of the structure that has the exception, it won't fire. This is handled in <code>spoon</code> with two different functions:</p>\n\n<ul>\n<li><code>spoon</code>, which evaluates a structure <em>deeply</em> but requires an instance of a special typeclass</li>\n<li><code>teaspoon</code> which only evaluates your structure part of the way to <a href=\"https://stackoverflow.com/questions/6872898/haskell-what-is-weak-head-normal-form\">weak head normal form</a></li>\n</ul>\n\n<p>For your case, I think <code>teaspoon</code> should be fine. Try checking the result of the parse with:</p>\n\n<pre><code>teaspoon (moveSAN move board)\n</code></pre>\n\n<p>which should give you a <code>Maybe</code> value.</p>\n\n<p>If that doesn't work, it means you need to evaluate more of the structure to hit the exception. It looks like <code>Board</code> does not implement the typeclass needed to deeply evaluate it with <code>spoon</code>, so your best bet is a bit hacky: use <code>spoon</code> on the result of <code>show</code>:</p>\n\n<pre><code>spoon (show $ moveSAN move board)\n</code></pre>\n\n<p>This will give you a <code>Maybe String</code>. If it's <code>Just</code>, the move parsed correctly; if it's <code>Nothing</code>, there was an error.</p>\n\n<p>It's worth noting that the <code>spoon</code> package doesn't really do much: each function it has is only <a href=\"https://hackage.haskell.org/package/spoon-0.3.1/docs/src/Control-Spoon.html#teaspoon\" rel=\"nofollow noreferrer\">a couple of lines</a>. At some point, it's worth figuring out how to handle exceptions in Haskell yourself, but for now <code>spoon</code> is just a bit more convenient and should work properly for you.</p>\n"}], "owner": {"reputation": 2487, "user_id": 1324356, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/EqyV4.png?s=128&g=1", "display_name": "Jaap Joris Vens", "link": "https://stackoverflow.com/users/1324356/jaap-joris-vens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "accepted_answer_id": 32057810, "answer_count": 1, "score": 6, "last_activity_date": 1439838198, "creation_date": 1439833601, "question_id": 32056598, "link": "https://stackoverflow.com/questions/32056598/how-to-handle-runtime-errors-in-haskell", "title": "How to handle runtime errors in Haskell?", "body": "<p>I'm trying to learn Haskell by writing a simple console chess game. It displays a chess board and gets moves from standard input in <a href=\"https://en.wikipedia.org/wiki/Algebraic_notation_(chess)\">SAN notation</a>. Here's what I've got so far:</p>\n\n<pre><code>import System.IO\nimport Chess\nimport Chess.FEN\n\nmain = do\n  putStrLn \"Welcome to Console Chess!\"\n  putStrLn $ show defaultBoard\n  gameLoop defaultBoard\n\ngameLoop board = do\n  putStr \"Your move: \"\n  hFlush stdout\n  move &lt;- getLine\n  let newBoard = moveSAN move board\n  case newBoard of\n   Left _ -&gt; do\n     putStrLn \"Invalid move, try again...\"\n     gameLoop board\n   Right b -&gt; do\n     putStrLn $ show b\n     gameLoop b\n</code></pre>\n\n<p>The problem is that the call to the <code>moveSAN</code> function sometimes crashes the program, losing all progress made in the game. For instance, pressing Enter at the \"Your move:\" prompt produces:</p>\n\n<pre><code>Your move: \ncchess: Prelude.head: empty list\n</code></pre>\n\n<p>Otherwise, entering a two-digit number produces:</p>\n\n<pre><code>Your move: 11\ncchess: Error in array index\n</code></pre>\n\n<p>Entering two periods gives:</p>\n\n<pre><code>Your move: ..\ncchess: Char.digitToInt: not a digit '.'\n</code></pre>\n\n<p>I would like to catch these errors and inform the user that the move they have entered is not in valid SAN notation. How can I do that?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1439833271, "post_id": 32056487, "comment_id": 52011857, "body": "I suspect you meant <code>One a | Many [a]</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 4, "creation_date": 1439833636, "post_id": 32056487, "comment_id": 52012045, "body": "Don&#39;t you want <code>flat (Many [&#39;3&#39;])</code>? or <code>flat (Many [3])</code> without the type signature."}, {"owner": {"reputation": 1819, "user_id": 4379891, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/00537a374fd78cbd4f92745dbb2ee0f0?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/4379891/kevin"}, "edited": false, "score": 0, "creation_date": 1439834000, "post_id": 32056487, "comment_id": 52012234, "body": "ah, that is unexpected, I guess what I am trying to do is to flatten out a nested list of arbitrary depth (I am debugging by printing stuff out right now), I thought I can define a new data structure to do that, but it seem like I actually have to define the type for each element? That seems to defeat the purpose. Is there a way to pattern match Many vs One"}, {"owner": {"reputation": 1603, "user_id": 225292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/139dd92ae95a2075a124e552c1299d54?s=128&d=identicon&r=PG", "display_name": "paul", "link": "https://stackoverflow.com/users/225292/paul"}, "edited": false, "score": 0, "creation_date": 1439834176, "post_id": 32056487, "comment_id": 52012345, "body": "Check this question out: <a href=\"http://stackoverflow.com/questions/9507358/haskell-flatten-a-list-of-lists\" title=\"haskell flatten a list of lists\">stackoverflow.com/questions/9507358/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439863239, "post_id": 32056487, "comment_id": 52023127, "body": "@Kevin But <code>show</code> can already handle arbitrarily-deeply nested lists... why introduce another data structure at all? Perhaps you can show a bit more context, since this seems like you have a legitimate problem and are asking about some trouble you are having with a particular solution to that problem, when a better solution exists."}], "answers": [{"comments": [{"owner": {"reputation": 1819, "user_id": 4379891, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/00537a374fd78cbd4f92745dbb2ee0f0?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/4379891/kevin"}, "edited": false, "score": 0, "creation_date": 1439834083, "post_id": 32056662, "comment_id": 52012282, "body": "Is there a way to automatically detect <code>[3]</code> to be Many type without explicitly defining it?"}, {"owner": {"reputation": 1603, "user_id": 225292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/139dd92ae95a2075a124e552c1299d54?s=128&d=identicon&r=PG", "display_name": "paul", "link": "https://stackoverflow.com/users/225292/paul"}, "reply_to_user": {"reputation": 1819, "user_id": 4379891, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/00537a374fd78cbd4f92745dbb2ee0f0?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/4379891/kevin"}, "edited": false, "score": 0, "creation_date": 1439840293, "post_id": 32056662, "comment_id": 52015524, "body": "@Kevin you <i>could</i> write a custom Read implementation for it and do <code>flat . read</code> (with the appropriate type specified), but other than that, no; you&#39;d have to define it as <code>Many [One 3]</code> to get it to go through <code>flat</code>."}], "tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": true, "score": 4, "last_activity_date": 1439833825, "creation_date": 1439833825, "answer_id": 32056662, "question_id": 32056487, "link": "https://stackoverflow.com/questions/32056487/couldnt-match-expected-type-in-haskell-code-that-print-nested-list/32056662#32056662", "title": "Couldn&#39;t match expected type in Haskell code that print nested list?", "body": "<p><code>flat [[3]]</code> yields a type error.  <code>[[3]]</code> has type <code>Num a =&gt; [[a]]</code>, not <code>Show a =&gt; Item a</code> that you can pass into <code>flat</code>.</p>\n\n<p><code>flat (Many [3])</code> will return <code>\"[3]\"</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1439901965, "creation_date": 1439901965, "answer_id": 32072841, "question_id": 32056487, "link": "https://stackoverflow.com/questions/32056487/couldnt-match-expected-type-in-haskell-code-that-print-nested-list/32072841#32072841", "title": "Couldn&#39;t match expected type in Haskell code that print nested list?", "body": "<p>Answering a follow-up question you asked in the comments of @jtobin's answer: yes there is a way to automatically dectect that <code>[3]</code> needs to be wrapped into a Maybe constructor. However you'll probably need to add type annotations (cf. <code>example</code> to help Haskell figure out what to do=.</p>\n\n<p>We start with a bunch of language extensions.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses  #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE FlexibleInstances      #-}\n</code></pre>\n\n<p>Then comes your definition of <code>Item</code>.</p>\n\n<pre><code>module Item where\n\ndata Item a = One a | Many [Item a]\n</code></pre>\n\n<p>We introduce a class of things which may be reified to an <code>Item a</code> and declare two instances: the <code>Many</code> one and the base case. You can see that we now have overlapping instances (e.g. for Itemable [Int] [Int]) so you're playing with fire here.</p>\n\n<pre><code>class Itemable b a where\n  item :: b -&gt; Item a\n\ninstance Itemable b a =&gt; Itemable [b] a where\n  item = Many . fmap item\ninstance Itemable a a where\n  item = One\n</code></pre>\n\n<p>You can finally define <code>flat</code> as a function that turns a <code>b</code> into an <code>Item a</code> first and then flattens it:</p>\n\n<pre><code>flat :: Itemable b a =&gt; b -&gt; [a]\nflat = go . item where\n  go (One a)   = [a]\n  go (Many as) = concatMap go as\n</code></pre>\n\n<p>Which works as the following example typechecking and evaluating to <code>[2,43,7,8,1]</code> shows:</p>\n\n<pre><code>example :: [Int]\nexample = flat [[[[[[2::Int],[43]],[[7],[8]],[[1]]]]]]\n</code></pre>\n\n<p>However, as soon as you try to use the overlapping instances it'll blow in your face. E.g.:</p>\n\n<pre><code>example' :: [[Int]]\nexample' = flat [[[[[[2::Int],[43]],[[7],[8]],[[1]]]]]]\n</code></pre>\n"}], "owner": {"reputation": 1819, "user_id": 4379891, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/00537a374fd78cbd4f92745dbb2ee0f0?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/4379891/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 32056662, "answer_count": 2, "score": 1, "last_activity_date": 1439901965, "creation_date": 1439833118, "last_edit_date": 1439834241, "question_id": 32056487, "link": "https://stackoverflow.com/questions/32056487/couldnt-match-expected-type-in-haskell-code-that-print-nested-list", "title": "Couldn&#39;t match expected type in Haskell code that print nested list?", "body": "<p>Here is my function</p>\n\n<pre><code>data Item a = One a | Many [Item a]\nlet flat (One x) = show x\nlet flat (Many xs) = show xs\n</code></pre>\n\n<p>Here is the output</p>\n\n<pre><code>Prelude&gt; flat [[3]]\n\n&lt;interactive&gt;:21:6:\nCouldn't match expected type \u2018Item t0\u2019 with actual type \u2018[[t1]]\u2019\nIn the first argument of \u2018flat\u2019, namely \u2018[[3]]\u2019\nIn the expression: flat [[3]]\nIn an equation for \u2018it\u2019: it = flat [[3]]\n</code></pre>\n\n<p>It seems like flat doesn't recognize Item as its function signature so I tried redefine the function signature</p>\n\n<pre><code>flat :: Item a -&gt; [a]\n\n&lt;interactive&gt;:22:1:\n    Couldn't match type \u2018a1\u2019 with \u2018Char\u2019\n  \u2018a1\u2019 is a rigid type variable bound by\n       an expression type signature: Item a1 -&gt; [a1] at  &lt;interactive&gt;:22:1\nExpected type: Item a1 -&gt; [a1]\n  Actual type: Item a1 -&gt; String\nIn the expression: flat :: Item a -&gt; [a]\nIn an equation for \u2018it\u2019: it = flat :: Item a -&gt; [a]\n</code></pre>\n\n<p>But Haskell does not let you redefine function signature in ghci, is there a way around this?</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 2, "last_activity_date": 1439913808, "creation_date": 1439913808, "answer_id": 32077326, "question_id": 32055842, "link": "https://stackoverflow.com/questions/32055842/how-to-check-if-running-shake-would-rebuild-a-target-without-actually-trying-to/32077326#32077326", "title": "How to check if running shake would rebuild a target (without actually trying to build it)?", "body": "<p>In Shake what files are \"dirty\" is a bit difficult to determine. If your file of interest depends on any oracles (even transitively), then the file is considered \"dirty\", since oracles are always dirty. However, if Shake reruns the dependent rules/oracles and they don't change, then at that point it is considered clean again. As a result, most rules are considered dirty before anything has been run, and only after running some rules does it become clean.</p>\n\n<p>I have <a href=\"https://github.com/ndmitchell/shake/issues/289\" rel=\"nofollow\">raised a ticket</a> to do something better. One option would be given a target rule, to say which leaves depend on it and are dirty - that would list the oracles (which you reasonably expect not to change) and if it lists any source files, you would expect it to rebuild.</p>\n\n<p>(I'd welcome suggestions if anyone has any good ideas.) </p>\n"}], "owner": {"reputation": 390, "user_id": 395106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fb92f1a86d6c574d2c9412d4abe18bf?s=128&d=identicon&r=PG", "display_name": "stefanwehr", "link": "https://stackoverflow.com/users/395106/stefanwehr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1439913808, "creation_date": 1439830597, "last_edit_date": 1495540109, "question_id": 32055842, "link": "https://stackoverflow.com/questions/32055842/how-to-check-if-running-shake-would-rebuild-a-target-without-actually-trying-to", "title": "How to check if running shake would rebuild a target (without actually trying to build it)?", "body": "<p>In certain situations, I want to know very quickly if a certain target file is up-to-date, i.e. whether or not building it with shake would run any of the rules transitively contributing to the target.</p>\n\n<p>What's the best way to achieve this with shake?</p>\n\n<p>My question is somewhat related to <a href=\"https://stackoverflow.com/questions/30284679/shake-signal-whether-anything-had-to-be-rebuilt-at-all\">Shake: Signal whether anything had to be rebuilt at all</a>. However, I do not want to run the actual build because I do not want to touch any of my build products.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1439830487, "post_id": 32055730, "comment_id": 52010394, "body": "It appears that you have generated an empty list. Does: <code>null alltrees1</code> equal <code>True</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1439831814, "post_id": 32055730, "comment_id": 52011086, "body": "BTW, <code>alltrees = [getAllTrees c | x &lt;- allparams, c &lt;- [x]]</code> means <code>alltrees = [getAllTrees x | x &lt;- allparams]</code> i.e. <code>alltrees = map getAllTrees allparams</code>"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 3, "creation_date": 1439837914, "post_id": 32055730, "comment_id": 52014288, "body": "List indexing starts at <code>0</code>, so <code>forM_ [1..(sizeoflist alltrees)] $ \\i -&gt; ... alltrees !! i</code> is not going to work. But more generally, you should not use <code>!!</code> if you can avoid it. It looks as if you should just be able to use <code>map</code>."}, {"owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "edited": false, "score": 0, "creation_date": 1439839252, "post_id": 32055730, "comment_id": 52014940, "body": "*Main&gt; null alltrees1 *** Exception: Prelude.(!!): index too large, it return error , not true"}, {"owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "edited": false, "score": 0, "creation_date": 1439839350, "post_id": 32055730, "comment_id": 52015003, "body": "i change to start from 0 in forM_ still have the same error"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1439851804, "post_id": 32055730, "comment_id": 52020485, "body": "Seriously, don&#39;t use <code>!!</code> for this. Indexing lists is <i>slow</i> as well as error prone. Use <code>forM_ alltrees</code> or the like."}, {"owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "edited": false, "score": 0, "creation_date": 1439855033, "post_id": 32055730, "comment_id": 52021346, "body": "how to use forM_ alltrees without !!? i can not compile after replace  with let alltrees1 = forM_ alltrees $ \\i -&gt; forM_ alltrees $ \\j -&gt; [(alltrees!!i!!j, eeval1(alltrees!!i!!j) &gt;= eeval1(alltrees!!i!!j) &amp;&amp; eeval2(alltrees!!i!!j) &gt;= eeval2(alltrees!!i!!j) &amp;&amp; eeval3(alltrees!!i!!j) &gt;= eeval3(alltrees!!i!!j) &amp;&amp; eeval4(alltrees!!i!!j) &gt;= eeval4(alltrees!!i!!j))]"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440249412, "post_id": 32055730, "comment_id": 52201288, "body": "&#216;rjan is suggesting you apply a list traversal function instead of using indices. If I understand what you&#39;re trying to do properly, the best function for you is <code>map</code>. Think about what <code>map (map f) xs</code> does if <code>f</code> is a function and <code>xs</code> is a list of lists."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 1, "creation_date": 1443706307, "post_id": 32055730, "comment_id": 53607527, "body": "Why did you completely change an existing question? And I have no idea what you&#39;re asking now."}, {"owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "edited": false, "score": 0, "creation_date": 1443706310, "post_id": 32055730, "comment_id": 53607529, "body": "i forget the original question and try another question"}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1443706613, "post_id": 32055730, "comment_id": 53607720, "body": "Well this question already had comments on it which are now irrelevant. You can post a new question, but make it clear what you&#39;re asking because this one is quite unclear. And stick to one question at a time, not two as you seem to be asking here."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1443717123, "post_id": 32055730, "comment_id": 53614637, "body": "I just rolled back the question to its previous form. Ask a new question separately, as a new question."}, {"owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "edited": false, "score": 0, "creation_date": 1443772352, "post_id": 32055730, "comment_id": 53633956, "body": "reached your question limit, how to increase limit?"}], "owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 714, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1443717046, "creation_date": 1439830196, "last_edit_date": 1443717046, "question_id": 32055730, "link": "https://stackoverflow.com/questions/32055730/exception-prelude-index-too-large-error", "title": "Exception: Prelude.(!!): index too large error", "body": "<p><strong>update1:</strong></p>\n\n<p>after tried a new way to do 2d array's access, it can not use bracket of bracket</p>\n\n<pre><code>let allparams = replicateM 3 [1.0, 2.0, 3.0]\nlet alltrees = [getAllTrees c | x &lt;- allparams, c &lt;- [x]]\nlet alltrees1 = [b | c &lt;- alltrees | x &lt;- [c] | b &lt;- [d | ee &lt;- alltrees | y &lt;- [ee] | d &lt;- ((x,y), eeval1(x) &gt;= eeval1(y) &amp;&amp; eeval2(x) &gt;= eeval2(y) &amp;&amp; eeval3(x) &gt;= eeval3(y) &amp;&amp; eeval4(x) &gt;= eeval4(y))]]\n\n\n&lt;interactive&gt;:8:36:\n    Unexpected parallel statement in a list comprehension\n    Use -XParallelListComp\n\n&lt;interactive&gt;:8:44: Not in scope: `c'\n\n&lt;interactive&gt;:8:74:\n    Unexpected parallel statement in a list comprehension\n    Use -XParallelListComp\n\n&lt;interactive&gt;:8:82:\n    Not in scope: `ee'\n    Perhaps you meant one of these:\n      `e' (imported from Math.Algebras.VectorSpace),\n      e' (imported from Math.Algebras.VectorSpace),\n      `e1' (imported from Math.Algebras.VectorSpace)\n\n&lt;interactive&gt;:8:95: Not in scope: `x'\n\n&lt;interactive&gt;:8:97: Not in scope: `y'\n\n&lt;interactive&gt;:8:108: Not in scope: `x'\n\n&lt;interactive&gt;:8:121: Not in scope: `y'\n\n&lt;interactive&gt;:8:134: Not in scope: `x'\n\n&lt;interactive&gt;:8:147: Not in scope: `y'\n\n&lt;interactive&gt;:8:160: Not in scope: `x'\n\n&lt;interactive&gt;:8:173: Not in scope: `y'\n\n&lt;interactive&gt;:8:186: Not in scope: `x'\n\n&lt;interactive&gt;:8:199: Not in scope: `y'\n</code></pre>\n\n<p>got an error when run code below after load :l trees.hs\nwhen make a list of (tree equations , true or false)\nand will be filter true or false to display tree equations</p>\n\n<p>before that , after make the list, it has error</p>\n\n<pre><code>let allparams = replicateM 3 [1.0, 2.0, 3.0]\nlet alltrees = [getAllTrees c | x &lt;- allparams, c &lt;- [x]]\nlet alltrees1 = forM_ [1..(sizeoflist alltrees)] $ \\i -&gt; forM_ [1..(sizeoflist (alltrees!!i))] $ \\j -&gt; [(alltrees!!i!!j, eeval1(alltrees!!i!!j) &gt; eeval1(alltrees!!i!!j) &amp;&amp; eeval2(alltrees!!i!!j) &gt; eeval2(alltrees!!i!!j) &amp;&amp; eeval3(alltrees!!i!!j) &gt; eeval3(alltrees!!i!!j) &amp;&amp; eeval4(alltrees!!i!!j) &gt; eeval4(alltrees!!i!!j))]\n</code></pre>\n\n<p>error , how to show items when it is too large</p>\n\n<pre><code>*Main&gt; alltrees1!!0\n*** Exception: Prelude.(!!): index too large\n</code></pre>\n\n<p>trees.hs</p>\n\n<pre><code>import Data.List\nimport Data.Array\n--import Data.Set\n--import Data.Graph \nimport Control.Monad\nimport Math.Combinat\nimport Math.Core.Utils\nimport Math.Core.Field\nimport Math.Algebras.VectorSpace\nimport Math.Algebras.Structures\n--import Math.CommutativeAlgebra.GroebnerBasis\n--import Math.CommutativeAlgebra.Polynomial\n--import Math.Algebras.Matrix\nimport System.IO\nimport qualified Data.Map as M\n\ntype Vertex = Int\ntype Table a = Array Vertex a\ntype Graph e = Table [(e, Vertex)]\ntype Bounds  = (Vertex, Vertex)\ntype Edge e = (Vertex, e, Vertex)\n\ntype Labeling a = Vertex -&gt; a\ndata LabGraph n e = LabGraph (Graph e) (Labeling n)\n\ndata Operation\n  = And\n  | Or\n  | MA\n  | MB\n  | Impl\n    deriving Show\n\ndata Mree x\n = Meaf x\n | Mode (Mree x) Operation (Mree x)\n   deriving Show\n\nsplits :: [a] -&gt; [([a], [a])]\nsplits xs = zip (inits xs) (tails xs)\n\ngetAllTrees :: [a] -&gt; [Mree a]\ngetAllTrees [] = []\ngetAllTrees [x] = return $ Meaf x\ngetAllTrees xs = do\n  (left, right) &lt;- splits xs\n  guard $ not (null left) &amp;&amp; not (null right)\n  leftT &lt;- getAllTrees left\n  rightT &lt;- getAllTrees right\n  op &lt;- [MA, MB, And, Or]\n  return $ Mode leftT op rightT\n\neeval1 :: Mree Double -&gt; Double\neeval1 (Meaf x) = x\neeval1 (Mode l And r) = eeval1 l * eeval1 r\neeval1 (Mode l Or r) = eeval1 l + eeval1 r\neeval1 (Mode l MA r) = eeval1 l + eeval1 r\neeval1 (Mode l MB r) = eeval1 l + eeval1 r\n\neeval2 :: Mree Double -&gt; Double\neeval2 (Meaf x) = x\neeval2 (Mode l And r) = eeval2 l * eeval2 r\neeval2 (Mode l Or r) = eeval2 l + eeval2 r\neeval2 (Mode l MA r) = eeval2 l + eeval2 r\neeval2 (Mode l MB r) = eeval2 l * eeval2 r\n\neeval3 :: Mree Double -&gt; Double\neeval3 (Meaf x) = x\neeval3 (Mode l And r) = eeval3 l * eeval3 r\neeval3 (Mode l Or r) = eeval3 l + eeval3 r\neeval3 (Mode l MA r) = eeval3 l * eeval3 r\neeval3 (Mode l MB r) = eeval3 l + eeval3 r\n\neeval4 :: Mree Double -&gt; Double\neeval4 (Meaf x) = x\neeval4 (Mode l And r) = eeval4 l * eeval4 r\neeval4 (Mode l Or r) = eeval4 l + eeval4 r\neeval4 (Mode l MA r) = eeval4 l * eeval4 r\neeval4 (Mode l MB r) = eeval4 l * eeval4 r\n\nsizeoflist :: [a] -&gt; Int\nsizeoflist = length\n</code></pre>\n"}, {"tags": ["haskell", "docker", "cabal", "jupyter", "ihaskell"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1439893333, "creation_date": 1439893333, "answer_id": 32069721, "question_id": 32054409, "link": "https://stackoverflow.com/questions/32054409/stack-docker-ihaskell-weird-behaviour/32069721#32069721", "title": "Stack/Docker/IHaskell weird behaviour", "body": "<p>There have been a lot of improvements made recently to stack ghci, which is still mostly a work in progress. I'd recommend testing out stack master, and if the problem still exists opening a Github issue.</p>\n"}], "owner": {"reputation": 368, "user_id": 1694636, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/jV6vG.gif?s=128&g=1", "display_name": "swish", "link": "https://stackoverflow.com/users/1694636/swish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1439893333, "creation_date": 1439826019, "question_id": 32054409, "link": "https://stackoverflow.com/questions/32054409/stack-docker-ihaskell-weird-behaviour", "title": "Stack/Docker/IHaskell weird behaviour", "body": "<p>I have a package with bunch of *.c and *.cpp files, listed inside <code>c-sources</code> field of <code>*.cabal</code> file. I need to include it inside a project with IHaskell and some other packages. Everything works fine, and builds without a problem. <code>stack exec ghci</code> works fine and I can import modules and execute any code. <code>stack ghci</code> though throws some weird errors, like this:</p>\n\n<pre><code>In file included from &lt;command-line&gt;:10:0: \n\n/...blabla.../.stack-work/dist/x86_64-linux/Cabal-1.22.4.0/build/autogen/cabal_macros.h:157:0:\n     note: this is the location of the previous definition\n     #define CURRENT_PACKAGE_KEY \"blabla\"\n     ^\n</code></pre>\n\n<p>And <code>stack ghci</code> inside my package complains about symbols exported from its C code. Another weird thing is that symbols depend on the order of <code>exposed-modules</code> in the configuration, so the error goes away if I put my *.hs module on top of others, but if I have two *.hs files importing from the same *.c file, it won't work! <code>stack exec jupyter -- console --kernel haskell</code> starts, but immediately throws <code>unknown symbol</code> error if I try to run some code from my package, always the same though.</p>\n\n<p>I have a docker image based on <code>fpco/stack-build</code>, which just installs jupyter and other necessary stuff. I use <code>lts-3.0</code> snapshot, if it's somehow relevant.</p>\n\n<p>What is going on? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1439825639, "creation_date": 1439825639, "answer_id": 32054279, "question_id": 32053098, "link": "https://stackoverflow.com/questions/32053098/how-to-do-function-of-another-functions-combinations-in-haskell/32054279#32054279", "title": "how to do function of another function&#39;s combinations in haskell", "body": "<p>Is this what you want to do?</p>\n\n<pre><code>efuncs = [ (\"eeval1\", eeval1), (\"eeval2\", eeval2), (\"eeval3\", eeval3), (\"eeval4\", eeval4) ]\n\nexample = do\n  let allparams = replicateM 5 [1.0, 2.0, 3.0, 4.0, 5.0]\n  let alltrees = [getAllTrees c | x &lt;- allparams, c &lt;- [x]]\n      t = alltrees !! 0 !! 0\n  putStrLn $ \"tree: \" ++ show t\n  forM_ efuncs $ \\(name, eval) -&gt; do\n    putStrLn $ \"- \" ++ name ++ \": \" ++ show (eval t)\n</code></pre>\n\n<p>Running <code>example</code> prints out:</p>\n\n<pre><code>tree: Mode (Meaf 1.0) MA (Mode (Meaf 1.0) MA (Mode (Meaf 1.0) MA (Mode (Meaf 1.0) MA (Meaf 1.0))))\n- eeval1: 5.0\n- eeval2: 5.0\n- eeval3: 1.0\n- eeval4: 1.0\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4304320, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVzim.jpg?s=128&g=1", "display_name": "Martin Lee", "link": "https://stackoverflow.com/users/4304320/martin-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 32054279, "answer_count": 1, "score": 0, "last_activity_date": 1439825639, "creation_date": 1439822010, "last_edit_date": 1439822709, "question_id": 32053098, "link": "https://stackoverflow.com/questions/32053098/how-to-do-function-of-another-functions-combinations-in-haskell", "title": "how to do function of another function&#39;s combinations in haskell", "body": "<p>I would like to search and validate a definition satisfy <code>eeval1</code>, <code>eeval2</code>, <code>eeval3</code>, <code>eeval4</code> and print the result definitions</p>\n\n<p>If I define <code>f</code>, it could be <code>x+y</code>, <code>x*y</code>, and <code>g</code> could be <code>x+y</code>, <code>x*y</code>\nand run through a combinations of them, which can have 4 combinations\nif the each possible definition satisfy four combinations, then it is true definition</p>\n\n<p>Current <code>MA</code> and <code>MB</code> function can only be as a operator <code>+</code> and <code>*</code>, and have redundant combinations such as some do not have both <code>MA</code> and <code>MB</code></p>\n\n<pre><code>MA(x, MB(x,y)) + MA(MB(x,y), y) &gt;= MA(MB(x,y), MB(x,y))\nMA(x, MB(x,y)) + MA(x, MB(x,y)) &gt;= MA(MB(x,y), y)\nMA(x, MB(x,y))*MA(x, MB(x,y)) &gt;= MA(MB(x,y), y)\nMA(x, MB(x,y)) + MA(x, MB(x,y)) &gt;= MB(MA(x,y), y)\n\nyou can see MA as function f, MB as function g\nf(x, g(x,y)) + f(g(x,y), y) &gt;= f(g(x,y), g(x,y))\nf(x, g(x,y)) + f(x, g(x,y)) &gt;= f(g(x,y), y)\n</code></pre>\n\n<p><strong>Haskell code:</strong></p>\n\n<pre><code>import Data.List\nimport Data.Array\n--import Data.Graph \nimport Control.Monad\nimport Math.Combinat\nimport Math.Core.Utils\nimport Math.Core.Field\nimport Math.Algebras.VectorSpace\nimport Math.Algebras.Structures\n--import Math.CommutativeAlgebra.GroebnerBasis\n--import Math.CommutativeAlgebra.Polynomial\n--import Math.Algebras.Matrix\nimport System.IO\nimport qualified Data.Map as M\n\ntype Vertex = Int\ntype Table a = Array Vertex a\ntype Graph e = Table [(e, Vertex)]\ntype Bounds  = (Vertex, Vertex)\ntype Edge e = (Vertex, e, Vertex)\n\ntype Labeling a = Vertex -&gt; a\ndata LabGraph n e = LabGraph (Graph e) (Labeling n)\n\ndata Operation\n  = And\n  | Or\n  | MA\n  | MB\n  | Impl\n    deriving Show\n\ndata Mree x\n = Meaf x\n | Mode (Mree x) Operation (Mree x)\n   deriving Show\n\nsplits :: [a] -&gt; [([a], [a])]\nsplits xs = zip (inits xs) (tails xs)\n\ngetAllTrees :: [a] -&gt; [Mree a]\ngetAllTrees [] = []\ngetAllTrees [x] = return $ Meaf x\ngetAllTrees xs = do\n  (left, right) &lt;- splits xs\n  guard $ not (null left) &amp;&amp; not (null right)\n  leftT &lt;- getAllTrees left\n  rightT &lt;- getAllTrees right\n  op &lt;- [MA, MB, And, Or]\n  return $ Mode leftT op rightT\n\neeval1 :: Mree Double -&gt; Double\neeval1 (Meaf x) = x\neeval1 (Mode l And r) = eeval1 l * eeval1 r\neeval1 (Mode l Or r) = eeval1 l + eeval1 r\neeval1 (Mode l MA r) = eeval1 l + eeval1 r\neeval1 (Mode l MB r) = eeval1 l + eeval1 r\n\neeval2 :: Mree Double -&gt; Double\neeval2 (Meaf x) = x\neeval2 (Mode l And r) = eeval2 l * eeval2 r\neeval2 (Mode l Or r) = eeval2 l + eeval2 r\neeval2 (Mode l MA r) = eeval2 l + eeval2 r\neeval2 (Mode l MB r) = eeval2 l * eeval2 r\n\neeval3 :: Mree Double -&gt; Double\neeval3 (Meaf x) = x\neeval3 (Mode l And r) = eeval3 l * eeval3 r\neeval3 (Mode l Or r) = eeval3 l + eeval3 r\neeval3 (Mode l MA r) = eeval3 l * eeval3 r\neeval3 (Mode l MB r) = eeval3 l + eeval3 r\n\neeval4 :: Mree Double -&gt; Double\neeval4 (Meaf x) = x\neeval4 (Mode l And r) = eeval4 l * eeval4 r\neeval4 (Mode l Or r) = eeval4 l + eeval4 r\neeval4 (Mode l MA r) = eeval4 l * eeval4 r\neeval4 (Mode l MB r) = eeval4 l * eeval4 r\n\nlet allparams = replicateM 5 [1.0, 2.0, 3.0, 4.0, 5.0]\nlet alltrees = [getAllTrees c | x &lt;- allparams, c &lt;- [x]]\neeval(alltrees!!0!!0)\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1439819030, "post_id": 32050222, "comment_id": 52003125, "body": "Note that using <code>Writer</code> or <code>WriterT</code> with lists as the log-monoid is pretty inefficient (quadratic time), because you keep appending to the right. Difference lists or more specialised containers are a better bet."}, {"owner": {"reputation": 73, "user_id": 5235162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60c5f757a38541577560d146a6bf59fb?s=128&d=identicon&r=PG&f=1", "display_name": "Bryce Tichit", "link": "https://stackoverflow.com/users/5235162/bryce-tichit"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1439826783, "post_id": 32050222, "comment_id": 52008195, "body": "I learned about that recently, indeed it seems more efficient to use Difference list. In any cases we should use Difference Lists as log-monoids everytime since it&#39;s nothing but faster ?"}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 5235162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60c5f757a38541577560d146a6bf59fb?s=128&d=identicon&r=PG&f=1", "display_name": "Bryce Tichit", "link": "https://stackoverflow.com/users/5235162/bryce-tichit"}, "edited": false, "score": 0, "creation_date": 1439826636, "post_id": 32051876, "comment_id": 52008086, "body": "Thank you it works ! I&#39;ll look more into monads transformers. I did not know about them :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1439818645, "creation_date": 1439818645, "answer_id": 32051876, "question_id": 32050222, "link": "https://stackoverflow.com/questions/32050222/haskell-monads-of-monad/32051876#32051876", "title": "Haskell: Monads of monad", "body": "<p>This kind of &ldquo;combination of two monads&rdquo; is an extremely common thing in Haskell. Fortunately, the language is flexible enough that we can nicely abstract over this.</p>\n\n<p>Mathematically speaking what you want is a <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Data-Functor-Compose.html\">composition of two functors</a>. Instead of that newtype, this is usually expressed with the concept of <em>transformers</em>: instead of using the <code>Writer</code> monad directly, you use the <code>WriterT</code> monad transformer. <code>WriterT w [] a</code> is <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Writer-Lazy.html#t:WriterT\">basically the same</a> as <code>[Writer w a]</code>, so in your case you can use:</p>\n\n<pre><code>import Control.Monad.Trans.Class\nimport Control.Monad.Trans.Writer\n\nmoveKnight'' :: KnightPos -&gt; WriterT [] [KnightPos] KnightPos\nmoveKnight'' (c,r) = do\n   (c',r') &lt;- lift [(c+2,r-1),(c+2,r+1),(c-2,r-1),(c-2,r+1)\n                   ,(c+1,r-2),(c+1,r+2),(c-1,r-2),(c-1,r+2)\n                   ]\n   guard (c' `elem` [1..8] &amp;&amp; r' `elem` [1..8])\n   tell [(c,r)]\n   return (c',r')\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 5235162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60c5f757a38541577560d146a6bf59fb?s=128&d=identicon&r=PG&f=1", "display_name": "Bryce Tichit", "link": "https://stackoverflow.com/users/5235162/bryce-tichit"}, "edited": false, "score": 0, "creation_date": 1440187397, "post_id": 32054698, "comment_id": 52186217, "body": "Hey, thanks you very much for your answer. I&#39;m sorry I did not understand clearly... did you write pseudo-code ? I can&#39;t see what is the variable named &quot;a&quot; for you since you use it as a monad but never define it? Maybe i&#39;m mistaken :)"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 73, "user_id": 5235162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60c5f757a38541577560d146a6bf59fb?s=128&d=identicon&r=PG&f=1", "display_name": "Bryce Tichit", "link": "https://stackoverflow.com/users/5235162/bryce-tichit"}, "edited": false, "score": 0, "creation_date": 1440190621, "post_id": 32054698, "comment_id": 52187695, "body": "@Bryce Tichit, you&#39;re welcome. The <code>a</code> is meant to be your <code>a</code>: <code>let a = moveKnight&#39; (2,4) !! 0</code>, i.e. it&#39;s just an example. The actual function <code>moveKnight</code> works for whatever <code>KnightRoute</code> you supply."}, {"owner": {"reputation": 73, "user_id": 5235162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60c5f757a38541577560d146a6bf59fb?s=128&d=identicon&r=PG&f=1", "display_name": "Bryce Tichit", "link": "https://stackoverflow.com/users/5235162/bryce-tichit"}, "edited": false, "score": 0, "creation_date": 1440285119, "post_id": 32054698, "comment_id": 52210962, "body": "I understand now it is a pretty smart way to do it since it uses laziness, I like this it shows how powerful Haskell is :)"}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1439826934, "creation_date": 1439826934, "answer_id": 32054698, "question_id": 32050222, "link": "https://stackoverflow.com/questions/32050222/haskell-monads-of-monad/32054698#32054698", "title": "Haskell: Monads of monad", "body": "<p>You can write</p>\n\n<pre><code>a' :: Int -&gt; KnightRoute\na' i = a &gt;&gt;= \\p -&gt; moveKnight' p !! i\n</code></pre>\n\n<p>Here <code>i</code> is used to eliminate the inner list of writers. And, thanks to laziness, you can turn <code>Int -&gt; a</code> into <code>[a]</code>:</p>\n\n<pre><code>asList :: (Int -&gt; a) -&gt; [a]\nasList f = map f [1..]\n</code></pre>\n\n<p>Then the list of all routes for <code>a'</code> is</p>\n\n<pre><code>a's :: [KnightRoute]\na's = asList a'\n</code></pre>\n\n<p>Putting everything together:</p>\n\n<pre><code>moveKnight :: KnightRoute -&gt; [KnightRoute]\nmoveKnight k = map (\\i -&gt; k &gt;&gt;= \\p -&gt; moveKnight' p !! i) [1..]\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 5235162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60c5f757a38541577560d146a6bf59fb?s=128&d=identicon&r=PG&f=1", "display_name": "Bryce Tichit", "link": "https://stackoverflow.com/users/5235162/bryce-tichit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 32051876, "answer_count": 2, "score": 6, "last_activity_date": 1439826934, "creation_date": 1439813900, "last_edit_date": 1439816224, "question_id": 32050222, "link": "https://stackoverflow.com/questions/32050222/haskell-monads-of-monad", "title": "Haskell: Monads of monad", "body": "<p>I'm learning some Haskell and I have some trouble with these Monads, I understood about them and know what they are about but in this particular case I have some issues. While learning it on LYAH I ran across an exercices which was about calculating the positions you could get to in 3 movements with a knight (from the chess game), we used the list monad like this:</p>\n\n<p>Assuming,</p>\n\n<pre><code>type KnightPos = (Int,Int)\n\nmoveKnight :: KnightPos -&gt; [KnightPos]\nmoveKnight (c,r) = do\n   (c',r') &lt;- [(c+2,r-1),(c+2,r+1),(c-2,r-1),(c-2,r+1)\n              ,(c+1,r-2),(c+1,r+2),(c-1,r-2),(c-1,r+2)\n              ]\n   guard (c' `elem` [1..8] &amp;&amp; r' `elem` [1..8])\n   return (c',r')\n</code></pre>\n\n<p>This works and if I give my position to this function it sucessfuly calculate the possible future positions but now I'm looking to implements the Writer monad in it so I can retrieve how did I get to this point.\nSo I made this function,</p>\n\n<p>Assuming,</p>\n\n<pre><code>type KnightRoute = Writer [KnightPos] KnightPos\n\nmoveKnight' :: KnightPos -&gt; [KnightRoute]\nmoveKnight' (c,r) = do\n   (c',r') &lt;- [(c+2,r-1),(c+2,r+1),(c-2,r-1),(c-2,r+1)\n              ,(c+1,r-2),(c+1,r+2),(c-1,r-2),(c-1,r+2)\n              ]\n   guard (c' `elem` [1..8] &amp;&amp; r' `elem` [1..8])\n   return $ toKr (c',r') (c,r)\n where toKr pos oldpos = Writer (pos,[oldpos])\n</code></pre>\n\n<p>It works if I give it a <code>KnightPos</code> but using monads I can't extract a <code>KnightPos</code> from a <code>KnightRoute</code> to execute the function another time...</p>\n\n<pre><code>*Main&gt; let a = moveKnight' (2,4) !! 0\n*Main&gt; runWriter a\n((4,3),[(2,4)])\n*Main&gt; a &gt;&gt;= moveKnight'\n\n&lt;interactive&gt;:4:7:\nCouldn't match type \u2018[]\u2019 with \u2018Writer [KnightPos]\u2019\nExpected type: KnightPos -&gt; Writer [KnightPos] KnightRoute\n  Actual type: KnightPos -&gt; [KnightRoute]\nIn the second argument of \u2018(&gt;&gt;=)\u2019, namely \u2018moveKnight'\u2019\nIn the expression: a &gt;&gt;= moveKnight'\n</code></pre>\n\n<p>I understand why it's not working, I extract the <code>(4,3)</code> from my Writer but then I give this to <code>KnightPos'</code>. But <code>KnightPos'</code> returns a list of <code>KnightRoute</code> where I need a <code>KnightRoute</code>, this is an error of logic but I don't know how to do. Is there a simple way to do this with Monads?</p>\n\n<p>Thanks by advance :)</p>\n"}, {"tags": ["haskell", "inline"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 5, "creation_date": 1439797925, "post_id": 32043855, "comment_id": 51990310, "body": "If I may take a stab, lists and <code>Text</code> are subject to fusion but <code>ByteString</code>-s are not."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1439812505, "post_id": 32043855, "comment_id": 51998887, "body": "@Andr&#225;sKov&#225;cs, so does this mean that Parsec&#39;s performance for <code>ByteString</code> is <i>very</i> poor and inlining those functions won&#39;t really change anything?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1439813318, "post_id": 32043855, "comment_id": 51999388, "body": "Fusion crucially relies on inlining, and missing it can sometimes make performance worse, hence the pragmas (I believe). Without pragmas GHC will still often inline the method. Also, the performance for ByteString isn&#39;t &quot;very poor&quot;, I think it&#39;s the fastest for Parsec."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1439813597, "post_id": 32043855, "comment_id": 51999550, "body": "@Andr&#225;sKov&#225;cs, OK, that means that things can be fast even without fusion. Feel free to post this as an answer."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1489753096, "creation_date": 1489753096, "answer_id": 42857361, "question_id": 32043855, "link": "https://stackoverflow.com/questions/32043855/why-is-parsecs-uncons-explicitly-inlined-for-text-but-not-bytestring/42857361#42857361", "title": "Why is Parsec&#39;s uncons explicitly inlined for Text but not ByteString?", "body": "<p>I guess there is no real reason. Probably no-one paid attention,\nbenchmarked and showed that there's benefit for or against <code>{-# INLINE #-}</code>.</p>\n\n<p>When <code>Stream Text</code> instances was added in <a href=\"https://github.com/aslatter/parsec/commit/b7fed21061000168a37df89b5a05cf09e7e13273\" rel=\"nofollow noreferrer\">a commit from 2011</a>\nit came with <code>{-# INLINE #-}</code> pragma.</p>\n\n<p>On the other hand, <code>Stream ByteString</code> <a href=\"https://github.com/aslatter/parsec/commit/34ea8270c96883436232913721ce3903fe4d7cfc\" rel=\"nofollow noreferrer\">was touched last time in Feb 2008</a>,\nwith the previous commit being <em>Initial import</em> from Jan 2008. It didn't have any <code>INLINE</code> pragmas</p>\n\n<p>So if you think that there's a reason to have or not to have <code>{-# INLINE #-}</code> pragmas\non those instances, make benchmarks proving your case. I'm not aware there are\nany. It might make sense to inline <code>&lt;*&gt;</code> and <code>&gt;&gt;=</code> too, of <code>ParsecT</code>.</p>\n\n<p>Related: I recently added few inline pragmas to lucid, because benchmarks clearly\nshow they make difference; but OTOH you shouldn't sprinkle them to everything.</p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "answer_count": 1, "score": 14, "last_activity_date": 1489753096, "creation_date": 1439792220, "last_edit_date": 1439803328, "question_id": 32043855, "link": "https://stackoverflow.com/questions/32043855/why-is-parsecs-uncons-explicitly-inlined-for-text-but-not-bytestring", "title": "Why is Parsec&#39;s uncons explicitly inlined for Text but not ByteString?", "body": "<p><a href=\"https://github.com/aslatter/parsec/blob/master/Text/Parsec/Prim.hs#L372-L393\">There's</a> abstraction layer used by Parsec, type class <code>Stream</code>, it looks like this:</p>\n\n<pre><code>class (Monad m, ShowToken t) =&gt; Stream s m t | s -&gt; t where\n  uncons :: s -&gt; m (Maybe (t, s))\n\ninstance (Monad m, ShowToken t) =&gt; Stream [t] m t where\n  uncons []     = return Nothing\n  uncons (t:ts) = return $ Just (t, ts)\n  {-# INLINE uncons #-}\n\ninstance Monad m =&gt; Stream CL.ByteString m Char where\n  uncons = return . CL.uncons\n\ninstance Monad m =&gt; Stream C.ByteString m Char where\n  uncons = return . C.uncons\n\ninstance Monad m =&gt; Stream T.Text m Char where\n  uncons = return . T.uncons\n  {-# INLINE uncons #-}\n\ninstance Monad m =&gt; Stream TL.Text m Char where\n  uncons = return . TL.uncons\n  {-# INLINE uncons #-}\n</code></pre>\n\n<p>I wonder if inlining is a good idea here, then why <code>uncons</code> in <code>ByteString</code>'s instance of <code>Stream</code> is not inlined?</p>\n\n<p>Should all these functions be inlined or none of them, or <code>Text</code> and <code>ByteString</code> are so different that we should inline one and shouldn't inline the other?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 3, "creation_date": 1439779889, "post_id": 32041732, "comment_id": 51984548, "body": "You should include all the other non-exported modules in your Cabal file in the <code>other-modules</code> field \u2013 does that fix your linking problem?  (I can&#39;t test myself as I&#39;m still on 7.8.3, so I can&#39;t build your code.)"}, {"owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1439782342, "post_id": 32041732, "comment_id": 51985010, "body": "It looks like that fixes the undefined reference problem works &lt;3 &lt;3 &lt;3."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1456440210, "post_id": 32041732, "comment_id": 58961324, "body": "@AntalSpector-Zabusky as this resolved the problem, you should post it as an answer :-)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1456441614, "post_id": 32041732, "comment_id": 58961971, "body": "@sclv: Good point :-)"}], "answers": [{"comments": [{"owner": {"reputation": 1233, "user_id": 7970829, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OGdYb.png?s=128&g=1", "display_name": "oRole", "link": "https://stackoverflow.com/users/7970829/orole"}, "edited": false, "score": 0, "creation_date": 1506788490, "post_id": 35640242, "comment_id": 79963622, "body": "First of all, sorry for posting this into a comment, but I ran into a similar situation as the questioner. I&#39;m using an external library called <b>gstreamer</b> for the haskell package <b>haskell-gi</b>. Now the linker runs into several <b>undefined reference</b>&#39; problems. Example: <b>&quot;undefined reference to `g_irepository_require&#39;&quot;</b> . This method is part of a .c or .h file, that is called gi-repository.c / gi-repository.h. I have looked through Cabals&#39; User Guide but still don&#39;t have a clue how to add that file to <b>&quot;other-modules&quot;</b>. Could you give me an example?"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 1233, "user_id": 7970829, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OGdYb.png?s=128&g=1", "display_name": "oRole", "link": "https://stackoverflow.com/users/7970829/orole"}, "edited": false, "score": 0, "creation_date": 1506825186, "post_id": 35640242, "comment_id": 79971705, "body": "@oRole: Since that&#39;s a C function, you handle it differently \u2013 this answer deals specifically with Haskell code.  I don&#39;t have a quick answer, so you should <a href=\"https://stackoverflow.com/questions/ask\">ask a new question!</a> :-)"}, {"owner": {"reputation": 1233, "user_id": 7970829, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OGdYb.png?s=128&g=1", "display_name": "oRole", "link": "https://stackoverflow.com/users/7970829/orole"}, "edited": false, "score": 0, "creation_date": 1506846429, "post_id": 35640242, "comment_id": 79975173, "body": "Thank you anyways!"}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 6, "last_activity_date": 1456441607, "creation_date": 1456441607, "answer_id": 35640242, "question_id": 32041732, "link": "https://stackoverflow.com/questions/32041732/haskell-cabal-build-undefined-reference-error-and-duplicate-recompilation/35640242#35640242", "title": "Haskell cabal build undefined reference error and duplicate recompilation", "body": "<p>You should include all the other non-exported modules in your Cabal file in the <code>other-modules</code> field, otherwise they won't be linked in properly when producing the final library or executable.</p>\n\n<p>You can see <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#modules-included-in-the-package\" rel=\"noreferrer\">the Cabal User's Guide</a> for more information (although that pretty much sums up the situation with <code>other-modules</code>!).</p>\n"}], "owner": {"reputation": 3023, "user_id": 1691145, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b6744a17b41f3b0e5c7554a43a04094?s=128&d=identicon&r=PG", "display_name": "Justin Raymond", "link": "https://stackoverflow.com/users/1691145/justin-raymond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 2, "accepted_answer_id": 35640242, "answer_count": 1, "score": 7, "last_activity_date": 1456441607, "creation_date": 1439776152, "last_edit_date": 1495540798, "question_id": 32041732, "link": "https://stackoverflow.com/questions/32041732/haskell-cabal-build-undefined-reference-error-and-duplicate-recompilation", "title": "Haskell cabal build undefined reference error and duplicate recompilation", "body": "<p>My question comes in two parts. The first is that when I compile my project I get a long list of errors of the form</p>\n\n<pre><code>  (.text+0x137f): undefined reference to `raytrzuAd6RComi0WmBiuT4685WWH_Types_zdfBinaryColor_closure'\n</code></pre>\n\n<p>The full list of errors can be found <a href=\"http://lpaste.net/138988\" rel=\"nofollow noreferrer\">here</a>\nThe code that produces this error can be found <a href=\"https://github.com/jrraymond/ray-tracer/tree/master\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I am using ghc 7.10.1 and cabal 1.22.4.0.</p>\n\n<p>The second part of my question is that despite following the same cabal structure as <a href=\"https://stackoverflow.com/questions/12305970/how-to-make-a-haskell-cabal-project-with-libraryexecutables-that-still-run-with\">this question</a>, cabal still recompiles the library 3 times each cabal build despite the executables and the library all having a unique <code>hs-source-dir</code> and depending on the library.</p>\n\n<p>EDIT: as far as the triple compilation is concerned, the first time it builds <code>.o</code> files <code>[ 2 of 15] Compiling Types            ( src/Types.hs, dist/build/Types.o )</code>. The second time it builds <code>.p_o</code> files <code>[ 2 of 15] Compiling Types            ( src/Types.hs, dist/build/Types.p_o )</code> which are caused by TemplateHaskell and profiling.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1439778296, "post_id": 32041662, "comment_id": 51984239, "body": "It&#39;s unclear what you&#39;re trying to achieve with this pattern here; Why not just have <code>data FooBar = FooBar { foo :: Int, bar :: String }</code> and <code>aToFooBar :: A -&gt; FooBar</code> and <code>bToFooBar :: B -&gt; FooBar</code> and <code>data C = C FooBar</code>? If it&#39;s all the same to you anyway?"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1439784565, "post_id": 32041662, "comment_id": 51985459, "body": "I&#39;d ultimately like to make <code>cFoo</code> and <code>cBar</code> lenses."}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": true, "score": 1, "last_activity_date": 1525935493, "creation_date": 1525935493, "answer_id": 50267289, "question_id": 32041662, "link": "https://stackoverflow.com/questions/32041662/template-haskell-function-for-record-accessor-inheritance/50267289#50267289", "title": "Template Haskell Function for Record Accessor Inheritance", "body": "<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\n\ndata A = \n  A \n    { _aFoo :: Int\n    , _aBar :: String \n    }\n\ndata B = \n  B \n    { _bFoo :: Int\n    , _bBar :: String\n    , _bBaz :: Float \n    }\n\nmakeLenses ''A\nmakeLenses ''B\n\ndata C \n  = CA A \n  | CB B\n\nmakePrisms ''C\n</code></pre>\n\n<p>That will give you seven functions: <code>aFoo</code>, <code>aBar</code>, <code>bFoo</code>, <code>bBar</code>, <code>bBaz</code>, <code>_CA</code> and <code>_CB</code>.</p>\n\n<p>I suggest you read this tutorial: <a href=\"https://artyom.me/lens-over-tea-6\" rel=\"nofollow noreferrer\">lens over tea #6: Template Haskell</a>.</p>\n"}], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 50267289, "answer_count": 1, "score": 0, "last_activity_date": 1525935493, "creation_date": 1439775481, "last_edit_date": 1439798339, "question_id": 32041662, "link": "https://stackoverflow.com/questions/32041662/template-haskell-function-for-record-accessor-inheritance", "title": "Template Haskell Function for Record Accessor Inheritance", "body": "<p>I have two datatypes, <code>A</code> and <code>B</code>, which I have defined as:</p>\n\n<pre><code>data A = A { aFoo :: Int, aBar :: String }\ndata B = B { bFoo :: Int, bBar :: String, bBaz :: Float }\n</code></pre>\n\n<p>I now need to create a heterogeneous list of <code>A</code>s and <code>B</code>s, so I define a sum type, <code>C</code>, as:</p>\n\n<pre><code>data C = CA A | CB B\n</code></pre>\n\n<p>I would now like to define the functions</p>\n\n<pre><code>cFoo :: C -&gt; Int\ncBar :: C -&gt; String\n</code></pre>\n\n<p>This can be achieved with pattern matching...</p>\n\n<pre><code>cFoo (CA a) = aFoo a\ncFoo (CB b) = bFoo b\n\ncBar (CA a) = aBar a\ncBar (CB b) = bBar b\n</code></pre>\n\n<p>...but this becomes tedious with data types of many fields. I was wondering if there is a simple solution using template Haskell, or if it wouldn't be worth the effort. I have intermediate knowledge of Haskell, but am relatively new to Template Haskell. Any help is appreciated.</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency", "io", "stdout"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1439766132, "post_id": 32040536, "comment_id": 51982077, "body": "Relevant: <a href=\"http://stackoverflow.com/questions/13549706/is-putstrln-thread-safe\">Is putStrLn thread-safe?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "edited": false, "score": 4, "creation_date": 1439766581, "post_id": 32040588, "comment_id": 51982163, "body": "use <code>atomicPutStrLn = bracket_ (takeMVar lock) (putMVar lock ())</code> because this will deadlock if exceptions are thrown"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 9, "creation_date": 1439767518, "post_id": 32040588, "comment_id": 51982365, "body": "Actually, just use <code>withMVar</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1439798294, "last_edit_date": 1439798294, "creation_date": 1439764466, "answer_id": 32040588, "question_id": 32040536, "link": "https://stackoverflow.com/questions/32040536/haskell-forkio-threads-writing-on-top-of-each-other-with-putstrln/32040588#32040588", "title": "Haskell forkIO threads writing on top of each other with putStrLn", "body": "<p>Simply put, <code>putStrLn</code> is not an atomic operation. Every character may be interleaved with any other from a different thread. </p>\n\n<p>(I am also not sure about whether in multi-byte encodings such as UTF8 it is guaranteed that a multi-byte character is atomically handled.)</p>\n\n<p>If you want atomicity, you can use a shared mutex e.g.</p>\n\n<pre><code>do lock &lt;- newMVar ()\n   let atomicPutStrLn str = takeMVar lock &gt;&gt; putStrLn str &gt;&gt; putMVar lock ()\n   forkIO $ forever (atomicPutStrLn \"hello\")\n   forkIO $ forever (atomicPutStrLn \"world\")\n</code></pre>\n\n<hr>\n\n<p>As suggested in the comments below, we can also simplify and make the above exception-safe as follows:</p>\n\n<pre><code>do lock &lt;- newMVar ()\n   let atomicPutStrLn str = withMVar lock (\\_ -&gt; putStrLn str)\n   forkIO $ forever (atomicPutStrLn \"hello\")\n   forkIO $ forever (atomicPutStrLn \"world\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2409, "user_id": 1232110, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/673c347007e8491a529e6514f81683d3?s=128&d=identicon&r=PG", "display_name": "Kevin Zhu", "link": "https://stackoverflow.com/users/1232110/kevin-zhu"}, "is_accepted": false, "score": 0, "last_activity_date": 1606911499, "creation_date": 1606911499, "answer_id": 65107939, "question_id": 32040536, "link": "https://stackoverflow.com/questions/32040536/haskell-forkio-threads-writing-on-top-of-each-other-with-putstrln/65107939#65107939", "title": "Haskell forkIO threads writing on top of each other with putStrLn", "body": "<p>A version using global lock.</p>\n<pre><code>import Control.Concurrent.MVar  (newMVar, takeMVar, putMVar, MVar)\nimport System.IO.Unsafe (unsafePerformIO)\n\n\n{-# NOINLINE lock #-}\nlock :: MVar ()\nlock = unsafePerformIO $ newMVar ()\n\nprinter :: String -&gt; IO ()\nprinter x= do\n   () &lt;- takeMVar lock\n   let atomicPutStrLn str =  putStrLn str &gt;&gt; putMVar lock ()\n   atomicPutStrLn x\n</code></pre>\n"}], "owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1168, "favorite_count": 1, "accepted_answer_id": 32040588, "answer_count": 2, "score": 7, "last_activity_date": 1606911499, "creation_date": 1439763970, "last_edit_date": 1439764655, "question_id": 32040536, "link": "https://stackoverflow.com/questions/32040536/haskell-forkio-threads-writing-on-top-of-each-other-with-putstrln", "title": "Haskell forkIO threads writing on top of each other with putStrLn", "body": "<p>I was playing around with Haskell lightweight threads (<code>forkIO</code>) with the following code:</p>\n\n<pre><code>import Control.Concurrent\n\nbeginTest :: IO ()\nbeginTest = go\n    where\n    go = do\n        putStrLn \"Very interesting string\"\n        go\n        return ()\n\nmain = do\n    threadID1 &lt;- forkIO $ beginTest\n    threadID2 &lt;- forkIO $ beginTest\n    threadID3 &lt;- forkIO $ beginTest\n    threadID4 &lt;- forkIO $ beginTest\n    threadID5 &lt;- forkIO $ beginTest\n\n    let tID1 = show threadID1\n    let tID2 = show threadID2\n    let tID3 = show threadID3\n    let tID4 = show threadID4\n    let tID5 = show threadID5\n\n    putStrLn \"Main Thread\"\n    putStrLn $ tID1 ++ \", \" ++ tID2 ++ \", \" ++ tID3 ++ \", \" ++ tID4 ++ \", \" ++ tID5\n    getLine\n    putStrLn \"Done\"\n</code></pre>\n\n<p>Now the expected output to this would be a whole bunch of these:</p>\n\n<pre><code>Very interesting string\nVery interesting string\nVery interesting string\nVery interesting string\n</code></pre>\n\n<p>with one of these somewhere in there:</p>\n\n<pre><code>Main Thread\n</code></pre>\n\n<p>However, the output (or first several lines anyway) turned out to be this:</p>\n\n<pre><code>Very interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery interesting string\nVery VVVViMeeeenarrrrtiyyyyen    r iiiieTnnnnshtttttreeeeierrrrnaeeeegdssss \nttttsiiiitTnnnnrhggggir    nessssgatttt\ndrrrrIiiiiVdnnnne ggggr5\n\n\n\ny1 ,VVVVi eeeenTrrrrthyyyyer    reiiiieannnnsdtttttIeeeeidrrrrn eeeeg5ssss 2tttts,iiiit nnnnrTggggih    nrssssgetttt\narrrrdiiiiVInnnnedggggr \n\n\n\ny5 3VVVVi,eeeen rrrrtTyyyyeh    rriiiieennnnsatttttdeeeeiIrrrrndeeeeg ssss 5tttts4iiiit,nnnnr ggggiT    nhssssgrtttt\nerrrraiiiiVdnnnneIggggrd\n\n\n\ny  5VVVVi5eeeen\nrrrrtyyyye    riiiiennnnsttttteeeeirrrrneeeegssss ttttsiiiitnnnnrggggi    nssssgtttt\nrrrriiiiVnnnneggggr\n\n\n\ny VVVVieeeenrrrrtyyyye    riiiiennnnsttttteeeeirrrrneeeegssss ttttsiiiitnnnnrggggi    nssssgtttt\nrrrriiiiVnnnneggggr\n</code></pre>\n\n<p>Every few lines the text would shift, though it's pretty clear that the <code>Very interesting string</code>s ended up on top of each other, because somehow the threads using <code>putStrLn</code> at the same time ended up writing to stdout on top of each other. Why is this, and how (without resorting to message passing, timing, or some other overcomplicated and convoluted solution) can it be overcome?</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1439764724, "post_id": 32040266, "comment_id": 51981789, "body": "Looks fine. Are you calling it with a infinite list perhaps?"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1439762094, "creation_date": 1439762094, "answer_id": 32040318, "question_id": 32040266, "link": "https://stackoverflow.com/questions/32040266/why-does-this-function-give-rise-to-an-infinite-loop/32040318#32040318", "title": "Why does this function give rise to an infinite loop?", "body": "<p>This is a correct implementation of <code>reverse</code> for the definition of <code>List</code> in your exercise book. If there is an infinite loop somewhere it is probably in your implementation of <code>(++)</code>.</p>\n"}], "owner": {"reputation": 5215, "user_id": 1370639, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7d25f04b35528cffd0b931044d985bbf?s=128&d=identicon&r=PG", "display_name": "Boyu Fang", "link": "https://stackoverflow.com/users/1370639/boyu-fang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 32040318, "answer_count": 1, "score": 0, "last_activity_date": 1439788446, "creation_date": 1439761732, "last_edit_date": 1439788446, "question_id": 32040266, "link": "https://stackoverflow.com/questions/32040266/why-does-this-function-give-rise-to-an-infinite-loop", "title": "Why does this function give rise to an infinite loop?", "body": "<p>I am trying to solve the exercises from the Haskell course I found online and for <a href=\"https://github.com/NICTA/course/blob/master/src/Course/List.hs#L287\" rel=\"nofollow\">this question</a>, I have the following implementation:</p>\n\n<pre><code>reverse ::\n  List a\n  -&gt; List a\nreverse Nil = Nil\nreverse (x :. xs) = let l = (reverse xs) in l ++ (x:.Nil)\n</code></pre>\n\n<p>With <code>List</code> being defined as:</p>\n\n<pre><code>data List t =\n  Nil\n  | t :. List t\n  deriving (Eq, Ord)\n</code></pre>\n\n<p>It seems that there is a infinite loop inside this function. But I could not find out why. Could you enlighten me? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 4, "last_activity_date": 1439759536, "last_edit_date": 1495539842, "creation_date": 1439759536, "answer_id": 32040012, "question_id": 32039970, "link": "https://stackoverflow.com/questions/32039970/what-is-wrong-with-this-haskell-quicksort/32040012#32040012", "title": "What is wrong with this Haskell quicksort", "body": "<p>Notice that this sort of algorithm is <em>not</em> going to yield quick sort.  The time complexity of <code>(++)</code> will destroy you, if nothing else.</p>\n\n<p>As for your problem, you are taking all elements that are <code>&lt;=</code> pivot.. which will (absolutely) include the pivot.  So if you have a list <code>[2,1]</code> then to sort that your right half will call <code>quicksort [2,1]</code>, thus creating a loop.</p>\n\n<p>A better solution is to pattern match, using something like:</p>\n\n<pre><code>quicksort (pivot:array) = quicksort rightHalf ++ [pivot] ++ quicksort leftHalf\n</code></pre>\n\n<p>Edit: see the related <a href=\"https://stackoverflow.com/questions/7717691/why-is-the-minimalist-example-haskell-quicksort-not-a-true-quicksort\">Why is the minimalist, example Haskell quicksort not a &quot;true&quot; quicksort?</a></p>\n"}], "owner": {"reputation": 1, "user_id": 4669945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/848294d746c64d48d6109149c0b9718e?s=128&d=identicon&r=PG&f=1", "display_name": "Tony ", "link": "https://stackoverflow.com/users/4669945/tony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1439759536, "creation_date": 1439759304, "question_id": 32039970, "link": "https://stackoverflow.com/questions/32039970/what-is-wrong-with-this-haskell-quicksort", "title": "What is wrong with this Haskell quicksort", "body": "<p>Taking the functional programming plunge and trying to teach myself Haskell from online materials. Probably pretty basic, but I cannot figure why my implementation of quicksort does not terminate for any input list with length longer than 1.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>quicksort :: (Ord ord) =&gt; [ord] -&gt; [ord\nquicksort [] = []\nquicksort [element] = [element]\nquicksort array = quicksort right_half ++ [pivot] ++ quicksort left_half\n  where pivot = head array\n        right_half = [element | element &lt;- array, element &lt;= pivot]\n        left_half = [element | element &lt;- array, element &gt; pivot]\n</code></pre>\n\n<p>I was reading an online textbook but decided to try the quicksort for myself before just reading the given solution. After failing, I went back and understood the given answer, but still cannot see why mine is wrong. Any help for this haskell newbie would be appreciated!</p>\n"}, {"tags": ["list", "haskell", "set", "list-comprehension"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 6, "creation_date": 1439749362, "post_id": 32038399, "comment_id": 51977728, "body": "I think the best way to find out is to try it (measure it) - it&#39;s just my gut but I <i>think</i> with lists &lt; 100 you might be quicker by just using lists (maybe sorting them first?)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1439749617, "post_id": 32038399, "comment_id": 51977800, "body": "&quot;For the record I&#39;m going to have to check lots of fairly small lists (~10^5 of size &lt;100)&quot; - Are you going to check all of the lists against a single one, or do you need to test all of the possible pairings?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1439751418, "post_id": 32038399, "comment_id": 51978304, "body": "Note: you <b>cannot</b> use <code>Set</code>s and obtain a strictly equivalent function. Using <code>Set</code>s implies having an <code>Ord a</code> constraint, while your function only has <code>Eq a</code>.  If you allow <code>Ord a</code> an equivalent approach could be to sort both lists and then use something like <code>group</code> and compare then &quot;linearly&quot; (without using <code>elem</code> just checking the heads).  In fact I believe this problem <i>requires</i> O(n^2) if allowing only <code>Eq a</code>..."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439753272, "post_id": 32038399, "comment_id": 51978829, "body": "@duplode Thank you, that was a careless mistake."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 4, "creation_date": 1439753327, "post_id": 32038399, "comment_id": 51978837, "body": "I would suggest defining it as <code>commonEle xs ys = any (`elem` ys) xs</code>. This should be marginally faster, as well as clearer IMO."}, {"owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439754196, "post_id": 32038399, "comment_id": 51979112, "body": "@duplode It&#39;s a simple model for a puzzle game - there&#39;s a list of (Int,Int) points that are covered on the board (of size at most 10x10, so the list will often have &lt;&lt;100 elements), and a list of points that would be covered by a particular move (i.e. placing a piece in a position) - these lists would be much smaller in general. So the reason for checking the intersection is a check for whether the move is possible. So I&#39;d be checking lots of very small lists against one.  Since they&#39;re (Int,Int) they could be ordered (I didn&#39;t know Set required that) by just ordering them lexicographically."}, {"owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1439754300, "post_id": 32038399, "comment_id": 51979136, "body": "@Kwarrtz Thanks! I didn&#39;t know about that function"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439761562, "post_id": 32038399, "comment_id": 51981026, "body": "@DanielLittlewood &quot; Since they&#39;re (Int,Int) they could be ordered (I didn&#39;t know Set required that) by just ordering them lexicographically.&quot; <code>Set</code> only requires they are <i>orderable</i> (that is what the <code>Ord</code> constraint enforces). As there is already an <code>Ord</code> instance for <code>(Int, Int)</code> (and for any other reasonbaly-sized tuples of <code>Ord</code> types as well), it will work out of the box with no further intervention."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1439762638, "last_edit_date": 1439762638, "creation_date": 1439761344, "answer_id": 32040220, "question_id": 32038399, "link": "https://stackoverflow.com/questions/32038399/is-it-worth-converting-to-sets/32040220#32040220", "title": "Is it worth converting to Sets?", "body": "<blockquote>\n  <p>Are you going to check all of the lists against a single one, or do you need to test all of the possible pairings?</p>\n</blockquote>\n\n\n\n<blockquote>\n  <p>I'd be checking lots of very small lists against one.</p>\n</blockquote>\n\n<p>I asked that because one concern would be having to convert too many small lists with <code>fromList</code>. As one of the lists is fixed, you can avoid most of that cost by converting just the fixed list.</p>\n\n<pre><code>import qualified Data.Set as S\nimport Data.Set (Set)\n\n-- There is probably a better name for this modified version. \ncommonEle :: (Ord a) =&gt; Set a -&gt; [a] -&gt; Bool\ncommonEle xs ys = any (`S.member` xs) ys\n</code></pre>\n\n<p>If you are writing a puzzle game, you might consider keeping this part of the state of the puzzle permanently as a <code>Set</code>, so that you do not have to recreate the set on every move. (If it turns out you need to keep extra information associated to the positions, there are also the <code>Map</code> types from <code>Data.Map</code>/<code>Data.Map.Strict</code>/<code>Data.HashMap</code>).</p>\n\n<p>In any case, though, do follow Carsten's advice: \"the best way to find out is to try it (measure it)\". Also be sure to check the promised performance characteristics for the functions you plan to use in the documentation of the relevant modules.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1439762189, "creation_date": 1439762189, "answer_id": 32040329, "question_id": 32038399, "link": "https://stackoverflow.com/questions/32038399/is-it-worth-converting-to-sets/32040329#32040329", "title": "Is it worth converting to Sets?", "body": "<p>You mention in the comments that your sets will all be will be pairs of coordinates <code>(Int,Int)</code> where each coordinate is in the range <code>[1..10]</code>.</p>\n\n<p>In that case you should use a \"bit set\" so that you can use the processor's bitwise AND and OR operations for set intersection and union.</p>\n\n<p>The module <a href=\"https://hackage.haskell.org/package/bitset-1.4.8/docs/Data-BitSet-Dynamic.html\" rel=\"nofollow\">Data.BitSet.Dynamic</a> can be used for this purpose:</p>\n\n<pre><code>import qualified Data.BitSet.Dynamic as B\n\ntype Bset = B.BitSet B.FasterInteger\n\n-- convert a list of points into a bit set\ntoSet :: [(Int,Int)] -&gt; Bset\ntoSet points = B.fromList [ fromIntegral (r*10+c) | (r,c) &lt;- points ]\n\n-- do two bit sets have common elements?\ncommonElements :: Bset -&gt; Bset -&gt; Bool\ncommonElements a b = not $ B.null $ B.intersection a b\n\n-- add a point to a bit set\naddPoint :: Bset -&gt; (Int,Int) -&gt; Bset\naddPoint a (r,c) = B.insert (fromIntegral $ r*10+c) a\n\n-- convert a bit set to a list of points\ntoPoints :: Bset -&gt; [(Int,Int)]\ntoPoints a = [ (q,r) | x &lt;- B.toList a, let (q,r) = divMod (fromIntegral x) 10 ]\n\n-- does a set have a point?\nhasPoint :: Bset -&gt; (Int,Int) -&gt; Bool\nhasPoint a (r,c) = B.member (fromIntegral $ r*10+c) a\n</code></pre>\n\n<p>Detecting if two sets have any common elements or if a point is in a set is very fast.</p>\n"}], "owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1439762638, "creation_date": 1439749024, "last_edit_date": 1495540284, "question_id": 32038399, "link": "https://stackoverflow.com/questions/32038399/is-it-worth-converting-to-sets", "title": "Is it worth converting to Sets?", "body": "<p>I'm dealing with lists in my program, and I want to be able to quickly check whether two lists intersect or not. My attempt at an implementation is  </p>\n\n<pre><code>commonEle :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool\ncommonEle _ [] = False\ncommonEle [] _ = False\ncommonEle (x:xs) ys\n    |x `elem` ys = True\n    |otherwise = commonEle xs ys  \n</code></pre>\n\n<p>This <em>works</em>, but I'm trying to be careful with efficiency so that things don't blow up. <a href=\"https://stackoverflow.com/questions/5986898/is-there-union-and-intersect-haskell-prelude-implementation\">This SO question</a> explains in one of the answer that it is much more efficient to use sets to quickly check intersections. My list will automatically have distinct elements, so using sets might be a good idea, but the natural way to build my data is in a list comprehension, so I'd have to use the <code>fromList</code> function to turn it into a set. How do you tell which implementation is more efficient?  </p>\n\n<p>For the record I'm going to have to check lots of fairly small lists (~10^5 of size &lt;100).</p>\n"}, {"tags": ["haskell", "monads", "continuations"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439742041, "post_id": 32037206, "comment_id": 51975449, "body": "first: the gist is fine in itself but why don&#39;t you copy&amp;paste the code in here - it&#39;s just convenient for us trying to help out here - next I don&#39;t think your types match up (or I guess wrong what you are trying to do) - have you tried to solve this problem just with continuation-passing-style (you don&#39;t exactly need the monad/<code>Cont</code>-wrapper to understand the technique)?"}, {"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439758835, "post_id": 32037206, "comment_id": 51980363, "body": "@carsten - This attempt of mine arises indeed from a perfectly working CPS implementation, definitely too trivial to mention. I believe it&#39;s clear that the whole point of this question is about using the monad, and especially its bind function."}], "answers": [{"comments": [{"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 0, "creation_date": 1439759943, "post_id": 32038111, "comment_id": 51980651, "body": "Thank you! I suspected I was doing something not-haskellian in my code :-) I am keen in getting a feel for &#39;bind&#39;, hoping to bring abstraction to a higher level. I appreciated the thoroughness and completeness of your answer. The functor version is mind-blowing. Gotta spend some time thinking about this fmap."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 1, "creation_date": 1439760235, "post_id": 32038111, "comment_id": 51980727, "body": "@Muzietto Monads are required to be &quot;compatible&quot; with their functor instance in the sense that they must satisfy the law <code>fmap f x = x &gt;&gt;= (return . f)</code>. Basically and informally, if you get something out of the monad (<code>&gt;&gt;=</code>), apply some <code>f</code> and then put it back in the monad with <code>return</code>, the result should be the same of <code>fmap f</code>."}, {"owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "edited": false, "score": 0, "creation_date": 1439826417, "post_id": 32038111, "comment_id": 52007950, "body": "yes I am aware of the relationship between functors and monads, but I&#39;ve always considered <code>bind</code> to be on a higher level of abstraction (and capabilities) than <code>fmap</code>. Seeing <code>fmap</code> here do more or less the same job in an even terser syntax is quite surprising."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1439747559, "last_edit_date": 1439747559, "creation_date": 1439747075, "answer_id": 32038111, "question_id": 32037206, "link": "https://stackoverflow.com/questions/32037206/trying-to-exercise-with-the-cont-monad-syntax-issue/32038111#32038111", "title": "Trying to exercise with the Cont monad. Syntax issue", "body": "<p>First, you can not define a function in the way you posted for the same reason you can not implement a predecessor function as follows:</p>\n\n<pre><code>1 + (predecessor x) = x\n</code></pre>\n\n<p>Functions can only be defined through equations of the form</p>\n\n<pre><code>f pattern1 .. patternK = expression\n</code></pre>\n\n<p>Note that <code>f</code> must be found at the top-level.</p>\n\n<p>For your factorial function using the continuation monad, you can simplify your attempt as follows:</p>\n\n<pre><code>fact :: Int -&gt; Cont r Int\n-- Your own code:\n-- Cont ($ (fact 0)) = return 1\nfact 0 = return 1\n-- Cont ($ (fact n)) = Cont ($ (fact (n-1))) &gt;&gt;= (\\x -&gt; Cont ($ (n*x)))\nfact n = fact (n-1) &gt;&gt;= \\x -&gt; return (n*x)\n\n-- the \"real\" factorial function, without monads\nfactorial :: Int -&gt; Int\nfactorial n = runCont (fact n) id\n</code></pre>\n\n<p>Note that <code>return (n*x)</code> above is indeed <code>Cont ($ (n*x))</code>, but I think it's more readable in the former way, also because it does not break the abstraction. Indeed, it would work in <em>any</em> monad once written as above.</p>\n\n<p>Alternatively, use <code>do</code> notation.</p>\n\n<pre><code>fact :: Int -&gt; Cont r Int\nfact 0 = return 1\nfact n = do\n   x &lt;- fact (n-1)\n   return (n*x)\n</code></pre>\n\n<p>Or use a functor operator:</p>\n\n<pre><code>fact :: Int -&gt; Cont r Int\nfact 0 = return 1\nfact n = (n*) &lt;$&gt; fact (n-1)\n</code></pre>\n"}], "owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 32038111, "answer_count": 1, "score": 0, "last_activity_date": 1439747559, "creation_date": 1439741297, "last_edit_date": 1495541037, "question_id": 32037206, "link": "https://stackoverflow.com/questions/32037206/trying-to-exercise-with-the-cont-monad-syntax-issue", "title": "Trying to exercise with the Cont monad. Syntax issue", "body": "<p>After some study ([1], [2], [3] among others) I am trying to make work of the continuation monad by attempting some examples on my own.</p>\n\n<p>The second answer to [1] suggests to express the factorial using continuations. My solution is the following:</p>\n\n<pre><code>Cont ($ (fact 0)) = return 1\nCont ($ (fact n)) = Cont ($ (fact (n-1))) &gt;&gt;= (\\x -&gt; Cont ($ (n*x)))\n</code></pre>\n\n<p>I've done some simulations on paper and the solution should be correct.</p>\n\n<p>However <strong>I am unable to have it digested by GHC</strong>. Of course I renamed the <code>fact</code> function, but still no joy.</p>\n\n<p>My latest attempt is <a href=\"https://gist.github.com/Muzietto/595bef1815ddf375129d\" rel=\"nofollow noreferrer\">https://gist.github.com/Muzietto/595bef1815ddf375129d</a>\nand gives as always a <code>parse error in pattern \\c -&gt; .....</code></p>\n\n<p>Can anyone suggest a running implementation for these definitions?</p>\n\n<p>[1] <a href=\"https://stackoverflow.com/questions/3322540/how-and-why-does-the-haskell-cont-monad-work\">How and why does the Haskell Cont monad work?</a></p>\n\n<p>[2] <a href=\"http://hackage.haskell.org/package/mtl-1.1.0.2/docs/Control-Monad-Cont.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/mtl-1.1.0.2/docs/Control-Monad-Cont.html</a></p>\n\n<p>[3] <a href=\"https://wiki.haskell.org/MonadCont_under_the_hood\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/MonadCont_under_the_hood</a></p>\n"}, {"tags": ["haskell", "configuration", "haskell-platform"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439807719, "post_id": 32040555, "comment_id": 51996008, "body": "This looks promising. Can you elaborate a bit: I&#39;ve got a current Python (2.7) and IPython installation, maintained with Homebrew, and I have the latest GHC and Cabal. If I understand correctly, all I need to do is (1) <a href=\"https://github.com/gibiansky/IHaskell/blob/master/README.md#install-zeromq\" rel=\"nofollow noreferrer\"><code>brew install zeromq</code></a>, (2) <a href=\"https://github.com/gibiansky/IHaskell/blob/master/README.md#install-haskell-tools\" rel=\"nofollow noreferrer\"><code>cabal install happy cpphs</code></a> and (3) <a href=\"https://github.com/gibiansky/IHaskell/blob/master/README.md#build-ihaskell\" rel=\"nofollow noreferrer\"><code>cabal install ihaskell --reorder-goals</code></a>. Is that correct?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439822002, "post_id": 32040555, "comment_id": 52005102, "body": "And if I go down that path, Kronos-Haskell is unaffected (it&#39;s self-contained and and could in fact be deleted altogether) right?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439849053, "post_id": 32040555, "comment_id": 52019661, "body": "And perhaps more importantly: <a href=\"http://stackoverflow.com/q/32055302/656912\">will I be able to continue to use IPython and IPython Notebooks</a> (and how do I switch between the two languages)?"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1439764148, "creation_date": 1439764148, "answer_id": 32040555, "question_id": 32036535, "link": "https://stackoverflow.com/questions/32036535/can-i-get-kronos-haskell-to-use-my-haskell-platform/32040555#32040555", "title": "Can I get Kronos-Haskell to use my Haskell platform?", "body": "<p>You can build IHaskell yourself using this recipe from the <a href=\"https://github.com/gibiansky/IHaskell/blob/master/README.md\" rel=\"nofollow\">README</a>:</p>\n\n<pre><code>git clone http://www.github.com/gibiansky/IHaskell\ncd IHaskell\n./macos-install.sh\n</code></pre>\n\n<p>Note - it might take a while as there are a ton of dependencies.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1439764148, "creation_date": 1439737471, "question_id": 32036535, "link": "https://stackoverflow.com/questions/32036535/can-i-get-kronos-haskell-to-use-my-haskell-platform", "title": "Can I get Kronos-Haskell to use my Haskell platform?", "body": "<p><a href=\"http://www.kronosnotebook.com/haskell\" rel=\"nofollow\">Kronos-Haskell</a> installs as a self-contained application and can exist (as near as I can tell) alongside an installation of the <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow\">Haskell Platform</a> without any issues or interactions. This is a nice feature, however I would like to use a current version of Haskell, along with some additional packages I've installed to the Haskell Platform.</p>\n\n<p>Is there a way to get Kronos-Haskell to use my installation of the Haskell Platform?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439734022, "post_id": 32035857, "comment_id": 51972733, "body": "Make them both instances of some typeclass, then enable the <code>ExistencialTypes</code> laguange extension."}, {"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439734641, "post_id": 32035857, "comment_id": 51972957, "body": "Is that best Haskell practice, since, it&#39;s only available via a GHC extension? Is there any &quot;pure&quot; Haskell way of doing this?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439735224, "post_id": 32035857, "comment_id": 51973148, "body": "It&#39;s a GHC extension, see my answer for the <i>right way</i>"}], "answers": [{"comments": [{"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "edited": false, "score": 0, "creation_date": 1439737328, "post_id": 32036154, "comment_id": 51973868, "body": "Thanks for the code. It&#39;s very clean, but it is however, equivalent to just creating copies of all messages. Is that unavoidable then? I was hoping there was some functional design-pattern that I was missing."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "edited": false, "score": 0, "creation_date": 1439737590, "post_id": 32036154, "comment_id": 51973967, "body": "@Feenaboccles It&#39;s not exactly equivenlent. Since Haskell <i>purely-functional</i> language, it will reuse the <code>String</code>s, <code>UTCTime</code>s, and <code>List</code>s in memory when creating the &quot;new&quot; <code>SocialMediaAccount</code> types. Essentially you will be creating new references, but not copying the entire &quot;objects.&quot; This is one of the benefits of <i>type purity.</i>"}, {"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "edited": false, "score": 0, "creation_date": 1439739671, "post_id": 32036154, "comment_id": 51974683, "body": "Your point is true of imperative languages too: passing values by reference is what happens (unsafely) in idiomatic Java. However in Java, given a <code>SimpleMessage</code> interface, you wouldn&#39;t have to create a new wrapper type around the same fields, for every value in the input lists. I&#39;d seen that solution, and the very closely related <code>ExistentialQuantification</code> extension before: I was hoping I could avoid them."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "edited": false, "score": 0, "creation_date": 1439739857, "post_id": 32036154, "comment_id": 51974743, "body": "@Feenaboccles as far as I know, they are your only options. That is just how the type-system works... It may be optemized away by the compiler. Given the purity guarantees, the compiler can safely make agressive optemizations."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1439744555, "post_id": 32036154, "comment_id": 51976258, "body": "I prefer this solution to the one based on existential types and typeclasses. Maybe I&#39;d also skip over the <code>SocialMediaAccount</code> type and use <code>[SocialMediaPost]</code> directly, but that&#39;s a minor point."}], "tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": true, "score": 4, "last_activity_date": 1439736002, "last_edit_date": 1439736002, "creation_date": 1439735196, "answer_id": 32036154, "question_id": 32035857, "link": "https://stackoverflow.com/questions/32035857/how-to-create-a-list-of-heterogeneous-datatypes-without-using-sum-types-or-copie/32036154#32036154", "title": "How to create a list of heterogeneous datatypes without using sum-types or copies", "body": "<p>You should abstract the <code>FaceBookAccount</code> and the <code>TwitterAccount</code> to instances of <code>SocialMediaAccount</code></p>\n\n<p><strong>Haskell Code:</strong></p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;))\nimport Data.List\nimport Data.Ord\nimport Data.Time\n\ndata FaceBookAccount = FaceBookAccount [FaceBookPost]\ndata TwitterAccount  = TwitterAccount  [TwitterPost]\ndata FaceBookPost    = FaceBookPost String UTCTime\ndata TwitterPost     = TwitterPost  String UTCTime\n\ndata SocialMediaAccount \n   = SocialMediaAccount \n   { accountPosts :: [SocialMediaPost]\n   }\ndata SocialMediaPost \n   = SocialMediaPost\n   { postBody :: String\n   , postTime :: UTCTime\n   }\n\nclass SocialMedia a where\n  simpleAccount  :: a -&gt; SocialMediaAccount  \n\ninstance SocialMedia FaceBookAccount where\n  simpleAccount (FaceBookAccount xs) = SocialMediaAccount $ f &lt;$&gt; xs\n    where \n      f (FaceBookPost text time) = SocialMediaPost text time\n\ninstance SocialMedia TwitterAccount where\n  simpleAccount (TwitterAccount xs) = SocialMediaAccount $ f &lt;$&gt; xs\n    where \n      f (TwitterPost text time) = SocialMediaPost text time\n\ngetAllMessages :: (SocialMedia a, SocialMedia b) =&gt; a -&gt; b -&gt; [SocialMediaPost]\ngetAllMessages xs ys = sortBy (comparing postTime) \n                     $ extract xs\n                    ++ extract ys\n  where\n    extract :: SocialMedia a =&gt; a -&gt; [SocialMediaPost]\n    extract = accountPosts . simpleAccount\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "edited": false, "score": 0, "creation_date": 1439764111, "post_id": 32037714, "comment_id": 51981625, "body": "Thanks so much for this, it&#39;s very interesting. All methods do seem to involve wrapping the disparate types inside of some unified marker type however, and seem like more complex versions of recursion.ninja&#39;s approach, which is why I&#39;d prefer it if I had to choose."}], "tags": [], "owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "is_accepted": false, "score": 3, "last_activity_date": 1439744523, "creation_date": 1439744523, "answer_id": 32037714, "question_id": 32035857, "link": "https://stackoverflow.com/questions/32035857/how-to-create-a-list-of-heterogeneous-datatypes-without-using-sum-types-or-copie/32037714#32037714", "title": "How to create a list of heterogeneous datatypes without using sum-types or copies", "body": "<p>I implemented three possible solutions that may help you decide what better fits your requirements.</p>\n\n<p><strong>Solution 1: <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow\">Existential Types</a></strong></p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\nimport Data.Time\n\ndata FacebookAccount = FacebookAccount [FacebookPost]\ndata TwitterAccount  = TwitterAccount  [TwitterPost]\n\ndata FacebookPost = FacebookPost String UTCTime\n  deriving Show\ndata TwitterPost  = TwitterPost  String UTCTime\n  deriving Show\n\n-- Account\n\nclass Account a where\n  posts :: a -&gt; [AnyPost]\n\ndata AnyAccount = forall a . Account a =&gt; AnyAccount a\n\ninstance Account AnyAccount where\n  posts (AnyAccount a) = posts a\n\ninstance Account FacebookAccount where\n  posts (FacebookAccount ps) = map AnyPost ps\n\ninstance Account TwitterAccount where\n  posts (TwitterAccount ps) = map AnyPost ps\n\n-- Post\n\nclass Show p =&gt; Post p where\n  text :: p -&gt; String\n  date :: p -&gt; UTCTime\n\ndata AnyPost = forall a . Post a =&gt; AnyPost a\n\ninstance Show AnyPost where\n  show (AnyPost p) = show p\n\ninstance Post AnyPost where\n  text (AnyPost p) = text p\n  date (AnyPost p) = date p\n\ninstance Post FacebookPost where\n  text (FacebookPost t _) = t\n  date (FacebookPost _ d) = d\n\ninstance Post TwitterPost where\n  text (TwitterPost t _) = t\n  date (TwitterPost _ d) = d\n\n\nallPostsSince :: UTCTime -&gt; [AnyAccount] -&gt; [AnyPost]\nallPostsSince d as = filter (\\p -&gt; date p &gt;= d) $ concatMap posts as\n\nfacebook = FacebookAccount\n  [ FacebookPost \"Hello\" $ UTCTime (fromGregorian 2015 8 14) (secondsToDiffTime 0)\n  , FacebookPost \"Ol\u00e1\"   $ UTCTime (fromGregorian 2015 8 12) (secondsToDiffTime 0)\n  ]\n\ntwitter = TwitterAccount\n  [ TwitterPost \"Bonjour\" $ UTCTime (fromGregorian 2015 8 13) (secondsToDiffTime 0)\n  , TwitterPost \"Hola\"    $ UTCTime (fromGregorian 2015 8 10) (secondsToDiffTime 0)\n  ]\n\nmain :: IO ()\nmain = do today &lt;- getCurrentTime\n          let fiveDays = 5 * 24 * 60 * 60\n              fiveDaysAgo = (-fiveDays) `addUTCTime` today\n              posts = allPostsSince fiveDaysAgo [AnyAccount facebook, AnyAccount twitter]\n          mapM_ print posts\n</code></pre>\n\n<hr>\n\n<p><strong>Solution 2: <a href=\"https://wiki.haskell.org/Heterogenous_collections#A_Universal_type\" rel=\"nofollow\">Universal Type</a></strong></p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Control.Applicative\nimport Data.Dynamic\nimport Data.Maybe\nimport Data.Time\n\ndata FacebookAccount = FacebookAccount [FacebookPost]\n  deriving Typeable\ndata TwitterAccount  = TwitterAccount  [TwitterPost]\n  deriving Typeable\n\ndata FacebookPost = FacebookPost String UTCTime\n  deriving (Show, Typeable)\ndata TwitterPost  = TwitterPost  String UTCTime\n  deriving (Show, Typeable)\n\ngetPosts :: Dynamic -&gt; [Dynamic]\ngetPosts dyn = fromJust $  (\\ (FacebookAccount ps) -&gt; map toDyn ps) &lt;$&gt; fromDynamic dyn\n                       &lt;|&gt; (\\ (TwitterAccount  ps) -&gt; map toDyn ps) &lt;$&gt; fromDynamic dyn\n                       &lt;|&gt; error \"Type mismatch\"\n\ngetDate :: Dynamic -&gt; UTCTime\ngetDate dyn = fromJust $  (\\ (FacebookPost _ d) -&gt; d) &lt;$&gt; fromDynamic dyn\n                      &lt;|&gt; (\\ (TwitterPost  _ d) -&gt; d) &lt;$&gt; fromDynamic dyn\n                      &lt;|&gt; error \"Type mismatch\"\n\ntoString :: Dynamic -&gt; String\ntoString dyn = fromJust $  (\\ p@(FacebookPost _ _) -&gt; show p) &lt;$&gt; fromDynamic dyn\n                       &lt;|&gt; (\\ p@(TwitterPost  _ _) -&gt; show p) &lt;$&gt; fromDynamic dyn\n                       &lt;|&gt; error \"Type mismatch\"\n\nallPostsSince :: UTCTime -&gt; [Dynamic] -&gt; [Dynamic]\nallPostsSince d as = filter (\\p -&gt; getDate p &gt;= d) $ concatMap getPosts as\n\nfacebook = FacebookAccount\n  [ FacebookPost \"Hello\" $ UTCTime (fromGregorian 2015 8 14) (secondsToDiffTime 0)\n  , FacebookPost \"Ol\u00e1\"   $ UTCTime (fromGregorian 2015 8 12) (secondsToDiffTime 0)\n  ]\n\ntwitter = TwitterAccount\n  [ TwitterPost \"Bonjour\" $ UTCTime (fromGregorian 2015 8 13) (secondsToDiffTime 0)\n  , TwitterPost \"Hola\"    $ UTCTime (fromGregorian 2015 8 10) (secondsToDiffTime 0)\n  ]\n\nmain :: IO ()\nmain = do today &lt;- getCurrentTime\n          let fiveDays = 5 * 24 * 60 * 60\n              fiveDaysAgo = (-fiveDays) `addUTCTime` today\n              posts = allPostsSince fiveDaysAgo [toDyn facebook, toDyn twitter]\n          mapM_ (putStrLn . toString) posts\n</code></pre>\n\n<hr>\n\n<p><strong>Solution 3: Back to Basics</strong></p>\n\n<p>This is a minimalist solution, which does not even enforce that all the posts in one account have that account's type.</p>\n\n<pre><code>import Data.Time\n\ndata AccountType = Facebook\n                 | Twitter\n  deriving Show\n\ndata Account = Account AccountType [Post]\n\ndata Post = Post AccountType String UTCTime\n  deriving Show\n\nallPostsSince :: UTCTime -&gt; [Account] -&gt; [Post]\nallPostsSince d as = filter (\\ (Post _ _ pd) -&gt; pd &gt;= d) $ concatMap (\\ (Account _ ps) -&gt; ps) as\n\nfacebook = Account Facebook\n  [ Post Facebook \"Hello\" $ UTCTime (fromGregorian 2015 8 14) (secondsToDiffTime 0)\n  , Post Facebook \"Ol\u00e1\"   $ UTCTime (fromGregorian 2015 8 12) (secondsToDiffTime 0)\n  ]\n\ntwitter = Account Twitter\n  [ Post Twitter \"Bonjour\" $ UTCTime (fromGregorian 2015 8 13) (secondsToDiffTime 0)\n  , Post Twitter \"Hola\"    $ UTCTime (fromGregorian 2015 8 10) (secondsToDiffTime 0)\n  ]\n\nmain :: IO ()\nmain = do today &lt;- getCurrentTime\n          let fiveDays = 5 * 24 * 60 * 60\n              fiveDaysAgo = (-fiveDays) `addUTCTime` today\n              posts = allPostsSince fiveDaysAgo [facebook, twitter]\n          mapM_ print posts\n</code></pre>\n"}], "owner": {"reputation": 372, "user_id": 2722784, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/17935d19c83cba797a7c8e1470dc20bb?s=128&d=identicon&r=PG", "display_name": "Feenaboccles", "link": "https://stackoverflow.com/users/2722784/feenaboccles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 1, "accepted_answer_id": 32036154, "answer_count": 2, "score": 2, "last_activity_date": 1439764423, "creation_date": 1439733349, "last_edit_date": 1439764423, "question_id": 32035857, "link": "https://stackoverflow.com/questions/32035857/how-to-create-a-list-of-heterogeneous-datatypes-without-using-sum-types-or-copie", "title": "How to create a list of heterogeneous datatypes without using sum-types or copies", "body": "<p><strong>The use-case:</strong> An app to follow users across several messaging services. There's a <code>TwitterAccount</code> datatype, a <code>FacebookAccount</code> datatype, etc. These could easily be joined together with an <code>Account</code> sum-type, but the next level of the hierarchy leads to my problem.</p>\n\n<p>A <code>TwitterAccount</code> has a list of <code>TwitterPost</code>s, a <code>FacebookAccount</code> has a list of <code>FacebookPost</code>s, etc. </p>\n\n<p><strong>My task:</strong> I want to be able to put all posts for the last 10 days from all accounts into a single list, and extract the common time and message body fields from them for display.</p>\n\n<p><strong>My failed approach:</strong> I thought that if every class of <code>Post</code> implemented a typeclass like <code>SimplePost</code> exposing functions <code>messageBody</code> and <code>messageTime</code> that that might solve my problem, but I can't create a list of <code>[SimpleMessage]</code>.</p>\n\n<p>I want to maintain the invariant that a <code>TwitterAccount</code> <em>can only contain</em><code>TwitterPost</code>s, and so on, so I can't use sum-types. I'd prefer not to create copies of objects to do this.</p>\n\n<p><em>What is the best, cleanest, most Haskell-ish design for this problem?</em></p>\n\n<p><strong>UPDATE</strong>\nThis isn't an answer, but as an alternative to the four solutions provided by recursion.ninja and Helder Pereira I've been thinking if I can meet my invariants using phantom types, and <code>Account</code> and <code>Post</code> types that hold all possible information required by all providers. However the use of tuples, and the awkward logic, means it doesn't scale very well; perhaps this should be in a different question.</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{-# LANGUAGE EmptyDataDecls #-}   \n\n-- Some FSharpisms\n(|&gt;) = flip ($)\n(&lt;|) = ($)\ninfixr 0 &lt;|\n\n\ndata Twitter\ndata Facebook\ndata LinkedIn\n\ndata Post a = Post{\n    postBody :: String,\n    postDate :: UTCTime,\n    postForwarded :: Bool,\n    postFriendMentions :: [UserName]\n    } deriving (Show, Eq)\n\ndata Account a = Account {\n    accountName  :: String,\n    accountPosts :: [Post a]\n    } deriving (Show, Eq)\n\ndata User = User {\n    userName   :: String,\n    userTweets :: Account Twitter,\n    userFaces  :: Account Facebook,\n    userLinks  :: Account LinkedIn\n    }\n\nprettyShowUtc :: UTCTime -&gt; String\nprettyShowUtc utc = ...\n\nprettyShow :: Post a -&gt; String\nprettyShow p = prettyShowUtc (postDate p) ++ \" : \" ++ show (postBody p)\n\nshowOrderedOf2 :: ([Post a], [Post b]) -&gt; [String]\nshowOrderedOf2 ([], []) = []\nshowOrderedOf2 (ls, []) = map prettyShow ls\nshowOrderedOf2 ([], rs) = map prettyShow rs\nshowOrderedOf2 ((l:ls), (r:rs)) = \n    if postDate l &lt; postDate r\n    then prettyShow l : showOrderedOf2 (ls, (r:rs))\n    else prettyShow r : showOrderedOf2 ((l:ls), rs)\n\nshowOrderedOf3 :: ([Post a], [Post b], [Post c]) -&gt; [String]\nshowOrderedOf3 ([], [], []) = []\nshowOrderedOf3 (as, [], []) = map postBody as\nshowOrderedOf3 ([], bs, []) = map postBody bs\nshowOrderedOf3 ([], [], cs) = map postBody cs\nshowOrderedOf3 (as, bs, []) = showOrderedOf2 (as, bs)\nshowOrderedOf3 ([], bs, cs) = showOrderedOf2 (bs, cs)\nshowOrderedOf3 (as, [], cs) = showOrderedOf2 (as, cs)\nshowOrderedOf3 ((a:as), (b:bs), (c:cs)) =\n    let (adate, bdate, cdate) = (postDate a, postDate b, postDate c)\n        minDate = minimum [adate, bdate, cdate]\n    in\n    if adate == minDate\n    then prettyShow a : showOrderedOf3 (as, (b:bs), (c:cs))\n    else (if bdate == minDate\n         then prettyShow b : showOrderedOf3 ((a:as), bs, (c:cs))\n         else prettyShow c : showOrderedOf3 ((a:as), (b:bs), cs))\n\ncreateAndShowSample :: IO ()\ncreateAndShowSample =\n    let faceAc = Account {...} :: Account Facebook\n        twitAc = Account {...} :: Account Twitter\n        linkAc = Account {...} :: Account LinkedIn\n    in \n    showOrderedOf3 (accountPosts faceAc, accountPosts twitAc, accountPosts linkAc)\n        |&gt; intercalate \"\\n\"\n        |&gt; putStrLn\n</code></pre>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "edited": false, "score": 0, "creation_date": 1439732580, "post_id": 32035680, "comment_id": 51972263, "body": "Aha! I didn&#39;t know <code>!!</code> was particularly inefficient either, thanks for that."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "edited": false, "score": 4, "creation_date": 1439733077, "post_id": 32035680, "comment_id": 51972416, "body": "@DanielLittlewood Keep in mind that Haskell lists are <b>linked</b> structures. The operation <code>xs !! n</code> requires to walk for <code>n</code> links to obtain the element. This is in  contrast to usual indexing of arrays in most imperative languages were it would require O(1) operations."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1439732288, "creation_date": 1439732288, "answer_id": 32035680, "question_id": 32035639, "link": "https://stackoverflow.com/questions/32035639/double-list-comprehension-in-haskell/32035680#32035680", "title": "Double List Comprehension in Haskell", "body": "<p>Indeed there is. The common idiom for getting list elements together with their indices is to use <code>zip</code>:</p>\n\n<pre><code>[(x,y) | (x,mx) &lt;- zip [1..] m, (y,mxy) &lt;- zip [1..] mx, p mxy]\n</code></pre>\n\n<p>Also:</p>\n\n<ul>\n<li><code>!!</code> is quite inefficient, especially when extracting many elements from a list, so it's best to try to avoid it when possible.</li>\n<li>List indices usually start with <code>0</code> in Haskell.</li>\n</ul>\n"}], "owner": {"reputation": 501, "user_id": 4681998, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e983411d6b657a245740031a55ed4b3?s=128&d=identicon&r=PG", "display_name": "preferred_anon", "link": "https://stackoverflow.com/users/4681998/preferred-anon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1604, "favorite_count": 0, "accepted_answer_id": 32035680, "answer_count": 1, "score": 3, "last_activity_date": 1563081206, "creation_date": 1439732045, "last_edit_date": 1563081206, "question_id": 32035639, "link": "https://stackoverflow.com/questions/32035639/double-list-comprehension-in-haskell", "title": "Double List Comprehension in Haskell", "body": "<p>I'm trying to implement an array as a list of lists in Haskell. In particular, I have some array <code>m</code> that I'm given, and a predicate <code>p</code> that I want to be satisfied, and I want to create a list of indices <code>(x,y)</code> such that the <code>x</code>th element of the <code>y</code>th list satisfies <code>p</code>. I set this up as the following list comprehension:  </p>\n\n<pre><code>[(x,y) | x&lt;-[1..],y&lt;-[1..],p ((m !! y) !! x)]  \n</code></pre>\n\n<p>Which throws up an error when it tries to find an element of <code>m</code> in the first row that doesn't exist. I can see one immediate way to fix this is to just change the inner comprehensions on <code>x</code> and <code>y</code> to something like <code>y&lt;-[1..length m]</code> but I feel like there's a cuter way that exploits laziness. I just don't know what it is.</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1439729529, "post_id": 32034889, "comment_id": 51971413, "body": "Maybe playing some ugly tricks with <code>unsafeCoerce</code> and under a big assumption on how GHC precisely implements its runtime you can achieve this. But... I really doubt this check is a big problem: do you have any evidence for it? As Knuth puts it, premature optimization is the root of all evil. And don&#39;t use <code>unsafe*</code> stuff unless you really, really can not do without."}, {"owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1439731221, "post_id": 32034889, "comment_id": 51971869, "body": "No, I don&#39;t have any evidence, and I will do some benchmarking before I implement anything."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 5, "creation_date": 1439731656, "post_id": 32034889, "comment_id": 51971985, "body": "Have you looked at the compiled Core that your program is generating? Depending on why a <code>Maybe</code> is involved in the first place, it&#39;s <i>possible</i> that GHC might have already removed it for you..."}, {"owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "edited": false, "score": 0, "creation_date": 1439733019, "post_id": 32034889, "comment_id": 51972395, "body": "I have looked at the compiled Core. The situation is actually more complicated than I described here, involving a GADT, rather than <code>Maybe</code>. In my situation, it&#39;s actually in theory possible to tell by the type which constructors need to be matched on; the Core sometimes uses this information well and sometimes does not (and thus includes an error case that can&#39;t happen). I think I can work with that, though."}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1439733164, "post_id": 32034889, "comment_id": 51972445, "body": "Heed @chi&#39;s advise. You rarely will guess correctly what are the performance problems in your program even in imperative straightforward languages.  In Haskell... well let&#39;s say that GHC  it is a creatively wild compiler for adrenaline addicted freaks, the sort that would practice <a href=\"https://www.youtube.com/watch?v=LrklTR4buEc\" rel=\"nofollow noreferrer\">paragliding in the fiords</a> if they were into that kind of things..."}], "answers": [{"comments": [{"owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "edited": false, "score": 0, "creation_date": 1439733818, "post_id": 32035833, "comment_id": 51972658, "body": "<code>fromJust</code> includes a check for <code>Nothing</code>, which is what I wanted to avoid."}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "reply_to_user": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "edited": false, "score": 1, "creation_date": 1439733981, "post_id": 32035833, "comment_id": 51972714, "body": "Then maybe use <code>Yolo</code>"}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": false, "score": 1, "last_activity_date": 1439733672, "last_edit_date": 1439733672, "creation_date": 1439733236, "answer_id": 32035833, "question_id": 32034889, "link": "https://stackoverflow.com/questions/32034889/haskell-ghc-unsafely-deconstruct-a-constructor/32035833#32035833", "title": "Haskell / GHC: Unsafely deconstruct a constructor?", "body": "<p>Consider using the <code>YOLO</code> typeclass\n<a href=\"https://gist.github.com/nkpart/8922083d3c18a8f777b8\" rel=\"nofollow\">https://gist.github.com/nkpart/8922083d3c18a8f777b8</a></p>\n\n<pre><code>instance Yolo Maybe where\n  yolo (Just x) = x\n</code></pre>\n\n<p>N.B: That was a joke. Use <code>fromJust</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1439760352, "last_edit_date": 1439760352, "creation_date": 1439757163, "answer_id": 32039645, "question_id": 32034889, "link": "https://stackoverflow.com/questions/32034889/haskell-ghc-unsafely-deconstruct-a-constructor/32039645#32039645", "title": "Haskell / GHC: Unsafely deconstruct a constructor?", "body": "<p>Sometimes you can help GHC figure out that a GADT pattern match is total by adding some pattern signatures. I'm not really sure why that sometimes helps but it can. If you really want unsafe, the way to do it is to make a more informative GADT than the one you are working with and unsafely coerce to it. Something like this:</p>\n\n<pre><code>data Shmaybe :: Bool -&gt; * -&gt; * where\n  Noway :: Shmaybe r a\n  Shucks :: a -&gt; Shmaybe True a\n\nfromShucks :: ShMaybe True a -&gt; a\nfromShucks (Shucks a) = a\n\nunsafeFromJust :: forall a . Maybe a -&gt; a\nunsafeFromJust m = fromShucks (unsafeCoerce m :: Shmaybe True a)\n</code></pre>\n\n<p>It's important that the constructors match in both argument types and order. Obviously, this is all absurdly unsafe and comes with no guarantees. Segmentation faults may happen.</p>\n"}, {"tags": [], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "is_accepted": false, "score": 1, "last_activity_date": 1439785425, "creation_date": 1439785425, "answer_id": 32042762, "question_id": 32034889, "link": "https://stackoverflow.com/questions/32034889/haskell-ghc-unsafely-deconstruct-a-constructor/32042762#32042762", "title": "Haskell / GHC: Unsafely deconstruct a constructor?", "body": "<p>I am aware of several possibilities, but all implicitly include code for\nthrowing errors in the <code>Nothing</code> case.</p>\n\n<p><em>Irrefutable pattern</em>:</p>\n\n<pre><code>\u03bb&gt; let Just a = Just \"hi\"\n\u03bb&gt; a\n\"hi\"\n\u03bb&gt; let Just a = Nothing\n\u03bb&gt; a\n*** Exception: &lt;interactive&gt;:4:5-20: Irrefutable pattern failed for pattern Data.Maybe.Just a\n</code></pre>\n\n<p><em>Non-exhastive patterns</em>:</p>\n\n<pre><code>\u03bb&gt; let f (Just a) = a\n\u03bb&gt; f (Just \"hi\")\n\"hi\"\n\u03bb&gt; f Nothing\n*** Exception: &lt;interactive&gt;:6:5-18: Non-exhaustive patterns in function f\n</code></pre>\n\n<p><code>fromJust</code> (check and throw error):</p>\n\n<pre><code>\u03bb&gt; fromJust (Just \"hi\")\n\"hi\"\n\u03bb&gt; fromJust Nothing\n*** Exception: Maybe.fromJust: Nothing\n</code></pre>\n\n<p>You cannot use <code>unsafeCoerce</code> because for all <code>a</code> the internal representations of <code>Maybe a</code> and <code>a</code> are different, and I am\nnot aware of a way to tell GHC to not check the other cases in\nan irrefutable pattern.</p>\n\n<p>Have you shown that this behaviour has\nundesirable performance characteristics and that there aren't\nother, easier optimisations?  Unless you have, I would not worry about\nit :)</p>\n"}], "owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 32039645, "answer_count": 3, "score": 6, "last_activity_date": 1439785425, "creation_date": 1439726830, "question_id": 32034889, "link": "https://stackoverflow.com/questions/32034889/haskell-ghc-unsafely-deconstruct-a-constructor", "title": "Haskell / GHC: Unsafely deconstruct a constructor?", "body": "<p>Here's a specific case of the general question I'm really asking: Suppose I'm in a performance critical section of code and I've received a value</p>\n\n<pre><code>x :: Maybe Int\n</code></pre>\n\n<p>I know it's a <code>Just Int</code> and not a <code>Nothing</code>, but due to code out of my control, I can't arrange to receive the actual <code>Int</code> directly. I want to do</p>\n\n<pre><code>case x of\n    Just i -&gt; whatever i\n</code></pre>\n\n<p>but I don't want GHC to insert any checking or error handling or jumps or anything; just interpret the bits as if they are of the form <code>Just i</code> and let me deal with the consequences.</p>\n\n<p>Is this possible? (Yes, I know this is something one shouldn't do regularly.)</p>\n"}, {"tags": ["haskell", "syntax"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439722720, "post_id": 32033879, "comment_id": 51969598, "body": "Start with the email lists. Maybe haskell@haskell.org?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1439733140, "post_id": 32033879, "comment_id": 51972436, "body": "I think not <code>haskell@haskell.org</code>, that&#39;s mostly for announcements, and fairly low volume. I&#39;m not sure what&#39;s the &quot;correct&quot; place, but <code>haskell-cafe@haskell.org</code> is for general discussion, so it shouldn&#39;t be <i>too</i> out of place there."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 4, "creation_date": 1439734084, "post_id": 32033879, "comment_id": 51972763, "body": "Oh, found <a href=\"https://wiki.haskell.org/Language_and_library_specification\" rel=\"nofollow noreferrer\">on the wiki</a>: &quot;If you find a mistake in the report, please send it to the <a href=\"http://www.haskell.org/mailman/listinfo/haskell-prime\" rel=\"nofollow noreferrer\">haskell-prime mailing list</a> (you have to register first), or send it directly to one of the current committee members.&quot;"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1439719402, "creation_date": 1439719402, "answer_id": 32033879, "question_id": 32033775, "link": "https://stackoverflow.com/questions/32033775/an-obscure-corner-of-the-haskell-report/32033879#32033879", "title": "An obscure corner of the Haskell Report", "body": "<p>Wait, hold up... According to the Control-Free Syntax given in section 10.5:</p>\n\n<blockquote>\n  <p>export &rarr; <em>qvar</em> | <em>qtycon</em> ... | <em>qtycls</em> ... | <code>module</code> <em>monid</em></p>\n  \n  <p>...</p>\n  \n  <p><em>var</em> &rarr; <em>varid</em> | <code>(</code> <em>varsym</em> <code>)</code></p>\n  \n  <p><em>qvar</em> &rarr; <em>qvarid</em> | <code>(</code> <em>qvarsym</em> <code>)</code></p>\n</blockquote>\n\n<p>So it seems that it's <strong>not</strong> a <em>qvarid</em>, it's supposed to be a <em>qvar</em>. So it's just a typo, I guess? Is there a process for having such things fixed in the official report?</p>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 32033879, "answer_count": 1, "score": 7, "last_activity_date": 1439719402, "creation_date": 1439718530, "question_id": 32033775, "link": "https://stackoverflow.com/questions/32033775/an-obscure-corner-of-the-haskell-report", "title": "An obscure corner of the Haskell Report", "body": "<p>Section 5.2 of the Haskell 2010 Report deals with module export lists. At one point, it <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1000005.2\" rel=\"noreferrer\">says</a>:</p>\n\n<blockquote>\n  <p>Entities in an export list may be named as follows:</p>\n  \n  <ol>\n  <li>A value, field name, or class method, whether declared in the module body or imported, may be named by giving the name of the value as a <em>qvarid</em>, which must be in scope. Operators should be enclosed in parentheses to turn them into <em>qvarids</em>.</li>\n  </ol>\n  \n  <p>...</p>\n</blockquote>\n\n<p>But, uh... am I missing something? Because according to the Syntax Reference in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17500010\" rel=\"noreferrer\">Chapter 10</a>:</p>\n\n<blockquote>\n  <p><em>qvarid</em> &rarr; [ <em>monid</em> . ] <em>varid</em></p>\n  \n  <p><em>varid</em> &rarr; ( <em>small</em> { <em>small</em> | <em>large</em> | <em>digit</em> | ' })</p>\n</blockquote>\n\n<p>So in which universe does putting an operator in brackets turn it into a <em>qvarid</em>? It looks to me like an operator is clearly a <em>varsym</em> (or maybe <em>qvarsym</em>).</p>\n\n<p>Does anybody know what's going on here? I mean, <em>clearly</em> Haskell definitely supports writing operators in an export list, but the syntax description in the Report doesn't appear to make sense...</p>\n"}, {"tags": ["haskell", "precision"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439707153, "post_id": 32032403, "comment_id": 51966131, "body": "Stackoverflow is <b>not</b> a library/package/software/tutorial recommendation site. Such questions are <i>off topic</i>."}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 1779564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b9c68ea28719640b824e02e6ea87463?s=128&d=identicon&r=PG", "display_name": "Iguana", "link": "https://stackoverflow.com/users/1779564/iguana"}, "edited": false, "score": 0, "creation_date": 1439731073, "post_id": 32032831, "comment_id": 51971831, "body": "If I wanted to 400 bits of precision using the above function, would it be able to give me that? Also would it be fast enough?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 147, "user_id": 1779564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b9c68ea28719640b824e02e6ea87463?s=128&d=identicon&r=PG", "display_name": "Iguana", "link": "https://stackoverflow.com/users/1779564/iguana"}, "edited": false, "score": 1, "creation_date": 1439797253, "post_id": 32032831, "comment_id": 51989961, "body": "Every type implements its own <code>sin</code>/<code>cos</code>.  So you need to find a type that calculates it with 400 bits of precision.  Neither <code>Float</code> nor <code>Double</code> do this, so you might want to hunt around/search for high-precision real number types :)  Remember it&#39;s the types that define their precision.  <code>sin</code>/<code>cos</code>/etc. are overloaded and definable by every time.  So find a high precision type and chances are it&#39;ll have a high precision sin/cos."}, {"owner": {"reputation": 147, "user_id": 1779564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b9c68ea28719640b824e02e6ea87463?s=128&d=identicon&r=PG", "display_name": "Iguana", "link": "https://stackoverflow.com/users/1779564/iguana"}, "edited": false, "score": 0, "creation_date": 1439799556, "post_id": 32032831, "comment_id": 51991140, "body": "I think I get your point. But obviously Haskell does not come equipped with an arbitrary precision Fractional type which has sin defined for it (since the sine function would be restricted to some type class). So does that mean I have to construct it?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 147, "user_id": 1779564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b9c68ea28719640b824e02e6ea87463?s=128&d=identicon&r=PG", "display_name": "Iguana", "link": "https://stackoverflow.com/users/1779564/iguana"}, "edited": false, "score": 0, "creation_date": 1439840991, "post_id": 32032831, "comment_id": 52015891, "body": "You can construct it, or you can search for a package/library somewhere that provides it"}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 1, "last_activity_date": 1439710154, "creation_date": 1439710154, "answer_id": 32032831, "question_id": 32032403, "link": "https://stackoverflow.com/questions/32032403/evaluating-trigonometric-functions-on-haskell/32032831#32032831", "title": "Evaluating trigonometric functions on Haskell", "body": "<p>As far as Haskell goes, all trigonometric functions in specified in the language (and that are in <code>base</code> --- <code>sin</code>, <code>cos</code>, etc.) are overloaded/polymorphic using typeclasses, so every type gets to implement a one-time-implemented <code>sin</code>, <code>cos</code>, etc.</p>\n\n<p>So <code>Float</code> gets to implement <code>sin</code>, <code>cos</code>, and <code>Double</code> gets to implement it, etc.</p>\n\n<p>So customizing the precision of <code>sin</code> might be just a matter of finding a type somewhere that fits the precision you need.  Every type gets to implement its own <code>sin</code>, so they're free to give whatever precision they want.</p>\n\n<p>You can also just write your own versions of <code>sin</code> and <code>cos</code> that \"round\" or truncate precision in the way you want, and name it <code>sin'</code> or <code>cos'</code> or something like that too :)</p>\n\n<pre><code>sin' x = (/100) . realToFrac . round . (*100) . sin\n</code></pre>\n\n<p>maybe, for instance</p>\n"}], "owner": {"reputation": 147, "user_id": 1779564, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b9c68ea28719640b824e02e6ea87463?s=128&d=identicon&r=PG", "display_name": "Iguana", "link": "https://stackoverflow.com/users/1779564/iguana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 705, "favorite_count": 0, "accepted_answer_id": 32032831, "answer_count": 1, "score": 1, "last_activity_date": 1439722540, "creation_date": 1439705904, "last_edit_date": 1439722540, "question_id": 32032403, "link": "https://stackoverflow.com/questions/32032403/evaluating-trigonometric-functions-on-haskell", "title": "Evaluating trigonometric functions on Haskell", "body": "<p>Is there a way in Haskell to specify the precision (say r bits) for the numerical calculation of trigonometric functions?</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439702951, "post_id": 32031968, "comment_id": 51965466, "body": "Well, the definition is clear: &quot;An arrow of <code>CatC</code>/A from <code>f: C -&gt; A</code> to <code>f&#39;: C&#39; -&gt; A</code> is an arrow <code>h: C -&gt; C</code>&#39;&quot; so an arrow of <code>CatC</code>/A is an arrow of <code>CatC</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439722849, "post_id": 32031968, "comment_id": 51969636, "body": "Where does the quoted text come from?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439737963, "post_id": 32031968, "comment_id": 51974095, "body": "Written in Agda it&#39;s: <code>_\u21d2\u209b_ : \u2200 {A B C} -&gt; A \u21d2 C -&gt; B \u21d2 C -&gt; Set _; f \u21d2\u209b g = \u2203 \u03bb h -&gt; g \u2218 h \u2248 f</code>. So it&#39;s an arrow <code>A \u21d2 B</code> in the original category, equipped with commutativity proof."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457065284, "creation_date": 1457065284, "answer_id": 35787927, "question_id": 32031968, "link": "https://stackoverflow.com/questions/32031968/arrow-notation-in-slice-category/35787927#35787927", "title": "Arrow notation in slice category", "body": "<p>This is really just terminological confusion \"type\" of an arrow in <code>CatC/A</code> is an arrow in <code>CatC/A</code> between objects of <code>CatC/A</code>. The <em>data</em> (or content if you prefer) of such an arrow is an arrow in <code>CatC</code> coupled with an additional proof obligation. Your arrows in <code>CatC/A</code> are thus not just arrows in <code>CatC</code>, but are the pairs of such arrows with the proofs that they satisfy the required commutative diagram.</p>\n"}], "owner": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1457065284, "creation_date": 1439700916, "question_id": 32031968, "link": "https://stackoverflow.com/questions/32031968/arrow-notation-in-slice-category", "title": "Arrow notation in slice category", "body": "<blockquote>\n  <p>If <code>CatC</code> is a category and A any object of <code>CatC</code>, the slice category <code>CatC</code>/A is described this way:</p>\n  \n  <p>SC-1 An object of <code>CatC</code>/A is an arrow <code>f: C -&gt; A</code> of <code>CatC</code> for some object C.</p>\n  \n  <p>SC-2 An arrow of <code>CatC</code>/A from <code>f: C -&gt; A</code> to <code>f': C' -&gt; A</code> is an arrow <code>h: C -&gt; C'</code> with the property that <code>f = f' . h</code>.</p>\n  \n  <p>SC-3 The composite of <code>h: f -&gt; f'</code> and <code>h': f -&gt; f''</code> is <code>h' . h</code>.</p>\n</blockquote>\n\n<p>What is the type of arrow in <code>CatC</code>/A? </p>\n\n<p><code>C -&gt; C</code>(object in <code>CatC</code> to object in <code>CatC</code>) or <code>f -&gt; f'</code>(object in <code>CatC</code>/A to object in <code>CatC</code>/A).</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1439700890, "post_id": 32031911, "comment_id": 51965152, "body": "This might need to be moved to MathExchange."}], "answers": [{"tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 2, "last_activity_date": 1439712542, "last_edit_date": 1439712542, "creation_date": 1439712188, "answer_id": 32033041, "question_id": 32031911, "link": "https://stackoverflow.com/questions/32031911/arrows-in-the-definition-of-dual-of-category/32033041#32033041", "title": "Arrows in the definition of dual of category", "body": "<p>I'd consider this a bit off-topic for Stack Overflow, but I'll just answer anyway.</p>\n\n<p>The morphisms and objects themselves don't change.  They are the same.  What we get to re-define are the domain and the codomain that we consider each morphism to have.  So if <em>x</em> is a morphism in in <strong><em>C</em></strong>, <strong><em>C</em></strong> gets to define <em>dom(x)</em> and <em>cod(x)</em>.</p>\n\n<p>Let's say I have a morphism in <strong><em>C</em></strong> and <strong><em>C</em></strong><sup>op</sup>, I'll call it <em>x</em>.  In <strong><em>C</em></strong>, it's defined that <em>dom(x) = X</em>, and <em>cod(f) = Y</em>.  Cool.  Now, when we define our new category <strong><em>C</em></strong><sup>op</sup>, we get to define <em>dom(x)</em> and <em>cod(f)</em> however we like.  We'll define <em>dom(x)</em> (remember, we can call it whatever we want) as <em>Y</em>, and <em>cod(x)</em> as <em>X</em>.  That's the \"rule\" of constructing a dual category.</p>\n\n<p>Remember that morphisms aren't functions, in general...they're just structureless things.  In a given Category we can imbue them with domains and codomains, but they're just sort of like meaningless/structureless tags.</p>\n\n<p>You can think of morphisms as a bag of things, each with two properties given by the category: a domain and a codomain.  The category itself can specify the domain and the codomain however they like; they're just like arbitrary \"tags\".</p>\n\n<p>For example, the category <strong><em>L</em></strong> whose objects are the natural numbers and where a single morphism exists between any two numbers numbers, where the domain is defined as the number that is higher and the codomain is defined as the number that is lower.  There's also a single morphism from each number to itself.  So there is a morphism <em>x</em> whose domain is 5 and whose codomain is 2.  And there is another morphism <em>y</em> whose domain is 10 and whose codomain is 3 (only one such morphism exists, here).  There is no morphism whose domain is 5 and codomain is 11.  It's not a part of our bag of morphisms.  There <em>is</em> a morphism between 5 and 11, but its domain is 11 and its codomain is 5.</p>\n\n<p>Well, we can now define a new category, <strong><em>L</em></strong><sup>op</sup>, whose objects are the natural numbers and which has all of the morphisms from <strong><em>L</em></strong>.  <em>x</em> is still there, and <em>y</em> is still there...<em>x</em> and <em>y</em> are just things in a bag.  Only, now, we look at <em>x</em>, and we say that its domain is 2 and its codomain is 5, and we look at <em>y</em> and say that its domain is 3 and its codomain is 10.  We just \"tag\" it with different numbers.  And what numbers do we tag <em>x</em>, <em>y</em> with?  Exactly the numbers they were tagged with in <strong><em>L</em></strong>, except flipped.</p>\n\n<p>In <strong><em>L</em></strong><sup>op</sup>, is there a morphism whose domain is 5 and whose codomain is 1?  Well, to find one, we would need to find a morphism whose domain in <strong><em>L</em></strong> was tagged as 1 and whose codomain in <strong><em>L</em></strong> was tagged as 5.  But no such morphism exists.  So no, no such morphism exists in <strong><em>L</em></strong><sup>op</sup></p>\n\n<p>So, in both cases, the morphism in question is exactly the same.  But the difference is what we \"call\" the domain and what we \"call\" the codomain.</p>\n"}], "owner": {"reputation": 1394, "user_id": 757616, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/63a9939189572fab4f8b36659d719c2e?s=128&d=identicon&r=PG", "display_name": "wenlong", "link": "https://stackoverflow.com/users/757616/wenlong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 32033041, "answer_count": 1, "score": 0, "last_activity_date": 1439712542, "creation_date": 1439700337, "question_id": 32031911, "link": "https://stackoverflow.com/questions/32031911/arrows-in-the-definition-of-dual-of-category", "title": "Arrows in the definition of dual of category", "body": "<blockquote>\n  <p>Given any category <code>CatC</code>, you can construct another category denoted <code>CatC</code><sup>op</sup> by reversing all the arrows. The dual or opposite <code>CatC</code><sup>op</sup> of a category <code>CatC</code> is defined by:</p>\n  \n  <p>D-1 The objects and arrows of <code>CatC</code><sup>op</sup> are the objects and arrows of <code>CatC</code></p>\n  \n  <p>D-2 If <code>f: A -&gt; B</code> in <code>CatC</code>, then <code>f: B -&gt; A</code> in <code>CatC</code><sup>op</sup>.</p>\n  \n  <p>D-3 If <code>h = g . f</code> in <code>CatC</code>, then <code>h = f . g</code> in <code>CatC</code><sup>op</sup>.</p>\n</blockquote>\n\n<p>My question is the conflict of <code>D-2</code> and <code>D-1</code>, each arrow in <code>CatC</code><sup>op</sup> is the reverse of the corresponding on in <code>CatC</code>. Why <code>D-1</code> says that the arrows of <code>CatC</code><sup>op</sup> are the arrows of <code>CatC</code>?</p>\n"}, {"tags": ["haskell", "aeson", "hspec"], "answers": [{"comments": [{"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1439706148, "post_id": 32031014, "comment_id": 51965972, "body": "Thank you. That makes sense. I guess I will just stick to parsing the entire record for now. Btw, for whatever reason <code>json</code> seems to work regardless of the order of the keys as long as it is a flat object and not an array."}, {"owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "reply_to_user": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1439767377, "post_id": 32031014, "comment_id": 51982330, "body": "@Ecognium: The order of the keys doesn\u2019t matter in your case because you\u2019re using Aeson both in your tests and in the implementation of the web service, and Aeson will normalize the order of the keys during serialization. However, if you were using something other than Aeson in your web service which disagreed with Aeson in how the key orders should be, your test would say the responses differ when they were semantically equivalent."}], "tags": [], "owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "is_accepted": true, "score": 3, "last_activity_date": 1439688422, "creation_date": 1439688422, "answer_id": 32031014, "question_id": 32030881, "link": "https://stackoverflow.com/questions/32030881/issue-with-aeson-or-wai-json-quasiquoter-converts-0-0-to-0/32031014#32031014", "title": "Issue with Aeson or Wai.JSON QuasiQuoter -- Converts 0.0 to 0", "body": "<p>The suspect appears to be this line of <code>Data.Aeson.QQ</code>:</p>\n\n<pre><code>toExp (JsonNumber n) = [|Number (fromRational $(return $ LitE $ RationalL (toRational n)))|]\n</code></pre>\n\n<p>It converts the number to a <code>Rational</code>, converts that to a Haskell expression, and then has the resulting expression then turn it back into a <code>Number</code>. This ends up discarding the fact that it was <code>0.0</code> rather than <code>0</code>.</p>\n\n<p>This would not normally be a problem, as Aeson correctly defines <code>==</code> to make <code>Number</code>s with equal values equal. This becomes an actual problem with <code>Test.Hspec.Wai.JSON</code>; the way it works is that it encodes the object back into a <code>ByteString</code> and expects it to match it exactly.</p>\n\n<p>While <code>Data.Aeson.QQ</code> is the root cause of your problem, I would not hold it to blame. Instead, <code>Test.Hspec.Wai.JSON</code> should not be serializing JSON objects and expecting their representations to be equivalent. Rather, it should be deserializing the actual response and comparing the decoded objects for equality. (After all, floating-point/integer isn\u2019t the only possible problem. It also wouldn\u2019t be able to handle object keys being reordered.) I\u2019m not familiar with Hspec, so I\u2019m not sure how you\u2019d make it do that.</p>\n"}], "owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 32031014, "answer_count": 1, "score": 2, "last_activity_date": 1439688422, "creation_date": 1439686938, "last_edit_date": 1439687447, "question_id": 32030881, "link": "https://stackoverflow.com/questions/32030881/issue-with-aeson-or-wai-json-quasiquoter-converts-0-0-to-0", "title": "Issue with Aeson or Wai.JSON QuasiQuoter -- Converts 0.0 to 0", "body": "<p>I am using <code>Test.Hspec.Wai.JSON</code> to check the return value of my api endpoints. I noticed that whenever i create a json with a value of <code>0.0</code>, when the test runs, it converts it to <code>0</code> (Int) and if the api returns <code>0.0</code>, the test fails. </p>\n\n<pre><code>let  j = [json|{\"test\":0.0}|]\nrequest \"GET\" \"some_url\" [(\"Content-Type\", \"application/json\")] \"\"\n        `shouldRespondWith` j {matchStatus = 200}\n\n   body mismatch:\n     expected: {\"test\":0}  ---&gt; this is the issue (0.0 has become 0)\n     but got:  {\"test\":0.0} \n</code></pre>\n\n<p>I am not that advanced in Haskell to figure out where in the library code this is happening. I looked at the source code for <code>Test.Hspec.Wai.JSON</code> and it seems to be relying on <code>Aeson.QQ</code> so not really sure the source of the issue. This is <a href=\"https://hackage.haskell.org/package/hspec-wai-json-0.6.1/docs/src/Test-Hspec-Wai-JSON.html#json\" rel=\"nofollow\">Test.Hspec.Wai.JSON source</a> and this is the <a href=\"https://hackage.haskell.org/package/aeson-qq-0.8.1/docs/src/Data-Aeson-QQ.html#aesonQQ\" rel=\"nofollow\">Aeson.QQ Source</a></p>\n\n<p>Due to this, my work around has been to write a <code>FromJSON</code> instance to parse the entire response and check against the filled out record. This is a bit tedious. </p>\n\n<p>Any suggestions as to what in the library code is causing this? And how to fix it?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell", "emacs", "ghc-mod"], "comments": [{"owner": {"reputation": 27385, "user_id": 729907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HeXcc.png?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/729907/drew"}, "edited": false, "score": 1, "creation_date": 1439692376, "post_id": 32030743, "comment_id": 51963907, "body": "Not enough info, I&#39;d guess, but maybe it will ring a bell for someone familiar with <code>ghc*</code>. Otherwise, try providing a specific, step-by-step recipe to reproduce the problem, including all steps, starting from <code>emacs -Q</code>."}, {"owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "reply_to_user": {"reputation": 27385, "user_id": 729907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HeXcc.png?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/729907/drew"}, "edited": false, "score": 0, "creation_date": 1439712595, "post_id": 32030743, "comment_id": 51967299, "body": "@Drew It may seem incomplete but I really don&#39;t have any more info to provide. I just installed <code>ghc-mod</code> and when I try to open a Haskell file it just freezes. I&#39;ll add to my post the lines I added to my <code>.emacs</code> when I wanted to add <code>ghc-mod</code>."}, {"owner": {"reputation": 65926, "user_id": 324105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b1ad4e4bdf8feaef18504593914fe16?s=128&d=identicon&r=PG", "display_name": "phils", "link": "https://stackoverflow.com/users/324105/phils"}, "edited": false, "score": 0, "creation_date": 1439717774, "post_id": 32030743, "comment_id": 51968365, "body": "FYI that instance of <code>`load-path</code> would conventionally use a regular <code>&#39;</code> quote than a backquote. (It seems like a standard backquote, though, so functionally that&#39;s not actually a problem here.)"}, {"owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "reply_to_user": {"reputation": 65926, "user_id": 324105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b1ad4e4bdf8feaef18504593914fe16?s=128&d=identicon&r=PG", "display_name": "phils", "link": "https://stackoverflow.com/users/324105/phils"}, "edited": false, "score": 0, "creation_date": 1439717990, "post_id": 32030743, "comment_id": 51968422, "body": "@phils Thanks for the tip. But yeah, that&#39;s not the problem here. load path works correctly."}], "answers": [{"tags": [], "owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "is_accepted": true, "score": 0, "last_activity_date": 1440002652, "creation_date": 1440002652, "answer_id": 32101223, "question_id": 32030743, "link": "https://stackoverflow.com/questions/32030743/emacs-stuck-on-infinite-loop-when-trying-to-use-ghc-mod/32101223#32101223", "title": "Emacs stuck on infinite loop when trying to use ghc-mod", "body": "<p>I opened an issue on <code>ghc-mod</code> github repo and they solved the issue.</p>\n\n<p>You can view the solution in <a href=\"https://github.com/kazu-yamamoto/ghc-mod/issues/542\" rel=\"nofollow\" title=\"this\">this</a> issue's comments.</p>\n"}], "owner": {"reputation": 1779, "user_id": 3671272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nK622.png?s=128&g=1", "display_name": "TheCrafter", "link": "https://stackoverflow.com/users/3671272/thecrafter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 32101223, "answer_count": 1, "score": 3, "last_activity_date": 1440002652, "creation_date": 1439685353, "last_edit_date": 1439749125, "question_id": 32030743, "link": "https://stackoverflow.com/questions/32030743/emacs-stuck-on-infinite-loop-when-trying-to-use-ghc-mod", "title": "Emacs stuck on infinite loop when trying to use ghc-mod", "body": "<p>I've been trying to learn Haskell the last couple of days so it was finally time to setup my environment. Thus, I installed Haskell Platform and cabal.</p>\n\n<p>My editor is emacs and my OS is Windows.</p>\n\n<p>I downloaded the ghc-mod's master branch from github and using cabal I installed the dependencies and then built the project. Everything went fine and the executable seems to work.</p>\n\n<p>Commands like <code>ghc-mod --version</code> or <code>ghc-mod boot</code> work as expected.</p>\n\n<p>Then, I installed haskell-mode on emacs and modified .emacs to use ghc. But when I tried to open a Haskell file, emacs froze saying \"Initializing...\".</p>\n\n<p>What is the problem?</p>\n\n<p>GHC version: 7.10.2\ncabal version: 1.22.6.0 using version 1.22.4.0 of the cabal library\nghc-mod version: 5.3.0.0 compiled by GHC 7.10.2</p>\n\n<p><strong>Edit 1: 16/8/2015 11:10</strong></p>\n\n<p>Here are the lines I added to my <code>.emacs</code>:</p>\n\n<pre><code>; haskell-mode\n(add-hook 'haskell-mode-hook 'haskell-indentation-mode)\n\n; ghc-mod for haskell\n; I added to list path to ghc elisp file because I read somewhere that that's\n; better than installing it from MELPA. I DID try to install it from melpa\n; though. Didn't solve anything.\n(add-to-list `load-path \"~/cabal/x86_64-windows-ghc-7.10.2/ghc-mod-5.3.0.0/elisp\")\n\n(autoload 'ghc-init \"ghc\" nil t)\n(autoload 'ghc-debug \"ghc\" nil t)\n(add-hook 'haskell-mode-hook (lambda () (ghc-init)))\n</code></pre>\n\n<p>Emacs freeze when I try to open a haskell file for the first time. So I guess it stacks in an infinite loop inside <code>ghc-init()</code>.</p>\n\n<p><strong>Edit 2: 16/8/2015 21:16</strong></p>\n\n<p>Output from <code>ghc-debug</code> is <a href=\"http://jpst.it/A-PW/\" rel=\"nofollow\" title=\"Output from ghc-debug\">here</a></p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1439676649, "last_edit_date": 1439676649, "creation_date": 1439676179, "answer_id": 32029828, "question_id": 32029776, "link": "https://stackoverflow.com/questions/32029776/understanding-haskell-seq/32029828#32029828", "title": "Understanding Haskell seq", "body": "<p><code>seq</code>ing a tuple only forces it to be evaluated as much as to expose its tuple constructor, but will not evaluate its components.</p>\n\n<p>That is,</p>\n\n<pre><code>let pair = id (1+1, 2+2)\nin seq pair $ ...\n</code></pre>\n\n<p>will apply <code>id</code> and produce <code>(_thunk1, _thunk2)</code> where the <code>_thunk</code>s point to the additions, which are not evaluated at this time.</p>\n\n<p>In your second example, you are forcing the accumulator <code>acc</code>, but not its components, hence some large thunks still build up.</p>\n\n<p>You could use a so-called evaluation strategy such as:</p>\n\n<pre><code>evalPair :: (a,b) -&gt; ()\nevalPair (a,b) = seq a $ seq b ()\n\ntestSeq2 :: Int -&gt; (Int,Int)\ntestSeq2 n = impl n (0,0) where\nimpl 0 acc = acc\nimpl i acc = seq (evalPair acc) $ impl (i-1) ((fst acc)+1, (snd acc)+1)\n</code></pre>\n\n<p>But then, <code>testSeq1</code> is a simpler approach.</p>\n\n<p>As another alternative, use <a href=\"http://hackage.haskell.org/package/strict-0.3.2/docs/Data-Strict-Tuple.html\">strict tuples</a>. Such tuples never have thunks for components, but only evaluated results. Forcing the tuple constructor will then force the components as well, as you expected.</p>\n\n<pre><code>import Data.Strict.Tuple\n\ntestSeq2 :: Int -&gt; Pair Int Int\ntestSeq2 n = impl n (0 :!: 0) where\nimpl 0 acc = acc\nimpl i acc = seq acc $ impl (i-1) ((fst acc + 1) :!: (snd acc + 1))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "edited": false, "score": 0, "creation_date": 1439678000, "post_id": 32029846, "comment_id": 51961551, "body": "Is this special treatment for tuple constructors, or are you saying that evaluation does not occur for arguments to any constructors? Suppose that I had created my own tuple data type instead of using the built-in tuples, would the result have been the same ?"}, {"owner": {"reputation": 10045, "user_id": 77542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2bb52913c4cebae8835bb50c03996d5?s=128&d=identicon&r=PG", "display_name": "Tordek", "link": "https://stackoverflow.com/users/77542/tordek"}, "reply_to_user": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "edited": false, "score": 0, "creation_date": 1439678683, "post_id": 32029846, "comment_id": 51961719, "body": "This is not special to tuples; this happens because Haskell is lazy, and only evaluates as much as necessary. You can test this by doing a similar example with <code>Just undefined</code> instead, or your own datatype."}, {"owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "edited": false, "score": 0, "creation_date": 1439679738, "post_id": 32029846, "comment_id": 51961939, "body": "This comes as a shock to me. I thought the whole point of seq was to be able to override the default &#39;laziness&#39; of Haskell and force it to fully evaluate an expression. This explains why my attempts to use foldl&#39; have not worked as I expected - I was using tuple constructors in my accumulator functions."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "edited": false, "score": 4, "creation_date": 1439683301, "post_id": 32029846, "comment_id": 51962631, "body": "@BillyBadBoy That is the whole point of seq, but lazy/strict is not an all or nothing proposition; data structures can have many fields and be deeply nested, and if you call a fully lazy function while implementing a function it may well make sense to eagerly evaluate parts but not all of such a structure. seq is basically the &quot;minimum unit&quot; of added strictness. There&#39;s also a deepseq which does fully evaluate things, but that comes at a cost (traversing the entire structure to check for thunks)."}], "tags": [], "owner": {"reputation": 10045, "user_id": 77542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2bb52913c4cebae8835bb50c03996d5?s=128&d=identicon&r=PG", "display_name": "Tordek", "link": "https://stackoverflow.com/users/77542/tordek"}, "is_accepted": true, "score": 5, "last_activity_date": 1439676294, "creation_date": 1439676294, "answer_id": 32029846, "question_id": 32029776, "link": "https://stackoverflow.com/questions/32029776/understanding-haskell-seq/32029846#32029846", "title": "Understanding Haskell seq", "body": "<p><code>seq</code> only forces the evaluation of its first argument shallowly. You can see these two examples:</p>\n\n<pre><code>errorTuple :: (Int, Int)\nerrorTuple = undefined\n\nerrorTupleContents :: (Int, Int)\nerrorTupleContents = (undefined, undefined)\n\ncase1 = errorTuple `seq` (1, 1)\ncase2 = errorTupleContents `seq` (1, 1)\n</code></pre>\n\n<p><code>case1</code> will fail with an <code>undefined</code> error, because <code>seq</code> tries to force the evaluation of <code>errorTuple</code>, which is <code>undefined</code>, however, <code>case2</code> will not, because the tuple constructor is evaluated and returns a tuple whose contents are unevaluated. If they were evaluated, they'd be <code>undefined</code>.</p>\n"}], "owner": {"reputation": 480, "user_id": 2681876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6ef986f3390388cf5c6b527b31cd5d?s=128&d=identicon&r=PG&f=1", "display_name": "BillyBadBoy", "link": "https://stackoverflow.com/users/2681876/billybadboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 1, "accepted_answer_id": 32029846, "answer_count": 2, "score": 4, "last_activity_date": 1439677257, "creation_date": 1439675780, "last_edit_date": 1439677257, "question_id": 32029776, "link": "https://stackoverflow.com/questions/32029776/understanding-haskell-seq", "title": "Understanding Haskell seq", "body": "<p>I'm a Haskell newbie having problems understanding <code>seq</code>, which I've summarized in the example below. </p>\n\n<p>Here are 2 implementations of the same (silly) function. The function takes a positive int n and returns the tuple <code>(n,n)</code>. The answer is produced by counting up from <code>(0,0)</code> using a helper function with a tuple accumulator. To avoid building up a large thunk I used seq to make the accumulator strict.</p>\n\n<p>In <code>testSeq1</code> the contents of the tuple are strict, whereas in <code>testSeq2</code> the tuple itself is strict. I thought these 2 implementations would perform identically. But actually the 'total memory in use' is only 1MB for <code>testSeq1</code> but a massive 187MB for <code>testSeq2</code> (when tested using n = 1000000).</p>\n\n<p>What's wrong with <code>testSeq2</code>? </p>\n\n<pre><code>testSeq1 :: Int -&gt; (Int,Int)\ntestSeq1 n = impl n (0,0) where\n    impl 0 (a,b) = (a,b)\n    impl i (a,b) = seq a $ seq b $ impl (i-1) (a+1, b+1)\n\ntestSeq2 :: Int -&gt; (Int,Int)\ntestSeq2 n = impl n (0,0) where\n    impl 0 acc = acc\n    impl i acc = seq acc $ impl (i-1) ((fst acc)+1, (snd acc)+1)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1439668165, "post_id": 32028644, "comment_id": 51958849, "body": "Have you looked at <a href=\"https://en.wikibooks.org/wiki/Haskell/GADT\" rel=\"nofollow noreferrer\">GADTs</a>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439672322, "post_id": 32028644, "comment_id": 51960097, "body": "Just want to point out that you can use a second data type with the &quot;same&quot; constructor names if you define it in a different module. Then you can use <code>import qualified ... as ...</code> if some code needs to deal with both types."}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 1, "creation_date": 1439673447, "post_id": 32028644, "comment_id": 51960422, "body": "Also take a look at <code>Data Types A La Carte</code> <a href=\"http://www.cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf\" rel=\"nofollow noreferrer\">cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf</a>"}], "answers": [{"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 2, "last_activity_date": 1439671439, "creation_date": 1439671439, "answer_id": 32029163, "question_id": 32028644, "link": "https://stackoverflow.com/questions/32028644/to-overload-a-data-type-or-to-use-a-similar-one/32029163#32029163", "title": "to overload a data type or to use a similar one?", "body": "<p>I'm not an expert but it's a problem I have also myself (even though it more with product type than sum type).</p>\n\n<p>The obvious solution is to reuse <code>RegexSimple</code> in <code>Regex</code> so that</p>\n\n<pre><code> data Regex a = Ref a | Literal a | SimpleR (SimpleRegex a)\n</code></pre>\n\n<p>another way is to parametrize Regex with a functor</p>\n\n<pre><code>data Regex f a = Literal (f a) | Ref (f a) | Epsilon a ...\n</code></pre>\n\n<p>and use either <code>Regex Id</code> or <code>Regex Void</code>.</p>\n\n<p>Another way is just to use <code>Maybe</code></p>\n\n<pre><code>data Regex a = Literal (Maybe a) | Epsilon a ...\n</code></pre>\n\n<p>But this it less clean because you can't enforce a function to only accept simple regex.</p>\n"}, {"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1439672347, "post_id": 32029201, "comment_id": 51960106, "body": "That&#39;s great. I&#39;ve never seen this technique before. Is there any resource about it ?"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1439673436, "post_id": 32029201, "comment_id": 51960418, "body": "Take a look at the links I included in my answer (<a href=\"https://en.wikibooks.org/wiki/Haskell/GADT\" rel=\"nofollow noreferrer\">this</a>)"}, {"owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "edited": false, "score": 0, "creation_date": 1439699734, "post_id": 32029201, "comment_id": 51965000, "body": "@Kwarrtz thanks this works although I had to change the types of my <code>Then</code>, <code>Or</code>, <code>Star</code>, <code>Epsilon</code> to the general case: <code>Regex t&#39; a -&gt; Regex t&#39; a -&gt; Regex t&#39; a</code>, etc. Because I need them in all sub-types."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1439700775, "post_id": 32029201, "comment_id": 51965140, "body": "Yes, I&#39;m sorry I forget to mention that."}], "tags": [], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "is_accepted": true, "score": 5, "last_activity_date": 1439671736, "creation_date": 1439671736, "answer_id": 32029201, "question_id": 32028644, "link": "https://stackoverflow.com/questions/32028644/to-overload-a-data-type-or-to-use-a-similar-one/32029201#32029201", "title": "to overload a data type or to use a similar one?", "body": "<p>I don't know what the rest of your code looks like, so this solution may require you to rethink certain aspects, but the most \"haskell-ish\" solution to this problem would probably be to use <a href=\"https://en.wikibooks.org/wiki/Haskell/GADT\">GADTs</a> and <a href=\"https://en.wikibooks.org/wiki/Haskell/Phantom_types\">phantom types</a>. Together, they basically allow you to create arbitrary subtypes for more flexible type safety. You would redefine your types like so.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata Literal\ndata Ref\ndata Rangeable\n\ndata Regex t a where\n         Epsilon :: Regex Rangeable a\n         Literal :: a -&gt; Regex Literal a\n         Ranges  :: [(a, a)] -&gt; Regex Rangeable a\n         Ref     :: String -&gt; Regex Ref a\n         Then    :: Regex t' a -&gt; Regex t' a -&gt; Regex Rangeable a\n         Or      :: Regex t' a -&gt; Regex t' a -&gt; Regex Rangeable a\n         Star    :: Regex t' a -&gt; Regex Rangeable\n</code></pre>\n\n<p>Then you can define</p>\n\n<pre><code>foo :: Regex Rangeable a\nfoo (Epsilon)  = ...\nfoo s@(Star a) = ...\n</code></pre>\n\n<p>Now, statements like <code>foo $ Literal 'c'</code> will fail compile-time type-checks.</p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 2, "accepted_answer_id": 32029201, "answer_count": 2, "score": 6, "last_activity_date": 1439671736, "creation_date": 1439667779, "question_id": 32028644, "link": "https://stackoverflow.com/questions/32028644/to-overload-a-data-type-or-to-use-a-similar-one", "title": "to overload a data type or to use a similar one?", "body": "<p>This is more of a question about a programming style and common practices. But I feel that it does not fit into the code review forum...</p>\n\n<p>My program parses regular expressions and processes them. A regular expression can have the usual elements (Kleene closure, concatenation, etc) and it also can have references to other regular expressions by their names, like macros:</p>\n\n<pre><code>data Regex a = Epsilon\n             | Literal a\n             | Ranges [(a, a)]\n             | Ref String\n             | Then (Regex a) (Regex a)\n             | Or (Regex a) (Regex a)\n             | Star (Regex a)\n</code></pre>\n\n<p>After I process a regular expression and resolve all macro references, and convert <code>Literal</code> elements to <code>Range</code> elements (this is needed for my purposes), I end up with a type that cannot and must not have <code>Ref</code> and <code>Literal</code>, so in my functions that work with it I do something like:</p>\n\n<pre><code>foo (Literal _) = error \"unexpected literal\"\nfoo (Ref _)     = error \"unexpected reference\"\nfoo (Epsilon)   = ...\nfoo (Star x)    = ...\n...\n</code></pre>\n\n<p>This looks ugly to me because it does runtime checks instead of checks during compilation. Not a very haskell kind of approach.</p>\n\n<p>So maybe I can introduce another data type which is very similar to the original one and use that?</p>\n\n<pre><code>data RegexSimple a = Epsilon2\n                   | Ranges2 [(a, a)]\n                   | Then2 (Regex a) (Regex a)\n                   | Or2 (Regex a) (Regex a)\n                   | Star2 (Regex a)\n</code></pre>\n\n<p>That would work, but here I have a lot of duplication and also the nice and descriptive names of constructors are taken now and I need to invent new ones...</p>\n\n<p>What would the experts do here? I want to learn : )</p>\n"}, {"tags": ["haskell", "automatic-differentiation"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1439662668, "post_id": 32027302, "comment_id": 51957163, "body": "What are <code>Reference</code> and <code>Plant</code>?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1439663406, "post_id": 32027302, "comment_id": 51957427, "body": "Related to <a href=\"http://stackoverflow.com/a/29393417/414413\">stackoverflow.com/a/29393417/414413</a>, both questions are about the type of the first argument to <code>gradientDescent</code>, with essentially the same answer but different errors prompting the question."}, {"owner": {"reputation": 2322, "user_id": 687749, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07bff365e74ca1c3db3a6dc19c8716d2?s=128&d=identicon&r=PG", "display_name": "bzn", "link": "https://stackoverflow.com/users/687749/bzn"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1439668335, "post_id": 32027302, "comment_id": 51958914, "body": "<code>Reference</code> and <code>Plant</code> are Functors. More specifically, <code>Reference</code> is a simple algebraic datatype and <code>Plant</code> is type alias for a <code>Wire</code> from the <code>netwire</code> library."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1442427971, "post_id": 32027302, "comment_id": 53082786, "body": "<code>optimize = gradientDescent</code> works because unapplied this can and will infer a rank-n type. When you expand it like that the rank-n type has to be specified as it is beyond what any type system can infer."}], "answers": [{"comments": [{"owner": {"reputation": 2322, "user_id": 687749, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07bff365e74ca1c3db3a6dc19c8716d2?s=128&d=identicon&r=PG", "display_name": "bzn", "link": "https://stackoverflow.com/users/687749/bzn"}, "edited": false, "score": 0, "creation_date": 1439715305, "post_id": 32027941, "comment_id": 51967836, "body": "Thanks, I got it to work now, though it is quite ugly. For some reason, <code>fmap</code>ing <code>auto</code> doesn&#39;t work and I have to use <code>realToFrac</code> instead. I also have to <code>fmap</code> twice over both arguments. Also <code>Plant a</code> being an alias for a <code>Wire s e m a a</code> from <code>netwire</code> complicates things. I&#39;ll test my solution now and post the answer, if it works."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1442428106, "post_id": 32027941, "comment_id": 53082851, "body": "If <code>Plant a</code> is an alias <code>Wire s e m a a</code> then <code>Plant</code> isn&#39;t a <code>Functor</code>.  What do you mean by having to <code>fmap</code> twice over both arguments?"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1439704891, "last_edit_date": 1439704891, "creation_date": 1439663340, "answer_id": 32027941, "question_id": 32027302, "link": "https://stackoverflow.com/questions/32027302/numeric-ad-type-variable-escaping-its-scope/32027941#32027941", "title": "Numeric.AD - type variable escaping its scope", "body": "<p><code>cost ref plant</code> has the type <code>[a] -&gt; a</code> where <code>a</code> is the same <code>a</code> as in the signature to <code>optimize</code></p>\n\n<pre><code>optimize :: (RealFloat a) =&gt; Reference a -&gt; Plant a -&gt; [a] -&gt; [[a]]\n                                       ^          ^\n                                       |          ------------\n                                       ------------------v   v\noptimize ref plant initialInputs = gradientDescent (cost ref plant) initialInputs\n                                                         ^   ^\n                                   -----------------------   |\n                                   v          v---------------\ncost :: (RealFloat a) =&gt; Reference a -&gt; Plant a -&gt; [a] -&gt; a\ncost = ...\n</code></pre>\n\n<p>But the type of <a href=\"http://hackage.haskell.org/package/ad-4.2.4/docs/Numeric-AD.html#v:gradientDescent\" rel=\"nofollow\"><code>gradientDescent</code></a> is </p>\n\n<pre><code>gradientDescent :: (Traversable f, Fractional a, Ord a) =&gt;\n                   (forall s. Reifies s Tape =&gt; f (Reverse s a) -&gt; Reverse s a) -&gt; \n                   f a -&gt; [f a]\n</code></pre>\n\n<p>The first argument to <code>gradientDescent</code> needs to be able to take (for <em>any</em> <code>s</code>) <code>[Reverse s a]</code> and return a <code>Reverse s a</code>, but <code>cost ref plant</code> can only take <code>[a]</code> an return an <code>a</code>.</p>\n\n<p>Since <code>Reference</code> and <code>Plant</code> are both <code>Functor</code>s, you can convert <code>ref</code> and <code>plant</code> from <code>Reference a</code> and <code>Plant a</code> to <code>Reference (Reverse s a)</code> and <code>Plant (Reverse s a)</code> by <code>fmap</code>ing <a href=\"http://hackage.haskell.org/package/ad-4.2.4/docs/Numeric-AD.html#v:auto\" rel=\"nofollow\"><code>auto</code></a>.</p>\n\n<pre><code>optimize :: (RealFloat a) =&gt; Reference a -&gt; Plant a -&gt; [a] -&gt; [[a]]\noptimize ref plant initialInputs = gradientDescent (cost (fmap auto ref) (fmap auto plant)) initialInputs\n</code></pre>\n"}], "owner": {"reputation": 2322, "user_id": 687749, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07bff365e74ca1c3db3a6dc19c8716d2?s=128&d=identicon&r=PG", "display_name": "bzn", "link": "https://stackoverflow.com/users/687749/bzn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 32027941, "answer_count": 1, "score": 3, "last_activity_date": 1439704891, "creation_date": 1439659416, "last_edit_date": 1439668210, "question_id": 32027302, "link": "https://stackoverflow.com/questions/32027302/numeric-ad-type-variable-escaping-its-scope", "title": "Numeric.AD - type variable escaping its scope", "body": "<p>I'm trying to use <a href=\"http://hackage.haskell.org/package/ad-4.2.4/docs/Numeric-AD.html\" rel=\"nofollow\">automatic differentiation</a> in Haskell for a nonlinear control problem, but have some problems getting it to work. I basically have a <code>cost</code> function, which should be optimized given an initial state. The types are:</p>\n\n<pre><code>data Reference a = Reference a deriving Functor\ndata Plant a = Plant a deriving Functor\n\noptimize :: (RealFloat a) =&gt; Reference a -&gt; Plant a -&gt; [a] -&gt; [[a]]\noptimize ref plant initialInputs = gradientDescent (cost ref plant) initialInputs\n\ncost :: (RealFloat a) =&gt; Reference a -&gt; Plant a -&gt; [a] -&gt; a\ncost = ...\n</code></pre>\n\n<p>This results in the following error message:</p>\n\n<pre><code>Couldn't match expected type `Reference\n                                (Numeric.AD.Internal.Reverse.Reverse s a)'\n            with actual type `t'\n  because type variable `s' would escape its scope\nThis (rigid, skolem) type variable is bound by\n  a type expected by the context:\n    Data.Reflection.Reifies s Numeric.AD.Internal.Reverse.Tape =&gt;\n    [Numeric.AD.Internal.Reverse.Reverse s a]\n    -&gt; Numeric.AD.Internal.Reverse.Reverse s a\n  at test.hs:13:5-50\nRelevant bindings include\n  initialInputs :: [a] (bound at test.hs:12:20)\n  ref :: t (bound at test.hs:12:10)\n  optimize :: t -&gt; t1 -&gt; [a] -&gt; [[a]] (bound at test.hs:12:1)\nIn the first argument of `cost', namely `ref'\nIn the first argument of `gradientDescent', namely\n  `(cost ref plant)'\n</code></pre>\n\n<p>I'm not even sure if I understand the error correctly. Is it, that the types of <code>ref</code> and <code>plant</code> need access to the <code>s</code>, which is inside the scope of the first argument to <code>gradientDescent</code>?</p>\n\n<p>Is it possible to make this work? While looking for a solution, I tried reducing the problem to a minimal example and found that the following definition produces a similar error message:</p>\n\n<pre><code>optimize f inputs = gradientDescent f inputs \n</code></pre>\n\n<p>This seems odd, because <code>optimize = gradientDescent</code> doesn't produce any error.</p>\n"}, {"tags": ["haskell", "inline", "ghc", "dynamic-linking"], "answers": [{"comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1439669456, "post_id": 32028400, "comment_id": 51959268, "body": "Do you have anything to back that up? I mean, I&#39;m aware of interface files but I don&#39;t know whether GHC will use them for a shared library. And how would it be? do I supply the shared library path + path for the interface files to the compilation arguments for the executable? I haven&#39;t been able to find much information about this whole thing; it&#39;s very vague for me at the moment. Thank you for your answer."}, {"owner": {"reputation": 570, "user_id": 650044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99b1857b84299c614042635fc2f9576a?s=128&d=identicon&r=PG", "display_name": "liyang", "link": "https://stackoverflow.com/users/650044/liyang"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1439691309, "post_id": 32028400, "comment_id": 51963768, "body": "That was off the top of my head, but you can read about it on the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/IfaceFiles\" rel=\"nofollow noreferrer\">GHC wiki</a>. GHC wouldn&#39;t be able to typecheck anything (and more besides) <i>without</i> the interface files.  You could read up on how to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-shared-libs.html\" rel=\"nofollow noreferrer\">build shared objects</a>, but I&#39;d just let <code>cabal</code> <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html\" rel=\"nofollow noreferrer\">deal with it</a>. (Search for <code>shared</code>.)  You&#39;ve not mentioned why you wanted to use shared libs. So why?"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1439793103, "post_id": 32028400, "comment_id": 51987972, "body": "Oh! your typecheck remark made a lot of sense suddenly for all of it; very clever of you. Then I suppose I can really trust it would inline, given that it must have the information it needs to do so. I don&#39;t want to use shared libs for anything specific at the moment, I just didn&#39;t want to rule them out from my arsenal for when performance matters (e.g. even a simple loop repeating a small function from a shared library could severely bite me if inlining wasn&#39;t there). Thank you very much!"}, {"owner": {"reputation": 570, "user_id": 650044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99b1857b84299c614042635fc2f9576a?s=128&d=identicon&r=PG", "display_name": "liyang", "link": "https://stackoverflow.com/users/650044/liyang"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1441023790, "post_id": 32028400, "comment_id": 52497302, "body": "Some libraries (I&#39;m thinking of <code>vector</code> in particular) depend heavily on inlining and GHC rewrite <code>RULES</code> (also in the <code>.hi</code>) to achieve its claimed fusion/deforestation/performance characteristics. I&#39;d consider it a bug in GHC&#39;s implementation of shared libraries had it a significant negative impact."}], "tags": [], "owner": {"reputation": 570, "user_id": 650044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99b1857b84299c614042635fc2f9576a?s=128&d=identicon&r=PG", "display_name": "liyang", "link": "https://stackoverflow.com/users/650044/liyang"}, "is_accepted": true, "score": 3, "last_activity_date": 1439666231, "creation_date": 1439666231, "answer_id": 32028400, "question_id": 32026739, "link": "https://stackoverflow.com/questions/32026739/could-dynamic-linking-hurt-inlining-thus-performance-in-ghc/32028400#32028400", "title": "Could dynamic linking hurt inlining thus performance in GHC?", "body": "<p>When a function is marked as either <code>{-# INLINE #-}</code> or <code>{-# INLINEABLE #-}</code>\u2014or if GHC considers it Cheap Enough\u2122\u2014the entire unmangled RHS is included in the interface <code>.hi</code> file alongside the compiled <code>.o</code> object. As far as I'm aware.</p>\n\n<p>So no, I'm pretty sure it wouldn't hurt inlining. Dynamic linking would affect code locality though, but that's micro\u00f6ptimisation compared to the inlining aspect you're concerned about.</p>\n\n<p>Caveat: I have not actually benchmarked anything.</p>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 32028400, "answer_count": 1, "score": 3, "last_activity_date": 1439666231, "creation_date": 1439655743, "question_id": 32026739, "link": "https://stackoverflow.com/questions/32026739/could-dynamic-linking-hurt-inlining-thus-performance-in-ghc", "title": "Could dynamic linking hurt inlining thus performance in GHC?", "body": "<p>It's no secret that inlining is what's enabling a lot of the sophisticated optimizations GHC can carry out. If I link a library dynamically (and get an actual dll/so file out of it), could GHC still inline where it would have, as if the link was static, and depend on the dll for the rest? or do I actually get less optimizations?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1439653259, "post_id": 32026260, "comment_id": 51954277, "body": "well yes you can do this - or you can but those into different modules and qualify the names through it"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 3, "creation_date": 1439653446, "post_id": 32026260, "comment_id": 51954320, "body": "There are three basic options. (1) make type-specific names, such as your <code>boardWidth</code> and <code>playerWidth</code> suggestion. (2) Put each data type definition into its own separate module, so that when it is imported, it will be accessed as you describe (e.g. <code>Board.width</code>), or (3) create a type class like <code>HasWidth</code> that requires a type to implement a <code>width</code> function to belong to the type class, then make each of <code>Board</code> and <code>Player</code> an instance of the <code>HasWidth</code> type class with appropriate implementations -- behind the scenes Haskell will dispatch a call to the generic <code>width</code> for the right types."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1439653590, "post_id": 32026260, "comment_id": 51954358, "body": "I know it&#39;s probably not a xy problem but in your case shouldn&#39;t you embbed a board in a player ?"}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1439653552, "post_id": 32026377, "comment_id": 51954345, "body": "<code>lens</code> is also a good solution, as it allows to generate lenses working for different types using either <code>makeFieilds</code> or <code>makeClassy</code> (I personally like <code>makeClassy</code> lots."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1439653674, "post_id": 32026377, "comment_id": 51954387, "body": "@mb14 Vinyl provides lenses for its record fields, so I wouldn&#39;t necessarily view them as separate things. Lens makes working with vinyl a lot easier."}, {"owner": {"reputation": 2017, "user_id": 4106994, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Y8lC.jpg?s=128&g=1", "display_name": "Afonso Matos", "link": "https://stackoverflow.com/users/4106994/afonso-matos"}, "edited": false, "score": 0, "creation_date": 1439811224, "post_id": 32026377, "comment_id": 51998026, "body": "I find this too overkill. Prefixing or creating modules seems the best approach so far."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 2017, "user_id": 4106994, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Y8lC.jpg?s=128&g=1", "display_name": "Afonso Matos", "link": "https://stackoverflow.com/users/4106994/afonso-matos"}, "edited": false, "score": 0, "creation_date": 1439813890, "post_id": 32026377, "comment_id": 51999741, "body": "@catgocat whether or not it&#39;s overkill really depends on what you want to do with it in the end"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 1, "last_activity_date": 1439653438, "creation_date": 1439653438, "answer_id": 32026377, "question_id": 32026260, "link": "https://stackoverflow.com/questions/32026260/data-types-with-same-field-names/32026377#32026377", "title": "Data types with same field names", "body": "<p>Giving the fields unique prefixes is a valid approach. This is a known somewhat-problem in Haskell, and there are several ways to work around that. </p>\n\n<p>One of the most sophisticated solutions is <a href=\"https://hackage.haskell.org/package/vinyl\" rel=\"nofollow\">vinyl</a>, which basically implements a new record system (or several, depending how you look at it) - allowing you to share fields between records, and even provides a notion of 'subtyping'. Depending on how familiar with Haskell you are, it might no necessarily be easy to use though. You should definitely check it out though.</p>\n"}], "owner": {"reputation": 2017, "user_id": 4106994, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6Y8lC.jpg?s=128&g=1", "display_name": "Afonso Matos", "link": "https://stackoverflow.com/users/4106994/afonso-matos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "accepted_answer_id": 32026377, "answer_count": 1, "score": 2, "last_activity_date": 1439653438, "creation_date": 1439652769, "question_id": 32026260, "link": "https://stackoverflow.com/questions/32026260/data-types-with-same-field-names", "title": "Data types with same field names", "body": "<p>I am having trouble making bigger programs in Haskell and one problem is the ambiguous error that occurs when I define data types with the same or matching field names.</p>\n\n<pre><code>data Board  = Board  { width :: Int, height :: Int }\ndata Player = Player { strength :: Int, width :: Int, height :: Int }\n</code></pre>\n\n<p>I am comfortable with writing small programs but when I find this issue, I run away and desperate.</p>\n\n<p>In other languages I could just do:</p>\n\n<pre><code>board.width  = 100;\nboard.height = 100;\n\nplayer.width = 5;\nplayer.height = 2;\n</code></pre>\n\n<p>I find that I could prefix each field name with the type name (i.e boardWith, playerWidth) but is this the best approach and good practice? What should I do?</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1439648982, "post_id": 32025213, "comment_id": 51953078, "body": "Please add your imports..."}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1439651679, "post_id": 32025213, "comment_id": 51953816, "body": "I added the import file"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1439651735, "post_id": 32025213, "comment_id": 51953828, "body": "I meant: add the <code>import ...</code> lines in your Haskell source file. As is, your code snippet is not self-contained."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1439649858, "post_id": 32025518, "comment_id": 51953311, "body": "<i>[...] don&#39;t use parsec [...]</i> I respectfully disagree. The parser needed here isn&#39;t much different from that in <a href=\"http://book.realworldhaskell.org/read/using-parsec.html\" rel=\"nofollow noreferrer\">Chapter 16 of <i>Real World Haskell</i></a>, which <code>parsec</code> handles very well."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1439651083, "post_id": 32025518, "comment_id": 51953634, "body": "There is a small difference, which is all the lines are similar in the RHW example which makes it easy to parse using parsec. The problem here is to parse the empty lines but not skip them. I add similar problems in the past and end-up ditching parsec. However I might be wrong and maybe the OP problem is simpler than mine and is easy to solve. Or maybe my problem was easier than I though. I&#39;m curious to see working solution for the OP problem. I&#39;ll probably be able to translate it to mines."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439653919, "post_id": 32025518, "comment_id": 51954443, "body": "I think the real problem with using parsec is that it has to read the entire file in order for the parse to be successful - i.e. you can&#39;t process elements as they are identified."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439655753, "post_id": 32025518, "comment_id": 51955017, "body": "@user5402 attoparsec supports incremental parsing, though."}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 0, "last_activity_date": 1439647500, "creation_date": 1439647500, "answer_id": 32025518, "question_id": 32025213, "link": "https://stackoverflow.com/questions/32025213/parse-array-of-numbers-between-emptylines/32025518#32025518", "title": "Parse array of numbers between emptylines", "body": "<p>I don't know the exact problem but my experience with parsing \"line oriented\" file with parsec is  : don't use parsec ( or at least not this way).</p>\n\n<p>I mean the problem is you want somehow to strip the blanks (spaces and newline) between numbers (on the same line) but still being aware of them when needed.\nIt's really hard to do in one step (which is what you are trying to do).\nIt's probably doable adding lookahead but it's really messy (and to be honest I never managed to make it work).</p>\n\n<p>The easiest way is to parse lines on the first step (which allow you to detect empty lines) and then parse each line separately.</p>\n\n<p>To do that, you don't need parsec at all and can do it just using <code>lines</code> and <code>words</code>. However, doing this, you are losing the ability to backtrack.</p>\n\n<p>There is probably a way to \"mulitple steps\" parsing using parsec and it's tokenizer (but I haven't find any useful doc about how to use parsec tokenizer).</p>\n"}, {"tags": [], "owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "is_accepted": false, "score": 2, "last_activity_date": 1439651808, "creation_date": 1439651808, "answer_id": 32026109, "question_id": 32025213, "link": "https://stackoverflow.com/questions/32025213/parse-array-of-numbers-between-emptylines/32026109#32026109", "title": "Parse array of numbers between emptylines", "body": "<p>The <code>spaces</code> in <code>emptyLine</code> is consuming the <code>'\\n'</code>, and then <code>newline</code> has no <code>'\\n'</code> to parse. You can write it as:</p>\n\n<pre><code>emptyLine = do\n  skipMany $ satisfy (\\c -&gt; isSpace c &amp;&amp; c /= '\\n')\n  newline\n</code></pre>\n\n<p>And you should change <code>parseListing</code> to:</p>\n\n<pre><code>parseListing = do \n    cont &lt;- parseSeries `sepEndBy` emptyLines\n    eof\n    return cont\n</code></pre>\n\n<p>I think <code>sepEndBy</code> is better than <code>sepBy</code>, because it will skip any new lines that you may have at the end of the file.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1439652153, "creation_date": 1439652153, "answer_id": 32026166, "question_id": 32025213, "link": "https://stackoverflow.com/questions/32025213/parse-array-of-numbers-between-emptylines/32026166#32026166", "title": "Parse array of numbers between emptylines", "body": "<p>A couple of things:</p>\n\n<p><code>spaces</code> includes new lines, and so <code>spaces &gt;&gt; newline</code> always fails which implies that the <code>emptyLine</code> parser will always fail.</p>\n\n<p>I've had luck with these definitions of <code>parseSeries</code> and <code>parseListing</code>:</p>\n\n<pre><code>parseSeries = do\n  s &lt;- many1 dataline\n  spaces                  -- eat trailing whitespace\n  return s\n\nparseListing = do\n  spaces                  -- ignore leading whitespace\n  ss &lt;- many parseSeries  -- begin parseSeries at non-whitespace\n  eof\n  return ss\n</code></pre>\n\n<p>The idea is that a parser always eats the whitespace following it.\nThis approach also handles empty files.</p>\n"}, {"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 1, "last_activity_date": 1439657530, "last_edit_date": 1439657530, "creation_date": 1439654791, "answer_id": 32026581, "question_id": 32025213, "link": "https://stackoverflow.com/questions/32025213/parse-array-of-numbers-between-emptylines/32026581#32026581", "title": "Parse array of numbers between emptylines", "body": "<blockquote>\n  <p><strong>Do you have any idea of what's wrong with my parser ?</strong></p>\n</blockquote>\n\n<p>A few things:</p>\n\n<ol>\n<li><p>As other answerers have already pointed out, the <code>spaces</code> parser is designed to consume a sequence of characters that satisfy <code>Data.Char.isSpace</code>; the newline (<code>'\\n'</code>) is such a character. Therefore, your <code>emptyLine</code> parser always fails, because <code>newline</code> expects a newline character that has already been consumed.</p></li>\n<li><p>You probably shouldn't use the <code>newline</code> parser in your \"line\" parsers anyway, because those parsers will fail on the last line of the file if the latter doesn't end with a newline.</p></li>\n<li><p>Why not use parsec 3 (<code>Text.Parsec.*</code>) rather than parsec 2 (<code>Text.ParserCombinators.*</code>)?</p></li>\n<li><p>Why not parse the numbers as <code>Integer</code>s or <code>Int</code>s as you go, rather than keep them as <code>String</code>s?</p></li>\n<li><p>Personal preference, but you rely too much on the <code>do</code> notation for my taste, to the detriment of readability. For instance,</p>\n\n<pre><code>data1 = do\n  dat &lt;- many1 digit\n  return (dat)\n</code></pre>\n\n<p>can be simplified to</p>\n\n<pre><code>data1 = many1 digit\n</code></pre></li>\n<li><p>You would do well to add a type signature to all your top-level bindings.</p></li>\n<li><p>Be consistent in how you name your parsers: why \"parseListing\" instead of simply \"listing\"?</p></li>\n<li><p>Have you considered using a different type of input stream (e.g. <code>Text</code>) for better performance? </p></li>\n</ol>\n\n<blockquote>\n  <p><strong>Do you have an example on how to parse a structured bunch of data separated by empty lines ?</strong></p>\n</blockquote>\n\n<p>Below is a much simplified version of the kind of parser you want. Note that the input is not supposed to begin with (but may end with) empty lines, and \"data lines\" are not supposed to contain leading <em>spaces</em>, but may contain trailing <em>spaces</em> (in the sense of the <code>spaces</code> parser).</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\nimport Data.Char ( isSpace )\nimport Text.Parsec\nimport Text.Parsec.String ( Parser )\n\neolChar :: Char\neolChar = '\\n'\n\neol :: Parser Char\neol = char eolChar\n\nwhitespace :: Parser String\nwhitespace = many $ satisfy $ \\c -&gt; isSpace c &amp;&amp; c /= eolChar\n\nemptyLine :: Parser String\nemptyLine = whitespace\n\nemptyLines :: Parser [String]\nemptyLines = sepEndBy1 emptyLine eol\n\ncell :: Parser Integer\ncell = read &lt;$&gt; many1 digit\n\ndataLine :: Parser [Integer]\ndataLine = sepEndBy1 cell whitespace\n--             ^\n-- replace by endBy1 if no trailing whitespace is allowed in a \"data line\"\n\ndataLines :: Parser [[Integer]]\ndataLines = sepEndBy1 dataLine eol\n\nlisting :: Parser [[[Integer]]]\nlisting = sepEndBy dataLines emptyLines\n\nmain :: IO ()\nmain = do\n    fichier &lt;- readFile (\"test_listtst.txt\")\n    case parse listing \"(test)\" fichier of\n        Left error  -&gt; putStrLn \"!!! Error !!!\"\n        Right serie -&gt; mapM_ print serie\n</code></pre>\n\n<p>Test:</p>\n\n<pre><code>\u03bb&gt; main\n[[1,235,623,684],[2,871,699,557],[3,918,686,49],[4,53,564,906]]\n[[1,154],[2,321],[3,519]]\n[[1,235,623,684],[2,871,699,557],[3,918,686,49]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1439654947, "creation_date": 1439654947, "answer_id": 32026604, "question_id": 32025213, "link": "https://stackoverflow.com/questions/32025213/parse-array-of-numbers-between-emptylines/32026604#32026604", "title": "Parse array of numbers between emptylines", "body": "<p>Here is another approach which allows you to stream in the data and process each block as it is identified:</p>\n\n<pre><code>import Data.Char\nimport Control.Monad\n\n-- toBlocks - convert a list of lines into a list of blocks\ntoBlocks :: [String] -&gt; [[[String]]]\ntoBlocks []  = []\ntoBlocks theLines =\n  let (block,rest) = break isBlank theLines\n      next = dropWhile isBlank rest\n  in  if null block\n        then toBlocks next\n        else [ words x | x &lt;- block ] : toBlocks next\n  where isBlank str = all isSpace str\n\nmain' path = do\n  content &lt;- readFile path\n  forM_ (toBlocks (lines content)) $ print\n</code></pre>\n\n<p>Parsec has to read in the entire file before it gives you the list of blocks which might be a problem if your input file is large.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 32026581, "answer_count": 5, "score": 3, "last_activity_date": 1439657530, "creation_date": 1439645394, "last_edit_date": 1439653768, "question_id": 32025213, "link": "https://stackoverflow.com/questions/32025213/parse-array-of-numbers-between-emptylines", "title": "Parse array of numbers between emptylines", "body": "<p>I'm trying to make a parser to scan arrays of numbers separated by empty lines in a text file.</p>\n\n<pre><code>1   235 623 684\n2   871 699 557\n3   918 686 49\n4   53  564 906\n\n\n1   154\n2   321\n3   519\n\n1   235 623 684\n2   871 699 557\n3   918 686 49\n</code></pre>\n\n<p>Here is the full <a href=\"http://www.2shared.com/document/3Kv2TlV6/test_listtst.html\" rel=\"nofollow\">text file</a></p>\n\n<p>I wrote the following parser with <code>parsec</code> : </p>\n\n<pre><code>import Text.ParserCombinators.Parsec\n\nemptyLine = do\n  spaces\n  newline\n\nemptyLines = many1 emptyLine\n\ndata1 = do\n  dat &lt;- many1 digit\n  return (dat)\n\ndatan = do\n  many1 (oneOf \" \\t\")\n  dat &lt;- many1 digit\n  return (dat)\n\ndataline  = do\n  dat1 &lt;- data1\n  dat2 &lt;- many datan\n  many (oneOf \" \\t\")\n  newline\n  return (dat1:dat2)\n\nparseSeries = do \n    dat &lt;- many1 dataline  \n    return dat\n\nparseParag =  try parseSeries\n\nparseListing = do \n    --cont &lt;- parseSeries `sepBy` emptyLines\n    cont &lt;- between emptyLines emptyLines parseSeries\n    eof\n    return cont\n\nmain = do\n    fichier &lt;- readFile (\"test_listtst.txt\")\n    case parse parseListing \"(test)\" fichier of\n            Left error -&gt; do putStrLn \"!!! Error !!!\"\n                             print error\n            Right serie -&gt; do  \n                                mapM_ print serie\n</code></pre>\n\n<p>but it fails with the following error : </p>\n\n<pre><code>!!! Error !!!\n\"(test)\" (line 6, column 1):\nunexpected \"1\"\nexpecting space or new-line\n</code></pre>\n\n<p>and I don't understand why.</p>\n\n<p><strong>Do you have any idea of what's wrong with my parser ?</strong></p>\n\n<p><strong>Do you have an example on how to parse a structured bunch of data separated by empty lines ?</strong></p>\n"}, {"tags": ["unit-testing", "haskell", "testing"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 5, "creation_date": 1439635376, "post_id": 32023805, "comment_id": 51949333, "body": "Check out the Python-inspired <a href=\"http://hackage.haskell.org/package/doctest\" rel=\"nofollow noreferrer\">doctest</a> library. <a href=\"https://github.com/sol/doctest#readme\" rel=\"nofollow noreferrer\">Here</a>&#39;s the documentation. <a href=\"https://github.com/danidiaz/process-streaming\" rel=\"nofollow noreferrer\">Here</a> is a example of a project that uses it."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1439637038, "post_id": 32023805, "comment_id": 51949699, "body": "I really like that idea danidiaz. Thanks. I&#39;ll give it a go."}], "answers": [{"tags": [], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "is_accepted": false, "score": 0, "last_activity_date": 1439675647, "last_edit_date": 1439675647, "creation_date": 1439652802, "answer_id": 32026270, "question_id": 32023805, "link": "https://stackoverflow.com/questions/32023805/inline-testcases-in-haskell/32026270#32026270", "title": "Inline testcases in Haskell", "body": "<p>(QuickCheck) test cases need to be generated at runtime, that's why each test suite has its own executable. I think you're correct that it would aid documentation, but it's <em>runnable</em> code - that's why we wouldn't want it polluting our library.</p>\n\n<p>To be honest, the type system suits as a decent inline \"test framework\" - by constructively proving your code to be correct with the type system, you're going even further than test cases.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 650044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99b1857b84299c614042635fc2f9576a?s=128&d=identicon&r=PG", "display_name": "liyang", "link": "https://stackoverflow.com/users/650044/liyang"}, "is_accepted": true, "score": 1, "last_activity_date": 1439667301, "last_edit_date": 1495540680, "creation_date": 1439667301, "answer_id": 32028555, "question_id": 32023805, "link": "https://stackoverflow.com/questions/32023805/inline-testcases-in-haskell/32028555#32028555", "title": "Inline testcases in Haskell", "body": "<p>I second <a href=\"https://stackoverflow.com/users/1364288/danidiaz\">danidiaz</a>'s <a href=\"https://stackoverflow.com/questions/32023805/inline-testcases-in-haskell/32028555#comment51949333_32023805\">suggestion</a> of <a href=\"http://hackage.haskell.org/package/doctest\" rel=\"nofollow noreferrer\"><code>doctest</code></a>. I've (seen it) used in <a href=\"https://github.com/ekmett/lens/blob/master/src/Control/Lens/Lens.hs#L157\" rel=\"nofollow noreferrer\"><code>lens</code></a> and it works very well IMO\u2014tests are just Haddock comments, so aren't even compiled unless you're running the doctest.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "accepted_answer_id": 32028555, "answer_count": 2, "score": 2, "last_activity_date": 1439675647, "creation_date": 1439634397, "question_id": 32023805, "link": "https://stackoverflow.com/questions/32023805/inline-testcases-in-haskell", "title": "Inline testcases in Haskell", "body": "<p>I'm developing a library in Haskell, which I hope to document in a Haddock compatible way and upload to Hackage at one point. I've read about testing using Cabal's frameworks, and also HUnit and Quickcheck, but it seems in all the tutorials I've read one makes a separate directory and puts the test cases in a separate file, importing the original file.</p>\n\n<p>I understand this might be appropriate sometimes, but I also think for just short tests it's simpler to put them in the same file as the implementation. Indeed, the documentation goes with the implementation, so why not the tests?</p>\n\n<p>Could someone point me to the best way to achieve this, ideally in a way that:</p>\n\n<ol>\n<li>Doesn't mess up the Haddock generation AND</li>\n<li>Doesn't bloat the library (i.e. when it's build in release mode the tests are ignored). </li>\n</ol>\n\n<p>I know this is a bit of a vague question, even some links to some tutorials and/or code that does test cases like this would be appreciated.</p>\n"}, {"tags": ["list", "haskell", "monads"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1439623387, "post_id": 32022475, "comment_id": 51946891, "body": "can you give an example for your <code>f</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 817, "user_id": 1077657, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/77827a893cf80112cc4157d96d81f5e0?s=128&d=identicon&r=PG", "display_name": "BenJacob", "link": "https://stackoverflow.com/users/1077657/benjacob"}, "edited": false, "score": 0, "creation_date": 1439626197, "post_id": 32022560, "comment_id": 51947400, "body": "This helps a lot, I have added more detail to my question because I think it complicates the problem a bit."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 817, "user_id": 1077657, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/77827a893cf80112cc4157d96d81f5e0?s=128&d=identicon&r=PG", "display_name": "BenJacob", "link": "https://stackoverflow.com/users/1077657/benjacob"}, "edited": false, "score": 0, "creation_date": 1439627793, "post_id": 32022560, "comment_id": 51947708, "body": "oh ok - you are not talking about using the list-monad after all - I think what you are searching for is as simple as <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:mapM\" rel=\"nofollow noreferrer\"><code>mapM</code></a>?"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1439628235, "last_edit_date": 1439628235, "creation_date": 1439623976, "answer_id": 32022560, "question_id": 32022475, "link": "https://stackoverflow.com/questions/32022475/generating-lists-in-a-monadic-context/32022560#32022560", "title": "Generating lists in a monadic context", "body": "<h3>update</h3>\n\n<p>for your edit with the MonadRandom I think all you need is <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:mapM\" rel=\"nofollow\"><code>mapM</code></a>:</p>\n\n<pre><code>import System.Random (randomRIO)\n\nf :: Int -&gt; IO Int\nf n = randomRIO (n,n+n)\n\ng :: [Int] -&gt; IO [Int]\ng xs = mapM f xs\n</code></pre>\n\n<p>example</p>\n\n<pre><code>\u03bb&gt; g [1..3]\n[1,4,5]\n\u03bb&gt; g [1..3]\n[1,3,4]\n\u03bb&gt; g [1..3]\n[1,4,6]\n</code></pre>\n\n<p>btw: of course you can do this yourself using <code>do</code>:</p>\n\n<pre><code>g :: [Int] -&gt; IO [Int]\ng [] = return []\ng (x:xs) = do\n  r &lt;- f x\n  rs &lt;- g xs\n  return (r:rs)\n</code></pre>\n\n<p>just remember not to mix up the list and the <code>IO</code> monad here - so the <code>do</code>, <code>&lt;-</code> and <code>return</code> here is in <code>IO</code> - for the rest of this answer it will be in the list-monad</p>\n\n<hr>\n\n<p>First your example (if <code>f :: a -&gt; [b]</code>) will create a <em>list of list of values</em> (which you surely found out already) - if you want to <em>flatten</em> it look below (basically you just have to pull out once more)</p>\n\n<hr>\n\n<p>Right now I don't understand exactly where you are going for, but here is a short example of how you can use the <code>do</code> notation with lists:</p>\n\n<p>Look at this function:</p>\n\n<pre><code>combs :: [a] -&gt; [b] -&gt; [(a,b)]\ncombs xs ys = do\n  x &lt;- xs\n  y &lt;- ys\n  return (x,y)\n</code></pre>\n\n<p>here is an example of it in action:</p>\n\n<pre><code>\u03bb&gt; combs [1..3] \"Hi\"\n[(1,'H'),(1,'i'),(2,'H'),(2,'i'),(3,'H'),(3,'i')]\n</code></pre>\n\n<p>As you can see the <em>trick</em> is to draw an <em>example</em> <code>x</code> out of all <code>xs</code> (of course you will do all - therefore you can think of this as working with combinatorics) and a <code>y</code> out of <code>ys</code> and then do something with them (here just make a tuple) and finally <code>return</code>ing it.</p>\n\n<p>Now of course you can first map it somehow (here just doubling the <code>xs</code>):</p>\n\n<pre><code>combs :: [a] -&gt; [b] -&gt; [(a,b)]\ncombs xs ys = do\n  x &lt;- xs ++ xs\n  y &lt;- ys\n  return (x,y)\n</code></pre>\n\n<p>and it will pull out of the mapped values:</p>\n\n<pre><code>\u03bb&gt; combs [1..3] \"Hi\"\n[(1,'H'),(1,'i'),(2,'H'),(2,'i'),(3,'H'),(3,'i'),(1,'H'),(1,'i'),(2,'H'),(2,'i'),(3,'H'),(3,'i')]\n</code></pre>\n\n<p>does this help you?</p>\n\n<hr>\n\n<p>here is another one where <code>f</code> creates a list itself:</p>\n\n<pre><code>func :: (a -&gt; [b]) -&gt; [a] -&gt; [b]\nfunc f xs = do\n  x &lt;- xs\n  b &lt;- f x\n  return b\n</code></pre>\n\n<p>as you can see first we pull out an <code>x</code> from <code>xs</code>, apply <code>f</code> to get a lists of <code>b</code>s only to pull them out with <code>b &lt;- f x</code> and then just returning those.</p>\n\n<p>Which is of course just <code>concatMap</code></p>\n\n<h3>Example</h3>\n\n<pre><code>\u03bb&gt; func (\\x -&gt; [x,x]) [1..5]\n[1,1,2,2,3,3,4,4,5,5]\n</code></pre>\n\n<p>is this where you are going for?</p>\n"}], "owner": {"reputation": 817, "user_id": 1077657, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/77827a893cf80112cc4157d96d81f5e0?s=128&d=identicon&r=PG", "display_name": "BenJacob", "link": "https://stackoverflow.com/users/1077657/benjacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 32022560, "answer_count": 1, "score": 1, "last_activity_date": 1439628235, "creation_date": 1439623026, "last_edit_date": 1439626126, "question_id": 32022475, "link": "https://stackoverflow.com/questions/32022475/generating-lists-in-a-monadic-context", "title": "Generating lists in a monadic context", "body": "<p>As I understand, you can use the 'draw from' <code>(&lt;-)</code> keyword in haskell to take values out of a monadic context in do-notation:</p>\n\n<pre><code>func = do\n    x &lt;- getRandom\n    let y = (x + 1)\n    return y\n</code></pre>\n\n<p>How would I apply this when generating lists? Say I am mapping a function <code>f :: (MonadRandom m) =&gt; Int -&gt; m a</code> that takes an integer and returns a value in a <code>MonadRandom</code> context. I want to generate a list of values of type <code>a</code> inside a <code>MonadRandom</code> context i.e <code>m [a]</code> . I believe doing something like this:</p>\n\n<pre><code>func = do\n    xs &lt;- map f [0..10]\n    return xs\n</code></pre>\n\n<p>would generate a list of values, each in a monadic context and then try to draw from the list which is not in the <code>MonadRandom</code> context</p>\n\n<p>Apologies if my terminology/understanding is incorrect, I am new to haskell.</p>\n"}, {"tags": ["scala", "haskell", "types", "ocaml"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439584107, "post_id": 32017722, "comment_id": 51938799, "body": "Looking at Haskell&#39;s <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/src/Data-Graph.html\" rel=\"nofollow noreferrer\"><b><code>Data.Graph</code></b> source</a> might be enlightening..."}, {"owner": {"reputation": 1032, "user_id": 3240588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fb1f403b8c39410fe00542b95377f410?s=128&d=identicon&r=PG&f=1", "display_name": "user3240588", "link": "https://stackoverflow.com/users/3240588/user3240588"}, "edited": false, "score": 0, "creation_date": 1439585909, "post_id": 32017722, "comment_id": 51939589, "body": "I don&#39;t get what the problem is now? Is link_source supposed return &#39;ok&#39; only when src is actually of type node_type_1 or something like that? If that&#39;s true you could just match its output on | NodeType1Node _ -&gt; &quot;ok&quot; | _ -&gt; &quot;not ok&quot;. I don&#39;t think I&#39;m getting it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1439589286, "post_id": 32017722, "comment_id": 51940877, "body": "Can you elaborate on what you actually would like to write? I can&#39;t fully grasp the last part of the question. I only can see that the scala code exploits subtyping to that <code>src</code> can be returned without injecting it into the right subclass of <code>Node</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1439589386, "post_id": 32017722, "comment_id": 51940907, "body": "To statically enforce some rules among edges and nodes in Haskell one could exploit GADTs, but I&#39;d like to understand your question better before actually recommending that."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1439595016, "post_id": 32017722, "comment_id": 51942301, "body": "Seconded that he&#39;s probably looking for a GADT and more input would be useful.  For example, if the validity of each edge (node) only depends on the immediately connected node (resp. edge), then a GADT solution should be &quot;easy&quot;.  However, if there are some sort of propogating types issues, such as the types of verticies in two hops then things get tremendously complex."}], "answers": [{"comments": [{"owner": {"reputation": 168, "user_id": 4435991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c3f11adf60aa43e3e45331784950cb3?s=128&d=identicon&r=PG", "display_name": "Stefan Larsson", "link": "https://stackoverflow.com/users/4435991/stefan-larsson"}, "edited": false, "score": 0, "creation_date": 1439655889, "post_id": 32022464, "comment_id": 51955058, "body": "Scala is like a woman who constantly seduces me but everyone tells me to stay away from. Haskell is the woman everyone says I should approach but she always slaps me in the face."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 168, "user_id": 4435991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c3f11adf60aa43e3e45331784950cb3?s=128&d=identicon&r=PG", "display_name": "Stefan Larsson", "link": "https://stackoverflow.com/users/4435991/stefan-larsson"}, "edited": false, "score": 0, "creation_date": 1439663534, "post_id": 32022464, "comment_id": 51957469, "body": "The Haskell solution is much better imho :) Scala&#39;s OO is a major annoyance, especially in a team without perfect discipline. Also non-purity."}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 6, "last_activity_date": 1439703393, "last_edit_date": 1439703393, "creation_date": 1439622870, "answer_id": 32022464, "question_id": 32017722, "link": "https://stackoverflow.com/questions/32017722/capturing-rules-of-graph-using-types-in-scala-ocaml-and-haskell/32022464#32022464", "title": "Capturing rules of graph using types in Scala, OCaml and Haskell", "body": "\n\n<p><em>Edit:</em> the answer with GADTs is much more direct.</p>\n\n<p>Here's a Haskell version (without <code>unsafeCoerce</code>), which is one possible translation of your Scala code. I can't help with an OCaml solution however.</p>\n\n<p>Note that, in Haskell, <code>==</code> cannot be used on values of different type (and the ability to do so in Scala is frequently frowned upon and a source of annoyance and bugs). However, I've provided a solution below for comparing different node types if you really need it. If you don't <em>truly</em> need it, I'd recommend avoiding it, as it depends on GHC features/extensions that make your code less portable and could potentially even cause problems for the type checker.</p>\n\n<p><strong>WITHOUT polymorphic node comparison:</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TypeFamilies, FlexibleContexts #-}\n-- the FlexibleContexts extension can be eliminated\n-- by removing the constraint on edgeSource.\n\n-- let's start with just the data types\ndata NodeType1 = NodeType1 { name1 :: String } deriving Eq\ndata NodeType2 = NodeType2 { name2 :: String } deriving Eq\ndata NodeType3 = NodeType3 { name3 :: String } deriving Eq\n\ndata EdgeType1 = EdgeType1 { source1 :: NodeType1, target1 :: NodeType2 }\ndata EdgeType2 = EdgeType2 { source2 :: NodeType2, target2 :: NodeType1 }\n\n-- you tell the compiler that the node types\n-- somehow \"belong together\" by using a type class\nclass    Node a         where name :: a -&gt; String\ninstance Node NodeType1 where name = name1\ninstance Node NodeType2 where name = name2\ninstance Node NodeType3 where name = name3\n\n-- same about the edges, however in order to\n-- map each Edge type to a different Node type,\n-- you need to use TypeFamilies; see\n-- https://wiki.haskell.org/GHC/Type_families\nclass Edge a where\n  type SourceType a\n  -- the constraint here isn't necessary to make\n  -- the code compile, but it ensures you can't\n  -- map Edge types to non-Node types.\n  edgeSource :: Node (SourceType a) =&gt; a -&gt; SourceType a\n\ninstance Edge EdgeType1 where\n  type SourceType EdgeType1 = NodeType1\n  edgeSource = source1\n\ninstance Edge EdgeType2 where\n  type SourceType EdgeType2 = NodeType2\n  edgeSource = source2\n\nmain = do\n  let n1     = NodeType1 \"Node1\"\n      n2     = NodeType2 \"Node2\"\n      edge   = EdgeType1 n1 n2\n      source = edgeSource edge\n  print (source == n1)  -- True\n--  print (source == n2)  -- False  -- DOESN'T COMPILE\n</code></pre>\n\n<p><strong>WITH polymorphic node comparison:</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances #-}\n\n-- again, constraint not required but makes sure you can't\n-- define node equality for non-Node types.\nclass (Node a, Node b) =&gt; NodeEq a b where\n  nodeEq :: a -&gt; b -&gt; Bool\n\n-- I wasn't able to avoid OVERLAPPING/OVERLAPS here.\n-- Also, if you forget `deriving Eq` for a node type N,\n-- `nodeEq` justs yield False for any a, b :: N, without warning.\ninstance {-# OVERLAPPING #-} (Node a, Eq a)   =&gt; NodeEq a a where\n  nodeEq = (==)\ninstance {-# OVERLAPPING #-} (Node a, Node b) =&gt; NodeEq a b where\n  nodeEq _ _ = False\n\nmain = do\n  let n1     = NodeType1 \"Node1\"\n      n2     = NodeType2 \"Node2\"\n      edge   = EdgeType1 n1 n2\n      source = edgeSource edge\n  print (source `nodeEq` n1)  -- True\n  print (source `nodeEq` n2)  -- False\n</code></pre>\n\n<p>The abov is not the only way to tell the Haskell type system about your constraints, for example functional dependencies seem applicable, and GADTs.</p>\n\n<hr>\n\n<p><strong>Explanation:</strong></p>\n\n<p>It's worth understanding why the solution seems to be more direct in Scala. </p>\n\n<p>Scala's a hybrid between <em><a href=\"https://en.wikipedia.org/wiki/Subtyping\" rel=\"nofollow\">subtype polymorphism</a> based OO</em> such as the one found in C++, Java/C#, Python/Ruby, and (often <a href=\"https://github.com/scalaz/scalaz\" rel=\"nofollow\">Haskell</a>-<a href=\"http://typelevel.org\" rel=\"nofollow\">like</a>) <em>functional programming</em>, which typically avoids subtyping a.k.a. datatype inheritance, and resorts to other, arguably better, forms of <a href=\"https://en.wikipedia.org/wiki/Polymorphism_(computer_science)\" rel=\"nofollow\">polymorphism</a>.</p>\n\n<p>In Scala, the way you define ADTs is by encoding them as a <code>sealed trait</code> + a number of (potentially sealed) case classes and/or case objects. However, this is only a pure ADT only if you never refer to the types of the case objects and case classes, so as to pretend they are like the Haskell or ML ADTs. However, your Scala solution indeed uses those types, i.e. it points \"into\" the ADT.</p>\n\n<p>There's no way to do that in Haskell as individual constructors of an ADT do not have a distinct type. Instead, if you need to type-distinguish between individual constructors of an ADT, you need to split the original ADT into separate ADTs, one per constructor of the original ADT. You then \"group\" these ADTs together, so as to be able to refer to all of them in your type signatures, by putting them in a <a href=\"https://en.wikipedia.org/wiki/Type_class\" rel=\"nofollow\">type class</a>, which is a form of ad-hoc polymorphism.</p>\n"}, {"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1439646337, "post_id": 32023598, "comment_id": 51952263, "body": "Doesn&#39;t OCaml have GADTs nowadays? Can&#39;t they help out here?"}, {"owner": {"reputation": 1032, "user_id": 3240588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fb1f403b8c39410fe00542b95377f410?s=128&d=identicon&r=PG&f=1", "display_name": "user3240588", "link": "https://stackoverflow.com/users/3240588/user3240588"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1439668503, "post_id": 32023598, "comment_id": 51958968, "body": "@ErikAllik yes I think they can; I updated the response with what I came up with."}], "tags": [], "owner": {"reputation": 1032, "user_id": 3240588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fb1f403b8c39410fe00542b95377f410?s=128&d=identicon&r=PG&f=1", "display_name": "user3240588", "link": "https://stackoverflow.com/users/3240588/user3240588"}, "is_accepted": false, "score": 4, "last_activity_date": 1448740077, "last_edit_date": 1448740077, "creation_date": 1439632666, "answer_id": 32023598, "question_id": 32017722, "link": "https://stackoverflow.com/questions/32017722/capturing-rules-of-graph-using-types-in-scala-ocaml-and-haskell/32023598#32023598", "title": "Capturing rules of graph using types in Scala, OCaml and Haskell", "body": "<p>You were asking too much of the Ocaml type system. At this point in your second attempt:</p>\n\n<pre><code>let link_source (e : edge) : node =\nmatch e with\n| EdgeType1 (src, _) -&gt; \n</code></pre>\n\n<p>you are saying: It should be clear that <code>src</code> is of <code>node_type_1</code>, and I gave the return type <code>node</code>, so the compiler should be able to sort out the correct constructor to use from the type of <code>src</code>. However this is not possible in general: In a given variant, there is not a unique mapping from 'member types' to constructors; for example: <code>type a = A of int | B of int</code>. So you do have to specify the constructor (you could name it shorter).</p>\n\n<p>If you don't want that you have to use polymorphism. One option is make the <code>src_link</code> function polymorphic. One attempt would be</p>\n\n<pre><code>type e12 = node_type_1 * node_type_2\ntype e21 = node_type_2 * node_type_1\n\nlet link_source = fst\n</code></pre>\n\n<p>but then you have to expose the link types as tuples separately. Another option is to use polymorphic variants.</p>\n\n<pre><code>type node1 = [`N1 of string]\ntype node2 = [`N2 of string]\ntype node3 = [`N3 of string]\ntype node = [node1 | node2 | node3]\ntype edge = E12 of node1 * node2 | E21 of node2 * node1\n</code></pre>\n\n<p>then one could write</p>\n\n<pre><code>let link_source (e:edge) : [&lt;node] = match e with\n  | E12 (`N1 s, _) -&gt; `N1 s \n  | E21 (`N2 s, _) -&gt; `N2 s\n</code></pre>\n\n<p>this automaticallly unifies the return type and checks that it's an existing node. The last pattern match can also be handled by type coercion: </p>\n\n<pre><code>let link_source (e:edge) : node = match e with\n  | E12 (n1, _) -&gt; (n1:&gt;node)\n  | E21 (n2, _) -&gt; (n2:&gt;node)\n</code></pre>\n\n<p>GADTs can also help. With the same definitions for <code>node{,1,2,3}</code> above one can define</p>\n\n<pre><code>type ('a, 'b) edge =\n  | E12 : node1 * node2 -&gt; (node1, node2) edge\n  | E21 : node2 * node1 -&gt; (node2, node1) edge\n</code></pre>\n\n<p>and then a polymorphic</p>\n\n<pre><code>let link_source : type a b . (a, b) edge -&gt; a = function\n  | E12 (n1, _) -&gt; n1\n  | E21 (n2, _) -&gt; n2\n</code></pre>\n\n<p>addendum: when using GADTs it's not necessary to use polymorphic variants. So, one can just have</p>\n\n<pre><code>type node1 = N1 of string\ntype node2 = N2 of string\ntype node3 = N3 of string\n</code></pre>\n\n<p>and the same definitions of <code>edge</code> and <code>link_source</code> will work.</p>\n"}, {"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1439702600, "post_id": 32025637, "comment_id": 51965416, "body": "seems like a much better translation than mine!"}, {"owner": {"reputation": 168, "user_id": 4435991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c3f11adf60aa43e3e45331784950cb3?s=128&d=identicon&r=PG", "display_name": "Stefan Larsson", "link": "https://stackoverflow.com/users/4435991/stefan-larsson"}, "edited": false, "score": 0, "creation_date": 1439815799, "post_id": 32025637, "comment_id": 52000949, "body": "It&#39;s a shame that all these extensions are needed for something like this. Ideally I am thinking about use the data model on server side and transpiled to JavaScript on the client side.  I am starting to think that the data is not modeled correctly for Haskell or OCaml. Perhaps my initial attempt in Scala is fooling me into a bad way to think to start with."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 5, "last_activity_date": 1439669120, "last_edit_date": 1439669120, "creation_date": 1439648401, "answer_id": 32025637, "question_id": 32017722, "link": "https://stackoverflow.com/questions/32017722/capturing-rules-of-graph-using-types-in-scala-ocaml-and-haskell/32025637#32025637", "title": "Capturing rules of graph using types in Scala, OCaml and Haskell", "body": "<p>I think the most straightforward translation of your Scala version is using phantom types to mark the node and edge type and bind them to specific constructors with GADTs.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n\ndata Type = Type1 | Type2\n\ndata Edge t where\n    EdgeType1 :: Node Type1 -&gt; Node Type2 -&gt; Edge Type1\n    EdgeType2 :: Node Type2 -&gt; Node Type1 -&gt; Edge Type2\n\ndata Node t where\n    NodeType1 :: String -&gt; Node Type1\n    NodeType2 :: String -&gt; Node Type2\n\ninstance Eq (Node t) where\n    NodeType1 a == NodeType1 b = a == b\n    NodeType2 a == NodeType2 b = a == b\n\nedgeSource :: Edge t -&gt; Node t\nedgeSource (EdgeType1 src _) = src\nedgeSource (EdgeType2 src _) = src\n\nmain :: IO ()\nmain = do\n    let n1   = NodeType1 \"Node1\"\n        n2   = NodeType2 \"Node2\"\n        edge = EdgeType1 n1 n2\n        src  = edgeSource edge\n\n    print $ src == n1\n</code></pre>\n\n<p>This is now actually safer than the Scala version since we know the exact type returned from <code>edgeSource</code> statically instead of just getting an abstract base class that we would need to type-cast or pattern match against.</p>\n\n<p>If you want to mimic the Scala version exactly, you could hide the phantom type in an existential wrapper to return a generic, \"unknown\" Node from <code>edgeSource</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n\ndata Some t where\n    Some :: t x -&gt; Some t\n\nedgeSource :: Edge t -&gt; Some Node\nedgeSource (EdgeType1 src _) = Some src\nedgeSource (EdgeType2 src _) = Some src\n\nlabel :: Node t -&gt; String\nlabel (NodeType1 l) = l\nlabel (NodeType2 l) = l\n\ninstance Eq (Some Node) where\n    Some n1 == Some n2 = label n1 == label n2\n</code></pre>\n"}], "owner": {"reputation": 168, "user_id": 4435991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c3f11adf60aa43e3e45331784950cb3?s=128&d=identicon&r=PG", "display_name": "Stefan Larsson", "link": "https://stackoverflow.com/users/4435991/stefan-larsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 2, "accepted_answer_id": 32025637, "answer_count": 3, "score": 11, "last_activity_date": 1448740077, "creation_date": 1439582077, "last_edit_date": 1439616566, "question_id": 32017722, "link": "https://stackoverflow.com/questions/32017722/capturing-rules-of-graph-using-types-in-scala-ocaml-and-haskell", "title": "Capturing rules of graph using types in Scala, OCaml and Haskell", "body": "<p>I am trying to describe a complex graph with many different types of nodes and edges which can only be connected to each other according to a set of rules. I would like these rules to be checked at compile time using the type system of the language. There are many different node and edge types in my real application.</p>\n\n<p>I have easily created a simple example in Scala:</p>\n\n<pre><code>sealed trait Node {\n  val name: String\n}\ncase class NodeType1(override val name: String) extends Node\ncase class NodeType2(override val name: String) extends Node\ncase class NodeType3(override val name: String) extends Node\n\nsealed trait Edge\ncase class EdgeType1(source: NodeType1, target: NodeType2) extends Edge\ncase class EdgeType2(source: NodeType2, target: NodeType1) extends Edge\n\nobject Edge {\n  def edgeSource(edge: Edge): Node = edge match {\n    case EdgeType1(src, _) =&gt; src\n    case EdgeType2(src, _) =&gt; src\n  }\n}\n\nobject Main {\n  def main(args: Array[String]) {\n    val n1 = NodeType1(\"Node1\")\n    val n2 = NodeType2(\"Node2\")\n    val edge = EdgeType1(n1, n2)\n    val source = Edge.edgeSource(edge)\n    println(source == n1)  // true\n  }\n}\n</code></pre>\n\n<p>A valid graph can only connect a given edge type between the given types of nodes as shown in the Scala example above. The function \"edgeSource\" extracts the source node from the edge, as simple as that.</p>\n\n<p>Here comes a non working example of what I would like to write in OCaml:</p>\n\n<pre><code>type node =\n    NodeType1 of string\n  | NodeType2 of string\n\ntype edge =\n    EdgeType1 of NodeType1 * NodeType2\n  | EdgeType2 of NodeType2 * NodeType1\n\nlet link_source (e : edge) : node =\n  match e with\n  | EdgeType1 (src, _) -&gt; src\n  | EdgeType2 (src, _) -&gt; src\n</code></pre>\n\n<p>The problem here is that \"NodeTypeX\" are constructors and not types. Hence, I am unable to use them when I describe the tuples with source and target for which the edges are defined. The \"link_source\" function can only return one type and \"node\" is the variant which can return something.</p>\n\n<p>I have been trying out how to fix this in both OCaml and Haskell and here is an example of one go in OCaml where the node type wraps node_type_X:</p>\n\n<pre><code>type node_type_1 = NodeType1 of string\ntype node_type_2 = NodeType2 of string\n\ntype node =\n    NodeType1Node of node_type_1\n  | NodeType2Node of node_type_2\n\ntype edge =\n    EdgeType1 of node_type_1 * node_type_2\n  | EdgeType2 of node_type_2 * node_type_1\n\nlet link_source (e : edge) : node =\n  match e with\n  | EdgeType1 (src, _) -&gt; NodeType1Node src\n  | EdgeType2 (src, _) -&gt; NodeType2Node src\n</code></pre>\n\n<p>But the problem with this is that I am duplicating the type information. I am specifying the source node type in the definition of edge, and it is also given when matching the edge in link_source as NodeTypeXNode.</p>\n\n<p>Obviously I am not understanding how to solve this problem. I am stuck thinking in class hierarchies. What would be the correct way to express what I am achieving in the Scala code above in OCaml or Haskell?</p>\n"}, {"tags": ["haskell", "emacs", "indentation"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439578496, "post_id": 32016807, "comment_id": 51936206, "body": "Not at all a solution, but if you are moving <code>arg2</code> and <code>arg3</code> to separate lines you might as well fo the same with <code>arg1</code>."}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439578601, "post_id": 32016807, "comment_id": 51936262, "body": "@duplode yeah but then they&#39;d still be lined up under <code>maybe</code> rather than being further indented... And seeing as haskell is an indentation based language, this could in theory cause some mis-interpretation"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439579699, "post_id": 32016807, "comment_id": 51936765, "body": "I see. FWIW, item 1.1 of <a href=\"https://wiki.haskell.org/Emacs/Indentation\" rel=\"nofollow noreferrer\">this HaskellWiki page</a> calls the haskell-mode behaviour you describe &quot;debatably a bad choice&quot; for this exact reason. Personally, I would probably indent this snippet as <code>myFunction = maybe&lt;newline&gt;&lt;4 spaces&gt;longArg1&lt;newline&gt;&lt;4 spaces&gt;longArg2&lt;newline&gt;&lt;4 spaces&gt;longArg3</code>, and so it seems that, were I to use haskell-mode, I would run into a similar issue to yours."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1439579771, "post_id": 32016807, "comment_id": 51936802, "body": "The layout rules (which are all that care about indentation) only come into effect when one of <code>let&#47;do&#47;where&#47;of</code> appears; and even within a layout context, as long as you don&#39;t <i>decrease</i> your indent so that <code>arg1</code> is indented by less than the <code>maybe</code> is, you run no risk of confusing the indentation."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1439582231, "post_id": 32016807, "comment_id": 51937985, "body": "I have the same issues. Usually I temporarily switch to simple indent mode using <code>turn-on-haskell-simple-indent</code> and then do the right level indent."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1439595841, "post_id": 32016807, "comment_id": 51942492, "body": "@amalloy Not true; <code>foo = do maybe arg1\\n.........arg2</code> would be interpreted very differently from <code>foo = do maybe arg1\\n...............arg2</code>, even though in neither case does the indentation decrease. (The former would be <code>foo = do { maybe arg1; arg2 }</code> while the latter would correctly be <code>foo = do { maybe arg1 arg2 }</code>."}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1439631772, "post_id": 32016807, "comment_id": 51948558, "body": "I&#39;ve submitted this issue as a ticket on the <code>haskell-mode</code> github, since it seems like I&#39;m not the only one with this problem"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1439635446, "post_id": 32016807, "comment_id": 51949347, "body": "@ElectricCoffee It will be nice if you can link the issue here. :)"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1439636117, "post_id": 32016807, "comment_id": 51949505, "body": "@Sibi Edited the question with the link"}, {"owner": {"reputation": 26618, "user_id": 1283394, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6d7d7689f9562293f6106353a6b1a905?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/1283394/stefan"}, "edited": false, "score": 1, "creation_date": 1470581396, "post_id": 32016807, "comment_id": 64997888, "body": "AFAICT, <code>haskell-indent</code> (as opposed to <code>haskell-indentation</code>) gets this one right."}, {"owner": {"reputation": 24687, "user_id": 70157, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/da0a70a59c1e428c7780aa1cdc7a26d2?s=128&d=identicon&r=PG", "display_name": "bignose", "link": "https://stackoverflow.com/users/70157/bignose"}, "edited": false, "score": 2, "creation_date": 1472444149, "post_id": 32016807, "comment_id": 65737021, "body": "I&#39;m voting to close this question as off-topic because it belongs on the <a href=\"http://emacs.stackexchange.com/\">emacs.stackexchange.com</a> site."}], "answers": [{"tags": [], "owner": {"reputation": 9377, "user_id": 8431111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GteAE.jpg?s=128&g=1", "display_name": "J_H", "link": "https://stackoverflow.com/users/8431111/j-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1514308390, "creation_date": 1514308390, "answer_id": 47981629, "question_id": 32016807, "link": "https://stackoverflow.com/questions/32016807/haskell-indentation-doesnt-line-up-function-arguments/47981629#47981629", "title": "Haskell indentation doesn&#39;t line up function arguments", "body": "<p>The haskell-indentation  haskell-mode issue was closed last year and won't be fixed.</p>\n\n<p>For desired behavior, use haskell-indent.</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "answer_count": 1, "score": 25, "last_activity_date": 1514308390, "creation_date": 1439577910, "last_edit_date": 1592644375, "question_id": 32016807, "link": "https://stackoverflow.com/questions/32016807/haskell-indentation-doesnt-line-up-function-arguments", "title": "Haskell indentation doesn&#39;t line up function arguments", "body": "<p>I'm using Emacs as my main Haskell editor, and as such, I of course use <code>haskell-mode</code> as the main mode for editing Haskell code.</p>\n<p>Now for whatever reason, <code>haskell-indentation</code> doesn't offer an indent point for function arguments.</p>\n<p>What I mean is that Emacs will consistently do this: (<code>\u25a1</code> is the other indent point(s))</p>\n<pre><code>myFunction = maybe arg1\n\u25a1            arg2\n\u25a1            arg3\n</code></pre>\n<p>Instead of doing this:</p>\n<pre><code>myFunction = maybe arg1\n\u25a1            \u25a1     arg2\n\u25a1            \u25a1     arg3\n</code></pre>\n<p>Sometimes I need to break functions up onto multiple lines due to the lines getting too long, but not having <code>haskell-mode</code> offer the right indent level is bugging me some.</p>\n<p>Anything I can do to alleviate this?</p>\n<h1>Edit</h1>\n<p>Seeing as I'm not the only one with this issue, I've opened a ticket on the <code>haskell-mode</code> github page [<a href=\"https://github.com/haskell/haskell-mode/issues/813\" rel=\"noreferrer\">here</a>]</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 1, "creation_date": 1439580061, "post_id": 32016828, "comment_id": 51936961, "body": "<code>stack solver --modify-stack-yaml</code> says <code>Couldn&#39;t find .cabal file in: .</code> but I do have a <code>Genesis.cabal</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1439581549, "post_id": 32016828, "comment_id": 51937652, "body": "@rem After cloning <a href=\"https://github.com/remysucre/Genesis\" rel=\"nofollow noreferrer\">your repository</a> I did not get this specific error (though there were a few version bounds issues). What does <code>stack version</code> say? (I am using the newly-released 0.1.3.1)."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1439582217, "post_id": 32016828, "comment_id": 51937976, "body": "Version 0.1.3.1, Git revision 908b042...46ed2b804d7. Do I need to do anything before <code>stack solver --modify-stack-yaml</code>?"}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1439583357, "post_id": 32016828, "comment_id": 51938477, "body": "I didn&#39;t notice this before, but in the error there&#39;s actually <code>Running &#47;usr&#47;local&#47;bin&#47;cabal --config-file=&#47;tmp&#47;cabal-solver8108&#47;cabal.config install -v --dry-run --only-dependencies --reorder-goals --max-backjumps=-1 --package-db=clear --package-db=global exited with ExitFailure 1</code>. But I succeeded in running the same command outside stack"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 1, "creation_date": 1439584082, "post_id": 32016828, "comment_id": 51938788, "body": "@rem I suggest you (1) in all .cabal files of your project, raise the upper bound of <code>haskell-src-exts</code> to <code>&lt; 1.17</code>, and that of <code>random</code> to <code>&lt; 1.2</code>, to match the versions in reasonably recent LTS snapshots; (2) delete <code>stack.yaml</code> and run <code>stack init --resolver lts-2.22</code> (the latest LTS for GHC 7.8.4, which I assume is the one in your system and what you want to use); and (3) run <code>stack solver --modify-stack-yaml</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 1, "creation_date": 1439584533, "post_id": 32016828, "comment_id": 51938981, "body": "@rem To sum it up, the main issue is that the version bounds for <code>haskell-src-exts</code> need bumping in some places (the earliest Stackage snapshot already used 1.15) and are inconsistent in others (one of the files asked for 1.16.*). If you don&#39;t need stack to handle all those .cabal files in the hidden directories of your project, you can make your life easier by passing the <code>--ignore-subdirs</code> option to <code>stack init</code>."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1439584822, "post_id": 32016828, "comment_id": 51939133, "body": "Succeed! Thanks so much"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1439577982, "creation_date": 1439577982, "answer_id": 32016828, "question_id": 32016256, "link": "https://stackoverflow.com/questions/32016256/stack-init-package-not-found/32016828#32016828", "title": "Stack init package not found", "body": "<p>stack does not look at Hackage at first. It tries to build your project using only packages from a snapshot of <a href=\"http://www.stackage.org/\" rel=\"nofollow\">Stackage</a> (you can find the exact snapshot you are using in the <code>resolver</code> field of <code>stack.yaml</code>). <code>bv</code> does not seem to be in Stackage (at least it is not in the <a href=\"http://www.stackage.org/lts-3.0\" rel=\"nofollow\">latest LTS snapshot</a>). Fortunately, the issue is easy to solve: just run <code>stack solver --modify-stack-yaml</code>. That will identify all non-Stackage dependencies and add them to the <code>extra-deps</code> field of <code>stack.yaml</code>. From that point on, those dependencies will be built somewhere in the <code>.stack-work</code> subdirectory of your project, in a very similar way to packages in a cabal-install sandbox. </p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 1, "accepted_answer_id": 32016828, "answer_count": 1, "score": 3, "last_activity_date": 1439577982, "creation_date": 1439575733, "question_id": 32016256, "link": "https://stackoverflow.com/questions/32016256/stack-init-package-not-found", "title": "Stack init package not found", "body": "<p>When trying to build an existing project with Stack I got errors like </p>\n\n<pre><code>bv not found\n- Genesis requires &gt;=0.3 &amp;&amp; &lt;0.4 &amp;&amp; -any\n- exp requires -any\n</code></pre>\n\n<p>during <code>stack init</code>. The packages are all installed in a sandbox and are from hackage. I'm almost sure Stack doesn't look into the sandbox, but why can't it find the packages from hackage? I'm also able to build just by running <code>cabal build</code>. </p>\n"}, {"tags": ["haskell", "functional-programming", "fold"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439573529, "post_id": 32015531, "comment_id": 51933614, "body": "Trivially: <code>foo a0 a1 ... = const foldr base_case</code>. More helpfully: not all recursion operates on lists. The shared theme of these two comments is that you should be careful about what you mean when you say &quot;rewritten using <code>foldr</code>&quot;."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439574503, "post_id": 32015531, "comment_id": 51934095, "body": "@Daniel Wagner, <code>const base_case foldr</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439574529, "post_id": 32015531, "comment_id": 51934116, "body": "@user3237465 Yes, of course. Silly me!"}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1439576769, "post_id": 32016234, "comment_id": 51935303, "body": "All that do not require the axiom K. And you will need to rewrite some functions (like Berry\u2019s <code>majority</code>) in sequential form."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445212363, "post_id": 32016234, "comment_id": 54213947, "body": "Yes, and the equations will only hold propositionally, if I&#39;m not mistaken."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1445214049, "post_id": 32016234, "comment_id": 54214347, "body": "What equations? Just usual function definitions? For complicated theories (like HoTT) \u2014 yes, but for good old ITT eliminators are generated natively (like with Epigram) and everything holds definitionally."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 3, "last_activity_date": 1439575662, "creation_date": 1439575662, "answer_id": 32016234, "question_id": 32015531, "link": "https://stackoverflow.com/questions/32015531/can-any-recursive-definition-be-rewritten-using-foldr/32016234#32016234", "title": "Can any recursive definition be rewritten using foldr?", "body": "<p>In type theory, it is indeed the case that you can <em>elaborate</em> all definitions by dependent <em>pattern-matching</em> into ones only using <em>eliminators</em> (a more strongly-typed version of <code>fold</code>s, the generalisation of lists' <code>foldr</code>).</p>\n\n<p>See e.g. <a href=\"http://strictlypositive.org/goguen.pdf\" rel=\"nofollow\">Eliminating Dependent Pattern Matching (pdf)</a></p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439594996, "post_id": 32019021, "comment_id": 51942297, "body": "Isn&#39;t it a proof of the fact that we can&#39;t enumerate total functions? We first assume that there is a way, but then construct a total function, which is not in the enumeration."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439627754, "post_id": 32019021, "comment_id": 51947699, "body": "@user3237465 You can enumerate functions in the language fragment: just take any valid program in the fragment (those who do not use recursion -- you can check for that in a program) and order it by length, and then by string comparison. This provides an effective infinite list. You are right that the last total function is not in the enumeration, meaning it&#39;s not in the language fragment."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439634179, "post_id": 32019021, "comment_id": 51949099, "body": "Still confused. So the language fragment contains all primitive recursive functions and only them, right? But then why should <code>f</code> be in the language fragment? It&#39;s defined in terms of <code>eval</code> and enumeration stuff \u2014 is it primitive recursive? Thanks for the explanations anyway."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439643373, "post_id": 32019021, "comment_id": 51951366, "body": "@user3237465 <code>f</code> is not in the fragment, that&#39;s what we prove! <code>f</code> is an example of a total function which is Haskell-definable (since it is computable), but does not belong to the fragment. Essentially, primitive recursion can not craft <code>f</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1439646073, "post_id": 32019021, "comment_id": 51952194, "body": "Note that (as you implied) this is primitive recursion + higher order functions, which, although total, is <i>much</i> more powerful than primitive recursion alone. E.g. you can easily write the Ackermann function."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439646811, "post_id": 32019021, "comment_id": 51952400, "body": "So your proof is about the fact that primitive recursive functions form a strict subset of total functions. But your original wording is somewhat unfortunate then: &quot;Computability theory states that, since the language becomes total (no more non termination), we lose expressiveness even on the total fragment&quot;. It&#39;s not that clear from the context, that &quot;total&quot; in the first case means &quot;only primitive recursive functions&quot;. Thanks for the clarification."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1439656725, "post_id": 32019021, "comment_id": 51955309, "body": "@user3237465 What I meant is: if you somehow restrict Haskell to a language where termination is guaranteed, and the sublanguage can be enumerated (as usually is), then the sublanguage can not express all the total functions Haskell can. In other words: if you want to (effectively) restrict a language to ensure termination, you have to throw away some total functions as well."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1444825088, "last_edit_date": 1444825088, "creation_date": 1439588271, "answer_id": 32019021, "question_id": 32015531, "link": "https://stackoverflow.com/questions/32015531/can-any-recursive-definition-be-rewritten-using-foldr/32019021#32019021", "title": "Can any recursive definition be rewritten using foldr?", "body": "<p>If we interpret your question literally, we can write <code>const value foldr</code> to achieve any <code>value</code>, as @DanielWagner pointed out in a comment.</p>\n\n<p>A more interesting question is whether we can instead forbid general recursion from Haskell, and \"recurse\" <em>only</em> through the eliminators/catamorphisms associated to each user-defined data type, which are the natural generalization of <code>foldr</code> to inductively defined data types. This is, essentially, (higher-order) primitive recursion.</p>\n\n<p>When this restriction is performed, we can only compose <em>terminating</em> functions (the eliminators) together. This means that we can no longer define non terminating functions.</p>\n\n<p>As a first example, we lose the trivial recursion</p>\n\n<pre><code>f x = f x\n-- or even\na = a\n</code></pre>\n\n<p>since, as said, the language becomes total.</p>\n\n<p>More interestingly, the general fixed point operator is lost.</p>\n\n<pre><code>fix :: (a -&gt; a) -&gt; a\nfix f = f (fix f)\n</code></pre>\n\n<p>A more intriguing question is: what about the <em>total</em> functions we can express in Haskell? We do lose all the non-total functions, but do we lose any of the total ones?</p>\n\n<p>Computability theory states that, since the language becomes total (no more non termination), we lose expressiveness even on the total fragment.</p>\n\n<p>The proof is a standard diagonalization argument. Fix any enumeration of programs in the total fragment so that we can speak of \"the <code>i</code>-th program\".\nThen, let <code>eval i x</code> be the result of running the <code>i</code>-th program on the natural <code>x</code> as input (for simplicity, assume this is well typed, and that the result is a natural). Note that, since the language is total, then a result <em>must</em> exist. Moreover, <code>eval</code> can be implemented in the unrestricted Haskell language, since we can write an interpreter of Haskell in Haskell (left as an exercise :-P), and that would work as fine for the fragment. Then, we simply take</p>\n\n<pre><code>f n = succ $ eval n n\n</code></pre>\n\n<p>The above is a total function (a composition of total functions) which can be expressed in Haskell, but not in the fragment. Indeed, otherwise there would be a program to compute it, say the <code>i</code>-th program. In such case we would have</p>\n\n<pre><code>eval i x = f x\n</code></pre>\n\n<p>for all <code>x</code>. But then,</p>\n\n<pre><code>eval i i = f i = succ $ eval i i\n</code></pre>\n\n<p>which is impossible -- contradiction. QED.</p>\n"}], "owner": {"reputation": 716, "user_id": 2315551, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8a4c0668c9eab3ecb855d3f6fd879ad7?s=128&d=identicon&r=PG&f=1", "display_name": "lsund", "link": "https://stackoverflow.com/users/2315551/lsund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 32019021, "answer_count": 2, "score": 5, "last_activity_date": 1444825088, "creation_date": 1439572868, "last_edit_date": 1439584849, "question_id": 32015531, "link": "https://stackoverflow.com/questions/32015531/can-any-recursive-definition-be-rewritten-using-foldr", "title": "Can any recursive definition be rewritten using foldr?", "body": "<p>Say I have a general recursive definition in haskell like this:</p>\n\n<pre><code>foo a0 a1 ... = base_case\nfoo b0 b1 ...          \n    | cond1 = recursive_case_1\n    | cond2 = recursive_case_2\n    ...\n</code></pre>\n\n<p>Can it always rewritten using foldr? Can it be proved?</p>\n"}, {"tags": ["haskell", "gtk2hs"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439570847, "post_id": 32014697, "comment_id": 51932300, "body": "N.B.: Use type signatures for your top-level definitions. Even if the compiler can infer them, writing them down makes it clearer makes things clearer, both for you and for other people reading your code."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1439571130, "post_id": 32014697, "comment_id": 51932446, "body": "When you say &quot;does not work&quot;, what do you mean? What happens?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1439578118, "creation_date": 1439578118, "answer_id": 32016857, "question_id": 32014697, "link": "https://stackoverflow.com/questions/32014697/timer-function-using-gtk2hs/32016857#32016857", "title": "Timer function using gtk2hs", "body": "<p>If you want to communicate with your timer thread, you will need to hand it a communication channel. An <code>MVar</code> seems appropriate here.</p>\n\n<pre><code>startTimer :: BoxClass self =&gt; self -&gt; MVar Integer -&gt; IO ThreadId\nstartTimer box timer = do \n  timeLabel &lt;- labelNew Nothing\n  boxPackStart box timeLabel PackNatural 0\n  forkIO . forever $ do\n    threadDelay 1000000\n    t &lt;- takeMVar timer\n    putMVar timer (t+1)\n    postGUIAsync $ labelSetText timeLabel (show t)\n</code></pre>\n\n<p>At the top of <code>main</code>, you can now create a fresh <code>MVar</code> with <code>timer &lt;- newMVar 0</code>, and pass this to <code>startTimer</code>. In your button callback, you can <code>takeMVar timer &gt;&gt; putMVar timer 0</code> to reset the timer.</p>\n"}], "owner": {"reputation": 367, "user_id": 4716940, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/363a400a9b096b10c2ba8070f7b12f35?s=128&d=identicon&r=PG&f=1", "display_name": "demathieu", "link": "https://stackoverflow.com/users/4716940/demathieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 32016857, "answer_count": 1, "score": 0, "last_activity_date": 1439578118, "creation_date": 1439569788, "last_edit_date": 1439571544, "question_id": 32014697, "link": "https://stackoverflow.com/questions/32014697/timer-function-using-gtk2hs", "title": "Timer function using gtk2hs", "body": "<p>I'm trying to make a Timer in Haskell using gtk2hs.\nI found an example on this website <a href=\"https://wiki.haskell.org/Gtk2Hs/Tutorials/ThreadedGUIs\" rel=\"nofollow\">wiki.haskell Tutorial Threaded GUI</a>\nwhich I could successfully implement in my project. The only problem I'm facing is creating a restart button for the timer. </p>\n\n<p>My goal is that when people pres the \"New game\" button, that a new game starts and that the timer resets.</p>\n\n<p>If a want to just restart a game I can use this line of code</p>\n\n<pre><code>onClicked button1 (startNewGame table window)\n</code></pre>\n\n<p>, which works. The problem is I can't find a way to bind a the start timer function to a button. </p>\n\n<p>I tried doing this:</p>\n\n<pre><code>onClicked button1 (do (startTimer box) (startNewGame table window))\n</code></pre>\n\n<p>Which does not work, also this does not work:</p>\n\n<pre><code>onClicked button1 (startTimer box)\n</code></pre>\n\n<p>How am I suppose to restart a thread correctly?\nWhen I run this code: </p>\n\n<pre><code>onClicked button1 (startTimer box)\n</code></pre>\n\n<p>I get this error: </p>\n\n<pre><code>gui.hs:29:25:\n    Couldn't match type `ThreadId' with `()'\n    Expected type: IO ()\n      Actual type: IO ThreadId\n    In the return type of a call of `startTimer'\n    In the second argument of `onClicked', namely `(startTimer box)'\n    In a stmt of a 'do' block: onClicked button1 (startTimer box)\n</code></pre>\n\n<p>How can I bind the (startTimer box) function to a button? </p>\n\n<p>Source code: </p>\n\n<pre><code>import Graphics.UI.Gtk\nimport SetTest\nimport qualified Data.Set as Set\nimport qualified Data.Map.Strict as Map\nimport Control.Monad.Trans(liftIO)\nimport Debug.Trace\nimport Control.Concurrent\nimport Control.Concurrent.MVar\nimport System.Exit\n\nmain :: IO ()\nmain = do\n     initGUI\n     window &lt;- windowNew\n     set window [windowTitle := \"Minesweeper\",\n                 windowDefaultWidth := 450, windowDefaultHeight := 200]\n\n\n     box &lt;- vBoxNew False 0\n     containerAdd window box\n\n     button1 &lt;- buttonNewWithLabel \"New game\"                         \n     boxPackStart box button1 PackGrow 0\n\n     widgetShowAll window\n\n     table   &lt;- tableNew 5 5 True\n     --onClicked button1 (do (startTimer box) (startNewGame table window))\n     --onClicked button1 (startTimer box)\n     onClicked button1 (startNewGame table window)\n     startTimer box\n     containerAdd window table\n     startNewGame table window\n     boxPackStart box table PackNatural 0\n     widgetShowAll window\n     onDestroy window mainQuit\n     mainGUI\n\nstartTimer :: BoxClass self =&gt; self -&gt; IO ThreadId\nstartTimer box =  do \n                  timeLabel &lt;- labelNew Nothing\n                  boxPackStart box timeLabel PackNatural 0\n                  forkIO $ do\n                   let\n                       printTime t = do{\n                               threadDelay 1000000;\n                               postGUIAsync $ labelSetText timeLabel (show t);\n                               printTime (t+1)}\n                   printTime 0\n\nstartNewGame:: (WidgetClass self, TableClass self1) =&gt; self1 -&gt; self -&gt; IO ()\nstartNewGame table window = let board = (SetTest.initialize 5 (5,5) (1,1)) :: MyBoard \n                            in checkStatusGame table board window   \n:: (WidgetClass self, TableClass self1) =&gt;\n self1 -&gt; MyBoard -&gt; self -&gt; IO ()\ncheckStatusGame table board window \n                            | won board = do  \n                                            cleanAndGenerateTable board table window True\n                                            (dialogMessage \"hurray hurray hurray\" \"Gratz, you won!!!\")\n\n                            | lost board = do \n                                             (dialogMessage \"Baby rage window\" \"Soz, you lost...\")  \n                                             cleanAndGenerateTable board table window True\n                            | otherwise =  (cleanAndGenerateTable board table window False)\ncleanAndGenerateTable :: (WidgetClass self, TableClass self1) =&gt;\n MyBoard -&gt; self1 -&gt; self -&gt; Bool -&gt; IO ()\ncleanAndGenerateTable board table window finished = do \n                                            let fieldList = [(x,y) | x &lt;- [0 .. (height board)] , y &lt;- [0 .. (width board)] ]\n                                            children &lt;- containerGetChildren table\n                                            mapM_ (\\child -&gt; containerRemove table child &gt;&gt; widgetDestroy child) children\n                                            if finished\n                                            then mapM_(generateTableFinished board table window) fieldList\n                                            else mapM_ (generateTable board table window) fieldList\n                                            widgetShowAll window  \n\ngenerateTable board table window (x,y) \n                    | Set.member (x,y) (flaggedCells board) = createButton \"flag.jpg\" (x,y) table board window              \n                    | Map.member (x,y) (clickedCells board) = createClickedButton (show (Map.findWithDefault (-1) (x,y) (clickedCells board))) (x,y) table                   \n                    | otherwise = createButton \"masked.png\" (x,y) table board window\n\n\ngenerateTableFinished board table window (x,y) \n                    | Set.member (x,y) (bombs board) = createButtonNoAction \"bomb.jpg\" (x,y) table board window                   \n                    | Map.member (x,y) (clickedCells board) = createClickedButton (show (Map.findWithDefault (-1) (x,y) (clickedCells board))) (x,y) table                   \n                    | otherwise = createClickedButton (show (Map.findWithDefault (-1) (x,y) (maskedCells board))) (x,y) table\n\ncreateButtonNoAction pth (x,y) table board window = do \n                                     button &lt;- buttonNew\n                                     box   &lt;- hBoxNew False 0\n                                     image &lt;- imageNewFromFile pth \n                                     boxPackStart box image PackRepel 0\n                                     containerAdd button box\n                                     tableAttachDefaults table button x (x+1) y (y+1)  \n\ncreateClickedButton lbl (x,y) table = do \n                                     button &lt;- buttonNew\n                                     box   &lt;- hBoxNew False 0\n                                     label &lt;- labelNew (Just lbl)\n                                     boxPackStart box label PackRepel 0\n                                     containerAdd button box\n                                     tableAttachDefaults table button x (x+1) y (y+1)\n\n\ncreateButton pth (x,y) table board window = do \n                                     button &lt;- buttonNew\n                                     box   &lt;- hBoxNew False 0\n                                     image &lt;- imageNewFromFile pth \n                                     boxPackStart box image PackRepel 0\n                                     containerAdd button box\n                                     tableAttachDefaults table button x (x+1) y (y+1)  \n                                     on button buttonReleaseEvent $ do \n                                                                      click &lt;- eventButton\n                                                                      liftIO $ case click of { LeftButton -&gt; (checkStatusGame table (SetTest.click (x,y) board) window); RightButton -&gt; (checkStatusGame table (SetTest.flag (x,y) board) window)  }\n                                                                      return False\n                                     return ()  \n\ndialogMessage title msg =  do dialog &lt;- messageDialogNew Nothing [] MessageOther ButtonsOk msg\n                              set dialog [windowTitle := title]\n                              widgetShowAll dialog\n                              dialogRun dialog\n                              widgetDestroy dialog\n</code></pre>\n"}, {"tags": ["haskell", "installation", "packaging", "cabal", "haskell-platform"], "comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439568163, "post_id": 32014191, "comment_id": 51930808, "body": "Note: I&#39;m new to Haskell so I am working from a <a href=\"https://www.haskell.org/platform/mac.html\" rel=\"nofollow noreferrer\">fresh installation</a> and no experience with Cabal other than executing the <a href=\"http://www.mathstat.dal.ca/~selinger/quipper/README\" rel=\"nofollow noreferrer\">instructions specified for configuring Quipper</a>."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439568416, "post_id": 32014191, "comment_id": 51930940, "body": "Looks like the source of <code>Lattices-0.0.1</code> is not compatible with newer versions of <code>base</code> which now include the Applicative Functor operators <code>(&lt;$&gt;)</code>, <code>(&lt;*&gt;)</code>, <code>(*&gt;)</code> &amp; <code>(&lt;*)</code> by default"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439568484, "post_id": 32014191, "comment_id": 51930976, "body": "@recursion.ninja: Can you elaborate? What can I do to get around that."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439568793, "post_id": 32014191, "comment_id": 51931133, "body": "@recursion.ninja: Also, did I start the &quot;right&quot; way by installing using the <a href=\"https://www.haskell.org/platform/mac.html#windows\" rel=\"nofollow noreferrer\">platform</a>. I generally use Homebrew, but when I <code>brew info haskell-platform</code> I get a <a href=\"http://stackoverflow.com/a/28616677/656912\">message</a> pointing me to the platform (which certainly seems to be well maintained and easy to set up)."}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439569290, "post_id": 32014471, "comment_id": 51931404, "body": "How do I backtrack to an older version of GHC?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439569351, "post_id": 32014471, "comment_id": 51931434, "body": "@raxacoricofallapatorius Carefully! I&#39;ll update my post with a reference."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439569490, "post_id": 32014471, "comment_id": 51931511, "body": "Thanks. It sounds like a bad idea though (&quot;carefully&quot; has me worried). Maybe the thing to do is for me to contact the Quipper folks and see if they can come up with a solution. As it is, their instructions, as written, don&#39;t work for current GHC."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439569502, "post_id": 32014471, "comment_id": 51931519, "body": "@raxacoricofallapatorius It&#39;s unfortunate that the developer(s) of <a href=\"http://www.mathstat.dal.ca/~selinger/quipper/\" rel=\"nofollow noreferrer\"><b><code>Quipper</code></b></a> choose an un-maintained package as a dependency. A simple <code>import Prelude hiding (*&gt;)</code> would solve the problem with the <code>Lattice-0.0.1</code> package."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439569612, "post_id": 32014471, "comment_id": 51931583, "body": "@raxacoricofallapatorius I would share in your concern about using an older version of <code>GHC</code> &amp; <code>base</code>. There have been major updates from versions <code>6.8.*</code> to <code>7.10.*</code> that were known to break some packages. <code>Lattices-0.0.1</code> is an unfortunate case. It might be more prudent to suggest an update to the package maintainer. You can find the package maintainer&#39;s contact info on the <a href=\"https://hackage.haskell.org/package/Lattices-0.0.1\" rel=\"nofollow noreferrer\">Hackage&#39;s package description page`</a>"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439570002, "post_id": 32014471, "comment_id": 51931805, "body": "What about <code>easyrender</code> (and for that matter, <code>newsynth</code>, which produces errors similar to those generated for <code>easyrender</code>) ?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1439570717, "post_id": 32014471, "comment_id": 51932221, "body": "@raxacoricofallapatorius Same problem. The package constraints are for <code>easyrender</code> are <code>base &gt;= 4.6 &amp;&amp; &lt; 4.8</code>. Since your <code>base</code> is greater than <code>4.8</code> it cannot find an acceptable <code>base</code> package as a dependency. This is because <code>GHC 7.10.2</code> provides a newer version of <code>base</code>. Essentially the packages aren&#39;t updated to support the newest version of <code>base</code>... :("}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1439571716, "post_id": 32014471, "comment_id": 51932749, "body": "I&#39;ll contact the maintainers of <code>easyrender</code> and <code>newsynth</code> (who include a Quipper maintainer) too."}], "tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": true, "score": 1, "last_activity_date": 1439569300, "last_edit_date": 1439569300, "creation_date": 1439569056, "answer_id": 32014471, "question_id": 32014191, "link": "https://stackoverflow.com/questions/32014191/cant-install-lattices-for-haskell/32014471#32014471", "title": "Can&#39;t install Lattices for Haskell", "body": "<p>The source of <code>Lattices-0.0.1</code> is not compatible with the newer versions of <code>base</code> included in <code>GHC 7.10.1</code> or greater which now includes the Applicative Functor operators <code>(&lt;$&gt;)</code>, <code>(&lt;*&gt;)</code>, <code>(*&gt;)</code> &amp; <code>(&lt;*)</code> by default.</p>\n\n<p>In previous versions of <code>base</code>, the Applicative Functor operators would need to be explicitly imported:</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;), (&lt;*&gt;), (*&gt;), (&lt;*))\n\nmain = show &lt;$&gt; getArgs -- use the applicative operator(s)\n</code></pre>\n\n<p>In the latest version of <code>base</code> included with <code>GHC 7.10.1</code> or greater these operators are included implicitly in the Prelude module.</p>\n\n<pre><code>-- This is not necessary\n-- import Control.Applicative ((&lt;$&gt;), (&lt;*&gt;), (*&gt;), (&lt;*))\n\nmain = show &lt;$&gt; getArgs -- use the applicative operator(s)\n</code></pre>\n\n<p>Since the <code>Lattices-0.0.1</code> package was created a long time ago, it's source is not compatible with the newest version of <code>GHC</code> &amp; <code>base</code> which you installed via the <code>haskell-platform</code>. If you <a href=\"https://hackage.haskell.org/package/Lattices-0.0.1/docs/src/Math-Lattices-LLL.html\" rel=\"nofollow\">look at the source</a> you can see that the <code>*&gt;</code> operator is used from a mathematics package import. But given the implicit prelude import of <code>*&gt;</code> from the Applicative Functor module there is now a naming ambiguity that did not exist in earlier versions of <code>base</code>. This causes the compilation error.</p>\n\n<p><strong>To correctly compile the <code>Lattice-0.0.1</code> package you will need to use a version of GHC which is older than <code>GHC 7.10.1</code>.</strong> </p>\n\n<p><em>The</em> <code>haskell-platform</code> <em>is well maintained, unfortunately the</em> <code>Lattices-0.0.1</code> <em>package is not...</em></p>\n"}, {"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440095412, "post_id": 32016322, "comment_id": 52142973, "body": "Thanks for being an awesome package maintainer!"}], "tags": [], "owner": {"reputation": 31, "user_id": 5228444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c645399b9e1573c776a4a795bc3cdd3?s=128&d=identicon&r=PG", "display_name": "bcoppens", "link": "https://stackoverflow.com/users/5228444/bcoppens"}, "is_accepted": false, "score": 3, "last_activity_date": 1439575987, "creation_date": 1439575987, "answer_id": 32016322, "question_id": 32014191, "link": "https://stackoverflow.com/questions/32014191/cant-install-lattices-for-haskell/32016322#32016322", "title": "Can&#39;t install Lattices for Haskell", "body": "<p>I wasn't actually aware anyone was using Lattice-0.0.1 from Hackage at all, so when someone reported me this bug last month, I did fix it on GitHub, but did not immediately release a new version because that didn't seem urgent. Seems I was mistaken :-)</p>\n\n<p>I've uploaded a new version to Hackage, Lattices-0.0.2, that should fix this issue.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 32014471, "answer_count": 2, "score": 1, "last_activity_date": 1439828629, "creation_date": 1439568040, "last_edit_date": 1495540280, "question_id": 32014191, "link": "https://stackoverflow.com/questions/32014191/cant-install-lattices-for-haskell", "title": "Can&#39;t install Lattices for Haskell", "body": "<p>I'm trying to follow the <a href=\"http://www.mathstat.dal.ca/~selinger/quipper/README\" rel=\"nofollow noreferrer\">instructions</a> for installing the Haskell components required by <a href=\"http://www.mathstat.dal.ca/~selinger/quipper/\" rel=\"nofollow noreferrer\"><strong><code>Quipper</code></strong></a>; but, working from a fresh installation of Haskell <a href=\"https://www.haskell.org/platform/mac.html\" rel=\"nofollow noreferrer\">using the binary installer</a>.</p>\n\n<p>I get as far on the list as attempting to install the <code>Lattices</code> package:</p>\n\n<pre><code>cabal update\ncabal install random\ncabal install mtl\ncabal install primes\ncabal install Lattices\n</code></pre>\n\n<p>However I encounter the follwoing error:</p>\n\n<blockquote>\n  <p>Lattices-0.0.1 failed during the building phase. The exception was: ExitFailure 1</p>\n</blockquote>\n\n<p>If I attempt to continue the <a href=\"http://www.mathstat.dal.ca/~selinger/quipper/README\" rel=\"nofollow noreferrer\">Quipper install instructions</a>:</p>\n\n<pre><code>cabal install zlib\ncabal install easyrender\n</code></pre>\n\n<p>I encounter further errors:</p>\n\n<blockquote>\n  <p>cabal: Could not resolve dependencies:</p>\n</blockquote>\n\n<p>I'm not sure how to proceed. What can I do to complete the package installation <a href=\"http://www.mathstat.dal.ca/~selinger/quipper/README\" rel=\"nofollow noreferrer\">instructions</a> for Quipper?</p>\n\n<hr>\n\n<pre><code>Resolving dependencies...\nConfiguring Lattices-0.0.1...\nBuilding Lattices-0.0.1...\nFailed to install Lattices-0.0.1\nBuild log ( /Users/Roy/.cabal/logs/Lattices-0.0.1.log ):\nConfiguring Lattices-0.0.1...\nBuilding Lattices-0.0.1...\nPreprocessing library Lattices-0.0.1...\n[1 of 2] Compiling Math.LinearAlgebra.GramSchmidt ( src/Math/LinearAlgebra/GramSchmidt.hs, dist/build/Math/LinearAlgebra/GramSchmidt.o )\n\nsrc/Math/LinearAlgebra/GramSchmidt.hs:25:26:\n    Ambiguous occurrence \u2018*&gt;\u2019\n    It could refer to either \u2018Prelude.*&gt;\u2019,\n                             imported from \u2018Prelude\u2019 at src/Math/LinearAlgebra/GramSchmidt.hs:2:8-37\n                             (and originally defined in \u2018GHC.Base\u2019)\n                          or \u2018Math.Algebra.LinearAlgebra.*&gt;\u2019,\n                             imported from \u2018Math.Algebra.LinearAlgebra\u2019 at src/Math/LinearAlgebra/GramSchmidt.hs:7:1-43\ncabal: Error: some packages failed to install:\nLattices-0.0.1 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<hr>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: easyrender-0.1.0.1 (user goal)\nnext goal: base (dependency of easyrender-0.1.0.1)\nrejecting: base-4.8.1.0/installed-075... (conflict: easyrender =&gt; base&gt;=4.6 &amp;&amp;\n&lt;4.8)\nrejecting: base-4.8.1.0, 4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0, 4.6.0.1, 4.6.0.0,\n4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0, 4.2.0.2, 4.2.0.1,\n4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global constraint requires\ninstalled instance)\nDependency tree exhaustively searched.\n</code></pre>\n\n<hr>\n\n<p>OS X 10.10.4; Xcode 6.4; CLT: 6.4.0.0.1.1435007323; Clang: 6.1 build 602; Haskell GHC: <a href=\"https://www.haskell.org/platform/mac.html\" rel=\"nofollow noreferrer\">7.10.2</a>. Using Homebrew in general, but, following what appears to be <a href=\"https://stackoverflow.com/a/28616677/656912\">Homebrew's recommendation</a>, not for Haskell.</p>\n"}, {"tags": ["haskell", "model-view-controller", "clojure", "functional-programming", "yesod"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 4, "creation_date": 1439559801, "post_id": 32010006, "comment_id": 51925404, "body": "what makes you assume that MVC assumes OO? I&#39;m not saying it does or not, but your statement makes me curious."}, {"owner": {"reputation": 7975, "user_id": 1455243, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/99716e02429624201ec8f85f820a81ce?s=128&d=identicon&r=PG", "display_name": "Mars", "link": "https://stackoverflow.com/users/1455243/mars"}, "edited": false, "score": 1, "creation_date": 1439565972, "post_id": 32010006, "comment_id": 51929521, "body": "fwiw, there&#39;s a close mapping between objects and functions.  Both objects and functions can contain code and do things.  Purely functional programming doesn&#39;t allow imperative modification, as most OO does, but one of the first functional languages, Scheme, was developed by Steele and Sussman to <a href=\"https://en.wikipedia.org/wiki/History_of_the_Scheme_programming_language\" rel=\"nofollow noreferrer\">explore OO ideas</a> during the early days of OOP.   e.g. in Scheme you can define a function that&#39;s a closure over data and returns functions that allow imperatively modifying or examining that data.  Voila--function is object."}], "answers": [{"tags": [], "owner": {"reputation": 6814, "user_id": 5227053, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/30254853024c1381c7e51ca09b9341e7?s=128&d=identicon&r=PG&f=1", "display_name": "AnoE", "link": "https://stackoverflow.com/users/5227053/anoe"}, "is_accepted": false, "score": 3, "last_activity_date": 1439559065, "creation_date": 1439559065, "answer_id": 32011339, "question_id": 32010006, "link": "https://stackoverflow.com/questions/32010006/how-do-you-explain-that-purely-functional-web-servers-like-ring-and-yesod-are-no/32011339#32011339", "title": "How do you explain that purely functional web servers like Ring and Yesod are not MVCs?", "body": "<p>Higher order functions and immutable data structures are what functional programming is about, just like classes/objects is what OOP is about, so it seems natural that a functional web server framework would primarily use the functional tools (functions, data structures) wherever possible.</p>\n\n<p><a href=\"http://www.yesodweb.com/book/routing-and-handlers\" rel=\"nofollow\">http://www.yesodweb.com/book/routing-and-handlers</a> begins with \"If we look at Yesod as a Model-View-Controller framework,\" ... so I don't seem to quite understand your question. What do you mean?</p>\n"}, {"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 13, "last_activity_date": 1439592652, "last_edit_date": 1439592652, "creation_date": 1439560738, "answer_id": 32011918, "question_id": 32010006, "link": "https://stackoverflow.com/questions/32010006/how-do-you-explain-that-purely-functional-web-servers-like-ring-and-yesod-are-no/32011918#32011918", "title": "How do you explain that purely functional web servers like Ring and Yesod are not MVCs?", "body": "<p>l will try to answer this with respect to Yesod.</p>\n\n<blockquote>\n  <p>How do you explain that purely functional <strong>web servers</strong> like Ring and Yesod are not MVCs?</p>\n</blockquote>\n\n<p>Yesod is not a web server. Yesod is a web framework. <a href=\"https://hackage.haskell.org/package/warp\" rel=\"nofollow\">warp</a> is the recommended web server for using alongside Yesod.</p>\n\n<blockquote>\n  <p>How do you explain that purely functional web servers like Ring and Yesod are <strong>not MVCs</strong>?</p>\n</blockquote>\n\n<p>That's not necessarily true. You can use the <a href=\"http://www.yesodweb.com/book/shakespearean-templates\" rel=\"nofollow\">templates</a> as view, <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow\">persistent</a> as model and <a href=\"http://www.yesodweb.com/book/routing-and-handlers\" rel=\"nofollow\">routing and handing</a> as Controller. In fact, the <a href=\"http://www.yesodweb.com/book/scaffolding-and-the-site-template\" rel=\"nofollow\">scaffolding site</a> loosely follows the MVC approach. </p>\n\n<blockquote>\n  <p>Functional programming critiques this - and offers a model using higher order functions and immutable data structures.</p>\n</blockquote>\n\n<p>This has nothing to do with this MVC. MVC is just a design pattern. Higher order functions and immutable data structures doesn't stop you from following some architecture or a design pattern.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 7, "last_activity_date": 1439561346, "last_edit_date": 1439561346, "creation_date": 1439561035, "answer_id": 32012008, "question_id": 32010006, "link": "https://stackoverflow.com/questions/32010006/how-do-you-explain-that-purely-functional-web-servers-like-ring-and-yesod-are-no/32012008#32012008", "title": "How do you explain that purely functional web servers like Ring and Yesod are not MVCs?", "body": "<p>You can assume OO context for MVC, and that's where it was born, but you certainly don't have to. MVC just says that Model, View and Controller should be separate things interacting in certain ways; in OO languages it's convenient to represent them as classes, but this isn't necessary. See e.g. <a href=\"http://blog.ezyang.com/2010/07/mvc-and-purity/\" rel=\"noreferrer\">MVC and Purity</a>:</p>\n\n<blockquote>\n  <p>Having been exposed to purely functional programming, I now believe that the controller and model/view separation is precisely the separation between side-effectful code (IO) and pure code.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1439599802, "creation_date": 1439599802, "answer_id": 32020437, "question_id": 32010006, "link": "https://stackoverflow.com/questions/32010006/how-do-you-explain-that-purely-functional-web-servers-like-ring-and-yesod-are-no/32020437#32020437", "title": "How do you explain that purely functional web servers like Ring and Yesod are not MVCs?", "body": "<p>Ring is low-level enough that it doesn't make sense to talk about it as being MVC or not: it is just your adapter to the HTTP protocol. You can read the request headers/body, write response headers/body, and so on, but there's nothing in ring itself about updating domain objects; that's up to whatever you layer on top of ring.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 1, "closed_date": 1439658265, "accepted_answer_id": 32011918, "answer_count": 4, "score": 4, "last_activity_date": 1439599802, "creation_date": 1439554972, "last_edit_date": 1439562259, "question_id": 32010006, "link": "https://stackoverflow.com/questions/32010006/how-do-you-explain-that-purely-functional-web-servers-like-ring-and-yesod-are-no", "closed_reason": "Opinion-based", "title": "How do you explain that purely functional web servers like Ring and Yesod are not MVCs?", "body": "<p>Traditionally people think of web applications as an MVC - which assumes an Object Oriented context. </p>\n\n<p>Functional programming critiques this - and offers a model using higher order functions and immutable data structures.</p>\n\n<p>My question is: <strong>How do you explain that purely functional web servers like Ring and Yesod are not MVCs?</strong></p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1439548971, "post_id": 32007940, "comment_id": 51918703, "body": "<a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\">ScopedTypeVariables</a> but in this case here you don&#39;t use <code>r</code> nor <code>r&#39;</code> so I fail to see your point - maybe you can find an better example?"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439549485, "post_id": 32007940, "comment_id": 51918975, "body": "I want to write expressions incrementally, using undefined first in various places. thats why I would wish to constraint the types that way"}], "answers": [{"comments": [{"owner": {"reputation": 2502, "user_id": 501739, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6b8fa3bc7278508dd85dc6090608f26c?s=128&d=identicon&r=PG", "display_name": "Jolta", "link": "https://stackoverflow.com/users/501739/jolta"}, "edited": false, "score": 0, "creation_date": 1439561322, "post_id": 32009161, "comment_id": 51926486, "body": "Will upvote if you explain what the forall keyword/symbol does here."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 1, "creation_date": 1439565783, "post_id": 32009161, "comment_id": 51929382, "body": "<code>forall a .</code> is like a <code>\\a -&gt;</code> for types. Normally when you write a signature like <code>f :: a -&gt; [a]</code> where does the <code>a</code> come from? We recognize that its meaning is &quot;some unknown type variable&quot;, but this is formalized by writing <code>f :: forall a . a -&gt; [a]</code>. In fact, Haskell automatically desugars things to that."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1439562333, "last_edit_date": 1439562333, "creation_date": 1439552354, "answer_id": 32009161, "question_id": 32007940, "link": "https://stackoverflow.com/questions/32007940/type-class-and-binding-reuse-inside-expressions-in-haskell/32009161#32009161", "title": "type class and binding reuse inside expressions in haskell", "body": "<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE UnicodeSyntax       #-}\n\ntest :: \u2200 m a . MonadPlus m =&gt; m a\ntest =\n    let r = mzero :: m a\n    in let r' :: m a = mzero\n       in  mzero\n</code></pre>\n\n<p>If you don't like non-ASCII characters in your code, you can also omit the <code>-XUnicodeSyntax</code> and use the <code>forall</code> keyword in place of &forall;.</p>\n\n<p>What this keyword does is,</p>\n\n<ol>\n<li>it introduces the new type variables <code>m</code> and <code>a</code>, as <em>universally quantified</em>. Now, usually Haskell just assumes that <em>any</em> type variable which hasn't yet been mentioned in the same(!) signature is universal. But</li>\n<li>it disables automatic introduction of type variables, within the whole context scope. This includes also <code>r = mzero :: m a</code>, so at that point GHC knows it's <em>not</em> supposed to introduce <code>m</code> and <code>a</code> as new variables, but re-use the same <code>m</code> and <code>a</code> as in the signature of <code>test</code>.</li>\n</ol>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 32009161, "answer_count": 1, "score": 1, "last_activity_date": 1439562333, "creation_date": 1439548207, "last_edit_date": 1439559885, "question_id": 32007940, "link": "https://stackoverflow.com/questions/32007940/type-class-and-binding-reuse-inside-expressions-in-haskell", "title": "type class and binding reuse inside expressions in haskell", "body": "<p>I am not really sure why the two intermediate expressions do not type check. The type checker seems to freshen new type bindings for each occurence of <code>m</code>. is there an extension to allow reusing the name <code>m</code> in all those locations?</p>\n\n<pre><code>test ::  MonadPlus m =&gt; m a\ntest =\n    let r = mzero :: m a  -- fails \n    in let r' :: m a = mzero  -- fails\n       in  mzero\n</code></pre>\n"}, {"tags": ["haskell", "unicode", "bytestring", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 476, "user_id": 635460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98a0399fcd45133c0dcc400462310f64?s=128&d=identicon&r=PG", "display_name": "Me again", "link": "https://stackoverflow.com/users/635460/me-again"}, "edited": false, "score": 0, "creation_date": 1439539979, "post_id": 32005173, "comment_id": 51913159, "body": "Yep, printing the field directly does it: <code>putStrLn . fi_summary</code> I&#39;m accepting the answer because I don&#39;t actually need the correct <code>show</code> behavior for my project, but is there a way to make <code>show</code> print unicode characters globally? (again, dozens of structures)"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 476, "user_id": 635460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98a0399fcd45133c0dcc400462310f64?s=128&d=identicon&r=PG", "display_name": "Me again", "link": "https://stackoverflow.com/users/635460/me-again"}, "edited": false, "score": 0, "creation_date": 1439540375, "post_id": 32005173, "comment_id": 51913333, "body": "None that I can think of. You would have to somehow <i>undefine</i> the existing <code>Show</code> instance and then write a new one. I don&#39;t think it&#39;s technically possible to do that - but I may be mistaken..."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 3, "last_activity_date": 1439539459, "creation_date": 1439539459, "answer_id": 32005173, "question_id": 32004881, "link": "https://stackoverflow.com/questions/32004881/read-unicode-from-json-to-string-field-using-aeson/32005173#32005173", "title": "Read unicode from JSON to String field using aeson", "body": "<p>If you're seeing escaped characters, then the data is in the string just fine. The default string <code>Show</code> instance prints all non-ASCII characters like this. So you're got the data, it's just a matter of trying to output it again appropriately.</p>\n\n<p>You might try using <code>putStrLn</code> to print the string, or maybe write it to a text file. (I know sometimes <code>putStrLn</code> does strange things if the locale is set wrong...)</p>\n"}], "owner": {"reputation": 476, "user_id": 635460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98a0399fcd45133c0dcc400462310f64?s=128&d=identicon&r=PG", "display_name": "Me again", "link": "https://stackoverflow.com/users/635460/me-again"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 32005173, "answer_count": 1, "score": 2, "last_activity_date": 1439539459, "creation_date": 1439538420, "question_id": 32004881, "link": "https://stackoverflow.com/questions/32004881/read-unicode-from-json-to-string-field-using-aeson", "title": "Read unicode from JSON to String field using aeson", "body": "<p>I receive a JSON data using httpLbs and read it</p>\n\n<pre><code>import qualified Data.ByteString.Lazy.UTF8 as LB\n\nsendSimpleRequest :: Credentials -&gt; IO LB.ByteString\nsendSimpleRequest creds = do\n    &lt;...&gt;\n    let request = applyBasicAuth user pass $ fromJust $ parseUrl url\n    manager &lt;- newManager tlsManagerSettings\n    response &lt;- httpLbs request manager\n    return $ responseBody response\n</code></pre>\n\n<p>After that, I can print the result with <code>putStr . LB.toString</code> and get <code>\"summary\":\"\u041e\u0431\u0441\u0443\u0436\u0434\u0435\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0447\u0438\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432\"</code>.</p>\n\n<p>However, when I try to use <code>aeson</code>'s <code>decode</code> to put this value into <code>data</code> and print it</p>\n\n<pre><code>data Fields = Fields\n    { fi_summary :: String\n    } deriving (Show, Generic)\n\ninstance FromJSON Fields where parseJSON = genericParseJSON parseOptions\ninstance ToJSON Fields where toJSON = genericToJSON parseOptions\n\nparseOptions :: Options\nparseOptions = defaultOptions { fieldLabelModifier = drop 3 }\n\nparseAndShow = putStr . show . fromJust . decode\n</code></pre>\n\n<p>I get escaped characters: <code>Fields {fi_summary = \"\\1054\\1073\\1089\\1091\\1078\\1076\\1077\\1085\\1080\\1077 \\1088\\1072\\1073\\1086\\1095\\1080\\1093 \\1074\\1086\\1087\\1088\\1086\\1089\\1086\\1074\"}</code></p>\n\n<p>Seems like I need to configure <code>aeson</code> to correctly put <code>ByteString</code> into <code>String</code>, but I don't want to implement the <code>FromJSON</code> instance myself because I have a dozen more structures like <code>data Fields</code>. Changing the <code>fi_summary</code> type is also a possibility, but I had no luck with any so far.</p>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"tags": [], "owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "is_accepted": true, "score": 3, "last_activity_date": 1439892296, "creation_date": 1439892296, "answer_id": 32069358, "question_id": 32004077, "link": "https://stackoverflow.com/questions/32004077/hakyll-using-makeitem-with-data-to-create-a-list-in-html/32069358#32069358", "title": "Hakyll - Using makeItem with data to create a list in HTML", "body": "<p>I've solved the problem myself. <a href=\"http://beerendlauwers.be/posts/2015-08-17-hacking-on-hakyll-pt-2.html\" rel=\"nofollow\">See this post for a detailed description</a>.</p>\n\n<p>Here's the code that actually does it:</p>\n\n<pre><code>create [\"test.html\"] $ do\n  route idRoute\n  compile $ do\n  let ctx =\n          listField \"parents\" \n                    (\n                     field \"parent\" (return . fst . itemBody) &lt;&gt;\n                     listFieldWith \"children\" \n                                   (field \"child\" (return . itemBody)) \n                                   (sequence . map makeItem . snd . itemBody)\n                    ) \n                    (sequence [makeItem (\"p1\",[\"c1\",\"c2\"]), \n                               makeItem (\"p2\",[\"p3\",\"p4\"])]) &lt;&gt;\n          defaultContext\n  makeItem \"\"\n      &gt;&gt;= loadAndApplyTemplate \"templates/testing.html\" ctx\n      &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n      &gt;&gt;= relativizeUrls\n</code></pre>\n"}], "owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 1, "accepted_answer_id": 32069358, "answer_count": 1, "score": 3, "last_activity_date": 1439892296, "creation_date": 1439535540, "question_id": 32004077, "link": "https://stackoverflow.com/questions/32004077/hakyll-using-makeitem-with-data-to-create-a-list-in-html", "title": "Hakyll - Using makeItem with data to create a list in HTML", "body": "<p>I have a list of categories. Each category itself has a list of sub-categories: <code>[(Category,[SubCategory])]</code>. I would like to get the following HTML output in a single page:</p>\n\n<pre><code>&lt;h2&gt;Category 1&lt;/h2&gt;\n\n&lt;ul&gt;\n  &lt;li&gt;Subcategory 1&lt;/li&gt;\n  &lt;li&gt;Subcategory 2&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;h2&gt;Category 2&lt;/h2&gt;\n\n&lt;ul&gt;\n  &lt;li&gt;Subcategory 1&lt;/li&gt;\n  &lt;li&gt;Subcategory 2&lt;/li&gt;\n&lt;/ul&gt;\n</code></pre>\n\n<p>I can't find a good way to do this. Would I need to do apply <code>makeItem</code> to the list and do something like </p>\n\n<pre><code>categoryList = [(\"Category 1\",[\"Subcategory 1\",\"Subcategory 2\"])]\n\ncompile $ do\n  makeItem (map fst categoryList)\n  &gt;&gt;= loadAndApplyTemplate \"templates/categories.html\" defaultContext\n</code></pre>\n\n<p>How could I add the subcategories in a context so they're available in the template? </p>\n\n<p>Perhaps I need to split up both creation steps (something like <code>mapM $ makeItem (map fst categoryList) &gt;&gt; loadAndApplyTemplate \"..\" contextWithCategories</code> and then, in some way, refer to that generated data in the actual page generation) ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439535644, "post_id": 32003234, "comment_id": 51910905, "body": "Unfortunately there is no simple way to do what you want, because different fields will have different types and thus cannot be handled using lists and <code>map</code>. There may be some compact solution using Template Haskell or some more advanced extension..."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2512323"}, "edited": false, "score": 10, "creation_date": 1439534783, "post_id": 32003577, "comment_id": 51910450, "body": "Mostly correct, but has a simpler explanation: <code>[foo_a, foo_b]</code> is a <code>List a</code>, so all elements must have the same type. But <code>foo_a::Foo-&gt;Int</code> cannot be unified with <code>foo_b::Foo-&gt;Float</code> . Basically the same thing as with <code>[&quot;String&quot;, 1, True]</code>."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 7, "last_activity_date": 1439533619, "creation_date": 1439533619, "answer_id": 32003577, "question_id": 32003234, "link": "https://stackoverflow.com/questions/32003234/type-system-in-haskell/32003577#32003577", "title": "Type System in Haskell", "body": "<p>This is a limitation of the Hindley-Milner type system. Only definitions in <code>let</code> (and equivalently, in <code>where</code> and at the top level) can be polymorphic. In particular, arguments to functions cannot be polymorphic. <code>fn</code> must either have type <code>Foo -&gt; Int</code> or <code>Foo -&gt; Float</code> -- there is no <code>Foo -&gt; (Int or Float)</code> or <code>Foo -&gt; Showable</code> type.</p>\n\n<p>If you must, you can define a Showable type, which is known as an <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"noreferrer\">existential type</a>, but you have to give the typechecker some help in order to use it, and in most code the idea is not used because its inconvenience outweighs its usefulness, and we generally have no trouble expressing what we want without it.</p>\n"}, {"tags": [], "owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "is_accepted": true, "score": 8, "last_activity_date": 1439569301, "last_edit_date": 1439569301, "creation_date": 1439543152, "answer_id": 32006306, "question_id": 32003234, "link": "https://stackoverflow.com/questions/32003234/type-system-in-haskell/32006306#32006306", "title": "Type System in Haskell", "body": "<p>The problem is that lists in Haskell are homogeneous (all the elements have the same type). And in <code>[foo_a, foo_b]</code> you are trying to create a list with two different types: <code>Foo -&gt; Int</code> and <code>Foo -&gt; Float</code>.</p>\n\n<p>One solution is to move the <code>show</code> inside the list and create a list of <code>Foo -&gt; String</code>:</p>\n\n<pre><code>Prelude&gt; data Foo = Foo {foo_a :: Int, foo_b :: Float}\nPrelude&gt; let x = Foo 2 3.4\nPrelude&gt; unwords $ map (\\fn -&gt; fn x) [show . foo_a, show . foo_b]\n\"2 3.4\"\n</code></pre>\n\n<p><sup>(<code>(\\fn -&gt; fn x)</code> can be written as <code>($ x)</code>)</sup></p>\n\n<hr>\n\n<p>Another possibility is to create a data type to unify the the several types you want to put in a list, mimicking a <a href=\"https://wiki.haskell.org/Heterogenous_collections\">heterogeneous collection</a>. In your case, it could be something like this:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata Showable b = forall a . Show a =&gt; MkShowable (b -&gt; a)\n\npack :: Show a =&gt; (b -&gt; a) -&gt; Showable b\npack = MkShowable\n\nunpack :: Showable b -&gt; b -&gt; String\nunpack (MkShowable f) = show . f\n</code></pre>\n\n<p>Then, you can do:</p>\n\n<pre><code>*Main&gt; let x = Foo 2 3.4\n*Main&gt; unwords $ map (\\fn -&gt; unpack fn x) [pack foo_a, pack foo_b]\n\"2 3.4\"\n</code></pre>\n\n<hr>\n\n<p><strong>[Update]</strong></p>\n\n<p>I was playing around with the <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Dynamic.html\"><code>Data.Dynamic</code></a>, and it seems more promising than the existential type I created above.</p>\n\n<p>Let's start with:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Control.Applicative\nimport Data.Dynamic\nimport Data.Maybe\n\ndata Foo = Foo {foo_a :: Int, foo_b :: Float}\n  deriving Typeable\n\nget_a :: Dynamic -&gt; Maybe (Foo -&gt; Int)\nget_a = fromDynamic\n\nget_b :: Dynamic -&gt; Maybe (Foo -&gt; Float)\nget_b = fromDynamic\n\ngetAsString :: Dynamic -&gt; (Foo -&gt; String)\ngetAsString dyn = fromJust $  (show .) &lt;$&gt; get_a dyn\n                          &lt;|&gt; (show .) &lt;$&gt; get_b dyn\n                          &lt;|&gt; error \"Type mismatch\"\n</code></pre>\n\n<p>In this case, we can do:</p>\n\n<pre><code>*Main&gt; let x = Foo 2 3.4\n*Main&gt; unwords $ map (\\fn -&gt; getAsString fn x) [toDyn foo_a, toDyn foo_b]\n\"2 3.4\"\n</code></pre>\n\n<p>It seems that we had to write more code to achieve the same result, but it actually gives us much more flexibility. While the existential type was only focused in showing the fields as <code>String</code>, here we are not limited to that. What if now we want to see all the fields as <code>Int</code> (in the case of <code>Float</code> we want to round the value)?</p>\n\n<pre><code>getAsInt :: Dynamic -&gt; (Foo -&gt; Int)\ngetAsInt dyn = fromJust $                get_a dyn\n                       &lt;|&gt; (round .) &lt;$&gt; get_b dyn\n                       &lt;|&gt; error \"Type mismatch\"\n</code></pre>\n\n<p>Now we can do:</p>\n\n<pre><code>*Main&gt; let x = Foo 2 3.4\n*Main&gt; map (\\fn -&gt; getAsInt fn x) [toDyn foo_a, toDyn foo_b]\n[2,3]\n</code></pre>\n"}], "owner": {"reputation": 523, "user_id": 1304393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/534886d79d0e9cdb1f3a083654f96e4f?s=128&d=identicon&r=PG", "display_name": "akn320", "link": "https://stackoverflow.com/users/1304393/akn320"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 32006306, "answer_count": 2, "score": 11, "last_activity_date": 1439569301, "creation_date": 1439531994, "question_id": 32003234, "link": "https://stackoverflow.com/questions/32003234/type-system-in-haskell", "title": "Type System in Haskell", "body": "<p>I am having trouble understanding why the following code results in an error. If the second field of <code>Foo</code> is changed to type <code>Int</code>, the code runs without errors.</p>\n\n<pre><code>Prelude&gt; data Foo = Foo {foo_a :: Int, foo_b :: Float}\nPrelude&gt; let x = Foo 2 3.4\nPrelude&gt; unwords $ map (\\fn -&gt; (show . fn) x) [foo_a, foo_b]\n\n&lt;interactive&gt;:4:46:\n    Couldn't match type `Float' with `Int'\n    Expected type: Foo -&gt; Int\n      Actual type: Foo -&gt; Float\n    In the expression: foo_b\n    In the second argument of `map', namely `[foo_a, foo_b]'\n    In the second argument of `($)', namely\n      `map (\\ fn -&gt; (show . fn) x) [foo_a, foo_b]'\n</code></pre>\n\n<p>Why is <code>show</code> unable to accept arguments of varying types? The following, of course, work:</p>\n\n<pre><code>Prelude&gt; show $ foo_a x\n\"2\"\nPrelude&gt; show $ foo_b x\n\"3.4\"\n</code></pre>\n\n<p>Also, given that this doesn't work, what is the recommended way to apply <code>show</code> to various fields of a data type?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439535667, "post_id": 32001941, "comment_id": 51910917, "body": "Is your definition of <code>term</code> correct? Shouldn&#39;t it look like <code>parens  relexpr &lt;|&gt; ... Var word ... &lt;?&gt; &quot;term&quot;</code>? (comment about <code>binary</code> and assoc deleted)"}, {"owner": {"reputation": 21, "user_id": 4673465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb15bf9bd51fe0e2e075f96520c128a?s=128&d=identicon&r=PG&f=1", "display_name": "Wazed", "link": "https://stackoverflow.com/users/4673465/wazed"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439594027, "post_id": 32001941, "comment_id": 51942083, "body": "@user5402 I think term is correctly defined, the problem is within the reservedOp2. This is the complete code."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1439782800, "creation_date": 1439782800, "answer_id": 32042443, "question_id": 32001941, "link": "https://stackoverflow.com/questions/32001941/expression-parser-for-unary-operator/32042443#32042443", "title": "Expression parser for unary operator", "body": "<p>It fails to parse e.g. <code>\"R^;S\"</code> because <code>postfix \"^\" Conv</code> fails on <code>notFollowedBy (oneOf opChar)</code> (since <code>'^'</code> <em>is</em> followed by <code>';'</code>). The fix is to remove <code>';'</code> from <code>opChar</code>:</p>\n\n<pre><code>opChar = \"^\"\n</code></pre>\n\n<p>Or, even easier if you can just use <code>reservedOp</code> from <code>haskell</code>:</p>\n\n<pre><code>reservedOp2 = P.reservedOp haskell\n</code></pre>\n\n<p>Either of these changes fixes the parsing of your examples.</p>\n"}], "owner": {"reputation": 21, "user_id": 4673465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb15bf9bd51fe0e2e075f96520c128a?s=128&d=identicon&r=PG&f=1", "display_name": "Wazed", "link": "https://stackoverflow.com/users/4673465/wazed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1439782800, "creation_date": 1439523838, "last_edit_date": 1439782115, "question_id": 32001941, "link": "https://stackoverflow.com/questions/32001941/expression-parser-for-unary-operator", "title": "Expression parser for unary operator", "body": "<p>I was trying to make an expression parser for two operators out of which only <code>^</code> is postfix unary, so with an operand it would look like <code>R^</code>.</p>\n\n<p>The problem is that whenever the operator <code>^</code> is encountered somewhere other than the end, it just stops there and returns whatever parsed successfully. It means <code>\"R;S;T^\"</code> parses successfully, but <code>\"R^;S;T^\"</code> stops at <code>R</code>. However, <code>\"(R^);S;T^\"</code> just works fine.</p>\n\n<p>I took help from an online post which he used for unary minus but that is a prefix operator (for example <code>-X</code>). His original solution was giving errors at <code>reservedOp2</code>, so I modified it to <code>reservedOp2 name = try (string name &gt;&gt; notFollowedBy (oneOf opChar))</code> and it produces the output mentioned above. I need it to work with or without parenthesis.</p>\n\n<pre><code>import Control.Applicative\nimport Text.ParserCombinators.Parsec hiding (many,optinal,(&lt;|&gt;))\nimport Text.ParserCombinators.Parsec.Expr\nimport Text.Parsec.Language (haskell)\nimport qualified Text.Parsec.Token as P\nimport Text.Parsec.String (Parser)\n\ndata RT = Comp RT RT        \n        | Conv RT           \n        | Var String\n        deriving (Show)\n\nwhiteSpace = P.whiteSpace haskell\nword = P.identifier haskell\nparens = P.parens haskell\nopChar = \"^;\"\n\nreservedOp2 :: String -&gt; CharParser st ()\nreservedOp2 name = try (string name &gt;&gt; notFollowedBy (oneOf opChar) &gt;&gt; whiteSpace)\n\n\nterm = parens relexpr\n       &lt;|&gt; Var &lt;$&gt; word\n       &lt;?&gt; \"term\"\n\ntable = [ [postfix \"^\" Conv]\n        , [binary \";\" Comp AssocLeft]\n        ]\n\nprefix  name fun = Prefix  $ reservedOp2 name &gt;&gt; return fun\nbinary  name fun = Infix   $ reservedOp2 name &gt;&gt; return fun\npostfix name fun = Postfix $ reservedOp2 name &gt;&gt; return fun\n\nrelexpr :: Parser RT\nrelexpr = buildExpressionParser table term &lt;?&gt; \"expression\"\n</code></pre>\n"}, {"tags": ["haskell", "persistent", "blaze-html", "haskell-spock"], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 5225690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67697ac4331f98418f1a18fbde4ded02?s=128&d=identicon&r=PG&f=1", "display_name": "SanShin", "link": "https://stackoverflow.com/users/5225690/sanshin"}, "edited": false, "score": 0, "creation_date": 1439537655, "post_id": 32001813, "comment_id": 51911948, "body": "Thanks, it seems that moving out loadFlightSeat works. Though I still have confusion on why I should move it out to Spock monad (despite it&#39;s the same kind of monad). Thanks a lot again!"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 5, "user_id": 5225690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67697ac4331f98418f1a18fbde4ded02?s=128&d=identicon&r=PG&f=1", "display_name": "SanShin", "link": "https://stackoverflow.com/users/5225690/sanshin"}, "edited": false, "score": 0, "creation_date": 1439563649, "post_id": 32001813, "comment_id": 51928038, "body": "@SanShin If I understand your doubt correctly, it seems you are mixing up something being in a <code>do</code>-block of some monad  with it being in a <code>where</code> clause below a <code>do</code>-block. For the purposes of your question, it doesn&#39;t really matter where you define a value like <code>loadFlightSeat</code> (i.e. whether it is in top level, a <code>where</code> clause, a <code>let</code> expression, etc.). What specifies to which monad the value belongs to, and how you have to use, is its type."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1439522942, "creation_date": 1439522942, "answer_id": 32001813, "question_id": 32001453, "link": "https://stackoverflow.com/questions/32001453/blaze-html-type-error-inside-form-block/32001813#32001813", "title": "Blaze-html type error inside forM_ block", "body": "<p><em>Disclaimer: I didn't run your code.</em></p>\n\n<blockquote>\n  <p>I know <code>runSQL</code> is a wrapper from persistent to Spock</p>\n</blockquote>\n\n<p>Exactly, and there lies your issue. The type of <code>runSQL</code> is:</p>\n\n<pre><code>runSQL :: (HasSpock m, SpockConn m ~ SqlBackend)\n       =&gt; SqlPersistT (NoLoggingT (ResourceT IO)) a -&gt; m a\n</code></pre>\n\n<p>The result type, <code>(HasSpock m, SpockConn m ~ SqlBackend) =&gt; m a</code>, tells us that <code>runSQL</code> gives a result in the Spock monad. Therefore, <code>loadFlightSeat</code> should be a Spock monad computation as well. However, you gave it type <code>H.Html</code>, which has nothing to do with the Spock monad. The issue will probably go away if you remove the mistaken type signature of <code>loadFlightSeat</code> and adjust your usage of <code>loadFlightSeat</code> accordingly:</p>\n\n<pre><code>     flightSeat &lt;- loadFlightSeat -- Returns an H.Html value in the Spock monad.\n     case fs of\n        [] -&gt; blaze $ template False (showResultAlertBar False \"Oops, something went wrong! Please try again.\")\n        _  -&gt; blaze $ template True (H.toHtml $ usersUsername l) flightSeat\n</code></pre>\n\n<p>P.S.: The type error you got...</p>\n\n<pre><code>Couldn't match expected type \u2018SqlBackend\u2019\n        with actual type \u2018SpockConn Text.Blaze.Internal.MarkupM\u2019\nIn the expression: runSQL\nIn a stmt of a 'do' block:\n   sid &lt;- runSQL $ getSeatIdByFlight fs' c\n</code></pre>\n\n<p>...is unusually weird because <code>H.Html</code> <a href=\"https://hackage.haskell.org/package/blaze-html-0.8.1.0/docs/Text-Blaze-Html.html\" rel=\"nofollow\">happens to be a synonym for <code>MarkupM ()</code></a>, with <code>MarkupM</code> being a monad defined by <code>blaze</code>. As a consequence, the signature you gave to <code>loadFlightSeat</code> leads the compiler to attempt matching Spock's monad with <code>MarkupM</code>. </p>\n"}], "owner": {"reputation": 5, "user_id": 5225690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67697ac4331f98418f1a18fbde4ded02?s=128&d=identicon&r=PG&f=1", "display_name": "SanShin", "link": "https://stackoverflow.com/users/5225690/sanshin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 32001813, "answer_count": 1, "score": 0, "last_activity_date": 1439522988, "creation_date": 1439519933, "last_edit_date": 1439522988, "question_id": 32001453, "link": "https://stackoverflow.com/questions/32001453/blaze-html-type-error-inside-form-block", "title": "Blaze-html type error inside forM_ block", "body": "<p>I'm just starting Haskell web development using Spock, persistent and blaze-html.</p>\n\n<p>In one of the routes I have, I want to load every row in my selected tables. I do something like this:</p>\n\n<pre><code>  get (\"/show/flight/\" &lt;//&gt; (var :: Var Integer)) $ \\f -&gt; requireUser $ \\(_, l) -&gt; do\n     fs &lt;- runSQL $ loadFlightInfos f\n\n     case fs of\n        [] -&gt; blaze $ template False (showResultAlertBar False \"Oops, something went wrong! Please try again.\")\n        _  -&gt; blaze $ template True (H.toHtml $ usersUsername l) loadFlightSeat\n\n           where\n              loadFlightSeat :: H.Html\n              loadFlightSeat =\n                 forM_ fs $ \\fs' -&gt; do\n                    sid &lt;- runSQL $ getSeatIdByFlight fs' c\n\n                    case sid of\n                       Nothing  -&gt; H.div H.! A.class_ \"alert alert-danger\" $ \"Oops, something went wrong! Please try again.\"\n                       Just rid -&gt; H.a H.! A.href (H.toValue $ \"/flight/seat/\" &lt;&gt; show c &lt;&gt; \"/\" &lt;&gt; show (fromIntegral $ (fromSqlKey . entityKey) sid)) H.! A.class_ \"btn btn-theme\" $ H.toHtml fs'\n</code></pre>\n\n<p><code>loadFlightInfos</code> has type:</p>\n\n<pre><code>Integer -&gt; SqlPersistM [Entity Flight]\n</code></pre>\n\n<p>and getSeatIdByFlight: </p>\n\n<pre><code>T.Text -&gt; Integer -&gt; SqlPersistM (Maybe (Entity Flight))\n</code></pre>\n\n<p>I copied <code>runSQL</code> from Spock's blog sample app, and it's something like this:</p>\n\n<pre><code>runSQL :: (HasSpock m, SpockConn m ~ SqlBackend) =&gt; SqlPersistT (NoLoggingT (ResourceT IO)) a -&gt; m a\nrunSQL action = runQuery $ \\conn -&gt; runResourceT $ runNoLoggingT $ runSqlConn action conn\n</code></pre>\n\n<p>The type error I got:</p>\n\n<pre><code>Couldn't match expected type \u2018SqlBackend\u2019\n        with actual type \u2018SpockConn Text.Blaze.Internal.MarkupM\u2019\nIn the expression: runSQL\nIn a stmt of a 'do' block:\n   sid &lt;- runSQL $ getSeatIdByFlight fs' c\n</code></pre>\n\n<p>I still don't understand this type error, because I know <code>runSQL</code> is a wrapper from persistent to Spock and if I simply just want to output HTML, why can't it pass type checking?</p>\n\n<p>How do I resolve this type error?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1439520384, "post_id": 32000254, "comment_id": 51906155, "body": "These are two completely different questions. I strongly recommend you pick one to keep here; make an edit to delete the other one and open a fresh question with it instead."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1439527710, "post_id": 32000254, "comment_id": 51907790, "body": "You probably want to define a type rather than a class. Classes in Haskell are not types."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 2, "creation_date": 1439527991, "post_id": 32000254, "comment_id": 51907875, "body": "If you&#39;re coming from Java, a typeclass in Haskell is more akin to an interface in Java. Haskell typeclasses are NOT OO classes."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 4673465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb15bf9bd51fe0e2e075f96520c128a?s=128&d=identicon&r=PG&f=1", "display_name": "Wazed", "link": "https://stackoverflow.com/users/4673465/wazed"}, "edited": false, "score": 0, "creation_date": 1439594377, "post_id": 32002405, "comment_id": 51942152, "body": "I actually need the class and there are lots of things defined on this class, after finishing the code when I was trying to make an example to run the system, the issue arrived. Anyway, I fixed it as follows, thanks a lot.      data A = A | C | F     instance FiniteSet Char where         elements = [A,C,F]"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 21, "user_id": 4673465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb15bf9bd51fe0e2e075f96520c128a?s=128&d=identicon&r=PG&f=1", "display_name": "Wazed", "link": "https://stackoverflow.com/users/4673465/wazed"}, "edited": false, "score": 0, "creation_date": 1439666342, "post_id": 32002405, "comment_id": 51958324, "body": "@Wazed Why do you say you need the class?"}, {"owner": {"reputation": 21, "user_id": 4673465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb15bf9bd51fe0e2e075f96520c128a?s=128&d=identicon&r=PG&f=1", "display_name": "Wazed", "link": "https://stackoverflow.com/users/4673465/wazed"}, "edited": false, "score": 0, "creation_date": 1439691110, "post_id": 32002405, "comment_id": 51963745, "body": "Hi, this is because I have a long system defined on the FiniteSet class. Adopting something else now would make the situation even worse and I actually don&#39;t have much time left, that&#39;s part of my research. Thanks."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 0, "last_activity_date": 1439527703, "last_edit_date": 1439527703, "creation_date": 1439527372, "answer_id": 32002405, "question_id": 32000254, "link": "https://stackoverflow.com/questions/32000254/creating-two-finite-sets-using-a-class/32002405#32002405", "title": "Creating two finite sets using a class", "body": "<p>Ok I'll try to give you some hints on my opinion on this.</p>\n\n<p>The first question you should ask yourself is <strong>Do I need a <code>class</code></strong>? (I don't think so here but let's go with it).</p>\n\n<hr>\n\n<p>The way you choose to do it tells us this:</p>\n\n<p>When a type <code>a</code> is an instance of <code>FinitSet</code> then we can get <strong>one</strong> list of elements <code>[a]</code> back and that is one for the <em>type</em> not a value of the type - which I doubt is what you want.</p>\n\n<p>Maybe you thought to have something like this:</p>\n\n<pre><code>class FiniteSet a where\n    elements :: a -&gt; [a]\n</code></pre>\n\n<p>Here you could get some list for a given value but still this looks strange doesn't it? Given a value you get yet more of the same? So maybe you the type of the elements you get should be different from the instance-type?</p>\n\n<pre><code>class FiniteSet i e where\n    elements :: i -&gt; [e]\n</code></pre>\n\n<p>but now you will certainly run into situations where you wonder why <code>i</code> does not imply <code>e</code> and you will search and look and find <em>Functional Dependencies</em> and stuff and it will more complicated by the second.</p>\n\n<p>So I think you don't really want it that way.</p>\n\n<hr>\n\n<p>Maybe instead you want to capture the essence of what it is to be a set - something like:</p>\n\n<pre><code>class FiniteSet i e where\n    count   :: i -&gt; Int\n    empty   :: i\n    isElem  :: i -&gt; e -&gt; Bool\n    addElem :: i -&gt; e -&gt; i\n</code></pre>\n\n<p>this way you could end up with something like this:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FunctionalDependencies #-}\n\nmodule FinSet where\n\nclass FiniteSet i e | i -&gt; e where\n  count   :: i -&gt; Int\n  empty   :: i\n  isElem  :: e -&gt; i -&gt; Bool\n  addElem :: i -&gt; e -&gt; i\n\ninstance Eq a =&gt; FiniteSet [a] a where\n  count xs     = length xs\n  empty        = []\n  isElem x xs  = x `elem` xs\n  addElem xs x = if x `elem` xs then xs else x:xs\n</code></pre>\n\n<p>see how you still need lot's of extensions just to define an instance for a simple list that just uses what you already have in a list?</p>\n\n<hr>\n\n<h3>remark</h3>\n\n<p>This is what I meant when I told you that I don't think you need/want a class as it seems that you just want a type-synonym/<code>newtype</code> for a list</p>\n\n<hr>\n\n<p>Anyway this will give you some way to construct sets:</p>\n\n<pre><code>\u03bb&gt; let fin = (empty `addElem` 'a' `addElem` 'b' `addElem` 'c')\n\n\u03bb&gt; count fin\n3\n\u03bb&gt; 'b' `isElem` fin\nTrue\n\u03bb&gt; 'd' `isElem` fin\nFalse\n\u03bb&gt; fin `addElem` 'a'\n\"cba\"\n</code></pre>\n\n<hr>\n\n<p>the problem of course is that you will not get any gurantee that will even be finite (it's just lists for this instance) and to be honest I don't see a way to <em>rescue</em> us in this situation right now:</p>\n\n<pre><code>\u03bb&gt; let nats = foldr (flip addElem) empty [0..]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1439589153, "last_edit_date": 1439589153, "creation_date": 1439574059, "answer_id": 32015836, "question_id": 32000254, "link": "https://stackoverflow.com/questions/32000254/creating-two-finite-sets-using-a-class/32015836#32015836", "title": "Creating two finite sets using a class", "body": "<p>You probably just want to say</p>\n\n<pre><code>type FiniteSet a = [a]\na = ['a', 'c', 'f'] -- = \"acf\"\nb = ['x', 'y']      -- = \"xy\"\n</code></pre>\n\n<p>or possibly</p>\n\n<pre><code>newtype FiniteSet a = FiniteSet { elements :: [a] }\na = FiniteSet ['a', 'c', 'f']\nb = FiniteSet ['x', 'y']\n</code></pre>\n\n<p>if you want to make sure you don't mix up <code>FiniteSet</code>s and lists.</p>\n"}], "owner": {"reputation": 21, "user_id": 4673465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb15bf9bd51fe0e2e075f96520c128a?s=128&d=identicon&r=PG&f=1", "display_name": "Wazed", "link": "https://stackoverflow.com/users/4673465/wazed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1439589153, "creation_date": 1439509849, "last_edit_date": 1439523893, "question_id": 32000254, "link": "https://stackoverflow.com/questions/32000254/creating-two-finite-sets-using-a-class", "title": "Creating two finite sets using a class", "body": "<p>I have defined a class for a finite set as follows:</p>\n\n<pre><code>class FiniteSet a where\nelements :: [a]\n</code></pre>\n\n<p>Now, I want to create two Char set, let's say A = {'a','c','f'} and B = {'x','y'}. How would I do that? However, I tried to create a Char instance as follows, but what after that?</p>\n\n<pre><code>instance FiniteSet Char where\nelements = []\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "edited": false, "score": 9, "creation_date": 1439505899, "post_id": 31999322, "comment_id": 51902624, "body": "Ray tracing is a pure computation and shouldn&#39;t need to be in the IO monad.  You&#39;ll need IO at the beginning to load your scene and any textures or whatever into memory, and IO at the end to write out an image, but the actual rendering can be a pure function call that takes a scene as an argument and returns the rendered image."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439508905, "post_id": 31999322, "comment_id": 51903525, "body": "You may ultimately want to work in <code>ST</code> (more generally, <code>PrimMonad</code>) with unboxed mutable vectors for speed, but you probably don&#39;t want to start there."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 6, "creation_date": 1439508909, "post_id": 31999322, "comment_id": 51903527, "body": "It looks like you are using <code>IO</code> for randomness.  Use <a href=\"https://hackage.haskell.org/package/MonadRandom\" rel=\"nofollow noreferrer\"><code>MonadRandom</code></a> instead."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1439509191, "post_id": 31999322, "comment_id": 51903599, "body": "Nevermind this will not solve your problem (though in general MonadRandom is better for randomness than <code>IO</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "edited": false, "score": 0, "creation_date": 1595853734, "post_id": 32000364, "comment_id": 111609088, "body": "Lennart Augustsson, Mikael Rittri, and Dan Synek describe this technique in their functional pearl <i>On generating unique names</i>. For a working example, see ghc-8.6.5/compiler/basicTypes/Unique.hs."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 10, "last_activity_date": 1439515205, "last_edit_date": 1439515205, "creation_date": 1439510613, "answer_id": 32000364, "question_id": 31999322, "link": "https://stackoverflow.com/questions/31999322/does-haskell-provides-a-way-to-evaluate-io-monad-immediately/32000364#32000364", "title": "Does Haskell provides a way to evaluate IO monad immediately?", "body": "<p>First, I think there is an error.  When you talk about going from </p>\n\n<pre><code>pixels &lt;- sequence [ (sumOfRadiance scene ray samples) | ray &lt;- rays]\n</code></pre>\n\n<p>to</p>\n\n<pre><code>pixels &lt;- sequence [ (unsafePerformIO (sumOfRadiance scene ray samples)) | ray &lt;- rays]\n</code></pre>\n\n<p>that doesn't make sense.  The types shouldn't match up -- <code>sequence</code> only makes sense if you are combining a bunch of things of type <code>m a</code>.  It would be correct to do</p>\n\n<pre><code>let pixels = [ unsafePerformIO (sumOfRadiance scene ray samples) | ray &lt;- rays ]\n</code></pre>\n\n<p>I will somewhat cavalierly assume that that is what you did and you simply made a mistake when entering your question.</p>\n\n<p>If this is the case, then what you are actually looking for is a way to execute <code>IO</code> actions <em>more lazily</em>, not more immediately.  The <code>sequence</code> call forces all the actions to be run right then, whereas the <code>unsafePerformIO</code> version simply creates a list of un-run actions (and indeed the list itself is generated lazily so it doesn't exist all at once), and the actions are run individually as their results are needed.</p>\n\n<p>It appears that the reason you need <code>IO</code> is to generate random numbers.  Randomness can be kind of a pain -- usually <a href=\"https://hackage.haskell.org/package/MonadRandom\" rel=\"noreferrer\"><code>MonadRandom</code></a> does the job, but it still creates a sequential dependence between actions and may still not be lazy enough (I'd give it a try -- if you use it you get reproducibility -- the same seed gives the same results, even after refactorings that respect the monad laws).</p>\n\n<p>If <code>MonadRandom</code> doesn't work and you need to generate random numbers in a more on-demand way, the way would be to make your own randomness monad which does the same thing as your <code>unsafePerformIO</code> solution, but in a way that is properly encapsulated.  I'm going to show you the way I consider to be the Haskell Way To Cheat.  First, a lovely pure implementation sketch:</p>\n\n<pre><code>-- A seed tells you how to generate random numbers\ndata Seed = ...\nsplitSeed :: Seed -&gt; (Seed, Seed)\nrandom :: Seed -&gt; Double\n\n-- A Cloud is a probability distribution of a's, or an a which\n-- depends on a random seed.  This monad is just as lazy as a\n-- pure computation.\nnewtype Cloud a = Cloud { runCloud :: Seed -&gt; a }\n    deriving (Functor)\n\ninstance Monad Cloud where\n    return = Cloud . const\n    m &gt;&gt;= f = Cloud $ \\seed -&gt;\n        let (seed1, seed2) = splitSeed seed in\n        runCloud (f (runCloud m seed1)) seed2\n</code></pre>\n\n<p>(I think I got that right.  The point is that at every bind you split the seed in two and pass one to the left and the other to the right.)</p>\n\n<p>Now this is a perfectly pure implementation of randomness... with a couple catches.  (1) there is no non-trivial <code>splitSeed</code> which will <em>strictly</em> respect the monad laws, and (2) even if we allow the laws to be broken, random number generators based on splitting can be pretty slow.  But if we give up determinism, if all we care about is that we get a good sampling from the distribution rather than the exact same result, then we don't need to strictly respect the monad laws.  And at that point we cheat and pretend there is a suitable <code>Seed</code> type:</p>\n\n<pre><code>data Seed = Seed\nsplitSeed Seed = (Seed, Seed)\n\n-- Always NOINLINE functions with unsafePerformIO to keep the \n-- optimizer from messing with you.\n{-# NOINLINE random #-}\nrandom Seed = unsafePerformIO randomIO\n</code></pre>\n\n<p>We should hide this inside a module to keep the abstraction barrier clear.  <code>Cloud</code> and <code>runCloud</code> should not be exposed since they allow us to violate purity; expose only</p>\n\n<pre><code>runCloudIO :: Cloud a -&gt; IO a\nrunCloudIO = return . runCloud\n</code></pre>\n\n<p>which doesn't technically need <code>IO</code>, but communicates that this will not be deterministic.  Then you can build up whatever you need as a value in the <code>Cloud</code> monad, and run it once in your main program.</p>\n\n<p>You might ask why we have a <code>Seed</code> type at all if it doesn't have any information.  Well, I think <code>splitSeed</code> is just a nod to purity and isn't actually doing anything -- you could remove it -- but we need <code>Cloud</code> to be a function type so that the implicit caching of laziness doesn't break our semantics.  Otherwise</p>\n\n<pre><code>let foo = random in liftM2 (,) foo foo\n</code></pre>\n\n<p>would always return a pair with two identical components, since the random value was really associated with <code>foo</code>.   I am not sure about these things since at this point we are at war with the optimizer, it takes some experimentation.</p>\n\n<p>Happy cheating. :-)</p>\n"}], "owner": {"reputation": 195, "user_id": 2854172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94870c02836167043f37f05ae1032690?s=128&d=identicon&r=PG", "display_name": "tatsy", "link": "https://stackoverflow.com/users/2854172/tatsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 32000364, "answer_count": 1, "score": 4, "last_activity_date": 1439516038, "creation_date": 1439504099, "last_edit_date": 1439516038, "question_id": 31999322, "link": "https://stackoverflow.com/questions/31999322/does-haskell-provides-a-way-to-evaluate-io-monad-immediately", "title": "Does Haskell provides a way to evaluate IO monad immediately?", "body": "<p>I am currently making a ray tracing program with Haskell. As I am a very beginner of Haskell, I don't understand the evaluation strategy of IO monad clearly.</p>\n\n<p>The problem is the memory usage of a long list of \"IO a\", which is \"IO Vec\" in my code.</p>\n\n<p>Each element of the list is computed by a recursive function that compute <code>IO Vec</code> which represents the color for a pixel. Therefore, the length of the list is equals to <code>width x height</code>.</p>\n\n<p>In addition, I take multiple samples for a pixels. As a whole, the function <code>radiance</code> to compute pixel value is called <code>width x height x samples</code> times.</p>\n\n<p>First I was implemented this program simply by using list comprehension. The code is like,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = do\n    ...\n    let ray = (compute ray for every pair of [0..w-1], [0..h-1]\n    pixels &lt;- sequence [ (sumOfRadiance scene ray samples) | ray &lt;- rays]\n</code></pre>\n\n<p>In my understanding, as pixels is not used before it is written to a file, Haskell stores some data for function call inside <code>pixels</code> which is an array of <code>IO Vec</code>. Finally, memory consumption increases by calling recursive function <code>radiance</code> to compute pixel values.</p>\n\n<p>If I change the program to evaluate the pixel value one by one using <code>unsafePerformIO</code> can prevent this strange use of memory space. </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = do\n    ...\n    let ray = (compute ray for every pair of [0..w-1], [0..h-1]\n    let pixels = [ (unsafePerformIO (sumOfRadiance scene ray samples)) | ray &lt;- rays]\n</code></pre>\n\n<p>I know unsafePerformIO is a bad solution, so I'd like to know if Haskell provides another way to evaluate inside of IO monad immediately. The following is the whole of my code (Sorry, it's a bit long...)</p>\n\n<p>Thank you for your help.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Small path tracing with Haskell\nimport System.Environment\nimport System.Random.Mersenne\nimport System.IO.Unsafe\nimport Control.Monad\nimport Codec.Picture\nimport Data.Time\nimport qualified Data.Word as W\nimport qualified Data.Vector.Storable as V\n\n-- Parameters\neps :: Double\neps = 1.0e-4\n\ninf :: Double\ninf = 1.0e20\n\nnc :: Double\nnc  = 1.0\n\nnt :: Double\nnt  = 1.5\n\n-- Vec\ndata Vec = Vec (Double, Double, Double) deriving (Show)\ninstance (Num Vec) where\n    (Vec (x, y, z)) + (Vec (a, b, c)) = Vec (x + a, y + b, z + c)\n    (Vec (x, y, z)) - (Vec (a, b, c)) = Vec (x - a, y - b, z - c)\n    (Vec (x, y, z)) * (Vec (a, b, c)) = Vec (x * a, y * b, z * c)\n    abs = undefined\n    signum = undefined\n    fromInteger x = Vec (dx, dx, dx) where dx = fromIntegral x\n\nx :: Vec -&gt; Double\nx (Vec (x, _, _)) = x\n\ny :: Vec -&gt; Double\ny (Vec (_, y, _)) = y\n\nz :: Vec -&gt; Double\nz (Vec (_, _, z)) = z\n\nmul :: Vec -&gt; Double -&gt; Vec\nmul (Vec (x, y, z)) s = Vec (x * s, y * s, z * s)\n\ndot :: Vec -&gt; Vec -&gt; Double\ndot (Vec (x, y, z)) (Vec (a, b, c))  = x * a + y * b + z * c\n\nnorm :: Vec -&gt; Vec\nnorm (Vec (x, y, z)) = Vec (x * invnrm, y * invnrm, z * invnrm)\n    where invnrm = 1 / sqrt (x * x + y * y + z * z)\n\ncross :: Vec -&gt; Vec -&gt; Vec\ncross (Vec (x, y, z)) (Vec (a, b, c)) = Vec (y * c - b * z, z * a - c * x, x * b - a * y)\n\n-- Ray\ndata Ray = Ray (Vec, Vec) deriving (Show)\n\norg :: Ray -&gt; Vec\norg (Ray (org, _)) = org\n\ndir :: Ray -&gt; Vec\ndir (Ray (_, dir)) = dir\n\n-- Material\ndata Refl = Diff\n          | Spec\n          | Refr\n          deriving Show\n\n-- Sphere\ndata Sphere = Sphere (Double, Vec, Vec, Vec, Refl) deriving (Show)\n\nrad :: Sphere -&gt; Double\nrad  (Sphere (rad, _, _, _, _   )) = rad\n\npos :: Sphere -&gt; Vec\npos  (Sphere (_  , p, _, _, _   )) = p\n\nemit :: Sphere -&gt; Vec\nemit (Sphere (_  , _, e, _, _   )) = e\n\ncol :: Sphere -&gt; Vec\ncol  (Sphere (_  , _, _, c, _   )) = c\n\nrefl :: Sphere -&gt; Refl\nrefl (Sphere (_  , _, _, _, refl)) = refl\n\nintersect :: Sphere -&gt; Ray -&gt; Double\nintersect sp ray =\n    let op  = (pos sp) - (org ray)\n        b   = op `dot` (dir ray)\n        det = b * b - (op `dot` op) + ((rad sp) ** 2)\n    in\n        if det &lt; 0.0\n            then inf\n            else\n                let sqdet = sqrt det\n                    t1    = b - sqdet\n                    t2    = b + sqdet\n                in ansCheck t1 t2\n                      where ansCheck t1 t2\n                                | t1 &gt; eps  = t1\n                                | t2 &gt; eps  = t2\n                                | otherwise = inf\n\n-- Scene\ntype Scene = [Sphere]\nsph :: Scene\nsph = [ Sphere (1e5,  Vec ( 1e5+1,  40.8, 81.6),    Vec (0.0, 0.0, 0.0), Vec (0.75, 0.25, 0.25),  Diff)   -- Left\n      , Sphere (1e5,  Vec (-1e5+99, 40.8, 81.6),    Vec (0.0, 0.0, 0.0), Vec (0.25, 0.25, 0.75),  Diff)   -- Right\n      , Sphere (1e5,  Vec (50.0, 40.8,  1e5),       Vec (0.0, 0.0, 0.0), Vec (0.75, 0.75, 0.75),  Diff)   -- Back\n      , Sphere (1e5,  Vec (50.0, 40.8, -1e5+170),   Vec (0.0, 0.0, 0.0), Vec (0.0, 0.0, 0.0),     Diff)   -- Front\n      , Sphere (1e5,  Vec (50, 1e5, 81.6),          Vec (0.0, 0.0, 0.0), Vec (0.75, 0.75, 0.75),  Diff)   -- Bottom\n      , Sphere (1e5,  Vec (50,-1e5+81.6,81.6),      Vec (0.0, 0.0, 0.0), Vec (0.75, 0.75, 0.75),  Diff)   -- Top\n      , Sphere (16.5, Vec (27, 16.5, 47),           Vec (0.0, 0.0, 0.0), Vec (1,1,1) `mul` 0.999, Spec)   -- Mirror\n      , Sphere (16.5, Vec (73, 16.5, 78),           Vec (0.0, 0.0, 0.0), Vec (1,1,1) `mul` 0.999, Refr)   -- Glass\n      , Sphere (600,  Vec (50, 681.6 - 0.27, 81.6), Vec (12, 12, 12),    Vec (0, 0, 0),           Diff) ] -- Light\n\n-- Utility functions\nclamp :: Double -&gt; Double\nclamp = (max 0.0) . (min 1.0)\n\nisectWithScene :: Scene -&gt; Ray -&gt; (Double, Int)\nisectWithScene scene ray = foldr1 (min) $ zip [ intersect sph ray | sph &lt;- scene ] [0..]\n\nnextDouble :: IO Double\nnextDouble = randomIO\n\nlambert :: Vec -&gt; Double -&gt; Double -&gt; (Vec, Double)\nlambert n r1 r2 =\n    let th  = 2.0 * pi * r1\n        r2s = sqrt r2\n        w = n\n        u = norm $ (if (abs (x w)) &gt; eps then Vec (0, 1, 0) else Vec (1, 0, 0)) `cross` w\n        v = w `cross` u\n        uu = u `mul` ((cos th) * r2s)\n        vv = v `mul` ((sin th) * r2s)\n        ww = w `mul` (sqrt (1.0 - r2))\n        rdir = norm (uu + vv + ww)\n    in (rdir, 1)\n\nreflect :: Vec -&gt; Vec -&gt; (Vec, Double)\nreflect v n =\n    let rdir = v - (n `mul` (2.0 * n `dot` v))\n    in (rdir, 1)\n\nrefract :: Vec -&gt; Vec -&gt; Vec -&gt; Double -&gt; (Vec, Double)\nrefract v n orn rr =\n    let (rdir, _) = reflect v orn\n        into = (n `dot` orn) &gt; 0\n        nnt  = if into then (nc / nt) else (nt / nc)\n        ddn  = v `dot` orn\n        cos2t = 1.0 - nnt * nnt * (1.0 - ddn * ddn)\n    in\n        if cos2t &lt; 0.0\n            then (rdir, 1.0)\n            else\n                let tdir = norm $ ((v `mul` nnt) -) $ n `mul` ((if into then 1 else -1) * (ddn * nnt + (sqrt cos2t)))\n                    a = nt - nc\n                    b = nt + nc\n                    r0 = (a * a) / (b * b)\n                    c = 1.0 - (if into then -ddn else (tdir `dot` n))\n                    re = r0 + (1 - r0) * (c ** 5)\n                    tr = 1.0 - re\n                    pp = 0.25 + 0.5 * re\n                in\n                    if rr &lt; pp\n                         then (rdir, (pp / re))\n                         else (tdir, ((1.0 - pp) / tr))\n\nradiance :: Scene -&gt; Ray -&gt; Int -&gt; IO Vec\nradiance scene ray depth = do\n    let (t, i) = (isectWithScene scene ray)\n    if inf &lt;= t\n        then return (Vec (0, 0, 0))\n        else do\n            r0 &lt;- nextDouble\n            r1 &lt;- nextDouble\n            r2 &lt;- nextDouble\n            let obj = (scene !! i)\n            let c = col obj\n            let prob = (max (x c) (max (y c) (z c)))\n            if depth &gt;= 5 &amp;&amp; r0 &gt;= prob\n                then return (emit obj)\n                else do\n                    let rlt = if depth &lt; 5 then 1 else prob\n                    let f = (col obj)\n                    let d = (dir ray)\n                    let x = (org ray) + (d `mul` t)\n                    let n = norm $ x - (pos obj)\n                    let orn = if (d `dot` n) &lt; 0.0  then n else (-n)\n                    let (ndir, pdf) = case (refl obj) of\n                            Diff -&gt; (lambert orn r1 r2)\n                            Spec -&gt; (reflect d orn)\n                            Refr -&gt; (refract d n orn r1)\n                    nextRad &lt;- (radiance scene (Ray (x, ndir)) (succ depth))\n                    return $ ((emit obj) + ((f * nextRad) `mul` (1.0 / (rlt * pdf))))\n\ntoByte :: Double -&gt; W.Word8\ntoByte x = truncate (((clamp x) ** (1.0 / 2.2)) * 255.0) :: W.Word8\n\naccumulateRadiance :: Scene -&gt; Ray -&gt; Int -&gt; Int -&gt; IO Vec\naccumulateRadiance scene ray d m = do\n    let rays = take m $ repeat ray\n    pixels &lt;- sequence [radiance scene r 0 | r &lt;- rays]\n    return $ (foldr1 (+) pixels) `mul` (1 / fromIntegral m)\n\nmain :: IO ()\nmain = do\n    args &lt;- getArgs\n    let argc = length args\n    let w   = if argc &gt;= 1 then (read (args !! 0)) else 400 :: Int\n    let h   = if argc &gt;= 2 then (read (args !! 1)) else 300 :: Int\n    let spp = if argc &gt;= 3 then (read (args !! 2)) else 4   :: Int\n\n    startTime &lt;- getCurrentTime\n\n    putStrLn \"-- Smallpt.hs --\"\n    putStrLn $ \"  width = \" ++ (show w)\n    putStrLn $ \" height = \" ++ (show h)\n    putStrLn $ \"    spp = \" ++ (show spp)\n\n    let dw = fromIntegral w :: Double\n    let dh = fromIntegral h :: Double\n\n    let cam = Ray (Vec (50, 52, 295.6), (norm $ Vec (0, -0.042612, -1)));\n    let cx  = Vec (dw * 0.5135 / dh, 0.0, 0.0)\n    let cy  = (norm $ cx `cross` (dir cam)) `mul` 0.5135\n    let dirs = [ norm $ (dir cam) + (cy `mul` (y / dh  - 0.5)) + (cx `mul` (x / dw - 0.5)) | y &lt;- [dh-1,dh-2..0], x &lt;- [0..dw-1] ]\n    let rays = [ Ray ((org cam) + (d `mul` 140.0), (norm d)) | d &lt;- dirs ]\n\n    let pixels = [ (unsafePerformIO (accumulateRadiance sph r 0 spp)) | r &lt;- rays ]\n\n    let pixelData = map toByte $! pixels `seq` (foldr (\\col lst -&gt; [(x col), (y col), (z col)] ++ lst) [] pixels)\n    let pixelBytes = V.fromList pixelData :: V.Vector W.Word8\n    let img = Image { imageHeight = h, imageWidth = w, imageData = pixelBytes } :: Image PixelRGB8\n    writePng \"image.png\" img\n\n    endTime &lt;- getCurrentTime\n    print $ diffUTCTime endTime startTime\n</code></pre>\n"}, {"tags": ["haskell", "gtk", "cabal", "c2hs"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439505726, "post_id": 31999191, "comment_id": 51902567, "body": "Just a quick comment, haven&#39;t had time to look enough to write an answer: <code>.chs</code> files are not generated by <code>gtk2hsC2hs</code>; they are written by hand, and processed by <code>gtk2hsC2hs</code> to produce <code>.hs</code> files. If you want, you can look in those files; <code>cabal</code> stores them in the <code>dist</code> directory. There will be pragmas pointing back from the <code>.hs</code> file to the <code>.chs</code> file, which is how GHC knows where in the <code>.chs</code> file to point in its errors."}, {"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1439507981, "post_id": 31999191, "comment_id": 51903262, "body": "Ok thanks for the tip. I&#39;ll look into that."}], "answers": [{"comments": [{"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 1, "creation_date": 1441704422, "post_id": 32053264, "comment_id": 52770246, "body": "Just helped me. I can confirm that it works on MacOSX 10.8. Thanks! :)"}, {"owner": {"reputation": 3422, "user_id": 1988505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3281bec4f80318de1f897786661f9e4?s=128&d=identicon&r=PG", "display_name": "Wesley Baugh", "link": "https://stackoverflow.com/users/1988505/wesley-baugh"}, "edited": false, "score": 3, "creation_date": 1466298957, "post_id": 32053264, "comment_id": 63259163, "body": "Stack variant (e.g., for installing threadscope): <code>stack install --flag gtk:have-quartz-gtk threadscope</code>"}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1614186815, "post_id": 32053264, "comment_id": 117311149, "body": "Neither of these workarounds help on catalina in 2021 :/"}], "tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": true, "score": 23, "last_activity_date": 1439822537, "creation_date": 1439822537, "answer_id": 32053264, "question_id": 31999191, "link": "https://stackoverflow.com/questions/31999191/cabal-install-gtk-failing/32053264#32053264", "title": "Cabal install gtk failing", "body": "<p>This had a really simple solution.  </p>\n\n<pre><code>cabal install gtk -fhave-quartz-gtk\n</code></pre>\n\n<p>It would be nice if this was more well documented, but hopefully this will help anyone else that ends up in a similar situation</p>\n"}], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1070, "favorite_count": 0, "accepted_answer_id": 32053264, "answer_count": 1, "score": 21, "last_activity_date": 1439822537, "creation_date": 1439503460, "last_edit_date": 1439562273, "question_id": 31999191, "link": "https://stackoverflow.com/questions/31999191/cabal-install-gtk-failing", "title": "Cabal install gtk failing", "body": "<p>I'm trying to install gtk via cabal, however, I'm getting the following type errors when building it</p>\n\n<pre><code>[ 22 of 209] Compiling Graphics.UI.Gtk.Embedding.Plug ( dist/build/Graphics/UI/Gtk/Embedding/Plug.hs, dist/build/Graphics/UI/Gtk/Embedding/Plug.o )\n\nGraphics/UI/Gtk/Embedding/Plug.chs:120:6: error:\n    Couldn't match expected type \u2018Ptr ()\u2019\n                with actual type \u2018Maybe DrawWindow\u2019\n    In the first argument of \u2018gtk_plug_new\u2019, namely\n      \u2018(fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018gtk_plug_new\n         (fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n\nGraphics/UI/Gtk/Embedding/Plug.chs:137:6: error:\n    Couldn't match expected type \u2018Ptr ()\u2019\n                with actual type \u2018Maybe DrawWindow\u2019\n    In the second argument of \u2018\\ (Display arg1) arg2\n                                 -&gt; withForeignPtr arg1\n                                    $ \\ argPtr1 -&gt; gtk_plug_new_for_display argPtr1 arg2\u2019, namely\n      \u2018(fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018(\\ (Display arg1) arg2\n          -&gt; withForeignPtr arg1\n             $ \\ argPtr1 -&gt; gtk_plug_new_for_display argPtr1 arg2)\n         display\n         (fromNativeWindowId (fromMaybe nativeWindowIdNone socketId))\u2019\n\nGraphics/UI/Gtk/Embedding/Plug.chs:151:3: error:\n    Couldn't match type \u2018Ptr ()\u2019 with \u2018Maybe DrawWindow\u2019\n    Expected type: IO (Maybe DrawWindow)\n      Actual type: IO (Ptr ())\n    In the second argument of \u2018($)\u2019, namely\n      \u2018(\\ (Plug arg1)\n          -&gt; withForeignPtr arg1 $ \\ argPtr1 -&gt; gtk_plug_get_id argPtr1)\n         (toPlug self)\u2019\n    In the expression:\n      liftM toNativeWindowId\n      $ (\\ (Plug arg1)\n           -&gt; withForeignPtr arg1 $ \\ argPtr1 -&gt; gtk_plug_get_id argPtr1)\n          (toPlug self)\nFailed to install gtk-0.13.9\ncabal: Error: some packages failed to install:\ngtk-0.13.9 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>To install this package, you need \"gtk2hsC2hs\" and the type errors are in <code>.chs</code> files, which presumably are generated from the gtk2hsC2hs tool.  Is this a known problem with gtk2hsC2hs?  Has anyone else been able to build this package?  Anyone know of a solution?  </p>\n\n<p>I'm on Mac OS X Yosemite (10.10.4)</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ gtk2hsC2hs --version\nC-&gt;Haskell Compiler, version 0.13.13 (gtk2hs branch) \"Bin IO\", 27 May 2012\n\n$ cabal --version\ncabal-install version 1.22.6.0\nusing version 1.22.4.0 of the Cabal library \n</code></pre>\n\n<p>I've done a <code>cabal update</code>, so all my packages appear to be up to date.  I've also tried building some of the older versions available from hackage, but I'm getting the same errors.  </p>\n\n<p><strong>Edit</strong></p>\n\n<p>The errors in the generated files, seem to all deal with the FFI imports that are getting generated by gtk2hsC2hs.  At the bottom of the file, I'm getting</p>\n\n<pre><code>foreign import ccall unsafe \"gtk_plug_new\"\n  gtk_plug_new :: ((Ptr ()) -&gt; (IO (Ptr Widget)))\n</code></pre>\n\n<p>It seems to consistently mix up <code>Ptr()</code> with <code>Maybe DrawWindow</code>.\nSo is the generated type <code>Ptr()</code> incorrect, or is the usage of it incorrect?  </p>\n"}, {"tags": ["haskell", "benchmarking", "haskell-stack"], "comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 2, "creation_date": 1439500500, "post_id": 31998500, "comment_id": 51900626, "body": "Have you configured <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#benchmarks\" rel=\"nofollow noreferrer\">cabal benchmarks</a>?"}, {"owner": {"reputation": 12902, "user_id": 207716, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c5db2fd504687aeda73c3561a83b43ac?s=128&d=identicon&r=PG", "display_name": "jk.", "link": "https://stackoverflow.com/users/207716/jk"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1439500851, "post_id": 31998500, "comment_id": 51900805, "body": "no, in fact I&#39;ve done very little with the cabal file as I used stack new to create the project which seems to create build and test targets ... but not bench"}], "answers": [{"tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": true, "score": 3, "last_activity_date": 1439580710, "creation_date": 1439580710, "answer_id": 32017451, "question_id": 31998500, "link": "https://stackoverflow.com/questions/31998500/how-to-use-stack-bench/32017451#32017451", "title": "How to use stack bench", "body": "<p><code>stack bench</code> will run any benchmark suites defined in your <code>foo.cabal</code> file.  Without seeing it it's hard to say more, note though that you can run with <code>-v</code> to get more output.</p>\n\n<p>From what I see above however I guess you don't have defined any benchmarks so <code>stack bench</code> does nothing because there is nothing to do :)</p>\n"}], "owner": {"reputation": 12902, "user_id": 207716, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c5db2fd504687aeda73c3561a83b43ac?s=128&d=identicon&r=PG", "display_name": "jk.", "link": "https://stackoverflow.com/users/207716/jk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 827, "favorite_count": 0, "accepted_answer_id": 32017451, "answer_count": 1, "score": 2, "last_activity_date": 1439580710, "creation_date": 1439500263, "question_id": 31998500, "link": "https://stackoverflow.com/questions/31998500/how-to-use-stack-bench", "title": "How to use stack bench", "body": "<p>I've been playing around with using stack for a little haskell application, so far I have been able to build and test fine and was interested in looking at performance so tried <code>stack bench</code> however this is all that seems to happen:</p>\n\n<pre><code>c:\\Users\\jk\\projects\\foo&gt;stack bench\nstack bench\n</code></pre>\n\n<p>I don't think it can have done anything? My application does not appear to have run. Presuembly there is some configuration I am missing?</p>\n"}, {"tags": ["haskell", "literals"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439497810, "post_id": 31997714, "comment_id": 51899394, "body": "` \\ ` is used in strings to escape certain things (like newlines ` \\n ` , tabs ` \\t ` and so on - to get the actual ` \\ ` character you have to escape this with the double-` \\\\ ` that should explain why you did get what you got - or so I hope )"}], "answers": [{"comments": [{"owner": {"reputation": 1539, "user_id": 2186301, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/GAisa.png?s=128&g=1", "display_name": "yulian", "link": "https://stackoverflow.com/users/2186301/yulian"}, "edited": false, "score": 0, "creation_date": 1439498484, "post_id": 31997907, "comment_id": 51899696, "body": "Just some kind of confusion because i&#39;m quite new to Haskell and thought that this symbol in a string means itself, but it&#39;s not. Thanks for an explanation and a link to a useful source!"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1539, "user_id": 2186301, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/GAisa.png?s=128&g=1", "display_name": "yulian", "link": "https://stackoverflow.com/users/2186301/yulian"}, "edited": false, "score": 4, "creation_date": 1439498684, "post_id": 31997907, "comment_id": 51899809, "body": "@id_yulian The backslash escape convention has been adopted by a very large number of programming languages, so it&#39;s not just a Haskell issue."}, {"owner": {"reputation": 1539, "user_id": 2186301, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/GAisa.png?s=128&g=1", "display_name": "yulian", "link": "https://stackoverflow.com/users/2186301/yulian"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1439498886, "post_id": 31997907, "comment_id": 51899912, "body": "@Ben now I see it. Maybe haskell  itself is hard-to-understand in the beginning and my brain is overheated) I guess (the more I learn and understand), I won&#39;t ask such blunt questions in future."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1539, "user_id": 2186301, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/GAisa.png?s=128&g=1", "display_name": "yulian", "link": "https://stackoverflow.com/users/2186301/yulian"}, "edited": false, "score": 2, "creation_date": 1439499583, "post_id": 31997907, "comment_id": 51900226, "body": "@id_yulian No, please do ask questions, blunt or otherwise! (After checking for existing ones, etc). I just wanted to make sure that if you&#39;d never seen backslash escapades before you didn&#39;t just file this away as a quirk of Haskell, only to be surprised again in some other language."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1439498011, "creation_date": 1439498011, "answer_id": 31997907, "question_id": 31997714, "link": "https://stackoverflow.com/questions/31997714/haskell-99-questions-10-strange-behaviour-of-symbol/31997907#31997907", "title": "Haskell 99 questions #10: strange behaviour of &#39;\\&#39; symbol", "body": "<p>There are a number of escape codes for characters which are hard to type on a normal keyboard or would make Haskell annoying to read in an editor. Thus, for example, the tab character is represented in Haskell code as <code>'\\t'</code>, the newline by <code>'\\n'</code>, and so forth. To represent a literal backslash, one escapes it, thus <code>'\\\\'</code>; and <code>'\\a'</code> happens to be an escape character as well (for the bell control character, an inelegant remnant of a less civilized age).</p>\n\n<p>So the string <code>\"\\\\\\a\"</code> represents a two-character list, containing the backslash character in its first element and the bell control character in its second element.</p>\n\n<p>A full description of the syntax for character and string literals is given in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-200002.6\">the Report</a>.</p>\n"}], "owner": {"reputation": 1539, "user_id": 2186301, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/GAisa.png?s=128&g=1", "display_name": "yulian", "link": "https://stackoverflow.com/users/2186301/yulian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 31997907, "answer_count": 1, "score": 1, "last_activity_date": 1439498528, "creation_date": 1439497273, "last_edit_date": 1439497845, "question_id": 31997714, "link": "https://stackoverflow.com/questions/31997714/haskell-99-questions-10-strange-behaviour-of-symbol", "title": "Haskell 99 questions #10: strange behaviour of &#39;\\&#39; symbol", "body": "<p>So far I have my 99.hs file:</p>\n\n<pre><code>import Data.List\n\nmyEncode :: Eq a =&gt; [a] -&gt; [(Int, a)]\nmyEncode = map (\\x -&gt; (length x, head x)) . group\n</code></pre>\n\n<p>But when trying to use it in <em>ghci</em>, I get this (haven't found an explanation yet, though I tried):</p>\n\n<pre><code>*Main&gt; myEncode \"///aaaaabbbbbbbccdddddxxyyzz0\"\n[(3,'/'),(5,'a'),(7,'b'),(2,'c'),(5,'d'),(2,'x'),(2,'y'),(2,'z'),(1,'0')]                           \u2502\n*Main&gt; myEncode \"\\\\\\aaaaabbbbbbbccdddddxxyyzz0\"\n[(1,'\\\\'),(1,'\\a'),(4,'a'),(7,'b'),(2,'c'),(5,'d'),(2,'x'),(2,'y'),(2,'z'),(1,'0')]\n</code></pre>\n\n<p>Any link to an exhaustive source about this (concerning haskell, of course) will be good, also as a good explanation of this issue.</p>\n"}, {"tags": ["haskell", "logic"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1439496409, "post_id": 31997175, "comment_id": 51898682, "body": "Note that your <code>otherwise</code> clause is truly unreachable: between <code>not result</code> and <code>result</code> all possibilities are covered."}], "answers": [{"comments": [{"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "edited": false, "score": 0, "creation_date": 1439500106, "post_id": 31997430, "comment_id": 51900435, "body": "aha!!! I thought, I got stuck for two days on the Implication problem. But in the end it ended up to be very enlightening."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1439496280, "creation_date": 1439496280, "answer_id": 31997430, "question_id": 31997175, "link": "https://stackoverflow.com/questions/31997175/are-there-any-tools-for-guard-analysis/31997430#31997430", "title": "Are there any tools for guard analysis?", "body": "<p>I think I would write this function a different way:</p>\n\n<pre><code>-- not result\nverdict True  False = (False, \"LIAR\")\n-- result &amp;&amp; p\nverdict True  True  = (True , \"telling the truth\")\n-- result\nverdict False _     = (True , \"innocent unless proven guilty\")\nverdict _     True  = (True , \"innocent unless proven guilty\")\n-- otherwise\nverdict _     _     = (False, \"we shouldn't get here\")\n</code></pre>\n\n<p>Then not only is it obvious to humans which clauses can be left out (the last two), but also to the machine; <code>ghc</code> says this at its default warning level:</p>\n\n<pre><code>test.hs:2:5: Warning:\n    Pattern match(es) are overlapped\n    In an equation for \u2018verdict\u2019:\n        verdict _ True = ...\n        verdict _ _ = ...\n</code></pre>\n\n<p>Checking guard overlap in general is of course undecidable; and furthermore I don't know of a tool that will try to give an approximate answer.</p>\n"}, {"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1439559199, "post_id": 31997659, "comment_id": 51925001, "body": "<code>implies</code> would be much nicer in infix/operator form."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1439563118, "post_id": 31997659, "comment_id": 51927657, "body": "@ErikAllik It would, but I wanted to avoid syntax variant overload. On second though, however, I guess it won&#39;t hurt to adopt your suggestion."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1439563186, "last_edit_date": 1439563186, "creation_date": 1439497080, "answer_id": 31997659, "question_id": 31997175, "link": "https://stackoverflow.com/questions/31997175/are-there-any-tools-for-guard-analysis/31997659#31997659", "title": "Are there any tools for guard analysis?", "body": "<p>This is probably a clearer expression of your intent:</p>\n\n<pre><code>implies :: Bool -&gt; Bool -&gt; Bool\np `implies` q = not p || q -- The backticks allow infix usage.\n\n-- The assumption is that p `implies` q is a known fact.\nverdict :: Bool -&gt; Bool -&gt; (Bool, String)\nverdict p q = (result, remark)\n    where\n    result = p `implies` q\n    remark\n        | not result = \"LIAR\"\n        | p = \"telling the truth\"\n        | otherwise = \"innocent until proven guilty\"\n</code></pre>\n\n<p>Guards are syntax sugar for pattern matches on <code>Bool</code> values. For general tips on arranging pattern matches, see Daniel Wagner's answer.</p>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 31997430, "answer_count": 2, "score": 2, "last_activity_date": 1439563186, "creation_date": 1439495372, "question_id": 31997175, "link": "https://stackoverflow.com/questions/31997175/are-there-any-tools-for-guard-analysis", "title": "Are there any tools for guard analysis?", "body": "<p>I'm a Haskell noob and while reading about Implications in Haskell Road I came to following puzzle.</p>\n\n<pre><code>verdict :: Bool -&gt; Bool -&gt; (Bool, String)\nverdict p q | not result  = (False, \"LIAR\")\n            | result &amp;&amp; p = (True,  \"telling the truth\")\n            | result      = (True,  \"innocent unless proven guilty\")\n            | otherwise   = (False, \"we shouldn't get here\")\n  where result = (not p) || q\n-- map (\\x -&gt; verdict (fst x == 1) (snd x == 1)) [(1,1),(1,0),(0,1),(0,0)]\n</code></pre>\n\n<p>Is there a tool that would warn me about the otherwise or other similar logical errors?</p>\n"}, {"tags": ["parsing", "haskell", "happy", "alex"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439499268, "post_id": 31996489, "comment_id": 51900090, "body": "Can you point us to the code - i.e. a github repo?"}, {"owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439499915, "post_id": 31996489, "comment_id": 51900365, "body": "@user5402 <a href=\"https://github.com/pscollins/ansi-parser\" rel=\"nofollow noreferrer\">github.com/pscollins/ansi-parser</a> has all of the code. It is a little sloppy at the moment, especially the labeling of tests."}], "answers": [{"tags": [], "owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "is_accepted": true, "score": 1, "last_activity_date": 1439533152, "creation_date": 1439533152, "answer_id": 32003473, "question_id": 31996489, "link": "https://stackoverflow.com/questions/31996489/what-causes-happy-to-throw-a-parse-error/32003473#32003473", "title": "What causes Happy to throw a parse error?", "body": "<p>It turns out the cause of this error was the innocuous line </p>\n\n<pre><code>%lexer { lexWrap } { alexEOF }\n</code></pre>\n\n<p>which was recommended by the linked question about using Alex with Happy (unfortunately, one of the top Google results for queries like \"using Alex as a monadic lexer with Happy). The fix is to change it to the following:</p>\n\n<pre><code>%lexer { lexWrap } { TokenEOF }\n</code></pre>\n\n<p>I had to dig in to the generated code to uncover the issue. It is caused by the code derived from the <code>%tokens</code> directive, which looks as follows (I commented out all of my token declarations except for <code>TokenNonPrint</code> while trying to track down the error):</p>\n\n<pre><code>happyNewToken action sts stk\n    = lexWrap(\\tk -&gt; \n    let cont i = happyDoAction i tk action sts stk in\n    case tk of {\n    alexEOF -&gt; happyDoAction 2# tk action sts stk; -- !!!!\n    TokenNonPrint happy_dollar_dollar -&gt; cont 1#;\n    _ -&gt; happyError' tk\n    })\n</code></pre>\n\n<p>Evidently, Happy transforms each line of the <code>%tokens</code> directive in to one branch of a pattern match. It <em>also</em> inserts a branch for whatever was identified to it as the EOF token in the <code>%lexer</code> directive. </p>\n\n<p>By inserting the name of a value, <code>alexEOF</code>, rather than a data constructor, <code>TokenEOF</code>, this branch of the case statement has the effect of re-binding the name <code>alexEOF</code> to whatever token was passed in to <code>lexWrap</code>, shadowing the original binding and short-circuiting the case statement so that it hits the EOF rule every time, which somehow results in Happy entering an error state. </p>\n\n<p>The mistake isn't caught by the type system, since the identifier <code>alexEOF</code> (or <code>TokenEOF</code>) doesn't appear anywhere else in the generated code. Misusing the <code>%lexer</code> directive like this will cause GHC to emit a warning, but, since the warning appears in generated code, it's impossible to distinguish it from all of the other harmless warnings the code throws out.</p>\n"}], "owner": {"reputation": 9267, "user_id": 2284221, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/120d229a55c7a6ce3037e6932c190616?s=128&d=identicon&r=PG", "display_name": "Patrick Collins", "link": "https://stackoverflow.com/users/2284221/patrick-collins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 1, "accepted_answer_id": 32003473, "answer_count": 1, "score": 2, "last_activity_date": 1439533152, "creation_date": 1439492816, "last_edit_date": 1495540317, "question_id": 31996489, "link": "https://stackoverflow.com/questions/31996489/what-causes-happy-to-throw-a-parse-error", "title": "What causes Happy to throw a parse error?", "body": "<p>I've written a lexer in Alex and I'm trying to hook it up to a parser written in Happy. I'll try my best to summarize my problem without pasting huge chunks of code.</p>\n\n<p>I know from my unit tests of my lexer that the string <code>\"\\x7\"</code> is lexed to:</p>\n\n<pre><code>[TokenNonPrint '\\x7', TokenEOF]\n</code></pre>\n\n<p>My token type (spit out by the lexer), is <code>Token</code>. I've defined <code>lexWrap</code> and <code>alexEOF</code> as described <a href=\"https://stackoverflow.com/questions/20315739/how-to-use-an-alex-monadic-lexer-with-happy\">here</a>, which gives me the following header and token declarations:</p>\n\n<pre><code>%name parseTokens \n%tokentype { Token }\n%lexer { lexWrap } { alexEOF }\n%monad { Alex }\n%error { parseError }\n\n%token\n  NONPRINT {TokenNonPrint $$}\n  PLAIN { TokenPlain $$ }\n</code></pre>\n\n<p>I invoke the parser+lexer combo with the following:</p>\n\n<pre><code>parseExpr :: String -&gt; Either String [Expr]\nparseExpr s = runAlex s parseTokens\n</code></pre>\n\n<p>And here are my first few productions:</p>\n\n<pre><code>exprs :: { [Expr] }\nexprs\n  : {- empty -} { trace \"exprs 30\" [] }\n  | exprs expr { trace \"exprs 31\" $ $2 : $1 }\n\nnonprint :: { Cmd }\n  : NONPRINT { NonPrint $ parseNonPrint $1}\n\nexpr :: { Expr }\nexpr\n  : nonprint {trace \"expr 44\" $ Cmd $ $1}\n  | PLAIN { trace \"expr 37\" $ Plain $1 }\n</code></pre>\n\n<p>I'll leave out the datatype declarations of <code>Expr</code> and <code>NonPrint</code> since they're long and only the constructors <code>Cmd</code> and <code>NonPrint</code> matter here. The function <code>parseNonPrint</code> is defined at the bottom of Parse.y as:</p>\n\n<pre><code>parseNonPrint :: Char -&gt; NonPrint\nparseNonPrint '\\x7' = Bell\n</code></pre>\n\n<p>Also, my error handling function looks like:</p>\n\n<pre><code>parseError :: Token -&gt; Alex a\nparseError tokens = error (\"Error processing token: \" ++ show tokens)\n</code></pre>\n\n<p>Written like this, I expect the following hspec test to pass:</p>\n\n<pre><code>parseExpr \"\\x7\" `shouldBe` Right [Cmd (NonPrint Bell)]\n</code></pre>\n\n<p>But instead, I see <code>\"exprs 30\"</code> print <em>once</em> (even though I'm running 5 different unit tests) and all of my tests of <code>parseExpr</code> return <code>Right []</code>. I don't understand why that would be the case, but I changed the <code>exprs</code> production to prevent it:</p>\n\n<pre><code>exprs :: { [Expr] }\nexprs\n  : expr { trace \"exprs 30\" [$1] }\n  | exprs expr { trace \"exprs 31\" $ $2 : $1 }\n</code></pre>\n\n<p>Now all of my tests fail on the first token they hit --- <code>parseExpr \"\\x7\"</code> fails with:</p>\n\n<pre><code>uncaught exception: ErrorCall (Error processing token: TokenNonPrint '\\a')\n</code></pre>\n\n<p>And I'm thoroughly confused, since I would expect the parser to take the path <code>exprs -&gt; expr -&gt; nonprint -&gt; NONPRINT</code> and succeed. I don't see why this input would put the parser in an error state. None of the <code>trace</code> statements are hit (optimized away?).</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "recursion", "lua", "parsec"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1439501260, "post_id": 31996183, "comment_id": 51900993, "body": "Convert to continuation-passing style (assuming Lua does tail call optimization).   I don&#39;t have time to elaborate right now, but maybe that will set you on the right track."}, {"owner": {"reputation": 215, "user_id": 904219, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/16b684a72bf6d9c58f534aa525253030?s=128&d=identicon&r=PG", "display_name": "Will Fancher", "link": "https://stackoverflow.com/users/904219/will-fancher"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1439548908, "post_id": 31996183, "comment_id": 51918676, "body": "Perfect! I hadn&#39;t thought of that. Works great.  EDIT: Although, my Lua implementation has a bug where tail calls don&#39;t update stack information correctly, so getting an error anywhere in the stack produces terribly incorrect error messages. But that&#39;s a different problem! =P"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439591878, "post_id": 31996183, "comment_id": 51941627, "body": "@WillFancher I suggest you add your solution as an answer."}], "answers": [{"tags": [], "owner": {"reputation": 215, "user_id": 904219, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/16b684a72bf6d9c58f534aa525253030?s=128&d=identicon&r=PG", "display_name": "Will Fancher", "link": "https://stackoverflow.com/users/904219/will-fancher"}, "is_accepted": true, "score": 1, "last_activity_date": 1439674362, "creation_date": 1439674362, "answer_id": 32029571, "question_id": 31996183, "link": "https://stackoverflow.com/questions/31996183/eliminating-recursion-in-this-lua-monad-mimicry/32029571#32029571", "title": "Eliminating recursion in this Lua monad mimicry", "body": "<p>Continuation passing made this very easy to solve.</p>\n\n<pre><code>function Parser:bind(f)\n    return new(function(s, cont)\n        return self.runParser(s, function(result)\n            if result.cons() == Result.Success then\n                return f(result.get()).runParser(result.get(2), cont)\n            else\n                return cont(result)\n            end\n        end)\n    end)\nend\n</code></pre>\n\n<p>This way, it's tail calls all the way down! Admittedly, there's potential for <code>f</code> to overflow all on its own, but that would be a case of bad programming on the user's side, as <code>f</code> shouldn't go very deep at all.</p>\n"}], "owner": {"reputation": 215, "user_id": 904219, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/16b684a72bf6d9c58f534aa525253030?s=128&d=identicon&r=PG", "display_name": "Will Fancher", "link": "https://stackoverflow.com/users/904219/will-fancher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "accepted_answer_id": 32029571, "answer_count": 1, "score": 2, "last_activity_date": 1439674362, "creation_date": 1439491754, "last_edit_date": 1439494272, "question_id": 31996183, "link": "https://stackoverflow.com/questions/31996183/eliminating-recursion-in-this-lua-monad-mimicry", "title": "Eliminating recursion in this Lua monad mimicry", "body": "<p>I'm trying to crudely replicate <a href=\"https://wiki.haskell.org/Parsec\" rel=\"nofollow\">Parsec</a> in Lua, and I'm having a bit of trouble with the bind function <strike>being recursive</strike> generating recursive <code>runParser</code>s.</p>\n\n<pre><code>function Parser:bind(f)\n    return new(function(s)\n        local result = self.runParser(s)\n        if result.cons() == Result.Success then\n            return f(result.get()).runParser(result.get(2))\n        else\n            return result\n        end\n    end)\nend\n</code></pre>\n\n<p>I'm using a custom system of making ADTs, hence the <code>cons()</code> and <code>get()</code> functions on the return value. The equivalent Haskell code would be something like this.</p>\n\n<pre><code>m &gt;&gt;= f = Parser $ \\s -&gt; case result of\n                            Success a cs -&gt; runParser (f a) cs\n                            _ -&gt; result\n                        where\n                            result = runParser m s\n</code></pre>\n\n<p>The argument to the <code>Parser</code> constructor (the <code>new</code> function in Lua) is the <code>runParser</code> function. So calling a different <code>runParser</code> from within <code>runParser</code> non-tail-recursively generates very deep call stacks, which causes a stack overflow. Any tips on removing the recursion or translating it to tail-recursion?</p>\n"}, {"tags": ["haskell", "fizzbuzz"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1439490547, "post_id": 31995737, "comment_id": 51895685, "body": "What type do you suppose <code>fb</code> should return?  Why would you think that returns an <code>Integer</code>?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1439536431, "post_id": 31995737, "comment_id": 51911328, "body": "Please do <b>not</b> add the php tag unneccessarily. The fact that you know php is completely unrelated to the question. Moreover it even breaks the highlighting of code (which uses tags to select the default highlighting)."}], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 5220880, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DS5F0.png?s=128&g=1", "display_name": "Rocket Risa", "link": "https://stackoverflow.com/users/5220880/rocket-risa"}, "edited": false, "score": 0, "creation_date": 1439502296, "post_id": 31995911, "comment_id": 51901405, "body": "So simple.. can&#39;t believe I missed that! Thanks again for all your help!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 1, "last_activity_date": 1439490838, "creation_date": 1439490838, "answer_id": 31995911, "question_id": 31995737, "link": "https://stackoverflow.com/questions/31995737/implementing-input-variables-in-functions-in-haskell/31995911#31995911", "title": "Implementing input variables in functions in Haskell", "body": "<p>The problem is simply with your type signature for <code>fb</code>. Just remove it and your code will compile.</p>\n\n<p>The correct type signature for <code>fb</code> is <code>Integer -&gt; Integer -&gt; Integer -&gt; IO ()</code> as you can verify by having <code>ghci</code> tell you with the <code>:t</code> command:</p>\n\n<pre><code>$ ghci Fizzbuzz.hs\nPrelude&gt; :t fb\nfb :: Integer -&gt; Integer -&gt; Integer -&gt; IO ()\nPrelude&gt;\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 5220880, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DS5F0.png?s=128&g=1", "display_name": "Rocket Risa", "link": "https://stackoverflow.com/users/5220880/rocket-risa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 31995911, "answer_count": 1, "score": 2, "last_activity_date": 1439536376, "creation_date": 1439490271, "last_edit_date": 1495542610, "question_id": 31995737, "link": "https://stackoverflow.com/questions/31995737/implementing-input-variables-in-functions-in-haskell", "title": "Implementing input variables in functions in Haskell", "body": "<p>This is a continuation to my previous <a href=\"https://stackoverflow.com/questions/31974442/multiple-input-values-with-upper-range/\">post</a>. </p>\n\n<p>I'm creating a FizzBuzz function that allows 3 parameters to be entered. However, this isn't just the standard FizzBuzz program. This one allows for 2 divisors while implementing an upper range. So if <code>div1</code> is divisible print \"Fizz\", if <code>div2</code> is divisible print \"buzz\", and if <code>div1</code> and <code>div2</code> are divisible print \"FizzBuzz\", else print the number/integer. </p>\n\n<p>I found different tutorials showing how to do the regular FizzBuzz in Haskell and modified it to be able to do as explained above.</p>\n\n<p>Right now I'm getting an error and I'm not sure how to properly do this in Haskell.  </p>\n\n<pre><code>fizzbuzz' :: [(Integer, String)] -&gt; Integer -&gt; String\nfizzbuzz' ss n = foldl (\\str (num, subst) -&gt; if n `mod` num == 0 then str ++ subst else str ++ \"\") \"\" ss\n\nfizzbuzz :: [(Integer, String)] -&gt; Integer -&gt; String\nfizzbuzz ss n = if null str then show n else str\n  where str = fizzbuzz' ss n\n\nfb :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nfb x y z = mapM_ putStrLn $ map (fizzbuzz [(x, \"fizz\"), (y, \"buzz\")]) [0..z]\n</code></pre>\n\n<p>The error I'm getting is: </p>\n\n<pre><code>Couldn't match expected type \u2018Integer\u2019 with actual type \u2018IO ()\u2019\nIn the expression:\n  mapM_ putStrLn $ map (fizzbuzz [(x, \"fizz\"), (y, \"buzz\")]) [0 .. z]\nIn an equation for \u2018fb\u2019:\n    fb x y z\n      = mapM_ putStrLn\n        $ map (fizzbuzz [(x, \"fizz\"), (y, \"buzz\")]) [0 .. z]\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Any ideas? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1439483400, "post_id": 31993452, "comment_id": 51891656, "body": "yes with the first parameter of <code>find</code> (you choose <code>always</code> here but you can do basically the same as with the file - they are named differently but they are really both <a href=\"https://hackage.haskell.org/package/filemanip-0.3.6.3/docs/System-FilePath-Find.html#t:FindClause\" rel=\"nofollow noreferrer\">FindClause Bool</a> - just use <code>directory</code> there to get the names)"}], "answers": [{"tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": true, "score": 4, "last_activity_date": 1439483569, "creation_date": 1439483569, "answer_id": 31993770, "question_id": 31993452, "link": "https://stackoverflow.com/questions/31993452/avoid-recursion-into-specifc-folder-using-filemanip/31993770#31993770", "title": "avoid recursion into specifc folder using filemanip", "body": "<p>Looking at the documentation we can see that <a href=\"https://hackage.haskell.org/package/filemanip-0.3.6.3/docs/System-FilePath-Find.html#g:1\" rel=\"nofollow\">find</a> takes as first argument a <a href=\"https://hackage.haskell.org/package/filemanip-0.3.6.3/docs/System-FilePath-Find.html#t:RecursionPredicate\" rel=\"nofollow\">RecursionPredicate</a> which in turn is <a href=\"https://hackage.haskell.org/package/filemanip-0.3.6.3/docs/System-FilePath-Find.html#t:FindClause\" rel=\"nofollow\">just</a> <code>FindClause Bool</code>.</p>\n\n<p>Based on this we can see that we have to pass in a custom <code>RecursionPredicate</code> to <code>find</code> other than <code>always</code>.\nOne example is to ignore <code>.git</code> directories:</p>\n\n<pre><code>notGit :: FindClause Bool -- or via type alias also a RecursionPredicate\nnotGit = directory /=? \".git\"\n</code></pre>\n\n<p>We then just use our new recursion predicate with <code>find</code>:</p>\n\n<pre><code>find notGit (fileType ==? RegularFile &amp;&amp;? extension ==? \".md\") path\n</code></pre>\n\n<p>Note also the special combinators for <a href=\"https://hackage.haskell.org/package/filemanip-0.3.6.3/docs/System-FilePath-Find.html#g:10\" rel=\"nofollow\">predicates</a> to e.g. compose a <code>notSvn</code> predicate with our <code>notGit</code> predicate via <code>(||?)</code> to get a predicate that enters neither directories.</p>\n"}], "owner": {"reputation": 3716, "user_id": 2899837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8cd69ea3c72bc748dd806bb526823a7b?s=128&d=identicon&r=PG&f=1", "display_name": "greole", "link": "https://stackoverflow.com/users/2899837/greole"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 31993770, "answer_count": 1, "score": 1, "last_activity_date": 1439486178, "creation_date": 1439482437, "last_edit_date": 1439486178, "question_id": 31993452, "link": "https://stackoverflow.com/questions/31993452/avoid-recursion-into-specifc-folder-using-filemanip", "title": "avoid recursion into specifc folder using filemanip", "body": "<p>I am exploring the <a href=\"https://hackage.haskell.org/package/filemanip\" rel=\"nofollow\">filemanip</a> library to search for markdown files in a path including subfolders</p>\n\n<pre><code>import System.FilePath.Find\n\nfind always (fileType ==? RegularFile &amp;&amp;? extension ==? \".md\") \"a/path/\"\n</code></pre>\n\n<p>is there any way to specify a folder name or pattern into which it should not recurse</p>\n"}, {"tags": ["windows", "haskell", "openldap"], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 0, "last_activity_date": 1440068726, "creation_date": 1440068726, "answer_id": 32116568, "question_id": 31987540, "link": "https://stackoverflow.com/questions/31987540/how-to-install-haskell-ldap-on-windows/32116568#32116568", "title": "How to install Haskell LDAP on Windows?", "body": "<p><a href=\"https://www.reddit.com/u/wrvn\" rel=\"nofollow\">/u/wrvn</a> on Reddit directed me to <a href=\"https://msys2.github.io/\" rel=\"nofollow\">MSYS2</a>.</p>\n\n<p>Setting that up and installing the OpenLDAP package (<a href=\"https://github.com/Alexpux/MINGW-packages\" rel=\"nofollow\">package list</a>) went smoothly, though did take an exceptionally long time.</p>\n\n<p>The Haskell LDAP package installed by adding the <code>C:/msys64/mingw64/bin</code> directory to the path and running <code>cabal install LDAP --extra-lib-dirs=c:/msys64/mingw64/lib --extra-include-dirs=c:/msys64/mingw64/include</code>.</p>\n\n<p>Paths of course are dependent on installation location and architecture (mingw32 or mingw64).</p>\n"}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 1, "accepted_answer_id": 32116568, "answer_count": 1, "score": 0, "last_activity_date": 1440068887, "creation_date": 1439466937, "last_edit_date": 1440068887, "question_id": 31987540, "link": "https://stackoverflow.com/questions/31987540/how-to-install-haskell-ldap-on-windows", "title": "How to install Haskell LDAP on Windows?", "body": "<p><strong>EDIT</strong> Resolved by using MSYS2 for OpenLDAP</p>\n\n<p>I'm trying to install <a href=\"https://hackage.haskell.org/package/LDAP\" rel=\"nofollow\">https://hackage.haskell.org/package/LDAP</a> on Windows.</p>\n\n<p>I installed OpenLDAP through Cygwin and those libraries appear to be referenced, but now I'm getting these linker errors and not sure what is missing. Could anyone explain what I'm doing incorrectly? I would also be happy to start clean if there is a certain process that should work.</p>\n\n<p>Running:</p>\n\n<pre><code>cabal install LDAP --extra-lib-dirs=c:/cygwin64/lib --extra-include-dirs=c:/cygwin64/usr/include\n</code></pre>\n\n<p>Results in:</p>\n\n<pre><code>dist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x53): undefined reference to `__ctype_ptr__'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x97): undefined reference to `__ctype_ptr__'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0xd5): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0xf4): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x102): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x114): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x127): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x13c): more undefined references to `_impure_ptr' follow\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x174): undefined reference to `__swbuf_r'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x17d): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x188): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x196): undefined reference to `__swbuf_r'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x1a1): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x1b4): undefined reference to `_impure_ptr'\ndist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o:Types_hsc_utils.c:(.text+0x201): undefined reference to `_impure_ptr'\nc:/program files/haskell platform/7.10.2-a/mingw/bin/../lib/gcc/x86_64-w64-mingw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: dist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o: bad reloc address 0x0 in section `.pdata'\nc:/program files/haskell platform/7.10.2-a/mingw/bin/../lib/gcc/x86_64-w64-mingw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: final link failed: Invalid operation\ncollect2: ld returned 1 exit status\nlinking dist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_make.o failed (exit code 1)\ncommand was: C:\\Program Files\\Haskell Platform\\7.10.2-a\\mingw\\bin\\gcc.exe dist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_make.o dist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_utils.o -o dist\\dist-sandbox-8cd1684e\\build\\LDAP\\Types_hsc_make.exe -Lc:/cygwin64/lib -lldap -llber -LC:\\Program Files\\Haskell Platform\\7.10.2-a\\lib\\base_GDytRqRVSUX7zckgKqJjgw -lwsock32 -luser32 -lshell32 -LC:\\Program Files\\Haskell Platform\\7.10.2-a\\lib\\integ_2aU3IZNMF9a7mQ0OzsZ0dS -LC:\\Program Files\\Haskell Platform\\7.10.2-a\\lib\\ghcpr_8TmvWUcS1U1IKHT0levwg3 -LC:\\Program Files\\Haskell Platform\\7.10.2-a\\lib/rts -lm -lwsock32 -lgdi32 -lwinmm\ncabal: Error: some packages failed to install:\nLDAP-0.6.10 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "edited": false, "score": 0, "creation_date": 1439467080, "post_id": 31987498, "comment_id": 51879621, "body": "Well, you can use <code>unique</code> for that, or defining your own, after the permutation: <code>unique = reverse . nub . reverse</code>, <code>unique $ permutations [1, 0, 0]</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "edited": false, "score": 3, "creation_date": 1439467213, "post_id": 31987498, "comment_id": 51879718, "body": "@MarceloCamargo nice one was just about to write <code>nub . permutations</code> - now I am wondering why you need the <code>reverse</code> there ... hmmm"}, {"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "edited": false, "score": 0, "creation_date": 1439467247, "post_id": 31987498, "comment_id": 51879747, "body": "Using nub works, but it&#39;s O(n^2) in Haskell&#39;s standard library?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439467321, "post_id": 31987498, "comment_id": 51879809, "body": "hayoo was able to find <a href=\"https://hackage.haskell.org/package/combinat-0.2.7.0/docs/Math-Combinat-Permutations.html#v:permuteMultiset\" rel=\"nofollow noreferrer\">another one</a> - I would guess that this one might be a bit more performant"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1439467341, "post_id": 31987498, "comment_id": 51879827, "body": "@user1440894 yes <code>nub</code> is quite slow"}], "answers": [{"comments": [{"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "edited": false, "score": 3, "creation_date": 1439467704, "post_id": 31987708, "comment_id": 51880070, "body": "Why reverse and re-reverse the list before and after nubbing it?"}, {"owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "reply_to_user": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "edited": false, "score": 0, "creation_date": 1439467987, "post_id": 31987708, "comment_id": 51880234, "body": "<code>reverse</code> was mean&#39;t to preserve the original order of the list, acting exactly like <code>unique</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1439474332, "post_id": 31987708, "comment_id": 51885015, "body": "&quot;Pure&quot; is probably not a good word to describe what <code>permutations</code> does to the length of the list, given how strongly we associate it with the concept of a pure function. You might prefer to say &quot;the length of the result of <code>permutation</code> depends only on the length of the argument&quot;, or simply &quot;<code>permutation</code> treats the elements of the list as if they were all different from each other&quot;."}, {"owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1439475315, "post_id": 31987708, "comment_id": 51885715, "body": "@duplode, I just edited it with your more concise definition. Thanks!"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1439486869, "post_id": 31987708, "comment_id": 51893660, "body": "Filtering n! permutations is still O(n!), so you can just use <code>nub</code>  \u2014 there is almost no difference."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1439489977, "post_id": 31987708, "comment_id": 51895338, "body": "<code>nubOrd = Set.elems . Set.fromList</code> is simpler but not a stable filter. Given <code>permutations</code> does not produce results in lexicographic order, an un-stable filter beforehand shouldn&#39;t be a problem. the following should suffice, <code>permutations&#39; = permutations . Set.elems . Set.fromList</code>"}], "tags": [], "owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "is_accepted": false, "score": 7, "last_activity_date": 1439476511, "last_edit_date": 1439476511, "creation_date": 1439467413, "answer_id": 31987708, "question_id": 31987498, "link": "https://stackoverflow.com/questions/31987498/haskells-permutations-function-defined-oddly/31987708#31987708", "title": "Haskell&#39;s &quot;permutations&quot; function defined oddly", "body": "<h3>1 - Why does Haskell implement \"permutations\" in the way described above (i.e. treating all elements of a list as distinct?)</h3>\n\n<p>It is a design question and should be studied in deep. <code>permutation</code> treats the elements of the list as if they were all different from each other. You can do <code>permutations [0, 0, 0]</code> and you'll yet get a list of lists of size <strong>6</strong>.</p>\n\n<h3>2 - Are there any standard library functions that calculate the permutations of a list in the \"true\" sense of permutations?</h3>\n\n<p>Yes, you have the <a href=\"https://hackage.haskell.org/package/combinat-0.2.7.0/docs/Math-Combinat-Permutations.html#v:permuteMultiset\" rel=\"nofollow\"><code>Math.Combinat.Permutations</code></a>, but you can easily create your own definition filtering the unique combinations with a complexity of <code>O(n * log n)</code> using sets, taking account that <code>nub</code> is known by being very slow:</p>\n\n<pre><code>module Main where\nimport Data.List (permutations)\nimport qualified Data.Set as Set\n\nnubOrd :: (Ord a) =&gt; [a] -&gt; [a]\nnubOrd xs = go Set.empty xs where\n  go s (x:xs)\n   | x `Set.member` s = go s xs\n   | otherwise        = x : go (Set.insert x s) xs\n  go _ _              = []\n\npermutations' :: (Ord a) =&gt; [a] -&gt; [[a]]\npermutations' = nubOrd . permutations\n</code></pre>\n\n<p>Where <code>permutations' [1, 0, 0]</code> gives <code>[[1, 0, 0], [0, 1, 0], [0, 0, 1]]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 8, "last_activity_date": 1439478688, "creation_date": 1439478688, "answer_id": 31992159, "question_id": 31987498, "link": "https://stackoverflow.com/questions/31987498/haskells-permutations-function-defined-oddly/31992159#31992159", "title": "Haskell&#39;s &quot;permutations&quot; function defined oddly", "body": "<p>Remember that <code>permutations</code> has type</p>\n\n<pre><code>permutations :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>That means that it satisfies the free theorem</p>\n\n<pre><code>permutations . map f = (map . map) f . permutations\n</code></pre>\n\n<p>for <em>all</em> functions <code>f</code>.  Since you can change the <em>elements</em> of the argument list arbitrarily without affecting the <em>structure</em> of the result list, <code>permutations</code> must really be a function on the indices of the original list, rather than the elements.</p>\n\n<p>So what <code>permutations</code> is really doing --- what it must do --- is calculate all permutations of the <em>indices</em> of the argument list, then apply each of those permutations to the list and return the results.  (I.e.,</p>\n\n<pre><code>permutations xn = (map . map) (xn!!) (permutations [0..length xn - 1])\n</code></pre>\n\n<p>for finite <code>xn</code>).</p>\n\n<p>Mathematical appendix:</p>\n\n<p>Since</p>\n\n<pre><code>xn = map (xn!!) (zipWith const [0..] xn)\n</code></pre>\n\n<p>for <em>all</em> <code>xn</code>, any function with <code>permutations</code>'s type must satisfy</p>\n\n<pre><code>permutations xn\n  = permutations (map (xn!!) (zipWith const [0..] xn)\n  = (map . map) (xn!!) (permutations (zipWith const [0..] xn))\n</code></pre>\n\n<p>by the equation above for <code>xn</code> and the free theorem for <code>permutations</code>.  So any function with <code>permutations</code>'s type must operate only on the indices of the input list[1].</p>\n\n<p>[1] Technically you can violate this by using <code>seq</code>.  But only for input lists that contain <code>undefined</code> as an element, which isn't true in your case.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 0, "last_activity_date": 1439487378, "last_edit_date": 1439487378, "creation_date": 1439487060, "answer_id": 31994849, "question_id": 31987498, "link": "https://stackoverflow.com/questions/31987498/haskells-permutations-function-defined-oddly/31994849#31994849", "title": "Haskell&#39;s &quot;permutations&quot; function defined oddly", "body": "<p>Here is a slightly rearranged Daniel Fischer's <a href=\"https://www.mail-archive.com/haskell-cafe@haskell.org/msg49360.html\" rel=\"nofollow\">solution</a>:</p>\n\n<pre><code>inserts :: [a] -&gt; [a] -&gt; [[a]]\ninserts (x:xs) (y:ys) = map (x:) (inserts xs (y:ys)) ++ map (y:) (inserts (x:xs) ys)\ninserts  xs     ys    = [xs ++ ys]\n\nuniqPerms :: Ord a =&gt; [a] -&gt; [[a]]\nuniqPerms = foldM inserts [] . group . sort\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1476929503, "post_id": 31998681, "comment_id": 67558396, "body": "Project Euler is pretty good that way (I mean for making us use interesting patterns in our code)."}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 1, "last_activity_date": 1439501052, "creation_date": 1439501052, "answer_id": 31998681, "question_id": 31987498, "link": "https://stackoverflow.com/questions/31987498/haskells-permutations-function-defined-oddly/31998681#31998681", "title": "Haskell&#39;s &quot;permutations&quot; function defined oddly", "body": "<blockquote>\n  <p>Why does Haskell implement \"permutations\" in the way described above (i.e. treating all elements of a list as distinct?)</p>\n</blockquote>\n\n<p>Because otherwise, the type would have to be:</p>\n\n<pre><code>permutations :: Eq a =&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>and then we could permute only things that have an Eq instance. But I remember I had something like</p>\n\n<pre><code>permutations [(+), subtract, (*), (/)]\n</code></pre>\n\n<p>in some Project Euler code ....</p>\n"}], "owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 852, "favorite_count": 0, "accepted_answer_id": 31992159, "answer_count": 4, "score": 7, "last_activity_date": 1439501052, "creation_date": 1439466840, "question_id": 31987498, "link": "https://stackoverflow.com/questions/31987498/haskells-permutations-function-defined-oddly", "title": "Haskell&#39;s &quot;permutations&quot; function defined oddly", "body": "<p>If I wanted to find the permutations of a list, I know that the number of permutations is given by the multinomial coefficient. For example, \"MISSISSIPPI\" has 11 letters, 'S' appears 4 times, 'I' appears 4 times, 'P' appears twice and 'M' appears once. So the number of permutations of \"MISSISSIPPI\" is equal to 11!/(4!4!2!) = 34650.</p>\n\n<p>If I load up GHCi and write:</p>\n\n<pre><code>ghci&gt; import Data.List\nghci&gt; permutations [1,2,3]\n</code></pre>\n\n<p>It will return</p>\n\n<pre><code>[[1,2,3],[2,1,3],[3,2,1],[2,3,1],[3,1,2],[1,3,2]]\n</code></pre>\n\n<p>as expected.</p>\n\n<p>But if I write </p>\n\n<pre><code>ghci&gt; permutations [1,0,0]\n</code></pre>\n\n<p>it will now return</p>\n\n<pre><code>[[1,0,0],[0,1,0],[0,0,1],[0,0,1],[0,1,0],[1,0,0]]\n</code></pre>\n\n<p>... which is very disappointing. As there are three elements, and two of them occur twice, one would hope for there only to be 6!/2! = 3 permutations, namely</p>\n\n<pre><code>[[1,0,0],[0,1,0],[0,0,1]]\n</code></pre>\n\n<p>rather than the six generated by treating each element of the list as distinct.</p>\n\n<p>1) Why does Haskell implement \"permutations\" in the way described above (i.e. treating all elements of a list as distinct?)</p>\n\n<p>2) Are there any standard library functions that calculate the permutations of a list in the \"true\" sense of permutations?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1439466568, "post_id": 31987208, "comment_id": 51879256, "body": "well there are all kinds of side-effects so which one do you want? - some of those have their own monads (State, ...) and many libs introduce some more (Yesod, ...) - but no I guess you cannot assemble them just like in PureScript - usually there are transformers and the monad-stack concept to do this"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1439524011, "post_id": 31987208, "comment_id": 51906930, "body": "A small nitpick: <code>IO</code> has <i>effects</i>, not side-effects. A side-effect would be something evil like a computation pretending to be pure, but doing IO via <code>unsafePerformIO</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 4, "last_activity_date": 1439469459, "creation_date": 1439469459, "answer_id": 31988473, "question_id": 31987208, "link": "https://stackoverflow.com/questions/31987208/monad-for-tracking-side-effects/31988473#31988473", "title": "Monad for tracking side-effects", "body": "<p>There are a couple of libraries that define similar effect systems for Haskell.</p>\n\n<p>I have worked some with <a href=\"http://hackage.haskell.org/package/extensible-effects\" rel=\"nofollow\"><code>extensible-effects</code></a>, and found it quite easy to add restricted <code>IO</code>, eg <code>STDIO</code>, <code>FileIO</code>, effects. The lack of compiler support makes is slightly less nice to use.</p>\n\n<p>If you want to try it out you can find inspiration in existing effects for the <code>extensible-effects</code> framework: <a href=\"http://hackage.haskell.org/packages/#cat:Effect\" rel=\"nofollow\">http://hackage.haskell.org/packages/#cat:Effect</a></p>\n\n<p>There seems to be a version of <code>extensible-effects</code> that doesn't use <code>Typeable</code> to track effects: <a href=\"http://hackage.haskell.org/package/effin\" rel=\"nofollow\">http://hackage.haskell.org/package/effin</a>. That should make it nicer to write new effects.</p>\n"}], "owner": {"reputation": 2041, "user_id": 3825483, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jqg7b.jpg?s=128&g=1", "display_name": "Marcelo Camargo", "link": "https://stackoverflow.com/users/3825483/marcelo-camargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 1, "accepted_answer_id": 31988473, "answer_count": 1, "score": 8, "last_activity_date": 1439469459, "creation_date": 1439466074, "question_id": 31987208, "link": "https://stackoverflow.com/questions/31987208/monad-for-tracking-side-effects", "title": "Monad for tracking side-effects", "body": "<p>In Haskell, we have the <code>IO</code> monad to deal with side-effects, although, it is not able to expressively track side-effects, you don't really know what type of side effect is really happening:</p>\n\n<pre><code>main :: IO ()\n</code></pre>\n\n<p>In PureScript, we have the <code>Eff</code> monad, where you are able to know what type of side-effects happen according to the type signature:</p>\n\n<pre><code>main :: forall e. Eff (fs :: FS, trace :: Trace, process :: Process | e) Unit\n</code></pre>\n\n<p>Here it is clearly that the <code>main</code> function has use of the filesystem, of tracing messages to the console and is able to handle the current process, where we have a specific module <code>Control.Monad.Eff</code> for dealing with side effects, and submodules such  as <code>Control.Monad.Eff.Random</code> and <code>Control.Monad.Eff.Console</code>.</p>\n\n<p>Taking by example the following:</p>\n\n<pre><code>module RandomExample where\n\nimport Prelude\n\nimport Control.Monad.Eff\nimport Control.Monad.Eff.Random (random)\nimport Control.Monad.Eff.Console (print)\n\nprintRandom :: forall e. Eff (console :: CONSOLE, random :: RANDOM | e) Unit\nprintRandom = do\n  n &lt;- random\n  print n\n</code></pre>\n\n<p>This is so much more specific than using just <em>\"Hey, here happens a side-effect, that's it, no more that you need to know!\"</em>. I've being looking through the web and I didn't see a monad complete enough to track side-effects.</p>\n\n<p><strong>Is there a specific monad in Haskell, like <code>Eff</code>, for tracking side effects?</strong></p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "gtk", "gtk2hs"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1439455292, "post_id": 31979492, "comment_id": 51871992, "body": "as you write &quot;when run from ghci&quot; does it work if you compile it?"}, {"owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1439456980, "post_id": 31979492, "comment_id": 51873053, "body": "As you are running from ghci, I think you need to create a thread for gtk with <code>forkOS $ runInBoundThread</code>.  See this file for a gtk library that can run in ghci: <a href=\"https://hackage.haskell.org/package/plot-gtk-0.2.0.2/docs/src/Graphics-Rendering-Plot-Gtk.html#PlotHandle\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/plot-gtk-0.2.0.2/docs/src/&hellip;</a>"}], "owner": {"reputation": 69, "user_id": 4394101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6542fcf97a0ec1a98baf00fb17958818?s=128&d=identicon&r=PG&f=1", "display_name": "scholar guy", "link": "https://stackoverflow.com/users/4394101/scholar-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1439446156, "creation_date": 1439439900, "last_edit_date": 1439446156, "question_id": 31979492, "link": "https://stackoverflow.com/questions/31979492/haskell-program-using-graphics-ui-gtk-crashes-on-windows-when-run-from-ghci", "title": "Haskell program using Graphics.UI.Gtk crashes on Windows when run from GHCi", "body": "<p>I downloaded gtk recently and wrote the following code.</p>\n\n<pre><code>main :: IO ()\nmain = do \n  initGUI\n  window &lt;- windowNew\n  onDestroy window mainQuit\n  widgetShowAll window\n  mainGUI\n</code></pre>\n\n<p>This program results to a error message and that ghci is quitted. </p>\n\n<pre><code>0 [main] us 0 init_cheap: VirtualAlloc pointer is null, Win32 error 487\nAllocationBase 0x68530000, BaseAddress 0x68570000, RegionSize 0x22000, State 0x1000\nC:\\Program Files (x86)\\Haskell Platform\\2014.2.0.0\\bin\\ghc.exe: *** Couldn't reserve space for cygwin's heap, Win32 error 0\n</code></pre>\n\n<p>I hope to find a solution for this problem. Thank you!</p>\n"}, {"tags": ["haskell", "ghc", "template-haskell", "type-synonyms"], "answers": [{"comments": [{"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1439443175, "post_id": 31979265, "comment_id": 51865640, "body": "I realize that this will work.  In my question I explicitly state that moving certain lines around will fix this.  My question is why this behavior exists, and what is causing it.  In my experience, in Haskell it shouldn&#39;t matter what order you have declared things.  It certainly shouldn&#39;t give a compile error."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 2, "creation_date": 1439449265, "post_id": 31979265, "comment_id": 51868433, "body": "@illabout Order isn&#39;t important <b>in Haskell</b>. When you use <i>Template Haskell</i> you <b>cannot</b> assume that."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1439438218, "creation_date": 1439438218, "answer_id": 31979265, "question_id": 31979147, "link": "https://stackoverflow.com/questions/31979147/type-synonyms-not-in-scope-when-using-template-haskell/31979265#31979265", "title": "Type synonyms &quot;not in scope&quot; when using Template Haskell", "body": "<p>Move the <code>data Bar = ...</code> declaration before the template Haskell and it'll work:</p>\n\n<pre><code>type Foo = Bar\n\ndata Baz = Baz\ndata Bar = Bar\n\n$(deriveJSON defaultOptions ''Baz)\n$(makeLenses ''Baz)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1439444536, "creation_date": 1439444536, "answer_id": 31980296, "question_id": 31979147, "link": "https://stackoverflow.com/questions/31979147/type-synonyms-not-in-scope-when-using-template-haskell/31980296#31980296", "title": "Type synonyms &quot;not in scope&quot; when using Template Haskell", "body": "<p>This is caused by <em>declaration groups</em> when using Template Haskell.  Here is an excerpt from the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/template-haskell.html\">GHC Manual</a>:</p>\n\n<blockquote>\n  <p>Top-level declaration splices break up a source file into delcaration\n  groups. A declaration group is the group of declarations created by a\n  top-level declaration splice, plus those following it, down to but not\n  including the next top-level declaration splice. The first declaration\n  group in a module includes all top-level definitions down to but not\n  including the first top-level declaration splice.</p>\n  \n  <p>Each declaration group is mutually recursive only within the group.\n  <strong>Declaration groups can refer to definitions within previous groups</strong>,\n  <strong>but not later one</strong>s.</p>\n</blockquote>\n\n<p>In my original code, two declaration groups are created:</p>\n\n<pre><code>-- This is the start of the first declaration group.\n\ntype Foo = Bar\n\ndata Baz = Baz\n$(deriveJSON defaultOptions ''Baz)\n\n-- This is the start of the second declaration group.\n\ndata Bar = Bar\n</code></pre>\n\n<p>The first declaration group cannot see <code>Bar</code>, which is causing this error.</p>\n"}], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 724, "favorite_count": 0, "accepted_answer_id": 31980296, "answer_count": 2, "score": 5, "last_activity_date": 1480282993, "creation_date": 1439437388, "last_edit_date": 1480282993, "question_id": 31979147, "link": "https://stackoverflow.com/questions/31979147/type-synonyms-not-in-scope-when-using-template-haskell", "title": "Type synonyms &quot;not in scope&quot; when using Template Haskell", "body": "<p>I am getting a strange error about a data type being \"not in scope\" when using Template Haskell.</p>\n\n<p>Here is my Main.hs file:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Main where\n\nimport Control.Lens\nimport Data.Aeson\nimport Data.Aeson.TH\n\ntype Foo = Bar\n\ndata Baz = Baz\n$(deriveJSON defaultOptions ''Baz)\n-- $(makeLenses ''Baz)\n\ndata Bar = Bar\n\nmain :: IO ()\nmain = print \"hello\"\n</code></pre>\n\n<p>When trying to compile it, I get the following error:</p>\n\n<pre><code>test-0.1.0.0: configure\nConfiguring test-0.1.0.0...\ntest-0.1.0.0: build\nBuilding test-0.1.0.0...\nPreprocessing executable 'test' for test-0.1.0.0...\n[1 of 1] Compiling Main             ( Main.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.2.0/build/test/test-tmp/Main.o )\n\nMain.hs:9:12:\n    Not in scope: type constructor or class \u2018Bar\u2019\n\n--  While building package test-0.1.0.0 using:\n      /usr/bin/runhaskell -package=Cabal-1.22.2.0 -clear-package-db -global-package-db -package-db=/home/illabout/.stack/snapshots/x86_64-linux/nightly-2015-06-17/7.10.1/pkgdb/ /tmp/stack1699/Setup.hs --builddir=.stack-work/dist/x86_64-linux/Cabal-1.22.2.0/ build\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>This error occurs whether I use <code>deriveJSON</code> or <code>makeLenses</code>.</p>\n\n<p>If I move the <code>type Foo = Bar</code> line down past the use of Template Haskell, the file compiles fine.</p>\n\n<p>What's causing this error?</p>\n\n<p>Here is a <code>.cabal</code> file and <code>stack.yaml</code> file to compile this:</p>\n\n<p>test.cabal:</p>\n\n<pre><code>name:                test\nversion:             0.1.0.0\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nexecutable test\n  main-is:             Main.hs\n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9\n                     , aeson &gt;= 0.8 &amp;&amp; &lt; 0.9\n                     , lens &gt;= 4 &amp;&amp; &lt; 5\n  default-language:    Haskell2010\n</code></pre>\n\n<p>stack.yaml:</p>\n\n<pre><code>flags: {}\npackages:\n- '.'\nextra-deps: []\nresolver: nightly-2015-06-17\n</code></pre>\n\n<p>This is using ghc-7.10.1.</p>\n"}, {"tags": ["haskell", "yesod", "blaze-html"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 0, "last_activity_date": 1439439758, "creation_date": 1439439758, "answer_id": 31979459, "question_id": 31978841, "link": "https://stackoverflow.com/questions/31978841/using-yesod-without-shakespeare/31979459#31979459", "title": "using yesod without Shakespeare", "body": "<p>Are you including the package <code>yesod-core</code> and the module <code>Yesod.Core</code>?</p>\n\n<p>That's where the <code>ToWidget</code> class is defined.</p>\n\n<p>I used <a href=\"http://hayoo.fh-wedel.de/?query=ToWidget\" rel=\"nofollow\">Hayoo</a> to find where <code>ToWidget</code> was defined.</p>\n"}], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 31979459, "answer_count": 1, "score": 0, "last_activity_date": 1439439758, "creation_date": 1439435099, "question_id": 31978841, "link": "https://stackoverflow.com/questions/31978841/using-yesod-without-shakespeare", "title": "using yesod without Shakespeare", "body": "<p><a href=\"http://www.yesodweb.com/blog/2012/10/yesod-pure\" rel=\"nofollow\">This</a> post shows how to use yesod directly with blaze-html,but following this post ghc complains that:</p>\n\n<pre><code>No instance for (ToWidget App (t0 -&gt; H.Html))\n  arising from a use of \u2018toWidget\u2019\nIn the expression: toWidget\nIn a stmt of a 'do' block: toWidget $ \\ render -&gt; do { H.p \"\" }\nIn the second argument of \u2018($)\u2019, namely\n  \u2018do { toWidget $ \\ render -&gt; do { ... } }\u2019\n</code></pre>\n\n<p>I checked source of the required <a href=\"http://hackage.haskell.org/package/yesod-pure-0.1.0.2/src/Yesod/Pure.hs\" rel=\"nofollow\">yesod.pure</a> module,but found there's no such instance for Towidget..</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1439434700, "post_id": 31978596, "comment_id": 51863333, "body": "Is there a reason you want to use a lens operation? It&#39;s simple enough using <code>do</code> notation: <code>doit (a,b) func = do { c &lt;- func b; return (a,c) }</code>"}, {"owner": {"reputation": 640, "user_id": 219614, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/703ea9b0434a9b328ec5b89d78ab2740?s=128&d=identicon&r=PG", "display_name": "Luke Cycon", "link": "https://stackoverflow.com/users/219614/luke-cycon"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439434846, "post_id": 31978596, "comment_id": 51863373, "body": "Lenses came to mind because I&#39;d be interested in solving this in the general sense-- that is abstracting out the shape, in this case 2-tuple."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1439434959, "post_id": 31978596, "comment_id": 51863402, "body": "Perhaps this SO question will help: <a href=\"http://stackoverflow.com/questions/22209982/how-to-modify-using-a-monadic-function-with-lenses\" title=\"how to modify using a monadic function with lenses\">stackoverflow.com/questions/22209982/&hellip;</a>"}, {"owner": {"reputation": 640, "user_id": 219614, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/703ea9b0434a9b328ec5b89d78ab2740?s=128&d=identicon&r=PG", "display_name": "Luke Cycon", "link": "https://stackoverflow.com/users/219614/luke-cycon"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1439435727, "post_id": 31978596, "comment_id": 51863569, "body": "Don&#39;t know how I missed that! I&#39;m marking an answer below correct as it was a direct solution to what I asked. Your link was certainly more what I was hoping to find though, thanks!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1439435986, "post_id": 31978596, "comment_id": 51863633, "body": "If your <code>Monad</code>s aren&#39;t <code>Applicative</code> yet, you might want to upgrade GHC. It&#39;s nice not to have to monkey around with that silly wrapper."}, {"owner": {"reputation": 640, "user_id": 219614, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/703ea9b0434a9b328ec5b89d78ab2740?s=128&d=identicon&r=PG", "display_name": "Luke Cycon", "link": "https://stackoverflow.com/users/219614/luke-cycon"}, "edited": false, "score": 0, "creation_date": 1439436066, "post_id": 31978596, "comment_id": 51863647, "body": "They most definitely are. To which wrapper are you referring?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1439437210, "post_id": 31978596, "comment_id": 51863871, "body": "<code>Applicative</code> and even <code>Functor</code> weren&#39;t superclasses of <code>Monad</code> till <code>base 4.8</code> (GHC 7.10). In the bad old days of last year, people had to use a newtype wrapper to turn arbitrary monads into applicatives."}], "answers": [{"comments": [{"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "edited": false, "score": 4, "creation_date": 1439435623, "post_id": 31978864, "comment_id": 51863549, "body": "Note that <code>flip traverse</code> is <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Traversable.html#v:for\" rel=\"nofollow noreferrer\"><code>for</code></a>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 6, "last_activity_date": 1439435901, "last_edit_date": 1439435901, "creation_date": 1439435331, "answer_id": 31978864, "question_id": 31978596, "link": "https://stackoverflow.com/questions/31978596/monadic-alteration-to-tuple/31978864#31978864", "title": "Monadic alteration to tuple", "body": "<p>Your function is just <code>forM = flip mapM</code>, or <code>for = flip traverse</code> if you relax the <code>Monad</code> constraint to <code>Applicative</code>. The <code>Functor</code> being traversed is <code>(,) a</code>.</p>\n\n<pre><code>Prelude&gt; let foo :: Applicative f =&gt; (a, b) -&gt; (b -&gt; f c) -&gt; f (a, c); foo p k = traverse k p\nPrelude&gt; :t foo\nfoo :: Applicative f =&gt; (a, b) -&gt; (b -&gt; f c) -&gt; f (a, c)\nPrelude&gt; foo (1,2) (\\x -&gt; [x,2*x])\n[(1,2),(1,4)]\n</code></pre>\n\n<p>(Also, as dfeuer points out, you don't even need <code>Applicative</code> in this specific case.)</p>\n"}, {"comments": [{"owner": {"reputation": 640, "user_id": 219614, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/703ea9b0434a9b328ec5b89d78ab2740?s=128&d=identicon&r=PG", "display_name": "Luke Cycon", "link": "https://stackoverflow.com/users/219614/luke-cycon"}, "edited": false, "score": 0, "creation_date": 1439438403, "post_id": 31978867, "comment_id": 51864170, "body": "Right you are. I must dig a bit deeper into the lens types. I should have immediately noticed the Functor aspect of the Lens definition. Thanks for pointing that out!"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1439449522, "post_id": 31978867, "comment_id": 51868614, "body": "Isn&#39;t that just: <code>changesecond = flip _2</code>?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1439582068, "post_id": 31978867, "comment_id": 51937903, "body": "Instead of invoking the <code>_2</code> lens directly, I&#39;d suggest using <code>traverseOf</code>: <code>changesecond = flip (traverseOf _2)</code>. While <a href=\"http://stackoverflow.com/a/22210866/1333025\"><code>traverseOf = id</code></a>, it makes the code somewhat more readable."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 8, "last_activity_date": 1439577324, "last_edit_date": 1592644375, "creation_date": 1439435352, "answer_id": 31978867, "question_id": 31978596, "link": "https://stackoverflow.com/questions/31978596/monadic-alteration-to-tuple/31978867#31978867", "title": "Monadic alteration to tuple", "body": "<p>This is definitely lensy. The monad is actually just a bit of a distraction because all you need is a functor:</p>\n<pre><code>changesecond (a, b) f = fmap (a,) (f b)\n</code></pre>\n<p>I'm pretty sure the <code>_2</code> lens can be made to do your bidding with a basic lens thing like maybe <code>over</code> but I'm not too familiar with the library yet.</p>\n<h3>Edit</h3>\n<p>No combinator is really needed. You can write</p>\n<pre><code>changesecond pair f = _2 f pair\n</code></pre>\n<p>You should be able to work this out from the general definition of the <code>Lens</code> type.</p>\n<h3>Edit 2</h3>\n<p>This simple example demonstrates the main theme of Van Laarhoven lens construction:</p>\n<ol>\n<li>Extract the focus from the context.</li>\n<li>Apply the given function to produce a functorful of results.</li>\n<li>Use <code>fmap</code> to restore the contexts to the results.</li>\n</ol>\n<p>Ed Kmett's <code>lens</code> library elaborates on this theme in various ways. Sometimes it strengthens the functor constraint. Sometimes it generalizes the function to a profunctor. In the case of <code>Equality</code>, it removes the functor constraint. It just turns out that the same basic type shape can express a lot of different ideas.</p>\n"}], "owner": {"reputation": 640, "user_id": 219614, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/703ea9b0434a9b328ec5b89d78ab2740?s=128&d=identicon&r=PG", "display_name": "Luke Cycon", "link": "https://stackoverflow.com/users/219614/luke-cycon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 31978867, "answer_count": 2, "score": 5, "last_activity_date": 1439577324, "creation_date": 1439433468, "last_edit_date": 1439449408, "question_id": 31978596, "link": "https://stackoverflow.com/questions/31978596/monadic-alteration-to-tuple", "title": "Monadic alteration to tuple", "body": "<p>I am looking for a function with type similar to:</p>\n\n<pre><code>Monad m =&gt; (a, b) -&gt; (b -&gt; m c) -&gt; m (a, c)\n</code></pre>\n\n<p>It appears to me as some combination of bind (<code>&gt;&gt;=</code>) and a lens operation.</p>\n\n<p>I am aware that I can solve this with a pattern match after a bind, but my gut tells me there is a \"simpler\" way to write this by leveraging lenses.</p>\n\n<p>Is there any such operation?</p>\n"}]